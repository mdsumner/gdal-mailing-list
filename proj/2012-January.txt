From spethm at landcareresearch.co.nz  Mon Jan  2 14:25:43 2012
From: spethm at landcareresearch.co.nz (Michael Speth)
Date: Tue, 03 Jan 2012 11:25:43 +1300
Subject: [Proj] Build fails on Windows
In-Reply-To: <CABUeae9GkYErGo+uPmjHC1d-cifSTwx60PtvbEig4EQO_+YW2Q@mail.gmail.com>
References: <4EF28CB8.9010505@gmail.com>
	<4EF39CC1.7030000@landcareresearch.co.nz>
	<CA+YzLBc2nfF2+w88E=sDvTurP+DDg_q_chZAVXc_uvOqVcovew@mail.gmail.com>
	<CABUeae9GkYErGo+uPmjHC1d-cifSTwx60PtvbEig4EQO_+YW2Q@mail.gmail.com>
Message-ID: <4F022EE7.5090004@landcareresearch.co.nz>

Hello All,
   I applied and tried Mateusz patch and it seems to work without any 
problems on 64-bit Ubuntu.  Has anyone tried it under windows?  Thanks 
Mateusz!

Regards
On 23/12/11 11:50, Mateusz Łoskot wrote:
> On 22 December 2011 22:00, Frank Warmerdam<warmerdam at pobox.com>  wrote:
>> On Thu, Dec 22, 2011 at 1:10 PM, Michael Speth
>> <spethm at landcareresearch.co.nz>  wrote:
>>> Hello,
>>>    Why is proj.4 being compiled with a C++ compiler?  Variable length
>>> arrays are valid C language constructs but are not in C++.  So does
>>> proj.4 need to be both C and C++ compiler compliant?
>>>
>> Michael,
>>
>> This will need to be corrected before we release.
> Quick patch proposal attached.
>
> Best regards,


-- 
Michael Speth
Research Systems Developer
Landcare Research



From jmfluis at gmail.com  Tue Jan  3 11:50:43 2012
From: jmfluis at gmail.com (J. Luis)
Date: Tue, 03 Jan 2012 19:50:43 +0000
Subject: [Proj] Build fails on Windows
In-Reply-To: <4F022EE7.5090004@landcareresearch.co.nz>
References: <4EF28CB8.9010505@gmail.com>	<4EF39CC1.7030000@landcareresearch.co.nz>	<CA+YzLBc2nfF2+w88E=sDvTurP+DDg_q_chZAVXc_uvOqVcovew@mail.gmail.com>	<CABUeae9GkYErGo+uPmjHC1d-cifSTwx60PtvbEig4EQO_+YW2Q@mail.gmail.com>
	<4F022EE7.5090004@landcareresearch.co.nz>
Message-ID: <4F035C13.9000206@gmail.com>

Hi,

I didn't test it but it builds fine with Win7 VS10 64 bits

Joaquim

> Hello All,
>     I applied and tried Mateusz patch and it seems to work without any
> problems on 64-bit Ubuntu.  Has anyone tried it under windows?  Thanks
> Mateusz!
>
> Regards
> On 23/12/11 11:50, Mateusz Łoskot wrote:
>> On 22 December 2011 22:00, Frank Warmerdam<warmerdam at pobox.com>   wrote:
>>> On Thu, Dec 22, 2011 at 1:10 PM, Michael Speth
>>> <spethm at landcareresearch.co.nz>   wrote:
>>>> Hello,
>>>>     Why is proj.4 being compiled with a C++ compiler?  Variable length
>>>> arrays are valid C language constructs but are not in C++.  So does
>>>> proj.4 need to be both C and C++ compiler compliant?
>>>>
>>> Michael,
>>>
>>> This will need to be corrected before we release.
>> Quick patch proposal attached.
>>
>> Best regards,
>



From michal.seidl at gmail.com  Sat Jan  7 15:36:00 2012
From: michal.seidl at gmail.com (Michal Seidl)
Date: Sun, 08 Jan 2012 00:36:00 +0100
Subject: [Proj] GTX format
Message-ID: <4F08D6E0.4020104@gmail.com>

Hello,
I am looking forward for +geoidgrids ability in 4.8.0 version. To be 
prepared I have downloaded and compile current development version from SVN.

But I have no idea how to create and install gtx file with geoid data? 
Is there something like geo2bin? To compile text data in binary format?

How to aware proj that new gtx file exists and where?

Thanks for help, Michal


From ericnico.david at gmail.com  Sun Jan  8 01:49:35 2012
From: ericnico.david at gmail.com (nicolas david)
Date: Sun, 8 Jan 2012 10:49:35 +0100
Subject: [Proj] GTX format
In-Reply-To: <4F08D6E0.4020104@gmail.com>
References: <4F08D6E0.4020104@gmail.com>
Message-ID: <CACuRz0ta2oj6=4xouM9MOTd04Syhy_EfrUETfvhxfnTN4U0CHg@mail.gmail.com>

Hi Michal


But I have no idea how to create and install gtx file with geoid data?
>

the gtx file description could be found on vdatum noaa pages :
  http://vdatum.noaa.gov/dev/gtx_info.html#dev_gtx_binary

some Vertical Datum could be found on http://download.osgeo.org/proj/vdatum/
You need to install them on the same directory as your proj nad file (
directory containing nadgrid data, EPSG dictionnary etc..).
Look at your PROJ_LIB environnement Variable for the path of this directory.


> Is there something like geo2bin? To compile text data in binary format?
>
>
I'm not aware of such utilities, for french geoidgrids I have to write my
own utilitiy to convert from french geoid format to gtx format (you could
look this code on gitorious
http://gitorious.org/proj4-sandbox/proj4-cmake/blobs/ign/proj/src/ign2gtx.c)

When your write "text data" do you mean like *.lla file ?



> How to aware proj that new gtx file exists and where?
>
>
A) add theses gtx files on your nad directory ( PROJ_LIB envVar)
B) add the "+geoidgrids" option on your proj description


Nicolas DAVID
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120108/e05b8531/attachment.html>

From warmerdam at pobox.com  Sun Jan  8 10:37:25 2012
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Sun, 08 Jan 2012 10:37:25 -0800
Subject: [Proj] GTX format
In-Reply-To: <CACuRz0ta2oj6=4xouM9MOTd04Syhy_EfrUETfvhxfnTN4U0CHg@mail.gmail.com>
References: <4F08D6E0.4020104@gmail.com>
	<CACuRz0ta2oj6=4xouM9MOTd04Syhy_EfrUETfvhxfnTN4U0CHg@mail.gmail.com>
Message-ID: <4F09E265.4020403@pobox.com>

On 12-01-08 01:49 AM, nicolas david wrote:

>     Is there something like geo2bin? To compile text data in binary format?
>
>
> I'm not aware of such utilities, for french geoidgrids I have to write my own
> utilitiy to convert from french geoid format to gtx format (you could look this
> code on gitorious
> http://gitorious.org/proj4-sandbox/proj4-cmake/blobs/ign/proj/src/ign2gtx.c )
>
> When your write "text data" do you mean like *.lla file ?

Michael / Nicolas,

I would add that GDAL now supports reading and writing GTX
files.  So you can use GDAL to translate from other formats
(ie. GeoTIFF, ASCII) to GTX.

Hmm, I was going to point off to the driver documentation but
it seems I haven't written any.  Perhaps I can do this today.

>     How to aware proj that new gtx file exists and where?
>
> A) add theses gtx files on your nad directory ( PROJ_LIB envVar)
> B) add the "+geoidgrids" option on your proj description

Right - they will only be used when the coordinate system
definitions include an explicit +geoidgrids directive.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/warmerda
and watch the world go round - Rush    | Geospatial Software Developer



From charles.karney at sri.com  Mon Jan  9 06:46:59 2012
From: charles.karney at sri.com (Charles Karney)
Date: Mon, 9 Jan 2012 09:46:59 -0500
Subject: [Proj] English translation of Helmert, Geodesy, Vol. 2
Message-ID: <4F0AFDE3.7080902@sri.com>

I have borrowed the ACIC translation of

   F. R. Helmert,
   Die Mathematischen und Physikalischen Theorieen der Hoeheren Geodaesie
   (Mathematical and Physical Theories of Higher Geodesy),
   Vol. 2, The Physical Theories (Teubner, Leipzig, 1884)

from the USGS library in Reston, VA, and have posted a scan of it at

   http://geographiclib.sf.net/geodesic-papers/helmert84-en.html

(The translation is a work of the US Government, so it's not covered by
copyright.)

Notes:

* The table of contents and the cross-references in the text use the
   page numbers from the original book.  This pagination is indicated in
   the translation by the numbers above and below the horizontal lines in
   the text.

* The formulas have been cut and pasted (in the old-fashioned way!) from
   the book.  In some cases these are barely legible.  Go to the German
   text to disambiguate these; see
     http://books.google.com/books?id=p9-CAAAAIAAJ

* This PDF has 1001 pages.  However, the scan is perfectly legible when
   printed 2-up (2 pages per sheet).  This should work OK with A4 and US
   letter sizes.

-- 
Charles Karney <charles.karney at sri.com>
SRI International, Princeton, NJ 08543-5300
Tel: +1 609 734 2312


From michal.seidl at gmail.com  Tue Jan 10 14:19:28 2012
From: michal.seidl at gmail.com (Michal Seidl)
Date: Tue, 10 Jan 2012 14:19:28 -0800 (PST)
Subject: [Proj] Vertical Datum Shift
In-Reply-To: <loom.20111214T172431-274@post.gmane.org>
References: <loom.20111214T172431-274@post.gmane.org>
Message-ID: <1326233968086-7174076.post@n2.nabble.com>

Hi,
I also started playing with vertical datum just about week ago, so I have
this experience.
+geoidgrids works with proj4 version 4.8.0. Now the trunk version in SVN
repository. Download and run ./configure, make on linux machine from top
directory. (have no idea how on Windows).  You will find compiled binaries
at src folder. Than run this executable for testing. In my case I did not
the last step make install to prevent currently installed packages from
Ubuntu repository.

You have to use PROJ_LIB=<path to nad directory> to force new compiled proj
to see your gtx file.

Hope this help. Michal

--
View this message in context: http://osgeo-org.1803224.n2.nabble.com/Vertical-Datum-Shift-tp7096989p7174076.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From michal.seidl at gmail.com  Tue Jan 10 15:06:23 2012
From: michal.seidl at gmail.com (Michal Seidl)
Date: Tue, 10 Jan 2012 15:06:23 -0800 (PST)
Subject: [Proj] GTX format
In-Reply-To: <4F09E265.4020403@pobox.com>
References: <4F08D6E0.4020104@gmail.com>
	<CACuRz0ta2oj6=4xouM9MOTd04Syhy_EfrUETfvhxfnTN4U0CHg@mail.gmail.com>
	<4F09E265.4020403@pobox.com>
Message-ID: <1326236783684-7174205.post@n2.nabble.com>

Hello,
thanks for link to GDAL library. Works awesome. I have formatted my data to
Arc/ASCII.

Even parameters DX DY instead of CELLSIZE work perfect despite I did not
find these parameters on ESRI site
http://resources.esri.com/help/9.3/arcgisengine/java/GP_ToolRef/spatial_analyst_tools/esri_ascii_raster_format.htm.

So process was quite straightforward. My ASCII ->(python) Arc/ESRI ->(gdal)
GTX

Thank again Michal

P.S. I stacked on grids in proj ;( New thread in mailing list. 



--
View this message in context: http://osgeo-org.1803224.n2.nabble.com/GTX-format-tp7163118p7174205.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From michal.seidl at gmail.com  Tue Jan 10 15:49:07 2012
From: michal.seidl at gmail.com (Michal Seidl)
Date: Tue, 10 Jan 2012 15:49:07 -0800 (PST)
Subject: [Proj] How grids work in PROJ4
Message-ID: <1326239347639-7174312.post@n2.nabble.com>

Hello,
I moved forward on implementing quite new Czech projection called "Krovak
Modified" which is used in new ProjectedCRS EPSG:5224. I also want to
implement vertical datum "Bpv" by use of +geoidgrids but I found myself
lacking some basic information which I can not easily find  on the web.

1)  What kind of coordinate transformation is supported by PROJ 4.8.0?
    - towgs84?
    - nadgrids?
    - geoidgrids?
    - others?


2) Can I combined these transformation? And how they are applied? Look at
these situations:

cs2cs ... +proj=latlong  +nadgrids=... +geoidgrids=...  +towgs84=...  +to 
+towgs84 ... +geoidgrids=... +nadgrids=...  +proj=latlong

What happens?


LLH->(dL,dL)->LLH->(dH)->LLH->XYZ->(3D)->XYZ(wgs84)->(3D)->XYZ->LLH->(dH)->LLH->(dL,dL)->LLH 

I mean by this:
a) if there is +nadgrids  and +towgs84 on the LEFT SIDE PROJ firstly changes
LL by dL,dL from grid before 3D transformation
b) if there is +geoidgrids on the LEFT SIDE PROJ thinks there is orthometric
height on input so firstly it changes H by dh from grid to get ellipsoid
height before 3D transformation
c) on the RIGHT SITE it should work in a opposite order. Firstly do 3D
transformation and than apply +nadgrids and +geoidgrids as there is
ellipsoid height on the imput from 3D transformation

I think PROJ should do this but I am not sure about it. I tried to do some
test but I got confused. Is there some document how it exactly works?

Thanks Michal

--
View this message in context: http://osgeo-org.1803224.n2.nabble.com/How-grids-work-in-PROJ4-tp7174312p7174312.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From warmerdam at pobox.com  Tue Jan 10 16:34:30 2012
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Tue, 10 Jan 2012 16:34:30 -0800
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <1326239347639-7174312.post@n2.nabble.com>
References: <1326239347639-7174312.post@n2.nabble.com>
Message-ID: <CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>

On Tue, Jan 10, 2012 at 3:49 PM, Michal Seidl <michal.seidl at gmail.com> wrote:
> Hello,
> I moved forward on implementing quite new Czech projection called "Krovak
> Modified" which is used in new ProjectedCRS EPSG:5224. I also want to
> implement vertical datum "Bpv" by use of +geoidgrids but I found myself
> lacking some basic information which I can not easily find  on the web.
>
> 1)  What kind of coordinate transformation is supported by PROJ 4.8.0?
>    - towgs84?
>    - nadgrids?
>    - geoidgrids?
>    - others?

Michal,

Yes, the above, and obviously projected transformations (ie proj=tmerc).

> 2) Can I combined these transformation? And how they are applied? Look at
> these situations:
>
> cs2cs ... +proj=latlong  +nadgrids=... +geoidgrids=...  +towgs84=...  +to
> +towgs84 ... +geoidgrids=... +nadgrids=...  +proj=latlong

Only one horizontal datum transformation can be associated with a
coordinate system.  So you should not currently mix +towgs84 and
+nadgrids.

> What happens?
>
> LLH->(dL,dL)->LLH->(dH)->LLH->XYZ->(3D)->XYZ(wgs84)->(3D)->XYZ->LLH->(dH)->LLH->(dL,dL)->LLH
>
> I mean by this:
> a) if there is +nadgrids  and +towgs84 on the LEFT SIDE PROJ firstly changes
> LL by dL,dL from grid before 3D transformation

Only one or the other is going to work properly.

> b) if there is +geoidgrids on the LEFT SIDE PROJ thinks there is orthometric
> height on input so firstly it changes H by dh from grid to get ellipsoid
> height before 3D transformation

Right

> c) on the RIGHT SITE it should work in a opposite order. Firstly do 3D
> transformation and than apply +nadgrids and +geoidgrids as there is
> ellipsoid height on the imput from 3D transformation

Right, with the caveat of only nadgrids or towgs84.

> I think PROJ should do this but I am not sure about it. I tried to do some
> test but I got confused. Is there some document how it exactly works?

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Software Developer


From knudsen.thomas at gmail.com  Tue Jan 10 23:39:19 2012
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Wed, 11 Jan 2012 08:39:19 +0100
Subject: [Proj] Vertical Datum Shift
In-Reply-To: <1326233968086-7174076.post@n2.nabble.com>
References: <loom.20111214T172431-274@post.gmane.org>
	<1326233968086-7174076.post@n2.nabble.com>
Message-ID: <CAH0YoEN9SxwEmWMbwBPwsMPU5ou9ZvrZgfRhfb9zsjBQopM8xw@mail.gmail.com>

2012/1/10 Michal Seidl <michal.seidl at gmail.com>:
> In my case I did not
> the last step make install to prevent currently installed packages from
> Ubuntu repository.

I haven't tested this for proj, but usually you can do a "per user
install" in ~/bin, ~/man, etc. by running the configure script as
./configure --prefix=$HOME, then prepend the ~/bin directory to your
path variable.

hth/thomas


From knudsen.thomas at gmail.com  Tue Jan 10 23:48:47 2012
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Wed, 11 Jan 2012 08:48:47 +0100
Subject: [Proj] GTX format
In-Reply-To: <1326236783684-7174205.post@n2.nabble.com>
References: <4F08D6E0.4020104@gmail.com>
	<CACuRz0ta2oj6=4xouM9MOTd04Syhy_EfrUETfvhxfnTN4U0CHg@mail.gmail.com>
	<4F09E265.4020403@pobox.com>
	<1326236783684-7174205.post@n2.nabble.com>
Message-ID: <CAH0YoEPVL3bkt7F8h=SH90jyDYW2FOy_chTKjkEr7Li3ZHsqpw@mail.gmail.com>

2012/1/11 Michal Seidl <michal.seidl at gmail.com>:
> I have formatted my data to Arc/ASCII.
> Even parameters DX DY instead of CELLSIZE work perfect despite I did not
> find these parameters on ESRI site

Michal,

Could you elaborate a bit on this? Does this mean that you have
separate DX and DY entries in your ArcASCII header, rather than
CELLSIZE?

The limitation to square cells is one of the most annoying parts of
the ArcASCII - a format that is otherwise extremely useful as a least
common denominator exchange format.

/thomas


From michal.seidl at gmail.com  Wed Jan 11 14:12:39 2012
From: michal.seidl at gmail.com (Michal Seidl)
Date: Wed, 11 Jan 2012 14:12:39 -0800 (PST)
Subject: [Proj] GTX format
In-Reply-To: <CAH0YoEPVL3bkt7F8h=SH90jyDYW2FOy_chTKjkEr7Li3ZHsqpw@mail.gmail.com>
References: <4F08D6E0.4020104@gmail.com>
	<CACuRz0ta2oj6=4xouM9MOTd04Syhy_EfrUETfvhxfnTN4U0CHg@mail.gmail.com>
	<4F09E265.4020403@pobox.com>
	<1326236783684-7174205.post@n2.nabble.com>
	<CAH0YoEPVL3bkt7F8h=SH90jyDYW2FOy_chTKjkEr7Li3ZHsqpw@mail.gmail.com>
Message-ID: <1326319959580-7178026.post@n2.nabble.com>

Hello,
I only checked GDAL format document.
http://www.gdal.org/frmt_various.html#AAIGrid. There is note about DX and
DY. So I used it. I do not if it is some history issue or GDAL extension. I
belive in GDAL library it is writen correctly.

Michal

--
View this message in context: http://osgeo-org.1803224.n2.nabble.com/GTX-format-tp7163118p7178026.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From michal.seidl at gmail.com  Wed Jan 11 15:15:39 2012
From: michal.seidl at gmail.com (Michal Seidl)
Date: Thu, 12 Jan 2012 00:15:39 +0100
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
Message-ID: <4F0E181B.7020001@gmail.com>

Hello Frank,
>
> Only one horizontal datum transformation can be associated with a
> coordinate system.  So you should not currently mix +towgs84 and
> +nadgrids.

I got it, do not mix +towgs84 and +nadgrids. Thanks

>
>> b) if there is +geoidgrids on the LEFT SIDE PROJ thinks there is orthometric
>> height on input so firstly it changes H by dh from grid to get ellipsoid
>> height before 3D transformation
>
> Right
>

It seems to me as cs2cs (trunk version) works exactly in an opposite 
(unreasonable?) manner. If there is +geoidgrids on the LEFT side I would 
suppose cs2cs SUBTRACTs geoid heigth above ellipsoid from GTX file but 
cs2cs ADDs it.

As I know it is usual there is positive value in geoid data set in case 
geoid is above ellipsoid. Also egm96_15.gtx is done like this. Should it 
be inverted in case of proj library?

Example:

PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84 
+towgs84=0,0,0 +geoidgrids=egm96_15.gtx +to +proj=latlong +ellps=WGS84 
+towgs84=0,0,0

15d 50d 0
15dE    50dN 44.690

PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84 
+towgs84=0,0,0 +to +geoidgrids=egm96_15.gtx +proj=latlong +ellps=WGS84 
+towgs84=0,0,0
15d 50d 0
15dE    50dN -44.690

Best regards, Michal


From warmerdam at pobox.com  Wed Jan 11 16:47:45 2012
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed, 11 Jan 2012 16:47:45 -0800
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <4F0E181B.7020001@gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
Message-ID: <CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>

On Wed, Jan 11, 2012 at 3:15 PM, Michal Seidl <michal.seidl at gmail.com> wrote:

>>> b) if there is +geoidgrids on the LEFT SIDE PROJ thinks there is orthometric
>>> height on input so firstly it changes H by dh from grid to get ellipsoid
>>> height before 3D transformation
>>
>> Right
>>
>
> It seems to me as cs2cs (trunk version) works exactly in an opposite
> (unreasonable?) manner. If there is +geoidgrids on the LEFT side I would
> suppose cs2cs SUBTRACTs geoid heigth above ellipsoid from GTX file but
> cs2cs ADDs it.

Michal,

I have checked.  At a point like -116,39 the egm96_15.gtx file has a
value of approximate -21.  At that location the geoid is around 21
meters above the ellipsoidal height.  So the value in the .gtx file is
the amount (in meters) that should be added to the geoid to get to
the ellipsoidal height.

When the geoidgrid is on the left side (the source coordinate system)
the input height is assumed to be geoidal and the amount in the
gtx is added to get to ellipsoidal height.  When the right side
(destination coordinate system) has a geoidgrids setting the value
read from the gtx is subtracted from the elevation to get back to
geoidal height.


> As I know it is usual there is positive value in geoid data set in case
> geoid is above ellipsoid.

Your statement does not match with my findings.  I expect the opposite.

I will note I am using the same convention (positive vs. negative) as
I encountered with the .gtx files distributed with the VDatum program.

>Also egm96_15.gtx is done like this. Should it
> be inverted in case of proj library?
>
> Example:
>
> PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84
> +towgs84=0,0,0 +geoidgrids=egm96_15.gtx +to +proj=latlong +ellps=WGS84
> +towgs84=0,0,0
>
> 15d 50d 0
> 15dE    50dN 44.690
>
> PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84
> +towgs84=0,0,0 +to +geoidgrids=egm96_15.gtx +proj=latlong +ellps=WGS84
> +towgs84=0,0,0
> 15d 50d 0
> 15dE    50dN -44.690

I checked in the area of 15E, 50N and the .gtx value was approximately
+45 in the .gtx file.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Software Developer


From jmfluis at gmail.com  Wed Jan 11 17:57:40 2012
From: jmfluis at gmail.com (J. Luis)
Date: Thu, 12 Jan 2012 01:57:40 +0000
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
Message-ID: <4F0E3E14.7040007@gmail.com>


> Michal,
>
> I have checked.  At a point like -116,39 the egm96_15.gtx file has a
> value of approximate -21.  At that location the geoid is around 21
> meters above the ellipsoidal height.  So the value in the .gtx file is
> the amount (in meters) that should be added to the geoid to get to
> the ellipsoidal height.
>
> When the geoidgrid is on the left side (the source coordinate system)
> the input height is assumed to be geoidal and the amount in the
> gtx is added to get to ellipsoidal height.  When the right side
> (destination coordinate system) has a geoidgrids setting the value
> read from the gtx is subtracted from the elevation to get back to
> geoidal height.
>
>
>> As I know it is usual there is positive value in geoid data set in case
>> geoid is above ellipsoid.
> Your statement does not match with my findings.  I expect the opposite.
>
> I will note I am using the same convention (positive vs. negative) as
> I encountered with the .gtx files distributed with the VDatum program.


Frank,

I don't know what type of altitude is assumed to be the left/right side 
but there is no doubt that when the geoid is above the ellipsoid the so 
called geoid undulations or anomalies are positive and negative when 
they are bellow. It should be better to call the altitudes as they are 
know in geodesy.

- The ellipsoidal distance is the distance to the ellipsoid - usually 
denoted by 'H'
- Orthometric distance is the distance along the plumb line from a point 
and the geoid - usually called 'h' and is what we simply call 'altitude'
- Geoid undulation is the distance between the geoid and the ellipsoid - 
called 'N'

the relation between the three is

h = H - N

We can see it pictorially here 
http://www.nrcan.gc.ca/earth-sciences/node/5580

If that matters (and it should) the point -116 39 according to the egm96 
geoid has an geoid anomaly (or geoid height) of -22.02 and not -21. 
Though, -21 is more close to value given by the egm2008 geoid, which is 
-21.60. One get check those values here
http://geographiclib.sourceforge.net/cgi-bin/GeoidEval
that is computed using the free geographicLib

Joaquim



>> Also egm96_15.gtx is done like this. Should it
>> be inverted in case of proj library?
>>
>> Example:
>>
>> PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84
>> +towgs84=0,0,0 +geoidgrids=egm96_15.gtx +to +proj=latlong +ellps=WGS84
>> +towgs84=0,0,0
>>
>> 15d 50d 0
>> 15dE    50dN 44.690
>>
>> PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84
>> +towgs84=0,0,0 +to +geoidgrids=egm96_15.gtx +proj=latlong +ellps=WGS84
>> +towgs84=0,0,0
>> 15d 50d 0
>> 15dE    50dN -44.690
> I checked in the area of 15E, 50N and the .gtx value was approximately
> +45 in the .gtx file.
>
> Best regards,



From Mikael.Rittri at carmenta.com  Fri Jan 13 07:02:18 2012
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Fri, 13 Jan 2012 15:02:18 +0000
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
Message-ID: <E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>

Frank, I believe your implementation is correct, although your 
explanation of the signs is easy to misunderstand. 

> At a point like -116,39 the egm96_15.gtx file has a
> value of approximate -21. At that location the geoid 
> is around 21 meters above the ellipsoidal height.  

I think you intended to say 

"the geoid height is around 21 meters above the ellipsoidal height."

I would express it: "the geoid surface is around 21 meters _below_ the ellipsoid surface." But this means that the height value of something above
the geoid (orthometric height) is about 21 meters _larger_ than its height
above the ellipsoid. Which I think you, Michal and Joaquim agree with.

> So the value in the .gtx file is the amount (in meters) that should be
> added to the geoid to get to the ellipsoidal height.

Yes, but I would express it: ... that should be added to the orthometric
height to get height above ellipsoid.

The term "ellipsoidal height" almost always means "height of something above
the ellipsoid", so that's a harmless term. 
    But the term "geoid height" or "geoidal height" sometimes means "height of geoid surface above ellipsoid surface", and sometimes means "height of something above the geoid". 
    So "geoid undulation" is a more unambiguous term for the first meaning,
and "orthometric height" is a more unambiguous term for the second meaning. 

So in summary, I think everyone is (almost) right!

Best regards,

Mikael Rittri
Carmenta AB
Sweden
http://www.carmenta.com

-----Original Message-----
From: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On Behalf Of Frank Warmerdam
Sent: Thursday, January 12, 2012 1:48 AM
To: michal.seidl at gmail.com; PROJ.4 and general Projections Discussions
Subject: Re: [Proj] How grids work in PROJ4

On Wed, Jan 11, 2012 at 3:15 PM, Michal Seidl <michal.seidl at gmail.com> wrote:

>>> b) if there is +geoidgrids on the LEFT SIDE PROJ thinks there is orthometric
>>> height on input so firstly it changes H by dh from grid to get ellipsoid
>>> height before 3D transformation
>>
>> Right
>>
>
> It seems to me as cs2cs (trunk version) works exactly in an opposite
> (unreasonable?) manner. If there is +geoidgrids on the LEFT side I would
> suppose cs2cs SUBTRACTs geoid heigth above ellipsoid from GTX file but
> cs2cs ADDs it.

Michal,

I have checked.  At a point like -116,39 the egm96_15.gtx file has a
value of approximate -21.  At that location the geoid is around 21
meters above the ellipsoidal height.  So the value in the .gtx file is
the amount (in meters) that should be added to the geoid to get to
the ellipsoidal height.

When the geoidgrid is on the left side (the source coordinate system)
the input height is assumed to be geoidal and the amount in the
gtx is added to get to ellipsoidal height.  When the right side
(destination coordinate system) has a geoidgrids setting the value
read from the gtx is subtracted from the elevation to get back to
geoidal height.


> As I know it is usual there is positive value in geoid data set in case
> geoid is above ellipsoid.

Your statement does not match with my findings.  I expect the opposite.

I will note I am using the same convention (positive vs. negative) as
I encountered with the .gtx files distributed with the VDatum program.

>Also egm96_15.gtx is done like this. Should it
> be inverted in case of proj library?
>
> Example:
>
> PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84
> +towgs84=0,0,0 +geoidgrids=egm96_15.gtx +to +proj=latlong +ellps=WGS84
> +towgs84=0,0,0
>
> 15d 50d 0
> 15dE    50dN 44.690
>
> PROJ_LIB=nad PROJ_DEBUG=ON  src/cs2cs +proj=latlong +ellps=WGS84
> +towgs84=0,0,0 +to +geoidgrids=egm96_15.gtx +proj=latlong +ellps=WGS84
> +towgs84=0,0,0
> 15d 50d 0
> 15dE    50dN -44.690

I checked in the area of 15E, 50N and the .gtx value was approximately
+45 in the .gtx file.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Software Developer
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj


From jmfluis at gmail.com  Fri Jan 13 07:49:13 2012
From: jmfluis at gmail.com (J Luis)
Date: Fri, 13 Jan 2012 15:49:13 +0000
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
	<E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
Message-ID: <CAE_VgzOK_HxRovb9n205s23R0Qe5J=mKNSij7M2qW+JH28sZBA@mail.gmail.com>

>
>
> Yes, but I would express it: ... that should be added to the orthometric
> height to get height above ellipsoid.
>
> The term "ellipsoidal height" almost always means "height of something
> above
> the ellipsoid", so that's a harmless term.
>    But the term "geoid height" or "geoidal height" sometimes means "height
> of geoid surface above ellipsoid surface", and sometimes means "height of
> something above the geoid".
>    So "geoid undulation" is a more unambiguous term for the first meaning,
> and "orthometric height" is a more unambiguous term for the second meaning.
>
> So in summary, I think everyone is (almost) right!
>

Hi,

It happens that I just tested with our Portuguese geoid with following
command

cs2cs +proj=latlong +ellps=WGS84 +towgs84=0,0,0 +geoidgrids=GeodPT08.gtx
+to +proj=latlong
+ellps=WGS84 +towgs84=0,0,0
-8 37 0
8dW     37dN 51.910

which is fine and means that the left side altitude was interpreted as
ellipsoidal height and the output is the geoid undulation at that point.
Because this matter can easily be confusing, I propose that 2 extra options
are added to cs2cs so that we can unambiguously tell the program what type
of altitudes are provided in input. And those would be

+H -> means input height are ellipsoidal heights
+h -> means input are Orthometric (plain 'altitudes')

and the output is determined according with the relation h = H - N

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120113/bbc8a4d4/attachment.html>

From warmerdam at pobox.com  Fri Jan 13 10:37:27 2012
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Fri, 13 Jan 2012 10:37:27 -0800
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <CAE_VgzOK_HxRovb9n205s23R0Qe5J=mKNSij7M2qW+JH28sZBA@mail.gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
	<E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
	<CAE_VgzOK_HxRovb9n205s23R0Qe5J=mKNSij7M2qW+JH28sZBA@mail.gmail.com>
Message-ID: <CA+YzLBfB15W-dO0UBCBZt2ppcLfbSYbW66huD1JLWy0fHE+L_g@mail.gmail.com>

On Fri, Jan 13, 2012 at 7:49 AM, J Luis <jmfluis at gmail.com> wrote:
> which is fine and means that the left side altitude was interpreted as
> ellipsoidal height and the output is the geoid undulation at that point.
> Because this matter can easily be confusing, I propose that 2 extra options
> are added to cs2cs so that we can unambiguously tell the program what type
> of altitudes are provided in input. And those would be
>
> +H -> means input height are ellipsoidal heights
> +h -> means input are Orthometric (plain 'altitudes')
>
> and the output is determined according with the relation h = H - N

Joaquim,

I don't agree with this change amoung other reasons because it
is different than the horizontal datum case.  Note that despite
the +geoidgrids parameter name, the system does not know
anything about geoid's.  Such grids can also be used to express
offsets from other kinds of vertical datums from the ellipsoidal
height.


Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Software Developer


From jmfluis at gmail.com  Fri Jan 13 12:43:21 2012
From: jmfluis at gmail.com (J Luis)
Date: Fri, 13 Jan 2012 20:43:21 +0000
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <CA+YzLBfB15W-dO0UBCBZt2ppcLfbSYbW66huD1JLWy0fHE+L_g@mail.gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
	<E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
	<CAE_VgzOK_HxRovb9n205s23R0Qe5J=mKNSij7M2qW+JH28sZBA@mail.gmail.com>
	<CA+YzLBfB15W-dO0UBCBZt2ppcLfbSYbW66huD1JLWy0fHE+L_g@mail.gmail.com>
Message-ID: <CAE_VgzMUX2APFv7Upto=BNzaoMaNXz5SSt37bObwE-WVi4dF+w@mail.gmail.com>

On Fri, Jan 13, 2012 at 6:37 PM, Frank Warmerdam <warmerdam at pobox.com>wrote:

> On Fri, Jan 13, 2012 at 7:49 AM, J Luis <jmfluis at gmail.com> wrote:
> > which is fine and means that the left side altitude was interpreted as
> > ellipsoidal height and the output is the geoid undulation at that point.
> > Because this matter can easily be confusing, I propose that 2 extra
> options
> > are added to cs2cs so that we can unambiguously tell the program what
> type
> > of altitudes are provided in input. And those would be
> >
> > +H -> means input height are ellipsoidal heights
> > +h -> means input are Orthometric (plain 'altitudes')
> >
> > and the output is determined according with the relation h = H - N
>
> Joaquim,
>
> I don't agree with this change amoung other reasons because it
> is different than the horizontal datum case.  Note that despite
> the +geoidgrids parameter name, the system does not know
> anything about geoid's.  Such grids can also be used to express
> offsets from other kinds of vertical datums from the ellipsoidal
> height.



Right, but as I said, I think it will be a bit confusing as this thread
proves.

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120113/1040c21f/attachment.html>

From michal.seidl at gmail.com  Fri Jan 13 15:11:50 2012
From: michal.seidl at gmail.com (Michal Seidl)
Date: Sat, 14 Jan 2012 00:11:50 +0100
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
	<E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
Message-ID: <4F10BA36.2080902@gmail.com>

Hi everybody,
finally I hope it is clear to me.
- the +geoidgrids is implemented correctly and works as Frank wrote
- Mikael Rittri explanation helps me a lot, I was really for a moment 
confused by Frank's one
- Joaquim formula h = H-N is OK. But as Frank said +geoidgrids is only 
name and can be used for other height correction which is exactly my 
situation.

Thanks a lot Michal



From knudsen.thomas at gmail.com  Sun Jan 15 05:58:33 2012
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Sun, 15 Jan 2012 14:58:33 +0100
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <4F10BA36.2080902@gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
	<E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
	<4F10BA36.2080902@gmail.com>
Message-ID: <CAH0YoEPLFBsXxKW+5_6V=qH-uXCwwEsBagYpgPJQ819z9UjVpQ@mail.gmail.com>

2012/1/14 Michal Seidl <michal.seidl at gmail.com>

> - Mikael Rittri explanation helps me a lot, I was really for a moment
> confused by Frank's one
>

Mikael's clarification was, indeed, excellent and useful


> - Joaquim formula h = H-N is OK. But as Frank said +geoidgrids is only
> name and can be used for other height correction which is exactly my
> situation.
>

But please note that Wikipedia and leading geodetic textbooks
(Hoffmann-Wellenhof & Moritz: Physical Geodesy, as well as Torge: Geodesy)
use a different notation:

h: height above ellipsoid
H: orthometric height (which to an excellent approximation is equivalent to
the height above the geoid)

Hence: h = N + H

So following Joaquim's suggestion of +H and +h options is quite risky. Out
of context you can never be sure what is meant by H and h.

/Thomas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120115/5f135c97/attachment.html>

From jmfluis at gmail.com  Sun Jan 15 12:12:07 2012
From: jmfluis at gmail.com (J. Luis)
Date: Sun, 15 Jan 2012 20:12:07 +0000
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <CAH0YoEPLFBsXxKW+5_6V=qH-uXCwwEsBagYpgPJQ819z9UjVpQ@mail.gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>	<4F0E181B.7020001@gmail.com>	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>	<E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>	<4F10BA36.2080902@gmail.com>
	<CAH0YoEPLFBsXxKW+5_6V=qH-uXCwwEsBagYpgPJQ819z9UjVpQ@mail.gmail.com>
Message-ID: <4F133317.6070003@gmail.com>

On 15-01-2012 13:58, Thomas Knudsen wrote:
> 2012/1/14 Michal Seidl <michal.seidl at gmail.com 
> <mailto:michal.seidl at gmail.com>>
>
>     - Mikael Rittri explanation helps me a lot, I was really for a moment
>     confused by Frank's one
>
>
> Mikael's clarification was, indeed, excellent and useful
>
>     - Joaquim formula h = H-N is OK. But as Frank said +geoidgrids is only
>     name and can be used for other height correction which is exactly my
>     situation.
>
>
> But please note that Wikipedia and leading geodetic textbooks 
> (Hoffmann-Wellenhof & Moritz: Physical Geodesy, as well as Torge: 
> Geodesy) use a different notation:
>
> h: height above ellipsoid
> H: orthometric height (which to an excellent approximation is 
> equivalent to the height above the geoid)
>
> Hence: h = N + H
>
> So following Joaquim's suggestion of +H and +h options is quite risky. 
> Out of context you can never be sure what is meant by H and h.
>
> /Thomas
>

Ai, this is embarrassing for me. Off course I mistakenly swapped the H/h 
as it never crossed my mind going against the notation followed by the 
"Physical Geodesy" bibles.

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120115/582b38bc/attachment.html>

From Mikael.Rittri at carmenta.com  Mon Jan 16 02:50:28 2012
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Mon, 16 Jan 2012 10:50:28 +0000
Subject: [Proj] How grids work in PROJ4
In-Reply-To: <4F133317.6070003@gmail.com>
References: <1326239347639-7174312.post@n2.nabble.com>
	<CA+YzLBfUPXbBFNU6=bRP4c8+H0Lxamh5ohGWmXidrian65O7QQ@mail.gmail.com>
	<4F0E181B.7020001@gmail.com>
	<CA+YzLBfgq2D6vmNg6T7Us5K6=2c2ypHTRSLW0pFE7LPahoXjoA@mail.gmail.com>
	<E4AB3DD44D22854B819908379DE4AD49390B309A@SETHNWS023.carmenta.se>
	<4F10BA36.2080902@gmail.com>
	<CAH0YoEPLFBsXxKW+5_6V=qH-uXCwwEsBagYpgPJQ819z9UjVpQ@mail.gmail.com>
	<4F133317.6070003@gmail.com>
Message-ID: <E4AB3DD44D22854B819908379DE4AD49390B4008@SETHNWS023.carmenta.se>

Joaquim,

I think Thomas's point wasn't that your H/h convention was wrong,
just that there are two conflicting conventions used in the literature.
(I have noted that the "Guide to coordinate systems in Great Britain",
 http://www.ordnancesurvey.co.uk/oswebsite/gps/docs/A_Guide_to_Coordinate_Systems_in_Great_Britain.pdf
 uses H for ellipsoid height and h for orthometric height.)

You also wrote:

> It happens that I just tested with our Portuguese geoid with following command
>
> cs2cs +proj=latlong +ellps=WGS84 +towgs84=0,0,0 +geoidgrids=GeodPT08.gtx
> +to +proj=latlong +ellps=WGS84 +towgs84=0,0,0
> -8 37 0
> 8dW 37dN 51.910
>
> which is fine and means that the left side altitude was interpreted as ellipsoidal height
> and the output is the geoid undulation at that point.

Well, that's one way to interpret the result (and a correct one). That is, the geoid
undulation is +51.910 m, so the geoid surface is 51.910 m above the ellipsoid
surface here.

However, I believe the intended interpretation is different: The presence of
+geoidgrids before +to means that the input height is an orthometric height,
while the absence of +geoidgrids after +to means that the output height is
height above ellipsoid.  This interpretation is more general, since the geoid
undulation is, in general, not output explicitly by cs2cs, although it can be
calculated as ellipsoid height minus orthometric height.

So as I understand it, your suggested +H/+h parameters are unnecessary,
since the presence of +geoidgrids means orthometric height, and its absence
means ellipsoid height.

Regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com<http://www.carmenta.com/>

________________________________
From: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On Behalf Of J. Luis
Sent: Sunday, January 15, 2012 9:12 PM
To: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] How grids work in PROJ4

On 15-01-2012 13:58, Thomas Knudsen wrote:
2012/1/14 Michal Seidl <michal.seidl at gmail.com<mailto:michal.seidl at gmail.com>>

[-- TEXT DELETED --]

So following Joaquim's suggestion of +H and +h options is quite risky. Out of context you can never be sure what is meant by H and h.

/Thomas


Ai, this is embarrassing for me. Off course I mistakenly swapped the H/h as it never crossed my mind going against the notation followed by the "Physical Geodesy" bibles.

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120116/02536884/attachment.html>

From Mikael.Rittri at carmenta.com  Wed Jan 18 06:22:43 2012
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Wed, 18 Jan 2012 14:22:43 +0000
Subject: [Proj] EPSG 7.9 Upgrade in Trunk
In-Reply-To: <4E84185D.3040301@pobox.com>
References: <4E84185D.3040301@pobox.com>
Message-ID: <E4AB3DD44D22854B819908379DE4AD49390B46D8@SETHNWS023.carmenta.se>

Not a prompt reply, but anyway: 

I noticed that for the British datum OSGB 1936, gcs.csv in the libgeotiff trunk ( http://trac.osgeo.org/geotiff/browser/trunk/libgeotiff/csv ) uses 
the 3-parameter datum shift 

        EPSG:1195, "OSGB 1936 to WGS 84(1)", accuracy 21 m. 

I would have expected the more accurate 7-parameter datum shift

        EPSG:1314, "OSGB 1936 to WGS 84(6), accuracy 2 m. 

This is a special case of the ticket 

        http://trac.osgeo.org/geotiff/ticket/33

and since the general case won't be fixed, I suggest that OSGB 1936
needs special treatment (in datum_shift_pref.csv).

> New "preferred datum shift selection" rules are also in place which
> will give preference to 7 parameter datum shifts over 3 parameter 
> datum shifts 

You mean that some 7 parameter datum shifts are listed as preferred
in datum_shift_pref.csv ?  Because in build_pcs.py, I couldn't see
that 7-parameter shifts are preferred over 3-parameter shifts in general (but maybe I missed it).

Best regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com

-----Original Message-----
From: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On Behalf Of Frank Warmerdam
Sent: Thursday, September 29, 2011 9:04 AM
To: PROJ.4 and general Projections Discussions; GeoTIFF; gdal-dev
Subject: [Proj] EPSG 7.9 Upgrade in Trunk

Folks,

I have upgraded libgeotiff, PROJ.4 and GDAL with EPSG definitions regenerated
from the EPSG 7.9 database.  New "preferred datum shift selection" rules are
also in place which will give preference to 7 parameter datum shifts over
3 parameter datum shifts are also in place causing a fair amount of churn
in the definitions.

The updates are in "trunk" for each of the projects.  I plan to produce
libgeotiff and PROJ.4 release candidates soon with the new definitions
so if you think you might have objections please investigate and speak
up promptly.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/warmerda
and watch the world go round - Rush    | Geospatial Software Developer

_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj


From strk at keybit.net  Mon Jan 23 08:44:40 2012
From: strk at keybit.net (Sandro Santilli)
Date: Mon, 23 Jan 2012 17:44:40 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
Message-ID: <20120123164440.GD16335@gnash>

Hello everyone, 
I'm trying to understand how to use the swisstopo grid shift 
CHENYX06a.gsb file and would like to ask if anyone of you used
it already.

Following instructions found on this message:
http://lists.maptools.org/pipermail/proj/2009-January/004297.html

I've prepared a couple of definitions pretending that the target
(CH1903+) was a WGS84 and defined the input (CH1903) as needing
the CHENYX06a.gsb gridshift:

 Source:
  +proj=longlat +ellps=WGS84 +nadgrids=CHENYX06a.gsb +no_defs

 Target:
  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs

But when trying to convert, proj4 reports that the gridshift file is only
valid within the following range of coordinates:

NTv2 CHENyx06 661x313: LL=(5.55,45.4666667) UR=(11.05,48.0666667)
pj_apply_gridshift(): failed to find a grid shift table for
                      location (759183.2731993dW,187561.6170195dN

This surprised me as the .asc version of the gridshift seems to 
contain a different range:

 S_LAT     163680.000000
 N_LAT     173040.000000
 E_LONG    -39780.000000
 W_LONG    -19980.000000

Which matches the CH1903 and CH1903+ coordinate systems, being supposedly
local.

 DATUM_F CH1903
 DATUM_T CH1903+

Is it possible that the .gsb file is different from the .asc file ?
Or where does proj4 get the LL/UR data from ?

Any help with using CHENYX06a.gsb with proj4 is appreciated,
Thanks in advance.

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From paul-grass at stjohnspoint.co.uk  Mon Jan 23 09:22:03 2012
From: paul-grass at stjohnspoint.co.uk (Paul Kelly)
Date: Mon, 23 Jan 2012 17:22:03 +0000 (GMT)
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <20120123164440.GD16335@gnash>
References: <20120123164440.GD16335@gnash>
Message-ID: <Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>

On Mon, 23 Jan 2012, Sandro Santilli wrote:

> Hello everyone,
> I'm trying to understand how to use the swisstopo grid shift
> CHENYX06a.gsb file and would like to ask if anyone of you used
> it already.
>
> Following instructions found on this message:
> http://lists.maptools.org/pipermail/proj/2009-January/004297.html

That was written by me, although it's not particularly clear - and neither 
was I particularly clear on it at the time, though I vaguely remember 
someone later reported back that the solution worked. I haven't tried it 
myself, so I can only offer some hints.

[...]
> But when trying to convert, proj4 reports that the gridshift file is only
> valid within the following range of coordinates:
>
> NTv2 CHENyx06 661x313: LL=(5.55,45.4666667) UR=(11.05,48.0666667)
> pj_apply_gridshift(): failed to find a grid shift table for
>                      location (759183.2731993dW,187561.6170195dN
>
> This surprised me as the .asc version of the gridshift seems to
> contain a different range:
>
> S_LAT     163680.000000
> N_LAT     173040.000000
> E_LONG    -39780.000000
> W_LONG    -19980.000000

No, this is exactly the same as the bounds reported by PROJ.4. Those 
values are in degree-seconds. You need to divide by 3600 to get them in 
degrees (and note also that the longitude values are positive west of the 
Greenwich meridian; you need to divide them by -3600).

> I've prepared a couple of definitions pretending that the target
> (CH1903+) was a WGS84 and defined the input (CH1903) as needing
> the CHENYX06a.gsb gridshift:
>
> Source:
>  +proj=longlat +ellps=WGS84 +nadgrids=CHENYX06a.gsb +no_defs
>
> Target:
>  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs

I suspect you may have gone a little too far in "pretending" that you're 
using WGS84! Are your co-ordinates really in latitude/longitude? The very 
large numbers shown in the error message suggest that you have projected 
co-ordinates; see below:

> pj_apply_gridshift(): failed to find a grid shift table for
>                      location (759183.2731993dW,187561.6170195dN
                                  ^^^^^^           ^^^^^^

I think you need to set up your co-ordinate system definition strings to 
specify the correct projection and ellipsoid that you are using.

Paul


From strk at keybit.net  Mon Jan 23 09:47:55 2012
From: strk at keybit.net (Sandro Santilli)
Date: Mon, 23 Jan 2012 18:47:55 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
Message-ID: <20120123174755.GG16335@gnash>

On Mon, Jan 23, 2012 at 05:22:03PM +0000, Paul Kelly wrote:

> No, this is exactly the same as the bounds reported by PROJ.4. Those 
> values are in degree-seconds. You need to divide by 3600 to get them in 
> degrees (and note also that the longitude values are positive west of the 
> Greenwich meridian; you need to divide them by -3600).

Ah, thanks !

> I suspect you may have gone a little too far in "pretending" that you're 
> using WGS84! Are your co-ordinates really in latitude/longitude? The very 
> large numbers shown in the error message suggest that you have projected 
> co-ordinates; see below:

Indeed I was feeding wrong input. Local instead of global.

> I think you need to set up your co-ordinate system definition strings to 
> specify the correct projection and ellipsoid that you are using.

The EPSG definition for the source and target projection are these:

 # CH1903
 <4149> +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs  <>
 # CH1903+
 <4150> +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs  <>

So, should I keep the +ellps=bessel in my "fake" ones, like this ?

 <CH1903>  +proj=longlat +ellps=bessel +nadgrids=CHENYX06a.gsb +no_defs
 <CH1903+> +proj=longlat +ellps=bessel +towgs84=0,0,0 +no_defs

It would surely help if I had an official set of points in CH1903 and CH1903+ to
test my conversions against... 

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From jeff at roqc.no  Mon Jan 23 18:14:23 2012
From: jeff at roqc.no (jeff)
Date: Mon, 23 Jan 2012 21:14:23 -0500
Subject: [Proj] Need a  Proj4 consultant
Message-ID: <1327371263.10357.11.camel@maine2>

Any Proj4 experts out there who'd like to do a few hours payed
consulting? Or if you know anyone.

Get in touch at jeff at roqc.no

Jeff



From Mikael.Rittri at carmenta.com  Tue Jan 24 04:32:40 2012
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Tue, 24 Jan 2012 12:32:40 +0000
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <20120123174755.GG16335@gnash>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
Message-ID: <E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>


Sandro Santilli wrote:

> It would surely help if I had an official set of points in CH1903
> and CH1903+ to test my conversions against...

You can find test points in Chapter 7 of 

"Formulas and constants for the calculation of the Swiss conformal
cylindrical projection and for the transformation between coordinate
systems", 

http://www.swisstopo.admin.ch/internet/swisstopo/en/home/topics/survey/sys/refsys/switzerland.parsysrelated1.37696.downloadList.97912.DownloadFile.tmp/swissprojectionen.pdf

There are five positions that are expressed in various Swiss systems.
Unfortunately, CH1303 LongLat is not one of them, but LV03 is included,
which I think is what EPSG calls "CH1903 / LV03" (EPSG:21781). So it is
possible to find out the CH1903 LongLat coordinates via Proj.4, like this

C:\Windows\system32>proj +init=epsg:21781 -I
602030.680 191775.030
7d27'58.413"E   46d52'42.269"N
617306.300 268507.300
7d40'10.545"E   47d34'6.387"N
776668.105 265372.681
9d47'8.443"E    47d31'0.107"N
497313.292 145625.438
6d6'10.014"E    46d27'19.25"N
722758.810 87649.670
9d1'20.596"E    45d55'49.755"N

Which you can compare with the corresponding CH1903+ LongLat from Chapter 7:

7 27 58.416328	46 52 42.269284 
7 40 10.574820	47 34  6.404965
9 47  8.465989	47 31  0.092644 
6  6  9.983811	46 27 19.272743 
9  1 20.606368	45 55 49.707052 

Hope this helps,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com

-----Original Message-----
From: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On Behalf Of Sandro Santilli
Sent: Monday, January 23, 2012 6:48 PM
To: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] Help with use of swisstopo NTv2 grid shift ?

[ see http://lists.maptools.org/pipermail/proj/2012-January/006070.html ]


From strk at keybit.net  Tue Jan 24 09:12:05 2012
From: strk at keybit.net (Sandro Santilli)
Date: Tue, 24 Jan 2012 18:12:05 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
Message-ID: <20120124171205.GX16335@gnash>

On Tue, Jan 24, 2012 at 12:32:40PM +0000, Mikael Rittri wrote:
> 
> Sandro Santilli wrote:
> 
> > It would surely help if I had an official set of points in CH1903
> > and CH1903+ to test my conversions against...
> 
> http://www.swisstopo.admin.ch/internet/swisstopo/en/home/topics/survey/sys/refsys/switzerland.parsysrelated1.37696.downloadList.97912.DownloadFile.tmp/swissprojectionen.pdf
> 
> There are five positions that are expressed in various Swiss systems.
> Unfortunately, CH1303 LongLat is not one of them, but LV03 is included,
> which I think is what EPSG calls "CH1903 / LV03" (EPSG:21781). So it is
> possible to find out the CH1903 LongLat coordinates via Proj.4, like this
> 
...
> 
> Which you can compare with the corresponding CH1903+ LongLat from Chapter 7:
> 
> 7 27 58.416328	46 52 42.269284 
> 7 40 10.574820	47 34  6.404965
> 9 47  8.465989	47 31  0.092644 
> 6  6  9.983811	46 27 19.272743 
> 9  1 20.606368	45 55 49.707052 
> 
> Hope this helps,

Thanks Mikael. It does partially help.

My early test with use of the gridshift give closer numbers
to the reference, but still a bit far.

These are distances from CH1903+ LongLat in Chapter 7 and:

  "proj": EPSG:21781 -> EPSG:4150 
  "trip": EPSG:21781 -> EPSG:4149 -> gridshift 

      name      |         proj         |         trip
----------------+----------------------+----------------------
 Zimmerwald     | 7.87246233515599e-07 | 7.60831787764113e-07
 Chrischona     | 9.71503452898624e-06 | 7.72176457507915e-07
 Pfaender       |  7.4382455747246e-06 | 7.18561592587409e-07
 La Givrine     | 1.05401600040938e-05 | 6.58608124095734e-07
 Monte Generoso | 1.36557256758873e-05 | 7.58098360996886e-07

Could EPSG:21781 -> EPSG:4149 have introduced that ~7.5e-07 units drift ?
Or am I doing it still wrong ...

The exact steps I took are as follow:

 (1) EPSG:21781 -> EPSG:4149 using standard EPSG entries:
     FROM (EPSG:21781): +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=6 +y_0=2 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs
     TO (EPSG:4149): +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs

 (2) gridshift using custom entries:
     FROM: +proj=longlat +ellps=WGS84 +nadgrids=CHENYX06a.gsb +no_defs
     TO (EPSG:4150 pretending to be EPSG:4326): +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs

Am I doing step (2) correctly ? It's basically pretending the input is
just a gridshift away from the target (which is really EPSG:4150 in disguise)
   

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From Mikael.Rittri at carmenta.com  Wed Jan 25 01:54:49 2012
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Wed, 25 Jan 2012 09:54:49 +0000
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <20120124171205.GX16335@gnash>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
Message-ID: <E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>

Hello Sandro, 

I don't see that you do anything wrong with the 'trip' calculation. 

You say you get a mismatch of about 7e-07, which I assume is degrees,
so that's about 7 or 8 cm.  

I have tried to reproduce your results, but my mismatches were ten times
smaller, or at most 8 mm. 

One reason for a mismatch is that Switzerland, like many countries, has
its own official algorithm for datum shifts; the Swiss one is called
FINELTRA. (The reason is probably a conspiracy to create work opportunities
for GIS programmers.) The NTv2 file that the Swiss have published is
intended only as an approximation. The mismatches compared to FINELTRA can
be up to 10 or 20 cm, apparently, but is less than 2 cm in most of the
country. I got this info from 

http://www.swisstopo.admin.ch/internet/swisstopo/en/home/topics/survey/lv03-lv95/chenyx06/distortion_grids.html

and there is more info in the PDF notes, but I am not good at German. 

Anyway, here is how I made my computations:

First, convert the five test points from CH1903 / LV03 to CH1903 LongLat:

>proj +init=epsg:21781 -f "%.9f" -I

602030.680 191775.030
7.466225970     46.878408135
617306.300 268507.300
7.669595854     47.568440713
776668.105 265372.681
9.785678730     47.516696408
497313.292 145625.438
6.102781793     46.455347324
722758.810 87649.670
9.022387820     45.930487539

Note that I used -f "%.9f" to get higher precision in the output. 

Second, transform from CH1903 LongLat to CH1903+ LongLat, using the NTv2
file in the same way you did, but again using -f "%.9f":

>cs2cs +proj=longlat +ellps=WGS84 +nadgrids=CHENYX06a.gsb +no_defs +to +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs -f "%.9f"

7.466225970     46.878408135
7.466226678     46.878408104 0.000000000
7.669595854     47.568440713
7.669604076     47.568445851 0.000000000
9.785678730     47.516696408
9.785684998     47.516692402 0.000000000
6.102781793     46.455347324
6.102773347     46.455353520 0.000000000
9.022387820     45.930487539
9.022390666     45.930474254 0.000000000

Third, compare these positions with the official (FINELTRA-calculated)
CH1903+ LongLat values from Chapter 7. I did this on Ed Williams's
calculator http://williams.best.vwh.net/gccalc.htm , and got mismatches
of

7.0 mm
4.3 mm
0.1 mm
5.5 mm
8.1 mm

I don't understand how you could get ten times larger mismatches.
Maybe you have some rounding going on somewhere. 

However, there is something strange in your +somerc definition, where you
have

+x_0=6 +y_0=2

This should be 

+x_0=600000 +y_0=200000

for CH1903 / LV03 (EPSG:21781), and 

+x_0=2600000 +y_0=1200000

for CH1903+ / LV95 (EPSG:2056). But perhaps you just made a cut-and-paste
error in your text (otherwise the errors would have been hundreds of
kilometers).

Regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com

-----Original Message-----
From: Sandro Santilli [mailto:sandro.santilli at gmail.com] On Behalf Of Sandro Santilli
Sent: Tuesday, January 24, 2012 6:12 PM
To: Mikael Rittri
Cc: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] Help with use of swisstopo NTv2 grid shift ?

On Tue, Jan 24, 2012 at 12:32:40PM +0000, Mikael Rittri wrote:
> 
> Sandro Santilli wrote:
> 
> > It would surely help if I had an official set of points in CH1903
> > and CH1903+ to test my conversions against...
> 
> http://www.swisstopo.admin.ch/internet/swisstopo/en/home/topics/survey/sys/refsys/switzerland.parsysrelated1.37696.downloadList.97912.DownloadFile.tmp/swissprojectionen.pdf
> 
> There are five positions that are expressed in various Swiss systems.
> Unfortunately, CH1303 LongLat is not one of them, but LV03 is included,
> which I think is what EPSG calls "CH1903 / LV03" (EPSG:21781). So it is
> possible to find out the CH1903 LongLat coordinates via Proj.4, like this
> 
...
> 
> Which you can compare with the corresponding CH1903+ LongLat from Chapter 7:
> 
> 7 27 58.416328	46 52 42.269284 
> 7 40 10.574820	47 34  6.404965
> 9 47  8.465989	47 31  0.092644 
> 6  6  9.983811	46 27 19.272743 
> 9  1 20.606368	45 55 49.707052 
> 
> Hope this helps,

Thanks Mikael. It does partially help.

My early test with use of the gridshift give closer numbers
to the reference, but still a bit far.

These are distances from CH1903+ LongLat in Chapter 7 and:

  "proj": EPSG:21781 -> EPSG:4150 
  "trip": EPSG:21781 -> EPSG:4149 -> gridshift 

      name      |         proj         |         trip
----------------+----------------------+----------------------
 Zimmerwald     | 7.87246233515599e-07 | 7.60831787764113e-07
 Chrischona     | 9.71503452898624e-06 | 7.72176457507915e-07
 Pfaender       |  7.4382455747246e-06 | 7.18561592587409e-07
 La Givrine     | 1.05401600040938e-05 | 6.58608124095734e-07
 Monte Generoso | 1.36557256758873e-05 | 7.58098360996886e-07

Could EPSG:21781 -> EPSG:4149 have introduced that ~7.5e-07 units drift ?
Or am I doing it still wrong ...

The exact steps I took are as follow:

 (1) EPSG:21781 -> EPSG:4149 using standard EPSG entries:
     FROM (EPSG:21781): +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=6 +y_0=2 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs
     TO (EPSG:4149): +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs

 (2) gridshift using custom entries:
     FROM: +proj=longlat +ellps=WGS84 +nadgrids=CHENYX06a.gsb +no_defs
     TO (EPSG:4150 pretending to be EPSG:4326): +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs

Am I doing step (2) correctly ? It's basically pretending the input is
just a gridshift away from the target (which is really EPSG:4150 in disguise)
   

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From strk at keybit.net  Wed Jan 25 02:24:06 2012
From: strk at keybit.net (Sandro Santilli)
Date: Wed, 25 Jan 2012 11:24:06 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
Message-ID: <20120125102406.GA3341@gnash>

On Wed, Jan 25, 2012 at 09:54:49AM +0000, Mikael Rittri wrote:

> I don't see that you do anything wrong with the 'trip' calculation. 

Good to know I'm on the right track !

> You say you get a mismatch of about 7e-07, which I assume is degrees,
> so that's about 7 or 8 cm.  

Right. That's what I had.

> I have tried to reproduce your results, but my mismatches were ten times
> smaller, or at most 8 mm. 
...
> Anyway, here is how I made my computations:
> 
> First, convert the five test points from CH1903 / LV03 to CH1903 LongLat:
> 
> >proj +init=epsg:21781 -f "%.9f" -I
> 
> 602030.680 191775.030
> 7.466225970     46.878408135
...

Sorry about my ignorance: where does the commandline above say you're
converting to CH1903 (epsg:4149) rather than WGS84 ?

It could be I found my drift ? See this:

cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
602030.680 191775.030
7.466225442     46.878408624 0.012045878

The destination projection above is epsg:4149

So do you confirm your multi-step would be as follows ?

 (1) convert CH1903/LV03 to WGS84 using epsg:21781
 (2) apply NTv2 on the result of step 1 (get CH1903+)
 (3) convert CH1903+ back to CH1903+/LV95 using epsg:2056

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From Mikael.Rittri at carmenta.com  Wed Jan 25 03:14:18 2012
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Wed, 25 Jan 2012 11:14:18 +0000
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <20120125102406.GA3341@gnash>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
	<20120125102406.GA3341@gnash>
Message-ID: <E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>

> > First, convert the five test points from CH1903 / LV03
> > to CH1903 LongLat:
> > 
> > >proj +init=epsg:21781 -f "%.9f" -I
> > 
> > 602030.680 191775.030
> > 7.466225970     46.878408135
...
>
> Sorry about my ignorance: where does the command line above say you're
> converting to CH1903 (epsg:4149) rather than WGS84 ?

Right at the start, where it says proj instead of cs2cs.
The original proj utility cannot do any datum shift, only cs2cs can do that.
So when the proj command uses +init=epsg:21781, it can convert from longlat
to projected coordinates (the default behaviour), or vice versa (the -I for
inverse projection). 

> It could be I found my drift ? See this:
> 
> cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
> 602030.680 191775.030
> 7.466225442     46.878408624 0.012045878

Strange, and I cannot reproduce it; I get identical results from proj and cs2cs:

>cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
602030.680 191775.030
7.466225970     46.878408135 0.000000000

Or simpler:

>cs2cs +init=epsg:21781 +to +init=epsg:4149 -f "%.9f"
602030.680 191775.030
7.466225970     46.878408135 0.000000000

The 1.2 cm height difference you get, may be caused by your having different
+towgs84 parameters on your left and right hand side, but I don't understand
how that can be. (I am using OSGeo4W with Proj version 4.7.1, I think.)

> So do you confirm your multi-step would be as follows ?
> 
> (1) convert CH1903/LV03 to WGS84 using epsg:21781
> (2) apply NTv2 on the result of step 1 (get CH1903+)
> (3) convert CH1903+ back to CH1903+/LV95 using epsg:2056

Yes, more or less:

Step (1) is really conversion from CH1903/LV03 to CH1903 longlat.
(I think that's what you mean).

Then in step (2), we pretend that these longlat values are on the WGS84
ellipsoid, and we pretend that we use the NTv2 grid to get WGS84 longlat,
but we really get CH1903+ longlat. (That's how you already do it.)

And step (3) should be possible with the proj command or cs2cs.

Maybe it would be possible to combine step (1) and (2) to a single cs2cs
command, by replacing +proj=longlat by +proj=somerc etc. in the source CRS
that uses the NTv2 grid. But I am not sure what ellipsoid to specify in that
case. The +proj=somerc would need the Bessel ellipsoid to work properly, and
that would perhaps confuse the grid conversion. 

Regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com

-----Original Message-----
From: Sandro Santilli [mailto:sandro.santilli at gmail.com] On Behalf Of Sandro Santilli
Sent: Wednesday, January 25, 2012 11:24 AM
To: Mikael Rittri
Cc: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] Help with use of swisstopo NTv2 grid shift ?

On Wed, Jan 25, 2012 at 09:54:49AM +0000, Mikael Rittri wrote:

> I don't see that you do anything wrong with the 'trip' calculation. 

Good to know I'm on the right track !

> You say you get a mismatch of about 7e-07, which I assume is degrees,
> so that's about 7 or 8 cm.  

Right. That's what I had.

> I have tried to reproduce your results, but my mismatches were ten times
> smaller, or at most 8 mm. 
...
> Anyway, here is how I made my computations:
> 
> First, convert the five test points from CH1903 / LV03 to CH1903 LongLat:
> 
> >proj +init=epsg:21781 -f "%.9f" -I
> 
> 602030.680 191775.030
> 7.466225970     46.878408135
...

Sorry about my ignorance: where does the commandline above say you're
converting to CH1903 (epsg:4149) rather than WGS84 ?

It could be I found my drift ? See this:

cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
602030.680 191775.030
7.466225442     46.878408624 0.012045878

The destination projection above is epsg:4149

So do you confirm your multi-step would be as follows ?

 (1) convert CH1903/LV03 to WGS84 using epsg:21781
 (2) apply NTv2 on the result of step 1 (get CH1903+)
 (3) convert CH1903+ back to CH1903+/LV95 using epsg:2056

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From strk at keybit.net  Wed Jan 25 07:45:13 2012
From: strk at keybit.net (Sandro Santilli)
Date: Wed, 25 Jan 2012 16:45:13 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
	<20120125102406.GA3341@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>
Message-ID: <20120125154513.GC9883@gnash>

On Wed, Jan 25, 2012 at 11:14:18AM +0000, Mikael Rittri wrote:
> > > First, convert the five test points from CH1903 / LV03
> > > to CH1903 LongLat:
> > > 
> > > >proj +init=epsg:21781 -f "%.9f" -I
> > > 
> > > 602030.680 191775.030
> > > 7.466225970     46.878408135
> ...
> >
> > Sorry about my ignorance: where does the command line above say you're
> > converting to CH1903 (epsg:4149) rather than WGS84 ?
> 
> Right at the start, where it says proj instead of cs2cs.
> The original proj utility cannot do any datum shift, only cs2cs can do that.

Got it, thanks.

> > cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
> > 602030.680 191775.030
> > 7.466225442     46.878408624 0.012045878
> 
> Strange, and I cannot reproduce it; I get identical results from proj and cs2cs:
> 
> >cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
> 602030.680 191775.030
> 7.466225970     46.878408135 0.000000000
> 
> Or simpler:
> 
> >cs2cs +init=epsg:21781 +to +init=epsg:4149 -f "%.9f"
> 602030.680 191775.030
> 7.466225970     46.878408135 0.000000000

I'm having your results with +init but not with the full-codes.

  ~$ cs2cs +init=epsg:21781 +to +init=epsg:4149 -f "%.9f"
  602030.680 191775.030
  7.466225970     46.878408135 0.000000000
  
  ~$ cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
  602030.680 191775.030
  7.466225442     46.878408624 0.012045878

Now, here's why !

  ~$ egrep '<(4149|21781)>' /usr/share/proj/epsg
  <4149> +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs  <>
  <21781> +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +un

I'm with 4.7.1 as well. On a 64bit.

  ~$ cs2cs --version
  Rel. 4.7.1, 23 September 2009

So, how could you get the same results ?
Did you manually update your <4149> defn with a more recent string ?
I see proj4 from SVN trunk has these other ones:

  ~$ egrep '<(4149|21781)>' /usr/src/proj/proj/proj/nad/epsg
  <4149> +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs  <>
  <21781> +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +units=m

The +towgs84 values look like swapped !

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From strk at keybit.net  Wed Jan 25 08:03:17 2012
From: strk at keybit.net (Sandro Santilli)
Date: Wed, 25 Jan 2012 17:03:17 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <20120125154513.GC9883@gnash>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
	<20120125102406.GA3341@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>
	<20120125154513.GC9883@gnash>
Message-ID: <20120125160317.GE9883@gnash>

On Wed, Jan 25, 2012 at 04:45:13PM +0100, Sandro Santilli wrote:

> The +towgs84 values look like swapped !

Alright, so with the NEW definitions for the known projections a full
roundtrip from LV03 to LV95 using the shift grid gives these distances
in meters:

        name      |     st_distance
  ----------------+---------------------
   Zimmerwald     | 0.00692816117873887
   Chrischona     | 0.00428319953182237
   Pfaender       | 0.00016855795287734
   La Givrine     | 0.00555304264270726
   Monte Generoso | 0.00804385131339353
  (5 rows)

For the record, here's the PostGIS query used to perform the round-trip:

  SELECT name, st_distance(lv95, 
   postgis_transform_geometry(      -- CH1903+      to   CH1903+/LV95
     postgis_transform_geometry(    -- CH1903       to   CH1903+ 
       postgis_transform_geometry(  -- CH1903/LV03  to   CH1903
          lv03,
          '+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +units=m +no_defs  <>', -- 21781 (good)
          '+proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs  <>', -- 4149 (good)
          4149
       ),
       '+proj=longlat +ellps=WGS84 +nadgrids=CHENYX06a.gsb +no_defs', -- grid shift
       '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs', -- ch1903+ pretending to be WGS84
       4150),
     '+proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs  <>', -- 4150 (good)
     '+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs  <>', -- 2056 good
     2056))
  FROM euref;

The "lv95" and "lv03" field in the "euref" table contain official numbers
found in in the PDF downloaded from the swisstopo website.

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From strk at keybit.net  Wed Jan 25 09:17:22 2012
From: strk at keybit.net (Sandro Santilli)
Date: Wed, 25 Jan 2012 18:17:22 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
	<20120125102406.GA3341@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>
Message-ID: <20120125171722.GB12646@gnash>

On Wed, Jan 25, 2012 at 11:14:18AM +0000, Mikael Rittri wrote:

> Maybe it would be possible to combine step (1) and (2) to a single cs2cs
> command, by replacing +proj=longlat by +proj=somerc etc. in the source CRS
> that uses the NTv2 grid. But I am not sure what ellipsoid to specify in that
> case. The +proj=somerc would need the Bessel ellipsoid to work properly, and
> that would perhaps confuse the grid conversion. 

The 2-steps version indeed also works:

  -- 2 steps
  SELECT name, ST_Distance( lv95,
   postgis_transform_geometry(
     postgis_transform_geometry(
       lv03,
       '+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +units=m +nadgrids=CHENYX06a.gsb +no_defs', -- CH1903 (epsg:21781) modified adding grid shift
       '+init=epsg:4326', -- CH1903+ pretending to be wgs84
       4150
     ),
     '+init=epsg:4150', -- CH1903+ proper
     '+init=epsg:2056', -- CH1903+/LV95 proper
     2056)
  ) from euref;

        name      |     st_distance
  ----------------+---------------------
   Zimmerwald     | 0.00692816117873887
   Chrischona     | 0.00428319953182237
   Pfaender       | 0.00016855795287734
   La Givrine     | 0.00555304264270726
   Monte Generoso | 0.00804385131339353
  (5 rows)

Now next step would be making such transformation available
with a single proj call.

Would it be possible to create an init file containing all "pretending"
referenced set of working transforms ?definitions so to be able to use
<CH1903+> as the pivot and <CH1903>, <CH1903/LV03>, <CH1903+/LV96> and maybe
<WGS84> to have a self-referenced set of working transforms ?

Is that what IGNF file is all about ? 

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From Mikael.Rittri at carmenta.com  Thu Jan 26 00:37:27 2012
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Thu, 26 Jan 2012 08:37:27 +0000
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <20120125154513.GC9883@gnash>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
	<20120125102406.GA3341@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>
	<20120125154513.GC9883@gnash>
Message-ID: <E4AB3DD44D22854B819908379DE4AD49390B6611@SETHNWS023.carmenta.se>

> I'm having your results with +init but not with the full-codes.
> [...]
> 
> Now, here's why !
> [...]

I'm glad you found it. It is clear that we have been running different versions of Proj.4.

> So, how could you get the same results ?
> Did you manually update your <4149> defn with a more recent string ?

I did get 

    C:\Windows\system32>cs2cs --version
    Rel. 4.7.1, 23 September 2009

but when I look at my C:\OSGeo4W\share\proj\epsg, I have the
decimeter-resolution datum shift for CH1903:

    +towgs84=674.4,15.1,405.3,0,0,0,0

And this was introduced in Changeset 1824, from 28 Feb 2010, which is
after the Proj 4.7.1 release, so it seems I have been running a trunk
version without knowing it.  I downloaded OSGeo4W in November 2011,
without doing anything special to get the trunk version of Proj.4, 
but maybe that's what you get by default. 

Before that Changeset, the datum shift for CH1903 had millimeter
resolution, (identical to the shift for CH1903+).

By the way, the EPSG Remarks for the decimeter-resolution shift are

    "These parameters are derived from CH1903+ to ETRS89 (code 1647) and are
     used as from CH1903 as an approximation which is within the accuracy of
     the distortions in the CH1903 network."

As I understand it, if you want to use a 3- or 7-parameter datum shift for
CH1903, you can use the same as the one for CH1903+, since the datums are
approximately in the same place. But the local distortions of CH1903 mean
that the accuracy is only about 1.5 m, so someone must have figured that 
the millimeter resolution made no sense, and rounded to decimeters.

> So, how could you get the same results ?

Well, when you use cs2cs to convert between CH1903 / LV03 and
CH1903 / longlat, you are not really doing any datum shift, since it
is the same datum on both sides. So, the only important thing is to 
have the same datum shift on both sides; then they will cancel each
other and have no net effect. Even +towgs84=999,999,999 should work, if
you use it on both sides. I think you can omit the +towgs84 parameters
on both sides, too, in this case, but I dislike doing that: I can
never remember the semantics of doing so. 
   
So, when you wrote 

> cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"

the +init on the left side gave you the millimeter-resolution datum shift,
since you are running Proj 4.7.1, but on the right side you have explicitly
used the decimeter-resolution datum shift. Of course, that gives a
difference of 2.6 cm in X, 4.4 cm in Y and 4.6 cm in Z; I am not sure
what that would be horizontally, but I think it explains your mismatches
up to 8 cm.
     Well, that's what you had already figured out. I guess the lesson is
that it can be risky to use +init for one CRS definition and an explicit
definition for the other CRS.

> Now next step would be making such transformation available with a single > proj call.
> 
> Would it be possible to create an init file containing all "pretending"
> referenced set of working transforms ?definitions so to be able to
> use <CH1903+> as the pivot and <CH1903>, <CH1903/LV03>, <CH1903+/LV96>
> and maybe <WGS84> to have a self-referenced set of working transforms ?
> 
> Is that what IGNF file is all about ?

I don't think I understand these questions. 

Regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com

-----Original Message-----
From: Sandro Santilli [mailto:sandro.santilli at gmail.com] On Behalf Of Sandro Santilli
Sent: Wednesday, January 25, 2012 4:45 PM
To: Mikael Rittri
Cc: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] Help with use of swisstopo NTv2 grid shift ?

On Wed, Jan 25, 2012 at 11:14:18AM +0000, Mikael Rittri wrote:
> > > First, convert the five test points from CH1903 / LV03
> > > to CH1903 LongLat:
> > > 
> > > >proj +init=epsg:21781 -f "%.9f" -I
> > > 
> > > 602030.680 191775.030
> > > 7.466225970     46.878408135
> ...
> >
> > Sorry about my ignorance: where does the command line above say you're
> > converting to CH1903 (epsg:4149) rather than WGS84 ?
> 
> Right at the start, where it says proj instead of cs2cs.
> The original proj utility cannot do any datum shift, only cs2cs can do that.

Got it, thanks.

> > cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
> > 602030.680 191775.030
> > 7.466225442     46.878408624 0.012045878
> 
> Strange, and I cannot reproduce it; I get identical results from proj and cs2cs:
> 
> >cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
> 602030.680 191775.030
> 7.466225970     46.878408135 0.000000000
> 
> Or simpler:
> 
> >cs2cs +init=epsg:21781 +to +init=epsg:4149 -f "%.9f"
> 602030.680 191775.030
> 7.466225970     46.878408135 0.000000000

I'm having your results with +init but not with the full-codes.

  ~$ cs2cs +init=epsg:21781 +to +init=epsg:4149 -f "%.9f"
  602030.680 191775.030
  7.466225970     46.878408135 0.000000000
  
  ~$ cs2cs +init=epsg:21781 +to +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs -f "%.9f"
  602030.680 191775.030
  7.466225442     46.878408624 0.012045878

Now, here's why !

  ~$ egrep '<(4149|21781)>' /usr/share/proj/epsg
  <4149> +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs  <>
  <21781> +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +un

I'm with 4.7.1 as well. On a 64bit.

  ~$ cs2cs --version
  Rel. 4.7.1, 23 September 2009

So, how could you get the same results ?
Did you manually update your <4149> defn with a more recent string ?
I see proj4 from SVN trunk has these other ones:

  ~$ egrep '<(4149|21781)>' /usr/src/proj/proj/proj/nad/epsg
  <4149> +proj=longlat +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +no_defs  <>
  <21781> +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +units=m

The +towgs84 values look like swapped !

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html


From mfinn at usgs.gov  Thu Jan 26 13:53:07 2012
From: mfinn at usgs.gov (Michael P Finn)
Date: Thu, 26 Jan 2012 14:53:07 -0700
Subject: [Proj] FYI -- code
Message-ID: <OFAE2DF41B.FD4527A5-ON87257991.0077DB56-87257991.00783884@usgs.gov>

http://code.nasa.gov/ 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120126/36eb60e4/attachment.html>

From strk at keybit.net  Mon Jan 30 05:09:48 2012
From: strk at keybit.net (Sandro Santilli)
Date: Mon, 30 Jan 2012 14:09:48 +0100
Subject: [Proj] Help with use of swisstopo NTv2 grid shift ?
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49390B6611@SETHNWS023.carmenta.se>
References: <20120123164440.GD16335@gnash>
	<Pine.LNX.4.62.1201231710390.4643@vortex.ukshells.co.uk>
	<20120123174755.GG16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B5F57@SETHNWS023.carmenta.se>
	<20120124171205.GX16335@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6223@SETHNWS023.carmenta.se>
	<20120125102406.GA3341@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6273@SETHNWS023.carmenta.se>
	<20120125154513.GC9883@gnash>
	<E4AB3DD44D22854B819908379DE4AD49390B6611@SETHNWS023.carmenta.se>
Message-ID: <20120130130948.GB2188@gnash>

On Thu, Jan 26, 2012 at 08:37:27AM +0000, Mikael Rittri wrote:
> On ???, Sandro Santilli wrote:
> >
> > Now next step would be making such transformation available with a single > proj call.
> > 
> > Would it be possible to create an init file containing all "pretending"
> > referenced set of working transforms ?definitions so to be able to
> > use <CH1903+> as the pivot and <CH1903>, <CH1903/LV03>, <CH1903+/LV96>
> > and maybe <WGS84> to have a self-referenced set of working transforms ?
> > 
> > Is that what IGNF file is all about ?
> 
> I don't think I understand these questions. 

I'd like to understand the existing options to provide the CH1903+ to CH1903
as an easy call to proj4 lib, so that any proj4 client would be able to do
that transformation w/out fiddling too much (with chains of transforms).

I had the impression that the IGNF init file had the same aim (for Franch
projections), but I'm probably wrong.

--strk; 

  ,------o-. 
  |   __/  |    Thank you for PostGIS-2.0 Topology !
  |  / 2.0 |    http://www.pledgebank.com/postgistopology
  `-o------'



From martin.moore at avbrief.com  Mon Jan 30 07:22:04 2012
From: martin.moore at avbrief.com (Martin Moore)
Date: Mon, 30 Jan 2012 15:22:04 -0000
Subject: [Proj] Undefined subroutine &Proj::proj_init called
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAAh3kF/Q2FdHpwnCCnp+mEIBAAAAAA==@avbrief.com>



Hi, I've got a pretty basic problem on a new Debian Squeeze server that has
been narrowed down to:

 

strace perl -e 'use PDL::GIS::Proj; my $pj = Proj::proj_init();'  // also
used Proj::proj_init_plus() with the same results

 

The only Proj.pm on the system is /usr/lib/perl5/PDL/GIS/Proj.pm and it
doesn't appear to have a proj_init<_plus> function.

 

Stacktrace is at http://pastebin.com/kPkwt6nj

 

Any ideas how to get this running appreciated.

 

 

As an aside, I needed to sudo ln -s /usr/lib/perl5/PDL/Core.pm
/usr/lib/perl5/PDL::Core to get this recognized.  

 

 

Thanks,

 

Martin.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120130/b71ab1cb/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 92 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120130/b71ab1cb/attachment.gif>

From martin.moore at avbrief.com  Mon Jan 30 11:01:54 2012
From: martin.moore at avbrief.com (Martin Moore)
Date: Mon, 30 Jan 2012 19:01:54 -0000
Subject: [Proj] Undefined subroutine &Proj::proj_init called
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAIhkLeaGNlVLph2+x0d783oBAAAAAA==@avbrief.com>


Already done and is the latest.


-----Original Message-----
From: Eric Miller [mailto:emiller at dfg.ca.gov] 
Sent: 30 January 2012 18:02
To: martin.moore at avbrief.com
Subject: Re: [Proj] Undefined subroutine &Proj::proj_init called

I don't think that Perl module supplies PROJ.4. Most likely it just wraps
the library.  Try:

$> apt-get install proj

-- 
Eric G. Miller
Staff Programmer
Department of Fish and Game
>>> Martin Moore <martin.moore at avbrief.com> 01/30/12 7:39 AM >>>


Hi, I've got a pretty basic problem on a new Debian Squeeze server that has
been narrowed down to:

 

strace perl -e 'use PDL::GIS::Proj; my $pj = Proj::proj_init();'  // also
used Proj::proj_init_plus() with the same results

 

The only Proj.pm on the system is /usr/lib/perl5/PDL/GIS/Proj.pm and it
doesn't appear to have a proj_init<_plus> function.

 

Stacktrace is at http://pastebin.com/kPkwt6nj

 

Any ideas how to get this running appreciated.

 

 

As an aside, I needed to sudo ln -s /usr/lib/perl5/PDL/Core.pm
/usr/lib/perl5/PDL::Core to get this recognized.  

 

 

Thanks,

 

Martin.



-----
No virus found in this message.
Checked by AVG - www.avg.com
Version: 2012.0.1901 / Virus Database: 2109/4776 - Release Date: 01/30/12



From martin.moore at avbrief.com  Mon Jan 30 11:03:37 2012
From: martin.moore at avbrief.com (Martin Moore)
Date: Mon, 30 Jan 2012 19:03:37 -0000
Subject: [Proj] Undefined subroutine &Proj::proj_init called
In-Reply-To: <CA+YzLBeQBwEEePuGv0xRkZrMRGbwbT6U2GgZhip5ucMmM5n1cA@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAAh3kF/Q2FdHpwnCCnp+mEIBAAAAAA==@avbrief.com>
	<CA+YzLBeQBwEEePuGv0xRkZrMRGbwbT6U2GgZhip5ucMmM5n1cA@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAABlXsxeRQdRAlKhyMosdpbcBAAAAAA==@avbrief.com>

OK, thanks.

 

Not being into perl very much, which binding do you mean?

 

Martin.

 

From: fwarmerdam at gmail.com [mailto:fwarmerdam at gmail.com] On Behalf Of Frank
Warmerdam
Sent: 30 January 2012 18:07
To: martin.moore at avbrief.com
Subject: Re: [Proj] Undefined subroutine &Proj::proj_init called

 

Martin,

For what it's worth, I don't believe the perl bindings for Proj
you are using are part of the core distribution.  So you might
have better luck directly contacting their author.  

Best regards,



On Mon, Jan 30, 2012 at 7:22 AM, Martin Moore <martin.moore at avbrief.com>
wrote:



Hi, I've got a pretty basic problem on a new Debian Squeeze server that has
been narrowed down to:

 

strace perl -e 'use PDL::GIS::Proj; my $pj = Proj::proj_init();'  // also
used Proj::proj_init_plus() with the same results

 

The only Proj.pm on the system is /usr/lib/perl5/PDL/GIS/Proj.pm and it
doesn't appear to have a proj_init<_plus> function.

 

Stacktrace is at http://pastebin.com/kPkwt6nj

 

Any ideas how to get this running appreciated.

 

 

As an aside, I needed to sudo ln -s /usr/lib/perl5/PDL/Core.pm
/usr/lib/perl5/PDL::Core to get this recognized.  

 

 

Thanks,

 

Martin.


_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj




-- 
---------------------------------------+------------------------------------
--
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
<http://pobox.com/%7Ewarmerdam> 
and watch the world go round - Rush    | Geospatial Software Developer

  _____  

No virus found in this message.
Checked by AVG - www.avg.com
Version: 2012.0.1901 / Virus Database: 2109/4776 - Release Date: 01/30/12

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120130/c6a7959e/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 92 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120130/c6a7959e/attachment.gif>

From ari.jolma at gmail.com  Mon Jan 30 23:18:35 2012
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 31 Jan 2012 09:18:35 +0200
Subject: [Proj] Undefined subroutine &Proj::proj_init called
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAABlXsxeRQdRAlKhyMosdpbcBAAAAAA==@avbrief.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAAh3kF/Q2FdHpwnCCnp+mEIBAAAAAA==@avbrief.com>
	<CA+YzLBeQBwEEePuGv0xRkZrMRGbwbT6U2GgZhip5ucMmM5n1cA@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAABlXsxeRQdRAlKhyMosdpbcBAAAAAA==@avbrief.com>
Message-ID: <4F2795CB.4040905@gmail.com>

cc'ing geo-perl list. Followups there, please.

Seems to be the bindings in PDL::GIS::Proj. There is also another Proj 
module Geo::Proj4. Anybody know the PDL::GIS::Proj author?

Martin, how do you know the code is supposed to work? proj_init sounds 
like a function that might be called automatically.

Regards,

Ari

On 01/30/2012 09:03 PM, Martin Moore wrote:
>
> OK, thanks.
>
> Not being into perl very much, which binding do you mean?
>
> Martin.
>
> *From:*fwarmerdam at gmail.com [mailto:fwarmerdam at gmail.com] *On Behalf 
> Of *Frank Warmerdam
> *Sent:* 30 January 2012 18:07
> *To:* martin.moore at avbrief.com
> *Subject:* Re: [Proj] Undefined subroutine &Proj::proj_init called
>
> Martin,
>
> For what it's worth, I don't believe the perl bindings for Proj
> you are using are part of the core distribution.  So you might
> have better luck directly contacting their author.
>
> Best regards,
>
> On Mon, Jan 30, 2012 at 7:22 AM, Martin Moore 
> <martin.moore at avbrief.com <mailto:martin.moore at avbrief.com>> wrote:
>
> Hi, I've got a pretty basic problem on a new Debian Squeeze server 
> that has been narrowed down to:
>
> strace perl -e 'use PDL::GIS::Proj; my $pj = Proj::proj_init();'  // 
> also used Proj::proj_init_plus() with the same results
>
> The only Proj.pm on the system is /usr/lib/perl5/PDL/GIS/Proj.pm and 
> it doesn't appear to have a proj_init<_plus> function.
>
> Stacktrace is at http://pastebin.com/kPkwt6nj
>
> Any ideas how to get this running appreciated.
>
> As an aside, I needed to sudo ln -s /usr/lib/perl5/PDL/Core.pm 
> /usr/lib/perl5/PDL::Core to get this recognized.
>
> Thanks,
>
> Martin.
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org <mailto:Proj at lists.maptools.org>
> http://lists.maptools.org/mailman/listinfo/proj
>
>
>
>
> -- 
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up   | Frank Warmerdam, 
> warmerdam at pobox.com <mailto:warmerdam at pobox.com>
> light and sound - activate the windows | http://pobox.com/~warmerdam 
> <http://pobox.com/%7Ewarmerdam>
> and watch the world go round - Rush    | Geospatial Software Developer
>
> ------------------------------------------------------------------------
>
> No virus found in this message.
> Checked by AVG - www.avg.com <http://www.avg.com>
> Version: 2012.0.1901 / Virus Database: 2109/4776 - Release Date: 01/30/12
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120131/06b3d97a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 92 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120131/06b3d97a/attachment.gif>

From martin.moore at avbrief.com  Tue Jan 31 02:44:28 2012
From: martin.moore at avbrief.com (Martin Moore)
Date: Tue, 31 Jan 2012 10:44:28 -0000
Subject: [Proj] Undefined subroutine &Proj::proj_init called
In-Reply-To: <4F2795CB.4040905@gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAAh3kF/Q2FdHpwnCCnp+mEIBAAAAAA==@avbrief.com>	<CA+YzLBeQBwEEePuGv0xRkZrMRGbwbT6U2GgZhip5ucMmM5n1cA@mail.gmail.com>	<!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAABlXsxeRQdRAlKhyMosdpbcBAAAAAA==@avbrief.com>
	<4F2795CB.4040905@gmail.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAOLbYtW4nVlHtmFkaePp9lsBAAAAAA==@avbrief.com>

Thanks Ari - the code runs fine on Etch systems.

 

I did however check strace perl -e 'use PDL::GIS::Proj; my $pj =
Proj::proj_init_plus();' 2>&1 | tail -n 20

 

On one of the etch systems and it also fails in the same way. So I guess the
main script is calling something else!

 

Martin.

 

From: proj-bounces at lists.maptools.org
[mailto:proj-bounces at lists.maptools.org] On Behalf Of Ari Jolma
Sent: 31 January 2012 07:19
To: proj at lists.maptools.org
Cc: Geo-perl at list.hut.fi
Subject: Re: [Proj] Undefined subroutine &Proj::proj_init called

 

cc'ing geo-perl list. Followups there, please.

Seems to be the bindings in PDL::GIS::Proj. There is also another Proj
module Geo::Proj4. Anybody know the PDL::GIS::Proj author?

Martin, how do you know the code is supposed to work? proj_init sounds like
a function that might be called automatically.

Regards,

Ari

On 01/30/2012 09:03 PM, Martin Moore wrote: 

OK, thanks.

 

Not being into perl very much, which binding do you mean?

 

Martin.

 

From: fwarmerdam at gmail.com [mailto:fwarmerdam at gmail.com] On Behalf Of Frank
Warmerdam
Sent: 30 January 2012 18:07
To: martin.moore at avbrief.com
Subject: Re: [Proj] Undefined subroutine &Proj::proj_init called

 

Martin,

For what it's worth, I don't believe the perl bindings for Proj
you are using are part of the core distribution.  So you might
have better luck directly contacting their author.  

Best regards,




On Mon, Jan 30, 2012 at 7:22 AM, Martin Moore <martin.moore at avbrief.com>
wrote:



Hi, I've got a pretty basic problem on a new Debian Squeeze server that has
been narrowed down to:

 

strace perl -e 'use PDL::GIS::Proj; my $pj = Proj::proj_init();'  // also
used Proj::proj_init_plus() with the same results

 

The only Proj.pm on the system is /usr/lib/perl5/PDL/GIS/Proj.pm and it
doesn't appear to have a proj_init<_plus> function.

 

Stacktrace is at http://pastebin.com/kPkwt6nj

 

Any ideas how to get this running appreciated.

 

 

As an aside, I needed to sudo ln -s /usr/lib/perl5/PDL/Core.pm
/usr/lib/perl5/PDL::Core to get this recognized.  

 

 

Thanks,

 

Martin.


_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj




-- 
---------------------------------------+------------------------------------
--
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
<http://pobox.com/%7Ewarmerdam> 
and watch the world go round - Rush    | Geospatial Software Developer

  _____  

No virus found in this message.
Checked by AVG - www.avg.com
Version: 2012.0.1901 / Virus Database: 2109/4776 - Release Date: 01/30/12






_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj

 

  _____  

No virus found in this message.
Checked by AVG - www.avg.com
Version: 2012.0.1901 / Virus Database: 2109/4776 - Release Date: 01/30/12

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120131/3617fe8e/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 92 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120131/3617fe8e/attachment.gif>

From strk at keybit.net  Tue Jan 31 08:33:46 2012
From: strk at keybit.net (Sandro Santilli)
Date: Tue, 31 Jan 2012 17:33:46 +0100
Subject: [Proj] Further help with the swisstopo NTv2 grid shift ?
Message-ID: <20120131163346.GJ15906@gnash>

Now that I understood how to use the NTv2 gridshift file provided
by swisstopo (chaining transforms) I'd like to evaluate feasibility
of producing a _new_ NTv2 gridshift file going straight to WGS84
latlong rather than CH1903+ latlong.

How could I proceed to compute the shift ?

--strk;


From EMiller at dfg.ca.gov  Tue Jan 31 10:51:15 2012
From: EMiller at dfg.ca.gov (Eric Miller)
Date: Tue, 31 Jan 2012 10:51:15 -0800
Subject: [Proj] Undefined subroutine &Proj::proj_init called
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAOLbYtW4nVlHtmFkaePp9lsBAAAAAA==@avbrief.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAAh3kF/Q2FdHpwnCCnp+mEIBAAAAAA==@avbrief.com>	<CA+YzLBeQBwEEePuGv0xRkZrMRGbwbT6U2GgZhip5ucMmM5n1cA@mail.gmail.com>	<!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAABlXsxeRQdRAlKhyMosdpbcBAAAAAA==@avbrief.com>
	<4F2795CB.4040905@gmail.com><4F2795CB.4040905@gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAAOLbYtW4nVlHtmFkaePp9lsBAAAAAA==@avbrief.com>
Message-ID: <4F27C7A3.95FD.00E4.1@dfg.ca.gov>

I'm not familiar with the Perl binding, but if it just is call the PROJ.4 library methods of the same name, then both "proj_init" and "proj_init_plus" require arguments.  The arguments to "proj_init" are the same as a C's main(int argc, char *argv[]).   In proj_init_plus, the argument is a string. For instance, proj_init_plus("+proj=latlon +DATUM=WGS84").

If Perl's loader is trying to match functions by name and arguments, then that might be the reason for the failure.  The trace shows that /usr/lib/libproj.so.0 is found and loaded. 
-- 

Eric G. Miller
Software Developer
CA Dept. of Fish & Game


>>> On 1/31/2012 at  2:44 AM, Martin Moore <martin.moore at avbrief.com> wrote:
> Thanks Ari - the code runs fine on Etch systems.
> 
>  
> 
> I did however check strace perl -e 'use PDL::GIS::Proj; my $pj =
> Proj::proj_init_plus();' 2>&1 | tail -n 20
> 
>  
> 
> On one of the etch systems and it also fails in the same way. So I guess the
> main script is calling something else!
> 
>  
> 
> Martin.
> 
>  
> 
> From: proj-bounces at lists.maptools.org 
> [mailto:proj-bounces at lists.maptools.org] On Behalf Of Ari Jolma
> Sent: 31 January 2012 07:19
> To: proj at lists.maptools.org 
> Cc: Geo-perl at list.hut.fi 
> Subject: Re: [Proj] Undefined subroutine &Proj::proj_init called
> 
>  
> 
> cc'ing geo-perl list. Followups there, please.
> 
> Seems to be the bindings in PDL::GIS::Proj. There is also another Proj
> module Geo::Proj4. Anybody know the PDL::GIS::Proj author?
> 
> Martin, how do you know the code is supposed to work? proj_init sounds like
> a function that might be called automatically.
> 
> Regards,
> 
> Ari
> 
> On 01/30/2012 09:03 PM, Martin Moore wrote: 
> 
> OK, thanks.
> 
>  
> 
> Not being into perl very much, which binding do you mean?
> 
>  
> 
> Martin.
> 
>  
> 
> From: fwarmerdam at gmail.com [mailto:fwarmerdam at gmail.com] On Behalf Of Frank
> Warmerdam
> Sent: 30 January 2012 18:07
> To: martin.moore at avbrief.com 
> Subject: Re: [Proj] Undefined subroutine &Proj::proj_init called
> 
>  
> 
> Martin,
> 
> For what it's worth, I don't believe the perl bindings for Proj
> you are using are part of the core distribution.  So you might
> have better luck directly contacting their author.  
> 
> Best regards,
> 
> 
> 
> 
> On Mon, Jan 30, 2012 at 7:22 AM, Martin Moore <martin.moore at avbrief.com>
> wrote:
> 
> 
> 
> Hi, I've got a pretty basic problem on a new Debian Squeeze server that has
> been narrowed down to:
> 
>  
> 
> strace perl -e 'use PDL::GIS::Proj; my $pj = Proj::proj_init();'  // also
> used Proj::proj_init_plus() with the same results
> 
>  
> 
> The only Proj.pm on the system is /usr/lib/perl5/PDL/GIS/Proj.pm and it
> doesn't appear to have a proj_init<_plus> function.
> 
>  
> 
> Stacktrace is at http://pastebin.com/kPkwt6nj 
> 
>  
> 
> Any ideas how to get this running appreciated.
> 
>  
> 
>  
> 
> As an aside, I needed to sudo ln -s /usr/lib/perl5/PDL/Core.pm
> /usr/lib/perl5/PDL::Core to get this recognized.  
> 
>  
> 
>  
> 
> Thanks,
> 
>  
> 
> Martin.
> 
> 
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org 
> http://lists.maptools.org/mailman/listinfo/proj 
> 
> 
> 




From martin.moore at avbrief.com  Fri Jan 27 05:17:07 2012
From: martin.moore at avbrief.com (Martin Moore)
Date: Fri, 27 Jan 2012 13:17:07 -0000
Subject: [Proj] Undefined subroutine &Proj::proj_init_plus
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAFLxZtQqo65Oo+1jhlUB9DvCgAAAEAAAADRmGUTsLfdHjMcCtgGUyEMBAAAAAA==@avbrief.com>



Hi, I'm building a new debian squeeze server and am getting the following
error when I run a (working under Etch) perl script:

 

Undefined subroutine &Proj::proj_init_plus

 

(In Etch this was &Proj::proj_init but it appears to have been replaced).

 

I'm assuming the Proj.pm module is loaded OK otherwise I'd get a different
error.

 

Top of the script is

 

 use strict;

 use vars qw($VERSION @ISA @EXPORT @EXPORT_OK);

 use Math::Trig;

 use Math::Geometry::Planar;

 use DBI;

 use Data::Dumper;

 use PDL::GIS::Proj;

 

 

and the line in question is

 

$p->{pj} = Proj::proj_init_plus( "+proj=$p->{proj} +units=$p->{units}
+lat_0=$p->{lat_0} +lon_0=$p->{lon_0}");

 

 

Proj was installed using ap-get, so I'm assuming no further build steps are
needed.

 

I know very little about perl and nothing about Proj, can anyone help with
this?

 

 

Thanks,

 

Martin.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120127/842daf17/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 92 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20120127/842daf17/attachment.gif>

