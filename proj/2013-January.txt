From support.mn at elisanet.fi  Wed Jan  2 02:40:00 2013
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Wed, 2 Jan 2013 12:40:00 +0200 (EET)
Subject: [Proj] Relationship between proj4 and spatialreference.org
Message-ID: <20762323.23365821357123201100.JavaMail.support.mn@elisanet.fi>

Howard Butler [hobu.inc at gmail.com] kirjoitti: 
> 
> On Dec 31, 2012, at 7:13 AM, Jan Hartmann <j.l.h.hartmann at uva.nl> wrote:
> 
> > Can anyone tell me how the references at spatialreference.org are related to the proj-strings of the official proj library? Nowadays proj includes lots of WGS-84 shifts, and at least one of them (28992, Dutch RD) is not propagated to spatialreference.org.
> 
> The relationship to spatialreference.org is one of being simply out-of-date. sr.org has not been updated in quite a while, and it needs a champion to come along and bring things forward.  sr.org gets its definitions from proj.4/GDAL as well as GeoTools. These have not been refreshed in at least a couple of years -- time for more than one EPSG database drop and the inclusion of datum shifting description in proj.4.
> 

The better side of this is that once up to date these local coordinate systems do not change very much.

Janne.




From milovanderlinden at gmail.com  Wed Jan  2 03:52:01 2013
From: milovanderlinden at gmail.com (Milo van der Linden (gmail))
Date: Wed, 2 Jan 2013 12:52:01 +0100
Subject: [Proj] Relationship between proj4 and spatialreference.org
In-Reply-To: <D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
Message-ID: <CANqqynmx2srrHsih4MVmZ3T1WNXeeFPS5SnW0PkPuy_g=H8CrQ@mail.gmail.com>

Is spatialreference.org waiting for funding or for "hands-on" volunteers?
For the latter; I would gladly help.

2012/12/31 Howard Butler <hobu.inc at gmail.com>

>
> On Dec 31, 2012, at 7:13 AM, Jan Hartmann <j.l.h.hartmann at uva.nl> wrote:
>
> > Can anyone tell me how the references at spatialreference.org are
> related to the proj-strings of the official proj library? Nowadays proj
> includes lots of WGS-84 shifts, and at least one of them (28992, Dutch RD)
> is not propagated to spatialreference.org.
>
> The relationship to spatialreference.org is one of being simply
> out-of-date. sr.org has not been updated in quite a while, and it needs a
> champion to come along and bring things forward.  sr.org gets its
> definitions from proj.4/GDAL as well as GeoTools. These have not been
> refreshed in at least a couple of years -- time for more than one EPSG
> database drop and the inclusion of datum shifting description in proj.4.
>
> Hope this helps,
>
> Howard
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130102/0f83c3d6/attachment.html>

From hobu.inc at gmail.com  Wed Jan  2 06:12:51 2013
From: hobu.inc at gmail.com (Howard Butler)
Date: Wed, 2 Jan 2013 08:12:51 -0600
Subject: [Proj] Relationship between proj4 and spatialreference.org
In-Reply-To: <CANqqynmx2srrHsih4MVmZ3T1WNXeeFPS5SnW0PkPuy_g=H8CrQ@mail.gmail.com>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<CANqqynmx2srrHsih4MVmZ3T1WNXeeFPS5SnW0PkPuy_g=H8CrQ@mail.gmail.com>
Message-ID: <44126A31-A354-4CF2-9F95-A9A3198A5C49@gmail.com>

Milo,

It is indeed waiting on a hands-on volunteer to invest some time in bringing it forward. Funding would be nice too, but developer time from someone familiar with Django, GDAL/OGR, and OpenLayers would make things go the farthest. Contact me privately if you're interested in getting the keys to the kingdom to do that work.

Howard

On Jan 2, 2013, at 5:52 AM, Milo van der Linden (gmail) <milovanderlinden at gmail.com> wrote:

> Is spatialreference.org waiting for funding or for "hands-on" volunteers? For the latter; I would gladly help.
> 
> 2012/12/31 Howard Butler <hobu.inc at gmail.com>
> 
> On Dec 31, 2012, at 7:13 AM, Jan Hartmann <j.l.h.hartmann at uva.nl> wrote:
> 
> > Can anyone tell me how the references at spatialreference.org are related to the proj-strings of the official proj library? Nowadays proj includes lots of WGS-84 shifts, and at least one of them (28992, Dutch RD) is not propagated to spatialreference.org.
> 
> The relationship to spatialreference.org is one of being simply out-of-date. sr.org has not been updated in quite a while, and it needs a champion to come along and bring things forward.  sr.org gets its definitions from proj.4/GDAL as well as GeoTools. These have not been refreshed in at least a couple of years -- time for more than one EPSG database drop and the inclusion of datum shifting description in proj.4.
> 
> Hope this helps,
> 
> Howard
> 
> 
> 
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
> 
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj



From j.l.h.hartmann at uva.nl  Wed Jan  2 06:32:08 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Wed, 02 Jan 2013 15:32:08 +0100
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
Message-ID: <50E444E8.7060403@uva.nl>

Hi Frank and all, happy new year!

Is the following possible with Proj? I am working with historical maps 
that are rotated with respect to a well known epsg-projection, see for 
example

http://mapserver.sara.nl/a1000/bladgrenzen.html

The blue squares are the sheets of the map 1:1000 of Amsterdam after 
1940, in epsg:28992, the red squares are the same sheets before 1940 in 
a local coordinate system. I know the conversion coefficients for the 
two coordinate systems: a simple six-value transformation of the form:

xnew = a*xold + b*yold + c
ynew = d*xold + e*yold + f

I would like to access the second map via a proj-string. For that, I 
would have to expand proj with a procedure that takes the six 
coefficients (a-f) and generates the transformed coordinates after the 
regular transformation.

Is this possible? Can anyone give me some pointers where to look in the 
proj-code? Conceptually, it looks simple to me, but I don't know where 
to start.

Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130102/9c1babbc/attachment.html>

From j.l.h.hartmann at uva.nl  Wed Jan  2 06:41:00 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Wed, 02 Jan 2013 15:41:00 +0100
Subject: [Proj] Relationship between proj4 and spatialreference.org
In-Reply-To: <D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
Message-ID: <50E446FC.8030006@uva.nl>

Hi Howard,

This is a problem, as OpenLayers looks by default to 
spatialreference.org when a projection has not been explicitly defined 
in the javascript code. This happens for example with the 
"displayProjection" item in the map controls. You get the wrong 
coordinates without being told that someting isn't right.

Is it very difficult to synchronize spatialreference.org with (e.g.) the 
proj epsg file? If I remember correctly, Frank has an automated updated  
procedure from the epsg database. Could that procedure be extended to 
spatialreference.org? I would be willing to put some effort in it, as I 
am working on a geographical indexing system of our map library, and 
there are many historical maps in it with projections that are not in 
the epsg database. Spatialreference.org would be an ideal system for 
these maps, but it would only be workable if all information were up to 
date.

Jan

On 12/31/2012 04:19 PM, Howard Butler wrote:
> On Dec 31, 2012, at 7:13 AM, Jan Hartmann <j.l.h.hartmann at uva.nl> wrote:
>
>> Can anyone tell me how the references at spatialreference.org are related to the proj-strings of the official proj library? Nowadays proj includes lots of WGS-84 shifts, and at least one of them (28992, Dutch RD) is not propagated to spatialreference.org.
> The relationship to spatialreference.org is one of being simply out-of-date. sr.org has not been updated in quite a while, and it needs a champion to come along and bring things forward.  sr.org gets its definitions from proj.4/GDAL as well as GeoTools. These have not been refreshed in at least a couple of years -- time for more than one EPSG database drop and the inclusion of datum shifting description in proj.4.
>
> Hope this helps,
>
> Howard
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130102/1e28d730/attachment.html>

From hobu.inc at gmail.com  Wed Jan  2 07:37:39 2013
From: hobu.inc at gmail.com (Howard Butler)
Date: Wed, 2 Jan 2013 09:37:39 -0600
Subject: [Proj] Relationship between proj4 and spatialreference.org
In-Reply-To: <50E446FC.8030006@uva.nl>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E446FC.8030006@uva.nl>
Message-ID: <922B318F-C4F6-4824-91ED-D4BE32BF756A@gmail.com>


On Jan 2, 2013, at 8:41 AM, Jan Hartmann <j.l.h.hartmann at uva.nl> wrote:

> Hi Howard,
> 
> This is a problem, as OpenLayers looks by default to spatialreference.org when a projection has not been explicitly defined in the javascript code. This happens for example with the "displayProjection" item in the map controls. You get the wrong coordinates without being told that someting isn't right.

That seems like a rather fragile way of OpenLayers (OpenLayers does reprojection now, or is this still proj.js?)  to engineer things, especially considering sr.org's sometimes spotty uptime...

> 
> Is it very difficult to synchronize spatialreference.org with (e.g.) the proj epsg file? If I remember correctly, Frank has an automated updated  procedure from the epsg database. Could that procedure be extended to spatialreference.org? I would be willing to put some effort in it, as I am working on a geographical indexing system of our map library, and there are many historical maps in it with projections that are not in the epsg database. Spatialreference.org would be an ideal system for these maps, but it would only be workable if all information were up to date.

The synchronization isn't too big of a job, but it depends on having an up-to-date GDAL available in addition to proj.4. sr.org uses GDAL's OSR classes to do the translations of the SRS representations. For some SRS's that GDAL can't interpret, the GeoTools WKT representation is simply passed back to the client. There's some voodoo that Chris Schmidt did to support this, and I'm not exactly sure where the lines of demarcation are. Additionally, OSR has improved significantly in the 3+ years since this was developed, so it may be possible to remove this hand-rolled aspect altogether. Then there's the ESRI, Oracle, and Lunar/Mars SRSs that need to be updated.

sr.org is one of those things that everyone likes to use but is unable to attract an audience of caretakers to invest in learning and spending some time keeping it current. 

Howard





From andre+joost at nurfuerspam.de  Wed Jan  2 07:51:37 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Wed, 02 Jan 2013 16:51:37 +0100
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <50E444E8.7060403@uva.nl>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E444E8.7060403@uva.nl>
Message-ID: <kc1l1r$72i$1@ger.gmane.org>

Am 02.01.2013 15:32, schrieb Jan Hartmann:
> Hi Frank and all, happy new year!
>
> Is the following possible with Proj? I am working with historical maps
> that are rotated with respect to a well known epsg-projection, see for
> example
>
> http://mapserver.sara.nl/a1000/bladgrenzen.html
>

Simpliest way would be to play with the +towgs84 parameters of the 
current EPSG definition.
The first three are shifts of the center of the earth in all three 
dimensions, the next three rotations around these axes, and the last a 
scale factor.

So I would change the values four to six one after the other and look 
for the result. Quantum GIS can handle self-defined proj strings, 
create vector grids in all projections, and show them togehter with 
other grids.

HTH,
André Joost



From j.l.h.hartmann at uva.nl  Wed Jan  2 09:03:00 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Wed, 02 Jan 2013 18:03:00 +0100
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <kc1l1r$72i$1@ger.gmane.org>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E444E8.7060403@uva.nl> <kc1l1r$72i$1@ger.gmane.org>
Message-ID: <50E46844.2000202@uva.nl>


On 01/02/2013 04:51 PM, Andre Joost wrote:
>
> Simpliest way would be to play with the +towgs84 parameters of the
> current EPSG definition.
> The first three are shifts of the center of the earth in all three
> dimensions, the next three rotations around these axes, and the last a
> scale factor.
>
> So I would change the values four to six one after the other and look
> for the result. Quantum GIS can handle self-defined proj strings,
> create vector grids in all projections, and show them togehter with
> other grids.
>
>
Thanks Andre, it's in the right direction, but it is a bit more complex. 
The towgs84 parameters are around the center of the earth. The rotations 
of the historical maps, and the coefficients I computed, are around the 
center of the projection of epsg:28992 (church tower of Amersfoort).

However, I can compute wgs84 latlon values for every point on the 
historical map, by first converting the point to epsg:28992 and then to 
epsg:4326 (wgs84). Do you know of any software that can compute the 
towgs84 parameters based on a set of input coordinates and the 
corresponding wgs84 coordinates?

Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130102/5df99d4d/attachment.html>

From richard.greenwood at gmail.com  Wed Jan  2 09:33:39 2013
From: richard.greenwood at gmail.com (Richard Greenwood)
Date: Wed, 2 Jan 2013 10:33:39 -0700
Subject: [Proj] Relationship between proj4 and spatialreference.org
In-Reply-To: <922B318F-C4F6-4824-91ED-D4BE32BF756A@gmail.com>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E446FC.8030006@uva.nl>
	<922B318F-C4F6-4824-91ED-D4BE32BF756A@gmail.com>
Message-ID: <CAHBySPY+teeFk50XZ9L3G=R7YGV8dkGk+Yg-NAQNTD03tjG5Cw@mail.gmail.com>

On Wed, Jan 2, 2013 at 8:37 AM, Howard Butler <hobu.inc at gmail.com> wrote:

>
> On Jan 2, 2013, at 8:41 AM, Jan Hartmann <j.l.h.hartmann at uva.nl> wrote:
>
> > Hi Howard,
> >
> > This is a problem, as OpenLayers looks by default to
> spatialreference.org when a projection has not been explicitly defined in
> the javascript code. This happens for example with the "displayProjection"
> item in the map controls. You get the wrong coordinates without being told
> that someting isn't right.
>
> That seems like a rather fragile way of OpenLayers (OpenLayers does
> reprojection now, or is this still proj.js?)  to engineer things,
> especially considering sr.org's sometimes spotty uptime...
>

I argued that the automatic lookup of coordinate systems parameters should
be a separate optional module as opposed to the default behavior as it is
now. Including your own definitions was always my intention. I've never
liked the idea of an automatic lookup because the user doesn't know what
they are getting, not to mention the additional dependencies and associated
performance hits.

Having said all that, if the default behavior is to do a lookup on
spatialreference.org, it would be nice if spatialreference.org provided
definitions that were optimized for web/javascript use, i.e. did not
require client-side lookup tables for things like named meridians,
ellipsoids, etc.

Best wishes for the new year,
Rich


Richard Greenwood
richard.greenwood at gmail.com
www.greenwoodmap.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130102/00cd78ea/attachment.html>

From andre+joost at nurfuerspam.de  Wed Jan  2 10:02:46 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Wed, 02 Jan 2013 19:02:46 +0100
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <50E46844.2000202@uva.nl>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E444E8.7060403@uva.nl> <kc1l1r$72i$1@ger.gmane.org>
	<50E46844.2000202@uva.nl>
Message-ID: <kc1snq$fd3$1@ger.gmane.org>

Am 02.01.2013 18:03, schrieb Jan Hartmann:

> However, I can compute wgs84 latlon values for every point on the
> historical map, by first converting the point to epsg:28992 and then to
> epsg:4326 (wgs84). Do you know of any software that can compute the
> towgs84 parameters based on a set of input coordinates and the
> corresponding wgs84 coordinates?

Well, I am an enginneer and not a scientist, so I prefer the trial by 
myself...

Assuming you understand German, here are some hints:
<http://www.ottmarlabonde.de/L1/Transformationsparameter_Berechnung.htm>
<http://diegeodaeten.de/quaternionentransformation.html>
<http://derletztekick.com/software/koordinatentransformation>

There is also a commercial software, but I would not recommend to pay 
for such things.



-- 
Gruß,
André Joost



From hobu.inc at gmail.com  Wed Jan  2 11:58:44 2013
From: hobu.inc at gmail.com (Howard Butler)
Date: Wed, 2 Jan 2013 13:58:44 -0600
Subject: [Proj] Relationship between proj4 and spatialreference.org
In-Reply-To: <CAHBySPY+teeFk50XZ9L3G=R7YGV8dkGk+Yg-NAQNTD03tjG5Cw@mail.gmail.com>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E446FC.8030006@uva.nl>
	<922B318F-C4F6-4824-91ED-D4BE32BF756A@gmail.com>
	<CAHBySPY+teeFk50XZ9L3G=R7YGV8dkGk+Yg-NAQNTD03tjG5Cw@mail.gmail.com>
Message-ID: <5ACD1AC4-EB19-4E6B-B641-6A3A92289BB3@gmail.com>


On Jan 2, 2013, at 11:33 AM, Richard Greenwood <richard.greenwood at gmail.com> wrote:
> Having said all that, if the default behavior is to do a lookup on spatialreference.org, it would be nice if spatialreference.org provided definitions that were optimized for web/javascript use, i.e. did not require client-side lookup tables for things like named meridians, ellipsoids, etc.

sr.org could certainly be augmented to provide such things (valid bboxen of SRSs is another common request). A simple matter of programming, as they say...

From jagoncal at gmail.com  Wed Jan  2 17:47:42 2013
From: jagoncal at gmail.com (=?ISO-8859-1?Q?Jose_Gon=E7alves?=)
Date: Thu, 3 Jan 2013 01:47:42 +0000
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <50E444E8.7060403@uva.nl>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E444E8.7060403@uva.nl>
Message-ID: <CALHLaORCfcumBJBvnc52Y_3ztD-ASjqC282+pNHf_fGX9c4a5w@mail.gmail.com>

Hello

I had a similar problem with some old scanned maps from Portugal that were
in a local topographic coordinate system. I also wanted to have a PROJ.4
string for that system in order to load the maps in a GIS software together
with other data sets. I did it simulating a LCC projection (Lambert
Conformal Conic).

First there is an assumption we can do about the affine transformation. It
is likely that it is nearly a conformal transformation (a=e and d=-b) and
with a scale factor very close to 1 (sqrt(a*a+b*b)=1). In this case the
essential thing to deal with is the rotation of the axes.

In the LCC projection you can choose one standard parallel in your region
so that the linear deformation is always very close to 1. Then you can
choose a central meridian far enough, so that the cartographic north (the Y
axis of the projection) becomes parallel to the Y axis of your local
coordinate system. You can do that by trial and error or by analysing the
meridian convergence of the LCC projection. Then you can add a false
easting/northing so that the projection and your local system coincide.

Suppose for example that point (4.8E, 52.2N) is the origin of your local
coordinate system and point (4.9E, 52.4N) is on the Y axis.
Consider 52.3N as the standard parallel. The following PROJ string converts
these two points in a way that they have the same easting:

   +ellps=bessel +proj=lcc +lon_0=-16.68875 +lat_0=52.3 +lat_1=52.3
+lat_2=52.3 +no_defs

The projected coordinates of the first point are (1447575.65 m, 205246.75
m). If you add symmetric values as false easting/northing

   +x_0=-1447575.65 +y_0=-205246.75

the PROJ string does what we want. You can also play with k_0 if some scale
adjustment is still needed.

This simulation of a projection is obviously only valid for rather small
areas. It worked well for me, in Quantum GIS, with the "on the fly" option.


Regards

Jose Gonçalves



2013/1/2 Jan Hartmann <j.l.h.hartmann at uva.nl>

>  Hi Frank and all, happy new year!
>
> Is the following possible with Proj? I am working with historical maps
> that are rotated with respect to a well known epsg-projection, see for
> example
>
> http://mapserver.sara.nl/a1000/bladgrenzen.html
>
> The blue squares are the sheets of the map 1:1000 of Amsterdam after 1940,
> in epsg:28992, the red squares are the same sheets before 1940 in a local
> coordinate system. I know the conversion coefficients for the two
> coordinate systems: a simple six-value transformation of the form:
>
> xnew = a*xold + b*yold + c
> ynew = d*xold + e*yold + f
>
> I would like to access the second map via a proj-string. For that, I would
> have to expand proj with a procedure that takes the six coefficients (a-f)
> and generates the transformed coordinates after the regular transformation.
>
> Is this possible? Can anyone give me some pointers where to look in the
> proj-code? Conceptually, it looks simple to me, but I don't know where to
> start.
>
> Jan
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130103/5b89d7f6/attachment.html>

From j.l.h.hartmann at uva.nl  Thu Jan  3 01:48:44 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Thu, 03 Jan 2013 10:48:44 +0100
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <CALHLaORCfcumBJBvnc52Y_3ztD-ASjqC282+pNHf_fGX9c4a5w@mail.gmail.com>
References: <CAGeT8y=dkTSD_nW9+4G0itNDApzN9uYHtJVsiB1PYNq0-o6CuA@mail.gmail.com>
	<50DB6915.10808@sri.com>
	<0DA58EB5D84A2744B1229C32174A8D524FB3B75B@BY2PRD0610MB352.namprd06.prod.outlook.com>
	<50DC9CD7.8090409@sri.com> <50E18F95.3020102@uva.nl>
	<D8D58097-FE48-4C21-8CCD-5CA41A3CD67B@gmail.com>
	<50E444E8.7060403@uva.nl>
	<CALHLaORCfcumBJBvnc52Y_3ztD-ASjqC282+pNHf_fGX9c4a5w@mail.gmail.com>
Message-ID: <50E553FC.1050009@uva.nl>

Thanks Jose, I'll give it a try

Jan

On 01/03/2013 02:47 AM, Jose Gonçalves wrote:
> Hello
>
> I had a similar problem with some old scanned maps from Portugal that 
> were in a local topographic coordinate system. I also wanted to have a 
> PROJ.4 string for that system in order to load the maps in a GIS 
> software together with other data sets. I did it simulating a LCC 
> projection (Lambert Conformal Conic).
>
> First there is an assumption we can do about the affine 
> transformation. It is likely that it is nearly a conformal 
> transformation (a=e and d=-b) and with a scale factor very close to 1 
> (sqrt(a*a+b*b)=1). In this case the essential thing to deal with is 
> the rotation of the axes.
>
> In the LCC projection you can choose one standard parallel in your 
> region so that the linear deformation is always very close to 1. Then 
> you can choose a central meridian far enough, so that the cartographic 
> north (the Y axis of the projection) becomes parallel to the Y axis of 
> your local coordinate system. You can do that by trial and error or by 
> analysing the meridian convergence of the LCC projection. Then you can 
> add a false easting/northing so that the projection and your local 
> system coincide.
>
> Suppose for example that point (4.8E, 52.2N) is the origin of your 
> local coordinate system and point (4.9E, 52.4N) is on the Y axis.
> Consider 52.3N as the standard parallel. The following PROJ string 
> converts these two points in a way that they have the same easting:
>
>    +ellps=bessel +proj=lcc +lon_0=-16.68875 +lat_0=52.3 +lat_1=52.3 
> +lat_2=52.3 +no_defs
>
> The projected coordinates of the first point are (1447575.65 m, 
> 205246.75 m). If you add symmetric values as false easting/northing
>
>    +x_0=-1447575.65 +y_0=-205246.75
>
> the PROJ string does what we want. You can also play with k_0 if some 
> scale adjustment is still needed.
>
> This simulation of a projection is obviously only valid for rather 
> small areas. It worked well for me, in Quantum GIS, with the "on the 
> fly" option.
>
>
> Regards
>
> Jose Gonçalves
>
>
>
> 2013/1/2 Jan Hartmann <j.l.h.hartmann at uva.nl 
> <mailto:j.l.h.hartmann at uva.nl>>
>
>     Hi Frank and all, happy new year!
>
>     Is the following possible with Proj? I am working with historical
>     maps that are rotated with respect to a well known
>     epsg-projection, see for example
>
>     http://mapserver.sara.nl/a1000/bladgrenzen.html
>
>     The blue squares are the sheets of the map 1:1000 of Amsterdam
>     after 1940, in epsg:28992, the red squares are the same sheets
>     before 1940 in a local coordinate system. I know the conversion
>     coefficients for the two coordinate systems: a simple six-value
>     transformation of the form:
>
>     xnew = a*xold + b*yold + c
>     ynew = d*xold + e*yold + f
>
>     I would like to access the second map via a proj-string. For that,
>     I would have to expand proj with a procedure that takes the six
>     coefficients (a-f) and generates the transformed coordinates after
>     the regular transformation.
>
>     Is this possible? Can anyone give me some pointers where to look
>     in the proj-code? Conceptually, it looks simple to me, but I don't
>     know where to start.
>
>     Jan
>
>     _______________________________________________
>     Proj mailing list
>     Proj at lists.maptools.org <mailto:Proj at lists.maptools.org>
>     http://lists.maptools.org/mailman/listinfo/proj
>
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130103/e11d6c8d/attachment.html>

From support.mn at elisanet.fi  Thu Jan  3 04:01:06 2013
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Thu, 3 Jan 2013 14:01:06 +0200 (EET)
Subject: [Proj] Add simple transformations to proj
Message-ID: <17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>

Andre Joost [andre+joost at nurfuerspam.de] kirjoitti: 
> There is also a commercial software, but I would not recommend to pay 
> for such things.
> 

I hope he is not recommending to use stolen programs?

if it is not too expensive (compared to your own hour/price x hours spent to
make similar) and it works. It is usually at least 1000 times cheaper to use
any ready made than to make similar tool your self - why? Since making
any good program is very slow and time consuming.

http://techtv.mit.edu/videos/12260-computer-for-apollo-1965-science-reporter-tv-series


regards: Janne.






From thy at 42.dk  Thu Jan  3 06:02:58 2013
From: thy at 42.dk (Kristian Thy)
Date: Thu, 3 Jan 2013 15:02:58 +0100
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
Message-ID: <20130103140257.GB16213@42.dk>

On Thu, Jan 03, support.mn at elisanet.fi wrote:
> Andre Joost [andre+joost at nurfuerspam.de] kirjoitti: 
> > There is also a commercial software, but I would not recommend to pay 
> > for such things.
> > 
> 
> I hope he is not recommending to use stolen programs?

I read that as an exhortation to use FOSS or build your own code, not
a suggestion that piracy is a valid choice.

> if it is not too expensive (compared to your own hour/price x hours spent to
> make similar) and it works.

Problem number one: you usually only find out whether it works after
you've paid for it.

> It is usually at least 1000 times cheaper to use any ready made than
> to make similar tool your self - why? Since making any good program is
> very slow and time consuming.

Problem number two: you very easily end up paying for 1000 features you
don't need and wouldn't have wasted time on coding yourself.

\\kristian
-- 
... et nemo ex vobis interrogat me: "Quo vadis?"


From msieczka at sieczka.org  Thu Jan  3 06:03:52 2013
From: msieczka at sieczka.org (Maciej Sieczka)
Date: Thu, 03 Jan 2013 15:03:52 +0100
Subject: [Proj] using an NTv2 grid to apply a slight shift to coordinates in
 a metric CS
Message-ID: <a62d95ace49d4fa26a1e0049529539fb@s16.hekko.net.pl>

Hello,

I have a script which takes an x,y pair of metric coordinates in 
EPSG:2174 (http://www.spatialreference.org/ref/epsg/2174/proj4) and 
returns them slightly shifted, in the same coordinate system.

The difference between the input and output coordinates varies from 0 
to about 60 cm, non-systematicaly.

I would like to be able to "reproject" my GIS data from EPSG:2174 to 
EPSG:2714 + the shift described above, and the other way round; using 
GDAL/OGR, GRASS, QGIS reprojection tools.

Can anyone tell me if using a shift grid for that would make sense? I 
have a general idea how to create one from my scripts output, but there 
is something missing in my thinking. Let me put it this way - should my 
grid provide shifts between:

a) the original EPSG:2174 and the EPSG:2174+shift

or rather

b) between WGS84 and the EPSG:2174+shift?

And what would be the proj4 string for the new system in either case?

Another thing is if it would be possible to utilise a similar grid to 
reproject between EPSG:2714+shift and other coordinate systems covering 
the same territory (e.g. EPSG:2180), again using GDAL etc. tools.

Ideally, I would like to achieve both goals with just single shift 
grid.

I'm afraid I might be asking my questions wrong way, but hopefully you 
get what I'm aiming at. I'd be grateful if you can correct my errors and 
give me some guidance here.

Regards,
Maciek

-- 
Maciej Sieczka
http://www.sieczka.org


From andre+joost at nurfuerspam.de  Thu Jan  3 08:25:23 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Thu, 03 Jan 2013 17:25:23 +0100
Subject: [Proj] using an NTv2 grid to apply a slight shift to
 coordinates in a metric CS
In-Reply-To: <a62d95ace49d4fa26a1e0049529539fb@s16.hekko.net.pl>
References: <a62d95ace49d4fa26a1e0049529539fb@s16.hekko.net.pl>
Message-ID: <kc4be0$uch$1@ger.gmane.org>

Hi,

the nadgrid shift is usually done with lat/lon coordinates. You 
transform your cartesian coordiantes to lat/lon, apply the shift, and 
transform into another grid.

The syntax of the proj string is:
+proj=tmerc +lat_0=0 +lon_0=9 +x_0=3500000 +y_0=0 +k=1.000000 
+ellps=bessel +units=m +nadgrids=path/to/BETA2007.gsb +wktext

The grid file has to be in binary format, which can be transformed from 
an ASCII file.

For the German grid, information can be found here:
<http://crs.bkg.bund.de/crseu/crs/descrtrans/BeTA/de_dhdn2etrs_beta.php>

Most other users of NTv2 should have published similar documentation.

HTH,
André Joost



Am 03.01.2013 15:03, schrieb Maciej Sieczka:
> Hello,
>
> I have a script which takes an x,y pair of metric coordinates in
> EPSG:2174 (http://www.spatialreference.org/ref/epsg/2174/proj4) and
> returns them slightly shifted, in the same coordinate system.
>
> The difference between the input and output coordinates varies from 0
> to about 60 cm, non-systematicaly.
>
> I would like to be able to "reproject" my GIS data from EPSG:2174 to
> EPSG:2714 + the shift described above, and the other way round; using
> GDAL/OGR, GRASS, QGIS reprojection tools.
>
> Can anyone tell me if using a shift grid for that would make sense? I
> have a general idea how to create one from my scripts output, but there
> is something missing in my thinking. Let me put it this way - should my
> grid provide shifts between:
>
> a) the original EPSG:2174 and the EPSG:2174+shift
>
> or rather
>
> b) between WGS84 and the EPSG:2174+shift?
>
> And what would be the proj4 string for the new system in either case?
>
> Another thing is if it would be possible to utilise a similar grid to
> reproject between EPSG:2714+shift and other coordinate systems covering
> the same territory (e.g. EPSG:2180), again using GDAL etc. tools.
>
> Ideally, I would like to achieve both goals with just single shift
> grid.
>
> I'm afraid I might be asking my questions wrong way, but hopefully you
> get what I'm aiming at. I'd be grateful if you can correct my errors and
> give me some guidance here.
>
> Regards,
> Maciek
>




From andre+joost at nurfuerspam.de  Thu Jan  3 08:14:54 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Thu, 03 Jan 2013 17:14:54 +0100
Subject: [Proj] Add simple transformations to proj
In-Reply-To: <20130103140257.GB16213@42.dk>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk>
Message-ID: <kc4be0$uch$2@ger.gmane.org>

Am 03.01.2013 15:02, schrieb Kristian Thy:
> On Thu, Jan 03, support.mn at elisanet.fi wrote:
>> Andre Joost [andre+joost at nurfuerspam.de] kirjoitti:
>>> There is also a commercial software, but I would not recommend to pay
>>> for such things.
>>>
>>
>> I hope he is not recommending to use stolen programs?
>
> I read that as an exhortation to use FOSS or build your own code

Exactly, and I learn a lot by doing it by myself. The time I invest does 
not matter to me.

Greetings,
André Joost



From msieczka at sieczka.org  Thu Jan  3 11:44:46 2013
From: msieczka at sieczka.org (Maciej Sieczka)
Date: Thu, 03 Jan 2013 20:44:46 +0100
Subject: [Proj] using an NTv2 grid to apply a slight shift to
 coordinates in a metric CS
In-Reply-To: <kc4be0$uch$1@ger.gmane.org>
References: <a62d95ace49d4fa26a1e0049529539fb@s16.hekko.net.pl>
	<kc4be0$uch$1@ger.gmane.org>
Message-ID: <50E5DFAE.4090706@sieczka.org>

W dniu 03.01.2013 17:25, Andre Joost pisze:
> the nadgrid shift is usually done with lat/lon coordinates. You
> transform your cartesian coordiantes to lat/lon,

EPSG:2174 is on Krassovsky/Pulkovo_1942_58. Do I convert my cartesian
EPSG:2714 coordinates to latlon on WGS84 or Pulkovo_1942_58?

> apply the shift, and transform into another grid.
>
> The syntax of the proj string is: +proj=tmerc +lat_0=0 +lon_0=9
> +x_0=3500000 +y_0=0 +k=1.000000 +ellps=bessel +units=m
> +nadgrids=path/to/BETA2007.gsb +wktext
>
> The grid file has to be in binary format, which can be transformed
> from an ASCII file.

I more or less know how to create a NTv2 grid (from threads
http://lists.maptools.org/pipermail/proj/2011-April/005628.html,
http://lists.maptools.org/pipermail/proj/2012-February/006093.html, and
the links mentioned in them both).

What I don't know is the following:

>> Let me put it this way - should my grid provide shifts between:
>>
>> a) the original EPSG:2174 and the EPSG:2174+shift
>>
>> or rather
>>
>> b) between WGS84 and the EPSG:2174+shift?
>>
>> And what would be the proj4 string for the new system in either
>> case?

Maciek

> Am 03.01.2013 15:03, schrieb Maciej Sieczka:
>> Hello,
>>
>> I have a script which takes an x,y pair of metric coordinates in
>> EPSG:2174 (http://www.spatialreference.org/ref/epsg/2174/proj4)
>> and returns them slightly shifted, in the same coordinate system.
>>
>> The difference between the input and output coordinates varies from
>> 0 to about 60 cm, non-systematicaly.
>>
>> I would like to be able to "reproject" my GIS data from EPSG:2174
>> to EPSG:2714 + the shift described above, and the other way round;
>> using GDAL/OGR, GRASS, QGIS reprojection tools.
>>
>> Can anyone tell me if using a shift grid for that would make sense?
>> I have a general idea how to create one from my scripts output, but
>> there is something missing in my thinking. Let me put it this way -
>> should my grid provide shifts between:
>>
>> a) the original EPSG:2174 and the EPSG:2174+shift
>>
>> or rather
>>
>> b) between WGS84 and the EPSG:2174+shift?
>>
>> And what would be the proj4 string for the new system in either
>> case?
>>
>> Another thing is if it would be possible to utilise a similar grid
>> to reproject between EPSG:2714+shift and other coordinate systems
>> covering the same territory (e.g. EPSG:2180), again using GDAL etc.
>> tools.
>>
>> Ideally, I would like to achieve both goals with just single shift
>> grid.
>>
>> I'm afraid I might be asking my questions wrong way, but hopefully
>> you get what I'm aiming at. I'd be grateful if you can correct my
>> errors and give me some guidance here.

-- 
Maciej Sieczka
http://www.sieczka.org


From andre+joost at nurfuerspam.de  Thu Jan  3 22:02:43 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Fri, 04 Jan 2013 07:02:43 +0100
Subject: [Proj] using an NTv2 grid to apply a slight shift to
 coordinates in a metric CS
In-Reply-To: <50E5DFAE.4090706@sieczka.org>
References: <a62d95ace49d4fa26a1e0049529539fb@s16.hekko.net.pl>
	<kc4be0$uch$1@ger.gmane.org> <50E5DFAE.4090706@sieczka.org>
Message-ID: <kc5r9p$kap$1@ger.gmane.org>

Am 03.01.2013 20:44, schrieb Maciej Sieczka:
> W dniu 03.01.2013 17:25, Andre Joost pisze:
>> the nadgrid shift is usually done with lat/lon coordinates. You
>> transform your cartesian coordiantes to lat/lon,
>
> EPSG:2174 is on Krassovsky/Pulkovo_1942_58. Do I convert my cartesian
> EPSG:2714 coordinates to latlon on WGS84 or Pulkovo_1942_58?

the lat/lon should be Pulkovo. Its like the constant +towgs84 value

+towgs84=33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84

but two-dimensional. The grid-shift is usually between the Krassovsky 
ellipsoid and WGS84.


>
> What I don't know is the following:
>
>>> Let me put it this way - should my grid provide shifts between:
>>>
>>> a) the original EPSG:2174 and the EPSG:2174+shift
>>>
>>> or rather
>>>
>>> b) between WGS84 and the EPSG:2174+shift?
>>>

the second one.

Greetings,
André Joost




From andre+joost at nurfuerspam.de  Thu Jan  3 23:27:33 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Fri, 04 Jan 2013 08:27:33 +0100
Subject: [Proj] using an NTv2 grid to apply a slight shift to
 coordinates in a metric CS
In-Reply-To: <kc5r9p$kap$1@ger.gmane.org>
References: <a62d95ace49d4fa26a1e0049529539fb@s16.hekko.net.pl>
	<kc4be0$uch$1@ger.gmane.org> <50E5DFAE.4090706@sieczka.org>
	<kc5r9p$kap$1@ger.gmane.org>
Message-ID: <kc609i$o0b$1@ger.gmane.org>

Just re-read the manual:

The shift is done with lat/lon values, and the source and target 
ellipsoid are given in the gsa/gsb file. Bbut I am not sure if they are 
actually used by Proj4.

Proj.4 always refers to WGS84 as target, so that ellipsoid should be the 
target ellipsoid.

The individual shift values are in seconds of lat and lon.

Greetings,
André Joost




From support.mn at elisanet.fi  Fri Jan  4 03:24:02 2013
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Fri, 4 Jan 2013 13:24:02 +0200 (EET)
Subject: [Proj] Add simple transformations to proj
Message-ID: <8432643.23513381357298643453.JavaMail.support.mn@elisanet.fi>

Kristian Thy [thy at 42.dk] kirjoitti: 
> On Thu, Jan 03, support.mn at elisanet.fi wrote:
> > Andre Joost [andre+joost at nurfuerspam.de] kirjoitti: 
> > > There is also a commercial software, but I would not recommend to pay 
> > > for such things.
> > > 
> > 
> > I hope he is not recommending to use stolen programs?
> 
> I read that as an exhortation to use FOSS or build your own code, not
> a suggestion that piracy is a valid choice.
> 
> > if it is not too expensive (compared to your own hour/price x hours spent to
> > make similar) and it works.
> 
> Problem number one: you usually only find out whether it works after
> you've paid for it.
> 

The market for software is very dangerous for an inexperienced consumer.
Often  the most tempting deal is the least usable -- why? -- since those
people use all their effort to sell the program and not to make it or develop
it. Often the low cost packages are also nothing else than pirated programs
coming from far east countries.

> > It is usually at least 1000 times cheaper to use any ready made than
> > to make similar tool your self - why? Since making any good program is
> > very slow and time consuming.
> 
> Problem number two: you very easily end up paying for 1000 features you
> don't need and wouldn't have wasted time on coding yourself.
> 

If you can really make it and save any money doing it your self then I agree
with you - the other side is that it seldom pays if there is any usable ready
made alternative .. and if you simply do not have time to develop, test and
write it due to doing something else that pays better.

Janne.




From charles.karney at sri.com  Wed Jan  9 08:53:22 2013
From: charles.karney at sri.com (Charles Karney)
Date: Wed, 9 Jan 2013 11:53:22 -0500
Subject: [Proj] triaxial ellipsoid
In-Reply-To: <951001350487547@web15h.yandex.ru>
References: <951001350487547@web15h.yandex.ru>
Message-ID: <50EDA082.2000702@sri.com>

On 2012-10-17 11:25, Aleksander Yanovskiy wrote:
> Greetings!
>
> Could you please suggest me a software library that can calculate distances on the surface of the triaxial Earth ellipsoid ?
>

Jean-Marc Baillard has coded up Jacobi's solution for geodesics on a
triaxial ellipsoid for an HP-41 calculator, see

   http://hp41programs.yolasite.com/geod3axial.php

I've also written up some notes on the problem which may be of interest

   http://geographiclib.sourceforge.net/1.29/triaxial.html

Disclaimer: A triaxial ellipsoid approximates the earth only slightly
better than an ellipsoid of revolution. If you are really considering
measuring distances on the earth using a triaxial ellipsoid, you should
also be worrying about the shape of the geoid (which essentially makes
the geodesic problem a hopeless mess).


From yanouski at yandex.by  Wed Jan  9 12:06:10 2013
From: yanouski at yandex.by (Aleksander Yanovskiy)
Date: Wed, 09 Jan 2013 23:06:10 +0300
Subject: [Proj] triaxial ellipsoid
In-Reply-To: <50EDA082.2000702@sri.com>
References: <951001350487547@web15h.yandex.ru> <50EDA082.2000702@sri.com>
Message-ID: <188621357761970@web17h.yandex.ru>

Thank you both Charles and Jean-Marc for your work!
The visualizations at http://geographiclib.sourceforge.net/1.29/triaxial.html are really helpfull for understanding the material. Could you please advise me some free software to generate the figures with another initial conditions ?

Aleksander

09.01.2013, 19:53, "Charles Karney" <charles.karney at sri.com>:
> On 2012-10-17 11:25, Aleksander Yanovskiy wrote:
>
>>  Greetings!
>>
>>  Could you please suggest me a software library that can calculate distances on the surface of the triaxial Earth ellipsoid ?
>
> Jean-Marc Baillard has coded up Jacobi's solution for geodesics on a
> triaxial ellipsoid for an HP-41 calculator, see
>
>    http://hp41programs.yolasite.com/geod3axial.php
>
> I've also written up some notes on the problem which may be of interest
>
>    http://geographiclib.sourceforge.net/1.29/triaxial.html
>
> Disclaimer: A triaxial ellipsoid approximates the earth only slightly
> better than an ellipsoid of revolution. If you are really considering
> measuring distances on the earth using a triaxial ellipsoid, you should
> also be worrying about the shape of the geoid (which essentially makes
> the geodesic problem a hopeless mess).


From charles.karney at sri.com  Wed Jan  9 12:57:24 2013
From: charles.karney at sri.com (Charles Karney)
Date: Wed, 9 Jan 2013 15:57:24 -0500
Subject: [Proj] triaxial ellipsoid
In-Reply-To: <188621357761970@web17h.yandex.ru>
References: <951001350487547@web15h.yandex.ru> <50EDA082.2000702@sri.com>
	<188621357761970@web17h.yandex.ru>
Message-ID: <50EDD9B4.40303@sri.com>

On 2013-01-09 15:06, Aleksander Yanovskiy wrote:
> Thank you both Charles and Jean-Marc for your work!
> The visualizations at http://geographiclib.sourceforge.net/1.29/triaxial.html are really helpfull for understanding the material. Could you please advise me some free software to generate the figures with another initial conditions ?
>
> Aleksander

I can tell you what I did to make the plots:

(1) Compute the path of geodesic using Matlab.  The code for transpolar
and circumpolar geodesics is straightforward: tabulate the two integrals
over a period and then use interp1q to interpolate and reverse
interpolate these integrals, e.g., for circumpolar geodesics:

   sigma -> integral -> omega

Umbilical geodesics are trickier because the rules for traversing the
umbilical points need to be worked out and coded up.  In addition the
line isn't well parameterized by either beta or omega when it lies near
the middle ellipse, so I ended up combining both parameterizations to
get a smooth result.

(2) To plot, I converted beta,omega to cartesian coordinates, projected
these to a 2d orthographic plane, replaced the back portions of the
geodesics by NaN, and used Matlab's 2d plot function.  (I suppose I
could have used the 3d graphics capabilities of Matlab; but I liked the
control that I had over the output doing the 2d conversion myself.)

You can equally well use octave for these tasks if you want a free
solution.

I might end up coding these routines for public consumption.  However
that's on a back burner for me.  First, I need to write up my algorithm
for exact sampling from a normal distribution.  See

   http://randomlib.sf.net/html/classRandomLib_1_1ExactNormal.html


From yanouski at yandex.by  Thu Jan 10 00:00:25 2013
From: yanouski at yandex.by (Aleksander Yanovskiy)
Date: Thu, 10 Jan 2013 11:00:25 +0300
Subject: [Proj] triaxial ellipsoid
In-Reply-To: <50EDD9B4.40303@sri.com>
References: <951001350487547@web15h.yandex.ru> <50EDA082.2000702@sri.com>
	<188621357761970@web17h.yandex.ru> <50EDD9B4.40303@sri.com>
Message-ID: <481591357804825@web30d.yandex.ru>

Thank you Charles for the explanation! It seems the visualization could be done in SciLab (http://www.scilab.org/).

09.01.2013, 23:57, "Charles Karney" <charles.karney at sri.com>:
> On 2013-01-09 15:06, Aleksander Yanovskiy wrote:
>
>>  Thank you both Charles and Jean-Marc for your work!
>>  The visualizations at http://geographiclib.sourceforge.net/1.29/triaxial.html are really helpfull for understanding the material. Could you please advise me some free software to generate the figures with another initial conditions ?
>>
>>  Aleksander
>
> I can tell you what I did to make the plots:
>
> (1) Compute the path of geodesic using Matlab.  The code for transpolar
> and circumpolar geodesics is straightforward: tabulate the two integrals
> over a period and then use interp1q to interpolate and reverse
> interpolate these integrals, e.g., for circumpolar geodesics:
>
>    sigma -> integral -> omega
>
> Umbilical geodesics are trickier because the rules for traversing the
> umbilical points need to be worked out and coded up.  In addition the
> line isn't well parameterized by either beta or omega when it lies near
> the middle ellipse, so I ended up combining both parameterizations to
> get a smooth result.
>
> (2) To plot, I converted beta,omega to cartesian coordinates, projected
> these to a 2d orthographic plane, replaced the back portions of the
> geodesics by NaN, and used Matlab's 2d plot function.  (I suppose I
> could have used the 3d graphics capabilities of Matlab; but I liked the
> control that I had over the output doing the 2d conversion myself.)
>
> You can equally well use octave for these tasks if you want a free
> solution.
>
> I might end up coding these routines for public consumption.  However
> that's on a back burner for me.  First, I need to write up my algorithm
> for exact sampling from a normal distribution.  See
>
>    http://randomlib.sf.net/html/classRandomLib_1_1ExactNormal.html


From j.l.h.hartmann at uva.nl  Thu Jan 17 09:10:40 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Thu, 17 Jan 2013 18:10:40 +0100
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <kc4be0$uch$2@ger.gmane.org>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
Message-ID: <50F83090.6070708@uva.nl>

(Sorry for crossposting, don't know if it is a gdal or proj problem )

This has been discussed on this list some time ago. I have been able to 
create a working nadgrid file with gdal, but it doesn't return the right 
coordinates. I did it as follows:

- create a 4 band, float32 geotif, each pixel with the displacements in 
lat, lon (arcseconds), errorx and errory (both zero)
- gdal-translate it to ntv2-format.

The displacements in the geotiff are correct, and proj returns shifted 
coordinates when using the ntv2-file, but not on the right location. I'm 
really out of my wits. Could it have something to do with ntv2 using 
negative lon-values east of Greenwich? Any help would be appreciated.

Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130117/a57c994f/attachment.html>

From molnar at sas.elte.hu  Fri Jan 18 02:43:22 2013
From: molnar at sas.elte.hu (molnar at sas.elte.hu)
Date: Fri, 18 Jan 2013 11:43:22 +0100
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <50F83090.6070708@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
Message-ID: <7586d4de08119a345659b8fdb808d167.squirrel@sas.elte.hu>

Dear Jan,
After your post, I tried to do it in the opposit way.
I used "gdal_translate" to convert my .gsb file to geotiff. (The .gsb
works perfectly with "cs2cs".)
I checked the geotiff and its location is perfect (so no obvious problem
with the negative longitude values), but the cell values are like
3.40e+38, so I expect a byte order problem.

If really this byte order problem couses the errors, maybe you can avoid it:
-- converting your .tif file first to raw binary with a "GDAL virtual
format" metadata file
-- edit the "ByteOrder" parameter from MSB to LSB or vica versa in the
.vrt metadata file
-- convert the raw binary back to geotiff
-- gdal_translate it to ntv2-format
Good luck!
Gabor



> (Sorry for crossposting, don't know if it is a gdal or proj problem )
>
> This has been discussed on this list some time ago. I have been able to
> create a working nadgrid file with gdal, but it doesn't return the right
> coordinates. I did it as follows:
>
> - create a 4 band, float32 geotif, each pixel with the displacements in
> lat, lon (arcseconds), errorx and errory (both zero)
> - gdal-translate it to ntv2-format.
>
> The displacements in the geotiff are correct, and proj returns shifted
> coordinates when using the ntv2-file, but not on the right location. I'm
> really out of my wits. Could it have something to do with ntv2 using
> negative lon-values east of Greenwich? Any help would be appreciated.
>
> Jan
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj



From jagoncal at gmail.com  Fri Jan 18 02:51:14 2013
From: jagoncal at gmail.com (=?ISO-8859-1?Q?Jose_Gon=E7alves?=)
Date: Fri, 18 Jan 2013 10:51:14 +0000
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <50F83090.6070708@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
Message-ID: <CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>

Hello

I have a program to create GSB files from two long/lat difference grids in
Surfer format.
http://www.fc.up.pt/pessoas/jagoncal/coordenadas/write_gsb.exe

You can check with it. The longitude difference in the input grid are in
the standard way (east positive).


Regards

José A. Gonçalves




2013/1/17 Jan Hartmann <j.l.h.hartmann at uva.nl>

>  (Sorry for crossposting, don't know if it is a gdal or proj problem )
>
> This has been discussed on this list some time ago. I have been able to
> create a working nadgrid file with gdal, but it doesn't return the right
> coordinates. I did it as follows:
>
> - create a 4 band, float32 geotif, each pixel with the displacements in
> lat, lon (arcseconds), errorx and errory (both zero)
> - gdal-translate it to ntv2-format.
>
> The displacements in the geotiff are correct, and proj returns shifted
> coordinates when using the ntv2-file, but not on the right location. I'm
> really out of my wits. Could it have something to do with ntv2 using
> negative lon-values east of Greenwich? Any help would be appreciated.
>
> Jan
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130118/ca0fd543/attachment.html>

From j.l.h.hartmann at uva.nl  Fri Jan 18 09:01:45 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Fri, 18 Jan 2013 18:01:45 +0100
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
Message-ID: <50F97FF9.4040804@uva.nl>

Hi Jose, Gabor, Andre,

I got Jose's program running without trouble, and the results are the 
same as what I got with gdal. So the problem is not with gdal, but there 
is something wrong with my data. I'll make a detailed use case tomorrow 
and hope you can have a look at it.

Jan

On 01/18/2013 11:51 AM, Jose Gonçalves wrote:
> Hello
>
> I have a program to create GSB files from two long/lat difference 
> grids in Surfer format.
> http://www.fc.up.pt/pessoas/jagoncal/coordenadas/write_gsb.exe
>
> You can check with it. The longitude difference in the input grid are 
> in the standard way (east positive).
>
>
> Regards
>
> José A. Gonçalves
>
>
>
>
> 2013/1/17 Jan Hartmann <j.l.h.hartmann at uva.nl 
> <mailto:j.l.h.hartmann at uva.nl>>
>
>     (Sorry for crossposting, don't know if it is a gdal or proj problem )
>
>     This has been discussed on this list some time ago. I have been
>     able to create a working nadgrid file with gdal, but it doesn't
>     return the right coordinates. I did it as follows:
>
>     - create a 4 band, float32 geotif, each pixel with the
>     displacements in lat, lon (arcseconds), errorx and errory (both zero)
>     - gdal-translate it to ntv2-format.
>
>     The displacements in the geotiff are correct, and proj returns
>     shifted coordinates when using the ntv2-file, but not on the right
>     location. I'm really out of my wits. Could it have something to do
>     with ntv2 using negative lon-values east of Greenwich? Any help
>     would be appreciated.
>
>     Jan
>
>     _______________________________________________
>     Proj mailing list
>     Proj at lists.maptools.org <mailto:Proj at lists.maptools.org>
>     http://lists.maptools.org/mailman/listinfo/proj
>
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130118/417b3900/attachment.html>

From j.l.h.hartmann at uva.nl  Sat Jan 19 06:56:11 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Sat, 19 Jan 2013 15:56:11 +0100
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <50F97FF9.4040804@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl>
Message-ID: <50FAB40B.8060100@uva.nl>

Perhaps I'm doing something stupid, perhaps it cannot be done at all 
with grid shift files. I would very much appreciate if you would have a 
look at it.

I want to rubbersheet old maps with source and destination control 
points in the same projection (epsg:28992). A test example is at

http://mapserver.sara.nl/ntv2.png

The green points are the original points, the blue points are the 
locations I want them shifted to. The shift values are in arcseconds, 
located at the WGS84 coordinates of the four original points

id |  lon    |    lat      |     dx         | dy
--+---------+-----------+-------------+--------------
  ll | 5.3876 | 52.1561 |  -52.6024 | -32.3636
  lr | 5.4022 | 52.1561 |  52.5918 | -32.3701
ur | 5.4022 | 52.1651 |  52.6448 |  32.3504
ul | 5.3876 | 52.1651 | -52.63421 |  32.3561

I created a regular grid with gdal_grid, covering both source and 
destination points, and with these four points as seeds. Then I 
converted that grid to ntv2 format, both with gdal and Jose's program. 
The grid and ntv2 files have correct values at the correct locations.

I would expect that a command like the following:

cs2cs +proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 
+k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs 
+nadgrids=@null \
     +to +proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 
+k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs 
+nadgrids=test_shift.ntv2

would convert source coordinates to destination, but no way. The best I 
get are the red points.

Is the idea correct? If so, how do I get it to work?

Thanks in advance,

Jan



On 01/18/2013 06:01 PM, Jan Hartmann wrote:
> Hi Jose, Gabor, Andre,
>
> I got Jose's program running without trouble, and the results are the 
> same as what I got with gdal. So the problem is not with gdal, but 
> there is something wrong with my data. I'll make a detailed use case 
> tomorrow and hope you can have a look at it.
>
> Jan
>
> On 01/18/2013 11:51 AM, Jose Gonçalves wrote:
>> Hello
>>
>> I have a program to create GSB files from two long/lat difference 
>> grids in Surfer format.
>> http://www.fc.up.pt/pessoas/jagoncal/coordenadas/write_gsb.exe
>>
>> You can check with it. The longitude difference in the input grid are 
>> in the standard way (east positive).
>>
>>
>> Regards
>>
>> José A. Gonçalves
>>
>>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130119/32002158/attachment.html>

From andre+joost at nurfuerspam.de  Sun Jan 20 10:28:17 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Sun, 20 Jan 2013 19:28:17 +0100
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <50FAB40B.8060100@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
Message-ID: <kdhd1b$bnm$1@ger.gmane.org>

Hi,

I think I found a solution, if I have understood your test data correct:

What you have and what you want:

source:
  id |  lon   |   lat   | deg E |  deg N |   dms E  | dms N
----+--------+---------+-------+--------+----------+----------+
  ll | 5.3876 | 52.1561 | 19395 | 187762 | 5d23'15" | 52d9'22"
  lr | 5.4022 | 52.1561 | 19448 | 187762 | 5d24'08" | 52d9'22"
  ur | 5.4022 | 52.1651 | 19448 | 187794 | 5d24'08" | 52d9'54"
  ul | 5.3876 | 52.1651 | 19395 | 187794 | 5d23'15" | 52d9'54"

destination:
  id |  lon   |   lat   | deg E |  deg N |   dms E  | dms N
----+--------+---------+-------+--------+----------+----------+
  ll | 5.37299| 52.14711| 19343 | 187730 | 5d22'23" | 52d8'50"
  lr | 5.41681| 52.14711| 19501 | 187730 | 5d25'1"  | 52d8'50"
  ur | 5.41682| 52.17409| 19501 | 187826 | 5d25'1"  | 52d10'27"
  ul | 5.37298| 52.17409| 19343 | 187826 | 5d22'23" | 52d10'27"

I expanded the data a bit:
S 52.13811°N =187697"N
N 52.18309°N =187859"N
E -5.43142°E =-19553"E
W -5.35838°E =-19290"E
with zero values for the border cells

My ASCII ntv2 file has the following header:

NUM_OREC 11
NUM_SREC 11
NUM_FILE  1
GS_TYPE SECONDS
VERSION
SYSTEM_F
SYSTEM_T
MAJOR_F        0.000
MINOR_F        0.000
MAJOR_T        0.000
MINOR_T        0.000
SUB_NAME
PARENT  NONE
CREATED
UPDATED
S_LAT     187697.000000
N_LAT     187859.000000
E_LONG    -19553.000000
W_LONG    -19290.000000
LAT_INC       32.400000
LONG_INC      52.600000
GS_COUNT    36

dx and dy are swapped in the file, upper right first, and dx values 
inverted:
-32.370100 -52.59180  0.000000  0.000000
-32.363600 52.602400  0.000000  0.000000
   32.35040 -52.64480  0.000000  0.000000
   32.35610 52.634210  0.000000  0.000000
(and a lot of null value lines between)

Converted with GDAy, because the old GDAit won't run on Windows 7 
anymore :-(

For cs2cs, I made an input file with your WGS84 values, and used 
Amersfoort lat/lon instead of the projected CRS.

Put the following in a batch file:

echo epsg4326 RDgrid.txt >out.txt
cs2cs +init=epsg:4326 +to +proj=longlat +ellps=bessel 
+nadgrids=D:\Karten\gdal\ntv2\RD.gsb +no_defs RD-grid.txt >>out.txt

echo Amersf ll nowgs84 - grid >>out.txt
cs2cs +proj=longlat +ellps=bessel +towgs84=0,0,0,0,0,0,0 +no_defs +to 
+proj=longlat +ellps=bessel +nadgrids=D:\Karten\gdal\ntv2\RD.gsb 
+no_defs RD-grid.txt >>out.txt

echo Amersf ll - grid >>out.txt
cs2cs +proj=longlat +ellps=bessel 
+towgs84=565.417,50.3319,465.552,-0.398957,0.343988,-1.8774,4.0725 
+no_defs +to +proj=longlat +ellps=bessel 
+nadgrids=D:\Karten\gdal\ntv2\RD.gsb +no_defs RD-grid.txt >>out.txt

echo grid -   Amersf ll nowgs84 >>out.txt
cs2cs +proj=longlat +ellps=bessel +nadgrids=D:\Karten\gdal\ntv2\RD.gsb 
+no_defs +to +proj=longlat +ellps=bessel +towgs84=0,0,0,0,0,0,0 +no_defs 
RD-grid.txt >>out.txt

echo grid 2 Amersf ll >>out.txt
cs2cs +proj=longlat +ellps=bessel +nadgrids=D:\Karten\gdal\ntv2\RD.gsb 
+no_defs +to +proj=longlat +ellps=bessel 
+towgs84=565.417,50.3319,465.552,-0.398957,0.343988,-1.8774,4.0725 
+no_defs RD-grid.txt >>out.txt

gives this result:
epsg4326 RDgrid.txt
5d23'15.36"E	52d9'21.96"N 0.000
5d24'7.92"E	52d9'21.96"N 0.000
5d24'7.92"E	52d9'54.36"N 0.000
5d23'15.36"E	52d9'54.36"N 0.000
Amersf ll nowgs84 - grid
5d23'15.36"E	52d9'24.046"N -698.431
5d24'7.92"E	52d9'24.046"N -698.431
5d24'7.92"E	52d9'56.446"N -698.420
5d23'15.36"E	52d9'56.446"N -698.420
Amersf ll - grid
5d23'13.793"E	52d9'18.402"N 43.347
5d24'6.345"E	52d9'18.402"N 43.346
5d24'6.345"E	52d9'50.798"N 43.331
5d23'13.793"E	52d9'50.799"N 43.331
grid -   Amersf ll nowgs84
5d22'23.077"E	52d8'47.83"N 698.441
5d25'0.512"E	52d8'47.823"N 698.441
5d25'0.565"E	52d10'24.624"N 698.411
5d22'23.046"E	52d10'24.63"N 698.411
grid 2 Amersf ll
5d22'24.637"E	52d8'53.47"N -43.360
5d25'2.095"E	52d8'53.464"N -43.359
5d25'2.148"E	52d10'30.276"N -43.313
5d22'24.606"E	52d10'30.282"N -43.314

Compared to the start, the "grid 2 Amersfoort" is the way to get the 
desired coordinates. Don't ask me why...

Maybe a case of "If you give me rubbish, I do nothing"-behaviour of proj.

HTH,
André Joost





From j.l.h.hartmann at uva.nl  Mon Jan 21 03:30:18 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Mon, 21 Jan 2013 12:30:18 +0100
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <kdhd1b$bnm$1@ger.gmane.org>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org>
Message-ID: <50FD26CA.2090805@uva.nl>

Hi Andre, could you send me the gsb-file you made, so I can have a look 
at the coordinates and values?

Jan

On 01/20/2013 07:28 PM, Andre Joost wrote:
> Hi,
>
> I think I found a solution, if I have understood your test data correct:
>
> What you have and what you want:
>
> source:
>    id |  lon   |   lat   | deg E |  deg N |   dms E  | dms N
> ----+--------+---------+-------+--------+----------+----------+
>    ll | 5.3876 | 52.1561 | 19395 | 187762 | 5d23'15" | 52d9'22"
>    lr | 5.4022 | 52.1561 | 19448 | 187762 | 5d24'08" | 52d9'22"
>    ur | 5.4022 | 52.1651 | 19448 | 187794 | 5d24'08" | 52d9'54"
>    ul | 5.3876 | 52.1651 | 19395 | 187794 | 5d23'15" | 52d9'54"
>
> destination:
>    id |  lon   |   lat   | deg E |  deg N |   dms E  | dms N
> ----+--------+---------+-------+--------+----------+----------+
>    ll | 5.37299| 52.14711| 19343 | 187730 | 5d22'23" | 52d8'50"
>    lr | 5.41681| 52.14711| 19501 | 187730 | 5d25'1"  | 52d8'50"
>    ur | 5.41682| 52.17409| 19501 | 187826 | 5d25'1"  | 52d10'27"
>    ul | 5.37298| 52.17409| 19343 | 187826 | 5d22'23" | 52d10'27"
>
> I expanded the data a bit:
> S 52.13811°N =187697"N
> N 52.18309°N =187859"N
> E -5.43142°E =-19553"E
> W -5.35838°E =-19290"E
> with zero values for the border cells
>
> My ASCII ntv2 file has the following header:
>
> NUM_OREC 11
> NUM_SREC 11
> NUM_FILE  1
> GS_TYPE SECONDS
> VERSION
> SYSTEM_F
> SYSTEM_T
> MAJOR_F        0.000
> MINOR_F        0.000
> MAJOR_T        0.000
> MINOR_T        0.000
> SUB_NAME
> PARENT  NONE
> CREATED
> UPDATED
> S_LAT     187697.000000
> N_LAT     187859.000000
> E_LONG    -19553.000000
> W_LONG    -19290.000000
> LAT_INC       32.400000
> LONG_INC      52.600000
> GS_COUNT    36
>
> dx and dy are swapped in the file, upper right first, and dx values
> inverted:
> -32.370100 -52.59180  0.000000  0.000000
> -32.363600 52.602400  0.000000  0.000000
>     32.35040 -52.64480  0.000000  0.000000
>     32.35610 52.634210  0.000000  0.000000
> (and a lot of null value lines between)
>
> Converted with GDAy, because the old GDAit won't run on Windows 7
> anymore :-(
>
> For cs2cs, I made an input file with your WGS84 values, and used
> Amersfoort lat/lon instead of the projected CRS.
>
> Put the following in a batch file:
>
> echo epsg4326 RDgrid.txt >out.txt
> cs2cs +init=epsg:4326 +to +proj=longlat +ellps=bessel
> +nadgrids=D:\Karten\gdal\ntv2\RD.gsb +no_defs RD-grid.txt >>out.txt
>
> echo Amersf ll nowgs84 - grid >>out.txt
> cs2cs +proj=longlat +ellps=bessel +towgs84=0,0,0,0,0,0,0 +no_defs +to
> +proj=longlat +ellps=bessel +nadgrids=D:\Karten\gdal\ntv2\RD.gsb
> +no_defs RD-grid.txt >>out.txt
>
> echo Amersf ll - grid >>out.txt
> cs2cs +proj=longlat +ellps=bessel
> +towgs84=565.417,50.3319,465.552,-0.398957,0.343988,-1.8774,4.0725
> +no_defs +to +proj=longlat +ellps=bessel
> +nadgrids=D:\Karten\gdal\ntv2\RD.gsb +no_defs RD-grid.txt >>out.txt
>
> echo grid -   Amersf ll nowgs84 >>out.txt
> cs2cs +proj=longlat +ellps=bessel +nadgrids=D:\Karten\gdal\ntv2\RD.gsb
> +no_defs +to +proj=longlat +ellps=bessel +towgs84=0,0,0,0,0,0,0 +no_defs
> RD-grid.txt >>out.txt
>
> echo grid 2 Amersf ll >>out.txt
> cs2cs +proj=longlat +ellps=bessel +nadgrids=D:\Karten\gdal\ntv2\RD.gsb
> +no_defs +to +proj=longlat +ellps=bessel
> +towgs84=565.417,50.3319,465.552,-0.398957,0.343988,-1.8774,4.0725
> +no_defs RD-grid.txt >>out.txt
>
> gives this result:
> epsg4326 RDgrid.txt
> 5d23'15.36"E	52d9'21.96"N 0.000
> 5d24'7.92"E	52d9'21.96"N 0.000
> 5d24'7.92"E	52d9'54.36"N 0.000
> 5d23'15.36"E	52d9'54.36"N 0.000
> Amersf ll nowgs84 - grid
> 5d23'15.36"E	52d9'24.046"N -698.431
> 5d24'7.92"E	52d9'24.046"N -698.431
> 5d24'7.92"E	52d9'56.446"N -698.420
> 5d23'15.36"E	52d9'56.446"N -698.420
> Amersf ll - grid
> 5d23'13.793"E	52d9'18.402"N 43.347
> 5d24'6.345"E	52d9'18.402"N 43.346
> 5d24'6.345"E	52d9'50.798"N 43.331
> 5d23'13.793"E	52d9'50.799"N 43.331
> grid -   Amersf ll nowgs84
> 5d22'23.077"E	52d8'47.83"N 698.441
> 5d25'0.512"E	52d8'47.823"N 698.441
> 5d25'0.565"E	52d10'24.624"N 698.411
> 5d22'23.046"E	52d10'24.63"N 698.411
> grid 2 Amersf ll
> 5d22'24.637"E	52d8'53.47"N -43.360
> 5d25'2.095"E	52d8'53.464"N -43.359
> 5d25'2.148"E	52d10'30.276"N -43.313
> 5d22'24.606"E	52d10'30.282"N -43.314
>
> Compared to the start, the "grid 2 Amersfoort" is the way to get the
> desired coordinates. Don't ask me why...
>
> Maybe a case of "If you give me rubbish, I do nothing"-behaviour of proj.
>
> HTH,
> André Joost
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130121/d1ecde05/attachment.html>

From j.l.h.hartmann at uva.nl  Mon Jan 21 03:36:23 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Mon, 21 Jan 2013 12:36:23 +0100
Subject: [Proj] Creating a nadgrid shift file
In-Reply-To: <CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
Message-ID: <50FD2837.8000207@uva.nl>

Hi Jose, I can produce a working gsb file, but somehow the coordinate 
range is wrong. It must have something to do with the way the base grids 
are produced with gdal-grid. Could you give me an example of working 
long/lat distance grids (surfer is OK), and the way you made them?

Jan

On 01/18/2013 11:51 AM, Jose Gonçalves wrote:
> Hello
>
> I have a program to create GSB files from two long/lat difference 
> grids in Surfer format.
> http://www.fc.up.pt/pessoas/jagoncal/coordenadas/write_gsb.exe
>
> You can check with it. The longitude difference in the input grid are 
> in the standard way (east positive).
>
>
> Regards
>
> José A. Gonçalves
>
>
>
>
> 2013/1/17 Jan Hartmann <j.l.h.hartmann at uva.nl 
> <mailto:j.l.h.hartmann at uva.nl>>
>
>     (Sorry for crossposting, don't know if it is a gdal or proj problem )
>
>     This has been discussed on this list some time ago. I have been
>     able to create a working nadgrid file with gdal, but it doesn't
>     return the right coordinates. I did it as follows:
>
>     - create a 4 band, float32 geotif, each pixel with the
>     displacements in lat, lon (arcseconds), errorx and errory (both zero)
>     - gdal-translate it to ntv2-format.
>
>     The displacements in the geotiff are correct, and proj returns
>     shifted coordinates when using the ntv2-file, but not on the right
>     location. I'm really out of my wits. Could it have something to do
>     with ntv2 using negative lon-values east of Greenwich? Any help
>     would be appreciated.
>
>     Jan
>
>     _______________________________________________
>     Proj mailing list
>     Proj at lists.maptools.org <mailto:Proj at lists.maptools.org>
>     http://lists.maptools.org/mailman/listinfo/proj
>
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130121/3baffe86/attachment.html>

From j.l.h.hartmann at uva.nl  Mon Jan 21 06:12:00 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Mon, 21 Jan 2013 15:12:00 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <kdhd1b$bnm$1@ger.gmane.org>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org>
Message-ID: <50FD4CB0.7060400@uva.nl>

This is the solution, thanks Andre.


On 01/20/2013 07:28 PM, Andre Joost wrote:


> dx values inverted:

To summarize: creating an ntv2 file with gdal utilities:

Let's say you have a list of coordinates in a non-wgs84 projection, and 
a list of the same locations in wgs84. You want to create an ntv2-file 
to shift from one to the other.

1) transfer the original coordinates to latlon, without a wgs84 shift
2) compute for each point the distance in degrees between the wgs84 
location and the original latlon-location
3) separate the distance in its lon and lat component, and multiply both 
numbers by 3600
4) invert the lon-value (<==== this was the problem)
5) create two point files, one for the lons and one for the lats. The 
coordinates should be the wgs84 values, and the z-value the lon or lat. 
Look on the gdal_grid page how to create a vrt-version, it's also 
possible with postgis or any other ogr-format. Create also a point-file 
with the same coordinates and all z-values set to zero
6) create for these three point-files each a gridded raster with 
gdal_grid. Set reasonable boundaries in wgs84 with -txe and -ty, and 
choose output format Float32
7) merge the grids into a four-band geotif: gdal_merge -separate -o 
<shiftgrid> <latgrid> <longrid> <zerogrid> <zerogrid>. Mind the order: 
lat first
8) invert the y-direction in <shiftgrid>: gdalwarp <shiftgrid> 
<new_shiftgrid> (<=== this was another problem. Is this a bug?)
9) convert to ntv2: gdal_translate <new_shiftgrid> <ntv2_grid>

I would appreciate if someone would test the procedure on their own 
data, and if it works, to add it to the documentation.

Thanks for all your help!

Jan

PS I fully agree with Gerald Evenden on the reversal of the lon-values 
in the ntv2-format

http://osgeo-org.1560.n6.nabble.com/NTv2-info-td3842825.html

I seem to get the idea that the Canadians developed this format---comments
please---and if they did then the designers deserve to be flogged for 8 
days
with wet noodles for "positive east longitude."  I can't believe it!!!! 
  What
is unbelievable arrogance by whoever had that stupid---yes, *VERY*
stupid---idea.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130121/6d52ec1d/attachment.html>

From andre+joost at nurfuerspam.de  Mon Jan 21 07:42:42 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Mon, 21 Jan 2013 16:42:42 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FD4CB0.7060400@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
Message-ID: <kdjovd$2a9$3@ger.gmane.org>

Am 21.01.2013 15:12, schrieb Jan Hartmann:
> This is the solution, thanks Andre.

Glad I could help!

> To summarize: creating an ntv2 file with gdal utilities:
>
> Let's say you have a list of coordinates in a non-wgs84 projection, and
> a list of the same locations in wgs84. You want to create an ntv2-file
> to shift from one to the other.
>
> 1) transfer the original coordinates to latlon, without a wgs84 shift

Why that? If you want to use the self-defined CRS in Qgis, it should 
better be in "real" WGS84 coordinates, that is with the +towgs84 
parameters. After all, its the position of the bessel ellipsoid relative 
to the WGS84 ellipsoid we now all reference to. Your old CRS may have 
the same position, though.

> 2) compute for each point the distance in degrees between the wgs84
> location and the original latlon-location
... or take the values our ancestors have already computed long time 
ago, or the raster printed on the map. If the data is in meters, 
transform them like normal on the same ellipsoid.

> 3) separate the distance in its lon and lat component, and multiply both
> numbers by 3600
> 4) invert the lon-value (<==== this was the problem)

We should better say: exchange the sign. Not to conflict wih 1/x 
computation.

> 5) create two point files, one for the lons and one for the lats. The
> coordinates should be the wgs84 values, and the z-value the lon or lat.
> Look on the gdal_grid page how to create a vrt-version, it's also
> possible with postgis or any other ogr-format. Create also a point-file
> with the same coordinates and all z-values set to zero
> 6) create for these three point-files each a gridded raster with
> gdal_grid. Set reasonable boundaries in wgs84 with -txe and -ty, and
> choose output format Float32

Make sure all your data is within the boundaries, otherwise no shift is 
applied. ntv2 does no extrapolation, not even for a millimeter offset...

> 7) merge the grids into a four-band geotif: gdal_merge -separate -o
> <shiftgrid> <latgrid> <longrid> <zerogrid> <zerogrid>. Mind the order:
> lat first
> 8) invert the y-direction in <shiftgrid>: gdalwarp <shiftgrid>
> <new_shiftgrid> (<=== this was another problem. Is this a bug?)

I think there should be any kind of operation? Otherwise it should be 
done from the start. Just think of West being positive.


> 9) convert to ntv2: gdal_translate <new_shiftgrid> <ntv2_grid>
>
> I would appreciate if someone would test the procedure on their own
> data,

I will do in the near future with old maps from Germany.

> and if it works, to add it to the documentation.
Is there any, and where?


> PS I fully agree with Gerald Evenden on the reversal of the lon-values
> in the ntv2-format
>
> http://osgeo-org.1560.n6.nabble.com/NTv2-info-td3842825.html
>
> I seem to get the idea that the Canadians developed this format---comments
> please---and if they did then the designers deserve to be flogged for 8
> days
> with wet noodles for "positive east longitude." I can't believe it!!!! What
> is unbelievable arrogance by whoever had that stupid---yes, *VERY*
> stupid---idea.
>

Well, they did not forsee to have it be used world wide...

Greetings,
André Joost




From j.l.h.hartmann at uva.nl  Mon Jan 21 08:41:30 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Mon, 21 Jan 2013 17:41:30 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <kdjovd$2a9$3@ger.gmane.org>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
	<kdjovd$2a9$3@ger.gmane.org>
Message-ID: <50FD6FBA.1010506@uva.nl>

All excellent remarks, but I'm not sure of nr 1

On 01/21/2013 04:42 PM, Andre Joost wrote:
> 1) transfer the original coordinates to latlon, without a wgs84 shift
> Why that? If you want to use the self-defined CRS in Qgis, it should
> better be in "real" WGS84 coordinates, that is with the +towgs84
> parameters. After all, its the position of the bessel ellipsoid relative
> to the WGS84 ellipsoid we now all reference to. Your old CRS may have
> the same position, though.
>
>
The shift is from the original ellipsoid to wgs84, so I think the 
distances should be computed from different ellipses. I'l try it out 
next few days.

If you want, I could send you the proj parameters for the Tranchot-map, 
together with the 48 original triangulation points, both in the original 
coordinate system and Gauss-Krüger II, as computed by Rodulf Schmidt in 
1973. You can see a rough georeference (without shifts) at 
http://mapserver.sara.nl/zl/, and the way it did it on: 
http://mapserver/conferences/2007/berlin_fossgis/. I'm certainly going 
to compute a shift file for it, when I get time for it, but if you want 
to try your hand on it, you are very welcome.

Jan
<http://mapserver.sara.nl/zl/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130121/dba3231b/attachment.html>

From peifer at gmx.eu  Mon Jan 21 11:21:30 2013
From: peifer at gmx.eu (Hermann Peifer)
Date: Mon, 21 Jan 2013 17:21:30 -0200
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FD4CB0.7060400@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
Message-ID: <50FD953A.9020000@gmx.eu>

On 2013-01-21 12:12, Jan Hartmann wrote:
>
> To summarize: creating an ntv2 file with gdal utilities:
>
> Let's say you have a list of coordinates in a non-wgs84 projection, and
> a list of the same locations in wgs84. You want to create an ntv2-file
> to shift from one to the other.
>
> 1) transfer the original coordinates to latlon, without a wgs84 shift
> 2) compute for each point the distance in degrees between the wgs84
> location and the original latlon-location
> 3) separate the distance in its lon and lat component, and multiply both
> numbers by 3600
> 4) invert the lon-value (<==== this was the problem)
> 5) create two point files, one for the lons and one for the lats. The
> coordinates should be the wgs84 values, and the z-value the lon or lat.
> Look on the gdal_grid page how to create a vrt-version, it's also
> possible with postgis or any other ogr-format. Create also a point-file
> with the same coordinates and all z-values set to zero
> 6) create for these three point-files each a gridded raster with
> gdal_grid. Set reasonable boundaries in wgs84 with -txe and -ty, and
> choose output format Float32
> 7) merge the grids into a four-band geotif: gdal_merge -separate -o
> <shiftgrid> <latgrid> <longrid> <zerogrid> <zerogrid>. Mind the order:
> lat first
> 8) invert the y-direction in <shiftgrid>: gdalwarp <shiftgrid>
> <new_shiftgrid> (<=== this was another problem. Is this a bug?)
> 9) convert to ntv2: gdal_translate <new_shiftgrid> <ntv2_grid>
>
> I would appreciate if someone would test the procedure on their own
> data, and if it works, to add it to the documentation.
>
> Thanks for all your help!
>

I just successfully tested your procedure using the 31 test points given 
in BETA2007testdaten.csv [1].

And indeed: it is somewhat puzzling that one has to do step 8. I 
"solved" the issue by defining the grid's Y extents as:

gdal_grid (...) -tye ymax ymin # rather than providing the values in the 
documented order: -tye ymin ymax

Wild guess: This looks to me like a bug in gdal_grid.cpp, perhaps around 
line 1000.

Hermann

[1] http://crs.bkg.bund.de/crseu/crs/descrtrans/BeTA/BETA2007testdaten.csv



From j.l.h.hartmann at uva.nl  Tue Jan 22 01:21:43 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Tue, 22 Jan 2013 10:21:43 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FD953A.9020000@gmx.eu>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
	<50FD953A.9020000@gmx.eu>
Message-ID: <50FE5A27.8090304@uva.nl>


On 01/21/2013 08:21 PM, Hermann Peifer wrote:
>
> I just successfully tested your procedure using the 31 test points 
> given in BETA2007testdaten.csv [1]. And indeed: it is somewhat 
> puzzling that one has to do step 8. I "solved" the issue by defining 
> the grid's Y extents as: gdal_grid (...) -tye ymax ymin # rather than 
> providing the values in the documented order: -tye ymin ymax. Wild 
> guess: This looks to me like a bug in gdal_grid.cpp, perhaps around 
> line 1000.
>
> Hermann
>
> [1] 
> http://crs.bkg.bund.de/crseu/crs/descrtrans/BeTA/BETA2007testdaten.csv
>
Good to hear!

It would be interesting to compare the grid you produced with the 
official BETA2007 grid. From what I know, those grids are made from a 
few real measurements, that are interpolated to a grid. Of course there 
are many interpolation methods. The default one for gdal_grid is inverse 
distance squared, but more advanced geostatistical methods (kriging?)  
could be more appropriate for these data. As we are talking about 
accuracies in the centimeter domain, the choice of method could be 
important. With these gdal procedures, testing them has become really 
simple.

Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130122/056587c1/attachment.html>

From j.l.h.hartmann at uva.nl  Tue Jan 22 03:14:25 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Tue, 22 Jan 2013 12:14:25 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FE70D8.7010406@uva.nl>
References: <50FE70D8.7010406@uva.nl>
Message-ID: <50FE7491.9010305@uva.nl>

I forward this mail from Hermann Peifer, about the differences between 
the official German grid shift file, and the one computed by gdal 
utilities based on 31 test points. It's a matter of different 
interpolation methods. Can anyone comment on this pretended accuracy of 
the official grid shift files, and about the interpolation methods used, 
in Germany or elsewhere?

Jan


On 01/22/2013 11:30 AM, Hermann Peifer wrote:
>
> As far as I can see: the agreement between "myshift.gsb" and 
> BETA2007.gsb is only in the immediate neighbourhood of the 31 test 
> points. For these points, the differences are below .5 millimeter.
>
> For the interpolated areas in between, there is no real agreement 
> between "myshift.gsb" and BETA2007.gsb. Which is no surprise, as the 
> official data might be interpolated using different methods and to my 
> knowledge, the interpolation has also been done differently for the 
> ex-GDR area compared to the area of former West-Germany.
>
This is important.What were those methods? The official grid-shift file 
pretends to a certain accuracy. How valid is that pretension, when 
different interpolations result in such different results? And two 
different interpolations are certainly inacceptable. Mind again: the 
pretended accuracy is several decimals behind the point. This doesn't 
make any sense, neither scientific nor in real world geodesy, if the 
interpolation method is that instable.

Jan



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130122/59173fe0/attachment.html>

From j.l.h.hartmann at uva.nl  Tue Jan 22 05:44:49 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Tue, 22 Jan 2013 14:44:49 +0100
Subject: [Proj] Polyhedric projection
In-Reply-To: <50D467C2.6010308@uva.nl>
References: <50BFE448.5070409@pobox.com> <k9sh2i$9f0$1@ger.gmane.org>
	<CA+YzLBcUG66Qdek9vhAAoqmuCBkD=x0Pi+UsXopOcN-eXDpK1g@mail.gmail.com>
	<50D467C2.6010308@uva.nl>
Message-ID: <50FE97D1.8030509@uva.nl>

What happens when I georeference all those polyhedric maps, by just 
rubbersheeting them with the lat-lon coordinates written at the corners 
as control points? This will give me a seamless map, but how great would 
the distortion be? Is there a better way to get a seamless map?

Jan

On 12/26/2012 11:38 PM, Clifford J Mugnier wrote:
>

Jan,

No, it is not possible to generate a correct global map using PROJ or any other application using the Polyhedric (Polyeder) projection.
It's an Aphylactic projection; not conformal, not azimuthal, not equal-area/authalic.
It IS easy to cast graphically from simple projection tables, which is why Aphylactics were popular in the 19th century by Topographers using plane tables and alidades in the field.  (Same goes for the Cassini-Soldner and the Polyconic.)

On 12/21/2012 02:44 PM, Jan Hartmann wrote:
> Hi all,
>
> I'm working with a large bunch of maps of Indonesia, dating from the 
> Dutch colonial period (1850-1946). Quite a few are in the so-called 
> "polyhedral" projection, a simple projection that fits the globe 
> locally for each separate map sheet. Works fine for a few sheets, but 
> for larger surfaces it is impossible to generate a fitting map. Has 
> anyone worked with this projection? Is it possible to generate a 
> correct global map using proj?
>
> Jan
>
>
> See this passage in Snyder's book:
>
> http://books.google.nl/books?id=0UzjTJ4w9yEC&pg=PA142&lpg=PA142&dq=polyhedric+projection&source=bl&ots=ZaeVIBxxA3&sig=Q437Wqb99b862kaqSYMRBTNS9f8&hl=nl&sa=X&ei=0WPUUPR0gaiEB7fjgKAE&ved=0CFwQ6AEwBg#v=onepage&q=polyhedric%20projection&f=false
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130122/497c01d0/attachment.html>

From uwe.schmitz at bezreg-koeln.nrw.de  Tue Jan 22 06:38:50 2013
From: uwe.schmitz at bezreg-koeln.nrw.de (Schmitz, Uwe)
Date: Tue, 22 Jan 2013 14:38:50 +0000
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FE7491.9010305@uva.nl>
References: <50FE70D8.7010406@uva.nl> <50FE7491.9010305@uva.nl>
Message-ID: <1A8DF958A1AA1E46BDDB48C08CB0DD003252DCAB@MAIL-V.bezreg-koeln.nrw.de>

Jan, 

> I forward this mail from Hermann Peifer, about the 
> differences between the official German grid shift file, and 
> the one computed by gdal utilities based on 31 test points. 
> It's a matter of different interpolation methods. Can anyone 
> comment on this pretended accuracy of the official grid shift 
> files, and about the interpolation methods used, in Germany 
> or elsewhere?
> 
I was involved in the process of creating the
BeTA2007 grid as a member of the (AdV-)working group.

So let me try to shed some light on this.

The resulting BeTA2007 grid is (as Hermann mentioned)
*not* created using one standalone interpolation/transformation 
method.
It's an amalgamation of the most suitable sub-grids
used by the individual federal states (Bundeslaender).
Each subgrid has been calculated by using the method
which was preferred by the indiviual state.
The subgrids were then "composed" to a country 
wide grid, using a special algorithm to average
the differences at state boundaries.

Not enough, there have been additional constraints to
preserve. So it's not unusual that a grid, computed
based on some arbitrary chosen test data, has nothing
to do with something obtained through the above
outlined process.

The test data is only meant for verifying 
implementations and to ensure, that an unknown
software is doing a good job ;-)

Hope that helps a little bit in understanding
BeTA2007.

Uwe


From j.l.h.hartmann at uva.nl  Tue Jan 22 07:09:19 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Tue, 22 Jan 2013 16:09:19 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <1A8DF958A1AA1E46BDDB48C08CB0DD003252DCAB@MAIL-V.bezreg-koeln.nrw.de>
References: <50FE70D8.7010406@uva.nl> <50FE7491.9010305@uva.nl>
	<1A8DF958A1AA1E46BDDB48C08CB0DD003252DCAB@MAIL-V.bezreg-koeln.nrw.de>
Message-ID: <50FEAB9F.9070400@uva.nl>

That's clear, thanks for the information.

I have two questions:

- Is there an error factor available for each data point, i.e. how 
precise are the grid shifts really?
- Are the original measurements available, to try out different 
interpolations?

Just curious for the German situation, I'm going to ask the same 
question at the Dutch topographic service. There is no ntv2 file 
available for our country, and I would like to know what happens if I 
try to create one with this method, unknow to them :-)

Jan

On 01/22/2013 03:38 PM, Schmitz, Uwe wrote:
> Jan,
>
>> I forward this mail from Hermann Peifer, about the
>> differences between the official German grid shift file, and
>> the one computed by gdal utilities based on 31 test points.
>> It's a matter of different interpolation methods. Can anyone
>> comment on this pretended accuracy of the official grid shift
>> files, and about the interpolation methods used, in Germany
>> or elsewhere?
>>
> I was involved in the process of creating the
> BeTA2007 grid as a member of the (AdV-)working group.
>
> So let me try to shed some light on this.
>
> The resulting BeTA2007 grid is (as Hermann mentioned)
> *not* created using one standalone interpolation/transformation
> method.
> It's an amalgamation of the most suitable sub-grids
> used by the individual federal states (Bundeslaender).
> Each subgrid has been calculated by using the method
> which was preferred by the indiviual state.
> The subgrids were then "composed" to a country
> wide grid, using a special algorithm to average
> the differences at state boundaries.
>
> Not enough, there have been additional constraints to
> preserve. So it's not unusual that a grid, computed
> based on some arbitrary chosen test data, has nothing
> to do with something obtained through the above
> outlined process.
>
> The test data is only meant for verifying
> implementations and to ensure, that an unknown
> software is doing a good job ;-)
>
> Hope that helps a little bit in understanding
> BeTA2007.
>
> Uwe
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130122/411430ae/attachment.html>

From andre+joost at nurfuerspam.de  Tue Jan 22 07:22:22 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Tue, 22 Jan 2013 16:22:22 +0100
Subject: [Proj] Polyhedric projection
In-Reply-To: <50FE97D1.8030509@uva.nl>
References: <50BFE448.5070409@pobox.com> <k9sh2i$9f0$1@ger.gmane.org>
	<CA+YzLBcUG66Qdek9vhAAoqmuCBkD=x0Pi+UsXopOcN-eXDpK1g@mail.gmail.com>
	<50D467C2.6010308@uva.nl> <50FE97D1.8030509@uva.nl>
Message-ID: <kdmbl9$6fe$1@ger.gmane.org>

Am 22.01.2013 14:44, schrieb Jan Hartmann:
> What happens when I georeference all those polyhedric maps, by just
> rubbersheeting them with the lat-lon coordinates written at the corners
> as control points? This will give me a seamless map, but how great would
> the distortion be? Is there a better way to get a seamless map?
>

With a ntv2 grid shift, your approach may be sucessful. And don't mind 
too much about accuracy: the paper the old maps are printed on, is not 
that accurate ;-)

Greetings,
André Joost



From andre+joost at nurfuerspam.de  Tue Jan 22 07:19:16 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Tue, 22 Jan 2013 16:19:16 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FD4CB0.7060400@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
Message-ID: <kdmbla$6fe$2@ger.gmane.org>

Am 21.01.2013 15:12, schrieb Jan Hartmann:

> 5) create two point files, one for the lons and one for the lats. The
> coordinates should be the wgs84 values, and the z-value the lon or lat.

I think you made a mistake there, or not stated it clearly.
According to the Beta2007 specification, the grid is related to the 
*source* CRS ellipsoid, that is EPSG:4289 Amersfoort latlon for 
EPSG:28991 and 28992, and EPSG:4314 DHDN for German Gauss-Krüger CRS.

The shift values are from bessel ellipsoid (or Airy, Clarke or whatever) 
to the WGS84 ellipsoid. For reprojection, an iterative solution is 
mentioned.

As far as the accuracy is concerned, ntv2 is by design accurate than 
7-parm Helmert. Simple reason is that Helmert takes the height into 
account. The height vecors of two ellipsoids are not in parallel, so 
another height gives you another lat/lon coordinate in the target 
system. ntv2 can not care about that. As approximation, the natural 
surface height is taken when shift values are made of Helmert 
transformations. And think of continental tectonic moves...

Greetings,
André Joost




From uwe.schmitz at bezreg-koeln.nrw.de  Tue Jan 22 07:55:42 2013
From: uwe.schmitz at bezreg-koeln.nrw.de (Schmitz, Uwe)
Date: Tue, 22 Jan 2013 15:55:42 +0000
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FEAB9F.9070400@uva.nl>
References: <50FE70D8.7010406@uva.nl> <50FE7491.9010305@uva.nl>
	<1A8DF958A1AA1E46BDDB48C08CB0DD003252DCAB@MAIL-V.bezreg-koeln.nrw.de>
	<50FEAB9F.9070400@uva.nl>
Message-ID: <1A8DF958A1AA1E46BDDB48C08CB0DD003252DCFE@MAIL-V.bezreg-koeln.nrw.de>

Jan, 

> That's clear, thanks for the information.
> 
> I have two questions:
> 
> - Is there an error factor available for each data point, 
> i.e. how precise are the grid shifts really?

considering the circumstances while creating the grid,
we decided against filling the "accuracy" columns
of ntv2 format.
So how precise is the grid? Well, the grid is documented
as being sub-meter accuracy, but this is much understated.
In 90% of the targeted area precision is as good as
the "best known" transformation method of each
individual state (difference <5cm). Areas around
state borders differ more, dependent on how
good the transformations of the involved neighbours 
match.

> - Are the original measurements available, to try out 
> different interpolations?
> 

At the time of creating BeTA2007 we are in luck that
another project had just collected all the data
needed for calcualting the grid shifts based on
the state transformation methods. To waste no
time we ask them for calculating the partial grids 
for us.
These grids are archived an can be brought back
if necessary.

> Just curious for the German situation, I'm going to ask the 
> same question at the Dutch topographic service. There is no 
> ntv2 file available for our country, and I would like to know 
> what happens if I try to create one with this method, unknow 
> to them :-)
> 

Here in Germany we did it, because the "usual" 
Helmert-Transformation results in errors around 2m 
at the far ends. That is to much if you like
to combine cadastral (buildings) with topographic
(roads) data. The ntv2 solution results in much 
better accuracy and can be tuned to match the 
individual solutions of the federal states.

Uwe



From j.l.h.hartmann at uva.nl  Tue Jan 22 08:11:38 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Tue, 22 Jan 2013 17:11:38 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <kdmbla$6fe$2@ger.gmane.org>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
	<kdmbla$6fe$2@ger.gmane.org>
Message-ID: <50FEBA3A.6000102@uva.nl>


On 01/22/2013 04:19 PM, Andre Joost wrote:
> Am 21.01.2013 15:12, schrieb Jan Hartmann:
>
>> 5) create two point files, one for the lons and one for the lats. The
>> coordinates should be the wgs84 values, and the z-value the lon or lat.
>
> I think you made a mistake there, or not stated it clearly.
> According to the Beta2007 specification, the grid is related to the
> *source* CRS ellipsoid, that is EPSG:4289 Amersfoort latlon for
> EPSG:28991 and 28992, and EPSG:4314 DHDN for German Gauss-Krüger CRS.
>
> The shift values are from bessel ellipsoid (or Airy, Clarke or whatever)
> to the WGS84 ellipsoid. For reprojection, an iterative solution is
> mentioned.
>
>
I think you are right (Hermann Peifer pointed out the same thing). I do 
not understand your reference to epsg:4289, though: that epsg number has 
a wgs84 shift. The original ellipsoid for Amersfoort is jus Bessel, so 
the source latlon epsg would be 4308

Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130122/a971bbb5/attachment.html>

From andre+joost at nurfuerspam.de  Tue Jan 22 09:03:22 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Tue, 22 Jan 2013 18:03:22 +0100
Subject: [Proj] *SOLVED*: Creating a nadgrid shift file with GDAL
In-Reply-To: <50FEBA3A.6000102@uva.nl>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
	<kdmbla$6fe$2@ger.gmane.org> <50FEBA3A.6000102@uva.nl>
Message-ID: <kdmgok$suh$1@ger.gmane.org>

Am 22.01.2013 17:11, schrieb Jan Hartmann:
>

> I think you are right (Hermann Peifer pointed out the same thing). I do
> not understand your reference to epsg:4289, though: that epsg number has
> a wgs84 shift. The original ellipsoid for Amersfoort is jus Bessel, so
> the source latlon epsg would be 4308

If you transform from EPSG:28991 to EPSG:4289, both have the same 
towgs84 parameters. So thats the same as calculating without any towgs84 
shift, but easier to handle with cs2cs. Its just to make clear that we 
still are on the same ellipsoid, located at the Amersfoort datum. About 
700m away from the WGS84 ellipsoids center.

Greetings,
André Joost





From j.l.h.hartmann at uva.nl  Fri Jan 25 03:49:24 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Fri, 25 Jan 2013 12:49:24 +0100
Subject: [Proj] Italian Datum
In-Reply-To: <kdmgok$suh$1@ger.gmane.org>
References: <kc1snq$fd3$1@ger.gmane.org>
	<17274071.19249561357214467594.JavaMail.support.mn@elisanet.fi>
	<20130103140257.GB16213@42.dk> <kc4be0$uch$2@ger.gmane.org>
	<50F83090.6070708@uva.nl>
	<CALHLaOTnorvUvAoHm5pxyMskjRGXRNJugW-=rZSJBs62P2VXWg@mail.gmail.com>
	<50F97FF9.4040804@uva.nl> <50FAB40B.8060100@uva.nl>
	<kdhd1b$bnm$1@ger.gmane.org> <50FD4CB0.7060400@uva.nl>
	<kdmbla$6fe$2@ger.gmane.org> <50FEBA3A.6000102@uva.nl>
	<kdmgok$suh$1@ger.gmane.org>
Message-ID: <51027144.6040509@uva.nl>

Hi all,

I'm indexing an Italian map series 1:100.000, published around 1950 on 
the basis of measurements in the first half of the 20th century. Map 
sheets are registered in lat-lon values, 30 seconds east-west 20 seconds 
north east, with Rome as central meridian (12d27'08''40). Those values 
are on the International Ellipsoid. I would like to transform those 
values to WGS84. In the Proj4 epsg file I find lots of latlon 
projections with ellps=intl and different +towgs84 parameters. I read 
Cliff Mugnier's column about Italy 
(http://www.asprs.org/a/resources/grids/08-2005-italy.pdf), but I am 
unable to find which epsg number is most appropriate for these maps. Can 
anyone help?

Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130125/3e513f8d/attachment.html>

From Mikael.Rittri at carmenta.com  Fri Jan 25 05:08:26 2013
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Fri, 25 Jan 2013 13:08:26 +0000
Subject: [Proj] Italian Datum
Message-ID: <E4AB3DD44D22854B819908379DE4AD49392D3820@SETHNWS023.carmenta.se>

Hello Jan,
I would think it is EPSG:4806, "Monte Mario (Rome)". 
If you use 

   +init=epsg:4806

this would expand to 

+proj=longlat +ellps=intl +towgs84=-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68 +pm=rome +no_defs  <>

(at least in Proj 4.8.0). The datum shift is intended for the
Italy mainland, and has accuracy 4 meters. There are other
published datum shifts designed for Sicily and Sardinia,
also with 4-meter accuracy, but if I recall correctly they
don't disagree by more than about 5 meters from the mainland
datum shift. 
    And there are several datum shifts for offshore areas 
around Italy; I haven't compared them with the mainland 
datum shift.

For a map in scale 1:100000, I think the mainland datum shift
should be okay for the entire Monte Mario area. 

Off-topic: Since about Christmas, I only get a small random 
subset of the Proj mails to my e-mail account. I don't
think it is due to my spam filter or wrong subscription
settings.
    Am I the only one with this problem?

Best regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com

-------- Original Message ---------
Jan Hartmann j.l.h.hartmann at uva.nl 
Fri Jan 25 06:49:24 EST 2013 
________________________________________
Hi all,

I'm indexing an Italian map series 1:100.000, published around 1950 on 
the basis of measurements in the first half of the 20th century. Map 
sheets are registered in lat-lon values, 30 seconds east-west 20 seconds 
north east, with Rome as central meridian (12d27'08''40). Those values 
are on the International Ellipsoid. I would like to transform those 
values to WGS84. In the Proj4 epsg file I find lots of latlon 
projections with ellps=intl and different +towgs84 parameters. I read 
Cliff Mugnier's column about Italy 
(http://www.asprs.org/a/resources/grids/08-2005-italy.pdf), but I am 
unable to find which epsg number is most appropriate for these maps. Can 
anyone help?

Jan



From j.l.h.hartmann at uva.nl  Fri Jan 25 05:47:49 2013
From: j.l.h.hartmann at uva.nl (Jan Hartmann)
Date: Fri, 25 Jan 2013 14:47:49 +0100
Subject: [Proj] Italian Datum
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49392D3820@SETHNWS023.carmenta.se>
References: <E4AB3DD44D22854B819908379DE4AD49392D3820@SETHNWS023.carmenta.se>
Message-ID: <51028D05.1030903@uva.nl>

Yes, this works. Thanks Mikael.

Jan

On 1/25/2013 2:08 PM, Mikael Rittri wrote:
> Hello Jan,
> I would think it is EPSG:4806, "Monte Mario (Rome)".
> If you use
>
>     +init=epsg:4806
>
> this would expand to
>
> +proj=longlat +ellps=intl +towgs84=-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68 +pm=rome +no_defs<>
>
> (at least in Proj 4.8.0). The datum shift is intended for the
> Italy mainland, and has accuracy 4 meters. There are other
> published datum shifts designed for Sicily and Sardinia,
> also with 4-meter accuracy, but if I recall correctly they
> don't disagree by more than about 5 meters from the mainland
> datum shift.
>      And there are several datum shifts for offshore areas
> around Italy; I haven't compared them with the mainland
> datum shift.
>
> For a map in scale 1:100000, I think the mainland datum shift
> should be okay for the entire Monte Mario area.
>
> Off-topic: Since about Christmas, I only get a small random
> subset of the Proj mails to my e-mail account. I don't
> think it is due to my spam filter or wrong subscription
> settings.
>      Am I the only one with this problem?
>
> Best regards,
>
> Mikael Rittri
> Carmenta
> Sweden
> http://www.carmenta.com
>
> -------- Original Message ---------
> Jan Hartmann j.l.h.hartmann at uva.nl
> Fri Jan 25 06:49:24 EST 2013
> ________________________________________
> Hi all,
>
> I'm indexing an Italian map series 1:100.000, published around 1950 on
> the basis of measurements in the first half of the 20th century. Map
> sheets are registered in lat-lon values, 30 seconds east-west 20 seconds
> north east, with Rome as central meridian (12d27'08''40). Those values
> are on the International Ellipsoid. I would like to transform those
> values to WGS84. In the Proj4 epsg file I find lots of latlon
> projections with ellps=intl and different +towgs84 parameters. I read
> Cliff Mugnier's column about Italy
> (http://www.asprs.org/a/resources/grids/08-2005-italy.pdf), but I am
> unable to find which epsg number is most appropriate for these maps. Can
> anyone help?
>
> Jan
>


From charles.karney at sri.com  Fri Jan 25 15:06:56 2013
From: charles.karney at sri.com (Charles Karney)
Date: Fri, 25 Jan 2013 18:06:56 -0500
Subject: [Proj] triaxial ellipsoid
In-Reply-To: <50EDA082.2000702@sri.com>
References: <951001350487547@web15h.yandex.ru> <50EDA082.2000702@sri.com>
Message-ID: <51031010.6050508@sri.com>

On 2013-01-09 11:53, Charles Karney wrote:
> Jean-Marc Baillard has coded up Jacobi's solution for geodesics on a
> triaxial ellipsoid for an HP-41 calculator, see
>
>    http://hp41programs.yolasite.com/geod3axial.php
>
> I've also written up some notes on the problem which may be of interest
>
>    http://geographiclib.sourceforge.net/1.29/triaxial.html
>
> Disclaimer: A triaxial ellipsoid approximates the earth only slightly
> better than an ellipsoid of revolution. If you are really considering
> measuring distances on the earth using a triaxial ellipsoid, you should
> also be worrying about the shape of the geoid (which essentially makes
> the geodesic problem a hopeless mess).

In the limit, when the minor semiaxis vanishes, the problem of geodesics
on a triaxial ellipsoid reduces to the problem of a billiard ball
bouncing on an elliptical table.  Billiard problems on tables of various
shapes have been thoroughly studied since the 1970s.  Searching for
"billiard ellipse" will take you to animations.  In brief:

(1) the 3 closed orbits for the ellipsoid (the 3 principal sections)
become (a) rolling around the perimeter, (b) the major axis of the
ellipse, (c) the minor axis of the ellipse.  (a) and (c) are stable;
(b) is unstable!

(2) the umbilical points are the foci of the ellipse.

(3) a circumpolar geodesic is the ball bouncing outside the foci, where
the envelope of the motion is a confocal ellipse.

(4) a transpolar geodesic is the ball bouncing between the foci, where
the envelope of the motion is a confocal hyperbola.

(5) a umbilical geodesic is the ball intersecting the foci.

Note that the billiard table is really double sided with even (resp.
odd) numbered segments corresponding to the top (resp. bottom) of the
table or ellipsoid.

   --Charles


From james at cox.cx  Mon Jan 28 22:50:03 2013
From: james at cox.cx (James Cox)
Date: Tue, 29 Jan 2013 14:50:03 +0800
Subject: [Proj] Help with a custom projection that is Transverse Mercator
	with Affine post-process
Message-ID: <CAALqcA4_tAB20djtzZm=L9pSUz342XM6u7iADQ9X8yAzZ2d7ng@mail.gmail.com>

Hi all,

I've subscribed in the hopes of tapping into a more specific group
than the general one on GIS Stack Exchange. I've also posted my
question there, I hope that's OK.

I am trying to define some of my local TMAF grids in PROJ.4 so I can
reproject points between the local grid and MGA95 and/or WGS84.

For these grids I have the MapInfo CoordSys clause which defines a lot
of parameters.
eg: “CoordSys Earth Projection”, 8, 33, 7, 117, 0, 0.9996, 500000,
10000000, 7, 0.890953, -0.455062, 2903977.24, 0.455063, 0.890954,
-6919253.68, -100000, -100000, 100000, 100000

>From the MapInfo doco I can see these parameters align to Datum,
Origin Latitude, Scale at Origin, False Easting/Northing, and the
Coefficients for the Affine Process.

What I'm having trouble with is trying to find out how to use these
coefficients when creating a new custom projection, and the parameters
in the PROJ.4 string that they could correctly map to.

Any help would be gratefully appreciated.

Cheers,
James


From Mikael.Rittri at carmenta.com  Tue Jan 29 01:02:37 2013
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Tue, 29 Jan 2013 09:02:37 +0000
Subject: [Proj] Help with a custom projection that is Transverse
 Mercator with Affine post-process
Message-ID: <E4AB3DD44D22854B819908379DE4AD49392D5148@SETHNWS023.carmenta.se>

Hello James.
Just a partial answer, I am afraid:

I don't think you can add an affine post-processing to a Proj.4 CRS definition.

For your example, the interpretation of the MapInfo CoordSys clause should be

"CoordSys Earth Projection", // Just a name (probably the wrong one in this case)
8,                   // The projection type, in this case Transverse Mercator
33,                 // The geodetic datum, in this case GRS80 (treat it like WGS84)
7,                   // length unit, in this case meter
117,                // central longitude
0,                   // central latitude
0.9996,           // scale factor
500000,          // false easting
10000000,       // false northing
7,                   // length unit for affine transformation, also meters,
0.890953, -0.455062, 2903977.24, 0.455063, 0.890954, -6919253.68,         // affine parameters A, B, C, D, E, F
-100000, -100000, 100000, 100000               // bounds

I think the basic CRS in this example can be expressed in Proj.4 as

+init=epsg:28350

which gives GDA94 / MGA zone 50, but I think you must implement the affine transformation yourself.

I got the information from http://www.sgsi.com/dnld/MapInfoPro_UserGuide_Current.pdf
but I didn't understand the meaning of the affine parameters.

And I think the 8 ought to have been 3008, maybe...

Best regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130129/af5254c1/attachment.html>

From peifer at gmx.eu  Tue Jan 29 05:54:24 2013
From: peifer at gmx.eu (Hermann Peifer)
Date: Tue, 29 Jan 2013 11:54:24 -0200
Subject: [Proj] Help with a custom projection that is Transverse
 Mercator with Affine post-process
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49392D5148@SETHNWS023.carmenta.se>
References: <E4AB3DD44D22854B819908379DE4AD49392D5148@SETHNWS023.carmenta.se>
Message-ID: <5107D490.2020201@gmx.eu>


About the meaning of the 6 parameters for the affine transformation, a 
random Internet search gave me this definition:

-------------
The six values A, B, C, D, E, F have to satisfy this formula:

AX + BY + C = X'
DX + EY + F = Y'

testdrive.mapinfo.com/techsupp/miprod.nsf/kbase_by_product/0B57EA4620B5EBF285256A010082A16A
-------------

Hermann


On 2013-01-29 7:02, Mikael Rittri wrote:
> Hello James.
>
> Just a partial answer, I am afraid:
>
> I don’t think you can add an affine post-processing to a Proj.4 CRS
> definition.
>
> For your example, the interpretation of the MapInfo CoordSys clause
> should be
>
> “CoordSys Earth Projection”, // Just a name (probably the wrong one in
> this case)
>
> 8,                  // The projection type, in this case Transverse Mercator
>
> 33,                // The geodetic datum, in this case GRS80 (treat it
> like WGS84)
>
> 7,                  // length unit, in this case meter
>
> 117,               // central longitude
>
> 0,                  // central latitude
>
> 0.9996,          // scale factor
>
> 500000,         // false easting
>
> 10000000,      // false northing
>
> 7,                  // length unit for affine transformation, also meters,
>
> 0.890953, -0.455062, 2903977.24, 0.455063, 0.890954, -6919253.68,
> // affine parameters A, B, C, D, E, F
>
> -100000, -100000, 100000, 100000               // bounds
>
> I think the basic CRS in this example can be expressed in Proj.4 as
>
> +init=epsg:28350
>
> which gives GDA94 / MGA zone 50, but I think you must implement the
> affine transformation yourself.
>
> I got the information from
> http://www.sgsi.com/dnld/MapInfoPro_UserGuide_Current.pdf
>
> but I didn’t understand the meaning of the affine parameters.
>
> And I think the 8 ought to have been 3008, maybe…
>
> Best regards,
>
> Mikael Rittri
>
> Carmenta
>
> Sweden
>
> http://www.carmenta.com
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>



From james at cox.cx  Tue Jan 29 17:22:18 2013
From: james at cox.cx (James Cox)
Date: Wed, 30 Jan 2013 09:22:18 +0800
Subject: [Proj] Help with a custom projection that is Transverse
 Mercator with Affine post-process
In-Reply-To: <E4AB3DD44D22854B819908379DE4AD49392D5148@SETHNWS023.carmenta.se>
References: <E4AB3DD44D22854B819908379DE4AD49392D5148@SETHNWS023.carmenta.se>
Message-ID: <CAALqcA5s34bb3d=oGZrMDxn8pw_ViJXc5Gbmw1Bs3RV0ZZKoQQ@mail.gmail.com>

Hi Mikael,

Thanks very much for the answer.
At least the question of whether or not the Affine process is
supported has been resolved. :)

Cheers,
James

On Tue, Jan 29, 2013 at 5:02 PM, Mikael Rittri
<Mikael.Rittri at carmenta.com> wrote:
> Hello James.
>
> Just a partial answer, I am afraid:
>
>
>
> I don’t think you can add an affine post-processing to a Proj.4 CRS
> definition.
>
>
>
> For your example, the interpretation of the MapInfo CoordSys clause should
> be
>
>
>
> “CoordSys Earth Projection”, // Just a name (probably the wrong one in this
> case)
>
> 8,                   // The projection type, in this case Transverse
> Mercator
>
> 33,                 // The geodetic datum, in this case GRS80 (treat it like
> WGS84)
>
> 7,                   // length unit, in this case meter
>
> 117,                // central longitude
>
> 0,                   // central latitude
>
> 0.9996,           // scale factor
>
> 500000,          // false easting
>
> 10000000,       // false northing
>
> 7,                   // length unit for affine transformation, also meters,
>
> 0.890953, -0.455062, 2903977.24, 0.455063, 0.890954, -6919253.68,         //
> affine parameters A, B, C, D, E, F
>
> -100000, -100000, 100000, 100000               // bounds
>
>
>
> I think the basic CRS in this example can be expressed in Proj.4 as
>
>
>
> +init=epsg:28350
>
>
>
> which gives GDA94 / MGA zone 50, but I think you must implement the affine
> transformation yourself.
>
>
>
> I got the information from
> http://www.sgsi.com/dnld/MapInfoPro_UserGuide_Current.pdf
>
> but I didn’t understand the meaning of the affine parameters.
>
>
>
> And I think the 8 ought to have been 3008, maybe…
>
>
>
> Best regards,
>
>
>
> Mikael Rittri
>
> Carmenta
>
> Sweden
>
> http://www.carmenta.com


From JAVIER.LOPEZBENITO at cgsi.asturias.org  Thu Jan 31 00:26:10 2013
From: JAVIER.LOPEZBENITO at cgsi.asturias.org (JAVIER LOPEZ BENITO)
Date: Thu, 31 Jan 2013 09:26:10 +0100
Subject: [Proj] Update Proj without effect
Message-ID: <E56DA713ADAAB54EB5C3F406A03E482F0319788C@C1EVS2.asturias.apa>

Hi there:

 

I've an issue with Proj upgrade in a SLES11 box...

 

In a fresh 8.4.12 PostGreSQL+PostGIS installation, when I run a "SELECT
PostGIS_PROJ_Version();" query, it shows 4.6.1 version. Later, I
installed Proj 4.8.0 (configure, make, make install), but the query
result is still the same.

 

When I run Proj directly from bash shell, the 4.8 version is executed
but I don't know how to "link" the PostGIS installation with the new
Proj version, without a complete PostGIS reinstallation with the
"--with-projdir" option in ./configure

 

ast:~ # proj

Rel. 4.8.0, 6 March 2012

usage: proj [ -beEfiIlormsStTvVwW [args] ] [ +opts[=arg] ] [ files ]

 

I think that there is a path problem, maybe in libraries or
executables... Someone can help me?

 

Greets

 

JL

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130131/611bb437/attachment.html>

From molnar at sas.elte.hu  Thu Jan 31 01:03:34 2013
From: molnar at sas.elte.hu (molnar at sas.elte.hu)
Date: Thu, 31 Jan 2013 10:03:34 +0100
Subject: [Proj] Help with a custom projection that is Transverse
 Mercator with Affine post-process
In-Reply-To: <CAALqcA5s34bb3d=oGZrMDxn8pw_ViJXc5Gbmw1Bs3RV0ZZKoQQ@mail.gmail.com>
References: <E4AB3DD44D22854B819908379DE4AD49392D5148@SETHNWS023.carmenta.se>
	<CAALqcA5s34bb3d=oGZrMDxn8pw_ViJXc5Gbmw1Bs3RV0ZZKoQQ@mail.gmail.com>
Message-ID: <3b8b2ca82f057cdf63fb5e5281b8d53e.squirrel@sas.elte.hu>

>From philosophical point of view of GDAL, the affine transformation  (used
for transforming image coordinates to projected coordinates) is a property
of the raster image, not of the projection itself. (Am I right?)
You can generate a simple six line text world file containing the A-F
coefficients using the coefficients:

A
D
-B
-E
C
F


You have to check the sings and probably the C and F values has to be
modified because in the world file the image coordinates are counted from
top left corner, what is probably not the case of CoordSys.

Best Regards,
Gabor


> Hi Mikael,
>
> Thanks very much for the answer.
> At least the question of whether or not the Affine process is
> supported has been resolved. :)
>
> Cheers,
> James
>
> On Tue, Jan 29, 2013 at 5:02 PM, Mikael Rittri
> <Mikael.Rittri at carmenta.com> wrote:
>> Hello James.
>>
>> Just a partial answer, I am afraid:
>>
>>
>>
>> I dont think you can add an affine post-processing to a Proj.4 CRS
>> definition.
>>
>>
>>
>> For your example, the interpretation of the MapInfo CoordSys clause
>> should
>> be
>>
>>
>>
>> CoordSys Earth Projection, // Just a name (probably the wrong one in
>> this
>> case)
>>
>> 8,                   // The projection type, in this case Transverse
>> Mercator
>>
>> 33,                 // The geodetic datum, in this case GRS80 (treat it
>> like
>> WGS84)
>>
>> 7,                   // length unit, in this case meter
>>
>> 117,                // central longitude
>>
>> 0,                   // central latitude
>>
>> 0.9996,           // scale factor
>>
>> 500000,          // false easting
>>
>> 10000000,       // false northing
>>
>> 7,                   // length unit for affine transformation, also
>> meters,
>>
>> 0.890953, -0.455062, 2903977.24, 0.455063, 0.890954, -6919253.68,
>>  //
>> affine parameters A, B, C, D, E, F
>>
>> -100000, -100000, 100000, 100000               // bounds
>>
>>
>>
>> I think the basic CRS in this example can be expressed in Proj.4 as
>>
>>
>>
>> +init=epsg:28350
>>
>>
>>
>> which gives GDA94 / MGA zone 50, but I think you must implement the
>> affine
>> transformation yourself.
>>
>>
>>
>> I got the information from
>> http://www.sgsi.com/dnld/MapInfoPro_UserGuide_Current.pdf
>>
>> but I didnt understand the meaning of the affine parameters.
>>
>>
>>
>> And I think the 8 ought to have been 3008, maybe

>>
>>
>>
>> Best regards,
>>
>>
>>
>> Mikael Rittri
>>
>> Carmenta
>>
>> Sweden
>>
>> http://www.carmenta.com
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>



From s.n.g at gmx.com  Thu Jan 31 07:57:55 2013
From: s.n.g at gmx.com (Stephane Goldstein)
Date: Thu, 31 Jan 2013 16:57:55 +0100
Subject: [Proj] Define custom proj4 CRS
Message-ID: <20130131155755.23310@gmx.com>

Hello.

 I have a vectorized version of a map from the Ilhabela http://www.openstreetmap.org/?lat=-23.845&lon=-45.343&zoom=11&layers=M  island in Brazil, dating from 1975.

 I could not find in QGIS the corresponding CRS, so I want to establish it based on the information that is in the PDF version of the map:

 Universal Transverse Mercator Projection

 Units are in kilometers, starting 10.000 km south of the equator (around de south pole), counting towards the north.

 and 500 km west from the 45º W meridian, couting towards the east.

 Horizontal Datum is Corrego Alegre with the Hayford 1924 ellipsoid and origins:

 Latitude 19° 50' 14.91" S
 Longitude 48° 57' 41.98" W 

 Vertical Datum is from Marégrafo de Imbituba, SC, but I don't really understand what are the parameters of the vertical datum that need to be taken in account.

 I would be really thankful if someone can help me to set a proj4 CRS to this map.

 PDF map can be downloaded here ftp://geoftp.ibge.gov.br/mapeamento_sistematico/topograficos/escala_50mil/pdf/sao_sebastiao27963.pdf 

 Vector (DGN) here ftp://geoftp.ibge.gov.br/mapeamento_sistematico/topograficos/escala_50mil/vetor/sao_sebastiao27963/vetor/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130131/e9f53f42/attachment.html>

From jagoncal at gmail.com  Thu Jan 31 10:03:52 2013
From: jagoncal at gmail.com (=?ISO-8859-1?Q?Jose_Gon=E7alves?=)
Date: Thu, 31 Jan 2013 18:03:52 +0000
Subject: [Proj] Define custom proj4 CRS
In-Reply-To: <20130131155755.23310@gmx.com>
References: <20130131155755.23310@gmx.com>
Message-ID: <CALHLaOQHwdHLxgKRVT3J6hVUE43pCsOKuCm1gf3dZDpUvo0oCQ@mail.gmail.com>

Dear Stephane

The projection is standard UTM, south hemisphere, zone 23 (central meridian
-45 deg).
Datum Corrego Alegre has two versions: "Corrego Alegre 1961" and "Corrego
Alegre 1970-72". They are similiar, with differences of only a few meters.
(The lat/long coordinates of the datum origin are not needed for the CRS
definition).

The EPSG file included in Quantum GIS has both datums but for the older one
no parameters are considered for the transformation to WGS84. So you would
better consider "Corrego Alegre 1970-72".
So, the EPSG code for your CRS is 22523. You can chose that in Quantum GIS.

If you need to transform your data to WGS84 and need better accuracy
transformations, there are datum shift grids for datum Corrego Alegre. Have
a look at:

http://www.ibge.gov.br/home/geociencias/geodesia/param_transf/default_param_transf.shtm

Regards

José Gonçalves


PS: The IBGE ftp site seems to be off.




2013/1/31 Stephane Goldstein <s.n.g at gmx.com>

> Hello.
>
> I have a vectorized version of a map from the Ilhabela<http://www.openstreetmap.org/?lat=-23.845&lon=-45.343&zoom=11&layers=M>island in Brazil, dating from 1975.
>
> I could not find in QGIS the corresponding CRS, so I want to establish it
> based on the information that is in the PDF version of the map:
>
> Universal Transverse Mercator Projection
>
> Units are in kilometers, starting 10.000 km south of the equator (around
> de south pole), counting towards the north.
>
> and 500 km west from the 45º W meridian, couting towards the east.
>
> Horizontal Datum is Corrego Alegre with the Hayford 1924 ellipsoid and
> origins:
>
> Latitude 19° 50' 14.91" S
> Longitude 48° 57' 41.98" W
>
> Vertical Datum is from Marégrafo de Imbituba, SC, but I don't really
> understand what are the parameters of the vertical datum that need to be
> taken in account.
>
> I would be really thankful if someone can help me to set a proj4 CRS to
> this map.
>
> PDF map can be downloaded here
> ftp://geoftp.ibge.gov.br/mapeamento_sistematico/topograficos/escala_50mil/pdf/sao_sebastiao27963.pdf
>
> Vector (DGN) here
> ftp://geoftp.ibge.gov.br/mapeamento_sistematico/topograficos/escala_50mil/vetor/sao_sebastiao27963/vetor/
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20130131/32b14e84/attachment.html>

From peifer at gmx.eu  Thu Jan 31 10:53:24 2013
From: peifer at gmx.eu (Hermann Peifer)
Date: Thu, 31 Jan 2013 16:53:24 -0200
Subject: [Proj] Define custom proj4 CRS
In-Reply-To: <CALHLaOQHwdHLxgKRVT3J6hVUE43pCsOKuCm1gf3dZDpUvo0oCQ@mail.gmail.com>
References: <20130131155755.23310@gmx.com>
	<CALHLaOQHwdHLxgKRVT3J6hVUE43pCsOKuCm1gf3dZDpUvo0oCQ@mail.gmail.com>
Message-ID: <510ABDA4.6010006@gmx.eu>


Dear both,

I just came to the same conclusion that EPSG:22523 would be the most 
appropriate CRS. It's proj4 representation is:

+proj=utm +zone=23 +south +ellps=intl +towgs84=-206,172,-6,0,0,0,0 
+units=m +no_defs

However, as Stephane mentioned: the units of IBGE's DGN files are in km, 
so one has to define a custom CRS with these parameters (same as above 
with the exception of +units=km)

+proj=utm +zone=23 +south +ellps=intl +towgs84=-206,172,-6,0,0,0,0 +units=km

Hope this helps, Hermann


On 2013-01-31 16:03, Jose Gonçalves wrote:
> Dear Stephane
>
> The projection is standard UTM, south hemisphere, zone 23 (central
> meridian -45 deg).
> Datum Corrego Alegre has two versions: "Corrego Alegre 1961" and
> "Corrego Alegre 1970-72". They are similiar, with differences of only a
> few meters. (The lat/long coordinates of the datum origin are not needed
> for the CRS definition).
>
> The EPSG file included in Quantum GIS has both datums but for the older
> one no parameters are considered for the transformation to WGS84. So you
> would better consider "Corrego Alegre 1970-72".
> So, the EPSG code for your CRS is 22523. You can chose that in Quantum GIS.
>
> If you need to transform your data to WGS84 and need better accuracy
> transformations, there are datum shift grids for datum Corrego Alegre.
> Have a look at:
>
> http://www.ibge.gov.br/home/geociencias/geodesia/param_transf/default_param_transf.shtm
>
>
> Regards
>
> José Gonçalves
>
>
> PS: The IBGE ftp site seems to be off.
>
>
>
>
> 2013/1/31 Stephane Goldstein <s.n.g at gmx.com <mailto:s.n.g at gmx.com>>
>
>     Hello.
>
>     I have a vectorized version of a map from the Ilhabela
>     <http://www.openstreetmap.org/?lat=-23.845&lon=-45.343&zoom=11&layers=M>
>     island in Brazil, dating from 1975.
>
>     I could not find in QGIS the corresponding CRS, so I want to
>     establish it based on the information that is in the PDF version of
>     the map:
>
>     Universal Transverse Mercator Projection
>
>     Units are in kilometers, starting 10.000 km south of the equator
>     (around de south pole), counting towards the north.
>
>     and 500 km west from the 45º W meridian, couting towards the east.
>
>     Horizontal Datum is Corrego Alegre with the Hayford 1924 ellipsoid
>     and origins:
>
>     Latitude19° 50' 14.91" S
>     Longitude 48° 57' 41.98" W
>
>     Vertical Datum is from Marégrafo de Imbituba, SC, but I don't really
>     understand what are the parameters of the vertical datum that need
>     to be taken in account.
>
>     I would be really thankful if someone can help me to set a proj4 CRS
>     to this map.
>
>     PDF map can be downloaded here
>     ftp://geoftp.ibge.gov.br/mapeamento_sistematico/topograficos/escala_50mil/pdf/sao_sebastiao27963.pdf
>
>     Vector (DGN) here
>     ftp://geoftp.ibge.gov.br/mapeamento_sistematico/topograficos/escala_50mil/vetor/sao_sebastiao27963/vetor/
>
>
>     _______________________________________________
>     Proj mailing list
>     Proj at lists.maptools.org <mailto:Proj at lists.maptools.org>
>     http://lists.maptools.org/mailman/listinfo/proj
>
>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>



From andre+joost at nurfuerspam.de  Thu Jan 31 11:58:11 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Thu, 31 Jan 2013 20:58:11 +0100
Subject: [Proj] Define custom proj4 CRS
In-Reply-To: <510ABDA4.6010006@gmx.eu>
References: <20130131155755.23310@gmx.com>
	<CALHLaOQHwdHLxgKRVT3J6hVUE43pCsOKuCm1gf3dZDpUvo0oCQ@mail.gmail.com>
	<510ABDA4.6010006@gmx.eu>
Message-ID: <keeio2$j9v$1@ger.gmane.org>

Am 31.01.2013 19:53, schrieb Hermann Peifer:
>
> Dear both,
>
> I just came to the same conclusion that EPSG:22523 would be the most
> appropriate CRS.

Me too, and it is in the standard database.

>
> However, as Stephane mentioned: the units of IBGE's DGN files are in km,
> so one has to define a custom CRS with these parameters (same as above
> with the exception of +units=km)
>
> +proj=utm +zone=23 +south +ellps=intl +towgs84=-206,172,-6,0,0,0,0 +units=km

I tried that, but QGIS does not like it:

Ausdehnung:
In Bezugssystemeinheiten des Projekts : xMin,yMin 448.11;7345.03 : 
xMax,yMax 475.53;7374.02
Räumliches Bezugssystem des Layers:
+proj=utm +zone=23 +south +ellps=intl +towgs84=-206,172,-6,0,0,0,0 
+units=m +no_defs

having set this custom CRS:
+proj=utm +zone=23 +south +ellps=intl +towgs84=-206,172,-6,0,0,0,0 
+units=km +no_defs

Maybe the elliposid and towgs84 parametres must also be in kilometres then?


> On 2013-01-31 16:03, Jose Gonçalves wrote:

>> PS: The IBGE ftp site seems to be off.

No, not off, but very slow: 6 to 9 kb/sec. Took me 2 hours to download 
51MB...

Greetings,
André Joost



From andre+joost at nurfuerspam.de  Thu Jan 31 12:09:05 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Thu, 31 Jan 2013 21:09:05 +0100
Subject: [Proj] Define custom proj4 CRS
In-Reply-To: <510ABDA4.6010006@gmx.eu>
References: <20130131155755.23310@gmx.com>
	<CALHLaOQHwdHLxgKRVT3J6hVUE43pCsOKuCm1gf3dZDpUvo0oCQ@mail.gmail.com>
	<510ABDA4.6010006@gmx.eu>
Message-ID: <keej0v$m74$1@ger.gmane.org>

Am 31.01.2013 19:53, schrieb Hermann Peifer:

>
> However, as Stephane mentioned: the units of IBGE's DGN files are in km,
> so one has to define a custom CRS with these parameters (same as above
> with the exception of +units=km)
>
> +proj=utm +zone=23 +south +ellps=intl +towgs84=-206,172,-6,0,0,0,0 +units=km
>

Reading a proj document from Frank Warmerdam of 2004, I found this hint:
+proj=utm +zone=23 +south +ellps=intl 
+towgs84=-0.206,0.172,-0.006,0,0,0,0 +to_meter=1000 +no_defs

which works perfectly in Qgis.

HTH,
André Joost




From andre+joost at nurfuerspam.de  Thu Jan 31 12:13:42 2013
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Thu, 31 Jan 2013 21:13:42 +0100
Subject: [Proj] Define custom proj4 CRS
In-Reply-To: <510ABDA4.6010006@gmx.eu>
References: <20130131155755.23310@gmx.com>
	<CALHLaOQHwdHLxgKRVT3J6hVUE43pCsOKuCm1gf3dZDpUvo0oCQ@mail.gmail.com>
	<510ABDA4.6010006@gmx.eu>
Message-ID: <keej9m$ovj$1@ger.gmane.org>

Sorry, it should have been:

+proj=utm +zone=23 +south +ellps=intl +towgs84=-206,172,-6,0,0,0,0 
+to_meter=1000 +no_defs

Time to go to bed, I think...

Greetings,
André Joost




