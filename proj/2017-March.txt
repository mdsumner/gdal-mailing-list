From jochem.lesparre at kadaster.nl  Wed Mar 22 14:41:29 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 14:41:29 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
Message-ID: <1490218889442-5313738.post@n6.nabble.com>

Hello, 

I joined the mailing list because I noticed that the PROJ.4 library uses
approximate formulas for the 7 parameter coordinate transformation defined
by +towgs84 (technical details: The elements of the rotation matrix are the
rotation angles instead of the product of sines and cosines of the angles).
For really small rotation angles this gives the same result, but not for
larger rotations. 

For my current application I want to transform a map in QGIS with 1 mm
accuracy. However, the approximation causes an error of 4 cm. Since PROJ.4
normally gives results within 0.1 mm accuracy, I did not expect such
approximation.

What can I do to help to fix this?

Regards, Jochem

   



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From ndzinn at comcast.net  Wed Mar 22 14:59:25 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Wed, 22 Mar 2017 16:59:25 -0500
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490218889442-5313738.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
Message-ID: <65EB943120A649279B8DFFD7D9712C32@NoelDellPC>

Jochem,

If you want to abandon the small-angle approximation and use sines and 
cosines, you must then define an order for the three rotation matrices 
(about X, about Y, and about Z).  Different matrix orders give different 
answers.  What's your preferred order and why?

Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Jochem
Sent: Wednesday, March 22, 2017 4:41 PM
To: proj at lists.maptools.org
Subject: [Proj] +towgs84 approximation error

Hello,

I joined the mailing list because I noticed that the PROJ.4 library uses
approximate formulas for the 7 parameter coordinate transformation defined
by +towgs84 (technical details: The elements of the rotation matrix are the
rotation angles instead of the product of sines and cosines of the angles).
For really small rotation angles this gives the same result, but not for
larger rotations.

For my current application I want to transform a map in QGIS with 1 mm
accuracy. However, the approximation causes an error of 4 cm. Since PROJ.4
normally gives results within 0.1 mm accuracy, I did not expect such
approximation.

What can I do to help to fix this?

Regards, Jochem





--
View this message in context: 
http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From martin.desruisseaux at geomatys.com  Wed Mar 22 15:25:46 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Wed, 22 Mar 2017 23:25:46 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490218889442-5313738.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
Message-ID: <effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>

Hello Jochem

The 7 parameter coordinate transformations are for datum shifts, which
are themselves approximative operations by nature. They have stochastic
error unrelated to the Proj.4 accuracy, much greater than the sine
approximation. For example the "NAD27 to WGS 84 (4)" transformation over
USA (EPSG:1173) has an accuracy of 10 metres. So in this context I
wonder what would be the purpose of aiming for an "accuracy" of 0.1 mm.
It can not be a positional accuracy (in the geodetic sense) at least,
but maybe the intend was something else?

    Martin


Le 22/03/2017 à 22:41, Jochem a écrit :
> Hello, 
>
> I joined the mailing list because I noticed that the PROJ.4 library uses
> approximate formulas for the 7 parameter coordinate transformation defined
> by +towgs84 (technical details: The elements of the rotation matrix are the
> rotation angles instead of the product of sines and cosines of the angles).
> For really small rotation angles this gives the same result, but not for
> larger rotations. 
>
> For my current application I want to transform a map in QGIS with 1 mm
> accuracy. However, the approximation causes an error of 4 cm. Since PROJ.4
> normally gives results within 0.1 mm accuracy, I did not expect such
> approximation.
>
> What can I do to help to fix this?
>
> Regards, Jochem



From knudsen.thomas at gmail.com  Wed Mar 22 17:13:32 2017
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Thu, 23 Mar 2017 01:13:32 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490218889442-5313738.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
Message-ID: <CAH0YoENBxYZEcY1dPFyO7EKX4nYv1Z5uhxiVoi-JCqVK=W_DBQ@mail.gmail.com>

Hello Jochem,

Perhaps this: https://github.com/OSGeo/proj.4/blob/master/src/PJ_helmert.c
may be of interest to you. And although it is still poorly documented and
probably not available in currently distributed versions of qgis, any
comments you may offer on the functionality, with and without using the
+approx flag will be much appreciated

2017-03-22 22:41 GMT+01:00 Jochem <jochem.lesparre at kadaster.nl>:

> Hello,
>
> I joined the mailing list because I noticed that the PROJ.4 library uses
> approximate formulas for the 7 parameter coordinate transformation defined
> by +towgs84 (technical details: The elements of the rotation matrix are the
> rotation angles instead of the product of sines and cosines of the angles).
> For really small rotation angles this gives the same result, but not for
> larger rotations.
>
> For my current application I want to transform a map in QGIS with 1 mm
> accuracy. However, the approximation causes an error of 4 cm. Since PROJ.4
> normally gives results within 0.1 mm accuracy, I did not expect such
> approximation.
>
> What can I do to help to fix this?
>
> Regards, Jochem
>
>
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-
> approximation-error-tp5313738.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/02a2f7db/attachment.html>

From smpel at yahoo.com  Wed Mar 22 17:48:25 2017
From: smpel at yahoo.com (Stefanos Beligiannis)
Date: Thu, 23 Mar 2017 00:48:25 +0000 (UTC)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
Message-ID: <496473731.1317018.1490230105144@mail.yahoo.com>

Hi Jochem,
if I understood well you need a method to transform your coordinates from one system to another.7 parameters transformation (or Bursa-Wolf) is a geodetic coordinates transformation method, so the first question you must answer is what type of coordinates do you have on both systems and you must describe these systems.A second issue that arises is the accuracy. Martin already explained you that 7 param. method gives transformations with errors of even >10 m big. So big errors are expected when we deal with datum (ellipsoids) that have parameters with big differences between them. There is a confuse also, if I got the point, on the proj.4 calculation rounding errors that you say are 0.1 mm and the standard deviation of your transformed coordinates which you say are 4.5 cm.In turn we can't help you unless you explain clearly : "what you have" and "what you need".
regards Stefanos Beligiannis   


      From: Martin Desruisseaux <martin.desruisseaux at geomatys.com>
 To: proj at lists.maptools.org 
 Sent: Thursday, March 23, 2017 12:33 AM
 Subject: Re: [Proj] +towgs84 approximation error
   
Hello Jochem

The 7 parameter coordinate transformations are for datum shifts, which
are themselves approximative operations by nature. They have stochastic
error unrelated to the Proj.4 accuracy, much greater than the sine
approximation. For example the "NAD27 to WGS 84 (4)" transformation over
USA (EPSG:1173) has an accuracy of 10 metres. So in this context I
wonder what would be the purpose of aiming for an "accuracy" of 0.1 mm.
It can not be a positional accuracy (in the geodetic sense) at least,
but maybe the intend was something else?

    Martin


Le 22/03/2017 à 22:41, Jochem a écrit :
> Hello, 
>
> I joined the mailing list because I noticed that the PROJ.4 library uses
> approximate formulas for the 7 parameter coordinate transformation defined
> by +towgs84 (technical details: The elements of the rotation matrix are the
> rotation angles instead of the product of sines and cosines of the angles).
> For really small rotation angles this gives the same result, but not for
> larger rotations. 
>
> For my current application I want to transform a map in QGIS with 1 mm
> accuracy. However, the approximation causes an error of 4 cm. Since PROJ.4
> normally gives results within 0.1 mm accuracy, I did not expect such
> approximation.
>
> What can I do to help to fix this?
>
> Regards, Jochem

_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/6aa82429/attachment.html>

From jochem.lesparre at kadaster.nl  Wed Mar 22 17:48:55 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 17:48:55 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
Message-ID: <1490230135613-5313761.post@n6.nabble.com>

Hi Martin,

WGS84 is just a hub for many users. I will transform data from frame A via
WGS84 to frame B. The transformation from A to B should have 1 mm (not 0.1
mm) accuracy for me, since the coordinates are of 1 cm accuracy. 

Moreover, 7 parameter transformations are not always stochastic, e.g. the
transformation between the Dutch national grid and ETRS89 (=WGS84 +/- 1 m)
is by definition exact since the Dutch national grid is defined as the
transformation from ETRS89.

Furthermore, world wide geodetic positional accuracy in ITRF (=WGS84 +/-
0.0001 m) is possible well below the accuracy of the 4 cm error I am
experiencing.

I think these are 3 reasons why the approximation is not good enough and
should be improved.

Regards, Jochem  
 



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313761.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Wed Mar 22 18:13:40 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 18:13:40 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
Message-ID: <1490231620066-5313764.post@n6.nabble.com>

Hi Noel,

My preference is Rz Ry Rx because this is how it is mentioned in my geodesy
text books. This could be different in other countries (like positive and
negative the rotation direction). The order Rz Ry Rx is also the order used
by EPSG which is the source of most of the parameters used by PROJ.4. I
think that is a good reason to keep to that order.

Reference:
http://www.iogp.org/pubs/373-07-2.pdf
<http://www.iogp.org/pubs/373-07-2.pdf>   (page 134)

Regards, Jochem 



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313764.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From cjmce at lsu.edu  Wed Mar 22 18:31:00 2017
From: cjmce at lsu.edu (Clifford J Mugnier)
Date: Thu, 23 Mar 2017 01:31:00 +0000
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490231620066-5313764.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>,
	<1490231620066-5313764.post@n6.nabble.com>
Message-ID: <95E0E0A2-2B61-40C1-A3E8-EA99DEA263AF@lsu.edu>

Is that the rotation order or the matrix multiplication order?  :-). Whatever the order, the resultant direction cosine matrix remains the same, an orthogonal rotation matrix.

Sent from Cliff Mugnier's iPhone

> On Mar 22, 2017, at 8:16 PM, Jochem <jochem.lesparre at kadaster.nl> wrote:
> 
> Hi Noel,
> 
> My preference is Rz Ry Rx because this is how it is mentioned in my geodesy
> text books. This could be different in other countries (like positive and
> negative the rotation direction). The order Rz Ry Rx is also the order used
> by EPSG which is the source of most of the parameters used by PROJ.4. I
> think that is a good reason to keep to that order.
> 
> Reference:
> http://www.iogp.org/pubs/373-07-2.pdf
> <http://www.iogp.org/pubs/373-07-2.pdf>   (page 134)
> 
> Regards, Jochem 
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313764.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj


From jochem.lesparre at kadaster.nl  Wed Mar 22 18:34:32 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 18:34:32 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <496473731.1317018.1490230105144@mail.yahoo.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
Message-ID: <1490232872178-5313766.post@n6.nabble.com>

Hi Stefanos,

I have coordinates in an old national grid and a new national grid. Both
grids have TM projections on the international Hayfort ellipsoid. Both grids
have 7 parameter transformations to WGS84 defined by the government but not
published in EPSG. I want to do:

cs2cs +init=mygrids:old +to +init=mygrids:new -f %.4f <old_coords.txt
>new_coords.txt

What I need is exactly what I explained in my first email: a 7 parameter
transformation without approximation error of 4 cm (this error is a bias,
not a standard deviation) in the formulas.

Regards, Jochem




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313766.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Wed Mar 22 18:37:00 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 18:37:00 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <95E0E0A2-2B61-40C1-A3E8-EA99DEA263AF@lsu.edu>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
	<1490231620066-5313764.post@n6.nabble.com>
	<95E0E0A2-2B61-40C1-A3E8-EA99DEA263AF@lsu.edu>
Message-ID: <1490233020241-5313767.post@n6.nabble.com>

Noel, That is matrix multiplication order, like explained the reference. So,
the rotation order is X, Y, Z. 
Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313767.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From nick_mein at trimble.com  Wed Mar 22 18:43:12 2017
From: nick_mein at trimble.com (Nick Mein)
Date: Thu, 23 Mar 2017 14:43:12 +1300
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490233020241-5313767.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
	<1490231620066-5313764.post@n6.nabble.com>
	<95E0E0A2-2B61-40C1-A3E8-EA99DEA263AF@lsu.edu>
	<1490233020241-5313767.post@n6.nabble.com>
Message-ID: <CAF3Sn4Uit8w001A2iJusEfcN8zMoeDa_Y1LnkaQn8oXWXUvHQw@mail.gmail.com>

Hi Jochem,

I was going to ask why you weren't using the RDNAPTRANS utility (available
from https://www.kadaster.nl/transformatie-van-coordinaten), but I see that
you are one of the authors of that utility :-)

Regards,
Nick.

On Thu, Mar 23, 2017 at 2:37 PM, Jochem <jochem.lesparre at kadaster.nl> wrote:

> Noel, That is matrix multiplication order, like explained the reference.
> So,
> the rotation order is X, Y, Z.
> Jochem
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-
> approximation-error-tp5313738p5313767.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/3bf858c1/attachment.html>

From jochem.lesparre at kadaster.nl  Wed Mar 22 18:44:46 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 18:44:46 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <CAH0YoENBxYZEcY1dPFyO7EKX4nYv1Z5uhxiVoi-JCqVK=W_DBQ@mail.gmail.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<CAH0YoENBxYZEcY1dPFyO7EKX4nYv1Z5uhxiVoi-JCqVK=W_DBQ@mail.gmail.com>
Message-ID: <1490233486100-5313769.post@n6.nabble.com>

Hi Thomas,

Thanks. Should I compile this to an exe or an other type of file? Where
should I put that file in order to use it in QGIS?

Regards, Jochem  



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313769.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From cjmce at lsu.edu  Wed Mar 22 18:53:41 2017
From: cjmce at lsu.edu (Clifford J Mugnier)
Date: Thu, 23 Mar 2017 01:53:41 +0000
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490232872178-5313766.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>,
	<1490232872178-5313766.post@n6.nabble.com>
Message-ID: <2AFA82EB-1AF2-48E8-9A54-7A7797A8E84A@lsu.edu>

How many coordinate pairs?  For that level of desired accuracy you're going to need more than 100 points.  Is that reasonable?

Sent from Cliff Mugnier's iPhone

> On Mar 22, 2017, at 8:34 PM, Jochem <jochem.lesparre at kadaster.nl> wrote:
> 
> Hi Stefanos,
> 
> I have coordinates in an old national grid and a new national grid. Both
> grids have TM projections on the international Hayfort ellipsoid. Both grids
> have 7 parameter transformations to WGS84 defined by the government but not
> published in EPSG. I want to do:
> 
> cs2cs +init=mygrids:old +to +init=mygrids:new -f %.4f <old_coords.txt
>> new_coords.txt
> 
> What I need is exactly what I explained in my first email: a 7 parameter
> transformation without approximation error of 4 cm (this error is a bias,
> not a standard deviation) in the formulas.
> 
> Regards, Jochem
> 
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313766.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj


From jochem.lesparre at kadaster.nl  Wed Mar 22 19:01:35 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 19:01:35 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <CAF3Sn4Uit8w001A2iJusEfcN8zMoeDa_Y1LnkaQn8oXWXUvHQw@mail.gmail.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
	<1490231620066-5313764.post@n6.nabble.com>
	<95E0E0A2-2B61-40C1-A3E8-EA99DEA263AF@lsu.edu>
	<1490233020241-5313767.post@n6.nabble.com>
	<CAF3Sn4Uit8w001A2iJusEfcN8zMoeDa_Y1LnkaQn8oXWXUvHQw@mail.gmail.com>
Message-ID: <1490234495391-5313773.post@n6.nabble.com>

Hi Nick,

I am not in the Netherlands at the moment. This is for another country. I
would like to make it possible for them to use Proj.4 instead of writing a
dedicated transformation program.

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313773.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From smpel at yahoo.com  Wed Mar 22 19:16:15 2017
From: smpel at yahoo.com (Stefanos Beligiannis)
Date: Thu, 23 Mar 2017 02:16:15 +0000 (UTC)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490232872178-5313766.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
Message-ID: <1862489975.1271600.1490235375532@mail.yahoo.com>

Hi Jochem,
this is more clear : 1. Usually these parameters are defined by the government by LSM and their (the parameters) computations are based on some CPs of  the National HARN network with coordinates calculated on both systems.  This means they enclose the national grid internal errors plus the least square methods calculation errors. In turn it is a big luck for you that you have only up to 4.5cm error.2. To my opinion, If you want better accuracy you must re-measure with big accuracy the coordinates of those (or at least, as many as possible) common points you have on the old Hayford datum, on WGS84 with GPS static Measurements and then define new "local" 7 parameters to transform the coordinates you have, and ignore the government for this area.3. I had the same with you problem on Riyadh Airport (Ain Al Abd datum) and I solved it like above.I find the problem very interesting and I want to kindly give me feedback how you solved it.many thanksStefanos
      From: Jochem <jochem.lesparre at kadaster.nl>
 To: proj at lists.maptools.org 
 Sent: Thursday, March 23, 2017 3:35 AM
 Subject: Re: [Proj] +towgs84 approximation error
   
Hi Stefanos,

I have coordinates in an old national grid and a new national grid. Both
grids have TM projections on the international Hayfort ellipsoid. Both grids
have 7 parameter transformations to WGS84 defined by the government but not
published in EPSG. I want to do:

cs2cs +init=mygrids:old +to +init=mygrids:new -f %.4f <old_coords.txt
>new_coords.txt

What I need is exactly what I explained in my first email: a 7 parameter
transformation without approximation error of 4 cm (this error is a bias,
not a standard deviation) in the formulas.

Regards, Jochem




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313766.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj


   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/4524d7d0/attachment.html>

From smpel at yahoo.com  Wed Mar 22 19:19:50 2017
From: smpel at yahoo.com (Stefanos Beligiannis)
Date: Thu, 23 Mar 2017 02:19:50 +0000 (UTC)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490233486100-5313769.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<CAH0YoENBxYZEcY1dPFyO7EKX4nYv1Z5uhxiVoi-JCqVK=W_DBQ@mail.gmail.com>
	<1490233486100-5313769.post@n6.nabble.com>
Message-ID: <146284604.1369117.1490235590200@mail.yahoo.com>

Hi Jochem QGIS runs Python you need a C compiler for Thomas program.regards Stefanos
      From: Jochem <jochem.lesparre at kadaster.nl>
 To: proj at lists.maptools.org 
 Sent: Thursday, March 23, 2017 3:53 AM
 Subject: Re: [Proj] +towgs84 approximation error
   
Hi Thomas,

Thanks. Should I compile this to an exe or an other type of file? Where
should I put that file in order to use it in QGIS?

Regards, Jochem  



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313769.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj


   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/26db69ac/attachment.html>

From jochem.lesparre at kadaster.nl  Wed Mar 22 19:20:03 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 19:20:03 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <2AFA82EB-1AF2-48E8-9A54-7A7797A8E84A@lsu.edu>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<2AFA82EB-1AF2-48E8-9A54-7A7797A8E84A@lsu.edu>
Message-ID: <1490235603353-5313775.post@n6.nabble.com>

Cliff,

The transformation has been estimated by performing static GPS observations
on about 12 points of the old triangulation frame. Ofcourse these parameters
are not at 1 mm precise but more like a few cm. However, these parameters
have been in use for some time now. Therefore these parameters are
conventional* parameters and I need to keep to that convention within 1 mm.

I do not know the number of points to be transformed, the entire digital map
of a small country (probably a few million).  

*)  Van der Marel, 2016
<http://www.citg.tudelft.nl/fileadmin/Faculteit/CiTG/Over_de_faculteit/Afdelingen/Afdeling_Geoscience_and_Remote_Sensing/Study/CTB3310_TerrestrialReferenceSystems_TRS_2-1a.pdf>  
page 33-34

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313775.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Wed Mar 22 19:37:49 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Wed, 22 Mar 2017 19:37:49 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1862489975.1271600.1490235375532@mail.yahoo.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
Message-ID: <1490236669299-5313778.post@n6.nabble.com>

Hi Stefanos,

You are still completely misunderstanding my problem. The responsible agency
already did these measurements. And the measurements are ok. They also
computed the 7 parameters. These are ok too. I checked the least-squares
adjustment. The problem is that the Proj.4 formulas are wrong. Wrong in the
sense that they give different results from transformation with other
software. I used several software packages and the differences between them
were 0.1 to a few mm. The only one that was 4 cm different was Proj.4. 

However I don't want to use one of the other software packages as these can
only transform points and not vector maps like QGIS.

Ragards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313778.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From kreve at sdfe.dk  Thu Mar 23 00:48:28 2017
From: kreve at sdfe.dk (Kristian Evers)
Date: Thu, 23 Mar 2017 07:48:28 +0000
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490236669299-5313778.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
Message-ID: <2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>

Hi Jochem, 

A few comments:

> The problem is that the Proj.4 formulas are wrong. Wrong in the
> sense that they give different results from transformation with other
> software. I used several software packages and the differences between
> them
> were 0.1 to a few mm. The only one that was 4 cm different was Proj.4.

You need to demonstrate this with some actual data and an example of 
what you are doing. Please recreate the problem with a call to cs2cs. Until
we see some results it is only going to be guesswork from our side.

> Thanks. Should I compile this to an exe or an other type of file? Where
> should I put that file in order to use it in QGIS?

It is a bit more convoluted to use a development version of PROJ.4 with QGIS. 
It is certainly possible if you know what you are doing, but I assume that you don't 
Since QGIS is a rather complicated setup. Basically you need to first build a recent
development version of PROJ.4, and then compile QGIS with PROJ.4 as one 
of the depending libraries. Look towards the QGIS documentation for a proper
write up of the process.

> This is for another country. I
> would like to make it possible for them to use Proj.4 instead of writing a
> dedicated transformation program.

This is a very sensible approach, one that I hope many other countries will adapt
in the coming years. We are doing the same thing in Denmark. Which is also why
we are expanding the geodetic capabilities of PROJ.4 at the moment. The progress 
can be followed on GitHub where development is on-going, and some background 
can be found in the archives of this list. 

Best regards,
Kristian 

> -----Oprindelig meddelelse-----
> Fra: proj-bounces at lists.maptools.org [mailto:proj-
> bounces at lists.maptools.org] På vegne af Jochem
> Sendt: 23. marts 2017 03:38
> Til: proj at lists.maptools.org
> Emne: Re: [Proj] +towgs84 approximation error
> 
> Hi Stefanos,
> 
> You are still completely misunderstanding my problem. The responsible
> agency
> already did these measurements. And the measurements are ok. They also
> computed the 7 parameters. These are ok too. I checked the least-squares
> adjustment. 
> 
> However I don't want to use one of the other software packages as these
> can
> only transform points and not vector maps like QGIS.
> 
> Ragards, Jochem
> 
> 
> 
> --
> View this message in context: http://osgeo-
> org.1560.x6.nabble.com/towgs84-approximation-error-
> tp5313738p5313778.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj


From smpel at yahoo.com  Thu Mar 23 01:11:30 2017
From: smpel at yahoo.com (Stefanos Beligiannis)
Date: Thu, 23 Mar 2017 08:11:30 +0000 (UTC)
Subject: [Proj] =?utf-8?b?zqPPh861z4Q6IFJlOiAgK3Rvd2dzODQgYXBwcm94aW1hdGlv?=
 =?utf-8?q?n_error?=
In-Reply-To: <496473731.1317018.1490230105144@mail.yahoo.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
Message-ID: <819282334.1524937.1490256690054@mail.yahoo.com>

Oh so sorry Jochem

Thank you for the explanations. I use my own software and I had never realized proj. I am sorry to hear a so usefull program like proj has these bugs. Thank you for informing me. Regards Stefanos
Στάλθηκε από το Ταχυδρομείο Yahoo σε Android 
 
  Στις Πέμ, 23 Μαρ, 2017 στις 2:48, ο χρήστηςStefanos Beligiannis<smpel at yahoo.com> έγραψε:   Hi Jochem,
if I understood well you need a method to transform your coordinates from one system to another.7 parameters transformation (or Bursa-Wolf) is a geodetic coordinates transformation method, so the first question you must answer is what type of coordinates do you have on both systems and you must describe these systems.A second issue that arises is the accuracy. Martin already explained you that 7 param. method gives transformations with errors of even >10 m big. So big errors are expected when we deal with datum (ellipsoids) that have parameters with big differences between them. There is a confuse also, if I got the point, on the proj.4 calculation rounding errors that you say are 0.1 mm and the standard deviation of your transformed coordinates which you say are 4.5 cm.In turn we can't help you unless you explain clearly : "what you have" and "what you need".
regards Stefanos Beligiannis   


      From: Martin Desruisseaux <martin.desruisseaux at geomatys.com>
 To: proj at lists.maptools.org 
 Sent: Thursday, March 23, 2017 12:33 AM
 Subject: Re: [Proj] +towgs84 approximation error
  
Hello Jochem

The 7 parameter coordinate transformations are for datum shifts, which
are themselves approximative operations by nature. They have stochastic
error unrelated to the Proj.4 accuracy, much greater than the sine
approximation. For example the "NAD27 to WGS 84 (4)" transformation over
USA (EPSG:1173) has an accuracy of 10 metres. So in this context I
wonder what would be the purpose of aiming for an "accuracy" of 0.1 mm.
It can not be a positional accuracy (in the geodetic sense) at least,
but maybe the intend was something else?

    Martin


Le 22/03/2017 à 22:41, Jochem a écrit :
> Hello, 
>
> I joined the mailing list because I noticed that the PROJ.4 library uses
> approximate formulas for the 7 parameter coordinate transformation defined
> by +towgs84 (technical details: The elements of the rotation matrix are the
> rotation angles instead of the product of sines and cosines of the angles).
> For really small rotation angles this gives the same result, but not for
> larger rotations. 
>
> For my current application I want to transform a map in QGIS with 1 mm
> accuracy. However, the approximation causes an error of 4 cm. Since PROJ.4
> normally gives results within 0.1 mm accuracy, I did not expect such
> approximation.
>
> What can I do to help to fix this?
>
> Regards, Jochem

_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj

     
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/4f204a0d/attachment.html>

From jochem.lesparre at kadaster.nl  Thu Mar 23 01:51:22 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 01:51:22 -0700 (MST)
Subject: [Proj]
	=?utf-8?b?zqPPh861z4Q6IFJlOiAgK3Rvd2dzODQgYXBwcm94aW1hdGlv?=
	=?utf-8?q?n_error?=
In-Reply-To: <819282334.1524937.1490256690054@mail.yahoo.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<819282334.1524937.1490256690054@mail.yahoo.com>
Message-ID: <1490259082250-5313814.post@n6.nabble.com>

Hi Stefanos,

No worries! I appreciate it you took the effort of replying to my post. And
you're not the only one that did not understand my question right away. I
think I should have done a bit more explanation in my question right away. I
find it is always difficult to find the best balance between completeness
and conciseness. 

Kind regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313814.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From dragons8mycat at live.co.uk  Thu Mar 23 02:09:23 2017
From: dragons8mycat at live.co.uk (Dragons8mycat)
Date: Thu, 23 Mar 2017 02:09:23 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490231620066-5313764.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
	<1490231620066-5313764.post@n6.nabble.com>
Message-ID: <1490260163430-5313816.post@n6.nabble.com>

Hi Jochem,
Is this issue occurring in both directions? The only reason I ask is that I
have found QGIS good for transformations as it calculates for both
directions of the transformation whereas most of the other software don't do
so well.
So that I can look into this, can you provide the coordinate systems you are
working between (epsg)?
Regards,
Nicholas Duggan
Geoninja 



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313816.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Thu Mar 23 02:21:12 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 02:21:12 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
Message-ID: <1490260872492-5313821.post@n6.nabble.com>

Hi Kristian,

I can not show that cs2cs makes an approximation error by using only cs2cs.
I have to compare it with other software. But what transformation software
is available to you that would you trust more than Proj.4? The best way to
show it, is to compute a transformation in computational software like
Matlab twice. One time with the approximate formulas, giving the same result
as cs2cs, and one time with the strict formulas, giving a 4 cm different
result. As not everyone here will have Matlab, I am thinking of using Excel.
Do you think that is a good idea?

Thanks for the information on how to use a development version of PROJ.4
with QGIS. This sounds complicated. Maybe I would manage to do it with a lot
of effort and some help. But I am afraid I can't expect the government
agency here to reproduce that.

In the Netherlands, the official transformation RDNAPTRANS will probably be
updated this year in a way that it can be done with Proj.4. I hoped to be
able to do the same here, but the approximation error is preventing me from
doing so.

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313821.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Thu Mar 23 02:30:15 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 02:30:15 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490260163430-5313816.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
	<1490231620066-5313764.post@n6.nabble.com>
	<1490260163430-5313816.post@n6.nabble.com>
Message-ID: <1490261415560-5313824.post@n6.nabble.com>

Hi Nicholas,

The problem is not direction dependant. I have a different set of parameters
for the inverse transformation. The coordinate systems I am using do not
have epsg codes yet. I can demonstrate the problem by comparing cs2cs with a
computation in Excel twice. One time with the approximate formulas, giving
the same result as cs2cs, and one time with the strict formulas, giving a 4
cm different result. Do you think that is a good idea? 

Regards, Jochem




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313824.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From a.cottin at carbomap.com  Thu Mar 23 02:47:10 2017
From: a.cottin at carbomap.com (Antoine Cottin)
Date: Thu, 23 Mar 2017 09:47:10 +0000
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490260872492-5313821.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
Message-ID: <4FA50323-61B6-4F2B-BA02-CA02C968A465@carbomap.com>

Hello Jochem,

As one mentioned, and i know it’s not answering your question.
But what kind of data (and sensor) did you have/used to reach this accuracy?
And how do you calculate this accuracy, what reference data did you used?

Thanks for enlightening me.
Best regards
Antoine
-----------------------
Dr Antoine Cottin
Chief Technology Officer
Carbomap Ltd.
Edinburgh Centre for Carbon Innovation
High School Yards
Edinburgh EH1 1LZ
-----------------------
http://www.carbomap.com
http://carbomap.wordpress.com
http://github.com/carbomap
@carbomap
+44 (0)7577 444-046










> On 23 Mar 2017, at 09:21, Jochem <jochem.lesparre at kadaster.nl> wrote:
> 
> Hi Kristian,
> 
> I can not show that cs2cs makes an approximation error by using only cs2cs.
> I have to compare it with other software. But what transformation software
> is available to you that would you trust more than Proj.4? The best way to
> show it, is to compute a transformation in computational software like
> Matlab twice. One time with the approximate formulas, giving the same result
> as cs2cs, and one time with the strict formulas, giving a 4 cm different
> result. As not everyone here will have Matlab, I am thinking of using Excel.
> Do you think that is a good idea?
> 
> Thanks for the information on how to use a development version of PROJ.4
> with QGIS. This sounds complicated. Maybe I would manage to do it with a lot
> of effort and some help. But I am afraid I can't expect the government
> agency here to reproduce that.
> 
> In the Netherlands, the official transformation RDNAPTRANS will probably be
> updated this year in a way that it can be done with Proj.4. I hoped to be
> able to do the same here, but the approximation error is preventing me from
> doing so.
> 
> Regards, Jochem
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313821.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/c2b67b40/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 842 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/c2b67b40/attachment.sig>

From kreve at sdfe.dk  Thu Mar 23 02:58:37 2017
From: kreve at sdfe.dk (Kristian Evers)
Date: Thu, 23 Mar 2017 09:58:37 +0000
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490260872492-5313821.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
Message-ID: <2E885BB293AF0448A0181138489E9A0E99FA10EF@S000014.PROD.SITAD.DK>

Jochem,

> I can not show that cs2cs makes an approximation error by using only cs2cs.
> I have to compare it with other software.

Sure you can.

You have coordinates that you trust and know to be true, right? Let us
see those. Both the coordinates before and after the transformation.
Then do the transformation with cs2cs. Use the same parameters as
the trusted coordinates were created with. Now we can compare the
two sets of coordinates, and maybe figure out what is going on here.

Kristian



> -----Oprindelig meddelelse-----
> Fra: proj-bounces at lists.maptools.org [mailto:proj-
> bounces at lists.maptools.org] På vegne af Jochem
> Sendt: 23. marts 2017 10:21
> Til: proj at lists.maptools.org
> Emne: Re: [Proj] +towgs84 approximation error
> 
> Hi Kristian,
> 
> I can not show that cs2cs makes an approximation error by using only cs2cs.
> I have to compare it with other software. But what transformation software
> is available to you that would you trust more than Proj.4? The best way to
> show it, is to compute a transformation in computational software like
> Matlab twice. One time with the approximate formulas, giving the same
> result
> as cs2cs, and one time with the strict formulas, giving a 4 cm different
> result. As not everyone here will have Matlab, I am thinking of using Excel.
> Do you think that is a good idea?
> 
> Thanks for the information on how to use a development version of PROJ.4
> with QGIS. This sounds complicated. Maybe I would manage to do it with a
> lot
> of effort and some help. But I am afraid I can't expect the government
> agency here to reproduce that.
> 
> In the Netherlands, the official transformation RDNAPTRANS will probably be
> updated this year in a way that it can be done with Proj.4. I hoped to be
> able to do the same here, but the approximation error is preventing me from
> doing so.
> 
> Regards, Jochem
> 
> 
> 
> --
> View this message in context: http://osgeo-
> org.1560.x6.nabble.com/towgs84-approximation-error-
> tp5313738p5313821.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj


From jochem.lesparre at kadaster.nl  Thu Mar 23 03:52:58 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 03:52:58 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <4FA50323-61B6-4F2B-BA02-CA02C968A465@carbomap.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
	<4FA50323-61B6-4F2B-BA02-CA02C968A465@carbomap.com>
Message-ID: <1490266378110-5313833.post@n6.nabble.com>

Hello Antoine,

My coordinates in the old frame have precision of a few cm (obtained by
triangulation a hundred years ago) and the coordinates in the new frame 1 cm
(obtained by static GPS measurements 15 years ago). Both networks are tied
to WGS84 with an precision of a few metres. 

However the two frames are tied to each other far more precisely. The
relative transformation parameters have a precision of a few cm, since these
are based on the measurements. However these parameters have been in use for
some time now in software with strict formulas, and by that they have become
more or less official. Therefore, I need Proj.4 to produce the exact same
result (+/- 1 mm) as the other software with the strict formulas.

Regards, Jochem





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313833.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From martin.desruisseaux at geomatys.com  Thu Mar 23 04:23:25 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Thu, 23 Mar 2017 12:23:25 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490230135613-5313761.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
Message-ID: <75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>

Hello Jochem

Le 23/03/2017 à 01:48, Jochem a écrit :

> WGS84 is just a hub for many users.
>
Right, but this is an issue. There is today 6 versions of WGS84: WGS
84(Transit), WGS 84(G730), WGS 84(G873), WGS 84(G1150), WGS 84(G1674),
WGS 84(G1762). The difference between them can more than 1 metre.
Furthermore - maybe not in your case but usually -, a transformation
from A to WGS84 involves stochastic errors and a transformation from
WGS84 to B involve additional stochastic errors that could be avoided
when defining the transformation directly from A to B (e.g. from NAD27
to NAD83). For those reasons, the use of a hub ("early-binding") is not
the preferred approach. In Well Known Text (WKT), the TOWGS84 keyword
has been removed in the new WKT 2 format (ISO 19162); another mechanism
(BOUNDCRS) is defined for those who really want early-binding.

Implementing the recommended approach ("late-binding") in Proj.4
requires access to a more complete EPSG dataset, which has been the
discussed in another thread a few months ago. The proposal was to use
SQLite. But I understand that the time frame may not fit your needs.


> I think these are 3 reasons why the approximation is not good enough
> and should be improved.
But EPSG guidance notes that you referred [1] also said that whether
there is an error or not depend on how the 7 parameters were derived. If
they were derived by an algorithm that itself used the small angle
approximation, then the current Proj.4 implementation is exact and the
proposed improvement would introduce errors. Unfortunately there is no
way as far as I know to said how the 7 parameters were derived. The
standard way would have been to define 2 separated operation methods
depending how the 7 parameters were derived, but this has not been done
(I presume because the errors were considered too small compared to
stochastic errors). However I admit that those who derived the 7
parameters using the small angle approximation probably care less about
errors than those who derived the 7 parameters using the full formulas.

    Martin


[1] http://www.iogp.org/pubs/373-07-2.pdf (page 135)




From martin.desruisseaux at geomatys.com  Thu Mar 23 04:41:16 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Thu, 23 Mar 2017 12:41:16 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490266378110-5313833.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
	<4FA50323-61B6-4F2B-BA02-CA02C968A465@carbomap.com>
	<1490266378110-5313833.post@n6.nabble.com>
Message-ID: <79f301c4-d939-845a-378e-56cd05b529d4@geomatys.com>

Le 23/03/2017 à 11:52, Jochem a écrit :

> Therefore, I need Proj.4 to produce the exact same result (+/- 1 mm)
> as the other software with the strict formulas.
>
I would have a different approach. To me, the problem is that Proj.4 and
other software are used as black boxes: there is nothing telling the
user that the coordinate transformation (s)he is using has an accuracy
of 5 cm, or 10 metres, or 25 metres, etc. I think that this information
should be made easily available. Again, this can be done with access to
a more complete EPSG dataset than the current CSV files.

I could even relate this issue to wider thoughts about the importance of
metadata in this "post-truth" era, for making easier to evaluate our
confidence in data or statement, but this is out of scope for this thread.

    Martin




From knudsen.thomas at gmail.com  Thu Mar 23 04:43:58 2017
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Thu, 23 Mar 2017 12:43:58 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490266378110-5313833.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
	<4FA50323-61B6-4F2B-BA02-CA02C968A465@carbomap.com>
	<1490266378110-5313833.post@n6.nabble.com>
Message-ID: <CAH0YoEP68bnzH4zht_QyJaU6oYi7jGXJ+KjG=gz0PcUZWTDy2g@mail.gmail.com>

i.e. your transformation is *exact by definition*: It defines the new
system in terms
of the old (or probably more likely the other way round, but in that case we
will - formally - have to talk about a re-definition of the old system).

I wrote a related comment about the reverse situation (the full matrix
formulation
not being strictly valid) in the code for PJ_helmert.c:

If the option "approximate" is set, small angle approximations are used:
The matrix elements are approximated by expanding the trigonometric
functions to linear order (i.e. cos(x) = 1, sin(x) = x), and discarding
products of second order.

This was a useful hack when calculating by hand was the only option,
but in general, today, should be avoided because:

1. It does not save much computation time, as the rotation matrix
   is built only once, and probably used many times.

2. The error induced may be too large for ultra high accuracy
   applications: the Earth is huge and the linear error is
   approximately the angular error multiplied by the Earth radius.

However, in many cases the approximation is necessary, since it has
been used historically: Rotation angles from older published datum
shifts may actually be a least squares fit to the linearized rotation
approximation, hence not being strictly valid for deriving the full
rotation matrix.

In principle it would not be a problem to switch Proj.4 to the full matrix
convention
even for the +towgs84 case, but in practice it would, for exacly the same
reason
that you need it the other way round: The approximate versions being correct
*by definition*. We would need to introduce an "+noapproximation" option, to
keep the classic behaviour intact by default.

Feel free to submit a pull request implementing this!

/Thomas

2017-03-23 11:52 GMT+01:00 Jochem <jochem.lesparre at kadaster.nl>:

> Hello Antoine,
>
> My coordinates in the old frame have precision of a few cm (obtained by
> triangulation a hundred years ago) and the coordinates in the new frame 1
> cm
> (obtained by static GPS measurements 15 years ago). Both networks are tied
> to WGS84 with an precision of a few metres.
>
> However the two frames are tied to each other far more precisely. The
> relative transformation parameters have a precision of a few cm, since
> these
> are based on the measurements. However these parameters have been in use
> for
> some time now in software with strict formulas, and by that they have
> become
> more or less official. Therefore, I need Proj.4 to produce the exact same
> result (+/- 1 mm) as the other software with the strict formulas.
>
> Regards, Jochem
>
>
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-
> approximation-error-tp5313738p5313833.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/92d0268e/attachment.html>

From jochem.lesparre at kadaster.nl  Thu Mar 23 04:56:18 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 04:56:18 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <2E885BB293AF0448A0181138489E9A0E99FA10EF@S000014.PROD.SITAD.DK>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA10EF@S000014.PROD.SITAD.DK>
Message-ID: <1490270178084-5313844.post@n6.nabble.com>

Kristian,

I did that, I'll show you in a bit. I know what is going wrong already. The
formulas in cs2cs are the approximate ones instead of the strict ones: 

Lookup the method with EPSG code 1032 on  http://epsg-registry.org/
<http://epsg-registry.org/>  

This refers to  Guidance Note 7, part 2
<http://www.iogp.org/pubs/373-07-2.pdf>  
On page 134 with page number 132 of that publication the strict and
approximate formulas are mentioned (see image)
<http://osgeo-org.1560.x6.nabble.com/file/n5313844/Untitled.png>  
This publication also states: "For this small angle approximation to be
valid to better than 3mm at the Earth’s surface, the rotations must be under
10 arc-seconds". My rotations are upto 40 arc-seconds (causing a errors of
several cm).

cs2cs uses these approximate formulas: 
http://proj.maptools.org/gen_parms.html
<http://proj.maptools.org/gen_parms.html>  

Example:
cs2cs +proj=geocent +ellps=WGS84
+towgs84=-294.1985,231.0171,-285.2462,-11.34441,40.54620,-9.73364,15.7901
+to +proj=geocent +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 -f %.4f 

input: 
3194419.1451 -3194419.1451 4487348.4089

output:
3194906.7475 -3194142.5106 4486681.7637

This is exactly identical to what I get if I program the approximate
formulas in Excel too.

What it should be is what I produced by programming the strict formulas in
Excel and what I also got (within few mm) with 3 other software packages
(Trimble, Topcon en Move3):
3194906.7284 -3194142.5438 4486681.6702

The difference is: -0.0191 -0.0332 -0.0934
The 3D difference: 0.1010 m

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313844.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From smpel at yahoo.com  Thu Mar 23 05:45:07 2017
From: smpel at yahoo.com (Stefanos Beligiannis)
Date: Thu, 23 Mar 2017 12:45:07 +0000 (UTC)
Subject: [Proj]
 =?utf-8?b?zqPPh861z4Q6IFJlOiAgK3Rvd2dzODQgYXBwcm94aW1hdGlv?=
 =?utf-8?q?n_error?=
In-Reply-To: <1490259082250-5313814.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<819282334.1524937.1490256690054@mail.yahoo.com>
	<1490259082250-5313814.post@n6.nabble.com>
Message-ID: <917774856.2452629.1490273107587@mail.yahoo.com>

Thanks Jochem,
I wish I could help more. I look forward the solution of this interesting problem you shared with us. I believe: thanks to you and all professionals here we have the opportunity to learn something new.
Kind regards, Stefanos. 



      From: Jochem <jochem.lesparre at kadaster.nl>
 To: proj at lists.maptools.org 
 Sent: Thursday, March 23, 2017 10:55 AM
 Subject: Re: [Proj] Σχετ: Re: +towgs84 approximation error
   
Hi Stefanos,
No worries! I appreciate it you took the effort of replying to my post. And
you're not the only one that did not understand my question right away. I
think I should have done a bit more explanation in my question right away. I
find it is always difficult to find the best balance between completeness
and conciseness. 

Kind regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313814.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj


   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/26610e20/attachment.html>

From jochem.lesparre at kadaster.nl  Thu Mar 23 05:49:24 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 05:49:24 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
Message-ID: <1490273364020-5313855.post@n6.nabble.com>

Hi Martin,

Indeed it would be better to give people using the approximated formulas an
error than for the people that use the strict ones.

The "late-binding" will not solve these problems, since also for parameters
between system A and B the rotation angles are too large for the approximate
formulas:

In my case:

Frame A -> WGS84
-294.1985,231.0171,-285.2462,-11.34441,40.54620,-9.73364,15.7901

WGS84 -> Frame B
270.4047,-127.0720,286.7425,+11.13087,-1.67806,-24.24971,0.4536

Frame A - > Frame B
-23.764,103.995,1.506,-0.21346,38.86867,-33.98116,16.2437
NB: I did not simple add the parameters, but used strict formulas to combine
them.

Therefore, I'm still convinced that the formulas of +towgs84 should be
corrected.

Regards, Jochem




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313855.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Thu Mar 23 05:58:33 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 05:58:33 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <CAH0YoEP68bnzH4zht_QyJaU6oYi7jGXJ+KjG=gz0PcUZWTDy2g@mail.gmail.com>
References: <effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
	<4FA50323-61B6-4F2B-BA02-CA02C968A465@carbomap.com>
	<1490266378110-5313833.post@n6.nabble.com>
	<CAH0YoEP68bnzH4zht_QyJaU6oYi7jGXJ+KjG=gz0PcUZWTDy2g@mail.gmail.com>
Message-ID: <1490273913106-5313857.post@n6.nabble.com>

Hi Thomas,

You are right. Probably there are users that would want to still be able to
use the approximate formulas. I think the default should be no
approximation, but maybe the other way around is better for backward
compatibility.

What is a pull request? (I'm new here.)

Regards, Jochem







--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313857.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From knudsen.thomas at gmail.com  Thu Mar 23 07:42:08 2017
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Thu, 23 Mar 2017 15:42:08 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490273913106-5313857.post@n6.nabble.com>
References: <effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<496473731.1317018.1490230105144@mail.yahoo.com>
	<1490232872178-5313766.post@n6.nabble.com>
	<1862489975.1271600.1490235375532@mail.yahoo.com>
	<1490236669299-5313778.post@n6.nabble.com>
	<2E885BB293AF0448A0181138489E9A0E99FA1041@S000014.PROD.SITAD.DK>
	<1490260872492-5313821.post@n6.nabble.com>
	<4FA50323-61B6-4F2B-BA02-CA02C968A465@carbomap.com>
	<1490266378110-5313833.post@n6.nabble.com>
	<CAH0YoEP68bnzH4zht_QyJaU6oYi7jGXJ+KjG=gz0PcUZWTDy2g@mail.gmail.com>
	<1490273913106-5313857.post@n6.nabble.com>
Message-ID: <CAH0YoEMCHcoD6qcb=E=civEgeQabgkUznK+VReT4mo93hozETQ@mail.gmail.com>

Hi Jochen,

A pull request is the way you contribute code to (most) open source
projects.

A good starting point will be to first take a look at the Proj.4 Github
page over
at https://github.com/OSGeo/proj.4 - then continue to learn about the GitHub
workflow from https://guides.github.com/introduction/flow/

...and then jump in at the deep end by opening a Github user account,
cloning Proj.4 to your own account and start learning git.

If you are new to distributed version control systems, git will be a big
mouthful,
but it is worth learning.

/Thomas


2017-03-23 13:58 GMT+01:00 Jochem <jochem.lesparre at kadaster.nl>:

> Hi Thomas,
>
> You are right. Probably there are users that would want to still be able to
> use the approximate formulas. I think the default should be no
> approximation, but maybe the other way around is better for backward
> compatibility.
>
> What is a pull request? (I'm new here.)
>
> Regards, Jochem
>
>
>
>
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-
> approximation-error-tp5313738p5313857.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170323/7199a2fb/attachment.html>

From martin.desruisseaux at geomatys.com  Thu Mar 23 13:21:51 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Thu, 23 Mar 2017 21:21:51 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490273364020-5313855.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
Message-ID: <64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>

Hello Jochem and all

I think you already know that, but just for information for people
reading this thread that may be interested. Jochem shows below an
example of two steps using WGS84 as a hub (A to WGS84 to B) that are
mathematically combined for producing a single step going directly from
A to B. What we call "late-binding" goes a little step further in that
it is not just a mathematical combination. The 7-parameters for a datum
shift from A to WGS84 are derived by minimizing the errors in a set of
stations (like a "curve fitting"), and the 7-parameters for a datum
shift from WGS84 to B are derived by another "curve fitting". The
mathematical combination of the two is not exactly the same than what we
get if we do a "curve fitting" directly from A to B. Since those
parameter values can not be inferred mathematically from the "+towgs84"
parameters, they have to be stored in a separated table in the EPSG
database.

I'm not completely sure that I understood correctly the context, but it
may be that Jochem's intend could be understood not as improving a datum
shift operation, but rather as defining a Derived CRS in ISO 19111 sense
[1]. It doesn't make a difference for Proj.4 in its current state, but
if Proj.4 is someday upgraded to a "late-binding" implementation this
little nuance would need to be kept in mind.

    Regards,

        Martin


[1] http://portal.opengeospatial.org/files/?artifact_id=39049 section
B.1.2.2 at page 63.


Le 23/03/2017 à 13:49, Jochem a écrit :

> The "late-binding" will not solve these problems, since also for parameters
> between system A and B the rotation angles are too large for the approximate
> formulas:
>
> In my case:
>
> Frame A -> WGS84
> -294.1985,231.0171,-285.2462,-11.34441,40.54620,-9.73364,15.7901
>
> WGS84 -> Frame B
> 270.4047,-127.0720,286.7425,+11.13087,-1.67806,-24.24971,0.4536
>
> Frame A - > Frame B
> -23.764,103.995,1.506,-0.21346,38.86867,-33.98116,16.2437
> NB: I did not simple add the parameters, but used strict formulas to combine
> them.
>
> Therefore, I'm still convinced that the formulas of +towgs84 should be
> corrected.



From ndzinn at comcast.net  Thu Mar 23 14:27:51 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Thu, 23 Mar 2017 16:27:51 -0500
Subject: [Proj]  +towgs84 approximation error
In-Reply-To: <64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com><effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com><1490230135613-5313761.post@n6.nabble.com><75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com><1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
Message-ID: <374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>

All,

This has been a very interesting thread for me and thanks for all the 
insightful geodetic contributions.  The computer science implementation 
details (git, et al) are beyond my experience.  But one important detail has 
been missed so far.  That is that derivation of a 7-parameter transformation 
for any European country is badly ill-defined.  Even for a country the size 
of Germany, the adjustment correlations between the rotations and the 
translations are extremely high.  That's because, for a "small" area, a 
positional difference (error) at a survey monument can be explained by 
EITHER a combination of rotations and scale OR just a combination of 
translations.  Those effects are only separated out over a very large area 
(continental or larger).  Unavoidable surface errors result in statistically 
meaningless and egregious translations compared with, say, a simple 
3-parameter transformation.  So, while we're gilding 7-parameter 
transformations here with rotation matrices fully populated with sines and 
cosines, we ought to consider how those transformations were derived.  There 
may be acceptance behind them, but little science from a survey-adjustment 
perspective.  Better to keep it simple in Europe.

Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Martin Desruisseaux
Sent: Thursday, March 23, 2017 3:21 PM
To: proj at lists.maptools.org
Subject: Re: [Proj] +towgs84 approximation error

Hello Jochem and all

I think you already know that, but just for information for people
reading this thread that may be interested. Jochem shows below an
example of two steps using WGS84 as a hub (A to WGS84 to B) that are
mathematically combined for producing a single step going directly from
A to B. What we call "late-binding" goes a little step further in that
it is not just a mathematical combination. The 7-parameters for a datum
shift from A to WGS84 are derived by minimizing the errors in a set of
stations (like a "curve fitting"), and the 7-parameters for a datum
shift from WGS84 to B are derived by another "curve fitting". The
mathematical combination of the two is not exactly the same than what we
get if we do a "curve fitting" directly from A to B. Since those
parameter values can not be inferred mathematically from the "+towgs84"
parameters, they have to be stored in a separated table in the EPSG
database.

I'm not completely sure that I understood correctly the context, but it
may be that Jochem's intend could be understood not as improving a datum
shift operation, but rather as defining a Derived CRS in ISO 19111 sense
[1]. It doesn't make a difference for Proj.4 in its current state, but
if Proj.4 is someday upgraded to a "late-binding" implementation this
little nuance would need to be kept in mind.

    Regards,

        Martin


[1] http://portal.opengeospatial.org/files/?artifact_id=39049 section
B.1.2.2 at page 63.


Le 23/03/2017 à 13:49, Jochem a écrit :

> The "late-binding" will not solve these problems, since also for 
> parameters
> between system A and B the rotation angles are too large for the 
> approximate
> formulas:
>
> In my case:
>
> Frame A -> WGS84
> -294.1985,231.0171,-285.2462,-11.34441,40.54620,-9.73364,15.7901
>
> WGS84 -> Frame B
> 270.4047,-127.0720,286.7425,+11.13087,-1.67806,-24.24971,0.4536
>
> Frame A - > Frame B
> -23.764,103.995,1.506,-0.21346,38.86867,-33.98116,16.2437
> NB: I did not simple add the parameters, but used strict formulas to 
> combine
> them.
>
> Therefore, I'm still convinced that the formulas of +towgs84 should be
> corrected.

_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From jochem.lesparre at kadaster.nl  Thu Mar 23 14:53:14 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 14:53:14 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
Message-ID: <1490305994297-5313952.post@n6.nabble.com>

Hi Martin,

Actually, I think that it is mathematically perfectly possible to derive
exactly the same parameters from A to B by common points, as by combining
the parameters form A to WGS84 and the parameters form B to WGS84 (if you
used the same common points to estimate all the transformations).

An important condition is that you take the full covariance matrices of the
least-squares solutions into account. This is like the fact that you can
compute the average body length of a school by taking the average of the
average length of each class, as long as you weigh it with the number of
students in each class. I think it works for 7 parameter transformations
too. I could try if this actually works if you are interested.

Anyway, it is definitely possible to compute the parameters from A to B from
the parameters from A to WGS84 and from B to WGS84 in a way that A to B
gives the same result as A to WGS84 to B. For small angles this is simple
subtracting the parameters. For larger angles it is a bit more complicated
but still commonly known linear algebra. I derived the formulas once to make
a "calculator" for stacking and inverting transformations.

If you have different sets of common points between A and B, A and WGS84 and
B and WGS84, then you would indeed get 3 sets of inconsistent parameters.
However, more precise and consistent parameters could then be obtained by
least-squares adjustment of the 3 sets of parameters (ideally using the full
covariance matrices again). That you would have to store 3 sets of
parameters to relate 3 reference frames is utter nonsense. This is like
claiming that the height difference between the floor and the ceiling is
different from the sum of the height differences from the floor to the table
and from the table to the ceiling. 

The part of ISO 19111 I don't understand (I'm good in least-squares theory,
but I bad in reading formal ISO norm texts. Could you explain that in normal
English?).

Now, there are two possibilities. Or what I just wrote is very interesting
for you, or I completely misunderstood that you meant. The third possibility
that I am wrong, I don't consider in this case ;-)

Regards, Jochem 





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313952.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Thu Mar 23 15:13:28 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Thu, 23 Mar 2017 15:13:28 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
Message-ID: <1490307208389-5313957.post@n6.nabble.com>

Hi Noel,

You are right about the corrections between rotations and translations. This
will cause the parameters to look very different if you estimate them on new
data. However, besides that, I don't see what the problem is. You still get
precise transformated coordinates (and you don't always get that with
approximate formulas). Or do you see other problems? 

You know the solution to this correlation problem by using a point in the
centre of the country as rotation pivot point and thus using a 10 parameter
transformation? 
Section 2.4.3.2 of  Guidance Note 7, part 2
<http://www.iogp.org/pubs/373-07-2.pdf>   (these are approximated formulas
but of course a strict equivalent is possible).

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313957.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From martin.desruisseaux at geomatys.com  Thu Mar 23 16:15:18 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Fri, 24 Mar 2017 00:15:18 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
Message-ID: <11a7037f-30c6-88ca-863b-9f0008718bff@geomatys.com>

Thanks Noel for the explanation. Maybe it explains why in the EPSG
database, the majority of datum shift operations are specified only by
translation terms.

    Martin


Le 23/03/2017 à 22:27, Noel Zinn (cc) a écrit :

> This has been a very interesting thread for me and thanks for all the 
> insightful geodetic contributions.  The computer science implementation 
> details (git, et al) are beyond my experience.  But one important detail has 
> been missed so far.  That is that derivation of a 7-parameter transformation 
> for any European country is badly ill-defined.  Even for a country the size 
> of Germany, the adjustment correlations between the rotations and the 
> translations are extremely high.  That's because, for a "small" area, a 
> positional difference (error) at a survey monument can be explained by 
> EITHER a combination of rotations and scale OR just a combination of 
> translations.  Those effects are only separated out over a very large area 
> (continental or larger).  Unavoidable surface errors result in statistically 
> meaningless and egregious translations compared with, say, a simple 
> 3-parameter transformation.  So, while we're gilding 7-parameter 
> transformations here with rotation matrices fully populated with sines and 
> cosines, we ought to consider how those transformations were derived.  There 
> may be acceptance behind them, but little science from a survey-adjustment 
> perspective.  Better to keep it simple in Europe.
>
> Noel



From scott.strong at dpipwe.tas.gov.au  Thu Mar 23 16:19:10 2017
From: scott.strong at dpipwe.tas.gov.au (Scott)
Date: Thu, 23 Mar 2017 16:19:10 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
Message-ID: <1490311150928-5313964.post@n6.nabble.com>

All,

Yes this thread has resulted in a very interesting conversation - many
issues from the transformation "black-box" have been drawn out into the
open.

What follows doesn't deal with Jochem's initial issue but, 

if you are interested in general background readers may like to monitor the
web pages supporting Australia's move to a adopt a new national datum -
http://www.icsm.gov.au/gda2020/index.html 

This whole site is intended to make matters pertaining to datums (and
transformations) more accessible - meaning providing explanations that are
conceptual in conjunction with technical content.  

While it is in an Australian context, much of the material is relevant
globally and there is still a lot of extra content planned.

In particular http://www.icsm.gov.au/gda2020/faqs-2.html, currently in early
stages of development, will be expanded to include resources (primarily
additions to the Fact Sheet series) that explain as simply as possible
general issues outlined in this thread including - 
the hidden nasty's regarding different transformation approach's, stuff
about EPSG codes (in an Australian context),treating WGS84 as a "static" or
"plate-fixed" datum and using it as a hub.

Please follow this site as it develops and importantly feel free to
contribute suggestions regarding the content if you have any.



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313964.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From ndzinn at comcast.net  Thu Mar 23 16:44:12 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Thu, 23 Mar 2017 18:44:12 -0500
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490307208389-5313957.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com><effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com><1490230135613-5313761.post@n6.nabble.com><75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com><1490273364020-5313855.post@n6.nabble.com><64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com><374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
	<1490307208389-5313957.post@n6.nabble.com>
Message-ID: <F69FDE046C594323B4AF1016060AB4F8@NoelDellPC>

Jochem,

Yes, the (7) parameters will look very different if you estimate them on new 
data because a 7-parameter derivation in a small area is ill determined. 
Such transformations use more parameters than required to solve the problem. 
The result is the statistical insignificance of the translations.  By 
contrast 3-parameter transformation translations (and that's all you get, 
just 3 translations) with new or old data, add or subtract points from the 
adjustment, will look pretty much the same.  In fact, they have a physical 
(geodetic) interpretation.  They are translations at the center of the earth 
required to align the surface points.  The so-called "translations" that you 
are using are not that.  They are just numbers, insignificant numbers driven 
wildly by small errors in your surface point.  You should not call them 
translations.  You should call them "fudge factors".  However, derived in 
continental-and-up-sized areas, especially between world datums, they really 
are translations.

One solution to this problem is as you suggest, a rotation center on the 
surface (not the geocenter as in the 7-parameter transformation), the 
so-called Molodensky-Badekas (MB) transformation.  Unfortunately, MB has 
several variants, most of which (if not all) are irreversible, so this is 
not a popular alternative.

Another honest solution to this problem is the approach used with the 
multiple-regression equations of the 1980s.  BTW, they must still be 
popular, especially for badly distorted datums, because Survey Review has or 
will soon publish on the topic.  That solution is to start with the 
translations then add other parameters one by one and assess their 
significance in the adjustment.  Alternatively, throw them all in at once 
and then subtract the least significant, evaluate the determination of the 
adjustment, then subtract another if required, and so on.  You can program 
that procedure and you'll be surprised.

Seven parameters for a European country is bad adjustment practice.

Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Jochem
Sent: Thursday, March 23, 2017 5:13 PM
To: proj at lists.maptools.org
Subject: Re: [Proj] +towgs84 approximation error

Hi Noel,

You are right about the corrections between rotations and translations. This
will cause the parameters to look very different if you estimate them on new
data. However, besides that, I don't see what the problem is. You still get
precise transformated coordinates (and you don't always get that with
approximate formulas). Or do you see other problems?

You know the solution to this correlation problem by using a point in the
centre of the country as rotation pivot point and thus using a 10 parameter
transformation?
Section 2.4.3.2 of  Guidance Note 7, part 2
<http://www.iogp.org/pubs/373-07-2.pdf>   (these are approximated formulas
but of course a strict equivalent is possible).

Regards, Jochem



--
View this message in context: 
http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5313957.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From ndzinn at comcast.net  Thu Mar 23 16:57:23 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Thu, 23 Mar 2017 18:57:23 -0500
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <11a7037f-30c6-88ca-863b-9f0008718bff@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com><effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com><1490230135613-5313761.post@n6.nabble.com><75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com><1490273364020-5313855.post@n6.nabble.com><64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com><374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
	<11a7037f-30c6-88ca-863b-9f0008718bff@geomatys.com>
Message-ID: <8EA045140F5A4441A6C7EF76EABF2656@NoelDellPC>

Hi Martin,

I'm sure you're right that the majority are 3-parameter, translation-only 
transformations, but EPGS are pretty good about publishing anything in 
common use, even bad 7-parameter transformations.  My favorite is the one 
derived by DMA/NIMA/NGA for Cyprus.  Be wary of those.

Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Martin Desruisseaux
Sent: Thursday, March 23, 2017 6:15 PM
To: proj at lists.maptools.org
Subject: Re: [Proj] +towgs84 approximation error

Thanks Noel for the explanation. Maybe it explains why in the EPSG
database, the majority of datum shift operations are specified only by
translation terms.

    Martin


Le 23/03/2017 à 22:27, Noel Zinn (cc) a écrit :

> This has been a very interesting thread for me and thanks for all the
> insightful geodetic contributions.  The computer science implementation
> details (git, et al) are beyond my experience.  But one important detail 
> has
> been missed so far.  That is that derivation of a 7-parameter 
> transformation
> for any European country is badly ill-defined.  Even for a country the 
> size
> of Germany, the adjustment correlations between the rotations and the
> translations are extremely high.  That's because, for a "small" area, a
> positional difference (error) at a survey monument can be explained by
> EITHER a combination of rotations and scale OR just a combination of
> translations.  Those effects are only separated out over a very large area
> (continental or larger).  Unavoidable surface errors result in 
> statistically
> meaningless and egregious translations compared with, say, a simple
> 3-parameter transformation.  So, while we're gilding 7-parameter
> transformations here with rotation matrices fully populated with sines and
> cosines, we ought to consider how those transformations were derived. 
> There
> may be acceptance behind them, but little science from a survey-adjustment
> perspective.  Better to keep it simple in Europe.
>
> Noel

_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From martin.desruisseaux at geomatys.com  Thu Mar 23 17:54:01 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Fri, 24 Mar 2017 01:54:01 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490305994297-5313952.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<1490305994297-5313952.post@n6.nabble.com>
Message-ID: <9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>

Hello Jochem

I do not know the details about how data are selected for computing the
7-parameters, but I would presume that the set of stations in "A to
WGS84 to B" is not necessarily the same than in "A to B". For example an
operation from A to B may be designed for a smaller geographic area than
an operation involving WGS84.

Before to talk about derived CRS, one note about ISO 19111 terminology.
They define two kinds of coordinate operations:

  * A *conversion* is a coordinate operation defined only by mathematics
    and arbitrary parameters. Theoretically, the precision of coordinate
    conversion is infinite (ignoring limitations of floating point
    arithmetic). All map projections are conversions. Change of axis
    order, unit of measurement, etc. are also conversions.
  * A *transformation* is a coordinate operation derived from
    measurements. Regardless the computer accuracy, coordinate
    transformations have a limited accuracy because of stochastic
    errors. All datum shifts are transformations.

So an affine operation for example can be either an conversion or a
transformation, depending for which purpose it is used:

  * An affine operation used for changing the unit of measurement, or
    for changing the false easting or false northing parameters of a map
    projection, is a /conversion/. There is no error associated to that
    operation.
  * An affine operation used for applying a datum shift on geocentric
    coordinates is a /transformation/. There is an error associated to
    that operation no matter the accuracy of the mathematics behind it.

A derived CRS in ISO 19111 is a Coordinate Reference System defined by
another CRS (named the "base CRS") that we use as a starting point, then
a *conversion* that we apply /by definition/ on the coordinates in the
base CRS in order to get the coordinates in the derived CRS. Some key
points:

  * The base CRS and derived CRS are related by a coordinate conversion,
    not a transformation.
  * The above coordinate conversion is part of the derived CRS
    definition. In WKT 2 format, the parameters are specified inside the
    CRS definition.
  * The above coordinate operation is the only possible coordinate
    operation from the base CRS to the derived CRS.

By contrast, a change of datum between two CRS has the following properties:

  * Datum changes are transformation, not conversion.
  * Datum change parameters are not part of CRS definition. In WKT 2
    format, the operation is specified in a separated WKT element
    independent of the CRS definition (except for BOUNDCRS, which is a
    compromise done for early-binding implementations).
  * Many different coordinate operations can exist for the same pair of
    CRS. In USA, there is about 80 datum shift operations from NAD27 to
    WGS84.

To make a parallel with Proj.4, the current Proj.4 implementation is
designed as if all CRS were derived CRS since the +towgs84 parameter is
part of CRS definition. This is not the reality (many CRS were designed
before WGS84). In late-binding implementations of map projection
libraries, whether a coordinate operation is used for the definition of
a derived CRS or not make a difference in:

  * Where the parameter is defined (in the CRS or in a separated construct).
  * The cardinality of the coordinate operation(s) associated to that
    CRS (1:1 or 0:∞).
  * Whether the coordinate operation choice may depend on the geographic
    area of the coordinates that we want to transform.
  * Whether the operation may have stochastic errors.

That said, I mentioned the derived CRS because I saw a statement saying
that the CRS would be /by definition/ an other CRS with the coordinate
operation defined by the 7 parameters. But I still a little bit
surprised by a scenario where a derived CRS would be defined by
Bursa-Wolf parameters.

    Martin


Le 23/03/2017 à 22:53, Jochem a écrit :

> Hi Martin,
>
> Actually, I think that it is mathematically perfectly possible to derive
> exactly the same parameters from A to B by common points, as by combining
> the parameters form A to WGS84 and the parameters form B to WGS84 (if you
> used the same common points to estimate all the transformations).
>
> An important condition is that you take the full covariance matrices of the
> least-squares solutions into account. This is like the fact that you can
> compute the average body length of a school by taking the average of the
> average length of each class, as long as you weigh it with the number of
> students in each class. I think it works for 7 parameter transformations
> too. I could try if this actually works if you are interested.
>
> Anyway, it is definitely possible to compute the parameters from A to B from
> the parameters from A to WGS84 and from B to WGS84 in a way that A to B
> gives the same result as A to WGS84 to B. For small angles this is simple
> subtracting the parameters. For larger angles it is a bit more complicated
> but still commonly known linear algebra. I derived the formulas once to make
> a "calculator" for stacking and inverting transformations.
>
> If you have different sets of common points between A and B, A and WGS84 and
> B and WGS84, then you would indeed get 3 sets of inconsistent parameters.
> However, more precise and consistent parameters could then be obtained by
> least-squares adjustment of the 3 sets of parameters (ideally using the full
> covariance matrices again). That you would have to store 3 sets of
> parameters to relate 3 reference frames is utter nonsense. This is like
> claiming that the height difference between the floor and the ceiling is
> different from the sum of the height differences from the floor to the table
> and from the table to the ceiling. 
>
> The part of ISO 19111 I don't understand (I'm good in least-squares theory,
> but I bad in reading formal ISO norm texts. Could you explain that in normal
> English?).
>
> Now, there are two possibilities. Or what I just wrote is very interesting
> for you, or I completely misunderstood that you meant. The third possibility
> that I am wrong, I don't consider in this case ;-)
>
> Regards, Jochem

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170324/9195245e/attachment.html>

From nick_mein at trimble.com  Thu Mar 23 18:09:14 2017
From: nick_mein at trimble.com (Nick Mein)
Date: Fri, 24 Mar 2017 14:09:14 +1300
Subject: [Proj] Time dependent datum transformations
Message-ID: <CAF3Sn4UhHxdYbbpav78p+FSpRJ-q_0mdZPBw1yjX=Y5Lr7nPkg@mail.gmail.com>

Hi all,

Scott mentioned "treating WGS84 as a 'static' or 'plate-fixed' datum in the
"+towgs84 approximation error" thread. I'll take that as my segue into the
topic of dynamic datums and time dependent datum transformations.

There is a good introduction/overview of the topic in
http://ceur-ws.org/Vol-1142/paper6.pdf. This was written from an Australian
and New Zealand perspective, but the general issues are global. There are
"International Case Studies" of USA and Great Britain.

Mike Craymer has written some nice accessible material on this topic as
well. See, for example, http://www.naref.org/transf/nad83_hydroscan2006.pdf.

As a community, we have managed to largely ignore the issue of dynamic
datums for a long time. As precise point positioning technology becomes
more and more available, and more and more users are able to access cm
level positions in the ITRF, we are not going to be able to continue to
ignore this issue.

Generally, there are two classes of challenges that we face with.

Firstly, we need to store the epoch of measurement with any position that
record - if that is not implicit in the definition of the reference frame
being used. That isn't a trivial challenge, if our database and/or our
software architecture assumes that a coordinate has only 3 dimensions.

Secondly, we need to use that epoch to perform a time dependent datum
transformation.

In general, transforming coordinates from ITRF to a plate-fixed datum will
require a 14 parameter datum transformation, and coordinate propagation to
the reference epoch for that datum.

The 14 parameter tansformation is straight-forward (as long as you know the
measurement epoch).

Coordinate propagation is not so straight-forward.

In GDA94 the coordinate propagation is combined with the 14 parameter datum
transformation. But Australia is the "lucky country", geodetically speaking.

An Euler pole approach works well if you are not close to a plate boundary.

For places like California or New Zealand you need a more sophisticated
velocity/displacement/distortion model.

So finally, a question for the Proj-4 community, and a plea to the wider
geodetic community:

To the Proj-4 community: Are there plans to add time-dependent datum
transformations to Proj-4? (Or is that support already there?)

To the wider geodetic community: Are we able to work together on
developing/defining standards for representing and sharing
velocity/displacement/distortion models, rather than having a "tower of
Babel" where every national authority develops and publishes a slightly
different model, and every software developer has to try to implement that
model.

Regards,
Nick.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170324/2f16155b/attachment.html>

From jochem.lesparre at kadaster.nl  Fri Mar 24 02:02:35 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Fri, 24 Mar 2017 02:02:35 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <F69FDE046C594323B4AF1016060AB4F8@NoelDellPC>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
	<1490307208389-5313957.post@n6.nabble.com>
	<F69FDE046C594323B4AF1016060AB4F8@NoelDellPC>
Message-ID: <1490346155435-5314008.post@n6.nabble.com>

Hi Noel,

Your point on the correlations between translations and rotations was
already clear to me after your first email. However, I still don't
understand why this is so important to you. Since the coordinates
transformed with these correlated parameters won't be less accurate than the
ones with the better method you mention.

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314008.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Fri Mar 24 02:09:14 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Fri, 24 Mar 2017 02:09:14 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490336251047-5313992.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<65EB943120A649279B8DFFD7D9712C32@NoelDellPC>
	<1490336251047-5313992.post@n6.nabble.com>
Message-ID: <1490346554014-5314010.post@n6.nabble.com>

Hi Gábor,

I am aware of everything you write. You are right. 

However, to me this is a bit distracting from the point I tried to make with
this post. The fact that some datum transformations are stochastic, is no
excuse for not implementing the proper formulas for the transformation. 

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314010.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From martin.desruisseaux at geomatys.com  Fri Mar 24 02:26:10 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Fri, 24 Mar 2017 10:26:10 +0100
Subject: [Proj] Time dependent datum transformations
In-Reply-To: <CAF3Sn4UhHxdYbbpav78p+FSpRJ-q_0mdZPBw1yjX=Y5Lr7nPkg@mail.gmail.com>
References: <CAF3Sn4UhHxdYbbpav78p+FSpRJ-q_0mdZPBw1yjX=Y5Lr7nPkg@mail.gmail.com>
Message-ID: <9201152a-ea23-7b5c-0f04-cb886169718b@geomatys.com>

Hello Nick

Le 24/03/2017 à 02:09, Nick Mein a écrit :

> To the wider geodetic community: Are we able to work together on
> developing/defining standards for representing and sharing
> velocity/displacement/distortion models, rather than having a "tower
> of Babel" where every national authority develops and publishes a
> slightly different model, and every software developer has to try to
> implement that model.
>
I'm not sure if this address your question about sharing the models, but
just in case: ISO 19111 is under revision right now, and one of the main
goal for this revision is to support dynamic datum in their conceptual
model. The draft is quite advanced and the standard may be published in
2018 if everything go well. After its publication, there is plan to
update the ISO 19162 standard (WKT 2) accordingly.

    Martin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170324/6c67fbce/attachment.html>

From kreve at sdfe.dk  Fri Mar 24 02:32:13 2017
From: kreve at sdfe.dk (Kristian Evers)
Date: Fri, 24 Mar 2017 09:32:13 +0000
Subject: [Proj] Time dependent datum transformations
In-Reply-To: <CAF3Sn4UhHxdYbbpav78p+FSpRJ-q_0mdZPBw1yjX=Y5Lr7nPkg@mail.gmail.com>
References: <CAF3Sn4UhHxdYbbpav78p+FSpRJ-q_0mdZPBw1yjX=Y5Lr7nPkg@mail.gmail.com>
Message-ID: <2E885BB293AF0448A0181138489E9A0E99FA151F@S000014.PROD.SITAD.DK>

Hi Nick,

Let me answer you last question:

>  To the Proj-4 community: Are there plans to add time-dependent datum transformations to Proj-4? (Or is that support already there?)

Yes, and (to some extent) yes. With the introduction of “transformation pipelines” and the new API (previously discussed here on the mailing list and GitHub) in the development version of PROJ.4 it is possible to implement time-dependent datum transformations. The framework that allows you to implement various time-dependent transformations is there, but not much has been implemented yet.

Within the Nordic Commision for Geodesy I am involved in a project about implementing a dynamic reference frame in Iceland, so this is something that is very much in focus on my end. As time allow it, I am working on adding time-dependent transformations to PROJ.4. First of will be extending the Helmert transformation so it also handles 14-parameter shifts. That should take care of most of your needs for ITRF transformations I imagine. Another thing I am working on is time-depending deformation grids. If you are interested in the progress of this pay attention the GitHub page.

> As a community, we have managed to largely ignore the issue of dynamic datums for a long time. As precise point positioning technology becomes more and > more available, and more and more users are able to access cm level positions in the ITRF, we are not going to be able to continue to ignore this issue.

I agree. We are taking the first steps in PROJ.4 now, but there is still a huge implementation effort waiting in downstream projects!

/Kristian


Fra: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] På vegne af Nick Mein
Sendt: 24. marts 2017 02:09
Til: PROJ.4 and general Projections Discussions
Emne: [Proj] Time dependent datum transformations

Hi all,

Scott mentioned "treating WGS84 as a 'static' or 'plate-fixed' datum in the "+towgs84 approximation error" thread. I'll take that as my segue into the topic of dynamic datums and time dependent datum transformations.

There is a good introduction/overview of the topic in http://ceur-ws.org/Vol-1142/paper6.pdf. This was written from an Australian and New Zealand perspective, but the general issues are global. There are "International Case Studies" of USA and Great Britain.

Mike Craymer has written some nice accessible material on this topic as well. See, for example, http://www.naref.org/transf/nad83_hydroscan2006.pdf.

As a community, we have managed to largely ignore the issue of dynamic datums for a long time. As precise point positioning technology becomes more and more available, and more and more users are able to access cm level positions in the ITRF, we are not going to be able to continue to ignore this issue.

Generally, there are two classes of challenges that we face with.

Firstly, we need to store the epoch of measurement with any position that record - if that is not implicit in the definition of the reference frame being used. That isn't a trivial challenge, if our database and/or our software architecture assumes that a coordinate has only 3 dimensions.

Secondly, we need to use that epoch to perform a time dependent datum transformation.

In general, transforming coordinates from ITRF to a plate-fixed datum will require a 14 parameter datum transformation, and coordinate propagation to the reference epoch for that datum.

The 14 parameter tansformation is straight-forward (as long as you know the measurement epoch).

Coordinate propagation is not so straight-forward.

In GDA94 the coordinate propagation is combined with the 14 parameter datum transformation. But Australia is the "lucky country", geodetically speaking.

An Euler pole approach works well if you are not close to a plate boundary.

For places like California or New Zealand you need a more sophisticated velocity/displacement/distortion model.

So finally, a question for the Proj-4 community, and a plea to the wider geodetic community:

To the Proj-4 community: Are there plans to add time-dependent datum transformations to Proj-4? (Or is that support already there?)

To the wider geodetic community: Are we able to work together on developing/defining standards for representing and sharing velocity/displacement/distortion models, rather than having a "tower of Babel" where every national authority develops and publishes a slightly different model, and every software developer has to try to implement that model.

Regards,
Nick.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170324/d5d6c829/attachment.html>

From jochem.lesparre at kadaster.nl  Fri Mar 24 03:29:20 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Fri, 24 Mar 2017 03:29:20 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<1490305994297-5313952.post@n6.nabble.com>
	<9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>
Message-ID: <1490351360448-5314039.post@n6.nabble.com>

Hi Martin,

Thanks for your clarifying email.

> Many different coordinate operations can exist for the same pair of CRS.
> In USA, there is about 80 datum
> shift operations from NAD27 to WGS84.

I think we should make a distinction between reference systems and reference
frames here (I assume you are familiar with that). As each frame of a system
will have different parameters. For a frame only one set of parameters is
needed. If these are multiple sets, one could combine the information of all
these stochastic transformations in to one best least-squares estimated set
of parameters.

However, maybe I should nuance my point that it is nonsense to store
multiple sets of parameters also for a frame. There could be different sets
of transformation parameters for one frame to WGS84 exist in practice, but
here are no *mathematical* reasons to store redundant sets of parameters.


> I saw a statement saying that the CRS would be by definition an other CRS
> with the coordinate operation
> defined by the 7 parameters. But I still a little bit surprised by a
> scenario where a derived CRS would be 
> defined by Bursa-Wolf parameters.

For the country where I am working this week, the parameters are not really
by definition (conventional) but official (given) parameters. See the
terminology below my email for the distinction between conventional defined,
official given and self-estimated stochastic parameters.

However, this is the case for the national grid (RD) of the Netherlands. RD
is defined as the transformation (in ISO19111 terminology this would be a
conversion?) from ETRS89, including a 7 parameter transformation, but also
an correction grid on projected coordinates is used:  

ETRF2000(R05) <--7par--> pseudo_NL_Bessel <--proj--> pseudo_RD <--corr-->
true_RD

Since this order of steps is not supported by Proj.4, EPSG etc., this
procedure will probably be updated this year to:

ETRF2000(R14) <--NTv2--> true_NL_Bessel <--proj--> RD

However, I would like to see this possibility in Proj.4, EPSG, etc.:

ETRF2000(R14) <--7par--> pseudo_NL_Bessel <--NTv2--> true_NL_Bessel
<--proj--> true_RD

This would be better for 2 reasons. First, the normal of the NL-Bessel
ellipsoid is closer to the true vertical than the normal of ETRS89. Second,
there are always stubborn users that will use RD outside the bounding box of
the NTv2 grid (using: ETRF2000(R05) <--7par--> NL_Bessel <--proj--> RD). Of
course they should not do that, but I know they will keep doing this and it
is causing nasty problems at the edge of the bounding box. With the the
combination of 7 parameters and a NTv2 grid, the values in the NTv2 grid
could fade out to zero outside the Netherlands and the grid can cover the
entire earth. This would produce complete nonsense for points outside the
bounding box, but at least it will be the same consistent nonsense for all
users without edge effects.


Citation from  Van der Marel, 2016
<http://www.citg.tudelft.nl/fileadmin/Faculteit/CiTG/Over_de_faculteit/Afdelingen/Afdeling_Geoscience_and_Remote_Sensing/Study/CTB3310_TerrestrialReferenceSystems_TRS_2-1a.pdf> 
:
| A big difference between datum transformations and coordinate conversions
is that the
| parameters for the datum transformation are often empirically determined
and thus subject
| to measurement errors, whereas coordinate conversions are fully
deterministic. More specific,
| three possibilities need to be distinguished for the datum transformation
parameters
| 
| 1. The first possibility is that the datum transformation parameters are
*conventional*. This
| means they are chosen and therefore not stochastic. The datum
transformation is then
| just some sort of coordinate conversion (which are also not stochastic).
| 
| 2. The second possibility is that the datum transformation parameters are
*given*, but have
| been derived by a third party through measurements. What often happens is
that this
| third party does new measurements and updates the transformation
parameters occa-
| sionally or at regular intervals. This is also related to the concepts of
| reference system and reference frames. Reference frames are considered
(different) realizations of the
| same reference system, with different coordinates assigned to the points
in the reference
| frame, and often with different realizations of the transformation
parameters. The sta-
| tion coordinates and transformation parameters are stochastic, so new
measurements,
| mean new estimates that are different from the previous estimates.
| 
| 3. The third possibility is that there is no third party that has
determined the transformation
| parameters, and you as user, have to *estimate *them using at least three
common points
| in both systems. In this case you will need coordinates from the other
reference system.
| Keep in mind that the coordinates from the external reference system all
come from the
| same realization, or, reference frame.




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314039.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From knudsen.thomas at gmail.com  Fri Mar 24 04:53:35 2017
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Fri, 24 Mar 2017 12:53:35 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490351360448-5314039.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<1490305994297-5313952.post@n6.nabble.com>
	<9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>
	<1490351360448-5314039.post@n6.nabble.com>
Message-ID: <CAH0YoEMVnQSsDw=gcLwroG4CaUUEOtRjjCMXTixacbC1-rGQFA@mail.gmail.com>

Hi Jochem,

You say that you would like to do
    ETRF2000(R14) <--7par--> pseudo_NL_Bessel <--NTv2-->
true_NL_Bessel<--proj--> true_RD
In Proj.4

This will, as far as I can see, be possible with the Proj.4 pipeline
implementation, when
Kristian's latest pull request "Horisontal and vertical gridshift drivers "
(cf. https://github.com/OSGeo/proj.4/pull/492 ).

Actually most of what has been mentioned in this thread (and the
neighbouring thread about
dynamical reference systems) is possible using the transformation pipeline
framework, which
Kristian and I have been designing and implementing over the last few
months.

We're making progress, but we're flooded with other tasks as well, so time
allocated to building this
is limited. The plan is, however, to retire our old and venerable
transformation software, trlib
(https://bitbucket.org/KMS/trlib ), so we have no other way to go than to
extend Proj.4 with a full
geodetic framework.

The ubiquity of Proj.4 also means that, realistically speaking,
extending Proj.4 in this way will also be the only viable road to provide
"longterm centimeter accuracy to everyone, everywhere".

But this is just the first step: Once Proj.4 is capable of handling generic
geodetic transformations,
we will have a long process going making the downstream application
projects actually making
that available to end users. Here, we will have to depend on end-users
actually reqiring and
requesting that support.

/Thomas




2017-03-24 11:29 GMT+01:00 Jochem <jochem.lesparre at kadaster.nl>:

> Hi Martin,
>
> Thanks for your clarifying email.
>
> > Many different coordinate operations can exist for the same pair of CRS.
> > In USA, there is about 80 datum
> > shift operations from NAD27 to WGS84.
>
> I think we should make a distinction between reference systems and
> reference
> frames here (I assume you are familiar with that). As each frame of a
> system
> will have different parameters. For a frame only one set of parameters is
> needed. If these are multiple sets, one could combine the information of
> all
> these stochastic transformations in to one best least-squares estimated set
> of parameters.
>
> However, maybe I should nuance my point that it is nonsense to store
> multiple sets of parameters also for a frame. There could be different sets
> of transformation parameters for one frame to WGS84 exist in practice, but
> here are no *mathematical* reasons to store redundant sets of parameters.
>
>
> > I saw a statement saying that the CRS would be by definition an other CRS
> > with the coordinate operation
> > defined by the 7 parameters. But I still a little bit surprised by a
> > scenario where a derived CRS would be
> > defined by Bursa-Wolf parameters.
>
> For the country where I am working this week, the parameters are not really
> by definition (conventional) but official (given) parameters. See the
> terminology below my email for the distinction between conventional
> defined,
> official given and self-estimated stochastic parameters.
>
> However, this is the case for the national grid (RD) of the Netherlands. RD
> is defined as the transformation (in ISO19111 terminology this would be a
> conversion?) from ETRS89, including a 7 parameter transformation, but also
> an correction grid on projected coordinates is used:
>
> ETRF2000(R05) <--7par--> pseudo_NL_Bessel <--proj--> pseudo_RD <--corr-->
> true_RD
>
> Since this order of steps is not supported by Proj.4, EPSG etc., this
> procedure will probably be updated this year to:
>
> ETRF2000(R14) <--NTv2--> true_NL_Bessel <--proj--> RD
>
> However, I would like to see this possibility in Proj.4, EPSG, etc.:
>
> ETRF2000(R14) <--7par--> pseudo_NL_Bessel <--NTv2--> true_NL_Bessel
> <--proj--> true_RD
>
> This would be better for 2 reasons. First, the normal of the NL-Bessel
> ellipsoid is closer to the true vertical than the normal of ETRS89. Second,
> there are always stubborn users that will use RD outside the bounding box
> of
> the NTv2 grid (using: ETRF2000(R05) <--7par--> NL_Bessel <--proj--> RD). Of
> course they should not do that, but I know they will keep doing this and it
> is causing nasty problems at the edge of the bounding box. With the the
> combination of 7 parameters and a NTv2 grid, the values in the NTv2 grid
> could fade out to zero outside the Netherlands and the grid can cover the
> entire earth. This would produce complete nonsense for points outside the
> bounding box, but at least it will be the same consistent nonsense for all
> users without edge effects.
>
>
> Citation from  Van der Marel, 2016
> <http://www.citg.tudelft.nl/fileadmin/Faculteit/CiTG/Over_
> de_faculteit/Afdelingen/Afdeling_Geoscience_and_
> Remote_Sensing/Study/CTB3310_TerrestrialReferenceSystems_TRS_2-1a.pdf>
> :
> | A big difference between datum transformations and coordinate conversions
> is that the
> | parameters for the datum transformation are often empirically determined
> and thus subject
> | to measurement errors, whereas coordinate conversions are fully
> deterministic. More specific,
> | three possibilities need to be distinguished for the datum transformation
> parameters
> |
> | 1. The first possibility is that the datum transformation parameters are
> *conventional*. This
> | means they are chosen and therefore not stochastic. The datum
> transformation is then
> | just some sort of coordinate conversion (which are also not stochastic).
> |
> | 2. The second possibility is that the datum transformation parameters are
> *given*, but have
> | been derived by a third party through measurements. What often happens is
> that this
> | third party does new measurements and updates the transformation
> parameters occa-
> | sionally or at regular intervals. This is also related to the concepts of
> | reference system and reference frames. Reference frames are considered
> (different) realizations of the
> | same reference system, with different coordinates assigned to the points
> in the reference
> | frame, and often with different realizations of the transformation
> parameters. The sta-
> | tion coordinates and transformation parameters are stochastic, so new
> measurements,
> | mean new estimates that are different from the previous estimates.
> |
> | 3. The third possibility is that there is no third party that has
> determined the transformation
> | parameters, and you as user, have to *estimate *them using at least three
> common points
> | in both systems. In this case you will need coordinates from the other
> reference system.
> | Keep in mind that the coordinates from the external reference system all
> come from the
> | same realization, or, reference frame.
>
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-
> approximation-error-tp5313738p5314039.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170324/7c432d6c/attachment.html>

From martin.desruisseaux at geomatys.com  Fri Mar 24 05:53:55 2017
From: martin.desruisseaux at geomatys.com (Martin Desruisseaux)
Date: Fri, 24 Mar 2017 13:53:55 +0100
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490351360448-5314039.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<1490305994297-5313952.post@n6.nabble.com>
	<9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>
	<1490351360448-5314039.post@n6.nabble.com>
Message-ID: <4a36cb42-be2a-10ce-8374-ef054b036fb3@geomatys.com>

Hello Jochem

Le 24/03/2017 à 11:29, Jochem a écrit :

> I think we should make a distinction between reference systems and
> reference frames here (I assume you are familiar with that). As each
> frame of a system will have different parameters. For a frame only one
> set of parameters is needed. If these are multiple sets, one could
> combine the information of all these stochastic transformations in to
> one best least-squares estimated set of parameters.
>
In the case of NAD27 to WGS84 transformations in the EPSG database, all
the 80 transformations are between the same geodetic datum (I think
"geodetic datum" was the old ISO 19111 terminology for "reference
frame", but they are renaming that in the new ISO 19111 revision). There
is +towgs84 parameters for the whole USA, then different +towgs84 for
various smaller geographic areas (e.g. East of Texas, West of Texas,
etc.). The transformations for local areas have smaller errors than the
transformations for the whole USA. I do not know how those parameters
were determined, but I could imagine starting from the same set of
stations and using e.g. only the stations in Texas for determining the
+towgs84 parameters in Texas, etc.

For map projection libraries, this imply that:

  * For coordinate conversions, we only need the source and target CRS.
  * For coordinate transformations, in addition of the source and target
    CRS we also need the area of interest if we want to choose the most
    accurate transformation among the various possibilities.


> However, this is the case for the national grid (RD) of the Netherlands. RD
> is defined as the transformation (in ISO19111 terminology this would be a
> conversion?) from ETRS89, including a 7 parameter transformation, but also
> an correction grid on projected coordinates is used:  
>
> ETRF2000(R05) <--7par--> pseudo_NL_Bessel <--proj--> pseudo_RD <--corr-->
> true_RD

This look like a datum shift to me, so it would still be a
transformation in ISO 19111 terminology. Even if the new CRS is
officially defined by Bursa-Wolf parameters and all software produce the
same numerical results, the relationship with objects in the real world
would still have stochastic errors: if we have a ETRF2000 coordinate
that describes the location of a physical object, and if we transform
that coordinate to RD, then the location described by the new coordinate
may be slightly aside the physical object (otherwise we would not have
to do least-square fitting). Or did I missed something?

Note: this is not an objection to your change proposal. This is rather
an emphasis that coordinate operations should be associated to metadata
that allow users to evaluate implications of what they are doing.

    Martin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20170324/889c5577/attachment.html>

From ndzinn at comcast.net  Fri Mar 24 06:19:21 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Fri, 24 Mar 2017 08:19:21 -0500
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490346155435-5314008.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com><effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com><1490230135613-5313761.post@n6.nabble.com><75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com><1490273364020-5313855.post@n6.nabble.com><64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com><374E5CD7748E47079814CF5F53EC97A9@NoelDellPC><1490307208389-5313957.post@n6.nabble.com><F69FDE046C594323B4AF1016060AB4F8@NoelDellPC>
	<1490346155435-5314008.post@n6.nabble.com>
Message-ID: <275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC>

Jochem,

Thanks for your rapid, cheery responses that keep this interesting thread 
going.

You say, "won't be less accurate".

I do support an option (not a default) of concatenated, fully-populated 
(sines and cosines) rotation matrices for the 7-parameter transformation in 
proj4, which, for consistency in the industry, ought to be done the way 
(rotation order) ESRI do it.  Perhaps Melita can weigh in on that. 
Unfortunately, it won't be more accurate geodetically.

Having said that I need to repeat other comments made in this thread 
(notably by Martin, and paraphrasing now) about the difference between the 
numerical accuracy that you are pursuing and "geodetic accuracy".  For 
transformation between datums my ad hoc definition of "geodetic accuracy" is 
RMS error at the control points after transformation.  Unlike mathematically 
exact conversions, all transformations have error, and that's especially 
true between a world datum (your choice) and any classical, terrestrial 
(land surveying) datum such as those one comes across exploring for oil 
(which is the genesis of the EPSG dataset).

Having spent a career in oil exploration and having derived "datum shifts" 
between WGS72 and WGS84 and many local datums, I frequently had to combat 
the misperception that a 7-parameter (Bursa-Wolf of Helmert) transformation 
was more geodetically accurate than just three translations.  Folks say, "it 
has more parameters so it must be more accurate".  Well, those parameters 
are wasted in high correlations in a small-area derivation and they're not 
more accurate by my geodetic definition above.  For me this is an issue of 
appropriate geodesy versus misleading geodesy.

Jochem, I have challenge for you to illustrate this.  Share with me the 
coordinates of control points in a European country in both a world datum 
and a pre-satellite terrestrial datum.  You derive a 7-parameter shift 
between them.  I will spend my 7 parameters on multiple regression equations 
(necessarily short).  We'll see which transformation produces the lowest RMS 
error.  You can use sines and cosines in your rotation matrices.  The geoid 
is a messy complication in this.  We can limit this challenge to the 
horizontal if you wish.

Let me know.

Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Jochem
Sent: Friday, March 24, 2017 4:02 AM
To: proj at lists.maptools.org
Subject: Re: [Proj] +towgs84 approximation error

Hi Noel,

Your point on the correlations between translations and rotations was
already clear to me after your first email. However, I still don't
understand why this is so important to you. Since the coordinates
transformed with these correlated parameters won't be less accurate than the
ones with the better method you mention.

Regards, Jochem



--
View this message in context: 
http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314008.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From jochem.lesparre at kadaster.nl  Sat Mar 25 06:18:31 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Sat, 25 Mar 2017 06:18:31 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC>
References: <effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
	<1490307208389-5313957.post@n6.nabble.com>
	<F69FDE046C594323B4AF1016060AB4F8@NoelDellPC>
	<1490346155435-5314008.post@n6.nabble.com>
	<275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC>
Message-ID: <1490447911123-5314214.post@n6.nabble.com>

Hi Noel,

You mean you would like to see less rapid, but more cheery responses? I am
Sorry. I really do find the discussion with you and the others very
interesting en enjoyable. But, I notice we both tend to repeat ourselves,
which is not getting us somewhere. I'll try to break with that.

I am happy you support my suggestion of having the strict formulas as an
option. You are totally right that it would not be more accurate in a
geodetic sense, in most cases. However, are cases where the strict formulas
are more accurate, also geodetically. I'll explain.

The country where I was working this week has an imprecise (20 cm errors)
old triangulation network with large (40 arc-seconds) rotation parameters to
ITRF2008 at 2005.0=WGS84(G1762). They installed a continuously operating GNSS
reference station (CORS). Using that, they corrected the coordinates of
their first order triangulation points and changed the false Northing and
Easting to not mix corrected and uncorrected coordinates. By that they
introduced a new precise reference frame, but with the same large rotation
parameters to WGS84. The precise values of these parameters are still
unknown. But they started to log the GNSS observations of their CORS. As
soon as they acquired a full year of data, I will compute the precise
coordinates of their CORS relative to the IGS network and estimate the
transformation parameters to ITRF2014 using adjustment software that happens
to use the strict formulas. And I will continue to do that yearly. The
precision of this transformation to ITRS will be definitely be better than
the 4 cm approximation error of the default +towgs84 formulas. Does that
explain why I say I need the strict formulas also for geodetic precision? 

As I said I agree totally with your point that the 7 parameters are often
highly correlated, but I am doubting if that influences the precision of
transformed coordinates. All the other things you say are correct, no
doubts. An experiment (or challenge if you wish) would be very interesting. 

However, the challenge you suggest makes no sense to me. We both know that
old triangulation frames have a too low accuracy to make the strict formulas
necessary  (unless it would have enormous > 1 arc-minute rotations). So I
would like to alter the experiment on two points: use a GNSS corrected old
frame (like pseudo-RD of the Netherlands) with 1 cm relative standard
deviations, but with rotation angles to ETRS89 up to 40 arc-seconds (I can
just shift the Netherlands 1 km to the north to accomplish that, to simulate
an error of 1 km in the astronomical observations of the central point)... 

Kind regards, Jochem 

 



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314214.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Sat Mar 25 06:23:59 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Sat, 25 Mar 2017 06:23:59 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <4a36cb42-be2a-10ce-8374-ef054b036fb3@geomatys.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<1490305994297-5313952.post@n6.nabble.com>
	<9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>
	<1490351360448-5314039.post@n6.nabble.com>
	<4a36cb42-be2a-10ce-8374-ef054b036fb3@geomatys.com>
Message-ID: <1490448239558-5314215.post@n6.nabble.com>

Hello Martin,

What you describe about the 80 transformations to NAD27 sound as 80
different frames to me, or one frame that is in need of a NTv2 correction
grid instead of 80 attempts for a 7 parameter transformation.

> if we transform that coordinate to RD, then the location described by the
> new coordinate may be slightly 
> aside the physical object

The RD coordinates of any object in the Netherlands are by definition the
transformed  ETRF coordinates. With a new realisation of ETRS89 the ETRF
coordinates of objects can change. If this change is less than 1 cm, the RD
coordinates change too. If this change is larger than 1 cm we update the
transformation to keep the RD coordinates as close as possible to the 1918
values. 

I would describe this as a series of RD realisations (1918, 2000, 2004 and
2008 frames) which are all connected to ETRS89 realisations by a
transformation. Of course these transformations have been estimated on
stochastic data, however the transformations of the frames since 2000 are by
definition correct (conventional transformations) en will always point to
the same point as the ETRS89 coordinates.

Does that clarify the Dutch situation?

Regards, Jochem 




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314215.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Sat Mar 25 06:25:44 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Sat, 25 Mar 2017 06:25:44 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <CAH0YoEMVnQSsDw=gcLwroG4CaUUEOtRjjCMXTixacbC1-rGQFA@mail.gmail.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<1490305994297-5313952.post@n6.nabble.com>
	<9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>
	<1490351360448-5314039.post@n6.nabble.com>
	<CAH0YoEMVnQSsDw=gcLwroG4CaUUEOtRjjCMXTixacbC1-rGQFA@mail.gmail.com>
Message-ID: <1490448344774-5314216.post@n6.nabble.com>

Hi Thomas, 

This pipeline implementation will not automatically become available in
QGIS, right? I need it in QGIS to be able to transform maps instead of
points (keeping all the line and attribute information). But, I guess QGIS
is one of the downstream application projects you mention. Your description
of your developments sound very promising. I would definitely ask the QGIS
community to adopt it.

Regards, Jochem 




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314216.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From ndzinn at comcast.net  Sat Mar 25 08:02:03 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Sat, 25 Mar 2017 10:02:03 -0500
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490447911123-5314214.post@n6.nabble.com>
References: <effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com><1490230135613-5313761.post@n6.nabble.com><75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com><1490273364020-5313855.post@n6.nabble.com><64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com><374E5CD7748E47079814CF5F53EC97A9@NoelDellPC><1490307208389-5313957.post@n6.nabble.com><F69FDE046C594323B4AF1016060AB4F8@NoelDellPC><1490346155435-5314008.post@n6.nabble.com><275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC>
	<1490447911123-5314214.post@n6.nabble.com>
Message-ID: <D1781CD4F0E845B592769308D1C26A86@NoelDellPC>

Hi Jochem,

Being new to this listserv you should know that there are tourists like 
myself who hang around for the geodetic tidbits and there are those who do 
the real work of maintaining proj4.  While I'm happy to support your 
project, it's the vote of the latter that counts.  I believe that you've 
made your case.

Having reread this thread, I agree there has been repetition.  Having said 
that, many excellent points were made early on.  Maybe they bear repeating.

Thanks for this view into your interesting work, Jochem!  " Does that 
explain why I say I need the strict formulas also for geodetic precision?". 
Well, yes it does if you are using the strict formulas for the derivation of 
your transformation.  Must make for messy linearized observation equations. 
But 40 arc seconds of rotation is large.  I presume this isn't a country 
worked by C.F. Gauss!

The high parametric correlation that we agree upon has a practical 
consequence.  I presume that you will publish your datum shift and the 
translations will be rounded to the nearest millimeter, which is the 
numerical accuracy you mentioned earlier, and not to the full precision left 
over in your computer after the derivation.  From previous studies of 
small-area derivations I know that the dilution of precision (DOP) for the 
translations will be at least 10 and as much as 100 (or more for a country 
the size of Cyprus).  So, I expect that an average publication truncation 
error of 0.0005m will escalate to 0.005 or 0.05 (or more) at the surface 
depending upon where you're working.  Something to consider with your tight 
error budget, but I'm sure that you have.  BTW, the translation DOP for a 
3-parameter shift must be about 1.

Regarding your revised challenge, I was hoping for somewhat more geodetic 
(stochastic) inaccuracy than 1cm to better absorb numerical differences 
between the small-angle approximation and your fully-populated rotation 
matrix.  But your suggestion is interesting nonetheless.  I would indeed 
like to know how well regression equations can model a 40 arc second 
rotation (with minimal parameters).  So, I'm up for it.

All the best,
Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Jochem
Sent: Saturday, March 25, 2017 8:18 AM
To: proj at lists.maptools.org
Subject: Re: [Proj] +towgs84 approximation error

Hi Noel,

You mean you would like to see less rapid, but more cheery responses? I am
Sorry. I really do find the discussion with you and the others very
interesting en enjoyable. But, I notice we both tend to repeat ourselves,
which is not getting us somewhere. I'll try to break with that.

I am happy you support my suggestion of having the strict formulas as an
option. You are totally right that it would not be more accurate in a
geodetic sense, in most cases. However, are cases where the strict formulas
are more accurate, also geodetically. I'll explain.

The country where I was working this week has an imprecise (20 cm errors)
old triangulation network with large (40 arc-seconds) rotation parameters to
ITRF2008 at 2005.0=WGS84(G1762). They installed a continuously operating GNSS
reference station (CORS). Using that, they corrected the coordinates of
their first order triangulation points and changed the false Northing and
Easting to not mix corrected and uncorrected coordinates. By that they
introduced a new precise reference frame, but with the same large rotation
parameters to WGS84. The precise values of these parameters are still
unknown. But they started to log the GNSS observations of their CORS. As
soon as they acquired a full year of data, I will compute the precise
coordinates of their CORS relative to the IGS network and estimate the
transformation parameters to ITRF2014 using adjustment software that happens
to use the strict formulas. And I will continue to do that yearly. The
precision of this transformation to ITRS will be definitely be better than
the 4 cm approximation error of the default +towgs84 formulas. Does that
explain why I say I need the strict formulas also for geodetic precision?

As I said I agree totally with your point that the 7 parameters are often
highly correlated, but I am doubting if that influences the precision of
transformed coordinates. All the other things you say are correct, no
doubts. An experiment (or challenge if you wish) would be very interesting.

However, the challenge you suggest makes no sense to me. We both know that
old triangulation frames have a too low accuracy to make the strict formulas
necessary  (unless it would have enormous > 1 arc-minute rotations). So I
would like to alter the experiment on two points: use a GNSS corrected old
frame (like pseudo-RD of the Netherlands) with 1 cm relative standard
deviations, but with rotation angles to ETRS89 up to 40 arc-seconds (I can
just shift the Netherlands 1 km to the north to accomplish that, to simulate
an error of 1 km in the astronomical observations of the central point)...

Kind regards, Jochem





--
View this message in context: 
http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314214.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From jochem.lesparre at kadaster.nl  Sat Mar 25 08:02:09 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Sat, 25 Mar 2017 08:02:09 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490447911123-5314214.post@n6.nabble.com>
References: <1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
	<1490307208389-5313957.post@n6.nabble.com>
	<F69FDE046C594323B4AF1016060AB4F8@NoelDellPC>
	<1490346155435-5314008.post@n6.nabble.com>
	<275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC>
	<1490447911123-5314214.post@n6.nabble.com>
Message-ID: <1490454129329-5314224.post@n6.nabble.com>

PS:

Noel, I read your email again, and I think I misunderstood your suggestion
for the "challenge". It is not about the strict/approximate formulas, but
only about correlated/uncorrelated parameters, right? Then we can do it
exactly as you suggested. I still see it as an experiment. I am really
interested in the outcome, not in winning.

Kind regards, Jochem




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314224.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From ndzinn at comcast.net  Sat Mar 25 09:09:24 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Sat, 25 Mar 2017 11:09:24 -0500
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490454129329-5314224.post@n6.nabble.com>
References: <1490230135613-5313761.post@n6.nabble.com><75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com><1490273364020-5313855.post@n6.nabble.com><64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com><374E5CD7748E47079814CF5F53EC97A9@NoelDellPC><1490307208389-5313957.post@n6.nabble.com><F69FDE046C594323B4AF1016060AB4F8@NoelDellPC><1490346155435-5314008.post@n6.nabble.com><275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC><1490447911123-5314214.post@n6.nabble.com>
	<1490454129329-5314224.post@n6.nabble.com>
Message-ID: <7EA0A4B201C14118B369F87F4A018C39@NoelDellPC>

Jochem, yes, the original challenge was to demonstrate that the 7 parameters 
of a Helmert transformation derived in a small area are squandered due to 
the high correlations with the rotations (regardless of how the rotations 
are approximated, or not) and that 7 coefficients could be "spent" better in 
2 or 3 regression equations depending upon the dimensionality of the 
experiment, but we'd have to decide how to handle the geoid, or not.  Is 
this your understanding?  -Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Jochem
Sent: Saturday, March 25, 2017 10:02 AM
To: proj at lists.maptools.org
Subject: Re: [Proj] +towgs84 approximation error

PS:

Noel, I read your email again, and I think I misunderstood your suggestion
for the "challenge". It is not about the strict/approximate formulas, but
only about correlated/uncorrelated parameters, right? Then we can do it
exactly as you suggested. I still see it as an experiment. I am really
interested in the outcome, not in winning.

Kind regards, Jochem




--
View this message in context: 
http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314224.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From kreve at sdfe.dk  Mon Mar 27 01:37:18 2017
From: kreve at sdfe.dk (Kristian Evers)
Date: Mon, 27 Mar 2017 08:37:18 +0000
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490448344774-5314216.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
	<effd0e3b-43da-4c52-41d6-40854be1b08b@geomatys.com>
	<1490230135613-5313761.post@n6.nabble.com>
	<75de22fe-96e9-2bb6-9c23-0a31c0123c59@geomatys.com>
	<1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<1490305994297-5313952.post@n6.nabble.com>
	<9ef92535-9a4a-9fba-9d77-f27ad599df8d@geomatys.com>
	<1490351360448-5314039.post@n6.nabble.com>
	<CAH0YoEMVnQSsDw=gcLwroG4CaUUEOtRjjCMXTixacbC1-rGQFA@mail.gmail.com>
	<1490448344774-5314216.post@n6.nabble.com>
Message-ID: <2E885BB293AF0448A0181138489E9A0E99FA320D@S000014.PROD.SITAD.DK>

Let me answer this on behalf of Thomas.

The pipeline implementation will be available in QGIS when the next version of PROJ.4 is released and the various distribution platforms adopt it (OSGeo4W for instance). The most likely scenario is that the QGIS developers doesn't change how they interface with PROJ.4. This will still give you the pipeline functionality but only a subset. You will miss the option to include time-varying transformations and you will probably experience a round-about way of setting up your transformation parameters. So eventually it will be available but you will have to perform some mental agility to use the new functionality within the existing QGIS setup.

/Kristian

> -----Oprindelig meddelelse-----
> Fra: proj-bounces at lists.maptools.org [mailto:proj-
> bounces at lists.maptools.org] På vegne af Jochem
> Sendt: 25. marts 2017 14:26
> Til: proj at lists.maptools.org
> Emne: Re: [Proj] +towgs84 approximation error
> 
> Hi Thomas,
> 
> This pipeline implementation will not automatically become available in
> QGIS, right? I need it in QGIS to be able to transform maps instead of
> points (keeping all the line and attribute information). But, I guess QGIS
> is one of the downstream application projects you mention. Your description
> of your developments sound very promising. I would definitely ask the QGIS
> community to adopt it.
> 
> Regards, Jochem
> 
> 
> 
> 
> --
> View this message in context: http://osgeo-
> org.1560.x6.nabble.com/towgs84-approximation-error-
> tp5313738p5314216.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj


From jochem.lesparre at kadaster.nl  Tue Mar 28 00:34:30 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Tue, 28 Mar 2017 00:34:30 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <7EA0A4B201C14118B369F87F4A018C39@NoelDellPC>
References: <1490273364020-5313855.post@n6.nabble.com>
	<64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com>
	<374E5CD7748E47079814CF5F53EC97A9@NoelDellPC>
	<1490307208389-5313957.post@n6.nabble.com>
	<F69FDE046C594323B4AF1016060AB4F8@NoelDellPC>
	<1490346155435-5314008.post@n6.nabble.com>
	<275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC>
	<1490447911123-5314214.post@n6.nabble.com>
	<1490454129329-5314224.post@n6.nabble.com>
	<7EA0A4B201C14118B369F87F4A018C39@NoelDellPC>
Message-ID: <1490686470431-5314568.post@n6.nabble.com>

Hi Noel,

Thanks for your friendly response. I am back in the Netherlands now with my
normal duties. Therefore, it took a bit more time to reply.

The country I visited is definitely not a country where Gauss has been
working, considering the large rotations and scale factor.

Regarding the challenge: If you like more stochastic noise in the
observations, we can take the original coordinates of the triangulation. I
am most interested in the effect for the Netherlands (rotation angles up to
2 arc-seconds). Or would you like 40 arc-second rotations better? The
ellipsoidal heights in the old triangulation are close to the levelling
heights, or I could use our precise national geoid to compute ellipsoidal
heights.

Regards, Jochem 





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314568.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jochem.lesparre at kadaster.nl  Tue Mar 28 01:08:45 2017
From: jochem.lesparre at kadaster.nl (Jochem)
Date: Tue, 28 Mar 2017 01:08:45 -0700 (MST)
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490218889442-5313738.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
Message-ID: <1490688525529-5314573.post@n6.nabble.com>

Dear all,

I'll give a short update.

For my home country, the approximation error is just 0.2 mm. For the country
I visited. I do not have the time to learn how to contribute to Proj.4 with
Git (I am interested to learn this, but I have to give other things
priority), nor can I wait for a new version of Proj.4 to be implemented in
QGIS. Luckily, I found a workaround for the country I visited:

I transformed a point in the centre of the country with the strict
parameters and the approximated formulas. By this I found approximation
errors in XYZ of that centre point. Next I added these approximation errors
to the strict translation parameters. By that I get perfect results for the
centre point with the tweaked parameters and the approximate formulas of
Proj.4. For the extreme points of the country, the error is <0.5 mm with
this tweaked transformation. This probably solves my problem for the moment.
However, this works only in one direction. So, I would have to use different
tweaked +towgs84 parameters for the transformation from the old to the new
coordinate frame than for the transformation from new to old, which is a
recipe for future mistakes. 

Regards, Jochem



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314573.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From ndzinn at comcast.net  Tue Mar 28 06:40:45 2017
From: ndzinn at comcast.net (Noel Zinn (cc))
Date: Tue, 28 Mar 2017 08:40:45 -0500
Subject: [Proj] +towgs84 approximation error
In-Reply-To: <1490686470431-5314568.post@n6.nabble.com>
References: <1490273364020-5313855.post@n6.nabble.com><64f5103b-9905-b231-2492-bf0019b69da6@geomatys.com><374E5CD7748E47079814CF5F53EC97A9@NoelDellPC><1490307208389-5313957.post@n6.nabble.com><F69FDE046C594323B4AF1016060AB4F8@NoelDellPC><1490346155435-5314008.post@n6.nabble.com><275DD9B0FBC44857B10F356F74BACB0D@NoelDellPC><1490447911123-5314214.post@n6.nabble.com><1490454129329-5314224.post@n6.nabble.com><7EA0A4B201C14118B369F87F4A018C39@NoelDellPC>
	<1490686470431-5314568.post@n6.nabble.com>
Message-ID: <84764DBCA2E9447BB7C2F791AA773129@NoelDellPC>

So many options, Jochem!  Old-timer that I am, my field experience in the 
late 1970s and 1980s was occupying triangulation (and traverse) points with 
JMR and Magnavox TRANSIT receivers.  Stochastic noise was generous with both 
technologies.  So, let's do something different.  How about minimal 
stochastics and extreme rotations?  That should exacerbate the deficiencies 
of either an ill-determined 7-parameter derivation or multiple regression 
equations (with 7 coefficients among them, yet to be derived).  Handle the 
vertical as you prefer.  OK?  -Noel

Noel Zinn, Principal, Hydrometronics LLC
+1-832-539-1472 (office), +1-281-221-0051 (cell)
noel.zinn at hydrometronics.com (email)
http://www.hydrometronics.com (website)

-----Original Message----- 
From: Jochem
Sent: Tuesday, March 28, 2017 2:34 AM
To: proj at lists.maptools.org
Subject: Re: [Proj] +towgs84 approximation error

Hi Noel,

Thanks for your friendly response. I am back in the Netherlands now with my
normal duties. Therefore, it took a bit more time to reply.

The country I visited is definitely not a country where Gauss has been
working, considering the large rotations and scale factor.

Regarding the challenge: If you like more stochastic noise in the
observations, we can take the original coordinates of the triangulation. I
am most interested in the effect for the Netherlands (rotation angles up to
2 arc-seconds). Or would you like 40 arc-second rotations better? The
ellipsoidal heights in the old triangulation are close to the levelling
heights, or I could use our precise national geoid to compute ellipsoidal
heights.

Regards, Jochem





--
View this message in context: 
http://osgeo-org.1560.x6.nabble.com/towgs84-approximation-error-tp5313738p5314568.html
Sent from the PROJ.4 mailing list archive at Nabble.com.
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj 



From support at mnspoint.com  Tue Mar 28 22:48:07 2017
From: support at mnspoint.com (support at mnspoint.com)
Date: Wed, 29 Mar 2017 08:48:07 +0300
Subject: [Proj] "8-Parameter Transformation"
In-Reply-To: <1490218889442-5313738.post@n6.nabble.com>
References: <1490218889442-5313738.post@n6.nabble.com>
Message-ID: <e9d042a00273e92f6024836626c48d1d@mnspoint.com>

Hello,

it looks like one solution could be to add 8th parameter to the 
"towgs84" statement.

The additional 8th parameter would define the exact method how the 
transformation should be done (and the default would be the same as is 
used nowadays). That would make it then possible in the future to define 
the "towgs84" more accurately .. and have also several versions of it 
available at the same time.

Something like..

Now we have for example:

     towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232

But we could also have:

     towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232,How

where "How" is some predefined identifier or number or mechanism like:

     towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232,J2017

or

     towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232,23

or (maybe even feed some parameters to the method via the 8th parameter)

     towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232,XYZ(2017)

etc.. etc...

in the Proj.4 library you (and maybe a fresh version also) would then 
try to figure out if there is this 8th parameter given and if so switch 
to some other transformation method according to the program and the 
parameter.

This would of course require some additional programming. If the 8th 
parameter is omitted then everything would default to the same as it is 
today. (And hopefully if using old version of the Proj.4 library .. the 
8th parameter would just be ignored). I have not tested how the library 
reacts to 8th parameter as it is now when it does not expect it?!

Regards: Janne.

-------------------------------------------------


Jochem kirjoitti 2017-03-22 23:41:
> Hello,
> 
> I joined the mailing list because I noticed that the PROJ.4 library 
> uses
> approximate formulas for the 7 parameter coordinate transformation 
> defined
> by +towgs84 (technical details: The elements of the rotation matrix are 
> the
> rotation angles instead of the product of sines and cosines of the 
> angles).
> For really small rotation angles this gives the same result, but not 
> for
> larger rotations.
> 
> For my current application I want to transform a map in QGIS with 1 mm
> accuracy. However, the approximation causes an error of 4 cm. Since 
> PROJ.4
> normally gives results within 0.1 mm accuracy, I did not expect such
> approximation.
> 
> What can I do to help to fix this?
> 
> Regards, Jochem


