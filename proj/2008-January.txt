From massimo at studiodemarchi.net  Wed Jan  2 01:00:07 2008
From: massimo at studiodemarchi.net (Massimo De Marchi)
Date: Wed, 02 Jan 2008 10:00:07 +0100
Subject: [Proj] Question about Italian conversion
In-Reply-To: <86782b610712291209g44e0c0c0k62bbee67bc88d10b@mail.gmail.com>
References: <C39817F3.FA88%ovv@hetnet.nl>	<1198704936.4772c9283ab8a@webmail.eutelia.it>	<4776A5DC.9080303@pobox.com>
	<86782b610712291209g44e0c0c0k62bbee67bc88d10b@mail.gmail.com>
Message-ID: <477B5297.7070405@studiodemarchi.net>

Thanks for the help!

Massimo



From arno at agerrius.nl  Thu Jan  3 01:03:23 2008
From: arno at agerrius.nl (Arno Gerretsen)
Date: Thu, 03 Jan 2008 10:03:23 +0100
Subject: [Proj] WGS84 to Minnesota State Plane South
Message-ID: <477CA4DB.5030707@agerrius.nl>

Hi,

I am trying to convert some data for a friend from WGS84 lat/lon to 
Minnesota State Plane South. I use the proj4 library for that, but the 
results do not match with some of the control point data he gave me. So 
I am wondering if I maybe did something wrong in my code. Here is the 
code I used:

PJ *prjState = pj_init_plus("+proj=lcc +lat_0=43 +lon_0=-94 
+lat_1=45.21666666666666666666666666666666666 
+lat_2=43.783333333333333333333333 +x_0=800000 +y_0=100000 +ellps=GRS80 
+datum=NAD83 +units=ft +no_defs");
PJ *prjWGS = pj_init_plus("+proj=latlong +ellps=WGS84 +datum=WGS84");

double x[1], y[1], z[1];
int err;

x[0] = -93.242251388888888888888888888889 * DEG_TO_RAD;
y[0] = 44.887752777777777777777777777778 * DEG_TO_RAD;
z[0] = 0.0;

err = pj_transform(prjWGS, prjState, 1, 1, x, y, z);

With this code and for the lat/lon values listed in the code, I get the 
following State Plane coordinates returned: 2821057.917382 1017161.112401

While the reference data says it should be: 2821052.29398607, 
1017159.04559559

As you can see the difference is a few feet. Can anybody tell me if I 
have done something wrong in my code, or should I doubt the quality of 
the reference data :)?

Thanks,

Arno


From AnthonyD at rocketmail.com  Thu Jan  3 04:38:59 2008
From: AnthonyD at rocketmail.com (Anthony Dunk)
Date: Thu, 3 Jan 2008 23:38:59 +1100 (EST)
Subject: [Proj] WGS84 to Minnesota State Plane South
In-Reply-To: <477CA4DB.5030707@agerrius.nl>
Message-ID: <560666.28304.qm@web50812.mail.re2.yahoo.com>

Using my own coordinate conversion program (which calls the PROJ dll),
I got the following results when converting your test point from WGS84
lat/lon to US State Plane (NAD83, US survey feet) Minesota 2203, South
Zone: Easting=2821052.4, Northing=1017159.1. These results are quite
close to the reference point you gave.

I couldn't see any differences in the parameters I was passing to PROJ
compared to yours.

The PROJ string I'm using for this US state plane coordinate system is:

+proj=lcc +lat_1=48.7833333333 +lat_2=45.2166666667 +lat_0=43
+lon_0=-94 +x_0=800000 +y_0=100000 +a=6378137 +rf=298.257222101
+to_meter=0.3048006

Anthony.

--- Arno Gerretsen <arno at agerrius.nl> wrote:

> Hi,
> 
> I am trying to convert some data for a friend from WGS84 lat/lon to 
> Minnesota State Plane South. I use the proj4 library for that, but
> the 
> results do not match with some of the control point data he gave me.
> So 
> I am wondering if I maybe did something wrong in my code. Here is the
> 
> code I used:
> 
> PJ *prjState = pj_init_plus("+proj=lcc +lat_0=43 +lon_0=-94 
> +lat_1=45.21666666666666666666666666666666666 
> +lat_2=43.783333333333333333333333 +x_0=800000 +y_0=100000
> +ellps=GRS80 
> +datum=NAD83 +units=ft +no_defs");
> PJ *prjWGS = pj_init_plus("+proj=latlong +ellps=WGS84 +datum=WGS84");
> 
> double x[1], y[1], z[1];
> int err;
> 
> x[0] = -93.242251388888888888888888888889 * DEG_TO_RAD;
> y[0] = 44.887752777777777777777777777778 * DEG_TO_RAD;
> z[0] = 0.0;
> 
> err = pj_transform(prjWGS, prjState, 1, 1, x, y, z);
> 
> With this code and for the lat/lon values listed in the code, I get
> the 
> following State Plane coordinates returned: 2821057.917382
> 1017161.112401
> 
> While the reference data says it should be: 2821052.29398607, 
> 1017159.04559559
> 
> As you can see the difference is a few feet. Can anybody tell me if I
> 
> have done something wrong in my code, or should I doubt the quality
> of 
> the reference data :)?
> 
> Thanks,
> 
> Arno
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
> 


----
Save power, save the planet!


      Make the switch to the world's best email. Get the new Yahoo!7 Mail now. www.yahoo7.com.au/worldsbestemail




From roger at opq.se  Thu Jan  3 05:53:50 2008
From: roger at opq.se (Roger Oberholtzer)
Date: Thu, 03 Jan 2008 14:53:50 +0100
Subject: [Proj] WGS84 to Minnesota State Plane South
In-Reply-To: <560666.28304.qm@web50812.mail.re2.yahoo.com>
References: <560666.28304.qm@web50812.mail.re2.yahoo.com>
Message-ID: <1199368431.21917.18.camel@acme.pacific>

On Thu, 2008-01-03 at 23:38 +1100, Anthony Dunk wrote:
> Using my own coordinate conversion program (which calls the PROJ dll),
> I got the following results when converting your test point from WGS84
> lat/lon to US State Plane (NAD83, US survey feet) Minesota 2203, South
> Zone: Easting=2821052.4, Northing=1017159.1. These results are quite
> close to the reference point you gave.
> 
> I couldn't see any differences in the parameters I was passing to PROJ
> compared to yours.
> 
> The PROJ string I'm using for this US state plane coordinate system is:
> 
> +proj=lcc +lat_1=48.7833333333 +lat_2=45.2166666667 +lat_0=43
> +lon_0=-94 +x_0=800000 +y_0=100000 +a=6378137 +rf=298.257222101
> +to_meter=0.3048006

Your last three (+a, +rf and +to_meter) are not in Anthony's parameters.
Could they be different?

> 
> Anthony.
> 
> --- Arno Gerretsen <arno at agerrius.nl> wrote:
> 
> > Hi,
> > 
> > I am trying to convert some data for a friend from WGS84 lat/lon to 
> > Minnesota State Plane South. I use the proj4 library for that, but
> > the 
> > results do not match with some of the control point data he gave me.
> > So 
> > I am wondering if I maybe did something wrong in my code. Here is the
> > 
> > code I used:
> > 
> > PJ *prjState = pj_init_plus("+proj=lcc +lat_0=43 +lon_0=-94 
> > +lat_1=45.21666666666666666666666666666666666 
> > +lat_2=43.783333333333333333333333 +x_0=800000 +y_0=100000
> > +ellps=GRS80 
> > +datum=NAD83 +units=ft +no_defs");
> > PJ *prjWGS = pj_init_plus("+proj=latlong +ellps=WGS84 +datum=WGS84");
> > 
> > double x[1], y[1], z[1];
> > int err;
> > 
> > x[0] = -93.242251388888888888888888888889 * DEG_TO_RAD;
> > y[0] = 44.887752777777777777777777777778 * DEG_TO_RAD;
> > z[0] = 0.0;
> > 
> > err = pj_transform(prjWGS, prjState, 1, 1, x, y, z);
> > 
> > With this code and for the lat/lon values listed in the code, I get
> > the 
> > following State Plane coordinates returned: 2821057.917382
> > 1017161.112401
> > 
> > While the reference data says it should be: 2821052.29398607, 
> > 1017159.04559559
> > 
> > As you can see the difference is a few feet. Can anybody tell me if I
> > 
> > have done something wrong in my code, or should I doubt the quality
> > of 
> > the reference data :)?
> > 
> > Thanks,
> > 
> > Arno
> > _______________________________________________
> > Proj mailing list
> > Proj at lists.maptools.org
> > http://lists.maptools.org/mailman/listinfo/proj
> > 
> 
> 
> ----
> Save power, save the planet!
> 
> 
>       Make the switch to the world's best email. Get the new Yahoo!7 Mail now. www.yahoo7.com.au/worldsbestemail
> 
> 
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
-- 
Roger Oberholtzer

OPQ Systems / Ramböll RST

Ramböll Sverige AB
Kapellgränd 7
P.O. Box 4205
SE-102 65 Stockholm, Sweden

Office: Int +46 8-615 60 20
Mobile: Int +46 70-815 1696



From EMiller at dfg.ca.gov  Thu Jan  3 08:06:39 2008
From: EMiller at dfg.ca.gov (Eric Miller)
Date: Thu, 03 Jan 2008 08:06:39 -0800
Subject: [Proj] WGS84 to Minnesota State Plane South
In-Reply-To: <477CA4DB.5030707@agerrius.nl>
References: <477CA4DB.5030707@agerrius.nl>
Message-ID: <477C978E.95FD.00E4.0@dfg.ca.gov>

It's probably the difference between the international foot "ft" and the US Survey foot "us_ft".  There's a lot of confusion about this with the state plane coordinate systems.  I think it's pretty universal that the NAD27 variants are all "us_ft", but when the NAD83 variants were adopted, they were all supposed to use meters.  However, different states and jurisdictions did different things and you'll see all three units used (meters, us_ft and ft).

>>> On 1/3/2008 at 1:03 AM, Arno Gerretsen <arno at agerrius.nl> wrote:
> Hi,
> 
> I am trying to convert some data for a friend from WGS84 lat/lon to 
> Minnesota State Plane South. I use the proj4 library for that, but the 
> results do not match with some of the control point data he gave me. So 
> I am wondering if I maybe did something wrong in my code. Here is the 
> code I used:
> 
> PJ *prjState = pj_init_plus("+proj=lcc +lat_0=43 +lon_0=-94 
> +lat_1=45.21666666666666666666666666666666666 
> +lat_2=43.783333333333333333333333 +x_0=800000 +y_0=100000 +ellps=GRS80 
> +datum=NAD83 +units=ft +no_defs");
> PJ *prjWGS = pj_init_plus("+proj=latlong +ellps=WGS84 +datum=WGS84");
> 
> double x[1], y[1], z[1];
> int err;
> 
> x[0] = -93.242251388888888888888888888889 * DEG_TO_RAD;
> y[0] = 44.887752777777777777777777777778 * DEG_TO_RAD;
> z[0] = 0.0;
> 
> err = pj_transform(prjWGS, prjState, 1, 1, x, y, z);
> 
> With this code and for the lat/lon values listed in the code, I get the 
> following State Plane coordinates returned: 2821057.917382 1017161.112401
> 
> While the reference data says it should be: 2821052.29398607, 
> 1017159.04559559
> 
> As you can see the difference is a few feet. Can anybody tell me if I 
> have done something wrong in my code, or should I doubt the quality of 
> the reference data :)?
> 
> Thanks,
> 
> Arno
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org 
> http://lists.maptools.org/mailman/listinfo/proj




From arno at agerrius.nl  Thu Jan  3 08:10:42 2008
From: arno at agerrius.nl (Arno Gerretsen)
Date: Thu, 03 Jan 2008 17:10:42 +0100
Subject: [Proj] WGS84 to Minnesota State Plane South
In-Reply-To: <560666.28304.qm@web50812.mail.re2.yahoo.com>
References: <560666.28304.qm@web50812.mail.re2.yahoo.com>
Message-ID: <1199376642.6211.24.camel@ag6400>

Thanks Anthony, your proj string helped me solving the problem. It
turned out to be a problem with the meter to feet conversion. In the
stirng I used I had tried both +units=ft and +units=m with my own
multiplication by 0.3048 to get meters. Now it turns out that is where
the problem was, I had to use 0.3048006 as you did. I did not know there
was a different between a foot and a US survey foot.

But it seems that the proj library also uses the 0.3048 factor when I
set the units to feet, is that what it is supposed to do?

Arno


On Thu, 2008-01-03 at 23:38 +1100, Anthony Dunk wrote:
> Using my own coordinate conversion program (which calls the PROJ dll),
> I got the following results when converting your test point from WGS84
> lat/lon to US State Plane (NAD83, US survey feet) Minesota 2203, South
> Zone: Easting=2821052.4, Northing=1017159.1. These results are quite
> close to the reference point you gave.
> 
> I couldn't see any differences in the parameters I was passing to PROJ
> compared to yours.
> 
> The PROJ string I'm using for this US state plane coordinate system is:
> 
> +proj=lcc +lat_1=48.7833333333 +lat_2=45.2166666667 +lat_0=43
> +lon_0=-94 +x_0=800000 +y_0=100000 +a=6378137 +rf=298.257222101
> +to_meter=0.3048006
> 
> Anthony.
> 
> --- Arno Gerretsen <arno at agerrius.nl> wrote:
> 
> > Hi,
> > 
> > I am trying to convert some data for a friend from WGS84 lat/lon to 
> > Minnesota State Plane South. I use the proj4 library for that, but
> > the 
> > results do not match with some of the control point data he gave me.
> > So 
> > I am wondering if I maybe did something wrong in my code. Here is the
> > 
> > code I used:
> > 
> > PJ *prjState = pj_init_plus("+proj=lcc +lat_0=43 +lon_0=-94 
> > +lat_1=45.21666666666666666666666666666666666 
> > +lat_2=43.783333333333333333333333 +x_0=800000 +y_0=100000
> > +ellps=GRS80 
> > +datum=NAD83 +units=ft +no_defs");
> > PJ *prjWGS = pj_init_plus("+proj=latlong +ellps=WGS84 +datum=WGS84");
> > 
> > double x[1], y[1], z[1];
> > int err;
> > 
> > x[0] = -93.242251388888888888888888888889 * DEG_TO_RAD;
> > y[0] = 44.887752777777777777777777777778 * DEG_TO_RAD;
> > z[0] = 0.0;
> > 
> > err = pj_transform(prjWGS, prjState, 1, 1, x, y, z);
> > 
> > With this code and for the lat/lon values listed in the code, I get
> > the 
> > following State Plane coordinates returned: 2821057.917382
> > 1017161.112401
> > 
> > While the reference data says it should be: 2821052.29398607, 
> > 1017159.04559559
> > 
> > As you can see the difference is a few feet. Can anybody tell me if I
> > 
> > have done something wrong in my code, or should I doubt the quality
> > of 
> > the reference data :)?
> > 
> > Thanks,
> > 
> > Arno
> > _______________________________________________
> > Proj mailing list
> > Proj at lists.maptools.org
> > http://lists.maptools.org/mailman/listinfo/proj
> > 
> 
> 
> ----
> Save power, save the planet!
> 
> 
>       Make the switch to the world's best email. Get the new Yahoo!7 Mail now. www.yahoo7.com.au/worldsbestemail
> 
> 
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj



From ndzinn at comcast.net  Thu Jan  3 08:42:18 2008
From: ndzinn at comcast.net (Noel Zinn)
Date: Thu, 3 Jan 2008 10:42:18 -0600
Subject: [Proj] WGS84 to Minnesota State Plane South
In-Reply-To: <1199376642.6211.24.camel@ag6400>
References: <560666.28304.qm@web50812.mail.re2.yahoo.com>
	<1199376642.6211.24.camel@ag6400>
Message-ID: <000601c84e27$9b3e6db0$6401a8c0@PowerSpec>


FYI, 

The EXACT conversion factor is the ration of two integers, viz.

1200/3937

Noel


-----Original Message-----
From: proj-bounces at lists.maptools.org
[mailto:proj-bounces at lists.maptools.org] On Behalf Of Arno Gerretsen
Sent: Thursday, January 03, 2008 10:11 AM
To: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] WGS84 to Minnesota State Plane South

Thanks Anthony, your proj string helped me solving the problem. It
turned out to be a problem with the meter to feet conversion. In the
stirng I used I had tried both +units=ft and +units=m with my own
multiplication by 0.3048 to get meters. Now it turns out that is where
the problem was, I had to use 0.3048006 as you did. I did not know there
was a different between a foot and a US survey foot.

But it seems that the proj library also uses the 0.3048 factor when I
set the units to feet, is that what it is supposed to do?

Arno


On Thu, 2008-01-03 at 23:38 +1100, Anthony Dunk wrote:
> Using my own coordinate conversion program (which calls the PROJ dll),
> I got the following results when converting your test point from WGS84
> lat/lon to US State Plane (NAD83, US survey feet) Minesota 2203, South
> Zone: Easting=2821052.4, Northing=1017159.1. These results are quite
> close to the reference point you gave.
> 
> I couldn't see any differences in the parameters I was passing to PROJ
> compared to yours.
> 
> The PROJ string I'm using for this US state plane coordinate system is:
> 
> +proj=lcc +lat_1=48.7833333333 +lat_2=45.2166666667 +lat_0=43
> +lon_0=-94 +x_0=800000 +y_0=100000 +a=6378137 +rf=298.257222101
> +to_meter=0.3048006
> 
> Anthony.
> 
> --- Arno Gerretsen <arno at agerrius.nl> wrote:
> 
> > Hi,
> > 
> > I am trying to convert some data for a friend from WGS84 lat/lon to 
> > Minnesota State Plane South. I use the proj4 library for that, but
> > the 
> > results do not match with some of the control point data he gave me.
> > So 
> > I am wondering if I maybe did something wrong in my code. Here is the
> > 
> > code I used:
> > 
> > PJ *prjState = pj_init_plus("+proj=lcc +lat_0=43 +lon_0=-94 
> > +lat_1=45.21666666666666666666666666666666666 
> > +lat_2=43.783333333333333333333333 +x_0=800000 +y_0=100000
> > +ellps=GRS80 
> > +datum=NAD83 +units=ft +no_defs");
> > PJ *prjWGS = pj_init_plus("+proj=latlong +ellps=WGS84 +datum=WGS84");
> > 
> > double x[1], y[1], z[1];
> > int err;
> > 
> > x[0] = -93.242251388888888888888888888889 * DEG_TO_RAD;
> > y[0] = 44.887752777777777777777777777778 * DEG_TO_RAD;
> > z[0] = 0.0;
> > 
> > err = pj_transform(prjWGS, prjState, 1, 1, x, y, z);
> > 
> > With this code and for the lat/lon values listed in the code, I get
> > the 
> > following State Plane coordinates returned: 2821057.917382
> > 1017161.112401
> > 
> > While the reference data says it should be: 2821052.29398607, 
> > 1017159.04559559
> > 
> > As you can see the difference is a few feet. Can anybody tell me if I
> > 
> > have done something wrong in my code, or should I doubt the quality
> > of 
> > the reference data :)?
> > 
> > Thanks,
> > 
> > Arno
> > _______________________________________________
> > Proj mailing list
> > Proj at lists.maptools.org
> > http://lists.maptools.org/mailman/listinfo/proj
> > 
> 
> 
> ----
> Save power, save the planet!
> 
> 
>       Make the switch to the world's best email. Get the new Yahoo!7 Mail
now. www.yahoo7.com.au/worldsbestemail
> 
> 
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj



From geraldi.evenden at gmail.com  Thu Jan  3 09:01:46 2008
From: geraldi.evenden at gmail.com (Gerald I. Evenden)
Date: Thu, 3 Jan 2008 12:01:46 -0500
Subject: [Proj] WGS84 to Minnesota State Plane South
In-Reply-To: <1199376642.6211.24.camel@ag6400>
References: <560666.28304.qm@web50812.mail.re2.yahoo.com>
	<1199376642.6211.24.camel@ag6400>
Message-ID: <200801031201.46142.geraldi.evenden@gmail.com>

On Thursday 03 January 2008 11:10 am, Arno Gerretsen wrote:
> Thanks Anthony, your proj string helped me solving the problem. It
> turned out to be a problem with the meter to feet conversion. In the
> stirng I used I had tried both +units=ft and +units=m with my own
> multiplication by 0.3048 to get meters. Now it turns out that is where
> the problem was, I had to use 0.3048006 as you did. I did not know there
> was a different between a foot and a US survey foot.

Indeed, there IS a difference as I well know when I was first putting together 
projection software in the '80 and spent many an hour trying to reconcile the 
differenced between an earlier version of proj and gctp.  FINALLY, I 
discovered a mention of the difference between the foots in Snyder's 
manual---one lonely sentence!

> But it seems that the proj library also uses the 0.3048 factor when I
> set the units to feet, is that what it is supposed to do?

Old standard USGS 'proj -lu' and current lproj lists units conversions 
understood internally.  Thus for the various foot conversions you will see 
listed

         	...
           m 1.                   Meter
 	...
          ft 0.3048               International Foot
         	...
       us-ft 0.304800609601219    U.S. Surveyor's Foot
 	...
      ind-ft 0.30479841           Indian Foot
	...
-- 
The whole religious complexion of the modern world is due
to the absence from Jerusalem of a lunatic asylum.
-- Havelock Ellis (1859-1939)  British psychologist


From hal at mobilegeographics.com  Fri Jan  4 15:36:58 2008
From: hal at mobilegeographics.com (Hal Mueller)
Date: Fri, 4 Jan 2008 15:36:58 -0800
Subject: [Proj] PROJ as embeddable framework for Mac OS 
Message-ID: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>

I need to reconfigure PROJ as an embeddable framework for Mac OS.   
This is so that I can make a drag-and-drop installable app (one that  
does not need an installer, as is recommended by current Apple  
guidelines).  The binaries posted on the Kyngchaos site are built as  
system-wide frameworks.

The Kyngchaos port has this tantalizing note in the ReadMe.rtf:

> Before linking (or maybe after linking) the framework copy's  
> install_name and library paths should be changed using  
> install_name_tool.  A handy relative path that can be used is  
> @executable_path, this is the location of the app executable.   So  
> a path to the framework within the app package would be  
> @executable_path/../Frameworks/PROJ.framework/PROJ.
>
> You would have to change the id of the framework, and the  
> dependencies of the framework that are also included in the app  
> package, to be relative paths.  This can get messy.
>
> Currently there is an additional consideration: the data folder.   
> It is normally hardwired into the library, but there is also an  
> environment variable to override that.  It's up to the programs  
> using PROJ to take care of this.

What exactly do I need to pass as arguments to install_name_tool?   
What -id am I working with?

What are the "messy" dependencies referred to?

What change do I need to make to manage the data folder?  What's the  
default as built?

This would be a lot easier to understand if the build instructions  
were included in the framework.  Or are they now included if I do a  
configure/build on the Mac?

Hal

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080104/1c781220/attachment.html>

From gdt at ir.bbn.com  Fri Jan  4 16:37:58 2008
From: gdt at ir.bbn.com (Greg Troxel)
Date: Fri, 04 Jan 2008 19:37:58 -0500
Subject: [Proj] PROJ as embeddable framework for Mac OS
In-Reply-To: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com> (Hal
	Mueller's message of "Fri, 4 Jan 2008 15:36:58 -0800")
References: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
Message-ID: <rmiejcx1509.fsf@fnord.ir.bbn.com>

  I need to reconfigure PROJ as an embeddable framework for Mac OS.
  This is so that I can make a drag-and-drop installable app (one that
  does not need an installer, as is recommended by current Apple
  guidelines).  The binaries posted on the Kyngchaos site are built as
  system-wide frameworks.

My quick reaction is that you should look for help within the OS X
community; I suspect the issues you are facing are not really about
proj.



From hal at mobilegeographics.com  Fri Jan  4 17:08:40 2008
From: hal at mobilegeographics.com (Hal Mueller)
Date: Fri, 4 Jan 2008 17:08:40 -0800
Subject: [Proj] PROJ as embeddable framework for Mac OS
In-Reply-To: <rmiejcx1509.fsf@fnord.ir.bbn.com>
References: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
	<rmiejcx1509.fsf@fnord.ir.bbn.com>
Message-ID: <CC794AC0-098E-455D-AED3-F52A9864956B@mobilegeographics.com>

The questions I have pertain to the PROJ data folder, and to the  
specific decisions made in this particular framework build.

Hal



From woklist at kyngchaos.com  Fri Jan  4 21:00:38 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Fri, 4 Jan 2008 23:00:38 -0600
Subject: [Proj] PROJ as embeddable framework for Mac OS 
In-Reply-To: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
References: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
Message-ID: <FB93F68C-F353-4785-A305-2E2A59A81E7A@kyngchaos.com>

On Jan 4, 2008, at 5:36 PM, Hal Mueller wrote:

> I need to reconfigure PROJ as an embeddable framework for Mac OS.   
> This is so that I can make a drag-and-drop installable app (one that  
> does not need an installer, as is recommended by current Apple  
> guidelines).  The binaries posted on the Kyngchaos site are built as  
> system-wide frameworks.
>
> The Kyngchaos port has this tantalizing note in the ReadMe.rtf:
>
>> Before linking (or maybe after linking) the framework copy's  
>> install_name and library paths should be changed using  
>> install_name_tool.  A handy relative path that can be used is  
>> @executable_path, this is the location of the app executable.   So  
>> a path to the framework within the app package would be  
>> @executable_path/../Frameworks/PROJ.framework/PROJ.
>>
>> You would have to change the id of the framework, and the  
>> dependencies of the framework that are also included in the app  
>> package, to be relative paths.  This can get messy.
>>
>> Currently there is an additional consideration: the data folder.   
>> It is normally hardwired into the library, but there is also an  
>> environment variable to override that.  It's up to the programs  
>> using PROJ to take care of this.
>
> What exactly do I need to pass as arguments to install_name_tool?   
> What -id am I working with?
>
I guess I was expecting Mac developers to know what they're doing and  
how to do this.  To change the install_name of the PROJ framework  
itself (only do this on your bundled copy of the framework) [I'm not  
sure it's critical to do this one]:

install_name_tool -id @executable_path/../Frameworks/PROJ.framework/ 
PROJ /path/to/your/application.app/Contents/Frameworks/PROJ.framework/ 
PROJ

to change the embedded path in your app binary:

install_name_tool -change /Library/Frameworks/PROJ.framework/Versions/ 
4.5/PROJ @executable_path/../Frameworks/PROJ.framework/PROJ /path/to/ 
your/application.app/Contents/MacOS/your_app

To verify the current id and embedded paths to libraries, use otool:

otool -L /path/to/some/library_or_exectuable

For a library (or frmaework), the first item is the library itself  
(the id), and is what will be embedded into executables and other  
libraries.  The rest (or all, for executables) are the linked libraries.


> What are the "messy" dependencies referred to?
>
As a small example, if you bundle the GDAL and PROJ frameworks.  GDAL  
also links to PROJ, so you would have to change the references in the  
bundled GDAL to use the relative path to the bundled PROJ.  The more  
interdependent frameworks you bundle, the more changes within those  
bundled frameworks are needed.


> What change do I need to make to manage the data folder?  What's the  
> default as built?
>
The default is the absolute path to the framework as installed in / 
Library/Frameworks. Using a different data folder is something you  
would have to look at the PROJ API to find.  You app would initialize  
(or something like that) PROJ with the alternate data path before  
calling the projection functions.

I'm not much of a C programmer, so you're on your own on the PROJ API.

> This would be a lot easier to understand if the build instructions  
> were included in the framework.  Or are they now included if I do a  
> configure/build on the Mac?
>

It's not in a configure-make build.  I currently patch a couple items  
to make it endian-agnostic so it can be a universal binary.  It's on  
my list to push for changes in the PROJ source to take care of this.


and offlist:

> You mentioned that the Xcode project you have posted is not actually  
> the project you use to build the framework.  I'd really like to get  
> a look at the build choices you're making.
>
Now that I'm done with the bulk of the Leopard update, updating the  
Xcode project downloads is next.  Stay tuned.


> My app is crashing on framework not found, searching in /Library,  
> even though the Proj framework is in the app's Frameworks folder.   
> Rather than mucking around with install_name_tool and guessing about  
> the data directory, I'd like to build the thing from scratch  
> myself.  It does not appear to me that what is posted is sufficient  
> to do that, based on what I've read and on what you've told me.


Changing the hardwired data path to match your app is probably not  
what you want to do - that will tie it down to whatever path you  
choose, and it won't be drag-n-droppable to an arbitrary location any  
more.  Use the PROJ API to set the data path at runtime, as mentioned  
above.


-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

[Trillian]  What are you supposed to do WITH a maniacally depressed  
robot?

[Marvin]  You think you have problems?  What are you supposed to do if  
you ARE a maniacally depressed robot?  No, don't try and answer, I'm  
50,000 times more intelligent than you and even I don't know the  
answer...

- HitchHiker's Guide to the Galaxy




From hal at mobilegeographics.com  Fri Jan  4 21:12:07 2008
From: hal at mobilegeographics.com (Hal Mueller)
Date: Fri, 4 Jan 2008 21:12:07 -0800
Subject: [Proj] PROJ as embeddable framework for Mac OS 
In-Reply-To: <FB93F68C-F353-4785-A305-2E2A59A81E7A@kyngchaos.com>
References: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
	<FB93F68C-F353-4785-A305-2E2A59A81E7A@kyngchaos.com>
Message-ID: <F9C4BFF4-A94D-4D78-B7A1-7681A348DE87@mobilegeographics.com>


On Jan 4, 2008, at 9:00 PM, William Kyngesburye wrote:
> As a small example, if you bundle the GDAL and PROJ frameworks.   
> GDAL also links to PROJ, so you would have to change the references  
> in the bundled GDAL to use the relative path to the bundled PROJ.   
> The more interdependent frameworks you bundle, the more changes  
> within those bundled frameworks are needed.

This sounds like an argument for using @executable_path in the  
frameworks in that case.

There are certainly cases where you want to install one copy of the  
Maptools frameworks in /Library, for all apps to share.  But there  
are other situations where you want to be independent of the  
installed environment.  So perhaps 2 different targets are needed-- 
one embeddable target, and one for system-level installation.

For the archives:  data directory ends up being /Library/Frameworks/ 
PROJ.framework/Resources/proj, for the current iteration anyway.

Resources/Info.plist, and the proj files themselves (in  
PROJ.framework/Resources/proj), are world-writeable, and owned by the  
user who installed them, with a group of "wheel".  I don't see this  
as much of a security risk, however.

Thanks for all of your work!

Hal



From woklist at kyngchaos.com  Sat Jan  5 09:43:56 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Sat, 5 Jan 2008 11:43:56 -0600
Subject: [Proj] PROJ as embeddable framework for Mac OS 
In-Reply-To: <F9C4BFF4-A94D-4D78-B7A1-7681A348DE87@mobilegeographics.com>
References: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
	<FB93F68C-F353-4785-A305-2E2A59A81E7A@kyngchaos.com>
	<F9C4BFF4-A94D-4D78-B7A1-7681A348DE87@mobilegeographics.com>
Message-ID: <DFBF057B-5FB6-439F-A503-3454ACD34C11@kyngchaos.com>

On Jan 4, 2008, at 11:12 PM, Hal Mueller wrote:

> On Jan 4, 2008, at 9:00 PM, William Kyngesburye wrote:
>> As a small example, if you bundle the GDAL and PROJ frameworks.   
>> GDAL also links to PROJ, so you would have to change the references  
>> in the bundled GDAL to use the relative path to the bundled PROJ.   
>> The more interdependent frameworks you bundle, the more changes  
>> within those bundled frameworks are needed.
>
> This sounds like an argument for using @executable_path in the  
> frameworks in that case.
>
Exactly, that's what the install_name_tool change is doing.

> There are certainly cases where you want to install one copy of the  
> Maptools frameworks in /Library, for all apps to share.  But there  
> are other situations where you want to be independent of the  
> installed environment.  So perhaps 2 different targets are needed-- 
> one embeddable target, and one for system-level installation.
>

Not really.  I think it's standard practice.  You link an app to the  
installed frameworks, then IF you want to bundle the frameworks, you  
copy them and use install_name_tool.

There may be other frameworks designed only for bundling that already  
have @executable_path, but I made my PROJ framework to be used  
normally as an installed framework.


> For the archives:  data directory ends up being /Library/Frameworks/ 
> PROJ.framework/Resources/proj, for the current iteration anyway.
>
> Resources/Info.plist, and the proj files themselves (in  
> PROJ.framework/Resources/proj), are world-writeable, and owned by  
> the user who installed them, with a group of "wheel".  I don't see  
> this as much of a security risk, however.
>
The old Panther/Tiger installers do this - I used the "admin" option  
for generating the installer, which sets ownership to the user that  
installed them.  It looked common and safe to do at the time.  It's  
also easier on me, since I don't have to worry about file ownership on  
my end.

The new Tiger/Leopard installers don't have the middle admin option,  
so I use the root option, which retains ownership as defined in the  
installer.  This means I have to make sure ownership is set correctly  
on my end.

Both require an admin user authentication (not root for the root  
option), the difference is that root *always* asks for authentication,  
whether you are an admin user or not.

In either case, nothing should be world-writable, so I don't know how  
that is happening.

> Thanks for all of your work!
>
> Hal
>

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

Earth: "Mostly harmless"

- revised entry in the HitchHiker's Guide to the Galaxy




From support.mn at elisanet.fi  Sun Jan  6 03:05:49 2008
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Sun, 6 Jan 2008 13:05:49 +0200 (EET)
Subject: [Proj] "Google Earth view snap shot" projection
Message-ID: <22047007.2914101199617549621.JavaMail.support.mn@elisanet.fi>

Hello,

When taking some snap shots from Google Earth viewer (using print screen etc.), what would be the closest projection that would fit that view. Or is there at all any projection that fits a snap shot of a shere? Or does it depend too much of the view point altitude... ??

Regards Janne




From hal at mobilegeographics.com  Mon Jan  7 17:18:14 2008
From: hal at mobilegeographics.com (Hal Mueller)
Date: Mon, 7 Jan 2008 17:18:14 -0800
Subject: [Proj] PROJ as embeddable framework for Mac OS 
In-Reply-To: <DFBF057B-5FB6-439F-A503-3454ACD34C11@kyngchaos.com>
References: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
	<FB93F68C-F353-4785-A305-2E2A59A81E7A@kyngchaos.com>
	<F9C4BFF4-A94D-4D78-B7A1-7681A348DE87@mobilegeographics.com>
	<DFBF057B-5FB6-439F-A503-3454ACD34C11@kyngchaos.com>
Message-ID: <D74948D9-AB57-441F-98AE-79A05948300C@mobilegeographics.com>

My notes on embedding/using PROJ from Cocoa are at
http://halmueller.wordpress.com/2008/01/07/embedding-the-proj-library- 
in-a-cocoa-app/

Hal



From woklist at kyngchaos.com  Mon Jan  7 19:38:28 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Mon, 7 Jan 2008 21:38:28 -0600
Subject: [Proj] PROJ as embeddable framework for Mac OS 
In-Reply-To: <D74948D9-AB57-441F-98AE-79A05948300C@mobilegeographics.com>
References: <0FB4579D-326A-4718-93F5-BA07BC36A4BB@mobilegeographics.com>
	<FB93F68C-F353-4785-A305-2E2A59A81E7A@kyngchaos.com>
	<F9C4BFF4-A94D-4D78-B7A1-7681A348DE87@mobilegeographics.com>
	<DFBF057B-5FB6-439F-A503-3454ACD34C11@kyngchaos.com>
	<D74948D9-AB57-441F-98AE-79A05948300C@mobilegeographics.com>
Message-ID: <EAB5F065-BEDD-469E-8C82-71DCF6FF42CD@kyngchaos.com>

Some comments:


It's not that I don't build the PROJ framework with Xcode, but that I  
hadn't updated the project files for download.  I took a few minutes  
and did that.  Note that it's for PROJ 4.5 for now, as I haven't  
looked at 4.6 yet because of the datum behaviour change. The project  
includes the patches I use to make the NAD file handling endian- 
agnostic so PROJ can be built universal.

Even so, remember that if you make adjustments to build it from the  
start to use @executable_path, the PROJ_LIB setting should still be  
left as is (or ignored), and the library initialized at runtime as you  
worked out.


The Copy Files + install_name_tool you worked out is pretty standard  
fare, so don't knock it.  Some may like to tweak things and build it  
all from scratch.  Others may prefer to use as much binary source as  
possible.  Both methods are completely valid.


Full paths to framework internals is preferable (other than the  
@executable_path part).  That is, don't depend on symlink shortcuts,  
but use the full "Versions/x.y/PROJ" path inside the framework.  At  
least, this is the recommendation for installed frameworks, but could  
apply to bundled frameworks.  I think it's mostly a versioning safety  
thing.


On Jan 7, 2008, at 7:18 PM, Hal Mueller wrote:

> My notes on embedding/using PROJ from Cocoa are at
> http://halmueller.wordpress.com/2008/01/07/embedding-the-proj-library-in-a-cocoa-app/
>
> Hal
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

"I ache, therefore I am.  Or in my case - I am, therefore I ache."

- Marvin




From didier.richard at ign.fr  Sun Jan 13 10:18:04 2008
From: didier.richard at ign.fr (RICHARD Didier)
Date: Sun, 13 Jan 2008 19:18:04 +0100 (CET)
Subject: [Proj] Lambert tangent form to Lambert secant form
Message-ID: <33947.81.66.8.49.1200248284.squirrel@81.66.8.49>

Hi all,

I am facing a bug in the MapInfo driver of GDAL that might need some
modifications of PROJ.4. The bug is two fold :

- MapInfo driver only supports 1SP LCC when building the CoordSys string.
Before, I implement an algorithm that modify LCC 1SP parameters to LCC 2SP
parameters. I would like to know whether someone on the list has already
implemented such a code. Another point is how to wrap that in GDAL (I
address this question to those who are on both list);

- When I use a SRS definition with both nadgrids and towgs84 parameters in
a PROJ.4 string, the later is not taken into account. Therefore, a WKT
string of such a SRS lacks the TOWGS84 block. As a consequence, the
MapInfo driver is not able to code the datum correctly (104 is written
which is the WGS84 datum). I would like to suggest to modify
pj_datum_set.c to keep storing towgs84 values even when nadgrids have been
encountered. The idea is to keep the datum_type has PJD_GRIDSHIFT in order
to keep precise coordinates transformation with grid and to parse the
towgs84 (from line 113). I don't know if there are known or already
debated issues on that, but I would like to know whether this idea is
correct or not.

Any comments/suggestions ?

Sincerely,

didier
-- 
RICHARD Didier - Chef du pôle technique du Géoportail
2/4, avenue Pasteur - 94165 Saint Mandé Cedex
Tél : +33 (0) 1 43 98 83 23


From cjmce at lsu.edu  Sun Jan 13 14:56:43 2008
From: cjmce at lsu.edu (Clifford J Mugnier)
Date: Sun, 13 Jan 2008 16:56:43 -0600
Subject: [Proj] Lambert tangent form to Lambert secant form
References: <33947.81.66.8.49.1200248284.squirrel@81.66.8.49>
Message-ID: <B597ADFC46B67741B18EA6AA13613FF776865E@email002.lsu.edu>

The Lambert Conformal Conic with one standard parallel defined with  a latitude of origin and a scale factor at origin less than one is a secant Lambert.  There are very few truly tangent Lambert Conformal Conic zones extant in the entire world.  The difference is what you have a problem with is likely just some algebra.  See Chapter 3 of the current "Manual of Photogrammetry" published by the American Society for Photogrammetry and Remote Sensing for some algebraic clues to your conundrum.
 
C. Mugnier
Louisiana State University

________________________________

From: proj-bounces at lists.maptools.org on behalf of RICHARD Didier
Sent: Sun 13-Jan-08 12:18
To: proj at lists.maptools.org; gdal-dev at lists.osgeo.org
Subject: [Proj] Lambert tangent form to Lambert secant form



Hi all,

I am facing a bug in the MapInfo driver of GDAL that might need some
modifications of PROJ.4. The bug is two fold :

- MapInfo driver only supports 1SP LCC when building the CoordSys string.
Before, I implement an algorithm that modify LCC 1SP parameters to LCC 2SP
parameters. I would like to know whether someone on the list has already
implemented such a code. Another point is how to wrap that in GDAL (I
address this question to those who are on both list);

- When I use a SRS definition with both nadgrids and towgs84 parameters in
a PROJ.4 string, the later is not taken into account. Therefore, a WKT
string of such a SRS lacks the TOWGS84 block. As a consequence, the
MapInfo driver is not able to code the datum correctly (104 is written
which is the WGS84 datum). I would like to suggest to modify
pj_datum_set.c to keep storing towgs84 values even when nadgrids have been
encountered. The idea is to keep the datum_type has PJD_GRIDSHIFT in order
to keep precise coordinates transformation with grid and to parse the
towgs84 (from line 113). I don't know if there are known or already
debated issues on that, but I would like to know whether this idea is
correct or not.

Any comments/suggestions ?

Sincerely,

didier
--
RICHARD Didier - Chef du pôle technique du Géoportail
2/4, avenue Pasteur - 94165 Saint Mandé Cedex
Tél : +33 (0) 1 43 98 83 23
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080113/5ff45a05/attachment.html>

From leonidas_liakos at yahoo.gr  Mon Jan 14 09:25:34 2008
From: leonidas_liakos at yahoo.gr (Leonidas Liakos)
Date: Mon, 14 Jan 2008 19:25:34 +0200
Subject: [Proj] ETRS1989 to Greek Grid (GGRS1987)
Message-ID: <478B9B0E.1070309@yahoo.gr>

Dear all,
recently I tried to convert some data from ETRS1989 (Lambert Azimuthal 
EqualArea) to Greek Grid. Comparing the results of the conversion, it 
seems that there is an important shift (error?) of those data.Is there 
any special tranformation method and parameters that I should use? Yours 
sincerely,

Leonidas Liakos
Geographer
32nd Ephorate of Antiquities
Hgoumenitsa,Greece


From gdt at ir.bbn.com  Mon Jan 14 09:55:59 2008
From: gdt at ir.bbn.com (Greg Troxel)
Date: Mon, 14 Jan 2008 12:55:59 -0500
Subject: [Proj] ETRS1989 to Greek Grid (GGRS1987)
In-Reply-To: <478B9B0E.1070309@yahoo.gr> (Leonidas Liakos's message of "Mon,
	14 Jan 2008 19:25:34 +0200")
References: <478B9B0E.1070309@yahoo.gr>
Message-ID: <rmiy7asp9zk.fsf@fnord.ir.bbn.com>

  From: Leonidas Liakos <leonidas_liakos at yahoo.gr>

  recently I tried to convert some data from ETRS1989 (Lambert Azimuthal
  EqualArea) to Greek Grid. Comparing the results of the conversion, it
  seems that there is an important shift (error?) of those data.Is there
  any special tranformation method and parameters that I should use?

To debug this, you should post the exact command you used to do the
transformation, and the control point (in both systems) that you think
is a correct transformation, perhaps describe where it came from, and
the results from your transformation.  I don't know anything about the
Greek grid, but anyone who does will need that information to help you.



From support.mn at elisanet.fi  Mon Jan 14 17:12:24 2008
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Tue, 15 Jan 2008 03:12:24 +0200 (EET)
Subject: [Proj] ETRS1989 to Greek Grid (GGRS1987)
Message-ID: <6812278.57921200359544583.JavaMail.support.mn@elisanet.fi>

I found the following data about Greek Grid and local datum:

"There is a new reference system used in Greece nowadays. It is
called the Greek Geodetic Reference System of 1987 (GGRS87)
where Fo = 38° 04' 33.8107" North, Lo = 23° 55' 51.0095" East of
Greenwich, No = 7.0 m, and the new Greek Grid is based on the
Transverse Mercator projection (presumably Gauss-Krüger) where
fo = 0°, lo = 24° E, the False Easting = 500 km, and the scale factor at
origin (mo) = 0.9996. Generally, I have serious doubts concerning any
new grid system that uses some non-standard variant of the UTM
Grid, but I understand that this particular one was devised by Professor
Veis of the Technical University of Athens. If Professor Veis approved
of this new grid, then there certainly must be a valid technical
reason for the curious parameters chosen. Thanks for the above
parameters go to Yannis Yanniris, a photogrammetrist in Athens.

The National Imagery and Mapping Agency (NIMA) has published
datum shift parameters from the European Datum of 1950 in Greece
to the WGS84 Datum where DX = 84 m, DY = 95 m, and DZ = 130
m; however, this solution is based on only two points and the accuracy
of the components is stated to be ±25 m. Users interested in
geodetic applications of GPS in Greece should read the NIMA
notice published next to my column in PE&RS October, 2002. The
European Petroleum Studies Group has published shift parameters
from GGRS87 to WGS84 as being DX = 199.87 m, DY = +74.79 m,
and DZ = +246.62 m. The EPSG published no accuracy estimates for
their parameters, so caveat emptor."

In the following link:

http://www.asprs.org/resources/grids/12-2002-hellenic.pdf

That might help you. You simply add the "towgs84" statement in the
local projection with those three parameters given in the above text
and you should get near the truth. Your local datum is shifted that
amount from the WGS84 datum. There might be additional shifting
required to the ETRS1989 from European 1950. The amount shift
needed is possible to figure out if you know some standard points
in Greekland in WGS84 and local datum. It is rather clear that the
Greek Grid is defined in the old local datum.

ETRS1989 (or EUREF89) is very close to WGS84 datum (difference is
less than 1 m) so that they can be considered the same. The following
datum shift for the Greek Grid was found in the esri data base. That
"towgs84" statement also fix your problem:

# esri:2100
# GGRS87 / Greek Grid
proj=tmerc
lat_0=0
lon_0=24
k=0.999600
x_0=500000
y_0=0
ellps=GRS80
towgs84=-199.87,74.79,246.62,0,0,0,0
units=m
no_defs
no_defs


Regards: Janne.

-----------------------------------------------------------------------------

Leonidas Liakos <leonidas_liakos at yahoo.gr> kirjoitti: 
> Dear all,
> recently I tried to convert some data from ETRS1989 (Lambert Azimuthal 
> EqualArea) to Greek Grid. Comparing the results of the conversion, it 
> seems that there is an important shift (error?) of those data.Is there 
> any special tranformation method and parameters that I should use? Yours 
> sincerely,
> 
> Leonidas Liakos
> Geographer
> 32nd Ephorate of Antiquities
> Hgoumenitsa,Greece
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
> 




From woklist at kyngchaos.com  Tue Jan 15 18:00:28 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Tue, 15 Jan 2008 20:00:28 -0600
Subject: [Proj] NAD problems on OSX 10.5 Leopard
Message-ID: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>

This is an odd one.  On OSX 10.5 (Leopard), as a 64bit binary PROJ/ 
cs2cs correctly translates betwen NAD27 and NAD83.  But, as a 32bit  
binary it translates in the opposite direction.  The OSX 10.4 (Tiger)  
build (32bits-only) also correctly translates datums (ie, it's the  
same as the 64bit translation).

$ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
-118 38
118d0'3.385"W	37d59'59.751"N 0.000

$ arch -i386 cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong  
+datum=NAD83
-118 38
117d59'59.748"W	38d0'3.385"N 0.000


The Tiger binary, even running on Leopard gets the translation  
correct, so I wonder if something is happening in the compilation.

long's can be trouble, since on 32bit OSX they are 32bit, but on 64bit  
OSX they are 64bit.  Looking at nad2bin (and a few library sources), I  
see that longs are used in the NAD tables (lam and phi), so the NAD  
binary files are getting built with 64bit longs, then the 32bit PROJ  
is trying to read 32bit longs.

Are the NAD tables meant to always be 64bit longs?  Should long long  
be used instead, to guarantee 64bit longs, or maybe they should be  
configured?


-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

All generalizations are dangerous, even this one.




From warmerdam at pobox.com  Tue Jan 15 18:31:31 2008
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Tue, 15 Jan 2008 21:31:31 -0500
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
Message-ID: <478D6C83.3070605@pobox.com>

William Kyngesburye wrote:
> This is an odd one.  On OSX 10.5 (Leopard), as a 64bit binary PROJ/cs2cs 
> correctly translates betwen NAD27 and NAD83.  But, as a 32bit binary it 
> translates in the opposite direction.  The OSX 10.4 (Tiger) build 
> (32bits-only) also correctly translates datums (ie, it's the same as the 
> 64bit translation).
> 
> $ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
> -118 38
> 118d0'3.385"W    37d59'59.751"N 0.000
> 
> $ arch -i386 cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong 
> +datum=NAD83
> -118 38
> 117d59'59.748"W    38d0'3.385"N 0.000
> 
> 
> The Tiger binary, even running on Leopard gets the translation correct, 
> so I wonder if something is happening in the compilation.
> 
> long's can be trouble, since on 32bit OSX they are 32bit, but on 64bit 
> OSX they are 64bit.  Looking at nad2bin (and a few library sources), I 
> see that longs are used in the NAD tables (lam and phi), so the NAD 
> binary files are getting built with 64bit longs, then the 32bit PROJ is 
> trying to read 32bit longs.
> 
> Are the NAD tables meant to always be 64bit longs?  Should long long be 
> used instead, to guarantee 64bit longs, or maybe they should be configured?

William,

Pretty bizzare behavior.

The nadcon style datum shift files are expected to be platform specific and
that means a 32bit generated datum shift file cannot be used by 64bit
program safely (amoung other things).  I *suspect* this is at the root
of your problem.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | President OSGeo, http://osgeo.org



From woklist at kyngchaos.com  Tue Jan 15 20:08:05 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Tue, 15 Jan 2008 22:08:05 -0600
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <478D6C83.3070605@pobox.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
Message-ID: <995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>

On Jan 15, 2008, at 8:31 PM, Frank Warmerdam wrote:

> William Kyngesburye wrote:
>> This is an odd one.  On OSX 10.5 (Leopard), as a 64bit binary PROJ/ 
>> cs2cs correctly translates betwen NAD27 and NAD83.  But, as a 32bit  
>> binary it translates in the opposite direction.  The OSX 10.4  
>> (Tiger) build (32bits-only) also correctly translates datums (ie,  
>> it's the same as the 64bit translation).
>> $ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
>> -118 38
>> 118d0'3.385"W    37d59'59.751"N 0.000
>> $ arch -i386 cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong  
>> +datum=NAD83
>> -118 38
>> 117d59'59.748"W    38d0'3.385"N 0.000
>> The Tiger binary, even running on Leopard gets the translation  
>> correct, so I wonder if something is happening in the compilation.
>> long's can be trouble, since on 32bit OSX they are 32bit, but on  
>> 64bit OSX they are 64bit.  Looking at nad2bin (and a few library  
>> sources), I see that longs are used in the NAD tables (lam and  
>> phi), so the NAD binary files are getting built with 64bit longs,  
>> then the 32bit PROJ is trying to read 32bit longs.
>> Are the NAD tables meant to always be 64bit longs?  Should long  
>> long be used instead, to guarantee 64bit longs, or maybe they  
>> should be configured?
>
> William,
>
> Pretty bizzare behavior.
>
> The nadcon style datum shift files are expected to be platform  
> specific and
> that means a 32bit generated datum shift file cannot be used by 64bit
> program safely (amoung other things).  I *suspect* this is at the root
> of your problem.

I poked around to try to understand it better.  The lam/laml/phi/phil  
that are longs, appear to be only used in reading the text source  
lla's.  The CTABLE that is written in binary form uses only doubles,  
floats and ints, which don't change between 32 and 64bit OSX.  At  
least, the number of bytes used doesn't change - would the binary  
format be different?  That doesn't make sense.

Comparing the binary files, on 64bits and 32bits, Tiger and Leopard:

64bit-Leo file
32bit-Tiger file
32bit-Leo file

The headers are all exactly the same - the ints and doubles for the  
lower-left coord, cell size, and grid size match in all files.  The  
floats for the conversion matrix don't match, immediately.  There are  
4 bytes in the 32bit files, and 8 bytes in the 64bit files, before the  
matrix that I can't account for.  After that the matrixes of floats  
match.  The calculated size of the matrix from the grid size matches  
the byte count after those mystery bytes.

Did I miss something in the CTABLE (pardon my ignorance here):

struct CTABLE {
	char id[MAX_TAB_ID]; /* ascii info */
	LP ll;      /* lower left corner coordinates */
	LP del;     /* size of cells */
	ILP lim;    /* limits of conversion matrix */
	FLP *cvs;   /* conversion matrix */
};

Is maybe the bulk fwrite of *cvs prepending something?  It looks like  
an integer of some sort.  And then the nad_init functions are reading  
them as part of the matrix float data.

So, I manually deleted those extra bytes.  Now 32bit and 64bit  
translations match.  And make more sense really (if I understand in  
right, datum transforms give me a headache) - when translating the  
datum of a latlong coordinate, the latlong doesn't actually change,  
it's the projected coordinate that changes.

$ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
-118 38
118dW	38dN 0.000

$ arch -i386 cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong  
+datum=NAD83
-118 38
118dW	38dN 0.000

Or, bad NAD file:

$ cs2cs +init=EPSG:26711 +to +init=EPSG:26911412199.39 4206081.09
412118.95	4206279.97 0.00

$ arch -i386 cs2cs +init=EPSG:26711 +to +init=EPSG:26911
412199.39 4206081.09
412208.85	4206391.01 0.00

and good NAD file:

$ cs2cs +init=EPSG:26711 +to +init=EPSG:26911
412199.39 4206081.09
412201.58	4206286.75 0.00

$ arch -i386 cs2cs +init=EPSG:26711 +to +init=EPSG:26911
412199.39 4206081.09
412201.58	4206286.75 0.00


I dug back into my ancient binaries and it's been like this since I  
started packaging PROJ and friends!

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

"This is a question about the past, is it? ... How can I tell that the  
past isn't a fiction designed to account for the discrepancy between  
my immediate physical sensations and my state of mind?"

- The Ruler of the Universe




From warmerdam at pobox.com  Tue Jan 15 20:42:12 2008
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Tue, 15 Jan 2008 23:42:12 -0500
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
Message-ID: <478D8B24.2080708@pobox.com>

William Kyngesburye wrote:
> I poked around to try to understand it better.  The lam/laml/phi/phil 
> that are longs, appear to be only used in reading the text source 
> lla's.  The CTABLE that is written in binary form uses only doubles, 
> floats and ints, which don't change between 32 and 64bit OSX.  At least, 
> the number of bytes used doesn't change - would the binary format be 
> different?  That doesn't make sense.
> 
> Comparing the binary files, on 64bits and 32bits, Tiger and Leopard:
> 
> 64bit-Leo file
> 32bit-Tiger file
> 32bit-Leo file
> 
> The headers are all exactly the same - the ints and doubles for the 
> lower-left coord, cell size, and grid size match in all files.  The 
> floats for the conversion matrix don't match, immediately.  There are 4 
> bytes in the 32bit files, and 8 bytes in the 64bit files, before the 
> matrix that I can't account for.  After that the matrixes of floats 
> match.  The calculated size of the matrix from the grid size matches the 
> byte count after those mystery bytes.

William,

I believe the difference is in alignment within the structure between
32bit and 64bit systems.  Because the memory image of the structure is
dumped to disk, the file access is very sensitive to differences in
how fields are packed into structures in memory.  This can vary based
on many things.

Really, my preference would be to completely get rid of nadcon style
binary files in favor of NTv1 or NTv2 style files which are platform
independent but doing so would require more work than I'm willing
to invest at this time.

In the meantime, I imagine it would not be too hard to alter the nadcon
reading and writing functions to use some sort of consistent binary
file.  But I'm even to lazy to attempt that just now.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | President OSGeo, http://osgeo.org



From woklist at kyngchaos.com  Tue Jan 15 21:30:59 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Tue, 15 Jan 2008 23:30:59 -0600
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <478D8B24.2080708@pobox.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
Message-ID: <B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>

On Jan 15, 2008, at 10:42 PM, Frank Warmerdam wrote:

> William,
>
> I believe the difference is in alignment within the structure between
> 32bit and 64bit systems.  Because the memory image of the structure is
> dumped to disk, the file access is very sensitive to differences in
> how fields are packed into structures in memory.  This can vary based
> on many things.
>
> Really, my preference would be to completely get rid of nadcon style
> binary files in favor of NTv1 or NTv2 style files which are platform
> independent but doing so would require more work than I'm willing
> to invest at this time.
>
> In the meantime, I imagine it would not be too hard to alter the  
> nadcon
> reading and writing functions to use some sort of consistent binary
> file.  But I'm even to lazy to attempt that just now.

Ah, the extra bytes are pointer for the *cvs part of the CTABLE  
structure?

   fwrite(ct.cvs, tsize, 1, stdout)


Or is it written as part of the &ct fwrite?

   fwrite(&ct, sizeof(ct), 1, stdout)

How about:

   fwrite(ct.id, sizeof(ct.id), 1, stdout)
   fwrite(ct.ll, sizeof(ct.ll), 1, stdout)
   fwrite(ct.del, sizeof(ct.del), 1, stdout)
   fwrite(ct.lim, sizeof(ct.lim), 1, stdout)

This way it skips the pointer part of ct.cvs.


On the other side, though, with the current extra bytes, the fseek()  
in nad_ctable_load() doesn't seem to be skipping over those bytes, so  
they are read as part of the data.  Could it be due to sizeof(ct) used  
in nad2bin, but sizeof(struct CTABLE) used in nad_ctable_load()?  Or  
an fseek bug?


-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

"This is a question about the past, is it? ... How can I tell that the  
past isn't a fiction designed to account for the discrepancy between  
my immediate physical sensations and my state of mind?"

- The Ruler of the Universe




From woklist at kyngchaos.com  Wed Jan 16 07:08:46 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Wed, 16 Jan 2008 09:08:46 -0600
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
Message-ID: <E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>

On Jan 15, 2008, at 11:30 PM, William Kyngesburye wrote:

> On Jan 15, 2008, at 10:42 PM, Frank Warmerdam wrote:
>
>> In the meantime, I imagine it would not be too hard to alter the  
>> nadcon
>> reading and writing functions to use some sort of consistent binary
>> file.  But I'm even to lazy to attempt that just now.
>
> Ah, the extra bytes are pointer for the *cvs part of the CTABLE  
> structure?
>
>  fwrite(ct.cvs, tsize, 1, stdout)
>
I guess not, since...
>
> Or is it written as part of the &ct fwrite?
>
>  fwrite(&ct, sizeof(ct), 1, stdout)
>
> How about:
>
>  fwrite(ct.id, sizeof(ct.id), 1, stdout)
>  fwrite(ct.ll, sizeof(ct.ll), 1, stdout)
>  fwrite(ct.del, sizeof(ct.del), 1, stdout)
>  fwrite(ct.lim, sizeof(ct.lim), 1, stdout)
>
> This way it skips the pointer part of ct.cvs.
>
This works:

if (fwrite(&ct.id, sizeof(ct.id), 1, stdout) != 1 ||
	fwrite(&ct.ll, sizeof(ct.ll), 1, stdout) != 1 ||
	fwrite(&ct.del, sizeof(ct.del), 1, stdout) != 1 ||
	fwrite(&ct.lim, sizeof(ct.lim), 1, stdout) != 1 ||
	fwrite(ct.cvs, tsize, 1, stdout) != 1) {
	fprintf(stderr, "output failure\n");
	exit(2);
}

This creates a file consistent enough at least for different  
architectures on OSX.  Combined with my endian patches, which forces  
the files to be little-endian on both PPC and Intel, the NAD files are  
usable on PPC + Intel, 32bit + 64bit.

> On the other side, though, with the current extra bytes, the fseek()  
> in nad_ctable_load() doesn't seem to be skipping over those bytes,  
> so they are read as part of the data.  Could it be due to sizeof(ct)  
> used in nad2bin, but sizeof(struct CTABLE) used in  
> nad_ctable_load()?  Or an fseek bug?
>

So, is sizeof(struct CTABLE) supposed to be the size including the  
*cvs pointer?  If so, then it's a bug (OSX at least) in sizeof.  But  
the pj_malloc(sizeof(struct CTABLE)) in nad_ctable_init() seems to be  
working properly.

To make sure, how about:

sizeof(&cd.id) + sizeof(&cd.ll) + sizeof(&cd.del) + sizeof(&cd.lim)

>

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

"Those people who most want to rule people are, ipso-facto, those  
least suited to do it."

- A rule of the universe, from the HitchHiker's Guide to the Galaxy




From woklist at kyngchaos.com  Wed Jan 16 07:43:25 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Wed, 16 Jan 2008 09:43:25 -0600
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
Message-ID: <F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>

Sorry to keep responding to myself...

On Jan 16, 2008, at 9:08 AM, William Kyngesburye wrote:

>> On the other side, though, with the current extra bytes, the  
>> fseek() in nad_ctable_load() doesn't seem to be skipping over those  
>> bytes, so they are read as part of the data.  Could it be due to  
>> sizeof(ct) used in nad2bin, but sizeof(struct CTABLE) used in  
>> nad_ctable_load()?  Or an fseek bug?
>>
>
> So, is sizeof(struct CTABLE) supposed to be the size including the  
> *cvs pointer?  If so, then it's a bug (OSX at least) in sizeof.  But  
> the pj_malloc(sizeof(struct CTABLE)) in nad_ctable_init() seems to  
> be working properly.
>
> To make sure, how about:
>
> sizeof(&cd.id) + sizeof(&cd.ll) + sizeof(&cd.del) + sizeof(&cd.lim)
>
>>


no sizeof bug.  I was probably (still) misunderstanding datum  
transforms a bit, and the  latlong to latlong tests and utm27 to utm83  
tests, though the same, were still wrong. Now, with the writing of the  
NAD files leaving out the extra bytes, AND and reading in the nad_init  
seeking to the proper place with the above sizeof change, it's all  
consistent, and agrees with the Tiger 32bit-only transform:


$ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
-118 38
118d0'3.385"W	37d59'59.751"N 0.000

$ arch -i386 cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong  
+datum=NAD83
-118 38
118d0'3.385"W	37d59'59.751"N 0.000

$ cs2cs +init=EPSG:26711 +to +init=EPSG:26911
412199.39 4206081.09
412118.95	4206279.97 0.00

$ arch -i386 cs2cs +init=EPSG:26711 +to +init=EPSG:26911
412199.39 4206081.09
412118.95	4206279.97 0.00


Is there a definitive way to verify this?  I'm basing the  
"correctness" of this by the NAD83 ticks on a USGS topo map.

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

"Those people who most want to rule people are, ipso-facto, those  
least suited to do it."

- A rule of the universe, from the HitchHiker's Guide to the Galaxy




From warmerdam at pobox.com  Wed Jan 16 08:00:54 2008
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed, 16 Jan 2008 11:00:54 -0500
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
Message-ID: <478E2A36.9020407@pobox.com>

William Kyngesburye wrote:
> no sizeof bug.  I was probably (still) misunderstanding datum transforms 
> a bit, and the  latlong to latlong tests and utm27 to utm83 tests, 
> though the same, were still wrong. Now, with the writing of the NAD 
> files leaving out the extra bytes, AND and reading in the nad_init 
> seeking to the proper place with the above sizeof change, it's all 
> consistent, and agrees with the Tiger 32bit-only transform:
> 
> 
> $ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
> -118 38
> 118d0'3.385"W    37d59'59.751"N 0.000

William,

The above matches the expected results.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | President OSGeo, http://osgeo.org



From ed at topozone.com  Wed Jan 16 08:09:28 2008
From: ed at topozone.com (Ed McNierney)
Date: Wed, 16 Jan 2008 11:09:28 -0500
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com><478D6C83.3070605@pobox.com><995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com><478D8B24.2080708@pobox.com><B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com><E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
Message-ID: <4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>

William -

I wouldn't claim to be "definitive" but I get the same results as you report on PROJ 4.5.0 running on Windows, and with my interactive JavaScript coordinate/datum converter on the TopoZone site (which uses PROJ behind the scenes for datum shifts).

     - Ed

Ed McNierney
Chief Mapmaker
Demand Media / TopoZone.com
73 Princeton Street, Suite 305
North Chelmsford, MA  01863
ed at topozone.com
Phone: +1 (978) 251-4242
Fax: +1 (978) 251-1396
-----Original Message-----
From: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On Behalf Of William Kyngesburye
Sent: Wednesday, January 16, 2008 10:43 AM
To: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard

Sorry to keep responding to myself...

On Jan 16, 2008, at 9:08 AM, William Kyngesburye wrote:

>> On the other side, though, with the current extra bytes, the  
>> fseek() in nad_ctable_load() doesn't seem to be skipping over those  
>> bytes, so they are read as part of the data.  Could it be due to  
>> sizeof(ct) used in nad2bin, but sizeof(struct CTABLE) used in  
>> nad_ctable_load()?  Or an fseek bug?
>>
>
> So, is sizeof(struct CTABLE) supposed to be the size including the  
> *cvs pointer?  If so, then it's a bug (OSX at least) in sizeof.  But  
> the pj_malloc(sizeof(struct CTABLE)) in nad_ctable_init() seems to  
> be working properly.
>
> To make sure, how about:
>
> sizeof(&cd.id) + sizeof(&cd.ll) + sizeof(&cd.del) + sizeof(&cd.lim)
>
>>


no sizeof bug.  I was probably (still) misunderstanding datum  
transforms a bit, and the  latlong to latlong tests and utm27 to utm83  
tests, though the same, were still wrong. Now, with the writing of the  
NAD files leaving out the extra bytes, AND and reading in the nad_init  
seeking to the proper place with the above sizeof change, it's all  
consistent, and agrees with the Tiger 32bit-only transform:


$ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
-118 38
118d0'3.385"W	37d59'59.751"N 0.000

$ arch -i386 cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong  
+datum=NAD83
-118 38
118d0'3.385"W	37d59'59.751"N 0.000

$ cs2cs +init=EPSG:26711 +to +init=EPSG:26911
412199.39 4206081.09
412118.95	4206279.97 0.00

$ arch -i386 cs2cs +init=EPSG:26711 +to +init=EPSG:26911
412199.39 4206081.09
412118.95	4206279.97 0.00


Is there a definitive way to verify this?  I'm basing the  
"correctness" of this by the NAD83 ticks on a USGS topo map.

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

"Those people who most want to rule people are, ipso-facto, those  
least suited to do it."

- A rule of the universe, from the HitchHiker's Guide to the Galaxy


_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj



From woklist at kyngchaos.com  Wed Jan 16 09:42:13 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Wed, 16 Jan 2008 11:42:13 -0600
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com><478D6C83.3070605@pobox.com><995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com><478D8B24.2080708@pobox.com><B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com><E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
Message-ID: <3307AF7B-209B-4D9A-B1B1-3296E3A49EC0@kyngchaos.com>

Thanks for the verifications.

I can use my patch in my binaries for now.  I'll add a feature request  
for a consistent binary file format, either as my quick patch, or as  
NTv* type files.

On Jan 16, 2008, at 10:09 AM, Ed McNierney wrote:

> William -
>
> I wouldn't claim to be "definitive" but I get the same results as  
> you report on PROJ 4.5.0 running on Windows, and with my interactive  
> JavaScript coordinate/datum converter on the TopoZone site (which  
> uses PROJ behind the scenes for datum shifts).
>
>     - Ed


On Jan 16, 2008, at 10:00 AM, Frank Warmerdam wrote:

> William Kyngesburye wrote:
>> $ cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong +datum=NAD83
>> -118 38
>> 118d0'3.385"W    37d59'59.751"N 0.000
>
> William,
>
> The above matches the expected results.

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

Earth: "Mostly harmless"

- revised entry in the HitchHiker's Guide to the Galaxy




From karl at kls2.com  Wed Jan 16 10:22:23 2008
From: karl at kls2.com (Karl Swartz)
Date: Wed, 16 Jan 2008 10:22:23 -0800
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
Message-ID: <20080116182223.GA62476@orion.kls2.com>

> >Ah, the extra bytes are pointer for the *cvs part of the CTABLE  
> >structure?
> >
> > fwrite(ct.cvs, tsize, 1, stdout)

No.

> >Or is it written as part of the &ct fwrite?
> >
> > fwrite(&ct, sizeof(ct), 1, stdout)

Yes.  The cvs element of that structure is a pointer, which is 32-bits
in x86 mode and 64-bits in x86-64 mode.  The extra four bytes are due to
the larger pointer.

> This works:
> 
> if (fwrite(&ct.id, sizeof(ct.id), 1, stdout) != 1 ||
> 	fwrite(&ct.ll, sizeof(ct.ll), 1, stdout) != 1 ||
> 	fwrite(&ct.del, sizeof(ct.del), 1, stdout) != 1 ||
> 	fwrite(&ct.lim, sizeof(ct.lim), 1, stdout) != 1 ||
> 	fwrite(ct.cvs, tsize, 1, stdout) != 1) {
> 	fprintf(stderr, "output failure\n");
> 	exit(2);
> }

That doesn't write the pointer, so yes, it should work, so long as both
architectures have the same format for ther other values (which is true
for x86 and x86-64).

> So, is sizeof(struct CTABLE) supposed to be the size including the  
> *cvs pointer?

Of course.

> sizeof(&cd.id) + sizeof(&cd.ll) + sizeof(&cd.del) + sizeof(&cd.lim)

In this case it should work though in general it will not since it
assumes no padding.  For example, if MAX_TAB_ID were 1 or 81 (it's
actually 80), an x86 compiler should add three pad bytes so cd.ll is
aligned on a 4-byte boundary.  On some architectures (and on x86 if
you use gcc's -malign-double option), there will be seven pad bytes
in this example, or other amounts depending upon the alignment of a
double.

(Again, on x86 and x86-64, there should be no padding so this should
work.)

A better way of writing this would be

    #include <stddef.h>

    if (fwrite(&ct, offsetof(ct, cvs), 1, stdout) != 1)
        ...

The avoids writing out the pointer (which is useless anyway) but depends
on cvs being the last element of the structure.

Writing each element individually (as you did above) is the safest,
depending only on the encoding of the underlying types.

 -- Karl


From paul-grass at stjohnspoint.co.uk  Wed Jan 16 10:27:00 2008
From: paul-grass at stjohnspoint.co.uk (Paul Kelly)
Date: Wed, 16 Jan 2008 18:27:00 +0000 (GMT)
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <3307AF7B-209B-4D9A-B1B1-3296E3A49EC0@kyngchaos.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com><478D6C83.3070605@pobox.com><995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com><478D8B24.2080708@pobox.com><B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com><E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
	<3307AF7B-209B-4D9A-B1B1-3296E3A49EC0@kyngchaos.com>
Message-ID: <Pine.LNX.4.62.0801161824540.17689@vortex.ukshells.co.uk>

On Wed, 16 Jan 2008, William Kyngesburye wrote:

> Thanks for the verifications.
>
> I can use my patch in my binaries for now.  I'll add a feature request for a 
> consistent binary file format, either as my quick patch, or as NTv* type 
> files.

Just pointing out for completeness because it doesn't seem to have been 
mentioned really in this thread, the "conventional" way of dealing with 
this issue is for the binary installer to automatically run the nad2bin 
program to regenerate the platform-dependent gridshift files during the 
installation process. E.g. this is what the GRASS binary installer script 
does.

Paul


From woklist at kyngchaos.com  Wed Jan 16 11:48:22 2008
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Wed, 16 Jan 2008 13:48:22 -0600
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <Pine.LNX.4.62.0801161824540.17689@vortex.ukshells.co.uk>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com><478D6C83.3070605@pobox.com><995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com><478D8B24.2080708@pobox.com><B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com><E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
	<3307AF7B-209B-4D9A-B1B1-3296E3A49EC0@kyngchaos.com>
	<Pine.LNX.4.62.0801161824540.17689@vortex.ukshells.co.uk>
Message-ID: <21CF6BBF-6BB4-41D2-A565-C0CC072C6A32@kyngchaos.com>

Understood.  But OSX is outside conventions here.  A single binary can  
contain 4 combinations of PPC & Intel, 32bit & 64bit architectures.   
Support data files need to be consistent across that range.

On Jan 16, 2008, at 12:27 PM, Paul Kelly wrote:

> On Wed, 16 Jan 2008, William Kyngesburye wrote:
>
>> Thanks for the verifications.
>>
>> I can use my patch in my binaries for now.  I'll add a feature  
>> request for a consistent binary file format, either as my quick  
>> patch, or as NTv* type files.
>
> Just pointing out for completeness because it doesn't seem to have  
> been mentioned really in this thread, the "conventional" way of  
> dealing with this issue is for the binary installer to automatically  
> run the nad2bin program to regenerate the platform-dependent  
> gridshift files during the installation process. E.g. this is what  
> the GRASS binary installer script does.
>
> Paul
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-----
William Kyngesburye <kyngchaos*at*kyngchaos*dot*com>
http://www.kyngchaos.com/

"Those people who most want to rule people are, ipso-facto, those  
least suited to do it."

- A rule of the universe, from the HitchHiker's Guide to the Galaxy




From richard.greenwood at gmail.com  Wed Jan 16 20:12:43 2008
From: richard.greenwood at gmail.com (Richard Greenwood)
Date: Wed, 16 Jan 2008 21:12:43 -0700
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
Message-ID: <ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>

On Jan 16, 2008 9:09 AM, Ed McNierney <ed at topozone.com> wrote:
> William -
>
> I wouldn't claim to be "definitive" but I get the same results as you report on PROJ 4.5.0 running on Windows, and with my interactive JavaScript coordinate/datum converter on the TopoZone site (which uses PROJ behind the scenes for datum shifts).
>
>      - Ed

Ed,

I curious about your JavaScript coordinate converted because I've done
a little work on one myself. I took a quick look on TopoZone and
didn't see it. Could you point me to it?

Rich

-- 
Richard Greenwood
richard.greenwood at gmail.com
www.greenwoodmap.com


From roger at opq.se  Thu Jan 17 05:55:37 2008
From: roger at opq.se (Roger Oberholtzer)
Date: Thu, 17 Jan 2008 14:55:37 +0100
Subject: [Proj] WGS84 to ED50 - SOLVED
In-Reply-To: <1196344518.25474.84.camel@acme.pacific>
References: <924401.75908.qm@web52712.mail.re2.yahoo.com>
	<1195511076.8756.10.camel@shark.ramboll.se>
	<B597ADFC46B67741B18EA6AA13613FF7768592@email002.lsu.edu>
	<1195564876.26007.56.camel@acme.pacific>
	<B597ADFC46B67741B18EA6AA13613FF7768594@email002.lsu.edu>
	<1196344518.25474.84.camel@acme.pacific>
Message-ID: <1200578137.15064.75.camel@acme.pacific>

On Thu, 2007-11-29 at 14:55 +0100, Roger Oberholtzer wrote:
> I have a bit more information on the problem with WGS84 lat/longs ->
> ED50(Spain) northings and eastings.
> 
> The software that is being used does not have a 'Spanish' setting. So
> they have defined an ED50 7 parameter transform, with these
> coefficients:
> 
> 
> > International Ellipsoid 1924 definition
> > Mayor semiaxle: 6378388
> > Minor semiaxle:6356911,9461
> > 1/f:297
> > Excentricity: 0.0819910890032286
> > 
> > About the 7 parameters transformation 
> > Translation X (m): 125.098545
> > Translation Y (m): 76.000054
> > Translation Z (m): 156.198703
> > X Rotation(seconds): 0
> > Y Rotation(seconds): 0
> > Z Rotation(seconds): -1.129
> > Scale factor (ppm): -8.30463103
> > 
> > This correspond with applanix header file saying 
> > Mapping frame datum: ED50_ESPAÑA ; a = 6378388.000000; 1/f = 297.000000;
> >  Coordinate transformation from WGS84 to mapping frame datum 
> >     dX = 125.098545; dY = 76.000054; dZ = 156.198703; f = 0.999991695369; 
> >     R1 = 0.000000000000; R2 = 0.000000000000; R3 = -0.000005473550;
> >  sequence of the rotations: x,y,z,1 
> >  Mapping frame projection : TM;
> >  central meridian = -3.000000 deg;
> >  latitude of the grid origin = 0.000000 deg; grid scale factor = 0.999600: 
> >  false easting = 500000.000000 m; false northing = 0.000000 m; 
> > 
> >  
> > Where Rotations are in radians 
> 
> I have tried setting proj to use this, as reported earlier in this thread, with no luck. I tried using the 7 parameters as 
> +towgs84=125.098545,76.000054,156.198703,0.0,0.0,-1.129,-8.30463103, but that made things worse.
> 
> fromProj = pj_init_plus(
>                         "+proj=latlong "
>                         "+ellps=WGS84 "
>                         "+no_defs");
> 
> toProj = pj_init_plus(
>                         "+proj=utm "
>                         "+ellps=intl "
>                         "+k=0.999600 "
>                         "+x_0=500000.0 "
>                         "+y_0=0.0 "
>                         "+zone=30 "
>                         "+units=m"
> 
> "+towgs84=125.098545,76.000054,156.198703,0.0,0.0,-1.129,-8.30463103"
>                         "+no_defs");
> 
> So I am guessing I cannot simply use the 7 parameters as given. Correct?

The towgs84 parameters I had been tying to use were correct - except in
sign. The best settings for matching Applanix/Trimble and a few other
packages is:

fromProj = pj_init_plus( "+proj=latlong "
                                       "+ellps=WGS84 "
                                       "+towgs84=0,0,0 "
                                       "+no_defs");

toProj   = pj_init_plus( "+proj=utm "
                                     "+ellps=intl "
                                     "+k=0.999600 "
                                     "+x_0=500000.0 "
                                     "+y_0=0.0 "
                                     "+zone=30 "
                                     "+units=m "

"+towgs84=-125.098545,-76.000054,-156.198703,0.0,0.0,-1.129,8.30463103 "
                                     "+no_defs");

Note the difference in signs from the earlier one. The earlier one had
at least a 1 meter error. Often more than 2 meters. The one just above
is at worst within 0.03 meters. Quite often it is much better. Often
0.0000 meters :)

I am preparing to be happy.

-- 
Roger Oberholtzer

OPQ Systems / Ramböll RST

Ramböll Sverige AB
Kapellgränd 7
P.O. Box 4205
SE-102 65 Stockholm, Sweden

Office: Int +46 8-615 60 20
Mobile: Int +46 70-815 1696



From ed at topozone.com  Thu Jan 17 09:58:25 2008
From: ed at topozone.com (Ed McNierney)
Date: Thu, 17 Jan 2008 12:58:25 -0500
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com><478D6C83.3070605@pobox.com><995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com><478D8B24.2080708@pobox.com><B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com><E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com><F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com><4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
	<ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>
Message-ID: <4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>

Rich -

It's actually not much, and is pretty hardwired for NAD27/NAD83 support
and converting UTM to lat/lon coordinates.

All maps displayed on TopoZone are in the UTM projection.  I calculate
the bounding box coordinates for each map in NAD27 UTM and NAD83 UTM,
and pre-load that data on the page, accessible to JavaScript (just some
global variables).  As a subscriber moves the mouse over the map, the
coordinates of the point under the cursor are displayed in the browser
status bar.  For UTM coordinates, it's simple linear interpolation
across the image extent.  If the user chooses lat/lon display, I use the
JavaScript code below to convert on the fly as the mouse is moved over
the map. It's a one-way conversion from UTM to LL, and relies on a
global variable (datumFlag) to indicate NAD27 (0) or NAD83 (1).

Please remember that this is not a general solution but is designed only
to work properly for valid NAD27 (North American) coordinates.

	- Ed

function UTMtoLL(UTMNorthing, UTMEasting, UTMZone)
{
	var deg2rad = Math.PI / 180;
	var rad2deg = 180.0 / Math.PI;

	var k0 = 0.9996;
	var a;
	var eccSquared;
	var eccPrimeSquared;
	var e1;
	var N1, T1, C1, R1, D, M;
	var LongOrigin;
	var mu, phi1, phi1Rad;
	var x, y;
	var ZoneNumber;

	if (datumFlag == 0)
	{
		a = 6378206;
		eccSquared = 0.006768658;
	} else
	{
		a = 6378137;
		eccSquared = 0.00669438;
	}
			
	e1 = (1-Math.sqrt(1-eccSquared))/(1+Math.sqrt(1-eccSquared));
	x = UTMEasting - 500000.0; //remove 500,000 meter offset for
longitude
	y = UTMNorthing;

	ZoneNumber = UTMZone;

	LongOrigin = (ZoneNumber - 1)*6 - 180 + 3;  //+3 puts origin in
middle of zone

	eccPrimeSquared = (eccSquared)/(1-eccSquared);

	M = y / k0;
	mu =
M/(a*(1-eccSquared/4-3*eccSquared*eccSquared/64-5*eccSquared*eccSquared*
eccSquared/256));

	phi1Rad = mu	+ (3*e1/2-27*e1*e1*e1/32)*Math.sin(2*mu) 
				+
(21*e1*e1/16-55*e1*e1*e1*e1/32)*Math.sin(4*mu)
				+(151*e1*e1*e1/96)*Math.sin(6*mu);
	phi1 = phi1Rad*rad2deg;

	N1 =
a/Math.sqrt(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Rad));
	T1 = Math.tan(phi1Rad)*Math.tan(phi1Rad);
	C1 = eccPrimeSquared*Math.cos(phi1Rad)*Math.cos(phi1Rad);
	R1 =
a*(1-eccSquared)/Math.pow(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Ra
d), 1.5);
	D = x/(N1*k0);

	Lat = phi1Rad -
(N1*Math.tan(phi1Rad)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*eccPrimeSquared
)*D*D*D*D/24
	
+(61+90*T1+298*C1+45*T1*T1-252*eccPrimeSquared-3*C1*C1)*D*D*D*D*D*D/720)
;
	Lat = Lat * rad2deg;
	LatS = formatDeg (Lat,0) + "N";
	
	Long =
(D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*eccPrimeSquared+24*T1*T1)
	
*D*D*D*D*D/120)/Math.cos(phi1Rad);
	Long = LongOrigin + Long * rad2deg;
	LongS = formatDeg (Long,0) + "W";
}

-----Original Message-----
From: proj-bounces at lists.maptools.org
[mailto:proj-bounces at lists.maptools.org] On Behalf Of Richard Greenwood
Sent: Wednesday, January 16, 2008 11:13 PM
To: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard

On Jan 16, 2008 9:09 AM, Ed McNierney <ed at topozone.com> wrote:
> William -
>
> I wouldn't claim to be "definitive" but I get the same results as you
report on PROJ 4.5.0 running on Windows, and with my interactive
JavaScript coordinate/datum converter on the TopoZone site (which uses
PROJ behind the scenes for datum shifts).
>
>      - Ed

Ed,

I curious about your JavaScript coordinate converted because I've done
a little work on one myself. I took a quick look on TopoZone and
didn't see it. Could you point me to it?

Rich

-- 
Richard Greenwood
richard.greenwood at gmail.com
www.greenwoodmap.com
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj



From diegoguidi at gmail.com  Thu Jan 17 11:27:07 2008
From: diegoguidi at gmail.com (D_Guidi)
Date: Thu, 17 Jan 2008 11:27:07 -0800 (PST)
Subject: [Proj] Question about Italian conversion
Message-ID: <14928933.post@talk.nabble.com>



Massimo De Marchi wrote:
> 
> Thanks for the help!
> 

Did you have resolved the problem?
I'm trying to fix the conversion from Monte Mario to WGS 84, with gdal I
have noticed some conversion errors.
Could you send me the correct parameters to insert in proj definitions?
Thanks ;)

-- 
View this message in context: http://www.nabble.com/Question-about-Italian-conversion-tp14486133p14928933.html
Sent from the PROJ.4 mailing list archive at Nabble.com.



From al001 at uni-koeln.de  Thu Jan 17 11:29:03 2008
From: al001 at uni-koeln.de (Irwin Scollar)
Date: Thu, 17 Jan 2008 20:29:03 +0100
Subject: [Proj] Spain Datum Transformations
In-Reply-To: <200801171703.m0HH2ien022959@duke.maptools.org>
References: <200801171703.m0HH2ien022959@duke.maptools.org>
Message-ID: <200801171929.m0HJT6kB030322@smtp-auth.uni-koeln.de>

Recent official constants for datum transformation in Spain are to be found in:

www.euref-iag.net/symposia/book2003/4-6.pdf

These give very accurate results in the north-east corner of the 
country and in the Baleric islands as well as on the mainland.

Irwin Scollar




From richard.greenwood at gmail.com  Thu Jan 17 17:34:06 2008
From: richard.greenwood at gmail.com (Richard Greenwood)
Date: Thu, 17 Jan 2008 18:34:06 -0700
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D6C83.3070605@pobox.com>
	<995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
	<ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>
	<4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>
Message-ID: <ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>

Ed,

Thanks for the detailed explanation. Nice, clean solution (I'd expect
no less fro you)!

I've done a bit of work on porting cs2cs to JavaScript. Grid shift
transformations pose an interesting challenge if you want to transfer
a minimum of data to the browser. Which is why I was curious as to
what you were doing.

Rich



On Jan 17, 2008 10:58 AM, Ed McNierney <ed at topozone.com> wrote:
> Rich -
>
> It's actually not much, and is pretty hardwired for NAD27/NAD83 support
> and converting UTM to lat/lon coordinates.
>
> All maps displayed on TopoZone are in the UTM projection.  I calculate
> the bounding box coordinates for each map in NAD27 UTM and NAD83 UTM,
> and pre-load that data on the page, accessible to JavaScript (just some
> global variables).  As a subscriber moves the mouse over the map, the
> coordinates of the point under the cursor are displayed in the browser
> status bar.  For UTM coordinates, it's simple linear interpolation
> across the image extent.  If the user chooses lat/lon display, I use the
> JavaScript code below to convert on the fly as the mouse is moved over
> the map. It's a one-way conversion from UTM to LL, and relies on a
> global variable (datumFlag) to indicate NAD27 (0) or NAD83 (1).
>
> Please remember that this is not a general solution but is designed only
> to work properly for valid NAD27 (North American) coordinates.
>
>         - Ed
>
> function UTMtoLL(UTMNorthing, UTMEasting, UTMZone)
> {
>         var deg2rad = Math.PI / 180;
>         var rad2deg = 180.0 / Math.PI;
>
>         var k0 = 0.9996;
>         var a;
>         var eccSquared;
>         var eccPrimeSquared;
>         var e1;
>         var N1, T1, C1, R1, D, M;
>         var LongOrigin;
>         var mu, phi1, phi1Rad;
>         var x, y;
>         var ZoneNumber;
>
>         if (datumFlag == 0)
>         {
>                 a = 6378206;
>                 eccSquared = 0.006768658;
>         } else
>         {
>                 a = 6378137;
>                 eccSquared = 0.00669438;
>         }
>
>         e1 = (1-Math.sqrt(1-eccSquared))/(1+Math.sqrt(1-eccSquared));
>         x = UTMEasting - 500000.0; //remove 500,000 meter offset for
> longitude
>         y = UTMNorthing;
>
>         ZoneNumber = UTMZone;
>
>         LongOrigin = (ZoneNumber - 1)*6 - 180 + 3;  //+3 puts origin in
> middle of zone
>
>         eccPrimeSquared = (eccSquared)/(1-eccSquared);
>
>         M = y / k0;
>         mu =
> M/(a*(1-eccSquared/4-3*eccSquared*eccSquared/64-5*eccSquared*eccSquared*
> eccSquared/256));
>
>         phi1Rad = mu    + (3*e1/2-27*e1*e1*e1/32)*Math.sin(2*mu)
>                                 +
> (21*e1*e1/16-55*e1*e1*e1*e1/32)*Math.sin(4*mu)
>                                 +(151*e1*e1*e1/96)*Math.sin(6*mu);
>         phi1 = phi1Rad*rad2deg;
>
>         N1 =
> a/Math.sqrt(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Rad));
>         T1 = Math.tan(phi1Rad)*Math.tan(phi1Rad);
>         C1 = eccPrimeSquared*Math.cos(phi1Rad)*Math.cos(phi1Rad);
>         R1 =
> a*(1-eccSquared)/Math.pow(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Ra
> d), 1.5);
>         D = x/(N1*k0);
>
>         Lat = phi1Rad -
> (N1*Math.tan(phi1Rad)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*eccPrimeSquared
> )*D*D*D*D/24
>
> +(61+90*T1+298*C1+45*T1*T1-252*eccPrimeSquared-3*C1*C1)*D*D*D*D*D*D/720)
> ;
>         Lat = Lat * rad2deg;
>         LatS = formatDeg (Lat,0) + "N";
>
>         Long =
> (D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*eccPrimeSquared+24*T1*T1)
>
> *D*D*D*D*D/120)/Math.cos(phi1Rad);
>         Long = LongOrigin + Long * rad2deg;
>         LongS = formatDeg (Long,0) + "W";
> }
>
> -----Original Message-----
> From: proj-bounces at lists.maptools.org
> [mailto:proj-bounces at lists.maptools.org] On Behalf Of Richard Greenwood
> Sent: Wednesday, January 16, 2008 11:13 PM
> To: PROJ.4 and general Projections Discussions
> Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard
>
>
> On Jan 16, 2008 9:09 AM, Ed McNierney <ed at topozone.com> wrote:
> > William -
> >
> > I wouldn't claim to be "definitive" but I get the same results as you
> report on PROJ 4.5.0 running on Windows, and with my interactive
> JavaScript coordinate/datum converter on the TopoZone site (which uses
> PROJ behind the scenes for datum shifts).
> >
> >      - Ed
>
> Ed,
>
> I curious about your JavaScript coordinate converted because I've done
> a little work on one myself. I took a quick look on TopoZone and
> didn't see it. Could you point me to it?
>
> Rich
>
> --
> Richard Greenwood
> richard.greenwood at gmail.com
> www.greenwoodmap.com
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>



-- 
Richard Greenwood
richard.greenwood at gmail.com
www.greenwoodmap.com


From ed at topozone.com  Thu Jan 17 19:28:42 2008
From: ed at topozone.com (Ed McNierney)
Date: Thu, 17 Jan 2008 22:28:42 -0500
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com><478D6C83.3070605@pobox.com><995C4987-3C97-4E84-8535-58687DE395B7@kyngchaos.com><478D8B24.2080708@pobox.com><B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com><E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com><F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com><4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com><ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com><4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>
	<ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>
Message-ID: <4BF377919225F449BB097CB76FFE9BC8019887F4@ptolemy.topozone.com>

Rich -

The one thing that significantly surprised me was how well that code
performed on low-end machines.  I think I released it in 2002 - maybe
2001 - and there were plenty of "slow" computers visiting TopoZone.  I
realize it's just math (other than updating the status bar with the
formatted coordinate text), but I was really expecting to see some kind
of lag if you waved the mouse quickly on a slow machine, but I never saw
the slightest delay.  I have found that I sometimes worry excessively
about performance!

	- Ed

-----Original Message-----
From: proj-bounces at lists.maptools.org
[mailto:proj-bounces at lists.maptools.org] On Behalf Of Richard Greenwood
Sent: Thursday, January 17, 2008 8:34 PM
To: PROJ.4 and general Projections Discussions
Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard

Ed,

Thanks for the detailed explanation. Nice, clean solution (I'd expect
no less fro you)!

I've done a bit of work on porting cs2cs to JavaScript. Grid shift
transformations pose an interesting challenge if you want to transfer
a minimum of data to the browser. Which is why I was curious as to
what you were doing.

Rich



On Jan 17, 2008 10:58 AM, Ed McNierney <ed at topozone.com> wrote:
> Rich -
>
> It's actually not much, and is pretty hardwired for NAD27/NAD83
support
> and converting UTM to lat/lon coordinates.
>
> All maps displayed on TopoZone are in the UTM projection.  I calculate
> the bounding box coordinates for each map in NAD27 UTM and NAD83 UTM,
> and pre-load that data on the page, accessible to JavaScript (just
some
> global variables).  As a subscriber moves the mouse over the map, the
> coordinates of the point under the cursor are displayed in the browser
> status bar.  For UTM coordinates, it's simple linear interpolation
> across the image extent.  If the user chooses lat/lon display, I use
the
> JavaScript code below to convert on the fly as the mouse is moved over
> the map. It's a one-way conversion from UTM to LL, and relies on a
> global variable (datumFlag) to indicate NAD27 (0) or NAD83 (1).
>
> Please remember that this is not a general solution but is designed
only
> to work properly for valid NAD27 (North American) coordinates.
>
>         - Ed
>
> function UTMtoLL(UTMNorthing, UTMEasting, UTMZone)
> {
>         var deg2rad = Math.PI / 180;
>         var rad2deg = 180.0 / Math.PI;
>
>         var k0 = 0.9996;
>         var a;
>         var eccSquared;
>         var eccPrimeSquared;
>         var e1;
>         var N1, T1, C1, R1, D, M;
>         var LongOrigin;
>         var mu, phi1, phi1Rad;
>         var x, y;
>         var ZoneNumber;
>
>         if (datumFlag == 0)
>         {
>                 a = 6378206;
>                 eccSquared = 0.006768658;
>         } else
>         {
>                 a = 6378137;
>                 eccSquared = 0.00669438;
>         }
>
>         e1 = (1-Math.sqrt(1-eccSquared))/(1+Math.sqrt(1-eccSquared));
>         x = UTMEasting - 500000.0; //remove 500,000 meter offset for
> longitude
>         y = UTMNorthing;
>
>         ZoneNumber = UTMZone;
>
>         LongOrigin = (ZoneNumber - 1)*6 - 180 + 3;  //+3 puts origin
in
> middle of zone
>
>         eccPrimeSquared = (eccSquared)/(1-eccSquared);
>
>         M = y / k0;
>         mu =
>
M/(a*(1-eccSquared/4-3*eccSquared*eccSquared/64-5*eccSquared*eccSquared*
> eccSquared/256));
>
>         phi1Rad = mu    + (3*e1/2-27*e1*e1*e1/32)*Math.sin(2*mu)
>                                 +
> (21*e1*e1/16-55*e1*e1*e1*e1/32)*Math.sin(4*mu)
>                                 +(151*e1*e1*e1/96)*Math.sin(6*mu);
>         phi1 = phi1Rad*rad2deg;
>
>         N1 =
> a/Math.sqrt(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Rad));
>         T1 = Math.tan(phi1Rad)*Math.tan(phi1Rad);
>         C1 = eccPrimeSquared*Math.cos(phi1Rad)*Math.cos(phi1Rad);
>         R1 =
>
a*(1-eccSquared)/Math.pow(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Ra
> d), 1.5);
>         D = x/(N1*k0);
>
>         Lat = phi1Rad -
>
(N1*Math.tan(phi1Rad)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*eccPrimeSquared
> )*D*D*D*D/24
>
>
+(61+90*T1+298*C1+45*T1*T1-252*eccPrimeSquared-3*C1*C1)*D*D*D*D*D*D/720)
> ;
>         Lat = Lat * rad2deg;
>         LatS = formatDeg (Lat,0) + "N";
>
>         Long =
>
(D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*eccPrimeSquared+24*T1*T1)
>
> *D*D*D*D*D/120)/Math.cos(phi1Rad);
>         Long = LongOrigin + Long * rad2deg;
>         LongS = formatDeg (Long,0) + "W";
> }
>
> -----Original Message-----
> From: proj-bounces at lists.maptools.org
> [mailto:proj-bounces at lists.maptools.org] On Behalf Of Richard
Greenwood
> Sent: Wednesday, January 16, 2008 11:13 PM
> To: PROJ.4 and general Projections Discussions
> Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard
>
>
> On Jan 16, 2008 9:09 AM, Ed McNierney <ed at topozone.com> wrote:
> > William -
> >
> > I wouldn't claim to be "definitive" but I get the same results as
you
> report on PROJ 4.5.0 running on Windows, and with my interactive
> JavaScript coordinate/datum converter on the TopoZone site (which uses
> PROJ behind the scenes for datum shifts).
> >
> >      - Ed
>
> Ed,
>
> I curious about your JavaScript coordinate converted because I've done
> a little work on one myself. I took a quick look on TopoZone and
> didn't see it. Could you point me to it?
>
> Rich
>
> --
> Richard Greenwood
> richard.greenwood at gmail.com
> www.greenwoodmap.com
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>



-- 
Richard Greenwood
richard.greenwood at gmail.com
www.greenwoodmap.com
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj



From richard.greenwood at gmail.com  Thu Jan 17 20:50:56 2008
From: richard.greenwood at gmail.com (Richard Greenwood)
Date: Thu, 17 Jan 2008 21:50:56 -0700
Subject: [Proj] NAD problems on OSX 10.5 Leopard
In-Reply-To: <4BF377919225F449BB097CB76FFE9BC8019887F4@ptolemy.topozone.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>
	<478D8B24.2080708@pobox.com>
	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>
	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>
	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>
	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>
	<ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>
	<4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>
	<ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>
	<4BF377919225F449BB097CB76FFE9BC8019887F4@ptolemy.topozone.com>
Message-ID: <ae9185aa0801172050w19310310oa9f0a1e3942e8e63@mail.gmail.com>

On Jan 17, 2008 8:28 PM, Ed McNierney <ed at topozone.com> wrote:
> Rich -
>
> The one thing that significantly surprised me was how well that code
> performed on low-end machines.  I think I released it in 2002 - maybe
> 2001 - and there were plenty of "slow" computers visiting TopoZone.  I
> realize it's just math (other than updating the status bar with the
> formatted coordinate text), but I was really expecting to see some kind
> of lag if you waved the mouse quickly on a slow machine, but I never saw
> the slightest delay.  I have found that I sometimes worry excessively
> about performance!
>
>         - Ed

I believe it was you who coined the term "premature optimization",
which always gets a chuckle when I use it. And I too have been amazed
at the performance of the JavaScript code I ported that does one or
more a projections (or unprojections) and a 7 parameter datum
transform for every pixel the user passes over. I kind of remember
computer science texts that discouraged us from using floating point
math if it could possibly be done with integers.

-- 
Richard Greenwood
richard.greenwood at gmail.com
www.greenwoodmap.com


From strebe at aol.com  Thu Jan 17 21:21:23 2008
From: strebe at aol.com (strebe at aol.com)
Date: Fri, 18 Jan 2008 00:21:23 -0500
Subject: [Proj] Re: NAD problems on OSX 10.5 Leopard
In-Reply-To: <ae9185aa0801172050w19310310oa9f0a1e3942e8e63@mail.gmail.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>	<478D8B24.2080708@pobox.com>	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>	<ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>	<ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F4@ptolemy.topozone.com>
	<ae9185aa0801172050w19310310oa9f0a1e3942e8e63@mail.gmail.com>
Message-ID: <8CA27A91A16523C-304-4E5@FWM-M25.sysops.aol.com>


 


 "Premature optimization" was probably coined by pioneering computer scientist C.A.R. Hoare, who said, "Premature optimization is the root of all evil." Sadly, this is often misunderstood to mean, "Engineering for scalability is the root of all evil."

Regards,
-- daan Strebe



 

-----Original Message-----
From: Richard Greenwood <richard.greenwood at gmail.com>
To: PROJ.4 and general Projections Discussions <proj at lists.maptools.org>
Sent: Thu, 17 Jan 2008 8:50 pm
Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard










On Jan 17, 2008 8:28 PM, Ed McNierney <ed at topozone.com> wrote:
> Rich -
>
> The one thing that significantly surprised me was how well that code
> performed on low-end machines.  I think I released it in 2002 - maybe
> 2001 - and there were plenty of "slow" computers visiting TopoZone.  I
> realize it's just math (other than updating the status bar with the
> formatted coordinate text), but I was really expecting to see some kind
> of lag if you waved the mouse quickly on a slow machine, but I never saw
> the slightest delay.  I have found that I sometimes worry excessively
> about performance!
>
>         - Ed

I believe it was you who coined the term "premature optimization",
which always gets a chuckle when I use it. And I too have been amazed
at the performance of the JavaScript code I ported that does one or
more a projections (or unprojections) and a 7 parameter datum
transform for every pixel the user passes over. I kind of remember
computer science texts that discouraged us from using floating point
math if it could possibly be done with integers.

-- 
Richard Greenwood
richard.greenwood at gmail.com
www.greenwoodmap.com
_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj



 


________________________________________________________________________
More new features than ever.  Check out the new AOL Mail ! - http://webmail.aol.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080118/51e8628a/attachment.html>

From ed at topozone.com  Fri Jan 18 05:03:51 2008
From: ed at topozone.com (Ed McNierney)
Date: Fri, 18 Jan 2008 08:03:51 -0500
Subject: [Proj] Re: NAD problems on OSX 10.5 Leopard
In-Reply-To: <8CA27A91A16523C-304-4E5@FWM-M25.sysops.aol.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>	<478D8B24.2080708@pobox.com>	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>	<ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>	<ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F4@ptolemy.topozone.com><ae9185aa0801172050w19310310oa9f0a1e3942e8e63@mail.gmail.com>
	<8CA27A91A16523C-304-4E5@FWM-M25.sysops.aol.com>
Message-ID: <4BF377919225F449BB097CB76FFE9BC8019887F5@ptolemy.topozone.com>

Daan & Rich -

 

I think I'd want to remember that "premature optimization" really
reminds us to "make it work correctly, THEN make it work quickly"!  This
is related to the observation that any code can be made to execute
arbitrarily quickly as long as it is not required to produce the right
answer.

 

I have to say that whatever its origin, I picked up the phrase from my
friend and co-worker Bob Frankston (author of VisiCalc), who was (and
is) fond of pithy pronouncements.

 

-          Ed

 

From: proj-bounces at lists.maptools.org
[mailto:proj-bounces at lists.maptools.org] On Behalf Of strebe at aol.com
Sent: Friday, January 18, 2008 12:21 AM
To: proj at lists.maptools.org
Subject: [Proj] Re: NAD problems on OSX 10.5 Leopard

 

 

"Premature optimization" was probably coined by pioneering computer
scientist C.A.R. Hoare, who said, "Premature optimization is the root of
all evil." Sadly, this is often misunderstood to mean, "Engineering for
scalability is the root of all evil."

Regards,
-- daan Strebe

 

-----Original Message-----
From: Richard Greenwood <richard.greenwood at gmail.com>
To: PROJ.4 and general Projections Discussions <proj at lists.maptools.org>
Sent: Thu, 17 Jan 2008 8:50 pm
Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard

On Jan 17, 2008 8:28 PM, Ed McNierney <ed at topozone.com> wrote:




> Rich -




>




> The one thing that significantly surprised me was how well that code




> performed on low-end machines.  I think I released it in 2002 - maybe




> 2001 - and there were plenty of "slow" computers visiting TopoZone.  I




> realize it's just math (other than updating the status bar with the




> formatted coordinate text), but I was really expecting to see some
kind




> of lag if you waved the mouse quickly on a slow machine, but I never
saw




> the slightest delay.  I have found that I sometimes worry excessively




> about performance!




>




>         - Ed









I believe it was you who coined the term "premature optimization",




which always gets a chuckle when I use it. And I too have been amazed




at the performance of the JavaScript code I ported that does one or




more a projections (or unprojections) and a 7 parameter datum




transform for every pixel the user passes over. I kind of remember




computer science texts that discouraged us from using floating point




math if it could possibly be done with integers.









-- 




Richard Greenwood




richard.greenwood at gmail.com




www.greenwoodmap.com




_______________________________________________




Proj mailing list




Proj at lists.maptools.org




http://lists.maptools.org/mailman/listinfo/proj
________________________________


More new features than ever. Check out the new AOL Mail
<http://o.aolcdn.com/cdn.webmail.aol.com/mailtour/aol/en-us/text.htm?nci
d=aolcmp00050000000003> !

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080118/5d6545cf/attachment.html>

From nhv at cape.com  Fri Jan 18 05:35:52 2008
From: nhv at cape.com (Norman Vine)
Date: Fri, 18 Jan 2008 08:35:52 -0500
Subject: [Proj] Re: NAD problems on OSX 10.5 Leopard
In-Reply-To: <4BF377919225F449BB097CB76FFE9BC8019887F5@ptolemy.topozone.com>
Message-ID: <20080118142600.5D26630E91F@mrelay1.cape.com>

Ed McNierney writes:
>  
> 
> I think I'd want to remember that "premature optimization" 
> really reminds us to "make it work correctly, THEN make it 
> work quickly"!  This is related to the observation that any 
> code can be made to execute arbitrarily quickly as long as it 
> is not required to produce the right answer.

A modern take 

The Fallacy of Premature Optimization

by Randall Hyde

Every programmer with a few years' experience or education has 
heard the phrase "premature optimization is the root of all evil." 
This famous quote by Sir Tony Hoare (popularized by Donald Knuth)

http://www.acm.org/ubiquity/views/v7i24_fallacy.html

Cheers

Norman



From oliver.eichler at dspsolutions.de  Fri Jan 18 08:20:16 2008
From: oliver.eichler at dspsolutions.de (Oliver Eichler)
Date: Fri, 18 Jan 2008 17:20:16 +0100
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
Message-ID: <4790D1C0.5090002@dspsolutions.de>

Hi,

I need a little help here. I am using proj4 with the BETA2007.gsb
correction coefficients  for Germany.

On one machine I do this with proj4-4.5 and get the expected result.
export PROJ_DEBUG=10 will log that the file is loaded and read.

On another machine I use pro4-4.6 and correction fails. export
PROJ_DEBUG=10 will log nothing.

Anything broken?


Oliver




From warmerdam at pobox.com  Fri Jan 18 10:49:59 2008
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Fri, 18 Jan 2008 13:49:59 -0500
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
In-Reply-To: <4790D1C0.5090002@dspsolutions.de>
References: <4790D1C0.5090002@dspsolutions.de>
Message-ID: <4790F4D7.4040401@pobox.com>

Oliver Eichler wrote:
> Hi,
> 
> I need a little help here. I am using proj4 with the BETA2007.gsb
> correction coefficients  for Germany.
> 
> On one machine I do this with proj4-4.5 and get the expected result.
> export PROJ_DEBUG=10 will log that the file is loaded and read.
> 
> On another machine I use pro4-4.6 and correction fails. export
> PROJ_DEBUG=10 will log nothing.
> 

Oliver,

I'm not aware of any change in handling datum shift files in 4.6 vs
4.5.  I would suggest you carefully review your PROJ_LIB setting in
the two environments.  If everything still checks out, perhaps you can
describe the exact command you are using,and make the .gsb file available
so others can try the same thing.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | President OSGeo, http://osgeo.org



From strebe at aol.com  Fri Jan 18 13:28:25 2008
From: strebe at aol.com (strebe at aol.com)
Date: Fri, 18 Jan 2008 16:28:25 -0500
Subject: [Proj] Re: Premature optimization [was NAD problems on OSX 10.5
	Leopard]
In-Reply-To: <4BF377919225F449BB097CB76FFE9BC8019887F5@ptolemy.topozone.com>
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>	<478D8B24.2080708@pobox.com>	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>	<ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>	<ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F4@ptolemy.topozone.com><ae9185aa0801172050w19310310oa9f0a1e3942e8e63@mail.gmail.com>	<8CA27A91A16523C-304-4E5@FWM-M25.sysops.aol.com>
	<4BF377919225F449BB097CB76FFE9BC8019887F5@ptolemy.topozone.com>
Message-ID: <8CA2830318CA729-304-2F07@FWM-M25.sysops.aol.com>



 

Not to be a curmudgeon, Ed (and Norman), but that isn't what the quote means, and that is exactly what I meant by "Often misunderstood to mean, 'Engineering for scalability is the root of all evil.'" The original quote, in its full glory, is "We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil." It is the "small efficiencies" disclaimer that is important.

Let us say your program is required (amongst many other operations) to sort a lot of numbers. You know from the beginning that "a lot" isn't just some fixed 12 values; it's arbitrarily large. But, in order to avoid "premature optimization", you throw in a simple bubble sort and proceed with the remainder of your programming.


Well. You haven't avoided premature optimization.  You've written the wrong program. It won't scale. Bubble sort's execution time increases exponentially as the number of items to sort increase. It's inappropriate for any but the tiniest counts of numbers. You should have used quicksort instead. C.A.R. Hoare knew this and had it in mind — he did, after all, invent quicksort.


Yet I constantly run into colleagues who excuse their program's performance failures running under stress as, "Oh, I wanted to get it working; now we can optimize it." Well. Optimizing means tuning your algorithm. It doesn't mean replacing your algorithm. If you replace it, you're writing a new program. You have completely lost the benefit of concentrating on the algorithm instead of the performance details.

The correct interpretation is, "Choose the correct algorithm; tune it later if you need to."



Regards,

-- daan Strebe





 





 



-----Original Message-----

From: Ed McNierney <ed at topozone.com>

To: PROJ.4 and general Projections Discussions <proj at lists.maptools.org>

Sent: Fri, 18 Jan 2008 5:03 am

Subject: RE: [Proj] Re: NAD problems on OSX 10.5 Leopard






























Daan & Rich –





 





I think I’d want to remember that “premature optimization” really
reminds us to “make it work correctly, THEN make it work quickly”!  This is
related to the observation that any code can be made to execute arbitrarily
quickly as long as it is not required to produce the right answer.





 





I have to say that whatever its origin, I picked up the phrase
from my friend and co-worker Bob Frankston (author of VisiCalc), who was (and
is) fond of pithy pronouncements.





 





-         
Ed





 









From:
proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On
Behalf Of strebe at aol.com


Sent: Friday, January 18, 2008 12:21 AM


To: proj at lists.maptools.org


Subject: [Proj] Re: NAD problems on OSX 10.5 Leopard









 









 













"Premature
optimization" was probably coined by pioneering computer scientist C.A.R.
Hoare, who said, "Premature optimization is the root of all evil."
Sadly, this is often misunderstood to mean, "Engineering for scalability
is the root of all evil."





Regards,


-- daan Strebe













 









-----Original Message-----


From: Richard Greenwood <richard.greenwood at gmail.com>


To: PROJ.4 and general Projections Discussions <proj at lists.maptools.org>


Sent: Thu, 17 Jan 2008 8:50 pm


Subject: Re: [Proj] NAD problems on OSX 10.5 Leopard






On Jan 17, 2008 8:28 PM, Ed McNierney <ed at topozone.com> wrote:







> Rich -







>







> The one thing that significantly surprised me was how well that code







> performed on low-end machines.  I think I released it in 2002 - maybe







> 2001 - and there were plenty of "slow" computers visiting TopoZone.  I







> realize it's just math (other than updating the status bar with the







> formatted coordinate text), but I was really expecting to see some kind







> of lag if you waved the mouse quickly on a slow machine, but I never saw







> the slightest delay.  I have found that I sometimes worry excessively







> about performance!







>







>         - Ed















I believe it was you who coined the term "premature optimization",







which always gets a chuckle when I use it. And I too have been amazed







at the performance of the JavaScript code I ported that does one or







more a projections (or unprojections) and a 7 parameter datum







transform for every pixel the user passes over. I kind of remember







computer science texts that discouraged us from using floating point







math if it could possibly be done with integers.















-- 







Richard Greenwood







richard.greenwood at gmail.com







www.greenwoodmap.com







_______________________________________________







Proj mailing list







Proj at lists.maptools.org







http://lists.maptools.org/mailman/listinfo/proj






















More new features than ever. Check
out the new AOL Mail!













 






_______________________________________________

Proj mailing list

Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj




 


________________________________________________________________________
More new features than ever.  Check out the new AOL Mail ! - http://webmail.aol.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080118/502ac2fb/attachment.html>

From ed at topozone.com  Fri Jan 18 14:14:12 2008
From: ed at topozone.com (Ed McNierney)
Date: Fri, 18 Jan 2008 17:14:12 -0500
Subject: [Proj] Re: Premature optimization [was NAD problems on OSX
	10.5Leopard]
References: <5DBD9D46-F7C9-4A1F-A76A-E1834F58E981@kyngchaos.com>	<478D8B24.2080708@pobox.com>	<B2327293-D022-410E-8531-0D07F5C9A307@kyngchaos.com>	<E0307438-A68A-47B2-A2FC-2437651C19AD@kyngchaos.com>	<F0A9E764-1C8B-4FE1-8109-9A020CE5423B@kyngchaos.com>	<4BF377919225F449BB097CB76FFE9BC8019887DB@ptolemy.topozone.com>	<ae9185aa0801162012o6eb9e9bcx1cf60c4880efc78e@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F1@ptolemy.topozone.com>	<ae9185aa0801171734y69a612d2l4248eee3bf70e0e5@mail.gmail.com>	<4BF377919225F449BB097CB76FFE9BC8019887F4@ptolemy.topozone.com><ae9185aa0801172050w19310310oa9f0a1e3942e8e63@mail.gmail.com>	<8CA27A91A16523C-304-4E5@FWM-M25.sysops.aol.com><4BF377919225F449BB097CB76FFE9BC8019887F5@ptolemy.topozone.com>
	<8CA2830318CA729-304-2F07@FWM-M25.sysops.aol.com> 
Message-ID: <4BF377919225F449BB097CB76FFE9BC801988800@ptolemy.topozone.com>

Daan –

 

Curmudgeons?  On THIS list?  I’m shocked – shocked, I say!

-          Ed

 

From: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On Behalf Of strebe at aol.com
Sent: Friday, January 18, 2008 4:28 PM
To: proj at lists.maptools.org
Subject: [Proj] Re: Premature optimization [was NAD problems on OSX 10.5Leopard]

 


Not to be a curmudgeon, Ed (and Norman), but that isn't what the quote means, and that is exactly what I meant by "Often misunderstood to mean, 'Engineering for scalability is the root of all evil.'" The original quote, in its full glory, is "We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil." It is the "small efficiencies" disclaimer that is important.

Let us say your program is required (amongst many other operations) to sort a lot of numbers. You know from the beginning that "a lot" isn't just some fixed 12 values; it's arbitrarily large. But, in order to avoid "premature optimization", you throw in a simple bubble sort and proceed with the remainder of your programming.

Well. You haven't avoided premature optimization.  You've written the wrong program. It won't scale. Bubble sort's execution time increases exponentially as the number of items to sort increase. It's inappropriate for any but the tiniest counts of numbers. You should have used quicksort instead. C.A.R. Hoare knew this and had it in mind — he did, after all, invent quicksort.

Yet I constantly run into colleagues who excuse their program's performance failures running under stress as, "Oh, I wanted to get it working; now we can optimize it." Well. Optimizing means tuning your algorithm. It doesn't mean replacing your algorithm. If you replace it, you're writing a new program. You have completely lost the benefit of concentrating on the algorithm instead of the performance details.

The correct interpretation is, "Choose the correct algorithm; tune it later if you need to."

Regards,
-- daan Strebe

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080118/3e467e4d/attachment.html>

From oliver.eichler at dspsolutions.de  Mon Jan 21 00:34:56 2008
From: oliver.eichler at dspsolutions.de (Oliver Eichler)
Date: Mon, 21 Jan 2008 09:34:56 +0100
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
In-Reply-To: <4790F4D7.4040401@pobox.com>
References: <4790D1C0.5090002@dspsolutions.de> <4790F4D7.4040401@pobox.com>
Message-ID: <47945930.5070508@dspsolutions.de>

Frank Warmerdam schrieb:
>
> Oliver,
>
> I'm not aware of any change in handling datum shift files in 4.6 vs
> 4.5.  I would suggest you carefully review your PROJ_LIB setting in
> the two environments.  If everything still checks out, perhaps you can
> describe the exact command you are using,and make the .gsb file available
> so others can try the same thing.
>

Hi Frank,

I pulled the source from your webpage again and did:

./configure --prefix=/usr --libdir=/usr/lib64 && make

The projection string I use is:

"+proj=tmerc +lat_0=0 +lon_0=12 +k=1.000000 +x_0=4500000 +y_0=0
+ellps=bessel +datum=potsdam +units=m +no_defs  +nadgrids=./BETA2007.gsb"

The file BETA2007.gsb is in my working path (download
http://crs.bkg.bund.de/crseu/crs/descrtrans/BeTA/de_dhdn2etrs_beta.php)

ldd says:

libproj.so.0 => /usr/lib64/libproj.so.0 (0x00002b8376350000)

>ll /usr/lib64/libproj.*
-rw-r--r-- 1 root root 2020350 21. Jan 08:35 /usr/lib64/libproj.a
-rwxr-xr-x 1 root root     816 21. Jan 08:35 /usr/lib64/libproj.la
lrwxrwxrwx 1 root root      16 21. Jan 08:35 /usr/lib64/libproj.so ->
libproj.so.0.5.4
lrwxrwxrwx 1 root root      16 21. Jan 08:35 /usr/lib64/libproj.so.0 ->
libproj.so.0.5.4
-rwxr-xr-x 1 root root  914576 30. Nov 13:50 /usr/lib64/libproj.so.0.5.3
-rwxr-xr-x 1 root root  911873 21. Jan 08:35 /usr/lib64/libproj.so.0.5.4

Thus the correct library is linked.

In my code I do a:

...
pjtar   = pj_init_plus("+proj=longlat +ellps=WGS84 +no_defs");
pjrsc   =pj_init_plus(" +proj=tmerc +lat_0=0 +lon_0=12 +k=1.000000
+x_0=4500000 +y_0=0 +ellps=bessel +datum=potsdam +units=m +no_defs 
+nadgrids=./BETA2007.gsb");
...

and later a:

pj_transform(pjsrc,pjtar,1,0,&pt.u,&pt.v,0);

or:

pj_transform(pjtar,pjsrc,1,0,&pt.u,&pt.v,0);

to convert from m to degree, and vice versa.

export PROJ_DEBUG=10

won't give be any debug output on the PC with libproj.so.0.5.4. Whereas
it will give me output on a machine with libproj.so.0.5.2, telling that
it opens BETA2007.gsb and chooses the correct coefficient set for
correction.


Tell me if you need more information. Thanks for help.

Olver










From S.Pascoe at rl.ac.uk  Mon Jan 21 03:03:38 2008
From: S.Pascoe at rl.ac.uk (Pascoe, S (Stephen))
Date: Mon, 21 Jan 2008 11:03:38 -0000
Subject: [Proj] Representing rotated poles
Message-ID: <EB1E7CB92F5B35459E0B926D2A614DB6168A3D@EXCHANGE19.fed.cclrc.ac.uk>

Hi,
 
I deal with climate model data and have regional model data defined on a
long/lat grid with the poles rotated away from their true position (in
order to keep the pole singularities away from the region of interest).
Typically this grid would be defined as follows:
 
grid_north_pole_latitude:  39.2 deg (true latitude of rotated north
pole)
grid_north_pole_longitude: 198.0 deg (true longitude of rotated north
pole)
north_pole_grid_longitude: 0 deg (longitude of the prime meridian in the
rotated coordinate system)
 
How would I represent this coordinate system with proj4 parameters?  I
have been trying to use +towgs84:
 
+proj=longlat
+towgs84=0,0,0,-grid_north_pole_longitude*60*60,90-grid_north_pole_latit
ude*60*60,north_pole_grid_longitude,0
 
So far this doesn't seem to work (I'm using gdal to transform an image
to EPSG:4326).  Am I on the right lines?  Standard GIS terminology such
as datum, spheroid etc. are unfortunately not part of the standard
vocabulary of climate modellers.
 
Many thanks,
Stephen.
 
---
Stephen Pascoe  +44 (0)1235 445980
British Atmospheric Data Centre
Rutherford Appleton Laboratory
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080121/52599b31/attachment.html>

From warmerdam at pobox.com  Mon Jan 21 07:58:17 2008
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Mon, 21 Jan 2008 10:58:17 -0500
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
In-Reply-To: <47945930.5070508@dspsolutions.de>
References: <4790D1C0.5090002@dspsolutions.de> <4790F4D7.4040401@pobox.com>
	<47945930.5070508@dspsolutions.de>
Message-ID: <4794C119.5050508@pobox.com>

Oliver Eichler wrote:
> The projection string I use is:
> 
> "+proj=tmerc +lat_0=0 +lon_0=12 +k=1.000000 +x_0=4500000 +y_0=0
> +ellps=bessel +datum=potsdam +units=m +no_defs  +nadgrids=./BETA2007.gsb"

Oliver,

I think your problem is the coordinate system definition.  It includes
+datum=potsdam and +nadgrids. These will conflict and it isn't necessarily
clear whether PROJ.4 will use the +towgs84 definition expanded from the
+datum, or will use the +nadgrids values.  I'd guess the potsdam datum
was unknown (and so unexpanded) in the older version and now it does get
expanded and the towgs84 used instead of the nadgrids statement.  Instead
try using:

+proj=tmerc +lat_0=0 +lon_0=12 +k=1.000000 +x_0=4500000 +y_0=0
   +ellps=bessel +units=m +no_defs  +nadgrids=./BETA2007.gsb

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | President OSGeo, http://osgeo.org



From oliver.eichler at dspsolutions.de  Mon Jan 21 08:32:01 2008
From: oliver.eichler at dspsolutions.de (Oliver Eichler)
Date: Mon, 21 Jan 2008 17:32:01 +0100
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
In-Reply-To: <4794C119.5050508@pobox.com>
References: <4790D1C0.5090002@dspsolutions.de> <4790F4D7.4040401@pobox.com>
	<47945930.5070508@dspsolutions.de> <4794C119.5050508@pobox.com>
Message-ID: <4794C901.8030009@dspsolutions.de>

Hi Frank,
>
> I think your problem is the coordinate system definition.  It includes
> +datum=potsdam and +nadgrids. These will conflict and it isn't
> necessarily
> clear whether PROJ.4 will use the +towgs84 definition expanded from the
> +datum, or will use the +nadgrids values.  I'd guess the potsdam datum
> was unknown (and so unexpanded) in the older version and now it does get
> expanded and the towgs84 used instead of the nadgrids statement.  Instead
> try using:
>
> +proj=tmerc +lat_0=0 +lon_0=12 +k=1.000000 +x_0=4500000 +y_0=0
>   +ellps=bessel +units=m +no_defs  +nadgrids=./BETA2007.gsb
>

I wish it would be that simple :) That Potsdam datum is not my idea.
It's from a GeoTiff which I created with your tools by following code:

...
snprintf(strProj,sizeof(strProj),"+proj=tmerc +lat_0=0 +lon_0=%i
+k=1.000000 +x_0=%i +y_0=0 +ellps=bessel +units=m +no_defs", lon_0,
500000 + (lon_0/3) * 1000000);

OGRSpatialReference oSRS;
oSRS.importFromProj4(strProj);
oSRS.exportToWkt(&ptr);
dataset->SetProjection(ptr);

CPLFree(ptr);
...

gdalinfo tells me:

...
Coordinate System is:
PROJCS["unnamed",
    GEOGCS["DHDN",
        DATUM["Deutsches_Hauptdreiecksnetz",
            SPHEROID["Bessel 1841",6377397.155,299.1528128000008,
                AUTHORITY["EPSG","7004"]],
            AUTHORITY["EPSG","6314"]],
        PRIMEM["Greenwich",0],
        UNIT["degree",0.0174532925199433],
        AUTHORITY["EPSG","4314"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",12],
    PARAMETER["scale_factor",1],
    PARAMETER["false_easting",4500000],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]]]
...

And if I read the GeoTiff again I restore the projection by:
...
    char str[1024];
    strncpy(str,dataset->GetProjectionRef(),sizeof(str));
    char * ptr = str;
    OGRSpatialReference oSRS;
    oSRS.importFromWkt(&ptr);
    oSRS.exportToProj4(&ptr);
    strProj = ptr;
    strProj += " +nadgrids=./BETA2007.gsb";
    qDebug() << strProj;
    pj = pj_init_plus(strProj.toLatin1());
...

You see, no Potsdam datum to remove anywhere :) At least not visible for
me - ok I am still a noob to that stuff.

Oliver







From oliver.eichler at dspsolutions.de  Wed Jan 23 08:49:18 2008
From: oliver.eichler at dspsolutions.de (Oliver Eichler)
Date: Wed, 23 Jan 2008 17:49:18 +0100
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
In-Reply-To: <4794CD52.1070300@pobox.com>
References: <4790D1C0.5090002@dspsolutions.de> <4790F4D7.4040401@pobox.com>
	<47945930.5070508@dspsolutions.de> <4794C119.5050508@pobox.com>
	<4794C8EC.6080002@dspsolutions.de> <4794CD52.1070300@pobox.com>
Message-ID: <4797700E.7070903@dspsolutions.de>

Hi Frank,

looks like this mail died in the mail filter because it was to big. Thus
once again without the BETA2007 file:


>
> Presumably the +datum=potsdam is embedded in "strProj" from the
> exportToProj4()
> result.  The issue is that exportToProj4() produces default information
> for the Potsdam datum which you want to override with the BETA2007.gsb
> grid file.  To do so you have to add the +nadgrids, and strip
> +datum=potsdam
> out of the string returned by exportToProj4.
>


No, it's not that simple.  I have attached a small C file.  I compile it
with:

gcc testpro.c -L/usr/lib64 -lproj -otestpro

On the machine with the Proj4-4.6 version this will output (bad):

4487992.480929,5421613.273181

On the machine with the Proj4-4.5 version this will output (good):

4488097.842111,5421724.742397


The BETA2007 file you get here.

http://crs.bkg.bund.de/crseu/crs/descrtrans/BeTA/de_dhdn2etrs_beta.php


Thanks for help

Oliver

-------------- next part --------------
A non-text attachment was scrubbed...
Name: testpro.c
Type: text/x-csrc
Size: 611 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20080123/8c0456f0/attachment.c>

From warmerdam at pobox.com  Wed Jan 23 10:57:10 2008
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed, 23 Jan 2008 13:57:10 -0500
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
In-Reply-To: <4797700E.7070903@dspsolutions.de>
References: <4790D1C0.5090002@dspsolutions.de> <4790F4D7.4040401@pobox.com>
	<47945930.5070508@dspsolutions.de> <4794C119.5050508@pobox.com>
	<4794C8EC.6080002@dspsolutions.de> <4794CD52.1070300@pobox.com>
	<4797700E.7070903@dspsolutions.de>
Message-ID: <47978E06.7020704@pobox.com>

Oliver Eichler wrote:
> No, it's not that simple.  I have attached a small C file.  I compile it
> with:
> 
> gcc testpro.c -L/usr/lib64 -lproj -otestpro
> 
> On the machine with the Proj4-4.6 version this will output (bad):
> 
> 4487992.480929,5421613.273181
> 
> On the machine with the Proj4-4.5 version this will output (good):
> 
> 4488097.842111,5421724.742397
/lists.maptools.org/mailman/listinfo/proj

Oliver,

You are quite right.  I tried this out and determined that you need
to declare your WGS84 coordinate system as +datum=WGS84, not +ellps=WGS84.

The big change in PROJ 4.6.0 was that pj_transform() will no longer try to
apply datum shifts if either the source or destination lack a datum
declaration (either +datum, +towgs84 or +nadgrids).  Your WGS84 declaration
was "+proj=longlat +ellps=WGS84 +no_defs" which means a geographic
coordinate system on the WGS84 ellipsoid but it provides no datum shift
info to get to the WGS84 datum.

Sorry for not realizing this sooner.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | President OSGeo, http://osgeo.org



From oliver.eichler at dspsolutions.de  Wed Jan 23 22:51:20 2008
From: oliver.eichler at dspsolutions.de (Oliver Eichler)
Date: Thu, 24 Jan 2008 07:51:20 +0100
Subject: [Proj] proj-4.6.0 and BETA2007.gsb
In-Reply-To: <4797700E.7070903@dspsolutions.de>
References: <4790D1C0.5090002@dspsolutions.de>
	<4790F4D7.4040401@pobox.com>	<47945930.5070508@dspsolutions.de>
	<4794C119.5050508@pobox.com>	<4794C8EC.6080002@dspsolutions.de>
	<4794CD52.1070300@pobox.com> <4797700E.7070903@dspsolutions.de>
Message-ID: <47983568.4020108@dspsolutions.de>

Perfect! That's it :)

Thanks a lot.


Oliver


From support.mn at elisanet.fi  Sun Jan 27 20:53:27 2008
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Mon, 28 Jan 2008 06:53:27 +0200 (EET)
Subject: [Proj] Representing rotated poles
Message-ID: <338107.769191201496008421.JavaMail.support.mn@elisanet.fi>

Hi,

what I understand, the most easy way is simply to rotate the poles back where they should be before using any proj-4, since that assumes that your coordinates are about right, datum shifts can only handle small shitfs in the rang of few hundred meters usually. I think proj-4 uses pole shifting internally with some projections, but externally nobady knows, since they are rotated back to their places after the math... well, several projections do that kind of tricks.. (?)

So you simply do the same. Add few lines in your code so that the poles get back to their right places, and then call proj-4. And if your application needs the results to be rotated, you simply add some more lines of code.

Regards: Janne.


---------------------


"Pascoe, S (Stephen)" <S.Pascoe at rl.ac.uk> kirjoitti: 
> Hi,
>  
> I deal with climate model data and have regional model data defined on a
> long/lat grid with the poles rotated away from their true position (in
> order to keep the pole singularities away from the region of interest).
> Typically this grid would be defined as follows:
>  
> grid_north_pole_latitude:  39.2 deg (true latitude of rotated north
> pole)
> grid_north_pole_longitude: 198.0 deg (true longitude of rotated north
> pole)
> north_pole_grid_longitude: 0 deg (longitude of the prime meridian in the
> rotated coordinate system)
>  
> How would I represent this coordinate system with proj4 parameters?  I
> have been trying to use +towgs84:
>  
> +proj=longlat
> +towgs84=0,0,0,-grid_north_pole_longitude*60*60,90-grid_north_pole_latit
> ude*60*60,north_pole_grid_longitude,0
>  
> So far this doesn't seem to work (I'm using gdal to transform an image
> to EPSG:4326).  Am I on the right lines?  Standard GIS terminology such
> as datum, spheroid etc. are unfortunately not part of the standard
> vocabulary of climate modellers.
>  
> Many thanks,
> Stephen.
>  
> ---
> Stephen Pascoe  +44 (0)1235 445980
> British Atmospheric Data Centre
> Rutherford Appleton Laboratory
>  
> 
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj



From cheynm at yahoo.com  Mon Jan 28 19:08:03 2008
From: cheynm at yahoo.com (Mark Cheyne)
Date: Mon, 28 Jan 2008 19:08:03 -0800 (PST)
Subject: [Proj] datum shifting - cs2cs build or config problem?
Message-ID: <499463.47853.qm@web32911.mail.mud.yahoo.com>

I'm trying to test my proj configuration.

There is an example in the FAQ
http://proj.maptools.org/faq.html:

cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong
+datum=NAD83 
-117 30

producing:

117d0'2.901"W   30d0'0.407"N 0.000

But when I try it, the following is produced:

117dW   30dN 0.000

That is, the output is identical to the input.

I am using binaries I built myself on Windows from the
4.5 source. 

If I try the 4.4.6 binaries that are available from
http://proj.maptools.org/ I get even worse results:

*       * 0.000

another symptom is what happens when I try to use
nad2nad. For example:

nad2nad -i 83 -i hpgn=WI -o 83

yields:

<nad2nad>:
hp datum file: WI, failed: No such file or directory
program abnormally terminated

I'm pretty out of my element when it comes to building
the source - merely trying to follow instructions. To
do it, I used Visual Studio 2003 and the commandline
'nmake /f makefile.vc all' on the source located at
c:\proj\src, and I have c:\proj\nad containing the
*.lla grid shift files, and I also have $PROJ_LIB set
to c:\proj. When the build runs, all the binary grid
shift files get created, a good sign.

Sorry if this is old hat, but I'm not having good luck
trying to search the email list archive...

A homebrew for an explanation.  ;-)  Thanks, Mark


      ____________________________________________________________________________________
Never miss a thing.  Make Yahoo your home page. 
http://www.yahoo.com/r/hs


From cheynm at yahoo.com  Mon Jan 28 19:36:49 2008
From: cheynm at yahoo.com (Mark Cheyne)
Date: Mon, 28 Jan 2008 19:36:49 -0800 (PST)
Subject: [Proj] Re: datum shifting - cs2cs build or config problem?
Message-ID: <595613.65046.qm@web32905.mail.mud.yahoo.com>

Partially solved. I quickly found one explanation - my
$PROJ_LIB was set to c:\proj, but it needed to be set
to c:\proj\nad.

So now I can run the example from the FAQ correctly.
Good sign.

However, consider this:

C:\proj>cs2cs +proj=latlong +ellps=GRS80 +datum=NAD83
+nadgrids=wi +to +proj=latlong
+ellps=GRS80+datum=NAD83
-89.8 44.166666667
89d47'59.992"W  44d10'0.003"N 0.000

What I am trying to say is that the input point is
NAD83HPGN(WI), and I want output in NAD83. I've run
this example through both NADCON and WISCON, both give
me the same result, different from what I got above:
-89 48 0.00849  44 9 59.99715

So it probably now comes down to user error - am I not
specifying that cs2cs command line correctly?

Mark 



--- Mark Cheyne <cheynm at yahoo.com> wrote:

> I'm trying to test my proj configuration.
> 
> There is an example in the FAQ
> http://proj.maptools.org/faq.html:
> 
> cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong
> +datum=NAD83 
> -117 30
> 
> producing:
> 
> 117d0'2.901"W   30d0'0.407"N 0.000
> 
> But when I try it, the following is produced:
> 
> 117dW   30dN 0.000
> 
> That is, the output is identical to the input.
> 
> I am using binaries I built myself on Windows from
> the
> 4.5 source. 
> 
> If I try the 4.4.6 binaries that are available from
> http://proj.maptools.org/ I get even worse results:
> 
> *       * 0.000
> 
> another symptom is what happens when I try to use
> nad2nad. For example:
> 
> nad2nad -i 83 -i hpgn=WI -o 83
> 
> yields:
> 
> <nad2nad>:
> hp datum file: WI, failed: No such file or directory
> program abnormally terminated
> 
> I'm pretty out of my element when it comes to
> building
> the source - merely trying to follow instructions.
> To
> do it, I used Visual Studio 2003 and the commandline
> 'nmake /f makefile.vc all' on the source located at
> c:\proj\src, and I have c:\proj\nad containing the
> *.lla grid shift files, and I also have $PROJ_LIB
> set
> to c:\proj. When the build runs, all the binary grid
> shift files get created, a good sign.
> 
> Sorry if this is old hat, but I'm not having good
> luck
> trying to search the email list archive...
> 
> A homebrew for an explanation.  ;-)  Thanks, Mark
> 
> 
>      
>
____________________________________________________________________________________
> Never miss a thing.  Make Yahoo your home page. 
> http://www.yahoo.com/r/hs
> 



      ____________________________________________________________________________________
Looking for last minute shopping deals?  
Find them fast with Yahoo! Search.  http://tools.search.yahoo.com/newsearch/category.php?category=shopping


From cheynm at yahoo.com  Mon Jan 28 19:57:53 2008
From: cheynm at yahoo.com (Mark Cheyne)
Date: Mon, 28 Jan 2008 19:57:53 -0800 (PST)
Subject: [Proj] Re: datum shifting - cs2cs build or config problem?
Message-ID: <700525.73593.qm@web32913.mail.mud.yahoo.com>

I get the same result from nad2nad as I get from
NADCON and WISCON:

C:\proj>nad2nad -i 83 -i hpgn=WI -o 83 -w5
-89.8 44.166666667
89d48'0.00849"W 44d9'59.99715"N

But as reported below, I get something else from
cs2cs:

> C:\proj>cs2cs +proj=latlong +ellps=GRS80
> +datum=NAD83
> +nadgrids=wi +to +proj=latlong
> +ellps=GRS80+datum=NAD83
> -89.8 44.166666667
> 89d47'59.992"W  44d10'0.003"N 0.000

I've tried noodling with my syntax, any suggestions
would be appreciated.

Mark

--- Mark Cheyne <cheynm at yahoo.com> wrote:

> Partially solved. I quickly found one explanation -
> my
> $PROJ_LIB was set to c:\proj, but it needed to be
> set
> to c:\proj\nad.
> 
> So now I can run the example from the FAQ correctly.
> Good sign.
> 
> However, consider this:
> 
> C:\proj>cs2cs +proj=latlong +ellps=GRS80
> +datum=NAD83
> +nadgrids=wi +to +proj=latlong
> +ellps=GRS80+datum=NAD83
> -89.8 44.166666667
> 89d47'59.992"W  44d10'0.003"N 0.000
> 
> What I am trying to say is that the input point is
> NAD83HPGN(WI), and I want output in NAD83. I've run
> this example through both NADCON and WISCON, both
> give
> me the same result, different from what I got above:
> -89 48 0.00849  44 9 59.99715
> 
> So it probably now comes down to user error - am I
> not
> specifying that cs2cs command line correctly?
> 
> Mark 
> 
> 
> 
> --- Mark Cheyne <cheynm at yahoo.com> wrote:
> 
> > I'm trying to test my proj configuration.
> > 
> > There is an example in the FAQ
> > http://proj.maptools.org/faq.html:
> > 
> > cs2cs +proj=latlong +datum=NAD27 +to +proj=latlong
> > +datum=NAD83 
> > -117 30
> > 
> > producing:
> > 
> > 117d0'2.901"W   30d0'0.407"N 0.000
> > 
> > But when I try it, the following is produced:
> > 
> > 117dW   30dN 0.000
> > 
> > That is, the output is identical to the input.
> > 
> > I am using binaries I built myself on Windows from
> > the
> > 4.5 source. 
> > 
> > If I try the 4.4.6 binaries that are available
> from
> > http://proj.maptools.org/ I get even worse
> results:
> > 
> > *       * 0.000
> > 
> > another symptom is what happens when I try to use
> > nad2nad. For example:
> > 
> > nad2nad -i 83 -i hpgn=WI -o 83
> > 
> > yields:
> > 
> > <nad2nad>:
> > hp datum file: WI, failed: No such file or
> directory
> > program abnormally terminated
> > 
> > I'm pretty out of my element when it comes to
> > building
> > the source - merely trying to follow instructions.
> > To
> > do it, I used Visual Studio 2003 and the
> commandline
> > 'nmake /f makefile.vc all' on the source located
> at
> > c:\proj\src, and I have c:\proj\nad containing the
> > *.lla grid shift files, and I also have $PROJ_LIB
> > set
> > to c:\proj. When the build runs, all the binary
> grid
> > shift files get created, a good sign.
> > 
> > Sorry if this is old hat, but I'm not having good
> > luck
> > trying to search the email list archive...
> > 
> > A homebrew for an explanation.  ;-)  Thanks, Mark
> > 
> > 
> >      
> >
>
____________________________________________________________________________________
> > Never miss a thing.  Make Yahoo your home page. 
> > http://www.yahoo.com/r/hs
> > 
> 
> 
> 
>      
>
____________________________________________________________________________________
> Looking for last minute shopping deals?  
> Find them fast with Yahoo! Search. 
>
http://tools.search.yahoo.com/newsearch/category.php?category=shopping
> 



      ____________________________________________________________________________________
Never miss a thing.  Make Yahoo your home page. 
http://www.yahoo.com/r/hs


From cheynm at yahoo.com  Mon Jan 28 20:37:53 2008
From: cheynm at yahoo.com (Mark Cheyne)
Date: Mon, 28 Jan 2008 20:37:53 -0800 (PST)
Subject: [Proj] (problem solved) Re: datum shifting - cs2cs build or config
	problem?
In-Reply-To: <700525.73593.qm@web32913.mail.mud.yahoo.com>
Message-ID: <165931.89975.qm@web32906.mail.mud.yahoo.com>

problem solved - a little counter-intuitive, but I
have to place the +nadgrids at the end:

cs2cs -v +proj=latlong +datum=NAD83 +to +proj=lat
long +datum=NAD83 +nadgrids=wi -w5

Since it is the input coord sys that is in
NAD83HPGN(WI), I thought the +nadgrids should go to
the left of the +to, but not so.

Well, thanks for letting me bore y'all.  ;-) MC


--- Mark Cheyne <cheynm at yahoo.com> wrote:

> I get the same result from nad2nad as I get from
> NADCON and WISCON:
> 
> C:\proj>nad2nad -i 83 -i hpgn=WI -o 83 -w5
> -89.8 44.166666667
> 89d48'0.00849"W 44d9'59.99715"N
> 
> But as reported below, I get something else from
> cs2cs:
> 
> > C:\proj>cs2cs +proj=latlong +ellps=GRS80
> > +datum=NAD83
> > +nadgrids=wi +to +proj=latlong
> > +ellps=GRS80+datum=NAD83
> > -89.8 44.166666667
> > 89d47'59.992"W  44d10'0.003"N 0.000
> 
> I've tried noodling with my syntax, any suggestions
> would be appreciated.
> 
> Mark
> 
> --- Mark Cheyne <cheynm at yahoo.com> wrote:
> 
> > Partially solved. I quickly found one explanation
> -
> > my
> > $PROJ_LIB was set to c:\proj, but it needed to be
> > set
> > to c:\proj\nad.
> > 
> > So now I can run the example from the FAQ
> correctly.
> > Good sign.
> > 
> > However, consider this:
> > 
> > C:\proj>cs2cs +proj=latlong +ellps=GRS80
> > +datum=NAD83
> > +nadgrids=wi +to +proj=latlong
> > +ellps=GRS80+datum=NAD83
> > -89.8 44.166666667
> > 89d47'59.992"W  44d10'0.003"N 0.000
> > 
> > What I am trying to say is that the input point is
> > NAD83HPGN(WI), and I want output in NAD83. I've
> run
> > this example through both NADCON and WISCON, both
> > give
> > me the same result, different from what I got
> above:
> > -89 48 0.00849  44 9 59.99715
> > 
> > So it probably now comes down to user error - am I
> > not
> > specifying that cs2cs command line correctly?
> > 
> > Mark 
> > 
> > 
> > 
> > --- Mark Cheyne <cheynm at yahoo.com> wrote:
> > 
> > > I'm trying to test my proj configuration.
> > > 
> > > There is an example in the FAQ
> > > http://proj.maptools.org/faq.html:
> > > 
> > > cs2cs +proj=latlong +datum=NAD27 +to
> +proj=latlong
> > > +datum=NAD83 
> > > -117 30
> > > 
> > > producing:
> > > 
> > > 117d0'2.901"W   30d0'0.407"N 0.000
> > > 
> > > But when I try it, the following is produced:
> > > 
> > > 117dW   30dN 0.000
> > > 
> > > That is, the output is identical to the input.
> > > 
> > > I am using binaries I built myself on Windows
> from
> > > the
> > > 4.5 source. 
> > > 
> > > If I try the 4.4.6 binaries that are available
> > from
> > > http://proj.maptools.org/ I get even worse
> > results:
> > > 
> > > *       * 0.000
> > > 
> > > another symptom is what happens when I try to
> use
> > > nad2nad. For example:
> > > 
> > > nad2nad -i 83 -i hpgn=WI -o 83
> > > 
> > > yields:
> > > 
> > > <nad2nad>:
> > > hp datum file: WI, failed: No such file or
> > directory
> > > program abnormally terminated
> > > 
> > > I'm pretty out of my element when it comes to
> > > building
> > > the source - merely trying to follow
> instructions.
> > > To
> > > do it, I used Visual Studio 2003 and the
> > commandline
> > > 'nmake /f makefile.vc all' on the source located
> > at
> > > c:\proj\src, and I have c:\proj\nad containing
> the
> > > *.lla grid shift files, and I also have
> $PROJ_LIB
> > > set
> > > to c:\proj. When the build runs, all the binary
> > grid
> > > shift files get created, a good sign.
> > > 
> > > Sorry if this is old hat, but I'm not having
> good
> > > luck
> > > trying to search the email list archive...
> > > 
> > > A homebrew for an explanation.  ;-)  Thanks,
> Mark
> > > 
> > > 
> > >      
> > >
> >
>
____________________________________________________________________________________
> > > Never miss a thing.  Make Yahoo your home page. 
> > > http://www.yahoo.com/r/hs
> > > 
> > 
> > 
> > 
> >      
> >
>
____________________________________________________________________________________
> > Looking for last minute shopping deals?  
> > Find them fast with Yahoo! Search. 
> >
>
http://tools.search.yahoo.com/newsearch/category.php?category=shopping
> > 
> 
> 
> 
>      
>
____________________________________________________________________________________
> Never miss a thing.  Make Yahoo your home page. 
> http://www.yahoo.com/r/hs
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
> 


Mark Cheyne
(608) 332-2235 (cell)


      ____________________________________________________________________________________
Never miss a thing.  Make Yahoo your home page. 
http://www.yahoo.com/r/hs


From paul-grass at stjohnspoint.co.uk  Tue Jan 29 02:15:37 2008
From: paul-grass at stjohnspoint.co.uk (Paul Kelly)
Date: Tue, 29 Jan 2008 10:15:37 +0000 (GMT)
Subject: [Proj] Re: datum shifting - cs2cs build or config problem?
In-Reply-To: <700525.73593.qm@web32913.mail.mud.yahoo.com>
References: <700525.73593.qm@web32913.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.62.0801291013590.5121@vortex.ukshells.co.uk>

On Mon, 28 Jan 2008, Mark Cheyne wrote:

> I get the same result from nad2nad as I get from
> NADCON and WISCON:
>
> C:\proj>nad2nad -i 83 -i hpgn=WI -o 83 -w5
> -89.8 44.166666667
> 89d48'0.00849"W 44d9'59.99715"N
>
> But as reported below, I get something else from
> cs2cs:
>
>> C:\proj>cs2cs +proj=latlong +ellps=GRS80
>> +datum=NAD83
>> +nadgrids=wi +to +proj=latlong
>> +ellps=GRS80+datum=NAD83
>> -89.8 44.166666667
>> 89d47'59.992"W  44d10'0.003"N 0.000
>
> I've tried noodling with my syntax, any suggestions
> would be appreciated.

Have you tried dropping the +datum=NAD83 from the first co-ordinate system 
description? This implies a datum setting of +towgs84=0,0,0, and your 
+nadgrids=wi may be getting ignored.

Just an idea.

Paul


From ntermaris at iqsoft.gr  Thu Jan 31 12:32:31 2008
From: ntermaris at iqsoft.gr (Alekos Ntermaris)
Date: Thu, 31 Jan 2008 22:32:31 +0200
Subject: [Proj] WGS84 Lat Lon to XYZ convercion
Message-ID: <fntb9c$hap$1@ger.gmane.org>

I want to convert long ,lat , h  coordinates to X,Y, Z to WGS 84
I Tried the definition of WGS84

+proj=latlong +ellps=WGS84 +datum=WGS84 +no_defs

and having data

l:20.6390537809385
f:39.3094039129052
h:523.563059728303

calling pj_fwd

the results
x:20.6390537809385
Y:39.3094039129052
The same as input...


Any suggestion for this transformation????
Thanks
Alex



