From charles.karney at sri.com  Mon Feb  3 20:39:06 2014
From: charles.karney at sri.com (Charles Karney)
Date: Mon, 3 Feb 2014 23:39:06 -0500
Subject: [Proj] 4.9.0 Beta2 Available
In-Reply-To: <CA+YzLBcAbNd7brqpCrGGDXBF9sOaBiXrYhFB=SFwEggoKPSMLQ@mail.gmail.com>
References: <CA+YzLBcAbNd7brqpCrGGDXBF9sOaBiXrYhFB=SFwEggoKPSMLQ@mail.gmail.com>
Message-ID: <52F06EEA.4010809@sri.com>

Frank:

When do you think 4.9.0 will be released?  (A "week or so" has already
elapsed!)

   --Charles

On 10/27/2013 02:55 PM, Frank Warmerdam wrote:
> Folks,
>
> With a wee prompt from Howard, I have reawakened the PROJ 4.9.0 release
> train after a few months asleep.  I have gone through the open bugs,
> dealing with a few, and prepared a new beta release.
>
> If there are no serious issues, and if Howard prompts me again, I'd like
> to do a final 4.9.0 release within a week or so.
>
> http://download.osgeo.org/proj/proj-4.9.0b2.tar.gz
> http://download.osgeo.org/proj/proj-4.9.0b2.zip
>
> The most noteworthy change since the last beta is updating to EPSG 8.2.



From ccrook at linz.govt.nz  Mon Feb  3 20:53:06 2014
From: ccrook at linz.govt.nz (Chris Crook)
Date: Tue, 4 Feb 2014 17:53:06 +1300
Subject: [Proj] 4.9.0 Beta2 Available
In-Reply-To: <52F06EEA.4010809@sri.com>
References: <CA+YzLBcAbNd7brqpCrGGDXBF9sOaBiXrYhFB=SFwEggoKPSMLQ@mail.gmail.com>
	<52F06EEA.4010809@sri.com>
Message-ID: <666FB8D75E95AE42965A0E76A5E5337E133A1052A5@prdlsmmsg01.ad.linz.govt.nz>

I think that the bug relating to NTv2 hasn't been implemented into this release yet... this is a significant problem for implementing multilevel NTv2 grids - basically it doesn't work.  This is a long standing bug - there is a patch file provided in

http://trac.osgeo.org/proj/attachment/ticket/177/0001-Fixing-NTv2-nested-grid-issues.patch

It would be great if this could be resolved at last.

Thanks
Chris Crook

> -----Original Message-----
> From: proj-bounces at lists.maptools.org [mailto:proj-
> bounces at lists.maptools.org] On Behalf Of Charles Karney
> Sent: Tuesday, 4 February 2014 5:39 p.m.
> To: Frank Warmerdam
> Cc: proj at lists.maptools.org
> Subject: Re: [Proj] 4.9.0 Beta2 Available
>
> Frank:
>
> When do you think 4.9.0 will be released?  (A "week or so" has already
> elapsed!)
>
>    --Charles
>
> On 10/27/2013 02:55 PM, Frank Warmerdam wrote:
> > Folks,
> >
> > With a wee prompt from Howard, I have reawakened the PROJ 4.9.0
> > release train after a few months asleep.  I have gone through the open
> > bugs, dealing with a few, and prepared a new beta release.
> >
> > If there are no serious issues, and if Howard prompts me again, I'd
> > like to do a final 4.9.0 release within a week or so.
> >
> > http://download.osgeo.org/proj/proj-4.9.0b2.tar.gz
> > http://download.osgeo.org/proj/proj-4.9.0b2.zip
> >
> > The most noteworthy change since the last beta is updating to EPSG 8.2.
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

This message contains information, which is confidential and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.


From charles.karney at sri.com  Tue Feb  4 03:38:31 2014
From: charles.karney at sri.com (Charles Karney)
Date: Tue, 4 Feb 2014 06:38:31 -0500
Subject: [Proj] 4.9.0 Beta2 Available
In-Reply-To: <666FB8D75E95AE42965A0E76A5E5337E133A1052A5@prdlsmmsg01.ad.linz.govt.nz>
References: <CA+YzLBcAbNd7brqpCrGGDXBF9sOaBiXrYhFB=SFwEggoKPSMLQ@mail.gmail.com>	<52F06EEA.4010809@sri.com>
	<666FB8D75E95AE42965A0E76A5E5337E133A1052A5@prdlsmmsg01.ad.linz.govt.nz>
Message-ID: <52F0D137.10500@sri.com>

On 02/03/2014 11:53 PM, Chris Crook wrote:
> I think that the bug relating to NTv2 hasn't been implemented into this release yet... this is a significant problem for implementing multilevel NTv2 grids - basically it doesn't work.  This is a long standing bug - there is a patch file provided in
>
> http://trac.osgeo.org/proj/attachment/ticket/177/0001-Fixing-NTv2-nested-grid-issues.patch
>
> It would be great if this could be resolved at last.

In the patch, line 44 of pj_gridinfo.c becomes

   #else/

presumably that's supposed to be

   #else

Also the comment before the function pj_gridinfo_parent incorrectly
identifies the function as pj_gridinfo_init_ntv2.


From ccrook at linz.govt.nz  Tue Feb  4 18:05:53 2014
From: ccrook at linz.govt.nz (Chris Crook)
Date: Wed, 5 Feb 2014 15:05:53 +1300
Subject: [Proj] 4.9.0 Beta2 Available
In-Reply-To: <52F0D137.10500@sri.com>
References: <CA+YzLBcAbNd7brqpCrGGDXBF9sOaBiXrYhFB=SFwEggoKPSMLQ@mail.gmail.com>
	<52F06EEA.4010809@sri.com>
	<666FB8D75E95AE42965A0E76A5E5337E133A1052A5@prdlsmmsg01.ad.linz.govt.nz>
	<52F0D137.10500@sri.com>
Message-ID: <666FB8D75E95AE42965A0E76A5E5337E133A1058EE@prdlsmmsg01.ad.linz.govt.nz>

Absolutely correct on both counts - not sure how the #else/ got compiled at all.

Thanks
Chris

> -----Original Message-----
> From: Charles Karney [mailto:charles.karney at sri.com]
> Sent: Wednesday, 5 February 2014 12:39 a.m.
> To: proj at lists.maptools.org; Chris Crook
> Subject: Re: [Proj] 4.9.0 Beta2 Available
>
> On 02/03/2014 11:53 PM, Chris Crook wrote:
> > I think that the bug relating to NTv2 hasn't been implemented into
> > this release yet... this is a significant problem for implementing
> > multilevel NTv2 grids - basically it doesn't work.  This is a long
> > standing bug - there is a patch file provided in
> >
> > http://trac.osgeo.org/proj/attachment/ticket/177/0001-Fixing-NTv2-nest
> > ed-grid-issues.patch
> >
> > It would be great if this could be resolved at last.
>
> In the patch, line 44 of pj_gridinfo.c becomes
>
>    #else/
>
> presumably that's supposed to be
>
>    #else
>
> Also the comment before the function pj_gridinfo_parent incorrectly
> identifies the function as pj_gridinfo_init_ntv2.

This message contains information, which is confidential and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.


From Roger.Bivand at nhh.no  Thu Feb  6 13:00:12 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 6 Feb 2014 22:00:12 +0100
Subject: [Proj] problem in trunk/4.9.0 in R/rgdal
Message-ID: <alpine.LRH.2.03.1402062125500.5156@reclus.nhh.no>

We see a problem in 4.9.0 that is not in 4.8.0 in R. The code provoking 
the problem in rgdal 0.8-15 built against 4.9.0 (trunk):

http://cran.r-project.org/src/contrib/rgdal_0.8-15.tar.gz

minimal install is install.packages(c("sp", "spacetime", "rgdal"))

library(sp)
library(spacetime)
data(air)
library(rgdal)
checkCRSArgs(proj4string(rural at sp))

which shows:

> checkCRSArgs(proj4string(rural at sp))
[[1]]
[1] FALSE

[[2]]
[1] "no options found in 'init' file"

first time round. The object rural is read in from a saved R object, and 
has a stored projection of:

"+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs 
+towgs84=0,0,0"

So when this string goes via checkCRSArgs() to C code (same function name) 
calling:


if (!(pj = pj_init_plus(CHAR(STRING_ELT(args, 0))))) {
 	SET_STRING_ELT(VECTOR_ELT(res, 1), 0,
         COPY_TO_USER_STRING(pj_strerrno(*pj_get_errno_ref())));
 	UNPROTECT(1);
 	return(res);
}

where res is a list with first element FALSE by default, second contains 
an error message on failure (or what pj_get_def() returns on success. This 
around line 292 in:

https://r-forge.r-project.org/scm/viewvc.php/pkg/src/projectit.cpp?view=markup&root=rgdal

However, if we then do:

checkCRSArgs("+init=epsg:4326")

we tickle something in pj_init_plus() and it works, and subsequently:

checkCRSArgs(proj4string(rural at sp))

works. I cannot see any changes in pj_init.c in the section looking for 
+init between 4.8.0 and 4.9.0 that might affect this. Under rgdal 0.8-15 
and 4.8.0, there is no trouble, but the issue arises predictably with the 
same rgdal 0.8-15 and current 4.9.0 trunk.

I'd be grateful for any advice.

Best wishes,

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Feb  6 15:11:12 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 7 Feb 2014 00:11:12 +0100
Subject: [Proj] problem in trunk/4.9.0 in R/rgdal
In-Reply-To: <alpine.LRH.2.03.1402062125500.5156@reclus.nhh.no>
References: <alpine.LRH.2.03.1402062125500.5156@reclus.nhh.no>
Message-ID: <alpine.LRH.2.03.1402070009010.5687@reclus.nhh.no>

On Thu, 6 Feb 2014, Roger Bivand wrote:

> We see a problem in 4.9.0 that is not in 4.8.0 in R. The code provoking the 
> problem in rgdal 0.8-15 built against 4.9.0 (trunk):
>
> http://cran.r-project.org/src/contrib/rgdal_0.8-15.tar.gz

A simpler example is:

minimal install is install.packages(c("sp", "rgdal"))

library(rgdal)
checkCRSArgs("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84 
+no_defs +towgs84=0,0,0")

failing with:

> library(rgdal)
Loading required package: sp
rgdal: version: 0.8-15, (SVN revision 496M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.11dev, released 2013/04/13
Path to GDAL shared files: /usr/local/share/gdal
Loaded PROJ.4 runtime: Rel. 4.9.0, 27 October 2013, [PJ_VERSION: 490]
Path to PROJ.4 shared files: (autodetected)
> checkCRSArgs("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84 
+no_defs +towgs84=0,0,0")
[[1]]
[1] FALSE

[[2]]
[1] "no options found in 'init' file"

Roger

>
> minimal install is install.packages(c("sp", "spacetime", "rgdal"))
>
> library(sp)
> library(spacetime)
> data(air)
> library(rgdal)
> checkCRSArgs(proj4string(rural at sp))
>
> which shows:
>
>> checkCRSArgs(proj4string(rural at sp))
> [[1]]
> [1] FALSE
>
> [[2]]
> [1] "no options found in 'init' file"
>
> first time round. The object rural is read in from a saved R object, and has 
> a stored projection of:
>
> "+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs 
> +towgs84=0,0,0"
>
> So when this string goes via checkCRSArgs() to C code (same function name) 
> calling:
>
>
> if (!(pj = pj_init_plus(CHAR(STRING_ELT(args, 0))))) {
> 	SET_STRING_ELT(VECTOR_ELT(res, 1), 0,
>        COPY_TO_USER_STRING(pj_strerrno(*pj_get_errno_ref())));
> 	UNPROTECT(1);
> 	return(res);
> }
>
> where res is a list with first element FALSE by default, second contains an 
> error message on failure (or what pj_get_def() returns on success. This 
> around line 292 in:
>
> https://r-forge.r-project.org/scm/viewvc.php/pkg/src/projectit.cpp?view=markup&root=rgdal
>
> However, if we then do:
>
> checkCRSArgs("+init=epsg:4326")
>
> we tickle something in pj_init_plus() and it works, and subsequently:
>
> checkCRSArgs(proj4string(rural at sp))
>
> works. I cannot see any changes in pj_init.c in the section looking for +init 
> between 4.8.0 and 4.9.0 that might affect this. Under rgdal 0.8-15 and 4.8.0, 
> there is no trouble, but the issue arises predictably with the same rgdal 
> 0.8-15 and current 4.9.0 trunk.
>
> I'd be grateful for any advice.
>
> Best wishes,
>
> Roger
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From warmerdam at pobox.com  Thu Feb  6 15:30:28 2014
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Thu, 6 Feb 2014 15:30:28 -0800
Subject: [Proj] problem in trunk/4.9.0 in R/rgdal
In-Reply-To: <alpine.LRH.2.03.1402070009010.5687@reclus.nhh.no>
References: <alpine.LRH.2.03.1402062125500.5156@reclus.nhh.no>
	<alpine.LRH.2.03.1402070009010.5687@reclus.nhh.no>
Message-ID: <CA+YzLBd5TNq2C_oxdxPWtDKZqc0DR7niKW6zfWWWCkO5RV2SNQ@mail.gmail.com>

Roger,

I have reproduced a seemingly related problem with the cs2cs commandline
program and filed a ticket:

  http://trac.osgeo.org/proj/ticket/229

I'll work on the problem this afternoon.

Best regards,
Frank



On Thu, Feb 6, 2014 at 3:11 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Thu, 6 Feb 2014, Roger Bivand wrote:
>
> > We see a problem in 4.9.0 that is not in 4.8.0 in R. The code provoking
> the
> > problem in rgdal 0.8-15 built against 4.9.0 (trunk):
> >
> > http://cran.r-project.org/src/contrib/rgdal_0.8-15.tar.gz
>
> A simpler example is:
>
> minimal install is install.packages(c("sp", "rgdal"))
>
> library(rgdal)
> checkCRSArgs("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs +towgs84=0,0,0")
>
> failing with:
>
> > library(rgdal)
> Loading required package: sp
> rgdal: version: 0.8-15, (SVN revision 496M)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.11dev, released 2013/04/13
> Path to GDAL shared files: /usr/local/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.9.0, 27 October 2013, [PJ_VERSION: 490]
> Path to PROJ.4 shared files: (autodetected)
> > checkCRSArgs("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs +towgs84=0,0,0")
> [[1]]
> [1] FALSE
>
> [[2]]
> [1] "no options found in 'init' file"
>
> Roger
>
> >
> > minimal install is install.packages(c("sp", "spacetime", "rgdal"))
> >
> > library(sp)
> > library(spacetime)
> > data(air)
> > library(rgdal)
> > checkCRSArgs(proj4string(rural at sp))
> >
> > which shows:
> >
> >> checkCRSArgs(proj4string(rural at sp))
> > [[1]]
> > [1] FALSE
> >
> > [[2]]
> > [1] "no options found in 'init' file"
> >
> > first time round. The object rural is read in from a saved R object, and
> has
> > a stored projection of:
> >
> > "+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
> > +towgs84=0,0,0"
> >
> > So when this string goes via checkCRSArgs() to C code (same function
> name)
> > calling:
> >
> >
> > if (!(pj = pj_init_plus(CHAR(STRING_ELT(args, 0))))) {
> >       SET_STRING_ELT(VECTOR_ELT(res, 1), 0,
> >        COPY_TO_USER_STRING(pj_strerrno(*pj_get_errno_ref())));
> >       UNPROTECT(1);
> >       return(res);
> > }
> >
> > where res is a list with first element FALSE by default, second contains
> an
> > error message on failure (or what pj_get_def() returns on success. This
> > around line 292 in:
> >
> >
> https://r-forge.r-project.org/scm/viewvc.php/pkg/src/projectit.cpp?view=markup&root=rgdal
> >
> > However, if we then do:
> >
> > checkCRSArgs("+init=epsg:4326")
> >
> > we tickle something in pj_init_plus() and it works, and subsequently:
> >
> > checkCRSArgs(proj4string(rural at sp))
> >
> > works. I cannot see any changes in pj_init.c in the section looking for
> +init
> > between 4.8.0 and 4.9.0 that might affect this. Under rgdal 0.8-15 and
> 4.8.0,
> > there is no trouble, but the issue arises predictably with the same rgdal
> > 0.8-15 and current 4.9.0 trunk.
> >
> > I'd be grateful for any advice.
> >
> > Best wishes,
> >
> > Roger
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>



-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam at pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Software Developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140206/85f9a701/attachment.html>

From Roger.Bivand at nhh.no  Thu Feb  6 15:39:02 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 7 Feb 2014 00:39:02 +0100
Subject: [Proj] problem in trunk/4.9.0 in R/rgdal
In-Reply-To: <CA+YzLBd5TNq2C_oxdxPWtDKZqc0DR7niKW6zfWWWCkO5RV2SNQ@mail.gmail.com>
References: <alpine.LRH.2.03.1402062125500.5156@reclus.nhh.no>
	<alpine.LRH.2.03.1402070009010.5687@reclus.nhh.no>
	<CA+YzLBd5TNq2C_oxdxPWtDKZqc0DR7niKW6zfWWWCkO5RV2SNQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1402070037180.5687@reclus.nhh.no>

Frank,

Thanks, I should have thought of trying a command line program to isolate 
the issue.

Best wishes,

Roger

On Fri, 7 Feb 2014, Frank Warmerdam wrote:

> Roger,
>
> I have reproduced a seemingly related problem with the cs2cs commandline
> program and filed a ticket:
>
>  http://trac.osgeo.org/proj/ticket/229
>
> I'll work on the problem this afternoon.
>
> Best regards,
> Frank
>
>
>
> On Thu, Feb 6, 2014 at 3:11 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Thu, 6 Feb 2014, Roger Bivand wrote:
>>
>>> We see a problem in 4.9.0 that is not in 4.8.0 in R. The code provoking
>> the
>>> problem in rgdal 0.8-15 built against 4.9.0 (trunk):
>>>
>>> http://cran.r-project.org/src/contrib/rgdal_0.8-15.tar.gz
>>
>> A simpler example is:
>>
>> minimal install is install.packages(c("sp", "rgdal"))
>>
>> library(rgdal)
>> checkCRSArgs("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84
>> +no_defs +towgs84=0,0,0")
>>
>> failing with:
>>
>>> library(rgdal)
>> Loading required package: sp
>> rgdal: version: 0.8-15, (SVN revision 496M)
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.11dev, released 2013/04/13
>> Path to GDAL shared files: /usr/local/share/gdal
>> Loaded PROJ.4 runtime: Rel. 4.9.0, 27 October 2013, [PJ_VERSION: 490]
>> Path to PROJ.4 shared files: (autodetected)
>>> checkCRSArgs("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84
>> +no_defs +towgs84=0,0,0")
>> [[1]]
>> [1] FALSE
>>
>> [[2]]
>> [1] "no options found in 'init' file"
>>
>> Roger
>>
>>>
>>> minimal install is install.packages(c("sp", "spacetime", "rgdal"))
>>>
>>> library(sp)
>>> library(spacetime)
>>> data(air)
>>> library(rgdal)
>>> checkCRSArgs(proj4string(rural at sp))
>>>
>>> which shows:
>>>
>>>> checkCRSArgs(proj4string(rural at sp))
>>> [[1]]
>>> [1] FALSE
>>>
>>> [[2]]
>>> [1] "no options found in 'init' file"
>>>
>>> first time round. The object rural is read in from a saved R object, and
>> has
>>> a stored projection of:
>>>
>>> "+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
>>> +towgs84=0,0,0"
>>>
>>> So when this string goes via checkCRSArgs() to C code (same function
>> name)
>>> calling:
>>>
>>>
>>> if (!(pj = pj_init_plus(CHAR(STRING_ELT(args, 0))))) {
>>>       SET_STRING_ELT(VECTOR_ELT(res, 1), 0,
>>>        COPY_TO_USER_STRING(pj_strerrno(*pj_get_errno_ref())));
>>>       UNPROTECT(1);
>>>       return(res);
>>> }
>>>
>>> where res is a list with first element FALSE by default, second contains
>> an
>>> error message on failure (or what pj_get_def() returns on success. This
>>> around line 292 in:
>>>
>>>
>> https://r-forge.r-project.org/scm/viewvc.php/pkg/src/projectit.cpp?view=markup&root=rgdal
>>>
>>> However, if we then do:
>>>
>>> checkCRSArgs("+init=epsg:4326")
>>>
>>> we tickle something in pj_init_plus() and it works, and subsequently:
>>>
>>> checkCRSArgs(proj4string(rural at sp))
>>>
>>> works. I cannot see any changes in pj_init.c in the section looking for
>> +init
>>> between 4.8.0 and 4.9.0 that might affect this. Under rgdal 0.8-15 and
>> 4.8.0,
>>> there is no trouble, but the issue arises predictably with the same rgdal
>>> 0.8-15 and current 4.9.0 trunk.
>>>
>>> I'd be grateful for any advice.
>>>
>>> Best wishes,
>>>
>>> Roger
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> Proj mailing list
>> Proj at lists.maptools.org
>> http://lists.maptools.org/mailman/listinfo/proj
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From woodbri at swoodbridge.com  Fri Feb  7 22:11:42 2014
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Sat, 08 Feb 2014 01:11:42 -0500
Subject: [Proj] gdalwarp EPSG:32662 problem
Message-ID: <52F5CA9E.9060601@swoodbridge.com>

Hi,

Sorry for cross posting. This seems like a proj4 issue but might be gdal 
related.

I've run into a problem that I think is related to a change in the EPSG 
definition for EPSG:32662

The symptom is that the image after gdalwarp reprojection is about 20km 
south of where it should be.

old system is correctly aligned:

GDAL 1.4.2.0, released 2007/06/27
proj Rel. 4.5.0, 22 Oct 2006

# WGS 84 / Plate Carree
<32662> +proj=eqc +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 
+datum=WGS84 +units=m +no_defs  <>

new system is shifted about 20km south:

GDAL 1.9.2, released 2012/10/08
proj Rel. 4.8.0, 6 March 2012

# WGS 84 / Plate Carree (deprecated)
<32662> +proj=eqc +lat_ts=0 +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 
+units=m +no_defs  <>


http://spatialreference.org/ref/epsg/32662/
This indicates that the definition in proj 4.8.0 is wrong. Would the 
+ellps=WGS84 account for this shift?

Any thoughts on this?

Thanks,
   -Steve


From antti.castren at iki.fi  Sat Feb  8 00:32:07 2014
From: antti.castren at iki.fi (=?ISO-8859-1?Q?Antti_Castr=E9n?=)
Date: Sat, 8 Feb 2014 10:32:07 +0200
Subject: [Proj] Fwd: [gdal-dev] gdalwarp EPSG:32662 problem
In-Reply-To: <CAPcvoOKw5tSg7rBaXuwX+iVUJjxdvyUQuk4SU74HmAS9pr6wag@mail.gmail.com>
References: <52F5CA9E.9060601@swoodbridge.com>
	<CAPcvoOKw5tSg7rBaXuwX+iVUJjxdvyUQuk4SU74HmAS9pr6wag@mail.gmail.com>
Message-ID: <CAPcvoOLVddCZ3ze_HLVOSZHejdQ4y5=3adpsZKY3gcKYXc44xQ@mail.gmail.com>

Hello Steve,

You asked for any thoughts, so here are some.

The 20km shift could easily be caused by using spherical version in
one implementation of equirectangular projection and ellipsoidal
version in the other. Amount of shift depends on the latitude.

You can find some information on these pages:

http://www.remotesensing.org/geotiff/proj_list/equirectangular.html

http://comments.gmane.org/gmane.comp.gis.proj-4.devel/981

Read especially the comments of the latter.

Hope these help,

  Antti

2014-02-08 8:11 GMT+02:00 Stephen Woodbridge <woodbri at swoodbridge.com>:
> Hi,
>
> Sorry for cross posting. This seems like a proj4 issue but might be gdal
> related.
>
> I've run into a problem that I think is related to a change in the EPSG
> definition for EPSG:32662
>
> The symptom is that the image after gdalwarp reprojection is about 20km
> south of where it should be.
>
> old system is correctly aligned:
>
> GDAL 1.4.2.0, released 2007/06/27
> proj Rel. 4.5.0, 22 Oct 2006
>
> # WGS 84 / Plate Carree
> <32662> +proj=eqc +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84
> +units=m +no_defs  <>
>
> new system is shifted about 20km south:
>
> GDAL 1.9.2, released 2012/10/08
> proj Rel. 4.8.0, 6 March 2012
>
> # WGS 84 / Plate Carree (deprecated)
> <32662> +proj=eqc +lat_ts=0 +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84
> +units=m +no_defs  <>
>
>
> http://spatialreference.org/ref/epsg/32662/
> This indicates that the definition in proj 4.8.0 is wrong. Would the
> +ellps=WGS84 account for this shift?
>
> Any thoughts on this?
>
> Thanks,
>   -Steve


From support.mn at elisanet.fi  Sat Feb  8 05:23:29 2014
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Sat, 8 Feb 2014 15:23:29 +0200 (EET)
Subject: [Proj] gdalwarp EPSG:32662 problem
Message-ID: <9300096.15551331391865809959.JavaMail.support.mn@elisanet.fi>

Hello,

the new version of proj.4 does not make any datum or ellipsoidal
shift if not both source and destination datums are defined.. the older
version did some other assumptions.. this is the most often reason
for some shifts between versions.

see also:
http://comments.gmane.org/gmane.comp.gis.proj-4.devel/6045

Regards: Janne.

---------------------------------------------------------------------------------------


Stephen Woodbridge [woodbri at swoodbridge.com] kirjoitti: 
> Hi,
> 
> Sorry for cross posting. This seems like a proj4 issue but might be gdal 
> related.
> 
> I've run into a problem that I think is related to a change in the EPSG 
> definition for EPSG:32662
> 
> The symptom is that the image after gdalwarp reprojection is about 20km 
> south of where it should be.
> 
> old system is correctly aligned:
> 
> GDAL 1.4.2.0, released 2007/06/27
> proj Rel. 4.5.0, 22 Oct 2006
> 
> # WGS 84 / Plate Carree
> <32662> +proj=eqc +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 
> +datum=WGS84 +units=m +no_defs  <>
> 
> new system is shifted about 20km south:
> 
> GDAL 1.9.2, released 2012/10/08
> proj Rel. 4.8.0, 6 March 2012
> 
> # WGS 84 / Plate Carree (deprecated)
> <32662> +proj=eqc +lat_ts=0 +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 
> +units=m +no_defs  <>
> 
> 
> http://spatialreference.org/ref/epsg/32662/
> This indicates that the definition in proj 4.8.0 is wrong. Would the 
> +ellps=WGS84 account for this shift?
> 
> Any thoughts on this?
> 
> Thanks,
>    -Steve
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
> 




From woodbri at swoodbridge.com  Sat Feb  8 06:44:29 2014
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Sat, 08 Feb 2014 09:44:29 -0500
Subject: [Proj] gdalwarp EPSG:32662 problem
In-Reply-To: <9300096.15551331391865809959.JavaMail.support.mn@elisanet.fi>
References: <9300096.15551331391865809959.JavaMail.support.mn@elisanet.fi>
Message-ID: <52F642CD.1030101@swoodbridge.com>

Hi Janne, Antti,

I gues a better question is using gdalwarp, what is the correct way to 
project this image so it aligns. given the behavior has changed between 
the two versions of proj4 that I listed below.

Reading the links people have posted explains the difference, but it is 
not clear to me if changing the epsg file or the command line and how is 
the right thing to do here.

Thanks,
   -Steve

My gdalwarp command is:

gdalwarp -rcs -ts 8800 6600 -s_srs EPSG:32662 -t_srs EPSG:4326 
$temptiff1 $target

The gdalinfo on the image is:

root at u17269306:/maps/images.tmp# gdalinfo 
MODIS.2014038.193758.fullpass.seadas_sst.hdf
Driver: HDF4/Hierarchical Data Format Release 4
Files: MODIS.2014038.193758.fullpass.seadas_sst.hdf
Size is 512, 512
Coordinate System is `'
Metadata:
   Collection Location=USF Institute for Marine Remote Sensing
   Data Source Type=Direct Broadcast
   Input File(s)=/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038193749.GEO, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038193749.L2_LAC_SST, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194019.GEO, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194019.L2_LAC_SST, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194249.GEO, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194249.L2_LAC_SST, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194519.GEO, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194519.L2_LAC_SST, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194749.GEO, 
/tmp/s4p_run_map_modis_2.3_WSthzYwz/A2014038194749.L2_LAC_SST
   L3 Software Name=/usr/bin/map_modis.pl
   L3 Software Version=4.2
   Map Limit=-5, -125, 55, -45
   Map Projection Category=Proj 4.4.7
   Map Projection Name=eqc
   Processing Status=intermediate
   Proj Projection Parameters=#Equidistant Cylindrical (Plate Caree)
#       Cyl, Sph
#       lat_ts=
# +proj=eqc +ellps=WGS84
   Satellite=aqua
   Spatial Resolution=1km
   Temporal Resolution=pass
Subdatasets:
 
SUBDATASET_1_NAME=HDF4_SDS:UNKNOWN:"MODIS.2014038.193758.fullpass.seadas_sst.hdf":0
   SUBDATASET_1_DESC=[6600x8800] seadas_sst (16-bit integer)
 
SUBDATASET_2_NAME=HDF4_SDS:UNKNOWN:"MODIS.2014038.193758.fullpass.seadas_sst.hdf":1
   SUBDATASET_2_DESC=[6600x8800] l2_flags (32-bit integer)
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  512.0)
Upper Right (  512.0,    0.0)
Lower Right (  512.0,  512.0)
Center      (  256.0,  256.0)

On 2/8/2014 8:23 AM, support.mn at elisanet.fi wrote:
> Hello,
>
> the new version of proj.4 does not make any datum or ellipsoidal
> shift if not both source and destination datums are defined.. the older
> version did some other assumptions.. this is the most often reason
> for some shifts between versions.
>
> see also:
> http://comments.gmane.org/gmane.comp.gis.proj-4.devel/6045
>
> Regards: Janne.
>
> ---------------------------------------------------------------------------------------
>
>
> Stephen Woodbridge [woodbri at swoodbridge.com] kirjoitti:
>> Hi,
>>
>> Sorry for cross posting. This seems like a proj4 issue but might be gdal
>> related.
>>
>> I've run into a problem that I think is related to a change in the EPSG
>> definition for EPSG:32662
>>
>> The symptom is that the image after gdalwarp reprojection is about 20km
>> south of where it should be.
>>
>> old system is correctly aligned:
>>
>> GDAL 1.4.2.0, released 2007/06/27
>> proj Rel. 4.5.0, 22 Oct 2006
>>
>> # WGS 84 / Plate Carree
>> <32662> +proj=eqc +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84
>> +datum=WGS84 +units=m +no_defs  <>
>>
>> new system is shifted about 20km south:
>>
>> GDAL 1.9.2, released 2012/10/08
>> proj Rel. 4.8.0, 6 March 2012
>>
>> # WGS 84 / Plate Carree (deprecated)
>> <32662> +proj=eqc +lat_ts=0 +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84
>> +units=m +no_defs  <>
>>
>>
>> http://spatialreference.org/ref/epsg/32662/
>> This indicates that the definition in proj 4.8.0 is wrong. Would the
>> +ellps=WGS84 account for this shift?
>>
>> Any thoughts on this?
>>
>> Thanks,
>>     -Steve
>> _______________________________________________
>> Proj mailing list
>> Proj at lists.maptools.org
>> http://lists.maptools.org/mailman/listinfo/proj
>>
>
>
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>



From hamish_b at yahoo.com  Sun Feb  9 12:59:38 2014
From: hamish_b at yahoo.com (Hamish)
Date: Sun, 9 Feb 2014 12:59:38 -0800 (PST)
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
Message-ID: <1391979578.15552.YahooMailNeo@web162701.mail.bf1.yahoo.com>

Hi,

I'm working with some weather model (WRF) output and I'll like to
import the results into proj4-aware software (gdal or grass gis).

The LCC model domain specification takes center of region lat/lon as
input, not +lat_0, +lon_0. The values I've been given for +lat_1 and
+lat_2 are equal, and near to +lon_0. That doesn't look quite
right but the model seems happy enough with it:


the values I was given:


CEN_LAT = 40.26405f ;
CEN_LON = -76.99222f ;
TRULAT1 = 39.338f ;
TRUELAT2 = 39.338f ;
MOAD_CEN_LAT = 39.33799f ;
STAND_LON = -84.f ;


What I do have of value is two of the raster grids put out by the
model which contain the lat and lon of each grid point, and these
seem correct. I also have two raster outputs for convergence angle,
ie the angle between grid north and geographic north at each grid
point. I know that +x_0 and +y_0 are 0, and that +ellps is a sphere,
the WRF code lists about 4 different radii for +a, but that's a
secondary issue. Grid cell size is down to 4km, so I'm not overly
concerned with datum issues on the order of 100m.


What I'd like to do is to take the center-of-region LCC definition
and solve for the +lon_0, +lat_0, +lat_1, +lat_2 terms so I can
process the model's output grids in their native projection.

I could treat the two lat,lon grids as source data to run a manual raster
reprojection and interpolate into a proj4-know projection, but that's
computationally expensive and lossy.

So far I've gotten close by choosing the bottom-left grid point of
the lat and lon grids, and reading off those values to use for the
+lat_0 and +lon_0 terms. Then by educated-guessing I picked some
+lat_1 and +lat_2 terms and iteratively have gotten pretty close to
being able to overly a geographic grid on top of contour lines from
the lat and lon raster grids. Of course the terms I found are no
where near those I was provided with or that I can see in the model's
domain setup files.


my guess:

-PROJ_INFO-------------------------------------------------
name       : Lambert Conformal Conic
proj       : lcc
a          : 6371229.000
es         : 0.0
f          : 0.0
lat_0      : 33.0624
lat_1      : 20
lat_2      : 45
lon_0      : -87.0188
x_0        : 0.0000
y_0        : 0.0000
-PROJ_UNITS-------------------
-----------------------------
unit       : meter
units      : meters
meters     : 1.0


This trial and error gets me to within about 5% (see attatched), but
I'd really like to do the job properly and calculate the exact terms.
I have access to the Fortran code used in the model to make the lat
and lon grids, could I use them to also derive the proj4 terms?


thanks for any ideas or advice on how to proceed.


Hamish

ps- sorry for any crazy formatting, yahoo mail's web app is broken yet again and won't let me change to ascii or have any control over the formatting. grumble!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140209/507deac9/attachment.html>

From hamish_b at yahoo.com  Sun Feb  9 13:09:21 2014
From: hamish_b at yahoo.com (Hamish)
Date: Sun, 9 Feb 2014 13:09:21 -0800 (PST)
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
In-Reply-To: <1391979578.15552.YahooMailNeo@web162701.mail.bf1.yahoo.com>
References: <1391979578.15552.YahooMailNeo@web162701.mail.bf1.yahoo.com>
Message-ID: <1391980161.14516.YahooMailNeo@web162702.mail.bf1.yahoo.com>

Hamish wrote:

> This trial and error gets me to within about 5% (see attatched), but
> I'd really like to do the job properly and calculate the exact terms.


sorry, the attachment seems to have been stripped off by the ML. here 'tis: 


 http://muck.otago.ac.nz/~hamish/sbss/lcc_grid_mismatch.png


Hamish



From antti.castren at iki.fi  Mon Feb 10 00:41:59 2014
From: antti.castren at iki.fi (=?ISO-8859-1?Q?Antti_Castr=E9n?=)
Date: Mon, 10 Feb 2014 10:41:59 +0200
Subject: [Proj] [gdal-dev] gdalwarp EPSG:32662 problem
In-Reply-To: <ld78dv$tf$2@ger.gmane.org>
References: <52F5CA9E.9060601@swoodbridge.com>
	<201402090042.30038.even.rouault@mines-paris.org>
	<ld78dv$tf$2@ger.gmane.org>
Message-ID: <CAPcvoO+bV8r9x1QQK+_Vte0C8yW8hPwyTV6zmB3DQR4fktpURw@mail.gmail.com>

2014-02-09 8:40 GMT+02:00 Andre Joost <andre+joost at nurfuerspam.de>:
> Am 09.02.2014 00:42, schrieb Even Rouault:
>>
>> But Antti guess seems right. Instead of +ellps=WGS84 (or +datum=WGS84), if
>> you
>> play with the a (semi-major axis) and b (semi-minor axis) parameters, you
>> can
>> see that only +a has an influence, so latest proj version seems to use a
>> spherical version of eqc.
>
>
> If you look at
> <http://trac.osgeo.org/proj/browser/trunk/proj/src/PJ_eqc.c>
>
> and the chapter 12 of Snyders manual, you will only find formulas for the
> sphere. So I guess there is no other way to calculate eqc.
>
> Maybe older versions calculated another radius for the sphere when an
> ellipsoid was given.

Stephen's "shift" was about 20km south, which correlates quite well if
you use semi-minor axis of WGS84 as radius of sphere while calculating
forward, and semi-major axis as radius of sphere while calculating the
inverse. At latitude of 55 degrees the difference is ca. 20 530 meters
(55 degrees -> 54.8156 degrees).

There are several different radii of the Earth, and some of them could
arguably be used in this context in place of semi-major axis.

All radii ar not created equal: http://en.wikipedia.org/wiki/Earth_radius

You have to bear in mind that this projection is intended for small
scale mapping, for example mapping the whole world. In that scale 20
km is nothing. If you need better representation of the Earth you have
to use a projection which takes ellipsoidal properties into account.
Of course the beef in this thread is not about choosing a projection,
but the change/difference in formulae used, which can create problems
as Stephen pointed out.

Cheers,

  Antti


From woodbri at swoodbridge.com  Mon Feb 10 05:42:14 2014
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Mon, 10 Feb 2014 08:42:14 -0500
Subject: [Proj] [gdal-dev] gdalwarp EPSG:32662 problem
In-Reply-To: <CAPcvoO+bV8r9x1QQK+_Vte0C8yW8hPwyTV6zmB3DQR4fktpURw@mail.gmail.com>
References: <52F5CA9E.9060601@swoodbridge.com>	<201402090042.30038.even.rouault@mines-paris.org>	<ld78dv$tf$2@ger.gmane.org>
	<CAPcvoO+bV8r9x1QQK+_Vte0C8yW8hPwyTV6zmB3DQR4fktpURw@mail.gmail.com>
Message-ID: <52F8D736.4090408@swoodbridge.com>

On 2/10/2014 3:41 AM, Antti Castrén wrote:
> 2014-02-09 8:40 GMT+02:00 Andre Joost <andre+joost at nurfuerspam.de>:
>> Am 09.02.2014 00:42, schrieb Even Rouault:
>>>
>>> But Antti guess seems right. Instead of +ellps=WGS84 (or +datum=WGS84), if
>>> you
>>> play with the a (semi-major axis) and b (semi-minor axis) parameters, you
>>> can
>>> see that only +a has an influence, so latest proj version seems to use a
>>> spherical version of eqc.
>>
>>
>> If you look at
>> <http://trac.osgeo.org/proj/browser/trunk/proj/src/PJ_eqc.c>
>>
>> and the chapter 12 of Snyders manual, you will only find formulas for the
>> sphere. So I guess there is no other way to calculate eqc.
>>
>> Maybe older versions calculated another radius for the sphere when an
>> ellipsoid was given.
>
> Stephen's "shift" was about 20km south, which correlates quite well if
> you use semi-minor axis of WGS84 as radius of sphere while calculating
> forward, and semi-major axis as radius of sphere while calculating the
> inverse. At latitude of 55 degrees the difference is ca. 20 530 meters
> (55 degrees -> 54.8156 degrees).
>
> There are several different radii of the Earth, and some of them could
> arguably be used in this context in place of semi-major axis.
>
> All radii ar not created equal: http://en.wikipedia.org/wiki/Earth_radius
>
> You have to bear in mind that this projection is intended for small
> scale mapping, for example mapping the whole world. In that scale 20
> km is nothing. If you need better representation of the Earth you have
> to use a projection which takes ellipsoidal properties into account.
> Of course the beef in this thread is not about choosing a projection,
> but the change/difference in formulae used, which can create problems
> as Stephen pointed out.

Right, The real issue here what changed between Proj4 4.5 and Proj 4.8 
that has caused this shift and how to best correct for it.

I hacked a solution into my problem by changing the reference bbox for 
the image to shove it north by 20,000 meters. As you point out maybe I 
should have pushed it 20,530 meters.

Anyway, thanks to everyone for taking the time to help me with this. It 
is greatly appreciated.

-Steve


From andre+joost at nurfuerspam.de  Mon Feb 10 12:07:38 2014
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Mon, 10 Feb 2014 21:07:38 +0100
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
In-Reply-To: <1391979578.15552.YahooMailNeo@web162701.mail.bf1.yahoo.com>
References: <1391979578.15552.YahooMailNeo@web162701.mail.bf1.yahoo.com>
Message-ID: <ldbc56$egq$1@ger.gmane.org>

Am 09.02.2014 21:59, schrieb Hamish:
> Hi,
>
> I'm working with some weather model (WRF) output and I'll like to
> import the results into proj4-aware software (gdal or grass gis).
>
> The LCC model domain specification takes center of region lat/lon as
> input, not +lat_0, +lon_0. The values I've been given for +lat_1 and
> +lat_2 are equal, and near to +lon_0. That doesn't look quite
> right but the model seems happy enough with it:
>
>
> the values I was given:
>
>
> CEN_LAT = 40.26405f ;
> CEN_LON = -76.99222f ;
> TRULAT1 = 39.338f ;
> TRUELAT2 = 39.338f ;
> MOAD_CEN_LAT = 39.33799f ;
> STAND_LON = -84.f ;

I guess that should be a LCC 1SP projection with these parameters:
+proj=lcc +lat_1=39.338 +lat_0=39.338 +lon_0=-84 +k_0=1 +x_0=0 +y_0=0 
+ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs


> This trial and error gets me to within about 5% (see attatched)

 From the image it is hard to tell what grid line should be right or 
wrong. For lon_0=-84, the 84W should be exactly vertical.

Can you share sample coordinates?

Greetings,
André Joost






From support.mn at elisanet.fi  Mon Feb 10 15:14:13 2014
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Tue, 11 Feb 2014 01:14:13 +0200 (EET)
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
Message-ID: <29944724.15832241392074053392.JavaMail.support.mn@elisanet.fi>

Hello,

after looking the picture you supplied it seems like
there is a rotation and scaling needed or also using
a different center setup for the projection might fix
that rotation:

1) try some other center lon or lat candidates

2) apply some rotation and scaling either using
a 7 parameter datum shift or

3) rotate and scale the resulting projection

It is most likely that any of those 3 corrections
will fix it but if the problem is due to wrong parameters
then number 1 would be the most desirable
solution.

Regards: Janne.

----------------------------------------------


Hamish [hamish_b at yahoo.com] kirjoitti: 
> Hamish wrote:
> 
> > This trial and error gets me to within about 5% (see attatched), but
> > I'd really like to do the job properly and calculate the exact terms.
> 
> 
> sorry, the attachment seems to have been stripped off by the ML. here 'tis: 
> 
> 
>  http://muck.otago.ac.nz/~hamish/sbss/lcc_grid_mismatch.png
> 
> 
> Hamish
> 




From hamish_b at yahoo.com  Tue Feb 11 15:33:56 2014
From: hamish_b at yahoo.com (Hamish)
Date: Tue, 11 Feb 2014 15:33:56 -0800 (PST)
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
In-Reply-To: <29944724.15832241392074053392.JavaMail.support.mn@elisanet.fi>
References: <29944724.15832241392074053392.JavaMail.support.mn@elisanet.fi>
Message-ID: <1392161636.57139.YahooMailNeo@web162701.mail.bf1.yahoo.com>

schrieb Hamish:
> > I'm working with some weather model (WRF) output and I'll like to
> > import the results into proj4-aware software (gdal or grass gis).
> >
> > The LCC model domain specification takes center of region lat/lon as
> > input, not +lat_0, +lon_0. The values I've been given for +lat_1 and
> > +lat_2 are equal, and near to +lon_0. That doesn't look quite
> > right but the model seems happy enough with it:
> >
> > the values I was given:
> >
> > CEN_LAT = 40.26405f ;
> > CEN_LON = -76.99222f ;
> > TRULAT1 = 39.338f ;
> > TRUELAT2 = 39.338f ;
> > MOAD_CEN_LAT = 39.33799f ;
> > STAND_LON = -84.f ;

André wrote:
> I guess that should be a LCC 1SP projection with these parameters:
> +proj=lcc +lat_1=39.338 +lat_0=39.338 +lon_0=-84 +k_0=1 +x_0=0 +y_0=0 
> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

Thanks, unfortunately I tried that & it's nowhere close.


> > This trial and error gets me to within about 5% (see attached)
[ http://muck.otago.ac.nz/~hamish/sbss/lcc_grid_mismatch.png ]

> From the image it is hard to tell what grid line should be right or 
> wrong.

Sorry, I should have explained that: the black lines are the native
grid (contour lines created from the lat/lon raster grid values), and
the grey is an overlay of what my best-guess projection terms produce.

With a bit more trial and error using 1SP I've now got it matching a
little better, but it's not really satisfying to have to fudge it with
an random guess.

revised trial and error:
  http://muck.otago.ac.nz/~hamish/sbss/lcc_grid_mismatch2.png

-PROJ_INFO-------------------------------------------------
name       : Lambert Conformal Conic
proj       : lcc
a          : 6371229.000
es         : 0.0
f          : 0.0
lat_1      : 40
lat_0      : 33.05
lon_0      : -84.0
x_0        : 235000
y_0        : 0.000
-PROJ_UNITS------------------------------------------------
unit       : meter
units      : meters
meters     : 1.0

GRASS> g.region -gcl | grep center
center_long=-77.00767527
center_lat=39.85944826

but I'd really like to find the mathematical/code relationship between
the setup values I was given and what comes out the other end. Based
on other output grids I'm pretty happy that the lat/lon values in the
grids are ok, and it's the provided lcc terms which are the problem.


> For lon_0=-84, the 84W should be exactly vertical.

With +lon_0=-84 I need to set +x_0=235000 (or thereabouts) in order to
get the 84W meridian to be vertical; with +x_0 it is vertical at the
very left of the grid which according to the longitude grid values is
-87.018799. (the grid is 138x138 so I'm wildly guessing cell-center
registered not grid-conflence registered)

.. but +lon_0=-84 && +x_0=0 doesn't do it. I'd be surprised if the code
used a false easting, so I suspect the +lon_0 value really isn't 84W.
(and it's just on a sphere --nothing fancy, so I'd also be surprised
if there was any rotation or scaling going on Janne)


> Can you share sample coordinates?

sure, but I only have the grid and the lat/lon equivalents of the grid
and the angle-to-true-north grid data to go by, I don't have known-good
projected coordinates to test against beyond the center-lat/lon which
I can calculate. The x,y resolution "should" be 12000m, so the north,
east bounds in the following ascii grids are simply based on that
times the number of rows,cols (138x138):

  http://muck.otago.ac.nz/~hamish/sbss/xlat.txt.bz2
  http://muck.otago.ac.nz/~hamish/sbss/xlong.txt.bz2



thanks,
Hamish



From Alain.Orsoni at ign.fr  Wed Feb 12 05:29:30 2014
From: Alain.Orsoni at ign.fr (Alain Orsoni)
Date: Wed, 12 Feb 2014 13:29:30 +0000
Subject: [Proj] Geoid models egm96 et egm08 in PROJ4
Message-ID: <82B7EC7B-B2CE-4A74-B6A0-C90110995F61@ign.fr>

Hi,

We think there could be a problem in the egm96_15.gtx and egm08_25.gtx files provided on ftp://ftp.remotesensing.org/proj/vdatum/

We noticed a difference between the values we used to get and the values provided by PROJ4 using these gtx files.
It seems that both files have a shift (although it is different for each of the files.

Probably the reason is related to the egm08togtx.py and egm96togtx.py :

=============   in egm96togtx.py the line
ds_gtx.SetGeoTransform( (-180.25,0.25,0,90.125,0,-0.25) )
should probably become
ds_gtx.SetGeoTransform( (-180.125,0.25,0,90.125,0,-0.25) )
assuming that the grid value is given for the center of a cell (0.25°x0.25° cell). 

This hypothesis seems to be confirmed by the following verification:
on the web site http://www.unavco.org/community_science/science-support/geoid/
which is a geoid height calculator, if you enter 0 0 and 0 values for long lat and height you will get a -17.162 orthometric height

If you use the following command

cs2cs +init=epsg:4326 +to +proj=longlat +datum=WGS84 +geoidgrids=egm96_15.gtx +units=m +no_defs
you will get the following result
0 0 0
0dE	0dN -17.120
while if you shift your value of -0.125
-0.125 0 0
0d7'30"W	0dN -17.160


=============  in egm08togtx.py the line
    ps_25 = 2.5 / 60.0
    ds_gtx.SetGeoTransform( (-180 - ps_25,ps_25,0,90 + ps_25,0,-1 * ps_25) )

should become

    ds_gtx.SetGeoTransform( (-180 - (ps_25/2),ps_25,0,90 + (ps_25/2),0,-1 * ps_25) )

=================

If some one as encountered the same problem and confirm or could unconfirm this hypothesis, it would be helpful.

Alain ORSONI



From Mikael.Rittri at carmenta.com  Wed Feb 12 06:38:29 2014
From: Mikael.Rittri at carmenta.com (Mikael Rittri)
Date: Wed, 12 Feb 2014 14:38:29 +0000
Subject: [Proj] Geoid models egm96 et egm08 in PROJ4
In-Reply-To: <82B7EC7B-B2CE-4A74-B6A0-C90110995F61@ign.fr>
References: <82B7EC7B-B2CE-4A74-B6A0-C90110995F61@ign.fr>
Message-ID: <E4AB3DD44D22854B819908379DE4AD493DCB0C4C@SETHNWS023.carmenta.se>


> If some one as encountered the same problem and confirm or could unconfirm > this hypothesis, it would be helpful.
> 
> Alain ORSONI

I agree with you, and I have reported this problem earlier, as 
 
   https://trac.osgeo.org/proj/ticket/126

Charles Karney has also confirmed it, in 

   http://lists.maptools.org/pipermail/proj/2012-April/006273.html


Best regards,

Mikael Rittri
Carmenta
Sweden
http://www.carmenta.com

-----Original Message-----
From: proj-bounces at lists.maptools.org [mailto:proj-bounces at lists.maptools.org] On Behalf Of Alain Orsoni
Sent: Wednesday, February 12, 2014 2:30 PM
To: proj at lists.maptools.org
Subject: [Proj] Geoid models egm96 et egm08 in PROJ4

Hi,

We think there could be a problem in the egm96_15.gtx and egm08_25.gtx files provided on ftp://ftp.remotesensing.org/proj/vdatum/

We noticed a difference between the values we used to get and the values provided by PROJ4 using these gtx files.
It seems that both files have a shift (although it is different for each of the files.

Probably the reason is related to the egm08togtx.py and egm96togtx.py :

=============   in egm96togtx.py the line
ds_gtx.SetGeoTransform( (-180.25,0.25,0,90.125,0,-0.25) )
should probably become
ds_gtx.SetGeoTransform( (-180.125,0.25,0,90.125,0,-0.25) )
assuming that the grid value is given for the center of a cell (0.25°x0.25° cell). 

This hypothesis seems to be confirmed by the following verification:
on the web site http://www.unavco.org/community_science/science-support/geoid/
which is a geoid height calculator, if you enter 0 0 and 0 values for long lat and height you will get a -17.162 orthometric height

If you use the following command

cs2cs +init=epsg:4326 +to +proj=longlat +datum=WGS84 +geoidgrids=egm96_15.gtx +units=m +no_defs
you will get the following result
0 0 0
0dE	0dN -17.120
while if you shift your value of -0.125
-0.125 0 0
0d7'30"W	0dN -17.160


=============  in egm08togtx.py the line
    ps_25 = 2.5 / 60.0
    ds_gtx.SetGeoTransform( (-180 - ps_25,ps_25,0,90 + ps_25,0,-1 * ps_25) )

should become

    ds_gtx.SetGeoTransform( (-180 - (ps_25/2),ps_25,0,90 + (ps_25/2),0,-1 * ps_25) )

=================

If some one as encountered the same problem and confirm or could unconfirm this hypothesis, it would be helpful.

Alain ORSONI

_______________________________________________
Proj mailing list
Proj at lists.maptools.org
http://lists.maptools.org/mailman/listinfo/proj


From andre+joost at nurfuerspam.de  Wed Feb 12 12:55:40 2014
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Wed, 12 Feb 2014 21:55:40 +0100
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
In-Reply-To: <1392161636.57139.YahooMailNeo@web162701.mail.bf1.yahoo.com>
References: <29944724.15832241392074053392.JavaMail.support.mn@elisanet.fi>
	<1392161636.57139.YahooMailNeo@web162701.mail.bf1.yahoo.com>
Message-ID: <ldgn97$bqo$1@ger.gmane.org>

Am 12.02.2014 00:33, schrieb Hamish:

>
>    http://muck.otago.ac.nz/~hamish/sbss/xlat.txt.bz2
>    http://muck.otago.ac.nz/~hamish/sbss/xlong.txt.bz2
>



I checked it the other way round:

Changed the header of your files to:
> nrows        138
> ncols        138
> xllcorner    0
> yllcorner    0
> cellsize     12000
> NODATA_value -32768

which makes them readable for the GDAL AAIGrid importer.
Then created contour lines from the data, and overlayed it with a WGS84 
grid.

The custom projection I came best with was

+proj=lcc +lat_1=39.338 +lat_0=39.338 +lon_0=-84 +k_0=1 +x_0=233925 
+y_0=722000 +a=6371229 +b=6371229 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

the x_0 value was easy to get, just the distance between left margin and 
the 84° meridian. For y_0, I measured the difference between WGS84 grid 
and the countour lines grid. So, empirical too, but I think you can not 
get much better from a 138x138 cell grid at that resolution.

Overlaying in QGIS I got this picture:

<http://home.arcor.de/andre.joost/WRF-LCC.png>

The cell values around the map center read (from line 75 and 76):

lon:  -77.068146/ -77.057312 / -76.927246 /-76.916199
lat: 40.32201 / 40.313641 / 40.214413 / 40.206055

So CEN_LAT and CEN_LON are just the average of the four middle cells, 
and have nothing to do with the following projection parameters.

Just some more references on the WRF projection parameters:

http://mailman.ucar.edu/pipermail/wrf-users/2007/000698.html

http://www.mmm.ucar.edu/wrf/users/docs/user_guide/users_guide_chap3.html

HTH,
André Joost



From andre+joost at nurfuerspam.de  Wed Feb 12 13:41:30 2014
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Wed, 12 Feb 2014 22:41:30 +0100
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
In-Reply-To: <ldgn97$bqo$1@ger.gmane.org>
References: <29944724.15832241392074053392.JavaMail.support.mn@elisanet.fi>
	<1392161636.57139.YahooMailNeo@web162701.mail.bf1.yahoo.com>
	<ldgn97$bqo$1@ger.gmane.org>
Message-ID: <ldgps4$b3b$1@ger.gmane.org>

Am 12.02.2014 21:55, schrieb Andre Joost:

>
> The custom projection I came best with was
>
> +proj=lcc +lat_1=39.338 +lat_0=39.338 +lon_0=-84 +k_0=1 +x_0=233925
> +y_0=722000 +a=6371229 +b=6371229 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs
>
> the x_0 value was easy to get, just the distance between left margin and
> the 84° meridian. For y_0, I measured the difference between WGS84 grid
> and the countour lines grid. So, empirical too, but I think you can not
> get much better from a 138x138 cell grid at that resolution.
>

Ok, now the analytical version ;-)

Put the center coordinates in a text file WRF4326.txt, and perform

cs2cs +init=epsg:4326 +to +proj=lcc +lat_1=39.338 +lat_0=39.338 
+lon_0=-84 +k_0=1 +x_0=0 +y_0=0 +a=6371229 +b=6371229 
+towgs84=0,0,0,0,0,0,0 +units=m +no_defs WRF4326.txt >out.txt

on it. Subtract the result

595747.57	 104990.12

from 828000 (that is 138x1200/2, the center of the raster grid)

and you get

x_0=232252. and y_0=723010.

Almost the same as I got empirical, taking the raster cell size of 
12000m into acount.

HTH,
André Joost





From andre+joost at nurfuerspam.de  Thu Feb 13 07:53:53 2014
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Thu, 13 Feb 2014 16:53:53 +0100
Subject: [Proj] Have LCC center terms, need PROJ.4 terms
In-Reply-To: <ldgps4$b3b$1@ger.gmane.org>
References: <29944724.15832241392074053392.JavaMail.support.mn@elisanet.fi>
	<1392161636.57139.YahooMailNeo@web162701.mail.bf1.yahoo.com>
	<ldgn97$bqo$1@ger.gmane.org> <ldgps4$b3b$1@ger.gmane.org>
Message-ID: <ldipta$v42$1@ger.gmane.org>

Am 12.02.2014 22:41, schrieb Andre Joost:
> Subtract the result
>
> 595747.57	 104990.12
>
> from 828000 (that is 138x1200/2, the center of the raster grid)
>
> and you get
>
> x_0=232252. and y_0=723010.
>

Just to get it right:
the inversed values should go into the lower left corner values of the 
ASCII Grid header:

nrows        138
ncols        138
xllcorner    -232252.
yllcorner    -723010.
cellsize     12000
NODATA_value -32768

and with that no false Easting or Northing is necessary for the projection:

+proj=lcc +lat_1=39.338 +lat_0=39.338 +lon_0=-84 +k_0=1 +x_0=0 +y_0=0 
+a=6371229 +b=6371229 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

Greetings,
André Joost



From rob at dijital.ca  Thu Feb 13 17:04:49 2014
From: rob at dijital.ca (Rob Skelly)
Date: Thu, 13 Feb 2014 17:04:49 -0800
Subject: [Proj] NAD83(Original) Transformation with Heights
Message-ID: <CAKk5Q9WkcMQJGiMoZWfL5=yp4F2OJQE_Wt5ARiVsaCxU0LM5pQ@mail.gmail.com>

Hello List,

I'm trying to convert some LiDAR data from NAD83(Original), with
orthometric heights based on CGVD28, to WGS84 with ellipsoidal heights, and
to NAD83(CSRS) with orthometric heights based on CGVD2013.

I've been verifying my output using NRCAN's online GPS-H tool (
http://webapp.geod.nrcan.gc.ca/geod/tools-outils/gpsh.php), and not getting
good results.

To begin with, I use las2las to convert my data to WGS84, using parameters:

--a_srs '+proj=utm +zone=12N +ellps=GRS80 +geoidgrids=HT2_0.gtx'
--t_srs EPSG:4326

Then I go from WGS84 to NAD83(CSRS) with the following:

--a_srs EPSG:4326
--t_srs +proj=utm +zone=12N +geoidgrid=CGG2013n83.gtx +ellps=GRS80
+datum=NAD83

Now, I don't actually have a decent way of verifying my output, other than
with GPS-H, and the disagreement seems significant. For example, the
original elevation at 494618.88mE, 6306815.69mN is 469.95m, and I get an
ellipsoidal height at -111.088356°W, 56.90501°N of 444.52m. GPS-H claims
that the orthometric height at that position (for HT2_0, the closest
approximation to CGVD28) should be 470.004m, a difference of 54cm.

I realize there are a lot of points where this process could be going
wrong, or that it's not going wrong at all. I wonder if anyone can give me
any insight or fill in any obvious holes in my reasoning. If I've left out
any pertinent information, let me know.

Note that I could just use GPS-H to process the points, but I need to
automate the conversion of a lot of data, and establish a reusable process
to do so. And, I'd like to use this opportunity to learn about proj!

Thanks,
Rob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140213/7de7ff70/attachment.html>

From support.mn at elisanet.fi  Fri Feb 14 03:14:13 2014
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Fri, 14 Feb 2014 13:14:13 +0200 (EET)
Subject: [Proj] NAD83(Original) Transformation with Heights
Message-ID: <2225649.2568091392376453973.JavaMail.support.mn@elisanet.fi>

Rob Skelly [rob at dijital.ca] kirjoitti: 
>
> Hello List,
> 
> I'm trying to convert some LiDAR data from NAD83(Original), with
> orthometric heights based on CGVD28, to WGS84 with ellipsoidal heights, and
> to NAD83(CSRS) with orthometric heights based on CGVD2013.
> 
> Now, I don't actually have a decent way of verifying my output, other than
> with GPS-H, and the disagreement seems significant. For example, the
> original elevation at 494618.88mE, 6306815.69mN is 469.95m, and I get an
> ellipsoidal height at -111.088356°W, 56.90501°N of 444.52m. GPS-H claims
> that the orthometric height at that position (for HT2_0, the closest
> approximation to CGVD28) should be 470.004m, a difference of 54cm.
> 
> I realize there are a lot of points where this process could be going
> wrong, or that it's not going wrong at all. I wonder if anyone can give me
> any insight or fill in any obvious holes in my reasoning. If I've left out
> any pertinent information, let me know.
> 

ok... "exactly"...

1) have you verified that the 54 cm is not within the limits of the
difference between HT2_0 and CGVD28?? if that is so then there is
no error

2) another source of errors might be the path you go to that elevation..
make sure the selected path (down and up) does not generate that error?

3) make sure that "las2las" and GPS-H do the same assumptions

4) remember that for later proj.4 versions you have to declare both
source and destination datums to make sure that it calculates
anything

5) how large was the horizontal difference?

6) etc etc ..

regards: Janne.




From charles.karney at sri.com  Fri Feb 14 07:36:10 2014
From: charles.karney at sri.com (Charles Karney)
Date: Fri, 14 Feb 2014 10:36:10 -0500
Subject: [Proj] Geoid models egm96 et egm08 in PROJ4
In-Reply-To: <82B7EC7B-B2CE-4A74-B6A0-C90110995F61@ign.fr>
References: <82B7EC7B-B2CE-4A74-B6A0-C90110995F61@ign.fr>
Message-ID: <52FE37EA.10403@sri.com>

Corrected versions of egm96_15.gtx and egm08_25.gtx are available at

   https://sarnoff.sharefile.com/d/sb23d64908da48ffb

These were produced directly from the NGA spherical harmonic expansions
using the GeoidToGTX program (a sample program distributed with
GeographicLib).  These files correct the following issues with the PROJ4
files:

(1) +/- 5mm quantization errors in egm96.
(2) incorrect origins in egm96 and egm08

GeoidToGTX faithfully reproduces the grids given by the harmonic
synthesis programs (in Fortran) provided by NGA.

(The link above should be valid "indefinitely".  However, I can't be
sure that it will work beyond about a year.)

   --Charles

On 2014-02-12 08:29, Alain Orsoni wrote:
> Hi,
>
> We think there could be a problem in the egm96_15.gtx and egm08_25.gtx files provided on ftp://ftp.remotesensing.org/proj/vdatum/
>
> We noticed a difference between the values we used to get and the values provided by PROJ4 using these gtx files.
> It seems that both files have a shift (although it is different for each of the files.
>
> Probably the reason is related to the egm08togtx.py and egm96togtx.py :
>
> =============   in egm96togtx.py the line
> ds_gtx.SetGeoTransform( (-180.25,0.25,0,90.125,0,-0.25) )
> should probably become
> ds_gtx.SetGeoTransform( (-180.125,0.25,0,90.125,0,-0.25) )
> assuming that the grid value is given for the center of a cell (0.25°x0.25° cell).
>
> This hypothesis seems to be confirmed by the following verification:
> on the web site http://www.unavco.org/community_science/science-support/geoid/
> which is a geoid height calculator, if you enter 0 0 and 0 values for long lat and height you will get a -17.162 orthometric height
>
> If you use the following command
>
> cs2cs +init=epsg:4326 +to +proj=longlat +datum=WGS84 +geoidgrids=egm96_15.gtx +units=m +no_defs
> you will get the following result
> 0 0 0
> 0dE	0dN -17.120
> while if you shift your value of -0.125
> -0.125 0 0
> 0d7'30"W	0dN -17.160
>
>
> =============  in egm08togtx.py the line
>      ps_25 = 2.5 / 60.0
>      ds_gtx.SetGeoTransform( (-180 - ps_25,ps_25,0,90 + ps_25,0,-1 * ps_25) )
>
> should become
>
>      ds_gtx.SetGeoTransform( (-180 - (ps_25/2),ps_25,0,90 + (ps_25/2),0,-1 * ps_25) )
>
> =================
>
> If some one as encountered the same problem and confirm or could unconfirm this hypothesis, it would be helpful.
>
> Alain ORSONI


From rob at dijital.ca  Fri Feb 14 16:01:42 2014
From: rob at dijital.ca (Rob Skelly)
Date: Fri, 14 Feb 2014 16:01:42 -0800
Subject: [Proj] NAD83(Original) Transformation with Heights
Message-ID: <CAKk5Q9WnD1XvgvDz5xo_tEShJnn1NPZVDRaXd7h5jxOKa1HvuA@mail.gmail.com>

> have you verified that the 54 cm is not within the limits of the
difference between HT2_0 and CGVD28?? if that is so then there is no error

Well, it turns out I made a math error: the difference is ~5cm, not 54cm.
That's a small error, but what we really want is for the outputs to match.

> another source of errors might be the path you go to that elevation..

The HT2_0 file is the grid shift file, so that's the mechanism proj is
using to get from the original orthometric heights to the ellipsoidal
heights. The HT2_0 file uses geographic coordinates, so proj must be doing
the horizontal transformation first, then the vertical shift -- so if the
horizontal coordinates are off, the elevation will be off.

So 5cm is obviously a small error, but it disagrees with GPS-H...

> make sure that "las2las" and GPS-H do the same assumptions

My working hypothesis was that, since GPS-H is using HT2_0 with the
NAD83(CSRS) reference frame, and our original data uses NAD83(Original),
there should be a +towgs84 argument in my original -> WGS84 transformation,
because WGS84 has changed between those two reference frames. However:

> how large was the horizontal difference?

My transformation from the original horizontal coordinates to WGS84 and
GPS-H's transformation are almost identical. Even if there is a reference
frame difference, the difference in shift values should be negligible.

So... we have just discovered that the grid shift files may be misaligned
by 8' to the East. Shifting them by that much provides almost perfect
results, at least for our study area.

Thanks for your time!
Rob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140214/9f8ed0f3/attachment.html>

From howard at hobu.co  Sat Feb 15 08:21:45 2014
From: howard at hobu.co (Howard Butler)
Date: Sat, 15 Feb 2014 10:21:45 -0600
Subject: [Proj] Geoid models egm96 et egm08 in PROJ4
In-Reply-To: <52FE37EA.10403@sri.com>
References: <82B7EC7B-B2CE-4A74-B6A0-C90110995F61@ign.fr>
	<52FE37EA.10403@sri.com>
Message-ID: <930B9E72-A81E-4F2B-B731-BB2E04F035B0@hobu.co>

Charles,

I have updated the files at http://download.osgeo.org/proj/vdatum/ with your set and renamed the old ones with a scary filename so that they can stay around for posterity and other archaeological operations if necessary.  

https://trac.osgeo.org/proj/ticket/126

Thanks for digging through this. Sorry it took so long to attend to it.

Howard

On Feb 14, 2014, at 9:36 AM, Charles Karney <charles.karney at sri.com> wrote:

> Corrected versions of egm96_15.gtx and egm08_25.gtx are available at
> 
>   https://sarnoff.sharefile.com/d/sb23d64908da48ffb
> 
> These were produced directly from the NGA spherical harmonic expansions
> using the GeoidToGTX program (a sample program distributed with
> GeographicLib).  These files correct the following issues with the PROJ4
> files:
> 
> (1) +/- 5mm quantization errors in egm96.
> (2) incorrect origins in egm96 and egm08
> 
> GeoidToGTX faithfully reproduces the grids given by the harmonic
> synthesis programs (in Fortran) provided by NGA.
> 
> (The link above should be valid "indefinitely".  However, I can't be
> sure that it will work beyond about a year.)
> 
>   --Charles
> 
> On 2014-02-12 08:29, Alain Orsoni wrote:
>> Hi,
>> 
>> We think there could be a problem in the egm96_15.gtx and egm08_25.gtx files provided on ftp://ftp.remotesensing.org/proj/vdatum/
>> 
>> We noticed a difference between the values we used to get and the values provided by PROJ4 using these gtx files.
>> It seems that both files have a shift (although it is different for each of the files.
>> 
>> Probably the reason is related to the egm08togtx.py and egm96togtx.py :
>> 
>> =============   in egm96togtx.py the line
>> ds_gtx.SetGeoTransform( (-180.25,0.25,0,90.125,0,-0.25) )
>> should probably become
>> ds_gtx.SetGeoTransform( (-180.125,0.25,0,90.125,0,-0.25) )
>> assuming that the grid value is given for the center of a cell (0.25°x0.25° cell).
>> 
>> This hypothesis seems to be confirmed by the following verification:
>> on the web site http://www.unavco.org/community_science/science-support/geoid/
>> which is a geoid height calculator, if you enter 0 0 and 0 values for long lat and height you will get a -17.162 orthometric height
>> 
>> If you use the following command
>> 
>> cs2cs +init=epsg:4326 +to +proj=longlat +datum=WGS84 +geoidgrids=egm96_15.gtx +units=m +no_defs
>> you will get the following result
>> 0 0 0
>> 0dE	0dN -17.120
>> while if you shift your value of -0.125
>> -0.125 0 0
>> 0d7'30"W	0dN -17.160
>> 
>> 
>> =============  in egm08togtx.py the line
>>     ps_25 = 2.5 / 60.0
>>     ds_gtx.SetGeoTransform( (-180 - ps_25,ps_25,0,90 + ps_25,0,-1 * ps_25) )
>> 
>> should become
>> 
>>     ds_gtx.SetGeoTransform( (-180 - (ps_25/2),ps_25,0,90 + (ps_25/2),0,-1 * ps_25) )
>> 
>> =================
>> 
>> If some one as encountered the same problem and confirm or could unconfirm this hypothesis, it would be helpful.
>> 
>> Alain ORSONI
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140215/b7d61977/attachment.sig>

From charles.karney at sri.com  Sat Feb 15 08:31:52 2014
From: charles.karney at sri.com (Charles Karney)
Date: Sat, 15 Feb 2014 11:31:52 -0500
Subject: [Proj] Geoid models egm96 et egm08 in PROJ4
In-Reply-To: <930B9E72-A81E-4F2B-B731-BB2E04F035B0@hobu.co>
References: <82B7EC7B-B2CE-4A74-B6A0-C90110995F61@ign.fr>	<52FE37EA.10403@sri.com>
	<930B9E72-A81E-4F2B-B731-BB2E04F035B0@hobu.co>
Message-ID: <52FF9678.3050207@sri.com>

Thanks.  Although I'm confident that the new files are correct, it
would be useful if anyone who is in a position to do so also confirms
this.

   --Charles

On 02/15/2014 11:21 AM, Howard Butler wrote:
> Charles,
>
> I have updated the files at http://download.osgeo.org/proj/vdatum/ with your set and renamed the old ones with a scary filename so that they can stay around for posterity and other archaeological operations if necessary.
>
> https://trac.osgeo.org/proj/ticket/126
>
> Thanks for digging through this. Sorry it took so long to attend to it.
>
> Howard
>
> On Feb 14, 2014, at 9:36 AM, Charles Karney <charles.karney at sri.com> wrote:
>
>> Corrected versions of egm96_15.gtx and egm08_25.gtx are available at
>>
>>    https://sarnoff.sharefile.com/d/sb23d64908da48ffb
>>
>> These were produced directly from the NGA spherical harmonic expansions
>> using the GeoidToGTX program (a sample program distributed with
>> GeographicLib).  These files correct the following issues with the PROJ4
>> files:
>>
>> (1) +/- 5mm quantization errors in egm96.
>> (2) incorrect origins in egm96 and egm08
>>
>> GeoidToGTX faithfully reproduces the grids given by the harmonic
>> synthesis programs (in Fortran) provided by NGA.
>>
>> (The link above should be valid "indefinitely".  However, I can't be
>> sure that it will work beyond about a year.)
>>
>>    --Charles
>>



From b17c0de at gmail.com  Sun Feb 16 12:06:42 2014
From: b17c0de at gmail.com (Kal)
Date: Sun, 16 Feb 2014 21:06:42 +0100
Subject: [Proj] +aunits feature?
Message-ID: <53011A52.1040401@gmail.com>

Hi everyone,
Is there any chance you will consider my +aunits= features (ticket
#121). I am willing to donate any time required to get this integrated.
Thanks!
Kal


From kochizufan at gmail.com  Tue Feb 18 08:52:27 2014
From: kochizufan at gmail.com (kochizufan)
Date: Tue, 18 Feb 2014 08:52:27 -0800 (PST)
Subject: [Proj] What is the difference between proj and cs2cs command?
Message-ID: <1392742347835-5104516.post@n6.nabble.com>

Hello,

I've believed for a long time that,

proj +proj=some_definition

and 

cs2cs +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +to
+proj=some_definition

is same meaning.


But I tried this:

proj -f %.6f +proj=tmerc +lat_0=0 +lon_0=-62 +k=0.9995000000000001
+x_0=400000 +y_0=0 +ellps=clrk80 +towgs84=725,685,536,0,0,0,0 +units=m
+no_defs
-61.35 15.42 0
469737.400664	1704564.737169 0

cs2cs -f %.6f +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +to
+proj=tmerc +lat_0=0 +lon_0=-62 +k=0.9995000000000001 +x_0=400000 +y_0=0
+ellps=clrk80 +towgs84=725,685,536,0,0,0,0 +units=m +no_defs
-61.35 15.42 0
468774.391590	1704156.539473 14.452425

These cases return different results.


And, I used pj_transform C function directly, from WGS84 to target
projection, it returns same result
with proj. 
(469737.400664  1704564.737169)



What is the difference between proj and cs2cs? 
My task is making test case of pj_transform function, which result I should
believe?

Thanks,
Ko-hei



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/What-is-the-difference-between-proj-and-cs2cs-command-tp5104516.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From andre+joost at nurfuerspam.de  Tue Feb 18 12:19:52 2014
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Tue, 18 Feb 2014 21:19:52 +0100
Subject: [Proj] What is the difference between proj and cs2cs command?
In-Reply-To: <1392742347835-5104516.post@n6.nabble.com>
References: <1392742347835-5104516.post@n6.nabble.com>
Message-ID: <le0fbv$q66$1@ger.gmane.org>

Am 18.02.2014 17:52, schrieb kochizufan:

>
> What is the difference between proj and cs2cs?

proj does not obey the +towgs84 parameters.

Greetings,
André Joost



From support.mn at elisanet.fi  Tue Feb 18 13:49:47 2014
From: support.mn at elisanet.fi (support.mn at elisanet.fi)
Date: Tue, 18 Feb 2014 23:49:47 +0200 (EET)
Subject: [Proj] More Proj.4 features (was Re: Aunits)
Message-ID: <3336351.16152871392760188010.JavaMail.support.mn@elisanet.fi>

Hello,

basically I have nothing against "aunits" as long as the default
behavior remains the same .. except that it is a very small
change and we would like to have more improvements
at the same time to the Proj.4 definition language.

One of the most important is the formal syntax checking and
check against most obvious user input errors (typos etc) ..
for example normal lat / lon limits on Earth etc. If errors were
detected the separate routine would then spit out a warning
or error message. This would then warn the user in fore
hand that there is an obvious error in the input. Let say
for example having an O (letter O) instead of a 0 (number 0)
in a number.. Now the sad situation is that Proj.4 says
nothing but gives crazy results and the user is not aware
of what is the problem and the crazy definition might
end up in some library and used with strange results.

The checking could be a separated subprogram that just
does the checking and nothing more. The main program
could just omit that with such data that is already checked
once to keep it simple and fast. So the check routine would
be a separated part and would not affect any of the current
library operation and programs that use it.

It would be most convenient to have that check inside
the library since it also defines the interface language
and format. Now everybody have to write it separated
if they want to have that.. situation similar to "aunits".

The syntax checker and analyzer could be also a
some kind of a preprocessor that could also handle
the "aunits" as well .. and maybe some future additional
similar requirements.

So if you do all that ... I have nothing against "aunits"!

regards: Janne.

-----------------------------------------------------------------------

Kal [b17c0de at gmail.com] kirjoitti: 
> Hi everyone,
> Is there any chance you will consider my +aunits= features (ticket
> #121). I am willing to donate any time required to get this integrated.
> Thanks!
> Kal
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
> 




From helloadamdynamic+proj4 at gmail.com  Mon Feb 24 01:37:32 2014
From: helloadamdynamic+proj4 at gmail.com (AdamDynamic)
Date: Mon, 24 Feb 2014 01:37:32 -0800 (PST)
Subject: [Proj] Beginner Question: Latitude/Longitude to x,
 y conversion - understanding output
Message-ID: <1393234652016-5105455.post@n6.nabble.com>

Hi,

I've been scouring the internet for a couple of days now and getting
absolutely nowhere - I appreciate this is probably a simple question once
you know the answer but any help on this would be appreciated!

I have a series of latitude/longitude coordinates that i want to plot as xy
coordinates (i.e. a flat, rectangular map).

I'm using the PyProj Python library to perform the conversion, the problem
is I can't determine what the output of the function means or represents? 

e.g. Converting [51.5072,0.1275] (what Google tells me is the lat/long for
London in the UK) returns [5733755.276187301, 14193.246790158479] for a
Mercator projection - my question is '5733755.276187301 of what'? I
understand that the library converts to Proj.4 notation (?) but I can't seem
to find what the units are, or how I'd map the output onto a 900x1100
rectangle?

I'm using the following conversion formula which I found  here
<http://osgeo-org.1560.x6.nabble.com/Google-Mercator-Projection-td3841191.html>  

+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0
+k=1.0 +units=m  +no_defs

Any assistance would be great as I haven't been able to get any information
from anywhere else. Please let me know if more information would be useful.

Thanks,

Adam



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Beginner-Question-Latitude-Longitude-to-x-y-conversion-understanding-output-tp5105455.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From antti.castren at iki.fi  Mon Feb 24 03:54:20 2014
From: antti.castren at iki.fi (=?ISO-8859-1?Q?Antti_Castr=E9n?=)
Date: Mon, 24 Feb 2014 13:54:20 +0200
Subject: [Proj] Beginner Question: Latitude/Longitude to x,
 y conversion - understanding output
In-Reply-To: <1393234652016-5105455.post@n6.nabble.com>
References: <1393234652016-5105455.post@n6.nabble.com>
Message-ID: <CAPcvoOLdP2vkSbA65TGod20Dtx=iSeytR+heJbGMGCUbS5Y2cw@mail.gmail.com>

 Hi Adam,

Units are meters. But they are true meters only at the latitude of
true scale of Mercator projection, which in your case is the Equator
(+lat_ts=0, +k=1.0). The string actually tells you that units are
meters (+units=m). At other latitudes meters are 'scaled' as the
projection formulae show. I personally call them pseudo-meters or
Mercator-meters, since they don't represent the correct distance. They
are just units of rectangular coordinates.

The longitude you are projecting (0.1275) is 14 193.25 m away from the
Central Meridian at the Equator. At latitude of London the true
distance from the Central Meridian is less since the meridians are
closer each other.

The latitude you are projecting (51.5072) is 5 733 755.28
pseudo-meters north of the Equator. The first meter is quite close to
real meter, but the scaling affects more and more the further you go
from the Equator. The true distance is only about 4 973 600 m.

To output the map onto 900x1100 rectangle you have to scale the length
and width of your projected map coordinates to 900 and 1100. And then
you have to apply shift of origin of course.

Hope this helps,

  Antti

2014-02-24 11:37 GMT+02:00 AdamDynamic <helloadamdynamic+proj4 at gmail.com>:
> Hi,
>
> I've been scouring the internet for a couple of days now and getting
> absolutely nowhere - I appreciate this is probably a simple question once
> you know the answer but any help on this would be appreciated!
>
> I have a series of latitude/longitude coordinates that i want to plot as xy
> coordinates (i.e. a flat, rectangular map).
>
> I'm using the PyProj Python library to perform the conversion, the problem
> is I can't determine what the output of the function means or represents?
>
> e.g. Converting [51.5072,0.1275] (what Google tells me is the lat/long for
> London in the UK) returns [5733755.276187301, 14193.246790158479] for a
> Mercator projection - my question is '5733755.276187301 of what'? I
> understand that the library converts to Proj.4 notation (?) but I can't seem
> to find what the units are, or how I'd map the output onto a 900x1100
> rectangle?
>
> I'm using the following conversion formula which I found  here
> <http://osgeo-org.1560.x6.nabble.com/Google-Mercator-Projection-td3841191.html>
>
> +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0
> +k=1.0 +units=m  +no_defs
>
> Any assistance would be great as I haven't been able to get any information
> from anywhere else. Please let me know if more information would be useful.
>
> Thanks,
>
> Adam
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/Beginner-Question-Latitude-Longitude-to-x-y-conversion-understanding-output-tp5105455.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj


From helloadamdynamic+proj4 at gmail.com  Mon Feb 24 05:30:12 2014
From: helloadamdynamic+proj4 at gmail.com (AdamDynamic)
Date: Mon, 24 Feb 2014 05:30:12 -0800 (PST)
Subject: [Proj] Beginner Question: Latitude/Longitude to x,
 y conversion - understanding output
In-Reply-To: <CAPcvoOLdP2vkSbA65TGod20Dtx=iSeytR+heJbGMGCUbS5Y2cw@mail.gmail.com>
References: <1393234652016-5105455.post@n6.nabble.com>
	<CAPcvoOLdP2vkSbA65TGod20Dtx=iSeytR+heJbGMGCUbS5Y2cw@mail.gmail.com>
Message-ID: <1393248612427-5105524.post@n6.nabble.com>

Ah ok, thanks for that. Reading your answer, the notation makes a bit more
sense (a risk of using something you find on the internet without actually
understanding it)


> To output the map onto 900x1100 rectangle you have to scale the length
> and width of your projected map coordinates to 900 and 1100. And then
> you have to apply shift of origin of course.

Am I correct in thinking that as I have the latitude of true scale as the
Equator, then no shift of origin is required?

In terms of scaling the output, my understanding is that the 'corners' of a
projection based on latitude and longitude should be -180,-90 and 180,90 -
when I convert these values using the PyProj library I get values of 1E30
for each value (which seems to me clearly wrong). What is the best way to
scale the output in terms of min/max values (in 'pseudo-meters') for each
corner of my 900x1100 rectangle?

Thanks again for the help!

Adam




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Beginner-Question-Latitude-Longitude-to-x-y-conversion-understanding-output-tp5105455p5105524.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From jagoncal at gmail.com  Mon Feb 24 06:27:47 2014
From: jagoncal at gmail.com (=?ISO-8859-1?Q?Jose_Gon=E7alves?=)
Date: Mon, 24 Feb 2014 14:27:47 +0000
Subject: [Proj] Beginner Question: Latitude/Longitude to x,
 y conversion - understanding output
In-Reply-To: <1393248612427-5105524.post@n6.nabble.com>
References: <1393234652016-5105455.post@n6.nabble.com>
	<CAPcvoOLdP2vkSbA65TGod20Dtx=iSeytR+heJbGMGCUbS5Y2cw@mail.gmail.com>
	<1393248612427-5105524.post@n6.nabble.com>
Message-ID: <CALHLaOQDKtU3qYf0MWW46w-mjzMF5MpHqy0gV6ct_j4Qny2ZLQ@mail.gmail.com>

Adam

I think you have to change the order of your coordinates. The default input
for PROJ is (lon,lat) and the default output is (Easting,Northing).
I used PROJ in the command line to check.

You have done:
echo 51.5072 0.1275 | proj +proj=merc +a=6378137 +b=6378137
5733755.28      14193.25

and it should have been:
echo 0.1275 51.5072 | proj +proj=merc +a=6378137 +b=6378137
14193.24        6711506.71

The local deformation of lengths at latitude LAT is approximately 1/COS(LAT)

Regards

José Gonçalves



Call
Send SMS
Add to Skype
You'll need Skype CreditFree via Skype


2014-02-24 13:30 GMT+00:00 AdamDynamic <helloadamdynamic+proj4 at gmail.com>:

> Ah ok, thanks for that. Reading your answer, the notation makes a bit more
> sense (a risk of using something you find on the internet without actually
> understanding it)
>
>
> > To output the map onto 900x1100 rectangle you have to scale the length
> > and width of your projected map coordinates to 900 and 1100. And then
> > you have to apply shift of origin of course.
>
> Am I correct in thinking that as I have the latitude of true scale as the
> Equator, then no shift of origin is required?
>
> In terms of scaling the output, my understanding is that the 'corners' of a
> projection based on latitude and longitude should be -180,-90 and 180,90 -
> when I convert these values using the PyProj library I get values of 1E30
> for each value (which seems to me clearly wrong). What is the best way to
> scale the output in terms of min/max values (in 'pseudo-meters') for each
> corner of my 900x1100 rectangle?
>
> Thanks again for the help!
>
> Adam
>
>
>
>
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/Beginner-Question-Latitude-Longitude-to-x-y-conversion-understanding-output-tp5105455p5105524.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140224/5e283397/attachment.html>

From antti.castren at iki.fi  Mon Feb 24 06:37:28 2014
From: antti.castren at iki.fi (=?ISO-8859-1?Q?Antti_Castr=E9n?=)
Date: Mon, 24 Feb 2014 16:37:28 +0200
Subject: [Proj] Beginner Question: Latitude/Longitude to x,
 y conversion - understanding output
In-Reply-To: <1393248612427-5105524.post@n6.nabble.com>
References: <1393234652016-5105455.post@n6.nabble.com>
	<CAPcvoOLdP2vkSbA65TGod20Dtx=iSeytR+heJbGMGCUbS5Y2cw@mail.gmail.com>
	<1393248612427-5105524.post@n6.nabble.com>
Message-ID: <CAPcvoOKh8xapTLW1QTY=wm_-tdUKeXfMT6vVCaVkduo3_iJbGg@mail.gmail.com>

2014-02-24 15:30 GMT+02:00 AdamDynamic <helloadamdynamic+proj4 at gmail.com>:
>> To output the map onto 900x1100 rectangle you have to scale the length
>> and width of your projected map coordinates to 900 and 1100. And then
>> you have to apply shift of origin of course.
>
> Am I correct in thinking that as I have the latitude of true scale as the
> Equator, then no shift of origin is required?

It depends on the area of interest and the coordinate system of your
map image (where your image's origin is). If you are mapping the
World, I think your image origin (0,0) will be somewhere else than in
the center. Or it could be there if your image coordinate ranges are
-450 to 450 and -550 to 550.

> In terms of scaling the output, my understanding is that the 'corners' of a
> projection based on latitude and longitude should be -180,-90 and 180,90 -
> when I convert these values using the PyProj library I get values of 1E30
> for each value (which seems to me clearly wrong). What is the best way to
> scale the output in terms of min/max values (in 'pseudo-meters') for each
> corner of my 900x1100 rectangle?

You simply can NOT project the poles (lat=90) using Mercator
projection, because the formulae give the infinity as result. Stop at
around 75N/S degrees in case you want something usable.

  Antti


From andre+joost at nurfuerspam.de  Mon Feb 24 10:27:31 2014
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Mon, 24 Feb 2014 19:27:31 +0100
Subject: [Proj] Beginner Question: Latitude/Longitude to x,
 y conversion - understanding output
In-Reply-To: <CAPcvoOKh8xapTLW1QTY=wm_-tdUKeXfMT6vVCaVkduo3_iJbGg@mail.gmail.com>
References: <1393234652016-5105455.post@n6.nabble.com>
	<CAPcvoOLdP2vkSbA65TGod20Dtx=iSeytR+heJbGMGCUbS5Y2cw@mail.gmail.com>
	<1393248612427-5105524.post@n6.nabble.com>
	<CAPcvoOKh8xapTLW1QTY=wm_-tdUKeXfMT6vVCaVkduo3_iJbGg@mail.gmail.com>
Message-ID: <leh7v2$3aq$1@ger.gmane.org>

Am 24.02.2014 15:37, schrieb Antti Castrén:

>
> You simply can NOT project the poles (lat=90) using Mercator
> projection, because the formulae give the infinity as result. Stop at
> around 75N/S degrees in case you want something usable.


If you stop at 85°N/S, the map will be a square. That`s the logic behind 
using 256x256pixel tiles as Google and Openstreetmap do.

Greetings,
André Joost




From mike.reynolds at aug-tech.co.uk  Wed Feb 26 09:12:43 2014
From: mike.reynolds at aug-tech.co.uk (Mike Reynolds)
Date: Wed, 26 Feb 2014 09:12:43 -0800 (PST)
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1386792840902-5093816.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>
Message-ID: <1393434763959-5106172.post@n6.nabble.com>

Hi.

Have you managed to resolve this?
I have been struggling to build Proj all day, and have now the exact same
errors!

I am also trying to use nmake with the makefile.vc - This does compile and
create a proj.dll, but when I call any native functions from Java I get an
UnsatisfiedLinkError, so something is missing!

Cheers



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106172.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From mchristyuk at hotmail.com  Wed Feb 26 10:37:56 2014
From: mchristyuk at hotmail.com (Mark Christy)
Date: Wed, 26 Feb 2014 18:37:56 +0000
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1393434763959-5106172.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>,
	<1393434763959-5106172.post@n6.nabble.com>
Message-ID: <DUB129-W81154AED4FB8F82D83C1EBD2800@phx.gbl>

Hi Mike,
I did get it to build using Microsoft VC++ compiler (used the free express edition).
I had to modify the build scripts to get it to work, but I have at least ended up with a DLL that I can call from Java!
If you can hang on I'll upload my build scripts tomorrow when I'm back in the office.
Cheers
Mark

> Date: Wed, 26 Feb 2014 09:12:43 -0800
> From: mike.reynolds at aug-tech.co.uk
> To: proj at lists.maptools.org
> Subject: Re: [Proj] Mingw JNI build issue
> 
> Hi.
> 
> Have you managed to resolve this?
> I have been struggling to build Proj all day, and have now the exact same
> errors!
> 
> I am also trying to use nmake with the makefile.vc - This does compile and
> create a proj.dll, but when I call any native functions from Java I get an
> UnsatisfiedLinkError, so something is missing!
> 
> Cheers
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106172.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140226/0e658eb1/attachment.html>

From mike.reynolds at aug-tech.co.uk  Wed Feb 26 10:46:35 2014
From: mike.reynolds at aug-tech.co.uk (Mike Reynolds)
Date: Wed, 26 Feb 2014 10:46:35 -0800 (PST)
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1393434763959-5106172.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>
	<1393434763959-5106172.post@n6.nabble.com>
Message-ID: <1393440395602-5106192.post@n6.nabble.com>

Hi Mark,

Example files would be great!

I've just got the code into VC Express, but its implying I have to change
the JNI wrapper functions to use C++ versions, which I'm loathed to do as I
use the same wrappers on Android.

Cheers.

Mike



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106192.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From mchristyuk at hotmail.com  Wed Feb 26 11:04:21 2014
From: mchristyuk at hotmail.com (Mark Christy)
Date: Wed, 26 Feb 2014 19:04:21 +0000
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1393440395602-5106192.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>,
	<1393434763959-5106172.post@n6.nabble.com>,
	<1393440395602-5106192.post@n6.nabble.com>
Message-ID: <DUB129-W339EE2D126030D71E9353AD2800@phx.gbl>

HI Mike,
I had to change something in a couple of the source files as there were compilation errors, but nothing that would stop it working with Android.
Apologies, it's a bit hazy as it was a while since I got it compiling!
The biggest issue was with the VC build script.. but that was mainly just to add the JNI portion to it.
I'll zip up the entire build folder and upload it for you in the morning.
Cheers
Mark
> Date: Wed, 26 Feb 2014 10:46:35 -0800
> From: mike.reynolds at aug-tech.co.uk
> To: proj at lists.maptools.org
> Subject: Re: [Proj] Mingw JNI build issue
> 
> Hi Mark,
> 
> Example files would be great!
> 
> I've just got the code into VC Express, but its implying I have to change
> the JNI wrapper functions to use C++ versions, which I'm loathed to do as I
> use the same wrappers on Android.
> 
> Cheers.
> 
> Mike
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106192.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140226/a887152c/attachment.html>

From mchristyuk at hotmail.com  Thu Feb 27 00:39:17 2014
From: mchristyuk at hotmail.com (Mark Christy)
Date: Thu, 27 Feb 2014 08:39:17 +0000
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1393440395602-5106192.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>,
	<1393434763959-5106172.post@n6.nabble.com>,
	<1393440395602-5106192.post@n6.nabble.com>
Message-ID: <DUB129-W154A867EE3B7A23BC96EFD2830@phx.gbl>

Hi Mike,
Here's my complete 4.8.0 build directory with the sources and build scripts.
Looking at it all I had to do was add JNI to the VC++ build script. I also had to change one line in one of the source files just for a pure syntax reason to do with VC++.
http://www.mediafire.com/download/4lb38al9bjbzcg8/Proj4.8.0.zip
Cheers
Mark

> Date: Wed, 26 Feb 2014 10:46:35 -0800
> From: mike.reynolds at aug-tech.co.uk
> To: proj at lists.maptools.org
> Subject: Re: [Proj] Mingw JNI build issue
> 
> Hi Mark,
> 
> Example files would be great!
> 
> I've just got the code into VC Express, but its implying I have to change
> the JNI wrapper functions to use C++ versions, which I'm loathed to do as I
> use the same wrappers on Android.
> 
> Cheers.
> 
> Mike
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106192.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140227/0a6a68ba/attachment.html>

From mchristyuk at hotmail.com  Thu Feb 27 00:40:13 2014
From: mchristyuk at hotmail.com (Mark Christy)
Date: Thu, 27 Feb 2014 08:40:13 +0000
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1393440395602-5106192.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>,
	<1393434763959-5106172.post@n6.nabble.com>,
	<1393440395602-5106192.post@n6.nabble.com>
Message-ID: <DUB129-W179B1321DE7CFC41B239DD2830@phx.gbl>

Oh yeah.. and I built it from the command line using the instructions given in the readme.txt file for building with VC++.. I didn't use the GUI interface...
Cheers
Mark

> Date: Wed, 26 Feb 2014 10:46:35 -0800
> From: mike.reynolds at aug-tech.co.uk
> To: proj at lists.maptools.org
> Subject: Re: [Proj] Mingw JNI build issue
> 
> Hi Mark,
> 
> Example files would be great!
> 
> I've just got the code into VC Express, but its implying I have to change
> the JNI wrapper functions to use C++ versions, which I'm loathed to do as I
> use the same wrappers on Android.
> 
> Cheers.
> 
> Mike
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106192.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140227/28a1c93d/attachment.html>

From mike.reynolds at aug-tech.co.uk  Thu Feb 27 02:29:30 2014
From: mike.reynolds at aug-tech.co.uk (Mike Reynolds)
Date: Thu, 27 Feb 2014 02:29:30 -0800 (PST)
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1393440395602-5106192.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>
	<1393434763959-5106172.post@n6.nabble.com>
	<1393440395602-5106192.post@n6.nabble.com>
Message-ID: <1393496970965-5106316.post@n6.nabble.com>

Hi Mark - Thanks for the files.

I've got a bit further using your files, changing the include path to point
to my Java_Home. I also see where you added in jni=jniproj.obj to get it to
build.

When doing the build now, I have another issue, which I'm pretty sure is
related to 64bit vs 32bit; 
jniproj.c(223) : error C2275: 'jclass' : illegal use of this type as an
expression
        C:\Program Files\Java\jdk1.6.0_22\include\jni.h(84) : see
declaration of 'jclass'
jniproj.c(223) : error C2146: syntax error : missing ';' before identifier
'c'


I believe I'm right in saying Proj only supports a 32bit build. I'm using
32bit nmake to perform the build, but the only jni.h I have is in
"C:\Program Files\Java\jdk1.6.0_22\include\", therefore I'm guessing 64bit
(although jni_md.h is in \Win32\ )

Do you know if its enough to get a 32bit version of jni.h and include that
instead? Which one(s) are you using?

Thanks,

Mike




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106316.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


From mchristyuk at hotmail.com  Thu Feb 27 02:34:42 2014
From: mchristyuk at hotmail.com (Mark Christy)
Date: Thu, 27 Feb 2014 10:34:42 +0000
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <1393496970965-5106316.post@n6.nabble.com>
References: <1386792840902-5093816.post@n6.nabble.com>,
	<1393434763959-5106172.post@n6.nabble.com>,
	<1393440395602-5106192.post@n6.nabble.com>,
	<1393496970965-5106316.post@n6.nabble.com>
Message-ID: <DUB129-W43A6CD9CE278CD5D9168FBD2830@phx.gbl>

Hi Mike,
It does build for 64 bit as that is what I have done (using it in a 64 bit application).
However I did my build using Java 7 rather than the Java 6 I see you're using.
Also you need to make sure you launched the 64bit VC++ command line tools windows.
Sorry I can't be more exact... it was a while ago and C++ is not my strong point!
Cheers
Mark

> Date: Thu, 27 Feb 2014 02:29:30 -0800
> From: mike.reynolds at aug-tech.co.uk
> To: proj at lists.maptools.org
> Subject: Re: [Proj] Mingw JNI build issue
> 
> Hi Mark - Thanks for the files.
> 
> I've got a bit further using your files, changing the include path to point
> to my Java_Home. I also see where you added in jni=jniproj.obj to get it to
> build.
> 
> When doing the build now, I have another issue, which I'm pretty sure is
> related to 64bit vs 32bit; 
> jniproj.c(223) : error C2275: 'jclass' : illegal use of this type as an
> expression
>         C:\Program Files\Java\jdk1.6.0_22\include\jni.h(84) : see
> declaration of 'jclass'
> jniproj.c(223) : error C2146: syntax error : missing ';' before identifier
> 'c'
> 
> 
> I believe I'm right in saying Proj only supports a 32bit build. I'm using
> 32bit nmake to perform the build, but the only jni.h I have is in
> "C:\Program Files\Java\jdk1.6.0_22\include\", therefore I'm guessing 64bit
> (although jni_md.h is in \Win32\ )
> 
> Do you know if its enough to get a 32bit version of jni.h and include that
> instead? Which one(s) are you using?
> 
> Thanks,
> 
> Mike
> 
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106316.html
> Sent from the PROJ.4 mailing list archive at Nabble.com.
> _______________________________________________
> Proj mailing list
> Proj at lists.maptools.org
> http://lists.maptools.org/mailman/listinfo/proj
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/proj/attachments/20140227/1eda3f43/attachment.html>

From mike.reynolds at aug-tech.co.uk  Thu Feb 27 08:46:47 2014
From: mike.reynolds at aug-tech.co.uk (Mike Reynolds)
Date: Thu, 27 Feb 2014 08:46:47 -0800 (PST)
Subject: [Proj] Mingw JNI build issue
In-Reply-To: <DUB129-W43A6CD9CE278CD5D9168FBD2830@phx.gbl>
References: <1386792840902-5093816.post@n6.nabble.com>
	<1393434763959-5106172.post@n6.nabble.com>
	<1393440395602-5106192.post@n6.nabble.com>
	<1393496970965-5106316.post@n6.nabble.com>
	<DUB129-W43A6CD9CE278CD5D9168FBD2830@phx.gbl>
Message-ID: <1393519607283-5106415.post@n6.nabble.com>

Mark,

Have been trying all day with this again, but still having issues :(
Firstly the compiler doesn't like my java include paths, no matter what I
do. Ended up putting jni.h and jni_md.h in the \src\ directory. This got the
build further (after much messing around with 32bit/64bit compilation.

I was going to write more, but needless to say, I've tried your built dll in
my project, but still get UnsatisfiedLinkError on 'transform'.

Had enough now!

I really don't know whats going on and really hate c/c++!

Would you still have the 'nmake' (or other build) command line you used
Mark?  If not, anyone on the list? I'd be extremely grateful!!

Mike



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Mingw-JNI-build-issue-tp5093816p5106415.html
Sent from the PROJ.4 mailing list archive at Nabble.com.


