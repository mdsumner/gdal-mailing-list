From paul.wittle at dorsetcouncil.gov.uk  Thu Jul  1 01:35:34 2021
From: paul.wittle at dorsetcouncil.gov.uk (Paul Wittle)
Date: Thu, 1 Jul 2021 08:35:34 +0000
Subject: [QGIS-Developer] Feature discussion
Message-ID: <LO2P265MB3231568629B0B66EB16BFF87C1009@LO2P265MB3231.GBRP265.PROD.OUTLOOK.COM>

Hi,

I suspect this has already been asked a few times but I thought I'd ask anyway.

Is there a feature request to get a dialogue box to appear when saving a project?

I'm asking because if the knock on impact of Covid is more people working from home and using home broadband then I feel like there may need to be a greater level of user feedback. To give an example if I take a project file of about 4MB and save it locally it is finished in seconds (definitely under a minute) but if I take the same project file and save it to a network location via a VPN then the save time is longer; say a minute or two. Based on my investigation this seems to match up with peoples home broadband as in the UK the upload speed is pretty variable / often quite poor when compared with download speeds.

I think it would be useful if there was a dialog that appears if a part of the process takes longer than x seconds. The dialog might say:

  *   Creating project file
  *   Saving to disk
  *   Saving backup

I think those are the main tasks involved in the save but it would be useful if the user is told that it is saving to disk but taking a while as hopefully they will then investigate their connection speed first.

Not to worry if this has already been discussed and rejected but I thought I'd ask to see what the options / opinions are.

Thanks,
Paul

This e-mail and any files transmitted with it are intended solely for the use of the individual or entity to whom they are addressed. It may contain unclassified but sensitive or protectively marked material and should be handled accordingly. Unless you are the named addressee (or authorised to receive it for the addressee) you may not copy or use it, or disclose it to anyone else. If you have received this transmission in error please notify the sender immediately. All traffic may be subject to recording and/or monitoring in accordance with relevant legislation. Any views expressed in this message are those of the individual sender, except where the sender specifies and with authority, states them to be the views of Dorset Council. Dorset Council does not accept service of documents by fax or other electronic means. Virus checking: Whilst all reasonable steps have been taken to ensure that this electronic communication and its attachments whether encoded, encrypted or otherwise supplied are free from computer viruses, Dorset Council accepts no liability in respect of any loss, cost, damage or expense suffered as a result of accessing this message or any of its attachments. For information on how Dorset Council processes your information, please see www.dorsetcouncil.gov.uk/data-protection
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210701/dda5479f/attachment.html>

From charles at kartoza.com  Thu Jul  1 01:53:47 2021
From: charles at kartoza.com (Charles Dixon-Paver)
Date: Thu, 1 Jul 2021 10:53:47 +0200
Subject: [QGIS-Developer] Feature discussion
In-Reply-To: <LO2P265MB3231568629B0B66EB16BFF87C1009@LO2P265MB3231.GBRP265.PROD.OUTLOOK.COM>
References: <LO2P265MB3231568629B0B66EB16BFF87C1009@LO2P265MB3231.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <CAK2KqifUntbpWGZoPyLRs0msm6vrauYeS8qYR3=BTTYmkp6d4g@mail.gmail.com>

There is a save project macro under the project properties which I believe
can be used to achieve this using the pyqgis api. Perhaps other users can
share snippets that perform the functions you are requesting, as I am not
entirely convinced that all of this functionality is useful enough to all
users to warrant inclusion as core features, or at least that this
functionality by default uses the bottom progress bar used by processing
tools rather than a separate and obtrusive dialogue.

On Thu, 1 Jul 2021 at 10:35, Paul Wittle <paul.wittle at dorsetcouncil.gov.uk>
wrote:

> Hi,
>
>
>
> I suspect this has already been asked a few times but I thought I?d ask
> anyway.
>
>
>
> Is there a feature request to get a dialogue box to appear when saving a
> project?
>
>
>
> I?m asking because if the knock on impact of Covid is more people working
> from home and using home broadband then I feel like there may need to be a
> greater level of user feedback. To give an example if I take a project file
> of about 4MB and save it locally it is finished in seconds (definitely
> under a minute) but if I take the same project file and save it to a
> network location via a VPN then the save time is longer; say a minute or
> two. Based on my investigation this seems to match up with peoples home
> broadband as in the UK the upload speed is pretty variable / often quite
> poor when compared with download speeds.
>
>
>
> I think it would be useful if there was a dialog that appears if a part of
> the process takes longer than x seconds. The dialog might say:
>
>    - Creating project file
>    - Saving to disk
>    - Saving backup
>
>
>
> I think those are the main tasks involved in the save but it would be
> useful if the user is told that it is saving to disk but taking a while as
> hopefully they will then investigate their connection speed first.
>
>
>
> Not to worry if this has already been discussed and rejected but I thought
> I?d ask to see what the options / opinions are.
>
>
>
> Thanks,
>
> Paul
>
>
> This e-mail and any files transmitted with it are intended solely for the
> use of the individual or entity to whom they are addressed. It may contain
> unclassified but sensitive or protectively marked material and should be
> handled accordingly. Unless you are the named addressee (or authorised to
> receive it for the addressee) you may not copy or use it, or disclose it to
> anyone else. If you have received this transmission in error please notify
> the sender immediately. All traffic may be subject to recording and/or
> monitoring in accordance with relevant legislation. Any views expressed in
> this message are those of the individual sender, except where the sender
> specifies and with authority, states them to be the views of Dorset
> Council. Dorset Council does not accept service of documents by fax or
> other electronic means. Virus checking: Whilst all reasonable steps have
> been taken to ensure that this electronic communication and its attachments
> whether encoded, encrypted or otherwise supplied are free from computer
> viruses, Dorset Council accepts no liability in respect of any loss, cost,
> damage or expense suffered as a result of accessing this message or any of
> its attachments. For information on how Dorset Council processes your
> information, please see www.dorsetcouncil.gov.uk/data-protection
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210701/7eac68d0/attachment-0001.html>

From enzo.ccc at gmail.com  Thu Jul  1 02:07:17 2021
From: enzo.ccc at gmail.com (Enzo Cocca)
Date: Thu, 1 Jul 2021 11:07:17 +0200
Subject: [QGIS-Developer] Rscript load output into qgis from folder
Message-ID: <CAC_+zur=m6xyBs8hnZdRY0B6mb5pxJXrrJxtUWr8FfmO5DpqQQ@mail.gmail.com>

Hi peoples,
I have a question:
In my r script I save (some raster and some vector file) in an a folder. Is
it a method to load my output into qgis?
I can't use output vector and output raster for some reason regarding the R
packages that I use.

so this one is my script:

##load_vector_using_rgdal
##load_raster_using_rgdal
##movecost script=group
##Movecost=name
##DTM=raster
##Origin=vector point
##Destination=vector point
##Move=number 8
##Breaks=number 0.5
##Function=selection
t;tofp;mp;icmonp;icmoffp;icfonp;ug;alb;gkrs;r;ree;hrz;wcs;p;vl;ls;b;icfoffp
##Time=selection h;m
##Outp=selection r;c
##Return_Base=selection TRUE;FALSE
##Cognitive_Slope=selection TRUE;FALSE
##Critical_Slope=number 1
##Walker_Body_Weight=number 70
##Carried_Load_Weight=number 0
##N=number 1
##Speed=number 1
##Zoom_Level=number 9
##RL=number 2
##CL=selection TRUE;FALSE
##DL=selection TRUE;FALSE
##CB=number 0.6
##CLL=number 0.6
##Output=output folder
##showplots
setwd(Output)
library(sp)
library(movecost)
library(raster)
library(rgdal)
DTM<-raster(DTM)
if(Function==0)
Function=c("t")
if(Function==1)
Function=c("tofp")
if(Function==2)
Function=c("mp")
if(Function==3)
Function=c("icmonp")
if(Function==4)
Function=c("icmoffp")
if(Function==5)
Function=c("icfonp")
if(Function==6)
Function=c("ug")
if(Function==7)
Function=c("alb")
if(Function==8)
Function=c("gkrs")
if(Function==9)
Function=c("r")
if(Function==10)
Function=c("ree")
if(Function==11)
Function=c("hrz")
if(Function==12)
Function=c("wcs")
if(Function==13)
Function=c("p")
if(Function==14)
Function=c("vl")
if(Function==15)
Function=c("ls")
if(Function==16)
Function=c("b")
if(Function==17)
Function=c("icfoffp")
if(Time==0)
Time=c("h")
if(Time==1)
Time=c("m")
if(Outp==0)
Outp=c("r")
if(Outp==1)
Outp=c("c")
if(Return_Base==0)
Return_Base=c(TRUE)
if(Return_Base==1)
Return_Base=c(FALSE)
if(Cognitive_Slope==0)
Cognitive_Slopee=c(TRUE)
if(Cognitive_Slope==1)
Cognitive_Slope=c(FALSE)

if(CL==0)
CL=c(TRUE)
if(CL==1)
CL=c(FALSE)

if(DL==0)
DL=c(TRUE)
if(DL==1)
DL=c(FALSE)
result<-movecost(dtm=DTM, origin=Origin, destin=Destination,
funct=Function, time=Time, outp=Outp, move=Move,
breaks=Breaks,return.base=Return_Base, cogn.slp=Cognitive_Slope,
sl.crit=Critical_Slope,W=Walker_Body_Weight,L=Carried_Load_Weight,N=N,V=Speed,z=Zoom_Level,rb.lty=RL,cont.lab=CL,destin.lab=DL,cex.breaks=CB,cex.lcp.lab=CLL,
export=TRUE)

thanks in advance

E



-- 
Enzo Cocca PhD
in "Science and Technology for Archaeology and Cultural Heritage"

ISMEO
International Association of Mediterranean and Oriental Studies


mail: enzo.ccc at gmail.com
cell: +393495087014
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210701/6d2ba4ed/attachment.html>

From paul.wittle at dorsetcouncil.gov.uk  Thu Jul  1 02:58:24 2021
From: paul.wittle at dorsetcouncil.gov.uk (Paul Wittle)
Date: Thu, 1 Jul 2021 09:58:24 +0000
Subject: [QGIS-Developer] Feature discussion
In-Reply-To: <CAK2KqifUntbpWGZoPyLRs0msm6vrauYeS8qYR3=BTTYmkp6d4g@mail.gmail.com>
References: <LO2P265MB3231568629B0B66EB16BFF87C1009@LO2P265MB3231.GBRP265.PROD.OUTLOOK.COM>
 <CAK2KqifUntbpWGZoPyLRs0msm6vrauYeS8qYR3=BTTYmkp6d4g@mail.gmail.com>
Message-ID: <LO2P265MB32312298EB47D7B5928AA3AFC1009@LO2P265MB3231.GBRP265.PROD.OUTLOOK.COM>

Hi,

I was not aware of that option and as you say I think that covers it nicely enough anyway. Thanks for pointing it out but any examples people have would be super useful.

Thanks again,
Paul

From: Charles Dixon-Paver <charles at kartoza.com>
Sent: 01 July 2021 09:54
To: Paul Wittle <paul.wittle at dorsetcouncil.gov.uk>
Cc: qgis-dev <Qgis-developer at lists.osgeo.org>
Subject: Re: [QGIS-Developer] Feature discussion

There is a save project macro under the project properties which I believe can be used to achieve this using the pyqgis api. Perhaps other users can share snippets that perform the functions you are requesting, as I am not entirely convinced that all of this functionality is useful enough to all users to warrant inclusion as core features, or at least that this functionality by default uses the bottom progress bar used by processing tools rather than a separate and obtrusive dialogue.

On Thu, 1 Jul 2021 at 10:35, Paul Wittle <paul.wittle at dorsetcouncil.gov.uk<mailto:paul.wittle at dorsetcouncil.gov.uk>> wrote:
Hi,

I suspect this has already been asked a few times but I thought I?d ask anyway.

Is there a feature request to get a dialogue box to appear when saving a project?

I?m asking because if the knock on impact of Covid is more people working from home and using home broadband then I feel like there may need to be a greater level of user feedback. To give an example if I take a project file of about 4MB and save it locally it is finished in seconds (definitely under a minute) but if I take the same project file and save it to a network location via a VPN then the save time is longer; say a minute or two. Based on my investigation this seems to match up with peoples home broadband as in the UK the upload speed is pretty variable / often quite poor when compared with download speeds.

I think it would be useful if there was a dialog that appears if a part of the process takes longer than x seconds. The dialog might say:

  *   Creating project file
  *   Saving to disk
  *   Saving backup

I think those are the main tasks involved in the save but it would be useful if the user is told that it is saving to disk but taking a while as hopefully they will then investigate their connection speed first.

Not to worry if this has already been discussed and rejected but I thought I?d ask to see what the options / opinions are.

Thanks,
Paul

This e-mail and any files transmitted with it are intended solely for the use of the individual or entity to whom they are addressed. It may contain unclassified but sensitive or protectively marked material and should be handled accordingly. Unless you are the named addressee (or authorised to receive it for the addressee) you may not copy or use it, or disclose it to anyone else. If you have received this transmission in error please notify the sender immediately. All traffic may be subject to recording and/or monitoring in accordance with relevant legislation. Any views expressed in this message are those of the individual sender, except where the sender specifies and with authority, states them to be the views of Dorset Council. Dorset Council does not accept service of documents by fax or other electronic means. Virus checking: Whilst all reasonable steps have been taken to ensure that this electronic communication and its attachments whether encoded, encrypted or otherwise supplied are free from computer viruses, Dorset Council accepts no liability in respect of any loss, cost, damage or expense suffered as a result of accessing this message or any of its attachments. For information on how Dorset Council processes your information, please see www.dorsetcouncil.gov.uk/data-protection<http://www.dorsetcouncil.gov.uk/data-protection>
_______________________________________________
QGIS-Developer mailing list
QGIS-Developer at lists.osgeo.org<mailto:QGIS-Developer at lists.osgeo.org>
List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
This e-mail and any files transmitted with it are intended solely for the use of the individual or entity to whom they are addressed. It may contain unclassified but sensitive or protectively marked material and should be handled accordingly. Unless you are the named addressee (or authorised to receive it for the addressee) you may not copy or use it, or disclose it to anyone else. If you have received this transmission in error please notify the sender immediately. All traffic may be subject to recording and/or monitoring in accordance with relevant legislation. Any views expressed in this message are those of the individual sender, except where the sender specifies and with authority, states them to be the views of Dorset Council. Dorset Council does not accept service of documents by fax or other electronic means. Virus checking: Whilst all reasonable steps have been taken to ensure that this electronic communication and its attachments whether encoded, encrypted or otherwise supplied are free from computer viruses, Dorset Council accepts no liability in respect of any loss, cost, damage or expense suffered as a result of accessing this message or any of its attachments. For information on how Dorset Council processes your information, please see www.dorsetcouncil.gov.uk/data-protection
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210701/3255d535/attachment-0001.html>

From enzo.ccc at gmail.com  Thu Jul  1 04:48:41 2021
From: enzo.ccc at gmail.com (Enzo Cocca)
Date: Thu, 1 Jul 2021 13:48:41 +0200
Subject: [QGIS-Developer] Rscript load output into qgis from folder
In-Reply-To: <CAC_+zur=m6xyBs8hnZdRY0B6mb5pxJXrrJxtUWr8FfmO5DpqQQ@mail.gmail.com>
References: <CAC_+zur=m6xyBs8hnZdRY0B6mb5pxJXrrJxtUWr8FfmO5DpqQQ@mail.gmail.com>
Message-ID: <CAC_+zuqkWHyE74wH62hwibhB66CW-_9UfdBZ6pqa4eTgS8HCOg@mail.gmail.com>

Hi again,
At moment the solution I found it is this but is not very great.

So I add two R packages more (GmAMisc to import raster and vector, and tkcl
to print a message box)

below the code:

##load_vector_using_rgdal
##load_raster_using_rgdal
##movecost script=group
##DTM=raster
##Origin=vector point
##Destination=vector point
##Movecost=name
##Move=number 8
##Breaks=number 0.5
##Function=selection
t;tofp;mp;icmonp;icmoffp;icfonp;ug;alb;gkrs;r;ree;hrz;wcs;p;vl;ls;b;icfoffp
;
##Time=selection h;m ;
##Outp=selection r;c ;
##Return_Base=selection TRUE;FALSE ;
##Cognitive_Slope=selection FALSE;TRUE ;
##Critical_Slope=number 1
##Walker_Body_Weight=number 70
##Carried_Load_Weight=number 0
##N=number 1
##Speed=number 1
##Zoom_Level=number 9
##RL=number 2
##CL=selection  TRUE;FALSE ;
##DL=selection  TRUE;FALSE ;
##CB=number 0.6
##CLL=number 0.6
##Output=output folder
##Output_Isoline=output vector
##Output_LCP=output vector
##Output_Isoline=output vector
##Output_Cost_Surface=output raster
##Output_Accum_Cost_Surface=output raster
##showplots
setwd(Output)

library(tcltk)
library(sp)
library(movecost)
library(GmAMisc)
library(raster)
library(rgdal)
DTM<-raster(DTM)
if(Function==0)
Function=c("t")
if(Function==1)
Function=c("tofp")
if(Function==2)
Function=c("mp")
if(Function==3)
Function=c("icmonp")
if(Function==4)
Function=c("icmoffp")
if(Function==5)
Function=c("icfonp")
if(Function==6)
Function=c("ug")
if(Function==7)
Function=c("alb")
if(Function==8)
Function=c("gkrs")
if(Function==9)
Function=c("r")
if(Function==10)
Function=c("ree")
if(Function==11)
Function=c("hrz")
if(Function==12)
Function=c("wcs")
if(Function==13)
Function=c("p")
if(Function==14)
Function=c("vl")
if(Function==15)
Function=c("ls")
if(Function==16)
Function=c("b")
if(Function==17)
Function=c("icfoffp")
if(Time==0)
Time=c("h")
if(Time==1)
Time=c("m")
if(Outp==0)
Outp=c("r")
if(Outp==1)
Outp=c("c")
if(Return_Base==0)
Return_Base=c(TRUE)
if(Return_Base==1)
Return_Base=c(FALSE)
if(Cognitive_Slope==0)
Cognitive_Slopee=c(TRUE)
if(Cognitive_Slope==1)
Cognitive_Slope=c(FALSE)

if(CL==0)
CL=c(TRUE)
if(CL==1)
CL=c(FALSE)

if(DL==0)
DL=c(TRUE)
if(DL==1)
DL=c(FALSE)
result<-movecost(dtm=DTM, origin=Origin, destin=Destination,
funct=Function, time=Time, outp=Outp, move=Move,
breaks=Breaks,return.base=Return_Base, cogn.slp=Cognitive_Slope,
sl.crit=Critical_Slope,W=Walker_Body_Weight,L=Carried_Load_Weight,N=N,V=Speed,z=Zoom_Level,rb.lty=RL,cont.lab=CL,destin.lab=DL,cex.breaks=CB,cex.lcp.lab=CLL,
export=TRUE)

msgBox <- tkmessageBox(title = "Import Vector",
                       message = "Import vector isolines .shp!", icon =
"info", type = "ok")
Output_Isoline=impShp()
msgBox2 <- tkmessageBox(title = "Import Vector",
                       message = "Import vector LCPs .shp!", icon = "info",
type = "ok")
Output_LCP=impShp()
msgBox3 <- tkmessageBox(title = "Import Raster",
                       message = "Import raster cost surface!", icon =
"info", type = "ok")
raster1<-impRst()
raster1.sp <- as(raster1, "SpatialPixelsDataFrame") # Converting the
RasterLayer object to a SpatialPixelsDataFrame object
Output_Cost_Surface=raster1.sp
msgBox4 <- tkmessageBox(title = "Import Raster",
                       message = "Import raster accum cost surface !", icon
= "info", type = "ok")

raster2<-impRst()
raster2.sp <- as(raster2, "SpatialPixelsDataFrame") # Converting the
RasterLayer object to a SpatialPixelsDataFrame object
Output_Accum_Cost_Surface=raster2.sp

If some one has some tricks better, should very approciate.

thanks
E

Il giorno gio 1 lug 2021 alle ore 11:07 Enzo Cocca <enzo.ccc at gmail.com> ha
scritto:

> Hi peoples,
> I have a question:
> In my r script I save (some raster and some vector file) in an a folder.
> Is it a method to load my output into qgis?
> I can't use output vector and output raster for some reason regarding the
> R packages that I use.
>
> so this one is my script:
>
> ##load_vector_using_rgdal
> ##load_raster_using_rgdal
> ##movecost script=group
> ##Movecost=name
> ##DTM=raster
> ##Origin=vector point
> ##Destination=vector point
> ##Move=number 8
> ##Breaks=number 0.5
> ##Function=selection
> t;tofp;mp;icmonp;icmoffp;icfonp;ug;alb;gkrs;r;ree;hrz;wcs;p;vl;ls;b;icfoffp
> ##Time=selection h;m
> ##Outp=selection r;c
> ##Return_Base=selection TRUE;FALSE
> ##Cognitive_Slope=selection TRUE;FALSE
> ##Critical_Slope=number 1
> ##Walker_Body_Weight=number 70
> ##Carried_Load_Weight=number 0
> ##N=number 1
> ##Speed=number 1
> ##Zoom_Level=number 9
> ##RL=number 2
> ##CL=selection TRUE;FALSE
> ##DL=selection TRUE;FALSE
> ##CB=number 0.6
> ##CLL=number 0.6
> ##Output=output folder
> ##showplots
> setwd(Output)
> library(sp)
> library(movecost)
> library(raster)
> library(rgdal)
> DTM<-raster(DTM)
> if(Function==0)
> Function=c("t")
> if(Function==1)
> Function=c("tofp")
> if(Function==2)
> Function=c("mp")
> if(Function==3)
> Function=c("icmonp")
> if(Function==4)
> Function=c("icmoffp")
> if(Function==5)
> Function=c("icfonp")
> if(Function==6)
> Function=c("ug")
> if(Function==7)
> Function=c("alb")
> if(Function==8)
> Function=c("gkrs")
> if(Function==9)
> Function=c("r")
> if(Function==10)
> Function=c("ree")
> if(Function==11)
> Function=c("hrz")
> if(Function==12)
> Function=c("wcs")
> if(Function==13)
> Function=c("p")
> if(Function==14)
> Function=c("vl")
> if(Function==15)
> Function=c("ls")
> if(Function==16)
> Function=c("b")
> if(Function==17)
> Function=c("icfoffp")
> if(Time==0)
> Time=c("h")
> if(Time==1)
> Time=c("m")
> if(Outp==0)
> Outp=c("r")
> if(Outp==1)
> Outp=c("c")
> if(Return_Base==0)
> Return_Base=c(TRUE)
> if(Return_Base==1)
> Return_Base=c(FALSE)
> if(Cognitive_Slope==0)
> Cognitive_Slopee=c(TRUE)
> if(Cognitive_Slope==1)
> Cognitive_Slope=c(FALSE)
>
> if(CL==0)
> CL=c(TRUE)
> if(CL==1)
> CL=c(FALSE)
>
> if(DL==0)
> DL=c(TRUE)
> if(DL==1)
> DL=c(FALSE)
> result<-movecost(dtm=DTM, origin=Origin, destin=Destination,
> funct=Function, time=Time, outp=Outp, move=Move,
> breaks=Breaks,return.base=Return_Base, cogn.slp=Cognitive_Slope,
> sl.crit=Critical_Slope,W=Walker_Body_Weight,L=Carried_Load_Weight,N=N,V=Speed,z=Zoom_Level,rb.lty=RL,cont.lab=CL,destin.lab=DL,cex.breaks=CB,cex.lcp.lab=CLL,
> export=TRUE)
>
> thanks in advance
>
> E
>
>
>
> --
> Enzo Cocca PhD
> in "Science and Technology for Archaeology and Cultural Heritage"
>
> ISMEO
> International Association of Mediterranean and Oriental Studies
>
>
> mail: enzo.ccc at gmail.com
> cell: +393495087014
>
>

-- 
Enzo Cocca PhD
in "Science and Technology for Archaeology and Cultural Heritage"

ISMEO
International Association of Mediterranean and Oriental Studies


mail: enzo.ccc at gmail.com
cell: +393495087014
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210701/3402abdc/attachment.html>

From enzo.ccc at gmail.com  Thu Jul  1 13:00:13 2021
From: enzo.ccc at gmail.com (Enzo Cocca)
Date: Thu, 1 Jul 2021 22:00:13 +0200
Subject: [QGIS-Developer] Rscript load output into qgis from folder
In-Reply-To: <CAC_+zuqkWHyE74wH62hwibhB66CW-_9UfdBZ6pqa4eTgS8HCOg@mail.gmail.com>
References: <CAC_+zur=m6xyBs8hnZdRY0B6mb5pxJXrrJxtUWr8FfmO5DpqQQ@mail.gmail.com>
 <CAC_+zuqkWHyE74wH62hwibhB66CW-_9UfdBZ6pqa4eTgS8HCOg@mail.gmail.com>
Message-ID: <CAC_+zuoV-zS16O7rOLy4AAjdFUEs6OuanHWGdvxhwKGP6Ro5Dw@mail.gmail.com>

hi,
just to inform you I solved the problem:

this works for me

......

r<-movecost(dtm=DTM, origin=Origin, destin=Destination, funct=Function,
time=Time, outp=Outp, move=Move, breaks=Breaks, return.base=TRUE,
cogn.slp=TRUE, sl.crit=Critical_Slope, W=Walker_Body_Weight,
L=Carried_Load_Weight, N=N, V=Speed, z=Zoom_Level, rb.lty=RL,
cont.lab=TRUE, destin.lab=TRUE, cex.breaks=CB, cex.lcp.lab=CLL,
oneplot=FALSE, export=FALSE)

raster.sp <- as(r$accumulated.cost.raster, "SpatialPixelsDataFrame")
Output_Accum_Cost_Surface=raster.sp

a1.sp<-as(r$isolines, "SpatialLinesDataFrame")
Output_Isoline=a1.sp

b1.sp<-as(r$LCPs, "SpatialLinesDataFrame")
Output_LCP=b1.sp

lback.sp<-as(r$LCPs.back, "SpatialLinesDataFrame")
Output_LCP_Back=lback.sp

dd.sp<-as(r$dest.loc.w.cost, "SpatialPointsDataFrame")
Output_W_Cost=dd.sp

Il giorno gio 1 lug 2021 alle ore 13:48 Enzo Cocca <enzo.ccc at gmail.com> ha
scritto:

> Hi again,
> At moment the solution I found it is this but is not very great.
>
> So I add two R packages more (GmAMisc to import raster and vector, and
> tkcl to print a message box)
>
> below the code:
>
> ##load_vector_using_rgdal
> ##load_raster_using_rgdal
> ##movecost script=group
> ##DTM=raster
> ##Origin=vector point
> ##Destination=vector point
> ##Movecost=name
> ##Move=number 8
> ##Breaks=number 0.5
> ##Function=selection
> t;tofp;mp;icmonp;icmoffp;icfonp;ug;alb;gkrs;r;ree;hrz;wcs;p;vl;ls;b;icfoffp
> ;
> ##Time=selection h;m ;
> ##Outp=selection r;c ;
> ##Return_Base=selection TRUE;FALSE ;
> ##Cognitive_Slope=selection FALSE;TRUE ;
> ##Critical_Slope=number 1
> ##Walker_Body_Weight=number 70
> ##Carried_Load_Weight=number 0
> ##N=number 1
> ##Speed=number 1
> ##Zoom_Level=number 9
> ##RL=number 2
> ##CL=selection  TRUE;FALSE ;
> ##DL=selection  TRUE;FALSE ;
> ##CB=number 0.6
> ##CLL=number 0.6
> ##Output=output folder
> ##Output_Isoline=output vector
> ##Output_LCP=output vector
> ##Output_Isoline=output vector
> ##Output_Cost_Surface=output raster
> ##Output_Accum_Cost_Surface=output raster
> ##showplots
> setwd(Output)
>
> library(tcltk)
> library(sp)
> library(movecost)
> library(GmAMisc)
> library(raster)
> library(rgdal)
> DTM<-raster(DTM)
> if(Function==0)
> Function=c("t")
> if(Function==1)
> Function=c("tofp")
> if(Function==2)
> Function=c("mp")
> if(Function==3)
> Function=c("icmonp")
> if(Function==4)
> Function=c("icmoffp")
> if(Function==5)
> Function=c("icfonp")
> if(Function==6)
> Function=c("ug")
> if(Function==7)
> Function=c("alb")
> if(Function==8)
> Function=c("gkrs")
> if(Function==9)
> Function=c("r")
> if(Function==10)
> Function=c("ree")
> if(Function==11)
> Function=c("hrz")
> if(Function==12)
> Function=c("wcs")
> if(Function==13)
> Function=c("p")
> if(Function==14)
> Function=c("vl")
> if(Function==15)
> Function=c("ls")
> if(Function==16)
> Function=c("b")
> if(Function==17)
> Function=c("icfoffp")
> if(Time==0)
> Time=c("h")
> if(Time==1)
> Time=c("m")
> if(Outp==0)
> Outp=c("r")
> if(Outp==1)
> Outp=c("c")
> if(Return_Base==0)
> Return_Base=c(TRUE)
> if(Return_Base==1)
> Return_Base=c(FALSE)
> if(Cognitive_Slope==0)
> Cognitive_Slopee=c(TRUE)
> if(Cognitive_Slope==1)
> Cognitive_Slope=c(FALSE)
>
> if(CL==0)
> CL=c(TRUE)
> if(CL==1)
> CL=c(FALSE)
>
> if(DL==0)
> DL=c(TRUE)
> if(DL==1)
> DL=c(FALSE)
> result<-movecost(dtm=DTM, origin=Origin, destin=Destination,
> funct=Function, time=Time, outp=Outp, move=Move,
> breaks=Breaks,return.base=Return_Base, cogn.slp=Cognitive_Slope,
> sl.crit=Critical_Slope,W=Walker_Body_Weight,L=Carried_Load_Weight,N=N,V=Speed,z=Zoom_Level,rb.lty=RL,cont.lab=CL,destin.lab=DL,cex.breaks=CB,cex.lcp.lab=CLL,
> export=TRUE)
>
> msgBox <- tkmessageBox(title = "Import Vector",
>                        message = "Import vector isolines .shp!", icon =
> "info", type = "ok")
> Output_Isoline=impShp()
> msgBox2 <- tkmessageBox(title = "Import Vector",
>                        message = "Import vector LCPs .shp!", icon =
> "info", type = "ok")
> Output_LCP=impShp()
> msgBox3 <- tkmessageBox(title = "Import Raster",
>                        message = "Import raster cost surface!", icon =
> "info", type = "ok")
> raster1<-impRst()
> raster1.sp <- as(raster1, "SpatialPixelsDataFrame") # Converting the
> RasterLayer object to a SpatialPixelsDataFrame object
> Output_Cost_Surface=raster1.sp
> msgBox4 <- tkmessageBox(title = "Import Raster",
>                        message = "Import raster accum cost surface !",
> icon = "info", type = "ok")
>
> raster2<-impRst()
> raster2.sp <- as(raster2, "SpatialPixelsDataFrame") # Converting the
> RasterLayer object to a SpatialPixelsDataFrame object
> Output_Accum_Cost_Surface=raster2.sp
>
> If some one has some tricks better, should very approciate.
>
> thanks
> E
>
> Il giorno gio 1 lug 2021 alle ore 11:07 Enzo Cocca <enzo.ccc at gmail.com>
> ha scritto:
>
>> Hi peoples,
>> I have a question:
>> In my r script I save (some raster and some vector file) in an a folder.
>> Is it a method to load my output into qgis?
>> I can't use output vector and output raster for some reason regarding the
>> R packages that I use.
>>
>> so this one is my script:
>>
>> ##load_vector_using_rgdal
>> ##load_raster_using_rgdal
>> ##movecost script=group
>> ##Movecost=name
>> ##DTM=raster
>> ##Origin=vector point
>> ##Destination=vector point
>> ##Move=number 8
>> ##Breaks=number 0.5
>> ##Function=selection
>> t;tofp;mp;icmonp;icmoffp;icfonp;ug;alb;gkrs;r;ree;hrz;wcs;p;vl;ls;b;icfoffp
>> ##Time=selection h;m
>> ##Outp=selection r;c
>> ##Return_Base=selection TRUE;FALSE
>> ##Cognitive_Slope=selection TRUE;FALSE
>> ##Critical_Slope=number 1
>> ##Walker_Body_Weight=number 70
>> ##Carried_Load_Weight=number 0
>> ##N=number 1
>> ##Speed=number 1
>> ##Zoom_Level=number 9
>> ##RL=number 2
>> ##CL=selection TRUE;FALSE
>> ##DL=selection TRUE;FALSE
>> ##CB=number 0.6
>> ##CLL=number 0.6
>> ##Output=output folder
>> ##showplots
>> setwd(Output)
>> library(sp)
>> library(movecost)
>> library(raster)
>> library(rgdal)
>> DTM<-raster(DTM)
>> if(Function==0)
>> Function=c("t")
>> if(Function==1)
>> Function=c("tofp")
>> if(Function==2)
>> Function=c("mp")
>> if(Function==3)
>> Function=c("icmonp")
>> if(Function==4)
>> Function=c("icmoffp")
>> if(Function==5)
>> Function=c("icfonp")
>> if(Function==6)
>> Function=c("ug")
>> if(Function==7)
>> Function=c("alb")
>> if(Function==8)
>> Function=c("gkrs")
>> if(Function==9)
>> Function=c("r")
>> if(Function==10)
>> Function=c("ree")
>> if(Function==11)
>> Function=c("hrz")
>> if(Function==12)
>> Function=c("wcs")
>> if(Function==13)
>> Function=c("p")
>> if(Function==14)
>> Function=c("vl")
>> if(Function==15)
>> Function=c("ls")
>> if(Function==16)
>> Function=c("b")
>> if(Function==17)
>> Function=c("icfoffp")
>> if(Time==0)
>> Time=c("h")
>> if(Time==1)
>> Time=c("m")
>> if(Outp==0)
>> Outp=c("r")
>> if(Outp==1)
>> Outp=c("c")
>> if(Return_Base==0)
>> Return_Base=c(TRUE)
>> if(Return_Base==1)
>> Return_Base=c(FALSE)
>> if(Cognitive_Slope==0)
>> Cognitive_Slopee=c(TRUE)
>> if(Cognitive_Slope==1)
>> Cognitive_Slope=c(FALSE)
>>
>> if(CL==0)
>> CL=c(TRUE)
>> if(CL==1)
>> CL=c(FALSE)
>>
>> if(DL==0)
>> DL=c(TRUE)
>> if(DL==1)
>> DL=c(FALSE)
>> result<-movecost(dtm=DTM, origin=Origin, destin=Destination,
>> funct=Function, time=Time, outp=Outp, move=Move,
>> breaks=Breaks,return.base=Return_Base, cogn.slp=Cognitive_Slope,
>> sl.crit=Critical_Slope,W=Walker_Body_Weight,L=Carried_Load_Weight,N=N,V=Speed,z=Zoom_Level,rb.lty=RL,cont.lab=CL,destin.lab=DL,cex.breaks=CB,cex.lcp.lab=CLL,
>> export=TRUE)
>>
>> thanks in advance
>>
>> E
>>
>>
>>
>> --
>> Enzo Cocca PhD
>> in "Science and Technology for Archaeology and Cultural Heritage"
>>
>> ISMEO
>> International Association of Mediterranean and Oriental Studies
>>
>>
>> mail: enzo.ccc at gmail.com
>> cell: +393495087014
>>
>>
>
> --
> Enzo Cocca PhD
> in "Science and Technology for Archaeology and Cultural Heritage"
>
> ISMEO
> International Association of Mediterranean and Oriental Studies
>
>
> mail: enzo.ccc at gmail.com
> cell: +393495087014
>
>

-- 
Enzo Cocca PhD
in "Science and Technology for Archaeology and Cultural Heritage"

ISMEO
International Association of Mediterranean and Oriental Studies


mail: enzo.ccc at gmail.com
cell: +393495087014
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210701/039b4133/attachment-0001.html>

From adenaculture at gmail.com  Thu Jul  1 17:36:03 2021
From: adenaculture at gmail.com (C Hamilton)
Date: Thu, 1 Jul 2021 20:36:03 -0400
Subject: [QGIS-Developer] Preview of the QGIS Earth, Sun, Moon,
 & Planets Plugin
In-Reply-To: <58717B7D-3101-483F-9A06-B39A7881C949@gmail.com>
References: <CAES-DZR3kcaVvVLDzf2WxwdM8JRWBPMAi0zXce9+b=9j6Ekt-A@mail.gmail.com>
 <58717B7D-3101-483F-9A06-B39A7881C949@gmail.com>
Message-ID: <CABPxTTrRgb3tcrsJgHNog63q7XU4W+YoERZJGfLun0CxSdR23A@mail.gmail.com>

Yes that could be done and is a good idea.

Best wishes,

Calvin

On Thu, Jul 1, 2021 at 8:15 PM Frank M. Howell <frankmhowell at gmail.com>
wrote:

> Calvin,
>
> I downloaded and installed it in Win 10 x64?will install on Linux Mint
> 20.2 this weekend.
>
> If this feature is already implemented, forgive my not yet noticing it.
> Would it be possible to take the earth et al data and write it to the
> attribute table at the date/time for each location in a table?
>
> For instance, I use RF beacon observations for Maidenhead Grid Squares
> using the centroid of each grid square. It would be very useful to use the
> date/time field from the attribute table to have the plugin retrieve the
> Sun?s location and save that back to the table in a new field, for each
> location in the table.
>
> Is this possible?
>
> Thanks,
>
> Frank
>
> On Jul 1, 2021, at 6:36 PM, Tim Sutton <tim at kartoza.com> wrote:
>
> ?
> Hey Calvin
>
> Testing here (after pip installing skyfield) on Fedora 34 and it works
> great! The only comment I would make is that it would be nice if the
> Sun/Lunar Info dock panel docked itself on start up rather than floating
> (which looks a bit messy).
>
> Looking forward to being able to animate this stuff with temporal
> controller one day!
>
> How did you make the day / night / twilight shadow layers you shared in a
> previous email?
>
> Regards
>
> Tim
>
>
>
> On Wed, Jun 30, 2021 at 6:50 PM C Hamilton <adenaculture at gmail.com> wrote:
>
>> I thought I would give you an alpha version of the QGIS Earth, Sun, Moon
>> & Planets plugin I am developing. This plugin requires QGIS 3.14 or more
>> recent. It is also rather large because it contains all the data needed to
>> run. If you are on windows and want to download a self contained windows
>> plugin use this link to download:
>>
>>
>>  earthsunmoon-alpha-windows.zip
>> <https://drive.google.com/file/d/1Pld4yIxBTTHA0FBwPbaUw_qfrIhHTawA/view?usp=drive_web>
>>
>> If you are using some other OS, use this link, but before you install it
>> open up your OSGeo4W console and run "pip install skyfield'. If this is not
>> the proper command for your OS then adjust it to how you install a python
>> package. In the OSGeo4W shell you may need to run py3_env first. If py3_env
>> gives an error then it is not needed.
>>
>>
>>  earthsunmoon-alpha.zip
>> <https://drive.google.com/file/d/1kJammSDWRTk7659Ncp3qAnNMQLggZ4Ks/view?usp=drive_web>
>>
>> There are 3 processing routines that can be used to display the 1) sun,
>> 2) moon, 3) planets showing their position directly overhead at a
>> particular date and time and will look something like this:
>>
>> <image.png>
>>
>>
>> There is also another window that displays all kinds of earth and moon
>> data for a particular location when you click on the "Solar/lunar
>> information" dialog box that can be found in "Plugins->Earth, sun, moon, &
>> plants." There is a green plus sign in the dialog box. Click on it and then
>> click anywhere on the map to capture the coordinate to display solar and
>> lunar information.
>>
>> If you need help to manually install this plugin let me know.
>>
>> I have not included the day/night terminator algorithm yet because there
>> is a bug in it. Let me know what you think and if you have any suggestions.
>>
>> Thanks,
>>
>> Calvin
>>
>
>
> --
>
> ------------------------------------------------------------------------------------------
> ?
>
> Tim Sutton
> Visit http://kartoza.com to find out about open source:
>  * Desktop GIS programming services
>  * Geospatial web development
> * GIS Training
> * Consulting Services
> Tim is a member of the QGIS Project Steering Committee
>
> -------------------------------------------------------------------------------------------
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210701/b7e46f44/attachment.html>

From ziebarth at gfz-potsdam.de  Fri Jul  2 09:28:54 2021
From: ziebarth at gfz-potsdam.de (Malte Ziebarth)
Date: Fri, 2 Jul 2021 18:28:54 +0200
Subject: [QGIS-Developer] PyQGIS Cookbook License
Message-ID: <2a83e509-eed1-4b6c-5474-dafe08cab1b7@gfz-potsdam.de>

Dear all,

first off, thank you all for all the great work that went into QGIS!

I am currently writing a Python plugin that I intend to make publicly
available in the plugin repository. I started developing the plugin by
adapting the examples from the PyQGIS Cookbook, specifically this page:

https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/plugins/plugins.html#writing-a-plugin

Now the problem that I encountered with that is the license of the skeleton
code (i.e. __init__.py and mainPlugin.py). The code does not actually 
contain
a license header and the documentation page itself contains only the
very general copyright information

"? Copyright 2002-now, QGIS project. Last updated on Jul 02, 2021 09:02."

with no further licensing information.

I guess that the intention of this part of documentation is for people to
have an easy start developing plugins which can then be contributed back
to the community under GPL license. This is just what I am planning to
do. However, trying to put this into a correct license header is currently
giving me a bit of a headache.

Maybe someone here in this mailing list has some advice about this issue,
and maybe even the person/people who wrote this piece of code can clarify?
Any help would be greatly appreciated!

Kind regards
Malte Ziebarth

-- 
Malte J. Ziebarth
Section 2.6
Tel.: +49 (0)331/288-28634
E-Mail: ziebarth at gfz-potsdam.de
___________________________________

Helmholtz-Zentrum Potsdam
Deutsches GeoForschungsZentrum GFZ
Stiftung des ?ff. Rechts Land Brandenburg
Telegrafenberg, 14473 Potsdam

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210702/b6000e65/attachment.html>

From senhor.neto at gmail.com  Sat Jul  3 14:35:10 2021
From: senhor.neto at gmail.com (Alexandre Neto)
Date: Sat, 3 Jul 2021 22:35:10 +0100
Subject: [QGIS-Developer] PyQGIS Cookbook License
In-Reply-To: <2a83e509-eed1-4b6c-5474-dafe08cab1b7@gfz-potsdam.de>
References: <2a83e509-eed1-4b6c-5474-dafe08cab1b7@gfz-potsdam.de>
Message-ID: <CA+H0G_HUoA-+WV0fSQkWXUFOpOrXBREaDSWY=YCeXcG23=GNXA@mail.gmail.com>

Hi,

Although I think you can safely use and replicate any part of the
documentation, including code snippets, I think you spotted an important
issue.

I do believe we should add a licence to all our documentation. Maybe a
creative commons license.

I have included the PSC mailing list in this reply, maybe they already have
a position about this subject.

Alexandre Neto


A sexta, 2/07/2021, 18:30, Malte Ziebarth <ziebarth at gfz-potsdam.de>
escreveu:

> Dear all,
>
> first off, thank you all for all the great work that went into QGIS!
>
> I am currently writing a Python plugin that I intend to make publicly
> available in the plugin repository. I started developing the plugin by
> adapting the examples from the PyQGIS Cookbook, specifically this page:
>
>
> https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/plugins/plugins.html#writing-a-plugin
>
> Now the problem that I encountered with that is the license of the skeleton
> code (i.e. __init__.py and mainPlugin.py). The code does not actually
> contain
> a license header and the documentation page itself contains only the
> very general copyright information
>
> "? Copyright 2002-now, QGIS project. Last updated on Jul 02, 2021 09:02."
>
> with no further licensing information.
>
> I guess that the intention of this part of documentation is for people to
> have an easy start developing plugins which can then be contributed back
> to the community under GPL license. This is just what I am planning to
> do. However, trying to put this into a correct license header is currently
> giving me a bit of a headache.
>
> Maybe someone here in this mailing list has some advice about this issue,
> and maybe even the person/people who wrote this piece of code can clarify?
> Any help would be greatly appreciated!
>
> Kind regards
> Malte Ziebarth
>
> --
> Malte J. Ziebarth
> Section 2.6
> Tel.: +49 (0)331/288-28634
> E-Mail: ziebarth at gfz-potsdam.de
> ___________________________________
>
> Helmholtz-Zentrum Potsdam
> Deutsches GeoForschungsZentrum GFZ
> Stiftung des ?ff. Rechts Land Brandenburg
> Telegrafenberg, 14473 Potsdam
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210703/64022d04/attachment.html>

From jfolgado94 at gmail.com  Mon Jul  5 09:03:00 2021
From: jfolgado94 at gmail.com (Joao Folgado)
Date: Mon, 5 Jul 2021 17:03:00 +0100
Subject: [QGIS-Developer] =?utf-8?q?tkinter_didn=E2=80=99t_work?=
Message-ID: <CAA7KAT=_EGLzOYYZEyGtaMAs818Tdg_7W34bAmErsKZt+jxiAA@mail.gmail.com>

Hi Qgis Developers !

In a plugin I tried to use a if statement that while ask something to the
user.
My ideia is to us tkinter but the library did not exist.

Do any one know who to use Tkinter in Qgis plugin ?

Best Regards,
Jo?o Folgado
-- 
JO?O FOLGADO
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210705/4dd437e8/attachment.html>

From bo.victor.thomsen at gmail.com  Tue Jul  6 00:18:37 2021
From: bo.victor.thomsen at gmail.com (Bo Victor Thomsen)
Date: Tue, 6 Jul 2021 09:18:37 +0200
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
Message-ID: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>

To the list -

Is there a method to use OS (Linux, Windows...) environment variables in 
the QGIS.ini setup file ?

I had a number of customers asking for a method to "generalize" 
QGIS.ini, so it doesn't contain any "user" specific file and directory 
references, i.e

(From qgis.ini)

Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor 
Thomsen\\AppData\\Roaming*\\QGIS\\QGIS3\\profiles\\default\\processing\\models
Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor 
Thomsen\\AppData\\Roaming*\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts

could be:

Configuration\MODELS_FOLDER=*%APPDATA%*\\QGIS\\QGIS3\\profiles\\default\\processing\\models
Configuration\SCRIPTS_FOLDERS=*%APPDATA%*\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts

or likewise.

The ultimate reason is to have a method to distribute a "standard" setup 
for QGIS, complete with plugins and specialized setup parameters. This 
can be done by making a standard QGIS installation (which the IT 
departments love, especially with the new .msi package) and afterwards 
replace the "default" profile directory with at? directory specific for 
the organisation. However, the process of making the new profile will 
place a lot of file/directory references in QGIS.ini that is specific 
for the super-user developing the new profile.

-- 
Med venlig hilsen / Kind regards

Bo Victor Thomsen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210706/6f81a9fe/attachment.html>

From marco at qgis.org  Tue Jul  6 09:27:21 2021
From: marco at qgis.org (Marco Bernasocchi)
Date: Tue, 6 Jul 2021 18:27:21 +0200
Subject: [QGIS-Developer] Python Cookbook license
Message-ID: <CAB2ZMRC+jHPa4Bh-2nnMWaBxJ8NNwCFsjAfMREjRY+8mKEYc4g@mail.gmail.com>

Dear community,
Our Python Cookbook [1] doesn?t have a license and this can be confusing
for users.
After discussing and analysing the existing licenses at today's PSC, we
agreed to put the Cookbook under the GNU Free Documentation License.

This license is already used for the User guide [4] and the Gentle
Introduction to GIS [3].

Even Though the cookbook has a lot of code, we decided to license it under
a documentation license and not a software license, since the code is
mostly for documentation purposes and are considered "trivial code":
?If your document contains non-trivial examples of program code, we
recommend releasing these examples in parallel under your choice of free
software license, such as the GNU General Public License, to permit their
use in free software.?

If you have any question or issue with the above license being added to the
Python Cookbook, please let us know before August 3rd 17:00 (CET) so we can
discuss the issue at the next PSC.


If no issues arise, wel add the license after the next PSC meeting.


Cheers

Marco


[1] https://docs.qgis.org/3.20/en/docs/pyqgis_developer_cookbook/
<https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/>
[2] https://www.gnu.org/licenses/fdl-1.3.en.html

[3]
https://docs.qgis.org/3.20/en/docs/gentle_gis_introduction/gnu_free_documentation_license.html
<https://docs.qgis.org/3.16/en/docs/gentle_gis_introduction/gnu_free_documentation_license.html>


[4] https://docs.qgis.org/3.20/en/docs/user_manual/appendices/GNU_FDL.html
<https://docs.qgis.org/3.16/en/docs/user_manual/appendices/GNU_FDL.html>
-- 
Marco Bernasocchi

QGIS.org Chair
OPENGIS.ch CEO
http://berna.io
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210706/91d81178/attachment.html>

From charles at kartoza.com  Tue Jul  6 15:32:11 2021
From: charles at kartoza.com (Charles Dixon-Paver)
Date: Wed, 7 Jul 2021 00:32:11 +0200
Subject: [QGIS-Developer] [Qgis-user] Missing plugins in version 3.20
In-Reply-To: <CAJdnw=g6kQAwq4mTQkPwuVD8K_r32YJB7=ydXiGNc0V1qG_tAw@mail.gmail.com>
References: <CAJdnw=jxLHVK7-foBGz8xTQwpipGe_FpfA2f8TWx66H2Mz77DQ@mail.gmail.com>
 <CAK2KqifSND6u04vBMV3VRbtP7dhiKiypPN+D8eW=J-AEzyu=2w@mail.gmail.com>
 <CAJdnw=jyWNpmSKrH-=tQMkKJxfrmaZvzLHPm9tgS4OvGxMW3jA@mail.gmail.com>
 <CAK2KqicLBsSrL2vY8S8QjHt7btMsvHhiAG=+7FMLhzYdZOKxDg@mail.gmail.com>
 <CAJdnw=g6kQAwq4mTQkPwuVD8K_r32YJB7=ydXiGNc0V1qG_tAw@mail.gmail.com>
Message-ID: <CAK2KqifreuLGRAN9heyW4TCu79_iFhzROq8-tQy056pWD8HjSA@mail.gmail.com>

It may well be the issue, although not one I was aware of. I am unsure if
the volunteers and developer handling packing and distribution have the
resources to test Windows 7. I have copied the developer list so hopefully
someone else can provide insight.


On Wed, 07 Jul 2021, 00:27 Pat Brown, <mistyhaven at gmail.com> wrote:

> I have always used the standalone installer. I see that there is a note
> saying that WIN 7 no longer works but as this is mentioned under the
> OSGeo4W installer I thought it only applied to that. Am I wrong in this
> assumption? I am still using WIN 7 and all version 3.x have worked fine so
> far. Do think that WIN 7 could be my problem?
>
> On Tue, Jul 6, 2021, 23:58 Charles Dixon-Paver <charles at kartoza.com>
> wrote:
>
>> It seems that QGIS 3.20 is unable to access python correctly. It is
>> possible that this is an ENV/ Path error that may be resolved by launching
>> QGIS from a relevant batch file, such as C:\OSGeo4W\bin\qgis.bat (or
>> similar depending on your installation configuration)
>>
>> Are you using the "new" OSGeo4W installer? If not and you attempted to
>> upgrade from the old installer it could be causing the issue.
>>
>> There was an update to OSGeo4W for the latest release that is not really
>> backwards compatible. The current recommendation is to uninstall QGIS/
>> remove the historic OSGeo4W installation directory (or rename it), download
>> the latest installer from QGIS.org [1] and install a new instance of QGIS
>> from there.
>>
>> If you are using the LTR (stable release), then using the existing
>> installer to upgrade should be fine, but you likely won't be able to use
>> 3.20 correctly. There is more information on the downloads page related to
>> this.
>>
>> [1] https://www.qgis.org/en/site/forusers/download.html
>>
>>
>> On Tue, 6 Jul 2021 at 23:17, Pat Brown <mistyhaven at gmail.com> wrote:
>>
>>> Hi Charles,
>>>    Tried with a new user profile and I get the same result. The attached
>>> pics show what is displayed at each tab of the plugin manager
>>>
>>> On Tue, 6 Jul 2021 at 22:55, Charles Dixon-Paver <charles at kartoza.com>
>>> wrote:
>>>
>>>> Hi there,
>>>>
>>>> Have you tried to access the plugins with a fresh user profile?
>>>>
>>>> Also, the plugins manager has a settings tab. Can you give some more
>>>> information on the current configuration settings, such as the configured
>>>> plugin repository URL?
>>>>
>>>> On Tue, 6 Jul 2021 at 22:49, Pat Brown <mistyhaven at gmail.com> wrote:
>>>>
>>>>> Hi
>>>>>     I asked this a few days ago and I am wondering if perhaps no-one
>>>>> else has come across this problem.
>>>>> "I have installed the above version but it only shows 4 plug-ins.
>>>>> Whether I click on ALL or INSTALLED it still only shows 4. If I go back to
>>>>> 3.18 it works fine. Can anybody suggest a possible solution?"
>>>>> I uninstalled all versions on my PC and reinstalled 3.20 but still
>>>>> have the same problem. I then uninstalled 3.20 and reinstalled 3.18 and the
>>>>> plugins work fine.
>>>>> Is there maybe a way to contact the developers to see if I can find a
>>>>> cause of my problem?
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Pat
>>>>> _______________________________________________
>>>>> Qgis-user mailing list
>>>>> Qgis-user at lists.osgeo.org
>>>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-user
>>>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-user
>>>>>
>>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210707/911468ed/attachment.html>

From a.neumann at carto.net  Thu Jul  8 01:30:08 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Thu, 08 Jul 2021 10:30:08 +0200
Subject: [QGIS-Developer] Question on @atlas_featureid
Message-ID: <68b4d97118bb679c22cd7d4c90048f52@carto.net>

Hi,

I haven't worked on an Atlas for a while, now again in QGIS 3.16.

I was surprised to see that @atlas_featureid is not equal to the primary 
key of the atlas coverage layer.

Is this expected or a bug? I know, I can access the primary key through 
attribute(@atlas_feature,'pkey_name'), but it is a little more 
complicated than @atlas_featureid - and I'm pretty sure that 
@atlas_featureid was using the pkey column in th past?

My data source for the atlas coverage layer is a Postgis View.

Thanks if you have any info on this issue,

Andreas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/fa6008ad/attachment.html>

From jef at norbit.de  Thu Jul  8 01:42:28 2021
From: jef at norbit.de (=?utf-8?Q?J=C3=BCrgen_E=2E?= Fischer)
Date: Thu, 8 Jul 2021 10:42:28 +0200
Subject: [QGIS-Developer] Question on @atlas_featureid
In-Reply-To: <68b4d97118bb679c22cd7d4c90048f52@carto.net>
References: <68b4d97118bb679c22cd7d4c90048f52@carto.net>
Message-ID: <20210708084228.nzrxdxiszgsajah5@norbit.de>

Hi Andreas,

On Thu, 08. Jul 2021 at 10:30:08 +0200, Andreas Neumann wrote:
> attribute(@atlas_feature,'pkey_name'), but it is a little more complicated
> than @atlas_featureid - and I'm pretty sure that @atlas_featureid was using
> the pkey column in th past?
> 
> My data source for the atlas coverage layer is a Postgis View.

It's probably not using the column you expect for the feature id.  Did you
specify the key column when adding the view?


J?rgen

-- 
J?rgen E. Fischer           norBIT GmbH             Tel. +49-4931-918175-31
Dipl.-Inf. (FH)             Rheinstra?e 13          Fax. +49-4931-918175-50
Software Engineer           D-26506 Norden            https://www.norbit.de
QGIS release manager (PSC)  Germany                 IRC: jef on Libera|OFTC
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 827 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/858985f5/attachment.sig>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Pflichtangaben
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/858985f5/attachment.ksh>

From andreas at qgis.org  Thu Jul  8 02:34:37 2021
From: andreas at qgis.org (Andreas Neumann)
Date: Thu, 8 Jul 2021 11:34:37 +0200
Subject: [QGIS-Developer] Question on @atlas_featureid
In-Reply-To: <20210708084228.nzrxdxiszgsajah5@norbit.de>
References: <68b4d97118bb679c22cd7d4c90048f52@carto.net>
 <20210708084228.nzrxdxiszgsajah5@norbit.de>
Message-ID: <CAB2Z92DRD279pLy36EfgL5MiKaX7W-H0bKSUiAAbb+Q+KZC5OQ@mail.gmail.com>

HI J?rgen,

Yes - I provided the primary key column

Here is my data source string:

service='edit' authcfg=sogis00 key='t_id' srid=2056 type=Polygon
checkPrimaryKeyUnicity='1'
table="alw_strukturverbesserungen"."projekt_aggregiert_v"
(geometrie_convex_hull) sql=geometrie_bbox IS NOT NULL

@atlas_featureid returns something like an internal "row number" or
similar, but not the column "t_id" as defined in the data source string.

Andreas

On Thu, 8 Jul 2021 at 10:42, J?rgen E. Fischer <jef at norbit.de> wrote:

> Hi Andreas,
>
> On Thu, 08. Jul 2021 at 10:30:08 +0200, Andreas Neumann wrote:
> > attribute(@atlas_feature,'pkey_name'), but it is a little more
> complicated
> > than @atlas_featureid - and I'm pretty sure that @atlas_featureid was
> using
> > the pkey column in th past?
> >
> > My data source for the atlas coverage layer is a Postgis View.
>
> It's probably not using the column you expect for the feature id.  Did you
> specify the key column when adding the view?
>
>
> J?rgen
>
> --
> J?rgen E. Fischer           norBIT GmbH             Tel. +49-4931-918175-31
> Dipl.-Inf. (FH)             Rheinstra?e 13          Fax. +49-4931-918175-50
> Software Engineer           D-26506 Norden
> https://www.norbit.de
> QGIS release manager (PSC)  Germany                 IRC: jef on Libera|OFTC
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>


-- 

--
Andreas Neumann
QGIS.ORG board member (treasurer)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/08571078/attachment.html>

From senhor.neto at gmail.com  Thu Jul  8 02:43:31 2021
From: senhor.neto at gmail.com (Alexandre Neto)
Date: Thu, 8 Jul 2021 10:43:31 +0100
Subject: [QGIS-Developer] Question on @atlas_featureid
In-Reply-To: <CAB2Z92DRD279pLy36EfgL5MiKaX7W-H0bKSUiAAbb+Q+KZC5OQ@mail.gmail.com>
References: <68b4d97118bb679c22cd7d4c90048f52@carto.net>
 <20210708084228.nzrxdxiszgsajah5@norbit.de>
 <CAB2Z92DRD279pLy36EfgL5MiKaX7W-H0bKSUiAAbb+Q+KZC5OQ@mail.gmail.com>
Message-ID: <CA+H0G_HUJNkjama+ytprC327pUPX7=jiwit6dQyf-x3FX6B9fw@mail.gmail.com>

As far as I remember @atlas_featureid has always returned the same as the
$id in the attributes table, which is kind of the internal row number.

Alex

A quinta, 8/07/2021, 10:35, Andreas Neumann <andreas at qgis.org> escreveu:

> HI J?rgen,
>
> Yes - I provided the primary key column
>
> Here is my data source string:
>
> service='edit' authcfg=sogis00 key='t_id' srid=2056 type=Polygon
> checkPrimaryKeyUnicity='1'
> table="alw_strukturverbesserungen"."projekt_aggregiert_v"
> (geometrie_convex_hull) sql=geometrie_bbox IS NOT NULL
>
> @atlas_featureid returns something like an internal "row number" or
> similar, but not the column "t_id" as defined in the data source string.
>
> Andreas
>
> On Thu, 8 Jul 2021 at 10:42, J?rgen E. Fischer <jef at norbit.de> wrote:
>
>> Hi Andreas,
>>
>> On Thu, 08. Jul 2021 at 10:30:08 +0200, Andreas Neumann wrote:
>> > attribute(@atlas_feature,'pkey_name'), but it is a little more
>> complicated
>> > than @atlas_featureid - and I'm pretty sure that @atlas_featureid was
>> using
>> > the pkey column in th past?
>> >
>> > My data source for the atlas coverage layer is a Postgis View.
>>
>> It's probably not using the column you expect for the feature id.  Did you
>> specify the key column when adding the view?
>>
>>
>> J?rgen
>>
>> --
>> J?rgen E. Fischer           norBIT GmbH             Tel.
>> +49-4931-918175-31
>> Dipl.-Inf. (FH)             Rheinstra?e 13          Fax.
>> +49-4931-918175-50
>> Software Engineer           D-26506 Norden
>> https://www.norbit.de
>> QGIS release manager (PSC)  Germany                 IRC: jef on
>> Libera|OFTC
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
>
>
> --
>
> --
> Andreas Neumann
> QGIS.ORG board member (treasurer)
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/40090b24/attachment.html>

From andreas at qgis.org  Thu Jul  8 02:50:34 2021
From: andreas at qgis.org (Andreas Neumann)
Date: Thu, 8 Jul 2021 11:50:34 +0200
Subject: [QGIS-Developer] Question on @atlas_featureid
In-Reply-To: <CA+H0G_HUJNkjama+ytprC327pUPX7=jiwit6dQyf-x3FX6B9fw@mail.gmail.com>
References: <68b4d97118bb679c22cd7d4c90048f52@carto.net>
 <20210708084228.nzrxdxiszgsajah5@norbit.de>
 <CAB2Z92DRD279pLy36EfgL5MiKaX7W-H0bKSUiAAbb+Q+KZC5OQ@mail.gmail.com>
 <CA+H0G_HUJNkjama+ytprC327pUPX7=jiwit6dQyf-x3FX6B9fw@mail.gmail.com>
Message-ID: <CAB2Z92BA6r+duCUSeVZa_4HH0MGha4Urnm0N34h43Zoc-0zJaA@mail.gmail.com>

Ok - that explains it.

It is quite confusing that QGIS uses a different internal ID than the
primary key column of the database. Is there a technical reason for this
behaviour?

Andreas



On Thu, 8 Jul 2021 at 11:43, Alexandre Neto <senhor.neto at gmail.com> wrote:

> As far as I remember @atlas_featureid has always returned the same as the
> $id in the attributes table, which is kind of the internal row number.
>
> Alex
>
> A quinta, 8/07/2021, 10:35, Andreas Neumann <andreas at qgis.org> escreveu:
>
>> HI J?rgen,
>>
>> Yes - I provided the primary key column
>>
>> Here is my data source string:
>>
>> service='edit' authcfg=sogis00 key='t_id' srid=2056 type=Polygon
>> checkPrimaryKeyUnicity='1'
>> table="alw_strukturverbesserungen"."projekt_aggregiert_v"
>> (geometrie_convex_hull) sql=geometrie_bbox IS NOT NULL
>>
>> @atlas_featureid returns something like an internal "row number" or
>> similar, but not the column "t_id" as defined in the data source string.
>>
>> Andreas
>>
>> On Thu, 8 Jul 2021 at 10:42, J?rgen E. Fischer <jef at norbit.de> wrote:
>>
>>> Hi Andreas,
>>>
>>> On Thu, 08. Jul 2021 at 10:30:08 +0200, Andreas Neumann wrote:
>>> > attribute(@atlas_feature,'pkey_name'), but it is a little more
>>> complicated
>>> > than @atlas_featureid - and I'm pretty sure that @atlas_featureid was
>>> using
>>> > the pkey column in th past?
>>> >
>>> > My data source for the atlas coverage layer is a Postgis View.
>>>
>>> It's probably not using the column you expect for the feature id.  Did
>>> you
>>> specify the key column when adding the view?
>>>
>>>
>>> J?rgen
>>>
>>> --
>>> J?rgen E. Fischer           norBIT GmbH             Tel.
>>> +49-4931-918175-31
>>> Dipl.-Inf. (FH)             Rheinstra?e 13          Fax.
>>> +49-4931-918175-50
>>> Software Engineer           D-26506 Norden
>>> https://www.norbit.de
>>> QGIS release manager (PSC)  Germany                 IRC: jef on
>>> Libera|OFTC
>>> _______________________________________________
>>> QGIS-Developer mailing list
>>> QGIS-Developer at lists.osgeo.org
>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>
>>
>>
>> --
>>
>> --
>> Andreas Neumann
>> QGIS.ORG board member (treasurer)
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
>

-- 

--
Andreas Neumann
QGIS.ORG board member (treasurer)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/9e622aef/attachment-0001.html>

From tim at kartoza.com  Thu Jul  8 04:09:55 2021
From: tim at kartoza.com (Tim Sutton)
Date: Thu, 8 Jul 2021 12:09:55 +0100
Subject: [QGIS-Developer] Build failure in master
Message-ID: <CAES-DZRZ4C=ShtiU1=N8CaC+Q_rSTMGt8XCbHE8Qf3JO4OpxzQ@mail.gmail.com>

Hi All

Just updated to master and getting a build error:


Consolidate compiler generated dependencies of target
python_module_qgis__analysis
[ 68%] Linking CXX shared module ../output/python/qgis/_analysis.so
/usr/bin/ld:
CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart13.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart13.cpp:138:
multiple definition of `sipTypeDef__analysis_QgsAnalysis';
CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart12.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart12.cpp:1812:
first defined here
collect2: error: ld returned 1 exit status
gmake[2]: ***
[python/CMakeFiles/python_module_qgis__analysis.dir/build.make:1101:
output/python/qgis/_analysis.so] Error 1
gmake[1]: *** [CMakeFiles/Makefile2:6919:
python/CMakeFiles/python_module_qgis__analysis.dir/all] Error 2
gmake[1]: *** Waiting for unfinished jobs....
Consolidate compiler generated dependencies of target qgis_gui
[ 78%] Built target qgis_gui
gmake: *** [Makefile:166: all] Error 2
12:03:00: The process "/usr/bin/cmake" exited with code 2.
Error while building/deploying project qgis (kit: Qt 5.15.2 (qt5))
When executing step "Build"


Is it because of the new exif alg maybe?

Regards

Tim


-- 
------------------------------------------------------------------------------------------

Tim Sutton
Visit http://kartoza.com to find out about open source:
 * Desktop GIS programming services
 * Geospatial web development
* GIS Training
* Consulting Services
Tim is a member of the QGIS Project Steering Committee
-------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/77392d88/attachment.html>

From werner.macho at gmail.com  Thu Jul  8 05:01:31 2021
From: werner.macho at gmail.com (Werner Macho)
Date: Thu, 8 Jul 2021 14:01:31 +0200
Subject: [QGIS-Developer] Build failure in master
In-Reply-To: <CAES-DZRZ4C=ShtiU1=N8CaC+Q_rSTMGt8XCbHE8Qf3JO4OpxzQ@mail.gmail.com>
References: <CAES-DZRZ4C=ShtiU1=N8CaC+Q_rSTMGt8XCbHE8Qf3JO4OpxzQ@mail.gmail.com>
Message-ID: <CA+3oMjsktQUHqePu24sW15uePJwPar+g6TSyTywnOvs6XmkmQg@mail.gmail.com>

Hi Tim,

Just updated master and also tried to build with no errors whatsoever.
(Using ninja and ccache)

Maybe try a clean build?

regards
Werner

On Thu, Jul 8, 2021 at 1:10 PM Tim Sutton <tim at kartoza.com> wrote:

> Hi All
>
> Just updated to master and getting a build error:
>
>
> Consolidate compiler generated dependencies of target
> python_module_qgis__analysis
> [ 68%] Linking CXX shared module ../output/python/qgis/_analysis.so
> /usr/bin/ld:
> CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart13.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart13.cpp:138:
> multiple definition of `sipTypeDef__analysis_QgsAnalysis';
> CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart12.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart12.cpp:1812:
> first defined here
> collect2: error: ld returned 1 exit status
> gmake[2]: ***
> [python/CMakeFiles/python_module_qgis__analysis.dir/build.make:1101:
> output/python/qgis/_analysis.so] Error 1
> gmake[1]: *** [CMakeFiles/Makefile2:6919:
> python/CMakeFiles/python_module_qgis__analysis.dir/all] Error 2
> gmake[1]: *** Waiting for unfinished jobs....
> Consolidate compiler generated dependencies of target qgis_gui
> [ 78%] Built target qgis_gui
> gmake: *** [Makefile:166: all] Error 2
> 12:03:00: The process "/usr/bin/cmake" exited with code 2.
> Error while building/deploying project qgis (kit: Qt 5.15.2 (qt5))
> When executing step "Build"
>
>
> Is it because of the new exif alg maybe?
>
> Regards
>
> Tim
>
>
> --
>
> ------------------------------------------------------------------------------------------
>
> Tim Sutton
> Visit http://kartoza.com to find out about open source:
>  * Desktop GIS programming services
>  * Geospatial web development
> * GIS Training
> * Consulting Services
> Tim is a member of the QGIS Project Steering Committee
>
> -------------------------------------------------------------------------------------------
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/d0fead44/attachment.html>

From tim at kartoza.com  Thu Jul  8 13:59:54 2021
From: tim at kartoza.com (Tim Sutton)
Date: Thu, 8 Jul 2021 21:59:54 +0100
Subject: [QGIS-Developer] Build failure in master
In-Reply-To: <CA+3oMjsktQUHqePu24sW15uePJwPar+g6TSyTywnOvs6XmkmQg@mail.gmail.com>
References: <CAES-DZRZ4C=ShtiU1=N8CaC+Q_rSTMGt8XCbHE8Qf3JO4OpxzQ@mail.gmail.com>
 <CA+3oMjsktQUHqePu24sW15uePJwPar+g6TSyTywnOvs6XmkmQg@mail.gmail.com>
Message-ID: <CAES-DZRqaSxt9cQrF8BDwnf=jaA1MZX6Fi5YUey=Cj=QXb5sbw@mail.gmail.com>

Thanks for testing Werner. A few others on Telegram also reported that
things are building fine for them. I will try doing  clean build tomorrow,
thanks!

Regards

Tim

On Thu, Jul 8, 2021 at 1:01 PM Werner Macho <werner.macho at gmail.com> wrote:

> Hi Tim,
>
> Just updated master and also tried to build with no errors whatsoever.
> (Using ninja and ccache)
>
> Maybe try a clean build?
>
> regards
> Werner
>
> On Thu, Jul 8, 2021 at 1:10 PM Tim Sutton <tim at kartoza.com> wrote:
>
>> Hi All
>>
>> Just updated to master and getting a build error:
>>
>>
>> Consolidate compiler generated dependencies of target
>> python_module_qgis__analysis
>> [ 68%] Linking CXX shared module ../output/python/qgis/_analysis.so
>> /usr/bin/ld:
>> CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart13.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart13.cpp:138:
>> multiple definition of `sipTypeDef__analysis_QgsAnalysis';
>> CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart12.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart12.cpp:1812:
>> first defined here
>> collect2: error: ld returned 1 exit status
>> gmake[2]: ***
>> [python/CMakeFiles/python_module_qgis__analysis.dir/build.make:1101:
>> output/python/qgis/_analysis.so] Error 1
>> gmake[1]: *** [CMakeFiles/Makefile2:6919:
>> python/CMakeFiles/python_module_qgis__analysis.dir/all] Error 2
>> gmake[1]: *** Waiting for unfinished jobs....
>> Consolidate compiler generated dependencies of target qgis_gui
>> [ 78%] Built target qgis_gui
>> gmake: *** [Makefile:166: all] Error 2
>> 12:03:00: The process "/usr/bin/cmake" exited with code 2.
>> Error while building/deploying project qgis (kit: Qt 5.15.2 (qt5))
>> When executing step "Build"
>>
>>
>> Is it because of the new exif alg maybe?
>>
>> Regards
>>
>> Tim
>>
>>
>> --
>>
>> ------------------------------------------------------------------------------------------
>>
>> Tim Sutton
>> Visit http://kartoza.com to find out about open source:
>>  * Desktop GIS programming services
>>  * Geospatial web development
>> * GIS Training
>> * Consulting Services
>> Tim is a member of the QGIS Project Steering Committee
>>
>> -------------------------------------------------------------------------------------------
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
>

-- 
------------------------------------------------------------------------------------------
?

Tim Sutton
Visit http://kartoza.com to find out about open source:
 * Desktop GIS programming services
 * Geospatial web development
* GIS Training
* Consulting Services
Tim is a member of the QGIS Project Steering Committee
-------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210708/b589361f/attachment.html>

From telwertowski at comcast.net  Thu Jul  8 15:37:33 2021
From: telwertowski at comcast.net (Tom Elwertowski)
Date: Thu, 8 Jul 2021 18:37:33 -0400
Subject: [QGIS-Developer] Build failure in master
In-Reply-To: <CAES-DZRqaSxt9cQrF8BDwnf=jaA1MZX6Fi5YUey=Cj=QXb5sbw@mail.gmail.com>
References: <CAES-DZRZ4C=ShtiU1=N8CaC+Q_rSTMGt8XCbHE8Qf3JO4OpxzQ@mail.gmail.com>
 <CA+3oMjsktQUHqePu24sW15uePJwPar+g6TSyTywnOvs6XmkmQg@mail.gmail.com>
 <CAES-DZRqaSxt9cQrF8BDwnf=jaA1MZX6Fi5YUey=Cj=QXb5sbw@mail.gmail.com>
Message-ID: <7630047b-2959-f051-705f-974c516d85b8@comcast.net>

Try deleting everything in the {build}/python/analysis folder. Just 
deleting the generated *.cpp files isn't enough.

I have been seeing a multiple definition sip_{module}part{n} 
sip_{module}part{n+1} error about once every three months for awhile. 
Deleting everything in {build}/python/{module} allows the build to be 
resumed (macOS Catalina).

Tom


On 7/8/21 4:59 PM, Tim Sutton wrote:
> Thanks for testing Werner. A few others on Telegram also reported that 
> things are building fine for them. I will try doing? clean build 
> tomorrow, thanks!
> 
> Regards
> 
> Tim
> 
> On Thu, Jul 8, 2021 at 1:01 PM Werner Macho <werner.macho at gmail.com 
> <mailto:werner.macho at gmail.com>> wrote:
> 
>     Hi Tim,
> 
>     Just updated master and also tried to build with no errors whatsoever.
>     (Using ninja and ccache)
> 
>     Maybe try a clean build?
> 
>     regards
>     Werner
> 
>     On Thu, Jul 8, 2021 at 1:10 PM Tim Sutton <tim at kartoza.com
>     <mailto:tim at kartoza.com>> wrote:
> 
>         Hi All
> 
>         Just updated to master and getting a build error:
> 
> 
>         Consolidate compiler generated dependencies of target
>         python_module_qgis__analysis
>         [ 68%] Linking CXX shared module ../output/python/qgis/_analysis.so
>         /usr/bin/ld:
>         CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart13.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart13.cpp:138:
>         multiple definition of `sipTypeDef__analysis_QgsAnalysis';
>         CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart12.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart12.cpp:1812:
>         first defined here
>         collect2: error: ld returned 1 exit status
>         gmake[2]: ***
>         [python/CMakeFiles/python_module_qgis__analysis.dir/build.make:1101:
>         output/python/qgis/_analysis.so] Error 1
>         gmake[1]: *** [CMakeFiles/Makefile2:6919:
>         python/CMakeFiles/python_module_qgis__analysis.dir/all] Error 2
>         gmake[1]: *** Waiting for unfinished jobs....
>         Consolidate compiler generated dependencies of target qgis_gui
>         [ 78%] Built target qgis_gui
>         gmake: *** [Makefile:166: all] Error 2
>         12:03:00: The process "/usr/bin/cmake" exited with code 2.
>         Error while building/deploying project qgis (kit: Qt 5.15.2 (qt5))
>         When executing step "Build"
> 
> 
>         Is it because of the new exif alg maybe?
> 
>         Regards
> 
>         Tim
> 
> 
>         -- 
>         ------------------------------------------------------------------------------------------
> 
>         Tim Sutton
>         Visit http://kartoza.com <http://kartoza.com/>?to find out about
>         open source:
>          ?* Desktop GIS programming services
>          ?* Geospatial web development
>         * GIS Training
>         * Consulting Services
>         Tim is a member of the QGIS Project Steering Committee
>         -------------------------------------------------------------------------------------------
>         _______________________________________________
>         QGIS-Developer mailing list
>         QGIS-Developer at lists.osgeo.org
>         <mailto:QGIS-Developer at lists.osgeo.org>
>         List info:
>         https://lists.osgeo.org/mailman/listinfo/qgis-developer
>         <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>         Unsubscribe:
>         https://lists.osgeo.org/mailman/listinfo/qgis-developer
>         <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
> 
> 
> 
> -- 
> ------------------------------------------------------------------------------------------
> ?
> 
> Tim Sutton
> Visit http://kartoza.com <http://kartoza.com/>?to find out about open 
> source:
>  ?* Desktop GIS programming services
>  ?* Geospatial web development
> * GIS Training
> * Consulting Services
> Tim is a member of the QGIS Project Steering Committee
> -------------------------------------------------------------------------------------------
> 
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> 

From senhor.neto at gmail.com  Thu Jul  8 16:02:00 2021
From: senhor.neto at gmail.com (Alexandre Neto)
Date: Fri, 9 Jul 2021 00:02:00 +0100
Subject: [QGIS-Developer] GDAL-warp and gdal-translate strange behaviour
 regarding output NODATA vaue
Message-ID: <CA+H0G_HOdFgkkxdMZsnEuzDxH5CBu-3tzxNy874zpgdHM2370A@mail.gmail.com>

Hi,

I was quite surprised with the behavior of gdal_translate (in clip raster
by extent) and gdal_warp (reproject) when the user sets up an output nodata
value different from the original nodata value of the input files.

My intuition was telling me that by using that option, all the old nodata
pixel values would be transferred to the new nodata values. So, if I have a
raster with nodata = -3.40282e+38 and I use as output nodata value -9999, I
would expect that all -3.40282e+38 pixels would be converted to -9999 and
considered to be NODATA. But I was wrong. By doing this, I ended up with
rasters containing pixels with actual -3.40282e+38 value, no longer
considered as nodata.

Is it just me that finds this unexpected?

On the other hand, if you use the same similar option in the DGAL raster
calculator it works as (I) expected.

Best regards,

Alexandre Neto
User Support
www.cooperative.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210709/b41e5e73/attachment.html>

From even.rouault at spatialys.com  Thu Jul  8 20:25:26 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 9 Jul 2021 05:25:26 +0200
Subject: [QGIS-Developer] GDAL-warp and gdal-translate strange behaviour
 regarding output NODATA vaue
In-Reply-To: <CA+H0G_HOdFgkkxdMZsnEuzDxH5CBu-3tzxNy874zpgdHM2370A@mail.gmail.com>
References: <CA+H0G_HOdFgkkxdMZsnEuzDxH5CBu-3tzxNy874zpgdHM2370A@mail.gmail.com>
Message-ID: <217a0392-131b-15a8-e3a4-fccea122704f@spatialys.com>

By design, only speaking about behaviour of the GDAL utilities themselves:

- gdal_translate -a_nodata just modifies the nodata metadata, and 
doesn't alter pixel values

- gdalwarp [-srcnodata xxx] -dstnodata yyy modifies the nodata metadata 
and pixel values

Le 09/07/2021 ? 01:02, Alexandre Neto a ?crit?:
> Hi,
>
> I was quite surprised with the behavior of gdal_translate (in clip 
> raster by extent) and gdal_warp (reproject) when the user sets up an 
> output nodata value different from the original nodata value of the 
> input files.
>
> My intuition was telling me that by using that option, all the old 
> nodata pixel values would be transferred to the new nodata values. So, 
> if I have a raster with nodata = -3.40282e+38 and I use as output 
> nodata value -9999, I would expect that all -3.40282e+38 pixels would 
> be converted to -9999 and considered to be NODATA. But I was wrong. By 
> doing this, I ended up with rasters containing pixels with actual 
> -3.40282e+38 value, no longer considered as nodata.
>
> Is it just me that finds this unexpected?
>
> On the other hand, if you use the same similar option in the DGAL 
> raster calculator it works as (I) expected.
>
> Best regards,
>
> Alexandre Neto
> User Support
> www.cooperative.net <http://www.cooperative.net>
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210709/c8ebd4e9/attachment-0001.html>

From pathmapper at posteo.de  Thu Jul  8 23:11:25 2021
From: pathmapper at posteo.de (pathmapper)
Date: Fri, 09 Jul 2021 06:11:25 +0000
Subject: [QGIS-Developer] 
 =?utf-8?q?QGIS_Server_and_Desktop_on_same_machi?=
 =?utf-8?q?ne_in_production=3F?=
In-Reply-To: <CAL5Q6712ZSsQkWVuLWduC5HJh4wQsOyofJsw30JnsBo+6ZVBNA@mail.gmail.com>
References: <4484bb98a94445614df4150305816d5c@posteo.de>
 <CAL5Q6712ZSsQkWVuLWduC5HJh4wQsOyofJsw30JnsBo+6ZVBNA@mail.gmail.com>
Message-ID: <b44a7fb1eee8e8046c5b3f8f9d881ba5@posteo.de>

Thanks Alessandro, also for the funny example of the guy with his 
personal computer server :)

The idea was to automate one or two processing steps on the server to 
update an OWS service regularly.

> I don't know how qgis_process is packaged but I don't see a reason why
> it would not run under the same server setup, it will just probably
> require xvfb-run before calling it.

Right, the following is working under a server setup:

xvfb-run --auto-servernum --server-num=1 qgis_process

Cheers,
Bjoern





On 10.06.2021 15:01, Alessandro Pasotti wrote:
> On Thu, Jun 10, 2021 at 2:48 PM pathmapper <pathmapper at posteo.de>
> wrote:
> 
>> Hi,
>> 
>> I would like to use processing from the command line
>> 
> (https://docs.qgis.org/3.16/en/docs/user_manual/processing/standalone.html
>> [1])
>> on the same Ubuntu machine where QGIS server is running:
>> 
>> Every information I did find so far says to install QGIS Desktop to
>> have
>> qgis_process available, but the training manual states:
>> 
>> "QGIS Server should be used in production without QGIS Desktop
>> (with the
>> accompanying X Server) installed on the same machine."
>> 
>> Source:
>> 
> https://docs.qgis.org/3.16/en/docs/training_manual/qgis_server/install.html#moderate-fa-install-from-packages
>> [2]
>> 
>> Is this recommendation still valid, and if yes, why?
> 
> That recommendation has never been valid from a technical point of
> view.
> 
> That said, it is not common nor recommended to perform common desktop
> operations on a production server, I've seen only a single example of
> such weird promiscuity in my whole career, in particular, that was a
> guy working for a public administration and the production server was
> his personal computer standing on his desktop.
> 
> For this reason all the documentation you will find assumes that the
> server is running on a headless server without X-Window running
> because that's what you will normally find with only a few very rare
> exceptions and it is not wise to do differently.
> 
> I don't know how qgis_process is packaged but I don't see a reason why
> it would not run under the same server setup, it will just probably
> require xvfb-run before calling it.
> 
> --
> 
> Alessandro Pasotti
> QCooperative:  www.qcooperative.net [3]
> ItOpen:   www.itopen.it [4]
> 
> Links:
> ------
> [1] 
> https://docs.qgis.org/3.16/en/docs/user_manual/processing/standalone.html
> [2]
> https://docs.qgis.org/3.16/en/docs/training_manual/qgis_server/install.html#moderate-fa-install-from-packages
> [3] https://www.qcooperative.net
> [4] http://www.itopen.it


From tim at kartoza.com  Fri Jul  9 02:13:20 2021
From: tim at kartoza.com (Tim Sutton)
Date: Fri, 9 Jul 2021 10:13:20 +0100
Subject: [QGIS-Developer] Build failure in master
In-Reply-To: <7630047b-2959-f051-705f-974c516d85b8@comcast.net>
References: <CAES-DZRZ4C=ShtiU1=N8CaC+Q_rSTMGt8XCbHE8Qf3JO4OpxzQ@mail.gmail.com>
 <CA+3oMjsktQUHqePu24sW15uePJwPar+g6TSyTywnOvs6XmkmQg@mail.gmail.com>
 <CAES-DZRqaSxt9cQrF8BDwnf=jaA1MZX6Fi5YUey=Cj=QXb5sbw@mail.gmail.com>
 <7630047b-2959-f051-705f-974c516d85b8@comcast.net>
Message-ID: <CAES-DZSYtbfnZez_iVgG1LTTJaKBN5EBUVm+T-mUAW3NJ1=iTQ@mail.gmail.com>

Thanks Tom (long time no see!) and Werner. It built successfully after
doing a clean first.

Regards

Tim

On Thu, Jul 8, 2021 at 11:37 PM Tom Elwertowski <telwertowski at comcast.net>
wrote:

> Try deleting everything in the {build}/python/analysis folder. Just
> deleting the generated *.cpp files isn't enough.
>
> I have been seeing a multiple definition sip_{module}part{n}
> sip_{module}part{n+1} error about once every three months for awhile.
> Deleting everything in {build}/python/{module} allows the build to be
> resumed (macOS Catalina).
>
> Tom
>
>
> On 7/8/21 4:59 PM, Tim Sutton wrote:
> > Thanks for testing Werner. A few others on Telegram also reported that
> > things are building fine for them. I will try doing  clean build
> > tomorrow, thanks!
> >
> > Regards
> >
> > Tim
> >
> > On Thu, Jul 8, 2021 at 1:01 PM Werner Macho <werner.macho at gmail.com
> > <mailto:werner.macho at gmail.com>> wrote:
> >
> >     Hi Tim,
> >
> >     Just updated master and also tried to build with no errors
> whatsoever.
> >     (Using ninja and ccache)
> >
> >     Maybe try a clean build?
> >
> >     regards
> >     Werner
> >
> >     On Thu, Jul 8, 2021 at 1:10 PM Tim Sutton <tim at kartoza.com
> >     <mailto:tim at kartoza.com>> wrote:
> >
> >         Hi All
> >
> >         Just updated to master and getting a build error:
> >
> >
> >         Consolidate compiler generated dependencies of target
> >         python_module_qgis__analysis
> >         [ 68%] Linking CXX shared module
> ../output/python/qgis/_analysis.so
> >         /usr/bin/ld:
> >
>  CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart13.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart13.cpp:138:
> >         multiple definition of `sipTypeDef__analysis_QgsAnalysis';
> >
>  CMakeFiles/python_module_qgis__analysis.dir/analysis/sip_analysispart12.cpp.o:/home/timlinux/dev/cpp/QGIS-QtCreator-Build/python/analysis/sip_analysispart12.cpp:1812:
> >         first defined here
> >         collect2: error: ld returned 1 exit status
> >         gmake[2]: ***
> >
>  [python/CMakeFiles/python_module_qgis__analysis.dir/build.make:1101:
> >         output/python/qgis/_analysis.so] Error 1
> >         gmake[1]: *** [CMakeFiles/Makefile2:6919:
> >         python/CMakeFiles/python_module_qgis__analysis.dir/all] Error 2
> >         gmake[1]: *** Waiting for unfinished jobs....
> >         Consolidate compiler generated dependencies of target qgis_gui
> >         [ 78%] Built target qgis_gui
> >         gmake: *** [Makefile:166: all] Error 2
> >         12:03:00: The process "/usr/bin/cmake" exited with code 2.
> >         Error while building/deploying project qgis (kit: Qt 5.15.2
> (qt5))
> >         When executing step "Build"
> >
> >
> >         Is it because of the new exif alg maybe?
> >
> >         Regards
> >
> >         Tim
> >
> >
> >         --
> >
>  ------------------------------------------------------------------------------------------
> >
> >         Tim Sutton
> >         Visit http://kartoza.com <http://kartoza.com/> to find out about
> >         open source:
> >           * Desktop GIS programming services
> >           * Geospatial web development
> >         * GIS Training
> >         * Consulting Services
> >         Tim is a member of the QGIS Project Steering Committee
> >
>  -------------------------------------------------------------------------------------------
> >         _______________________________________________
> >         QGIS-Developer mailing list
> >         QGIS-Developer at lists.osgeo.org
> >         <mailto:QGIS-Developer at lists.osgeo.org>
> >         List info:
> >         https://lists.osgeo.org/mailman/listinfo/qgis-developer
> >         <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
> >         Unsubscribe:
> >         https://lists.osgeo.org/mailman/listinfo/qgis-developer
> >         <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
> >
> >
> >
> > --
> >
> ------------------------------------------------------------------------------------------
> > ?
> >
> > Tim Sutton
> > Visit http://kartoza.com <http://kartoza.com/> to find out about open
> > source:
> >   * Desktop GIS programming services
> >   * Geospatial web development
> > * GIS Training
> > * Consulting Services
> > Tim is a member of the QGIS Project Steering Committee
> >
> -------------------------------------------------------------------------------------------
> >
> > _______________________________________________
> > QGIS-Developer mailing list
> > QGIS-Developer at lists.osgeo.org
> > List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> > Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> >
>


-- 
------------------------------------------------------------------------------------------
?

Tim Sutton
Visit http://kartoza.com to find out about open source:
 * Desktop GIS programming services
 * Geospatial web development
* GIS Training
* Consulting Services
Tim is a member of the QGIS Project Steering Committee
-------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210709/3ed9405b/attachment.html>

From osgeo.mailinglist at gmail.com  Sun Jul 11 18:14:01 2021
From: osgeo.mailinglist at gmail.com (Thomas Gratier)
Date: Mon, 12 Jul 2021 03:14:01 +0200
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
In-Reply-To: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
References: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
Message-ID: <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>

Hi,

I'm not aware QSettings provided by Qt can do it. Your %APPDATA% is not
portable as would only work on Windows

You can always try generate the QGIS.ini file using a templating system

File QGIS.ini.j2 with following content

Configuration\MODELS_FOLDER={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\models
Configuration\SCRIPTS_FOLDERS={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts


File generate_ini.py with following content

import os
import jinja2

templateLoader = jinja2.FileSystemLoader(searchpath="./")
templateEnv = jinja2.Environment(loader=templateLoader)
TEMPLATE_FILE = "QGIS.ini.j2"
template = templateEnv.get_template(TEMPLATE_FILE)
mydict = {
    "APPDATA": os.environ.get("APPDATA")
}
outputText = template.render(**mydict)
with open('QGIS.ini', 'w') as outputfile:
    outputfile.write(outputText)

Then, to write your QGIS.ini file, do


python3 generate_ini.py


The possible deal breakers with this approach are:
- you depend from jinja2, a third party Python library,
- you can't later reuse the mechanism if for instance QGIS changes the
QGIS.ini file later on


Regards

Thomas


Le mar. 6 juil. 2021 ? 09:18, Bo Victor Thomsen <bo.victor.thomsen at gmail.com>
a ?crit :

> To the list -
>
> Is there a method to use OS (Linux, Windows...) environment variables in
> the QGIS.ini setup file ?
>
> I had a number of customers asking for a method to "generalize" QGIS.ini,
> so it doesn't contain any "user" specific file and directory references, i.e
>
> (From qgis.ini)
>
> Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor
> Thomsen\\AppData\\Roaming*
> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
> Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor
> Thomsen\\AppData\\Roaming*
> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>
> could be:
>
> Configuration\MODELS_FOLDER=*%APPDATA%*
> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
> Configuration\SCRIPTS_FOLDERS=*%APPDATA%*
> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>
> or likewise.
>
> The ultimate reason is to have a method to distribute a "standard" setup
> for QGIS, complete with plugins and specialized setup parameters. This can
> be done by making a standard QGIS installation (which the IT departments
> love, especially with the new .msi package) and afterwards replace the
> "default" profile directory with at  directory specific for the
> organisation. However, the process of making the new profile will place a
> lot of file/directory references in QGIS.ini that is specific for the
> super-user developing the new profile.
>
> --
> Med venlig hilsen / Kind regards
>
> Bo Victor Thomsen
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/dbf4090f/attachment.html>

From matthias at opengis.ch  Sun Jul 11 22:59:58 2021
From: matthias at opengis.ch (Matthias Kuhn)
Date: Mon, 12 Jul 2021 07:59:58 +0200
Subject: [QGIS-Developer] Question on @atlas_featureid
In-Reply-To: <CAB2Z92BA6r+duCUSeVZa_4HH0MGha4Urnm0N34h43Zoc-0zJaA@mail.gmail.com>
References: <68b4d97118bb679c22cd7d4c90048f52@carto.net>
 <20210708084228.nzrxdxiszgsajah5@norbit.de>
 <CAB2Z92DRD279pLy36EfgL5MiKaX7W-H0bKSUiAAbb+Q+KZC5OQ@mail.gmail.com>
 <CA+H0G_HUJNkjama+ytprC327pUPX7=jiwit6dQyf-x3FX6B9fw@mail.gmail.com>
 <CAB2Z92BA6r+duCUSeVZa_4HH0MGha4Urnm0N34h43Zoc-0zJaA@mail.gmail.com>
Message-ID: <CAC7zN953+f-VW56_vgVa8wXBnoRDXMYEMkJPQc=2Jp54mUczLA@mail.gmail.com>

Hi

It depends on the implementation in the data provider (and normally on the
data type for the primary key).

In the postgres case, (up to) 32 bit integer primary keys are normally used
as fid.
With others like 64 bit integer, string or compound foreign keys it's not
possible to stick to this approach, so an internal fid to pk map is
generated by the provider at runtime.

64 bit integers cannot be directly reused as fid because QGIS stores fids
internally with 64 bit, but reserves the (negative, -1, -2, ...) half of
the available values for new, uncommitted features.

Matthias


On Thu, Jul 8, 2021 at 11:50 AM Andreas Neumann <andreas at qgis.org> wrote:

> Ok - that explains it.
>
> It is quite confusing that QGIS uses a different internal ID than the
> primary key column of the database. Is there a technical reason for this
> behaviour?
>
> Andreas
>
>
>
> On Thu, 8 Jul 2021 at 11:43, Alexandre Neto <senhor.neto at gmail.com> wrote:
>
>> As far as I remember @atlas_featureid has always returned the same as the
>> $id in the attributes table, which is kind of the internal row number.
>>
>> Alex
>>
>> A quinta, 8/07/2021, 10:35, Andreas Neumann <andreas at qgis.org> escreveu:
>>
>>> HI J?rgen,
>>>
>>> Yes - I provided the primary key column
>>>
>>> Here is my data source string:
>>>
>>> service='edit' authcfg=sogis00 key='t_id' srid=2056 type=Polygon
>>> checkPrimaryKeyUnicity='1'
>>> table="alw_strukturverbesserungen"."projekt_aggregiert_v"
>>> (geometrie_convex_hull) sql=geometrie_bbox IS NOT NULL
>>>
>>> @atlas_featureid returns something like an internal "row number" or
>>> similar, but not the column "t_id" as defined in the data source string.
>>>
>>> Andreas
>>>
>>> On Thu, 8 Jul 2021 at 10:42, J?rgen E. Fischer <jef at norbit.de> wrote:
>>>
>>>> Hi Andreas,
>>>>
>>>> On Thu, 08. Jul 2021 at 10:30:08 +0200, Andreas Neumann wrote:
>>>> > attribute(@atlas_feature,'pkey_name'), but it is a little more
>>>> complicated
>>>> > than @atlas_featureid - and I'm pretty sure that @atlas_featureid was
>>>> using
>>>> > the pkey column in th past?
>>>> >
>>>> > My data source for the atlas coverage layer is a Postgis View.
>>>>
>>>> It's probably not using the column you expect for the feature id.  Did
>>>> you
>>>> specify the key column when adding the view?
>>>>
>>>>
>>>> J?rgen
>>>>
>>>> --
>>>> J?rgen E. Fischer           norBIT GmbH             Tel.
>>>> +49-4931-918175-31
>>>> Dipl.-Inf. (FH)             Rheinstra?e 13          Fax.
>>>> +49-4931-918175-50
>>>> Software Engineer           D-26506 Norden
>>>> https://www.norbit.de
>>>> QGIS release manager (PSC)  Germany                 IRC: jef on
>>>> Libera|OFTC
>>>> _______________________________________________
>>>> QGIS-Developer mailing list
>>>> QGIS-Developer at lists.osgeo.org
>>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>>
>>>
>>>
>>> --
>>>
>>> --
>>> Andreas Neumann
>>> QGIS.ORG board member (treasurer)
>>> _______________________________________________
>>> QGIS-Developer mailing list
>>> QGIS-Developer at lists.osgeo.org
>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>
>>
>
> --
>
> --
> Andreas Neumann
> QGIS.ORG board member (treasurer)
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/e9855493/attachment.html>

From bo.victor.thomsen at gmail.com  Mon Jul 12 00:32:35 2021
From: bo.victor.thomsen at gmail.com (Bo Victor Thomsen)
Date: Mon, 12 Jul 2021 09:32:35 +0200
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
In-Reply-To: <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>
References: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
 <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>
Message-ID: <588313ac-8328-eb6a-2bb3-20dd35a4a32f@gmail.com>

Hi Thomas -

Your suggestion is actually pretty close to the solution I made -

  * Standard installation of QGIS with /standard/ .msi package.
  * After the QGIS installation and before QGIS is started the user do a
    one-time run a Python script from et central network drive -? using
    the Python interpreter installed together with QGIS? which:
      o Unzip a complete profile? with specific plugins and customized
        parameters from a central network based repository. This profile
        replaces the standard "default" profile.
      o Search/replace a couple of "tokenized" values in QGIS.ini with
        actual values based on username

The profile and tokenized QGIS.ini is prepared by the GIS administrator

The Python script is packaged in a .cmd file which is started by the user.

Not a perfect solution, but doable:

  * The It department is happy: No work doing specialized installations
  * The GIS administrator is happy. It's a one-time piece of work for
    each QGIS version to? prepare the profile and tokenize the QGIS.ini
  * The user is - somewhat - happy. To finish the installation is simply
    to double-click once on a file placed in a "highly visible" location.
  * Any subsequent mistakes made by the user (Installation of dodgy
    plugins, strange changes in setups ....) is easily repaired by
    running the Python script again.


Med venlig hilsen / Kind regards

Bo Victor Thomsen

Den 12-07-2021 kl. 03:14 skrev Thomas Gratier:
> Hi,
>
> I'm not aware QSettings provided by Qt can do it. Your %APPDATA% is 
> not portable as would only work on Windows
>
> You can always try generate the QGIS.ini file using a templating system
>
> File QGIS.ini.j2 with following content
>
> Configuration\MODELS_FOLDER={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\models
> Configuration\SCRIPTS_FOLDERS={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>
>
> File generate_ini.py with following content
>
> import os
> import jinja2
>
> templateLoader = jinja2.FileSystemLoader(searchpath="./")
> templateEnv = jinja2.Environment(loader=templateLoader)
> TEMPLATE_FILE = "QGIS.ini.j2"
> template = templateEnv.get_template(TEMPLATE_FILE)
> mydict = {
> ??? "APPDATA": os.environ.get("APPDATA")
> }
> outputText = template.render(**mydict)
> with open('QGIS.ini', 'w') as outputfile:
> ??? outputfile.write(outputText)
>
> Then, to write your QGIS.ini file, do
>
>
> python3 generate_ini.py
>
>
> The possible deal breakers with this approach are:
> - you depend from jinja2, a third party Python library,
> - you can't later reuse the mechanism if for instance QGIS changes the 
> QGIS.ini file later on
>
>
> Regards
>
> Thomas
>
>
> Le?mar. 6 juil. 2021 ??09:18, Bo Victor Thomsen 
> <bo.victor.thomsen at gmail.com <mailto:bo.victor.thomsen at gmail.com>> a 
> ?crit?:
>
>     To the list -
>
>     Is there a method to use OS (Linux, Windows...) environment
>     variables in the QGIS.ini setup file ?
>
>     I had a number of customers asking for a method to "generalize"
>     QGIS.ini, so it doesn't contain any "user" specific file and
>     directory references, i.e
>
>     (From qgis.ini)
>
>     Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor
>     Thomsen\\AppData\\Roaming*\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>     Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor
>     Thomsen\\AppData\\Roaming*\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>
>     could be:
>
>     Configuration\MODELS_FOLDER=*%APPDATA%*\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>     Configuration\SCRIPTS_FOLDERS=*%APPDATA%*\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>
>     or likewise.
>
>     The ultimate reason is to have a method to distribute a "standard"
>     setup for QGIS, complete with plugins and specialized setup
>     parameters. This can be done by making a standard QGIS
>     installation (which the IT departments love, especially with the
>     new .msi package) and afterwards replace the "default" profile
>     directory with at? directory specific for the organisation.
>     However, the process of making the new profile will place a lot of
>     file/directory references in QGIS.ini that is specific for the
>     super-user developing the new profile.
>
>     -- 
>     Med venlig hilsen / Kind regards
>
>     Bo Victor Thomsen
>
>     _______________________________________________
>     QGIS-Developer mailing list
>     QGIS-Developer at lists.osgeo.org <mailto:QGIS-Developer at lists.osgeo.org>
>     List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>     Unsubscribe:
>     https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/24982656/attachment-0001.html>

From a.neumann at carto.net  Mon Jul 12 00:52:19 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Mon, 12 Jul 2021 09:52:19 +0200
Subject: [QGIS-Developer] Question on @atlas_featureid
In-Reply-To: <CAC7zN953+f-VW56_vgVa8wXBnoRDXMYEMkJPQc=2Jp54mUczLA@mail.gmail.com>
References: <68b4d97118bb679c22cd7d4c90048f52@carto.net>
 <20210708084228.nzrxdxiszgsajah5@norbit.de>
 <CAB2Z92DRD279pLy36EfgL5MiKaX7W-H0bKSUiAAbb+Q+KZC5OQ@mail.gmail.com>
 <CA+H0G_HUJNkjama+ytprC327pUPX7=jiwit6dQyf-x3FX6B9fw@mail.gmail.com>
 <CAB2Z92BA6r+duCUSeVZa_4HH0MGha4Urnm0N34h43Zoc-0zJaA@mail.gmail.com>
 <CAC7zN953+f-VW56_vgVa8wXBnoRDXMYEMkJPQc=2Jp54mUczLA@mail.gmail.com>
Message-ID: <c7fd32279f0993de62b84dda0b7aa495@carto.net>

Hi Matthias,

Ok - this is the case here. ili2pg creates bigint pkeys. That explains 
why I see the "unrelated" internal pkeys from QGIS instead.

It would be really nice if we had an option to create normal "integer" 
pkeys with ili2pg instead of bigint. Other GIS (like Geomedia) had 
issues with bigint pkeys as well (at least in older versions).

In 99% of our cases bigint isn't necessary and the ranger of normal 
integer good enough.

I'll open an issue at ili2pg.

Thanks for you explanation, Matthias!

Andreas

On 2021-07-12 07:59, Matthias Kuhn wrote:

> Hi
> 
> It depends on the implementation in the data provider (and normally on 
> the data type for the primary key).
> 
> In the postgres case, (up to) 32 bit integer primary keys are normally 
> used as fid.
> With others like 64 bit integer, string or compound foreign keys it's 
> not possible to stick to this approach, so an internal fid to pk map is 
> generated by the provider at runtime.
> 
> 64 bit integers cannot be directly reused as fid because QGIS stores 
> fids internally with 64 bit, but reserves the (negative, -1, -2, ...) 
> half of the available values for new, uncommitted features.
> 
> Matthias
> 
> On Thu, Jul 8, 2021 at 11:50 AM Andreas Neumann <andreas at qgis.org> 
> wrote:
> 
> Ok - that explains it.
> 
> It is quite confusing that QGIS uses a different internal ID than the 
> primary key column of the database. Is there a technical reason for 
> this behaviour?
> 
> Andreas
> 
> On Thu, 8 Jul 2021 at 11:43, Alexandre Neto <senhor.neto at gmail.com> 
> wrote:
> 
> As far as I remember @atlas_featureid has always returned the same as 
> the $id in the attributes table, which is kind of the internal row 
> number.
> 
> Alex
> 
> A quinta, 8/07/2021, 10:35, Andreas Neumann <andreas at qgis.org> 
> escreveu:
> 
> HI J?rgen,
> 
> Yes - I provided the primary key column
> 
> Here is my data source string:
> 
> service='edit' authcfg=sogis00 key='t_id' srid=2056 type=Polygon 
> checkPrimaryKeyUnicity='1' 
> table="alw_strukturverbesserungen"."projekt_aggregiert_v" 
> (geometrie_convex_hull) sql=geometrie_bbox IS NOT NULL
> 
> @atlas_featureid returns something like an internal "row number" or 
> similar, but not the column "t_id" as defined in the data source 
> string.
> 
> Andreas
> 
> On Thu, 8 Jul 2021 at 10:42, J?rgen E. Fischer <jef at norbit.de> wrote: 
> Hi Andreas,
> 
> On Thu, 08. Jul 2021 at 10:30:08 +0200, Andreas Neumann wrote:
>> attribute(@atlas_feature,'pkey_name'), but it is a little more 
>> complicated
>> than @atlas_featureid - and I'm pretty sure that @atlas_featureid was 
>> using
>> the pkey column in th past?
>> 
>> My data source for the atlas coverage layer is a Postgis View.
> 
> It's probably not using the column you expect for the feature id.  Did 
> you
> specify the key column when adding the view?
> 
> J?rgen
> 
> --
> J?rgen E. Fischer           norBIT GmbH             Tel. 
> +49-4931-918175-31
> Dipl.-Inf. (FH)             Rheinstra?e 13          Fax. 
> +49-4931-918175-50
> Software Engineer           D-26506 Norden            
> https://www.norbit.de
> QGIS release manager (PSC)  Germany                 IRC: jef on 
> Libera|OFTC
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> 
> --
> 
> --
> Andreas Neumann QGIS.ORG [1] board member (treasurer) 
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

-- 

--
Andreas Neumann QGIS.ORG [1] board member (treasurer) 
_______________________________________________
QGIS-Developer mailing list
QGIS-Developer at lists.osgeo.org
List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer



Links:
------
[1] http://QGIS.ORG
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/50b81fbc/attachment.html>

From senhor.neto at gmail.com  Mon Jul 12 01:54:31 2021
From: senhor.neto at gmail.com (Alexandre Neto)
Date: Mon, 12 Jul 2021 09:54:31 +0100
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
In-Reply-To: <588313ac-8328-eb6a-2bb3-20dd35a4a32f@gmail.com>
References: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
 <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>
 <588313ac-8328-eb6a-2bb3-20dd35a4a32f@gmail.com>
Message-ID: <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>

Hi Bo,

This is some old stuff we wrote at Boundless, I believe it still applies
for QGIS today.

https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators

Both initialisation scripts and global setting file can help you with what
you want to achieve.

(I should make sure this information is available on docs.qgis.org, but I
never find the time to do it...)

Best regards,

Alexandre Neto
User Support
www.qcooperative.net

A segunda, 12/07/2021, 08:34, Bo Victor Thomsen <bo.victor.thomsen at gmail.com>
escreveu:

> Hi Thomas -
>
> Your suggestion is actually pretty close to the solution I made -
>
>    - Standard installation of QGIS with *standard* .msi package.
>    - After the QGIS installation and before QGIS is started the user do a
>    one-time run a Python script from et central network drive -  using the
>    Python interpreter installed together with QGIS  which:
>    - Unzip a complete profile  with specific plugins and customized
>       parameters from a central network based repository. This profile replaces
>       the standard "default" profile.
>       - Search/replace a couple of "tokenized" values in QGIS.ini with
>       actual values based on username
>
> The profile and tokenized QGIS.ini is prepared by the GIS administrator
>
> The Python script is packaged in a .cmd file which is started by the user.
>
> Not a perfect solution, but doable:
>
>    - The It department is happy: No work doing specialized installations
>    - The GIS administrator is happy. It's a one-time piece of work for
>    each QGIS version to  prepare the profile and tokenize the QGIS.ini
>    - The user is - somewhat - happy. To finish the installation is simply
>    to double-click once on a file placed in a "highly visible" location.
>    - Any subsequent mistakes made by the user (Installation of dodgy
>    plugins, strange changes in setups ....) is easily repaired by running the
>    Python script again.
>
>
> Med venlig hilsen / Kind regards
>
> Bo Victor Thomsen
>
> Den 12-07-2021 kl. 03:14 skrev Thomas Gratier:
>
> Hi,
>
> I'm not aware QSettings provided by Qt can do it. Your %APPDATA% is not
> portable as would only work on Windows
>
> You can always try generate the QGIS.ini file using a templating system
>
> File QGIS.ini.j2 with following content
>
>
> Configuration\MODELS_FOLDER={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>
> Configuration\SCRIPTS_FOLDERS={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>
>
> File generate_ini.py with following content
>
> import os
> import jinja2
>
> templateLoader = jinja2.FileSystemLoader(searchpath="./")
> templateEnv = jinja2.Environment(loader=templateLoader)
> TEMPLATE_FILE = "QGIS.ini.j2"
> template = templateEnv.get_template(TEMPLATE_FILE)
> mydict = {
>     "APPDATA": os.environ.get("APPDATA")
> }
> outputText = template.render(**mydict)
> with open('QGIS.ini', 'w') as outputfile:
>     outputfile.write(outputText)
>
> Then, to write your QGIS.ini file, do
>
>
> python3 generate_ini.py
>
>
> The possible deal breakers with this approach are:
> - you depend from jinja2, a third party Python library,
> - you can't later reuse the mechanism if for instance QGIS changes the
> QGIS.ini file later on
>
>
> Regards
>
> Thomas
>
>
> Le mar. 6 juil. 2021 ? 09:18, Bo Victor Thomsen <
> bo.victor.thomsen at gmail.com> a ?crit :
>
>> To the list -
>>
>> Is there a method to use OS (Linux, Windows...) environment variables in
>> the QGIS.ini setup file ?
>>
>> I had a number of customers asking for a method to "generalize" QGIS.ini,
>> so it doesn't contain any "user" specific file and directory references, i.e
>>
>> (From qgis.ini)
>>
>> Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor
>> Thomsen\\AppData\\Roaming*
>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>> Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor
>> Thomsen\\AppData\\Roaming*
>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>
>> could be:
>>
>> Configuration\MODELS_FOLDER=*%APPDATA%*
>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>> Configuration\SCRIPTS_FOLDERS=*%APPDATA%*
>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>
>> or likewise.
>>
>> The ultimate reason is to have a method to distribute a "standard" setup
>> for QGIS, complete with plugins and specialized setup parameters. This can
>> be done by making a standard QGIS installation (which the IT departments
>> love, especially with the new .msi package) and afterwards replace the
>> "default" profile directory with at  directory specific for the
>> organisation. However, the process of making the new profile will place a
>> lot of file/directory references in QGIS.ini that is specific for the
>> super-user developing the new profile.
>>
>> --
>> Med venlig hilsen / Kind regards
>>
>> Bo Victor Thomsen
>>
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/4ab26a21/attachment-0001.html>

From bo.victor.thomsen at gmail.com  Mon Jul 12 08:40:00 2021
From: bo.victor.thomsen at gmail.com (Bo Victor Thomsen)
Date: Mon, 12 Jul 2021 17:40:00 +0200
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
In-Reply-To: <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>
References: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
 <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>
 <588313ac-8328-eb6a-2bb3-20dd35a4a32f@gmail.com>
 <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>
Message-ID: <e85563d0-7f2e-887c-7956-93b68c482aec@gmail.com>

Hi Alexandre -

Thanks for the heads-up regarding initialisation scripts and global 
settings file.

Med venlig hilsen / Kind regards

Bo Victor Thomsen

Den 12-07-2021 kl. 10:54 skrev Alexandre Neto:
> Hi Bo,
>
> This is some old stuff we wrote at Boundless, I believe it still 
> applies for QGIS today.
>
> https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators 
> <https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators>
>
> Both initialisation scripts and global setting file can help you with 
> what you want to achieve.
>
> (I should make sure this information is available on docs.qgis.org 
> <http://docs.qgis.org>, but I never find the time to do it...)
>
> Best regards,
>
> Alexandre Neto
> User Support
> www.qcooperative.net <http://www.qcooperative.net>
>
> A segunda, 12/07/2021, 08:34, Bo Victor Thomsen 
> <bo.victor.thomsen at gmail.com <mailto:bo.victor.thomsen at gmail.com>> 
> escreveu:
>
>     Hi Thomas -
>
>     Your suggestion is actually pretty close to the solution I made -
>
>       * Standard installation of QGIS with /standard/ .msi package.
>       * After the QGIS installation and before QGIS is started the
>         user do a one-time run a Python script from et central network
>         drive -? using the Python interpreter installed together with
>         QGIS? which:
>           o Unzip a complete profile? with specific plugins and
>             customized parameters from a central network based
>             repository. This profile replaces the standard "default"
>             profile.
>           o Search/replace a couple of "tokenized" values in QGIS.ini
>             with actual values based on username
>
>     The profile and tokenized QGIS.ini is prepared by the GIS
>     administrator
>
>     The Python script is packaged in a .cmd file which is started by
>     the user.
>
>     Not a perfect solution, but doable:
>
>       * The It department is happy: No work doing specialized
>         installations
>       * The GIS administrator is happy. It's a one-time piece of work
>         for each QGIS version to? prepare the profile and tokenize the
>         QGIS.ini
>       * The user is - somewhat - happy. To finish the installation is
>         simply to double-click once on a file placed in a "highly
>         visible" location.
>       * Any subsequent mistakes made by the user (Installation of
>         dodgy plugins, strange changes in setups ....) is easily
>         repaired by running the Python script again.
>
>
>     Med venlig hilsen / Kind regards
>
>     Bo Victor Thomsen
>
>     Den 12-07-2021 kl. 03:14 skrev Thomas Gratier:
>>     Hi,
>>
>>     I'm not aware QSettings provided by Qt can do it. Your %APPDATA%
>>     is not portable as would only work on Windows
>>
>>     You can always try generate the QGIS.ini file using a templating
>>     system
>>
>>     File QGIS.ini.j2 with following content
>>
>>     Configuration\MODELS_FOLDER={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>     Configuration\SCRIPTS_FOLDERS={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>
>>
>>     File generate_ini.py with following content
>>
>>     import os
>>     import jinja2
>>
>>     templateLoader = jinja2.FileSystemLoader(searchpath="./")
>>     templateEnv = jinja2.Environment(loader=templateLoader)
>>     TEMPLATE_FILE = "QGIS.ini.j2"
>>     template = templateEnv.get_template(TEMPLATE_FILE)
>>     mydict = {
>>     ??? "APPDATA": os.environ.get("APPDATA")
>>     }
>>     outputText = template.render(**mydict)
>>     with open('QGIS.ini', 'w') as outputfile:
>>     ??? outputfile.write(outputText)
>>
>>     Then, to write your QGIS.ini file, do
>>
>>
>>     python3 generate_ini.py
>>
>>
>>     The possible deal breakers with this approach are:
>>     - you depend from jinja2, a third party Python library,
>>     - you can't later reuse the mechanism if for instance QGIS
>>     changes the QGIS.ini file later on
>>
>>
>>     Regards
>>
>>     Thomas
>>
>>
>>     Le?mar. 6 juil. 2021 ??09:18, Bo Victor Thomsen
>>     <bo.victor.thomsen at gmail.com
>>     <mailto:bo.victor.thomsen at gmail.com>> a ?crit?:
>>
>>         To the list -
>>
>>         Is there a method to use OS (Linux, Windows...) environment
>>         variables in the QGIS.ini setup file ?
>>
>>         I had a number of customers asking for a method to
>>         "generalize" QGIS.ini, so it doesn't contain any "user"
>>         specific file and directory references, i.e
>>
>>         (From qgis.ini)
>>
>>         Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor
>>         Thomsen\\AppData\\Roaming*\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>         Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor
>>         Thomsen\\AppData\\Roaming*\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>
>>         could be:
>>
>>         Configuration\MODELS_FOLDER=*%APPDATA%*\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>         Configuration\SCRIPTS_FOLDERS=*%APPDATA%*\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>
>>         or likewise.
>>
>>         The ultimate reason is to have a method to distribute a
>>         "standard" setup for QGIS, complete with plugins and
>>         specialized setup parameters. This can be done by making a
>>         standard QGIS installation (which the IT departments love,
>>         especially with the new .msi package) and afterwards replace
>>         the "default" profile directory with at? directory specific
>>         for the organisation. However, the process of making the new
>>         profile will place a lot of file/directory references in
>>         QGIS.ini that is specific for the super-user developing the
>>         new profile.
>>
>>         -- 
>>         Med venlig hilsen / Kind regards
>>
>>         Bo Victor Thomsen
>>
>>         _______________________________________________
>>         QGIS-Developer mailing list
>>         QGIS-Developer at lists.osgeo.org
>>         <mailto:QGIS-Developer at lists.osgeo.org>
>>         List info:
>>         https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>         <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>>         Unsubscribe:
>>         https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>         <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>>
>     _______________________________________________
>     QGIS-Developer mailing list
>     QGIS-Developer at lists.osgeo.org <mailto:QGIS-Developer at lists.osgeo.org>
>     List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>     Unsubscribe:
>     https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/e2991b2a/attachment.html>

From pierluigi.derosa at gmail.com  Mon Jul 12 10:51:37 2021
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Mon, 12 Jul 2021 19:51:37 +0200
Subject: [QGIS-Developer] QgsMapLayerCombobox with multiple filters
Message-ID: <CAAgsrZiX7Xr_huJ6hQOkY+XFY+KnsttzNQkwc509sdkinWF0dA@mail.gmail.com>

Dear All,

I'm experiencing some problems with the QgsMapLayerComboBox.
I would like to filter all line and polygon layer.
Here below my code:

self.overlayLayer_ComboBox.setFilters(QgsMapLayerProxyModel.PointLayer,QgsMapLayerProxyModel.LineLayer)

But I have and Error. I can add only one layer type. Even the
QgsmapLayerProxyModel.VectorLayer
<https://qgis.github.io/pyqgis/3.2/core/Map/QgsMapLayerProxyModel.html?highlight=qgsmaplayerproxymodel%20pointlayer#qgis.core.QgsMapLayerProxyModel.VectorLayer>
is
not suitable.
I want to show only line and polygon.
Can anyone help me?
Thank you
Pierluigi
-- 
Ing. Pierluigi De Rosa (PhD in Earth Science)
Contract Professor of Geographic Information System at University of Perugia
cel: 3497558268 / fax: 075 7823038
skype: pierluigi.derosa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/56005c3a/attachment.html>

From benjamin.jakimow at geo.hu-berlin.de  Mon Jul 12 10:56:44 2021
From: benjamin.jakimow at geo.hu-berlin.de (Benjamin Jakimow)
Date: Mon, 12 Jul 2021 19:56:44 +0200
Subject: [QGIS-Developer] QgsMapLayerCombobox with multiple filters
In-Reply-To: <CAAgsrZiX7Xr_huJ6hQOkY+XFY+KnsttzNQkwc509sdkinWF0dA@mail.gmail.com>
References: <CAAgsrZiX7Xr_huJ6hQOkY+XFY+KnsttzNQkwc509sdkinWF0dA@mail.gmail.com>
Message-ID: <586c0de7d3c77dbdcc58704c019c1b3c@geo.hu-berlin.de>

Hi Pierluigi,

you need to combine the Flags as binary Or ('|') :

self.overlayLayer_ComboBox.setFilters(QgsMapLayerProxyModel.PointLayer | 
QgsMapLayerProxyModel.LineLayer)

/Benjamin

On 2021-07-12 19:51, pierluigi de rosa wrote:

> Dear All,
> 
> I'm experiencing some problems with the QgsMapLayerComboBox.
> I would like to filter all line and polygon layer.
> Here below my code:
> 
> self.overlayLayer_ComboBox.setFilters(QgsMapLayerProxyModel.PointLayer,QgsMapLayerProxyModel.LineLayer)
> 
> But I have and Error. I can add only one layer type. Even the 
> QgsmapLayerProxyModel.VectorLayer [1] is not suitable.
> I want to show only line and polygon.
> Can anyone help me?
> Thank you
> Pierluigi --
> 
> Ing. Pierluigi De Rosa (PhD in Earth Science)
> Contract Professor of Geographic Information System at University of 
> Perugia
> cel: 3497558268 / fax: 075 7823038
> skype: pierluigi.derosa
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

-- 
--
Benjamin Jakimow, Doctoral Researcher
Earth Observation Lab | Geography Department | Humboldt-Universit?t zu 
Berlin

e-mail: benjamin.jakimow at geo.hu-berlin.de

phone:  +49 (0) 30 2093 6894
mobile: +49 (0) 157 5656 8477
fax:    +49 (0) 30 2093 6848
mail:   Unter den Linden 6 | 10099 Berlin | Germany
room: 2'222

Links:
------
[1] 
https://qgis.github.io/pyqgis/3.2/core/Map/QgsMapLayerProxyModel.html?highlight=qgsmaplayerproxymodel%20pointlayer#qgis.core.QgsMapLayerProxyModel.VectorLayer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210712/be1a85f4/attachment-0001.html>

From pierluigi.derosa at gmail.com  Mon Jul 12 22:38:28 2021
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Tue, 13 Jul 2021 07:38:28 +0200
Subject: [QGIS-Developer] QgsMapLayerCombobox with multiple filters
In-Reply-To: <586c0de7d3c77dbdcc58704c019c1b3c@geo.hu-berlin.de>
References: <CAAgsrZiX7Xr_huJ6hQOkY+XFY+KnsttzNQkwc509sdkinWF0dA@mail.gmail.com>
 <586c0de7d3c77dbdcc58704c019c1b3c@geo.hu-berlin.de>
Message-ID: <CAAgsrZi=qxGBj3c6DTPjG9t5jH4HheZyFVsRCzXDd-7LNyeHJA@mail.gmail.com>

Thanks a lot for your answer.

I solved my problem
P

Il giorno lun 12 lug 2021 alle ore 19:56 Benjamin Jakimow <
benjamin.jakimow at geo.hu-berlin.de> ha scritto:

> Hi Pierluigi,
>
> you need to combine the Flags as binary Or ('|') :
>
> self.overlayLayer_ComboBox.setFilters(QgsMapLayerProxyModel.PointLayer |
> QgsMapLayerProxyModel.LineLayer)
>
> /Benjamin
>
> On 2021-07-12 19:51, pierluigi de rosa wrote:
>
> Dear All,
>
> I'm experiencing some problems with the QgsMapLayerComboBox.
> I would like to filter all line and polygon layer.
> Here below my code:
>
> self.overlayLayer_ComboBox.setFilters(QgsMapLayerProxyModel.PointLayer,QgsMapLayerProxyModel.LineLayer)
>
> But I have and Error. I can add only one layer type. Even the
> QgsmapLayerProxyModel.VectorLayer
> <https://qgis.github.io/pyqgis/3.2/core/Map/QgsMapLayerProxyModel.html?highlight=qgsmaplayerproxymodel%20pointlayer#qgis.core.QgsMapLayerProxyModel.VectorLayer> is
> not suitable.
> I want to show only line and polygon.
> Can anyone help me?
> Thank you
> Pierluigi
> --
> Ing. Pierluigi De Rosa (PhD in Earth Science)
> Contract Professor of Geographic Information System at University of
> Perugia
> cel: 3497558268 / fax: 075 7823038
> skype: pierluigi.derosa
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
>
> --
> --
> Benjamin Jakimow, Doctoral Researcher
> Earth Observation Lab | Geography Department | Humboldt-Universit?t zu
> Berlin
>
> e-mail: benjamin.jakimow at geo.hu-berlin.de
>
> phone:  +49 (0) 30 2093 6894
> mobile: +49 (0) 157 5656 8477
> fax:    +49 (0) 30 2093 6848
> mail:   Unter den Linden 6 | 10099 Berlin | Germany
> room: 2'222
>


-- 
Ing. Pierluigi De Rosa (PhD in Earth Science)
Contract Professor of Geographic Information System at University of Perugia
cel: 3497558268 / fax: 075 7823038
skype: pierluigi.derosa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210713/23d0d97a/attachment.html>

From rdbath.regiodata at gmail.com  Mon Jul 12 23:08:27 2021
From: rdbath.regiodata at gmail.com (Thomas B)
Date: Tue, 13 Jul 2021 08:08:27 +0200
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
In-Reply-To: <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>
References: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
 <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>
 <588313ac-8328-eb6a-2bb3-20dd35a4a32f@gmail.com>
 <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>
Message-ID: <CAD3koGk9X0X8+VzppXo-pbcQ75REpU5_e3Xj-ZX+01owwM1qnQ@mail.gmail.com>

 Hi Alexandre,

    >>This is some old stuff we wrote at Boundless, I believe it still
applies for QGIS today.
    >>
https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators
    >>Both initialisation scripts and global setting file can help you with
what you want to achieve.

The initialisation scripts could be useful. But they don't seem to be
merged into the QGIS repository yet.

regards,
Thomas


Am Mo., 12. Juli 2021 um 10:54 Uhr schrieb Alexandre Neto <
senhor.neto at gmail.com>:

> Hi Bo,
>
> This is some old stuff we wrote at Boundless, I believe it still applies
> for QGIS today.
>
>
> https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators
>
> Both initialisation scripts and global setting file can help you with what
> you want to achieve.
>
> (I should make sure this information is available on docs.qgis.org, but I
> never find the time to do it...)
>
> Best regards,
>
> Alexandre Neto
> User Support
> www.qcooperative.net
>
> A segunda, 12/07/2021, 08:34, Bo Victor Thomsen <
> bo.victor.thomsen at gmail.com> escreveu:
>
>> Hi Thomas -
>>
>> Your suggestion is actually pretty close to the solution I made -
>>
>>    - Standard installation of QGIS with *standard* .msi package.
>>    - After the QGIS installation and before QGIS is started the user do
>>    a one-time run a Python script from et central network drive -  using the
>>    Python interpreter installed together with QGIS  which:
>>    - Unzip a complete profile  with specific plugins and customized
>>       parameters from a central network based repository. This profile replaces
>>       the standard "default" profile.
>>       - Search/replace a couple of "tokenized" values in QGIS.ini with
>>       actual values based on username
>>
>> The profile and tokenized QGIS.ini is prepared by the GIS administrator
>>
>> The Python script is packaged in a .cmd file which is started by the user.
>>
>> Not a perfect solution, but doable:
>>
>>    - The It department is happy: No work doing specialized installations
>>    - The GIS administrator is happy. It's a one-time piece of work for
>>    each QGIS version to  prepare the profile and tokenize the QGIS.ini
>>    - The user is - somewhat - happy. To finish the installation is
>>    simply to double-click once on a file placed in a "highly visible" location.
>>    - Any subsequent mistakes made by the user (Installation of dodgy
>>    plugins, strange changes in setups ....) is easily repaired by running the
>>    Python script again.
>>
>>
>> Med venlig hilsen / Kind regards
>>
>> Bo Victor Thomsen
>>
>> Den 12-07-2021 kl. 03:14 skrev Thomas Gratier:
>>
>> Hi,
>>
>> I'm not aware QSettings provided by Qt can do it. Your %APPDATA% is not
>> portable as would only work on Windows
>>
>> You can always try generate the QGIS.ini file using a templating system
>>
>> File QGIS.ini.j2 with following content
>>
>>
>> Configuration\MODELS_FOLDER={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>
>> Configuration\SCRIPTS_FOLDERS={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>
>>
>> File generate_ini.py with following content
>>
>> import os
>> import jinja2
>>
>> templateLoader = jinja2.FileSystemLoader(searchpath="./")
>> templateEnv = jinja2.Environment(loader=templateLoader)
>> TEMPLATE_FILE = "QGIS.ini.j2"
>> template = templateEnv.get_template(TEMPLATE_FILE)
>> mydict = {
>>     "APPDATA": os.environ.get("APPDATA")
>> }
>> outputText = template.render(**mydict)
>> with open('QGIS.ini', 'w') as outputfile:
>>     outputfile.write(outputText)
>>
>> Then, to write your QGIS.ini file, do
>>
>>
>> python3 generate_ini.py
>>
>>
>> The possible deal breakers with this approach are:
>> - you depend from jinja2, a third party Python library,
>> - you can't later reuse the mechanism if for instance QGIS changes the
>> QGIS.ini file later on
>>
>>
>> Regards
>>
>> Thomas
>>
>>
>> Le mar. 6 juil. 2021 ? 09:18, Bo Victor Thomsen <
>> bo.victor.thomsen at gmail.com> a ?crit :
>>
>>> To the list -
>>>
>>> Is there a method to use OS (Linux, Windows...) environment variables in
>>> the QGIS.ini setup file ?
>>>
>>> I had a number of customers asking for a method to "generalize"
>>> QGIS.ini, so it doesn't contain any "user" specific file and directory
>>> references, i.e
>>>
>>> (From qgis.ini)
>>>
>>> Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor
>>> Thomsen\\AppData\\Roaming*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>> Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor
>>> Thomsen\\AppData\\Roaming*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>>
>>> could be:
>>>
>>> Configuration\MODELS_FOLDER=*%APPDATA%*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>> Configuration\SCRIPTS_FOLDERS=*%APPDATA%*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>>
>>> or likewise.
>>>
>>> The ultimate reason is to have a method to distribute a "standard" setup
>>> for QGIS, complete with plugins and specialized setup parameters. This can
>>> be done by making a standard QGIS installation (which the IT departments
>>> love, especially with the new .msi package) and afterwards replace the
>>> "default" profile directory with at  directory specific for the
>>> organisation. However, the process of making the new profile will place a
>>> lot of file/directory references in QGIS.ini that is specific for the
>>> super-user developing the new profile.
>>>
>>> --
>>> Med venlig hilsen / Kind regards
>>>
>>> Bo Victor Thomsen
>>>
>>> _______________________________________________
>>> QGIS-Developer mailing list
>>> QGIS-Developer at lists.osgeo.org
>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210713/41e3be01/attachment-0001.html>

From senhor.neto at gmail.com  Tue Jul 13 01:44:54 2021
From: senhor.neto at gmail.com (Alexandre Neto)
Date: Tue, 13 Jul 2021 09:44:54 +0100
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
In-Reply-To: <CAD3koGk9X0X8+VzppXo-pbcQ75REpU5_e3Xj-ZX+01owwM1qnQ@mail.gmail.com>
References: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
 <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>
 <588313ac-8328-eb6a-2bb3-20dd35a4a32f@gmail.com>
 <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>
 <CAD3koGk9X0X8+VzppXo-pbcQ75REpU5_e3Xj-ZX+01owwM1qnQ@mail.gmail.com>
Message-ID: <CA+H0G_Eaxca9Mc9ojQ0NZuSTT3umNxMVphphMVK6z-PmREqHLg@mail.gmail.com>

Hi Thomas,

I will check with others and let you know.

Best regards,

Alexandre Neto

A ter?a, 13/07/2021, 07:08, Thomas B <rdbath.regiodata at gmail.com> escreveu:

> Hi Alexandre,
>
>     >>This is some old stuff we wrote at Boundless, I believe it still
> applies for QGIS today.
>     >>
> https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators
>     >>Both initialisation scripts and global setting file can help you
> with what you want to achieve.
>
> The initialisation scripts could be useful. But they don't seem to be
> merged into the QGIS repository yet.
>
> regards,
> Thomas
>
>
> Am Mo., 12. Juli 2021 um 10:54 Uhr schrieb Alexandre Neto <
> senhor.neto at gmail.com>:
>
>> Hi Bo,
>>
>> This is some old stuff we wrote at Boundless, I believe it still applies
>> for QGIS today.
>>
>>
>> https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators
>>
>> Both initialisation scripts and global setting file can help you with
>> what you want to achieve.
>>
>> (I should make sure this information is available on docs.qgis.org, but
>> I never find the time to do it...)
>>
>> Best regards,
>>
>> Alexandre Neto
>> User Support
>> www.qcooperative.net
>>
>> A segunda, 12/07/2021, 08:34, Bo Victor Thomsen <
>> bo.victor.thomsen at gmail.com> escreveu:
>>
>>> Hi Thomas -
>>>
>>> Your suggestion is actually pretty close to the solution I made -
>>>
>>>    - Standard installation of QGIS with *standard* .msi package.
>>>    - After the QGIS installation and before QGIS is started the user do
>>>    a one-time run a Python script from et central network drive -  using the
>>>    Python interpreter installed together with QGIS  which:
>>>    - Unzip a complete profile  with specific plugins and customized
>>>       parameters from a central network based repository. This profile replaces
>>>       the standard "default" profile.
>>>       - Search/replace a couple of "tokenized" values in QGIS.ini with
>>>       actual values based on username
>>>
>>> The profile and tokenized QGIS.ini is prepared by the GIS administrator
>>>
>>> The Python script is packaged in a .cmd file which is started by the
>>> user.
>>>
>>> Not a perfect solution, but doable:
>>>
>>>    - The It department is happy: No work doing specialized installations
>>>    - The GIS administrator is happy. It's a one-time piece of work for
>>>    each QGIS version to  prepare the profile and tokenize the QGIS.ini
>>>    - The user is - somewhat - happy. To finish the installation is
>>>    simply to double-click once on a file placed in a "highly visible" location.
>>>    - Any subsequent mistakes made by the user (Installation of dodgy
>>>    plugins, strange changes in setups ....) is easily repaired by running the
>>>    Python script again.
>>>
>>>
>>> Med venlig hilsen / Kind regards
>>>
>>> Bo Victor Thomsen
>>>
>>> Den 12-07-2021 kl. 03:14 skrev Thomas Gratier:
>>>
>>> Hi,
>>>
>>> I'm not aware QSettings provided by Qt can do it. Your %APPDATA% is not
>>> portable as would only work on Windows
>>>
>>> You can always try generate the QGIS.ini file using a templating system
>>>
>>> File QGIS.ini.j2 with following content
>>>
>>>
>>> Configuration\MODELS_FOLDER={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>>
>>> Configuration\SCRIPTS_FOLDERS={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>>
>>>
>>> File generate_ini.py with following content
>>>
>>> import os
>>> import jinja2
>>>
>>> templateLoader = jinja2.FileSystemLoader(searchpath="./")
>>> templateEnv = jinja2.Environment(loader=templateLoader)
>>> TEMPLATE_FILE = "QGIS.ini.j2"
>>> template = templateEnv.get_template(TEMPLATE_FILE)
>>> mydict = {
>>>     "APPDATA": os.environ.get("APPDATA")
>>> }
>>> outputText = template.render(**mydict)
>>> with open('QGIS.ini', 'w') as outputfile:
>>>     outputfile.write(outputText)
>>>
>>> Then, to write your QGIS.ini file, do
>>>
>>>
>>> python3 generate_ini.py
>>>
>>>
>>> The possible deal breakers with this approach are:
>>> - you depend from jinja2, a third party Python library,
>>> - you can't later reuse the mechanism if for instance QGIS changes the
>>> QGIS.ini file later on
>>>
>>>
>>> Regards
>>>
>>> Thomas
>>>
>>>
>>> Le mar. 6 juil. 2021 ? 09:18, Bo Victor Thomsen <
>>> bo.victor.thomsen at gmail.com> a ?crit :
>>>
>>>> To the list -
>>>>
>>>> Is there a method to use OS (Linux, Windows...) environment variables
>>>> in the QGIS.ini setup file ?
>>>>
>>>> I had a number of customers asking for a method to "generalize"
>>>> QGIS.ini, so it doesn't contain any "user" specific file and directory
>>>> references, i.e
>>>>
>>>> (From qgis.ini)
>>>>
>>>> Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor
>>>> Thomsen\\AppData\\Roaming*
>>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>>> Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor
>>>> Thomsen\\AppData\\Roaming*
>>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>>>
>>>> could be:
>>>>
>>>> Configuration\MODELS_FOLDER=*%APPDATA%*
>>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>>> Configuration\SCRIPTS_FOLDERS=*%APPDATA%*
>>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>>>
>>>> or likewise.
>>>>
>>>> The ultimate reason is to have a method to distribute a "standard"
>>>> setup for QGIS, complete with plugins and specialized setup parameters.
>>>> This can be done by making a standard QGIS installation (which the IT
>>>> departments love, especially with the new .msi package) and afterwards
>>>> replace the "default" profile directory with at  directory specific for the
>>>> organisation. However, the process of making the new profile will place a
>>>> lot of file/directory references in QGIS.ini that is specific for the
>>>> super-user developing the new profile.
>>>>
>>>> --
>>>> Med venlig hilsen / Kind regards
>>>>
>>>> Bo Victor Thomsen
>>>>
>>>> _______________________________________________
>>>> QGIS-Developer mailing list
>>>> QGIS-Developer at lists.osgeo.org
>>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>>
>>> _______________________________________________
>>> QGIS-Developer mailing list
>>> QGIS-Developer at lists.osgeo.org
>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210713/c29194bd/attachment.html>

From etienne.trimaille at gmail.com  Tue Jul 13 07:33:54 2021
From: etienne.trimaille at gmail.com (Etienne Trimaille)
Date: Tue, 13 Jul 2021 16:33:54 +0200
Subject: [QGIS-Developer] Using environment variables in QGIS.ini
In-Reply-To: <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>
References: <06334b9c-b425-b164-2204-cd397c66b078@gmail.com>
 <CACPZzQ0TKRHHtcmnBzCWFNQ0D=QUZwPGjGRHAPeaTFvNXQK5wA@mail.gmail.com>
 <588313ac-8328-eb6a-2bb3-20dd35a4a32f@gmail.com>
 <CA+H0G_F5n7S7hbz5-cR=sF40v93aHkoeV8jMKrpdxhy5k13MBg@mail.gmail.com>
Message-ID: <CAMtDFL+JZmJjmB7OYcp6wkQ8xVzZ2+gSmTFqfqqBH7JxpYqODA@mail.gmail.com>

You might find something useful in this new repository :
https://github.com/haubourg/custom-osgeo4w-qgis/ ?

Le lun. 12 juil. 2021 ? 10:54, Alexandre Neto <senhor.neto at gmail.com> a
?crit :

> Hi Bo,
>
> This is some old stuff we wrote at Boundless, I believe it still applies
> for QGIS today.
>
>
> https://boundless-desktop.readthedocs.io/en/latest/system_admins/index.html#for-system-administrators
>
> Both initialisation scripts and global setting file can help you with what
> you want to achieve.
>
> (I should make sure this information is available on docs.qgis.org, but I
> never find the time to do it...)
>
> Best regards,
>
> Alexandre Neto
> User Support
> www.qcooperative.net
>
> A segunda, 12/07/2021, 08:34, Bo Victor Thomsen <
> bo.victor.thomsen at gmail.com> escreveu:
>
>> Hi Thomas -
>>
>> Your suggestion is actually pretty close to the solution I made -
>>
>>    - Standard installation of QGIS with *standard* .msi package.
>>    - After the QGIS installation and before QGIS is started the user do
>>    a one-time run a Python script from et central network drive -  using the
>>    Python interpreter installed together with QGIS  which:
>>    - Unzip a complete profile  with specific plugins and customized
>>       parameters from a central network based repository. This profile replaces
>>       the standard "default" profile.
>>       - Search/replace a couple of "tokenized" values in QGIS.ini with
>>       actual values based on username
>>
>> The profile and tokenized QGIS.ini is prepared by the GIS administrator
>>
>> The Python script is packaged in a .cmd file which is started by the user.
>>
>> Not a perfect solution, but doable:
>>
>>    - The It department is happy: No work doing specialized installations
>>    - The GIS administrator is happy. It's a one-time piece of work for
>>    each QGIS version to  prepare the profile and tokenize the QGIS.ini
>>    - The user is - somewhat - happy. To finish the installation is
>>    simply to double-click once on a file placed in a "highly visible" location.
>>    - Any subsequent mistakes made by the user (Installation of dodgy
>>    plugins, strange changes in setups ....) is easily repaired by running the
>>    Python script again.
>>
>>
>> Med venlig hilsen / Kind regards
>>
>> Bo Victor Thomsen
>>
>> Den 12-07-2021 kl. 03:14 skrev Thomas Gratier:
>>
>> Hi,
>>
>> I'm not aware QSettings provided by Qt can do it. Your %APPDATA% is not
>> portable as would only work on Windows
>>
>> You can always try generate the QGIS.ini file using a templating system
>>
>> File QGIS.ini.j2 with following content
>>
>>
>> Configuration\MODELS_FOLDER={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>
>> Configuration\SCRIPTS_FOLDERS={{APPDATA}}\\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>
>>
>> File generate_ini.py with following content
>>
>> import os
>> import jinja2
>>
>> templateLoader = jinja2.FileSystemLoader(searchpath="./")
>> templateEnv = jinja2.Environment(loader=templateLoader)
>> TEMPLATE_FILE = "QGIS.ini.j2"
>> template = templateEnv.get_template(TEMPLATE_FILE)
>> mydict = {
>>     "APPDATA": os.environ.get("APPDATA")
>> }
>> outputText = template.render(**mydict)
>> with open('QGIS.ini', 'w') as outputfile:
>>     outputfile.write(outputText)
>>
>> Then, to write your QGIS.ini file, do
>>
>>
>> python3 generate_ini.py
>>
>>
>> The possible deal breakers with this approach are:
>> - you depend from jinja2, a third party Python library,
>> - you can't later reuse the mechanism if for instance QGIS changes the
>> QGIS.ini file later on
>>
>>
>> Regards
>>
>> Thomas
>>
>>
>> Le mar. 6 juil. 2021 ? 09:18, Bo Victor Thomsen <
>> bo.victor.thomsen at gmail.com> a ?crit :
>>
>>> To the list -
>>>
>>> Is there a method to use OS (Linux, Windows...) environment variables in
>>> the QGIS.ini setup file ?
>>>
>>> I had a number of customers asking for a method to "generalize"
>>> QGIS.ini, so it doesn't contain any "user" specific file and directory
>>> references, i.e
>>>
>>> (From qgis.ini)
>>>
>>> Configuration\MODELS_FOLDER=*C:\\Users\\Bo Victor
>>> Thomsen\\AppData\\Roaming*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>> Configuration\SCRIPTS_FOLDERS=*C:\\Users\\Bo Victor
>>> Thomsen\\AppData\\Roaming*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>>
>>> could be:
>>>
>>> Configuration\MODELS_FOLDER=*%APPDATA%*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\models
>>> Configuration\SCRIPTS_FOLDERS=*%APPDATA%*
>>> \\QGIS\\QGIS3\\profiles\\default\\processing\\scripts
>>>
>>> or likewise.
>>>
>>> The ultimate reason is to have a method to distribute a "standard" setup
>>> for QGIS, complete with plugins and specialized setup parameters. This can
>>> be done by making a standard QGIS installation (which the IT departments
>>> love, especially with the new .msi package) and afterwards replace the
>>> "default" profile directory with at  directory specific for the
>>> organisation. However, the process of making the new profile will place a
>>> lot of file/directory references in QGIS.ini that is specific for the
>>> super-user developing the new profile.
>>>
>>> --
>>> Med venlig hilsen / Kind regards
>>>
>>> Bo Victor Thomsen
>>>
>>> _______________________________________________
>>> QGIS-Developer mailing list
>>> QGIS-Developer at lists.osgeo.org
>>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>>
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210713/b55d0c2d/attachment-0001.html>

From nyall.dawson at gmail.com  Wed Jul 14 21:56:23 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Thu, 15 Jul 2021 14:56:23 +1000
Subject: [QGIS-Developer] =?utf-8?q?tkinter_didn=E2=80=99t_work?=
In-Reply-To: <CAA7KAT=_EGLzOYYZEyGtaMAs818Tdg_7W34bAmErsKZt+jxiAA@mail.gmail.com>
References: <CAA7KAT=_EGLzOYYZEyGtaMAs818Tdg_7W34bAmErsKZt+jxiAA@mail.gmail.com>
Message-ID: <CAB28Asjj5Ry8VYZmnKMs_TqhEqdW48T2tXs8c+P2vucfxuBzJQ@mail.gmail.com>

On Tue, 6 Jul 2021 at 02:03, Joao Folgado <jfolgado94 at gmail.com> wrote:
>
> Hi Qgis Developers !
>
> In a plugin I tried to use a if statement that while ask something to the user.
> My ideia is to us tkinter but the library did not exist.
>
> Do any one know who to use Tkinter in Qgis plugin ?

Don't use it! QGIS is built on the Qt library, so all GUI components
like message boxes should be made using PyQt instead.

Nyall

>
> Best Regards,
> Jo?o Folgado
> --
> JO?O FOLGADO
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

From a.neumann at carto.net  Wed Jul 14 23:33:22 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Thu, 15 Jul 2021 08:33:22 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
Message-ID: <1de92cab2abc35c35369c05723aed500@carto.net>

Hi,

I have a bunch of MS Excel .xls files in the old format (hundreds of 
files), not the new .xlsx format.

The content of the .xls files seems to be UTF-8 encoded, but QGIS loads 
them with some LATIN-x encoding - all of the non-ASCII-characters look 
garbled.

I want to process these files with Processing and merge them into one 
file.

Is there any way how I can load these files with the correct UTF-8 
encoding? I know, there is an algorithm to set the correct encoding of a 
layer in processing, but unfortunately this doesn't work with 
multi-layer input, only with single layer input.

Is there some OGR trick (environment variable or opening option) to load 
the files with correct encoding?

Thanks if you have any hint,

Andreas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/a8d36438/attachment.html>

From a.neumann at carto.net  Wed Jul 14 23:56:00 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Thu, 15 Jul 2021 08:56:00 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <1de92cab2abc35c35369c05723aed500@carto.net>
References: <1de92cab2abc35c35369c05723aed500@carto.net>
Message-ID: <5daf014635e066726c2f551678815e58@carto.net>

Hi again,

I tried to set the layer encoding after the layer merging, but it fails 
;-(

And before the layer merging I cannot set the encoding in the model, 
because it only accepts a single layer as input, and not multiple 
layers.

So it seems that I will have to set the correct encoding right away from 
the beginning on - but I don't know how.

Thanks,

Andreas

On 2021-07-15 08:33, Andreas Neumann wrote:

> Hi,
> 
> I have a bunch of MS Excel .xls files in the old format (hundreds of 
> files), not the new .xlsx format.
> 
> The content of the .xls files seems to be UTF-8 encoded, but QGIS loads 
> them with some LATIN-x encoding - all of the non-ASCII-characters look 
> garbled.
> 
> I want to process these files with Processing and merge them into one 
> file.
> 
> Is there any way how I can load these files with the correct UTF-8 
> encoding? I know, there is an algorithm to set the correct encoding of 
> a layer in processing, but unfortunately this doesn't work with 
> multi-layer input, only with single layer input.
> 
> Is there some OGR trick (environment variable or opening option) to 
> load the files with correct encoding?
> 
> Thanks if you have any hint,
> 
> Andreas
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/d4c81d9e/attachment.html>

From a.neumann at carto.net  Thu Jul 15 00:11:28 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Thu, 15 Jul 2021 09:11:28 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <5daf014635e066726c2f551678815e58@carto.net>
References: <1de92cab2abc35c35369c05723aed500@carto.net>
 <5daf014635e066726c2f551678815e58@carto.net>
Message-ID: <7824c9d36a8c131e0d5680d33d9a2cbb@carto.net>

Hi,

Seems like when I load the same file from the newer .xlsx format then 
the encoding is fine.

Now I need to find a way how to batch-convert all of the many .xls to 
.xlsx files automatically.

Still I find it disturbing that QGIS doesn't allow me to load the older 
.xls files with correct encoding without manual intervention.

Andreas

On 2021-07-15 08:56, Andreas Neumann wrote:

> Hi again,
> 
> I tried to set the layer encoding after the layer merging, but it fails 
> ;-(
> 
> And before the layer merging I cannot set the encoding in the model, 
> because it only accepts a single layer as input, and not multiple 
> layers.
> 
> So it seems that I will have to set the correct encoding right away 
> from the beginning on - but I don't know how.
> 
> Thanks,
> 
> Andreas
> 
> On 2021-07-15 08:33, Andreas Neumann wrote:
> 
>> Hi,
>> 
>> I have a bunch of MS Excel .xls files in the old format (hundreds of 
>> files), not the new .xlsx format.
>> 
>> The content of the .xls files seems to be UTF-8 encoded, but QGIS 
>> loads them with some LATIN-x encoding - all of the 
>> non-ASCII-characters look garbled.
>> 
>> I want to process these files with Processing and merge them into one 
>> file.
>> 
>> Is there any way how I can load these files with the correct UTF-8 
>> encoding? I know, there is an algorithm to set the correct encoding of 
>> a layer in processing, but unfortunately this doesn't work with 
>> multi-layer input, only with single layer input.
>> 
>> Is there some OGR trick (environment variable or opening option) to 
>> load the files with correct encoding?
>> 
>> Thanks if you have any hint,
>> 
>> Andreas
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> 
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/e3f8a24a/attachment.html>

From nyall.dawson at gmail.com  Thu Jul 15 00:33:32 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Thu, 15 Jul 2021 17:33:32 +1000
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <7824c9d36a8c131e0d5680d33d9a2cbb@carto.net>
References: <1de92cab2abc35c35369c05723aed500@carto.net>
 <5daf014635e066726c2f551678815e58@carto.net>
 <7824c9d36a8c131e0d5680d33d9a2cbb@carto.net>
Message-ID: <CAB28Asipia399e9L_hChFzumw7+sebwD-jLSNYFMs2Ssuurv1Q@mail.gmail.com>

On Thu, 15 Jul 2021 at 17:12, Andreas Neumann <a.neumann at carto.net> wrote:
>
> Hi,
>
> Seems like when I load the same file from the newer .xlsx format then the encoding is fine.
>
> Now I need to find a way how to batch-convert all of the many .xls to .xlsx files automatically.
>
> Still I find it disturbing that QGIS doesn't allow me to load the older .xls files with correct encoding without manual intervention.

Isn't this limitation ultimately that GDAL isn't reading the encoding
correctly? (Or perhaps it's a limitation in the underlying freexl
library...)

Nyall

>
> Andreas
>
> On 2021-07-15 08:56, Andreas Neumann wrote:
>
> Hi again,
>
> I tried to set the layer encoding after the layer merging, but it fails ;-(
>
> And before the layer merging I cannot set the encoding in the model, because it only accepts a single layer as input, and not multiple layers.
>
> So it seems that I will have to set the correct encoding right away from the beginning on - but I don't know how.
>
> Thanks,
>
> Andreas
>
> On 2021-07-15 08:33, Andreas Neumann wrote:
>
> Hi,
>
> I have a bunch of MS Excel .xls files in the old format (hundreds of files), not the new .xlsx format.
>
> The content of the .xls files seems to be UTF-8 encoded, but QGIS loads them with some LATIN-x encoding - all of the non-ASCII-characters look garbled.
>
> I want to process these files with Processing and merge them into one file.
>
> Is there any way how I can load these files with the correct UTF-8 encoding? I know, there is an algorithm to set the correct encoding of a layer in processing, but unfortunately this doesn't work with multi-layer input, only with single layer input.
>
> Is there some OGR trick (environment variable or opening option) to load the files with correct encoding?
>
> Thanks if you have any hint,
>
> Andreas
>
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
>
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

From a.neumann at carto.net  Thu Jul 15 01:02:16 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Thu, 15 Jul 2021 10:02:16 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <CAB28Asipia399e9L_hChFzumw7+sebwD-jLSNYFMs2Ssuurv1Q@mail.gmail.com>
References: <1de92cab2abc35c35369c05723aed500@carto.net>
 <5daf014635e066726c2f551678815e58@carto.net>
 <7824c9d36a8c131e0d5680d33d9a2cbb@carto.net>
 <CAB28Asipia399e9L_hChFzumw7+sebwD-jLSNYFMs2Ssuurv1Q@mail.gmail.com>
Message-ID: <6d3d6cd799f783d7505e7969bd1f449e@carto.net>

> Isn't this limitation ultimately that GDAL isn't reading the encoding
> correctly? (Or perhaps it's a limitation in the underlying freexl
> library...)

Yes - I also assume it is a limitation of OGR or FreeXL. I was hoping 
that some secret OGR opening option, environment variable or sidecar 
file could do the trick ...

Never mind - I found a solution to convert my hundreds of .xls to .xlsx 
(with VBA code in Excel) and when I load the .xlsx, the encoding is 
loaded fine in QGIS.

For reference: here is the VBA-Code for the batch conversion in Excel: 
https://www.extendoffice.com/documents/excel/1349-excel-batch-convert-xls-to-xlsx.html#a2

In general, I think that the handling of spreadsheet file loading in 
QGIS could be much improved - similar to the plugin "Spreadsheet Layers" 
from Arnaud 
(https://plugins.qgis.org/plugins/SpreadsheetLayers/version/2.0.1/).

My assumption is that Excel/Openoffice files are so popular among our 
users that it would really nice if we could improve the situation 
susbstantially. Otherwise we are always forcing our users to save the 
spreadsheet files to CSV first - which has a lot of loading options, but 
has it's own limitations.

Thanks anyway - my problem is now solved by previous conversion of the 
files to .xlsx.

Andreas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/67bed251/attachment.html>

From a.neumann at carto.net  Thu Jul 15 02:25:00 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Thu, 15 Jul 2021 11:25:00 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <CAB28AsjJuB72O=+FjFe=u3o7gYh0a+4ZEROK8GsufufWq_Jo-g@mail.gmail.com>
References: <1de92cab2abc35c35369c05723aed500@carto.net>
 <5daf014635e066726c2f551678815e58@carto.net>
 <7824c9d36a8c131e0d5680d33d9a2cbb@carto.net>
 <CAB28Asipia399e9L_hChFzumw7+sebwD-jLSNYFMs2Ssuurv1Q@mail.gmail.com>
 <6d3d6cd799f783d7505e7969bd1f449e@carto.net>
 <CAB28AsjJuB72O=+FjFe=u3o7gYh0a+4ZEROK8GsufufWq_Jo-g@mail.gmail.com>
Message-ID: <f7804bab03bea2764636e0499707454b@carto.net>

Hi all,

Thank you Nyall for checking the situation around codepage and 
freexl/OGR.

Let's plan to improve the situation around spreadsheet data loading in 
future OGR and QGIS versions.

We can start with a QEP collecting all the requirements around the 
spreadsheet data loading and an easy conversion of a non-geometry layer 
to a geometry layer.

Then we can have a look what FreeXL/OGR could improve and what needs to 
be done in QGIS.

After we have this collection of requirements, we can see what this 
would cost, who could implement what and who can fund the work.

@Rosa: thank you for your suggestion with Python/Pandas. I already found 
a solution through batch conversion (.xls to .xlsx) first (with some VBA 
code).

So my situation is ok now, but I think we should improve the situation 
for our users in the future.

Thanks all for the input,

Andreas

On 2021-07-15 10:33, Nyall Dawson wrote:

> On Thu, 15 Jul 2021, 6:02 pm Andreas Neumann, <a.neumann at carto.net> 
> wrote:
> 
> Isn't this limitation ultimately that GDAL isn't reading the encoding
> correctly? (Or perhaps it's a limitation in the underlying freexl
> library...)
> 
> Yes - I also assume it is a limitation of OGR or FreeXL. I was hoping 
> that some secret OGR opening option, environment variable or sidecar 
> file could do the trick ...

I just checked -- it's a gdal bug. Freexl supports reading the codepage 
from the xls file, but gdal doesn't do this and doesn't respect the 
codepage when reading string values.

> Never mind - I found a solution to convert my hundreds of .xls to .xlsx 
> (with VBA code in Excel) and when I load the .xlsx, the encoding is 
> loaded fine in QGIS.
> 
> For reference: here is the VBA-Code for the batch conversion in Excel: 
> https://www.extendoffice.com/documents/excel/1349-excel-batch-convert-xls-to-xlsx.html#a2
> 
> In general, I think that the handling of spreadsheet file loading in 
> QGIS could be much improved - similar to the plugin "Spreadsheet 
> Layers" from Arnaud 
> (https://plugins.qgis.org/plugins/SpreadsheetLayers/version/2.0.1/).
> 
> My assumption is that Excel/Openoffice files are so popular among our 
> users that it would really nice if we could improve the situation 
> susbstantially. Otherwise we are always forcing our users to save the 
> spreadsheet files to CSV first - which has a lot of loading options, 
> but has it's own limitations.

Yeah, I agree. I'd like to see an easy way to turn ANY non spatial layer 
into a spatial layer via some "virtual" geometry column. Maybe for non 
spatial sources we could add a "geometry" tab in the layer properties 
which lets users pick the X/y/z/m/wkt etc fields....

> Thanks anyway - my problem is now solved by previous conversion of the 
> files to .xlsx.
> 
> Andreas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/83d578de/attachment.html>

From hghklly at gmail.com  Thu Jul 15 06:00:37 2021
From: hghklly at gmail.com (Hugh Kelley)
Date: Thu, 15 Jul 2021 09:00:37 -0400
Subject: [QGIS-Developer] QGIS daily use and development set up
Message-ID: <CAOrcXHGu6pkbm-oEuudiL+jzJphVcSMiadXZKRFrgPXE-ct3Fg@mail.gmail.com>

Hi all,

I am a daily QGIS user for work in addition to a variety of programming
tasks i'm responsible for . I would like to begin spending some time
developing QGIS plugins and contributing to the documentation.  I am trying
to figure out the best way to set things up on my computer.

because I use QGIS LTR for daily mapping tasks, I need to be very confident
that nothing I do development-wise will affect the QGIS install I use for
those mapping tasks.

Does anyone have a similar situation? What has been your workflow? I am
using a windows 10 computer, with WSL for my python needs. I could set up
an entirely separate VM especially if a linux machine would be heavily
recommended, Would a dedicated windows Python venv for QGIS development be
sufficient?

Thanks for any and all suggestions!

Hugh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/dcf48268/attachment.html>

From apasotti at gmail.com  Thu Jul 15 06:24:55 2021
From: apasotti at gmail.com (Alessandro Pasotti)
Date: Thu, 15 Jul 2021 15:24:55 +0200
Subject: [QGIS-Developer] QGIS daily use and development set up
In-Reply-To: <CAOrcXHGu6pkbm-oEuudiL+jzJphVcSMiadXZKRFrgPXE-ct3Fg@mail.gmail.com>
References: <CAOrcXHGu6pkbm-oEuudiL+jzJphVcSMiadXZKRFrgPXE-ct3Fg@mail.gmail.com>
Message-ID: <CAL5Q673D5sMCyC5eQUEZi7rm0p0FV4wsPFphvXK=gz7LgT9f7w@mail.gmail.com>

On Thu, Jul 15, 2021 at 3:00 PM Hugh Kelley <hghklly at gmail.com> wrote:

> Hi all,
>
> I am a daily QGIS user for work in addition to a variety of programming
> tasks i'm responsible for . I would like to begin spending some time
> developing QGIS plugins and contributing to the documentation.  I am trying
> to figure out the best way to set things up on my computer.
>
> because I use QGIS LTR for daily mapping tasks, I need to be very
> confident that nothing I do development-wise will affect the QGIS install I
> use for those mapping tasks.
>
> Does anyone have a similar situation? What has been your workflow? I am
> using a windows 10 computer, with WSL for my python needs. I could set up
> an entirely separate VM especially if a linux machine would be heavily
> recommended, Would a dedicated windows Python venv for QGIS development be
> sufficient?
>

A new user profile is enough to insulate python plugins.


-- 
Alessandro Pasotti
QCooperative:  www.qcooperative.net
ItOpen:   www.itopen.it
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/8dad8bbf/attachment.html>

From andreaerdna at libero.it  Thu Jul 15 11:51:51 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Thu, 15 Jul 2021 20:51:51 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
Message-ID: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>

> Isn't this limitation ultimately that GDAL isn't reading the encoding
> correctly? (Or perhaps it's a limitation in the underlying freexl
> library...)
> 
> Nyall


Hi Nyall and Andreas,
it seems to me GDAL/OGR [1] reads XLS and XLSX files with the relative 
proper encoding [2] and ogrinfo outputs the text in UTF-8 for both the 
formats.

Instead, QGIS imports correctly XLSX files as UTF-8 encoded, while XLS 
files are wrongly imported as "system" encoded, even selecting UTF-8 [3] 
encoding in the Data Source Manager vector import window.

After importing a XLS file, changing the "Data source encoding" of the 
layer to "UTF-8" fixes the text codecs in my tests.

So, I think QGIS should automatically import also XLS files as UTF-8 
encoded.

Best regards.

Andrea Giudiceandrea

[1] tested on Windows /OSGeo4W: GDAL 3.1.4 / FreeXL 1.0.2 / Expat 2.1.0 
and GDAL 3.2.2 / FreeXL 1.0.6 / Expat 2.2.10
[2] text in XLS (BIFF8) files are internally encoded in UTF-16LE
[3] by the way, there are incorrectly two "UTF-8" codecs listed in the 
"Encoding" drop down menu list...

From andreaerdna at libero.it  Thu Jul 15 12:51:13 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Thu, 15 Jul 2021 21:51:13 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
References: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
Message-ID: <f0dc25a4-3ba0-9d09-64c5-dd876189e376@libero.it>

Il 15/07/2021 20:51, Andrea Giudiceandrea ha scritto:
> Instead, QGIS imports correctly XLSX files as UTF-8 encoded, while XLS 
> files are wrongly imported as "system" encoded, even selecting UTF-8 [3] 
> encoding in the Data Source Manager vector import window.

Looking at GDA/OGR code, I see that the layer imported via XLSX driver 
advertise the UTF-8 strings (OLCStringsAsUTF8) in the capabilities, 
while an XLS layer does not.

So, this could be the underlying root cause of the issue.

Regards.

Andrea

From even.rouault at spatialys.com  Thu Jul 15 13:10:57 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 15 Jul 2021 22:10:57 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <f0dc25a4-3ba0-9d09-64c5-dd876189e376@libero.it>
References: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
 <f0dc25a4-3ba0-9d09-64c5-dd876189e376@libero.it>
Message-ID: <2e62ad42-7946-2603-3f17-0ea004ad4b01@spatialys.com>


Le 15/07/2021 ? 21:51, Andrea Giudiceandrea a ?crit?:
> Il 15/07/2021 20:51, Andrea Giudiceandrea ha scritto:
>> Instead, QGIS imports correctly XLSX files as UTF-8 encoded, while 
>> XLS files are wrongly imported as "system" encoded, even selecting 
>> UTF-8 [3] encoding in the Data Source Manager vector import window.
>
> Looking at GDA/OGR code, I see that the layer imported via XLSX driver 
> advertise the UTF-8 strings (OLCStringsAsUTF8) in the capabilities, 
> while an XLS layer does not.
>
> So, this could be the underlying root cause of the issue.
Good catch! Could you issue a PR to fix this ?
>
> Regards.
>
> Andrea
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From nyall.dawson at gmail.com  Thu Jul 15 13:30:33 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Fri, 16 Jul 2021 06:30:33 +1000
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
References: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
Message-ID: <CAB28Asj6KYZ3qha=LCUvaYJVDVPiQxAxnhgay_f1edwFO5uZDg@mail.gmail.com>

On Fri, 16 Jul 2021, 4:52 am Andrea Giudiceandrea, <andreaerdna at libero.it>
wrote:

> > Isn't this limitation ultimately that GDAL isn't reading the encoding
> > correctly? (Or perhaps it's a limitation in the underlying freexl
> > library...)
> >
> > Nyall
>
>
> Hi Nyall and Andreas,
> it seems to me GDAL/OGR [1] reads XLS and XLSX files with the relative
> proper encoding [2] and ogrinfo outputs the text in UTF-8 for both the
> formats.
>

I don't think that's completely correct -- looking at the freexl
documentation it seems that only some xls file versions are utf8, and
others have a codepage indicating the encoding which needs to be read from
the xls metadata:

"Any BIFF version from BIFF2 to BIFF5 simply supports CodePage based
character encoding, i.e. each character
simply requires 8 bits to be represented (single byte). Correct
representation of characters requires knowing which
one CodePage table has to be applied. This can be determined from the
workbook or worksheet metadata (it is the
CODEPAGE record).
BIFF8 is much more sophisticated, since any text string is usually encoded
as Unicode in UTF-16 Little Endian
[UTF-16LE] format. This encoding is a multi-byte encoding (two bytes are
required to represent a single character),
but being universal no character table is required."

Nyall




> Instead, QGIS imports correctly XLSX files as UTF-8 encoded, while XLS
> files are wrongly imported as "system" encoded, even selecting UTF-8 [3]
> encoding in the Data Source Manager vector import window.
>
> After importing a XLS file, changing the "Data source encoding" of the
> layer to "UTF-8" fixes the text codecs in my tests.
>
> So, I think QGIS should automatically import also XLS files as UTF-8
> encoded.
>
> Best regards.
>
> Andrea Giudiceandrea
>
> [1] tested on Windows /OSGeo4W: GDAL 3.1.4 / FreeXL 1.0.2 / Expat 2.1.0
> and GDAL 3.2.2 / FreeXL 1.0.6 / Expat 2.2.10
> [2] text in XLS (BIFF8) files are internally encoded in UTF-16LE
> [3] by the way, there are incorrectly two "UTF-8" codecs listed in the
> "Encoding" drop down menu list...
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210716/308239a4/attachment.html>

From even.rouault at spatialys.com  Thu Jul 15 14:11:45 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 15 Jul 2021 23:11:45 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <CAB28Asj6KYZ3qha=LCUvaYJVDVPiQxAxnhgay_f1edwFO5uZDg@mail.gmail.com>
References: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
 <CAB28Asj6KYZ3qha=LCUvaYJVDVPiQxAxnhgay_f1edwFO5uZDg@mail.gmail.com>
Message-ID: <bea3df60-f637-f88e-43da-b017d1e6e5aa@spatialys.com>


Le 15/07/2021 ? 22:30, Nyall Dawson a ?crit?:
>
>
> On Fri, 16 Jul 2021, 4:52 am Andrea Giudiceandrea, 
> <andreaerdna at libero.it <mailto:andreaerdna at libero.it>> wrote:
>
>     > Isn't this limitation ultimately that GDAL isn't reading the
>     encoding
>     > correctly? (Or perhaps it's a limitation in the underlying freexl
>     > library...)
>     >
>     > Nyall
>
>
>     Hi Nyall and Andreas,
>     it seems to me GDAL/OGR [1] reads XLS and XLSX files with the
>     relative
>     proper encoding [2] and ogrinfo outputs the text in UTF-8 for both
>     the
>     formats.
>
>
> I don't think that's completely correct -- looking at the freexl 
> documentation it seems that only some xls file versions are utf8, and 
> others have a codepage indicating the encoding which needs to be read 
> from the xls metadata:
>
> "Any BIFF version from BIFF2 to BIFF5 simply supports CodePage based 
> character encoding, i.e. each character
> simply requires 8 bits to be represented (single byte). Correct 
> representation of characters requires knowing which
> one CodePage table has to be applied. This can be determined from the 
> workbook or worksheet metadata (it is the
> CODEPAGE record).
> BIFF8 is much more sophisticated, since any text string is usually 
> encoded as Unicode in UTF-16 Little Endian
> [UTF-16LE] format. This encoding is a multi-byte encoding (two bytes 
> are required to represent a single character),
> but being universal no character table is required."
Yes, but FreeXL does the recoding to UTF-8
>
> Nyall
>
>
>
>
>     Instead, QGIS imports correctly XLSX files as UTF-8 encoded, while
>     XLS
>     files are wrongly imported as "system" encoded, even selecting
>     UTF-8 [3]
>     encoding in the Data Source Manager vector import window.
>
>     After importing a XLS file, changing the "Data source encoding" of
>     the
>     layer to "UTF-8" fixes the text codecs in my tests.
>
>     So, I think QGIS should automatically import also XLS files as UTF-8
>     encoded.
>
>     Best regards.
>
>     Andrea Giudiceandrea
>
>     [1] tested on Windows /OSGeo4W: GDAL 3.1.4 / FreeXL 1.0.2 / Expat
>     2.1.0
>     and GDAL 3.2.2 / FreeXL 1.0.6 / Expat 2.2.10
>     [2] text in XLS (BIFF8) files are internally encoded in UTF-16LE
>     [3] by the way, there are incorrectly two "UTF-8" codecs listed in
>     the
>     "Encoding" drop down menu list...
>     _______________________________________________
>     QGIS-Developer mailing list
>     QGIS-Developer at lists.osgeo.org <mailto:QGIS-Developer at lists.osgeo.org>
>     List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>     Unsubscribe:
>     https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210715/ab921924/attachment.html>

From andreaerdna at libero.it  Thu Jul 15 14:14:48 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Thu, 15 Jul 2021 23:14:48 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <CAB28Asj6KYZ3qha=LCUvaYJVDVPiQxAxnhgay_f1edwFO5uZDg@mail.gmail.com>
References: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
 <CAB28Asj6KYZ3qha=LCUvaYJVDVPiQxAxnhgay_f1edwFO5uZDg@mail.gmail.com>
Message-ID: <5f0e6ec7-7a21-cb71-ce46-18a4afc09bbe@libero.it>

Il 15/07/2021 22:30, Nyall Dawson ha scritto:
> I don't think that's completely correct -- looking at the freexl 
> documentation it seems that only some xls file versions are utf8, and 
> others have a codepage indicating the encoding which needs to be read 
> from the xls metadata:

Yes, of course BIFF5 (and previous versions), which is used until Excel 
95, stores internally the strings with a codepage based encoding, while 
BIFF8 (since Excel 98), stores them internally as UTF-16LE without the 
need of codepages.

Anyway the documentation states that: "FreeXL is intended to be strictly 
interoperable with SQLite and SpatiaLite, so any text string has to be 
converted to UTF-8 encoding.  GNU libiconv can easily handle any 
required charset conversion. So we can simply fetch the appropriate 
bytes, then call iconv() as appropriate, and we'll immediately get back 
the corresponding UTF-8 encoded text string."

So, if I'm not mistaken, the decoding from the proper internal codec and 
the encoding to UTF-8 is handled by the FreeXL library for both 
BIFF2/BIFF5 and BIFF8.
I've also tested a BIFF5 XLS using ogrinfo, and the output is UTF-8 
encoded, while internally

Regards.

Andrea

From kimaidou at gmail.com  Fri Jul 16 02:32:38 2021
From: kimaidou at gmail.com (kimaidou)
Date: Fri, 16 Jul 2021 11:32:38 +0200
Subject: [QGIS-Developer] Processing script to audit all projects in a
 directory and subdirectories
Message-ID: <CAMKXKO7o4epphBO7x4vPB9LXPwBErP3Pqei7sBNmhT3HqieXZQ@mail.gmail.com>

Hi all !

I just published a WIP processing script I created to audit all the
projects found in a local directory (and subdirectories).
I think it can be useful in different contexts, and if you enough people
find it interesting, I could add it to the QGIS Resource sharing repository.

See a full README here:
https://gist.github.com/mdouchin/cd89a259d3560635d4bb8708ad430caa/

PS: obviously it can be improved, as any piece of code ;) but I think it is
mature enough to be shared

Regards
Micha?l
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210716/8e782e0d/attachment.html>

From a.neumann at carto.net  Fri Jul 16 02:51:56 2021
From: a.neumann at carto.net (Andreas Neumann)
Date: Fri, 16 Jul 2021 11:51:56 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <5f0e6ec7-7a21-cb71-ce46-18a4afc09bbe@libero.it>
References: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
 <CAB28Asj6KYZ3qha=LCUvaYJVDVPiQxAxnhgay_f1edwFO5uZDg@mail.gmail.com>
 <5f0e6ec7-7a21-cb71-ce46-18a4afc09bbe@libero.it>
Message-ID: <80a318993df306e29fc871f6baba7b3a@carto.net>

Hi all and thanks for the discussion,

Even and I discovered that the .xls files are loading with correct 
encoding in Linux but not on Windows which leads to the assumption that 
freexl on Windows might not have been correctly compiled/linked against 
iconv.

Something that maybe J?rgen could clarify?

Thanks,

Andreas

On 2021-07-15 23:14, Andrea Giudiceandrea wrote:

> Il 15/07/2021 22:30, Nyall Dawson ha scritto:
> 
>> I don't think that's completely correct -- looking at the freexl 
>> documentation it seems that only some xls file versions are utf8, and 
>> others have a codepage indicating the encoding which needs to be read 
>> from the xls metadata:
> 
> Yes, of course BIFF5 (and previous versions), which is used until Excel 
> 95, stores internally the strings with a codepage based encoding, while 
> BIFF8 (since Excel 98), stores them internally as UTF-16LE without the 
> need of codepages.
> 
> Anyway the documentation states that: "FreeXL is intended to be 
> strictly interoperable with SQLite and SpatiaLite, so any text string 
> has to be converted to UTF-8 encoding.  GNU libiconv can easily handle 
> any required charset conversion. So we can simply fetch the appropriate 
> bytes, then call iconv() as appropriate, and we'll immediately get back 
> the corresponding UTF-8 encoded text string."
> 
> So, if I'm not mistaken, the decoding from the proper internal codec 
> and the encoding to UTF-8 is handled by the FreeXL library for both 
> BIFF2/BIFF5 and BIFF8.
> I've also tested a BIFF5 XLS using ogrinfo, and the output is UTF-8 
> encoded, while internally
> 
> Regards.
> 
> Andrea
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210716/fdf2ae37/attachment.html>

From andreaerdna at libero.it  Fri Jul 16 04:50:16 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Fri, 16 Jul 2021 13:50:16 +0200
Subject: [QGIS-Developer] Loading many Excel-Files in QGIS with correct
 encoding
In-Reply-To: <80a318993df306e29fc871f6baba7b3a@carto.net>
References: <2280f939-4710-a09f-0c28-7436bfee6e61@libero.it>
 <CAB28Asj6KYZ3qha=LCUvaYJVDVPiQxAxnhgay_f1edwFO5uZDg@mail.gmail.com>
 <5f0e6ec7-7a21-cb71-ce46-18a4afc09bbe@libero.it>
 <80a318993df306e29fc871f6baba7b3a@carto.net>
Message-ID: <75905c7a-d22c-d5c9-e8c0-4109b47b9078@libero.it>

Il 16/07/2021 11:51, Andreas Neumann ha scritto:
> Hi all and thanks for the discussion,
> 
> Even and I discovered that the .xls files are loading with correct 
> encoding in Linux but not on Windows which leads to the assumption that 
> freexl on Windows might not have been correctly compiled/linked against 
> iconv.

Hi Andreas,
usually on GNU/Linux distributions the "system" encoding is UTF-8, while 
on Windows is the "ANSI" encoding (e.g. Windows-1252 for Western Europe 
locales).

So I think that since XLS layers are imported in QGIS using the "system" 
encoding, and since FreeXL translates the strings values to UTF-8 and 
GDAL/OGR exposes such strings values as they are passed by FreeXL, then 
XLS tables are correctly displayed in QGIS on GNU/Linux systems, while 
are incorrectly displayed in QGIS on Windows systems.

You can test your xls files on Windows using ogrinfo in the OSGeo4W Shell:

ogrinfo path\to\file.xls sheet_name > path\to\file.txt

then you can check if file.txt will contain the string cell values UTF-8 
encoded.

Or you can use the ogr module from osgeo in the QGIS Python Console on 
Windows to open the XLS datasource and output the features fields 
(cells) values as strings: the cells values are correctly read by ogr 
(via FreeXL) from the XLS file and correctly displayed as UTF-8 strings.

AFAIK FreeXL depends by iconv libary and cannot be compiled and cannot 
work at all without it.

In fact, in my QGIS installations via OSGeo4W (old and new repository) 
both the FreeXL and iconv DLLs (FreeXL 1.0.2 / iconv 1.14 - FreeXL 1.0.6 
/ iconv 1.16) are present, with the former linked to the latter as 
dependency.

Regards.

Andrea

From jorgealmerio at yahoo.com.br  Fri Jul 16 05:30:14 2021
From: jorgealmerio at yahoo.com.br (jorgealmerio at yahoo.com.br)
Date: Fri, 16 Jul 2021 09:30:14 -0300
Subject: [QGIS-Developer] RES: Processing script to audit all projects in a
 directory and subdirectories
In-Reply-To: <CAMKXKO7o4epphBO7x4vPB9LXPwBErP3Pqei7sBNmhT3HqieXZQ@mail.gmail.com>
References: <CAMKXKO7o4epphBO7x4vPB9LXPwBErP3Pqei7sBNmhT3HqieXZQ@mail.gmail.com>
Message-ID: <004001d77a3e$5565b990$00312cb0$@yahoo.com.br>

Hi, Michael,

 

Congratulations for the script!

 

These days I was looking for a script to list layers from Qgis projects with their respective sources (pathfile) and other info like, layer name, Invalid pathfile. I would be better if it is possible to do without really open the Qgis project file in Qgis.

 

I think this script you created do this, If am not wrong, but I did not figure out how to list layers from projects.

I use Windows and Qgis 3.18. Do I have to install anything else?

 

I got a CSV file like this:

"

path,basename,last_modified,crs,layer_count,invalid_layer_count,print_layout_count,print_layout_pictures_paths,print_layout_pictures_sizes,print_layout_pictures_total_size,print_layout_pictures_total_size_mb,trust_option_active,last_save_version

C:\Users\jorgealmerio\Documents\Mandu.qgz, Mandu,2021-07-15 16:46:55,EPSG:31984,126,5,1,,,0,0.0,False,31802

 

C:\Users\jorgealmerio\Documents\Mandu2.qgz, Mandu2,2021-07-16 16:46:55,EPSG:31984,126,5,1,,,0,0.0,False,31802

 

"

 

Another thing, there are urnecessary blank lines in result CSV file.

 

Regards,

 

Jorge Almerio

 

 

De: QGIS-Developer [mailto:qgis-developer-bounces at lists.osgeo.org] Em nome de kimaidou
Enviada em: sexta-feira, 16 de julho de 2021 06:33
Para: qgis-developer <qgis-developer at lists.osgeo.org>
Assunto: [QGIS-Developer] Processing script to audit all projects in a directory and subdirectories

 

Hi all !

 

I just published a WIP processing script I created to audit all the projects found in a local directory (and subdirectories).

I think it can be useful in different contexts, and if you enough people find it interesting, I could add it to the QGIS Resource sharing repository.

 

See a full README here: https://gist.github.com/mdouchin/cd89a259d3560635d4bb8708ad430caa/

 

PS: obviously it can be improved, as any piece of code ;) but I think it is mature enough to be shared

 

Regards

Micha?l

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210716/73817a7b/attachment-0001.html>

From nicolae.marinica at qtibia.ro  Fri Jul 16 06:35:58 2021
From: nicolae.marinica at qtibia.ro (=?utf-8?q?Nicolae_Marinic=C4=83?=)
Date: Fri, 16 Jul 2021 16:35:58 +0300
Subject: [QGIS-Developer] Questions about using QgsTask class
Message-ID: <68-60f18b00-27-1b381d20@36430645>


Dear QGIS developers,

My name is Nicolae Marinica (Nicu) from?QTIBIA Engineering?and I recently started to work with QGIS. While developing a new QGIS plugin, I stumbled upon some problems when using QgsTask. Although my background is in the embedded world (with C/C++ and Python), I am interested in increasing my QGIS know-how and contributing to the QGIS project. I want to know if this workaround (described below) is valid so that I can contribute by adding it in to the documentation such that other people will not spend time in finding it, like I did.

I want to run from a QGIS plugin a QgsTask created according to the documentation (https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/tasks.html). I tried both versions: a task from a function and I also created my own task by extending QgsTask class. In both cases, the task terminates successfully but the finished method is never? called/executed. I do not perform any GUI based operation from the run method as described in the documentation.

The workaround (found on the internet -?https://gis.stackexchange.com/questions/296175/issues-with-qgstask-and-task-manager) was to to declare the task as global variable like:

globals()['task1'] = TestTask('waste cpu long', 20)
tsk_mngr = QgsApplication.taskManager()
tsk_mngr.addTask(globals()['task1'])

Furthermore, I can not longer use the QgsTask object (defined as above) if a task terminates. When I try to call any method of the terminated task I get the following error message "wrapped C/C++ object of type TestTask has been deleted". It looks like the C/C++ object was destroyed while the python object still exists. The workaround for this one is to catch the exception and to return something convenient (in my case for task1.status() return QgsTask.Terminated).

Any advice would be appreciated and I would like to thank all contributors to this super nice project.
??????
Wish you all the best!
Thanks,
Nicu?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210716/68a5cfbf/attachment.html>

From kimaidou at gmail.com  Fri Jul 16 06:55:24 2021
From: kimaidou at gmail.com (kimaidou)
Date: Fri, 16 Jul 2021 15:55:24 +0200
Subject: [QGIS-Developer] Processing script to audit all projects in a
 directory and subdirectories
In-Reply-To: <004001d77a3e$5565b990$00312cb0$@yahoo.com.br>
References: <CAMKXKO7o4epphBO7x4vPB9LXPwBErP3Pqei7sBNmhT3HqieXZQ@mail.gmail.com>
 <004001d77a3e$5565b990$00312cb0$@yahoo.com.br>
Message-ID: <CAMKXKO5Zpurph4Qm94bQsBBnLnRyk2nEooeN9xw2VX-qZd3SZg@mail.gmail.com>

Hi,

Thanks for your reply.

My answers:

Le ven. 16 juil. 2021 ? 14:30, <jorgealmerio at yahoo.com.br> a ?crit :

> Hi, Michael,
>
>
>
> Congratulations for the script!
>

thanks


>
> These days I was looking for a script to list layers from Qgis projects
> with their respective sources (pathfile) and other info like, layer name,
> Invalid pathfile. I would be better if it is possible to do without really
> open the Qgis project file in Qgis.
>
>
>
> I think this script you created do this, If am not wrong, but I did not
> figure out how to list layers from projects.
>

I have not listed all the layers and sources in the output, because it
could be huge (some users have 200 layers in their projects....).
I created the plugin "Layer Board" some time ago, which you can use inside
QGIS Desktop, to get a list of layers with their properties (name, title,
datasource, CRS, feature count, etc.). It can export this data to CSV too.
But you have to open the QGIS project.

The processing script "Audit QGIS projects" has not yet this capabilities.
We could think of a new checkbox "Gather all the layers information", which
would create one CSV file per QGIS project (or huge CSV file with all the
layers of all the projects...).



> I use Windows and Qgis 3.18. Do I have to install anything else?
>

Not really, I think. I have not tried it under Windows...


>
>
> I got a CSV file like this:
>
> "
>
>
> *path,basename,last_modified,crs,layer_count,invalid_layer_count,print_layout_count,print_layout_pictures_paths,print_layout_pictures_sizes,print_layout_pictures_total_size,print_layout_pictures_total_size_mb,trust_option_active,last_save_version*
>
> *C:\Users\jorgealmerio\Documents\Mandu.qgz, Mandu,2021-07-15
> 16:46:55,EPSG:31984,126,5,1,,,0,0.0,False,31802*
>
>
>
> *C:\Users\jorgealmerio\Documents\Mandu2.qgz, Mandu2,2021-07-16
> 16:46:55,EPSG:31984,126,5,1,,,0,0.0,False,31802*
>
>
>
> "
>
>
>


This seems to be a correct output.


> Another thing, there are unnecessary blank lines in result CSV file.
>

Hum, bizarre... Do you see all the projects which should be there, ie which
are present in the directory(ies) but not listed in the output CSV file ?


>
>
> Regards,
>

Cheers !
Micha?l
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210716/18c8253e/attachment.html>

From jorgealmerio at yahoo.com.br  Fri Jul 16 07:45:28 2021
From: jorgealmerio at yahoo.com.br (jorgealmerio at yahoo.com.br)
Date: Fri, 16 Jul 2021 11:45:28 -0300
Subject: [QGIS-Developer] RES: Processing script to audit all projects in a
 directory and subdirectories
In-Reply-To: <CAMKXKO5Zpurph4Qm94bQsBBnLnRyk2nEooeN9xw2VX-qZd3SZg@mail.gmail.com>
References: <CAMKXKO7o4epphBO7x4vPB9LXPwBErP3Pqei7sBNmhT3HqieXZQ@mail.gmail.com>
 <004001d77a3e$5565b990$00312cb0$@yahoo.com.br>
 <CAMKXKO5Zpurph4Qm94bQsBBnLnRyk2nEooeN9xw2VX-qZd3SZg@mail.gmail.com>
Message-ID: <008f01d77a51$3981da70$ac858f50$@yahoo.com.br>

Hi,

 

Hum, bizarre... Do you see all the projects which should be there, ie which are present in the directory(ies) but not listed in the output CSV file ?

 

Yes, All the files are listed correctly in CSV file. The only thing strange it has a blank line between each record (Qgs project).

 

Thanks for the others replies.

 

Cheers,

 

Jorge Almerio

 

 

De: kimaidou [mailto:kimaidou at gmail.com] 
Enviada em: sexta-feira, 16 de julho de 2021 10:55
Para: jorgealmerio at yahoo.com.br
Cc: qgis-developer <qgis-developer at lists.osgeo.org>
Assunto: Re: [QGIS-Developer] Processing script to audit all projects in a directory and subdirectories

 

Hi,

 

Thanks for your reply.

 

My answers:

Le ven. 16 juil. 2021 ? 14:30, <jorgealmerio at yahoo.com.br <mailto:jorgealmerio at yahoo.com.br> > a ?crit :

Hi, Michael,

 

Congratulations for the script!

 

thanks

 

 

These days I was looking for a script to list layers from Qgis projects with their respective sources (pathfile) and other info like, layer name, Invalid pathfile. I would be better if it is possible to do without really open the Qgis project file in Qgis.

 

I think this script you created do this, If am not wrong, but I did not figure out how to list layers from projects.

 

I have not listed all the layers and sources in the output, because it could be huge (some users have 200 layers in their projects....).

I created the plugin "Layer Board" some time ago, which you can use inside QGIS Desktop, to get a list of layers with their properties (name, title, datasource, CRS, feature count, etc.). It can export this data to CSV too. But you have to open the QGIS project.

 

The processing script "Audit QGIS projects" has not yet this capabilities. We could think of a new checkbox "Gather all the layers information", which would create one CSV file per QGIS project (or huge CSV file with all the layers of all the projects...).

 

 

I use Windows and Qgis 3.18. Do I have to install anything else?

 

Not really, I think. I have not tried it under Windows...

 

 

I got a CSV file like this:

"

path,basename,last_modified,crs,layer_count,invalid_layer_count,print_layout_count,print_layout_pictures_paths,print_layout_pictures_sizes,print_layout_pictures_total_size,print_layout_pictures_total_size_mb,trust_option_active,last_save_version

C:\Users\jorgealmerio\Documents\Mandu.qgz, Mandu,2021-07-15 16:46:55,EPSG:31984,126,5,1,,,0,0.0,False,31802

 

C:\Users\jorgealmerio\Documents\Mandu2.qgz, Mandu2,2021-07-16 16:46:55,EPSG:31984,126,5,1,,,0,0.0,False,31802

 

"

 

 

 

This seems to be a correct output.

 

Another thing, there are unnecessary blank lines in result CSV file.

 

Hum, bizarre... Do you see all the projects which should be there, ie which are present in the directory(ies) but not listed in the output CSV file ?

 

 

Regards,

 

Cheers !

Micha?l

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210716/cef333ce/attachment-0001.html>

From r.nijssen at terglobo.nl  Sun Jul 18 02:46:13 2021
From: r.nijssen at terglobo.nl (Raymond Nijssen)
Date: Sun, 18 Jul 2021 11:46:13 +0200
Subject: [QGIS-Developer] geom.isValid() does not work in python
Message-ID: <3c6c5576-5263-087f-aa15-dd8d0a025a20@terglobo.nl>

How can I run ths isValid() function on a geometry. I would think my 
Polygon Geometry would inherit all functions from the 
QgsAbstractGeometry base class, but it seems it doesn't.


```
wkt = 'POLYGON((-1 0, 0 1, 1 0, 0 -1, -1 0))'

geom = QgsGeometry.fromWkt(wkt)

print(isinstance(geom, QgsGeometry)) # Outputs True
print(isinstance(geom, QgsAbstractGeometry)) # Outputs False

result = geom.isValid(0) # Outputs Error
print(result)
```

I get:
AttributeError: 'QgsGeometry' object has no attribute 'isValid'

Is it supposed to work?

By the way, there's a geom.isGeosValid() that does work. But not a 
geom.isQgisValid()...

Thanks,
Raymond







-- 
Terglobo
Fahrenheitstraat 1
5223 BJ 's-Hertogenbosch
The Netherlands
+31 (0) 6 25 31 49 83

From andreaerdna at libero.it  Sun Jul 18 04:49:45 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Sun, 18 Jul 2021 13:49:45 +0200
Subject: [QGIS-Developer] geom.isValid() does not work in python
In-Reply-To: <3c6c5576-5263-087f-aa15-dd8d0a025a20@terglobo.nl>
References: <3c6c5576-5263-087f-aa15-dd8d0a025a20@terglobo.nl>
Message-ID: <ac107f10-89a6-084a-44e0-bf0becedcd75@libero.it>

Il 18/07/2021 11:46, Raymond Nijssen ha scritto:
> How can I run ths isValid() function on a geometry. I would think my 
> Polygon Geometry would inherit all functions from the 
> QgsAbstractGeometry base class, but it seems it doesn't.

> I get:
> AttributeError: 'QgsGeometry' object has no attribute 'isValid'

Hi Raymond,
the QGIS Python API documentation clarify that: "The actual geometry 
representation is stored as a QgsAbstractGeometry within the container, 
and can be accessed via the get() method"[1].

So, I think

geom.get().isValid()

will work without errors.

Best regards.

Andrea

[1] https://qgis.org/pyqgis/3.16/core/QgsGeometry.html#module-QgsGeometry

From r.nijssen at terglobo.nl  Sun Jul 18 22:47:33 2021
From: r.nijssen at terglobo.nl (Raymond Nijssen)
Date: Mon, 19 Jul 2021 07:47:33 +0200
Subject: [QGIS-Developer] geom.isValid() does not work in python
In-Reply-To: <ac107f10-89a6-084a-44e0-bf0becedcd75@libero.it>
References: <3c6c5576-5263-087f-aa15-dd8d0a025a20@terglobo.nl>
 <ac107f10-89a6-084a-44e0-bf0becedcd75@libero.it>
Message-ID: <f9d38c7f-0747-9752-c657-d025f0d67146@terglobo.nl>

Thank you Andrea!

I also asked this on the QGIS Community Telegram group and got a few 
answers. Still a bit confusing though. Here's a test script:



wkt = 'MULTIPOLYGON(((-9 0, 0 9, 9 0, 0 -9, -9 0),(-8 0, 0 8, 8 0, 0 -8, 
-8 0)),((-7 0, 0 7, 7 0, 0 -7, -7 0)))'

geom = QgsGeometry.fromWkt(wkt)
print(geom)

print( geom.validateGeometry() ) # 0 = QGIS (Returns an error)
print( geom.validateGeometry(0) ) # 0 = QGIS (Returns an error)
print( geom.validateGeometry(1) ) # 1 = GEOS
print( geom.isGeosValid() ) # Why does this one even exist???

geom2 = geom.constGet()
print(geom2)
print( geom2.isValid() )
print( geom2.isValid(0) )
print( geom2.isValid(1) )

geom3 = geom.get()
print(geom3)
print( geom2.isValid() )
print( geom3.isValid(0) )
print( geom3.isValid(1) )



I think geom2 and geom3 are the exact same thing. And the parameter 0 or 
1 (or none at all) don't seem to change anything to the validation type, 
since they don't raise errors.

(BTW I'm doing this cause QGIS validation raises an error for 
multipolygons having a polygon within an inner of another polygon, which 
should be fixed. That's also the example wkt here.)



On 18-07-2021 13:49, Andrea Giudiceandrea wrote:
> Il 18/07/2021 11:46, Raymond Nijssen ha scritto:
>> How can I run ths isValid() function on a geometry. I would think my 
>> Polygon Geometry would inherit all functions from the 
>> QgsAbstractGeometry base class, but it seems it doesn't.
> 
>> I get:
>> AttributeError: 'QgsGeometry' object has no attribute 'isValid'
> 
> Hi Raymond,
> the QGIS Python API documentation clarify that: "The actual geometry 
> representation is stored as a QgsAbstractGeometry within the container, 
> and can be accessed via the get() method"[1].
> 
> So, I think
> 
> geom.get().isValid()
> 
> will work without errors.
> 
> Best regards.
> 
> Andrea
> 
> [1] https://qgis.org/pyqgis/3.16/core/QgsGeometry.html#module-QgsGeometry
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

From andreaerdna at libero.it  Sun Jul 18 23:38:09 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Mon, 19 Jul 2021 08:38:09 +0200
Subject: [QGIS-Developer] geom.isValid() does not work in python
In-Reply-To: <f9d38c7f-0747-9752-c657-d025f0d67146@terglobo.nl>
References: <3c6c5576-5263-087f-aa15-dd8d0a025a20@terglobo.nl>
 <ac107f10-89a6-084a-44e0-bf0becedcd75@libero.it>
 <f9d38c7f-0747-9752-c657-d025f0d67146@terglobo.nl>
Message-ID: <3f342710-2069-a998-e32a-28edff5a8b35@libero.it>

Il 19/07/2021 07:47, Raymond Nijssen ha scritto:

 > print( geom.isGeosValid() )

> geom2 = geom.constGet()
 > print( geom2.isValid() )

> geom3 = geom.get()
 > print( geom3.isValid() )

> I think geom2 and geom3 are the exact same thing. And the parameter 0 or 
> 1 (or none at all) don't seem to change anything to the validation type, 
> since they don't raise errors.

Hi Raymond,
for some insight of get() and constGet() in PyQGIS, please read a 
previous thread [1] on the same argument.

The flags used in isValid() "indicates optional flags which control the 
type of validity checking performed (corresponding to 
QgsGeometry.ValidityFlags)" [2].
The only flag available is "FlagAllowSelfTouchingHoles: Indicates that 
self-touching holes are permitted" [3].
isValid() was introduced in 3.8 [4] and uses GEOS to perform the 
validity check.
isGeosValid(), which uses the same QgsGeometry.ValidityFlags, actaully 
relies on isValid() and thus on GEOS to perform the validity check, so 
they act in the same way AFAIK.

Maybe Nyall Dawson could share more light on this...

With validateGeometry() you could specify the validity check method to 
use (QGIS or GEOS) beside the ValidityFlags.

Best regards.

Andrea Giudiceandrea


[1] 
http://osgeo-org.1560.x6.nabble.com/QGIS-Developer-Do-QgsGeometry-constGet-e-constParts-return-non-modifiable-or-modifiable-reference-in-td5457143.html
[2] 
https://qgis.org/pyqgis/3.16/core/QgsAbstractGeometry.html?highlight=isvalid#qgis.core.QgsAbstractGeometry.isValid
[3] 
https://qgis.org/api/classQgsGeometry.html#a9079690dc8d58af969fae36d16499923
[4] https://github.com/qgis/QGIS/pull/9293

From pierluigi.derosa at gmail.com  Tue Jul 20 01:42:19 2021
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Tue, 20 Jul 2021 10:42:19 +0200
Subject: [QGIS-Developer] process bar in processing algs
Message-ID: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>

Dear User,
I have a plugin that call a processing alghoritm
I would like to communicate to the user with  a progress bar

below my code:

# native:creategrid
params_creategrid = {
    'CRS': crs_layer,
    'EXTENT': extent_coords,
    'HOVERLAY': 0,
    'HSPACING': resolution,
    'OUTPUT': 'memory:',
    'TYPE': 0,
    'VOVERLAY': 0,
    'VSPACING': resolution
}

result_grid = processing.run("native:creategrid", params_creategrid)
grid_output = result_grid['OUTPUT']

I would like to show a progressbar in my QprogressBar
called progressBarGrid.
Thanks for your help
Pierluigi
-- 
Ing. Pierluigi De Rosa (PhD in Earth Science)
Contract Professor of Geographic Information System at University of Perugia
cel: 3497558268 / fax: 075 7823038
skype: pierluigi.derosa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210720/1c753c63/attachment.html>

From matteo.ghetta at gmail.com  Tue Jul 20 02:01:21 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 20 Jul 2021 11:01:21 +0200
Subject: [QGIS-Developer] process bar in processing algs
In-Reply-To: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>
References: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>
Message-ID: <36cc1386-fbc6-d1b5-d9f4-25669117b025@gmail.com>

Hi Pierluigi,

you can fill the progressBar of the Processing algorithm with 
feedback.setProgress(integer).

Hope this helps

Matteo

From pierluigi.derosa at gmail.com  Tue Jul 20 02:14:49 2021
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Tue, 20 Jul 2021 11:14:49 +0200
Subject: [QGIS-Developer] process bar in processing algs
In-Reply-To: <36cc1386-fbc6-d1b5-d9f4-25669117b025@gmail.com>
References: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>
 <36cc1386-fbc6-d1b5-d9f4-25669117b025@gmail.com>
Message-ID: <CAAgsrZhEABxgBLQZ5m26CFk2J=gq8zPrNrXyx5hbz6UHNyFiMA@mail.gmail.com>

Hi Matteo,
can you please explain me better?
I have self plugin that in particular part use this code

result_grid = processing.run("native:creategrid", params_creategrid)

But I would like to use note the progressBar of processing but a personal
bar in the QDialog

It is possible?
P

Il giorno mar 20 lug 2021 alle ore 11:01 matteo <matteo.ghetta at gmail.com>
ha scritto:

> Hi Pierluigi,
>
> you can fill the progressBar of the Processing algorithm with
> feedback.setProgress(integer).
>
> Hope this helps
>
> Matteo
>


-- 
Ing. Pierluigi De Rosa (PhD in Earth Science)
Contract Professor of Geographic Information System at University of Perugia
cel: 3497558268 / fax: 075 7823038
skype: pierluigi.derosa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210720/501fa4ef/attachment.html>

From prem.netgis at gmail.com  Tue Jul 20 02:37:27 2021
From: prem.netgis at gmail.com (Prem Kumar)
Date: Tue, 20 Jul 2021 15:07:27 +0530
Subject: [QGIS-Developer] process bar in processing algs
In-Reply-To: <CAAgsrZhEABxgBLQZ5m26CFk2J=gq8zPrNrXyx5hbz6UHNyFiMA@mail.gmail.com>
References: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>
 <36cc1386-fbc6-d1b5-d9f4-25669117b025@gmail.com>
 <CAAgsrZhEABxgBLQZ5m26CFk2J=gq8zPrNrXyx5hbz6UHNyFiMA@mail.gmail.com>
Message-ID: <CAP2_p62x2aOR1OWYDGRfDqfG=BW+eLjTfAthad7hWRWt-brkCg@mail.gmail.com>

Hi Mate,

Every processing tool has to implement its business logic in
processAlgorithm() function and it has below syntax.

*def processAlgorithm(self, parameters, context, feedback):*

One of the input parameters is feedback and this as a parameter variable
should be given to the *processing.run()* function as shown below.

Hope, this helps.

result_grid = processing.run("native:creategrid", params_creategrid*,
context=context, feedback=feedback*)


On Tue, Jul 20, 2021 at 2:45 PM pierluigi de rosa <
pierluigi.derosa at gmail.com> wrote:

> Hi Matteo,
> can you please explain me better?
> I have self plugin that in particular part use this code
>
> result_grid = processing.run("native:creategrid", params_creategrid)
>
> But I would like to use note the progressBar of processing but a personal
> bar in the QDialog
>
> It is possible?
> P
>
> Il giorno mar 20 lug 2021 alle ore 11:01 matteo <matteo.ghetta at gmail.com>
> ha scritto:
>
>> Hi Pierluigi,
>>
>> you can fill the progressBar of the Processing algorithm with
>> feedback.setProgress(integer).
>>
>> Hope this helps
>>
>> Matteo
>>
>
>
> --
> Ing. Pierluigi De Rosa (PhD in Earth Science)
> Contract Professor of Geographic Information System at University of
> Perugia
> cel: 3497558268 / fax: 075 7823038
> skype: pierluigi.derosa
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210720/6f36ae67/attachment.html>

From ziebarth at gfz-potsdam.de  Tue Jul 20 02:40:24 2021
From: ziebarth at gfz-potsdam.de (Malte Ziebarth)
Date: Tue, 20 Jul 2021 11:40:24 +0200
Subject: [QGIS-Developer] PyQGIS Cookbook License
In-Reply-To: <CA+H0G_HUoA-+WV0fSQkWXUFOpOrXBREaDSWY=YCeXcG23=GNXA@mail.gmail.com>
References: <2a83e509-eed1-4b6c-5474-dafe08cab1b7@gfz-potsdam.de>
 <CA+H0G_HUoA-+WV0fSQkWXUFOpOrXBREaDSWY=YCeXcG23=GNXA@mail.gmail.com>
Message-ID: <576acd24-0e02-93f5-37e1-e113fa6c16dd@gfz-potsdam.de>

Hi,

thanks a lot for the reply and forwarding to the PSC.

Also, thanks to the PSC for quickly adressing the issue. I'm going to 
jump threads
here a little to reply also to Marco Bernasocchi's e-mail:

> Even Though the cookbook has a lot of code, we decided to license it under
> a documentation license and not a software license, since the code is
> mostly for documentation purposes and are considered "trivial code":

I think that the code being "trivial" is the crucial information to 
answer my question.

Following up on that, I think that a similar statement at the beginning 
of the Cookbook
documentation would be very helpful for users in a situation similar to 
mine. I.e. a small
statement that explicitly tells the (developing) user that the code is 
considered trivial
and may be reused in GPL'ed QGIS plugins.

Otherwise I think that deciding whether some code is trivial is not a 
trivial task - at
least I did not experience it to be so.

Thanks again!

Best regards
Malte

On 03.07.21 23:35, Alexandre Neto wrote:
> Hi,
>
> Although I think you can safely use and replicate any part of the 
> documentation, including code snippets, I think you spotted an 
> important issue.
>
> I do believe we should add a licence to all our documentation. Maybe a 
> creative commons license.
>
> I have included the PSC mailing list in this reply, maybe they already 
> have a position about this subject.
>
> Alexandre Neto
>
>
> A sexta, 2/07/2021, 18:30, Malte Ziebarth <ziebarth at gfz-potsdam.de 
> <mailto:ziebarth at gfz-potsdam.de>> escreveu:
>
>     Dear all,
>
>     first off, thank you all for all the great work that went into QGIS!
>
>     I am currently writing a Python plugin that I intend to make publicly
>     available in the plugin repository. I started developing the plugin by
>     adapting the examples from the PyQGIS Cookbook, specifically this
>     page:
>
>     https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/plugins/plugins.html#writing-a-plugin
>     <https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/plugins/plugins.html#writing-a-plugin>
>
>     Now the problem that I encountered with that is the license of the
>     skeleton
>     code (i.e. __init__.py and mainPlugin.py). The code does not
>     actually contain
>     a license header and the documentation page itself contains only the
>     very general copyright information
>
>     "? Copyright 2002-now, QGIS project. Last updated on Jul 02, 2021
>     09:02."
>
>     with no further licensing information.
>
>     I guess that the intention of this part of documentation is for
>     people to
>     have an easy start developing plugins which can then be
>     contributed back
>     to the community under GPL license. This is just what I am planning to
>     do. However, trying to put this into a correct license header is
>     currently
>     giving me a bit of a headache.
>
>     Maybe someone here in this mailing list has some advice about this
>     issue,
>     and maybe even the person/people who wrote this piece of code can
>     clarify?
>     Any help would be greatly appreciated!
>
>     Kind regards
>     Malte Ziebarth
>
>     -- 
>     Malte J. Ziebarth
>     Section 2.6
>     Tel.: +49 (0)331/288-28634
>     E-Mail:ziebarth at gfz-potsdam.de  <mailto:ziebarth at gfz-potsdam.de>
>     ___________________________________
>
>     Helmholtz-Zentrum Potsdam
>     Deutsches GeoForschungsZentrum GFZ
>     Stiftung des ?ff. Rechts Land Brandenburg
>     Telegrafenberg, 14473 Potsdam
>
>     _______________________________________________
>     QGIS-Developer mailing list
>     QGIS-Developer at lists.osgeo.org <mailto:QGIS-Developer at lists.osgeo.org>
>     List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>     Unsubscribe:
>     https://lists.osgeo.org/mailman/listinfo/qgis-developer
>     <https://lists.osgeo.org/mailman/listinfo/qgis-developer>
>
-- 
Malte J. Ziebarth
Section 2.6
Tel.: +49 (0)331/288-28634
E-Mail: ziebarth at gfz-potsdam.de
___________________________________

Helmholtz-Zentrum Potsdam
Deutsches GeoForschungsZentrum GFZ
Stiftung des ?ff. Rechts Land Brandenburg
Telegrafenberg, 14473 Potsdam

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210720/3fed7696/attachment-0001.html>

From matteo.ghetta at gmail.com  Tue Jul 20 02:52:34 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 20 Jul 2021 11:52:34 +0200
Subject: [QGIS-Developer] process bar in processing algs
In-Reply-To: <CAAgsrZhEABxgBLQZ5m26CFk2J=gq8zPrNrXyx5hbz6UHNyFiMA@mail.gmail.com>
References: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>
 <36cc1386-fbc6-d1b5-d9f4-25669117b025@gmail.com>
 <CAAgsrZhEABxgBLQZ5m26CFk2J=gq8zPrNrXyx5hbz6UHNyFiMA@mail.gmail.com>
Message-ID: <e3b16a2e-5d64-8ca8-062a-24d815999137@gmail.com>

Hi Pierluigi,


> can you please explain me better?
> I have self plugin that in particular part use this code
> 
> result_grid = processing.run("native:creategrid", params_creategrid)

as explained by Prem, if you want to add the progress when you call a 
"native" algorithm of QGIS within your algorithm, then you can pass to 
the algorithm parameters:

result_grid = processing.run("native:creategrid", params_creategrid, 
context=context, feedback=feedback)

be aware also at the `is_child` parameter. Have a look at the example:

https://docs.qgis.org/3.4/en/docs/user_manual/processing/scripts.html#extending-qgsprocessingalgorithm

if you want to add steps to the progressBar with your logic then you can 
use feedback.setProgress(number) to fill the progress bar. Have a look 
at the template script and you will find a fine usage

Hope this helps

Matteo

From carrillo.german at gmail.com  Tue Jul 20 06:20:05 2021
From: carrillo.german at gmail.com (=?UTF-8?Q?Germ=C3=A1n_Carrillo?=)
Date: Tue, 20 Jul 2021 08:20:05 -0500
Subject: [QGIS-Developer] process bar in processing algs
In-Reply-To: <e3b16a2e-5d64-8ca8-062a-24d815999137@gmail.com>
References: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>
 <36cc1386-fbc6-d1b5-d9f4-25669117b025@gmail.com>
 <CAAgsrZhEABxgBLQZ5m26CFk2J=gq8zPrNrXyx5hbz6UHNyFiMA@mail.gmail.com>
 <e3b16a2e-5d64-8ca8-062a-24d815999137@gmail.com>
Message-ID: <CANaz7myLGBw2rViQUHMPhvMUAmLsyi1aeDWUrsRHtqQ+_dnKKQ@mail.gmail.com>

Hi Pierluigi,


you need to create your own *feedback* object and connect its
*progressChanged* SIGNAL to your progressbar's *setValue* SLOT, in this way:


feedback = QgsProcessingFeedback()
feedback.progressChanged.connect(progressBarGrid.setValue)

params_creategrid = {
    # Set key-value parameters
}
result_grid = processing.run("native:creategrid", params_creategrid,
feedback=feedback)


Source: https://gis.stackexchange.com/a/348588/4972


Regards,

Germ?n

El mar, 20 jul 2021 a las 4:52, matteo (<matteo.ghetta at gmail.com>) escribi?:

> Hi Pierluigi,
>
>
> > can you please explain me better?
> > I have self plugin that in particular part use this code
> >
> > result_grid = processing.run("native:creategrid", params_creategrid)
>
> as explained by Prem, if you want to add the progress when you call a
> "native" algorithm of QGIS within your algorithm, then you can pass to
> the algorithm parameters:
>
> result_grid = processing.run("native:creategrid", params_creategrid,
> context=context, feedback=feedback)
>
> be aware also at the `is_child` parameter. Have a look at the example:
>
>
> https://docs.qgis.org/3.4/en/docs/user_manual/processing/scripts.html#extending-qgsprocessingalgorithm
>
> if you want to add steps to the progressBar with your logic then you can
> use feedback.setProgress(number) to fill the progress bar. Have a look
> at the template script and you will find a fine usage
>
> Hope this helps
>
> Matteo
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>


-- 
-----------
   |\__
(:>__)(
   |/
Soluciones Geoinform?ticas Libres
http://geotux.tuxfamily.org/
https://twitter.com/GeoTux2 <http://twitter.com/GeoTux2>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210720/12d6493e/attachment.html>

From totolamb at abv.bg  Tue Jul 20 07:31:15 2021
From: totolamb at abv.bg (todor lambev)
Date: Tue, 20 Jul 2021 17:31:15 +0300 (EEST)
Subject: [QGIS-Developer] DWG files preview in QGIS
Message-ID: <1228961645.1995170.1626791475712@nm71.abv.bg>

 Dear QGIS developers,
  
  I have a strange need. Could you help me?
  I have 30 000 DWG files that are not georeferenced, each file has unique and a specific name. I have a point shapefile which in its attribute table contains a column with the names of the *dwg files.
  
  My question is: How I can load to preview the DWG files in QGIS next to the points or to preview the DWG by clicking on the point (similar to the photo preview widget)?  
  I hope that you won't skip my question and will help me to find a solution basically because otherwise, I have to do it manually...  

  Best regards
   Todor Lambev, PhD Student
   - - - - -
   Institute of Oceanology
  Department of coastal zones dynamics
mob: +359 886 75 72 85;
Varna, Bulgaria
URL:  http://www.io-bas.bg     
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210720/f3b58610/attachment.html>

From charles at kartoza.com  Tue Jul 20 08:38:20 2021
From: charles at kartoza.com (Charles Dixon-Paver)
Date: Tue, 20 Jul 2021 17:38:20 +0200
Subject: [QGIS-Developer] DWG files preview in QGIS
In-Reply-To: <1228961645.1995170.1626791475712@nm71.abv.bg>
References: <1228961645.1995170.1626791475712@nm71.abv.bg>
Message-ID: <CAK2Kqice8fTPthJHhTR_eiYvWyxMr3eMUu+3zB_80mOdV=pyjg@mail.gmail.com>

It's not totally clear to me what the objective is for your DWGs.

By "preview", do you mean wish to just view an overview image of the DWG
contents? If that is the case, I would recommend using a separate command
line/ batch process to produce raster format previews as DWGs. You can then
create a new field for the accompanying raster file using the field
calculator and QGIS expressions.

With the rasters you can use the preview option in the feature form, or
even use a "Raster Image Marker" based symbol at certain scales to
represent the DXF previews.

Another option for previews is to use the "Show map tips" option from the
QGIS toolbars. In the "Display" section of the layer properties you will
find that tooltips can use HTML code which will render a "web preview" of
the feature when you hover the cursor on it. for example, the
following should allow image previews:

<img src='file:///[%  @project_folder || '/' || "image" %]' height=400
width=400 />

In theory, you could likely combine this with a DWG rendering library such
as https://sharecad.org/it/DWGOnlinePlugin but I expect it will be
difficult to use and not very efficient, hence why I would suggest
converting the data to raster beforehand. One other thing you could do as
well is to use the "web view" of the QGIS form to render an html template
with an integrated viewer, but again, this is likely difficult and not
necessary.

I am not aware of any "preview" plugin for rendering DWG data within QGIS.

If your aim is to "load" the DWG into your project from a command available
within the point feature attributes, this is supported by using GitHub
actions and some custom code, although the process may be quite cumbersome.
Actions functionality was covered on the last QGIS Open Day[1] and I
recommend watching the demonstration if that is your use case.
Alternatively, there is also some written material on this topic [2] f you
would prefer to start there

[1] https://github.com/qgis/QGIS/wiki/QOD-June-2021#qgis-actions-deep-dive
[2]
https://courses.spatialthoughts.com/pyqgis-in-a-day.html#creating-custom-python-actions


On Tue, 20 Jul 2021 at 16:40, todor lambev <totolamb at abv.bg> wrote:

> Dear QGIS developers,
>
> I have a strange need. Could you help me?
> I have 30 000 DWG files that are not georeferenced, each file has unique
> and a specific name. I have a point shapefile which in its attribute table
> contains a column with the names of the *dwg files.
>
> My question is: How I can load to preview the DWG files in QGIS next to
> the points or to preview the DWG by clicking on the point (similar to the
> photo preview widget)?
>
> I hope that you won't skip my question and will help me to find a solution
> basically because otherwise, I have to do it manually...
>
> Best regards
>
> Todor Lambev, PhD Student- - - - -*Institute of Oceanology
> **Department of coastal zones dynamics
> mob: +359 886 75 72 85;
> Varna, Bulgaria
> URL: http://www.io-bas.bg <http://www.io-bas.bg>*
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210720/ef3ca999/attachment.html>

From pierluigi.derosa at gmail.com  Tue Jul 20 21:51:18 2021
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Wed, 21 Jul 2021 06:51:18 +0200
Subject: [QGIS-Developer] process bar in processing algs
In-Reply-To: <CANaz7myLGBw2rViQUHMPhvMUAmLsyi1aeDWUrsRHtqQ+_dnKKQ@mail.gmail.com>
References: <CAAgsrZjUWjC=Fv2zKw74JXLDZnZRvmBddRrqBQSt-q-SUCeKCg@mail.gmail.com>
 <36cc1386-fbc6-d1b5-d9f4-25669117b025@gmail.com>
 <CAAgsrZhEABxgBLQZ5m26CFk2J=gq8zPrNrXyx5hbz6UHNyFiMA@mail.gmail.com>
 <e3b16a2e-5d64-8ca8-062a-24d815999137@gmail.com>
 <CANaz7myLGBw2rViQUHMPhvMUAmLsyi1aeDWUrsRHtqQ+_dnKKQ@mail.gmail.com>
Message-ID: <CAAgsrZhTgzEAae-brk7BadvYugNTWj1Osjfr8bjWGmC4uabjZQ@mail.gmail.com>

Thanks guys,

I solved my problem

In particular it was the feedback.progressChanged.connect suggested by
German the missing part.
Cheers
Pierluigi

Il giorno mar 20 lug 2021 alle ore 15:20 Germ?n Carrillo <
carrillo.german at gmail.com> ha scritto:

> Hi Pierluigi,
>
>
> you need to create your own *feedback* object and connect its
> *progressChanged* SIGNAL to your progressbar's *setValue* SLOT, in this
> way:
>
>
> feedback = QgsProcessingFeedback()
> feedback.progressChanged.connect(progressBarGrid.setValue)
>
> params_creategrid = {
>     # Set key-value parameters
> }
> result_grid = processing.run("native:creategrid", params_creategrid,
> feedback=feedback)
>
>
> Source: https://gis.stackexchange.com/a/348588/4972
>
>
> Regards,
>
> Germ?n
>
> El mar, 20 jul 2021 a las 4:52, matteo (<matteo.ghetta at gmail.com>)
> escribi?:
>
>> Hi Pierluigi,
>>
>>
>> > can you please explain me better?
>> > I have self plugin that in particular part use this code
>> >
>> > result_grid = processing.run("native:creategrid", params_creategrid)
>>
>> as explained by Prem, if you want to add the progress when you call a
>> "native" algorithm of QGIS within your algorithm, then you can pass to
>> the algorithm parameters:
>>
>> result_grid = processing.run("native:creategrid", params_creategrid,
>> context=context, feedback=feedback)
>>
>> be aware also at the `is_child` parameter. Have a look at the example:
>>
>>
>> https://docs.qgis.org/3.4/en/docs/user_manual/processing/scripts.html#extending-qgsprocessingalgorithm
>>
>> if you want to add steps to the progressBar with your logic then you can
>> use feedback.setProgress(number) to fill the progress bar. Have a look
>> at the template script and you will find a fine usage
>>
>> Hope this helps
>>
>> Matteo
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
>
>
> --
> -----------
>    |\__
> (:>__)(
>    |/
> Soluciones Geoinform?ticas Libres
> http://geotux.tuxfamily.org/
> https://twitter.com/GeoTux2 <http://twitter.com/GeoTux2>
>
>

-- 
Ing. Pierluigi De Rosa (PhD in Earth Science)
Contract Professor of Geographic Information System at University of Perugia
cel: 3497558268 / fax: 075 7823038
skype: pierluigi.derosa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210721/06ff155f/attachment.html>

From adenaculture at gmail.com  Wed Jul 21 06:15:23 2021
From: adenaculture at gmail.com (C Hamilton)
Date: Wed, 21 Jul 2021 09:15:23 -0400
Subject: [QGIS-Developer] OSGeo4W QGIS 3.20.1 Failing on Windows 10
Message-ID: <CABPxTTqa=3vV0Qha4yx-umXtGO3OG8af9XWOjWcPmSWvp46dPQ@mail.gmail.com>

I noticed the QGIS 3.20.1 update in the OSGeo4W installer and rain the
update. When launched, the application never shows a splash screen and it
never launches, but in the Task Manager it shows the process qgis-bin.exe
as being there.

I noticed there was a problem with it not working on Linux Mint. I can
confirm it is not working on Windows 10.

Thanks,

calvin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210721/23bd3c0e/attachment.html>

From adenaculture at gmail.com  Wed Jul 21 06:18:01 2021
From: adenaculture at gmail.com (C Hamilton)
Date: Wed, 21 Jul 2021 09:18:01 -0400
Subject: [QGIS-Developer] OSGeo4W QGIS 3.20.1 Failing on Windows 10
In-Reply-To: <CABPxTTqa=3vV0Qha4yx-umXtGO3OG8af9XWOjWcPmSWvp46dPQ@mail.gmail.com>
References: <CABPxTTqa=3vV0Qha4yx-umXtGO3OG8af9XWOjWcPmSWvp46dPQ@mail.gmail.com>
Message-ID: <CABPxTTrFtdM30uQ1UvaAKSP_J4arXReO9Hj3nfbV=tatqUHcfQ@mail.gmail.com>

QGIS 3.16.9 seems to work properly but 3.20.1 does not.

On Wed, Jul 21, 2021 at 9:15 AM C Hamilton <adenaculture at gmail.com> wrote:

> I noticed the QGIS 3.20.1 update in the OSGeo4W installer and rain the
> update. When launched, the application never shows a splash screen and it
> never launches, but in the Task Manager it shows the process qgis-bin.exe
> as being there.
>
> I noticed there was a problem with it not working on Linux Mint. I can
> confirm it is not working on Windows 10.
>
> Thanks,
>
> calvin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210721/a28f4dfd/attachment.html>

From andreaerdna at libero.it  Wed Jul 21 06:41:21 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Wed, 21 Jul 2021 15:41:21 +0200
Subject: [QGIS-Developer] OSGeo4W QGIS 3.20.1 Failing on Windows 10
In-Reply-To: <CABPxTTqa=3vV0Qha4yx-umXtGO3OG8af9XWOjWcPmSWvp46dPQ@mail.gmail.com>
References: <CABPxTTqa=3vV0Qha4yx-umXtGO3OG8af9XWOjWcPmSWvp46dPQ@mail.gmail.com>
Message-ID: <0d02dd7c-596c-8e61-440f-02f8fe999a6d@libero.it>

Il 21/07/2021 15:15, C Hamilton ha scritto:
> I noticed the QGIS 3.20.1 update in the OSGeo4W installer and rain the 
> update. When launched, the application never shows a splash?screen and 
> it never launches, but in the Task Manager it shows the process 
> qgis-bin.exe as being there.

Also reported on GitHub by various users 
https://github.com/qgis/QGIS/issues/44293

It seems something related with the symbology-style.db file in the 
profile folder.

Regards.

Andrea

From jgr at di.uminho.pt  Wed Jul 21 07:48:08 2021
From: jgr at di.uminho.pt (Jorge Gustavo Rocha)
Date: Wed, 21 Jul 2021 15:48:08 +0100
Subject: [QGIS-Developer] DWG files preview in QGIS
In-Reply-To: <1228961645.1995170.1626791475712@nm71.abv.bg>
References: <1228961645.1995170.1626791475712@nm71.abv.bg>
Message-ID: <f9fd17fb-5d19-9df3-b959-1d1f9bdd1d02@di.uminho.pt>

Hi Todor,

You can configure an action on your shapefile layer. The action can call
your DWG previewer with the dwg filename.

If you use the ODA Drawings Explorer for example, the action would be:
/usr/bin/ODADrawingsExplorer "[% "DWG_FILE_NAME" %]"
where DWG_FILE_NAME is your field with the DWG file.

I hope it helps.

Regards,

Jorge Gustavo


On 20/07/21 15:31, todor lambev wrote:
> Dear QGIS developers,?
> 
> I have a strange need. Could you help me??
> I have 30 000 DWG files that are not georeferenced, each file has unique
> and a specific name. I have a point shapefile which in its attribute
> table contains a column with the names of the *dwg files.?
> 
> My question is: How I can load to preview the DWG files in QGIS next to
> the points or to preview the DWG by clicking on the point (similar to
> the photo preview widget)?
> 
> I hope that you won't skip my question and will help me to find a
> solution basically because otherwise, I have to do it manually...
> ??
> Best regards
> 
> Todor Lambev, PhD Student - - - - - *Institute of Oceanology
> */Department of coastal zones dynamics mob: +359 886 75 72 85; Varna,
> Bulgaria URL: http://www.io-bas.bg <http://www.io-bas.bg>/
> 
> 
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> 

J. Gustavo
-- 
Jorge Gustavo Rocha
Departamento de Inform?tica
Universidade do Minho
4710-057 Braga
Gabinete 3.29 (Piso 3)
Tel: +351 253604480
Fax: +351 253604471
M?vel: +351 910333888
skype: nabocudnosor

From bernd.vogelgesang at gmx.de  Wed Jul 21 08:27:32 2021
From: bernd.vogelgesang at gmx.de (Bernd Vogelgesang)
Date: Wed, 21 Jul 2021 17:27:32 +0200
Subject: [QGIS-Developer] [Qgis-user] 3.20.1 fails on Linux Mint
In-Reply-To: <20210721113706.15645e2c@cabore.cwbpr.rx>
References: <CAHBySPYVY5xiJjwACa1EbhGS_T+4Vc+FanYb7r_ijG0x46TAsg@mail.gmail.com>
 <20210721113706.15645e2c@cabore.cwbpr.rx>
Message-ID: <d21ebba3-160b-3376-df2c-88b4188fb900@gmx.de>

On 21.07.21 16:37, Fernando M. Roxo da Motta wrote:
> On Wed, 21 Jul 2021 07:02:37 -0600, Richard Greenwood
> <richard.greenwood at gmail.com> wrote:
>
>
>> I just upgraded from 3.20.0 to 3.20.1 on Linux Mint 20.1. Qgis doesn't
>> start, or more accurately, I don't get a GUI interface. I can see the
>> qgis.bin process running and using 100% of one core, so I guess it's
>> hung. I uninstalled, reinstalled, rebooted, same result. Suggestions?
>>
>
>    I have just upgraded Qgis in my Ubuntu 20.04.2 LTS and got the same
> result, no GUI.
>
>    There are many messages like:
>
> (qgis.bin:62147): Gtk-WARNING **: 11:17:36.524: Theme parsing error:
> gtk.css:28:35: Junk at end of value for background-color
>
> or
>
> (qgis.bin:62147): Gtk-WARNING **: 11:17:36.546: Theme parsing error:
> gtk-widgets-assets.css:108:32: The style property
> GtkWidget:separator-width is deprecated and shouldn't be used anymore.
> It will be removed in a future version
>
> But I think that is not the problem here.
>
>    I am still struggling trying to get some clue.
>
>
>
>
>    Roxo
>
Thanks for the warnings!

I forward it to the developer list.

Cheers,

Bernd


From milos96pantelic at gmail.com  Wed Jul 21 23:12:25 2021
From: milos96pantelic at gmail.com (=?UTF-8?B?TWlsb8WhIFBhbnRlbGnEiw==?=)
Date: Thu, 22 Jul 2021 08:12:25 +0200
Subject: [QGIS-Developer] Algorithm and Code
Message-ID: <CADXtoLsvkq2sZC8TTsK+a92PE0f3BARR=_uQ+ytTHa+WiyaH=A@mail.gmail.com>

Hello everyone!

Maybe I am referring to wrong address, but I hope that you will be able to
redirect me at least. I am interested in finding source code or at least
algorithms for tools from processing toolbox, specifically *Polygonizer *and
*PolygonstoLines* tools. Is that even possible?
Thanks in advance.

Best of luck!
Milo? Panteli?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210722/4585f480/attachment.html>

From rdmailings at duif.net  Thu Jul 22 00:03:47 2021
From: rdmailings at duif.net (Richard Duivenvoorde)
Date: Thu, 22 Jul 2021 09:03:47 +0200
Subject: [QGIS-Developer] Algorithm and Code
In-Reply-To: <CADXtoLsvkq2sZC8TTsK+a92PE0f3BARR=_uQ+ytTHa+WiyaH=A@mail.gmail.com>
References: <CADXtoLsvkq2sZC8TTsK+a92PE0f3BARR=_uQ+ytTHa+WiyaH=A@mail.gmail.com>
Message-ID: <983479ee0522c4e49baf71b1f5cb6a3c@duif.net>


Source for PolygonstoLines

https://github.com/qgis/QGIS/blob/master/src/analysis/processing/qgsalgorithmpolygonstolines.cpp

Regards,

Richard Duivenvoorde

On 2021-07-22 08:12, Milo? Panteli? wrote:
> Hello everyone!
> 
> Maybe I am referring to wrong address, but I hope that you will be
> able to redirect me at least. I am interested in finding source code
> or at least algorithms for tools from processing toolbox, specifically
> Polygonizer and PolygonstoLines tools. Is that even possible?
> Thanks in advance.
> 
> Best of luck!
> Milo? Panteli?
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

From senhor.neto at gmail.com  Thu Jul 22 00:12:35 2021
From: senhor.neto at gmail.com (Alexandre Neto)
Date: Thu, 22 Jul 2021 08:12:35 +0100
Subject: [QGIS-Developer] Algorithm and Code
In-Reply-To: <CADXtoLsvkq2sZC8TTsK+a92PE0f3BARR=_uQ+ytTHa+WiyaH=A@mail.gmail.com>
References: <CADXtoLsvkq2sZC8TTsK+a92PE0f3BARR=_uQ+ytTHa+WiyaH=A@mail.gmail.com>
Message-ID: <CA+H0G_Hv_kVwUwyxC7UMw205ujfZG800OrPXUoXGg-hAuFqd5Q@mail.gmail.com>

Hell Milos,

QGIS is open source, so all the code is available, in this case om github.
You can find the code for most processing tools in this folder of the
source code:

https://github.com/qgis/QGIS/tree/master/src%2Fanalysis%2Fprocessing

Search for qgsalgorithmpoligonize and qgsalgorithmpolygonstolines.

Best regards,

Alexandre Neto
User Support
www.qcooperative.net

A quinta, 22/07/2021, 07:12, Milo? Panteli? <milos96pantelic at gmail.com>
escreveu:

> Hello everyone!
>
> Maybe I am referring to wrong address, but I hope that you will be able to
> redirect me at least. I am interested in finding source code or at least
> algorithms for tools from processing toolbox, specifically *Polygonizer *and
> *PolygonstoLines* tools. Is that even possible?
> Thanks in advance.
>
> Best of luck!
> Milo? Panteli?
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210722/1567c017/attachment.html>

From rdmailings at duif.net  Thu Jul 22 00:34:19 2021
From: rdmailings at duif.net (Richard Duivenvoorde)
Date: Thu, 22 Jul 2021 09:34:19 +0200
Subject: [QGIS-Developer] Sending a Header when using QgsVectorLayer/gdal
 with http url
Message-ID: <98f9e629d90304c999954c3e266049f9@duif.net>

Hi Devs,

I'm using a geojson url from an external service to retrieve features in 
a plugin.

But this service wants me to set an 'Accept-Encoding' header to be able 
to retrieve GEOjson (instead of json)...

Is there a way to do this using the QgsVectorLayer-constructor?

I've had a quick look into the code and could not find any header 
related stuff.

And gdal itself in the geojson driver is not mentioning any headers:
https://gdal.org/drivers/vector/geojson.html
The wfs driver seems to have some file to be able to 'set headers' using 
a GDAL_HTTP_HEADER_FILE (https://gdal.org/drivers/vector/wfs.html)
but that seems a little overkill.

My last resort off course is to do the request myself using for example 
a QgsBlockingNetworkRequest (setting the headers), and then feed the 
geojson to a QgsVectorLayer.

But given REST-full api's nowadays favour content-negotiation via 
headers over the use of an extension [0] I think gdal/QGIS should maybe 
be able to set headers in the constructor/context?

Regards,

Richard Duivenvoorde

https://www.baeldung.com/spring-mvc-content-negotiation-json-xml

From pierluigi.derosa at gmail.com  Thu Jul 22 02:52:59 2021
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Thu, 22 Jul 2021 11:52:59 +0200
Subject: [QGIS-Developer] Duplicate the extent layer selection in processing
Message-ID: <CAAgsrZh61QzKCjnp2wrYgWmxfPg+rHZ7PZ39SG2c0s_6PJRyuQ@mail.gmail.com>

Dear all,

I would like to duplicate the useful tool used in processing for the extend
layer selector in a personalized QDialog.
Instead of write anything from scratch where I can find a snippet do
duplicate?
Thanks to all
Pierluigi

-- 
Ing. Pierluigi De Rosa (PhD in Earth Science)
Contract Professor of Geographic Information System at University of Perugia
cel: 3497558268 / fax: 075 7823038
skype: pierluigi.derosa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210722/337a15ed/attachment.html>

From felahdab at gmail.com  Thu Jul 22 13:09:23 2021
From: felahdab at gmail.com (Florian El Ahdab)
Date: Thu, 22 Jul 2021 22:09:23 +0200
Subject: [QGIS-Developer] Access DB manager connection details in a python
 plugins
Message-ID: <CAEeudyT+Qi+mtLTg++4g8dVWZ2W=oxpWY1__PQSXw2kj9KGDDA@mail.gmail.com>

Hi.

I would like to take advantage of the db manager from a python plugin. That
would allow me to avoid handling the database configuration myself and
would make the overall ui more consistent for the user.

I can't find any relevant reference to do that.

Has anyone achieved anything like that ?

Regards.
Florian.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210722/6bb42618/attachment.html>

From nyall.dawson at gmail.com  Thu Jul 22 17:12:25 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Fri, 23 Jul 2021 10:12:25 +1000
Subject: [QGIS-Developer] QGIS commercial organisations: PLEASE invest in
 time for pull request reviews
Message-ID: <CAB28AsipNrads2PQn-0_dUi5SMzAHgo2rzAEdx5NBx8sC1HLMg@mail.gmail.com>

Hi all,

Sorry to keep banging on about this same topic, but the situation is
dire once again with tons of pull requests waiting in the queue for
review and a desperate need for more experienced developers helping
out and fixing the horrendous turn around time for PR review.

Case in point: Right now we're seeing an issue with a hang on start in
QGIS 3.20.1. This is frankly a horrible issue, made even worse by the
fact that there's been a PR sitting in the queue fixing this very
issue waiting on action for weeks (the fix required changes before it
could be backported to 3.20, and no action was taken on this front
till I came back from leave this week and took over the changes). So
now our users are experiencing this horrible QGIS breaking issue....
and yet the PR queue is still being ignored by the organisations who
are employing the only people with the power to fix this.

So PLEASE PLEASE PLEASE if you are in charge of a company offering
QGIS development services I plead with you to set aside some regular
time for your employees experienced in QGIS code to review and
maintain the pull request queue.

Nyall

From etienne.trimaille at gmail.com  Thu Jul 22 23:32:40 2021
From: etienne.trimaille at gmail.com (Etienne Trimaille)
Date: Fri, 23 Jul 2021 08:32:40 +0200
Subject: [QGIS-Developer] Access DB manager connection details in a
 python plugins
In-Reply-To: <CAEeudyT+Qi+mtLTg++4g8dVWZ2W=oxpWY1__PQSXw2kj9KGDDA@mail.gmail.com>
References: <CAEeudyT+Qi+mtLTg++4g8dVWZ2W=oxpWY1__PQSXw2kj9KGDDA@mail.gmail.com>
Message-ID: <CAMtDFL+Cz8weqQxtipxRuqcjUBHvSmLPGzEK_JBBT6MZNjTQZw@mail.gmail.com>

Can you clarify what you need from DBManager?
Widgets ? Features ?
Or do you mean to be able to list DB connections and launch SQL queries ?

You should avoid importing code from the DbManager plugin as it is removed
step by step.
Use the database API :
https://qgis.org/api/classQgsAbstractDatabaseProviderConnection.html

metadata = QgsProviderRegistry.instance().providerMetadata('postgres')
connection = metadata.findConnection("name_of_connection)
connection.executeSql("SELECT ....")



Le jeu. 22 juil. 2021 ? 22:09, Florian El Ahdab <felahdab at gmail.com> a
?crit :

> Hi.
>
> I would like to take advantage of the db manager from a python plugin.
> That would allow me to avoid handling the database configuration myself and
> would make the overall ui more consistent for the user.
>
> I can't find any relevant reference to do that.
>
> Has anyone achieved anything like that ?
>
> Regards.
> Florian.
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210723/b0861b3a/attachment.html>

From charles at kartoza.com  Fri Jul 23 08:36:15 2021
From: charles at kartoza.com (Charles Dixon-Paver)
Date: Fri, 23 Jul 2021 17:36:15 +0200
Subject: [QGIS-Developer] [Qgis-user] QGIS data source speed profiling
In-Reply-To: <CAOrcXHFJUj=BzVNSVzo8BxaqpQ2eMdV4UD03uQdLLZjEytwkSw@mail.gmail.com>
References: <CAOrcXHFJUj=BzVNSVzo8BxaqpQ2eMdV4UD03uQdLLZjEytwkSw@mail.gmail.com>
Message-ID: <CAK2KqicWxYXTV=KaSq93ruKGt7664qzGzoEsmEN97mwBxhe0MQ@mail.gmail.com>

You can use the F12 key to access the developer tools which have a panel
for recording and monitoring network requests, as well as timing certain
operations for debug purposes.

One other trick I thought of to try was to use the label expression
epoch($now) on both a remote and local layer to show the time that an
expression is evaluated per layer which should give some indication of how
quickly a layer is available to QGIS. I then added a canvas decoration with
the same expression and every time I panned I could get the difference in
milliseconds between the layers. This actually kind of worked to my
surprise. Although not ideal it certainly should give you some sort of
feedback on vector layers and identify some of the slower layers.

Some of the members of the development list may have more sophisticated
methods available so I've copied that list into the response.

Regards

On Fri, 23 Jul 2021 at 15:59, Hugh Kelley <hghklly at gmail.com> wrote:

> Hi all,
>
> I have a number of qgis files with a layers pulling datasets from a
> variety of sources that include local and shared drive files, shp, gpkg,
> tiff, and a few more, postgres databases and web feature services and map
> tile services.
>
> I'm wondering if anyone has any recommended workflows or tools for
> understanding the time required to refresh these layers. Some are faster
> than others and I have suspicions but I'd like to be able to see actual
> data confirming what I think are the slower layers.
>
> It's complicated by the fact that some symbologies take longer to render
> than others and that for non-local data sources, the connection speeds may
> change.
>
> Thanks for any suggestions. happy friday!
>
>
> Hugh
>
> _______________________________________________
> Qgis-user mailing list
> Qgis-user at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-user
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-user
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210723/1436680c/attachment.html>

From felahdab at gmail.com  Fri Jul 23 08:48:21 2021
From: felahdab at gmail.com (Florian El Ahdab)
Date: Fri, 23 Jul 2021 17:48:21 +0200
Subject: [QGIS-Developer] Access DB manager connection details in a
 python plugins
In-Reply-To: <CAMtDFL+Cz8weqQxtipxRuqcjUBHvSmLPGzEK_JBBT6MZNjTQZw@mail.gmail.com>
References: <CAEeudyT+Qi+mtLTg++4g8dVWZ2W=oxpWY1__PQSXw2kj9KGDDA@mail.gmail.com>
 <CAMtDFL+Cz8weqQxtipxRuqcjUBHvSmLPGzEK_JBBT6MZNjTQZw@mail.gmail.com>
Message-ID: <CAEeudyS2EeSuBvAGD8hX7y0W9yfGT7yQ2gNDH6zG11rE7VTQKA@mail.gmail.com>

Hi

Thanks.
Your code snippet is what I was looking for. I want to re-use the database
connection settings from my plugin.

Regards.
Florian.

Le ven. 23 juil. 2021 ? 08:32, Etienne Trimaille <
etienne.trimaille at gmail.com> a ?crit :

> Can you clarify what you need from DBManager?
> Widgets ? Features ?
> Or do you mean to be able to list DB connections and launch SQL queries ?
>
> You should avoid importing code from the DbManager plugin as it is removed
> step by step.
> Use the database API :
> https://qgis.org/api/classQgsAbstractDatabaseProviderConnection.html
>
> metadata = QgsProviderRegistry.instance().providerMetadata('postgres')
> connection = metadata.findConnection("name_of_connection)
> connection.executeSql("SELECT ....")
>
>
>
> Le jeu. 22 juil. 2021 ? 22:09, Florian El Ahdab <felahdab at gmail.com> a
> ?crit :
>
>> Hi.
>>
>> I would like to take advantage of the db manager from a python plugin.
>> That would allow me to avoid handling the database configuration myself and
>> would make the overall ui more consistent for the user.
>>
>> I can't find any relevant reference to do that.
>>
>> Has anyone achieved anything like that ?
>>
>> Regards.
>> Florian.
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210723/bf1b5449/attachment-0001.html>

From charles at kartoza.com  Mon Jul 26 00:28:26 2021
From: charles at kartoza.com (Charles Dixon-Paver)
Date: Mon, 26 Jul 2021 09:28:26 +0200
Subject: [QGIS-Developer] DWG files preview in QGIS
In-Reply-To: <636071771.173689.1627255887836@nm72.abv.bg>
References: <1228961645.1995170.1626791475712@nm71.abv.bg>
 <CAK2Kqice8fTPthJHhTR_eiYvWyxMr3eMUu+3zB_80mOdV=pyjg@mail.gmail.com>
 <2100701243.40254.1626939294931@nm71.abv.bg>
 <CAK2KqiewD2HMvZJdrWx_VQAppZSSWUBrrwzY+fBAbeUSMiC_WA@mail.gmail.com>
 <636071771.173689.1627255887836@nm72.abv.bg>
Message-ID: <CAK2KqidtMb_nqdSRgnjeE9DN5D5_+GKUFOdaERE9U3piE=Atyg@mail.gmail.com>

There should be no need to buy additional software to bulk convert DWG
files to PNG format. If you have access to autocad you should be able to
bulk export your layouts. I could likely share an auto lisp routine but
without an autocad license and sample data I wouldn't be able to test it.

As I said, I personally used the Autodesk True View application (which is
free) to bulk export to pdf. You can also use a program like imagemajick to
bulk convert PDF to PNG, so although it's a more complex workflow than
exporting directly to PNG it is certainly possible without purchasing
separate software.

If you struggle with automating these steps let me know. I expect it to be
quite a common procedure for users who work with CAD data and it may be
worth a quick YouTube tutorial or similar. Even if it does take some extra
time to develop, if you pay an open source consultant to develop a solution
rather than paying for conversion software, everyone can benefit.

On Mon, 26 Jul 2021, 01:31 todor lambev, <totolamb at abv.bg> wrote:

> Dear Charles,
>
> Thank you very much for your reply. I learned something new and usefull.
> I have to buy a DWG -> PNG convertor now but I think that will be fair if
> I need to preview all the files.
>
>
> Best regards
>
> Todor Lambev, PhD Student- - - - -*Institute of Oceanology
> **Department of coastal zones dynamics
> mob: +359 886 75 72 85;
> Varna, Bulgaria
> URL: http://www.io-bas.bg <http://www.io-bas.bg>*
>
>
>
>
>
> >-------- ?????????? ????? --------
> >??: Charles Dixon-Paver charles at kartoza.com
> >???????: Re: [QGIS-Developer] DWG files preview in QGIS
> >??: todor lambev <totolamb at abv.bg>
> >????????? ??: 23.07.2021 00:20
>
> No problem Todor, although it may be worth bearing in mind that these
> sorts of usability questions are typically better suited to the QGIS User
> mailing list and may get a better response from there.
>
> In terms of your query, I would say it is certainly possible to achieve in
> QGIS, but there are a few limits to what is possible and what is practical.
>
> Like I mentioned before, I believe what you are after is better served
> using raster files displaying your CAD information, so converting your DWGs
> to a raster format beforehand would be beneficial.
>
> Previewing the DWG file itself in QGIS probably isn't easily feasible, the
> easiest approach likely being some sort of HTML viewer integration. You can
> also convert the DWG to GPKG using QGIS tools to make it easier to work
> with, but again I feel this is not what you seem to need for your use case.
>
> I would expect some data from a DWG to be unsupported by QGIS when
> converting it, as well as having data which is outside of the drawing
> paperspace not be included in the preview image (amongst other issues
> depending on the structure/ design of the DWGs). Jorge outlined the code
> needed to load the DWG with an external program using an action as
> well, but that would specifically require loading an instance of a third
> party program. My suggestion would be to build the map project as outlined
> in the presentation with raster images, and attach an action to open the
> complete drawing for further introspection.
>
> I have created a small demo project which demonstrates how to achieve the
> outcomes I described. It includes various actions for launching file
> previews and contains a number of different layer styles and approaches for
> rendering the data in various manners as you would like. You can also
> configure the feature identification tool to automatically load the feature
> form and use the QGIS drag and Drop form designer to configure an image
> preview. The project also demonstrates using the QGIS atlas feature with
> print layouts to achieve the specific outcome highlighted in the
> presentation document.
>
> [image: output_3.png]
>
> You can download the files and project, DWG_integration_example.zip, from
> the following temporary file share:
>
> https://filebin.net/qxrw2xc94syeioo4
>
> (The Chrome browser security may complain it is unsafe, but you should be
> able to download it with firefox or edge etc)
>
> SHA256: 7E9E5A398BFAE4115EEE6D5C1B2073ED7314C6B7186AB61818D613B389991FD7
>
> I used some sample DWGs from the internet and bulk exported them to PDF
> using TrueView before converting to PNG, so this is definitely something
> you can make at least semi-automatic. If you have access to autocad, I
> imagine there are a number of options available for bulk exporting/
> plotting/ publishing, if not from within the software itself, certainly
> using AutoLisp.
>
> You could of course try to build similar DWG viewing functionality and
> leverage it in QGIS similar to what I have demonstrated with raster data,
> but I doubt it would be practical.
>
> I hope that this solves your issues and provides you with a strong
> starting point for configuring your project.
>
> On Thu, 22 Jul 2021 at 09:34, todor lambev < totolamb at abv.bg> wrote:
>
> Dear Charles,
>
> Thank you very much for your reply. In fact this is my first time that I
> use QGIS-developer forum and I am pleasantly surprised that someone replied
> to my questions.
>
> No on the topic.  In the attached presentation you can find an explanation
> what I would like to receive as a final "product.  Do you think that it is
> possible or at least someting similar? The idea of the hole excersice is to
> be able to make a quick visual check of all the profiles which I have in
> separate DWGs.
>
>
> Best regards
>
> Todor Lambev, PhD Student- - - - -*Institute of Oceanology
> **Department of coastal zones dynamics
> mob: +359 886 75 72 85;
> Varna, Bulgaria
> URL: http://www.io-bas.bg <http://www.io-bas.bg>*
>
>
>
>
>
> >-------- ?????????? ????? --------
> >??: Charles Dixon-Paver charles at kartoza.com
> >???????: Re: [QGIS-Developer] DWG files preview in QGIS
> >??: todor lambev < totolamb at abv.bg>
> >????????? ??: 20.07.2021 18:38
>
> It's not totally clear to me what the objective is for your DWGs.
>
> By "preview", do you mean wish to just view an overview image of the DWG
> contents? If that is the case, I would recommend using a separate command
> line/ batch process to produce raster format previews as DWGs. You can then
> create a new field for the accompanying raster file using the field
> calculator and QGIS expressions.
>
> With the rasters you can use the preview option in the feature form, or
> even use a "Raster Image Marker" based symbol at certain scales to
> represent the DXF previews.
>
> Another option for previews is to use the "Show map tips" option from the
> QGIS toolbars. In the "Display" section of the layer properties you will
> find that tooltips can use HTML code which will render a "web preview" of
> the feature when you hover the cursor on it. for example, the
> following should allow image previews:
>
> <img src='file:///[%  @project_folder || '/' || "image" %]' height=400
> width=400 />
>
> In theory, you could likely combine this with a DWG rendering library such
> as https://sharecad.org/it/DWGOnlinePlugin but I expect it will be
> difficult to use and not very efficient, hence why I would suggest
> converting the data to raster beforehand. One other thing you could do as
> well is to use the "web view" of the QGIS form to render an html template
> with an integrated viewer, but again, this is likely difficult and not
> necessary.
>
> I am not aware of any "preview" plugin for rendering DWG data within QGIS.
>
> If your aim is to "load" the DWG into your project from a command
> available within the point feature attributes, this is supported by using
> GitHub actions and some custom code, although the process may be quite
> cumbersome. Actions functionality was covered on the last QGIS Open Day[1]
> and I recommend watching the demonstration if that is your use case.
> Alternatively, there is also some written material on this topic [2] f you
> would prefer to start there
>
> [1] https://github.com/qgis/QGIS/wiki/QOD-June-2021#qgis-actions-deep-dive
> [2]
> https://courses.spatialthoughts.com/pyqgis-in-a-day.html#creating-custom-python-actions
>
>
> On Tue, 20 Jul 2021 at 16:40, todor lambev < totolamb at abv.bg> wrote:
>
> Dear QGIS developers,
>
> I have a strange need. Could you help me?
> I have 30 000 DWG files that are not georeferenced, each file has unique
> and a specific name. I have a point shapefile which in its attribute table
> contains a column with the names of the *dwg files.
>
> My question is: How I can load to preview the DWG files in QGIS next to
> the points or to preview the DWG by clicking on the point (similar to the
> photo preview widget)?
>
> I hope that you won't skip my question and will help me to find a solution
> basically because otherwise, I have to do it manually...
>
> Best regards
>
> Todor Lambev, PhD Student- - - - -*Institute of Oceanology
> **Department of coastal zones dynamics
> mob: +359 886 75 72 85;
> Varna, Bulgaria
> URL: http://www.io-bas.bg <http://www.io-bas.bg>*
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210726/96a214be/attachment.html>

From julien.cabieces at oslandia.com  Mon Jul 26 01:30:36 2021
From: julien.cabieces at oslandia.com (Julien Cabieces)
Date: Mon, 26 Jul 2021 10:30:36 +0200
Subject: [QGIS-Developer] Questions about using QgsTask class
In-Reply-To: <68-60f18b00-27-1b381d20@36430645>
References: <68-60f18b00-27-1b381d20@36430645>
Message-ID: <87bl6plbo3.fsf@julien-laptop.home>


Hi Nicolae,

It's not mandatory to add the task to the globals, you just need to keep
a reference to your QgsTask somewhere (as a member of another class for
instance) during the task execution. If not, Python garbage collector
will delete the referenced object when the variable scope ends (when the
methods which create the task ends), which would lead to some errors.

Regarding the second point, it's important to understand that the
QgsTaskManager will destroy your task when it finishes, so your variable
referencing your task is destroyed (actually the python object is
not but the underlying C++ object is, so the message "wrapped C/C++
object of type TestTask has been deleted").

You can connect to signal taskCompleted, get everything you want from
your task, and then it will be deleted.

Kind regards,
Julien

> Dear QGIS developers,
>
> My name is Nicolae Marinica (Nicu) from QTIBIA Engineering and I recently started to work with QGIS. While developing a new QGIS plugin, I stumbled upon some problems when using QgsTask. Although my background is in the embedded world (with C/C++ and Python), I am interested in increasing my QGIS know-how and contributing to the QGIS project. I want to know if this workaround (described below) is valid so that I can contribute by adding it in to the documentation such that other people will not spend time in finding it, like I did.
>
> I want to run from a QGIS plugin a QgsTask created according to the documentation (https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/tasks.html). I tried both versions: a task from a function and I also created my own task by extending QgsTask class. In both cases, the task terminates successfully but the finished method is never  called/executed. I do not perform any GUI based operation from the run method as described in the documentation.
>
> The workaround (found on the internet - https://gis.stackexchange.com/questions/296175/issues-with-qgstask-and-task-manager) was to to declare the task as global variable like:
>
> globals()['task1'] = TestTask('waste cpu long', 20)
> tsk_mngr = QgsApplication.taskManager()
> tsk_mngr.addTask(globals()['task1'])
>
> Furthermore, I can not longer use the QgsTask object (defined as above) if a task terminates. When I try to call any method of the terminated task I get the following error message "wrapped C/C++ object of type TestTask has been deleted". It looks like the C/C++ object was destroyed while the python object still exists. The workaround for this one is to catch the exception and to return something convenient (in my case for task1.status() return QgsTask.Terminated).
>
> Any advice would be appreciated and I would like to thank all contributors to this super nice project.
> ??????
> Wish you all the best!
> Thanks,
> Nicu 
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer


From nyall.dawson at gmail.com  Tue Jul 27 21:02:30 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Wed, 28 Jul 2021 14:02:30 +1000
Subject: [QGIS-Developer] Grant report: Rework handling of multi-layer,
 mixed-format datasets
Message-ID: <CAB28AsiKK6Cmrr2RmR52xmq_7oFgL5_i+Fy8ZwpGidEgndr78w@mail.gmail.com>

Hi lists,

Just reporting in the conclusion of the grant work: "Rework handling
of multi-layer, mixed-format datasets". You can read more about the
motivation behind this work at
https://github.com/qgis/QGIS-Enhancement-Proposals/issues/216

While the work was partly motivated as an opportunity to clean up some
older parts of the QGIS codebase which were fragile and had low test
coverage, it has also resulted in many improvements and polish in the
QGIS user interface. Specifically:

- There's a much improved dialog shown when a user has to pick from
multiple layers from a dataset dropped onto QGIS. The dialog will
populate in a background thread, avoiding the UI hangs older QGIS
versions experience when scanning for layers in large files. The
dialog shows a unified view of all layers in the dataset, regardless
of whether they are vector, raster or mesh layers. There's also a new
"filter" widget allowing users to quickly find matching layers in
larger datasets.

- The browser view of files and file-based datasources has been
reworked. You'll no longer see duplicate entries for the same files
when these files can be read as either raster/vector/mesh layers (e.g.
for netcdf files, geopdf files and other mixed-format types). A lot of
consistency has been added to the right click actions you see when
interacting with file based items, with many bugs fixed along the way.

Under the hood, we've now got a flexible API for querying sublayers of
a dataset which can be easily extended to new providers so that they
automatically participate in the unified sublayers dialog and browser
items. It's all protected by a huge number of new unit tests, the
majority of which cover critical functionality which was previously
not being tested.

Thanks for funding this work!
Nyall

From nyall.dawson at gmail.com  Tue Jul 27 21:04:35 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Wed, 28 Jul 2021 14:04:35 +1000
Subject: [QGIS-Developer] Grant report: Rework handling of multi-layer,
 mixed-format datasets
In-Reply-To: <CAB28AsiKK6Cmrr2RmR52xmq_7oFgL5_i+Fy8ZwpGidEgndr78w@mail.gmail.com>
References: <CAB28AsiKK6Cmrr2RmR52xmq_7oFgL5_i+Fy8ZwpGidEgndr78w@mail.gmail.com>
Message-ID: <CAB28AsjF48_pefGRcgxLQhPp6e7d4rj-etokQHpJbZfsyhXcHQ@mail.gmail.com>

On Wed, 28 Jul 2021 at 14:02, Nyall Dawson <nyall.dawson at gmail.com> wrote:
>
> Hi lists,
>
> Just reporting in the conclusion of the grant work: "Rework handling
> of multi-layer, mixed-format datasets". You can read more about the
> motivation behind this work at
> https://github.com/qgis/QGIS-Enhancement-Proposals/issues/216
>
> While the work was partly motivated as an opportunity to clean up some
> older parts of the QGIS codebase which were fragile and had low test
> coverage, it has also resulted in many improvements and polish in the
> QGIS user interface. Specifically:
>
> - There's a much improved dialog shown when a user has to pick from
> multiple layers from a dataset dropped onto QGIS. The dialog will
> populate in a background thread, avoiding the UI hangs older QGIS
> versions experience when scanning for layers in large files. The
> dialog shows a unified view of all layers in the dataset, regardless
> of whether they are vector, raster or mesh layers. There's also a new
> "filter" widget allowing users to quickly find matching layers in
> larger datasets.
>
> - The browser view of files and file-based datasources has been
> reworked. You'll no longer see duplicate entries for the same files
> when these files can be read as either raster/vector/mesh layers (e.g.
> for netcdf files, geopdf files and other mixed-format types). A lot of
> consistency has been added to the right click actions you see when
> interacting with file based items, with many bugs fixed along the way.
>
> Under the hood, we've now got a flexible API for querying sublayers of
> a dataset which can be easily extended to new providers so that they
> automatically participate in the unified sublayers dialog and browser
> items. It's all protected by a huge number of new unit tests, the
> majority of which cover critical functionality which was previously
> not being tested.

Oh, I forgot another cool new feature -- when dragging and dropping a
geopackage onto QGIS, the dialog showing layers will also show any
embedded projects in that gpkg, making it MUCH easier to open them!

Nyall

From cavallini at faunalia.it  Tue Jul 27 23:43:09 2021
From: cavallini at faunalia.it (Paolo Cavallini)
Date: Wed, 28 Jul 2021 09:43:09 +0300
Subject: [QGIS-Developer] Grant report: Rework handling of multi-layer,
 mixed-format datasets
In-Reply-To: <CAB28AsiKK6Cmrr2RmR52xmq_7oFgL5_i+Fy8ZwpGidEgndr78w@mail.gmail.com>
References: <CAB28AsiKK6Cmrr2RmR52xmq_7oFgL5_i+Fy8ZwpGidEgndr78w@mail.gmail.com>
Message-ID: <BAD6EFD6-3DC1-4862-9F4C-5476461A7DBF@faunalia.it>

Thanks a lot Nyall, I'm sure you did more and better work than it was expected. Our donors can be happy.
Cheers.

Il 28 luglio 2021 07:02:30 EEST, Nyall Dawson <nyall.dawson at gmail.com> ha scritto:
>Hi lists,
>
>Just reporting in the conclusion of the grant work: "Rework handling
>of multi-layer, mixed-format datasets". You can read more about the
>motivation behind this work at
>https://github.com/qgis/QGIS-Enhancement-Proposals/issues/216
>
>While the work was partly motivated as an opportunity to clean up some
>older parts of the QGIS codebase which were fragile and had low test
>coverage, it has also resulted in many improvements and polish in the
>QGIS user interface. Specifically:
>
>- There's a much improved dialog shown when a user has to pick from
>multiple layers from a dataset dropped onto QGIS. The dialog will
>populate in a background thread, avoiding the UI hangs older QGIS
>versions experience when scanning for layers in large files. The
>dialog shows a unified view of all layers in the dataset, regardless
>of whether they are vector, raster or mesh layers. There's also a new
>"filter" widget allowing users to quickly find matching layers in
>larger datasets.
>
>- The browser view of files and file-based datasources has been
>reworked. You'll no longer see duplicate entries for the same files
>when these files can be read as either raster/vector/mesh layers (e.g.
>for netcdf files, geopdf files and other mixed-format types). A lot of
>consistency has been added to the right click actions you see when
>interacting with file based items, with many bugs fixed along the way.
>
>Under the hood, we've now got a flexible API for querying sublayers of
>a dataset which can be easily extended to new providers so that they
>automatically participate in the unified sublayers dialog and browser
>items. It's all protected by a huge number of new unit tests, the
>majority of which cover critical functionality which was previously
>not being tested.
>
>Thanks for funding this work!
>Nyall
>_______________________________________________
>QGIS-Developer mailing list
>QGIS-Developer at lists.osgeo.org
>List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

-- 
Sorry for being short
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/d5907ee1/attachment.html>

From tim at kartoza.com  Tue Jul 27 23:59:47 2021
From: tim at kartoza.com (Tim Sutton)
Date: Wed, 28 Jul 2021 07:59:47 +0100
Subject: [QGIS-Developer] [Qgis-psc] Grant report: Rework handling of
 multi-layer, mixed-format datasets
In-Reply-To: <BAD6EFD6-3DC1-4862-9F4C-5476461A7DBF@faunalia.it>
References: <BAD6EFD6-3DC1-4862-9F4C-5476461A7DBF@faunalia.it>
Message-ID: <95A74841-7A8E-40CD-9D99-F1136325A5F1@kartoza.com>

Wow great work Nyall!

Regards

Tim

Sent from my iPhone

> On 28 Jul 2021, at 07:43, Paolo Cavallini <cavallini at faunalia.it> wrote:
> 
> ?Thanks a lot Nyall, I'm sure you did more and better work than it was expected. Our donors can be happy.
> Cheers.
> 
> Il 28 luglio 2021 07:02:30 EEST, Nyall Dawson <nyall.dawson at gmail.com> ha scritto:
>> 
>> Hi lists,
>> 
>> Just reporting in the conclusion of the grant work: "Rework handling
>> of multi-layer, mixed-format datasets". You can read more about the
>> motivation behind this work at
>> https://github.com/qgis/QGIS-Enhancement-Proposals/issues/216
>> 
>> While the work was partly motivated as an opportunity to clean up some
>> older parts of the QGIS codebase which were fragile and had low test
>> coverage, it has also resulted in many improvements and polish in the
>> QGIS user interface. Specifically:
>> 
>> - There's a much improved dialog shown when a user has to pick from
>> multiple layers from a dataset dropped onto QGIS. The dialog will
>> populate in a background thread, avoiding the UI hangs older QGIS
>> versions experience when scanning for layers in large files. The
>> dialog shows a unified view of all layers in the dataset, regardless
>> of whether they are vector, raster or mesh layers. There's also a new
>> "filter" widget allowing users to quickly find matching layers in
>> larger datasets.
>> 
>> - The browser view of files and file-based datasources has been
>> reworked. You'll no longer see duplicate entries for the same files
>> when these files can be read as either raster/vector/mesh layers (e.g.
>> for netcdf files, geopdf files and other mixed-format types). A lot of
>> consistency has been added to the right click actions you see when
>> interacting with file based items, with many bugs fixed along the way.
>> 
>> Under the hood, we've now got a flexible API for querying sublayers of
>> a dataset which can be easily extended to new providers so that they
>> automatically participate in the unified sublayers dialog and browser
>> items. It's all protected by a huge number of new unit tests, the
>> majority of which cover critical functionality which was previously
>> not being tested.
>> 
>> Thanks for funding this work!
>> Nyall
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> 
> -- 
> Sorry for being short_______________________________________________
> Qgis-psc mailing list
> Qgis-psc at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/qgis-psc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/f2056438/attachment.html>

From kimaidou at gmail.com  Wed Jul 28 01:45:04 2021
From: kimaidou at gmail.com (kimaidou)
Date: Wed, 28 Jul 2021 10:45:04 +0200
Subject: [QGIS-Developer] [Qgis-psc] Grant report: Rework handling of
 multi-layer, mixed-format datasets
In-Reply-To: <95A74841-7A8E-40CD-9D99-F1136325A5F1@kartoza.com>
References: <BAD6EFD6-3DC1-4862-9F4C-5476461A7DBF@faunalia.it>
 <95A74841-7A8E-40CD-9D99-F1136325A5F1@kartoza.com>
Message-ID: <CAMKXKO6WSZBJTB0dRsOc6RauuytWK_P510KfnsipdG2DriRnFA@mail.gmail.com>

Thanks a lot !

Regards,
Micha?l

Le mer. 28 juil. 2021 ? 09:00, Tim Sutton <tim at kartoza.com> a ?crit :

> Wow great work Nyall!
>
> Regards
>
> Tim
>
> Sent from my iPhone
>
> On 28 Jul 2021, at 07:43, Paolo Cavallini <cavallini at faunalia.it> wrote:
>
> ?Thanks a lot Nyall, I'm sure you did more and better work than it was
> expected. Our donors can be happy.
> Cheers.
>
> Il 28 luglio 2021 07:02:30 EEST, Nyall Dawson <nyall.dawson at gmail.com> ha
> scritto:
>>
>> Hi lists,
>>
>> Just reporting in the conclusion of the grant work: "Rework handling
>> of multi-layer, mixed-format datasets". You can read more about the
>> motivation behind this work at
>> https://github.com/qgis/QGIS-Enhancement-Proposals/issues/216
>>
>> While the work was partly motivated as an opportunity to clean up some
>> older parts of the QGIS codebase which were fragile and had low test
>> coverage, it has also resulted in many improvements and polish in the
>> QGIS user interface. Specifically:
>>
>> - There's a much improved dialog shown when a user has to pick from
>> multiple layers from a dataset dropped onto QGIS. The dialog will
>> populate in a background thread, avoiding the UI hangs older QGIS
>> versions experience when scanning for layers in large files. The
>> dialog shows a unified view of all layers in the dataset, regardless
>> of whether they are vector, raster or mesh layers. There's also a new
>> "filter" widget allowing users to quickly find matching layers in
>> larger datasets.
>>
>> - The browser view of files and file-based datasources has been
>> reworked. You'll no longer see duplicate entries for the same files
>> when these files can be read as either raster/vector/mesh layers (e.g.
>> for netcdf files, geopdf files and other mixed-format types). A lot of
>> consistency has been added to the right click actions you see when
>> interacting with file based items, with many bugs fixed along the way.
>>
>> Under the hood, we've now got a flexible API for querying sublayers of
>> a dataset which can be easily extended to new providers so that they
>> automatically participate in the unified sublayers dialog and browser
>> items. It's all protected by a huge number of new unit tests, the
>> majority of which cover critical functionality which was previously
>> not being tested.
>>
>> Thanks for funding this work!
>> Nyall
>> ------------------------------
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>>
>>
> --
> Sorry for being short_______________________________________________
> Qgis-psc mailing list
> Qgis-psc at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/qgis-psc
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/638971b4/attachment-0001.html>

From kimaidou at gmail.com  Wed Jul 28 03:08:31 2021
From: kimaidou at gmail.com (kimaidou)
Date: Wed, 28 Jul 2021 12:08:31 +0200
Subject: [QGIS-Developer] Monitor QGIS (Server) memory consumption per
 project
Message-ID: <CAMKXKO4Ci4GjtunFU0RgOsi35ZjLJj3czzKqEhi7HGC+US7eFQ@mail.gmail.com>

Hi all,

We (@3liz.com) use QGIS Server since a long time to provide hosting
services for our clients, with Lizmap Web Client (LWC) as the web map
builder.

Having hundred LWC instances, we pay obviously attention to metrics, and
monitor the CPU, memory, requests response time, etc.

We sometimes encounter heavy memory consumption for specific projects, for
example :
https://github.com/qgis/QGIS/issues/43787
which put a lot of strain to the servers.

It is often very hard to find the project(s) responsible for a high memory
usage, in a production context, when many requests are run in parallel for
many projects.

I created a POC processing script to audit all the QGIS projects stored in
a folder:
https://gist.github.com/mdouchin/cd89a259d3560635d4bb8708ad430caa/
which helps a bit to gather some key figures, such as the number of layers,
the sum of the images used in map layouts, etc.
This can help, but often the memory consumption is not related to the
number of layers, and we use a "find a needle in the haystack" approach to
find the problematic project(s).

For example, I spent once a whole day finding that a too big JPEG used in a
print layout causes the heavy memory usage:
* look at the memory curve,
* find the moment when the memory increased a lot
* use the command line find  to get which QGIS project files has changed
during this period (for example because it has been uploaded by the user)
* look inside QGIS logs to find which project has been loaded during this
period, and compare
* if you are lucky, there are not so many projects involved...
* download the project, open it in QGIS Desktop to observe and confirm the
memory issue
* try to understand which causes the issue
* ...

We are also building a REST API over py-qgis-server (
https://github.com/3liz/py-qgis-server ) which will allow to get
information on the loaded projects, to ease the auditing process in
real-time. (It will be opensource).

In the processing script, and in this API tool, we still miss a very
important metric: how much each project consumes the system memory (RAM). I
am not sure it could be easily done, but it will be very handy to:

* find heavy memory consumer projects
* see how the memory evolves
* compare the memory usage for each QGIS versions (with the same project
and layers)
* help to find the possible memory leaks

This message is not a feature request, I would like to get your experience
and opinion regarding this memory usage issue. Any contribution welcome ;-)

Thanks in advance
Micha?l
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/b83dbb3f/attachment.html>

From kimaidou at gmail.com  Wed Jul 28 07:52:55 2021
From: kimaidou at gmail.com (kimaidou)
Date: Wed, 28 Jul 2021 16:52:55 +0200
Subject: [QGIS-Developer] Monitor QGIS (Server) memory consumption per
 project
In-Reply-To: <CAMKXKO4Ci4GjtunFU0RgOsi35ZjLJj3czzKqEhi7HGC+US7eFQ@mail.gmail.com>
References: <CAMKXKO4Ci4GjtunFU0RgOsi35ZjLJj3czzKqEhi7HGC+US7eFQ@mail.gmail.com>
Message-ID: <CAMKXKO5s3fbkOqNWfbHOnsyzUvdvGS00TLXNGQq3WbBRbqkZUA@mail.gmail.com>

Hey,

I updated my "audit qgis projects" processing algorithm with a
quick-and-dirty method to calculate the memory usage, before and after each
project reading
https://gist.github.com/mdouchin/cd89a259d3560635d4bb8708ad430caa#file-lizmapauditqgisprojects-py-L150

It is not very reliable and should not be used in a highly changing
environment (production server with high activity).
It could help nonetheless...

Regards,
Micha?l

Le mer. 28 juil. 2021 ? 12:08, kimaidou <kimaidou at gmail.com> a ?crit :

> Hi all,
>
> We (@3liz.com) use QGIS Server since a long time to provide hosting
> services for our clients, with Lizmap Web Client (LWC) as the web map
> builder.
>
> Having hundred LWC instances, we pay obviously attention to metrics, and
> monitor the CPU, memory, requests response time, etc.
>
> We sometimes encounter heavy memory consumption for specific projects, for
> example :
> https://github.com/qgis/QGIS/issues/43787
> which put a lot of strain to the servers.
>
> It is often very hard to find the project(s) responsible for a high memory
> usage, in a production context, when many requests are run in parallel for
> many projects.
>
> I created a POC processing script to audit all the QGIS projects stored in
> a folder:
> https://gist.github.com/mdouchin/cd89a259d3560635d4bb8708ad430caa/
> which helps a bit to gather some key figures, such as the number of
> layers, the sum of the images used in map layouts, etc.
> This can help, but often the memory consumption is not related to the
> number of layers, and we use a "find a needle in the haystack" approach to
> find the problematic project(s).
>
> For example, I spent once a whole day finding that a too big JPEG used in
> a print layout causes the heavy memory usage:
> * look at the memory curve,
> * find the moment when the memory increased a lot
> * use the command line find  to get which QGIS project files has changed
> during this period (for example because it has been uploaded by the user)
> * look inside QGIS logs to find which project has been loaded during this
> period, and compare
> * if you are lucky, there are not so many projects involved...
> * download the project, open it in QGIS Desktop to observe and confirm the
> memory issue
> * try to understand which causes the issue
> * ...
>
> We are also building a REST API over py-qgis-server (
> https://github.com/3liz/py-qgis-server ) which will allow to get
> information on the loaded projects, to ease the auditing process in
> real-time. (It will be opensource).
>
> In the processing script, and in this API tool, we still miss a very
> important metric: how much each project consumes the system memory (RAM). I
> am not sure it could be easily done, but it will be very handy to:
>
> * find heavy memory consumer projects
> * see how the memory evolves
> * compare the memory usage for each QGIS versions (with the same project
> and layers)
> * help to find the possible memory leaks
>
> This message is not a feature request, I would like to get your experience
> and opinion regarding this memory usage issue. Any contribution welcome ;-)
>
> Thanks in advance
> Micha?l
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/d8989f4b/attachment.html>

From adenaculture at gmail.com  Wed Jul 28 12:43:16 2021
From: adenaculture at gmail.com (C Hamilton)
Date: Wed, 28 Jul 2021 19:43:16 +0000
Subject: [QGIS-Developer] Bug with GeoPackage and Expressions?
Message-ID: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>

I think I found a bug and was wondering if someone could verify this. I am
on Windows 10 and tried this with both QGIS 3.16.9 and 3.20.1.

I tried the following filter expression on the Natural Earth data set
ne_10m_populated_places (
https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places.zip).
Once loaded into QGIS right mouse click on the layer and select
"Properties...", then click on the "Source" tab, click on "Query Builder"
and then use this query

"NAME" ILIKE '%Bom%'

This works fine. If I export ne_10m_populated_places as a GeoPackage and
try the same thing with the GeoPackage version of the layer, I get the
error:

"An error occurred when executing the query, please check the expression
syntax."

If I use LIKE instead of ILIKE then it works. It is like ILIKE was not
implemented for GeoPackage. Can anyone verify this? I think you can use any
vector layer for this test with one that is a shapefile and the other a
GeoPackage.

Thanks,

Calvin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/335b83d6/attachment.html>

From even.rouault at spatialys.com  Wed Jul 28 13:00:12 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 28 Jul 2021 22:00:12 +0200
Subject: [QGIS-Developer] Bug with GeoPackage and Expressions?
In-Reply-To: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
References: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
Message-ID: <90f99169-1608-3a56-a138-a722989dbcab@spatialys.com>

SQLite, which is the underneath database engine for GeoPackage, doesn't 
support ILIKE. The SQLite LIKE operator is actually case insensitive for 
ASCII characters. See paragraph 5 "The LIKE, GLOB, REGEXP, and MATCH 
operators" of https://www.sqlite.org/lang_expr.html

Le 28/07/2021 ? 21:43, C Hamilton a ?crit?:
> I think I found a bug and was wondering if someone could verify this. 
> I am on Windows 10 and tried this with both QGIS 3.16.9 and 3.20.1.
>
> I tried the following filter expression on the Natural Earth data set 
> ne_10m_populated_places 
> (https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places.zip 
> <https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places.zip>). 
> Once loaded into QGIS right mouse click on the layer and select 
> "Properties...", then click on the "Source" tab, click on "Query 
> Builder" and then use this query
>
> "NAME" ILIKE '%Bom%'
>
> This works fine. If I export ne_10m_populated_places as a GeoPackage 
> and try the same thing with?the GeoPackage version of the layer, I get 
> the error:
>
> "An error occurred when executing the query, please check the 
> expression syntax."
>
> If I use LIKE instead of ILIKE then it works. It is like ILIKE was not 
> implemented for GeoPackage. Can anyone verify this? I think you can 
> use any vector layer for this test with one that is a shapefile and 
> the other a GeoPackage.
>
> Thanks,
>
> Calvin
>
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/b296dc4c/attachment.html>

From adenaculture at gmail.com  Wed Jul 28 13:08:25 2021
From: adenaculture at gmail.com (C Hamilton)
Date: Wed, 28 Jul 2021 20:08:25 +0000
Subject: [QGIS-Developer] [Qgis-user] Bug with GeoPackage and
 Expressions?
In-Reply-To: <cdaba3d5-3ddb-4e7d-b55b-731b45506aff@gmx.at>
References: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
 <cdaba3d5-3ddb-4e7d-b55b-731b45506aff@gmx.at>
Message-ID: <CABPxTTqfv+=zsGRgxguebbh6Mv7NELDuiNguNuRM1_rDWrX7zw@mail.gmail.com>

Thanks everyone for that explanation. This does complicate the ability to
set an expression filter in a plugin when it depends on the data source
type. I'm not sure what to do about that.

Regards,
Calvin

On Wed, Jul 28, 2021 at 8:00 PM Anita Graser <anitagraser at gmx.at> wrote:

> Hi Calvin,
>
> 28 Jul 2021 21:43:40 C Hamilton <adenaculture at gmail.com>:
> > If I use LIKE instead of ILIKE then it works. It is like ILIKE was not
> implemented for GeoPackage. Can anyone verify this?
>
> Yes, there seems to be no iLike in sqlite:
>
>
> https://stackoverflow.com/questions/15480319/case-sensitive-and-insensitive-like-in-sqlite
>
> And therefore neither in geopackage.
>
> Regards
> Anita
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210728/8c4ef731/attachment.html>

From matthias at opengis.ch  Wed Jul 28 22:30:48 2021
From: matthias at opengis.ch (Matthias Kuhn)
Date: Thu, 29 Jul 2021 07:30:48 +0200
Subject: [QGIS-Developer] [Qgis-user] Bug with GeoPackage and
 Expressions?
In-Reply-To: <CABPxTTqfv+=zsGRgxguebbh6Mv7NELDuiNguNuRM1_rDWrX7zw@mail.gmail.com>
References: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
 <cdaba3d5-3ddb-4e7d-b55b-731b45506aff@gmx.at>
 <CABPxTTqfv+=zsGRgxguebbh6Mv7NELDuiNguNuRM1_rDWrX7zw@mail.gmail.com>
Message-ID: <CAC7zN96UOoaDhEwzKHiki73b6HdmrJhWg25Gyp_Y3GG+pJd1pw@mail.gmail.com>

Can you fill a bug for this? The expression compiler in QGIS should not
forward it to ogr/gpkg/sqlite in this case.

Matthias

On Wed, Jul 28, 2021 at 10:08 PM C Hamilton <adenaculture at gmail.com> wrote:

> Thanks everyone for that explanation. This does complicate the ability to
> set an expression filter in a plugin when it depends on the data source
> type. I'm not sure what to do about that.
>
> Regards,
> Calvin
>
> On Wed, Jul 28, 2021 at 8:00 PM Anita Graser <anitagraser at gmx.at> wrote:
>
>> Hi Calvin,
>>
>> 28 Jul 2021 21:43:40 C Hamilton <adenaculture at gmail.com>:
>> > If I use LIKE instead of ILIKE then it works. It is like ILIKE was not
>> implemented for GeoPackage. Can anyone verify this?
>>
>> Yes, there seems to be no iLike in sqlite:
>>
>>
>> https://stackoverflow.com/questions/15480319/case-sensitive-and-insensitive-like-in-sqlite
>>
>> And therefore neither in geopackage.
>>
>> Regards
>> Anita
>>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210729/3ed9aaa7/attachment.html>

From nyall.dawson at gmail.com  Wed Jul 28 22:42:20 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Thu, 29 Jul 2021 15:42:20 +1000
Subject: [QGIS-Developer] [Qgis-user] Bug with GeoPackage and
 Expressions?
In-Reply-To: <CAC7zN96UOoaDhEwzKHiki73b6HdmrJhWg25Gyp_Y3GG+pJd1pw@mail.gmail.com>
References: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
 <cdaba3d5-3ddb-4e7d-b55b-731b45506aff@gmx.at>
 <CABPxTTqfv+=zsGRgxguebbh6Mv7NELDuiNguNuRM1_rDWrX7zw@mail.gmail.com>
 <CAC7zN96UOoaDhEwzKHiki73b6HdmrJhWg25Gyp_Y3GG+pJd1pw@mail.gmail.com>
Message-ID: <CAB28AsjknGikVrEivmKd=Oszr6khrCw5MgqOcNM3PnKV+g9YWw@mail.gmail.com>

On Thu, 29 Jul 2021 at 15:31, Matthias Kuhn <matthias at opengis.ch> wrote:
>
> Can you fill a bug for this? The expression compiler in QGIS should not forward it to ogr/gpkg/sqlite in this case.

My interpretation is that Calvin is setting a layer filter, so QGIS
expressions aren't involved (i.e. no bug).

Nyall

>
> Matthias
>
> On Wed, Jul 28, 2021 at 10:08 PM C Hamilton <adenaculture at gmail.com> wrote:
>>
>> Thanks everyone for that explanation. This does complicate the ability to set an expression filter in a plugin when it depends on the data source type. I'm not sure what to do about that.
>>
>> Regards,
>> Calvin
>>
>> On Wed, Jul 28, 2021 at 8:00 PM Anita Graser <anitagraser at gmx.at> wrote:
>>>
>>> Hi Calvin,
>>>
>>> 28 Jul 2021 21:43:40 C Hamilton <adenaculture at gmail.com>:
>>> > If I use LIKE instead of ILIKE then it works. It is like ILIKE was not implemented for GeoPackage. Can anyone verify this?
>>>
>>> Yes, there seems to be no iLike in sqlite:
>>>
>>> https://stackoverflow.com/questions/15480319/case-sensitive-and-insensitive-like-in-sqlite
>>>
>>> And therefore neither in geopackage.
>>>
>>> Regards
>>> Anita
>>
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer

From andreaerdna at libero.it  Wed Jul 28 22:47:44 2021
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Thu, 29 Jul 2021 07:47:44 +0200
Subject: [QGIS-Developer] [Qgis-user] Bug with GeoPackage and
 Expressions?
In-Reply-To: <CAC7zN96UOoaDhEwzKHiki73b6HdmrJhWg25Gyp_Y3GG+pJd1pw@mail.gmail.com>
References: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
 <cdaba3d5-3ddb-4e7d-b55b-731b45506aff@gmx.at>
 <CABPxTTqfv+=zsGRgxguebbh6Mv7NELDuiNguNuRM1_rDWrX7zw@mail.gmail.com>
 <CAC7zN96UOoaDhEwzKHiki73b6HdmrJhWg25Gyp_Y3GG+pJd1pw@mail.gmail.com>
Message-ID: <ed35c424-728e-3c8f-4f27-8574b63297e4@libero.it>

Il 29/07/2021 07:30, Matthias Kuhn ha scritto:
> Can you fill a bug for this? The expression compiler in QGIS should not
> forward it to ogr/gpkg/sqlite in this case.
> 
> Matthias

The Query Builder documentation [1] states that:

"The filter is made at the data provider (OGR, PostgreSQL, MSSQL?) 
level. So the syntax depends on the data provider (DateTime is for 
instance not supported for the ESRI Shapefile format)"

So I think the reported behaviour is expected.

Regards.

Andrea

[1] 
https://docs.qgis.org/3.16/en/docs/user_manual/working_with_vector/vector_properties.html#query-builder

From matthias at opengis.ch  Wed Jul 28 23:13:07 2021
From: matthias at opengis.ch (Matthias Kuhn)
Date: Thu, 29 Jul 2021 08:13:07 +0200
Subject: [QGIS-Developer] [Qgis-user] Bug with GeoPackage and
 Expressions?
In-Reply-To: <ed35c424-728e-3c8f-4f27-8574b63297e4@libero.it>
References: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
 <cdaba3d5-3ddb-4e7d-b55b-731b45506aff@gmx.at>
 <CABPxTTqfv+=zsGRgxguebbh6Mv7NELDuiNguNuRM1_rDWrX7zw@mail.gmail.com>
 <CAC7zN96UOoaDhEwzKHiki73b6HdmrJhWg25Gyp_Y3GG+pJd1pw@mail.gmail.com>
 <ed35c424-728e-3c8f-4f27-8574b63297e4@libero.it>
Message-ID: <CAC7zN94uVVLQ4dKwHqwidOS234nODORAZoYuTEkNg_4kcZLcwA@mail.gmail.com>

Thanks for pointing that out.

In this case a sqlite compatible version (I think something like
`lower(NAME) LIKE '%bom%'` should work) is required.

Hope this helps
Matthias

On Thu, Jul 29, 2021 at 7:56 AM Andrea Giudiceandrea <andreaerdna at libero.it>
wrote:

> Il 29/07/2021 07:30, Matthias Kuhn ha scritto:
> > Can you fill a bug for this? The expression compiler in QGIS should not
> > forward it to ogr/gpkg/sqlite in this case.
> >
> > Matthias
>
> The Query Builder documentation [1] states that:
>
> "The filter is made at the data provider (OGR, PostgreSQL, MSSQL?)
> level. So the syntax depends on the data provider (DateTime is for
> instance not supported for the ESRI Shapefile format)"
>
> So I think the reported behaviour is expected.
>
> Regards.
>
> Andrea
>
> [1]
>
> https://docs.qgis.org/3.16/en/docs/user_manual/working_with_vector/vector_properties.html#query-builder
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210729/b5e8965b/attachment.html>

From adenaculture at gmail.com  Thu Jul 29 06:23:43 2021
From: adenaculture at gmail.com (C Hamilton)
Date: Thu, 29 Jul 2021 09:23:43 -0400
Subject: [QGIS-Developer] [Qgis-user] Bug with GeoPackage and
 Expressions?
In-Reply-To: <CAB28AsjknGikVrEivmKd=Oszr6khrCw5MgqOcNM3PnKV+g9YWw@mail.gmail.com>
References: <CABPxTTrLm=mqc_woB-SAQ12DT94eW2CANExhzhUb0MY5TqGTSg@mail.gmail.com>
 <cdaba3d5-3ddb-4e7d-b55b-731b45506aff@gmx.at>
 <CABPxTTqfv+=zsGRgxguebbh6Mv7NELDuiNguNuRM1_rDWrX7zw@mail.gmail.com>
 <CAC7zN96UOoaDhEwzKHiki73b6HdmrJhWg25Gyp_Y3GG+pJd1pw@mail.gmail.com>
 <CAB28AsjknGikVrEivmKd=Oszr6khrCw5MgqOcNM3PnKV+g9YWw@mail.gmail.com>
Message-ID: <CABPxTTobOhS-rvkGkqyKzMN1X_0Z8tAqyhri5J6H_P9umsnZjw@mail.gmail.com>

Ultimately what I am trying to do is to revamp the Search Layers plugin (
https://plugins.qgis.org/plugins/searchlayers/) to allow searching using
two different strings with NOT, AND, OR operators, case dependent or
independent, with qualifiers where the strings are an exact match, within
the string, begins with, and ends with. The plugin allows for searching
across all layers and all attributes, or optionally a particular layer and
attribute. The two strings may be required to match within each attribute
or match in any of the attributes within the feature. I am trying to make
it very flexible and easy to use. I know that QGIS has the Locator
interface, but the users like the extra interactivity that Search Layers
provides.

Here is the issue: For some of the searches I am creating a regular
expression that matches the search parameters and iterating through each
feature and then each attribute using *re.search* to do the comparison.
Unfortunately, this is very slow. On a 2.2 million data set it can take
5-10 minutes to do the search. This is way too slow. The SQL search is less
than 5 seconds. I am using a *QgsFeatureRequest *and then setting
*request.setFilterExpression*. I am only using this when searching on a
single layer and single attribute and I don't think there is the
flexibility that there is with the regular expressions, but I don't really
use SQL and don't know what is possible. It sounds like the SQL searching
may be limited by the vector file type source.

Are there any other ways for searching that I am unaware of? The results of
the search need to identify the feature in the layer and what attribute or
attributes matched for each of the two strings and then I can apply the
NOT, AND, OR operators. I am trying to satisfy user's requests to make
Search Layers into what they want it to be and am finding it difficult to
satisfy speed, vector file types, and flexibility. I welcome any
suggestions. Ultimately I might just have to constrain the file types
supported and say to convert the data first.

Thanks,

Calvin

On Thu, Jul 29, 2021 at 1:42 AM Nyall Dawson <nyall.dawson at gmail.com> wrote:

> On Thu, 29 Jul 2021 at 15:31, Matthias Kuhn <matthias at opengis.ch> wrote:
> >
> > Can you fill a bug for this? The expression compiler in QGIS should not
> forward it to ogr/gpkg/sqlite in this case.
>
> My interpretation is that Calvin is setting a layer filter, so QGIS
> expressions aren't involved (i.e. no bug).
>
> Nyall
>
> >
> > Matthias
> >
> > On Wed, Jul 28, 2021 at 10:08 PM C Hamilton <adenaculture at gmail.com>
> wrote:
> >>
> >> Thanks everyone for that explanation. This does complicate the ability
> to set an expression filter in a plugin when it depends on the data source
> type. I'm not sure what to do about that.
> >>
> >> Regards,
> >> Calvin
> >>
> >> On Wed, Jul 28, 2021 at 8:00 PM Anita Graser <anitagraser at gmx.at>
> wrote:
> >>>
> >>> Hi Calvin,
> >>>
> >>> 28 Jul 2021 21:43:40 C Hamilton <adenaculture at gmail.com>:
> >>> > If I use LIKE instead of ILIKE then it works. It is like ILIKE was
> not implemented for GeoPackage. Can anyone verify this?
> >>>
> >>> Yes, there seems to be no iLike in sqlite:
> >>>
> >>>
> https://stackoverflow.com/questions/15480319/case-sensitive-and-insensitive-like-in-sqlite
> >>>
> >>> And therefore neither in geopackage.
> >>>
> >>> Regards
> >>> Anita
> >>
> >> _______________________________________________
> >> QGIS-Developer mailing list
> >> QGIS-Developer at lists.osgeo.org
> >> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> >> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> >
> > _______________________________________________
> > QGIS-Developer mailing list
> > QGIS-Developer at lists.osgeo.org
> > List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> > Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210729/820d672c/attachment.html>

From rldhont at gmail.com  Fri Jul 30 03:27:11 2021
From: rldhont at gmail.com (=?UTF-8?Q?Ren=c3=a9-Luc_Dhont?=)
Date: Fri, 30 Jul 2021 12:27:11 +0200
Subject: [QGIS-Developer] QGIS Server Tiles API Plugin
Message-ID: <4911dbb3-b618-ad63-63ae-81dfe2292a3d@gmail.com>

Hi Devs,

On request from Ifremer, we at 3Liz are started to work on a plugin to 
provide Tiles API for QGIS Server.
https://github.com/3liz/qgis-server-tiles-plugin

We have started to implement a Tile Map Service API, known as TMS.
It is based on the QGIS project WMTS configuration availabe in the OWS 
Server tab in Project properties.
If the EPSG:3857 is activated for WMTS, the tiles will be available 
through a simple URL with the MAP parameter.
The TMS API supports images, provided by WMTS, and Vector Tile based on 
QgsVectorTileWriter.

I have discovered that QgsVectorTileMVTEncoder is not available in Python.

We have planed to:
* implement in this plugin the OGC Tiles API, https://ogcapi.ogc.org/tiles/
* enhance the QGIS API to be able to build Vector Tile in other CRS than 
EPSG:3857
* and port the OGC Tiles API in the QGIS Server core.

Feedbacks are welcome
Regards,
Ren?-Luc D'Hont

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210730/a9c371e4/attachment.html>

From apasotti at gmail.com  Fri Jul 30 06:28:53 2021
From: apasotti at gmail.com (Alessandro Pasotti)
Date: Fri, 30 Jul 2021 15:28:53 +0200
Subject: [QGIS-Developer] QGIS Server Tiles API Plugin
In-Reply-To: <4911dbb3-b618-ad63-63ae-81dfe2292a3d@gmail.com>
References: <4911dbb3-b618-ad63-63ae-81dfe2292a3d@gmail.com>
Message-ID: <CAL5Q671+Kh7ZOTh8ZX5CjuO6MKbXojUVaPYRELLf4fU72fhPSg@mail.gmail.com>

Hi Ren?-Luc,

This is great news - I was almost sure you would have picked this up :)

I think you  should be able to use most of the OGC API foundation classes
that I've written for OAPIF/WFS3.

Kind Regards.


On Fri, Jul 30, 2021 at 12:27 PM Ren?-Luc Dhont <rldhont at gmail.com> wrote:

> Hi Devs,
>
> On request from Ifremer, we at 3Liz are started to work on a plugin to
> provide Tiles API for QGIS Server.
> https://github.com/3liz/qgis-server-tiles-plugin
>
> We have started to implement a Tile Map Service API, known as TMS.
> It is based on the QGIS project WMTS configuration availabe in the OWS
> Server tab in Project properties.
> If the EPSG:3857 is activated for WMTS, the tiles will be available
> through a simple URL with the MAP parameter.
> The TMS API supports images, provided by WMTS, and Vector Tile based on
> QgsVectorTileWriter.
>
> I have discovered that QgsVectorTileMVTEncoder is not available in Python.
>
> We have planed to:
> * implement in this plugin the OGC Tiles API,
> https://ogcapi.ogc.org/tiles/
> * enhance the QGIS API to be able to build Vector Tile in other CRS than
> EPSG:3857
> * and port the OGC Tiles API in the QGIS Server core.
>
> Feedbacks are welcome
> Regards,
> Ren?-Luc D'Hont
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>


-- 
Alessandro Pasotti
QCooperative:  www.qcooperative.net
ItOpen:   www.itopen.it
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210730/7c03a8ba/attachment.html>

From tim at kartoza.com  Fri Jul 30 07:00:22 2021
From: tim at kartoza.com (Tim Sutton)
Date: Fri, 30 Jul 2021 15:00:22 +0100
Subject: [QGIS-Developer] QGIS Server Tiles API Plugin
In-Reply-To: <CAL5Q671+Kh7ZOTh8ZX5CjuO6MKbXojUVaPYRELLf4fU72fhPSg@mail.gmail.com>
References: <CAL5Q671+Kh7ZOTh8ZX5CjuO6MKbXojUVaPYRELLf4fU72fhPSg@mail.gmail.com>
Message-ID: <48F0AD07-B20D-4E5F-867C-0A0615E72C03@kartoza.com>

Oh yay and thank goodness we long miss this! Some questions:

- metabufferring
- metatiling 
- tile caching 
- tile seeding

Are any of those in your todo list?

Thanks so much for working on this!

Regards

Tim

Sent from my iPhone

> On 30 Jul 2021, at 14:29, Alessandro Pasotti <apasotti at gmail.com> wrote:
> 
> ?
> Hi Ren?-Luc,
> 
> This is great news - I was almost sure you would have picked this up :)
> 
> I think you  should be able to use most of the OGC API foundation classes that I've written for OAPIF/WFS3.
> 
> Kind Regards.
> 
> 
>> On Fri, Jul 30, 2021 at 12:27 PM Ren?-Luc Dhont <rldhont at gmail.com> wrote:
>> Hi Devs,
>> 
>> On request from Ifremer, we at 3Liz are started to work on a plugin to provide Tiles API for QGIS Server.
>> https://github.com/3liz/qgis-server-tiles-plugin
>> 
>> We have started to implement a Tile Map Service API, known as TMS.
>> It is based on the QGIS project WMTS configuration availabe in the OWS Server tab in Project properties.
>> If the EPSG:3857 is activated for WMTS, the tiles will be available through a simple URL with the MAP parameter.
>> The TMS API supports images, provided by WMTS, and Vector Tile based on QgsVectorTileWriter.
>> 
>> I have discovered that QgsVectorTileMVTEncoder is not available in Python.
>> 
>> We have planed to:
>> * implement in this plugin the OGC Tiles API, https://ogcapi.ogc.org/tiles/
>> * enhance the QGIS API to be able to build Vector Tile in other CRS than EPSG:3857
>> * and port the OGC Tiles API in the QGIS Server core.
>> 
>> Feedbacks are welcome
>> Regards,
>> Ren?-Luc D'Hont
>> 
>> _______________________________________________
>> QGIS-Developer mailing list
>> QGIS-Developer at lists.osgeo.org
>> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> 
> 
> -- 
> Alessandro Pasotti
> QCooperative:  www.qcooperative.net
> ItOpen:   www.itopen.it
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210730/1a2fcc60/attachment.html>

From adenaculture at gmail.com  Thu Jul  1 17:34:54 2021
From: adenaculture at gmail.com (C Hamilton)
Date: Fri, 02 Jul 2021 00:34:54 -0000
Subject: [QGIS-Developer] Preview of the QGIS Earth, Sun, Moon,
 & Planets Plugin
In-Reply-To: <CAES-DZR3kcaVvVLDzf2WxwdM8JRWBPMAi0zXce9+b=9j6Ekt-A@mail.gmail.com>
References: <CABPxTTrvotuVhwG1wN6q9rZqvqFGr7PiOckfOPUDpQ7Q1YzUCA@mail.gmail.com>
 <CAES-DZR3kcaVvVLDzf2WxwdM8JRWBPMAi0zXce9+b=9j6Ekt-A@mail.gmail.com>
Message-ID: <CABPxTTpy9YquWoU8O5QNR=t=Boqid3Bkrz8FD3bofWZGHMiceg@mail.gmail.com>

Tim,

If you want to try day/night layer, uncomment the line

        # self.addAlgorithm(DayNightAlgorithm())

 in provider.py. It will install the algorithm in the processing toolbox.
The reason I did not include it is because the algorithm is incorrect
except close to the summer or winter solstice. I don't understand the math
so I need to find someone willing to help out with that algorithm, but it
looks nice during the summer months and is close to correct. I would be
working on this a lot if I were not stuck with this problem and would
probably have started looking at the time controller. Animation will be
fun, but for now I need to get the basic functionality working correctly.

I am debating whether to include the local time zone in the processing
algorithms. If I want to include the local time in the attribute table then
I may need it. The easiest thing to do is to just use UTC, but I like to
make the algorithms flexible. Right now it is looking at the computer's
local time and UTC time.

Best wishes,

Calvin

On Thu, Jul 1, 2021 at 7:36 PM Tim Sutton <tim at kartoza.com> wrote:

> Hey Calvin
>
> Testing here (after pip installing skyfield) on Fedora 34 and it works
> great! The only comment I would make is that it would be nice if the
> Sun/Lunar Info dock panel docked itself on start up rather than floating
> (which looks a bit messy).
>
> Looking forward to being able to animate this stuff with temporal
> controller one day!
>
> How did you make the day / night / twilight shadow layers you shared in a
> previous email?
>
> Regards
>
> Tim
>
>
>
> On Wed, Jun 30, 2021 at 6:50 PM C Hamilton <adenaculture at gmail.com> wrote:
>
>> I thought I would give you an alpha version of the QGIS Earth, Sun, Moon
>> & Planets plugin I am developing. This plugin requires QGIS 3.14 or more
>> recent. It is also rather large because it contains all the data needed to
>> run. If you are on windows and want to download a self contained windows
>> plugin use this link to download:
>>
>>
>>  earthsunmoon-alpha-windows.zip
>> <https://drive.google.com/file/d/1Pld4yIxBTTHA0FBwPbaUw_qfrIhHTawA/view?usp=drive_web>
>>
>> If you are using some other OS, use this link, but before you install it
>> open up your OSGeo4W console and run "pip install skyfield'. If this is not
>> the proper command for your OS then adjust it to how you install a python
>> package. In the OSGeo4W shell you may need to run py3_env first. If py3_env
>> gives an error then it is not needed.
>>
>>
>>  earthsunmoon-alpha.zip
>> <https://drive.google.com/file/d/1kJammSDWRTk7659Ncp3qAnNMQLggZ4Ks/view?usp=drive_web>
>>
>> There are 3 processing routines that can be used to display the 1) sun,
>> 2) moon, 3) planets showing their position directly overhead at a
>> particular date and time and will look something like this:
>>
>> [image: image.png]
>>
>> There is also another window that displays all kinds of earth and moon
>> data for a particular location when you click on the "Solar/lunar
>> information" dialog box that can be found in "Plugins->Earth, sun, moon, &
>> plants." There is a green plus sign in the dialog box. Click on it and then
>> click anywhere on the map to capture the coordinate to display solar and
>> lunar information.
>>
>> If you need help to manually install this plugin let me know.
>>
>> I have not included the day/night terminator algorithm yet because there
>> is a bug in it. Let me know what you think and if you have any suggestions.
>>
>> Thanks,
>>
>> Calvin
>>
>
>
> --
>
> ------------------------------------------------------------------------------------------
> ?
>
> Tim Sutton
> Visit http://kartoza.com to find out about open source:
>  * Desktop GIS programming services
>  * Geospatial web development
> * GIS Training
> * Consulting Services
> Tim is a member of the QGIS Project Steering Committee
>
> -------------------------------------------------------------------------------------------
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210702/39878d7f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 147942 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210702/39878d7f/attachment.png>

From charles at kartoza.com  Thu Jul 22 14:20:37 2021
From: charles at kartoza.com (Charles Dixon-Paver)
Date: Thu, 22 Jul 2021 21:20:37 -0000
Subject: [QGIS-Developer] DWG files preview in QGIS
In-Reply-To: <2100701243.40254.1626939294931@nm71.abv.bg>
References: <1228961645.1995170.1626791475712@nm71.abv.bg>
 <CAK2Kqice8fTPthJHhTR_eiYvWyxMr3eMUu+3zB_80mOdV=pyjg@mail.gmail.com>
 <2100701243.40254.1626939294931@nm71.abv.bg>
Message-ID: <CAK2KqiewD2HMvZJdrWx_VQAppZSSWUBrrwzY+fBAbeUSMiC_WA@mail.gmail.com>

No problem Todor, although it may be worth bearing in mind that these sorts
of usability questions are typically better suited to the QGIS User mailing
list and may get a better response from there.

In terms of your query, I would say it is certainly possible to achieve in
QGIS, but there are a few limits to what is possible and what is practical.

Like I mentioned before, I believe what you are after is better served
using raster files displaying your CAD information, so converting your DWGs
to a raster format beforehand would be beneficial.

Previewing the DWG file itself in QGIS probably isn't easily feasible, the
easiest approach likely being some sort of HTML viewer integration. You can
also convert the DWG to GPKG using QGIS tools to make it easier to work
with, but again I feel this is not what you seem to need for your use case.

I would expect some data from a DWG to be unsupported by QGIS when
converting it, as well as having data which is outside of the drawing
paperspace not be included in the preview image (amongst other issues
depending on the structure/ design of the DWGs). Jorge outlined the code
needed to load the DWG with an external program using an action as
well, but that would specifically require loading an instance of a third
party program. My suggestion would be to build the map project as outlined
in the presentation with raster images, and attach an action to open the
complete drawing for further introspection.

I have created a small demo project which demonstrates how to achieve the
outcomes I described. It includes various actions for launching file
previews and contains a number of different layer styles and approaches for
rendering the data in various manners as you would like. You can also
configure the feature identification tool to automatically load the feature
form and use the QGIS drag and Drop form designer to configure an image
preview. The project also demonstrates using the QGIS atlas feature with
print layouts to achieve the specific outcome highlighted in the
presentation document.

[image: output_3.png]

You can download the files and project, DWG_integration_example.zip, from
the following temporary file share:

https://filebin.net/qxrw2xc94syeioo4

(The Chrome browser security may complain it is unsafe, but you should be
able to download it with firefox or edge etc)

SHA256: 7E9E5A398BFAE4115EEE6D5C1B2073ED7314C6B7186AB61818D613B389991FD7

I used some sample DWGs from the internet and bulk exported them to PDF
using TrueView before converting to PNG, so this is definitely something
you can make at least semi-automatic. If you have access to autocad, I
imagine there are a number of options available for bulk exporting/
plotting/ publishing, if not from within the software itself, certainly
using AutoLisp.

You could of course try to build similar DWG viewing functionality and
leverage it in QGIS similar to what I have demonstrated with raster data,
but I doubt it would be practical.

I hope that this solves your issues and provides you with a strong starting
point for configuring your project.

On Thu, 22 Jul 2021 at 09:34, todor lambev <totolamb at abv.bg> wrote:

> Dear Charles,
>
> Thank you very much for your reply. In fact this is my first time that I
> use QGIS-developer forum and I am pleasantly surprised that someone replied
> to my questions.
>
> No on the topic.  In the attached presentation you can find an explanation
> what I would like to receive as a final "product.  Do you think that it is
> possible or at least someting similar? The idea of the hole excersice is to
> be able to make a quick visual check of all the profiles which I have in
> separate DWGs.
>
>
> Best regards
>
> Todor Lambev, PhD Student- - - - -*Institute of Oceanology
> **Department of coastal zones dynamics
> mob: +359 886 75 72 85;
> Varna, Bulgaria
> URL: http://www.io-bas.bg <http://www.io-bas.bg>*
>
>
>
>
>
> >-------- ?????????? ????? --------
> >??: Charles Dixon-Paver charles at kartoza.com
> >???????: Re: [QGIS-Developer] DWG files preview in QGIS
> >??: todor lambev <totolamb at abv.bg>
> >????????? ??: 20.07.2021 18:38
>
> It's not totally clear to me what the objective is for your DWGs.
>
> By "preview", do you mean wish to just view an overview image of the DWG
> contents? If that is the case, I would recommend using a separate command
> line/ batch process to produce raster format previews as DWGs. You can then
> create a new field for the accompanying raster file using the field
> calculator and QGIS expressions.
>
> With the rasters you can use the preview option in the feature form, or
> even use a "Raster Image Marker" based symbol at certain scales to
> represent the DXF previews.
>
> Another option for previews is to use the "Show map tips" option from the
> QGIS toolbars. In the "Display" section of the layer properties you will
> find that tooltips can use HTML code which will render a "web preview" of
> the feature when you hover the cursor on it. for example, the
> following should allow image previews:
>
> <img src='file:///[%  @project_folder || '/' || "image" %]' height=400
> width=400 />
>
> In theory, you could likely combine this with a DWG rendering library such
> as https://sharecad.org/it/DWGOnlinePlugin but I expect it will be
> difficult to use and not very efficient, hence why I would suggest
> converting the data to raster beforehand. One other thing you could do as
> well is to use the "web view" of the QGIS form to render an html template
> with an integrated viewer, but again, this is likely difficult and not
> necessary.
>
> I am not aware of any "preview" plugin for rendering DWG data within QGIS.
>
> If your aim is to "load" the DWG into your project from a command
> available within the point feature attributes, this is supported by using
> GitHub actions and some custom code, although the process may be quite
> cumbersome. Actions functionality was covered on the last QGIS Open Day[1]
> and I recommend watching the demonstration if that is your use case.
> Alternatively, there is also some written material on this topic [2] f you
> would prefer to start there
>
> [1] https://github.com/qgis/QGIS/wiki/QOD-June-2021#qgis-actions-deep-dive
> [2]
> https://courses.spatialthoughts.com/pyqgis-in-a-day.html#creating-custom-python-actions
>
>
> On Tue, 20 Jul 2021 at 16:40, todor lambev < totolamb at abv.bg> wrote:
>
> Dear QGIS developers,
>
> I have a strange need. Could you help me?
> I have 30 000 DWG files that are not georeferenced, each file has unique
> and a specific name. I have a point shapefile which in its attribute table
> contains a column with the names of the *dwg files.
>
> My question is: How I can load to preview the DWG files in QGIS next to
> the points or to preview the DWG by clicking on the point (similar to the
> photo preview widget)?
>
> I hope that you won't skip my question and will help me to find a solution
> basically because otherwise, I have to do it manually...
>
> Best regards
>
> Todor Lambev, PhD Student- - - - -*Institute of Oceanology
> **Department of coastal zones dynamics
> mob: +359 886 75 72 85;
> Varna, Bulgaria
> URL: http://www.io-bas.bg <http://www.io-bas.bg>*
>
> _______________________________________________
> QGIS-Developer mailing list
> QGIS-Developer at lists.osgeo.org
> List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210722/dfb44785/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: output_3.png
Type: image/png
Size: 282264 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/qgis-developer/attachments/20210722/dfb44785/attachment-0001.png>

