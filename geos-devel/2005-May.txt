From oss-dev at rambler.ru  Mon May  2 14:23:03 2005
From: oss-dev at rambler.ru (???? ???????)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] About LineSegment and its shifting
In-Reply-To: <e458dd1405042912154f569187@mail.gmail.com>
References: <42726859.000006.28403@mfront7.yandex.ru>
	<20050429170545.GC96157@freek.keybit.net>
	<e458dd140504291207715e4d08@mail.gmail.com>
	<e458dd1405042912154f569187@mail.gmail.com>
Message-ID: <web-57477744@mail6.rambler.ru>

As I understand, Sergey want to calculate coordinates of new
LineSegment which have same count of points as base LineSegment but
shifted along the perpendicular length.
It easy to show then explain:
if we have vertical LineSegment (2 2)-(2 5)
and shifting length = 5
then result LneSegment is (7 2)-(7 5)

> 2005/4/29, strk@refractions.net <strk@refractions.net>:
> On Fri, Apr 29, 2005 at 09:01:13PM +0400, nil5-ksa wrote:
> > Hi, all
> >
> > I have one LineSegment. And I want to get another LineSegment with 
>points, that calculates with next algorithm.
> > I create two perpendiculars to my LineString in its end points. 
>Both perpendiculars have same and fixed length.
> > Resulting LineString have coordinates given by this algorithm.
> >
> > Are there in GEOS any abilities to create this LineString?
> >
> > Sergey Karin
>
> It is possible, but I don't know if the resulting LineString
> is simple in OGC terms. It takes 6 points for how I see it.
>
> --strk;
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From Kevin.Wiebe at safe.com  Tue May  3 10:00:19 2005
From: Kevin.Wiebe at safe.com (Kevin Wiebe)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
Message-ID: <CB8D74468A40754791B9F85EAE581CE503C8FAC0@van-e2k1.safe.internal>

I'm asking for advice here:  What is the most robust (numerically
stable) way to use GEOS?  What are its limitations?

 

For our purposes we need to use code that is both as fast and accurate
as possible.  As you probably know, when using a complex algorithm
sometimes even small inaccuracies in geometric computations can compound
into drastically incorrect results.

 

Here is a concrete example from real customer data:

I have created two simple 2-point LINEs and used the GEOS call to get
the spot where they intersect:

point = lineA.intersection(lineB);

 

lineA = from (2089426.5233462777,1180182.3877339689) to
(2085646.6891757075,1195618.7333999649)

lineB = from (1889281.8148903656,1997547.0560044837) to
(2259977.3672235999,483675.17050843034)

 

the intersection point I get back is this:

point = (2097408.2633752143,1144595.8008114607)

 

This point is a significant distance away from any part of lineA.  If
one were to place this intersection point between the start and end
points of lineA, the resulting line would look ridiculous.

 

JTS returns the same result.

 

Depending on your explanations for this I may have some technical
advice.

 

Thanks for your comments,

-Kevin-

 

----------------------------------------------------------------

 Kevin Wiebe     Safe Software Inc.              kevin@safe.com

      Senior     Surrey, BC, CANADA       phone: (604) 501-9985

   Developer     http://www.safe.com        fax: (604) 501-9965

----------------------------------------------------------------

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20050503/96c9aa2a/attachment.html
From mbdavis at VividSolutions.com  Tue May  3 11:51:39 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CDC3@venus.VividSolutions.com>

> I'm asking for advice here:  What is the most robust (numerically
stable) way to use GEOS?  What are its limitations?

 

That's a bit hard to give a short answer to.  (In fact, the shortest
answer is probably in the code itself.)  Basically, JTS/GEOS is as
robust as I know how to make it.  There are a few obvious places where
robustness is an issue: 

- testing the relative orientation of 3 points

- computing the intersection point of two segments (the case you've
raised)

- computing the intersected arrangement of a set of linestrings (the
noded problem)

 

There's probably some others - feel free to provide others.

 

For each of these areas I have tried to obtain or develop a fully robust
or at least a high quality algorithm.  In the case of point orientation,
this reduces to evalutating the sign of a determinant, and there is some
good code provided by a group in France for doing this robustly.  For
noding, I have added snap rounding in the next version of JTS (although
I have not yet incorporated this into the geometry algorithms, since
there are some further issues to work out).

 

For the case of line segment intersection, I was aware that the code was
not robust and that there were some egregious failure cases.  But you've
found a real shocker!  If you have any ideas about how to make this more
robust, that would be great.  Feel free to post or call me to discuss.

 

Martin

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046

	-----Original Message-----
	From: geos-devel-bounces@geos.refractions.net
[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Kevin
Wiebe
	Sent: May 3, 2005 7:00 AM
	To: geos-devel@geos.refractions.net
	Subject: [geos-devel] How robust is GEOS?
	
	

	I'm asking for advice here:  What is the most robust
(numerically stable) way to use GEOS?  What are its limitations?

	 

	For our purposes we need to use code that is both as fast and
accurate as possible.  As you probably know, when using a complex
algorithm sometimes even small inaccuracies in geometric computations
can compound into drastically incorrect results.

	 

	Here is a concrete example from real customer data:

	I have created two simple 2-point LINEs and used the GEOS call
to get the spot where they intersect:

	point = lineA.intersection(lineB);

	 

	lineA = from (2089426.5233462777,1180182.3877339689) to
(2085646.6891757075,1195618.7333999649)

	lineB = from (1889281.8148903656,1997547.0560044837) to
(2259977.3672235999,483675.17050843034)

	 

	the intersection point I get back is this:

	point = (2097408.2633752143,1144595.8008114607)

	 

	This point is a significant distance away from any part of
lineA.  If one were to place this intersection point between the start
and end points of lineA, the resulting line would look ridiculous.

	 

	JTS returns the same result.

	 

	Depending on your explanations for this I may have some
technical advice.

	 

	Thanks for your comments,

	-Kevin-

	 

	----------------------------------------------------------------

	 Kevin Wiebe     Safe Software Inc.              kevin@safe.com

	      Senior     Surrey, BC, CANADA       phone: (604) 501-9985

	   Developer     http://www.safe.com        fax: (604) 501-9965

	----------------------------------------------------------------

	 

	 

	 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20050503/f507872d/attachment.html
From mbdavis at VividSolutions.com  Tue May  3 12:19:23 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CDC7@venus.VividSolutions.com>

By the way, I'll also point out that I architected JTS so that the
algorithms which are potentially problematic are all modularized.  If
there are better algorithms for performing any of the operations below,
it should be easy to just plug them in to the code.
 
 
Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046

	-----Original Message-----
	From: geos-devel-bounces@geos.refractions.net
[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Martin
Davis
	Sent: May 3, 2005 8:52 AM
	To: GEOS Development List
	Cc: Kevin Wiebe
	Subject: RE: [geos-devel] How robust is GEOS?
	
	

	> I'm asking for advice here:  What is the most robust
(numerically stable) way to use GEOS?  What are its limitations?

	 

	That's a bit hard to give a short answer to.  (In fact, the
shortest answer is probably in the code itself.)  Basically, JTS/GEOS is
as robust as I know how to make it.  There are a few obvious places
where robustness is an issue: 

	- testing the relative orientation of 3 points

	- computing the intersection point of two segments (the case
you've raised)

	- computing the intersected arrangement of a set of linestrings
(the noded problem)

	 

	There's probably some others - feel free to provide others.

	 

	For each of these areas I have tried to obtain or develop a
fully robust or at least a high quality algorithm.  In the case of point
orientation, this reduces to evalutating the sign of a determinant, and
there is some good code provided by a group in France for doing this
robustly.  For noding, I have added snap rounding in the next version of
JTS (although I have not yet incorporated this into the geometry
algorithms, since there are some further issues to work out).

	 

	For the case of line segment intersection, I was aware that the
code was not robust and that there were some egregious failure cases.
But you've found a real shocker!  If you have any ideas about how to
make this more robust, that would be great.  Feel free to post or call
me to discuss.

	 

	Martin

	Martin Davis, Senior Technical Architect
	Vivid Solutions Inc.      www.vividsolutions.com
	Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
	Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046

		-----Original Message-----
		From: geos-devel-bounces@geos.refractions.net
[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Kevin
Wiebe
		Sent: May 3, 2005 7:00 AM
		To: geos-devel@geos.refractions.net
		Subject: [geos-devel] How robust is GEOS?
		
		

		I'm asking for advice here:  What is the most robust
(numerically stable) way to use GEOS?  What are its limitations?

		 

		For our purposes we need to use code that is both as
fast and accurate as possible.  As you probably know, when using a
complex algorithm sometimes even small inaccuracies in geometric
computations can compound into drastically incorrect results.

		 

		Here is a concrete example from real customer data:

		I have created two simple 2-point LINEs and used the
GEOS call to get the spot where they intersect:

		point = lineA.intersection(lineB);

		 

		lineA = from (2089426.5233462777,1180182.3877339689) to
(2085646.6891757075,1195618.7333999649)

		lineB = from (1889281.8148903656,1997547.0560044837) to
(2259977.3672235999,483675.17050843034)

		 

		the intersection point I get back is this:

		point = (2097408.2633752143,1144595.8008114607)

		 

		This point is a significant distance away from any part
of lineA.  If one were to place this intersection point between the
start and end points of lineA, the resulting line would look ridiculous.

		 

		JTS returns the same result.

		 

		Depending on your explanations for this I may have some
technical advice.

		 

		Thanks for your comments,

		-Kevin-

		 

	
----------------------------------------------------------------

		 Kevin Wiebe     Safe Software Inc.
kevin@safe.com

		      Senior     Surrey, BC, CANADA       phone: (604)
501-9985

		   Developer     http://www.safe.com        fax: (604)
501-9965

	
----------------------------------------------------------------

		 

		 

		 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20050503/811c751d/attachment.html
From strk at keybit.net  Thu May  5 11:15:59 2005
From: strk at keybit.net (strk)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] Re: WKB parser
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA02796CDB4@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDB4@venus.VividSolutions.com>
Message-ID: <20050505151559.GA57157@freek.keybit.net>

I answer on geos-devel as I think community should be able to
partecipate in this.

On Fri, Apr 29, 2005 at 05:29:47PM -0700, Martin Davis wrote:
> I don't think normalize is what you want to be looking at.
> 
> This was an issue with WKT as well - the SFS doesn't specify a format
> for LinearRings. I just went ahead and made up my own. I guess we could
> do the same thing for WKB too - what do you think?  Or we could just say
> that LinearRings are not supported by WKB  (not such a good decision, I
> guess).

I'm afraid that the presence of LINEARRING in GEOS-extended WKT is
all my fault, and I'm sorry about it :(

We shouldn't have done it, as ogc tests were failing for exactly
this reason. A LINEARRIN is a LINESTRING at all effects, why bothering
with a new definition ? It is ok to have a derivation in an OO
hierarchy as it can help encoding constraints in calls such as
polygon constructors, but I think exporing this in WKT was
a wrong choice. I wouldn't do it again, so I vote for WKB
representation of a LINEARRIN *is* a LINESTRING.

Other thoughts ?

--strk;

> 
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 
> > -----Original Message-----
> > From: strk [mailto:strk@keybit.net] 
> > Sent: April 29, 2005 8:26 AM
> > To: Martin Davis
> > Cc: Paul Ramsey
> > Subject: Re: WKB parser
> > 
> > 
> > Ok, I've been lame. It's compareTo() as used by XMLTester. 
> > Anyway there's another problem. Input geometries can be 
> > LINEARRING, while output geometries (as parsed by WKB output 
> > of input geometry) will become LINESTRING. The normalize() 
> > method of geoms doesn't take care of this. Should it in your opinion ?
> > 
> > --strk;
> > 
> > On Fri, Apr 29, 2005 at 04:15:43PM +0200, strk wrote:
> > > I've about done with the WKB parser code.
> > > In order to test it I need a function to test vertex-by-vertex 
> > > equality of geometries, to compare input and output ( INPUT -> 
> > > WKBWrite -> WKBRead -> OUTPUT).
> > > 
> > > What function should I use ?
> > > Is anything similar in JTS ?
> > > (sorry if I'm being lame)
> > > 
> > > --strk;
> > 

From mbdavis at VividSolutions.com  Thu May  5 11:55:15 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] RE: WKB parser
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CDD9@venus.VividSolutions.com>

Ah, strk, you're being too hard on yourself.

Personally I think it's a good idea to support LINEARRINGs in WKT.
After all, it's a first-class datatype, and it's easy to provide this
support.

As for WKB, I think it would be easy to add to it as well - just add a
new code byte value.  However, this seems a wee bit more fraught with
peril, simply because in a binary format it isn't as easy to see what's
going on when things break.

However, I'm happy with the decision to NOT handle LINEARRINGs in WKB,
since there doesn't seem to be a clear use case for them.

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: strk [mailto:strk@keybit.net] 
> Sent: May 5, 2005 8:16 AM
> To: Martin Davis
> Cc: pramsey@refractions.net; geos-devel@geos.refractions.net
> Subject: Re: WKB parser
> 
> 
> I answer on geos-devel as I think community should be able to 
> partecipate in this.
> 
> On Fri, Apr 29, 2005 at 05:29:47PM -0700, Martin Davis wrote:
> > I don't think normalize is what you want to be looking at.
> > 
> > This was an issue with WKT as well - the SFS doesn't 
> specify a format 
> > for LinearRings. I just went ahead and made up my own. I guess we 
> > could do the same thing for WKB too - what do you think?  
> Or we could 
> > just say that LinearRings are not supported by WKB  (not 
> such a good 
> > decision, I guess).
> 
> I'm afraid that the presence of LINEARRING in GEOS-extended 
> WKT is all my fault, and I'm sorry about it :(
> 
> We shouldn't have done it, as ogc tests were failing for 
> exactly this reason. A LINEARRIN is a LINESTRING at all 
> effects, why bothering with a new definition ? It is ok to 
> have a derivation in an OO hierarchy as it can help encoding 
> constraints in calls such as polygon constructors, but I 
> think exporing this in WKT was a wrong choice. I wouldn't do 
> it again, so I vote for WKB representation of a LINEARRIN 
> *is* a LINESTRING.
> 
> Other thoughts ?
> 
> --strk;
> 
> > 
> > Martin Davis, Senior Technical Architect
> > Vivid Solutions Inc.      www.vividsolutions.com
> > Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> > Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> > 
> > 
> > > -----Original Message-----
> > > From: strk [mailto:strk@keybit.net]
> > > Sent: April 29, 2005 8:26 AM
> > > To: Martin Davis
> > > Cc: Paul Ramsey
> > > Subject: Re: WKB parser
> > > 
> > > 
> > > Ok, I've been lame. It's compareTo() as used by XMLTester.
> > > Anyway there's another problem. Input geometries can be 
> > > LINEARRING, while output geometries (as parsed by WKB output 
> > > of input geometry) will become LINESTRING. The normalize() 
> > > method of geoms doesn't take care of this. Should it in 
> your opinion ?
> > > 
> > > --strk;
> > > 
> > > On Fri, Apr 29, 2005 at 04:15:43PM +0200, strk wrote:
> > > > I've about done with the WKB parser code.
> > > > In order to test it I need a function to test vertex-by-vertex
> > > > equality of geometries, to compare input and output ( INPUT -> 
> > > > WKBWrite -> WKBRead -> OUTPUT).
> > > > 
> > > > What function should I use ?
> > > > Is anything similar in JTS ?
> > > > (sorry if I'm being lame)
> > > > 
> > > > --strk;
> > > 
> 

From mbdavis at VividSolutions.com  Fri May  6 11:43:51 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CDE7@venus.VividSolutions.com>

Kevin, List, strk:
 
I've made an enhancement to JTS (based on a suggestion by Kevin) which
seems to solve the issue of computed intersection points lying outside
the intersection of the segment envelopes.  (This is simply one
different function in RobustLineIntersector - it's an easy patch, strk).
 
This still doesn't produce the ultimate desired result of computing
intersections to the full 56 bits of double precision, however.  We're
working on a solution for that - will post it if and when it's done. 
 
Martin
 
 
Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046

	-----Original Message-----
	From: geos-devel-bounces@geos.refractions.net
[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Kevin
Wiebe
	Sent: May 3, 2005 7:00 AM
	To: geos-devel@geos.refractions.net
	Subject: [geos-devel] How robust is GEOS?
	
	

	I'm asking for advice here:  What is the most robust
(numerically stable) way to use GEOS?  What are its limitations?

	 

	For our purposes we need to use code that is both as fast and
accurate as possible.  As you probably know, when using a complex
algorithm sometimes even small inaccuracies in geometric computations
can compound into drastically incorrect results.

	 

	Here is a concrete example from real customer data:

	I have created two simple 2-point LINEs and used the GEOS call
to get the spot where they intersect:

	point = lineA.intersection(lineB);

	 

	lineA = from (2089426.5233462777,1180182.3877339689) to
(2085646.6891757075,1195618.7333999649)

	lineB = from (1889281.8148903656,1997547.0560044837) to
(2259977.3672235999,483675.17050843034)

	 

	the intersection point I get back is this:

	point = (2097408.2633752143,1144595.8008114607)

	 

	This point is a significant distance away from any part of
lineA.  If one were to place this intersection point between the start
and end points of lineA, the resulting line would look ridiculous.

	 

	JTS returns the same result.

	 

	Depending on your explanations for this I may have some
technical advice.

	 

	Thanks for your comments,

	-Kevin-

	 

	----------------------------------------------------------------

	 Kevin Wiebe     Safe Software Inc.              kevin@safe.com

	      Senior     Surrey, BC, CANADA       phone: (604) 501-9985

	   Developer     http://www.safe.com        fax: (604) 501-9965

	----------------------------------------------------------------

	 

	 

	 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20050506/732343a2/attachment.html
From strk at refractions.net  Fri May  6 12:21:21 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA02796CDE7@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDE7@venus.VividSolutions.com>
Message-ID: <20050506162121.GC68917@keybit.net>

On Fri, May 06, 2005 at 08:43:51AM -0700, Martin Davis wrote:
> Kevin, List, strk:
>  
> I've made an enhancement to JTS (based on a suggestion by Kevin) which
> seems to solve the issue of computed intersection points lying outside
> the intersection of the segment envelopes.  (This is simply one
> different function in RobustLineIntersector - it's an easy patch, strk).
>  
> This still doesn't produce the ultimate desired result of computing
> intersections to the full 56 bits of double precision, however.  We're
> working on a solution for that - will post it if and when it's done. 

Ok. I'll wait for the final version before applying to GEOS.
Thanks.
--strk;

>  
> Martin
>  
>  
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 	-----Original Message-----
> 	From: geos-devel-bounces@geos.refractions.net
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Kevin
> Wiebe
> 	Sent: May 3, 2005 7:00 AM
> 	To: geos-devel@geos.refractions.net
> 	Subject: [geos-devel] How robust is GEOS?
> 	
> 	
> 
> 	I'm asking for advice here:  What is the most robust
> (numerically stable) way to use GEOS?  What are its limitations?
> 
> 	 
> 
> 	For our purposes we need to use code that is both as fast and
> accurate as possible.  As you probably know, when using a complex
> algorithm sometimes even small inaccuracies in geometric computations
> can compound into drastically incorrect results.
> 
> 	 
> 
> 	Here is a concrete example from real customer data:
> 
> 	I have created two simple 2-point LINEs and used the GEOS call
> to get the spot where they intersect:
> 
> 	point = lineA.intersection(lineB);
> 
> 	 
> 
> 	lineA = from (2089426.5233462777,1180182.3877339689) to
> (2085646.6891757075,1195618.7333999649)
> 
> 	lineB = from (1889281.8148903656,1997547.0560044837) to
> (2259977.3672235999,483675.17050843034)
> 
> 	 
> 
> 	the intersection point I get back is this:
> 
> 	point = (2097408.2633752143,1144595.8008114607)
> 
> 	 
> 
> 	This point is a significant distance away from any part of
> lineA.  If one were to place this intersection point between the start
> and end points of lineA, the resulting line would look ridiculous.
> 
> 	 
> 
> 	JTS returns the same result.
> 
> 	 
> 
> 	Depending on your explanations for this I may have some
> technical advice.
> 
> 	 
> 
> 	Thanks for your comments,
> 
> 	-Kevin-
> 
> 	 
> 
> 	----------------------------------------------------------------
> 
> 	 Kevin Wiebe     Safe Software Inc.              kevin@safe.com
> 
> 	      Senior     Surrey, BC, CANADA       phone: (604) 501-9985
> 
> 	   Developer     http://www.safe.com        fax: (604) 501-9965
> 
> 	----------------------------------------------------------------
> 
> 	 
> 
> 	 
> 
> 	 
> 

From nhv at cape.com  Fri May  6 12:26:53 2005
From: nhv at cape.com (Norman Vine)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA02796CDE7@venus.VividSolutions.com>
Message-ID: <EKEJIKAILPONGGENMBGACEECLFAA.nhv@cape.com>

Martin Davis writes:

> This still doesn't produce the ultimate desired result of computing intersections to the full 56 bits of double precision,
however.
> We're working on a solution for that - will post it if and when it's done.

I am sure you are familiar with this technique

 http://www-2.cs.cmu.edu/~quake/robust.html

Cheers

Norman


From mbdavis at VividSolutions.com  Fri May  6 13:55:44 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CDE9@venus.VividSolutions.com>

Thanks, Norman.  We have seen this, and it's a nice piece of work.
Unfortunately, his technique apparently doesn't work with IEEE-754
doubles.  

http://www-2.cs.cmu.edu/~quake/robust.pc.html

We're looking at similar kinds of solutions using Interval Analysis, or
possible some extended precision computation.

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: geos-devel-bounces@geos.refractions.net 
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> Norman Vine
> Sent: May 6, 2005 9:27 AM
> To: GEOS Development List
> Subject: RE: [geos-devel] How robust is GEOS?
> 
> 
> Martin Davis writes:
> 
> > This still doesn't produce the ultimate desired result of computing 
> > intersections to the full 56 bits of double precision,
> however.
> > We're working on a solution for that - will post it if and 
> when it's 
> > done.
> 
> I am sure you are familiar with this technique
> 
 http://www-2.cs.cmu.edu/~quake/robust.html

Cheers

Norman

_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net
http://geos.refractions.net/mailman/listinfo/geos-devel

From mbdavis at VividSolutions.com  Fri May  6 13:56:33 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>

I would go ahead and implement the patch right now.  It's a very easy
patch to apply, and it produces a dramatic improvement in correctness.

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: strk@refractions.net [mailto:strk@refractions.net] 
> Sent: May 6, 2005 9:21 AM
> To: Martin Davis
> Cc: GEOS Development List
> Subject: Re: [geos-devel] How robust is GEOS?
> 
> 
> On Fri, May 06, 2005 at 08:43:51AM -0700, Martin Davis wrote:
> > Kevin, List, strk:
> >  
> > I've made an enhancement to JTS (based on a suggestion by 
> Kevin) which 
> > seems to solve the issue of computed intersection points 
> lying outside 
> > the intersection of the segment envelopes.  (This is simply one 
> > different function in RobustLineIntersector - it's an easy patch, 
> > strk).
> >  
> > This still doesn't produce the ultimate desired result of computing 
> > intersections to the full 56 bits of double precision, 
> however.  We're 
> > working on a solution for that - will post it if and when it's done.
> 
> Ok. I'll wait for the final version before applying to GEOS. 
> Thanks. --strk;
> 
> >  
> > Martin
> >  
> >  
> > Martin Davis, Senior Technical Architect
> > Vivid Solutions Inc.      www.vividsolutions.com
> > Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> > Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> > 
> > 	-----Original Message-----
> > 	From: geos-devel-bounces@geos.refractions.net
> > [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Kevin 
> > Wiebe
> > 	Sent: May 3, 2005 7:00 AM
> > 	To: geos-devel@geos.refractions.net
> > 	Subject: [geos-devel] How robust is GEOS?
> > 	
> > 	
> > 
> > 	I'm asking for advice here:  What is the most robust 
> (numerically 
> > stable) way to use GEOS?  What are its limitations?
> > 
> > 	 
> > 
> > 	For our purposes we need to use code that is both as fast and 
> > accurate as possible.  As you probably know, when using a complex 
> > algorithm sometimes even small inaccuracies in geometric 
> computations 
> > can compound into drastically incorrect results.
> > 
> > 	 
> > 
> > 	Here is a concrete example from real customer data:
> > 
> > 	I have created two simple 2-point LINEs and used the 
> GEOS call to get 
> > the spot where they intersect:
> > 
> > 	point = lineA.intersection(lineB);
> > 
> > 	 
> > 
> > 	lineA = from (2089426.5233462777,1180182.3877339689) to
> > (2085646.6891757075,1195618.7333999649)
> > 
> > 	lineB = from (1889281.8148903656,1997547.0560044837) to
> > (2259977.3672235999,483675.17050843034)
> > 
> > 	 
> > 
> > 	the intersection point I get back is this:
> > 
> > 	point = (2097408.2633752143,1144595.8008114607)
> > 
> > 	 
> > 
> > 	This point is a significant distance away from any part 
> of lineA.  If 
> > one were to place this intersection point between the start and end 
> > points of lineA, the resulting line would look ridiculous.
> > 
> > 	 
> > 
> > 	JTS returns the same result.
> > 
> > 	 
> > 
> > 	Depending on your explanations for this I may have some 
> technical 
> > advice.
> > 
> > 	 
> > 
> > 	Thanks for your comments,
> > 
> > 	-Kevin-
> > 
> > 	 
> > 
> > 	----------------------------------------------------------------
> > 
> > 	 Kevin Wiebe     Safe Software Inc.              kevin@safe.com
> > 
> > 	      Senior     Surrey, BC, CANADA       phone: (604) 501-9985
> > 
> > 	   Developer     http://www.safe.com        fax: (604) 501-9965
> > 
> > 	----------------------------------------------------------------
> > 
> > 	 
> > 
> > 	 
> > 
> > 	 
> > 
> 

From strk at refractions.net  Fri May  6 14:03:06 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>
Message-ID: <20050506180305.GG68917@keybit.net>

On Fri, May 06, 2005 at 10:56:33AM -0700, Martin Davis wrote:
> I would go ahead and implement the patch right now.  It's a very easy
> patch to apply, and it produces a dramatic improvement in correctness.

Ok then, can you provide the RobustLineIntersector revision number
against I should run a diff ? I see only removal of code between
1.30 and 1.31 ...

--strk;

> 
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 
> > -----Original Message-----
> > From: strk@refractions.net [mailto:strk@refractions.net] 
> > Sent: May 6, 2005 9:21 AM
> > To: Martin Davis
> > Cc: GEOS Development List
> > Subject: Re: [geos-devel] How robust is GEOS?
> > 
> > 
> > On Fri, May 06, 2005 at 08:43:51AM -0700, Martin Davis wrote:
> > > Kevin, List, strk:
> > >  
> > > I've made an enhancement to JTS (based on a suggestion by 
> > Kevin) which 
> > > seems to solve the issue of computed intersection points 
> > lying outside 
> > > the intersection of the segment envelopes.  (This is simply one 
> > > different function in RobustLineIntersector - it's an easy patch, 
> > > strk).
> > >  
> > > This still doesn't produce the ultimate desired result of computing 
> > > intersections to the full 56 bits of double precision, 
> > however.  We're 
> > > working on a solution for that - will post it if and when it's done.
> > 
> > Ok. I'll wait for the final version before applying to GEOS. 
> > Thanks. --strk;
> > 
> > >  
> > > Martin
> > >  
> > >  
> > > Martin Davis, Senior Technical Architect
> > > Vivid Solutions Inc.      www.vividsolutions.com
> > > Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> > > Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> > > 
> > > 	-----Original Message-----
> > > 	From: geos-devel-bounces@geos.refractions.net
> > > [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Kevin 
> > > Wiebe
> > > 	Sent: May 3, 2005 7:00 AM
> > > 	To: geos-devel@geos.refractions.net
> > > 	Subject: [geos-devel] How robust is GEOS?
> > > 	
> > > 	
> > > 
> > > 	I'm asking for advice here:  What is the most robust 
> > (numerically 
> > > stable) way to use GEOS?  What are its limitations?
> > > 
> > > 	 
> > > 
> > > 	For our purposes we need to use code that is both as fast and 
> > > accurate as possible.  As you probably know, when using a complex 
> > > algorithm sometimes even small inaccuracies in geometric 
> > computations 
> > > can compound into drastically incorrect results.
> > > 
> > > 	 
> > > 
> > > 	Here is a concrete example from real customer data:
> > > 
> > > 	I have created two simple 2-point LINEs and used the 
> > GEOS call to get 
> > > the spot where they intersect:
> > > 
> > > 	point = lineA.intersection(lineB);
> > > 
> > > 	 
> > > 
> > > 	lineA = from (2089426.5233462777,1180182.3877339689) to
> > > (2085646.6891757075,1195618.7333999649)
> > > 
> > > 	lineB = from (1889281.8148903656,1997547.0560044837) to
> > > (2259977.3672235999,483675.17050843034)
> > > 
> > > 	 
> > > 
> > > 	the intersection point I get back is this:
> > > 
> > > 	point = (2097408.2633752143,1144595.8008114607)
> > > 
> > > 	 
> > > 
> > > 	This point is a significant distance away from any part 
> > of lineA.  If 
> > > one were to place this intersection point between the start and end 
> > > points of lineA, the resulting line would look ridiculous.
> > > 
> > > 	 
> > > 
> > > 	JTS returns the same result.
> > > 
> > > 	 
> > > 
> > > 	Depending on your explanations for this I may have some 
> > technical 
> > > advice.
> > > 
> > > 	 
> > > 
> > > 	Thanks for your comments,
> > > 
> > > 	-Kevin-
> > > 
> > > 	 
> > > 
> > > 	----------------------------------------------------------------
> > > 
> > > 	 Kevin Wiebe     Safe Software Inc.              kevin@safe.com
> > > 
> > > 	      Senior     Surrey, BC, CANADA       phone: (604) 501-9985
> > > 
> > > 	   Developer     http://www.safe.com        fax: (604) 501-9965
> > > 
> > > 	----------------------------------------------------------------
> > > 
> > > 	 
> > > 
> > > 	 
> > > 
> > > 	 
> > > 
> > 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Mon May  9 06:36:03 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] How robust is GEOS?
In-Reply-To: <20050506180305.GG68917@keybit.net>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>
	<20050506180305.GG68917@keybit.net>
Message-ID: <20050509103603.GA95578@keybit.net>

I've ported the patches to GEOS. Thanks Martin, Kevin.

--strk;

On Fri, May 06, 2005 at 08:03:06PM +0200, strk@refractions.net wrote:
> On Fri, May 06, 2005 at 10:56:33AM -0700, Martin Davis wrote:
> > I would go ahead and implement the patch right now.  It's a very easy
> > patch to apply, and it produces a dramatic improvement in correctness.
> 
> Ok then, can you provide the RobustLineIntersector revision number
> against I should run a diff ? I see only removal of code between
> 1.30 and 1.31 ...
> 
> --strk;
> 
> > 
> > Martin Davis, Senior Technical Architect
> > Vivid Solutions Inc.      www.vividsolutions.com
> > Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> > Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> > 
> > 
> > > -----Original Message-----
> > > From: strk@refractions.net [mailto:strk@refractions.net] 
> > > Sent: May 6, 2005 9:21 AM
> > > To: Martin Davis
> > > Cc: GEOS Development List
> > > Subject: Re: [geos-devel] How robust is GEOS?
> > > 
> > > 
> > > On Fri, May 06, 2005 at 08:43:51AM -0700, Martin Davis wrote:
> > > > Kevin, List, strk:
> > > >  
> > > > I've made an enhancement to JTS (based on a suggestion by 
> > > Kevin) which 
> > > > seems to solve the issue of computed intersection points 
> > > lying outside 
> > > > the intersection of the segment envelopes.  (This is simply one 
> > > > different function in RobustLineIntersector - it's an easy patch, 
> > > > strk).
> > > >  
> > > > This still doesn't produce the ultimate desired result of computing 
> > > > intersections to the full 56 bits of double precision, 
> > > however.  We're 
> > > > working on a solution for that - will post it if and when it's done.
> > > 
> > > Ok. I'll wait for the final version before applying to GEOS. 
> > > Thanks. --strk;
> > > 
> > > >  
> > > > Martin
> > > >  
> > > >  
> > > > Martin Davis, Senior Technical Architect
> > > > Vivid Solutions Inc.      www.vividsolutions.com
> > > > Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> > > > Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> > > > 
> > > > 	-----Original Message-----
> > > > 	From: geos-devel-bounces@geos.refractions.net
> > > > [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Kevin 
> > > > Wiebe
> > > > 	Sent: May 3, 2005 7:00 AM
> > > > 	To: geos-devel@geos.refractions.net
> > > > 	Subject: [geos-devel] How robust is GEOS?
> > > > 	
> > > > 	
> > > > 
> > > > 	I'm asking for advice here:  What is the most robust 
> > > (numerically 
> > > > stable) way to use GEOS?  What are its limitations?
> > > > 
> > > > 	 
> > > > 
> > > > 	For our purposes we need to use code that is both as fast and 
> > > > accurate as possible.  As you probably know, when using a complex 
> > > > algorithm sometimes even small inaccuracies in geometric 
> > > computations 
> > > > can compound into drastically incorrect results.
> > > > 
> > > > 	 
> > > > 
> > > > 	Here is a concrete example from real customer data:
> > > > 
> > > > 	I have created two simple 2-point LINEs and used the 
> > > GEOS call to get 
> > > > the spot where they intersect:
> > > > 
> > > > 	point = lineA.intersection(lineB);
> > > > 
> > > > 	 
> > > > 
> > > > 	lineA = from (2089426.5233462777,1180182.3877339689) to
> > > > (2085646.6891757075,1195618.7333999649)
> > > > 
> > > > 	lineB = from (1889281.8148903656,1997547.0560044837) to
> > > > (2259977.3672235999,483675.17050843034)
> > > > 
> > > > 	 
> > > > 
> > > > 	the intersection point I get back is this:
> > > > 
> > > > 	point = (2097408.2633752143,1144595.8008114607)
> > > > 
> > > > 	 
> > > > 
> > > > 	This point is a significant distance away from any part 
> > > of lineA.  If 
> > > > one were to place this intersection point between the start and end 
> > > > points of lineA, the resulting line would look ridiculous.
> > > > 
> > > > 	 
> > > > 
> > > > 	JTS returns the same result.
> > > > 
> > > > 	 
> > > > 
> > > > 	Depending on your explanations for this I may have some 
> > > technical 
> > > > advice.
> > > > 
> > > > 	 
> > > > 
> > > > 	Thanks for your comments,
> > > > 
> > > > 	-Kevin-
> > > > 
> > > > 	 
> > > > 
> > > > 	----------------------------------------------------------------
> > > > 
> > > > 	 Kevin Wiebe     Safe Software Inc.              kevin@safe.com
> > > > 
> > > > 	      Senior     Surrey, BC, CANADA       phone: (604) 501-9985
> > > > 
> > > > 	   Developer     http://www.safe.com        fax: (604) 501-9965
> > > > 
> > > > 	----------------------------------------------------------------
> > > > 
> > > > 	 
> > > > 
> > > > 	 
> > > > 
> > > > 	 
> > > > 
> > > 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From dhouston at beyondcompliance.ca  Mon May  9 13:53:00 2005
From: dhouston at beyondcompliance.ca (Darren Houston)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] Error Compiling GEOS CVS and Snapshot File Missing
In-Reply-To: <20050509103603.GA95578@keybit.net>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>
	<20050506180305.GG68917@keybit.net>
	<20050509103603.GA95578@keybit.net>
Message-ID: <200505091153.01406.dhouston@beyondcompliance.ca>

Hello everyone,

It's been about 6 months since I've updated my PostGIS and GEOS to the latest 
and greatest (CVS) to play with. I grabbed GEOS from the hourly snapshot from 
the website, configured and started to compile. An error was thrown;

../../source/headers/geos/io.h:272:29: geos/WKBWriterT.h: No such file or 
directory

Indeed, this file is missing. So, I grabbed the latest CVS source (17:00 hours 
GMT, May 9), ran autogen.sh, made sure WKBWriterT.h was in the source (which 
it was), configured and started to compile. An error was thrown;

In file included from ../../source/headers/geos/io.h:272,
                 from Geometry.cpp:28:
../../source/headers/geos/WKBWriterT.h:115: error: invalid use of member `
   geos::WKBWriterT<T>::outStream'

WKBWriterT.h is giving me problems. I looked at WKBWriterT.h, but I'm not a 
C++ programmer, so no blazing mistakes jumped out at me.

My environment is as follows;

gcc (GCC) 3.3.5  (Gentoo Linux 3.3.5-r1, ssp-3.3.2-3, pie-8.7.7.1)
GNU Make 3.80

Let me know if you want any more info.

Hope this was usefull,

Darren H.

From strk at refractions.net  Mon May  9 15:17:40 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] Error Compiling GEOS CVS and Snapshot File Missing
In-Reply-To: <200505091153.01406.dhouston@beyondcompliance.ca>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>
	<20050506180305.GG68917@keybit.net>
	<20050509103603.GA95578@keybit.net>
	<200505091153.01406.dhouston@beyondcompliance.ca>
Message-ID: <20050509191740.GD99308@keybit.net>

I didn't get errors with GCC 3.4.3, anyway this patch should
fix it, please try:

Index: source/headers/geos/WKBWriterT.h
===================================================================
RCS file: /home/cvs/postgis/geos/source/headers/geos/WKBWriterT.h,v
retrieving revision 1.3
diff -U2 -r1.3 WKBWriterT.h
--- source/headers/geos/WKBWriterT.h    29 Apr 2005 17:40:36 -0000      1.3
+++ source/headers/geos/WKBWriterT.h    9 May 2005 19:17:00 -0000
@@ -113,5 +113,5 @@

 template<class T> void
-WKBWriterT<T>::write(const Geometry &g, T &os=outStream)
+WKBWriterT<T>::write(const Geometry &g, T &os)
 {
        outStream = &os;



--
strk;

On Mon, May 09, 2005 at 11:53:00AM -0600, Darren Houston wrote:
> Hello everyone,
> 
> It's been about 6 months since I've updated my PostGIS and GEOS to the latest 
> and greatest (CVS) to play with. I grabbed GEOS from the hourly snapshot from 
> the website, configured and started to compile. An error was thrown;
> 
> ../../source/headers/geos/io.h:272:29: geos/WKBWriterT.h: No such file or 
> directory
> 
> Indeed, this file is missing. So, I grabbed the latest CVS source (17:00 hours 
> GMT, May 9), ran autogen.sh, made sure WKBWriterT.h was in the source (which 
> it was), configured and started to compile. An error was thrown;
> 
> In file included from ../../source/headers/geos/io.h:272,
>                  from Geometry.cpp:28:
> ../../source/headers/geos/WKBWriterT.h:115: error: invalid use of member `
>    geos::WKBWriterT<T>::outStream'
> 
> WKBWriterT.h is giving me problems. I looked at WKBWriterT.h, but I'm not a 
> C++ programmer, so no blazing mistakes jumped out at me.
> 
> My environment is as follows;
> 
> gcc (GCC) 3.3.5  (Gentoo Linux 3.3.5-r1, ssp-3.3.2-3, pie-8.7.7.1)
> GNU Make 3.80
> 
> Let me know if you want any more info.
> 
> Hope this was usefull,
> 
> Darren H.
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From dhouston at beyondcompliance.ca  Tue May 10 00:45:40 2005
From: dhouston at beyondcompliance.ca (Darren Houston)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Error Compiling GEOS CVS and Snapshot File Missing
In-Reply-To: <20050509191740.GD99308@keybit.net>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>
	<200505091153.01406.dhouston@beyondcompliance.ca>
	<20050509191740.GD99308@keybit.net>
Message-ID: <200505092245.40794.dhouston@beyondcompliance.ca>

Hi strk,

I updated GEOS with your patch, started compiling and it almost made it all 
the way through. Your patch did fix the one problem I had. A new error was 
thrown that looked like it was an issue with the gcc compiler, so I upgraded 
to a more recent version (3.4.3 from 3.3.5). GEOS CVS compiled fine. I've 
included my compiler error below for future reference.

Thank you for your help,

Darren H.


example.o(.gnu.linkonce.t._ZNSbIhSt11char_traitsIhESaIhEE12_S_constructIPhEES4_T_S5_RKS1_St20forward_iterator_tag+0x4e): 
In function `unsigned char* std::basic_string<unsigned char, 
std::char_traits<unsigned char>, std::allocator<unsigned char> 
>::_S_construct<unsigned char*>(unsigned char*, unsigned char*, 
std::allocator<unsigned char> const&, std::forward_iterator_tag)':
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/include/g++-v3/bits/basic_string.h:311: 
undefined reference to `std::char_traits<unsigned char>::copy(unsigned char*, 
unsigned char const*, unsigned)'
collect2: ld returned 1 exit status
make[1]: *** [example] Error 1


On May 9, 2005 01:17 pm, strk@refractions.net wrote:
> I didn't get errors with GCC 3.4.3, anyway this patch should
> fix it, please try:
>
> Index: source/headers/geos/WKBWriterT.h
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/headers/geos/WKBWriterT.h,v
> retrieving revision 1.3
> diff -U2 -r1.3 WKBWriterT.h
> --- source/headers/geos/WKBWriterT.h    29 Apr 2005 17:40:36 -0000      1.3
> +++ source/headers/geos/WKBWriterT.h    9 May 2005 19:17:00 -0000
> @@ -113,5 +113,5 @@
>
>  template<class T> void
> -WKBWriterT<T>::write(const Geometry &g, T &os=outStream)
> +WKBWriterT<T>::write(const Geometry &g, T &os)
>  {
>         outStream = &os;
>
>
>
> --
> strk;
>
> On Mon, May 09, 2005 at 11:53:00AM -0600, Darren Houston wrote:
> > Hello everyone,
> >
> > It's been about 6 months since I've updated my PostGIS and GEOS to the
> > latest and greatest (CVS) to play with. I grabbed GEOS from the hourly
> > snapshot from the website, configured and started to compile. An error
> > was thrown;
> >
> > ../../source/headers/geos/io.h:272:29: geos/WKBWriterT.h: No such file or
> > directory
> >
> > Indeed, this file is missing. So, I grabbed the latest CVS source (17:00
> > hours GMT, May 9), ran autogen.sh, made sure WKBWriterT.h was in the
> > source (which it was), configured and started to compile. An error was
> > thrown;
> >
> > In file included from ../../source/headers/geos/io.h:272,
> >                  from Geometry.cpp:28:
> > ../../source/headers/geos/WKBWriterT.h:115: error: invalid use of member
> > ` geos::WKBWriterT<T>::outStream'
> >
> > WKBWriterT.h is giving me problems. I looked at WKBWriterT.h, but I'm not
> > a C++ programmer, so no blazing mistakes jumped out at me.
> >
> > My environment is as follows;
> >
> > gcc (GCC) 3.3.5  (Gentoo Linux 3.3.5-r1, ssp-3.3.2-3, pie-8.7.7.1)
> > GNU Make 3.80
> >
> > Let me know if you want any more info.
> >
> > Hope this was usefull,
> >
> > Darren H.
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
>
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Tue May 10 04:04:13 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Error Compiling GEOS CVS and Snapshot File Missing
In-Reply-To: <200505092245.40794.dhouston@beyondcompliance.ca>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDEA@venus.VividSolutions.com>
	<200505091153.01406.dhouston@beyondcompliance.ca>
	<20050509191740.GD99308@keybit.net>
	<200505092245.40794.dhouston@beyondcompliance.ca>
Message-ID: <20050510080413.GA2508@keybit.net>

On Mon, May 09, 2005 at 10:45:40PM -0600, Darren Houston wrote:
> Hi strk,
> 
> I updated GEOS with your patch, started compiling and it almost made it all 
> the way through. Your patch did fix the one problem I had. A new error was 
> thrown that looked like it was an issue with the gcc compiler, so I upgraded 
> to a more recent version (3.4.3 from 3.3.5). GEOS CVS compiled fine. I've 
> included my compiler error below for future reference.

It looks like an STL limitation... doesn't provide copy semantic
for unsigned char (?).
Anyway current CVS contained the patch, which was needed anyway
(default value for T& was a T*)

> Thank you for your help,

Thank you for testing
--strk;

> 
> Darren H.
> 
> 
> example.o(.gnu.linkonce.t._ZNSbIhSt11char_traitsIhESaIhEE12_S_constructIPhEES4_T_S5_RKS1_St20forward_iterator_tag+0x4e): 
> In function `unsigned char* std::basic_string<unsigned char, 
> std::char_traits<unsigned char>, std::allocator<unsigned char> 
> >::_S_construct<unsigned char*>(unsigned char*, unsigned char*, 
> std::allocator<unsigned char> const&, std::forward_iterator_tag)':
> /usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/include/g++-v3/bits/basic_string.h:311: 
> undefined reference to `std::char_traits<unsigned char>::copy(unsigned char*, 
> unsigned char const*, unsigned)'
> collect2: ld returned 1 exit status
> make[1]: *** [example] Error 1
> 
> 
> On May 9, 2005 01:17 pm, strk@refractions.net wrote:
> > I didn't get errors with GCC 3.4.3, anyway this patch should
> > fix it, please try:
> >
> > Index: source/headers/geos/WKBWriterT.h
> > ===================================================================
> > RCS file: /home/cvs/postgis/geos/source/headers/geos/WKBWriterT.h,v
> > retrieving revision 1.3
> > diff -U2 -r1.3 WKBWriterT.h
> > --- source/headers/geos/WKBWriterT.h    29 Apr 2005 17:40:36 -0000      1.3
> > +++ source/headers/geos/WKBWriterT.h    9 May 2005 19:17:00 -0000
> > @@ -113,5 +113,5 @@
> >
> >  template<class T> void
> > -WKBWriterT<T>::write(const Geometry &g, T &os=outStream)
> > +WKBWriterT<T>::write(const Geometry &g, T &os)
> >  {
> >         outStream = &os;
> >
> >
> >
> > --
> > strk;
> >
> > On Mon, May 09, 2005 at 11:53:00AM -0600, Darren Houston wrote:
> > > Hello everyone,
> > >
> > > It's been about 6 months since I've updated my PostGIS and GEOS to the
> > > latest and greatest (CVS) to play with. I grabbed GEOS from the hourly
> > > snapshot from the website, configured and started to compile. An error
> > > was thrown;
> > >
> > > ../../source/headers/geos/io.h:272:29: geos/WKBWriterT.h: No such file or
> > > directory
> > >
> > > Indeed, this file is missing. So, I grabbed the latest CVS source (17:00
> > > hours GMT, May 9), ran autogen.sh, made sure WKBWriterT.h was in the
> > > source (which it was), configured and started to compile. An error was
> > > thrown;
> > >
> > > In file included from ../../source/headers/geos/io.h:272,
> > >                  from Geometry.cpp:28:
> > > ../../source/headers/geos/WKBWriterT.h:115: error: invalid use of member
> > > ` geos::WKBWriterT<T>::outStream'
> > >
> > > WKBWriterT.h is giving me problems. I looked at WKBWriterT.h, but I'm not
> > > a C++ programmer, so no blazing mistakes jumped out at me.
> > >
> > > My environment is as follows;
> > >
> > > gcc (GCC) 3.3.5  (Gentoo Linux 3.3.5-r1, ssp-3.3.2-3, pie-8.7.7.1)
> > > GNU Make 3.80
> > >
> > > Let me know if you want any more info.
> > >
> > > Hope this was usefull,
> > >
> > > Darren H.
> > > _______________________________________________
> > > geos-devel mailing list
> > > geos-devel@geos.refractions.net
> > > http://geos.refractions.net/mailman/listinfo/geos-devel
> >
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From steve.lime at dnr.state.mn.us  Wed May 11 12:52:08 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and GeometryFactory
	relationship...
Message-ID: <s281f234.062@co5.dnr.state.mn.us>

Hi All: I'm running into trouble making a clean integration of GEOS into
MapServer. Problem is that GeometryFactory objects must persist while
any Geometry objects spawned from that factory are in us. This makes it
necessary to either use a global factory which is problematic with
theading, or somehow couple the two so that they are created, persist
and are deleted together. I'm curious why Geometry's cannot stand-alone?
Perhaps I'm missing something obvious in my implementation.

Steve

Stephen Lime
Data & Applications Manager

Minnesota DNR
500 Lafayette Road
St. Paul, MN 55155
651-297-2937

From mbdavis at VividSolutions.com  Wed May 11 13:02:18 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
Message-ID: <5A94289A9268514C8D6C0F1FF44BA0279C3D88@venus.VividSolutions.com>

Geometrys need some metadata to allow methods to execute.  This
currently includes things like PrecisionModel and SRID (and may grow to
include more things in the future).  Rather than duplicate these for
every geometry, the GF is referenced by the geometry and shared with any
created geometrys.  This works well in the Java world.  

In the C++ world if this is a problem I guess each Geometry could own
its own copy of the GF.  This would require a code change to make
Geometrys copy the GF for created Geometrys, rather than keep a
reference to it.

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: geos-devel-bounces@geos.refractions.net 
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> Steve Lime
> Sent: May 11, 2005 9:52 AM
> To: geos-devel@geos.refractions.net
> Subject: [geos-devel] Question about Geometry and 
> GeometryFactoryrelationship...
> 
> 
> Hi All: I'm running into trouble making a clean integration 
> of GEOS into MapServer. Problem is that GeometryFactory 
> objects must persist while any Geometry objects spawned from 
> that factory are in us. This makes it necessary to either use 
> a global factory which is problematic with theading, or 
> somehow couple the two so that they are created, persist and 
> are deleted together. I'm curious why Geometry's cannot 
> stand-alone? Perhaps I'm missing something obvious in my 
> implementation.
> 
> Steve
> 
> Stephen Lime
> Data & Applications Manager
> 
> Minnesota DNR
> 500 Lafayette Road
> St. Paul, MN 55155
> 651-297-2937
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel
> 

From steve.lime at dnr.state.mn.us  Wed May 11 13:21:05 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
Message-ID: <s281f8fe.068@co5.dnr.state.mn.us>

Hi Martin: Thanks for the clarification, something to think about
anyway. In lieu of a code change at the moment I'll couple the two
myself. GEOS Geometry's are buried behind MapServer shapes so the
developer/user doesn't see 'em. With MapServer there no logical
candidate structure/object to attach the factory to without explicitly
creating something new and GEOS specfic. I'd rather not go there.

Is the factory object relatively lightweight so that constantly
instatiating new objects doesn't hurt performance?

Steve

>>> mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
Geometrys need some metadata to allow methods to execute.  This
currently includes things like PrecisionModel and SRID (and may grow
to
include more things in the future).  Rather than duplicate these for
every geometry, the GF is referenced by the geometry and shared with
any
created geometrys.  This works well in the Java world.  

In the C++ world if this is a problem I guess each Geometry could own
its own copy of the GF.  This would require a code change to make
Geometrys copy the GF for created Geometrys, rather than keep a
reference to it.

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com 
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: geos-devel-bounces@geos.refractions.net 
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> Steve Lime
> Sent: May 11, 2005 9:52 AM
> To: geos-devel@geos.refractions.net 
> Subject: [geos-devel] Question about Geometry and 
> GeometryFactoryrelationship...
> 
> 
> Hi All: I'm running into trouble making a clean integration 
> of GEOS into MapServer. Problem is that GeometryFactory 
> objects must persist while any Geometry objects spawned from 
> that factory are in us. This makes it necessary to either use 
> a global factory which is problematic with theading, or 
> somehow couple the two so that they are created, persist and 
> are deleted together. I'm curious why Geometry's cannot 
> stand-alone? Perhaps I'm missing something obvious in my 
> implementation.
> 
> Steve
> 
> Stephen Lime
> Data & Applications Manager
> 
> Minnesota DNR
> 500 Lafayette Road
> St. Paul, MN 55155
> 651-297-2937
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel 
> 
_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net 
http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Wed May 11 18:20:10 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
In-Reply-To: <s281f8fe.068@co5.dnr.state.mn.us>
References: <s281f8fe.068@co5.dnr.state.mn.us>
Message-ID: <20050511222010.GA23400@keybit.net>

On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
> Hi Martin: Thanks for the clarification, something to think about
> anyway. In lieu of a code change at the moment I'll couple the two
> myself. GEOS Geometry's are buried behind MapServer shapes so the
> developer/user doesn't see 'em. With MapServer there no logical
> candidate structure/object to attach the factory to without explicitly
> creating something new and GEOS specfic. I'd rather not go there.
> 
> Is the factory object relatively lightweight so that constantly
> instatiating new objects doesn't hurt performance?

This must be profiled to tell.

The default constructor for a GeometryFactory:

GeometryFactory::GeometryFactory() {
        precisionModel=new PrecisionModel();
        SRID=0;
        coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
}

The default constructor for a PrecisionModel:

PrecisionModel::PrecisionModel(){
        modelType=FLOATING;
        scale=1.0;
}

So it takes 2 ints, 1 double and 2 pointers of size + 3 function 
calls (own and PM ctors and ::instance).

Would it be ok for threading if GEOS provides a
defaultGeometryFactory ?

--strk;

> 
> Steve
> 
> >>> mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
> Geometrys need some metadata to allow methods to execute.  This
> currently includes things like PrecisionModel and SRID (and may grow
> to
> include more things in the future).  Rather than duplicate these for
> every geometry, the GF is referenced by the geometry and shared with
> any
> created geometrys.  This works well in the Java world.  
> 
> In the C++ world if this is a problem I guess each Geometry could own
> its own copy of the GF.  This would require a code change to make
> Geometrys copy the GF for created Geometrys, rather than keep a
> reference to it.
> 
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com 
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 
> > -----Original Message-----
> > From: geos-devel-bounces@geos.refractions.net 
> > [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> > Steve Lime
> > Sent: May 11, 2005 9:52 AM
> > To: geos-devel@geos.refractions.net 
> > Subject: [geos-devel] Question about Geometry and 
> > GeometryFactoryrelationship...
> > 
> > 
> > Hi All: I'm running into trouble making a clean integration 
> > of GEOS into MapServer. Problem is that GeometryFactory 
> > objects must persist while any Geometry objects spawned from 
> > that factory are in us. This makes it necessary to either use 
> > a global factory which is problematic with theading, or 
> > somehow couple the two so that they are created, persist and 
> > are deleted together. I'm curious why Geometry's cannot 
> > stand-alone? Perhaps I'm missing something obvious in my 
> > implementation.
> > 
> > Steve
> > 
> > Stephen Lime
> > Data & Applications Manager
> > 
> > Minnesota DNR
> > 500 Lafayette Road
> > St. Paul, MN 55155
> > 651-297-2937
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From sdlime at comcast.net  Fri May 13 00:06:40 2005
From: sdlime at comcast.net (Stephen Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
In-Reply-To: <20050511222010.GA23400@keybit.net>
References: <s281f8fe.068@co5.dnr.state.mn.us>
	<20050511222010.GA23400@keybit.net>
Message-ID: <f1c70d7baa820e630e90137b175d5e8d@comcast.net>

I'm sure there are others lurking that are far more qualified to 
comment on threading. How would a default factory be implemented? if it 
took care of the dependancy I first asked about then I think it would 
simplify life for what I'm working on.

Steve

On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:

> On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
>> Hi Martin: Thanks for the clarification, something to think about
>> anyway. In lieu of a code change at the moment I'll couple the two
>> myself. GEOS Geometry's are buried behind MapServer shapes so the
>> developer/user doesn't see 'em. With MapServer there no logical
>> candidate structure/object to attach the factory to without explicitly
>> creating something new and GEOS specfic. I'd rather not go there.
>>
>> Is the factory object relatively lightweight so that constantly
>> instatiating new objects doesn't hurt performance?
>
> This must be profiled to tell.
>
> The default constructor for a GeometryFactory:
>
> GeometryFactory::GeometryFactory() {
>         precisionModel=new PrecisionModel();
>         SRID=0;
>         
> coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
> }
>
> The default constructor for a PrecisionModel:
>
> PrecisionModel::PrecisionModel(){
>         modelType=FLOATING;
>         scale=1.0;
> }
>
> So it takes 2 ints, 1 double and 2 pointers of size + 3 function
> calls (own and PM ctors and ::instance).
>
> Would it be ok for threading if GEOS provides a
> defaultGeometryFactory ?
>
> --strk;
>
>>
>> Steve
>>
>>>>> mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
>> Geometrys need some metadata to allow methods to execute.  This
>> currently includes things like PrecisionModel and SRID (and may grow
>> to
>> include more things in the future).  Rather than duplicate these for
>> every geometry, the GF is referenced by the geometry and shared with
>> any
>> created geometrys.  This works well in the Java world.
>>
>> In the C++ world if this is a problem I guess each Geometry could own
>> its own copy of the GF.  This would require a code change to make
>> Geometrys copy the GF for created Geometrys, rather than keep a
>> reference to it.
>>
>> Martin Davis, Senior Technical Architect
>> Vivid Solutions Inc.      www.vividsolutions.com
>> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
>> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
>>
>>
>>> -----Original Message-----
>>> From: geos-devel-bounces@geos.refractions.net
>>> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of
>>> Steve Lime
>>> Sent: May 11, 2005 9:52 AM
>>> To: geos-devel@geos.refractions.net
>>> Subject: [geos-devel] Question about Geometry and
>>> GeometryFactoryrelationship...
>>>
>>>
>>> Hi All: I'm running into trouble making a clean integration
>>> of GEOS into MapServer. Problem is that GeometryFactory
>>> objects must persist while any Geometry objects spawned from
>>> that factory are in us. This makes it necessary to either use
>>> a global factory which is problematic with theading, or
>>> somehow couple the two so that they are created, persist and
>>> are deleted together. I'm curious why Geometry's cannot
>>> stand-alone? Perhaps I'm missing something obvious in my
>>> implementation.
>>>
>>> Steve
>>>
>>> Stephen Lime
>>> Data & Applications Manager
>>>
>>> Minnesota DNR
>>> 500 Lafayette Road
>>> St. Paul, MN 55155
>>> 651-297-2937
>>> _______________________________________________
>>> geos-devel mailing list
>>> geos-devel@geos.refractions.net
>>> http://geos.refractions.net/mailman/listinfo/geos-devel
>>>
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@geos.refractions.net
>> http://geos.refractions.net/mailman/listinfo/geos-devel
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@geos.refractions.net
>> http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
>


From sdlime at comcast.net  Fri May 13 01:11:57 2005
From: sdlime at comcast.net (Stephen Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
In-Reply-To: <20050511222010.GA23400@keybit.net>
References: <s281f8fe.068@co5.dnr.state.mn.us>
	<20050511222010.GA23400@keybit.net>
Message-ID: <f6609389ba691fa02da36e3b210088ba@comcast.net>

One other question then. Most of the time you need a GeometryFactory 
when creating a Geometery, but not always. What happens in the case of 
constructing a buffer?

e.g.

   Geometry *bg = g->buffer(width);

At what GeometryFactory does bg point? The same as g I assume. This 
makes my workaround of keeping a GeometryFactory and Geometry coupled 
together within a MapServer shape kinda difficult, unless there's an 
easy way to point a Geometry at another factory of its own. Otherwise 
if features are deleted in the wrong order they may well take other 
features with them.

Steve

On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:

> On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
>> Hi Martin: Thanks for the clarification, something to think about
>> anyway. In lieu of a code change at the moment I'll couple the two
>> myself. GEOS Geometry's are buried behind MapServer shapes so the
>> developer/user doesn't see 'em. With MapServer there no logical
>> candidate structure/object to attach the factory to without explicitly
>> creating something new and GEOS specfic. I'd rather not go there.
>>
>> Is the factory object relatively lightweight so that constantly
>> instatiating new objects doesn't hurt performance?
>
> This must be profiled to tell.
>
> The default constructor for a GeometryFactory:
>
> GeometryFactory::GeometryFactory() {
>         precisionModel=new PrecisionModel();
>         SRID=0;
>         
> coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
> }
>
> The default constructor for a PrecisionModel:
>
> PrecisionModel::PrecisionModel(){
>         modelType=FLOATING;
>         scale=1.0;
> }
>
> So it takes 2 ints, 1 double and 2 pointers of size + 3 function
> calls (own and PM ctors and ::instance).
>
> Would it be ok for threading if GEOS provides a
> defaultGeometryFactory ?
>
> --strk;
>
>>
>> Steve
>>
>>>>> mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
>> Geometrys need some metadata to allow methods to execute.  This
>> currently includes things like PrecisionModel and SRID (and may grow
>> to
>> include more things in the future).  Rather than duplicate these for
>> every geometry, the GF is referenced by the geometry and shared with
>> any
>> created geometrys.  This works well in the Java world.
>>
>> In the C++ world if this is a problem I guess each Geometry could own
>> its own copy of the GF.  This would require a code change to make
>> Geometrys copy the GF for created Geometrys, rather than keep a
>> reference to it.
>>
>> Martin Davis, Senior Technical Architect
>> Vivid Solutions Inc.      www.vividsolutions.com
>> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
>> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
>>
>>
>>> -----Original Message-----
>>> From: geos-devel-bounces@geos.refractions.net
>>> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of
>>> Steve Lime
>>> Sent: May 11, 2005 9:52 AM
>>> To: geos-devel@geos.refractions.net
>>> Subject: [geos-devel] Question about Geometry and
>>> GeometryFactoryrelationship...
>>>
>>>
>>> Hi All: I'm running into trouble making a clean integration
>>> of GEOS into MapServer. Problem is that GeometryFactory
>>> objects must persist while any Geometry objects spawned from
>>> that factory are in us. This makes it necessary to either use
>>> a global factory which is problematic with theading, or
>>> somehow couple the two so that they are created, persist and
>>> are deleted together. I'm curious why Geometry's cannot
>>> stand-alone? Perhaps I'm missing something obvious in my
>>> implementation.
>>>
>>> Steve
>>>
>>> Stephen Lime
>>> Data & Applications Manager
>>>
>>> Minnesota DNR
>>> 500 Lafayette Road
>>> St. Paul, MN 55155
>>> 651-297-2937
>>> _______________________________________________
>>> geos-devel mailing list
>>> geos-devel@geos.refractions.net
>>> http://geos.refractions.net/mailman/listinfo/geos-devel
>>>
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@geos.refractions.net
>> http://geos.refractions.net/mailman/listinfo/geos-devel
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@geos.refractions.net
>> http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
>


From strk at refractions.net  Fri May 13 03:28:38 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
In-Reply-To: <f6609389ba691fa02da36e3b210088ba@comcast.net>
References: <s281f8fe.068@co5.dnr.state.mn.us>
	<20050511222010.GA23400@keybit.net>
	<f6609389ba691fa02da36e3b210088ba@comcast.net>
Message-ID: <20050513072838.GD28367@keybit.net>

On Fri, May 13, 2005 at 12:11:57AM -0500, Stephen Lime wrote:
> One other question then. Most of the time you need a GeometryFactory 
> when creating a Geometery, but not always. What happens in the case of 
> constructing a buffer?
> 
> e.g.
> 
>   Geometry *bg = g->buffer(width);
> 
> At what GeometryFactory does bg point? The same as g I assume. This 
> makes my workaround of keeping a GeometryFactory and Geometry coupled 
> together within a MapServer shape kinda difficult, unless there's an 
> easy way to point a Geometry at another factory of its own. Otherwise 
> if features are deleted in the wrong order they may well take other 
> features with them.

Buffer operation will use factory of input. 
Geometry destruction won't destruct the GeometryFactory it points to.
Binary operations can be a problem, as you have two geoms with possibly
two different factories. I have to say I don't know what should
be expected then. Martin should be able to answer, and I can check 
that GEOS respect the expected behaviour.

--strk;


> 
> Steve
> 
> On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:
> 
> >On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
> >>Hi Martin: Thanks for the clarification, something to think about
> >>anyway. In lieu of a code change at the moment I'll couple the two
> >>myself. GEOS Geometry's are buried behind MapServer shapes so the
> >>developer/user doesn't see 'em. With MapServer there no logical
> >>candidate structure/object to attach the factory to without explicitly
> >>creating something new and GEOS specfic. I'd rather not go there.
> >>
> >>Is the factory object relatively lightweight so that constantly
> >>instatiating new objects doesn't hurt performance?
> >
> >This must be profiled to tell.
> >
> >The default constructor for a GeometryFactory:
> >
> >GeometryFactory::GeometryFactory() {
> >        precisionModel=new PrecisionModel();
> >        SRID=0;
> >        
> >coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
> >}
> >
> >The default constructor for a PrecisionModel:
> >
> >PrecisionModel::PrecisionModel(){
> >        modelType=FLOATING;
> >        scale=1.0;
> >}
> >
> >So it takes 2 ints, 1 double and 2 pointers of size + 3 function
> >calls (own and PM ctors and ::instance).
> >
> >Would it be ok for threading if GEOS provides a
> >defaultGeometryFactory ?
> >
> >--strk;
> >
> >>
> >>Steve
> >>
> >>>>>mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
> >>Geometrys need some metadata to allow methods to execute.  This
> >>currently includes things like PrecisionModel and SRID (and may grow
> >>to
> >>include more things in the future).  Rather than duplicate these for
> >>every geometry, the GF is referenced by the geometry and shared with
> >>any
> >>created geometrys.  This works well in the Java world.
> >>
> >>In the C++ world if this is a problem I guess each Geometry could own
> >>its own copy of the GF.  This would require a code change to make
> >>Geometrys copy the GF for created Geometrys, rather than keep a
> >>reference to it.
> >>
> >>Martin Davis, Senior Technical Architect
> >>Vivid Solutions Inc.      www.vividsolutions.com
> >>Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> >>Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> >>
> >>
> >>>-----Original Message-----
> >>>From: geos-devel-bounces@geos.refractions.net
> >>>[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of
> >>>Steve Lime
> >>>Sent: May 11, 2005 9:52 AM
> >>>To: geos-devel@geos.refractions.net
> >>>Subject: [geos-devel] Question about Geometry and
> >>>GeometryFactoryrelationship...
> >>>
> >>>
> >>>Hi All: I'm running into trouble making a clean integration
> >>>of GEOS into MapServer. Problem is that GeometryFactory
> >>>objects must persist while any Geometry objects spawned from
> >>>that factory are in us. This makes it necessary to either use
> >>>a global factory which is problematic with theading, or
> >>>somehow couple the two so that they are created, persist and
> >>>are deleted together. I'm curious why Geometry's cannot
> >>>stand-alone? Perhaps I'm missing something obvious in my
> >>>implementation.
> >>>
> >>>Steve
> >>>
> >>>Stephen Lime
> >>>Data & Applications Manager
> >>>
> >>>Minnesota DNR
> >>>500 Lafayette Road
> >>>St. Paul, MN 55155
> >>>651-297-2937
> >>>_______________________________________________
> >>>geos-devel mailing list
> >>>geos-devel@geos.refractions.net
> >>>http://geos.refractions.net/mailman/listinfo/geos-devel
> >>>
> >>_______________________________________________
> >>geos-devel mailing list
> >>geos-devel@geos.refractions.net
> >>http://geos.refractions.net/mailman/listinfo/geos-devel
> >>_______________________________________________
> >>geos-devel mailing list
> >>geos-devel@geos.refractions.net
> >>http://geos.refractions.net/mailman/listinfo/geos-devel
> >_______________________________________________
> >geos-devel mailing list
> >geos-devel@geos.refractions.net
> >http://geos.refractions.net/mailman/listinfo/geos-devel
> >
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at keybit.net  Fri May 13 05:42:36 2005
From: strk at keybit.net (strk)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Re: WKB parser
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA02796CDB3@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA02796CDB3@venus.VividSolutions.com>
Message-ID: <20050513094236.GC38590@keybit.net>

On Fri, Apr 29, 2005 at 05:27:06PM -0700, Martin Davis wrote:
> Have a look at test.jts.junit.io.WKBTest in CVS.  I developed some
> utility classes to allow vertex-by-vertex comparison of geometry.  (You
> can use Geometry#equalsExact, but it only does 2D comparisons, so isn't
> useful for testing 3D geoms).

What about adding a new Geometry method for strict equality test ?
(3D, vertex by vertex comparison).
In that case I think we should consider LINESTRING and LINEARRING
as being the same and maybe (again) drop LINEARRING WKT (is that
really useful ?).

--strk;


> 
> 
> 
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 
> > -----Original Message-----
> > From: strk [mailto:strk@keybit.net] 
> > Sent: April 29, 2005 7:16 AM
> > To: Martin Davis
> > Subject: WKB parser
> > 
> > 
> > I've about done with the WKB parser code.
> > In order to test it I need a function to test 
> > vertex-by-vertex equality of geometries, to compare input and 
> > output ( INPUT -> WKBWrite -> WKBRead -> OUTPUT).
> > 
> > What function should I use ?
> > Is anything similar in JTS ?
> > (sorry if I'm being lame)
> > 
> > --strk;
> > 

From dblasby at openplans.org  Fri May 13 09:14:23 2005
From: dblasby at openplans.org (dblasby@openplans.org)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Re: WKB parser
Message-ID: <1115990063.4284a82f52343@webmail.limegroup.com>

strk,

JTS has an "equalsExact(Geometry,Geometry)" method and a
"equalsExact(Geometry,Geometry, tolerance)".

I'm pretty sure that GEOS has at least the former.

I'm not 100% sure if its 2d or 3d (I assume its 3d, but I could be
wrong).


dave



----------------------------------------------------------
This mail sent through IMP: https://webmail.limegroup.com/

From steve.lime at dnr.state.mn.us  Fri May 13 09:32:16 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
Message-ID: <s284662a.089@co5.dnr.state.mn.us>

Sorry, I was refering to deleting a Geometry and GeometryFactory at the
same time which would cause problems with other Geometry objects created
from one another via buffers, convex hulls or whatever. I have been
hanging a Geometry off of a MapServer C shape structure and would have
to include a GeometryFactory as well to avoid threading issues. Each
shape would then have its own GeometryFactory which would be deleted
when a shape is deleted.

I wish C/C++ was multi-threaded by default with a memory manager but
they're not...

Steve

>>> strk@refractions.net 05/13/05 2:28 AM >>>
On Fri, May 13, 2005 at 12:11:57AM -0500, Stephen Lime wrote:
> One other question then. Most of the time you need a GeometryFactory 
> when creating a Geometery, but not always. What happens in the case of

> constructing a buffer?
> 
> e.g.
> 
>   Geometry *bg = g->buffer(width);
> 
> At what GeometryFactory does bg point? The same as g I assume. This 
> makes my workaround of keeping a GeometryFactory and Geometry coupled 
> together within a MapServer shape kinda difficult, unless there's an 
> easy way to point a Geometry at another factory of its own. Otherwise 
> if features are deleted in the wrong order they may well take other 
> features with them.

Buffer operation will use factory of input. 
Geometry destruction won't destruct the GeometryFactory it points to.
Binary operations can be a problem, as you have two geoms with possibly
two different factories. I have to say I don't know what should
be expected then. Martin should be able to answer, and I can check 
that GEOS respect the expected behaviour.

--strk;


> 
> Steve
> 
> On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:
> 
> >On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
> >>Hi Martin: Thanks for the clarification, something to think about
> >>anyway. In lieu of a code change at the moment I'll couple the two
> >>myself. GEOS Geometry's are buried behind MapServer shapes so the
> >>developer/user doesn't see 'em. With MapServer there no logical
> >>candidate structure/object to attach the factory to without
explicitly
> >>creating something new and GEOS specfic. I'd rather not go there.
> >>
> >>Is the factory object relatively lightweight so that constantly
> >>instatiating new objects doesn't hurt performance?
> >
> >This must be profiled to tell.
> >
> >The default constructor for a GeometryFactory:
> >
> >GeometryFactory::GeometryFactory() {
> >        precisionModel=new PrecisionModel();
> >        SRID=0;
> >        
> >coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
> >}
> >
> >The default constructor for a PrecisionModel:
> >
> >PrecisionModel::PrecisionModel(){
> >        modelType=FLOATING;
> >        scale=1.0;
> >}
> >
> >So it takes 2 ints, 1 double and 2 pointers of size + 3 function
> >calls (own and PM ctors and ::instance).
> >
> >Would it be ok for threading if GEOS provides a
> >defaultGeometryFactory ?
> >
> >--strk;
> >
> >>
> >>Steve
> >>
> >>>>>mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
> >>Geometrys need some metadata to allow methods to execute.  This
> >>currently includes things like PrecisionModel and SRID (and may grow
> >>to
> >>include more things in the future).  Rather than duplicate these for
> >>every geometry, the GF is referenced by the geometry and shared with
> >>any
> >>created geometrys.  This works well in the Java world.
> >>
> >>In the C++ world if this is a problem I guess each Geometry could
own
> >>its own copy of the GF.  This would require a code change to make
> >>Geometrys copy the GF for created Geometrys, rather than keep a
> >>reference to it.
> >>
> >>Martin Davis, Senior Technical Architect
> >>Vivid Solutions Inc.      www.vividsolutions.com
> >>Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> >>Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> >>
> >>
> >>>-----Original Message-----
> >>>From: geos-devel-bounces@geos.refractions.net
> >>>[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of
> >>>Steve Lime
> >>>Sent: May 11, 2005 9:52 AM
> >>>To: geos-devel@geos.refractions.net
> >>>Subject: [geos-devel] Question about Geometry and
> >>>GeometryFactoryrelationship...
> >>>
> >>>
> >>>Hi All: I'm running into trouble making a clean integration
> >>>of GEOS into MapServer. Problem is that GeometryFactory
> >>>objects must persist while any Geometry objects spawned from
> >>>that factory are in us. This makes it necessary to either use
> >>>a global factory which is problematic with theading, or
> >>>somehow couple the two so that they are created, persist and
> >>>are deleted together. I'm curious why Geometry's cannot
> >>>stand-alone? Perhaps I'm missing something obvious in my
> >>>implementation.
> >>>
> >>>Steve
> >>>
> >>>Stephen Lime
> >>>Data & Applications Manager
> >>>
> >>>Minnesota DNR
> >>>500 Lafayette Road
> >>>St. Paul, MN 55155
> >>>651-297-2937
> >>>_______________________________________________
> >>>geos-devel mailing list
> >>>geos-devel@geos.refractions.net
> >>>http://geos.refractions.net/mailman/listinfo/geos-devel
> >>>
> >>_______________________________________________
> >>geos-devel mailing list
> >>geos-devel@geos.refractions.net
> >>http://geos.refractions.net/mailman/listinfo/geos-devel
> >>_______________________________________________
> >>geos-devel mailing list
> >>geos-devel@geos.refractions.net
> >>http://geos.refractions.net/mailman/listinfo/geos-devel
> >_______________________________________________
> >geos-devel mailing list
> >geos-devel@geos.refractions.net
> >http://geos.refractions.net/mailman/listinfo/geos-devel
> >
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net
http://geos.refractions.net/mailman/listinfo/geos-devel


From strk at refractions.net  Fri May 13 10:13:28 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry and
	GeometryFactoryrelationship...
In-Reply-To: <s284662a.090@co5.dnr.state.mn.us>
References: <s284662a.090@co5.dnr.state.mn.us>
Message-ID: <20050513141328.GC38872@keybit.net>

On Fri, May 13, 2005 at 08:32:16AM -0500, Steve Lime wrote:
> Sorry, I was refering to deleting a Geometry and GeometryFactory at the
> same time which would cause problems with other Geometry objects created
> from one another via buffers, convex hulls or whatever. I have been
> hanging a Geometry off of a MapServer C shape structure and would have
> to include a GeometryFactory as well to avoid threading issues. Each
> shape would then have its own GeometryFactory which would be deleted
> when a shape is deleted.

No, you can't safely destroy the GeometryFactory element of a
Geometry. Can you tell me more about the issues of keeping
a single instance of the GeometryFactory ? It is a read-only
structure (all state defined at construction time).

--strk;

> 
> I wish C/C++ was multi-threaded by default with a memory manager but
> they're not...
> 
> Steve
> 
> >>> strk@refractions.net 05/13/05 2:28 AM >>>
> On Fri, May 13, 2005 at 12:11:57AM -0500, Stephen Lime wrote:
> > One other question then. Most of the time you need a GeometryFactory 
> > when creating a Geometery, but not always. What happens in the case of
> 
> > constructing a buffer?
> > 
> > e.g.
> > 
> >   Geometry *bg = g->buffer(width);
> > 
> > At what GeometryFactory does bg point? The same as g I assume. This 
> > makes my workaround of keeping a GeometryFactory and Geometry coupled 
> > together within a MapServer shape kinda difficult, unless there's an 
> > easy way to point a Geometry at another factory of its own. Otherwise 
> > if features are deleted in the wrong order they may well take other 
> > features with them.
> 
> Buffer operation will use factory of input. 
> Geometry destruction won't destruct the GeometryFactory it points to.
> Binary operations can be a problem, as you have two geoms with possibly
> two different factories. I have to say I don't know what should
> be expected then. Martin should be able to answer, and I can check 
> that GEOS respect the expected behaviour.
> 
> --strk;
> 
> 
> > 
> > Steve
> > 
> > On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:
> > 
> > >On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
> > >>Hi Martin: Thanks for the clarification, something to think about
> > >>anyway. In lieu of a code change at the moment I'll couple the two
> > >>myself. GEOS Geometry's are buried behind MapServer shapes so the
> > >>developer/user doesn't see 'em. With MapServer there no logical
> > >>candidate structure/object to attach the factory to without
> explicitly
> > >>creating something new and GEOS specfic. I'd rather not go there.
> > >>
> > >>Is the factory object relatively lightweight so that constantly
> > >>instatiating new objects doesn't hurt performance?
> > >
> > >This must be profiled to tell.
> > >
> > >The default constructor for a GeometryFactory:
> > >
> > >GeometryFactory::GeometryFactory() {
> > >        precisionModel=new PrecisionModel();
> > >        SRID=0;
> > >        
> > >coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
> > >}
> > >
> > >The default constructor for a PrecisionModel:
> > >
> > >PrecisionModel::PrecisionModel(){
> > >        modelType=FLOATING;
> > >        scale=1.0;
> > >}
> > >
> > >So it takes 2 ints, 1 double and 2 pointers of size + 3 function
> > >calls (own and PM ctors and ::instance).
> > >
> > >Would it be ok for threading if GEOS provides a
> > >defaultGeometryFactory ?
> > >
> > >--strk;
> > >
> > >>
> > >>Steve
> > >>
> > >>>>>mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
> > >>Geometrys need some metadata to allow methods to execute.  This
> > >>currently includes things like PrecisionModel and SRID (and may grow
> > >>to
> > >>include more things in the future).  Rather than duplicate these for
> > >>every geometry, the GF is referenced by the geometry and shared with
> > >>any
> > >>created geometrys.  This works well in the Java world.
> > >>
> > >>In the C++ world if this is a problem I guess each Geometry could
> own
> > >>its own copy of the GF.  This would require a code change to make
> > >>Geometrys copy the GF for created Geometrys, rather than keep a
> > >>reference to it.
> > >>
> > >>Martin Davis, Senior Technical Architect
> > >>Vivid Solutions Inc.      www.vividsolutions.com
> > >>Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> > >>Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> > >>
> > >>
> > >>>-----Original Message-----
> > >>>From: geos-devel-bounces@geos.refractions.net
> > >>>[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of
> > >>>Steve Lime
> > >>>Sent: May 11, 2005 9:52 AM
> > >>>To: geos-devel@geos.refractions.net
> > >>>Subject: [geos-devel] Question about Geometry and
> > >>>GeometryFactoryrelationship...
> > >>>
> > >>>
> > >>>Hi All: I'm running into trouble making a clean integration
> > >>>of GEOS into MapServer. Problem is that GeometryFactory
> > >>>objects must persist while any Geometry objects spawned from
> > >>>that factory are in us. This makes it necessary to either use
> > >>>a global factory which is problematic with theading, or
> > >>>somehow couple the two so that they are created, persist and
> > >>>are deleted together. I'm curious why Geometry's cannot
> > >>>stand-alone? Perhaps I'm missing something obvious in my
> > >>>implementation.
> > >>>
> > >>>Steve
> > >>>
> > >>>Stephen Lime
> > >>>Data & Applications Manager
> > >>>
> > >>>Minnesota DNR
> > >>>500 Lafayette Road
> > >>>St. Paul, MN 55155
> > >>>651-297-2937
> > >>>_______________________________________________
> > >>>geos-devel mailing list
> > >>>geos-devel@geos.refractions.net
> > >>>http://geos.refractions.net/mailman/listinfo/geos-devel
> > >>>
> > >>_______________________________________________
> > >>geos-devel mailing list
> > >>geos-devel@geos.refractions.net
> > >>http://geos.refractions.net/mailman/listinfo/geos-devel
> > >>_______________________________________________
> > >>geos-devel mailing list
> > >>geos-devel@geos.refractions.net
> > >>http://geos.refractions.net/mailman/listinfo/geos-devel
> > >_______________________________________________
> > >geos-devel mailing list
> > >geos-devel@geos.refractions.net
> > >http://geos.refractions.net/mailman/listinfo/geos-devel
> > >
> > 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From chodgson at refractions.net  Fri May 13 10:33:40 2005
From: chodgson at refractions.net (Chris Hodgson)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry
	and	GeometryFactoryrelationship...
In-Reply-To: <20050513141328.GC38872@keybit.net>
References: <s284662a.090@co5.dnr.state.mn.us>
	<20050513141328.GC38872@keybit.net>
Message-ID: <4284BAC4.6020005@refractions.net>

Well, if GeometryFactory had any internal state at all, then there would 
be the risk of two different threads trying to simultaneously access 
and/or modify it. However, since as you say it is read only, then it may 
be perfectly thread-safe to keep just one of them around and use the 
same one in all threads for all geometries. That would certainly be the 
easiest to code, wouldn't it Steve?

Chris

strk@refractions.net wrote:
> On Fri, May 13, 2005 at 08:32:16AM -0500, Steve Lime wrote:
> 
>>Sorry, I was refering to deleting a Geometry and GeometryFactory at the
>>same time which would cause problems with other Geometry objects created
>>from one another via buffers, convex hulls or whatever. I have been
>>hanging a Geometry off of a MapServer C shape structure and would have
>>to include a GeometryFactory as well to avoid threading issues. Each
>>shape would then have its own GeometryFactory which would be deleted
>>when a shape is deleted.
> 
> 
> No, you can't safely destroy the GeometryFactory element of a
> Geometry. Can you tell me more about the issues of keeping
> a single instance of the GeometryFactory ? It is a read-only
> structure (all state defined at construction time).
> 
> --strk;
> 
> 
>>I wish C/C++ was multi-threaded by default with a memory manager but
>>they're not...
>>
>>Steve
>>
>>
>>>>>strk@refractions.net 05/13/05 2:28 AM >>>
>>
>>On Fri, May 13, 2005 at 12:11:57AM -0500, Stephen Lime wrote:
>>
>>>One other question then. Most of the time you need a GeometryFactory 
>>>when creating a Geometery, but not always. What happens in the case of
>>
>>>constructing a buffer?
>>>
>>>e.g.
>>>
>>>  Geometry *bg = g->buffer(width);
>>>
>>>At what GeometryFactory does bg point? The same as g I assume. This 
>>>makes my workaround of keeping a GeometryFactory and Geometry coupled 
>>>together within a MapServer shape kinda difficult, unless there's an 
>>>easy way to point a Geometry at another factory of its own. Otherwise 
>>>if features are deleted in the wrong order they may well take other 
>>>features with them.
>>
>>Buffer operation will use factory of input. 
>>Geometry destruction won't destruct the GeometryFactory it points to.
>>Binary operations can be a problem, as you have two geoms with possibly
>>two different factories. I have to say I don't know what should
>>be expected then. Martin should be able to answer, and I can check 
>>that GEOS respect the expected behaviour.
>>
>>--strk;
>>
>>
>>
>>>Steve
>>>
>>>On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:
>>>
>>>
>>>>On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
>>>>
>>>>>Hi Martin: Thanks for the clarification, something to think about
>>>>>anyway. In lieu of a code change at the moment I'll couple the two
>>>>>myself. GEOS Geometry's are buried behind MapServer shapes so the
>>>>>developer/user doesn't see 'em. With MapServer there no logical
>>>>>candidate structure/object to attach the factory to without
>>
>>explicitly
>>
>>>>>creating something new and GEOS specfic. I'd rather not go there.
>>>>>
>>>>>Is the factory object relatively lightweight so that constantly
>>>>>instatiating new objects doesn't hurt performance?
>>>>
>>>>This must be profiled to tell.
>>>>
>>>>The default constructor for a GeometryFactory:
>>>>
>>>>GeometryFactory::GeometryFactory() {
>>>>       precisionModel=new PrecisionModel();
>>>>       SRID=0;
>>>>       
>>>>coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
>>>>}
>>>>
>>>>The default constructor for a PrecisionModel:
>>>>
>>>>PrecisionModel::PrecisionModel(){
>>>>       modelType=FLOATING;
>>>>       scale=1.0;
>>>>}
>>>>
>>>>So it takes 2 ints, 1 double and 2 pointers of size + 3 function
>>>>calls (own and PM ctors and ::instance).
>>>>
>>>>Would it be ok for threading if GEOS provides a
>>>>defaultGeometryFactory ?
>>>>
>>>>--strk;
>>>>
>>>>
>>>>>Steve
>>>>>
>>>>>
>>>>>>>>mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
>>>>>
>>>>>Geometrys need some metadata to allow methods to execute.  This
>>>>>currently includes things like PrecisionModel and SRID (and may grow
>>>>>to
>>>>>include more things in the future).  Rather than duplicate these for
>>>>>every geometry, the GF is referenced by the geometry and shared with
>>>>>any
>>>>>created geometrys.  This works well in the Java world.
>>>>>
>>>>>In the C++ world if this is a problem I guess each Geometry could
>>
>>own
>>
>>>>>its own copy of the GF.  This would require a code change to make
>>>>>Geometrys copy the GF for created Geometrys, rather than keep a
>>>>>reference to it.
>>>>>
>>>>>Martin Davis, Senior Technical Architect
>>>>>Vivid Solutions Inc.      www.vividsolutions.com
>>>>>Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
>>>>>Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
>>>>>
>>>>>
>>>>>
>>>>>>-----Original Message-----
>>>>>>From: geos-devel-bounces@geos.refractions.net
>>>>>>[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of
>>>>>>Steve Lime
>>>>>>Sent: May 11, 2005 9:52 AM
>>>>>>To: geos-devel@geos.refractions.net
>>>>>>Subject: [geos-devel] Question about Geometry and
>>>>>>GeometryFactoryrelationship...
>>>>>>
>>>>>>
>>>>>>Hi All: I'm running into trouble making a clean integration
>>>>>>of GEOS into MapServer. Problem is that GeometryFactory
>>>>>>objects must persist while any Geometry objects spawned from
>>>>>>that factory are in us. This makes it necessary to either use
>>>>>>a global factory which is problematic with theading, or
>>>>>>somehow couple the two so that they are created, persist and
>>>>>>are deleted together. I'm curious why Geometry's cannot
>>>>>>stand-alone? Perhaps I'm missing something obvious in my
>>>>>>implementation.
>>>>>>
>>>>>>Steve
>>>>>>
>>>>>>Stephen Lime
>>>>>>Data & Applications Manager
>>>>>>
>>>>>>Minnesota DNR
>>>>>>500 Lafayette Road
>>>>>>St. Paul, MN 55155
>>>>>>651-297-2937
>>>>>>_______________________________________________
>>>>>>geos-devel mailing list
>>>>>>geos-devel@geos.refractions.net
>>>>>>http://geos.refractions.net/mailman/listinfo/geos-devel
>>>>>>
>>>>>
>>>>>_______________________________________________
>>>>>geos-devel mailing list
>>>>>geos-devel@geos.refractions.net
>>>>>http://geos.refractions.net/mailman/listinfo/geos-devel
>>>>>_______________________________________________
>>>>>geos-devel mailing list
>>>>>geos-devel@geos.refractions.net
>>>>>http://geos.refractions.net/mailman/listinfo/geos-devel
>>>>
>>>>_______________________________________________
>>>>geos-devel mailing list
>>>>geos-devel@geos.refractions.net
>>>>http://geos.refractions.net/mailman/listinfo/geos-devel
>>>>
>>>
>>>_______________________________________________
>>>geos-devel mailing list
>>>geos-devel@geos.refractions.net
>>>http://geos.refractions.net/mailman/listinfo/geos-devel
>>
>>_______________________________________________
>>geos-devel mailing list
>>geos-devel@geos.refractions.net
>>http://geos.refractions.net/mailman/listinfo/geos-devel
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Fri May 13 11:30:05 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Re: WKB parser
In-Reply-To: <1115990063.4284a82f52343@webmail.limegroup.com>
References: <1115990063.4284a82f52343@webmail.limegroup.com>
Message-ID: <20050513153005.GF38872@keybit.net>

On Fri, May 13, 2005 at 09:14:23AM -0400, dblasby@openplans.org wrote:
> strk,
> 
> JTS has an "equalsExact(Geometry,Geometry)" method and a
> "equalsExact(Geometry,Geometry, tolerance)".
> 
> I'm pretty sure that GEOS has at least the former.
> 
> I'm not 100% sure if its 2d or 3d (I assume its 3d, but I could be
> wrong).

I'm making some tests, the tolerance argument is mandatory with
GEOS, but code seems broken (a simple comparison of a point
in and out WKB returns false...).

Anyway, thanks for the point, I'll at least fix that, and
possibly use it for testing WKB.

--strk;

From steve.lime at dnr.state.mn.us  Fri May 13 11:55:15 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry
	and	GeometryFactoryrelationship...
Message-ID: <s28487d7.002@co5.dnr.state.mn.us>

That's certainly easiest, I'll admit I spent a lot of time studying your
postGIS implementation as I did the MapServer stuff and that was your
approach. There are startup and cleanup issues though so you make sure
only one thread can instantiate the factory and that it goes away at
some point (although the amount of memory leaked is pretty small). I've
dropped a note to a few of the threading experts on the MapServer side
for their opinions. I don't think any GEOS changes are warranted...

Steve

>>> chodgson@refractions.net 5/13/2005 9:33:40 AM >>>
Well, if GeometryFactory had any internal state at all, then there
would 
be the risk of two different threads trying to simultaneously access 
and/or modify it. However, since as you say it is read only, then it
may 
be perfectly thread-safe to keep just one of them around and use the 
same one in all threads for all geometries. That would certainly be the

easiest to code, wouldn't it Steve?

Chris

strk@refractions.net wrote:
> On Fri, May 13, 2005 at 08:32:16AM -0500, Steve Lime wrote:
> 
>>Sorry, I was refering to deleting a Geometry and GeometryFactory at
the
>>same time which would cause problems with other Geometry objects
created
>>from one another via buffers, convex hulls or whatever. I have been
>>hanging a Geometry off of a MapServer C shape structure and would
have
>>to include a GeometryFactory as well to avoid threading issues. Each
>>shape would then have its own GeometryFactory which would be deleted
>>when a shape is deleted.
> 
> 
> No, you can't safely destroy the GeometryFactory element of a
> Geometry. Can you tell me more about the issues of keeping
> a single instance of the GeometryFactory ? It is a read-only
> structure (all state defined at construction time).
> 
> --strk;
> 
> 
>>I wish C/C++ was multi-threaded by default with a memory manager but
>>they're not...
>>
>>Steve
>>
>>
>>>>>strk@refractions.net 05/13/05 2:28 AM >>>
>>
>>On Fri, May 13, 2005 at 12:11:57AM -0500, Stephen Lime wrote:
>>
>>>One other question then. Most of the time you need a GeometryFactory

>>>when creating a Geometery, but not always. What happens in the case
of
>>
>>>constructing a buffer?
>>>
>>>e.g.
>>>
>>>  Geometry *bg = g->buffer(width);
>>>
>>>At what GeometryFactory does bg point? The same as g I assume. This

>>>makes my workaround of keeping a GeometryFactory and Geometry
coupled 
>>>together within a MapServer shape kinda difficult, unless there's an

>>>easy way to point a Geometry at another factory of its own.
Otherwise 
>>>if features are deleted in the wrong order they may well take other

>>>features with them.
>>
>>Buffer operation will use factory of input. 
>>Geometry destruction won't destruct the GeometryFactory it points
to.
>>Binary operations can be a problem, as you have two geoms with
possibly
>>two different factories. I have to say I don't know what should
>>be expected then. Martin should be able to answer, and I can check 
>>that GEOS respect the expected behaviour.
>>
>>--strk;
>>
>>
>>
>>>Steve
>>>
>>>On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:
>>>
>>>
>>>>On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
>>>>
>>>>>Hi Martin: Thanks for the clarification, something to think about
>>>>>anyway. In lieu of a code change at the moment I'll couple the
two
>>>>>myself. GEOS Geometry's are buried behind MapServer shapes so the
>>>>>developer/user doesn't see 'em. With MapServer there no logical
>>>>>candidate structure/object to attach the factory to without
>>
>>explicitly
>>
>>>>>creating something new and GEOS specfic. I'd rather not go there.
>>>>>
>>>>>Is the factory object relatively lightweight so that constantly
>>>>>instatiating new objects doesn't hurt performance?
>>>>
>>>>This must be profiled to tell.
>>>>
>>>>The default constructor for a GeometryFactory:
>>>>
>>>>GeometryFactory::GeometryFactory() {
>>>>       precisionModel=new PrecisionModel();
>>>>       SRID=0;
>>>>       
>>>>coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
>>>>}
>>>>
>>>>The default constructor for a PrecisionModel:
>>>>
>>>>PrecisionModel::PrecisionModel(){
>>>>       modelType=FLOATING;
>>>>       scale=1.0;
>>>>}
>>>>
>>>>So it takes 2 ints, 1 double and 2 pointers of size + 3 function
>>>>calls (own and PM ctors and ::instance).
>>>>
>>>>Would it be ok for threading if GEOS provides a
>>>>defaultGeometryFactory ?
>>>>
>>>>--strk;
>>>>
>>>>
>>>>>Steve
>>>>>
>>>>>
>>>>>>>>mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
>>>>>
>>>>>Geometrys need some metadata to allow methods to execute.  This
>>>>>currently includes things like PrecisionModel and SRID (and may
grow
>>>>>to
>>>>>include more things in the future).  Rather than duplicate these
for
>>>>>every geometry, the GF is referenced by the geometry and shared
with
>>>>>any
>>>>>created geometrys.  This works well in the Java world.
>>>>>
>>>>>In the C++ world if this is a problem I guess each Geometry could
>>
>>own
>>
>>>>>its own copy of the GF.  This would require a code change to make
>>>>>Geometrys copy the GF for created Geometrys, rather than keep a
>>>>>reference to it.
>>>>>
>>>>>Martin Davis, Senior Technical Architect
>>>>>Vivid Solutions Inc.      www.vividsolutions.com 
>>>>>Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
>>>>>Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
>>>>>
>>>>>
>>>>>
>>>>>>-----Original Message-----
>>>>>>From: geos-devel-bounces@geos.refractions.net 
>>>>>>[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of
>>>>>>Steve Lime
>>>>>>Sent: May 11, 2005 9:52 AM
>>>>>>To: geos-devel@geos.refractions.net 
>>>>>>Subject: [geos-devel] Question about Geometry and
>>>>>>GeometryFactoryrelationship...
>>>>>>
>>>>>>
>>>>>>Hi All: I'm running into trouble making a clean integration
>>>>>>of GEOS into MapServer. Problem is that GeometryFactory
>>>>>>objects must persist while any Geometry objects spawned from
>>>>>>that factory are in us. This makes it necessary to either use
>>>>>>a global factory which is problematic with theading, or
>>>>>>somehow couple the two so that they are created, persist and
>>>>>>are deleted together. I'm curious why Geometry's cannot
>>>>>>stand-alone? Perhaps I'm missing something obvious in my
>>>>>>implementation.
>>>>>>
>>>>>>Steve
>>>>>>
>>>>>>Stephen Lime
>>>>>>Data & Applications Manager
>>>>>>
>>>>>>Minnesota DNR
>>>>>>500 Lafayette Road
>>>>>>St. Paul, MN 55155
>>>>>>651-297-2937
>>>>>>_______________________________________________
>>>>>>geos-devel mailing list
>>>>>>geos-devel@geos.refractions.net 
>>>>>>http://geos.refractions.net/mailman/listinfo/geos-devel 
>>>>>>
>>>>>
>>>>>_______________________________________________
>>>>>geos-devel mailing list
>>>>>geos-devel@geos.refractions.net 
>>>>>http://geos.refractions.net/mailman/listinfo/geos-devel 
>>>>>_______________________________________________
>>>>>geos-devel mailing list
>>>>>geos-devel@geos.refractions.net 
>>>>>http://geos.refractions.net/mailman/listinfo/geos-devel 
>>>>
>>>>_______________________________________________
>>>>geos-devel mailing list
>>>>geos-devel@geos.refractions.net 
>>>>http://geos.refractions.net/mailman/listinfo/geos-devel 
>>>>
>>>
>>>_______________________________________________
>>>geos-devel mailing list
>>>geos-devel@geos.refractions.net 
>>>http://geos.refractions.net/mailman/listinfo/geos-devel 
>>
>>_______________________________________________
>>geos-devel mailing list
>>geos-devel@geos.refractions.net 
>>http://geos.refractions.net/mailman/listinfo/geos-devel 
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel 
_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net 
http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Fri May 13 12:12:59 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Re: WKB parser
In-Reply-To: <20050513153005.GF38872@keybit.net>
References: <1115990063.4284a82f52343@webmail.limegroup.com>
	<20050513153005.GF38872@keybit.net>
Message-ID: <20050513161258.GB41636@keybit.net>

Martin, I checked out the equalsExact method as suggested
by Dave. It internally calls equals() on Coordinates, which
is again 2D only. Isn't this a conceptual bug since the
metohd is named equalsEXACT ?

Yes, current JTS does the same, it's
Geometry#equal(Coordinate, Coordinate, double)

--strk;

On Fri, May 13, 2005 at 05:30:05PM +0200, strk@refractions.net wrote:
> On Fri, May 13, 2005 at 09:14:23AM -0400, dblasby@openplans.org wrote:
> > strk,
> > 
> > JTS has an "equalsExact(Geometry,Geometry)" method and a
> > "equalsExact(Geometry,Geometry, tolerance)".
> > 
> > I'm pretty sure that GEOS has at least the former.
> > 
> > I'm not 100% sure if its 2d or 3d (I assume its 3d, but I could be
> > wrong).
> 
> I'm making some tests, the tolerance argument is mandatory with
> GEOS, but code seems broken (a simple comparison of a point
> in and out WKB returns false...).
> 
> Anyway, thanks for the point, I'll at least fix that, and
> possibly use it for testing WKB.
> 
> --strk;
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From mbdavis at VividSolutions.com  Fri May 13 14:10:07 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Question about Geometry
	andGeometryFactoryrelationship...
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CE3B@venus.VividSolutions.com>

>Binary operations can be a problem, as you have 
> two geoms with possibly two different factories. 

The JTS convention is to use the geometry of the left hand operand (the
instance the overlay method is run on).

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: geos-devel-bounces@geos.refractions.net 
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> strk@refractions.net
> Sent: May 13, 2005 12:29 AM
> To: GEOS Development List
> Subject: Re: [geos-devel] Question about Geometry 
> andGeometryFactoryrelationship...
> 
> 
> On Fri, May 13, 2005 at 12:11:57AM -0500, Stephen Lime wrote:
> > One other question then. Most of the time you need a GeometryFactory
> > when creating a Geometery, but not always. What happens in 
> the case of 
> > constructing a buffer?
> > 
> > e.g.
> > 
> >   Geometry *bg = g->buffer(width);
> > 
> > At what GeometryFactory does bg point? The same as g I assume. This
> > makes my workaround of keeping a GeometryFactory and 
> Geometry coupled 
> > together within a MapServer shape kinda difficult, unless 
> there's an 
> > easy way to point a Geometry at another factory of its own. 
> Otherwise 
> > if features are deleted in the wrong order they may well take other 
> > features with them.
> 
> Buffer operation will use factory of input. 
> Geometry destruction won't destruct the GeometryFactory it 
> points to. Binary operations can be a problem, as you have 
> two geoms with possibly two different factories. I have to 
> say I don't know what should be expected then. Martin should 
> be able to answer, and I can check 
> that GEOS respect the expected behaviour.
> 
> --strk;
> 
> 
> > 
> > Steve
> > 
> > On May 11, 2005, at 5:20 PM, strk@refractions.net wrote:
> > 
> > >On Wed, May 11, 2005 at 12:21:05PM -0500, Steve Lime wrote:
> > >>Hi Martin: Thanks for the clarification, something to think about 
> > >>anyway. In lieu of a code change at the moment I'll 
> couple the two 
> > >>myself. GEOS Geometry's are buried behind MapServer shapes so the 
> > >>developer/user doesn't see 'em. With MapServer there no logical 
> > >>candidate structure/object to attach the factory to without 
> > >>explicitly creating something new and GEOS specfic. I'd 
> rather not 
> > >>go there.
> > >>
> > >>Is the factory object relatively lightweight so that constantly 
> > >>instatiating new objects doesn't hurt performance?
> > >
> > >This must be profiled to tell.
> > >
> > >The default constructor for a GeometryFactory:
> > >
> > >GeometryFactory::GeometryFactory() {
> > >        precisionModel=new PrecisionModel();
> > >        SRID=0;
> > >        
> > >coordinateListFactory=DefaultCoordinateSequenceFactory::instance();
> > >}
> > >
> > >The default constructor for a PrecisionModel:
> > >
> > >PrecisionModel::PrecisionModel(){
> > >        modelType=FLOATING;
> > >        scale=1.0;
> > >}
> > >
> > >So it takes 2 ints, 1 double and 2 pointers of size + 3 function 
> > >calls (own and PM ctors and ::instance).
> > >
> > >Would it be ok for threading if GEOS provides a 
> > >defaultGeometryFactory ?
> > >
> > >--strk;
> > >
> > >>
> > >>Steve
> > >>
> > >>>>>mbdavis@VividSolutions.com 5/11/2005 12:02:18 PM >>>
> > >>Geometrys need some metadata to allow methods to execute.  This 
> > >>currently includes things like PrecisionModel and SRID 
> (and may grow 
> > >>to include more things in the future).  Rather than 
> duplicate these 
> > >>for every geometry, the GF is referenced by the geometry 
> and shared 
> > >>with any
> > >>created geometrys.  This works well in the Java world.
> > >>
> > >>In the C++ world if this is a problem I guess each Geometry could 
> > >>own its own copy of the GF.  This would require a code change to 
> > >>make Geometrys copy the GF for created Geometrys, rather 
> than keep a 
> > >>reference to it.
> > >>
> > >>Martin Davis, Senior Technical Architect
> > >>Vivid Solutions Inc.      www.vividsolutions.com
> > >>Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> > >>Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> > >>
> > >>
> > >>>-----Original Message-----
> > >>>From: geos-devel-bounces@geos.refractions.net
> > >>>[mailto:geos-devel-bounces@geos.refractions.net] On 
> Behalf Of Steve 
> > >>>Lime
> > >>>Sent: May 11, 2005 9:52 AM
> > >>>To: geos-devel@geos.refractions.net
> > >>>Subject: [geos-devel] Question about Geometry and 
> > >>>GeometryFactoryrelationship...
> > >>>
> > >>>
> > >>>Hi All: I'm running into trouble making a clean 
> integration of GEOS 
> > >>>into MapServer. Problem is that GeometryFactory objects must 
> > >>>persist while any Geometry objects spawned from that 
> factory are in 
> > >>>us. This makes it necessary to either use a global 
> factory which is 
> > >>>problematic with theading, or somehow couple the two so 
> that they 
> > >>>are created, persist and are deleted together. I'm curious why 
> > >>>Geometry's cannot stand-alone? Perhaps I'm missing something 
> > >>>obvious in my implementation.
> > >>>
> > >>>Steve
> > >>>
> > >>>Stephen Lime
> > >>>Data & Applications Manager
> > >>>
> > >>>Minnesota DNR
> > >>>500 Lafayette Road
> > >>>St. Paul, MN 55155
> > >>>651-297-2937 _______________________________________________
> > >>>geos-devel mailing list
> > >>>geos-devel@geos.refractions.net
> > >>>http://geos.refractions.net/mailman/listinfo/geos-devel
> > >>>
> > >>_______________________________________________
> > >>geos-devel mailing list
> > >>geos-devel@geos.refractions.net 
> > >>http://geos.refractions.net/mailman/listinfo/geos-devel
> > >>_______________________________________________
> > >>geos-devel mailing list
> > >>geos-devel@geos.refractions.net 
> > >>http://geos.refractions.net/mailman/listinfo/geos-devel
> > >_______________________________________________
> > >geos-devel mailing list
> > >geos-devel@geos.refractions.net 
> > >http://geos.refractions.net/mailman/listinfo/geos-devel
> > >
> > 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel
> 

From mbdavis at VividSolutions.com  Fri May 13 15:51:45 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Re: WKB parser
Message-ID: <5A94289A9268514C8D6C0F1FF44BA0279C3D8A@venus.VividSolutions.com>

JTS is basically a 2D system.  For that reason the equality methods just
check the 2D values.  I agree this is an issue for checking 3D data.  I
guess we could have an equalsExact3D to take care of this.  But to my
mind this is starting to get a bit crufty.  

With the proving-out of user-defined CoordinateSequences, the new "zen"
of JTS which I am following is that JTS is basically 2D, but users can
provide CoordinateSequences which contain extra information at each
point.  Given this, what JTS methods need to do is let the user define
the behaviour of CoordinateSequences.  In the case of equality testing,
this means they have to define CoordinateSequence equality.  This is the
approach I have taken in the unit test code for WKB I/O.  I have defined
a Geometry#compareTo(Object, CoordinateSequenceComparator) method, which
lets the user say how CoordinateSequences should compare.  And I've
provided an implementation of CoordinateSequenceComparator which allows
specifying how many dimensions should be compared.  This lets me use
existing Coordinate objects and compare them across 2 or 3 dimensions.

Comments?  Does this design solve the problem?

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: strk@refractions.net [mailto:strk@refractions.net] 
> Sent: May 13, 2005 9:13 AM
> To: geos-devel@geos.refractions.net
> Cc: Martin Davis
> Subject: Re: [geos-devel] Re: WKB parser
> 
> 
> Martin, I checked out the equalsExact method as suggested
> by Dave. It internally calls equals() on Coordinates, which
> is again 2D only. Isn't this a conceptual bug since the
> metohd is named equalsEXACT ?
> 
> Yes, current JTS does the same, it's
> Geometry#equal(Coordinate, Coordinate, double)
> 
> --strk;
> 
> On Fri, May 13, 2005 at 05:30:05PM +0200, strk@refractions.net wrote:
> > On Fri, May 13, 2005 at 09:14:23AM -0400, 
> dblasby@openplans.org wrote:
> > > strk,
> > > 
> > > JTS has an "equalsExact(Geometry,Geometry)" method and a 
> > > "equalsExact(Geometry,Geometry, tolerance)".
> > > 
> > > I'm pretty sure that GEOS has at least the former.
> > > 
> > > I'm not 100% sure if its 2d or 3d (I assume its 3d, but I 
> could be 
> > > wrong).
> > 
> > I'm making some tests, the tolerance argument is mandatory 
> with GEOS, 
> > but code seems broken (a simple comparison of a point in 
> and out WKB 
> > returns false...).
> > 
> > Anyway, thanks for the point, I'll at least fix that, and 
> possibly use 
> > it for testing WKB.
> > 
> > --strk;
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> 

From strk at refractions.net  Sat May 14 04:31:48 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Re: WKB parser
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA0279C3D8A@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA0279C3D8A@venus.VividSolutions.com>
Message-ID: <20050514083148.GC50626@keybit.net>

On Fri, May 13, 2005 at 12:51:45PM -0700, Martin Davis wrote:
> JTS is basically a 2D system.  For that reason the equality methods just
> check the 2D values.  I agree this is an issue for checking 3D data.  I
> guess we could have an equalsExact3D to take care of this.  But to my
> mind this is starting to get a bit crufty.  
> 
> With the proving-out of user-defined CoordinateSequences, the new "zen"
> of JTS which I am following is that JTS is basically 2D, but users can
> provide CoordinateSequences which contain extra information at each
> point.  Given this, what JTS methods need to do is let the user define
> the behaviour of CoordinateSequences.  In the case of equality testing,
> this means they have to define CoordinateSequence equality.  This is the
> approach I have taken in the unit test code for WKB I/O.  I have defined
> a Geometry#compareTo(Object, CoordinateSequenceComparator) method, which
> lets the user say how CoordinateSequences should compare.  And I've
> provided an implementation of CoordinateSequenceComparator which allows
> specifying how many dimensions should be compared.  This lets me use
> existing Coordinate objects and compare them across 2 or 3 dimensions.
> 
> Comments?  Does this design solve the problem?

I think it will solve it, yes.
But I think all this flexibility will slow down things more.
Yes, it depends on actual implementation... I'll see how to handle
it.

--strk;

> 
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 
> > -----Original Message-----
> > From: strk@refractions.net [mailto:strk@refractions.net] 
> > Sent: May 13, 2005 9:13 AM
> > To: geos-devel@geos.refractions.net
> > Cc: Martin Davis
> > Subject: Re: [geos-devel] Re: WKB parser
> > 
> > 
> > Martin, I checked out the equalsExact method as suggested
> > by Dave. It internally calls equals() on Coordinates, which
> > is again 2D only. Isn't this a conceptual bug since the
> > metohd is named equalsEXACT ?
> > 
> > Yes, current JTS does the same, it's
> > Geometry#equal(Coordinate, Coordinate, double)
> > 
> > --strk;
> > 
> > On Fri, May 13, 2005 at 05:30:05PM +0200, strk@refractions.net wrote:
> > > On Fri, May 13, 2005 at 09:14:23AM -0400, 
> > dblasby@openplans.org wrote:
> > > > strk,
> > > > 
> > > > JTS has an "equalsExact(Geometry,Geometry)" method and a 
> > > > "equalsExact(Geometry,Geometry, tolerance)".
> > > > 
> > > > I'm pretty sure that GEOS has at least the former.
> > > > 
> > > > I'm not 100% sure if its 2d or 3d (I assume its 3d, but I 
> > could be 
> > > > wrong).
> > > 
> > > I'm making some tests, the tolerance argument is mandatory 
> > with GEOS, 
> > > but code seems broken (a simple comparison of a point in 
> > and out WKB 
> > > returns false...).
> > > 
> > > Anyway, thanks for the point, I'll at least fix that, and 
> > possibly use 
> > > it for testing WKB.
> > > 
> > > --strk;
> > > _______________________________________________
> > > geos-devel mailing list
> > > geos-devel@geos.refractions.net 
> > > http://geos.refractions.net/mailman/listinfo/geos-devel
> > 

From steve.lime at dnr.state.mn.us  Tue May 17 02:02:58 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
Message-ID: <s28942ce.034@co5.dnr.state.mn.us>

Hi All: I'm wondering if someone can confirm that buffering a
multipolygon works with GEOS 2.1.1. I'm testing my conversion code and
am having problems with just this case: simple polgons with/without
holes work fine, anything with multiple outer rings does not (bus error
on Mac OS). The conversion code must be close because computing a convex
hull on the same test shape works fine.

I've attached a small graphic that shows the multipolygon (with GEOS
computed convext hull)...

Steve
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.gif
Type: image/gif
Size: 2000 bytes
Desc: CompuServe GIF graphic
Url : http://lists.osgeo.org/pipermail/geos-devel/attachments/20050517/705477ac/test.gif
From strk at refractions.net  Tue May 17 02:33:34 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <s28942ce.034@co5.dnr.state.mn.us>
References: <s28942ce.034@co5.dnr.state.mn.us>
Message-ID: <20050517063334.GA78313@keybit.net>

If you send a small script we can test it.
--strk;

On Tue, May 17, 2005 at 01:02:58AM -0500, Steve Lime wrote:
> Hi All: I'm wondering if someone can confirm that buffering a
> multipolygon works with GEOS 2.1.1. I'm testing my conversion code and
> am having problems with just this case: simple polgons with/without
> holes work fine, anything with multiple outer rings does not (bus error
> on Mac OS). The conversion code must be close because computing a convex
> hull on the same test shape works fine.
> 
> I've attached a small graphic that shows the multipolygon (with GEOS
> computed convext hull)...
> 
> Steve


> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel


From steve.lime at dnr.state.mn.us  Tue May 17 09:19:05 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
Message-ID: <s289a926.002@co5.dnr.state.mn.us>

What flavor of script or test data? Do you really want a perl/mapscript
script?

>>> strk@refractions.net 05/17/05 1:33 AM >>>
If you send a small script we can test it.
--strk;

On Tue, May 17, 2005 at 01:02:58AM -0500, Steve Lime wrote:
> Hi All: I'm wondering if someone can confirm that buffering a
> multipolygon works with GEOS 2.1.1. I'm testing my conversion code and
> am having problems with just this case: simple polgons with/without
> holes work fine, anything with multiple outer rings does not (bus
error
> on Mac OS). The conversion code must be close because computing a
convex
> hull on the same test shape works fine.
> 
> I've attached a small graphic that shows the multipolygon (with GEOS
> computed convext hull)...
> 
> Steve


> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net
http://geos.refractions.net/mailman/listinfo/geos-devel


From steve.lime at dnr.state.mn.us  Tue May 17 09:19:06 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
Message-ID: <s289a926.001@co5.dnr.state.mn.us>

What flavor of script or test data? Do you really want a perl/mapscript
script?

>>> strk@refractions.net 05/17/05 1:33 AM >>>
If you send a small script we can test it.
--strk;

On Tue, May 17, 2005 at 01:02:58AM -0500, Steve Lime wrote:
> Hi All: I'm wondering if someone can confirm that buffering a
> multipolygon works with GEOS 2.1.1. I'm testing my conversion code and
> am having problems with just this case: simple polgons with/without
> holes work fine, anything with multiple outer rings does not (bus
error
> on Mac OS). The conversion code must be close because computing a
convex
> hull on the same test shape works fine.
> 
> I've attached a small graphic that shows the multipolygon (with GEOS
> computed convext hull)...
> 
> Steve


> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net
http://geos.refractions.net/mailman/listinfo/geos-devel


From strk at refractions.net  Tue May 17 12:05:50 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <s289a926.001@co5.dnr.state.mn.us>
References: <s289a926.001@co5.dnr.state.mn.us>
Message-ID: <20050517160550.GC81242@keybit.net>

On Tue, May 17, 2005 at 08:19:06AM -0500, Steve Lime wrote:
> What flavor of script or test data? Do you really want a perl/mapscript
> script?

No, just an .sql script containing table creation, data load (WKT geoms)
and the failing call to GeomUnion(). The dataset should be the
smallest possible reproducing the problem.

--strk;

> 
> >>> strk@refractions.net 05/17/05 1:33 AM >>>
> If you send a small script we can test it.
> --strk;
> 
> On Tue, May 17, 2005 at 01:02:58AM -0500, Steve Lime wrote:
> > Hi All: I'm wondering if someone can confirm that buffering a
> > multipolygon works with GEOS 2.1.1. I'm testing my conversion code and
> > am having problems with just this case: simple polgons with/without
> > holes work fine, anything with multiple outer rings does not (bus
> error
> > on Mac OS). The conversion code must be close because computing a
> convex
> > hull on the same test shape works fine.
> > 
> > I've attached a small graphic that shows the multipolygon (with GEOS
> > computed convext hull)...
> > 
> > Steve
> 
> 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From chodgson at refractions.net  Tue May 17 12:36:06 2005
From: chodgson at refractions.net (Chris Hodgson)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <s28942ce.034@co5.dnr.state.mn.us>
References: <s28942ce.034@co5.dnr.state.mn.us>
Message-ID: <428A1D76.9050202@refractions.net>

I think Martin Davis is off on holidays, so I will offer this tidbit - I 
do recall that some JTS operations (union/intersection come to mind) do 
NOT work on multi-polygons. I wouldn't be surprised if buffer was also 
one of these operations.

The only convex hull algorithm I know works on a set of points, if a 
similar one is used in JTS then it probably would work on any type of 
shape, (even multi-*) because you would just break it down into the 
constituent points.

My best bet is that you're code is right Steve - if you can buffer 
regular polygons, and you can convex hull multi-polygons, then it seems 
more likely to me that buffering multi's just doesn't work than it is 
that there is some special case not being handled in your code :)

Chris

Steve Lime wrote:
> Hi All: I'm wondering if someone can confirm that buffering a
> multipolygon works with GEOS 2.1.1. I'm testing my conversion code and
> am having problems with just this case: simple polgons with/without
> holes work fine, anything with multiple outer rings does not (bus error
> on Mac OS). The conversion code must be close because computing a convex
> hull on the same test shape works fine.
> 
> I've attached a small graphic that shows the multipolygon (with GEOS
> computed convext hull)...
> 
> Steve
> 
> 
> ------------------------------------------------------------------------
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From mbdavis at VividSolutions.com  Tue May 17 13:46:37 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
Message-ID: <5A94289A9268514C8D6C0F1FF44BA02796CE65@venus.VividSolutions.com>

Nope, I'm still here... for a couple more days.

In JTS buffer works on *everything*, including MultiPolygons.  So this
might be a bug in GEOS.

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: geos-devel-bounces@geos.refractions.net 
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> Chris Hodgson
> Sent: May 17, 2005 9:36 AM
> To: GEOS Development List
> Subject: Re: [geos-devel] Buffering Multipolygons
> 
> 
> I think Martin Davis is off on holidays, so I will offer this 
> tidbit - I 
> do recall that some JTS operations (union/intersection come 
> to mind) do 
> NOT work on multi-polygons. I wouldn't be surprised if buffer 
> was also 
> one of these operations.
> 
> The only convex hull algorithm I know works on a set of points, if a 
> similar one is used in JTS then it probably would work on any type of 
> shape, (even multi-*) because you would just break it down into the 
> constituent points.
> 
> My best bet is that you're code is right Steve - if you can buffer 
> regular polygons, and you can convex hull multi-polygons, 
> then it seems 
> more likely to me that buffering multi's just doesn't work than it is 
> that there is some special case not being handled in your code :)
> 
> Chris
> 
> Steve Lime wrote:
> > Hi All: I'm wondering if someone can confirm that buffering a 
> > multipolygon works with GEOS 2.1.1. I'm testing my 
> conversion code and 
> > am having problems with just this case: simple polgons with/without 
> > holes work fine, anything with multiple outer rings does not (bus 
> > error on Mac OS). The conversion code must be close because 
> computing 
> > a convex hull on the same test shape works fine.
> > 
> > I've attached a small graphic that shows the multipolygon 
> (with GEOS 
> > computed convext hull)...
> > 
> > Steve
> > 
> > 
> > 
> ----------------------------------------------------------------------
> > --
> > 
> > 
> > 
> ----------------------------------------------------------------------
> > --
> > 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel
> 

From strk at refractions.net  Tue May 17 15:47:05 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <20050517160550.GC81242@keybit.net>
References: <s289a926.001@co5.dnr.state.mn.us>
	<20050517160550.GC81242@keybit.net>
Message-ID: <20050517194705.GA83242@keybit.net>

On Tue, May 17, 2005 at 06:05:50PM +0200, strk@refractions.net wrote:
> On Tue, May 17, 2005 at 08:19:06AM -0500, Steve Lime wrote:
> > What flavor of script or test data? Do you really want a perl/mapscript
> > script?
> 
> No, just an .sql script containing table creation, data load (WKT geoms)
> and the failing call to GeomUnion(). The dataset should be the
> smallest possible reproducing the problem.

Err.. sorry, the call is to buffer() not to GeomUnion,
so a single command should be able to show the problem and let us
test it on other versions.
Something like:
 select buffer('MULTIPOLYGON...', #);

--strk;

> 
> --strk;
> 
> > 
> > >>> strk@refractions.net 05/17/05 1:33 AM >>>
> > If you send a small script we can test it.
> > --strk;
> > 
> > On Tue, May 17, 2005 at 01:02:58AM -0500, Steve Lime wrote:
> > > Hi All: I'm wondering if someone can confirm that buffering a
> > > multipolygon works with GEOS 2.1.1. I'm testing my conversion code and
> > > am having problems with just this case: simple polgons with/without
> > > holes work fine, anything with multiple outer rings does not (bus
> > error
> > > on Mac OS). The conversion code must be close because computing a
> > convex
> > > hull on the same test shape works fine.
> > > 
> > > I've attached a small graphic that shows the multipolygon (with GEOS
> > > computed convext hull)...
> > > 
> > > Steve
> > 
> > 
> > > _______________________________________________
> > > geos-devel mailing list
> > > geos-devel@geos.refractions.net
> > > http://geos.refractions.net/mailman/listinfo/geos-devel
> > 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> > 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From sdlime at comcast.net  Wed May 18 00:33:27 2005
From: sdlime at comcast.net (Stephen Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <20050517194705.GA83242@keybit.net>
References: <s289a926.001@co5.dnr.state.mn.us>
	<20050517160550.GC81242@keybit.net>
	<20050517194705.GA83242@keybit.net>
Message-ID: <710fa2476708be578b1e73bee90debe2@comcast.net>

Sorry, not a regular  PostGIS user I'm afraid to say. Here's a simple 
WKT mutipolygon though:

   MULTIPOLYGON(((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 
60, 60 60 )))

Steve

On May 17, 2005, at 2:47 PM, strk@refractions.net wrote:

> On Tue, May 17, 2005 at 06:05:50PM +0200, strk@refractions.net wrote:
>> On Tue, May 17, 2005 at 08:19:06AM -0500, Steve Lime wrote:
>>> What flavor of script or test data? Do you really want a 
>>> perl/mapscript
>>> script?
>>
>> No, just an .sql script containing table creation, data load (WKT 
>> geoms)
>> and the failing call to GeomUnion(). The dataset should be the
>> smallest possible reproducing the problem.
>
> Err.. sorry, the call is to buffer() not to GeomUnion,
> so a single command should be able to show the problem and let us
> test it on other versions.
> Something like:
>  select buffer('MULTIPOLYGON...', #);
>
> --strk;
>
>>
>> --strk;
>>
>>>
>>>>>> strk@refractions.net 05/17/05 1:33 AM >>>
>>> If you send a small script we can test it.
>>> --strk;
>>>
>>> On Tue, May 17, 2005 at 01:02:58AM -0500, Steve Lime wrote:
>>>> Hi All: I'm wondering if someone can confirm that buffering a
>>>> multipolygon works with GEOS 2.1.1. I'm testing my conversion code 
>>>> and
>>>> am having problems with just this case: simple polgons with/without
>>>> holes work fine, anything with multiple outer rings does not (bus
>>> error
>>>> on Mac OS). The conversion code must be close because computing a
>>> convex
>>>> hull on the same test shape works fine.
>>>>
>>>> I've attached a small graphic that shows the multipolygon (with GEOS
>>>> computed convext hull)...
>>>>
>>>> Steve
>>>
>>>
>>>> _______________________________________________
>>>> geos-devel mailing list
>>>> geos-devel@geos.refractions.net
>>>> http://geos.refractions.net/mailman/listinfo/geos-devel
>>>
>>> _______________________________________________
>>> geos-devel mailing list
>>> geos-devel@geos.refractions.net
>>> http://geos.refractions.net/mailman/listinfo/geos-devel
>>>
>>> _______________________________________________
>>> geos-devel mailing list
>>> geos-devel@geos.refractions.net
>>> http://geos.refractions.net/mailman/listinfo/geos-devel
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@geos.refractions.net
>> http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/enriched
Size: 2716 bytes
Desc: not available
Url : http://lists.osgeo.org/pipermail/geos-devel/attachments/20050517/941eb3a0/attachment.bin
From strk at refractions.net  Wed May 18 04:28:35 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <710fa2476708be578b1e73bee90debe2@comcast.net>
References: <s289a926.001@co5.dnr.state.mn.us>
	<20050517160550.GC81242@keybit.net>
	<20050517194705.GA83242@keybit.net>
	<710fa2476708be578b1e73bee90debe2@comcast.net>
Message-ID: <20050518082835.GA84946@keybit.net>

On Tue, May 17, 2005 at 11:33:27PM -0500, Stephen Lime wrote:
> Sorry, not a regular  PostGIS user I'm afraid to say. Here's a simple 
> WKT mutipolygon though: 
> 
>   MULTIPOLYGON(((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 
> 60, 60 60 ))) 
> 
> Steve 

=# select astext(buffer('MULTIPOLYGON(((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60 )))', 0));
              astext
-----------------------------------
 POLYGON((60 60,80 60,70 7,60 60))
(1 row)

=# select postgis_geos_version();
 postgis_geos_version
----------------------
 3.0.0
(1 row)

Is the result correct ?
3.0.0 is the CVS version (next release).

--strk;

> 
> On May 17, 2005, at 2:47 PM, strk@refractions.net wrote: 
> 
> 
> > On Tue, May 17, 2005 at 06:05:50PM +0200, strk@refractions.net 
> > wrote: 
> > 
> > > On Tue, May 17, 2005 at 08:19:06AM -0500, Steve Lime wrote: 
> > > 
> > > > What flavor of script or test data? Do you really want a 
> > > > perl/mapscript 
> > > > script? 
> > > > 
> > >  
> > > No, just an .sql script containing table creation, data load (WKT 
> > > geoms) 
> > > and the failing call to GeomUnion(). The dataset should be the 
> > > smallest possible reproducing the problem. 
> > > 
> >  
> > Err.. sorry, the call is to buffer() not to GeomUnion, 
> > so a single command should be able to show the problem and let us 
> > test it on other versions. 
> > Something like: 
> >  select buffer('MULTIPOLYGON...', #); 
> > 
> > --strk; 
> > 
> > 
> > >  
> > > --strk; 
> > > 
> > > 
> > > >  
> > > > 
> > > > > 
> > > > > > 
> > > > > > > strk@refractions.net 05/17/05 1:33 AM >>> 
> > > > > > > 
> > > > > > 
> > > > > 
> > > > If you send a small script we can test it. 
> > > > --strk; 
> > > > 
> > > > On Tue, May 17, 2005 at 01:02:58AM -0500, Steve Lime wrote: 
> > > > 
> > > > > Hi All: I'm wondering if someone can confirm that buffering a 
> > > > > multipolygon works with GEOS 2.1.1. I'm testing my conversion 
> > > > > code and 
> > > > > am having problems with just this case: simple polgons 
> > > > > with/without 
> > > > > holes work fine, anything with multiple outer rings does not 
> > > > > (bus 
> > > > > 
> > > > error 
> > > > 
> > > > > on Mac OS). The conversion code must be close because 
> > > > > computing a 
> > > > > 
> > > > convex 
> > > > 
> > > > > hull on the same test shape works fine. 
> > > > > 
> > > > > I've attached a small graphic that shows the multipolygon 
> > > > > (with GEOS 
> > > > > computed convext hull)... 
> > > > > 
> > > > > Steve 
> > > > > 
> > > >  
> > > > 
> > > > 
> > > > > _______________________________________________ 
> > > > > geos-devel mailing list 
> > > > > geos-devel@geos.refractions.net 
> > > > > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > > > > 
> > > >  
> > > > _______________________________________________ 
> > > > geos-devel mailing list 
> > > > geos-devel@geos.refractions.net 
> > > > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > > > 
> > > > _______________________________________________ 
> > > > geos-devel mailing list 
> > > > geos-devel@geos.refractions.net 
> > > > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > > > 
> > > _______________________________________________ 
> > > geos-devel mailing list 
> > > geos-devel@geos.refractions.net 
> > > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > > 
> > _______________________________________________ 
> > geos-devel mailing list 
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > 
> > 
> 
> 

> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel


From dblasby at openplans.org  Wed May 18 09:08:23 2005
From: dblasby at openplans.org (dblasby@openplans.org)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
Message-ID: <1116421703.428b3e47b130f@webmail.limegroup.com>

buffering this in JUMP (using JTS), works fine.

-->
MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
  ((60 60, 70 7, 80 60, 60 60)))

strk; your result is not correct.  You've lost the 1st polygon!

Attached picture -- the (10 10) polygon is the one on the left.

Since these polygons are disjoint, buffer(0) shouldnt do anything.

dave





----------------------------------------------------------
This mail sent through IMP: https://webmail.limegroup.com/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: buff1.gif
Type: image/gif
Size: 25674 bytes
Desc: not available
Url : http://lists.osgeo.org/pipermail/geos-devel/attachments/20050518/aa42d9db/buff1.gif
From strk at refractions.net  Wed May 18 13:52:09 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <1116421703.428b3e47b130f@webmail.limegroup.com>
References: <1116421703.428b3e47b130f@webmail.limegroup.com>
Message-ID: <20050518175209.GB94814@keybit.net>

On Wed, May 18, 2005 at 09:08:23AM -0400, dblasby@openplans.org wrote:
> buffering this in JUMP (using JTS), works fine.
> 
> -->
> MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
>   ((60 60, 70 7, 80 60, 60 60)))
> 
> strk; your result is not correct.  You've lost the 1st polygon!

You're right! I've verified geos-1.0.0 not having this problem.
I'll check out 2.0.0 and up and see what broke this.
I'll add a test in testLeaksBig.xml for this as well.
Following is the XML test (parametrized buffer argument will only work
with GEOS CVS, other versions will use 10 as argument instead of arg3):

<run>
  <precisionModel type="FLOATING"/>


<case>
  <desc>Multipolygon buffering</desc>
  <a>MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))</a>
<test>
  <op name="buffer" arg1="a" arg3="0">
  	MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))
  </op>
</test>
</case>


</run>


--strk;

From strk at refractions.net  Thu May 19 02:48:13 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <20050518175209.GB94814@keybit.net>
References: <1116421703.428b3e47b130f@webmail.limegroup.com>
	<20050518175209.GB94814@keybit.net>
Message-ID: <20050519064813.GC490@keybit.net>

Found out that geos-2.0.0 already has this bug.

It seems related to vertex order. If you swap vertex order
of second shell result is correct:

  <a>
MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
	((60 60, 80 60, 70 7, 60 60)))
  </a>

Martin, where should vertex order be enforced ?

--strk;


On Wed, May 18, 2005 at 07:52:09PM +0200, strk@refractions.net wrote:
> On Wed, May 18, 2005 at 09:08:23AM -0400, dblasby@openplans.org wrote:
> > buffering this in JUMP (using JTS), works fine.
> > 
> > -->
> > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> >   ((60 60, 70 7, 80 60, 60 60)))
> > 
> > strk; your result is not correct.  You've lost the 1st polygon!
> 
> You're right! I've verified geos-1.0.0 not having this problem.
> I'll check out 2.0.0 and up and see what broke this.
> I'll add a test in testLeaksBig.xml for this as well.
> Following is the XML test (parametrized buffer argument will only work
> with GEOS CVS, other versions will use 10 as argument instead of arg3):
> 
> <run>
>   <precisionModel type="FLOATING"/>
> 
> 
> <case>
>   <desc>Multipolygon buffering</desc>
>   <a>MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))</a>
> <test>
>   <op name="buffer" arg1="a" arg3="0">
>   	MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))
>   </op>
> </test>
> </case>
> 
> 
> </run>
> 
> 
> --strk;
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Thu May 19 03:39:05 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] CGAlgoritms singleton
Message-ID: <20050519073905.GA1198@keybit.net>

Hunting for the multipolygon buffer bug I've seen one of
multiple places where CGAlgoritms class is instanciated.
Apart from high paranoia due to Robust/NonRobust implementation
(actually marked as obsoleted in GEOS) I don't really 
understand if we really have a need to instantiate that
class multiple time.

Wouldn't it be smarter to make it a Singleton and
store reference to it in the different classes ?

(the instance I'm talking about is in OffsetCurveSetBuilder.cpp,
but I recall to have seen many others around)

--strk;

From strk at refractions.net  Thu May 19 03:41:59 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] CGAlgoritms singleton
In-Reply-To: <20050519073905.GA1198@keybit.net>
References: <20050519073905.GA1198@keybit.net>
Message-ID: <20050519074158.GB1198@keybit.net>

Actually, if there's no state, why not using a namespace instead ?

--strk;

On Thu, May 19, 2005 at 09:39:05AM +0200, strk@refractions.net wrote:
> Hunting for the multipolygon buffer bug I've seen one of
> multiple places where CGAlgoritms class is instanciated.
> Apart from high paranoia due to Robust/NonRobust implementation
> (actually marked as obsoleted in GEOS) I don't really 
> understand if we really have a need to instantiate that
> class multiple time.
> 
> Wouldn't it be smarter to make it a Singleton and
> store reference to it in the different classes ?
> 
> (the instance I'm talking about is in OffsetCurveSetBuilder.cpp,
> but I recall to have seen many others around)
> 
> --strk;
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From paul at toolscenter.org  Thu May 19 04:41:53 2005
From: paul at toolscenter.org (Paul Selormey)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] CGAlgoritms singleton
In-Reply-To: <20050519074158.GB1198@keybit.net>
Message-ID: <20050519084159.9E8D52C0830@netnation.refractions.net>

The new JTS simply uses static methods, hope you have seen that too.

Best regards,
Paul. 

> -----Original Message-----
> From: geos-devel-bounces@geos.refractions.net 
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> strk@refractions.net
> Sent: Thursday, May 19, 2005 4:42 PM
> To: geos-devel@geos.refractions.net
> Subject: Re: [geos-devel] CGAlgoritms singleton
> 
> Actually, if there's no state, why not using a namespace instead ?
> 
> --strk;
> 
> On Thu, May 19, 2005 at 09:39:05AM +0200, strk@refractions.net wrote:
> > Hunting for the multipolygon buffer bug I've seen one of multiple 
> > places where CGAlgoritms class is instanciated.
> > Apart from high paranoia due to Robust/NonRobust implementation 
> > (actually marked as obsoleted in GEOS) I don't really 
> understand if we 
> > really have a need to instantiate that class multiple time.
> > 
> > Wouldn't it be smarter to make it a Singleton and store 
> reference to 
> > it in the different classes ?
> > 
> > (the instance I'm talking about is in 
> OffsetCurveSetBuilder.cpp, but I 
> > recall to have seen many others around)
> > 
> > --strk;
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
> 
> 



From strk at refractions.net  Thu May 19 04:46:59 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] CGAlgoritms singleton
In-Reply-To: <20050519084159.9E8D52C0830@netnation.refractions.net>
References: <20050519074158.GB1198@keybit.net>
	<20050519084159.9E8D52C0830@netnation.refractions.net>
Message-ID: <20050519084659.GA1683@keybit.net>

On Thu, May 19, 2005 at 05:41:53PM +0900, Paul Selormey wrote:
> The new JTS simply uses static methods, hope you have seen that too.

Yes, that's why I'm asking. I'm trying to keep the code
simple to maintain and I don't like all these CGAlgorithms
pointers passing around with really no reason. Note that
often these pointers are instantiated at class instantiation
time.

I'm now working on changing all CGAltorithms access using
fully qualified paths and making CGAlgorithms pointer arguments
optional (and unused if provided). This would reduce flexibility
as users won't be able to pass in another implementation
of CGAlgorithms, but this flexibility was already broken in 
GEOS (not all classes using do accept it as argument).

Since GEOS is free software recompiling sources should not
be a problem in case we find improved algorithms. This is
what happened already between NonRobust and Robust algos...

Comments ?

--strk;


> 
> Best regards,
> Paul. 
> 
> > -----Original Message-----
> > From: geos-devel-bounces@geos.refractions.net 
> > [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> > strk@refractions.net
> > Sent: Thursday, May 19, 2005 4:42 PM
> > To: geos-devel@geos.refractions.net
> > Subject: Re: [geos-devel] CGAlgoritms singleton
> > 
> > Actually, if there's no state, why not using a namespace instead ?
> > 
> > --strk;
> > 
> > On Thu, May 19, 2005 at 09:39:05AM +0200, strk@refractions.net wrote:
> > > Hunting for the multipolygon buffer bug I've seen one of multiple 
> > > places where CGAlgoritms class is instanciated.
> > > Apart from high paranoia due to Robust/NonRobust implementation 
> > > (actually marked as obsoleted in GEOS) I don't really 
> > understand if we 
> > > really have a need to instantiate that class multiple time.
> > > 
> > > Wouldn't it be smarter to make it a Singleton and store 
> > reference to 
> > > it in the different classes ?
> > > 
> > > (the instance I'm talking about is in 
> > OffsetCurveSetBuilder.cpp, but I 
> > > recall to have seen many others around)
> > > 
> > > --strk;
> > > _______________________________________________
> > > geos-devel mailing list
> > > geos-devel@geos.refractions.net
> > > http://geos.refractions.net/mailman/listinfo/geos-devel
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> > 
> > 
> 
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Thu May 19 06:24:12 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Buffering Multipolygons
In-Reply-To: <20050519064813.GC490@keybit.net>
References: <1116421703.428b3e47b130f@webmail.limegroup.com>
	<20050518175209.GB94814@keybit.net>
	<20050519064813.GC490@keybit.net>
Message-ID: <20050519102412.GA2687@keybit.net>

Martin, inspecting this problem I found out a comment
of you:

                // <FIX> - handle negative depths

Actually, there's a negative depth in the 'non-working' case:

  BufferSubgraph::findResultEdges got 2 edges
   dirEdge 0: depth:-1
   dirEdge 1: depth:0
  PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
    dirEdge 0 inResult:0 isArea:1
    dirEdge 1 inResult:0 isArea:1
    returning 0 maxEdgeRings

While non negative depts are in the 'working' case:

  BufferSubgraph::findResultEdges got 2 edges
   dirEdge 0: depth:0
   dirEdge 1: depth:1
     in result
  PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
    dirEdge 0 inResult:0 isArea:1
    dirEdge 1 inResult:1 isArea:1
    returning 1 maxEdgeRings

I checked JTS and the notice is still there (your comment).
Anyway Dave reports it is working with JTS. Do you have
any hint on how to proceed ?

--strk;



On Thu, May 19, 2005 at 08:48:13AM +0200, strk@refractions.net wrote:
> Found out that geos-2.0.0 already has this bug.
> 
> It seems related to vertex order. If you swap vertex order
> of second shell result is correct:
> 
>   <a>
> MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> 	((60 60, 80 60, 70 7, 60 60)))
>   </a>
> 
> Martin, where should vertex order be enforced ?
> 
> --strk;
> 
> 
> On Wed, May 18, 2005 at 07:52:09PM +0200, strk@refractions.net wrote:
> > On Wed, May 18, 2005 at 09:08:23AM -0400, dblasby@openplans.org wrote:
> > > buffering this in JUMP (using JTS), works fine.
> > > 
> > > -->
> > > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> > >   ((60 60, 70 7, 80 60, 60 60)))
> > > 
> > > strk; your result is not correct.  You've lost the 1st polygon!
> > 
> > You're right! I've verified geos-1.0.0 not having this problem.
> > I'll check out 2.0.0 and up and see what broke this.
> > I'll add a test in testLeaksBig.xml for this as well.
> > Following is the XML test (parametrized buffer argument will only work
> > with GEOS CVS, other versions will use 10 as argument instead of arg3):
> > 
> > <run>
> >   <precisionModel type="FLOATING"/>
> > 
> > 
> > <case>
> >   <desc>Multipolygon buffering</desc>
> >   <a>MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))</a>
> > <test>
> >   <op name="buffer" arg1="a" arg3="0">
> >   	MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))
> >   </op>
> > </test>
> > </case>
> > 
> > 
> > </run>
> > 
> > 
> > --strk;
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From carl.anderson at vadose.org  Sat May 21 22:56:14 2005
From: carl.anderson at vadose.org (Carl Anderson)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] compiling GEOS CVS against GDAL CVS
Message-ID: <428FF4CE.8020605@vadose.org>


the WKBWriterT.h header is not in source/headers/geos/Makefile.am so it 
does not get installed.
GDAL requires it.

C.

snip -----
--- source/headers/geos/Makefile.am     2005-05-21 21:57:47.844157048 -0400
+++ source/headers/geos/Makefile.am2    2005-05-21 21:56:43.042008472 -0400
@@ -20,6 +20,7 @@
        io.h \
        ByteOrderDataInStreamT.h \
        WKBReaderT.h \
+        WKBWriterT.h \
        opLinemerge.h \
        opBuffer.h \
        operation.h \


From strk at refractions.net  Sun May 22 13:42:39 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] compiling GEOS CVS against GDAL CVS
In-Reply-To: <428FF4CE.8020605@vadose.org>
References: <428FF4CE.8020605@vadose.org>
Message-ID: <20050522174239.GB36300@keybit.net>

Committed. Thanks.
--strk;

On Sat, May 21, 2005 at 10:56:14PM -0400, Carl Anderson wrote:
> 
> the WKBWriterT.h header is not in source/headers/geos/Makefile.am so it 
> does not get installed.
> GDAL requires it.
> 
> C.

From strk at refractions.net  Mon May 23 11:18:38 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] [FIXED] Buffering Multipolygons
In-Reply-To: <20050519102412.GA2687@keybit.net>
References: <1116421703.428b3e47b130f@webmail.limegroup.com>
	<20050518175209.GB94814@keybit.net>
	<20050519064813.GC490@keybit.net>
	<20050519102412.GA2687@keybit.net>
Message-ID: <20050523151838.GA46079@keybit.net>

I've found and fixed the bug.
It was in LineSegment::reverse

Patch attached.
Affected versions: 2.0.0 to 3.0.0CVS

Might be worth setting up a branch for 2.1 so to come
out with a 2.1.2 ... what do you think ?

--strk;

On Thu, May 19, 2005 at 12:24:12PM +0200, strk@refractions.net wrote:
> Martin, inspecting this problem I found out a comment
> of you:
> 
>                 // <FIX> - handle negative depths
> 
> Actually, there's a negative depth in the 'non-working' case:
> 
>   BufferSubgraph::findResultEdges got 2 edges
>    dirEdge 0: depth:-1
>    dirEdge 1: depth:0
>   PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
>     dirEdge 0 inResult:0 isArea:1
>     dirEdge 1 inResult:0 isArea:1
>     returning 0 maxEdgeRings
> 
> While non negative depts are in the 'working' case:
> 
>   BufferSubgraph::findResultEdges got 2 edges
>    dirEdge 0: depth:0
>    dirEdge 1: depth:1
>      in result
>   PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
>     dirEdge 0 inResult:0 isArea:1
>     dirEdge 1 inResult:1 isArea:1
>     returning 1 maxEdgeRings
> 
> I checked JTS and the notice is still there (your comment).
> Anyway Dave reports it is working with JTS. Do you have
> any hint on how to proceed ?
> 
> --strk;
> 
> 
> 
> On Thu, May 19, 2005 at 08:48:13AM +0200, strk@refractions.net wrote:
> > Found out that geos-2.0.0 already has this bug.
> > 
> > It seems related to vertex order. If you swap vertex order
> > of second shell result is correct:
> > 
> >   <a>
> > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> > 	((60 60, 80 60, 70 7, 60 60)))
> >   </a>
> > 
> > Martin, where should vertex order be enforced ?
> > 
> > --strk;
> > 
> > 
> > On Wed, May 18, 2005 at 07:52:09PM +0200, strk@refractions.net wrote:
> > > On Wed, May 18, 2005 at 09:08:23AM -0400, dblasby@openplans.org wrote:
> > > > buffering this in JUMP (using JTS), works fine.
> > > > 
> > > > -->
> > > > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> > > >   ((60 60, 70 7, 80 60, 60 60)))
> > > > 
> > > > strk; your result is not correct.  You've lost the 1st polygon!
> > > 
> > > You're right! I've verified geos-1.0.0 not having this problem.
> > > I'll check out 2.0.0 and up and see what broke this.
> > > I'll add a test in testLeaksBig.xml for this as well.
> > > Following is the XML test (parametrized buffer argument will only work
> > > with GEOS CVS, other versions will use 10 as argument instead of arg3):
> > > 
> > > <run>
> > >   <precisionModel type="FLOATING"/>
> > > 
> > > 
> > > <case>
> > >   <desc>Multipolygon buffering</desc>
> > >   <a>MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))</a>
> > > <test>
> > >   <op name="buffer" arg1="a" arg3="0">
> > >   	MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60 60, 70 7, 80 60, 60 60)))
> > >   </op>
> > > </test>
> > > </case>
> > > 
> > > 
> > > </run>
> > > 
> > > 
> > > --strk;
> > > _______________________________________________
> > > geos-devel mailing list
> > > geos-devel@geos.refractions.net
> > > http://geos.refractions.net/mailman/listinfo/geos-devel
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From steve.lime at dnr.state.mn.us  Mon May 23 11:22:19 2005
From: steve.lime at dnr.state.mn.us (Steve Lime)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] [FIXED] Buffering Multipolygons
Message-ID: <s291af4f.024@co5.dnr.state.mn.us>

Excellent, thanks for pursuing! In my opinion that was a big fix and
would warrant a 2.1.2 if 3.0 is still a ways out.

Steve

>>> strk@refractions.net 5/23/2005 10:18:38 AM >>>
I've found and fixed the bug.
It was in LineSegment::reverse

Patch attached.
Affected versions: 2.0.0 to 3.0.0CVS

Might be worth setting up a branch for 2.1 so to come
out with a 2.1.2 ... what do you think ?

--strk;

On Thu, May 19, 2005 at 12:24:12PM +0200, strk@refractions.net wrote:
> Martin, inspecting this problem I found out a comment
> of you:
> 
>                 // <FIX> - handle negative depths
> 
> Actually, there's a negative depth in the 'non-working' case:
> 
>   BufferSubgraph::findResultEdges got 2 edges
>    dirEdge 0: depth:-1
>    dirEdge 1: depth:0
>   PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
>     dirEdge 0 inResult:0 isArea:1
>     dirEdge 1 inResult:0 isArea:1
>     returning 0 maxEdgeRings
> 
> While non negative depts are in the 'working' case:
> 
>   BufferSubgraph::findResultEdges got 2 edges
>    dirEdge 0: depth:0
>    dirEdge 1: depth:1
>      in result
>   PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
>     dirEdge 0 inResult:0 isArea:1
>     dirEdge 1 inResult:1 isArea:1
>     returning 1 maxEdgeRings
> 
> I checked JTS and the notice is still there (your comment).
> Anyway Dave reports it is working with JTS. Do you have
> any hint on how to proceed ?
> 
> --strk;
> 
> 
> 
> On Thu, May 19, 2005 at 08:48:13AM +0200, strk@refractions.net
wrote:
> > Found out that geos-2.0.0 already has this bug.
> > 
> > It seems related to vertex order. If you swap vertex order
> > of second shell result is correct:
> > 
> >   <a>
> > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> > 	((60 60, 80 60, 70 7, 60 60)))
> >   </a>
> > 
> > Martin, where should vertex order be enforced ?
> > 
> > --strk;
> > 
> > 
> > On Wed, May 18, 2005 at 07:52:09PM +0200, strk@refractions.net
wrote:
> > > On Wed, May 18, 2005 at 09:08:23AM -0400, dblasby@openplans.org
wrote:
> > > > buffering this in JUMP (using JTS), works fine.
> > > > 
> > > > -->
> > > > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> > > >   ((60 60, 70 7, 80 60, 60 60)))
> > > > 
> > > > strk; your result is not correct.  You've lost the 1st
polygon!
> > > 
> > > You're right! I've verified geos-1.0.0 not having this problem.
> > > I'll check out 2.0.0 and up and see what broke this.
> > > I'll add a test in testLeaksBig.xml for this as well.
> > > Following is the XML test (parametrized buffer argument will only
work
> > > with GEOS CVS, other versions will use 10 as argument instead of
arg3):
> > > 
> > > <run>
> > >   <precisionModel type="FLOATING"/>
> > > 
> > > 
> > > <case>
> > >   <desc>Multipolygon buffering</desc>
> > >   <a>MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60
60, 70 7, 80 60, 60 60)))</a>
> > > <test>
> > >   <op name="buffer" arg1="a" arg3="0">
> > >   	MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
((60 60, 70 7, 80 60, 60 60)))
> > >   </op>
> > > </test>
> > > </case>
> > > 
> > > 
> > > </run>
> > > 
> > > 
> > > --strk;
> > > _______________________________________________
> > > geos-devel mailing list
> > > geos-devel@geos.refractions.net 
> > > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel 
_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net 
http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Mon May 23 11:25:18 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] [FIXED] Buffering Multipolygons
In-Reply-To: <s291af4f.025@co5.dnr.state.mn.us>
References: <s291af4f.025@co5.dnr.state.mn.us>
Message-ID: <20050523152518.GB46079@keybit.net>

Ok, branch-2-1 is tagged in CVS and the patch has already
been back-ported. I'll take a look at the head ChangeLog
to find other big fixes if any.

--strk;

On Mon, May 23, 2005 at 10:22:19AM -0500, Steve Lime wrote:
> Excellent, thanks for pursuing! In my opinion that was a big fix and
> would warrant a 2.1.2 if 3.0 is still a ways out.
> 
> Steve
> 
> >>> strk@refractions.net 5/23/2005 10:18:38 AM >>>
> I've found and fixed the bug.
> It was in LineSegment::reverse
> 
> Patch attached.
> Affected versions: 2.0.0 to 3.0.0CVS
> 
> Might be worth setting up a branch for 2.1 so to come
> out with a 2.1.2 ... what do you think ?
> 
> --strk;
> 
> On Thu, May 19, 2005 at 12:24:12PM +0200, strk@refractions.net wrote:
> > Martin, inspecting this problem I found out a comment
> > of you:
> > 
> >                 // <FIX> - handle negative depths
> > 
> > Actually, there's a negative depth in the 'non-working' case:
> > 
> >   BufferSubgraph::findResultEdges got 2 edges
> >    dirEdge 0: depth:-1
> >    dirEdge 1: depth:0
> >   PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
> >     dirEdge 0 inResult:0 isArea:1
> >     dirEdge 1 inResult:0 isArea:1
> >     returning 0 maxEdgeRings
> > 
> > While non negative depts are in the 'working' case:
> > 
> >   BufferSubgraph::findResultEdges got 2 edges
> >    dirEdge 0: depth:0
> >    dirEdge 1: depth:1
> >      in result
> >   PolygonBuilder::buildMaximalEdgeRings got 2 dirEdges
> >     dirEdge 0 inResult:0 isArea:1
> >     dirEdge 1 inResult:1 isArea:1
> >     returning 1 maxEdgeRings
> > 
> > I checked JTS and the notice is still there (your comment).
> > Anyway Dave reports it is working with JTS. Do you have
> > any hint on how to proceed ?
> > 
> > --strk;
> > 
> > 
> > 
> > On Thu, May 19, 2005 at 08:48:13AM +0200, strk@refractions.net
> wrote:
> > > Found out that geos-2.0.0 already has this bug.
> > > 
> > > It seems related to vertex order. If you swap vertex order
> > > of second shell result is correct:
> > > 
> > >   <a>
> > > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> > > 	((60 60, 80 60, 70 7, 60 60)))
> > >   </a>
> > > 
> > > Martin, where should vertex order be enforced ?
> > > 
> > > --strk;
> > > 
> > > 
> > > On Wed, May 18, 2005 at 07:52:09PM +0200, strk@refractions.net
> wrote:
> > > > On Wed, May 18, 2005 at 09:08:23AM -0400, dblasby@openplans.org
> wrote:
> > > > > buffering this in JUMP (using JTS), works fine.
> > > > > 
> > > > > -->
> > > > > MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> > > > >   ((60 60, 70 7, 80 60, 60 60)))
> > > > > 
> > > > > strk; your result is not correct.  You've lost the 1st
> polygon!
> > > > 
> > > > You're right! I've verified geos-1.0.0 not having this problem.
> > > > I'll check out 2.0.0 and up and see what broke this.
> > > > I'll add a test in testLeaksBig.xml for this as well.
> > > > Following is the XML test (parametrized buffer argument will only
> work
> > > > with GEOS CVS, other versions will use 10 as argument instead of
> arg3):
> > > > 
> > > > <run>
> > > >   <precisionModel type="FLOATING"/>
> > > > 
> > > > 
> > > > <case>
> > > >   <desc>Multipolygon buffering</desc>
> > > >   <a>MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)), ((60
> 60, 70 7, 80 60, 60 60)))</a>
> > > > <test>
> > > >   <op name="buffer" arg1="a" arg3="0">
> > > >   	MULTIPOLYGON (((10 10, 10 20, 20 20, 20 15, 10 10)),
> ((60 60, 70 7, 80 60, 60 60)))
> > > >   </op>
> > > > </test>
> > > > </case>
> > > > 
> > > > 
> > > > </run>
> > > > 
> > > > 
> > > > --strk;
> > > > _______________________________________________
> > > > geos-devel mailing list
> > > > geos-devel@geos.refractions.net 
> > > > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > > _______________________________________________
> > > geos-devel mailing list
> > > geos-devel@geos.refractions.net 
> > > http://geos.refractions.net/mailman/listinfo/geos-devel 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Mon May 23 15:28:44 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] 2.1 branch and 2.1.2
Message-ID: <20050523192844.GA48298@keybit.net>

I've set up a branch for 2.1 code line (branch-2-1)

Most ABI-compatible changes since 2.1.1 have already
be applied to the branch.
A new CHANGES file as been added, currently containing:

Changes from 2.1.1 to 2.1.2

- Segfault fix in Point::isEmpty
- Mem Leak fix in OffsetCurveBuilder::getRingCurve
- Bugfix in LineSegment::reverse
- Added multipolygon buffering test in source/test/testLeaksBig
- Ported JTS robustness patch for RobustLineIntersector
- Removed useless Coordinate copies in OverlayOp::mergeZ()
- Avoided throws by IsValid on invalid input
- Stricter C++ syntax (math.h=>cmath, ieeefp.h in "C" block, ostringstream
  instead of sprintf)
- Better support for older compilers (Polygonizer::LineStringAdder friendship)
- Removed useless Coordinate copies in CGAlgorithms::isOnLine()
- Added support for polygonize and parametrized buffer tests in XMLTester
- Fixed support for --includedir and --libdir
- Fixed Z interpolation in LineIntersector


--strk;

From pramsey at refractions.net  Mon May 23 17:12:52 2005
From: pramsey at refractions.net (Paul Ramsey)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] 2.1 branch and 2.1.2
In-Reply-To: <20050523192844.GA48298@keybit.net>
References: <20050523192844.GA48298@keybit.net>
Message-ID: <CFD99327-184C-42CE-AEDD-23AC7CD83F4F@refractions.net>

Shall we roll out geos-2.1.2 and postgis 1.0.1?
P

On 23-May-05, at 12:28 PM, strk@refractions.net wrote:

> I've set up a branch for 2.1 code line (branch-2-1)
>
> Most ABI-compatible changes since 2.1.1 have already
> be applied to the branch.
> A new CHANGES file as been added, currently containing:
>
> Changes from 2.1.1 to 2.1.2
>
> - Segfault fix in Point::isEmpty
> - Mem Leak fix in OffsetCurveBuilder::getRingCurve
> - Bugfix in LineSegment::reverse
> - Added multipolygon buffering test in source/test/testLeaksBig
> - Ported JTS robustness patch for RobustLineIntersector
> - Removed useless Coordinate copies in OverlayOp::mergeZ()
> - Avoided throws by IsValid on invalid input
> - Stricter C++ syntax (math.h=>cmath, ieeefp.h in "C" block,  
> ostringstream
>   instead of sprintf)
> - Better support for older compilers (Polygonizer::LineStringAdder  
> friendship)
> - Removed useless Coordinate copies in CGAlgorithms::isOnLine()
> - Added support for polygonize and parametrized buffer tests in  
> XMLTester
> - Fixed support for --includedir and --libdir
> - Fixed Z interpolation in LineIntersector
>
>
> --strk;
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
>


From strk at refractions.net  Tue May 24 03:12:42 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] Re: GEOS 2.1
In-Reply-To: <VAN-E2K1NpyLAPDVXLu00000112@VAN-E2K1.safe.internal>
References: <VAN-E2K1NpyLAPDVXLu00000112@VAN-E2K1.safe.internal>
Message-ID: <20050524071242.GB52482@keybit.net>

On Mon, May 23, 2005 at 01:59:02PM -0700, Dale Lutz wrote:
> Hello,
> 
> Thanks very much for the multi-buffer fix.  We also found some problems with
> it in our testing at about the same time as others here did, so this is great
> news.
> 
> > Ok, branch-2-1 is tagged in CVS and the patch has already
> > been back-ported. I'll take a look at the head ChangeLog
> > to find other big fixes if any.
> 
> Can you post something on the list when all the fixes have been brought down
> to the 2.1 branch, and then we?ll update to that. (Any thoughts about how
> soon might this be available?)
> Thanks again.
> Dale

I think today it will be done, then I'd ask you users to test it
and report any problem I might have overlooked.

--strk;

From strk at refractions.net  Tue May 24 03:14:02 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] 2.1 branch and 2.1.2
In-Reply-To: <CFD99327-184C-42CE-AEDD-23AC7CD83F4F@refractions.net>
References: <20050523192844.GA48298@keybit.net>
	<CFD99327-184C-42CE-AEDD-23AC7CD83F4F@refractions.net>
Message-ID: <20050524071402.GC52482@keybit.net>

On Mon, May 23, 2005 at 02:12:52PM -0700, Paul Ramsey wrote:
> Shall we roll out geos-2.1.2 and postgis 1.0.1?
> P

For postgis 1.0.1 I think we're done (apart from srtext not
being updated and bugtracker being down).
For geos-2.1.2 I'd wait feedback from community for any bug
tests might be still around.

--strk;

> 
> On 23-May-05, at 12:28 PM, strk@refractions.net wrote:
> 
> >I've set up a branch for 2.1 code line (branch-2-1)
> >
> >Most ABI-compatible changes since 2.1.1 have already
> >be applied to the branch.
> >A new CHANGES file as been added, currently containing:
> >
> >Changes from 2.1.1 to 2.1.2
> >
> >- Segfault fix in Point::isEmpty
> >- Mem Leak fix in OffsetCurveBuilder::getRingCurve
> >- Bugfix in LineSegment::reverse
> >- Added multipolygon buffering test in source/test/testLeaksBig
> >- Ported JTS robustness patch for RobustLineIntersector
> >- Removed useless Coordinate copies in OverlayOp::mergeZ()
> >- Avoided throws by IsValid on invalid input
> >- Stricter C++ syntax (math.h=>cmath, ieeefp.h in "C" block,  
> >ostringstream
> >  instead of sprintf)
> >- Better support for older compilers (Polygonizer::LineStringAdder  
> >friendship)
> >- Removed useless Coordinate copies in CGAlgorithms::isOnLine()
> >- Added support for polygonize and parametrized buffer tests in  
> >XMLTester
> >- Fixed support for --includedir and --libdir
> >- Fixed Z interpolation in LineIntersector
> >
> >
> >--strk;
> >_______________________________________________
> >geos-devel mailing list
> >geos-devel@geos.refractions.net
> >http://geos.refractions.net/mailman/listinfo/geos-devel
> >
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Tue May 24 04:50:53 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:42 2007
Subject: [geos-devel] GEOS 2.1 branch in sync
Message-ID: <20050524085053.GA53375@keybit.net>

I've finished back-porting of ABI-compatible patches
from HEAD to 2.1 branch. Contextually I introduced
CHANGES files to both branches moving info from the
NEWS files (dropped) and updating them.

I've tested ABI compatibility by compiling postgis
against 2.1.1 and running its regress test against
2.1.2. It works.

Next step would be: test other ABI compatibility
(gdal, ...) and run any tests you might have around.

To try it out:

 # export CVSROOT=:pserver:cvs@geos.refractions.net:/home/cvs/postgis 
 # cvs login
	<password is cvs>
 # cvs co -r branch-2-1 geos

Please let me know

--strk;

From strk at refractions.net  Wed May 25 05:36:43 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:48 2007
Subject: [geos-devel] [BUG] no outgoing dirEdge found
In-Reply-To: <20050525091114.GB65207@keybit.net>
References: <42932BEA.1070104@noaa.gov> <20050524133055.GA56115@keybit.net>
	<42933F33.4030206@noaa.gov> <20050524150758.GA57295@keybit.net>
	<42934B70.7080108@noaa.gov> <20050524160018.GA57486@keybit.net>
	<20050524160620.GB57486@keybit.net> <42936523.2030600@noaa.gov>
	<20050525090844.GA65207@keybit.net>
	<20050525091114.GB65207@keybit.net>
Message-ID: <20050525093643.GA65330@keybit.net>

Mark, I found out that a coordinate reduction on one of the input
geometries goes around the bug. Attached is a test file.
I confirm the bug being in GEOS-2.1.2CVS, GEOS-3.0.0 and
current JTS:

-- with GEOS:
psql:test.sql:16: NOTICE:  TopologyException: no outgoing dirEdge found (-102895,939993)
psql:test.sql:16: ERROR:  GEOS difference() threw an error!


-- with JTS:
psql:test.sql:16: NOTICE:  no outgoing dirEdge found [ (-102894.55624213882, 939992.6692729667, NaN) ]
psql:test.sql:16: ERROR:  JTS difference() threw an error!


Making an XML test would be harder since WKT representation brings 
to precision reduction that in turn makes the test work. The format
used in the attached test.sql file is HEX-WKB.

Test has been conducted linking the postgis library against libGEOS
and libJTS respectively.

--strk;
-------------- next part --------------
SELECT postgis_full_version();

CREATE TEMP TABLE test(a geometry, b geometry);
INSERT INTO test VALUES (
'0103000020E80A00000100000069010000ECA2396C13BBFF40E8BA3424319F2541DEFB1D49DFB8FF40E73660ADA07F2541FAD6C80B43B2FF407033A9AC12602541E43630383FA7FF401F0EFC9789402541470638AAD497FF408AE2E2E40721254133F2A0950484FF40D372540890012541776AF085D06BFF40B21B837624E22441E2C9515E3A4FFF40DBD7ABA2C7C22441CDA87059442EFF407956E5FE7BA32441DF5C4C09F108FF40A728EFFB4384244184A9045743DFFE40A40901092265244116A59F823EB1FE4096459A931846244141D7C822E67EFE40AD4251072A272441B29589243E48FE405630A3CD58082441A6A4FACA4A0DFE4065E0C34DA7E923417321EFAE10CEFD40D6CD6DEC17CB2341B7BD98BE948AFD40F954B20BADAC23414652253DDC42FD40B720CA0A698E234192D155C2ECF6FC40ADD0E5454E702341B3A10E3ACCA6FC40CCDBFE155F522341D166E1E38052FC4022B3A8D09D3423411747905211FAFB408628E2C70C172341F7B18A6B849DFB40B61CE749AEF92241F6B46366E13CFB40907802A184DC2241B9E841CC2FD8FA40FA74601392BF224194014977776FFA400135E1E2D8A22241500FFD91C002FA40CFB5EB4C5B8622416E789F961392F940DE17418A1B6A22418ABD854E791DF940FD44D0CE1B4E224122126AD1FAA4F84096F689495E32224164D8B584A128F840951F3524E5162241350EC61A77A8F7406EBD4383B2FB2141FEB929928524F7408B13A885C8E021417066DA34D79CF6408654AA4429C62141BCBC6E977611F64071BCBED3D6AB21414A4D47986E82F5407B1F5C40D39121416897B55ECAEFF44024F0D29120782141DA601D5A9559F4403AC024C9C05E2141AC6E1041DBBFF340C23FDCE0B545214109B16410A822F340EABCE5CC012D214160F4440A0882F2402528687AA61421417B2A3CB507DEF140659F9ECFA5FC2041975E3BDBB336F1408B83B2AB01E5204109689A88198CF040F01A96E6BBCD204192DE26168CBCEF40FDC3DF50D6B620418BB372E18D5AEE40A5BAA5B352A020414762D20D54F2EC409D735AD0328A204125366DB2FA83EB401B90A9607874204149EEA6609E0FEA40CC6C5516255F20412C71E5215C95E840C14E159B3A4A204167244D755115E740E4307490BA3520410516744D9C8FE5409C34B08FA621204130250C0E5B04E44024B89A29000E2041F2588489AC73E240152AF2CC91F51F414194A1FEAFDDE040A812CC8B04D01F41B9AE1D2C0A85DE40479B677D5BAB1F413F7ECABF9744DB4062B59D7D99871F4122E757A249FAD740CEC04256C1641F412B6FA08261A6D440A7E1EEBED5421F41A4982BCF2149D14038C2C75CD9211F41436DFF619BC5CB402FC54BC2CE011F41DF6CCA0C52E7C44028AC1E6FB8E21E41DD196F76E1EFBB409BB6D7CF98C41E41F3220E7C07E0AB40163DD13D72A71E4180CA45A3CBEE47C079CCF9FE468B1E4173AA092451DDACC0EBC4A64519701E41488EA3D140CBBCC00E806830EB551E41721152D143A2C5C0D501E0C9BE3C1E41BB857A0AAEECCCC05637960896241E4176759EC42622D2C0BAC6D4CE720D1E41BE846FDD47D4D5C0657380EA56F71D41F4583488708CD9C03319F51444E21D4153B71285564ADDC0B041E3F23BCE1D41F73ECE90D786E0C0E7552F1440BB1D417067519F176BE2C05E6FD2F351A91D413DDB08ABC551E4C0B5CABCF772981D41C6EB69C0BB3AE6C01FDEB970A4881D4115D45EBED325E8C00516569AE7791D4168E43F59E712EAC0BF39C69A3D6C1D4198FFCF1DD001ECC05C7AD082A75F1D41AE2E3C7467F2EDC0482DB74D26541D41D30E1EA386E4EFC0703425E1BA491D41C76E406903ECF0C06B151C0D66401D417873748760E6F1C014C1E38B28381D41AC8C2E2647E1F2C0D60CFC0103311D410441B9B4A3DCF3C0C9DE0FFEF52A1D41EDBA2C9962D8F4C0A10DEAF801261D419914F63170D4F5C053F56B5527221D41003D5FD7B8D0F6C024C18560661F1D41725717DD28CDF7C0C06B3051BF1D1D410D77BB93ACC9F8C0D0756948321D1D4181975F4A30C6F9C067533051BF1D1D4180B41750A0C2FAC075908560661F1D4127E180F5E8BEFBC051AC6B5527221D41C5404A8EF6BAFCC051ACE9F801261D4152C2BD72B5B6FDC033650FFEF52A1D41FF7F480112B2FEC0047BFB0103311D4139A402A0F8ACFFC01117E38B28381D41D05A1BDFAA5300C145531B0D66401D41B215F4EA8AD000C1365A24E1BA491D41C495ACB6124D01C10B3BB64D26541D4169AA478C38C901C12E70CF82A75F1D41EBBA6BBDF24402C1B517C59A3D6C1D418A0924A437C002C136DC549AE7791D41FC4EA1A3FD3A03C1A38CB870A4881D414F9FF9283BB503C1A661BBF772981D414689E7ABE62E04C1DAEED0F351A91D41386188AFF6A704C10ABE2D1440BB1D41B0A819C3612005C19B92E1F23BCE1D41F083B5821E9805C10753F31444E21D41B72E0E98230F06C145967EEA56F71D41AE6128BB678506C1CDD2D2CE720D1E41DA9914B3E1FA06C1C12C940896241E41C133A756886F07C1C2E0DDC9BE3C1E41D14B2F8D52E307C1A7486630EB551E41CA552C4F375608C15C77A44519701E410E5D02A72DC808C1F068F7FE468B1E41B1DFACB12C3909C1C3C3CE3D72A71E417036709F2BA909C1B027D5CF98C41E41AB7B89B421180AC1D7071C6FB8E21E41ACE3DC4906860AC1AD0B49C2CE011F41A378A2CDD0F20AC1BCF3C45CD9211F41E52C11C4785E0BC168FEEBBED5421F410D3608C8F5C80BC107C93F56C1641F41D1A3B68B3F320CC14DA99A7D99871F41742541D94D9A0CC1207B647D5BAB1F41F3F0659318010DC1AFDEC88B04D01F4116BF1EB697660DC189E2EECC91F51F41C9CF4057C3CA0DC1B60A9929000E20414EEA1AA7932D0EC1A77DAE8FA6212041DF4C11F1008F0EC189707290BA352041B07F379C03EF0EC12585139B3A4A20413BFFE72B944D0FC1129A5316255F204117B25940ABAA0FC167B4A76078742041528F99CB200310C1148F58D0328A20418BAA0D06283010C16DCDA3B352A020414941A4CC675C10C13DCEDD50D6B62041221106ACDC8710C1CE1C94E6BBCD2041B960AE4083B210C12F7DB0AB01E52041EEA52E3758DC10C1F8909CCFA5FC2041EAEA704C580511C1D011667AA6142141DEECF84D802D11C1D79EE3CC012D214154EF231ACD5411C11A1ADAE0B5452141313F67A03B7B11C1299322C9C05E214166608DE1C8A011C1D5BBD09120782141B1E1F1EF71C511C11AE45940D39121419ED1BBEF33E911C12B7ABCD3D6AB214159D016170C0C12C1870BA84429C62141C5B96AAEF72D12C101C4A585C8E0214195E39110F44E12C187674183B2FB21411BEB0DABFE6E12C181C33224E5162241BB0E3BFE148E12C1839487495E322241FB0E829D34AC12C11BDDCDCE1B4E22414D93882F5BC912C15CAA3E8A1B6A2241D00E606E86E512C1DF42E94C5B8622415A21B327B40013C1D3BCDEE2D8A222414B71F13CE21A13C1BFF75D1392BF2241AFFA79A30E3413C17BF6FFA084DC22416DD0C364374C13C1F895E449AEF922415D4C859E5A6313C1519DDFC70C1723411AABD982767913C1AA23A6D09D342341C6106558898E13C14348FC155F522341D5F3767A91A213C14839E3454E7023413AEB2A598DB513C1A885C70A698E23416FDD87797BC713C175B6AF0BADAC2341D48D9D755AD813C1112C6BEC17CB23413386A0FC28E813C1943BC14DA7E92341235A04D3E5F613C1AD88A0CD580824414D4294D28F0414C161984E072A2724419E0D8AEA251114C1DD98979318462441AA66A31FA71C14C1B25AFE0822652441856B358C122714C1B377ECFB4384244195963E60673014C1B9A3E2FE7BA32441FEF676E1A43814C18423A9A2C7C2244154B75E6BCA3F14C1FA65807624E2244180F14A6FD74514C1EFBB510890012541CBCE7074CB4A14C1B22AE0E40721254140F3EE17A64E14C18855F997894025419833D50C675114C1517AA6AC1260254128952A1C0E5314C1777D5DADA07F25414597F1249B5314C15C013224319F2541DAC52A1C0E5314C17985069BC1BE2541F994D50C675114C14189BD9B4FDE25414685EF17A64E14C11AAF6AB0D8FD25416D917174CB4A14C16DDB83635A1D2641AEE44B6FD74514C1194C1240D23C2641FCDA5F6BCA3F14C164A4E3D13D5C2641074B78E1A43814C19CE9BAA59A7B2641E61A4060673014C1946C8149E69A26410020378C122714C1339C774C1EBA26412D4BA51FA71C14C139BD653F40D9264102228CEA251114C17E83CCB449F82641698696D28F0414C1D588154138172741CBCD06D3E5F613C1CE9DC37A093627413529A3FC28E813C196F0A2FABA542741FB5FA0755AD813C13106F95B4A73274183DE8A797BC713C14F82B43CB5912741FF1A2E598DB513C107BA9C3DF9AF27410B527A7A91A213C1B90D810214CE27412B9D6858898E13C17706683203EC27416665DD82767913C13233BE77C40928414634899E5A6313C111C2848055272841A6E5C764374C13C157D27FFEB3442841E43C7EA30E3413C1257B64A7DD6128412AE0F53CE21A13C197830635D07E284189BCB727B40013C19BC88565899B2841F2D5646E86E512C10B4D7BFB06B8284104868D2F5BC912C16BF025BE46D42841E42C879D34AC12C1EBC8967946F02841705740FE148E12C1211DDDFE030C2941325E13ABFE6E12C121FA31247D272941A1809710F44E12C1756223C5AF422941578070AEF72D12C1B412BFC2995D2941FDBF1C170C0C12C143D8BC0339782941DEE9C1EF33E911C11077A8748B9229411322F8EF71C511C1EC1A0B088FAC29416DC893E1C8A011C1555194B641C629415DCE6DA03B7B11C17C88427FA1DF294123A52A1ACD5411C15E108B67ACF82941C9C8FF4D802D11C1C99A817B60112A4169EC774C580511C14D37FFCDBB292A4173CC353758DC10C1F5C7C878BC412A41B7ABB54083B210C1E0EBB49C60592A4108800DACDC8710C1B45CD161A6702A4182D3ABCC675C10C108BC87F78B872A417F5F1506283010C1E9CDC1940F9E2A416866A1CB200310C1A01D0D782FB42A414EA36940ABAA0FC1F609BEE7E9C92A413E32F82B944D0FC13F3612323DDF2A413DF3479C03EF0EC1685D52AD27F42A41AAFF21F1008F0EC18884F3B7A7082B410ADB2BA7932D0EC1358AB7B8BB1C2B4123FD5157C3CA0DC13510CD1E62302B41B72730B697660DC1F8BCEE6199432B418093779318010DC177D2810260562B418C0053D94D9A0CC11218B489B4682B4110B6C88B3F320CC10D159989957A2B410B7E1AC8F5C80BC17F99469D018C2B4134A923C4785E0BC15793F068F79C2B41D227B5CDD0F20AC1702D049A75AD2B4146C4EF4906860AC1733642E77ABD2B41378C9CB421180AC18FCDD81006CD2B417275839F2BA909C109537CE015DC2B41A84BC0B12C3909C1989A7F29A9EA2B4177F415A72DC808C1CD5DEBC8BEF82B411D17404F375608C191EC94A555062C418335438D52E307C1141A34B06C132C414644BB56886F07C15A6478E302202C41A1CF28B3E1FA06C1DA541D44172C2C4123BB3CBB678506C17B18FEE0A8372C4144AA2298230F06C18E4D28D3B6422C41FB1FCA821E9805C12106EE3D404D2C41A0632EC3612005C16EFDF64E44572C416D399DAFF6A704C1EFFE503EC2602C41207DFCABE62E04C1DF7D7F4EB9692C412DAD0E293BB503C1EF5B8ACC28722C413875B6A3FD3A03C104DE0B10107A2C417F4639A437C002C1E7CD3D7B6E812C41F10C81BDF24402C1EDC7057B43882C41D70F5D8C38C901C18CB300878E8E2C41ED0CC2B6124D01C10E668D214F942C41EA9C09EB8AD000C17C6ED6D784992C416AF030DFAA5300C1090ADB412F9E2C41D2E82DA0F8ACFFC0464077024EA22C419DDA730112B2FEC07D266BC7E0A52C41942FE972B5B6FDC0A2496149E7A82C4148BD758EF6BAFCC0593EF44B61AB2C418769ACF5E8BEFBC0A656B39D4EAD2C4158454350A0C2FAC0E77C2618AFAE2C416B2D8B4A30C6F9C0C433D19F82AF2C41A30EE793ACC9F8C0E8BA3424C9AF2C414FED42DD28CDF7C04858D19F82AF2C41BCCD8AD7B8D0F6C0EDC52618AFAE2C41CF9C213270D4F5C028C4B39D4EAD2C413837589962D8F4C04ED0F44B61AB2C41FFADE4B4A3DCF3C0FFFF6149E7A82C41F6E6592647E1F2C034016CC7E0A52C41AFB79F8760E6F1C0463F78024EA22C418B996B6903ECF0C03D2DDC412F9E2C41B92A74A386E4EFC0CEB5D7D784992C413B0A927467F2EDC065D18E214F942C411C94251ED001ECC0CB4202878E8E2C41352B9559E712EAC0F57A077B43882C4184C6B3BED325E8C096A43F7B6E812C413983BEC0BB3AE6C036D80D10107A2C411C115DABC551E4C07C798CCC28722C412835A59F176BE2C09DBE814EB9692C41009E2191D786E0C0B062533EC2602C41078BB885564ADDC00384F94E44572C415C35D988708CD9C058AFF03D404D2C41FF5C13DE47D4D5C031192BD3B6422C41C93C41C52622D2C0540601E1A8372C4123D9BD0BAEECCCC0AC642044172C2C41681093D243A2C5C0EA957BE302202C413EB120D440CBBCC0216D37B06C132C411BD7F92851DDACC0D96098A555062C4127FFB1DCCCEE47C00BF3EEC8BEF82B41B64F337707E0AB4085508329A9EA2B417C4F0774E1EFBB405A2980E015DC2B41506F990B52E7C440F8C3DC1006CD2B411C6FD1609BC5CB40A54C46E77ABD2B410A2596CE2149D1401A63089A75AD2B41B2920C8261A6D44024E8F468F79C2B414CADC5A149FAD740170D4B9D018C2B4172F239BF9744DB401AA79D89957A2B4139DC8E2B0A85DE4037C8B889B4682B413A0D5BFEAFDDE04058A0860260562B41A3B93E89AC73E24033A8F36199432B410773C70D5B04E4406918D21E62302B415C56304D9C8FE540FEAEBCB8BB1C2B41885C0A755115E7407FC5F8B7A7082B414AA6A3215C95E84024BA57AD27F42A41872566609E0FEA4053AE17323DDF2A418F742DB2FA83EB40F79CC3E7E9C92A41D6AC930D54F2EC401DCB12782FB42A41220F35E18D5AEE407195C7940F9E2A41FF4FEA158CBCEF40299D8DF78B872A4107AE7C88198CF040F756D761A6702A412F341EDBB336F140CFFEBA9C60592A41F1911FB507DEF14015F3CE78BC412A41F0EF280A0882F240247A05CEBB292A41E2424910A822F340DAF4877B60112A41F298F540DBBFF3402A819167ACF82941A425035A9559F440820F497FA1DF2941C0F89B5ECAEFF44013EE9AB641C62941314D2E986E82F540DECC11088FAC2941255D56977611F640B13DAF748B92294141A9C234D79CF6400BB3C3033978294111A112928524F7401A01C6C2995D2941579BAF1A77A8F740EF632AC5AF422941540DA084A128F840220E39247D27294193F054D1FAA4F8401D43E4FE030C29412347714E791DF94053009E7946F02841C8AE8B961392F940AF382DBE46D42841F4F3E991C002FA409AA582FB06B8284100963677776FFA40E2308D65899B28415D2E30CC2FD8FA4001FB0D35D07E284133AD5266E13CFB401E016CA7DD612841215E7A6B849DFB40496687FEB344284173A8805211FAFB4064638C8055272841987ED2E38052FC404EE1C577C40928410E71003ACCA6FC40C3C06F3203EC27419C5948C2ECF6FC409AD3880214CE27410C94183DDC42FD40E28AA43DF9AF274136BA8CBE948AFD40895DBC3CB59127419BD9E3AE10CEFD402CEB005C4A7327415819F0CA4A0DFE40B5DEAAFABA542741C1C77F243E48FE407294CB7A0936274170C7BF22E67EFE405F871D41381727411A5497823EB1FE404F89D4B449F826410318FD5643DFFE40B1C96D3F40D926416F8B4509F108FF40B1AE7F4C1EBA2641F6976A59442EFF4077848949E69A26411D7A4C5E3A4FFF404206C3A59A7B26412FDCEB85D06BFF402CC5EBD13D5C2641C2259D950484FF4060701A40D23C2641F9FB34AAD497FF4090028C635A1D2641F4EE2D383FA7FF4077D872B0D8FD25419651C70B43B2FF4035B4C59B4FDE254124391D49DFB8FF4060B10E9BC1BE2541ECA2396C13BBFF40E8BA3424319F2541',
'0103000020E80A0000010000001B0000003731C25DB7A40AC123BABA3D2F2E1541482DDA6520AE15C150176B846E0E04419D9BAD51D2DD20C188B238C6A20F1341C93BA6B63EF616C1773C690356B72041AFE718BD3DE01AC1363F67295618224104666722A81614C128DF2B476DE92641E3BF74CA1BBCF1C0D43292B68C652141BDD1D74AAFA6CCC01D27263DE8A122418FF95A96AD86C240BA1AA7079685274134285EE6E81EF9C040F2AA56B1AF2C4117B1B91CDC81FA40E8363289617C3041DF296F1F14800941806416C77A5C2C4143DE3E9BAE901A41E5DD836A7C8E2E413E4390CBBBDE1E41DCBAED0B9BC82741489E9ED935770A41535871C71BFB2441A247FE423D360841CDF36716539B2441ECC1420680470741BD3D4C94710F23414D024D7D04380A41FEC5364D1A022241407DA7BAAF811D41DD0784C658ED184192B08CF1A618184108E3295E56ED104121896F9066610541F13A975D57FE1941096E8D134BEBFB406847DAE3D9661741AABE21A245A00B41845A019F2304FF40E48112BC1AF0F84080891F1A39C7F140DD811CEEB3B3EF40AE82AE28194B0341AB6F85D09F3409C1B06BA7169F6201413731C25DB7A40AC123BABA3D2F2E1541');

SELECT isvalid(a) as a_valid, isvalid(b) as b_valid from test;

-- This works, which is precision reduction on geometry B 
-- introduced by 'astext' is enought to get the exception away
SELECT geometrytype(difference(setSRID(a, -1),astext(b))) from test;

-- This throws the exception:
-- TopologyException: no outgoing dirEdge found (-102895,939993)
SELECT difference(a,b) from test;
