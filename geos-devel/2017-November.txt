From james.turner at weather.com  Wed Nov  8 06:59:28 2017
From: james.turner at weather.com (James Turner)
Date: Wed, 08 Nov 2017 09:59:28 -0500
Subject: [geos-devel] Alternative licensing for GEOS
Message-ID: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>

Good day,

   We would like to use the GeoSwift framework in our existing proprietary iOS application. It is offered under an MIT license, but it in turn uses the GEOS library, which is LGPL. We would like to know if alternative licensing is available for GEOS, as the object distribution requirements for the LGPL don’t really make any sense in iOS applications.

 

 

James Turner

iOS Developer

w: (978) 483-0793 e: james.turner at weather.com

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171108/6ef82d42/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 14380 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171108/6ef82d42/attachment.png>

From howard at hobu.co  Wed Nov  8 08:25:32 2017
From: howard at hobu.co (Howard Butler)
Date: Wed, 8 Nov 2017 10:25:32 -0600
Subject: [geos-devel] Alternative licensing for GEOS
In-Reply-To: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
References: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
Message-ID: <CAKyBbG5A+g+5ed9-LpJ-BYpZDt1Cu0FGQg1dMoLFzTeabFe7TQ@mail.gmail.com>

James,

The answer to the question of the possibility of relicensing GEOS is "no"
with near 100% certainty. There are a few significant GEOS contributors who
are steadfast in their contribution only being released as LGPL software.

This question has come up a few other times and there's never been any
movement on the topic.

I personally think the answer is to take any needed features from the
recently relicensed JTS and continue efforts to port them over into Boost
Geometry Library. BGL doesn't have parity with GEOS at the moment, but it
is still getting contribution and attention. Significant corporate
attention, contribution, and resources are needed to change the situation
in any meaningful way.

Howard


On Wed, Nov 8, 2017 at 8:59 AM, James Turner <james.turner at weather.com>
wrote:

> Good day,
>
>    We would like to use the GeoSwift framework in our existing proprietary
> iOS application. It is offered under an MIT license, but it in turn uses
> the GEOS library, which is LGPL. We would like to know if alternative
> licensing is available for GEOS, as the object distribution requirements
> for the LGPL don’t really make any sense in iOS applications.
>
>
>
>
>
> *James Turner*
>
> iOS Developer
>
> *w:* (978) 483-0793 *e:* james.turner at weather.com
>
>
>
>
>
>
>
> _______________________________________________
> geos-devel mailing list
> geos-devel at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/geos-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171108/911aeb70/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 14380 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171108/911aeb70/attachment-0001.png>

From strk at kbt.io  Wed Nov  8 12:08:48 2017
From: strk at kbt.io (Sandro Santilli)
Date: Thu, 9 Nov 2017 09:08:48 +1300
Subject: [geos-devel] Alternative licensing for GEOS
In-Reply-To: <CAKyBbG5A+g+5ed9-LpJ-BYpZDt1Cu0FGQg1dMoLFzTeabFe7TQ@mail.gmail.com>
References: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
 <CAKyBbG5A+g+5ed9-LpJ-BYpZDt1Cu0FGQg1dMoLFzTeabFe7TQ@mail.gmail.com>
Message-ID: <20171108200848.sj5h5bgfxednytrh@liz>

On Wed, Nov 8, 2017 at 8:59 AM, James Turner <james.turner at weather.com> wrote:

> We would like to use the GeoSwift framework in our existing
> proprietary iOS application.

On Wed, Nov 08, 2017 at 10:25:32AM -0600, Howard Butler wrote:

> Significant corporate
> attention, contribution, and resources are needed to change the situation
> in any meaningful way.

And that's the whole point of the GPL licences !

You want to spread proprietary applications ? It has to be painful :)

Alternatively, why don't you try the smooth experience of providing
your users with something more powerful than a look-but-not-touch
black box ?

--strk;

From howard at hobu.co  Wed Nov  8 12:50:50 2017
From: howard at hobu.co (Howard Butler)
Date: Wed, 8 Nov 2017 14:50:50 -0600
Subject: [geos-devel] Alternative licensing for GEOS
In-Reply-To: <20171108200848.sj5h5bgfxednytrh@liz>
References: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
 <CAKyBbG5A+g+5ed9-LpJ-BYpZDt1Cu0FGQg1dMoLFzTeabFe7TQ@mail.gmail.com>
 <20171108200848.sj5h5bgfxednytrh@liz>
Message-ID: <CAKyBbG4A7ScjR_=zoJJVcVxmfJqCXCHVMfO+1_CAY+15LrT5TQ@mail.gmail.com>

On Wed, Nov 8, 2017 at 2:08 PM, Sandro Santilli <strk at kbt.io> wrote:

>
> And that's the whole point of the GPL licences !
>
> You want to spread proprietary applications ? It has to be painful :)
>

Ah, there's that contributor, right on cue.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171108/e31c0c99/attachment.html>

From lr at pcorp.us  Wed Nov  8 16:30:44 2017
From: lr at pcorp.us (Regina Obe)
Date: Wed, 8 Nov 2017 19:30:44 -0500
Subject: [geos-devel] Alternative licensing for GEOS
In-Reply-To: <CAKyBbG4A7ScjR_=zoJJVcVxmfJqCXCHVMfO+1_CAY+15LrT5TQ@mail.gmail.com>
References: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
 <CAKyBbG5A+g+5ed9-LpJ-BYpZDt1Cu0FGQg1dMoLFzTeabFe7TQ@mail.gmail.com>
 <20171108200848.sj5h5bgfxednytrh@liz>
 <CAKyBbG4A7ScjR_=zoJJVcVxmfJqCXCHVMfO+1_CAY+15LrT5TQ@mail.gmail.com>
Message-ID: <001301d358f1$fb6ddc40$f24994c0$@pcorp.us>

He would have been faster if he wasn't in New Zealand :)

Damn we lost the opportunity to change the license while he was asleep.

 

 

From: geos-devel [mailto:geos-devel-bounces at lists.osgeo.org] On Behalf Of Howard Butler
Sent: Wednesday, November 08, 2017 3:51 PM
To: GEOS Development List <geos-devel at lists.osgeo.org>
Subject: Re: [geos-devel] Alternative licensing for GEOS

 

 

 

On Wed, Nov 8, 2017 at 2:08 PM, Sandro Santilli <strk at kbt.io <mailto:strk at kbt.io> > wrote:


And that's the whole point of the GPL licences !

You want to spread proprietary applications ? It has to be painful :)

 

Ah, there's that contributor, right on cue. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171108/f7648dc0/attachment.html>

From gdt at lexort.com  Thu Nov  9 06:16:10 2017
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 09 Nov 2017 09:16:10 -0500
Subject: [geos-devel] Alternative licensing for GEOS
In-Reply-To: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com> (James
 Turner's message of "Wed, 08 Nov 2017 09:59:28 -0500")
References: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
Message-ID: <smu7euzsfkl.fsf@linuxpal.mit.edu>


James Turner <james.turner at weather.com> writes:

> We would like to know if alternative licensing is available for GEOS,
> as the object distribution requirements for the LGPL don’t really make
> any sense in iOS applications.

The key issue is that the permission granted is intended to be
conditioned on the user being able to do some things, and Apple chooses
not to let the user do those things.

The notion that "the iOS rules don't make sense" is an equally valid
viewpoint in this case.

Perhaps you could ask Apple to let users share Free Software that
they've obtained from the app store, with each other, and to add a way
for people to rebuild LGPL code, relink it, and install it on their
devices :-) Obviously I don't expect you to do that, and I don't expect
the request to be at all succesful, but this is basically why the Free
Software community is not receptive to "could you change your licensing
so I can distribute proprietary software via a mechanism that is
explicitly hostile to Free Software".

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 162 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171109/9e763af3/attachment.sig>

From pramsey at cleverelephant.ca  Thu Nov  9 08:42:37 2017
From: pramsey at cleverelephant.ca (Paul Ramsey)
Date: Thu, 9 Nov 2017 08:42:37 -0800
Subject: [geos-devel] Alternative licensing for GEOS
In-Reply-To: <smu7euzsfkl.fsf@linuxpal.mit.edu>
References: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
 <smu7euzsfkl.fsf@linuxpal.mit.edu>
Message-ID: <CACowWR0TtykK1qGMiqNAqcL9SztTEJ_ftg0609x85SieOExj8w@mail.gmail.com>

Just randomly, if IBM licensed GEOS for $100K / year for five years, would
that be acceptable?
One can write a lot of free software for $100K / year.
It's not uncommon for copyleft projects to self-support with relicensing
deals. Wonder what our community members think about that.
P.

On Thu, Nov 9, 2017 at 6:16 AM, Greg Troxel <gdt at lexort.com> wrote:

>
> James Turner <james.turner at weather.com> writes:
>
> > We would like to know if alternative licensing is available for GEOS,
> > as the object distribution requirements for the LGPL don’t really make
> > any sense in iOS applications.
>
> The key issue is that the permission granted is intended to be
> conditioned on the user being able to do some things, and Apple chooses
> not to let the user do those things.
>
> The notion that "the iOS rules don't make sense" is an equally valid
> viewpoint in this case.
>
> Perhaps you could ask Apple to let users share Free Software that
> they've obtained from the app store, with each other, and to add a way
> for people to rebuild LGPL code, relink it, and install it on their
> devices :-) Obviously I don't expect you to do that, and I don't expect
> the request to be at all succesful, but this is basically why the Free
> Software community is not receptive to "could you change your licensing
> so I can distribute proprietary software via a mechanism that is
> explicitly hostile to Free Software".
>
>
> _______________________________________________
> geos-devel mailing list
> geos-devel at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/geos-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171109/514ad37f/attachment.html>

From lr at pcorp.us  Thu Nov  9 08:52:56 2017
From: lr at pcorp.us (Regina Obe)
Date: Thu, 9 Nov 2017 11:52:56 -0500
Subject: [geos-devel] Alternative licensing for GEOS
In-Reply-To: <CACowWR0TtykK1qGMiqNAqcL9SztTEJ_ftg0609x85SieOExj8w@mail.gmail.com>
References: <C8D4AFC5-FC01-41B4-8846-46528F8717C7@weather.com>
 <smu7euzsfkl.fsf@linuxpal.mit.edu>
 <CACowWR0TtykK1qGMiqNAqcL9SztTEJ_ftg0609x85SieOExj8w@mail.gmail.com>
Message-ID: <001b01d3597b$318f7110$94ae5330$@pcorp.us>

I personally would be okay with that.

 

From: geos-devel [mailto:geos-devel-bounces at lists.osgeo.org] On Behalf Of Paul Ramsey
Sent: Thursday, November 09, 2017 11:43 AM
To: GEOS Development List <geos-devel at lists.osgeo.org>
Subject: Re: [geos-devel] Alternative licensing for GEOS

 

Just randomly, if IBM licensed GEOS for $100K / year for five years, would that be acceptable? 

One can write a lot of free software for $100K / year.

It's not uncommon for copyleft projects to self-support with relicensing deals. Wonder what our community members think about that.
P.

 

On Thu, Nov 9, 2017 at 6:16 AM, Greg Troxel <gdt at lexort.com <mailto:gdt at lexort.com> > wrote:


James Turner <james.turner at weather.com <mailto:james.turner at weather.com> > writes:

> We would like to know if alternative licensing is available for GEOS,
> as the object distribution requirements for the LGPL don’t really make
> any sense in iOS applications.

The key issue is that the permission granted is intended to be
conditioned on the user being able to do some things, and Apple chooses
not to let the user do those things.

The notion that "the iOS rules don't make sense" is an equally valid
viewpoint in this case.

Perhaps you could ask Apple to let users share Free Software that
they've obtained from the app store, with each other, and to add a way
for people to rebuild LGPL code, relink it, and install it on their
devices :-) Obviously I don't expect you to do that, and I don't expect
the request to be at all succesful, but this is basically why the Free
Software community is not receptive to "could you change your licensing
so I can distribute proprietary software via a mechanism that is
explicitly hostile to Free Software".


_______________________________________________
geos-devel mailing list
geos-devel at lists.osgeo.org <mailto:geos-devel at lists.osgeo.org> 
https://lists.osgeo.org/mailman/listinfo/geos-devel

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171109/e15f5eea/attachment-0001.html>

From fardet.tanguy at laposte.net  Sat Nov 11 19:30:06 2017
From: fardet.tanguy at laposte.net (Fardet Tanguy)
Date: Sun, 12 Nov 2017 04:30:06 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
	multithreading
Message-ID: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>

Dear GEOS developers,

I would like to know what is the proper way to initialize and use GEOS 
with OpenMP.
Indeed, I am encountering a segfault problem when using GEOS with 
multithreading enabled.

I first tried to ask people on SO because I am not 100% sure this issue 
is directly linked with GEOS (see post: 
https://stackoverflow.com/questions/47182166/segfault-when-testing-the-intersection-with-geos-in-parallel) 
but making sure that I am indeed using GEOS properly is crucial anyway.

Basically, what I need to do is test the intersection between one common 
object (the environment) and some thread-specific segments. You can find 
some details and code on the SO post 
<https://stackoverflow.com/questions/47182166/segfault-when-testing-the-intersection-with-geos-in-parallel>.

Thanks in advance,
best regards.

Tanguy Farde
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171112/9c27bd2f/attachment.html>

From geos-trac at osgeo.org  Fri Nov 17 15:05:14 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 17 Nov 2017 23:05:14 -0000
Subject: [geos-devel] [GEOS] #845: Head Use-After-Free
 geos::geomgraph::index::SweepLineEvent::isDelete()
Message-ID: <045.f3a4e4a45b09ccde692fccadab9bcd0b@osgeo.org>

#845: Head Use-After-Free geos::geomgraph::index::SweepLineEvent::isDelete()
------------------------+--------------------------
 Reporter:  goatbar     |      Owner:  geos-devel@…
     Type:  defect      |     Status:  new
 Priority:  major       |  Milestone:  3.6.3
Component:  Default     |    Version:  master
 Severity:  Unassigned  |   Keywords:
------------------------+--------------------------
 Related to #835, I setup a fuzzers for geos and indirectly for geos from
 fuzzers on GDAL.  I've hit this same bug via WKT, WKB, and GML.

 I'll go with the WKT version.  This is the fuzzer I'm using with GEOS and
 GDAL pretty much both at head.

 https://github.com/schwehr/gdal-
 autotest2/blob/master/cpp/ogr/ogrgeometryfactory_wkt_fuzzer.cc

 The crazy fuzzer proof of concept WKT:

 {{{
 CIRCULARSTRING(.        --.,-KAN-NpolygonJ-p--2         5.--0
            -2,      8 ..LI.        -1.--.,-NAN---Np--2
              5.,-    ---,0 -1                 ,.
              --      --)R
 }}}

 Calling GDAL's OGRGeometry dumpReadable, I get:

 {{{
 CIRCULARSTRING Z (0 0 0,0 5 -2,8 0 -1,nan 5.0 0,0 0 0,0 -1 0,0 0 0)
 }}}

 {{{
 AddressSanitizer: heap-use-after-free
 READ of size 8
     #0 geos::geomgraph::index::SweepLineEvent::isDelete()
 include/geos/geomgraph/index/SweepLineEvent.h:56:27
     #1
 geos::geomgraph::index::SimpleMCSweepLineIntersector::~SimpleMCSweepLineIntersector()
 src/geomgraph/index/SimpleMCSweepLineIntersector.cpp:42:12
     #2
 geos::geomgraph::index::SimpleMCSweepLineIntersector::~SimpleMCSweepLineIntersector()
 src/geomgraph/index/SimpleMCSweepLineIntersector.cpp:38:1
     #3
 geos::geomgraph::GeometryGraph::computeSelfNodes(geos::algorithm::LineIntersector&,
 bool, bool, geos::geom::Envelope const*)
 src/geomgraph/GeometryGraph.cpp:401:1
     #4
 geos::geomgraph::GeometryGraph::computeSelfNodes(geos::algorithm::LineIntersector&,
 bool, geos::geom::Envelope const*) src/geomgraph/GeometryGraph.cpp:366:9
     #5
 geos::operation::IsSimpleOp::isSimpleLinearGeometry(geos::geom::Geometry
 const*) src/operation/IsSimpleOp.cpp:174:46
     #6 geos::geom::Geometry::isSimple() const src/geom/Geometry.cpp:866:12
     #7 GEOSisRing_r capi/geos_ts_c.cpp:1756:25
     #8 OGRGeometry::IsRing() const gdal/ogr/ogrgeometry.cpp:2262:19
     #9 LLVMFuzzerTestOneInput
 gdal/autotest2/cpp/ogr/ogrgeometryfactory_wkt_fuzzer.cc:51:9

 located 40 bytes inside of 56-byte region
 freed here:
     #0 operator delete(void*, unsigned long) llvm/llvm/projects/compiler-
 rt/lib/asan/asan_new_delete.cc:153:3
     #1 geos::geomgraph::index::SweepLineEvent::~SweepLineEvent()
 src/geomgraph/index/SweepLineEvent.cpp:41:3
     #2 geos::geomgraph::index::SweepLineEvent::~SweepLineEvent()
 src/geomgraph/index/SweepLineEvent.cpp:39:34
     #3
 geos::geomgraph::index::SimpleMCSweepLineIntersector::~SimpleMCSweepLineIntersector()
 src/geomgraph/index/SimpleMCSweepLineIntersector.cpp:42:24
     #4
 geos::geomgraph::index::SimpleMCSweepLineIntersector::~SimpleMCSweepLineIntersector()
 src/geomgraph/index/SimpleMCSweepLineIntersector.cpp:38:1
     #5
 geos::geomgraph::GeometryGraph::computeSelfNodes(geos::algorithm::LineIntersector&,
 bool, bool, geos::geom::Envelope const*)
 src/geomgraph/GeometryGraph.cpp:401:1
     #6
 geos::geomgraph::GeometryGraph::computeSelfNodes(geos::algorithm::LineIntersector&,
 bool, geos::geom::Envelope const*) src/geomgraph/GeometryGraph.cpp:366:9
     #7
 geos::operation::IsSimpleOp::isSimpleLinearGeometry(geos::geom::Geometry
 const*) src/operation/IsSimpleOp.cpp:174:46
     #8 geos::geom::Geometry::isSimple() const src/geom/Geometry.cpp:866:12
     #9 GEOSisRing_r capi/geos_ts_c.cpp:1756:25
     #10 OGRGeometry::IsRing() const gdal/ogr/ogrgeometry.cpp:2262:19
     #11 LLVMFuzzerTestOneInput
 gdal/autotest2/cpp/ogr/ogrgeometryfactory_wkt_fuzzer.cc:51:9

 previously allocated here:
     #0 operator new(unsigned long) llvm/llvm/projects/compiler-
 rt/lib/asan/asan_new_delete.cc:92:3
     #1
 geos::geomgraph::index::SimpleMCSweepLineIntersector::add(geos::geomgraph::Edge*,
 void*) src/geomgraph/index/SimpleMCSweepLineIntersector.cpp:99:31
     #2
 geos::geomgraph::index::SimpleMCSweepLineIntersector::add(std::vector<geos::geomgraph::Edge*,
 std::allocator<geos::geomgraph::Edge*> >*, void*)
 src/geomgraph/index/SimpleMCSweepLineIntersector.cpp:84:3
     #3
 geos::geomgraph::index::SimpleMCSweepLineIntersector::computeIntersections(std::vector<geos::geomgraph::Edge*,
 std::allocator<geos::geomgraph::Edge*> >*,
 geos::geomgraph::index::SegmentIntersector*, bool)
 src/geomgraph/index/SimpleMCSweepLineIntersector.cpp:52:3
     #4
 geos::geomgraph::GeometryGraph::computeSelfNodes(geos::algorithm::LineIntersector&,
 bool, bool, geos::geom::Envelope const*)
 src/geomgraph/GeometryGraph.cpp:393:7
     #5
 geos::geomgraph::GeometryGraph::computeSelfNodes(geos::algorithm::LineIntersector&,
 bool, geos::geom::Envelope const*) src/geomgraph/GeometryGraph.cpp:366:9
     #6
 geos::operation::IsSimpleOp::isSimpleLinearGeometry(geos::geom::Geometry
 const*) src/operation/IsSimpleOp.cpp:174:46
     #7 geos::geom::Geometry::isSimple() const src/geom/Geometry.cpp:866:12
     #8 GEOSisRing_r capi/geos_ts_c.cpp:1756:25
     #9 OGRGeometry::IsRing() const gdal/ogr/ogrgeometry.cpp:2262:19
     #10 LLVMFuzzerTestOneInput
 gdal/autotest2/cpp/ogr/ogrgeometryfactory_wkt_fuzzer.cc:51:9
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/845>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Fri Nov 17 15:05:48 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 17 Nov 2017 23:05:48 -0000
Subject: [geos-devel] [GEOS] #845: Head Use-After-Free
 geos::geomgraph::index::SweepLineEvent::isDelete()
In-Reply-To: <045.f3a4e4a45b09ccde692fccadab9bcd0b@osgeo.org>
References: <045.f3a4e4a45b09ccde692fccadab9bcd0b@osgeo.org>
Message-ID: <060.e3f456d78818176d6b310f973f3ca47a@osgeo.org>

#845: Head Use-After-Free geos::geomgraph::index::SweepLineEvent::isDelete()
------------------------+---------------------------
 Reporter:  goatbar     |       Owner:  geos-devel@…
     Type:  defect      |      Status:  new
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  master
 Severity:  Unassigned  |  Resolution:
 Keywords:              |
------------------------+---------------------------
Changes (by goatbar):

 * Attachment "poc-
 2083faf16400ba496ef915c4b216d5290211f9b170f45613d89d0a03dc5f349d.wkt.gz"
 added.

 wkt causing heap use after free

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/845>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Mon Nov 20 00:51:16 2017
From: geos-trac at osgeo.org (GEOS)
Date: Mon, 20 Nov 2017 08:51:16 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
Message-ID: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+--------------------------
 Reporter:  landry      |      Owner:  geos-devel@…
     Type:  defect      |     Status:  new
 Priority:  major       |  Milestone:  3.6.3
Component:  Default     |    Version:  3.6.2
 Severity:  Unassigned  |   Keywords:
------------------------+--------------------------
 I have a build failure for 3.6.2 on sparc64 using gcc4.9; see http
 ://build-failures.rhaalovely.net//sparc64/2017-11-12/geo/geos.log for the
 full log, but the interesting part is:

 {{{
 ../../../include/geos/geom/Polygonal.h:1: error: stray '\357' in program
 ../../../include/geos/geom/Polygonal.h:1: error: stray '\273' in program
 ../../../include/geos/geom/Polygonal.h:1: error: stray '\277' in program
 In file included from ../../../include/geos/geom/MultiPolygon.h:29,
                  from IndexedPointInAreaLocator.cpp:19:
 ../../../include/geos/geom/Polygonal.h:1: error: stray '\357' in program
 ../../../include/geos/geom/Polygonal.h:1: error: stray '\273' in program
 ../../../include/geos/geom/Polygonal.h:1: error: stray '\277' in program
 In file included from ../../../include/geos/geom/LineString.h:27,
                  from IndexedPointInAreaLocator.cpp:20:
 ../../../include/geos/geom/Lineal.h:1: error: stray '\357' in program
 ../../../include/geos/geom/Lineal.h:1: error: stray '\273' in program
 ../../../include/geos/geom/Lineal.h:1: error: stray '\277' in program
 In file included from
 ../../../include/geos/util/IllegalArgumentException.h:22,
                  from IndexedPointInAreaLocator.cpp:25:
 ../../../include/geos/util/GEOSException.h:1: error: stray '\357' in
 program
 ../../../include/geos/util/GEOSException.h:1: error: stray '\273' in
 program
 ../../../include/geos/util/GEOSException.h:1: error: stray '\277' in
 program


 $file include/geos/*/*|grep ISO
 include/geos/geom/Lineal.h:                                   ISO-8859
 English text
 include/geos/geom/Polygonal.h:                                ISO-8859
 English text
 include/geos/geom/Puntal.h:                                   ISO-8859
 English text
 include/geos/util/GEOSException.h:                            ISO-8859
 English text
 }}}

 It seems those files start with an utf8 BOM:

 {{{
 $head -1 include/geos/geom/Lineal.h |hexdump
 0000000    bbef    2fbf    2a2a
 $head -1 include/geos/geom/IntersectionMatrix.h |hexdump
 0000000    2a2f    2a2a    2a2a
 }}}

 Pretty sure removing those wrong chars will fix my build.. either way they
 shouldnt be here :)

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Mon Nov 20 00:52:20 2017
From: geos-trac at osgeo.org (GEOS)
Date: Mon, 20 Nov 2017 08:52:20 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.31c54fadede718f5ed9440767d068104@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  new
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:
 Keywords:              |
------------------------+---------------------------

Comment (by landry):

 Err sorry that is with gcc 4.2.1 (yeah i know ancient)

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:1>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From Mika.Heiskanen at fmi.fi  Wed Nov 22 04:49:09 2017
From: Mika.Heiskanen at fmi.fi (Heiskanen Mika (FMI))
Date: Wed, 22 Nov 2017 12:49:09 +0000
Subject: [geos-devel] Supporting OGC winding rules for polygons
Message-ID: <1511354949414.78773@fmi.fi>

Hello,


Would it be possible to add support for OGC (v 1.2) winding rules? Currently

normalize() forces polygon exteriors to be clockwise and interiors to be

counter-clockwise. I had a quick look at the C++, and it looks like adding

a new virtual method with a boolean argument would be quite simple to

implement, and would not break the ABI if the flag is not made into an

optional argument with a default value. I did not check the C-API though.

In comparison, writing a free normalize function which would change the

winding rule seems to be quite cumbersome without direct access to the

object internals.


Regards,


Mika Heiskanen / FMI

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171122/29366b81/attachment.html>

From geos-trac at osgeo.org  Thu Nov 23 06:43:13 2017
From: geos-trac at osgeo.org (GEOS)
Date: Thu, 23 Nov 2017 14:43:13 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.7587586bb2346da907948f9cdf5d408b@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------
Changes (by Sandro Santilli <strk@…>):

 * status:  new => closed
 * resolution:   => fixed


Comment:

 In [changeset:"11476b5c1aee62c7be5ecfab03389e240b7e0966/git" 11476b5/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="11476b5c1aee62c7be5ecfab03389e240b7e0966"
 Remove BOM from header files

 It was accidentally added by fbb4431f84ba516b873961b373567ae79a1d92e2

 Fixes #846
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:2>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Thu Nov 23 06:43:13 2017
From: geos-trac at osgeo.org (GEOS)
Date: Thu, 23 Nov 2017 14:43:13 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.492d851bdbe30582d418bef6e9a4f1c0@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Sandro Santilli <strk@…>):

 In [changeset:"b5c0141cf50bc5c9c5b9e0591ea3f4d937224a25/git" b5c0141/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="b5c0141cf50bc5c9c5b9e0591ea3f4d937224a25"
 Another BOM removed

 This one was added in dbc52d41fd43bb9bdec31fc9969a66d05bc4bf95

 See #846
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:3>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Thu Nov 23 06:43:49 2017
From: geos-trac at osgeo.org (GEOS)
Date: Thu, 23 Nov 2017 14:43:49 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.af3b462ef46d7f395a7ff3f9e68b0b70@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by strk):

 Please check if [dbc52d41fd43bb9bdec31fc9969a66d05bc4bf95/git]
 builds fine there.

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:4>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From strk at kbt.io  Thu Nov 23 06:50:08 2017
From: strk at kbt.io (Sandro Santilli)
Date: Thu, 23 Nov 2017 15:50:08 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
Message-ID: <20171123145008.4cgkbo53xs5mbeck@liz>

On Sun, Nov 12, 2017 at 04:30:06AM +0100, Fardet Tanguy wrote:
> Dear GEOS developers,
> 
> I would like to know what is the proper way to initialize and use GEOS with
> OpenMP.
> Indeed, I am encountering a segfault problem when using GEOS with
> multithreading enabled.

Are you using the C or C++ API ?
When using the C API you can define
the GEOS_USE_ONLY_R_API macro to be
sure to be only using thread-safe methods.

If you find a non-reentrant path by using that
API then please file a bug report including
the smallest testcase.

--strk;

From geos-trac at osgeo.org  Thu Nov 23 07:00:58 2017
From: geos-trac at osgeo.org (GEOS)
Date: Thu, 23 Nov 2017 15:00:58 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.e8dafaf6c14cb89d031a912345b375af@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by landry):

 Hmmm well i saw the issue on 3.6 branch, and the fixes are on
 trunk/master, where there's now a requirement for c++1, which will force
 the use of a recent/decent compiler, which will support UTF-8 BOM (as
 that's already the case on amd64/i386 for OpenBSD) - so that should work
 in all cases now, but i cant really test now, unless the commits are
 backported to 3.6.

 Either way, thanks for fixing it!

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:5>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From fardet.tanguy at laposte.net  Thu Nov 23 07:20:58 2017
From: fardet.tanguy at laposte.net (Tanguy Fardet)
Date: Thu, 23 Nov 2017 16:20:58 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <20171123145008.4cgkbo53xs5mbeck@liz>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
 <20171123145008.4cgkbo53xs5mbeck@liz>
Message-ID: <790cf199-2da6-074c-a4fd-25960bcd8143@laposte.net>

Hi,
thank you for your answer.

I am using the C API, and your macro allowed me to find a few places 
where I was using non-reentrant functions.
After recompiling, the code still fails if I remove the critical 
section, though.
Unfortunately, the code of the simulator is quite complex so I cannot 
really provide a MWE, the best I can give is what is on the SO post and 
the backtrace.

The new backtrace reads:

    Thread 22 "python" received signal SIGSEGV, Segmentation fault.
    [Switching to Thread 0x7fffa126e700 (LWP 6548)]
    0x00007fffa220fb35 in
    geos::noding::MCIndexSegmentSetMutualIntersector::intersectChains()
    () from /usr/lib/libgeos-3.6.2.so
    (gdb) bt
    #0  0x00007fffa220fb35 in
    geos::noding::MCIndexSegmentSetMutualIntersector::intersectChains()
    () from /usr/lib/libgeos-3.6.2.so
    #1  0x00007fffa220d661 in
    geos::noding::FastSegmentSetIntersectionFinder::intersects(std::vector<geos::noding::SegmentString
    const*, std::allocator<geos::noding::SegmentString const*> >*,
    geos::noding::SegmentIntersectionDetector*) ()
        from /usr/lib/libgeos-3.6.2.so
    #2  0x00007fffa220d6d5 in
    geos::noding::FastSegmentSetIntersectionFinder::intersects(std::vector<geos::noding::SegmentString
    const*, std::allocator<geos::noding::SegmentString const*> >*) ()
    from /usr/lib/libgeos-3.6.2.so
    #3  0x00007fffa21d55ca in
    geos::geom::prep::PreparedLineStringIntersects::intersects(geos::geom::Geometry
    const*) const () from /usr/lib/libgeos-3.6.2.so
    #4  0x00007fffa21d4f96 in
    geos::geom::prep::PreparedLineString::intersects(geos::geom::Geometry
    const*) const () from /usr/lib/libgeos-3.6.2.so
    #5  0x00007fffa24df380 in GEOSPreparedIntersects_r ()
        from /usr/lib/libgeos_c.so.1
    #6  0x00007fffa27e391b in growth::SpaceManager::env_intersect (
         this=0x555555f68918, line=std::shared_ptr (count 1, weak 0)
    0x7fff8c001430)
         at
    /home/tfardet/Documents/GitLabo/Growth/src/kernel/space_manager.cpp:122

L122 is in the code on the SO post 
<https://stackoverflow.com/questions/47182166/segfault-when-testing-the-intersection-with-geos-in-parallel>. 
Hope this helps.

In the meantime, I will try generating one PreparedGeometry object per 
thread to see if this helps.

Best,
Tanguy


Le 23/11/2017 à 15:50, Sandro Santilli a écrit :
> Are you using the C or C++ API ?
> When using the C API you can define
> the GEOS_USE_ONLY_R_API macro to be
> sure to be only using thread-safe methods.
>
> If you find a non-reentrant path by using that
> API then please file a bug report including
> the smallest testcase.
>
> --strk;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20171123/b44637bb/attachment.html>

From fardet.tanguy at laposte.net  Thu Nov 23 09:05:56 2017
From: fardet.tanguy at laposte.net (Tanguy Fardet)
Date: Thu, 23 Nov 2017 18:05:56 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <20171123145008.4cgkbo53xs5mbeck@liz>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
 <20171123145008.4cgkbo53xs5mbeck@liz>
Message-ID: <c3f887a1-5360-6fc3-8c76-ca40cad0323f@laposte.net>

Hi again,

just to let you know that the segfault dissapears if I store 
oneGEOSPreparedGeometry copy of the global GEOSGeom evironment per 
OpenMP thread and use the thread-specific copy in GEOSPreparedIntersects_r.

Thus, it seems that, at least in my code and GEOS 3.6.2, the API is not 
providing thread safe access to shared data using OpenMP.

Best,
Tanguy


Le 23/11/2017 à 15:50, Sandro Santilli a écrit :
> Are you using the C or C++ API ?
> When using the C API you can define
> the GEOS_USE_ONLY_R_API macro to be
> sure to be only using thread-safe methods.
>
> If you find a non-reentrant path by using that
> API then please file a bug report including
> the smallest testcase.
>
> --strk;

From geos-trac at osgeo.org  Thu Nov 23 10:46:10 2017
From: geos-trac at osgeo.org (GEOS)
Date: Thu, 23 Nov 2017 18:46:10 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.3c9dca2834565892dd4255ee707c50f5@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Sandro Santilli <strk@…>):

 In [changeset:"a1f79c734a190ea68cbc8543665e4603f84523d2/git"
 a1f79c73/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="a1f79c734a190ea68cbc8543665e4603f84523d2"
 Remove BOM from header files

 It was accidentally added by fbb4431f84ba516b873961b373567ae79a1d92e2

 Fixes #846
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:6>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Thu Nov 23 10:46:11 2017
From: geos-trac at osgeo.org (GEOS)
Date: Thu, 23 Nov 2017 18:46:11 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.545795b450b9e762364e237572479cca@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Sandro Santilli <strk@…>):

 In [changeset:"78913af14cd047b87a644d084fa7c2acfebd4e01/git"
 78913af1/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="78913af14cd047b87a644d084fa7c2acfebd4e01"
 Another BOM removed

 This one was added in dbc52d41fd43bb9bdec31fc9969a66d05bc4bf95

 See #846
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:7>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Thu Nov 23 10:46:22 2017
From: geos-trac at osgeo.org (GEOS)
Date: Thu, 23 Nov 2017 18:46:22 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.be53506c4cf802895d972e19d2757c82@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by strk):

 Please check with 04a19a5d, in svn-3.6 branch

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:8>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From strk at kbt.io  Thu Nov 23 23:46:14 2017
From: strk at kbt.io (Sandro Santilli)
Date: Fri, 24 Nov 2017 08:46:14 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <c3f887a1-5360-6fc3-8c76-ca40cad0323f@laposte.net>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
 <20171123145008.4cgkbo53xs5mbeck@liz>
 <c3f887a1-5360-6fc3-8c76-ca40cad0323f@laposte.net>
Message-ID: <20171124074614.agznakv7qymgbuow@liz>

On Thu, Nov 23, 2017 at 06:05:56PM +0100, Tanguy Fardet wrote:
> Hi again,
> 
> just to let you know that the segfault dissapears if I store
> oneGEOSPreparedGeometry copy of the global GEOSGeom evironment per OpenMP
> thread and use the thread-specific copy in GEOSPreparedIntersects_r.
> 
> Thus, it seems that, at least in my code and GEOS 3.6.2, the API is not
> providing thread safe access to shared data using OpenMP.

There's currently no use of locks in base classes to protect
mutable resources, while there are some of them lazy cache
creators. Improving that situation is welcome, if you are up
to send patches.

--strk;

From strk at kbt.io  Fri Nov 24 00:09:31 2017
From: strk at kbt.io (Sandro Santilli)
Date: Fri, 24 Nov 2017 09:09:31 +0100
Subject: [geos-devel] Supporting OGC winding rules for polygons
In-Reply-To: <1511354949414.78773@fmi.fi>
References: <1511354949414.78773@fmi.fi>
Message-ID: <20171124080931.pmmoxewgndj7l36o@liz>

On Wed, Nov 22, 2017 at 12:49:09PM +0000, Heiskanen Mika (FMI) wrote:

> Would it be possible to add support for OGC (v 1.2) winding rules?

A patch is welcome. I'm not concerned about ABI at the C++ level,
but adding a parameter to a virtual method may break existing
codebases in a subtle way (ie: no error/warning at compile time but
overrides will not be called) so maybe is better to just expose
a *new* virtual method ? But I'm also happy to just document the
change very prominently in the NEWS file.

As in master we're not allowing use of C++11 it may be good to add
the "override" specifier to be more robust about these cases at
least inside GEOS itself:
http://en.cppreference.com/w/cpp/language/override

If you go with the optional argument please consider making it
extensible. There is a case of using BoundaryNodeRule enum, which
could be similar in spirit.

> I did not check the C-API though.

New function would be needed there anyway. GEOSNormalizeOGC ?

--strk;

From geos-trac at osgeo.org  Fri Nov 24 01:12:23 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 24 Nov 2017 09:12:23 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.38809ecd9513f81f1120282902dd6365@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by landry):

 Hah, there's another bunch (in 3.6 branch):

 {{{
 CGAlgorithms.cpp:1: error: stray '\357' in program
 CGAlgorithms.cpp:1: error: stray '\273' in program
 CGAlgorithms.cpp:1: error: stray '\277' in program

 LineIntersector.cpp:1: error: stray '\357' in program
 LineIntersector.cpp:1: error: stray '\273' in program
 LineIntersector.cpp:1: error: stray '\277' in program
 ...
 ...
 }}}

 To find them all, some shell fu helps
 {{{
 find src/ include/ |while read f ; do file $f ; done |grep ISO
 src/algorithm/CGAlgorithms.cpp: ISO-8859 English text
 src/algorithm/LineIntersector.cpp: ISO-8859 English text
 src/geom/IntersectionMatrix.cpp: ISO-8859 English text
 include/geos/index/strtree/AbstractSTRtree.h: ISO-8859 English text


 }}}

 With those 4 files locally fixed, git branch svn-3.6 builds fine with g++
 4.2.1 on OpenBSD/amd64.

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:9>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Fri Nov 24 04:14:40 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 24 Nov 2017 12:14:40 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.8734f1dd6fe26a6e825953c889dbcc97@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Mateusz Loskot <mateusz@…>):

 In [changeset:"c292ffd76375a8f725bb7d889e3206c29f76b6b6/git" c292ffd/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="c292ffd76375a8f725bb7d889e3206c29f76b6b6"
 Remove BOM mark

 Fixes #846
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:10>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Fri Nov 24 04:15:48 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 24 Nov 2017 12:15:48 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.f10899a57ff728cd514560a4901b89f3@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by mloskot):

 Fixed in PR https://git.osgeo.org/gogs/geos/geos/pulls/17

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:11>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From fardet.tanguy at laposte.net  Fri Nov 24 05:04:05 2017
From: fardet.tanguy at laposte.net (Tanguy Fardet)
Date: Fri, 24 Nov 2017 14:04:05 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <20171124074614.agznakv7qymgbuow@liz>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
 <20171123145008.4cgkbo53xs5mbeck@liz>
 <c3f887a1-5360-6fc3-8c76-ca40cad0323f@laposte.net>
 <20171124074614.agznakv7qymgbuow@liz>
Message-ID: <a670a97f-fded-e579-b215-b7929fd33902@laposte.net>

Thanks for the answer.

The situation is not necessarily bothersome to me now that I know about 
that fact.

The problem was that the API is labeled "thread safe" when it is not... 
When time permits, I think including a short documentation describing 
exactly what is safe and what is not would be a valuable addition for users.

Best,
Tanguy


Le 24/11/2017 à 08:46, Sandro Santilli a écrit :
> On Thu, Nov 23, 2017 at 06:05:56PM +0100, Tanguy Fardet wrote:
>> Hi again,
>>
>> just to let you know that the segfault dissapears if I store
>> oneGEOSPreparedGeometry copy of the global GEOSGeom evironment per OpenMP
>> thread and use the thread-specific copy in GEOSPreparedIntersects_r.
>>
>> Thus, it seems that, at least in my code and GEOS 3.6.2, the API is not
>> providing thread safe access to shared data using OpenMP.
> There's currently no use of locks in base classes to protect
> mutable resources, while there are some of them lazy cache
> creators. Improving that situation is welcome, if you are up
> to send patches.
>
> --strk;

From geos-trac at osgeo.org  Fri Nov 24 06:29:19 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 24 Nov 2017 14:29:19 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.53ed736d2d1f856466ba27be9f836531@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Mateusz Loskot <mateusz@…>):

 In [changeset:"c292ffd76375a8f725bb7d889e3206c29f76b6b6/git" c292ffd/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="c292ffd76375a8f725bb7d889e3206c29f76b6b6"
 Remove BOM mark

 Fixes #846
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:12>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Fri Nov 24 06:30:05 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 24 Nov 2017 14:30:05 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.3abb24b189bd4ccbae8effb61fa356fd@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Sandro Santilli <strk@…>):

 In [changeset:"b0690d0cb658217e53fd7a15f66a486d7910558e/git" b0690d0/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="b0690d0cb658217e53fd7a15f66a486d7910558e"
 Remove BOM mark

 Fixes #846
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:13>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Fri Nov 24 06:34:31 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 24 Nov 2017 14:34:31 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.52530de37f28c163adb6160d92ea8b00@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by strk):

 Landry is it fine now ? [b0690d0cb6/git] in 3.6 branch

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:14>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Fri Nov 24 07:26:18 2017
From: geos-trac at osgeo.org (GEOS)
Date: Fri, 24 Nov 2017 15:26:18 -0000
Subject: [geos-devel] [GEOS] #846: UTF8 BOM in headers ?
In-Reply-To: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
References: <044.a5625973cc1d9780bba31c5fe1a10861@osgeo.org>
Message-ID: <059.c81755375cc510a4ee3e31d914455d25@osgeo.org>

#846: UTF8 BOM in headers ?
------------------------+---------------------------
 Reporter:  landry      |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.3
Component:  Default     |     Version:  3.6.2
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by landry):

 Yep, incremental built went fine here.. thanks !

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/846#comment:15>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From strk at kbt.io  Fri Nov 24 12:25:37 2017
From: strk at kbt.io (Sandro Santilli)
Date: Fri, 24 Nov 2017 21:25:37 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <a670a97f-fded-e579-b215-b7929fd33902@laposte.net>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
 <20171123145008.4cgkbo53xs5mbeck@liz>
 <c3f887a1-5360-6fc3-8c76-ca40cad0323f@laposte.net>
 <20171124074614.agznakv7qymgbuow@liz>
 <a670a97f-fded-e579-b215-b7929fd33902@laposte.net>
Message-ID: <20171124202537.snszc6hz2a6prxzl@liz>

On Fri, Nov 24, 2017 at 02:04:05PM +0100, Tanguy Fardet wrote:

> The problem was that the API is labeled "thread safe" when it is not...

The API is, the implementation isn't ...

--strk;

From fardet.tanguy at laposte.net  Fri Nov 24 13:15:58 2017
From: fardet.tanguy at laposte.net (Fardet Tanguy)
Date: Fri, 24 Nov 2017 22:15:58 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <20171124202537.snszc6hz2a6prxzl@liz>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
 <20171123145008.4cgkbo53xs5mbeck@liz>
 <c3f887a1-5360-6fc3-8c76-ca40cad0323f@laposte.net>
 <20171124074614.agznakv7qymgbuow@liz>
 <a670a97f-fded-e579-b215-b7929fd33902@laposte.net>
 <20171124202537.snszc6hz2a6prxzl@liz>
Message-ID: <135ad59b-4fcf-2fb2-f3bd-e0f5da89cbbf@laposte.net>

>> The problem was that the API is labeled "thread safe" when it is not...
> The API is, the implementation isn't ...
I'm not sure I understand, could you elaborate? It feels like I'm 
missing an important concept here.
Sorry to drag on this, but since I'm probably going to use GEOS for some 
time, I'd rather make sure I get that part.

Thanks in advance,
T

From strk at kbt.io  Sat Nov 25 07:40:40 2017
From: strk at kbt.io (Sandro Santilli)
Date: Sat, 25 Nov 2017 16:40:40 +0100
Subject: [geos-devel] Segmentation fault when using intersect with
 multithreading
In-Reply-To: <135ad59b-4fcf-2fb2-f3bd-e0f5da89cbbf@laposte.net>
References: <15b5414e-6f8e-ab14-cf06-ac988e13b007@laposte.net>
 <20171123145008.4cgkbo53xs5mbeck@liz>
 <c3f887a1-5360-6fc3-8c76-ca40cad0323f@laposte.net>
 <20171124074614.agznakv7qymgbuow@liz>
 <a670a97f-fded-e579-b215-b7929fd33902@laposte.net>
 <20171124202537.snszc6hz2a6prxzl@liz>
 <135ad59b-4fcf-2fb2-f3bd-e0f5da89cbbf@laposte.net>
Message-ID: <20171125154040.o42geswauiflvxev@liz>

On Fri, Nov 24, 2017 at 10:15:58PM +0100, Fardet Tanguy wrote:
> > > The problem was that the API is labeled "thread safe" when it is not...
> > The API is, the implementation isn't ...
> I'm not sure I understand, could you elaborate? It feels like I'm missing an
> important concept here.
> Sorry to drag on this, but since I'm probably going to use GEOS for some
> time, I'd rather make sure I get that part.

Someone drafted and committed a version of the C-API
which would allow not using a global context variable,
opening the possibility for it to be re-entrant.

But there are some static variables used in the C++
implementation that are initialized on first call
which may suffer from race conditions when multiple
threads access them.

That's just to say you should be able to keep using
the interface, but we need to fix the thread safety
issues.

--strk;

From geos-trac at osgeo.org  Tue Nov 28 00:32:17 2017
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 28 Nov 2017 08:32:17 -0000
Subject: [geos-devel] [GEOS] #741: [PATCH] GEOSSimplify() returns empty
 polygon if inner ring dimension < simplify distance
In-Reply-To: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
References: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
Message-ID: <060.db63c4ac1532d9237116ae8fbbd76bdd@osgeo.org>

#741: [PATCH] GEOSSimplify() returns empty polygon if inner ring dimension <
simplify distance
------------------------+---------------------------
 Reporter:  rouault     |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.1
Component:  Default     |     Version:  master
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Bas Couwenberg):

 Replying to [comment:9 strk]:
 > Done in trunk and 3.6 branch (for 3.6.1) - thanks

 Can the change also be included in the 3.5 branch?

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/741#comment:13>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Nov 28 00:32:41 2017
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 28 Nov 2017 08:32:41 -0000
Subject: [geos-devel] [GEOS] #741: [PATCH] GEOSSimplify() returns empty
 polygon if inner ring dimension < simplify distance
In-Reply-To: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
References: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
Message-ID: <060.57d0f57e805ac75ae244ca9a0d91b046@osgeo.org>

#741: [PATCH] GEOSSimplify() returns empty polygon if inner ring dimension <
simplify distance
------------------------+---------------------------
 Reporter:  rouault     |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.1
Component:  Default     |     Version:  master
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------
Changes (by Bas Couwenberg):

 * cc: sebastic@… (added)


--
Ticket URL: <https://trac.osgeo.org/geos/ticket/741#comment:14>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Nov 28 02:59:20 2017
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 28 Nov 2017 10:59:20 -0000
Subject: [geos-devel] [GEOS] #741: [PATCH] GEOSSimplify() returns empty
 polygon if inner ring dimension < simplify distance
In-Reply-To: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
References: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
Message-ID: <060.58e7ec3e3122a9bfe5b35d96c190118b@osgeo.org>

#741: [PATCH] GEOSSimplify() returns empty polygon if inner ring dimension <
simplify distance
------------------------+---------------------------
 Reporter:  rouault     |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.1
Component:  Default     |     Version:  master
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by strk):

 Could you prepare a patch for that ?
 Can be a pull request for the git
 repository (official hoster or any mirror).

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/741#comment:15>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Nov 28 09:46:18 2017
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 28 Nov 2017 17:46:18 -0000
Subject: [geos-devel] [GEOS] #741: [PATCH] GEOSSimplify() returns empty
 polygon if inner ring dimension < simplify distance
In-Reply-To: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
References: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
Message-ID: <060.12b1ae4af63385be47323299a9ea63bc@osgeo.org>

#741: [PATCH] GEOSSimplify() returns empty polygon if inner ring dimension <
simplify distance
------------------------+---------------------------
 Reporter:  rouault     |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.1
Component:  Default     |     Version:  master
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Bas Couwenberg <sebastic@…>):

 In [changeset:"710ddbe48177c215f98dd5e90fb64460b35401a7/git" 710ddbe/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="710ddbe48177c215f98dd5e90fb64460b35401a7"
 Fix empty GEOSSimplify return on inner ring collapse

 Patch by Even Rouault
 See #741

 git-svn-id: http://svn.osgeo.org/geos/trunk at 4311 5242fede-
 7e19-0410-aef8-94bd7d2200fb
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/741#comment:16>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Nov 28 10:53:36 2017
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 28 Nov 2017 18:53:36 -0000
Subject: [geos-devel] [GEOS] #741: [PATCH] GEOSSimplify() returns empty
 polygon if inner ring dimension < simplify distance
In-Reply-To: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
References: <045.24f715a14f26fc5c9e65b45b150aa16e@osgeo.org>
Message-ID: <060.b6857979b85316973d52b4e67d51722a@osgeo.org>

#741: [PATCH] GEOSSimplify() returns empty polygon if inner ring dimension <
simplify distance
------------------------+---------------------------
 Reporter:  rouault     |       Owner:  geos-devel@…
     Type:  defect      |      Status:  closed
 Priority:  major       |   Milestone:  3.6.1
Component:  Default     |     Version:  master
 Severity:  Unassigned  |  Resolution:  fixed
 Keywords:              |
------------------------+---------------------------

Comment (by Bas Couwenberg <sebastic@…>):

 In [changeset:"710ddbe48177c215f98dd5e90fb64460b35401a7/git" 710ddbe/git]:
 {{{
 #!CommitTicketReference repository="git"
 revision="710ddbe48177c215f98dd5e90fb64460b35401a7"
 Fix empty GEOSSimplify return on inner ring collapse

 Patch by Even Rouault
 See #741

 git-svn-id: http://svn.osgeo.org/geos/trunk at 4311 5242fede-
 7e19-0410-aef8-94bd7d2200fb
 }}}

--
Ticket URL: <https://trac.osgeo.org/geos/ticket/741#comment:17>
GEOS <http://trac.osgeo.org/geos>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

