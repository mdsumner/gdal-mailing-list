From kohtsuka at atr-p.com  Tue Jun  1 04:08:53 2010
From: kohtsuka at atr-p.com (OHTSUKA Ko-hei)
Date: Tue Jun  1 04:08:56 2010
Subject: [geos-devel] Is there a license problem to use GEOS in iPhone App?
Message-ID: <AANLkTilFTfotvnS-q0xxYp4HpbZAF90sMRmyu78uUhFn@mail.gmail.com>

Hello,

I want to use GEOS in iPhone App, as base of spatialite library.
But GEOS is LGPL License, and Apple forces all Applications must be
made as Static linked binary.

Is there any way to use GEOS in iPhone App?

Regards,

Ko-hei

-- 
HTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHT

????ATR-Promotions ?????????????
??????
?????

?619-0228???????????????2-2-2
?TEL?0774-95-2636?FAX?0774-95-1191
Mail?kohtsuka@atr-p.com

HTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHT
From pramsey at opengeo.org  Tue Jun  1 07:53:46 2010
From: pramsey at opengeo.org (Paul Ramsey)
Date: Tue Jun  1 07:53:49 2010
Subject: [geos-devel] WKTReader requiring uppercase keywords?
In-Reply-To: <4C047E7C.5040204@pobox.com>
References: <4C047E7C.5040204@pobox.com>
Message-ID: <AANLkTimNRqNw5ZZr2awJeEXTjoTK9bePWR_2vscnHAMk@mail.gmail.com>

Fine w/ me.

P

On Mon, May 31, 2010 at 11:29 PM, Frank Warmerdam <warmerdam@pobox.com> wrote:
> Folks,
>
> Does anyone know why the WKTReader requires the WKT keywords like "POINT" to
> be in upper case? ? This seems needlessly pendantic, and I'd like to relax
> it so that mixed and lower case keywords work as well. ?This is convenient
> for me when hand preparing WKT for SQL operations.
>
> Best regards,
> --
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up ? | Frank Warmerdam,
> warmerdam@pobox.com
> light and sound - activate the windows | http://pobox.com/~warmerdam
> and watch the world go round - Rush ? ?| Geospatial Programmer for Rent
>
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
From novalis at novalis.org  Tue Jun  1 09:27:05 2010
From: novalis at novalis.org (David Turner)
Date: Tue Jun  1 09:32:18 2010
Subject: [geos-devel] Is there a license problem to use GEOS in iPhone App?
In-Reply-To: <AANLkTilFTfotvnS-q0xxYp4HpbZAF90sMRmyu78uUhFn@mail.gmail.com>
References: <AANLkTilFTfotvnS-q0xxYp4HpbZAF90sMRmyu78uUhFn@mail.gmail.com>
Message-ID: <1275398825.19812.4.camel@cory>

On Tue, 2010-06-01 at 17:08 +0900, OHTSUKA Ko-hei wrote:
> Hello,
> 
> I want to use GEOS in iPhone App, as base of spatialite library.
> But GEOS is LGPL License, and Apple forces all Applications must be
> made as Static linked binary.
> 
> Is there any way to use GEOS in iPhone App?

The LGPL doesn't forbid static linking -- it just requires that you
provide a relinkable version.  Basically, if you provide the .o files
and makefiles for your proprietary app, and the source code for GEOS,
then users can change the library and rebuild your app.

However, you're going to have a *different* problem:
http://www.fsf.org/news/2010-05-app-store-compliance/


From mateusz at loskot.net  Tue Jun  1 10:29:12 2010
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue Jun  1 10:29:14 2010
Subject: [geos-devel] Re: WKTReader requiring uppercase keywords?
In-Reply-To: <4C047E7C.5040204@pobox.com>
References: <4C047E7C.5040204@pobox.com>
Message-ID: <1275402552825-5126246.post@n2.nabble.com>



Frank Warmerdam wrote:
> Does anyone know why the WKTReader requires the WKT keywords like "POINT"
> to be in upper case?

Original OGC spefication of BNF was not clear about case-sensitivity of
Well-Known-Text
and perhaps GEOS assumed it's safer to follow WKT examples presented by OGC.
More recent spec is more specific and says: "Well known text is case
insensitive."

There was similar discussion http://trac.osgeo.org/postgis/ticket/332

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

-----
-- 
Mateusz Loskot
http://mateusz.loskot.net
-- 
View this message in context: http://osgeo-org.1803224.n2.nabble.com/WKTReader-requiring-uppercase-keywords-tp5124345p5126246.html
Sent from the GEOS Developers mailing list archive at Nabble.com.
From warmerdam at pobox.com  Tue Jun  1 10:42:29 2010
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Tue Jun  1 10:42:34 2010
Subject: [geos-devel] Re: WKTReader requiring uppercase keywords?
In-Reply-To: <1275402552825-5126246.post@n2.nabble.com>
References: <4C047E7C.5040204@pobox.com>
	<1275402552825-5126246.post@n2.nabble.com>
Message-ID: <4C051C55.9070102@pobox.com>

Mateusz Loskot wrote:
> 
> Frank Warmerdam wrote:
>> Does anyone know why the WKTReader requires the WKT keywords like "POINT"
>> to be in upper case?
> 
> Original OGC spefication of BNF was not clear about case-sensitivity of
> Well-Known-Text
> and perhaps GEOS assumed it's safer to follow WKT examples presented by OGC.
> More recent spec is more specific and says: "Well known text is case
> insensitive."
> 
> There was similar discussion http://trac.osgeo.org/postgis/ticket/332

Mateusz,

Excellent, I'll make the WKTReader case insensitive.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From rblatt at warmlyyours.com  Thu Jun  3 13:38:16 2010
From: rblatt at warmlyyours.com (Ramie Blatt)
Date: Thu Jun  3 13:38:19 2010
Subject: [geos-devel] Re: SWIG Ruby bindings on OS X
In-Reply-To: <263713070912120846s6bacbe69x5e6c4a7cf014c7d3@mail.gmail.com>
References: <263713070912120846s6bacbe69x5e6c4a7cf014c7d3@mail.gmail.com>
Message-ID: <1275586696044-5136112.post@n2.nabble.com>


Hi there, I came across this post and thought I'd share my experiences. This
may be out of date, but here's the last crucial step I took to get it
working:

On Mac OS you need to rename the "geos.so" file in the ruby extension/plugin
directory to "geos.bundle". When you do the ./configure step above it will
display what your system's ruby extension directory is. You will need to
scroll up through the output to find the line: "Ruby extension directory is
'XYZ'. So, for e.g., if your ruby extension directory is
/usr/local/lib/ruby/site_ruby/1.8/i686-darwin8.10.1/ then do the following:

 cd /usr/local/lib/ruby/site_ruby/1.8/i686-darwin8.10.1/
 mv geos.so geos.bundle

Confirm correct installation by requiring GEOS in irb, you should have the
result "true":

 irb
 irb(main):001:0> require 'geos'
 => true
-- 
View this message in context: http://osgeo-org.1803224.n2.nabble.com/SWIG-Ruby-bindings-on-OS-X-tp4156738p5136112.html
Sent from the GEOS Developers mailing list archive at Nabble.com.
From kohtsuka at atr-p.com  Wed Jun  9 05:27:15 2010
From: kohtsuka at atr-p.com (OHTSUKA Ko-hei)
Date: Wed Jun  9 05:27:17 2010
Subject: [geos-devel] Is there a license problem to use GEOS in iPhone 
	App?
In-Reply-To: <1275398825.19812.4.camel@cory>
References: <AANLkTilFTfotvnS-q0xxYp4HpbZAF90sMRmyu78uUhFn@mail.gmail.com>
	<1275398825.19812.4.camel@cory>
Message-ID: <AANLkTinJB_6ddaIf0P5YPWlu2z7JFdq4KmKI6_ijP99_@mail.gmail.com>

Thanks, David, I forgot about it.
Your advice is very helpful for me.

2010/6/1 David Turner <novalis@novalis.org>:
> On Tue, 2010-06-01 at 17:08 +0900, OHTSUKA Ko-hei wrote:
>> Hello,
>>
>> I want to use GEOS in iPhone App, as base of spatialite library.
>> But GEOS is LGPL License, and Apple forces all Applications must be
>> made as Static linked binary.
>>
>> Is there any way to use GEOS in iPhone App?
>
> The LGPL doesn't forbid static linking -- it just requires that you
> provide a relinkable version.  Basically, if you provide the .o files
> and makefiles for your proprietary app, and the source code for GEOS,
> then users can change the library and rebuild your app.
>
> However, you're going to have a *different* problem:
> http://www.fsf.org/news/2010-05-app-store-compliance/
>
>
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>



-- 
HTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHT

????ATR-Promotions ?????????????
??????
?????

?619-0228???????????????2-2-2
?TEL?0774-95-2636?FAX?0774-95-1191
Mail?kohtsuka@atr-p.com

HTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHTHT
From pramsey at cleverelephant.ca  Wed Jun  9 11:55:15 2010
From: pramsey at cleverelephant.ca (Paul Ramsey)
Date: Wed Jun  9 11:55:30 2010
Subject: [geos-devel] FOSS4G 2010 Early Bird Deadline: June 15
Message-ID: <AANLkTimsbiQtw8Kx4NjQwug64G5s7wRJtc_FfhHHXNLg@mail.gmail.com>

If you plan to come to Barcelona, Spain for the Free and Open Source
Software for Geospatial conference in Semptember this year, then you
best register right now, as early bird registration ends this Tuesday
15 June 2010.
http://2010.foss4g.org/registration.php

FOSS4G is the international Free and Open Source Software for
Geospatial conference, which comes to Barcelona, Spain, 6-9 September
2010.
From maxime at altribe.org  Fri Jun 11 05:15:51 2010
From: maxime at altribe.org (Maxime van Noppen)
Date: Fri Jun 11 05:45:07 2010
Subject: [geos-devel] Missing const on Geometry::isWithinDistance
Message-ID: <4C11FEC7.1030206@altribe.org>

Hi,

It seems that the method Geometry::isWithinDistance is const while not
flagged as such. Could it be possible to make it const ?

Thanks,

-- 
Maxime
From strk at keybit.net  Mon Jun 14 04:03:24 2010
From: strk at keybit.net (strk)
Date: Mon Jun 14 04:03:30 2010
Subject: [geos-devel] Missing const on Geometry::isWithinDistance
In-Reply-To: <4C11FEC7.1030206@altribe.org>
References: <4C11FEC7.1030206@altribe.org>
Message-ID: <20100614080324.GM51187@keybit.net>

On Fri, Jun 11, 2010 at 11:15:51AM +0200, Maxime van Noppen wrote:

> It seems that the method Geometry::isWithinDistance is const while not
> flagged as such. Could it be possible to make it const ?

Do you mind filing a bug for this ?
http://trac.osgeo.org/geos

Thank you .

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From geos-trac at osgeo.org  Mon Jun 14 04:41:47 2010
From: geos-trac at osgeo.org (GEOS)
Date: Mon Jun 14 04:41:49 2010
Subject: [geos-devel] [GEOS] #349: Missing const on
	Geometry::isWithinDistance
Message-ID: <044.d27df3541b54a454beeb4c98fc1dcc3b@osgeo.org>

#349: Missing const on Geometry::isWithinDistance
------------------------+---------------------------------------------------
 Reporter:  yabo        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 It seems that the method Geometry::isWithinDistance is const while not
 flagged as such. Could it be possible to make it const ?

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/349>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Mon Jun 14 09:47:19 2010
From: geos-trac at osgeo.org (GEOS)
Date: Mon Jun 14 09:47:22 2010
Subject: [geos-devel] [GEOS] #350: TopologyException on operations on valid
	geometries
Message-ID: <044.e263e78fce00b2617dfa712edd8ee2db@osgeo.org>

#350: TopologyException on operations on valid geometries
------------------------+---------------------------------------------------
 Reporter:  yabo        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 I get a TopologyException for operations between these two geometries
 (reduced as much as I could from original geometry) :

 {{{
 wkb1 =
 01060000000100000001030000000100000007000000000000005C3613C1000000000028A54000000000208D14C1000000000028A5C000000000A83F15C100000000C0A6D040981124BD63B414C1B82DC4EB7C969940CA5EE746E76814C120462E0E5B4A8A40323BFF843F4B14C1C77B5B2D590C9AC0000000005C3613C1000000000028A540

 wkb2 =
 01060000000100000001030000000100000005000000EF2CF4FC0ED315C1F4792E801F82B6C0477F50A83BA313C12242DCE0BE81B2C0203301B73FCE13C14FB2744AB1EBD24029062D840ECE15C161DDB50E8D6BD140EF2CF4FC0ED315C1F4792E801F82B6C0
 }}}

 isValid() returns true for both geometries while almost any operation
 fails with geos-3.2.1 and svn-trunk (r2999).

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/350>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Mon Jun 14 09:57:19 2010
From: geos-trac at osgeo.org (GEOS)
Date: Mon Jun 14 09:57:22 2010
Subject: [geos-devel] [GEOS] #351: Missing includes
Message-ID: <044.8a91459b2cedfe51267aefc38e411909@osgeo.org>

#351: Missing includes
------------------------+---------------------------------------------------
 Reporter:  yabo        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 svn_trunk fails to build on my platform (Linux 64bit, g++ 4.4.3). The
 errors where about the function isnan and the assert macro.

 Here are the changes I had to make :

   * Add <cmath> include to
    * src/geom/GeometryFactory.cpp
    * src/geom/CoordinateArraySequence.cpp
    * src/io/WKTWriter.cpp
   * Add <cassert> include to
    * include/geos/operation/buffer/OffsetCurveVertexList.h

 {{{
 $ svn diff
 Index: src/geom/CoordinateArraySequence.cpp
 ===================================================================
 --- src/geom/CoordinateArraySequence.cpp        (revision 2999)
 +++ src/geom/CoordinateArraySequence.cpp        (working copy)
 @@ -24,6 +24,7 @@
  #include <cassert>
  #include <algorithm>
  #include <vector>
 +#include <cmath>

  using namespace std;

 Index: src/geom/GeometryFactory.cpp
 ===================================================================
 --- src/geom/GeometryFactory.cpp        (revision 2999)
 +++ src/geom/GeometryFactory.cpp        (working copy)
 @@ -37,6 +37,7 @@
  #include <cassert>
  #include <vector>
  #include <typeinfo>
 +#include <cmath>

  #ifndef GEOS_DEBUG
  #define GEOS_DEBUG 0
 Index: src/io/WKTWriter.cpp
 ===================================================================
 --- src/io/WKTWriter.cpp        (revision 2999)
 +++ src/io/WKTWriter.cpp        (working copy)
 @@ -37,6 +37,7 @@
  #include <string>
  #include <sstream>
  #include <cassert>
 +#include <cmath>

  using namespace std;
  using namespace geos::geom;
 Index: include/geos/operation/buffer/OffsetCurveVertexList.h
 ===================================================================
 --- include/geos/operation/buffer/OffsetCurveVertexList.h       (revision
 2999)
 +++ include/geos/operation/buffer/OffsetCurveVertexList.h       (working
 copy)
 @@ -27,6 +27,7 @@

  #include <vector>
  #include <memory>
 +#include <cassert>

  // Forward declarations
  namespace geos {

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/351>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From strk at keybit.net  Tue Jun 15 07:16:08 2010
From: strk at keybit.net (strk)
Date: Tue Jun 15 07:16:16 2010
Subject: [geos-devel] PHP bindings anyone ?
Message-ID: <20100615111608.GO51187@keybit.net>

I'm plaing with drupal recently and be wondering
if the SWIG binding for GEOS are still in use by
anyone or not.

In particular, I think Shapely and GeoDjango
are using a direct interface rather than swig, right ?

Is anyone else interested in a PHP binding for GEOS ?

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From robert.coup at koordinates.com  Tue Jun 15 18:57:29 2010
From: robert.coup at koordinates.com (Robert Coup)
Date: Tue Jun 15 18:57:32 2010
Subject: [geos-devel] PHP bindings anyone ?
In-Reply-To: <20100615111608.GO51187@keybit.net>
References: <20100615111608.GO51187@keybit.net>
Message-ID: <AANLkTiks_5R0oTPdkQSQzbCT58eI-jJKMIL5SQQyrHd6@mail.gmail.com>

On Tue, Jun 15, 2010 at 11:16 PM, strk <strk@keybit.net> wrote:

> I'm plaing with drupal recently and be wondering
> if the SWIG binding for GEOS are still in use by
> anyone or not.
>
> In particular, I think Shapely and GeoDjango
> are using a direct interface rather than swig, right ?
>


Yep, they both access the C library using the Python ctypes module. AFAIK
they just wanted to expose clean "pythonic" interfaces rather than the
hybrid stuff SWIG produces...

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20100616/90466faf/attachment.html
From sean.gillies at gmail.com  Wed Jun 16 03:53:00 2010
From: sean.gillies at gmail.com (Sean Gillies)
Date: Wed Jun 16 03:53:05 2010
Subject: [geos-devel] PHP bindings anyone ?
In-Reply-To: <AANLkTiks_5R0oTPdkQSQzbCT58eI-jJKMIL5SQQyrHd6@mail.gmail.com>
References: <20100615111608.GO51187@keybit.net>
	<AANLkTiks_5R0oTPdkQSQzbCT58eI-jJKMIL5SQQyrHd6@mail.gmail.com>
Message-ID: <AANLkTinTQOsWeT_Sj1t7QaqDTuyYAMrLWReNpJD4ER9S@mail.gmail.com>

On Wed, Jun 16, 2010 at 12:57 AM, Robert Coup
<robert.coup@koordinates.com> wrote:
> On Tue, Jun 15, 2010 at 11:16 PM, strk <strk@keybit.net> wrote:
>>
>> I'm plaing with drupal recently and be wondering
>> if the SWIG binding for GEOS are still in use by
>> anyone or not.
>>
>> In particular, I think Shapely and GeoDjango
>> are using a direct interface rather than swig, right ?
>
>
> Yep, they both access the C library using the Python ctypes module. AFAIK
> they just wanted to expose clean "pythonic" interfaces rather than the
> hybrid stuff SWIG produces...

>From time to time I hear from some one who is using the SWIG bindings for Ruby.

Are there any libffi (used by ctypes) intefaces for PHP? If so, I'd
recommend giving that a try.

Cheers,

-- 
Sean
From strk at keybit.net  Wed Jun 16 04:21:43 2010
From: strk at keybit.net (strk)
Date: Wed Jun 16 04:21:47 2010
Subject: [geos-devel] PHP bindings anyone ?
In-Reply-To: <AANLkTinTQOsWeT_Sj1t7QaqDTuyYAMrLWReNpJD4ER9S@mail.gmail.com>
References: <20100615111608.GO51187@keybit.net>
	<AANLkTiks_5R0oTPdkQSQzbCT58eI-jJKMIL5SQQyrHd6@mail.gmail.com>
	<AANLkTinTQOsWeT_Sj1t7QaqDTuyYAMrLWReNpJD4ER9S@mail.gmail.com>
Message-ID: <20100616082143.GB6276@keybit.net>

On Wed, Jun 16, 2010 at 09:53:00AM +0200, Sean Gillies wrote:

> Are there any libffi (used by ctypes) intefaces for PHP? If so, I'd
> recommend giving that a try.

Found this: http://pecl.php.net/package/ffi
Last release (0.3-alpha) is from 2004 :!

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From geos-trac at osgeo.org  Wed Jun 16 05:23:08 2010
From: geos-trac at osgeo.org (GEOS)
Date: Wed Jun 16 05:23:11 2010
Subject: [geos-devel] [GEOS] #352: make dist does not package swig binding
Message-ID: <044.db7daca19d4140dd91dad681b6a39427@osgeo.org>

#352: make dist does not package swig binding
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 ... unless you configured with --enable-xxxxy

 the DIST_SUBDIRS variable for Makefile.am would fix this
 this item is just so we don't forget

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/352>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Wed Jun 16 05:32:20 2010
From: geos-trac at osgeo.org (GEOS)
Date: Wed Jun 16 05:32:22 2010
Subject: [geos-devel] Re: [GEOS] #352: make dist does not package swig
	binding
In-Reply-To: <044.db7daca19d4140dd91dad681b6a39427@osgeo.org>
References: <044.db7daca19d4140dd91dad681b6a39427@osgeo.org>
Message-ID: <053.da54deb3d8492a60134ec38280b0b805@osgeo.org>

#352: make dist does not package swig binding
------------------------+---------------------------------------------------
 Reporter:  strk        |        Owner:  geos-devel@?              
     Type:  defect      |       Status:  closed                    
 Priority:  major       |    Milestone:                            
Component:  Default     |      Version:  svn-trunk                 
 Severity:  Unassigned  |   Resolution:  fixed                     
 Keywords:              |  
------------------------+---------------------------------------------------
Changes (by strk):

  * status:  new => closed
  * resolution:  => fixed


Comment:

 Fixed in r3001 (a Swig Odyssey)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/352#comment:1>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Wed Jun 16 05:56:28 2010
From: geos-trac at osgeo.org (GEOS)
Date: Wed Jun 16 05:56:31 2010
Subject: [geos-devel] Re: [GEOS] #352: make dist does not package swig
	binding
In-Reply-To: <044.db7daca19d4140dd91dad681b6a39427@osgeo.org>
References: <044.db7daca19d4140dd91dad681b6a39427@osgeo.org>
Message-ID: <053.5fc79eb51975e5d785e44e68ea2f20db@osgeo.org>

#352: make dist does not package swig binding
------------------------+---------------------------------------------------
 Reporter:  strk        |        Owner:  geos-devel@?              
     Type:  defect      |       Status:  closed                    
 Priority:  major       |    Milestone:                            
Component:  Default     |      Version:  svn-trunk                 
 Severity:  Unassigned  |   Resolution:  fixed                     
 Keywords:              |  
------------------------+---------------------------------------------------

Comment(by strk):

 as a note, r3002 fixes it w/out breaking 'make' discend into bindings

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/352#comment:2>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From mateusz at loskot.net  Wed Jun 16 06:48:33 2010
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed Jun 16 06:45:17 2010
Subject: [geos-devel] PHP bindings anyone ?
In-Reply-To: <20100616082143.GB6276@keybit.net>
References: <20100615111608.GO51187@keybit.net>	<AANLkTiks_5R0oTPdkQSQzbCT58eI-jJKMIL5SQQyrHd6@mail.gmail.com>	<AANLkTinTQOsWeT_Sj1t7QaqDTuyYAMrLWReNpJD4ER9S@mail.gmail.com>
	<20100616082143.GB6276@keybit.net>
Message-ID: <4C18AC01.207@loskot.net>

On 16/06/10 09:21, strk wrote:
> On Wed, Jun 16, 2010 at 09:53:00AM +0200, Sean Gillies wrote:
>
>> Are there any libffi (used by ctypes) intefaces for PHP? If so, I'd
>> recommend giving that a try.
>
> Found this: http://pecl.php.net/package/ffi
> Last release (0.3-alpha) is from 2004 :!

Sandro,

You may find this interesting:

http://wiki.github.com/moriyoshi/boost.php/

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net
From cfis at savagexi.com  Wed Jun 16 17:42:16 2010
From: cfis at savagexi.com (Charlie Savage)
Date: Wed Jun 16 18:12:30 2010
Subject: [geos-devel] PHP bindings anyone ?
In-Reply-To: <AANLkTinTQOsWeT_Sj1t7QaqDTuyYAMrLWReNpJD4ER9S@mail.gmail.com>
References: <20100615111608.GO51187@keybit.net>	<AANLkTiks_5R0oTPdkQSQzbCT58eI-jJKMIL5SQQyrHd6@mail.gmail.com>
	<AANLkTinTQOsWeT_Sj1t7QaqDTuyYAMrLWReNpJD4ER9S@mail.gmail.com>
Message-ID: <4C194538.5060309@savagexi.com>



On 6/16/2010 1:53 AM, Sean Gillies wrote:
> On Wed, Jun 16, 2010 at 12:57 AM, Robert Coup
> <robert.coup@koordinates.com>  wrote:
>> On Tue, Jun 15, 2010 at 11:16 PM, strk<strk@keybit.net>  wrote:
>>>
>>> I'm plaing with drupal recently and be wondering
>>> if the SWIG binding for GEOS are still in use by
>>> anyone or not.
Yes, we use the Ruby ones.

Charlie
>>>
>>> In particular, I think Shapely and GeoDjango
>>> are using a direct interface rather than swig, right ?
>>
>>
>> Yep, they both access the C library using the Python ctypes module. AFAIK
>> they just wanted to expose clean "pythonic" interfaces rather than the
>> hybrid stuff SWIG produces...
>
>> From time to time I hear from some one who is using the SWIG bindings for Ruby.
>
> Are there any libffi (used by ctypes) intefaces for PHP? If so, I'd
> recommend giving that a try.
>
> Cheers,
>

-- 
Charlie Savage
http://cfis.savagexi.com
From strk at keybit.net  Thu Jun 17 03:04:29 2010
From: strk at keybit.net (strk)
Date: Thu Jun 17 03:04:32 2010
Subject: [geos-devel] PHP bindings anyone ?
In-Reply-To: <4C18AC01.207@loskot.net>
References: <20100615111608.GO51187@keybit.net>
	<AANLkTiks_5R0oTPdkQSQzbCT58eI-jJKMIL5SQQyrHd6@mail.gmail.com>
	<AANLkTinTQOsWeT_Sj1t7QaqDTuyYAMrLWReNpJD4ER9S@mail.gmail.com>
	<20100616082143.GB6276@keybit.net> <4C18AC01.207@loskot.net>
Message-ID: <20100617070429.GF6276@keybit.net>

On Wed, Jun 16, 2010 at 11:48:33AM +0100, Mateusz Loskot wrote:
> On 16/06/10 09:21, strk wrote:
> >On Wed, Jun 16, 2010 at 09:53:00AM +0200, Sean Gillies wrote:
> >
> >>Are there any libffi (used by ctypes) intefaces for PHP? If so, I'd
> >>recommend giving that a try.
> >
> >Found this: http://pecl.php.net/package/ffi
> >Last release (0.3-alpha) is from 2004 :!
> 
> Sandro,
> 
> You may find this interesting:
> 
> http://wiki.github.com/moriyoshi/boost.php/

Promising indeed.
But at first glance it must be requiring
a too new version of boost (running make failed).

For now I started a direct Zend implementation.

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 18 05:26:06 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 05:26:10 2010
Subject: [geos-devel] PHP bindings
Message-ID: <20100618092606.GI6276@keybit.net>

I've started hand-crafting PHP bindings for the GEOS C-API.
Currently in the process of merging into trunk for proper
build scripts.

One obstacle I found is that -ansi, which is added to
CFLAGS by ./configure, won't accept Zend (PHP engine)
headers, so that switch must be removed when building
the PHP module.

Does anyone know how to override the cflags for just
one dir ? Or ideally, only drop the -ansi switch ?

Here's the relevant annotation from configure.in:

  2533    mloskot AC_LIBTOOL_COMPILER_OPTION([if $compiler supports -ansi], [dum
my_cv_ansi], [-ansi], [], [WARNFLAGS="$WARNFLAGS -ansi"], [])

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 18 05:26:35 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 05:26:37 2010
Subject: [geos-devel] PHP bindings
Message-ID: <20100618092606.GI6276@keybit.net>

I've started hand-crafting PHP bindings for the GEOS C-API.
Currently in the process of merging into trunk for proper
build scripts.

One obstacle I found is that -ansi, which is added to
CFLAGS by ./configure, won't accept Zend (PHP engine)
headers, so that switch must be removed when building
the PHP module.

Does anyone know how to override the cflags for just
one dir ? Or ideally, only drop the -ansi switch ?

Here's the relevant annotation from configure.in:

  2533    mloskot AC_LIBTOOL_COMPILER_OPTION([if $compiler supports -ansi], [dum
my_cv_ansi], [-ansi], [], [WARNFLAGS="$WARNFLAGS -ansi"], [])

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 18 05:59:04 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 05:59:07 2010
Subject: [geos-devel] C/C++ Standards, switches ordering
In-Reply-To: <20100618092606.GI6276@keybit.net>
References: <20100618092606.GI6276@keybit.net>
Message-ID: <20100618095904.GJ6276@keybit.net>

So, -ansi is equivalent to -std=c89
Using -std=c99 works fine.

Now, the problem is that GEOS's ./configure script
is setting CFLAGS, which it shouldn't.
CFLAGS is always added last as it is considered
the user-defined one.

Doing so (as we do) will drop our own flags when
user specifies others (I think, to be tested).

Instead, configure is fine to set 'AM_' variables
which are used to replace whatever_CFLAGS when they
are not needed, and to properly position $(AM_xxx)
when in need for overrides.

Currently, only CAPI and SWIG dirs do use overrides
of whatever_CFLAGS.

I'll see how to sort this all out.

--strk;

On Fri, Jun 18, 2010 at 11:26:35AM +0200, strk wrote:
> I've started hand-crafting PHP bindings for the GEOS C-API.
> Currently in the process of merging into trunk for proper
> build scripts.
> 
> One obstacle I found is that -ansi, which is added to
> CFLAGS by ./configure, won't accept Zend (PHP engine)
> headers, so that switch must be removed when building
> the PHP module.
> 
> Does anyone know how to override the cflags for just
> one dir ? Or ideally, only drop the -ansi switch ?
> 
> Here's the relevant annotation from configure.in:
> 
>   2533    mloskot AC_LIBTOOL_COMPILER_OPTION([if $compiler supports -ansi], [dum
> my_cv_ansi], [-ansi], [], [WARNFLAGS="$WARNFLAGS -ansi"], [])
> 
> --strk; 
> 
>   ()   Free GIS & Flash consultant/developer
>   /\   http://strk.keybit.net/services.html

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 18 09:13:59 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 09:14:02 2010
Subject: [geos-devel] C/C++ Standards, switches ordering
In-Reply-To: <20100618095904.GJ6276@keybit.net>
References: <20100618092606.GI6276@keybit.net>
	<20100618095904.GJ6276@keybit.net>
Message-ID: <20100618131359.GK6276@keybit.net>

Alright, as of r3006 AM_XXXX is used.
This means that you can finally override the CFLAGS
yourself w/out loosing the important ones (-ffloat-store,
-DGEOS_INLINE, -DNDEBUG). The first one is mandatory,
the second two are controlled trough ./configure switches
(--disable-inline, --disable-cassert)

But also you won't loose the -pedantic -Wall -ansi -Wno-long-long,
which might be not what we want (ie: how does a user asks for
a build w/out those flags ? -no-flag ?).

I kindly ask anyone to test their build with their existing
configure scripts to catch any problem with the current
setup.

--strk;


On Fri, Jun 18, 2010 at 11:59:04AM +0200, strk wrote:
> So, -ansi is equivalent to -std=c89
> Using -std=c99 works fine.
> 
> Now, the problem is that GEOS's ./configure script
> is setting CFLAGS, which it shouldn't.
> CFLAGS is always added last as it is considered
> the user-defined one.
> 
> Doing so (as we do) will drop our own flags when
> user specifies others (I think, to be tested).
> 
> Instead, configure is fine to set 'AM_' variables
> which are used to replace whatever_CFLAGS when they
> are not needed, and to properly position $(AM_xxx)
> when in need for overrides.
> 
> Currently, only CAPI and SWIG dirs do use overrides
> of whatever_CFLAGS.
> 
> I'll see how to sort this all out.
> 
> --strk;
> 
> On Fri, Jun 18, 2010 at 11:26:35AM +0200, strk wrote:
> > I've started hand-crafting PHP bindings for the GEOS C-API.
> > Currently in the process of merging into trunk for proper
> > build scripts.
> > 
> > One obstacle I found is that -ansi, which is added to
> > CFLAGS by ./configure, won't accept Zend (PHP engine)
> > headers, so that switch must be removed when building
> > the PHP module.
> > 
> > Does anyone know how to override the cflags for just
> > one dir ? Or ideally, only drop the -ansi switch ?
> > 
> > Here's the relevant annotation from configure.in:
> > 
> >   2533    mloskot AC_LIBTOOL_COMPILER_OPTION([if $compiler supports -ansi], [dum
> > my_cv_ansi], [-ansi], [], [WARNFLAGS="$WARNFLAGS -ansi"], [])
> > 
> > --strk; 
> > 
> >   ()   Free GIS & Flash consultant/developer
> >   /\   http://strk.keybit.net/services.html
> 
> -- 
> 
>   ()   Free GIS & Flash consultant/developer
>   /\   http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From maxime at altribe.org  Fri Jun 18 09:25:04 2010
From: maxime at altribe.org (Maxime van Noppen)
Date: Fri Jun 18 09:21:56 2010
Subject: [geos-devel] C/C++ Standards, switches ordering
In-Reply-To: <20100618131359.GK6276@keybit.net>
References: <20100618092606.GI6276@keybit.net>	<20100618095904.GJ6276@keybit.net>
	<20100618131359.GK6276@keybit.net>
Message-ID: <4C1B73B0.1050506@altribe.org>

On 06/18/2010 03:13 PM, strk wrote:
> I kindly ask anyone to test their build with their existing
> configure scripts to catch any problem with the current
> setup.

Working here (linux x86_64, g++ 4.4.3) with custom CXXFLAGS.

Well done. :)

-- 
Maxime
From strk at keybit.net  Fri Jun 18 10:48:31 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 10:48:35 2010
Subject: [geos-devel] Online doxygen docs
Message-ID: <20100618144831.GM6276@keybit.net>

I was looking for info about WKTWriter::setTrim 
but haven't found it on http://download.osgeo.org/geos/doxygen/

Who's in charge for updating that page ?
Can we track both latest release and trunk ?

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 18 12:41:47 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 12:41:52 2010
Subject: [geos-devel] PHP bindings
In-Reply-To: <20100618092606.GI6276@keybit.net>
References: <20100618092606.GI6276@keybit.net>
Message-ID: <20100618164147.GN6276@keybit.net>

So, current trunk as a -std=gnu99 added to CFLAGS
when building the PHP bindings and was tested to
work on OpenSUSE 11.1 and Ubuntu 8.10 with gcc-4.3.2
(-std=c99 didn't work on the Ubuntu box).

If anyone feels like testing on other systems these
are the steps:

	0: svn up
	1: make sure you have php5 dev files
	   installed (for debian-based: apt-get install php5-dev)
	2: ./autogen.sh && ./configure --enable-php
	3: make 
	4: make check (bonus)

Bonus step 4 you may want to run under php/ dir only.
If you get lots of errors in step 3 that's likely Zend
interaction with -ansi, which is what I'm trying to
fix in a general way.

--strk;

On Fri, Jun 18, 2010 at 11:26:35AM +0200, strk wrote:
> I've started hand-crafting PHP bindings for the GEOS C-API.
> Currently in the process of merging into trunk for proper
> build scripts.
> 
> One obstacle I found is that -ansi, which is added to
> CFLAGS by ./configure, won't accept Zend (PHP engine)
> headers, so that switch must be removed when building
> the PHP module.
> 
> Does anyone know how to override the cflags for just
> one dir ? Or ideally, only drop the -ansi switch ?
> 
> Here's the relevant annotation from configure.in:
> 
>   2533    mloskot AC_LIBTOOL_COMPILER_OPTION([if $compiler supports -ansi], [dum
> my_cv_ansi], [-ansi], [], [WARNFLAGS="$WARNFLAGS -ansi"], [])
> 
> --strk; 
> 
>   ()   Free GIS & Flash consultant/developer
>   /\   http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 18 12:53:19 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 12:53:21 2010
Subject: [geos-devel] PHP bindings
In-Reply-To: <20100618164147.GN6276@keybit.net>
References: <20100618092606.GI6276@keybit.net>
	<20100618164147.GN6276@keybit.net>
Message-ID: <20100618165319.GQ6276@keybit.net>

On Fri, Jun 18, 2010 at 06:41:47PM +0200, strk wrote:
> So, current trunk as a -std=gnu99 added to CFLAGS
> when building the PHP bindings and was tested to
> work on OpenSUSE 11.1 and Ubuntu 8.10 with gcc-4.3.2
> (-std=c99 didn't work on the Ubuntu box).

FYI: also tested successfully on 
Debian 4.0 with:
 gcc (GCC) 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)]

--strk;

> 
> If anyone feels like testing on other systems these
> are the steps:
> 
> 	0: svn up
> 	1: make sure you have php5 dev files
> 	   installed (for debian-based: apt-get install php5-dev)
> 	2: ./autogen.sh && ./configure --enable-php
> 	3: make 
> 	4: make check (bonus)
> 
> Bonus step 4 you may want to run under php/ dir only.
> If you get lots of errors in step 3 that's likely Zend
> interaction with -ansi, which is what I'm trying to
> fix in a general way.
> 
> --strk;
> 
> On Fri, Jun 18, 2010 at 11:26:35AM +0200, strk wrote:
> > I've started hand-crafting PHP bindings for the GEOS C-API.
> > Currently in the process of merging into trunk for proper
> > build scripts.
> > 
> > One obstacle I found is that -ansi, which is added to
> > CFLAGS by ./configure, won't accept Zend (PHP engine)
> > headers, so that switch must be removed when building
> > the PHP module.
> > 
> > Does anyone know how to override the cflags for just
> > one dir ? Or ideally, only drop the -ansi switch ?
> > 
> > Here's the relevant annotation from configure.in:
> > 
> >   2533    mloskot AC_LIBTOOL_COMPILER_OPTION([if $compiler supports -ansi], [dum
> > my_cv_ansi], [-ansi], [], [WARNFLAGS="$WARNFLAGS -ansi"], [])
> > 
> > --strk; 
> > 
> >   ()   Free GIS & Flash consultant/developer
> >   /\   http://strk.keybit.net/services.html
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@lists.osgeo.org
> > http://lists.osgeo.org/mailman/listinfo/geos-devel
> 
> -- 
> 
>   ()   Free GIS & Flash consultant/developer
>   /\   http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 18 18:04:07 2010
From: strk at keybit.net (strk)
Date: Fri Jun 18 18:04:14 2010
Subject: [geos-devel] PHP bindings
In-Reply-To: <20100618165319.GQ6276@keybit.net>
References: <20100618092606.GI6276@keybit.net>
	<20100618164147.GN6276@keybit.net>
	<20100618165319.GQ6276@keybit.net>
Message-ID: <20100618220404.GT6276@keybit.net>

On Fri, Jun 18, 2010 at 06:53:19PM +0200, strk wrote:
> On Fri, Jun 18, 2010 at 06:41:47PM +0200, strk wrote:
> > So, current trunk as a -std=gnu99 added to CFLAGS
> > when building the PHP bindings and was tested to
> > work on OpenSUSE 11.1 and Ubuntu 8.10 with gcc-4.3.2
> > (-std=c99 didn't work on the Ubuntu box).
> 
> FYI: also tested successfully on 
> Debian 4.0 with:
>  gcc (GCC) 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)]

Another success on Snow Leopard 10.6.3
with i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5659

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From pramsey at opengeo.org  Fri Jun 18 18:36:25 2010
From: pramsey at opengeo.org (Paul Ramsey)
Date: Fri Jun 18 18:36:28 2010
Subject: [geos-devel] Online doxygen docs
In-Reply-To: <20100618144831.GM6276@keybit.net>
References: <20100618144831.GM6276@keybit.net>
Message-ID: <AANLkTinvGGbTn7LhZF_AmJyq3JKRNWwVcAflfG03lgLV@mail.gmail.com>

I am... I just repaired it and now we're building trunk and 3.2 nightly...

P

On Fri, Jun 18, 2010 at 7:48 AM, strk <strk@keybit.net> wrote:
> I was looking for info about WKTWriter::setTrim
> but haven't found it on http://download.osgeo.org/geos/doxygen/
>
> Who's in charge for updating that page ?
> Can we track both latest release and trunk ?
>
> --strk;
>
> ?() ? Free GIS & Flash consultant/developer
> ?/\ ? http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
From strk at keybit.net  Sat Jun 19 07:02:31 2010
From: strk at keybit.net (strk)
Date: Sat Jun 19 07:02:39 2010
Subject: [geos-devel] linearref::LinearIterator segfaults
Message-ID: <20100619110231.GZ6276@keybit.net>

Doing tests for the PHP biding I found a segfault
when using the C-API GEOSProject method against
something which is not a lineal geometry.

This goes down to linearref::LinearIterator assuming
the input is a lineal geometry w/out checking.

The bug goes deep into JTS as well, where you don't get
a segfault but do a wrong assumption here:

  private void loadCurrentLine()                                                  {
    if (componentIndex >= numLines) {
      currentLine = null;
      return;
    }
    currentLine = (LineString) linear.getGeometryN(componentIndex);
  }

That is, there's no code checking that 'linear' is a LINESTRING
or MULTILINESTRING:

  public LinearIterator(Geometry linear, int componentIndex, int vertexIndex) {
    this.linear = linear;
    numLines = linear.getNumGeometries();
    this.componentIndex = componentIndex;
    this.vertexIndex = vertexIndex;
    loadCurrentLine();
  }

I'd throw an IllegalArgumentException from the constructor, if geom
is not LINEAL.

Will do this in GEOS trunk, but wanted to signal JTS too...

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From geos-trac at osgeo.org  Sat Jun 19 08:11:14 2010
From: geos-trac at osgeo.org (GEOS)
Date: Sat Jun 19 08:11:16 2010
Subject: [geos-devel] Re: [GEOS] #283: Patch: ported linearref from JTS
In-Reply-To: <047.becd7fad57d55dcccfde0ec15b3e1905@osgeo.org>
References: <047.becd7fad57d55dcccfde0ec15b3e1905@osgeo.org>
Message-ID: <056.70e070bd38f61a456afca8106431cf92@osgeo.org>

#283: Patch: ported linearref from JTS
------------------------+---------------------------------------------------
 Reporter:  novalis     |        Owner:  geos-devel@?              
     Type:  defect      |       Status:  reopened                  
 Priority:  blocker     |    Milestone:  3.2.0                     
Component:  Default     |      Version:  svn-trunk                 
 Severity:  Unassigned  |   Resolution:                            
 Keywords:              |  
------------------------+---------------------------------------------------
Changes (by strk):

  * priority:  major => blocker
  * status:  closed => reopened
  * resolution:  fixed =>


Comment:

 GEOSInterpolate, like GEOSProject, segfaults.
 I fixed GEOSProject, but don't have time/funding to fix GEOSInterpolate.

 When new code is added, it should come with unit testing.
 It would have been easy to catch such situations.

 Also in this case the segfault is triggered by calling the function
 against a POINT, so the root cause might be the same (not checking
 that input is a LINESTRING)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/283#comment:4>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Sat Jun 19 08:19:06 2010
From: geos-trac at osgeo.org (GEOS)
Date: Sat Jun 19 08:19:08 2010
Subject: [geos-devel] [GEOS] #353: GEOSInterpolate segfaults
Message-ID: <044.87a7db56b41fad30810cda6c20808710@osgeo.org>

#353: GEOSInterpolate segfaults
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  blocker     |   Milestone:  3.2.1                     
Component:  Default     |     Version:  3.2.0                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 When calling GEOSInterpolate against a POINT geometry (C-API), a segfault
 happens. See #283 for when that code was added.

 NOTE: milestone should be 3.2.3 but doesn't exist.
 Also, versions 3.2.1 and 3.2.2 should be added to trac.

 Also, r3012, r3013, r3014 and r3015 should be back-ported to 2.x branch.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/353>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Sat Jun 19 08:19:26 2010
From: geos-trac at osgeo.org (GEOS)
Date: Sat Jun 19 08:19:28 2010
Subject: [geos-devel] Re: [GEOS] #283: Patch: ported linearref from JTS
In-Reply-To: <047.becd7fad57d55dcccfde0ec15b3e1905@osgeo.org>
References: <047.becd7fad57d55dcccfde0ec15b3e1905@osgeo.org>
Message-ID: <056.e15f2d7e9092d31b3fe352c991654906@osgeo.org>

#283: Patch: ported linearref from JTS
------------------------+---------------------------------------------------
 Reporter:  novalis     |        Owner:  geos-devel@?              
     Type:  defect      |       Status:  closed                    
 Priority:  blocker     |    Milestone:  3.2.0                     
Component:  Default     |      Version:  svn-trunk                 
 Severity:  Unassigned  |   Resolution:  fixed                     
 Keywords:              |  
------------------------+---------------------------------------------------
Changes (by strk):

  * status:  reopened => closed
  * resolution:  => fixed


Comment:

 Filed another ticket for the segfault: #353

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/283#comment:5>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Sat Jun 19 08:29:57 2010
From: geos-trac at osgeo.org (GEOS)
Date: Sat Jun 19 08:29:59 2010
Subject: [geos-devel] Re: [GEOS] #353: LinearReferencing functions segfaults
 (was: GEOSInterpolate segfaults)
In-Reply-To: <044.87a7db56b41fad30810cda6c20808710@osgeo.org>
References: <044.87a7db56b41fad30810cda6c20808710@osgeo.org>
Message-ID: <053.db8ed7ed2ab9cca7e08ab75df1b892fd@osgeo.org>

#353: LinearReferencing functions segfaults
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  blocker     |   Milestone:  3.2.1                     
Component:  Default     |     Version:  3.2.0                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 Fixed GEOSInterpolate in r3019, won't close so we remember to back-port.
 Also, I rename to keep this for generic linear referencing segfaults (I'm
 sure I'll find more)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/353#comment:1>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Sat Jun 19 08:43:16 2010
From: geos-trac at osgeo.org (GEOS)
Date: Sat Jun 19 08:43:17 2010
Subject: [geos-devel] Re: [GEOS] #353: LinearReferencing functions segfaults
In-Reply-To: <044.87a7db56b41fad30810cda6c20808710@osgeo.org>
References: <044.87a7db56b41fad30810cda6c20808710@osgeo.org>
Message-ID: <053.dbd33138f529d529f7d831418d0aa9a0@osgeo.org>

#353: LinearReferencing functions segfaults
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  blocker     |   Milestone:  3.2.1                     
Component:  Default     |     Version:  3.2.0                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 GEOSInterpolate CAPI side fixed in r3021 (catching the exception)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/353#comment:2>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Sat Jun 19 09:18:57 2010
From: geos-trac at osgeo.org (GEOS)
Date: Sat Jun 19 09:18:59 2010
Subject: [geos-devel] Re: [GEOS] #353: LinearReferencing functions segfaults
In-Reply-To: <044.87a7db56b41fad30810cda6c20808710@osgeo.org>
References: <044.87a7db56b41fad30810cda6c20808710@osgeo.org>
Message-ID: <053.765f9027569cf3e79c89e418e9f0a2e2@osgeo.org>

#353: LinearReferencing functions segfaults
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  blocker     |   Milestone:  3.2.1                     
Component:  Default     |     Version:  3.2.0                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 Ok, I'm done, linearref patches are finished.
 Just a backport to branch before closing this.
 I don't have time to do it myself.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/353#comment:3>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From strk at keybit.net  Sun Jun 20 04:16:03 2010
From: strk at keybit.net (strk)
Date: Sun Jun 20 04:16:10 2010
Subject: [geos-devel] Polygonizer bug ?
Message-ID: <20100620081536.GB6276@keybit.net>

Martin, I'm adding a testcase for the Polygonizer using example from :
"JTS Developer's Guide, Chapter 6 - Polygonization"

Here's the input, represented as a collection:

GEOMETRYCOLLECTION(
            LINESTRING(0 0, 10 10),
            LINESTRING(185 221, 100 100),
            LINESTRING(185 221, 88 275, 180 316),
            LINESTRING(185 221, 292 281, 180 316),
            LINESTRING(189 98, 83 187, 185 221),
            LINESTRING(189 98, 325 168, 185 221))
)

When passing it into the Polygonizer class I get
2 rings, no cut or invalid edges and 3 dangles.                                 Also notable is that of the 3 dangles, 2 are identical
and specificall are the isolated edge (first geometry
in the collection).

The example in the guide suggests the rings should
be 3 instead, and that there should be one cut
edge (represented in blue) and 2 dangles
the red ones.

Does it sound as a bug in GEOS or does JTS give the
same results ?

Note that forcing proper noding using the union trick
does give the 3 expected rings, but still lacks the
cut edge and duplicates the dangle.

Thanks in advance.

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From maxime at altribe.org  Mon Jun 21 03:32:50 2010
From: maxime at altribe.org (Maxime van Noppen)
Date: Mon Jun 21 03:29:19 2010
Subject: [geos-devel] Re: [geos-commits] r3046 - trunk/src/geom
In-Reply-To: <20100621005313.AA4DE3904D2@trac.osgeo.org>
References: <20100621005313.AA4DE3904D2@trac.osgeo.org>
Message-ID: <4C1F15A2.9060005@altribe.org>

On 06/21/2010 02:53 AM, svn_geos@osgeo.org wrote:
> Modified:
>    trunk/src/geom/GeometryCollection.cpp
> Log:
> Geometry::getGeometryN is an API function, so make it safe/checked

Is there a guideline on such topics ?

The runtime cost of an additional if() is quite high in such a method,
could there be, at least, a compilation flag to activate/deactivate such
statements ?

>From a C++ point of view, the STL (for example std::vector) is designed
to have both methods (fast: operator[], safe: std::vector::at()) to let
the programmer decide which is best (safety vs performance).

-- 
Maxime
From strk at keybit.net  Mon Jun 21 05:22:34 2010
From: strk at keybit.net (strk)
Date: Mon Jun 21 05:22:38 2010
Subject: [geos-devel] Re: [geos-commits] r3046 - trunk/src/geom
In-Reply-To: <4C1F15A2.9060005@altribe.org>
References: <20100621005313.AA4DE3904D2@trac.osgeo.org>
	<4C1F15A2.9060005@altribe.org>
Message-ID: <20100621092234.GD6276@keybit.net>

On Mon, Jun 21, 2010 at 09:32:50AM +0200, Maxime van Noppen wrote:
> On 06/21/2010 02:53 AM, svn_geos@osgeo.org wrote:
> > Modified:
> >    trunk/src/geom/GeometryCollection.cpp
> > Log:
> > Geometry::getGeometryN is an API function, so make it safe/checked
> 
> Is there a guideline on such topics ?

Not really.
You're right about additional cost, but I dubt it'll really
be noticeable. Have some profiles ?

We could move the checks in higher level APIs and
leave internals alone. Note that the C-API says it'd return
0 on exception. Isn't asking for an non-existant child 
an exceptional request ? Should the C-API functions check ?

The ones I changed are:
	GeometryCollection::getGeometryN
	LineString::getPointN
	Polygon::getInteriorRingN

Note that LineString::getStartPoint and ::getEndPoint already check
for being empty.

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From maxime at altribe.org  Mon Jun 21 07:23:08 2010
From: maxime at altribe.org (Maxime van Noppen)
Date: Mon Jun 21 07:19:34 2010
Subject: [geos-devel] Re: [geos-commits] r3046 - trunk/src/geom
In-Reply-To: <20100621092234.GD6276@keybit.net>
References: <20100621005313.AA4DE3904D2@trac.osgeo.org>	<4C1F15A2.9060005@altribe.org>
	<20100621092234.GD6276@keybit.net>
Message-ID: <4C1F4B9C.3080800@altribe.org>

On 06/21/2010 11:22 AM, strk wrote:
> Not really.
> You're right about additional cost, but I dubt it'll really
> be noticeable. Have some profiles ?

Not directly on geos but testing the same scenario against a trivial
example (attached) gives these results on gcc 4.4.3 :

$ g++ -O0 -o bench bench.cc && ./bench
elapsed: 00:00:24.000799
elapsed: 00:00:27.809378
diff: 00:00:03.808579
added cost: 15.8686%

$ g++ -O2 -o bench bench.cc && ./bench
elapsed: 00:00:13.456086
elapsed: 00:00:14.927550
diff: 00:00:01.471464
added cost: 10.9353%

$ g++ -O3 -o bench bench.cc && ./bench
elapsed: 00:00:01.757662
elapsed: 00:00:02.050734
diff: 00:00:00.293072
added cost: 16.674%


First 'elapsed' is an unsafe access, second is the same access protected
by an if().

It is clearly noticeable in any optimization level.

> We could move the checks in higher level APIs and
> leave internals alone. Note that the C-API says it'd return
> 0 on exception. Isn't asking for an non-existant child 
> an exceptional request ? Should the C-API functions check ?

It is indeed an exceptional request and this is why I find that paying
the cost of this additional safety for exceptional cases is too much.
These methods are typically used in loop-intensive contexts.

Furthermore, they add no safety when used in loops such as :

 for(std::size_t i = 0; i < geom->getNumGeometries(); ++i)
  // ...geom->getGeometryN(i)...

Having a safe and slow API is fine, std::vector has one, but not having
an unsafe bust fast API is bad for those who care about performance.
These functions are quite fundamental and broadly used in geos, this is
going to slow down everything a bit.

As I don't use the C-API I don't know if it should do the test or not.
I'd say that there should also be two functions, unsafe & fast and safe
& slow. By the way, a lot of C code has the 'unsafe & fast' behaviour.
Typically the libc : str{len,cpy,...} functions will segfault if they
are given invalid arguments (NULL pointers, ...). So a C developer
should be used to functions that fail when given invalid arguments.

-- 
Maxime
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bench.cc
Type: text/x-c++src
Size: 1548 bytes
Desc: not available
Url : http://lists.osgeo.org/pipermail/geos-devel/attachments/20100621/6b4853f0/bench.bin
From strk at keybit.net  Mon Jun 21 10:32:24 2010
From: strk at keybit.net (strk)
Date: Mon Jun 21 10:32:27 2010
Subject: [geos-devel] Re: [geos-commits] r3046 - trunk/src/geom
In-Reply-To: <4C1F4B9C.3080800@altribe.org>
References: <20100621005313.AA4DE3904D2@trac.osgeo.org>
	<4C1F15A2.9060005@altribe.org> <20100621092234.GD6276@keybit.net>
	<4C1F4B9C.3080800@altribe.org>
Message-ID: <20100621143224.GJ6276@keybit.net>

Alright, convinced.
Thanks for the review.
r3060 has them back unchecked, with checks moved at PHP level.

--strk;

On Mon, Jun 21, 2010 at 01:23:08PM +0200, Maxime van Noppen wrote:
> On 06/21/2010 11:22 AM, strk wrote:
> > Not really.
> > You're right about additional cost, but I dubt it'll really
> > be noticeable. Have some profiles ?
> 
> Not directly on geos but testing the same scenario against a trivial
> example (attached) gives these results on gcc 4.4.3 :
> 
> $ g++ -O0 -o bench bench.cc && ./bench
> elapsed: 00:00:24.000799
> elapsed: 00:00:27.809378
> diff: 00:00:03.808579
> added cost: 15.8686%
> 
> $ g++ -O2 -o bench bench.cc && ./bench
> elapsed: 00:00:13.456086
> elapsed: 00:00:14.927550
> diff: 00:00:01.471464
> added cost: 10.9353%
> 
> $ g++ -O3 -o bench bench.cc && ./bench
> elapsed: 00:00:01.757662
> elapsed: 00:00:02.050734
> diff: 00:00:00.293072
> added cost: 16.674%
> 
> 
> First 'elapsed' is an unsafe access, second is the same access protected
> by an if().
> 
> It is clearly noticeable in any optimization level.
> 
> > We could move the checks in higher level APIs and
> > leave internals alone. Note that the C-API says it'd return
> > 0 on exception. Isn't asking for an non-existant child 
> > an exceptional request ? Should the C-API functions check ?
> 
> It is indeed an exceptional request and this is why I find that paying
> the cost of this additional safety for exceptional cases is too much.
> These methods are typically used in loop-intensive contexts.
> 
> Furthermore, they add no safety when used in loops such as :
> 
>  for(std::size_t i = 0; i < geom->getNumGeometries(); ++i)
>   // ...geom->getGeometryN(i)...
> 
> Having a safe and slow API is fine, std::vector has one, but not having
> an unsafe bust fast API is bad for those who care about performance.
> These functions are quite fundamental and broadly used in geos, this is
> going to slow down everything a bit.
> 
> As I don't use the C-API I don't know if it should do the test or not.
> I'd say that there should also be two functions, unsafe & fast and safe
> & slow. By the way, a lot of C code has the 'unsafe & fast' behaviour.
> Typically the libc : str{len,cpy,...} functions will segfault if they
> are given invalid arguments (NULL pointers, ...). So a C developer
> should be used to functions that fail when given invalid arguments.
> 
> -- 
> Maxime


> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From maxime at altribe.org  Mon Jun 21 12:02:32 2010
From: maxime at altribe.org (Maxime van Noppen)
Date: Mon Jun 21 11:58:55 2010
Subject: [geos-devel] Re: [geos-commits] r3046 - trunk/src/geom
In-Reply-To: <20100621143224.GJ6276@keybit.net>
References: <20100621005313.AA4DE3904D2@trac.osgeo.org>	<4C1F15A2.9060005@altribe.org>
	<20100621092234.GD6276@keybit.net>	<4C1F4B9C.3080800@altribe.org>
	<20100621143224.GJ6276@keybit.net>
Message-ID: <4C1F8D18.80506@altribe.org>

On 06/21/2010 04:32 PM, strk wrote:
> Alright, convinced.
> Thanks for the review.
> r3060 has them back unchecked, with checks moved at PHP level.

Great ! :)

-- 
Maxime
From mbdavis at refractions.net  Mon Jun 21 12:06:12 2010
From: mbdavis at refractions.net (Martin Davis)
Date: Mon Jun 21 12:03:18 2010
Subject: [geos-devel] Re: linearref::LinearIterator segfaults
In-Reply-To: <20100619110231.GZ6276@keybit.net>
References: <20100619110231.GZ6276@keybit.net>
Message-ID: <4C1F8DF4.4050208@refractions.net>

Thanks, strk.

I added a check in the LinearIterator constructor:

  /**
   * Creates an iterator starting at
   * a component and vertex in a linear {@link Geometry}
   *
   * @param linearGeom the linear geometry to iterate over
   * @param componentIndex the component to start at
   * @param vertexIndex the vertex to start at
   * @throws IllegalArgumentException if linearGeom is not lineal
   */
  public LinearIterator(Geometry linearGeom, int componentIndex, int 
vertexIndex)
  {
      if (! (linearGeom instanceof Lineal))
              throw new IllegalArgumentException("Lineal geometry is 
required");


strk wrote:
> Doing tests for the PHP biding I found a segfault
> when using the C-API GEOSProject method against
> something which is not a lineal geometry.
>
> This goes down to linearref::LinearIterator assuming
> the input is a lineal geometry w/out checking.
>
> The bug goes deep into JTS as well, where you don't get
> a segfault but do a wrong assumption here:
>
>   private void loadCurrentLine()                                                  {
>     if (componentIndex >= numLines) {
>       currentLine = null;
>       return;
>     }
>     currentLine = (LineString) linear.getGeometryN(componentIndex);
>   }
>
> That is, there's no code checking that 'linear' is a LINESTRING
> or MULTILINESTRING:
>
>   public LinearIterator(Geometry linear, int componentIndex, int vertexIndex) {
>     this.linear = linear;
>     numLines = linear.getNumGeometries();
>     this.componentIndex = componentIndex;
>     this.vertexIndex = vertexIndex;
>     loadCurrentLine();
>   }
>
> I'd throw an IllegalArgumentException from the constructor, if geom
> is not LINEAL.
>
> Will do this in GEOS trunk, but wanted to signal JTS too...
>
> --strk;
>
>   ()   Free GIS & Flash consultant/developer
>   /\   http://strk.keybit.net/services.html
>   

-- 
Martin Davis
Senior Technical Architect
Refractions Research, Inc.
(250) 383-3022

From giohappy at gmail.com  Tue Jun 22 08:26:24 2010
From: giohappy at gmail.com (G. Allegri)
Date: Tue Jun 22 08:26:26 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
Message-ID: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>

I'm using Postgis 1.5.1 to compute a Union on a quite large
multipolygons dataset (some hundreds of thousands of features), but
I'm facing the following error:

NOTICE:  TopologyException: found non-noded intersection between
LINESTRING (1.7318e+006 4.77959e+006, 1.7318e+006 4.77958e+006) and
LINESTRING (1.7318e+006 4.77958e+006, 1.73174e+006 4.77954e+006) at
1.7318e+006 4.77958e+006

ERROR:  GEOS union() threw an error!

I know it's a known issue, but I haven't been able to find a good,
replicable, solution. The input geometries result valid (in simple
feature meaning).
What is causing this? I have overlapping polygons, but I thought the
cascaded union algorithm computed the necessary noding on the
linestrings.
I've supposed it depends on tolerances/precision model, but I don't if
it makes sense and how, eventually, tune it.

Thanks a lot,
Giovanni
From mbdavis at refractions.net  Tue Jun 22 11:52:30 2010
From: mbdavis at refractions.net (Martin Davis)
Date: Tue Jun 22 11:49:30 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
Message-ID: <4C20DC3E.10905@refractions.net>

Unfortunately the polygon overlay operations in GEOS/JTS aren't 
perfectly robust, so it's possible that there is some pair of polygons 
computed during the union which causes a robustness error.

Also, there was a bug uncovered recently in JTS which has the effect of 
not performing some robustness improvement steps during CascadedUnion.  
It's a simple fix, so perhaps someone (strk?) will be able to implement 
it in GEOS.

It looks like your geometries are fairly low precision, so rounding 
probably won't help.  You might try translating your dataset so that it 
lies around the origin.

Martin

G. Allegri wrote:
> I'm using Postgis 1.5.1 to compute a Union on a quite large
> multipolygons dataset (some hundreds of thousands of features), but
> I'm facing the following error:
>
> NOTICE:  TopologyException: found non-noded intersection between
> LINESTRING (1.7318e+006 4.77959e+006, 1.7318e+006 4.77958e+006) and
> LINESTRING (1.7318e+006 4.77958e+006, 1.73174e+006 4.77954e+006) at
> 1.7318e+006 4.77958e+006
>
> ERROR:  GEOS union() threw an error!
>
> I know it's a known issue, but I haven't been able to find a good,
> replicable, solution. The input geometries result valid (in simple
> feature meaning).
> What is causing this? I have overlapping polygons, but I thought the
> cascaded union algorithm computed the necessary noding on the
> linestrings.
> I've supposed it depends on tolerances/precision model, but I don't if
> it makes sense and how, eventually, tune it.
>
> Thanks a lot,
> Giovanni
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
>   

-- 
Martin Davis
Senior Technical Architect
Refractions Research, Inc.
(250) 383-3022

From mbdavis at refractions.net  Tue Jun 22 11:58:24 2010
From: mbdavis at refractions.net (Martin Davis)
Date: Tue Jun 22 11:55:22 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <4C20DC3E.10905@refractions.net>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<4C20DC3E.10905@refractions.net>
Message-ID: <4C20DDA0.2060701@refractions.net>

By the way, I tried the sample dataset you posted here in JTS 1.12 (alpha):

http://www.giovanniallegri.it/share/postgis_selection.zip

and it processes fine.  Actually it also works fine in JTS 1.11 (before the bug fix I mentioned).  

If this is a one-off case, you can always extract your data and process it in JTS.  Or if it's an on-going need, you can check out JEQL for a way to run spatial operations using JTS on data from a variety of data sources.

http://tsusiatsoftware.net/jeql/main.html

Martin



Martin Davis wrote:
> Unfortunately the polygon overlay operations in GEOS/JTS aren't 
> perfectly robust, so it's possible that there is some pair of polygons 
> computed during the union which causes a robustness error.
>
> Also, there was a bug uncovered recently in JTS which has the effect 
> of not performing some robustness improvement steps during 
> CascadedUnion.  It's a simple fix, so perhaps someone (strk?) will be 
> able to implement it in GEOS.
>
> It looks like your geometries are fairly low precision, so rounding 
> probably won't help.  You might try translating your dataset so that 
> it lies around the origin.
>
> Martin
>
> G. Allegri wrote:
>> I'm using Postgis 1.5.1 to compute a Union on a quite large
>> multipolygons dataset (some hundreds of thousands of features), but
>> I'm facing the following error:
>>
>> NOTICE:  TopologyException: found non-noded intersection between
>> LINESTRING (1.7318e+006 4.77959e+006, 1.7318e+006 4.77958e+006) and
>> LINESTRING (1.7318e+006 4.77958e+006, 1.73174e+006 4.77954e+006) at
>> 1.7318e+006 4.77958e+006
>>
>> ERROR:  GEOS union() threw an error!
>>
>> I know it's a known issue, but I haven't been able to find a good,
>> replicable, solution. The input geometries result valid (in simple
>> feature meaning).
>> What is causing this? I have overlapping polygons, but I thought the
>> cascaded union algorithm computed the necessary noding on the
>> linestrings.
>> I've supposed it depends on tolerances/precision model, but I don't if
>> it makes sense and how, eventually, tune it.
>>
>> Thanks a lot,
>> Giovanni
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>
>>   
>

-- 
Martin Davis
Senior Technical Architect
Refractions Research, Inc.
(250) 383-3022

From giohappy at gmail.com  Tue Jun 22 13:03:37 2010
From: giohappy at gmail.com (G. Allegri)
Date: Tue Jun 22 13:03:40 2010
Subject: [geos-devel] Re: TopologyException: found non-noded intersection
In-Reply-To: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
Message-ID: <AANLkTil7tXpxMYfafnrE4Efsu8w4P0N01BROh-scaa3K@mail.gmail.com>

Thanks Martin.
I see that jts 1.11 works fine on a subset of my dataset. I have
hundreds of thousands od polygons to merge... I have to find the way
to read them to pass the collection to JTS without receiving
java.lang.OutOfMemoryError (just happened!).
What do you suggest to build the collection needed by CascadedUnion
without havind to create a huge Collection of geometries?

I will take a look at JEQL. Thanks for the hint, I didn't know it...

Giovanni

2010/6/22 G. Allegri <giohappy@gmail.com>:
> I'm using Postgis 1.5.1 to compute a Union on a quite large
> multipolygons dataset (some hundreds of thousands of features), but
> I'm facing the following error:
>
> NOTICE: ?TopologyException: found non-noded intersection between
> LINESTRING (1.7318e+006 4.77959e+006, 1.7318e+006 4.77958e+006) and
> LINESTRING (1.7318e+006 4.77958e+006, 1.73174e+006 4.77954e+006) at
> 1.7318e+006 4.77958e+006
>
> ERROR: ?GEOS union() threw an error!
>
> I know it's a known issue, but I haven't been able to find a good,
> replicable, solution. The input geometries result valid (in simple
> feature meaning).
> What is causing this? I have overlapping polygons, but I thought the
> cascaded union algorithm computed the necessary noding on the
> linestrings.
> I've supposed it depends on tolerances/precision model, but I don't if
> it makes sense and how, eventually, tune it.
>
> Thanks a lot,
> Giovanni
>
From mbdavis at refractions.net  Tue Jun 22 13:15:33 2010
From: mbdavis at refractions.net (Martin Davis)
Date: Tue Jun 22 13:12:31 2010
Subject: [geos-devel] Re: TopologyException: found non-noded intersection
In-Reply-To: <AANLkTil7tXpxMYfafnrE4Efsu8w4P0N01BROh-scaa3K@mail.gmail.com>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<AANLkTil7tXpxMYfafnrE4Efsu8w4P0N01BROh-scaa3K@mail.gmail.com>
Message-ID: <4C20EFB5.8060504@refractions.net>

Giovanni,

That's a good point. In both JTS and GEOS CascadedUnion is limited to 
operating in main memory.  (However, it may be that GEOS running under 
PostGIS is more memory-efficient, or is able to utilize a larger memory 
space).

There's not really an easy solution for working with JTS CascadedUnion 
and very large datasets.  (This also applies to using CascadedUnion in 
JEQL - although JEQL itself is not memory-bound, it can process data in 
a streaming fashion.  But the CascadedUnion algorithm is not stream-based).

Some alternatives that come to mind are:

- use 64-bit Java and lots of memory

- implement your own "GriddedUnion" in PostGIS (and maybe involving 
JTS).  I can provided details if you like.

Martin

G. Allegri wrote:
> Thanks Martin.
> I see that jts 1.11 works fine on a subset of my dataset. I have
> hundreds of thousands od polygons to merge... I have to find the way
> to read them to pass the collection to JTS without receiving
> java.lang.OutOfMemoryError (just happened!).
> What do you suggest to build the collection needed by CascadedUnion
> without havind to create a huge Collection of geometries?
>
> I will take a look at JEQL. Thanks for the hint, I didn't know it...
>
> Giovanni
>
> 2010/6/22 G. Allegri <giohappy@gmail.com>:
>   
>> I'm using Postgis 1.5.1 to compute a Union on a quite large
>> multipolygons dataset (some hundreds of thousands of features), but
>> I'm facing the following error:
>>
>> NOTICE:  TopologyException: found non-noded intersection between
>> LINESTRING (1.7318e+006 4.77959e+006, 1.7318e+006 4.77958e+006) and
>> LINESTRING (1.7318e+006 4.77958e+006, 1.73174e+006 4.77954e+006) at
>> 1.7318e+006 4.77958e+006
>>
>> ERROR:  GEOS union() threw an error!
>>
>> I know it's a known issue, but I haven't been able to find a good,
>> replicable, solution. The input geometries result valid (in simple
>> feature meaning).
>> What is causing this? I have overlapping polygons, but I thought the
>> cascaded union algorithm computed the necessary noding on the
>> linestrings.
>> I've supposed it depends on tolerances/precision model, but I don't if
>> it makes sense and how, eventually, tune it.
>>
>> Thanks a lot,
>> Giovanni
>>
>>     
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
>   

-- 
Martin Davis
Senior Technical Architect
Refractions Research, Inc.
(250) 383-3022

From giohappy at gmail.com  Tue Jun 22 16:53:40 2010
From: giohappy at gmail.com (G. Allegri)
Date: Tue Jun 22 17:00:00 2010
Subject: [geos-devel] Re: TopologyException: found non-noded intersection
In-Reply-To: <AANLkTil7tXpxMYfafnrE4Efsu8w4P0N01BROh-scaa3K@mail.gmail.com>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<AANLkTil7tXpxMYfafnrE4Efsu8w4P0N01BROh-scaa3K@mail.gmail.com>
Message-ID: <AANLkTikmC5kIXnnfO74n53YSLP9ezv_rgKozONvlWDhR@mail.gmail.com>

> In both JTS and GEOS CascadedUnion is limited to operating in main memory

I supposed it, that's why...

> implement your own "GriddedUnion" in PostGIS (and maybe involving
> JTS).  I can provided details if you like.

...would be of great help! I've been considering that but I haven't
given it the needed time yet. Now I have to!
My customer would prefere to work entirely on Postgis, without
involving external tools/dependencies, but I prefer to the job well
and use jts (or something else) then to risk unexpected topology
exceptions. I've never combined Postgis and JTS (I just set up a basic
test through geotools time ago)...
If you can share hints on this and griddedunion, it would be really useful.

thanks,
giovanni



2010/6/22 G. Allegri <giohappy@gmail.com>:
> Thanks Martin.
> I see that jts 1.11 works fine on a subset of my dataset. I have
> hundreds of thousands od polygons to merge... I have to find the way
> to read them to pass the collection to JTS without receiving
> java.lang.OutOfMemoryError (just happened!).
> What do you suggest to build the collection needed by CascadedUnion
> without havind to create a huge Collection of geometries?
>
> I will take a look at JEQL. Thanks for the hint, I didn't know it...
>
> Giovanni
>
> 2010/6/22 G. Allegri <giohappy@gmail.com>:
>> I'm using Postgis 1.5.1 to compute a Union on a quite large
>> multipolygons dataset (some hundreds of thousands of features), but
>> I'm facing the following error:
>>
>> NOTICE: ?TopologyException: found non-noded intersection between
>> LINESTRING (1.7318e+006 4.77959e+006, 1.7318e+006 4.77958e+006) and
>> LINESTRING (1.7318e+006 4.77958e+006, 1.73174e+006 4.77954e+006) at
>> 1.7318e+006 4.77958e+006
>>
>> ERROR: ?GEOS union() threw an error!
>>
>> I know it's a known issue, but I haven't been able to find a good,
>> replicable, solution. The input geometries result valid (in simple
>> feature meaning).
>> What is causing this? I have overlapping polygons, but I thought the
>> cascaded union algorithm computed the necessary noding on the
>> linestrings.
>> I've supposed it depends on tolerances/precision model, but I don't if
>> it makes sense and how, eventually, tune it.
>>
>> Thanks a lot,
>> Giovanni
>>
>
From strk at keybit.net  Wed Jun 23 05:14:23 2010
From: strk at keybit.net (strk)
Date: Wed Jun 23 05:14:27 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <4C20DC3E.10905@refractions.net>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<4C20DC3E.10905@refractions.net>
Message-ID: <20100623091423.GF7111@keybit.net>

On Tue, Jun 22, 2010 at 08:52:30AM -0700, Martin Davis wrote:

> Also, there was a bug uncovered recently in JTS which has the effect of 
> not performing some robustness improvement steps during CascadedUnion.  
> It's a simple fix, so perhaps someone (strk?) will be able to implement 

A ticket with an attached testcase would help going there.
Fundings would even get it done within a reasonable amount of time :)

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From geos-trac at osgeo.org  Wed Jun 23 05:23:57 2010
From: geos-trac at osgeo.org (GEOS)
Date: Wed Jun 23 05:23:58 2010
Subject: [geos-devel] Re: [GEOS] #351: Missing includes
In-Reply-To: <044.8a91459b2cedfe51267aefc38e411909@osgeo.org>
References: <044.8a91459b2cedfe51267aefc38e411909@osgeo.org>
Message-ID: <053.a01c09be31baca9d30eb2227f5fa5224@osgeo.org>

#351: Missing includes
------------------------+---------------------------------------------------
 Reporter:  yabo        |        Owner:  geos-devel@?              
     Type:  defect      |       Status:  closed                    
 Priority:  major       |    Milestone:                            
Component:  Default     |      Version:  svn-trunk                 
 Severity:  Unassigned  |   Resolution:  fixed                     
 Keywords:              |  
------------------------+---------------------------------------------------
Changes (by strk):

  * status:  new => closed
  * resolution:  => fixed


Comment:

 Thanks, committed in r3061

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/351#comment:1>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Wed Jun 23 05:47:18 2010
From: geos-trac at osgeo.org (GEOS)
Date: Wed Jun 23 05:47:19 2010
Subject: [geos-devel] Re: [GEOS] #349: Missing const on
	Geometry::isWithinDistance
In-Reply-To: <044.d27df3541b54a454beeb4c98fc1dcc3b@osgeo.org>
References: <044.d27df3541b54a454beeb4c98fc1dcc3b@osgeo.org>
Message-ID: <053.5f10e293b02c6db60d20fa07611eedb1@osgeo.org>

#349: Missing const on Geometry::isWithinDistance
------------------------+---------------------------------------------------
 Reporter:  yabo        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 Sure, committed in r3063

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/349#comment:1>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Wed Jun 23 05:48:37 2010
From: geos-trac at osgeo.org (GEOS)
Date: Wed Jun 23 05:48:38 2010
Subject: [geos-devel] Re: [GEOS] #349: Missing const on
	Geometry::isWithinDistance
In-Reply-To: <044.d27df3541b54a454beeb4c98fc1dcc3b@osgeo.org>
References: <044.d27df3541b54a454beeb4c98fc1dcc3b@osgeo.org>
Message-ID: <053.8db1b7128847d74e39224339b2566ef1@osgeo.org>

#349: Missing const on Geometry::isWithinDistance
------------------------+---------------------------------------------------
 Reporter:  yabo        |        Owner:  geos-devel@?              
     Type:  defect      |       Status:  closed                    
 Priority:  major       |    Milestone:                            
Component:  Default     |      Version:  svn-trunk                 
 Severity:  Unassigned  |   Resolution:  fixed                     
 Keywords:              |  
------------------------+---------------------------------------------------
Changes (by strk):

  * status:  new => closed
  * resolution:  => fixed


-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/349#comment:2>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From strk at keybit.net  Wed Jun 23 12:16:45 2010
From: strk at keybit.net (strk)
Date: Wed Jun 23 12:16:48 2010
Subject: [geos-devel] gstrdup in CAPI implementation
Message-ID: <20100623161645.GN7111@keybit.net>

I haven't investigated much, but valgrind
is complaining about some non-null-terminated
strings coming out from WKBWriter::writeHEX.

I guess it _might_ be expected, given writeHEX
takes a size_t output parameter, but wanted
to make sure this is the case.

I find it pretty useless for an HEX-returning 
function to skip null-termination (let alone
return by unsigned char*). But this is another
story.

So, question is: are gstrdup and gstrdup_s
functions in geos_ts.cpp intended to include
or not a null termination ?
Note that gstrdup_s takes a size but reads
one more byte from input pointer:

char* gstrdup_s(const char* str, const std::size_t size)
{
    char* out = static_cast<char*>(std::malloc(size + 1));
    if (0 != out)
    {
        // as no strlen call necessary, memcpy may be faster than strcpy
        std::memcpy(out, str, size + 1);
            ^^^^^^^^^^^^^^^^^ HERE ^^^^^^^^^
    }

    assert(0 != out);
    return out;
}


--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From geos-trac at osgeo.org  Thu Jun 24 04:30:42 2010
From: geos-trac at osgeo.org (GEOS)
Date: Thu Jun 24 04:30:46 2010
Subject: [geos-devel] [GEOS] #354: CAPI: WKTWriter has setOutputDimension
 but no getOutputDimension
Message-ID: <044.6b5ca5ed6872aff0c8124f72bb44f7af@osgeo.org>

#354: CAPI: WKTWriter has setOutputDimension but no getOutputDimension
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  task        |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 The summary says it all, for consistency WKTWriter should also have a
 getOutputDimension method exposed.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/354>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Thu Jun 24 05:32:09 2010
From: geos-trac at osgeo.org (GEOS)
Date: Thu Jun 24 05:32:11 2010
Subject: [geos-devel] [GEOS] #355: CAPI: SRID in WKT Reader and Writer
Message-ID: <044.f51ef556750ac86e68a1a6805f1a9335@osgeo.org>

#355: CAPI: SRID in WKT Reader and Writer
-------------------------+--------------------------------------------------
 Reporter:  strk         |       Owner:  geos-devel@?              
     Type:  enhancement  |      Status:  new                       
 Priority:  major        |   Milestone:                            
Component:  Default      |     Version:  3.0.3                     
 Severity:  Unassigned   |    Keywords:                            
-------------------------+--------------------------------------------------
 For consistency, SRID inclusion could be configured for WKTWriter
 and WKTReader (like it is for WKB reader/writer)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/355>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From strk at keybit.net  Thu Jun 24 06:00:00 2010
From: strk at keybit.net (strk)
Date: Thu Jun 24 06:00:04 2010
Subject: [geos-devel] PHP binding ready
Message-ID: <20100624100000.GQ7111@keybit.net>

PHP bindings for GEOS are ready for wider test/use.

Exposed classes:
	- GEOSWKTReader
	- GEOSWKTWriter
	- GEOSWKBReader (hex-only)
	- GEOSWKBWriter (hex-only)
	- GEOSGeometry

Only missing functionality in GEOSGeometry is
the ::normalize function, being the only mutator
function in the whole C-API (ouch).

The code comes with unit testing, which you can 
look at to see how to use.

./configure --enable-php && make check

Buildbot support for such configuration would be
nice to have. Anyone ?
http://buildbot.osgeo.org:8506/waterfall times out, btw.

Suggestions for a good documentation plan are welcome.
Ideally something integrating with Doxygen.


--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From geos-trac at osgeo.org  Thu Jun 24 11:32:29 2010
From: geos-trac at osgeo.org (GEOS)
Date: Thu Jun 24 11:32:31 2010
Subject: [geos-devel] [GEOS] #356: Buffer error
Message-ID: <049.df4e06055480a5bb59caf458d37a4314@osgeo.org>

#356: Buffer error
------------------------+---------------------------------------------------
 Reporter:  aperi2007   |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:  3.2.1                     
Component:  Default     |     Version:  3.2.0                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 Hi,

 In postgis try-ing a Buffer with this:

 select
     1 as id,
         ST_Buffer(ST_GeomFromText('MULTILINESTRING(
         (1676339.95971128 4847443.67952346,
         1676340.19 4847443.54,
         1676338.44 4847440.65,
         1676335.37 4847442.52,
         1676337.12 4847445.4,
         1676339.95971128 4847443.67952346)
 )'),1) as geom;

 I experience a Bug .
 The buffer build a Polygon with a strange secondary polygon near a vertex.

 The Geos used from Postgis 1.5.1 is Geos 3.2.0, so I try
 downloading the last Geos 3.2.2 compile and use it.
 But the bug is still here.

 I work with windows , postgis 1.5.1.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/356>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From strk at keybit.net  Fri Jun 25 04:49:57 2010
From: strk at keybit.net (strk)
Date: Fri Jun 25 04:49:59 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <4C20DDA0.2060701@refractions.net>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<4C20DC3E.10905@refractions.net> <4C20DDA0.2060701@refractions.net>
Message-ID: <20100625084957.GX7111@keybit.net>

On Tue, Jun 22, 2010 at 08:58:24AM -0700, Martin Davis wrote:
> By the way, I tried the sample dataset you posted here in JTS 1.12 (alpha):
> 
> http://www.giovanniallegri.it/share/postgis_selection.zip
> 
> and it processes fine.  Actually it also works fine in JTS 1.11 (before the 
> bug fix I mentioned).  

Tried with GEOS trunk too, and works as well.
We need another selection ...

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From giohappy at gmail.com  Fri Jun 25 05:35:36 2010
From: giohappy at gmail.com (G. Allegri)
Date: Fri Jun 25 05:35:39 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <20100625084957.GX7111@keybit.net>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<4C20DC3E.10905@refractions.net> <4C20DDA0.2060701@refractions.net>
	<20100625084957.GX7111@keybit.net>
Message-ID: <AANLkTimu56v-yj9nbxP-qSfpZgQvPgDU6MQaL2s_Eiss@mail.gmail.com>

Actually this selection works. We're selecting more precisely the
geometries that give problems.

giovanni

2010/6/25 strk <strk@keybit.net>:
> On Tue, Jun 22, 2010 at 08:58:24AM -0700, Martin Davis wrote:
>> By the way, I tried the sample dataset you posted here in JTS 1.12 (alpha):
>>
>> http://www.giovanniallegri.it/share/postgis_selection.zip
>>
>> and it processes fine. ?Actually it also works fine in JTS 1.11 (before the
>> bug fix I mentioned).
>
> Tried with GEOS trunk too, and works as well.
> We need another selection ...
>
> --strk;
>
> ?() ? Free GIS & Flash consultant/developer
> ?/\ ? http://strk.keybit.net/services.html
>
From giohappy at gmail.com  Fri Jun 25 08:14:51 2010
From: giohappy at gmail.com (G. Allegri)
Date: Fri Jun 25 08:14:54 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <AANLkTimu56v-yj9nbxP-qSfpZgQvPgDU6MQaL2s_Eiss@mail.gmail.com>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<4C20DC3E.10905@refractions.net> <4C20DDA0.2060701@refractions.net>
	<20100625084957.GX7111@keybit.net>
	<AANLkTimu56v-yj9nbxP-qSfpZgQvPgDU6MQaL2s_Eiss@mail.gmail.com>
Message-ID: <AANLkTiltcUialgoaPrIRAvEcMETn8QHfvjCSFcuc5y0T@mail.gmail.com>

Here is a testcase which reproduces the exception:
http://www.giovanniallegri.it/share/selezione_exp1_red2.sql
Me and strk are trying to get into the problem... If someone else
(Martin) could give it a try...

giovanni


2010/6/25 G. Allegri <giohappy@gmail.com>:
> Actually this selection works. We're selecting more precisely the
> geometries that give problems.
>
> giovanni
>
> 2010/6/25 strk <strk@keybit.net>:
>> On Tue, Jun 22, 2010 at 08:58:24AM -0700, Martin Davis wrote:
>>> By the way, I tried the sample dataset you posted here in JTS 1.12 (alpha):
>>>
>>> http://www.giovanniallegri.it/share/postgis_selection.zip
>>>
>>> and it processes fine. ?Actually it also works fine in JTS 1.11 (before the
>>> bug fix I mentioned).
>>
>> Tried with GEOS trunk too, and works as well.
>> We need another selection ...
>>
>> --strk;
>>
>> ?() ? Free GIS & Flash consultant/developer
>> ?/\ ? http://strk.keybit.net/services.html
>>
>
From strk at keybit.net  Fri Jun 25 08:42:16 2010
From: strk at keybit.net (strk)
Date: Fri Jun 25 08:42:23 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <AANLkTiltcUialgoaPrIRAvEcMETn8QHfvjCSFcuc5y0T@mail.gmail.com>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<4C20DC3E.10905@refractions.net> <4C20DDA0.2060701@refractions.net>
	<20100625084957.GX7111@keybit.net>
	<AANLkTimu56v-yj9nbxP-qSfpZgQvPgDU6MQaL2s_Eiss@mail.gmail.com>
	<AANLkTiltcUialgoaPrIRAvEcMETn8QHfvjCSFcuc5y0T@mail.gmail.com>
Message-ID: <20100625124216.GB7111@keybit.net>

It's to be noted that non-cascaded union (the one using
robustness handling heuristics) succeeds with this input.

--strk;

On Fri, Jun 25, 2010 at 02:14:51PM +0200, G. Allegri wrote:
> Here is a testcase which reproduces the exception:
> http://www.giovanniallegri.it/share/selezione_exp1_red2.sql
> Me and strk are trying to get into the problem... If someone else
> (Martin) could give it a try...
> 
> giovanni
> 
> 
> 2010/6/25 G. Allegri <giohappy@gmail.com>:
> > Actually this selection works. We're selecting more precisely the
> > geometries that give problems.
> >
> > giovanni
> >
> > 2010/6/25 strk <strk@keybit.net>:
> >> On Tue, Jun 22, 2010 at 08:58:24AM -0700, Martin Davis wrote:
> >>> By the way, I tried the sample dataset you posted here in JTS 1.12 (alpha):
> >>>
> >>> http://www.giovanniallegri.it/share/postgis_selection.zip
> >>>
> >>> and it processes fine. ?Actually it also works fine in JTS 1.11 (before the
> >>> bug fix I mentioned).
> >>
> >> Tried with GEOS trunk too, and works as well.
> >> We need another selection ...
> >>
> >> --strk;
> >>
> >> ?() ? Free GIS & Flash consultant/developer
> >> ?/\ ? http://strk.keybit.net/services.html
> >>
> >
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From geos-trac at osgeo.org  Fri Jun 25 09:46:37 2010
From: geos-trac at osgeo.org (GEOS)
Date: Fri Jun 25 09:46:40 2010
Subject: [geos-devel] [GEOS] #358: Exception on Union
Message-ID: <044.27982233bb1acd7870b63b2a3ea1cfbb@osgeo.org>

#358: Exception on Union
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 The attached SQL file contains two valid geometries (a and b)
 that, when unioned, result in a topology exception.

 It is interesting that the CommonBitsRemover heuristic succeeds
 in obtaining a valid union with bits removed, but results in
 the output getting invalid again when re-adding the common bits !!

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/358>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From geos-trac at osgeo.org  Fri Jun 25 09:48:45 2010
From: geos-trac at osgeo.org (GEOS)
Date: Fri Jun 25 09:48:47 2010
Subject: [geos-devel] Re: [GEOS] #358: Exception on Union
In-Reply-To: <044.27982233bb1acd7870b63b2a3ea1cfbb@osgeo.org>
References: <044.27982233bb1acd7870b63b2a3ea1cfbb@osgeo.org>
Message-ID: <053.ca5eef4ad743bfe8d84e8f5fa2aa1333@osgeo.org>

#358: Exception on Union
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 It is also interesting that cascaded union succeeds w/out heuristics on
 the same dataset.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/358#comment:1>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From strk at keybit.net  Fri Jun 25 10:39:17 2010
From: strk at keybit.net (strk)
Date: Fri Jun 25 10:39:23 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
Message-ID: <20100625143916.GB17726@keybit.net>

Martin, is there any support for testing CascadedUnion
with the XML format ? Would help comparing GEOS/JTS.

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 25 11:21:07 2010
From: strk at keybit.net (strk)
Date: Fri Jun 25 11:21:12 2010
Subject: [geos-devel] TopologyException: found non-noded intersection
In-Reply-To: <4C20DC3E.10905@refractions.net>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>
	<4C20DC3E.10905@refractions.net>
Message-ID: <20100625152107.GG17726@keybit.net>

On Tue, Jun 22, 2010 at 08:52:30AM -0700, Martin Davis wrote:

> Also, there was a bug uncovered recently in JTS which has the effect of 
> not performing some robustness improvement steps during CascadedUnion.  
> It's a simple fix, so perhaps someone (strk?) will be able to implement 
> it in GEOS.

Martin, could you give more info about this ?
I see nothing about "Cascaded" in the commit log.
The closest I see is:

2010-06-09 04:42  dr_jts

        * [r112] operation/union/UnaryUnionOp.java: Fixed to use
          SnapIfNeededOverlayOp

But maybe SVN logs don'g go back enough ?
First entry is 2010-02-10

--strk; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Fri Jun 25 12:40:05 2010
From: strk at keybit.net (strk)
Date: Fri Jun 25 12:40:11 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <20100625143916.GB17726@keybit.net>
References: <20100625143916.GB17726@keybit.net>
Message-ID: <20100625164005.GH17726@keybit.net>

On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
> Martin, is there any support for testing CascadedUnion
> with the XML format ? Would help comparing GEOS/JTS.

I've found TestUnaryUnion.xml in JTS repository.
I guess that's what GEOS should be using
for testing CascadedPolygonUnion.

Only need to actually port UnaryUnion ...

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From giohappy at gmail.com  Fri Jun 25 13:41:48 2010
From: giohappy at gmail.com (G. Allegri)
Date: Fri Jun 25 13:41:53 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <20100625164005.GH17726@keybit.net>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
Message-ID: <AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>

Here is a test xml:
http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
It's big, but I will reduce it nex time :)

Notes:

1 - this multipolygon comes from an st_collect on 95 rows in a postgis
table. The test on it fails with Topology Expection found non-noded
intersection, because the MP is invalid. I've tested it on jts from
trunk.
2 - I've run a cascadedunion.union operation on a List of the same
geometries (picked with Geotools directly from the DB). It works fine.
In this test I've used jts 1.10 shipped with Geotools. I will try it
agains the trunk version as soon as possible.

Giovanni

2010/6/25 strk <strk@keybit.net>:
> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
>> Martin, is there any support for testing CascadedUnion
>> with the XML format ? Would help comparing GEOS/JTS.
>
> I've found TestUnaryUnion.xml in JTS repository.
> I guess that's what GEOS should be using
> for testing CascadedPolygonUnion.
>
> Only need to actually port UnaryUnion ...
>
> --strk;
>
> ?() ? Free GIS & Flash consultant/developer
> ?/\ ? http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
From giohappy at gmail.com  Fri Jun 25 17:48:33 2010
From: giohappy at gmail.com (G. Allegri)
Date: Fri Jun 25 17:48:35 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
Message-ID: <AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>

This is the reduced version of the test xml:
http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml

Now it contains only two geometries. It tries to node them but fails,
so a second try is done with the SnapOverlay, but it fails too.
I don't know the algorithm so I'm not able, yet, to say what is failing.

giovanni

2010/6/25 G. Allegri <giohappy@gmail.com>:
> Here is a test xml:
> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
> It's big, but I will reduce it nex time :)
>
> Notes:
>
> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
> table. The test on it fails with Topology Expection found non-noded
> intersection, because the MP is invalid. I've tested it on jts from
> trunk.
> 2 - I've run a cascadedunion.union operation on a List of the same
> geometries (picked with Geotools directly from the DB). It works fine.
> In this test I've used jts 1.10 shipped with Geotools. I will try it
> agains the trunk version as soon as possible.
>
> Giovanni
>
> 2010/6/25 strk <strk@keybit.net>:
>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
>>> Martin, is there any support for testing CascadedUnion
>>> with the XML format ? Would help comparing GEOS/JTS.
>>
>> I've found TestUnaryUnion.xml in JTS repository.
>> I guess that's what GEOS should be using
>> for testing CascadedPolygonUnion.
>>
>> Only need to actually port UnaryUnion ...
>>
>> --strk;
>>
>> ?() ? Free GIS & Flash consultant/developer
>> ?/\ ? http://strk.keybit.net/services.html
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>
>
From giohappy at gmail.com  Fri Jun 25 18:26:11 2010
From: giohappy at gmail.com (G. Allegri)
Date: Fri Jun 25 18:26:13 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
Message-ID: <AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>

Before going to bed... a snapshot of the location causing the
exception: http://www.giovanniallegri.it/share/error_condition_snapshot.png



2010/6/25 G. Allegri <giohappy@gmail.com>:
> This is the reduced version of the test xml:
> http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml
>
> Now it contains only two geometries. It tries to node them but fails,
> so a second try is done with the SnapOverlay, but it fails too.
> I don't know the algorithm so I'm not able, yet, to say what is failing.
>
> giovanni
>
> 2010/6/25 G. Allegri <giohappy@gmail.com>:
>> Here is a test xml:
>> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
>> It's big, but I will reduce it nex time :)
>>
>> Notes:
>>
>> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
>> table. The test on it fails with Topology Expection found non-noded
>> intersection, because the MP is invalid. I've tested it on jts from
>> trunk.
>> 2 - I've run a cascadedunion.union operation on a List of the same
>> geometries (picked with Geotools directly from the DB). It works fine.
>> In this test I've used jts 1.10 shipped with Geotools. I will try it
>> agains the trunk version as soon as possible.
>>
>> Giovanni
>>
>> 2010/6/25 strk <strk@keybit.net>:
>>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
>>>> Martin, is there any support for testing CascadedUnion
>>>> with the XML format ? Would help comparing GEOS/JTS.
>>>
>>> I've found TestUnaryUnion.xml in JTS repository.
>>> I guess that's what GEOS should be using
>>> for testing CascadedPolygonUnion.
>>>
>>> Only need to actually port UnaryUnion ...
>>>
>>> --strk;
>>>
>>> ?() ? Free GIS & Flash consultant/developer
>>> ?/\ ? http://strk.keybit.net/services.html
>>> _______________________________________________
>>> geos-devel mailing list
>>> geos-devel@lists.osgeo.org
>>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>>
>>
>
From strk at keybit.net  Sat Jun 26 13:12:53 2010
From: strk at keybit.net (strk)
Date: Sat Jun 26 13:12:56 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
Message-ID: <20100626171253.GI17726@keybit.net>

On Sat, Jun 26, 2010 at 12:26:11AM +0200, G. Allegri wrote:
> Before going to bed... a snapshot of the location causing the
> exception: http://www.giovanniallegri.it/share/error_condition_snapshot.png

Just in case mine is smaller, another reduction here:
http://strk.keybit.net/tmp/another_dump1.sql
(201 points in 3 geoms)

NOTE: my version is a database dump, failure happens on st_union
which fails with original geoms and fails with snapped overlay.
dropping any of the 3 geoms makes the operation succeed, haven't
checked if that's a special handling within postgis.

It'd be worth filing a ticket on trac for better handling.

--strk;

> 
> 
> 
> 2010/6/25 G. Allegri <giohappy@gmail.com>:
> > This is the reduced version of the test xml:
> > http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml
> >
> > Now it contains only two geometries. It tries to node them but fails,
> > so a second try is done with the SnapOverlay, but it fails too.
> > I don't know the algorithm so I'm not able, yet, to say what is failing.
> >
> > giovanni
> >
> > 2010/6/25 G. Allegri <giohappy@gmail.com>:
> >> Here is a test xml:
> >> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
> >> It's big, but I will reduce it nex time :)
> >>
> >> Notes:
> >>
> >> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
> >> table. The test on it fails with Topology Expection found non-noded
> >> intersection, because the MP is invalid. I've tested it on jts from
> >> trunk.
> >> 2 - I've run a cascadedunion.union operation on a List of the same
> >> geometries (picked with Geotools directly from the DB). It works fine.
> >> In this test I've used jts 1.10 shipped with Geotools. I will try it
> >> agains the trunk version as soon as possible.
> >>
> >> Giovanni
> >>
> >> 2010/6/25 strk <strk@keybit.net>:
> >>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
> >>>> Martin, is there any support for testing CascadedUnion
> >>>> with the XML format ? Would help comparing GEOS/JTS.
> >>>
> >>> I've found TestUnaryUnion.xml in JTS repository.
> >>> I guess that's what GEOS should be using
> >>> for testing CascadedPolygonUnion.
> >>>
> >>> Only need to actually port UnaryUnion ...
> >>>
> >>> --strk;
> >>>
> >>> ?() ? Free GIS & Flash consultant/developer
> >>> ?/\ ? http://strk.keybit.net/services.html
> >>> _______________________________________________
> >>> geos-devel mailing list
> >>> geos-devel@lists.osgeo.org
> >>> http://lists.osgeo.org/mailman/listinfo/geos-devel
> >>>
> >>
> >
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From giohappy at gmail.com  Sat Jun 26 18:18:22 2010
From: giohappy at gmail.com (G. Allegri)
Date: Sat Jun 26 18:18:26 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <20100626171253.GI17726@keybit.net>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
Message-ID: <AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>

I'm getting mad. The same geometries, run in a basic test written by
me works fine: http://www.giovanniallegri.it/share/test_wkt.java
The same geometries give errors in Postgis (+GEOS?) and with TestRunner...

giovanni

2010/6/26 strk <strk@keybit.net>:
> On Sat, Jun 26, 2010 at 12:26:11AM +0200, G. Allegri wrote:
>> Before going to bed... a snapshot of the location causing the
>> exception: http://www.giovanniallegri.it/share/error_condition_snapshot.png
>
> Just in case mine is smaller, another reduction here:
> http://strk.keybit.net/tmp/another_dump1.sql
> (201 points in 3 geoms)
>
> NOTE: my version is a database dump, failure happens on st_union
> which fails with original geoms and fails with snapped overlay.
> dropping any of the 3 geoms makes the operation succeed, haven't
> checked if that's a special handling within postgis.
>
> It'd be worth filing a ticket on trac for better handling.
>
> --strk;
>
>>
>>
>>
>> 2010/6/25 G. Allegri <giohappy@gmail.com>:
>> > This is the reduced version of the test xml:
>> > http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml
>> >
>> > Now it contains only two geometries. It tries to node them but fails,
>> > so a second try is done with the SnapOverlay, but it fails too.
>> > I don't know the algorithm so I'm not able, yet, to say what is failing.
>> >
>> > giovanni
>> >
>> > 2010/6/25 G. Allegri <giohappy@gmail.com>:
>> >> Here is a test xml:
>> >> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
>> >> It's big, but I will reduce it nex time :)
>> >>
>> >> Notes:
>> >>
>> >> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
>> >> table. The test on it fails with Topology Expection found non-noded
>> >> intersection, because the MP is invalid. I've tested it on jts from
>> >> trunk.
>> >> 2 - I've run a cascadedunion.union operation on a List of the same
>> >> geometries (picked with Geotools directly from the DB). It works fine.
>> >> In this test I've used jts 1.10 shipped with Geotools. I will try it
>> >> agains the trunk version as soon as possible.
>> >>
>> >> Giovanni
>> >>
>> >> 2010/6/25 strk <strk@keybit.net>:
>> >>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
>> >>>> Martin, is there any support for testing CascadedUnion
>> >>>> with the XML format ? Would help comparing GEOS/JTS.
>> >>>
>> >>> I've found TestUnaryUnion.xml in JTS repository.
>> >>> I guess that's what GEOS should be using
>> >>> for testing CascadedPolygonUnion.
>> >>>
>> >>> Only need to actually port UnaryUnion ...
>> >>>
>> >>> --strk;
>> >>>
>> >>> ?() ? Free GIS & Flash consultant/developer
>> >>> ?/\ ? http://strk.keybit.net/services.html
>> >>> _______________________________________________
>> >>> geos-devel mailing list
>> >>> geos-devel@lists.osgeo.org
>> >>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>> >>>
>> >>
>> >
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
> --
>
> ?() ? Free GIS & Flash consultant/developer
> ?/\ ? http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
From geos-trac at osgeo.org  Sat Jun 26 19:09:28 2010
From: geos-trac at osgeo.org (GEOS)
Date: Sat Jun 26 19:09:30 2010
Subject: [geos-devel] Re: [GEOS] #358: Invalid output from Union (was:
	Exception on Union)
In-Reply-To: <044.27982233bb1acd7870b63b2a3ea1cfbb@osgeo.org>
References: <044.27982233bb1acd7870b63b2a3ea1cfbb@osgeo.org>
Message-ID: <053.d33b652c93d3442195587b86356f7c0d@osgeo.org>

#358: Invalid output from Union
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:                            
Component:  Default     |     Version:  svn-trunk                 
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 Sorry, the summary was wrong, problem is not a topology exception here,
 but an invalid result. A topology exception might come up later, when
 iteratively applying the BinaryOp.

 The invalidity is a "Too few points in ring" kind. Basically when
 translated toward origin (common bits removed) the code doesn't find
 repeated points, but after re-translating up, for some reason, two points
 become the same point (precision loss, I guess?).

 If theoretically confirmed, this might mean applying common bits removal
 might not
 be a good idea from within the SnappingOverlay OP

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/358#comment:2>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).
From strk at keybit.net  Sat Jun 26 19:16:46 2010
From: strk at keybit.net (strk)
Date: Sat Jun 26 19:16:50 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
Message-ID: <20100626231646.GJ17726@keybit.net>

35 points version (2 geoms):
http://strk.keybit.net/tmp/another_dump2.sql

... still finds non-noded intersections ...

--strk;

On Sun, Jun 27, 2010 at 12:18:22AM +0200, G. Allegri wrote:
> I'm getting mad. The same geometries, run in a basic test written by
> me works fine: http://www.giovanniallegri.it/share/test_wkt.java
> The same geometries give errors in Postgis (+GEOS?) and with TestRunner...
> 
> giovanni
> 
> 2010/6/26 strk <strk@keybit.net>:
> > On Sat, Jun 26, 2010 at 12:26:11AM +0200, G. Allegri wrote:
> >> Before going to bed... a snapshot of the location causing the
> >> exception: http://www.giovanniallegri.it/share/error_condition_snapshot.png
> >
> > Just in case mine is smaller, another reduction here:
> > http://strk.keybit.net/tmp/another_dump1.sql
> > (201 points in 3 geoms)
> >
> > NOTE: my version is a database dump, failure happens on st_union
> > which fails with original geoms and fails with snapped overlay.
> > dropping any of the 3 geoms makes the operation succeed, haven't
> > checked if that's a special handling within postgis.
> >
> > It'd be worth filing a ticket on trac for better handling.
> >
> > --strk;
> >
> >>
> >>
> >>
> >> 2010/6/25 G. Allegri <giohappy@gmail.com>:
> >> > This is the reduced version of the test xml:
> >> > http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml
> >> >
> >> > Now it contains only two geometries. It tries to node them but fails,
> >> > so a second try is done with the SnapOverlay, but it fails too.
> >> > I don't know the algorithm so I'm not able, yet, to say what is failing.
> >> >
> >> > giovanni
> >> >
> >> > 2010/6/25 G. Allegri <giohappy@gmail.com>:
> >> >> Here is a test xml:
> >> >> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
> >> >> It's big, but I will reduce it nex time :)
> >> >>
> >> >> Notes:
> >> >>
> >> >> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
> >> >> table. The test on it fails with Topology Expection found non-noded
> >> >> intersection, because the MP is invalid. I've tested it on jts from
> >> >> trunk.
> >> >> 2 - I've run a cascadedunion.union operation on a List of the same
> >> >> geometries (picked with Geotools directly from the DB). It works fine.
> >> >> In this test I've used jts 1.10 shipped with Geotools. I will try it
> >> >> agains the trunk version as soon as possible.
> >> >>
> >> >> Giovanni
> >> >>
> >> >> 2010/6/25 strk <strk@keybit.net>:
> >> >>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
> >> >>>> Martin, is there any support for testing CascadedUnion
> >> >>>> with the XML format ? Would help comparing GEOS/JTS.
> >> >>>
> >> >>> I've found TestUnaryUnion.xml in JTS repository.
> >> >>> I guess that's what GEOS should be using
> >> >>> for testing CascadedPolygonUnion.
> >> >>>
> >> >>> Only need to actually port UnaryUnion ...
> >> >>>
> >> >>> --strk;
> >> >>>
> >> >>> ?() ? Free GIS & Flash consultant/developer
> >> >>> ?/\ ? http://strk.keybit.net/services.html
> >> >>> _______________________________________________
> >> >>> geos-devel mailing list
> >> >>> geos-devel@lists.osgeo.org
> >> >>> http://lists.osgeo.org/mailman/listinfo/geos-devel
> >> >>>
> >> >>
> >> >
> >> _______________________________________________
> >> geos-devel mailing list
> >> geos-devel@lists.osgeo.org
> >> http://lists.osgeo.org/mailman/listinfo/geos-devel
> >
> > --
> >
> > ?() ? Free GIS & Flash consultant/developer
> > ?/\ ? http://strk.keybit.net/services.html
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@lists.osgeo.org
> > http://lists.osgeo.org/mailman/listinfo/geos-devel
> >
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel

-- 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From giohappy at gmail.com  Sun Jun 27 06:22:35 2010
From: giohappy at gmail.com (G. Allegri)
Date: Sun Jun 27 06:22:38 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <20100626231646.GJ17726@keybit.net>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
Message-ID: <AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>

also "another_dump2" seems to execute well with JTS. I'm using its wkt
representation as a collected multipolygon:
http://www.giovanniallegri.it/share/another_dump2_collect_wkt.txt

giovanni



2010/6/27 strk <strk@keybit.net>:
> 35 points version (2 geoms):
> http://strk.keybit.net/tmp/another_dump2.sql
>
> ... still finds non-noded intersections ...
>
> --strk;
>
> On Sun, Jun 27, 2010 at 12:18:22AM +0200, G. Allegri wrote:
>> I'm getting mad. The same geometries, run in a basic test written by
>> me works fine: http://www.giovanniallegri.it/share/test_wkt.java
>> The same geometries give errors in Postgis (+GEOS?) and with TestRunner...
>>
>> giovanni
>>
>> 2010/6/26 strk <strk@keybit.net>:
>> > On Sat, Jun 26, 2010 at 12:26:11AM +0200, G. Allegri wrote:
>> >> Before going to bed... a snapshot of the location causing the
>> >> exception: http://www.giovanniallegri.it/share/error_condition_snapshot.png
>> >
>> > Just in case mine is smaller, another reduction here:
>> > http://strk.keybit.net/tmp/another_dump1.sql
>> > (201 points in 3 geoms)
>> >
>> > NOTE: my version is a database dump, failure happens on st_union
>> > which fails with original geoms and fails with snapped overlay.
>> > dropping any of the 3 geoms makes the operation succeed, haven't
>> > checked if that's a special handling within postgis.
>> >
>> > It'd be worth filing a ticket on trac for better handling.
>> >
>> > --strk;
>> >
>> >>
>> >>
>> >>
>> >> 2010/6/25 G. Allegri <giohappy@gmail.com>:
>> >> > This is the reduced version of the test xml:
>> >> > http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml
>> >> >
>> >> > Now it contains only two geometries. It tries to node them but fails,
>> >> > so a second try is done with the SnapOverlay, but it fails too.
>> >> > I don't know the algorithm so I'm not able, yet, to say what is failing.
>> >> >
>> >> > giovanni
>> >> >
>> >> > 2010/6/25 G. Allegri <giohappy@gmail.com>:
>> >> >> Here is a test xml:
>> >> >> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
>> >> >> It's big, but I will reduce it nex time :)
>> >> >>
>> >> >> Notes:
>> >> >>
>> >> >> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
>> >> >> table. The test on it fails with Topology Expection found non-noded
>> >> >> intersection, because the MP is invalid. I've tested it on jts from
>> >> >> trunk.
>> >> >> 2 - I've run a cascadedunion.union operation on a List of the same
>> >> >> geometries (picked with Geotools directly from the DB). It works fine.
>> >> >> In this test I've used jts 1.10 shipped with Geotools. I will try it
>> >> >> agains the trunk version as soon as possible.
>> >> >>
>> >> >> Giovanni
>> >> >>
>> >> >> 2010/6/25 strk <strk@keybit.net>:
>> >> >>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
>> >> >>>> Martin, is there any support for testing CascadedUnion
>> >> >>>> with the XML format ? Would help comparing GEOS/JTS.
>> >> >>>
>> >> >>> I've found TestUnaryUnion.xml in JTS repository.
>> >> >>> I guess that's what GEOS should be using
>> >> >>> for testing CascadedPolygonUnion.
>> >> >>>
>> >> >>> Only need to actually port UnaryUnion ...
>> >> >>>
>> >> >>> --strk;
>> >> >>>
>> >> >>> ?() ? Free GIS & Flash consultant/developer
>> >> >>> ?/\ ? http://strk.keybit.net/services.html
>> >> >>> _______________________________________________
>> >> >>> geos-devel mailing list
>> >> >>> geos-devel@lists.osgeo.org
>> >> >>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>> >> >>>
>> >> >>
>> >> >
>> >> _______________________________________________
>> >> geos-devel mailing list
>> >> geos-devel@lists.osgeo.org
>> >> http://lists.osgeo.org/mailman/listinfo/geos-devel
>> >
>> > --
>> >
>> > ?() ? Free GIS & Flash consultant/developer
>> > ?/\ ? http://strk.keybit.net/services.html
>> > _______________________________________________
>> > geos-devel mailing list
>> > geos-devel@lists.osgeo.org
>> > http://lists.osgeo.org/mailman/listinfo/geos-devel
>> >
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
> --
>
> ?() ? Free GIS & Flash consultant/developer
> ?/\ ? http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
From giohappy at gmail.com  Sun Jun 27 06:28:57 2010
From: giohappy at gmail.com (G. Allegri)
Date: Sun Jun 27 06:29:02 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
Message-ID: <AANLkTiko9rhakhuktHWXqZdX1S4dn1eWr9ackE_CdJEc@mail.gmail.com>

An this is the polygon resulting from Union. It is valid for JTS:
http://www.giovanniallegri.it/share/another_dump2_collect_wkt_resultfromJTS.txt

2010/6/27 G. Allegri <giohappy@gmail.com>:
> also "another_dump2" seems to execute well with JTS. I'm using its wkt
> representation as a collected multipolygon:
> http://www.giovanniallegri.it/share/another_dump2_collect_wkt.txt
>
> giovanni
>
>
>
> 2010/6/27 strk <strk@keybit.net>:
>> 35 points version (2 geoms):
>> http://strk.keybit.net/tmp/another_dump2.sql
>>
>> ... still finds non-noded intersections ...
>>
>> --strk;
>>
>> On Sun, Jun 27, 2010 at 12:18:22AM +0200, G. Allegri wrote:
>>> I'm getting mad. The same geometries, run in a basic test written by
>>> me works fine: http://www.giovanniallegri.it/share/test_wkt.java
>>> The same geometries give errors in Postgis (+GEOS?) and with TestRunner...
>>>
>>> giovanni
>>>
>>> 2010/6/26 strk <strk@keybit.net>:
>>> > On Sat, Jun 26, 2010 at 12:26:11AM +0200, G. Allegri wrote:
>>> >> Before going to bed... a snapshot of the location causing the
>>> >> exception: http://www.giovanniallegri.it/share/error_condition_snapshot.png
>>> >
>>> > Just in case mine is smaller, another reduction here:
>>> > http://strk.keybit.net/tmp/another_dump1.sql
>>> > (201 points in 3 geoms)
>>> >
>>> > NOTE: my version is a database dump, failure happens on st_union
>>> > which fails with original geoms and fails with snapped overlay.
>>> > dropping any of the 3 geoms makes the operation succeed, haven't
>>> > checked if that's a special handling within postgis.
>>> >
>>> > It'd be worth filing a ticket on trac for better handling.
>>> >
>>> > --strk;
>>> >
>>> >>
>>> >>
>>> >>
>>> >> 2010/6/25 G. Allegri <giohappy@gmail.com>:
>>> >> > This is the reduced version of the test xml:
>>> >> > http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml
>>> >> >
>>> >> > Now it contains only two geometries. It tries to node them but fails,
>>> >> > so a second try is done with the SnapOverlay, but it fails too.
>>> >> > I don't know the algorithm so I'm not able, yet, to say what is failing.
>>> >> >
>>> >> > giovanni
>>> >> >
>>> >> > 2010/6/25 G. Allegri <giohappy@gmail.com>:
>>> >> >> Here is a test xml:
>>> >> >> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
>>> >> >> It's big, but I will reduce it nex time :)
>>> >> >>
>>> >> >> Notes:
>>> >> >>
>>> >> >> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
>>> >> >> table. The test on it fails with Topology Expection found non-noded
>>> >> >> intersection, because the MP is invalid. I've tested it on jts from
>>> >> >> trunk.
>>> >> >> 2 - I've run a cascadedunion.union operation on a List of the same
>>> >> >> geometries (picked with Geotools directly from the DB). It works fine.
>>> >> >> In this test I've used jts 1.10 shipped with Geotools. I will try it
>>> >> >> agains the trunk version as soon as possible.
>>> >> >>
>>> >> >> Giovanni
>>> >> >>
>>> >> >> 2010/6/25 strk <strk@keybit.net>:
>>> >> >>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
>>> >> >>>> Martin, is there any support for testing CascadedUnion
>>> >> >>>> with the XML format ? Would help comparing GEOS/JTS.
>>> >> >>>
>>> >> >>> I've found TestUnaryUnion.xml in JTS repository.
>>> >> >>> I guess that's what GEOS should be using
>>> >> >>> for testing CascadedPolygonUnion.
>>> >> >>>
>>> >> >>> Only need to actually port UnaryUnion ...
>>> >> >>>
>>> >> >>> --strk;
>>> >> >>>
>>> >> >>> ?() ? Free GIS & Flash consultant/developer
>>> >> >>> ?/\ ? http://strk.keybit.net/services.html
>>> >> >>> _______________________________________________
>>> >> >>> geos-devel mailing list
>>> >> >>> geos-devel@lists.osgeo.org
>>> >> >>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>> >> >>>
>>> >> >>
>>> >> >
>>> >> _______________________________________________
>>> >> geos-devel mailing list
>>> >> geos-devel@lists.osgeo.org
>>> >> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>> >
>>> > --
>>> >
>>> > ?() ? Free GIS & Flash consultant/developer
>>> > ?/\ ? http://strk.keybit.net/services.html
>>> > _______________________________________________
>>> > geos-devel mailing list
>>> > geos-devel@lists.osgeo.org
>>> > http://lists.osgeo.org/mailman/listinfo/geos-devel
>>> >
>>> _______________________________________________
>>> geos-devel mailing list
>>> geos-devel@lists.osgeo.org
>>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>
>> --
>>
>> ?() ? Free GIS & Flash consultant/developer
>> ?/\ ? http://strk.keybit.net/services.html
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>
>
From giohappy at gmail.com  Sun Jun 27 08:18:57 2010
From: giohappy at gmail.com (G. Allegri)
Date: Sun Jun 27 08:18:59 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTiko9rhakhuktHWXqZdX1S4dn1eWr9ackE_CdJEc@mail.gmail.com>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
	<AANLkTiko9rhakhuktHWXqZdX1S4dn1eWr9ackE_CdJEc@mail.gmail.com>
Message-ID: <AANLkTikKLUP2A2gZFjfT9ffv828yw05Sye_MBjTlScjh@mail.gmail.com>

Ok, I've found the difference between the tests. I set up a test run
with precisionModel FIXED and scale 1.0. With this model the union
fails. While, the default precisionModel for the UnionOp is FLOATING
(scale=0.0) and this runs ok...

What is the model used by GEOS?

2010/6/27 G. Allegri <giohappy@gmail.com>:
> An this is the polygon resulting from Union. It is valid for JTS:
> http://www.giovanniallegri.it/share/another_dump2_collect_wkt_resultfromJTS.txt
>
> 2010/6/27 G. Allegri <giohappy@gmail.com>:
>> also "another_dump2" seems to execute well with JTS. I'm using its wkt
>> representation as a collected multipolygon:
>> http://www.giovanniallegri.it/share/another_dump2_collect_wkt.txt
>>
>> giovanni
>>
>>
>>
>> 2010/6/27 strk <strk@keybit.net>:
>>> 35 points version (2 geoms):
>>> http://strk.keybit.net/tmp/another_dump2.sql
>>>
>>> ... still finds non-noded intersections ...
>>>
>>> --strk;
>>>
>>> On Sun, Jun 27, 2010 at 12:18:22AM +0200, G. Allegri wrote:
>>>> I'm getting mad. The same geometries, run in a basic test written by
>>>> me works fine: http://www.giovanniallegri.it/share/test_wkt.java
>>>> The same geometries give errors in Postgis (+GEOS?) and with TestRunner...
>>>>
>>>> giovanni
>>>>
>>>> 2010/6/26 strk <strk@keybit.net>:
>>>> > On Sat, Jun 26, 2010 at 12:26:11AM +0200, G. Allegri wrote:
>>>> >> Before going to bed... a snapshot of the location causing the
>>>> >> exception: http://www.giovanniallegri.it/share/error_condition_snapshot.png
>>>> >
>>>> > Just in case mine is smaller, another reduction here:
>>>> > http://strk.keybit.net/tmp/another_dump1.sql
>>>> > (201 points in 3 geoms)
>>>> >
>>>> > NOTE: my version is a database dump, failure happens on st_union
>>>> > which fails with original geoms and fails with snapped overlay.
>>>> > dropping any of the 3 geoms makes the operation succeed, haven't
>>>> > checked if that's a special handling within postgis.
>>>> >
>>>> > It'd be worth filing a ticket on trac for better handling.
>>>> >
>>>> > --strk;
>>>> >
>>>> >>
>>>> >>
>>>> >>
>>>> >> 2010/6/25 G. Allegri <giohappy@gmail.com>:
>>>> >> > This is the reduced version of the test xml:
>>>> >> > http://www.giovanniallegri.it/share/TestUnionMultiPolygon_red.xml
>>>> >> >
>>>> >> > Now it contains only two geometries. It tries to node them but fails,
>>>> >> > so a second try is done with the SnapOverlay, but it fails too.
>>>> >> > I don't know the algorithm so I'm not able, yet, to say what is failing.
>>>> >> >
>>>> >> > giovanni
>>>> >> >
>>>> >> > 2010/6/25 G. Allegri <giohappy@gmail.com>:
>>>> >> >> Here is a test xml:
>>>> >> >> http://www.giovanniallegri.it/share/TestUnionMultiPolygon.xml
>>>> >> >> It's big, but I will reduce it nex time :)
>>>> >> >>
>>>> >> >> Notes:
>>>> >> >>
>>>> >> >> 1 - this multipolygon comes from an st_collect on 95 rows in a postgis
>>>> >> >> table. The test on it fails with Topology Expection found non-noded
>>>> >> >> intersection, because the MP is invalid. I've tested it on jts from
>>>> >> >> trunk.
>>>> >> >> 2 - I've run a cascadedunion.union operation on a List of the same
>>>> >> >> geometries (picked with Geotools directly from the DB). It works fine.
>>>> >> >> In this test I've used jts 1.10 shipped with Geotools. I will try it
>>>> >> >> agains the trunk version as soon as possible.
>>>> >> >>
>>>> >> >> Giovanni
>>>> >> >>
>>>> >> >> 2010/6/25 strk <strk@keybit.net>:
>>>> >> >>> On Fri, Jun 25, 2010 at 04:39:17PM +0200, strk wrote:
>>>> >> >>>> Martin, is there any support for testing CascadedUnion
>>>> >> >>>> with the XML format ? Would help comparing GEOS/JTS.
>>>> >> >>>
>>>> >> >>> I've found TestUnaryUnion.xml in JTS repository.
>>>> >> >>> I guess that's what GEOS should be using
>>>> >> >>> for testing CascadedPolygonUnion.
>>>> >> >>>
>>>> >> >>> Only need to actually port UnaryUnion ...
>>>> >> >>>
>>>> >> >>> --strk;
>>>> >> >>>
>>>> >> >>> ?() ? Free GIS & Flash consultant/developer
>>>> >> >>> ?/\ ? http://strk.keybit.net/services.html
>>>> >> >>> _______________________________________________
>>>> >> >>> geos-devel mailing list
>>>> >> >>> geos-devel@lists.osgeo.org
>>>> >> >>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>>> >> >>>
>>>> >> >>
>>>> >> >
>>>> >> _______________________________________________
>>>> >> geos-devel mailing list
>>>> >> geos-devel@lists.osgeo.org
>>>> >> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>>> >
>>>> > --
>>>> >
>>>> > ?() ? Free GIS & Flash consultant/developer
>>>> > ?/\ ? http://strk.keybit.net/services.html
>>>> > _______________________________________________
>>>> > geos-devel mailing list
>>>> > geos-devel@lists.osgeo.org
>>>> > http://lists.osgeo.org/mailman/listinfo/geos-devel
>>>> >
>>>> _______________________________________________
>>>> geos-devel mailing list
>>>> geos-devel@lists.osgeo.org
>>>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>>
>>> --
>>>
>>> ?() ? Free GIS & Flash consultant/developer
>>> ?/\ ? http://strk.keybit.net/services.html
>>> _______________________________________________
>>> geos-devel mailing list
>>> geos-devel@lists.osgeo.org
>>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>>
>>
>
From strk at keybit.net  Sun Jun 27 16:39:58 2010
From: strk at keybit.net (strk)
Date: Sun Jun 27 16:40:02 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
Message-ID: <20100627203958.GK17726@keybit.net>

On Sun, Jun 27, 2010 at 12:22:35PM +0200, G. Allegri wrote:
> also "another_dump2" seems to execute well with JTS. I'm using its wkt
> representation as a collected multipolygon:
> http://www.giovanniallegri.it/share/another_dump2_collect_wkt.txt
> 

Don't ! 
WKT representation is lossy.
SELECT ST_Union(ST_AsText(g));
would succeed too (and does)...

-- strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Sun Jun 27 16:42:05 2010
From: strk at keybit.net (strk)
Date: Sun Jun 27 16:42:08 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTikKLUP2A2gZFjfT9ffv828yw05Sye_MBjTlScjh@mail.gmail.com>
References: <20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
	<AANLkTiko9rhakhuktHWXqZdX1S4dn1eWr9ackE_CdJEc@mail.gmail.com>
	<AANLkTikKLUP2A2gZFjfT9ffv828yw05Sye_MBjTlScjh@mail.gmail.com>
Message-ID: <20100627204205.GL17726@keybit.net>

On Sun, Jun 27, 2010 at 02:18:57PM +0200, G. Allegri wrote:
> Ok, I've found the difference between the tests. I set up a test run
> with precisionModel FIXED and scale 1.0. With this model the union
> fails. While, the default precisionModel for the UnionOp is FLOATING
> (scale=0.0) and this runs ok...
> 
> What is the model used by GEOS?

FLOATING (the model used by the C-AP, thus postgis)

--strk;; 

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From giohappy at gmail.com  Sun Jun 27 16:57:37 2010
From: giohappy at gmail.com (G. Allegri)
Date: Sun Jun 27 16:57:39 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <20100627203958.GK17726@keybit.net>
References: <20100625143916.GB17726@keybit.net>
	<20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
	<20100627203958.GK17726@keybit.net>
Message-ID: <AANLkTinOIQubZWns6uHVQ225CEZcS_mG3D51vG_JS8D9@mail.gmail.com>

Are you sure it works?
select st_union(st_astext(the_geom)) from selezione_exp1_red2 (one of
your reductions) doesn't give any output...

Anyway, do you suggest using wkb?

2010/6/27 strk <strk@keybit.net>:
> On Sun, Jun 27, 2010 at 12:22:35PM +0200, G. Allegri wrote:
>> also "another_dump2" seems to execute well with JTS. I'm using its wkt
>> representation as a collected multipolygon:
>> http://www.giovanniallegri.it/share/another_dump2_collect_wkt.txt
>>
>
> Don't !
> WKT representation is lossy.
> SELECT ST_Union(ST_AsText(g));
> would succeed too (and does)...
>
> -- strk;
>
> ?() ? Free GIS & Flash consultant/developer
> ?/\ ? http://strk.keybit.net/services.html
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
From strk at keybit.net  Sun Jun 27 17:14:22 2010
From: strk at keybit.net (strk)
Date: Sun Jun 27 17:14:24 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <AANLkTinOIQubZWns6uHVQ225CEZcS_mG3D51vG_JS8D9@mail.gmail.com>
References: <20100625164005.GH17726@keybit.net>
	<AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
	<20100627203958.GK17726@keybit.net>
	<AANLkTinOIQubZWns6uHVQ225CEZcS_mG3D51vG_JS8D9@mail.gmail.com>
Message-ID: <20100627211422.GA87010@keybit.net>

On Sun, Jun 27, 2010 at 10:57:37PM +0200, G. Allegri wrote:
> Are you sure it works?
> select st_union(st_astext(the_geom)) from selezione_exp1_red2 (one of
> your reductions) doesn't give any output...

Doesn't _always_ work, did for another_dump2:

strk=# select st_isvalid(st_union(g)) from another_dump2;
ERROR:  GEOSUnionCascaded: TopologyException: found non-noded intersection between LINESTRING (184.319 2038.88, 186.647 2046.15) and LINESTRING (186.647 2046.15, 186.647 2046.15) at 186.647 2046.15
strk=# select st_isvalid(st_union(st_astext(g))) from another_dump2;
 st_isvalid
------------
 t
(1 row)



> Anyway, do you suggest using wkb?

Yes. HEXEWKB (the canonical output) is handled by JTS just fine.

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From strk at keybit.net  Sun Jun 27 17:16:36 2010
From: strk at keybit.net (strk)
Date: Sun Jun 27 17:16:38 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <20100627211422.GA87010@keybit.net>
References: <AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
	<20100627203958.GK17726@keybit.net>
	<AANLkTinOIQubZWns6uHVQ225CEZcS_mG3D51vG_JS8D9@mail.gmail.com>
	<20100627211422.GA87010@keybit.net>
Message-ID: <20100627211636.GB87010@keybit.net>

On Sun, Jun 27, 2010 at 11:14:22PM +0200, strk wrote:
> On Sun, Jun 27, 2010 at 10:57:37PM +0200, G. Allegri wrote:
> > Are you sure it works?
> > select st_union(st_astext(the_geom)) from selezione_exp1_red2 (one of
> > your reductions) doesn't give any output...
> 
> Doesn't _always_ work, did for another_dump2:

For the record, using SnapToGrid gives you more control over the 
roundup. 1e-6 "gridding" works in the exp1_red2 case too:

# select st_isvalid(st_union(snaptogrid(the_geom, 0.0000001))) from selezione_exp1_red2;
 st_isvalid
------------
 t
(1 row)

--strk;

  ()   Free GIS & Flash consultant/developer
  /\   http://strk.keybit.net/services.html
From giohappy at gmail.com  Sun Jun 27 17:35:00 2010
From: giohappy at gmail.com (G. Allegri)
Date: Sun Jun 27 17:35:02 2010
Subject: [geos-devel] CascadedPolygonUnion XML testing
In-Reply-To: <20100627211636.GB87010@keybit.net>
References: <AANLkTikkgMCr5OuBv1k8eA4wbrNzEYI-1pusJP1bk7nx@mail.gmail.com>
	<AANLkTilVgzO9snuyxlboxDodvsJNsv5EqyvCxQ6fBf4w@mail.gmail.com>
	<AANLkTimynLVBPk2UnDh_nGom1bD3DTFy_DilVdy96Fs5@mail.gmail.com>
	<20100626171253.GI17726@keybit.net>
	<AANLkTikGlxQOtpXaodICIjKZ0efuGvGVyn3Mlj-3hO-Y@mail.gmail.com>
	<20100626231646.GJ17726@keybit.net>
	<AANLkTikkIUk61v2s8hES4bsaySYgS0dTqWdjVVlN4NOr@mail.gmail.com>
	<20100627203958.GK17726@keybit.net>
	<AANLkTinOIQubZWns6uHVQ225CEZcS_mG3D51vG_JS8D9@mail.gmail.com>
	<20100627211422.GA87010@keybit.net>
	<20100627211636.GB87010@keybit.net>
Message-ID: <AANLkTikrR1Cib2AXZh7rWdFdGgdGBkGWc5uSyzmIrhi2@mail.gmail.com>

> For the record, using SnapToGrid gives you more control over the
> roundup. 1e-6 "gridding" works in the exp1_red2 case too:

Well, this is like using a FIXED precision model with scale 1e6, if
I'm not wrong. Anyway I would expect a FLOATING model to work well
too, as it does in JTS. I've tested HEXWKB from exp1_red2, and it
works fine, so I think the result in JTS doesn't depend on the lossy
wkt representation.
From mbdavis at refractions.net  Mon Jun 28 11:54:50 2010
From: mbdavis at refractions.net (Martin Davis)
Date: Mon Jun 28 11:51:36 2010
Subject: [geos-devel] Re: CascadedPolygonUnion XML testing
In-Reply-To: <20100625143916.GB17726@keybit.net>
References: <20100625143916.GB17726@keybit.net>
Message-ID: <4C28C5CA.5050306@refractions.net>

As you saw, CascadedUnion is tested indirectly via the UnaryUnion tests.

Warning - those tests are just a small set of sanity tests. They don't 
really stress the algorithm!

strk wrote:
> Martin, is there any support for testing CascadedUnion
> with the XML format ? Would help comparing GEOS/JTS.
>
> --strk; 
>
>   ()   Free GIS & Flash consultant/developer
>   /\   http://strk.keybit.net/services.html
>   

-- 
Martin Davis
Senior Technical Architect
Refractions Research, Inc.
(250) 383-3022

From giohappy at gmail.com  Mon Jun 28 11:59:53 2010
From: giohappy at gmail.com (G. Allegri)
Date: Mon Jun 28 11:59:55 2010
Subject: [geos-devel] Re: CascadedPolygonUnion XML testing
In-Reply-To: <4C28C5CA.5050306@refractions.net>
References: <20100625143916.GB17726@keybit.net>
	<4C28C5CA.5050306@refractions.net>
Message-ID: <AANLkTilBj0gf3oKdHbkTcCWx6rhfylQxzXse5jUCvFfy@mail.gmail.com>

Hi Martin, nice to see you.
Maybe you've read the various mails from me and strk. After various
tests, it seems JTS don't seem to fall in the exceptions thrown by
GEOS, and the unstable GEOS behaviour seems to be related to floating
point operations (like common bits removing). I'm going to stress JTS
some more...

giovanni

2010/6/28 Martin Davis <mbdavis@refractions.net>:
> As you saw, CascadedUnion is tested indirectly via the UnaryUnion tests.
>
> Warning - those tests are just a small set of sanity tests. They don't
> really stress the algorithm!
>
> strk wrote:
>>
>> Martin, is there any support for testing CascadedUnion
>> with the XML format ? Would help comparing GEOS/JTS.
>>
>> --strk;
>> ?() ? Free GIS & Flash consultant/developer
>> ?/\ ? http://strk.keybit.net/services.html
>>
>
> --
> Martin Davis
> Senior Technical Architect
> Refractions Research, Inc.
> (250) 383-3022
>
> _______________________________________________
> geos-devel mailing list
> geos-devel@lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/geos-devel
>
From mbdavis at refractions.net  Mon Jun 28 13:16:39 2010
From: mbdavis at refractions.net (Martin Davis)
Date: Mon Jun 28 13:13:25 2010
Subject: [geos-devel] Gridded Union idea
In-Reply-To: <4C20EFB5.8060504@refractions.net>
References: <AANLkTildQ3fElZv0FWuiYdY9N6SksypPHwoMWtFtI4k3@mail.gmail.com>	<AANLkTil7tXpxMYfafnrE4Efsu8w4P0N01BROh-scaa3K@mail.gmail.com>
	<4C20EFB5.8060504@refractions.net>
Message-ID: <4C28D8F7.6040702@refractions.net>

Here's the idea of Gridded Union I mentioned as a workaround to memory 
limitations for CascadedUnion in JTS & GEOS.

Basically this mimics the operation of CascadedUnion, but using a grid 
index instead of a tree, since that's easier to code in a database 
environment.

1. Choose an appropriate grid size.  This will have to be determined by 
experimentation.  The goal is to use as large a cell size as possible, 
but small enought to allow the unions in step 4 to all execute.
2. First, extract the "lowest" coordinate from each geometry.  This will 
be used to assign the geometry to a grid cell.  The lowest coordinate 
can be defined as the coordinate with minimum X, and then minimum Y.  (I 
have to admit, I don't know how to do this in PostGIS - but I'm sure 
there's a way!)
3. Compute the grid cell for each geometry, by determining which grid 
cell the min point lies in
4. Union the geometries in each grid cell to a new table.
5. Finally, union all the geometries in the new table.

As long as there is a significant amount of overlap between the 
geometries, the intermediate union step should result in a large 
decrease in the number of points which need to be unioned in the final step

Note that step 4 parallelizes easily, so you might be able to get a 
significant performance increase as well.  This can be parallized on the 
DB server by issuing multiple union queries concurrently.

Note that I haven't actually tried this, so there may be some flaw I'm 
overlooking.  If anyone tries this, I'd like to hear about the results.

Martin

Martin Davis wrote:
> Giovanni,
>
> That's a good point. In both JTS and GEOS CascadedUnion is limited to 
> operating in main memory.  (However, it may be that GEOS running under 
> PostGIS is more memory-efficient, or is able to utilize a larger 
> memory space).
>
> There's not really an easy solution for working with JTS CascadedUnion 
> and very large datasets.  (This also applies to using CascadedUnion in 
> JEQL - although JEQL itself is not memory-bound, it can process data 
> in a streaming fashion.  But the CascadedUnion algorithm is not 
> stream-based).
>
> Some alternatives that come to mind are:
>
> - use 64-bit Java and lots of memory
>
> - implement your own "GriddedUnion" in PostGIS (and maybe involving 
> JTS).  I can provided details if you like.
>
> Martin
>
> G. Allegri wrote:
>> Thanks Martin.
>> I see that jts 1.11 works fine on a subset of my dataset. I have
>> hundreds of thousands od polygons to merge... I have to find the way
>> to read them to pass the collection to JTS without receiving
>> java.lang.OutOfMemoryError (just happened!).
>> What do you suggest to build the collection needed by CascadedUnion
>> without havind to create a huge Collection of geometries?
>>
>> I will take a look at JEQL. Thanks for the hint, I didn't know it...
>>
>> Giovanni
>>
>> 2010/6/22 G. Allegri <giohappy@gmail.com>:
>>  
>>> I'm using Postgis 1.5.1 to compute a Union on a quite large
>>> multipolygons dataset (some hundreds of thousands of features), but
>>> I'm facing the following error:
>>>
>>> NOTICE:  TopologyException: found non-noded intersection between
>>> LINESTRING (1.7318e+006 4.77959e+006, 1.7318e+006 4.77958e+006) and
>>> LINESTRING (1.7318e+006 4.77958e+006, 1.73174e+006 4.77954e+006) at
>>> 1.7318e+006 4.77958e+006
>>>
>>> ERROR:  GEOS union() threw an error!
>>>
>>> I know it's a known issue, but I haven't been able to find a good,
>>> replicable, solution. The input geometries result valid (in simple
>>> feature meaning).
>>> What is causing this? I have overlapping polygons, but I thought the
>>> cascaded union algorithm computed the necessary noding on the
>>> linestrings.
>>> I've supposed it depends on tolerances/precision model, but I don't if
>>> it makes sense and how, eventually, tune it.
>>>
>>> Thanks a lot,
>>> Giovanni
>>>
>>>     
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/geos-devel
>>
>>   
>

-- 
Martin Davis
Senior Technical Architect
Refractions Research, Inc.
(250) 383-3022

