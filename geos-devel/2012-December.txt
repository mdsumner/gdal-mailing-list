From gvaleika at gmail.com  Mon Dec  3 10:49:28 2012
From: gvaleika at gmail.com (=?UTF-8?Q?Gra=C5=BEvydas_Valeika?=)
Date: Mon, 3 Dec 2012 20:49:28 +0200
Subject: [geos-devel] Fwd: st_buffer crashes server
In-Reply-To: <CAO6eJZojLLYQdyG+ffoWSjFYsEx8W5_HKDazzN1UDyHhcZJSgw@mail.gmail.com>
References: <CAO6eJZojLLYQdyG+ffoWSjFYsEx8W5_HKDazzN1UDyHhcZJSgw@mail.gmail.com>
Message-ID: <CAO6eJZqEoL7JBfkpza=A2F03Gotkd9RnrsdEstz7Pp4o6m0kHg@mail.gmail.com>

Hi all,

today I had unpleasant situation - st_buffer crashed my server. After some
log inspection I've find that st_buffer, or to be more precise, geos
crashed server. To make situation worse, it happened in the way, when
crashing call was produced by service, service fails, Postgres run in
circles:

terminating any other active server processes
terminating connection because of crash of another server process
The postmaster has commanded this server process to roll back the current
transaction and exit, because another server process exited abnormally and
possibly corrupted shared memory.
In a moment you should be able to reconnect to the database and repeat your
command.
the database system is in recovery mode
redo starts at 26/F8DB1A00
record with zero length at 26/F8DE7D58
redo done at 26/F8DE7D28
last completed transaction was at log time 2012-12-03 17:34:55.285808+02
autovacuum launcher started
database system is ready to accept connections

and then, failed service tries another time to do what it is asked, and
crashes in the same way.

I'm getting geos error: SELECT: RightmostEdgeFinder.cpp:77: void
geos::operation::buffer::RightmostEdgeFinder::findEdge(std::vector<geos::geomgraph::DirectedEdge*,
std::allocator<geos::geomgraph::DirectedEdge*> >*): Assertion `checked>0'
failed.

But this doesn't help much, because in their bugtracker it is mentioned for
years, time to time changing status to 'fixed' , but, as we can see, this
fix doesn't work well. (http://trac.osgeo.org/geos/ticket/473)

This crash happens with same data on Scientific Linux release 6.3, Fedora
release 16, Windows Server 2008 R2 (all of them 64 bits). On linuxes I have
PGDG 9.2.1 PostgreSQL with bundled Postgis 2.0, windows: "POSTGIS="2.0.1
r9979" GEOS="3.3.5-CAPI-1.7.5" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL
1.9.1, released 2012/05/15" LIBXML="2.7.8" LIBJSON="UNKNOWN" RASTER".


Both SL and Fedora have geos-3.3.5-1. Windows - libgeos-3-3-5.dll.

With minor data changes, call works normally. It would be nice to find
workaround which would help to protect DBMS server from crash. Changing of
radius_of_buffer  parameter from 1000 to 1001 in this call helps, but I am
frightented that it will fail with another geometry input.

Best regards,

Grazvydas

Bad behaving query:


select st_buffer(st_geomfromtext('LINESTRING(388198
6056788.3125001,388092.708841545 6056810.2110781,388088.920493843
6056967.93374297,388241.956691708 6057273.06946183,388481.94116096
6057599.24728253,
388450.615057762 6057788.60752023,388636.887768547
6058618.51458289,388575.098744835 6059249.3480535,388474.392698583
6059431.13197422,388252.570132005 6060588.91556507,
388138.573761171 6060963.23473355,388134.221733554
6061168.9551149,388299.160032874 6061394.41812456,388495.538867362
6061924.31858251,388332.370336841 6062138.11937723,
388119.211582829 6062230.26685346,388110.25175897
6062522.42617419,388165.506860547 6062748.51579152,388123.828222584
6062846.8479905,388133.803362367 6063141.16660669,
388064.564019166 6063243.27635235,387716.728231868
6063389.12380394,387453.115341178 6063849.8464528,387188.899722711
6064434.77944927,386726.051764386 6065921.01741559,
386527.803954052 6066405.26080532,386167.716575243
6067005.70139789,385585.129661588 6067750.82724575,384377.479486561
6069706.42224637,381303.184154561 6075430.53477082,
380938.825063071 6075953.44262464,379576.166973678
6077621.16952598,378617.680329676 6079335.72562118,377692.247058369
6080354.61070676,377304.98997202 6080868.84136614,
376119.146366383 6083160.6663075,375533.996242582
6084119.42036258,374831.2997138 6085068.06506297,374239.343010324
6085700.28783992,373667.330967215 6086156.23924685,
372431.267944668 6086964.31974138,371658.572051644
6087723.20126027,371184.358950609 6088414.63985996,369295.313145564
6091948.39630187,368510.010900525 6093900.30288199,
367699.079184587 6095641.17579127,366839.965846187
6097765.46196932,365887.033263914 6100299.38724338,365704.388073836
6100959.46445081,365381.540134711 6102674.28775494,
364698.31205062 6105321.58891112,364420.13298109
6105954.50724961,363567.334008088 6107222.47989483,363378.045274123
6107623.83942034,361272.146778924 6114111.545846,
360696.478924724 6116653.94545047,360625.946490487
6117579.6210964,361085.424946998 6120296.02187525,361129.554866774
6121826.37696278,361221.00136377 6122302.61003117,
361356.311073206 6122507.64959402,359931.783565909
6123603.77468629,359335.92095244 6123981.14671129,359095.301851194
6123744.88716597,358685.742038043 6123598.20791129,
358729 6123404,358729 6123404,358622.693709635
6123764.44708204,357239.91098603 6123124.35800193,357181.5 6123153,357181.5
6123153,357232.159652672 6123120.44225534,
358379.138263059 6123653.23254885,358045.151179082
6124395.52177733,358261.928444251 6124569.618564,358077.865280239
6124838.18210352,358281.044343582 6124982.05367936,
358432.766000182 6125165.71179119,358375.669443869
6125262.28106258,359789.175958758 6126217.21693403,359809.655435652
6126184.44927005,359739.362906316 6126110.63846627,
359825 6125976,359825 6125976,359739.362906316
6126110.63846627,359798.23045867 6126148.42609188,359789.175958758
6126217.21693403,360323.491342721 6126598.10301608,
364105.700770721 6130589.54564699,365851.118627503
6133776.04159448,366074.924340233 6134077.5652318,366321.276893722
6134309.5818053,366752.527028152 6134568.10150752,
373346.647541771 6137433.71166638,373718.872489144
6137668.49630618,375295.498589261 6138886.92620252,380360.32646877
6141721.21191597,380111.862144265 6142591.67766098,
380188.965151436 6142863.32687809,380412.556804893
6143070.19850033,380326.51146761 6143486.2191135,380519.86965456
6143672.04731848,380524.672688485 6143745.65405921,
380333.210322103 6144277.10325332,380366.537370783
6144825.73061995,380268.927547754 6145283.97143005,380101.057446265
6145452.75372955,380072.61124807 6145554.36976643,
379910.941600418 6147258.40194766,379895.687981905
6147888.36419869,379645.66003822 6148831.99607563,379584.096108666
6149348.80443556,379757.037432146 6150109.02363008,
379782.695357509 6151294.47303588,379940.061949347
6151544.25492761,379892.065462456 6152163.0470847,379852.912014202
6152193.70518401,379881.507158488 6152775.52694882,
379735.825345059 6153190.50246425,379798.964041976
6153600.96172558,379604.84141527 6153880.28255335,380274.62842471
6154663.22487804,380296.916351767 6154764.4053277,
380407.96506929 6154758.60352038,380404.973832117
6154930.39286119,380533.266481 6154956.03942,380533.266481
6154956.03942,380697.469609411 6154933.37328515,
380804.601918464 6154718.75524037,380003.000283501
6154234.91781766,379947.596702516 6154268.33657074,379604.84141527
6153880.28255335,379801.104099702 6153581.04862935,
379734.034176517 6153214.61521516,379879.325267865
6152797.41205984,379852.912014202 6152193.70518401,379940.061949347
6151544.25492761,379782.695357509 6151294.47303588,
379757.037432146 6150109.02363008,379584.096108666
6149348.80443556,379645.66003822 6148831.99607563,379895.687981905
6147888.36419869,379910.941600418 6147258.40194766,
380078.689290296 6145509.57402919,380268.927547754
6145283.97143005,380293.424476874 6145037.39476578,380366.235644963
6144852.36309869,380330.160194237 6144288.82245702,
380532.368921331 6143696.47274357,380330.569412652
6143508.9916221,380418.378928402 6143089.13720483,380201.908916375
6142890.21141506,380113.567105044 6142613.12216422,
380358.007167029 6141736.36302396,375141.310137443
6138794.83236084,373718.872489144 6137668.49630618,373346.647541771
6137433.71166638,366752.527028152 6134568.10150752,
366261.351299655 6134260.49101737,365851.118627503
6133776.04159448,364105.700770721 6130589.54564699,360775.41757528
6127074.35479882,360953.797311602 6126892.71824755,
361415.446406647 6124129.77434326,361418.461836166
6123309.50723627,361223.676981864 6122424.10716164,361158.196642996
6122397.73568352,361113.476183368 6122455.98975904,
361231.736678766 6122617.56913771,359931.783565909
6123603.77468629,359335.92095244 6123981.14671129,359095.301851194
6123744.88716597,358685.742038043 6123598.20791129,
358741.0625 6123522,358741.0625 6123522,357971.36255807
6125108.43269709,357920.008042721 6125077.68096362,357679.808786759
6125460.74022553,357213.718482872 6125510.63249069,
357060 6125868,357060 6125868,357003.056253166
6125944.75887484,356749.73178741 6125801.21952087,356576.400427944
6125577.20775089,356509.666450818 6125295.74512354,
356454 6125304,356454 6125304,356509.666450818
6125295.74512354,356485.06516117 6124575.24473136,356746.540496635
6124608.57147991,356808 6124501,356808 6124501,
356841.04623812 6124345.94903632,356917.601431696
6124368.97007825,357540.531428107 6124708.38003617,357962.38036606
6125101.9157808,358337.402089666 6124407.55301858,
358652.565855199 6124352.24990397,359082.983074971
6124156.03807671,359519.418855862 6123853.86577455,359507 6123806,359507
6123806,359519.418855862 6123853.86577455,
358927.509705773 6124235.82599912,358668.99357866
6124346.01258094,358346.979589857 6124383.702781,357971.36255807
6125108.43269709,357540.531428107 6124708.38003617,
356545.762875273 6124169.95952009,356642.213182996
6123954.08053072,356541.426332461 6123823.05777582,356444 6123955,356444
6123955,356528.633898072 6123802.58917791,
356635.327210811 6123941.87391433,356536.358713067
6124164.88456013,357540.531428107 6124708.38003617,357898.367966032
6125061.33495277,358375.669443869 6125262.28106258,
359864.195548135 6126265.27116361,360279.790154604
6126555.44586471,360762.970983925 6127054.06482593,364105.700770721
6130589.54564699,365851.118627503 6133776.04159448,
366074.924340233 6134077.5652318,366360.991546586
6134339.22803017,366752.527028152 6134568.10150752,373346.647541771
6137433.71166638,373718.872489144 6137668.49630618,
375295.498589261 6138886.92620252,380360.32646877
6141721.21191597,380111.862144265 6142591.67766098,380188.965151436
6142863.32687809,380412.556804893 6143070.19850033,
380326.51146761 6143486.2191135,380519.86965456
6143672.04731848,380524.672688485 6143745.65405921,380333.210322103
6144277.10325332,380366.537370783 6144825.73061995,
380268.927547754 6145283.97143005,380101.057446265
6145452.75372955,380072.61124807 6145554.36976643,379910.941600418
6147258.40194766,379895.687981905 6147888.36419869,
379645.66003822 6148831.99607563,379584.096108666
6149348.80443556,379757.037432146 6150109.02363008,379782.695357509
6151294.47303588,379940.061949347 6151544.25492761,
379892.065462456 6152163.0470847,379852.912014202
6152193.70518401,379881.507158488 6152775.52694882,379735.825345059
6153190.50246425,379798.964041976 6153600.96172558,
379604.84141527 6153880.28255335,380274.62842471
6154663.22487804,380270.707586966 6154922.27465547,380401.543492492
6154969.07054731,380395.790832264 6155021.2631309,
380225.171669476 6155038.03451076,380009.961292789
6155174.55789084,380214.541517594 6155508.21736627,380471.273097537
6155787.73721704,380779.514035757 6156457.27872544,
380664.720504259 6156522.49306375,380565.632008301
6156470.80623459,380565.632008301 6156470.80623459,380659.885725872
6156528.60438952,380770.908059047 6156461.95579602,
380471.273097537 6155787.73721704,380224.131766873
6155521.71880139,380009.961292789 6155174.55789084,380241.317773985
6155032.03703938,380395.316987553 6155026.58763786,
380399.760813982 6154978.75127648,380278.928144154
6154937.86254539,380274.62842471 6154663.22487804,379604.84141527
6153880.28255335,379801.104099702 6153581.04862935,
379734.034176517 6153214.61521516,379879.325267865
6152797.41205984,379852.912014202 6152193.70518401,379940.061949347
6151544.25492761,379782.695357509 6151294.47303588,
379757.037432146 6150109.02363008,379584.096108666
6149348.80443556,379645.66003822 6148831.99607563,379895.687981905
6147888.36419869,379910.941600418 6147258.40194766,
380078.689290296 6145509.57402919,380268.927547754
6145283.97143005,380293.424476874 6145037.39476578,380366.235644963
6144852.36309869,380330.160194237 6144288.82245702,
380532.368921331 6143696.47274357,380330.569412652
6143508.9916221,380418.378928402 6143089.13720483,380201.908916375
6142890.21141506,380113.567105044 6142613.12216422,
380358.007167029 6141736.36302396,375141.310137443
6138794.83236084,373718.872489144 6137668.49630618,373346.647541771
6137433.71166638,366826.150471738 6134600.68215773,
366384.177071635 6134356.53424428,366074.924340233
6134077.5652318,365851.118627503 6133776.04159448,364105.700770721
6130589.54564699,360283.950543384 6126559.51325796,
358310.754368459 6125224.10678874,357976.08601118
6125117.84819477,357566.504359631 6124728.78392167,356485.06516117
6124575.24473136,356474.37159831 6124718.01769267,
356394 6124712,356394 6124712,356474.37159831
6124718.01769267,356485.06516117 6124575.24473136,356746.540496635
6124608.57147991,356841.04623812 6124345.94903632,
356917.601431696 6124368.97007825,357540.531428107
6124708.38003617,357898.367966032 6125061.33495277,358375.669443869
6125262.28106258,360279.790154604 6126555.44586471,
364105.700770721 6130589.54564699,365851.118627503
6133776.04159448,366220.074543707 6134224.37808788,366136.936463203
6134224.04608468,366110.33046146 6134300.85927697,
366140.96755391 6135400.4088888,366262.088579507
6135953.44233793,366243.224373423 6136539.96317083,366869.109960216
6139049.28144522,366861.962049922 6139393.21523448,
366783.963283364 6139810.26288602,366810.021621773
6140097.76752051,366909.839012986 6140346.59460061,367483.155296243
6141289.28680997,368491.366973702 6144297.76560617,
368624.352440217 6144834.69168676,368815.544245043
6145099.54822602,369230.077151043 6145239.2445828,370681.28754639
6146615.8063275,371346.506937068 6147048.89562104,
372670.642536898 6148303.46738851,375735.574462588
6153280.35465536,376025.682515648 6153968.41706293,376181.477195906
6154040.98847407,377590.660285194 6154019.98732847,
378068.953140288 6154094.72967084,378572.849829578
6154240.81730227,379168.5625 6154562.5,379168.5625
6154562.5,378596.752745659 6154250.4673199,
378077.605910676 6154096.88336475,377590.660285194
6154019.98732847,376181.477195906 6154040.98847407,376025.682515648
6153968.41706293,375735.574462588 6153280.35465536,
372670.642536898 6148303.46738851,371346.506937068
6147048.89562104,370681.28754639 6146615.8063275,369230.077151043
6145239.2445828,368798.447992323 6145087.03940357,
368624.352440217 6144834.69168676,368491.366973702
6144297.76560617,367483.155296243 6141289.28680997,366909.839012986
6140346.59460061,366810.021621773 6140097.76752051,
366783.963283364 6139810.26288602,366861.962049922
6139393.21523448,366869.109960216 6139049.28144522,366252.868206412
6136622.02568867,366262.088579507 6135953.44233793,
366144.737792622 6135428.89321238,366099.59095496
6134250.64732141,364105.700770721 6130589.54564699,360283.950543384
6126559.51325796,358310.754368459 6125224.10678874,
357976.08601118 6125117.84819477,357566.504359631
6124728.78392167,356027.21875 6124543)'), 1000, 'endcap=round');
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20121203/68523ff4/attachment-0001.html>

From geos-trac at osgeo.org  Tue Dec  4 04:42:41 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 12:42:41 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.8fd8b3b8389213b6e4bed234743bb1c3@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 In any case the assertion means that there are NO forward edges in a
 BufferSubgraph, which is probably a robustness issue on its own (so may be
 worth a TopologyException).
 What do you think Martin ?

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:8>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 03:36:55 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 11:36:55 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.a68ba3fcbd3ac2c948269ff6e22bd442@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Using MCIndexSnapRounder rather than MCIndexNoder (as JTS does) fixes this
 case.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:6>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 06:07:42 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 14:07:42 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.fe670f502444eee3beb08facf1865ba3@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Interesting enough, a further simplification of input forces JTS (current
 trunk) to get as low as precisionDigits 3 (scale factor 0.0001) before it
 gives an answer !

 Full JTS session:
 {{{
 =====  Test Runner  -  JTS Topology Suite (Version 1.13.0)  =====
 Reading test file
 /home/src/geos/geos/tests/xmltester/tests/ticket/bug605.xml
 Running tests...
 Trying with original precision
 Original precision failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (374252.3702753792, 6136822.694844382, NaN)
 ]
 Trying with precisionDigits 12
 recomputing with precision scale factor = 100000.0
 precisionDigits 12 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (374252.37062, 6136822.69508, NaN) ]
 Trying with precisionDigits 11
 recomputing with precision scale factor = 10000.0
 precisionDigits 11 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (373145.0804, 6138488.8817, NaN) ]
 Trying with precisionDigits 10
 recomputing with precision scale factor = 1000.0
 precisionDigits 10 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (366695.108, 6133235.285, NaN) ]
 Trying with precisionDigits 9
 recomputing with precision scale factor = 100.0
 precisionDigits 9 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (366095.54, 6132140.7, NaN) ]
 Trying with precisionDigits 8
 recomputing with precision scale factor = 10.0
 precisionDigits 8 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (373140.4, 6138485.9, NaN) ]
 Trying with precisionDigits 7
 recomputing with precision scale factor = 1.0
 precisionDigits 7 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (366694.0, 6133233.0, NaN) ]
 Trying with precisionDigits 6
 recomputing with precision scale factor = 0.1
 precisionDigits 6 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (366430.0, 6135520.0, NaN) ]
 Trying with precisionDigits 5
 recomputing with precision scale factor = 0.01
 precisionDigits 5 failed: com.vividsolutions.jts.geom.TopologyException:
 assigned depths do not match [ (375800.0, 6138000.0, NaN) ]
 Trying with precisionDigits 4
 recomputing with precision scale factor = 0.001
 precisionDigits 4 failed: com.vividsolutions.jts.geom.TopologyException:
 depth mismatch at (365000.0, 6133000.0, NaN)
 Trying with precisionDigits 3
 recomputing with precision scale factor = 1.0E-4
 Case bug605.xml - #1 (8): http://trac.osgeo.org/geos/ticket/605
 Test Failed (A buffer 1000)
 ...
   Actual: POLYGON ((360000 6130000, 370000 6140000, 380000 6140000, 370000
 6130000, 360000 6130000))
 }}}

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:10>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 02:42:27 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 10:42:27 -0000
Subject: [geos-devel] [GEOS] #602: GEOSOffsetCurve:
 IllegalArgumentException: RobustDeterminant encountered non-finite numbers
In-Reply-To: <044.9595abdf0f203da524c3f179d9beaea3@osgeo.org>
References: <044.9595abdf0f203da524c3f179d9beaea3@osgeo.org>
Message-ID: <053.10b9042c464226b9e033b2ba252b5eba@osgeo.org>

#602: GEOSOffsetCurve: IllegalArgumentException: RobustDeterminant encountered
non-finite numbers
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:  3.3.7                     
Component:  Default     |     Version:  3.3.6                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 Possibly related: #591

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/602#comment:2>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 02:48:56 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 10:48:56 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.75467c6633e1968a48fb304387be4d60@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 See also #473, same assertion there (but that specific case was fixed)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:2>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 06:30:55 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 14:30:55 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.b1e763ef8a190e91a65e3684590f6bba@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 I've attached an XML test for comparing JTS and GEOS against. The input is
 a further reduction. The expected output is actually unknown but JTS is
 clearly giving a bogus answer:
 http://strk.keybit.net/tmp/grossbuffer.png

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:11>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 05:20:30 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 13:20:30 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.4ef5c517b928c6fe52f41eb69606db6d@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Reduced input still reproducing the bug:
 {{{
 LINESTRING(
 365851.118627503 6133776.04159448,
 366074.924340233 6134077.5652318,
 375141.310137443 6138794.83236084,
 373718.872489144 6137668.49630618,
 373346.647541771 6137433.71166638,
 366752.527028152 6134568.10150752,
 360775.41757528 6127074.35479882,
 360762.970983925 6127054.06482593,
 365851.118627503 6133776.04159448,
  366074.924340233 6134077.5652318,
 366360.991546586 6134339.22803017,
 366752.527028152 6134568.10150752,
 373346.647541771 6137433.71166638,
 373718.872489144 6137668.49630618,
  375295.498589261 6138886.92620252,
 373718.872489144 6137668.49630618,
 373346.647541771 6137433.71166638,
 366826.150471738 6134600.68215773,
  366384.177071635 6134356.53424428,
 365851.118627503 6133776.04159448,
 364105.700770721 6130589.54564699,
 360283.950543384 6126559.51325796,
 356474.37159831 6124718.01769267,
  356917.601431696 6124368.97007825,
 360279.790154604 6126555.44586471,
  364105.700770721 6130589.54564699,
 365851.118627503 6133776.04159448,
 364105.700770721 6130589.54564699,
 360283.950543384 6126559.51325796,
 356027.21875 6124543
 )
 }}}

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:9>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 02:59:20 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 10:59:20 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.cd349fb90398635436007fab6f3d3985@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Attempts to buffer with original precision fail with this:
 {{{
 TopologyException: assigned depths do not match at 366818.60878326674
 6133401.6729513798
 }}}

 Then GEOS enters the precision reduction loop, starts with scaleFactor
 100000 and reduces scale factor by 10 on every iteration. Every iteration
 fails with a similar TopologyException.
 The last one before the crash is with scaleFactor=1:
 {{{
 TopologyException: assigned depths do not match at 364550 6129605
 }}}

 When trying scale factor = 0.1 we get the crash.

 I'm surprised that scale factor of 10 shows more than a single decimal
 digit in the topology exception:
 {{{
 TopologyException: assigned depths do not match at 364818.32000000001
 6129887.71
 }}}

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:3>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 01:52:19 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 09:52:19 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
Message-ID: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  blocker     |   Milestone:  3.3.7                     
Component:  Default     |     Version:  3.3.6                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 See http://lists.osgeo.org/pipermail/geos-devel/2012-December/006096.html

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 04:19:21 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 12:19:21 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.ee4772b54b755b2ec1b95f0c88e63683@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 #544 might help here

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:7>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 01:57:19 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 09:57:19 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.bf7bc0c2df224a587c9430fdc0c1576b@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------
Changes (by strk):

  * severity:  Unassigned => Critical


-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:1>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 04:22:10 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 12:22:10 -0000
Subject: [geos-devel] [GEOS] #544: Port JTS bugfix and testcases for
 MCIndexSnapRounder / GeometryNoder
In-Reply-To: <044.6061adbad1d82050cfe07c3617f61255@osgeo.org>
References: <044.6061adbad1d82050cfe07c3617f61255@osgeo.org>
Message-ID: <053.4d049324e93f105f5aded8d2476509ba@osgeo.org>

#544: Port JTS bugfix and testcases for MCIndexSnapRounder / GeometryNoder
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:  3.4.0                     
Component:  Default     |     Version:  3.3.3                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 Porting the fixes might help fixing bugs in Buffer operation also in 3.3
 branch, where MCIndexSnapRounder is NOT used but its use would fix at
 least #605

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/544#comment:3>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 03:20:18 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 11:20:18 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.6031c1cab88c85647ba2ad24906cf33f@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 JTS succeeds with the first reduction (scaleFactor 100000)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:4>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From gvaleika at gmail.com  Tue Dec  4 02:54:43 2012
From: gvaleika at gmail.com (=?UTF-8?Q?Gra=C5=BEvydas_Valeika?=)
Date: Tue, 4 Dec 2012 12:54:43 +0200
Subject: [geos-devel] Fwd: st_buffer crashes server
In-Reply-To: <20121204095415.GH2883@gnash>
References: <CAO6eJZojLLYQdyG+ffoWSjFYsEx8W5_HKDazzN1UDyHhcZJSgw@mail.gmail.com>
	<CAO6eJZqEoL7JBfkpza=A2F03Gotkd9RnrsdEstz7Pp4o6m0kHg@mail.gmail.com>
	<20121204095415.GH2883@gnash>
Message-ID: <CAO6eJZoYcgV5kZEZZO=GEYQL4WUxx25YVdWx08=wXzNci1kjeA@mail.gmail.com>

On Tue, Dec 4, 2012 at 11:54 AM, Sandro Santilli <strk at keybit.net> wrote:

> If you want to help further you could find a smaller version of
> that input still triggering the bug.
>

Hi,

my naively minimized sample which still crashes on my Fedora and Win
environments (didn't try on Scientific Linux):

select st_buffer(st_geomfromtext('LINESTRING(
380533.266481 6154956.03942,380804.601918464
6154718.75524037,375141.310137443 6138794.83236084,373718.872489144
6137668.49630618,
373346.647541771 6137433.71166638,366752.527028152
6134568.10150752,366261.351299655 6134260.49101737,364105.700770721
6130589.54564699,
360775.41757528 6127074.35479882,366360.991546586
6134339.22803017,366752.527028152 6134568.10150752,373346.647541771
6137433.71166638,
373718.872489144 6137668.49630618,375295.498589261
6138886.92620252,380360.32646877 6141721.21191597,380401.543492492
6154969.07054731,
380225.171669476 6155038.03451076,380241.317773985
6155032.03703938,380395.316987553 6155026.58763786,380358.007167029
6141736.36302396,
373718.872489144 6137668.49630618,373346.647541771
6137433.71166638,366826.150471738 6134600.68215773,365851.118627503
6133776.04159448,
364105.700770721 6130589.54564699,360283.950543384
6126559.51325796,366099.59095496 6134250.64732141,364105.700770721
6130589.54564699,
360283.950543384 6126559.51325796)'), 1000, 'endcap=round');
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/geos-devel/attachments/20121204/0b871ac2/attachment.html>

From geos-trac at osgeo.org  Tue Dec  4 03:30:36 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 11:30:36 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.457137eebd595ec53b823dc9ebeee98c@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 So there seems to still be some state hold that shouldn't be, in that
 running directly with FixedPrecision and scale 100000 succeeds in GEOS
 too.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:5>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From strk at keybit.net  Tue Dec  4 01:54:15 2012
From: strk at keybit.net (Sandro Santilli)
Date: Tue, 4 Dec 2012 10:54:15 +0100
Subject: [geos-devel] Fwd: st_buffer crashes server
In-Reply-To: <CAO6eJZqEoL7JBfkpza=A2F03Gotkd9RnrsdEstz7Pp4o6m0kHg@mail.gmail.com>
References: <CAO6eJZojLLYQdyG+ffoWSjFYsEx8W5_HKDazzN1UDyHhcZJSgw@mail.gmail.com>
	<CAO6eJZqEoL7JBfkpza=A2F03Gotkd9RnrsdEstz7Pp4o6m0kHg@mail.gmail.com>
Message-ID: <20121204095415.GH2883@gnash>

Hi Gra?vydas,
bug confirmed also with 3.3.7dev on x86_64 GNU/Linux
filed here: http://trac.osgeo.org/geos/ticket/605

Thanks for the report.
If you want to help further you could find a smaller version of
that input still triggering the bug.

--strk;


On Mon, Dec 03, 2012 at 08:49:28PM +0200, Gra?vydas Valeika wrote:

> today I had unpleasant situation - st_buffer crashed my server. After some
> log inspection I've find that st_buffer, or to be more precise, geos
> crashed server.

> select st_buffer(st_geomfromtext('LINESTRING(388198
> 6056788.3125001,388092.708841545 6056810.2110781,388088.920493843
> 6056967.93374297,388241.956691708 6057273.06946183,388481.94116096
> 6057599.24728253,
> 388450.615057762 6057788.60752023,388636.887768547
> 6058618.51458289,388575.098744835 6059249.3480535,388474.392698583
> 6059431.13197422,388252.570132005 6060588.91556507,
> 388138.573761171 6060963.23473355,388134.221733554
> 6061168.9551149,388299.160032874 6061394.41812456,388495.538867362
> 6061924.31858251,388332.370336841 6062138.11937723,
> 388119.211582829 6062230.26685346,388110.25175897
> 6062522.42617419,388165.506860547 6062748.51579152,388123.828222584
> 6062846.8479905,388133.803362367 6063141.16660669,
> 388064.564019166 6063243.27635235,387716.728231868
> 6063389.12380394,387453.115341178 6063849.8464528,387188.899722711
> 6064434.77944927,386726.051764386 6065921.01741559,
> 386527.803954052 6066405.26080532,386167.716575243
> 6067005.70139789,385585.129661588 6067750.82724575,384377.479486561
> 6069706.42224637,381303.184154561 6075430.53477082,
> 380938.825063071 6075953.44262464,379576.166973678
> 6077621.16952598,378617.680329676 6079335.72562118,377692.247058369
> 6080354.61070676,377304.98997202 6080868.84136614,
> 376119.146366383 6083160.6663075,375533.996242582
> 6084119.42036258,374831.2997138 6085068.06506297,374239.343010324
> 6085700.28783992,373667.330967215 6086156.23924685,
> 372431.267944668 6086964.31974138,371658.572051644
> 6087723.20126027,371184.358950609 6088414.63985996,369295.313145564
> 6091948.39630187,368510.010900525 6093900.30288199,
> 367699.079184587 6095641.17579127,366839.965846187
> 6097765.46196932,365887.033263914 6100299.38724338,365704.388073836
> 6100959.46445081,365381.540134711 6102674.28775494,
> 364698.31205062 6105321.58891112,364420.13298109
> 6105954.50724961,363567.334008088 6107222.47989483,363378.045274123
> 6107623.83942034,361272.146778924 6114111.545846,
> 360696.478924724 6116653.94545047,360625.946490487
> 6117579.6210964,361085.424946998 6120296.02187525,361129.554866774
> 6121826.37696278,361221.00136377 6122302.61003117,
> 361356.311073206 6122507.64959402,359931.783565909
> 6123603.77468629,359335.92095244 6123981.14671129,359095.301851194
> 6123744.88716597,358685.742038043 6123598.20791129,
> 358729 6123404,358729 6123404,358622.693709635
> 6123764.44708204,357239.91098603 6123124.35800193,357181.5 6123153,357181.5
> 6123153,357232.159652672 6123120.44225534,
> 358379.138263059 6123653.23254885,358045.151179082
> 6124395.52177733,358261.928444251 6124569.618564,358077.865280239
> 6124838.18210352,358281.044343582 6124982.05367936,
> 358432.766000182 6125165.71179119,358375.669443869
> 6125262.28106258,359789.175958758 6126217.21693403,359809.655435652
> 6126184.44927005,359739.362906316 6126110.63846627,
> 359825 6125976,359825 6125976,359739.362906316
> 6126110.63846627,359798.23045867 6126148.42609188,359789.175958758
> 6126217.21693403,360323.491342721 6126598.10301608,
> 364105.700770721 6130589.54564699,365851.118627503
> 6133776.04159448,366074.924340233 6134077.5652318,366321.276893722
> 6134309.5818053,366752.527028152 6134568.10150752,
> 373346.647541771 6137433.71166638,373718.872489144
> 6137668.49630618,375295.498589261 6138886.92620252,380360.32646877
> 6141721.21191597,380111.862144265 6142591.67766098,
> 380188.965151436 6142863.32687809,380412.556804893
> 6143070.19850033,380326.51146761 6143486.2191135,380519.86965456
> 6143672.04731848,380524.672688485 6143745.65405921,
> 380333.210322103 6144277.10325332,380366.537370783
> 6144825.73061995,380268.927547754 6145283.97143005,380101.057446265
> 6145452.75372955,380072.61124807 6145554.36976643,
> 379910.941600418 6147258.40194766,379895.687981905
> 6147888.36419869,379645.66003822 6148831.99607563,379584.096108666
> 6149348.80443556,379757.037432146 6150109.02363008,
> 379782.695357509 6151294.47303588,379940.061949347
> 6151544.25492761,379892.065462456 6152163.0470847,379852.912014202
> 6152193.70518401,379881.507158488 6152775.52694882,
> 379735.825345059 6153190.50246425,379798.964041976
> 6153600.96172558,379604.84141527 6153880.28255335,380274.62842471
> 6154663.22487804,380296.916351767 6154764.4053277,
> 380407.96506929 6154758.60352038,380404.973832117
> 6154930.39286119,380533.266481 6154956.03942,380533.266481
> 6154956.03942,380697.469609411 6154933.37328515,
> 380804.601918464 6154718.75524037,380003.000283501
> 6154234.91781766,379947.596702516 6154268.33657074,379604.84141527
> 6153880.28255335,379801.104099702 6153581.04862935,
> 379734.034176517 6153214.61521516,379879.325267865
> 6152797.41205984,379852.912014202 6152193.70518401,379940.061949347
> 6151544.25492761,379782.695357509 6151294.47303588,
> 379757.037432146 6150109.02363008,379584.096108666
> 6149348.80443556,379645.66003822 6148831.99607563,379895.687981905
> 6147888.36419869,379910.941600418 6147258.40194766,
> 380078.689290296 6145509.57402919,380268.927547754
> 6145283.97143005,380293.424476874 6145037.39476578,380366.235644963
> 6144852.36309869,380330.160194237 6144288.82245702,
> 380532.368921331 6143696.47274357,380330.569412652
> 6143508.9916221,380418.378928402 6143089.13720483,380201.908916375
> 6142890.21141506,380113.567105044 6142613.12216422,
> 380358.007167029 6141736.36302396,375141.310137443
> 6138794.83236084,373718.872489144 6137668.49630618,373346.647541771
> 6137433.71166638,366752.527028152 6134568.10150752,
> 366261.351299655 6134260.49101737,365851.118627503
> 6133776.04159448,364105.700770721 6130589.54564699,360775.41757528
> 6127074.35479882,360953.797311602 6126892.71824755,
> 361415.446406647 6124129.77434326,361418.461836166
> 6123309.50723627,361223.676981864 6122424.10716164,361158.196642996
> 6122397.73568352,361113.476183368 6122455.98975904,
> 361231.736678766 6122617.56913771,359931.783565909
> 6123603.77468629,359335.92095244 6123981.14671129,359095.301851194
> 6123744.88716597,358685.742038043 6123598.20791129,
> 358741.0625 6123522,358741.0625 6123522,357971.36255807
> 6125108.43269709,357920.008042721 6125077.68096362,357679.808786759
> 6125460.74022553,357213.718482872 6125510.63249069,
> 357060 6125868,357060 6125868,357003.056253166
> 6125944.75887484,356749.73178741 6125801.21952087,356576.400427944
> 6125577.20775089,356509.666450818 6125295.74512354,
> 356454 6125304,356454 6125304,356509.666450818
> 6125295.74512354,356485.06516117 6124575.24473136,356746.540496635
> 6124608.57147991,356808 6124501,356808 6124501,
> 356841.04623812 6124345.94903632,356917.601431696
> 6124368.97007825,357540.531428107 6124708.38003617,357962.38036606
> 6125101.9157808,358337.402089666 6124407.55301858,
> 358652.565855199 6124352.24990397,359082.983074971
> 6124156.03807671,359519.418855862 6123853.86577455,359507 6123806,359507
> 6123806,359519.418855862 6123853.86577455,
> 358927.509705773 6124235.82599912,358668.99357866
> 6124346.01258094,358346.979589857 6124383.702781,357971.36255807
> 6125108.43269709,357540.531428107 6124708.38003617,
> 356545.762875273 6124169.95952009,356642.213182996
> 6123954.08053072,356541.426332461 6123823.05777582,356444 6123955,356444
> 6123955,356528.633898072 6123802.58917791,
> 356635.327210811 6123941.87391433,356536.358713067
> 6124164.88456013,357540.531428107 6124708.38003617,357898.367966032
> 6125061.33495277,358375.669443869 6125262.28106258,
> 359864.195548135 6126265.27116361,360279.790154604
> 6126555.44586471,360762.970983925 6127054.06482593,364105.700770721
> 6130589.54564699,365851.118627503 6133776.04159448,
> 366074.924340233 6134077.5652318,366360.991546586
> 6134339.22803017,366752.527028152 6134568.10150752,373346.647541771
> 6137433.71166638,373718.872489144 6137668.49630618,
> 375295.498589261 6138886.92620252,380360.32646877
> 6141721.21191597,380111.862144265 6142591.67766098,380188.965151436
> 6142863.32687809,380412.556804893 6143070.19850033,
> 380326.51146761 6143486.2191135,380519.86965456
> 6143672.04731848,380524.672688485 6143745.65405921,380333.210322103
> 6144277.10325332,380366.537370783 6144825.73061995,
> 380268.927547754 6145283.97143005,380101.057446265
> 6145452.75372955,380072.61124807 6145554.36976643,379910.941600418
> 6147258.40194766,379895.687981905 6147888.36419869,
> 379645.66003822 6148831.99607563,379584.096108666
> 6149348.80443556,379757.037432146 6150109.02363008,379782.695357509
> 6151294.47303588,379940.061949347 6151544.25492761,
> 379892.065462456 6152163.0470847,379852.912014202
> 6152193.70518401,379881.507158488 6152775.52694882,379735.825345059
> 6153190.50246425,379798.964041976 6153600.96172558,
> 379604.84141527 6153880.28255335,380274.62842471
> 6154663.22487804,380270.707586966 6154922.27465547,380401.543492492
> 6154969.07054731,380395.790832264 6155021.2631309,
> 380225.171669476 6155038.03451076,380009.961292789
> 6155174.55789084,380214.541517594 6155508.21736627,380471.273097537
> 6155787.73721704,380779.514035757 6156457.27872544,
> 380664.720504259 6156522.49306375,380565.632008301
> 6156470.80623459,380565.632008301 6156470.80623459,380659.885725872
> 6156528.60438952,380770.908059047 6156461.95579602,
> 380471.273097537 6155787.73721704,380224.131766873
> 6155521.71880139,380009.961292789 6155174.55789084,380241.317773985
> 6155032.03703938,380395.316987553 6155026.58763786,
> 380399.760813982 6154978.75127648,380278.928144154
> 6154937.86254539,380274.62842471 6154663.22487804,379604.84141527
> 6153880.28255335,379801.104099702 6153581.04862935,
> 379734.034176517 6153214.61521516,379879.325267865
> 6152797.41205984,379852.912014202 6152193.70518401,379940.061949347
> 6151544.25492761,379782.695357509 6151294.47303588,
> 379757.037432146 6150109.02363008,379584.096108666
> 6149348.80443556,379645.66003822 6148831.99607563,379895.687981905
> 6147888.36419869,379910.941600418 6147258.40194766,
> 380078.689290296 6145509.57402919,380268.927547754
> 6145283.97143005,380293.424476874 6145037.39476578,380366.235644963
> 6144852.36309869,380330.160194237 6144288.82245702,
> 380532.368921331 6143696.47274357,380330.569412652
> 6143508.9916221,380418.378928402 6143089.13720483,380201.908916375
> 6142890.21141506,380113.567105044 6142613.12216422,
> 380358.007167029 6141736.36302396,375141.310137443
> 6138794.83236084,373718.872489144 6137668.49630618,373346.647541771
> 6137433.71166638,366826.150471738 6134600.68215773,
> 366384.177071635 6134356.53424428,366074.924340233
> 6134077.5652318,365851.118627503 6133776.04159448,364105.700770721
> 6130589.54564699,360283.950543384 6126559.51325796,
> 358310.754368459 6125224.10678874,357976.08601118
> 6125117.84819477,357566.504359631 6124728.78392167,356485.06516117
> 6124575.24473136,356474.37159831 6124718.01769267,
> 356394 6124712,356394 6124712,356474.37159831
> 6124718.01769267,356485.06516117 6124575.24473136,356746.540496635
> 6124608.57147991,356841.04623812 6124345.94903632,
> 356917.601431696 6124368.97007825,357540.531428107
> 6124708.38003617,357898.367966032 6125061.33495277,358375.669443869
> 6125262.28106258,360279.790154604 6126555.44586471,
> 364105.700770721 6130589.54564699,365851.118627503
> 6133776.04159448,366220.074543707 6134224.37808788,366136.936463203
> 6134224.04608468,366110.33046146 6134300.85927697,
> 366140.96755391 6135400.4088888,366262.088579507
> 6135953.44233793,366243.224373423 6136539.96317083,366869.109960216
> 6139049.28144522,366861.962049922 6139393.21523448,
> 366783.963283364 6139810.26288602,366810.021621773
> 6140097.76752051,366909.839012986 6140346.59460061,367483.155296243
> 6141289.28680997,368491.366973702 6144297.76560617,
> 368624.352440217 6144834.69168676,368815.544245043
> 6145099.54822602,369230.077151043 6145239.2445828,370681.28754639
> 6146615.8063275,371346.506937068 6147048.89562104,
> 372670.642536898 6148303.46738851,375735.574462588
> 6153280.35465536,376025.682515648 6153968.41706293,376181.477195906
> 6154040.98847407,377590.660285194 6154019.98732847,
> 378068.953140288 6154094.72967084,378572.849829578
> 6154240.81730227,379168.5625 6154562.5,379168.5625
> 6154562.5,378596.752745659 6154250.4673199,
> 378077.605910676 6154096.88336475,377590.660285194
> 6154019.98732847,376181.477195906 6154040.98847407,376025.682515648
> 6153968.41706293,375735.574462588 6153280.35465536,
> 372670.642536898 6148303.46738851,371346.506937068
> 6147048.89562104,370681.28754639 6146615.8063275,369230.077151043
> 6145239.2445828,368798.447992323 6145087.03940357,
> 368624.352440217 6144834.69168676,368491.366973702
> 6144297.76560617,367483.155296243 6141289.28680997,366909.839012986
> 6140346.59460061,366810.021621773 6140097.76752051,
> 366783.963283364 6139810.26288602,366861.962049922
> 6139393.21523448,366869.109960216 6139049.28144522,366252.868206412
> 6136622.02568867,366262.088579507 6135953.44233793,
> 366144.737792622 6135428.89321238,366099.59095496
> 6134250.64732141,364105.700770721 6130589.54564699,360283.950543384
> 6126559.51325796,358310.754368459 6125224.10678874,
> 357976.08601118 6125117.84819477,357566.504359631
> 6124728.78392167,356027.21875 6124543)'), 1000, 'endcap=round');

From strk at keybit.net  Tue Dec  4 07:14:34 2012
From: strk at keybit.net (Sandro Santilli)
Date: Tue, 4 Dec 2012 16:14:34 +0100
Subject: [geos-devel] Fwd: st_buffer crashes server
In-Reply-To: <CAO6eJZoYcgV5kZEZZO=GEYQL4WUxx25YVdWx08=wXzNci1kjeA@mail.gmail.com>
References: <CAO6eJZojLLYQdyG+ffoWSjFYsEx8W5_HKDazzN1UDyHhcZJSgw@mail.gmail.com>
	<CAO6eJZqEoL7JBfkpza=A2F03Gotkd9RnrsdEstz7Pp4o6m0kHg@mail.gmail.com>
	<20121204095415.GH2883@gnash>
	<CAO6eJZoYcgV5kZEZZO=GEYQL4WUxx25YVdWx08=wXzNci1kjeA@mail.gmail.com>
Message-ID: <20121204151434.GN2883@gnash>

On Tue, Dec 04, 2012 at 12:54:43PM +0200, Gra?vydas Valeika wrote:
> On Tue, Dec 4, 2012 at 11:54 AM, Sandro Santilli <strk at keybit.net> wrote:
> 
> > If you want to help further you could find a smaller version of
> > that input still triggering the bug.
> 
> my naively minimized sample which still crashes on my Fedora and Win
> environments (didn't try on Scientific Linux):

Thanks. I've a 26 vertices reduction on trac.
That's the best place to continue this:
http://trac.osgeo.org/geos/ticket/605

I think the problem is a robustness issue in PlanarGraph building.
Fixing it won't be easy, but I guess we could just throw a TopologyException
thus allowing higher levels to try some heuristic to fix that.

Unfortunately the heuristic used results in an extreme loss of precision,
finally giving a buffer which is very unlikely to be what you're looking for.
More info on the tracker.

I'm currently trying to setup a testcase for PlanarGraph building.
It strikes me that there's no unit testing for that even in JTS...

--strk;




From geos-trac at osgeo.org  Tue Dec  4 07:32:43 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 15:32:43 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.8ce6831eb0e63b7be1567564d79a5837@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Another hint: the problem in turn seems to originate in non-noded input
 being feeded to PlanarGraph. Pre-noding the input also seems to fix the
 case (in PostGIS: ST_Buffer(ST_Node(...), 1000))

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:12>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 08:16:53 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 16:16:53 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.3a562f89ee14bbf5431cef82da483e0e@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Alright so I think it is a perfectly legit case of a dangling edge in the
 topology.
 If the node of degree 1 (the unconnected end) of the dangling edge is the
 _end_ vertex of the edge, eventually the BufferSubgraph create function
 will start from there and produce a subgraph of that edge _only_, and that
 edge will be backward. And in turn that'll take us to the exception.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:13>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 08:28:36 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 16:28:36 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.fb6331f424579c3ad5b5b6c122c7716d@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Forget the above comment, theoretically the dangling edges would be part
 of the same SubGraph as the other.

 Adding more logging I do see weird things in the built planargraph, like
 this snippet:
 {{{
  Adding node 366650 6133180
   backward edge (366700 6133200, 366650 6133180)
   backward edge (366700 6133300, 366650 6133180)
   forward edge (366650 6133180, 366520 6133030, 366360 6132920, 366190
 6132830, 366000 6132790, 365800 6132780, 365610 6132810, 365420 6132870,
 365260 6132970, 365110 6133100, 364990 6133260, 364910 6133440, 364860
 6133630, 364900 6133800)
 ...
 }}}

 Sounds like there are 2 identical backward edges attached to that node ...

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:14>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 08:35:20 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 16:35:20 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.be6a53bbd69d9dc07f4ac31a7f325b97@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 Instrumented the Subgraph generation with more checks and I found a case
 of duplicated edge:
 {{{
  Adding node 361600 6126500
   backward edge (364830 6129900, 361600 6126500)
   backward edge (366100 6132100, 361600 6126500)
   backward edge (366650 6133180, 366650 6133170, 361600 6126500)
   backward edge (361600 6126500, 361620 6126560, 361630 6126550, 361620
 6126530, 361600 6126500)
  sym node 361600 6126500 visited
   forward edge (361600 6126500, 361620 6126560, 361630 6126550, 361620
 6126530, 361600 6126500)
   EQUALS previous edge!
 }}}

 It should never happen, right ?

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:15>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 09:05:55 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 17:05:55 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.e929aa490b99912048ecba933a9e2c09@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 The EQUAL case was indeed fine, as that's a closed edge starting and
 ending on the same node.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:16>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 10:33:23 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 18:33:23 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.efae82361a48c68c3c10c06ad7086a39@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 What I'm trying to understand is how it is possible to obtain only
 backward edges by walking all reachable _directed_ edges starting from any
 node, as this is what's happening here.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:17>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 11:07:39 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 19:07:39 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.b12d01b6e0108444f8ad3385dbb1ea20@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 About the grossbuffer.png image I posted above: that images shows a buffer
 performed on a precision grid of 10000 units per side, that why it looks
 so weird. It would be enough to limit the precisionModel to a fraction of
 max extent to avoid that broken result (better an exception there...)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:18>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 11:31:38 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 19:31:38 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.49b04c1a11daf7dd67cea51e97dc97b7@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 r3727 in trunk implements throwing a TopologyException rather than
 aborting.
 Has to be backported to 3.3 branch but first I wanted to further limit the
 precision reduction to avoid gross results

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:19>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 13:28:14 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 21:28:14 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.4f439eacffda9f7bfa2768169b56c8ac@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |       Owner:  geos-devel@?              
     Type:  defect    |      Status:  new                       
 Priority:  blocker   |   Milestone:  3.3.7                     
Component:  Default   |     Version:  3.3.6                     
 Severity:  Critical  |    Keywords:                            
----------------------+-----------------------------------------------------

Comment(by strk):

 r3728 takes a step forward by reducing the input coordinates (snapping
 them to the reduced precision grid). Good results !
 http://strk.keybit.net/tmp/goodbuffer.png

 Unfortunately the GeometryPrecisionReducer class isn't in the 3.3 branch
 so the fix can't backport there that easily.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:20>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 13:47:53 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 21:47:53 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.630103376a2dcd03d2e28ea7f69335b4@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |        Owner:  geos-devel@?              
     Type:  defect    |       Status:  closed                    
 Priority:  blocker   |    Milestone:  3.3.7                     
Component:  Default   |      Version:  3.3.6                     
 Severity:  Critical  |   Resolution:  fixed                     
 Keywords:            |  
----------------------+-----------------------------------------------------
Changes (by strk):

  * status:  new => closed
  * resolution:  => fixed


Comment:

 r3730 ports the TopologyException to 3.3 branch, fixing the abort (but not
 the buffer result).

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:21>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Tue Dec  4 13:51:44 2012
From: geos-trac at osgeo.org (GEOS)
Date: Tue, 04 Dec 2012 21:51:44 -0000
Subject: [geos-devel] [GEOS] #605: Crash from GEOSBuffer:
 RightmostEdgeFinder.cpp: Assertion `checked>0` failed
In-Reply-To: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
References: <044.8a8afee8a4e4b6d09807dcaebfba5e09@osgeo.org>
Message-ID: <053.2fa38fcd7ff12c8c4478ac339980b126@osgeo.org>

#605: Crash from GEOSBuffer: RightmostEdgeFinder.cpp: Assertion `checked>0`
failed
----------------------+-----------------------------------------------------
 Reporter:  strk      |        Owner:  geos-devel@?              
     Type:  defect    |       Status:  closed                    
 Priority:  blocker   |    Milestone:  3.3.7                     
Component:  Default   |      Version:  3.3.6                     
 Severity:  Critical  |   Resolution:  fixed                     
 Keywords:            |  
----------------------+-----------------------------------------------------
Changes (by strk):

 * cc: history (added)


-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/605#comment:22>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Wed Dec  5 00:57:09 2012
From: geos-trac at osgeo.org (GEOS)
Date: Wed, 05 Dec 2012 08:57:09 -0000
Subject: [geos-devel] [GEOS] #591: Port robust determinant fixes from JTS
In-Reply-To: <044.1cc558a7a3be4128383f28dc221e6277@osgeo.org>
References: <044.1cc558a7a3be4128383f28dc221e6277@osgeo.org>
Message-ID: <053.e52b21bdb72110e0e81e6b98ef5b0c33@osgeo.org>

#591: Port robust determinant fixes from JTS
------------------------+---------------------------------------------------
 Reporter:  strk        |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  major       |   Milestone:  3.3.7                     
Component:  Default     |     Version:  3.3.5                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------

Comment(by strk):

 may fix #602 (to be checked)

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/591#comment:2>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

From geos-trac at osgeo.org  Mon Dec 24 15:22:38 2012
From: geos-trac at osgeo.org (GEOS)
Date: Mon, 24 Dec 2012 23:22:38 -0000
Subject: [geos-devel] [GEOS] #608: IsValidOp should return eNestedShells not
 eNestedHoles at ln 530
Message-ID: <048.436b168fef6f118a24fa4701d7a2fc75@osgeo.org>

#608: IsValidOp should return eNestedShells not eNestedHoles at ln 530
------------------------+---------------------------------------------------
 Reporter:  geomworx    |       Owner:  geos-devel@?              
     Type:  defect      |      Status:  new                       
 Priority:  minor       |   Milestone:  3.3.7                     
Component:  Default     |     Version:  3.3.6                     
 Severity:  Unassigned  |    Keywords:                            
------------------------+---------------------------------------------------
 Stepping through code, I believe that inside
 3rd_geos\IsValidOp.cpp::checkShellNotNested(), on line 530, the keyword:

   eNestedHoles

 should be replaced by:

   eNestedShells

 Since the error detected here is shells being nested, not holes being
 nested.

-- 
Ticket URL: <http://trac.osgeo.org/geos/ticket/608>
GEOS <http://geos.refractions.net/>
GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology Suite (JTS).

