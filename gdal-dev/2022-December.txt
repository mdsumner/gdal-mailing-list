From pschmitt at gmail.com  Thu Dec  1 16:00:23 2022
From: pschmitt at gmail.com (Peter Schmitt)
Date: Thu, 1 Dec 2022 17:00:23 -0700
Subject: [gdal-dev] Relationship between GTiff multi-threaded read and
 vsicurl multirange requests
Message-ID: <CACkcqcXBGYpaBdrZqF0q7v79Vb4JR=W5V+S3+rQOPfSBHKBi-A@mail.gmail.com>

Hi,

I am experimenting with curl range requests on servers supporting HTTP/1.1
and the new GTiff multi-threaded read released in gdal-3.6.0 from
https://github.com/OSGeo/gdal/pull/6438.

First, here's a command that uses single-threaded reads with HTTP/1.1. Note
the default value
https://trac.osgeo.org/gdal/wiki/ConfigOptions#GDAL_HTTP_MULTIRANGE =YES.
For HTTP/1.1,  I expect each range will be requested in parallel, using
several HTTP connections.

env GDAL_NUM_THREADS=1 CPL_CURL_VERBOSE=1 GDAL_HTTP_VERSION=1.1
GDAL_DISABLE_READDIR_ON_OPEN=YES CPL_VSIL_CURL_ALLOWED_EXTENSIONS=tif
gdal_translate /vsicurl/
https://github.com/OSGeo/gdal/raw/master/autotest/gdrivers/data/small_world.tif
small_world_jpeg.tif -co tiled=yes -co compress=jpeg -co photometric=ycbcr
2>&1 | grep "Content-Range"
< Content-Range: bytes 0-16383/240574
< Content-Range: bytes 229376-240573/240574
< Content-Range: bytes 16384-81919/240574
< Content-Range: bytes 81920-212991/240574
< Content-Range: bytes 212992-229375/240574


I try the same thing using 2 threads. It is quite a bit slower and there
are much more range requests than I would anticipate:

time env GDAL_NUM_THREADS=2 CPL_CURL_VERBOSE=1 GDAL_HTTP_VERSION=1.1
GDAL_DISABLE_READDIR_ON_OPEN=YES CPL_VSIL_CURL_ALLOWED_EXTENSIONS=tif
gdal_translate /vsicurl/
https://github.com/OSGeo/gdal/raw/master/autotest/gdrivers/data/small_world.tif
small_world_jpeg_multi.tif -co tiled=yes -co compress=jpeg -co
photometric=ycbcr 2>&1 | grep "Content-Range"
< Content-Range: bytes 0-16383/240574
< Content-Range: bytes 229376-240573/240574
< Content-Range: bytes 232008-240007/240574
< Content-Range: bytes 88008-96007/240574
< Content-Range: bytes 152008-160007/240574
< Content-Range: bytes 72008-80007/240574
< Content-Range: bytes 224008-232007/240574
< Content-Range: bytes 144008-152007/240574
< Content-Range: bytes 64008-72007/240574
< Content-Range: bytes 216008-224007/240574
< Content-Range: bytes 136008-144007/240574
< Content-Range: bytes 56008-64007/240574
< Content-Range: bytes 208008-216007/240574
< Content-Range: bytes 128008-136007/240574
< Content-Range: bytes 48008-56007/240574
< Content-Range: bytes 200008-208007/240574
< Content-Range: bytes 120008-128007/240574
< Content-Range: bytes 40008-48007/240574
< Content-Range: bytes 192008-200007/240574
< Content-Range: bytes 112008-120007/240574
< Content-Range: bytes 32008-40007/240574
< Content-Range: bytes 184008-192007/240574
< Content-Range: bytes 104008-112007/240574
< Content-Range: bytes 24008-32007/240574
< Content-Range: bytes 176008-184007/240574
< Content-Range: bytes 96008-104007/240574
< Content-Range: bytes 16008-24007/240574
< Content-Range: bytes 168008-176007/240574
< Content-Range: bytes 8008-16007/240574
< Content-Range: bytes 160008-168007/240574
< Content-Range: bytes 80008-88007/240574
< Content-Range: bytes 8-8007/240574


I am confused by the large number of curl range requests when using the new
multithreaded reading.  Some questions:

- with GDAL_NUM_THREADS_1 and GDAL_HTTP_MULTIRANGE=YES, "each range will be
requested in parallel, using several HTTP connections"... are those
requests multithreaded?
- Is it a bad idea to use multithreaded reads and GDAL_HTTP_MULTIRANGE=YES
when data is accessed with /vsicurl/ served by HTTP/1.1?  I am guessing the
GTiff multithreaded reads are splitting up contiguous byte ranges to be
noncontiguous, which may yield worse performance on some virtual
filesystems.

Thanks,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221201/5a25e877/attachment.htm>

From even.rouault at spatialys.com  Thu Dec  1 16:13:17 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 2 Dec 2022 01:13:17 +0100
Subject: [gdal-dev] Relationship between GTiff multi-threaded read and
 vsicurl multirange requests
In-Reply-To: <CACkcqcXBGYpaBdrZqF0q7v79Vb4JR=W5V+S3+rQOPfSBHKBi-A@mail.gmail.com>
References: <CACkcqcXBGYpaBdrZqF0q7v79Vb4JR=W5V+S3+rQOPfSBHKBi-A@mail.gmail.com>
Message-ID: <3cec6a9e-37ba-b421-2f12-a2cd7bb8d0c1@spatialys.com>

Hi Pete,

Those are good questions

> I am confused by the large number of curl range requests when using 
> the new multithreaded reading.? Some questions:
>
> - with GDAL_NUM_THREADS_1 and GDAL_HTTP_MULTIRANGE=YES, "each range 
> will be requested in parallel, using several HTTP connections"... are 
> those requests multithreaded?
Not multi-threaded, but using Curl multi handle interface 
(https://curl.se/libcurl/c/libcurl-multi.html), which enables to start 
several connections in parallel within the same user-space thread (not 
sure what the kernel/OS does behinds the scenes) and listen to the 
corresponding file descriptors/network handles to collect responses as 
soon as they arive. Thus, the GeoTIFF driver waits for all those queued 
requests to have returned their result to continue its processing.
> - Is it a bad idea to use multithreaded reads and 
> GDAL_HTTP_MULTIRANGE=YES when data is accessed with /vsicurl/ served 
> by HTTP/1.1?? I am guessing the GTiff multithreaded reads are 
> splitting up contiguous byte ranges to be noncontiguous, which may 
> yield worse performance on some virtual filesystems.

What you've experienced with multithreaded reads and HTTP reads falls 
into the suggestion of https://github.com/OSGeo/gdal/issues/6456. So 
basically the multi-threaded optimization works best for now to read 
local files. The choice of reading small_world.tif over network is a bit 
a worst case here as it is definitely not a cloud optimized files, 
having a strip organization, and each strip being only 8 KB large. So 
the absence of range merging currently in the multithreaded GTiff 
decoding code path particularly hurts for that use case. For normally 
tiled files, it shouldn't be that bad.

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.


From elpaso at itopen.it  Fri Dec  2 02:57:12 2022
From: elpaso at itopen.it (ElPaso)
Date: Fri, 2 Dec 2022 11:57:12 +0100
Subject: [gdal-dev] RFC89: sql logging callback
Message-ID: <acf6768b-4533-f983-34e4-4dec270ec940@itopen.it>

Hi,

I've been working on a SQL query callback for GDALDataset [1], I wasn't 
sure if that deserves an RFC, but since I've prepared one [2] I'd like 
to read your comments.


Please note that I've also tested the implementation in QGIS logging 
panel and it works just fine, we can now see which SQL is generated from 
the OGR/GDAL data providers.


[1] 
https://github.com/elpaso/gdal/tree/rfc89_sql_logging_callback_implementation

[2]? https://github.com/OSGeo/gdal/pull/6837


-- 
Alessandro Pasotti
w3: www.itopen.it


From phlebas at cantab.net  Fri Dec  2 04:35:28 2022
From: phlebas at cantab.net (Rob Stevens)
Date: Fri, 2 Dec 2022 07:35:28 -0500
Subject: [gdal-dev] Build of gdal fails on missing OSGeo.GDAL.Core
Message-ID: <18dd49bf-05c4-96d5-ea6e-71b161c10169@cantab.net>

I am very new to building out GIS tools on the MacOS platform,
so I apologize for my rather turgid description below.

I am trying to build gdal 3.6.0 (git cloned)
on macos catalina 10.15.7 on a macbook pro 2017
On this machine I have various versions of Msoft dotnet core sdks installed
(7.0.100, 6.0.403, 6.0.401, 2.1.500)
All goes well until the build gets 88% done.
Then I see:

======= Building .NET project OSGeo.OSR [Release ]
 ? Determining projects to restore...
/usr/local/share/dotnet/sdk/7.0.100/Sdks/Microsoft.NET.Sdk/targets/Microsoft.NET.EolTargetFrameworks.targets(28,5): 
warning NETSDK1138: The target framework 'net5.0' is out of support and 
will not receive security updates in the future. Please refer to 
https://aka.ms/dotnet-core-support for more information about the 
support policy. 
[/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj]
 ? Writing /var/folders/15/nt94jgd930z_z6zr5gc081y00000gr/T/tmpUJ1Fvw.tmp
info : X.509 certificate chain validation will use the fallback 
certificate bundle at 
'/usr/local/share/dotnet/sdk/7.0.100/trustedroots/codesignctl.pem'.
info : X.509 certificate chain validation will use the fallback 
certificate bundle at 
'/usr/local/share/dotnet/sdk/7.0.100/trustedroots/timestampctl.pem'.
info : Restoring packages for 
/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj...
info :?? GET 
https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json
info :?? NotFound 
https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json 1316ms
error: NU1101: Unable to find package OSGeo.GDAL.Core. No packages exist 
with this id in source(s): nuget.org
error: Package 'OSGeo.GDAL.Core' is incompatible with 'all' frameworks 
in project 
'/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj'

It is not my intent to build any dotnet components/interfaces
but the cmake build seems to want to do this just by virtue
of my having dotnet SDKs installed. The cmake build files
are very difficult to understand, and I have not yet been
able to figure out how to prevent these unneeded
components being built.

1. How do I prevent these dotnet components being built?
2. It seems as though I am trying to build against all versions of the 
dotnet
 ??? SDK installed, but some of those versions do not have nuget packages
 ??? for OSGeo.GDal.Core.
 ??? Regardless of my needs, is this not a larger problem in the build?

Thanks for any help.

Rob Stevens

From runette at gmail.com  Fri Dec  2 04:53:13 2022
From: runette at gmail.com (Paul Harwood)
Date: Fri, 2 Dec 2022 12:53:13 +0000
Subject: [gdal-dev] Build of gdal fails on missing OSGeo.GDAL.Core
In-Reply-To: <18dd49bf-05c4-96d5-ea6e-71b161c10169@cantab.net>
References: <18dd49bf-05c4-96d5-ea6e-71b161c10169@cantab.net>
Message-ID: <CAE8nN5MG4BVBOmm9kDfgc+_zqtyCk=79X8OuUz6ksw9A0RzFUA@mail.gmail.com>

I can have a think about what is causing the problem - but the simplest fix
if you don't want the c# bindings is to build with
-DBUILD_CSHARP_BINDINGS:BOOLOFF

More on the compile switches here
https://gdal.org/development/building_from_source.html#cmdoption-arg-BUILD_CSHARP_BINDINGS-BOOL

On Fri, 2 Dec 2022 at 12:45, Rob Stevens <phlebas at cantab.net> wrote:

> I am very new to building out GIS tools on the MacOS platform,
> so I apologize for my rather turgid description below.
>
> I am trying to build gdal 3.6.0 (git cloned)
> on macos catalina 10.15.7 on a macbook pro 2017
> On this machine I have various versions of Msoft dotnet core sdks installed
> (7.0.100, 6.0.403, 6.0.401, 2.1.500)
> All goes well until the build gets 88% done.
> Then I see:
>
> ======= Building .NET project OSGeo.OSR [Release ]
>    Determining projects to restore...
> /usr/local/share/dotnet/sdk/7.0.100/Sdks/Microsoft.NET.Sdk/targets/Microsoft.NET.EolTargetFrameworks.targets(28,5):
>
> warning NETSDK1138: The target framework 'net5.0' is out of support and
> will not receive security updates in the future. Please refer to
> https://aka.ms/dotnet-core-support for more information about the
> support policy.
> [/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj]
>    Writing /var/folders/15/nt94jgd930z_z6zr5gc081y00000gr/T/tmpUJ1Fvw.tmp
> info : X.509 certificate chain validation will use the fallback
> certificate bundle at
> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/codesignctl.pem'.
> info : X.509 certificate chain validation will use the fallback
> certificate bundle at
> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/timestampctl.pem'.
> info : Restoring packages for
>
> /Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj...
> info :   GET
> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json
> info :   NotFound
> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json 1316ms
> error: NU1101: Unable to find package OSGeo.GDAL.Core. No packages exist
> with this id in source(s): nuget.org
> error: Package 'OSGeo.GDAL.Core' is incompatible with 'all' frameworks
> in project
> '/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj'
>
> It is not my intent to build any dotnet components/interfaces
> but the cmake build seems to want to do this just by virtue
> of my having dotnet SDKs installed. The cmake build files
> are very difficult to understand, and I have not yet been
> able to figure out how to prevent these unneeded
> components being built.
>
> 1. How do I prevent these dotnet components being built?
> 2. It seems as though I am trying to build against all versions of the
> dotnet
>      SDK installed, but some of those versions do not have nuget packages
>      for OSGeo.GDal.Core.
>      Regardless of my needs, is this not a larger problem in the build?
>
> Thanks for any help.
>
> Rob Stevens
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221202/1f6c8cb4/attachment-0001.htm>

From runette at gmail.com  Fri Dec  2 04:58:11 2022
From: runette at gmail.com (Paul Harwood)
Date: Fri, 2 Dec 2022 12:58:11 +0000
Subject: [gdal-dev] Build of gdal fails on missing OSGeo.GDAL.Core
In-Reply-To: <CAE8nN5MG4BVBOmm9kDfgc+_zqtyCk=79X8OuUz6ksw9A0RzFUA@mail.gmail.com>
References: <18dd49bf-05c4-96d5-ea6e-71b161c10169@cantab.net>
 <CAE8nN5MG4BVBOmm9kDfgc+_zqtyCk=79X8OuUz6ksw9A0RzFUA@mail.gmail.com>
Message-ID: <CAE8nN5NX9srLbMD=DwuBiu0_JUf_bz4oPREoV0p_onZBX+Ba5g@mail.gmail.com>

sorry - cut and paste error. That should have been

-DBUILD_CSHARP_BINDINGS=OFF

On Fri, 2 Dec 2022 at 12:53, Paul Harwood <runette at gmail.com> wrote:

> I can have a think about what is causing the problem - but the simplest
> fix if you don't want the c# bindings is to build with
> -DBUILD_CSHARP_BINDINGS:BOOLOFF
>
> More on the compile switches here
> https://gdal.org/development/building_from_source.html#cmdoption-arg-BUILD_CSHARP_BINDINGS-BOOL
>
> On Fri, 2 Dec 2022 at 12:45, Rob Stevens <phlebas at cantab.net> wrote:
>
>> I am very new to building out GIS tools on the MacOS platform,
>> so I apologize for my rather turgid description below.
>>
>> I am trying to build gdal 3.6.0 (git cloned)
>> on macos catalina 10.15.7 on a macbook pro 2017
>> On this machine I have various versions of Msoft dotnet core sdks
>> installed
>> (7.0.100, 6.0.403, 6.0.401, 2.1.500)
>> All goes well until the build gets 88% done.
>> Then I see:
>>
>> ======= Building .NET project OSGeo.OSR [Release ]
>>    Determining projects to restore...
>> /usr/local/share/dotnet/sdk/7.0.100/Sdks/Microsoft.NET.Sdk/targets/Microsoft.NET.EolTargetFrameworks.targets(28,5):
>>
>> warning NETSDK1138: The target framework 'net5.0' is out of support and
>> will not receive security updates in the future. Please refer to
>> https://aka.ms/dotnet-core-support for more information about the
>> support policy.
>>
>> [/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj]
>>    Writing /var/folders/15/nt94jgd930z_z6zr5gc081y00000gr/T/tmpUJ1Fvw.tmp
>> info : X.509 certificate chain validation will use the fallback
>> certificate bundle at
>> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/codesignctl.pem'.
>> info : X.509 certificate chain validation will use the fallback
>> certificate bundle at
>> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/timestampctl.pem'.
>> info : Restoring packages for
>>
>> /Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj...
>> info :   GET
>> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json
>> info :   NotFound
>> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json 1316ms
>> error: NU1101: Unable to find package OSGeo.GDAL.Core. No packages exist
>> with this id in source(s): nuget.org
>> error: Package 'OSGeo.GDAL.Core' is incompatible with 'all' frameworks
>> in project
>>
>> '/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj'
>>
>> It is not my intent to build any dotnet components/interfaces
>> but the cmake build seems to want to do this just by virtue
>> of my having dotnet SDKs installed. The cmake build files
>> are very difficult to understand, and I have not yet been
>> able to figure out how to prevent these unneeded
>> components being built.
>>
>> 1. How do I prevent these dotnet components being built?
>> 2. It seems as though I am trying to build against all versions of the
>> dotnet
>>      SDK installed, but some of those versions do not have nuget packages
>>      for OSGeo.GDal.Core.
>>      Regardless of my needs, is this not a larger problem in the build?
>>
>> Thanks for any help.
>>
>> Rob Stevens
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221202/92a618e0/attachment.htm>

From runette at gmail.com  Fri Dec  2 05:18:55 2022
From: runette at gmail.com (Paul Harwood)
Date: Fri, 2 Dec 2022 13:18:55 +0000
Subject: [gdal-dev] Build of gdal fails on missing OSGeo.GDAL.Core
In-Reply-To: <CAE8nN5NX9srLbMD=DwuBiu0_JUf_bz4oPREoV0p_onZBX+Ba5g@mail.gmail.com>
References: <18dd49bf-05c4-96d5-ea6e-71b161c10169@cantab.net>
 <CAE8nN5MG4BVBOmm9kDfgc+_zqtyCk=79X8OuUz6ksw9A0RzFUA@mail.gmail.com>
 <CAE8nN5NX9srLbMD=DwuBiu0_JUf_bz4oPREoV0p_onZBX+Ba5g@mail.gmail.com>
Message-ID: <CAE8nN5MDO1mFXmvZ3wqtwFJbEB0woPKk+UtsCpm4c1vfGDm45A@mail.gmail.com>

BTW - I am fairly certain that the error messages are because the .NET SDK
release default is still set as .NET 5  and reading your email - you don't
have .NET 5. Since you did not set the .NET release - it is trying to use
the default.

I think the error messages could be a lot better! I can have a look at that.

I guess that defaulting to .NET 5 is no longer ideal. I can have a look at
that as well.

On Fri, 2 Dec 2022 at 12:58, Paul Harwood <runette at gmail.com> wrote:

> sorry - cut and paste error. That should have been
>
> -DBUILD_CSHARP_BINDINGS=OFF
>
> On Fri, 2 Dec 2022 at 12:53, Paul Harwood <runette at gmail.com> wrote:
>
>> I can have a think about what is causing the problem - but the simplest
>> fix if you don't want the c# bindings is to build with
>> -DBUILD_CSHARP_BINDINGS:BOOLOFF
>>
>> More on the compile switches here
>> https://gdal.org/development/building_from_source.html#cmdoption-arg-BUILD_CSHARP_BINDINGS-BOOL
>>
>> On Fri, 2 Dec 2022 at 12:45, Rob Stevens <phlebas at cantab.net> wrote:
>>
>>> I am very new to building out GIS tools on the MacOS platform,
>>> so I apologize for my rather turgid description below.
>>>
>>> I am trying to build gdal 3.6.0 (git cloned)
>>> on macos catalina 10.15.7 on a macbook pro 2017
>>> On this machine I have various versions of Msoft dotnet core sdks
>>> installed
>>> (7.0.100, 6.0.403, 6.0.401, 2.1.500)
>>> All goes well until the build gets 88% done.
>>> Then I see:
>>>
>>> ======= Building .NET project OSGeo.OSR [Release ]
>>>    Determining projects to restore...
>>> /usr/local/share/dotnet/sdk/7.0.100/Sdks/Microsoft.NET.Sdk/targets/Microsoft.NET.EolTargetFrameworks.targets(28,5):
>>>
>>> warning NETSDK1138: The target framework 'net5.0' is out of support and
>>> will not receive security updates in the future. Please refer to
>>> https://aka.ms/dotnet-core-support for more information about the
>>> support policy.
>>>
>>> [/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj]
>>>    Writing /var/folders/15/nt94jgd930z_z6zr5gc081y00000gr/T/tmpUJ1Fvw.tmp
>>> info : X.509 certificate chain validation will use the fallback
>>> certificate bundle at
>>> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/codesignctl.pem'.
>>> info : X.509 certificate chain validation will use the fallback
>>> certificate bundle at
>>> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/timestampctl.pem'.
>>> info : Restoring packages for
>>>
>>> /Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj...
>>> info :   GET
>>> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json
>>> info :   NotFound
>>> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json 1316ms
>>> error: NU1101: Unable to find package OSGeo.GDAL.Core. No packages exist
>>> with this id in source(s): nuget.org
>>> error: Package 'OSGeo.GDAL.Core' is incompatible with 'all' frameworks
>>> in project
>>>
>>> '/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj'
>>>
>>> It is not my intent to build any dotnet components/interfaces
>>> but the cmake build seems to want to do this just by virtue
>>> of my having dotnet SDKs installed. The cmake build files
>>> are very difficult to understand, and I have not yet been
>>> able to figure out how to prevent these unneeded
>>> components being built.
>>>
>>> 1. How do I prevent these dotnet components being built?
>>> 2. It seems as though I am trying to build against all versions of the
>>> dotnet
>>>      SDK installed, but some of those versions do not have nuget packages
>>>      for OSGeo.GDal.Core.
>>>      Regardless of my needs, is this not a larger problem in the build?
>>>
>>> Thanks for any help.
>>>
>>> Rob Stevens
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221202/20655905/attachment.htm>

From even.rouault at spatialys.com  Fri Dec  2 05:24:21 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 2 Dec 2022 14:24:21 +0100
Subject: [gdal-dev] Motion: adopt RFC69 C/C++ Code Formatting
In-Reply-To: <a5aa47e0-2b1f-f745-25ba-24a8452e7e20@itopen.it>
References: <a5aa47e0-2b1f-f745-25ba-24a8452e7e20@itopen.it>
Message-ID: <d40776f2-affd-b84a-c2eb-e706a0fdd23d@spatialys.com>

Hi,

I declare this motion passed with +1 from PSC members KurtS and me.

Even

Le 24/11/2022 ? 09:39, ElPaso a ?crit?:
> Hi,
>
> Motion:
>
> Adopt RFC88: RFC69 C/C++ Code Formatting [1]
>
> I have updated the RFC [1] to use pre-commit and I have created a 
> draft implementation of the pre-commit hook and the CI integration 
> with a GH workflow [2].
>
> If adopted, we still have to agree on which coding style to apply (for 
> now I used a clang-format file I've found under gdal/scripts), but the 
> biggest decision is wether proceed with an initial "Big Reformat" or 
> an incremental one, my draft implementation supports both.
>
>
> Kind regards.
>
>
> [1] 
> https://github.com/elpaso/gdal/blob/rfc69_cplusplus_formatting-text-only/doc/source/development/rfc/rfc69_cplusplus_formatting.rst
> [2] 
> https://github.com/elpaso/gdal/tree/rfc69_cplusplus_formatting_revival
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From runette at gmail.com  Fri Dec  2 15:56:11 2022
From: runette at gmail.com (Paul Harwood)
Date: Fri, 2 Dec 2022 23:56:11 +0000
Subject: [gdal-dev] Build of gdal fails on missing OSGeo.GDAL.Core
In-Reply-To: <CAE8nN5MDO1mFXmvZ3wqtwFJbEB0woPKk+UtsCpm4c1vfGDm45A@mail.gmail.com>
References: <18dd49bf-05c4-96d5-ea6e-71b161c10169@cantab.net>
 <CAE8nN5MG4BVBOmm9kDfgc+_zqtyCk=79X8OuUz6ksw9A0RzFUA@mail.gmail.com>
 <CAE8nN5NX9srLbMD=DwuBiu0_JUf_bz4oPREoV0p_onZBX+Ba5g@mail.gmail.com>
 <CAE8nN5MDO1mFXmvZ3wqtwFJbEB0woPKk+UtsCpm4c1vfGDm45A@mail.gmail.com>
Message-ID: <CAE8nN5Px0CFUCPzs4rHDdhKT-4NbFia6H0Swhfc+90MfrWsxqw@mail.gmail.com>

PR proposed related to this https://github.com/OSGeo/gdal/pull/6843

On Fri, 2 Dec 2022 at 13:18, Paul Harwood <runette at gmail.com> wrote:

> BTW - I am fairly certain that the error messages are because the .NET SDK
> release default is still set as .NET 5  and reading your email - you don't
> have .NET 5. Since you did not set the .NET release - it is trying to use
> the default.
>
> I think the error messages could be a lot better! I can have a look at
> that.
>
> I guess that defaulting to .NET 5 is no longer ideal. I can have a look at
> that as well.
>
> On Fri, 2 Dec 2022 at 12:58, Paul Harwood <runette at gmail.com> wrote:
>
>> sorry - cut and paste error. That should have been
>>
>> -DBUILD_CSHARP_BINDINGS=OFF
>>
>> On Fri, 2 Dec 2022 at 12:53, Paul Harwood <runette at gmail.com> wrote:
>>
>>> I can have a think about what is causing the problem - but the simplest
>>> fix if you don't want the c# bindings is to build with
>>> -DBUILD_CSHARP_BINDINGS:BOOLOFF
>>>
>>> More on the compile switches here
>>> https://gdal.org/development/building_from_source.html#cmdoption-arg-BUILD_CSHARP_BINDINGS-BOOL
>>>
>>> On Fri, 2 Dec 2022 at 12:45, Rob Stevens <phlebas at cantab.net> wrote:
>>>
>>>> I am very new to building out GIS tools on the MacOS platform,
>>>> so I apologize for my rather turgid description below.
>>>>
>>>> I am trying to build gdal 3.6.0 (git cloned)
>>>> on macos catalina 10.15.7 on a macbook pro 2017
>>>> On this machine I have various versions of Msoft dotnet core sdks
>>>> installed
>>>> (7.0.100, 6.0.403, 6.0.401, 2.1.500)
>>>> All goes well until the build gets 88% done.
>>>> Then I see:
>>>>
>>>> ======= Building .NET project OSGeo.OSR [Release ]
>>>>    Determining projects to restore...
>>>> /usr/local/share/dotnet/sdk/7.0.100/Sdks/Microsoft.NET.Sdk/targets/Microsoft.NET.EolTargetFrameworks.targets(28,5):
>>>>
>>>> warning NETSDK1138: The target framework 'net5.0' is out of support and
>>>> will not receive security updates in the future. Please refer to
>>>> https://aka.ms/dotnet-core-support for more information about the
>>>> support policy.
>>>>
>>>> [/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj]
>>>>    Writing
>>>> /var/folders/15/nt94jgd930z_z6zr5gc081y00000gr/T/tmpUJ1Fvw.tmp
>>>> info : X.509 certificate chain validation will use the fallback
>>>> certificate bundle at
>>>> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/codesignctl.pem'.
>>>> info : X.509 certificate chain validation will use the fallback
>>>> certificate bundle at
>>>> '/usr/local/share/dotnet/sdk/7.0.100/trustedroots/timestampctl.pem'.
>>>> info : Restoring packages for
>>>>
>>>> /Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj...
>>>> info :   GET
>>>> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json
>>>> info :   NotFound
>>>> https://api.nuget.org/v3-flatcontainer/osgeo.gdal.core/index.json
>>>> 1316ms
>>>> error: NU1101: Unable to find package OSGeo.GDAL.Core. No packages
>>>> exist
>>>> with this id in source(s): nuget.org
>>>> error: Package 'OSGeo.GDAL.Core' is incompatible with 'all' frameworks
>>>> in project
>>>>
>>>> '/Users/rob/tmp/git_checkouts/gdal/build/swig/csharp/osr/osr_csharp.csproj'
>>>>
>>>> It is not my intent to build any dotnet components/interfaces
>>>> but the cmake build seems to want to do this just by virtue
>>>> of my having dotnet SDKs installed. The cmake build files
>>>> are very difficult to understand, and I have not yet been
>>>> able to figure out how to prevent these unneeded
>>>> components being built.
>>>>
>>>> 1. How do I prevent these dotnet components being built?
>>>> 2. It seems as though I am trying to build against all versions of the
>>>> dotnet
>>>>      SDK installed, but some of those versions do not have nuget
>>>> packages
>>>>      for OSGeo.GDal.Core.
>>>>      Regardless of my needs, is this not a larger problem in the build?
>>>>
>>>> Thanks for any help.
>>>>
>>>> Rob Stevens
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221202/38621370/attachment.htm>

From bjorn.harrtell at gmail.com  Sat Dec  3 05:18:10 2022
From: bjorn.harrtell at gmail.com (=?UTF-8?Q?Bj=C3=B6rn_Harrtell?=)
Date: Sat, 3 Dec 2022 14:18:10 +0100
Subject: [gdal-dev] Is there a way to create a spatial index in FGB if
 created without?
In-Reply-To: <3080ad07-a9d3-85b5-5283-53ced54e9ca3@spatialys.com>
References: <089af468-5e02-6765-7da6-c3150fe8feba@spatialys.com>
 <96451436-10CA-41D7-818F-4BC1B3B62675@gmail.com>
 <3080ad07-a9d3-85b5-5283-53ced54e9ca3@spatialys.com>
Message-ID: <CANhDX=Yh0+geRVVuWUp9nbAyDQeXrm3jiyK2q45P0nb23MKy2w@mail.gmail.com>

So this (https://github.com/OSGeo/gdal/pull/6804) optimization by Even
might be helpful here.

In any case nice to see the limits of current FlatGeobuf impl. being put to
the test. ?

I suppose one could do an on disk sorting implementation but I'm not sure
it's worth the complexity of it and speed trade off.

If i can get to it would like to get some measurements done to properly
document the amount of RAM required as a function of number of features to
index.

Bj?rn

Den tors 24 nov. 2022 19:38Even Rouault <even.rouault at spatialys.com> skrev:

>
> Le 24/11/2022 ? 19:18, michael.smith.erdc at gmail.com a ?crit :
> > I don?t believe these are huge features, its OSM building for the
> > world. Must be the memory constraint since it is a lot of features.
> > This doesn?t happen (i think, am retesting now) if created from the
> > osm pbf file directly but does from the fgb created from the pbf.
> Hum, it might be that the FGB reader is a bit gready in its memory usage
> then. Bj?rn might be able to comment more
> >
> > Do either of the columnar formats (arrow, geoparquet) support spatial
> > access window selections yet (via ogr2ogr) or is that still forthcoming?
>
> There is no spatial index specification for those formats (yet ? it
> isn't obvious how to stick one into them, in a clean and backward
> compatible way, but I believe this is a subject of research). So for now
> spatial filtering involves scanning all features geometries (there are a
> few optimizations to make it as efficient as possible, but you
> definitely won't get a great performance if repeatedly selecting small
> amounts of features with different extents)
>
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221203/edff6358/attachment.htm>

From ccrook at linz.govt.nz  Sun Dec  4 00:02:28 2022
From: ccrook at linz.govt.nz (Chris Crook)
Date: Sun, 4 Dec 2022 08:02:28 +0000
Subject: [gdal-dev] Python API ReadAsArray axis order
Message-ID: <SY4PR01MB655391003B4C164638E5E833EC199@SY4PR01MB6553.ausprd01.prod.outlook.com>

Hi

I am using the Python GDAL API and looking at a simple TIFF image with a test program:

from osgeo import gdal
dataset = gdal.Open('test-gdal.tif')
transform=dataset.GetGeoTransform()
nx=dataset.RasterXSize
ny=dataset.RasterYSize
data=dataset.ReadAsArray()
print(f"Raster xsize, ysize ({nx},{ny})")
print(f"ReadAsArray dimensions {data.shape}")
print(f"GeoTransform: {transform}")

The output is:

test_python_api.py
Raster xsize, ysize (3,4)
ReadAsArray dimensions (4, 3)
GeoTransform: (22.15, 0.7, 0.0, -69.5, 0.0, 1.0)


I am confused that the array appears transposed from the raster x,y size.

Is this always the cased.  As far as I can tell the geotransform is assuming x,y (0-2,0-3 values) to map indices to location, which is what I want to do.

Can I assume that the array is always transposed?  Or if not how do I identify when this is the case?

Many thanks in advance

Chris Crook
Land Information New Zealand






________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221204/b69ba40a/attachment.htm>

From j1 at jimenezshaw.com  Sun Dec  4 04:02:19 2022
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sun, 4 Dec 2022 13:02:19 +0100
Subject: [gdal-dev] Python API ReadAsArray axis order
In-Reply-To: <SY4PR01MB655391003B4C164638E5E833EC199@SY4PR01MB6553.ausprd01.prod.outlook.com>
References: <SY4PR01MB655391003B4C164638E5E833EC199@SY4PR01MB6553.ausprd01.prod.outlook.com>
Message-ID: <CADRrdKsOrEx9WAfOsa0TOXMOsS9sULXwidmKVW-7r75L8YhuwA@mail.gmail.com>

Hi Chris

I am not an expert in python. But I had similar problems in other
environments.
At https://gdal.org/api/python/osgeo.gdal.html you can see that in many
functions the numpy array returned is always in the form "array[y][x]".
Looks like the shape in stored as "row,cols", not as "x,y".

Cheers
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Sun, 4 Dec 2022 at 09:02, Chris Crook <ccrook at linz.govt.nz> wrote:

> Hi
>
> I am using the Python GDAL API and looking at a simple TIFF image with a
> test program:
>
> from osgeo import gdal
> dataset = gdal.Open('test-gdal.tif')
> transform=dataset.GetGeoTransform()
> nx=dataset.RasterXSize
> ny=dataset.RasterYSize
> data=dataset.ReadAsArray()
> print(f"Raster xsize, ysize ({nx},{ny})")
> print(f"ReadAsArray dimensions {data.shape}")
> print(f"GeoTransform: {transform}")
>
> The output is:
>
> test_python_api.py
> Raster xsize, ysize (3,4)
> ReadAsArray dimensions (4, 3)
> GeoTransform: (22.15, 0.7, 0.0, -69.5, 0.0, 1.0)
>
>
> I am confused that the array appears transposed from the raster x,y size.
>
> Is this always the cased.  As far as I can tell the geotransform is
> assuming x,y (0-2,0-3 values) to map indices to location, which is what I
> want to do.
>
> Can I assume that the array is always transposed?  Or if not how do I
> identify when this is the case?
>
> Many thanks in advance
>
> Chris Crook
> Land Information New Zealand
>
>
>
>
>
>
> ------------------------------
>
> This message contains information, which may be in confidence and may be
> subject to legal privilege. If you are not the intended recipient, you must
> not peruse, use, disseminate, distribute or copy this message. If you have
> received this message in error, please notify us immediately (Phone 0800
> 665 463 or info at linz.govt.nz) and destroy the original message. LINZ
> accepts no responsibility for changes to this email, or for any
> attachments, after its transmission from LINZ. Thank You.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221204/e974be13/attachment.htm>

From even.rouault at spatialys.com  Sun Dec  4 04:07:29 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 4 Dec 2022 13:07:29 +0100
Subject: [gdal-dev] Python API ReadAsArray axis order
In-Reply-To: <SY4PR01MB655391003B4C164638E5E833EC199@SY4PR01MB6553.ausprd01.prod.outlook.com>
References: <SY4PR01MB655391003B4C164638E5E833EC199@SY4PR01MB6553.ausprd01.prod.outlook.com>
Message-ID: <8f06a622-3008-06f6-9a57-91b0890b4aca@spatialys.com>

Chris,

ReadAsArray() returns a NumPy array, and the first dimension in NumPy is 
the slowest varying one, that is y.

GDAL's geotransform is

Xgeoref = gt[0] + column * gt[1] + line * gt[2]

Ygeoref = gt[3] + column * gt[4] + line * gt[5]

and GDAL's Raster API have their arguments with column first, line second.

So, there's no transposition. It is just a different convention on how 
to present dimensions.

Note: if you used GDAL's multidimensional API, it would be similar to 
NumPy convention, with slowest varying dimension being the first index 
value.

Even

Le 04/12/2022 ? 09:02, Chris Crook a ?crit?:
> Hi
>
> I am using the Python GDAL API and looking at a simple TIFF image with 
> a test program:
>
> from osgeo import gdal
> dataset = gdal.Open('test-gdal.tif')
> transform=dataset.GetGeoTransform()
> nx=dataset.RasterXSize
> ny=dataset.RasterYSize
> data=dataset.ReadAsArray()
> print(f"Raster xsize, ysize ({nx},{ny})")
> print(f"ReadAsArray dimensions {data.shape}")
> print(f"GeoTransform: {transform}")
>
> The output is:
>
> test_python_api.py
> Raster xsize, ysize (3,4)
> ReadAsArray dimensions (4, 3)
> GeoTransform: (22.15, 0.7, 0.0, -69.5, 0.0, 1.0)
>
>
> I am confused that the array appears transposed from the raster x,y size.
>
> Is this always the cased.? As far as I can tell the geotransform is 
> assuming x,y (0-2,0-3 values) to map indices to location, which is 
> what I want to do.
>
> Can I assume that the array is always transposed?? Or if not how do I 
> identify when this is the case?
>
> Many thanks in advance
>
> Chris Crook
> Land Information New Zealand
>
>
>
>
>
>
> ------------------------------------------------------------------------
>
> This message contains information, which may be in confidence and may 
> be subject to legal privilege. If you are not the intended recipient, 
> you must not peruse, use, disseminate, distribute or copy this 
> message. If you have received this message in error, please notify us 
> immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the 
> original message. LINZ accepts no responsibility for changes to this 
> email, or for any attachments, after its transmission from LINZ. Thank 
> You.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221204/3006cfeb/attachment-0001.htm>

From cliveswan at gmail.com  Mon Dec  5 02:24:14 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 5 Dec 2022 10:24:14 +0000
Subject: [gdal-dev] gdal_merge
Message-ID: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>

Hi Even,



Thanks
the ?configuration sorted out that issue.

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE is a configuration option /

environment variable, so you have to pass it with --config

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES



Now I am getting a memory issue?? << The input files are 6.9 GB + 672 MB
The output should be 7.xx GB



6.9 GB + 672MB

numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for
an array with shape (225000, 450000) and data type float32



Any suggestions appreciated

Kind regards,

Clive


-- 

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/df8c6525/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec  5 03:34:53 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 5 Dec 2022 11:34:53 +0000
Subject: [gdal-dev] gdal_merge
In-Reply-To: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
Message-ID: <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Maybe your rasters are far apart. Gdal_merge creates a raster with so large extent that all the source images fit within it. Even empty pixels take space.

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clive Swan
L?hetetty: maanantai 5. joulukuuta 2022 12.24
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdal_merge

Hi Even,

Thanks
the ?configuration sorted out that issue.
CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE is a configuration option /
environment variable, so you have to pass it with --config
CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES


Now I am getting a memory issue?? << The input files are 6.9 GB + 672 MB
The output should be 7.xx GB


6.9 GB + 672MB

numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for an array with shape (225000, 450000) and data type float32

Any suggestions appreciated
Kind regards,
Clive


--

 Regards,



Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/35ea3235/attachment.htm>

From cliveswan at gmail.com  Mon Dec  5 03:46:49 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 5 Dec 2022 11:46:49 +0000
Subject: [gdal-dev] gdal_merge
In-Reply-To: <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>

Hi,

The raster one is the world, the second is the UK.
The UK fits within the first raster...

We want to update UK data in raster one.

Regards,

Clive

Get Outlook for Android<https://aka.ms/AAb9ysg>
________________________________
From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Sent: Monday, December 5, 2022 11:34:53 AM
To: Clive Swan <cliveswan at gmail.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] gdal_merge


Hi,



Maybe your rasters are far apart. Gdal_merge creates a raster with so large extent that all the source images fit within it. Even empty pixels take space.



-Jukka Rahkonen-





L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clive Swan
L?hetetty: maanantai 5. joulukuuta 2022 12.24
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdal_merge



Hi Even,



Thanks
the ?configuration sorted out that issue.

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE is a configuration option /

environment variable, so you have to pass it with --config

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES


Now I am getting a memory issue?? << The input files are 6.9 GB + 672 MB
The output should be 7.xx GB



6.9 GB + 672MB

numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for an array with shape (225000, 450000) and data type float32



Any suggestions appreciated

Kind regards,

Clive


--

 Regards,



Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/b63bcb75/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec  5 04:32:28 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 5 Dec 2022 12:32:28 +0000
Subject: [gdal-dev] gdal_merge
In-Reply-To: <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <AM0PR09MB3219C96D0B7C6E8F505518A4FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Let's try to get all missing information with one mail.

  *   You have two images:
3_data_ready_for_spectra/coastal-undefended-rcp26-2020.tif and

5_UK_prod_rasters/coastal-undefended-rcp26-2020.tif.

Is that right? And the first one covers the world but the second one only UK, right?

  *   What are the pixel sizes and image sizes (in pixels, width x hight) of the source images?
  *   Are they compressed? With what method?
  *   What are the block sizes (out of curiosity, not essential knowledge)?
  *   Have you considered to create a tiled and compressed output? (you should)
  *   Have you considered to use gdalwarp instead? (I would)

With the gdalwarp option you could update the world image with the UK contents with "gdalwarp uk_image.tif world_image.tif". However, your images are in AWS and the same recipes that work for local images may not work so well in the cloud. Unfortunately that is something that I have no experience yet.

The logic in "The input files are 6.9 GB + 672 MB The output should be 7.xx GB" is wrong. If you update part of the pixels of the 6.9 GB file then the output should be about 6.9 GB. But if you convert a 6.9 GB compressed image into an uncompressed image, as I guess that you are doing, the output will be much bigger. How big it will be can be calculated with a formula that numpy showed (width x height) x (bytes/pixel).

-Jukka Rahkonen-

L?hett?j?: Clive Swan <cliveswan at gmail.com>
L?hetetty: maanantai 5. joulukuuta 2022 13.47
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdal_merge

Hi,

The raster one is the world, the second is the UK.
The UK fits within the first raster...

We want to update UK data in raster one.

Regards,

Clive

Get Outlook for Android<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2FAAb9ysg&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C405531fd73e74c5add7208dad6b66773%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638058376154245151%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=3iBA3SB0%2BBSUKMk8laLw5Gi7%2BnDzhHsoqTpjnfznUoY%3D&reserved=0>
________________________________
From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Monday, December 5, 2022 11:34:53 AM
To: Clive Swan <cliveswan at gmail.com<mailto:cliveswan at gmail.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: Re: [gdal-dev] gdal_merge


Hi,



Maybe your rasters are far apart. Gdal_merge creates a raster with so large extent that all the source images fit within it. Even empty pixels take space.



-Jukka Rahkonen-





L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Clive Swan
L?hetetty: maanantai 5. joulukuuta 2022 12.24
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdal_merge



Hi Even,



Thanks
the -configuration sorted out that issue.

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE is a configuration option /

environment variable, so you have to pass it with --config

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES


Now I am getting a memory issue?? << The input files are 6.9 GB + 672 MB
The output should be 7.xx GB



6.9 GB + 672MB

numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for an array with shape (225000, 450000) and data type float32



Any suggestions appreciated

Kind regards,

Clive


--

 Regards,



Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/fca487a6/attachment.htm>

From even.rouault at spatialys.com  Mon Dec  5 04:33:44 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 5 Dec 2022 13:33:44 +0100
Subject: [gdal-dev] gdal_merge
In-Reply-To: <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <0c3df129-b60f-b463-1a0c-4bb033be2042@spatialys.com>

You may need to specify the pixel size with the -ps argument to be the 
one with the less resolution.

Or try using gdalwarp instead (you may also need to use the -tr argument 
to specify the resolution). gdal_merge cannot deal with rasters larger 
than memory.

Le 05/12/2022 ? 12:46, Clive Swan a ?crit?:
> Hi,
>
> The raster one is the world, the second is the UK.
> The UK fits within the first raster...
>
> We want to update UK data in raster one.
>
> Regards,
>
> Clive
>
> Get Outlook for Android <https://aka.ms/AAb9ysg>
> ------------------------------------------------------------------------
> *From:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Sent:* Monday, December 5, 2022 11:34:53 AM
> *To:* Clive Swan <cliveswan at gmail.com>; gdal-dev at lists.osgeo.org 
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdal_merge
>
> Hi,
>
> Maybe your rasters are far apart. Gdal_merge creates a raster with so 
> large extent that all the source images fit within it. Even empty 
> pixels take space.
>
> -Jukka Rahkonen-
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Clive Swan
> *L?hetetty:* maanantai 5. joulukuuta 2022 12.24
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdal_merge
>
> Hi Even,
>
> Thanks
> the ?configuration sorted out that issue.
>
> CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE is a configuration option /
>
> environment variable, so you have to pass it with --config
>
> CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
>
>
>
> Now I am getting a memory issue?? << The input files are 6.9 GB + 672 MB
> The output should be 7.xx GB
>
> 6.9 GB + 672MB
>
> numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB 
> for an array with shape (225000, 450000) and data type float32
>
> Any suggestions appreciated
>
> Kind regards,
>
> Clive
>
>
>
> -- 
>
> ?Regards,
>
> Clive Swan
>
> --
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/e2d2da31/attachment-0001.htm>

From cliveswan at gmail.com  Mon Dec  5 05:31:40 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 5 Dec 2022 13:31:40 +0000
Subject: [gdal-dev] gdal_merge
In-Reply-To: <AM0PR09MB3219C96D0B7C6E8F505518A4FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB3219C96D0B7C6E8F505518A4FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CA+kQ3mup=w+5ZFkz6ro=+Xuybbw49Wq9FAJhFCJB8a=M8A=BcQ@mail.gmail.com>

Greetings,

 I tried
-ps 3600 7200
 -ps 3600,7200
-ps x=3600  y=7200

Just get errors, I don't see any option to select LZW or any compression??

Extent -180.0000000000000000,-90.0000000000000000 :
> 180.0000000000000000,90.0000000000000000
> Width 7200
> Height 3600
> Data type Float32 - Thirty two bit floating point
>
Compression LZW

On Mon, 5 Dec 2022 at 12:32, Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Let?s try to get all missing information with one mail.
>
>    - You have two images:
>    3_data_ready_for_spectra/coastal-undefended-rcp26-2020.tif and
>
> 5_UK_prod_rasters/coastal-undefended-rcp26-2020.tif.
>
> Is that right? And the first one covers the world but the second one only
> UK, right?
>
>    - What are the pixel sizes and image sizes (in pixels, width x hight)
>    of the source images?
>    - Are they compressed? With what method?
>    - What are the block sizes (out of curiosity, not essential knowledge)?
>    - Have you considered to create a tiled and compressed output? (you
>    should)
>    - Have you considered to use gdalwarp instead? (I would)
>
>
>
> With the gdalwarp option you could update the world image with the UK
> contents with ?gdalwarp uk_image.tif world_image.tif?. However, your images
> are in AWS and the same recipes that work for local images may not work so
> well in the cloud. Unfortunately that is something that I have no
> experience yet.
>
>
>
> The logic in ?The input files are 6.9 GB + 672 MB The output should be
> 7.xx GB? is wrong. If you update part of the pixels of the 6.9 GB file then
> the output should be about 6.9 GB. But if you convert a 6.9 GB compressed
> image into an uncompressed image, as I guess that you are doing, the output
> will be much bigger. How big it will be can be calculated with a formula
> that numpy showed (width x height) x (bytes/pixel).
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Clive Swan <cliveswan at gmail.com>
> *L?hetetty:* maanantai 5. joulukuuta 2022 13.47
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] gdal_merge
>
>
>
> Hi,
>
>
>
> The raster one is the world, the second is the UK.
>
> The UK fits within the first raster...
>
>
>
> We want to update UK data in raster one.
>
>
>
> Regards,
>
>
>
> Clive
>
>
>
> Get Outlook for Android
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2FAAb9ysg&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C405531fd73e74c5add7208dad6b66773%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638058376154245151%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=3iBA3SB0%2BBSUKMk8laLw5Gi7%2BnDzhHsoqTpjnfznUoY%3D&reserved=0>
> ------------------------------
>
> *From:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Sent:* Monday, December 5, 2022 11:34:53 AM
> *To:* Clive Swan <cliveswan at gmail.com>; gdal-dev at lists.osgeo.org <
> gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdal_merge
>
>
>
> Hi,
>
>
>
> Maybe your rasters are far apart. Gdal_merge creates a raster with so
> large extent that all the source images fit within it. Even empty pixels
> take space.
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Clive
> Swan
> *L?hetetty:* maanantai 5. joulukuuta 2022 12.24
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdal_merge
>
>
>
> Hi Even,
>
>
>
> Thanks
> the ?configuration sorted out that issue.
>
> CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE is a configuration option /
>
> environment variable, so you have to pass it with --config
>
> CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
>
>
>
> Now I am getting a memory issue?? << The input files are 6.9 GB + 672 MB
> The output should be 7.xx GB
>
>
>
> 6.9 GB + 672MB
>
> numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for
> an array with shape (225000, 450000) and data type float32
>
>
>
> Any suggestions appreciated
>
> Kind regards,
>
> Clive
>
>
>
> --
>
>  Regards,
>
>
>
> Clive Swan
>
> --
>


-- 

 Regards,


Clive Swan

--


M: +44 7766 452665
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/87447007/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec  5 05:51:32 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 5 Dec 2022 13:51:32 +0000
Subject: [gdal-dev] gdal_merge
In-Reply-To: <CA+kQ3mup=w+5ZFkz6ro=+Xuybbw49Wq9FAJhFCJB8a=M8A=BcQ@mail.gmail.com>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB3219C96D0B7C6E8F505518A4FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CA+kQ3mup=w+5ZFkz6ro=+Xuybbw49Wq9FAJhFCJB8a=M8A=BcQ@mail.gmail.com>
Message-ID: <AM0PR09MB3219F9B2F8D6E41DCA294E8BFD189@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

I asked a few questions and hoped we could solve your problem with one mail if you answered them all but probably we need more. Here is an example about the info I would like to see. You can obtain it with gdalinfo
gdalinfo test.tif
...
Size is 12000, 12000
...
Pixel Size = (0.500000000000000,-0.500000000000000)
...
COMPRESSION=YCbCr JPEG
...
Band 1 Block=256x256 Type=Byte, ColorInterp=Red

The -ps stands for pixel size https://gdal.org/programs/gdal_merge.html#cmdoption-gdal_merge-ps. Thus, how many meters or degrees one pixel is wide/high. Gdal_merge does not have an option for defining the size of the output image in pixels. See my example about half-a-metre pixels above, that is the information that you need. Do not pay attention to negative Y size, use positive number for both directions with gdal_merge. Do not get surprised by the small number that you will probably see, I guess your image in in EPSG:4326 and the units are degrees.

Compression options are format specific, for GeoTIFF read https://gdal.org/drivers/raster/gtiff.html. With gdal_merge read https://gdal.org/programs/gdal_merge.html#cmdoption-gdal_merge-co and add for example "-co COMPRESS=LZW -co TILED=YES" into the command.

-Jukka Rahkonen-

L?hett?j?: Clive Swan <cliveswan at gmail.com>
L?hetetty: maanantai 5. joulukuuta 2022 15.32
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdal_merge

Greetings,
 I tried
-ps 3600 7200
 -ps 3600,7200
-ps x=3600  y=7200

Just get errors, I don't see any option to select LZW or any compression??

Extent
-180.0000000000000000,-90.0000000000000000 : 180.0000000000000000,90.0000000000000000
Width
7200
Height
3600
Data type
Float32 - Thirty two bit floating point
Compression
LZW

On Mon, 5 Dec 2022 at 12:32, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Let's try to get all missing information with one mail.

  *   You have two images:
3_data_ready_for_spectra/coastal-undefended-rcp26-2020.tif and

5_UK_prod_rasters/coastal-undefended-rcp26-2020.tif.

Is that right? And the first one covers the world but the second one only UK, right?

  *   What are the pixel sizes and image sizes (in pixels, width x hight) of the source images?
  *   Are they compressed? With what method?
  *   What are the block sizes (out of curiosity, not essential knowledge)?
  *   Have you considered to create a tiled and compressed output? (you should)
  *   Have you considered to use gdalwarp instead? (I would)

With the gdalwarp option you could update the world image with the UK contents with "gdalwarp uk_image.tif world_image.tif". However, your images are in AWS and the same recipes that work for local images may not work so well in the cloud. Unfortunately that is something that I have no experience yet.

The logic in "The input files are 6.9 GB + 672 MB The output should be 7.xx GB" is wrong. If you update part of the pixels of the 6.9 GB file then the output should be about 6.9 GB. But if you convert a 6.9 GB compressed image into an uncompressed image, as I guess that you are doing, the output will be much bigger. How big it will be can be calculated with a formula that numpy showed (width x height) x (bytes/pixel).

-Jukka Rahkonen-

L?hett?j?: Clive Swan <cliveswan at gmail.com<mailto:cliveswan at gmail.com>>
L?hetetty: maanantai 5. joulukuuta 2022 13.47
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] gdal_merge

Hi,

The raster one is the world, the second is the UK.
The UK fits within the first raster...

We want to update UK data in raster one.

Regards,

Clive

Get Outlook for Android<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2FAAb9ysg&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca53f6e33f709481cefa008dad6c51040%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638058439123548735%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=NbhnxmobPMAi%2F%2FrcmPjSwtbKHyRqxAriD5MNJe4CSXA%3D&reserved=0>
________________________________
From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Monday, December 5, 2022 11:34:53 AM
To: Clive Swan <cliveswan at gmail.com<mailto:cliveswan at gmail.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: Re: [gdal-dev] gdal_merge


Hi,



Maybe your rasters are far apart. Gdal_merge creates a raster with so large extent that all the source images fit within it. Even empty pixels take space.



-Jukka Rahkonen-





L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Clive Swan
L?hetetty: maanantai 5. joulukuuta 2022 12.24
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdal_merge



Hi Even,



Thanks
the -configuration sorted out that issue.

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE is a configuration option /

environment variable, so you have to pass it with --config

CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES


Now I am getting a memory issue?? << The input files are 6.9 GB + 672 MB
The output should be 7.xx GB



6.9 GB + 672MB

numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for an array with shape (225000, 450000) and data type float32



Any suggestions appreciated

Kind regards,

Clive


--

 Regards,



Clive Swan

--


--

 Regards,



Clive Swan

--



M: +44 7766 452665
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/bfebe5e0/attachment-0001.htm>

From gdal at stripfamily.net  Mon Dec  5 05:41:41 2022
From: gdal at stripfamily.net (David Strip)
Date: Mon, 5 Dec 2022 06:41:41 -0700
Subject: [gdal-dev] gdal_merge
In-Reply-To: <CA+kQ3mup=w+5ZFkz6ro=+Xuybbw49Wq9FAJhFCJB8a=M8A=BcQ@mail.gmail.com>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB3219C96D0B7C6E8F505518A4FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CA+kQ3mup=w+5ZFkz6ro=+Xuybbw49Wq9FAJhFCJB8a=M8A=BcQ@mail.gmail.com>
Message-ID: <6a070ca0-a138-4a64-37e7-746cb93aa192@stripfamily.net>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/940f9aff/attachment.htm>

From cliveswan at gmail.com  Mon Dec  5 06:11:28 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 5 Dec 2022 14:11:28 +0000
Subject: [gdal-dev] gdal_merge
In-Reply-To: <AM0PR09MB3219F9B2F8D6E41DCA294E8BFD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB3219C96D0B7C6E8F505518A4FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CA+kQ3mup=w+5ZFkz6ro=+Xuybbw49Wq9FAJhFCJB8a=M8A=BcQ@mail.gmail.com>
 <AM0PR09MB3219F9B2F8D6E41DCA294E8BFD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CA+kQ3mtf8FuCAfA-Qe1446Q5rg447JSiWrBqQnJEmnPXw_TOkw@mail.gmail.com>

The raster file details are:
Extent: -180.0000000000000000,-90.0000000000000000 :
180.0000000000000000,90.0000000000000000
Width:  7200
Height: 3600
Pixel Size = (0.000800000000000,-0.000800000000000)
Data type: Float32 - Thirty two bit floating point
Compression: LZW

   - Still getting an error for -ps 3600 7200
   - I did not see gdalwarp option to merge two images


Thanks
Clive
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221205/97cfe663/attachment.htm>

From andrew at aitchison.me.uk  Mon Dec  5 06:20:36 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 5 Dec 2022 14:20:36 +0000 (GMT)
Subject: [gdal-dev] gdal_merge
In-Reply-To: <CA+kQ3mtf8FuCAfA-Qe1446Q5rg447JSiWrBqQnJEmnPXw_TOkw@mail.gmail.com>
References: <CA+kQ3mux249zxouLqon=sNj7G9rHatbhUUe8Pgu8shnqum7rnA@mail.gmail.com>
 <AM0PR09MB321954FF1DEDE38AEE41CA67FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB39598752820997674CC7529DA0189@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB3219C96D0B7C6E8F505518A4FD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CA+kQ3mup=w+5ZFkz6ro=+Xuybbw49Wq9FAJhFCJB8a=M8A=BcQ@mail.gmail.com>
 <AM0PR09MB3219F9B2F8D6E41DCA294E8BFD189@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CA+kQ3mtf8FuCAfA-Qe1446Q5rg447JSiWrBqQnJEmnPXw_TOkw@mail.gmail.com>
Message-ID: <27946322-6ad7-0433-d6e0-09fc397de445@aitchison.me.uk>

On Mon, 5 Dec 2022, Clive Swan wrote:

> The raster file details are:
> Extent: -180.0000000000000000,-90.0000000000000000 :
> 180.0000000000000000,90.0000000000000000
> Width:  7200
> Height: 3600
> Pixel Size = (0.000800000000000,-0.000800000000000)
> Data type: Float32 - Thirty two bit floating point
> Compression: LZW
>
>   - Still getting an error for -ps 3600 7200

Maybe I misunderstand, but don't you want -ps 0.0008 0.0008 ?

>   - I did not see gdalwarp option to merge two images

        <dstfile>
               The destination file name.
   Mosaicing into an existing output file is supported if the
   output file already exists.  The spatial extent of the existing file
   will not be modified to accommodate new data, so you may have to
   remove it in that case, or use the -overwrite option.

So I would copy the world file then do something based on:
      gdalwarp uk.tif world_copy.tif


-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From chris at lightfield.ag  Tue Dec  6 18:26:59 2022
From: chris at lightfield.ag (Chris Diehl)
Date: Tue, 6 Dec 2022 19:26:59 -0700
Subject: [gdal-dev] Deriving a new raster attribute layer from a polygon
 layer
Message-ID: <CA+q8prWokg+vf8EwRGCeix78iaYgjaECgc9zxRoRA8QMeOrZ+w@mail.gmail.com>

Hello everyone,

I am trying to discern how I can accomplish the following at the command
line with GDAL and could use some guidance. I have a GeoTIFF containing
data from the National Land Cover Database and I would like to add another
raster layer to the GeoTIFF that contains land management labels for the
centroids of each pixel in the NLCD raster. I have a GeoJSON file that has
polygons representing areas with a particular land management label. At the
end of the day, I'd like to produce a GeoTIFF with two bands, one
representing the land cover type and another representing the land
management type.

I located this example
<https://gis.stackexchange.com/questions/365258/spatial-join-between-raster-and-shapefille-give-raster-the-shapefile-values-w>
that I believe is a Python-based solution to my problem but the code is
producing an empty GeoTIFF. I assume if a solution path does exist, there's
a way to do this at the command line which would be preferable.

If someone can point me in the right direction, I would be very grateful!
I'm struggling to see how to get there from the GDAL docs.

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221206/baa7cb26/attachment.htm>

From sethg at geographika.co.uk  Wed Dec  7 06:11:13 2022
From: sethg at geographika.co.uk (Seth G)
Date: Wed, 07 Dec 2022 15:11:13 +0100
Subject: [gdal-dev] MSSQL Driver and Bulk Copy Drivers
Message-ID: <5761c019-354c-40c0-afa1-143d6675a560@app.fastmail.com>

Hi all,

>From the Microsoft docs at https://learn.microsoft.com/en-us/sql/relational-databases/native-client/applications/installing-sql-server-native-client?view=sql-server-ver16:

> The SQL Server Native Client (often abbreviated SNAC) has been removed from SQL Server 2022 (16.x) and SQL Server Management Studio 19 (SSMS). The SQL Server Native Client (SQLNCLI or SQLNCLI11) and the legacy Microsoft OLE DB Provider for SQL Server (SQLOLEDB) are not recommended for new development. Switch to the new Microsoft OLE DB Driver (MSOLEDBSQL) for SQL Server or the latest Microsoft ODBC Driver for SQL Server going forward.

So the native SQL Server driver will be retired, however the GDAL MSSQL Driver only supports bulk copy (BCP) with this driver and not the "ODBC Driver 17 for SQL Server" - the following error is returned:

> ERROR 1: SQL Error SQLState=HY000, NativeError=0, Msg=[Microsoft][ODBC Driver 17 for SQL Server]Connection is not enabled for BCP

According to https://learn.microsoft.com/en-us/sql/connect/odbc/microsoft-odbc-driver-for-sql-server?view=sql-server-ver16:

> The ODBC driver comes with tools such as sqlcmd and bcp.

Does anyone know if BCP can be enabled with the MS ODBC drivers?

Thanks,

Seth



--
web:https://geographika.net
twitter: @geographika

From andrew at aitchison.me.uk  Wed Dec  7 09:12:23 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 7 Dec 2022 17:12:23 +0000 (GMT)
Subject: [gdal-dev] OGRFeatureDefn and clang -Wsign-conversion
Message-ID: <5183cae0-081a-23c0-9313-021bb098d813@aitchison.me.uk>


https://github.com/OSGeo/gdal/commit/b0797370a3ed238bc5e74435262c2e889f58fe03
adds two new classes GetFields() and GetGeomFields() for easier C++ iteration.

Unfortunately clang++ -Wsign-conversion is unhappy about the implicit
change of signedness in the size() functions of these classes:

clang++-15 -fPIC -std=c++11 -I/usr/local/gdal/git.llvm/include -g -O3
   -DFRMT_VRC -DVRC_STANDALONE -std=c++11 -Wsign-conversion -c -o VRC.o VRC.cpp
In file included from VRC.cpp:38:
In file included from ./VRC.h:56:
In file included from /usr/local/gdal/git.llvm/include/gdal_pam.h:36:
In file included from /usr/local/gdal/git.llvm/include/gdal_priv.h:81:
/usr/local/gdal/git.llvm/include/ogr_feature.h:336:56: warning: implicit
    conversion changes signedness: 'int' to 'size_t' (aka 'unsigned long')
    [-Wsign-conversion]
         inline size_t size() const { return m_poFDefn->GetFieldCount(); }
                                      ~~~~~~ ~~~~~~~~~~~^~~~~~~~~~~~~~~
/usr/local/gdal/git.llvm/include/ogr_feature.h:403:56: warning: implicit
    conversion changes signedness: 'int' to 'size_t' (aka 'unsigned long')
    [-Wsign-conversion]
         inline size_t size() const { return m_poFDefn->GetGeomFieldCount(); }
                                      ~~~~~~ ~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~
2 warnings generated.

The obvious static_cast seems to work but I am not sure
whether that is fixing the issue or just hiding it.

Draft pull request at
 	https://github.com/OSGeo/gdal/pull/6869

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From szekerest at gmail.com  Thu Dec  8 01:23:09 2022
From: szekerest at gmail.com (Tamas Szekeres)
Date: Thu, 8 Dec 2022 10:23:09 +0100
Subject: [gdal-dev] MSSQL Driver and Bulk Copy Drivers
In-Reply-To: <5761c019-354c-40c0-afa1-143d6675a560@app.fastmail.com>
References: <5761c019-354c-40c0-afa1-143d6675a560@app.fastmail.com>
Message-ID: <CACALY+QgKaaDQ4u9q7FpAUAJbooxgbUSziFjPD=YqaM2JtYMiA@mail.gmail.com>

Hi Seth,

The gdal nmake builds supports to build the mssql driver against MSODBC17,
by using these params in nmake.opt:

# Uncomment out the following to enable plugin with Microsoft ODBC Driver
17 for SQL Server support for MSSQL Bulk Copy.
#MSODBCSQL_VERSION = 17
#MSODBCSQL_DIR = C:\Program Files\Microsoft SQL Server\Client
SDK\ODBC\$(MSODBCSQL_VERSION)0\SDK
#MSODBCSQL_LIB =
"$(MSODBCSQL_DIR)\Lib\x86\msodbcsql$(MSODBCSQL_VERSION).lib"
#MSODBCSQL_INCLUDE = "-I$(MSODBCSQL_DIR)\Include"
-DMSODBCSQL_VERSION=$(MSODBCSQL_VERSION) -DMSSQL_BCP_SUPPORTED=1

I also think that the gisinternals builds have compiled the ODBC17 based
plugin earlier (looks like it is broken currently, I'll check that).

The recent cmake build can also be controlled in this regard by
the GDAL_USE_MSSQL_ODBC and GDAL_USE_MSSQL_NCLI parameters.

Best regards,

Tamas




Seth G <sethg at geographika.co.uk> ezt ?rta (id?pont: 2022. dec. 7., Sze,
15:21):

> Hi all,
>
> From the Microsoft docs at
> https://learn.microsoft.com/en-us/sql/relational-databases/native-client/applications/installing-sql-server-native-client?view=sql-server-ver16
> :
>
> > The SQL Server Native Client (often abbreviated SNAC) has been removed
> from SQL Server 2022 (16.x) and SQL Server Management Studio 19 (SSMS). The
> SQL Server Native Client (SQLNCLI or SQLNCLI11) and the legacy Microsoft
> OLE DB Provider for SQL Server (SQLOLEDB) are not recommended for new
> development. Switch to the new Microsoft OLE DB Driver (MSOLEDBSQL) for SQL
> Server or the latest Microsoft ODBC Driver for SQL Server going forward.
>
> So the native SQL Server driver will be retired, however the GDAL MSSQL
> Driver only supports bulk copy (BCP) with this driver and not the "ODBC
> Driver 17 for SQL Server" - the following error is returned:
>
> > ERROR 1: SQL Error SQLState=HY000, NativeError=0, Msg=[Microsoft][ODBC
> Driver 17 for SQL Server]Connection is not enabled for BCP
>
> According to
> https://learn.microsoft.com/en-us/sql/connect/odbc/microsoft-odbc-driver-for-sql-server?view=sql-server-ver16
> :
>
> > The ODBC driver comes with tools such as sqlcmd and bcp.
>
> Does anyone know if BCP can be enabled with the MS ODBC drivers?
>
> Thanks,
>
> Seth
>
>
>
> --
> web:https://geographika.net
> twitter: @geographika
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221208/7ebce85b/attachment.htm>

From jesse.r.meyer at nasa.gov  Thu Dec  8 10:07:00 2022
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Thu, 8 Dec 2022 18:07:00 +0000
Subject: [gdal-dev] SQL query to set column to GPKG raster pixel value of
 point intersection result
Message-ID: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>

Hi,

I have GPKG database with features represented by point geometries.  I?d like to update these features, in a single SQL statement, to add a new column whose value is the pixel value of an external GPKG raster for which the point geometry intersects with.  I was hoping to find an OGR SQL function similar to burn for this, but I?ve come up empty handed.

Is this functionality available? Ideally, without resorting to manually updating each feature individually in a user application.  Otherwise, perhaps a feature request is in order.

Thanks,
Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221208/4613a168/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Dec  8 12:44:59 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 8 Dec 2022 20:44:59 +0000
Subject: [gdal-dev] SQL query to set column to GPKG raster pixel value
 of point intersection result
In-Reply-To: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
References: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
Message-ID: <AM0PR09MB321961DC13AD42965244F71BFD1D9@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

It feels like quite special tool. Have you considered to use the Sample Raster Values tool in QGIS? The description of the tool is:

Sample raster values
This algorithm creates a new vector layer with the same attributes of the input layer and the raster values corresponding on the point location.
If the raster layer has more than one band, all the band values are sampled.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev
L?hetetty: torstai 8. joulukuuta 2022 20.07
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] SQL query to set column to GPKG raster pixel value of point intersection result

Hi,

I have GPKG database with features represented by point geometries.  I?d like to update these features, in a single SQL statement, to add a new column whose value is the pixel value of an external GPKG raster for which the point geometry intersects with.  I was hoping to find an OGR SQL function similar to burn for this, but I?ve come up empty handed.

Is this functionality available? Ideally, without resorting to manually updating each feature individually in a user application.  Otherwise, perhaps a feature request is in order.

Thanks,
Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221208/c29b5147/attachment.htm>

From lnicola at dend.ro  Thu Dec  8 12:48:38 2022
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 08 Dec 2022 22:48:38 +0200
Subject: [gdal-dev] SQL query to set column to GPKG raster pixel value
 of point intersection result
In-Reply-To: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
References: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
Message-ID: <28bccf39-a1a2-4bfb-8e2b-f95c413fec72@app.fastmail.com>

https://www.orfeo-toolbox.org/ has an app for something like this (SampleExtraction?), but I think it writes the values into a new file and last time I tried, it think it only worked with shapefiles did some reason.

Laurentiu

On Thu, Dec 8, 2022, at 20:07, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev wrote:
> Hi,
>  
> I have GPKG database with features represented by point geometries.  I?d like to update these features, in a single SQL statement, to add a new column whose value is the pixel value of an external GPKG raster for which the point geometry intersects with.  I was hoping to find an OGR SQL function similar to burn for this, but I?ve come up empty handed.
>  
> Is this functionality available? Ideally, without resorting to manually updating each feature individually in a user application.  Otherwise, perhaps a feature request is in order.
>  
> Thanks,
> Jesse
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221208/57aa95ad/attachment.htm>

From jesse.r.meyer at nasa.gov  Thu Dec  8 13:10:06 2022
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Thu, 8 Dec 2022 21:10:06 +0000
Subject: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG
 raster pixel value of point intersection result
In-Reply-To: <AM0PR09MB321961DC13AD42965244F71BFD1D9@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
 <AM0PR09MB321961DC13AD42965244F71BFD1D9@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <63FFE6AE-ABEA-4C37-BB01-9E2C70EA653D@nasa.gov>

Hi,

I want to perform this on tens of thousands of GPKG databases, each possessing upwards of millions of points, so automation (and performance) is a high value.  The hope was that given both data sources leverage the same driver, there was some hope of this working with the proper incantation, especially considering the library routines available by Spatialite in SQL queries.  But without something like burn available in a SQL query then this can?t work at the query level.  This is easy to write in C/C++ but wanted to see if the database engine could handle it directly.

Jesse

From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Date: Thursday, December 8, 2022 at 3:45 PM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>, "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: SQL query to set column to GPKG raster pixel value of point intersection result

Hi,

It feels like quite special tool. Have you considered to use the Sample Raster Values tool in QGIS? The description of the tool is:

Sample raster values
This algorithm creates a new vector layer with the same attributes of the input layer and the raster values corresponding on the point location.
If the raster layer has more than one band, all the band values are sampled.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev
L?hetetty: torstai 8. joulukuuta 2022 20.07
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] SQL query to set column to GPKG raster pixel value of point intersection result

Hi,

I have GPKG database with features represented by point geometries.  I?d like to update these features, in a single SQL statement, to add a new column whose value is the pixel value of an external GPKG raster for which the point geometry intersects with.  I was hoping to find an OGR SQL function similar to burn for this, but I?ve come up empty handed.

Is this functionality available? Ideally, without resorting to manually updating each feature individually in a user application.  Otherwise, perhaps a feature request is in order.

Thanks,
Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221208/a1e3e74e/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Dec  8 14:04:31 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 8 Dec 2022 23:04:31 +0100
Subject: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG
 raster pixel value of point intersection result
In-Reply-To: <63FFE6AE-ABEA-4C37-BB01-9E2C70EA653D@nasa.gov>
References: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
 <AM0PR09MB321961DC13AD42965244F71BFD1D9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <63FFE6AE-ABEA-4C37-BB01-9E2C70EA653D@nasa.gov>
Message-ID: <3b0a6723-da8c-da37-5dd0-a283cbfc40d1@spatialys.com>

Hi,

That sounds like a cool idea. I've had a crack at it in 
https://github.com/OSGeo/gdal/pull/6877

Even

Le 08/12/2022 ? 22:10, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND 
APPLICATIONS INC] via gdal-dev a ?crit?:
>
> Hi,
>
> I want to perform this on tens of thousands of GPKG databases, each 
> possessing upwards of millions of points, so automation (and 
> performance) is a high value.? The hope was that given both data 
> sources leverage the same driver, there was some hope of this working 
> with the proper incantation, especially considering the library 
> routines available by Spatialite in SQL queries.? But without 
> something like burn available in a SQL query then this can?t work at 
> the query level.? This is easy to write in C/C++ but wanted to see if 
> the database engine could handle it directly.
>
> Jesse
>
> *From: *Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Date: *Thursday, December 8, 2022 at 3:45 PM
> *To: *"Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS 
> INC]" <jesse.r.meyer at nasa.gov>, "gdal-dev at lists.osgeo.org" 
> <gdal-dev at lists.osgeo.org>
> *Subject: *[EXTERNAL] Re: SQL query to set column to GPKG raster pixel 
> value of point intersection result
>
> Hi,
>
> It feels like quite special tool. Have you considered to use the 
> Sample Raster Values tool in QGIS? The description of the tool is:
>
> Sample raster values
>
> This algorithm creates a new vector layer with the same attributes of 
> the input layer and the raster values corresponding on the point location.
>
> If the raster layer has more than one band, all the band values are 
> sampled.
>
> -Jukka Rahkonen-
>
> *L?hett?j?:*gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] 
> via gdal-dev
> *L?hetetty:* torstai 8. joulukuuta 2022 20.07
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] SQL query to set column to GPKG raster pixel value 
> of point intersection result
>
> Hi,
>
> I have GPKG database with features represented by point geometries.? 
> I?d like to update these features, in a single SQL statement, to add a 
> new column whose value is the pixel value of an external GPKG raster 
> for which the point geometry intersects with.? I was hoping to find an 
> OGR SQL function similar to burn for this, but I?ve come up empty handed.
>
> Is this functionality available? Ideally, without resorting to 
> manually updating each feature individually in a user application.? 
> Otherwise, perhaps a feature request is in order.
>
> Thanks,
>
> Jesse
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221208/b21f0755/attachment.htm>

From even.rouault at spatialys.com  Fri Dec  9 07:48:08 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 9 Dec 2022 16:48:08 +0100
Subject: [gdal-dev] libtiff v4.5.0 release candidate available
Message-ID: <dbf671b8-15bc-8e17-d768-a3d1fce0a59b@spatialys.com>

Hi,

I've prepared a release candidate for libtiff v4.5.0:

- https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz
- https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz.sig
- https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz
- https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz.sig
- https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip
- https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip.sig

Release notes at https://libtiff.gitlab.io/libtiff/releases/v4.5.0.html

I'll promote it to final next week if no serious blocking issues are 
reported.

Thanks to all contributors.

Best regards,

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From schwehr at gmail.com  Fri Dec  9 10:03:08 2022
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 9 Dec 2022 10:03:08 -0800
Subject: [gdal-dev] [Tiff] libtiff v4.5.0 release candidate available
In-Reply-To: <dbf671b8-15bc-8e17-d768-a3d1fce0a59b@spatialys.com>
References: <dbf671b8-15bc-8e17-d768-a3d1fce0a59b@spatialys.com>
Message-ID: <CACmBxyusF1uRgjm_i46vBH_C-JMypd5degpYmTKRtGGw0VLPNw@mail.gmail.com>

I'm a couple commits back from head and have no known issues.  I pull
directly via git head and use bazel for building, so I can't comment about
the tar / zip.

Specifically, I'm at
https://gitlab.com/libtiff/libtiff/-/commit/1bdbd03fbb4e7d662af052450259fcd353a49cc0
and working on updating my patches to the new formatting.

On Fri, Dec 9, 2022 at 7:48 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> I've prepared a release candidate for libtiff v4.5.0:
>
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip.sig
>
> Release notes at https://libtiff.gitlab.io/libtiff/releases/v4.5.0.html
>
> I'll promote it to final next week if no serious blocking issues are
> reported.
>
> Thanks to all contributors.
>
> Best regards,
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> Tiff mailing list
> Tiff at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/tiff
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221209/331c1f3c/attachment.htm>

From dg0yt at darc.de  Sat Dec 10 02:40:44 2022
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Sat, 10 Dec 2022 11:40:44 +0100
Subject: [gdal-dev] libtiff v4.5.0 release candidate available
In-Reply-To: <dbf671b8-15bc-8e17-d768-a3d1fce0a59b@spatialys.com>
References: <dbf671b8-15bc-8e17-d768-a3d1fce0a59b@spatialys.com>
Message-ID: <8a73757f-4c70-0a0b-79a0-7f31231df1ce@darc.de>

Thanks for your work!

There is an issue with tiff_vers.h:
The new linebreak style of the TIFF_VERSION_STR definition breaks 
version detection in CMake's FindTIFF.cmake,
leaving TIFF_VERSION unset (in CMake). Some packages rely on this 
variable. E.g. openimageio in vcpkg:

-- Found TIFF
CMake Error at src/cmake/checked_find_package.cmake:154 (if):
 ? if given arguments:

 ??? "VERSION_LESS" "4.0"

 ? Unknown arguments specified
Call Stack (most recent call first):
 ? src/cmake/externalpackages.cmake:90 (checked_find_package)
 ? CMakeLists.txt:141 (include)


which probably comes from some

if(${TIFF_VERSION} VERSION_LESS "4.0")

I would suggest to restore a formatting which doesn't break existing 
CMake code.

Regards, Kai

Am 09.12.22 um 16:48 schrieb Even Rouault:
> Hi,
>
> I've prepared a release candidate for libtiff v4.5.0:
>
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip.sig
>
> Release notes at https://libtiff.gitlab.io/libtiff/releases/v4.5.0.html
>
> I'll promote it to final next week if no serious blocking issues are 
> reported.
>
> Thanks to all contributors.
>
> Best regards,
>


From cliveswan at gmail.com  Sat Dec 10 05:19:40 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Sat, 10 Dec 2022 13:19:40 -0000
Subject: [gdal-dev] Odd error
Message-ID: <000001d90c9a$0fb271f0$2f1755d0$@gmail.com>

I have been using the security details for weeks, now getting an odd error.

 

Getting an odd error??

I have been using the same:

AWS_ACCESS_KEY_ID

AWS_SECRET_ACCESS_KEY

 

ERROR 4: Attempt to create new tiff file `/vsis3/summer-outputs/1/coastal-
-2020.tif' failed: Permission denied

Input file size is 450000, 225000

ERROR 13: The specified key does not exist << ??

 

### Script below

#!/bin/bash

 LOG_FILE=/home/ubuntu/run_translate.log

 exec 1>>${LOG_FILE}

exec 2>>${LOG_FILE}

 ## 5_UK_prod_rasters >> 3_data_ready_for_spectra

 

gdal_translate /vsis3/summer-outputs /1/coastal -2020.vrt /vsis3/
summer-outputs /2/coastal -2020.tif -co BIGTIFF=YES  -co
NUM_THREADS=ALL_CPUS --config GDAL_CACHEMAX 100000 --config CPL_TMPDIR
/data/tmp --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config
AWS_ACCESS_KEY_ID KEY_ID --config AWS_SECRET_ACCESS_KEY ACCESS_KEY

echo end script

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221210/fe25a8bd/attachment.htm>

From even.rouault at spatialys.com  Sat Dec 10 05:29:10 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 10 Dec 2022 14:29:10 +0100
Subject: [gdal-dev] libtiff v4.5.0 release candidate available
In-Reply-To: <8a73757f-4c70-0a0b-79a0-7f31231df1ce@darc.de>
References: <dbf671b8-15bc-8e17-d768-a3d1fce0a59b@spatialys.com>
 <8a73757f-4c70-0a0b-79a0-7f31231df1ce@darc.de>
Message-ID: <5f876c60-9e61-fc09-ade0-5db9448ad85b@spatialys.com>

Hi,

annoying that FindTIFF.cmake is so formatting sensitive, but I've 
reverted the reformatting of that file in 
https://gitlab.com/libtiff/libtiff/-/merge_requests/434

I've also added long overdue TIFFLIB_MAJOR_VERSION, 
TIFFLIB_MINOR_VERSION, TIFFLIB_MICRO_VERSION defines

Even

Le 10/12/2022 ? 11:40, Kai Pastor, DG0YT a ?crit?:
> Thanks for your work!
>
> There is an issue with tiff_vers.h:
> The new linebreak style of the TIFF_VERSION_STR definition breaks 
> version detection in CMake's FindTIFF.cmake,
> leaving TIFF_VERSION unset (in CMake). Some packages rely on this 
> variable. E.g. openimageio in vcpkg:
>
> -- Found TIFF
> CMake Error at src/cmake/checked_find_package.cmake:154 (if):
> ? if given arguments:
>
> ??? "VERSION_LESS" "4.0"
>
> ? Unknown arguments specified
> Call Stack (most recent call first):
> ? src/cmake/externalpackages.cmake:90 (checked_find_package)
> ? CMakeLists.txt:141 (include)
>
>
> which probably comes from some
>
> if(${TIFF_VERSION} VERSION_LESS "4.0")
>
> I would suggest to restore a formatting which doesn't break existing 
> CMake code.
>
> Regards, Kai
>
> Am 09.12.22 um 16:48 schrieb Even Rouault:
>> Hi,
>>
>> I've prepared a release candidate for libtiff v4.5.0:
>>
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz.sig
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz.sig
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip.sig
>>
>> Release notes at https://libtiff.gitlab.io/libtiff/releases/v4.5.0.html
>>
>> I'll promote it to final next week if no serious blocking issues are 
>> reported.
>>
>> Thanks to all contributors.
>>
>> Best regards,
>>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From ccrook at linz.govt.nz  Sat Dec 10 11:06:26 2022
From: ccrook at linz.govt.nz (Chris Crook)
Date: Sat, 10 Dec 2022 19:06:26 +0000
Subject: [gdal-dev] GDAL python API - Data axis to CRS axis mapping
Message-ID: <SY4PR01MB6553744DED879988E61067EBEC1F9@SY4PR01MB6553.ausprd01.prod.outlook.com>

Hi

I am using the GDAL python API and trying to determine the data axis to CRS axis mapping.  This is displayed by gdalinfo, eg looking at test.tif file I have:

Data axis to CRS axis mapping: 2,1

However I can't see how to access this in the API.  I have looked at the tolatlong.py sample, and but this looks like it is about converting projections, which I think is a different thing.  What I am looking for is the correct mapping from the lat/lon order generated by the geotransform to the order defined by the CRS WKT.

Can anyone advise on how to best access this mapping?

Thanks
Chris Crook


________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221210/7d93911d/attachment-0001.htm>

From even.rouault at spatialys.com  Sat Dec 10 11:55:03 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 10 Dec 2022 20:55:03 +0100
Subject: [gdal-dev] GDAL python API - Data axis to CRS axis mapping
In-Reply-To: <SY4PR01MB6553744DED879988E61067EBEC1F9@SY4PR01MB6553.ausprd01.prod.outlook.com>
References: <SY4PR01MB6553744DED879988E61067EBEC1F9@SY4PR01MB6553.ausprd01.prod.outlook.com>
Message-ID: <69960474-dd75-0066-f00e-c419eb34601d@spatialys.com>

Hi Chris,

==> 
https://gdal.org/api/python/osgeo.osr.html#osgeo.osr.SpatialReference.GetDataAxisToSRSAxisMapping

Doc: 
https://gdal.org/api/ogrspatialref.html#_CPPv4NK19OGRSpatialReference27GetDataAxisToSRSAxisMappingEv

Example at 
https://github.com/OSGeo/gdal/blob/9452625baa544ea3ab6bb0b3e368023434011ea7/autotest/gcore/vrt_read.py#L1339

Even

Le 10/12/2022 ? 20:06, Chris Crook a ?crit?:
> Hi
>
> I am using the GDAL python API and trying to determine the data axis 
> to CRS axis mapping.? This is displayed by gdalinfo, eg looking at 
> test.tif file I have:
>
> Data axis to CRS axis mapping: 2,1
>
> However I can't see how to access this in the API.? I have looked at 
> the tolatlong.py sample, and but this looks like it is about 
> converting projections, which I think is a different thing.? What I am 
> looking for is the correct mapping from the lat/lon order generated by 
> the geotransform to the order defined by the CRS WKT.
>
> Can anyone advise on how to best access this mapping?
>
> Thanks
> Chris Crook
>
>
> ------------------------------------------------------------------------
>
> This message contains information, which may be in confidence and may 
> be subject to legal privilege. If you are not the intended recipient, 
> you must not peruse, use, disseminate, distribute or copy this 
> message. If you have received this message in error, please notify us 
> immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the 
> original message. LINZ accepts no responsibility for changes to this 
> email, or for any attachments, after its transmission from LINZ. Thank 
> You.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221210/73e6b7f8/attachment.htm>

From dg0yt at darc.de  Sun Dec 11 02:42:27 2022
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Sun, 11 Dec 2022 11:42:27 +0100
Subject: [gdal-dev] libtiff v4.5.0 release candidate available
In-Reply-To: <5f876c60-9e61-fc09-ade0-5db9448ad85b@spatialys.com>
References: <dbf671b8-15bc-8e17-d768-a3d1fce0a59b@spatialys.com>
 <8a73757f-4c70-0a0b-79a0-7f31231df1ce@darc.de>
 <5f876c60-9e61-fc09-ade0-5db9448ad85b@spatialys.com>
Message-ID: <50cd0351-4cf6-7a62-79e5-309ddfe5836e@darc.de>

It is probably the best and cheapest what they could do with introspection.

The ultimate way out is to export CMake config in a compatible way so 
that *future* versions of FindTIFF.cmake can use it. (This is already 
done for CURL.) As a positive side-effect, this helps to properly carry 
transitive usage requirements for static linkage and to deal with 
multi-config generators.

Kai

Am 10.12.22 um 14:29 schrieb Even Rouault:
> Hi,
>
> annoying that FindTIFF.cmake is so formatting sensitive, but I've 
> reverted the reformatting of that file in 
> https://gitlab.com/libtiff/libtiff/-/merge_requests/434
>
> I've also added long overdue TIFFLIB_MAJOR_VERSION, 
> TIFFLIB_MINOR_VERSION, TIFFLIB_MICRO_VERSION defines
>
> Even
>
> Le 10/12/2022 ? 11:40, Kai Pastor, DG0YT a ?crit?:
>> Thanks for your work!
>>
>> There is an issue with tiff_vers.h:
>> The new linebreak style of the TIFF_VERSION_STR definition breaks 
>> version detection in CMake's FindTIFF.cmake,
>> leaving TIFF_VERSION unset (in CMake). Some packages rely on this 
>> variable. E.g. openimageio in vcpkg:
>>
>> -- Found TIFF
>> CMake Error at src/cmake/checked_find_package.cmake:154 (if):
>> ? if given arguments:
>>
>> ??? "VERSION_LESS" "4.0"
>>
>> ? Unknown arguments specified
>> Call Stack (most recent call first):
>> ? src/cmake/externalpackages.cmake:90 (checked_find_package)
>> ? CMakeLists.txt:141 (include)
>>
>>
>> which probably comes from some
>>
>> if(${TIFF_VERSION} VERSION_LESS "4.0")
>>
>> I would suggest to restore a formatting which doesn't break existing 
>> CMake code.
>>
>> Regards, Kai
>>
>> Am 09.12.22 um 16:48 schrieb Even Rouault:
>>> Hi,
>>>
>>> I've prepared a release candidate for libtiff v4.5.0:
>>>
>>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz
>>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.gz.sig
>>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz
>>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.tar.xz.sig
>>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip
>>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc1.zip.sig
>>>
>>> Release notes at https://libtiff.gitlab.io/libtiff/releases/v4.5.0.html
>>>
>>> I'll promote it to final next week if no serious blocking issues are 
>>> reported.
>>>
>>> Thanks to all contributors.
>>>
>>> Best regards,
>>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


From even.rouault at spatialys.com  Sun Dec 11 13:58:14 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 11 Dec 2022 22:58:14 +0100
Subject: [gdal-dev] Trouble using TEMPORARY=ON with ogr2ogr
In-Reply-To: <CAO8qHHGKVmgVGVjr63Pi9R7E5jC7pgHe-QirFbRiRcgj9nsM_g@mail.gmail.com>
References: <CAO8qHHGKVmgVGVjr63Pi9R7E5jC7pgHe-QirFbRiRcgj9nsM_g@mail.gmail.com>
Message-ID: <c2978771-64c7-5dc8-63d9-2c6ce7632902@spatialys.com>

FYI Jeremy Palmer has just submitted a fix for that: 
https://github.com/OSGeo/gdal/pull/6896

Le 30/11/2022 ? 16:12, Daniel Mannarino a ?crit?:
>
> Hello!
>
>
> I'm having trouble using the temporary table option of 
> ogr2ogr:https://gdal.org/drivers/vector/pg.html#layer-creation-options
>
> Ultimately I am trying to load data from a Shapefile into a temporary 
> table, enrich the rows in the temporary table, and then copy from the 
> temporary table into a final table. However I cannot get Postgres and 
> ogr2ogr to work together. It sounds to me from the logs that they 
> disagree on the table name. In my example code below I have removed 
> everything that is to happen after loading the data (enriching, 
> copying) for clarity.
>
>
> Very little is said about the temporary table option on the web, but 
> from the source (and Postgres logs) it looks like ogr2ogr assumes a 
> schema of 
> "pg_temp_1":https://github.com/OSGeo/gdal/blob/dc39f7d68095621842a2547ab06c60a03fd34a19/ogr/ogrsf_frmts/pg/ogrpgdatasource.cpp#L1865-L1872
>
>
> It sounds to me from the Postgres docs this isn't safe to assume, but 
> let's say it is for the moment.
>
>
> Here is my simplified script:
>
> #!/bin/bash
>
> set -e
>
>
> PGHOST="<host>"
>
> PGDATABASE="<db>"
>
> PGUSER="<user>"
>
> PGPASSWORD="<pass>"
>
> PGPORT=<port>
>
>
> LOCAL_FILE="/vsizip/test.shp.zip"
>
> SRC_LAYER="test"
>
> FID_NAME="gfw_fid"
>
> GEOMETRY_NAME="geom"
>
> TEMP_SCHEMA="pg_temp_1"
>
> TEMP_TABLE="bazinga"
>
>
>
> ogr2ogr -f "PostgreSQL" PG:"password=$PGPASSWORD host=$PGHOST 
> port=$PGPORT dbname=$PGDATABASE user=$PGUSER" \
>
> "$LOCAL_FILE" "$SRC_LAYER" \
>
> -lco GEOMETRY_NAME="$GEOMETRY_NAME" \
>
> -lco SPATIAL_INDEX=NONE \
>
> -lco FID="$FID_NAME" \
>
> -lco TEMPORARY=ON \
>
> -nlt PROMOTE_TO_MULTI \
>
> -nln "$TEMP_SCHEMA.$TEMP_TABLE" \
>
> ???-t_srs EPSG:4326 \
>
> --config PG_USE_COPY YES \
>
> -makevalid -update
>
>
> # End of script
>
>
>
> Here is the Postgres log from attempting to run this script with the 
> Shapefile in the PS:
>
>
> # START LOG
>
> 2022-11-28 21:16:51.206 UTC [504] LOG:? statement: set client_encoding 
> to 'UTF8'
>
> 2022-11-28 21:16:51.209 UTC [504] LOG:? execute <unnamed>: SHOW 
> client_encoding
>
> 2022-11-28 21:16:51.239 UTC [504] LOG:? execute <unnamed>: SELECT 
> n.nspname FROM pg_proc p JOIN pg_namespace n ON n.oid = p.pronamespace 
> WHERE proname = 'postgis_version'
>
> 2022-11-28 21:16:51.245 UTC [504] LOG:? execute <unnamed>: SELECT 
> version()
>
> 2022-11-28 21:16:51.246 UTC [504] LOG:? execute <unnamed>: SHOW 
> standard_conforming_strings
>
> 2022-11-28 21:16:51.250 UTC [504] LOG:? execute <unnamed>: SELECT oid, 
> typname FROM pg_type WHERE typname IN ('geometry', 'geography') AND 
> typtype='b'
>
> 2022-11-28 21:16:51.323 UTC [504] LOG:? execute <unnamed>: SELECT 
> postgis_version()
>
> 2022-11-28 21:16:51.326 UTC [504] LOG:? execute <unnamed>: SET 
> ENABLE_SEQSCAN = ON
>
> 2022-11-28 21:16:51.342 UTC [504] LOG:? execute <unnamed>: SELECT 1 
> FROM information_schema.tables WHERE table_name = 'geometry_columns' 
> LIMIT 1
>
> 2022-11-28 21:16:51.345 UTC [504] LOG:? execute <unnamed>: SELECT 1 
> FROM information_schema.tables WHERE table_name = 'spatial_ref_sys' 
> LIMIT 1
>
> 2022-11-28 21:16:51.354 UTC [504] LOG:? execute <unnamed>: SELECT 
> ST_Srid('POINT EMPTY'::GEOMETRY)
>
> 2022-11-28 21:16:51.356 UTC [504] LOG:? execute <unnamed>: SELECT 
> current_schema()
>
> 2022-11-28 21:16:51.394 UTC [504] LOG:? execute <unnamed>: BEGIN
>
> 2022-11-28 21:16:51.415 UTC [504] LOG:? execute <unnamed>: SELECT 
> c.oid FROM pg_class c JOIN pg_namespace n ON c.relnamespace=n.oid 
> WHERE c.relname = 'bazinga' AND n.nspname = 'pg_temp_1'
>
> 2022-11-28 21:16:51.418 UTC [504] LOG:? execute <unnamed>: SELECT 
> c.oid FROM pg_class c JOIN pg_namespace n ON c.relnamespace=n.oid 
> WHERE c.relname = 'bazinga' AND n.nspname = 'pg_temp_1'
>
> 2022-11-28 21:16:51.439 UTC [504] LOG:? execute <unnamed>: SELECT 
> c.relname, n.nspname, c.relkind, a.attname, t.typname, 
> postgis_typmod_dims(a.atttypmod) dim, postgis_typmod_srid(a.atttypmod) 
> srid, postgis_typmod_type(a.atttypmod)::text geomtyp, 
> array_agg(pg_get_constraintdef(s.oid))::text att_constraints, 
> a.attnotnull, d.description FROM pg_class c JOIN pg_attribute a ON 
> a.attrelid=c.oid JOIN pg_namespace n ON c.relnamespace = n.oid AND 
> c.relkind in ('r','v','m','f') AND NOT ( n.nspname = 'public' AND 
> c.relname = 'raster_columns' ) JOIN pg_type t ON a.atttypid = t.oid 
> AND (t.typname = 'geometry'::name OR t.typname = 'geography'::name) 
> LEFT JOIN pg_constraint s ON s.connamespace = n.oid AND s.conrelid = 
> c.oid AND a.attnum = ANY (s.conkey) AND (pg_get_constraintdef(s.oid) 
> LIKE '%geometrytype(% = %' OR pg_get_constraintdef(s.oid) LIKE 
> '%ndims(% = %' OR pg_get_constraintdef(s.oid) LIKE '%srid(% = %') LEFT 
> JOIN pg_description d ON d.objoid = c.oid AND d.classoid = 
> 'pg_class'::regclass::oid AND d.objsubid = 0 GROUP BY c.relname, 
> n.nspname, c.relkind, a.attname, t.typname, dim, srid, geomtyp, 
> a.attnotnull, c.oid, a.attnum, d.description ORDER BY c.oid, a.attnum
>
> 2022-11-28 21:16:51.452 UTC [504] LOG:? execute <unnamed>: SELECT srid 
> FROM spatial_ref_sys WHERE auth_name = 'EPSG' AND auth_srid = 4326
>
> 2022-11-28 21:16:51.545 UTC [504] LOG:? execute <unnamed>: CREATE 
> TEMPORARY TABLE "bazinga" ( "gfw_fid" SERIAL, PRIMARY KEY ("gfw_fid"), 
> "fid" NUMERIC(11,0), "geom" geometry(MULTIPOLYGON,4326) )
>
> 2022-11-28 21:16:51.575 UTC [504] LOG:? execute <unnamed>: COMMENT ON 
> TABLE "pg_temp_1"."bazinga" IS NULL
>
> 2022-11-28 21:16:51.575 UTC [504] ERROR:? relation "pg_temp_1.bazinga" 
> does not exist
>
> 2022-11-28 21:16:51.575 UTC [504] STATEMENT:? COMMENT ON TABLE 
> "pg_temp_1"."bazinga" IS NULL
>
> 2022-11-28 21:16:51.585 UTC [504] ERROR:? current transaction is 
> aborted, commands ignored until end of transaction block
>
> 2022-11-28 21:16:51.585 UTC [504] STATEMENT:? COPY 
> "pg_temp_1"."bazinga" ("geom", "fid") FROM STDIN;
>
> 2022-11-28 21:16:51.587 UTC [504] LOG:? execute <unnamed>: ROLLBACK
>
>
> # END LOG
>
>
>
> I have tried many variations of quoting the table and schema name to 
> no avail (including
>
> -nln "\"$TEMP_SCHEMA\".\"$TEMP_TABLE\"" \
>
> ).
>
>
> I also tried wrapping the whole thing in a transaction by specifying
>
> -doo PRELUDE_STATEMENTS="BEGIN;" \
>
> -doo CLOSING_STATEMENTS="COMMIT;" \
>
>
> Can anyone explain how to get this to work? I actually first tried to 
> create a temporary table by myself with -doo, but ran into other 
> problems and will leave that for another thread.
>
>
> Thanks!
>
> Daniel Mannarino
>
>
> PS: Here's the Shapefile I'm 
> using:https://github.com/wri/gfw-data-api/blob/master/tests/fixtures/test.shp.zip
>
> PPS: I am running PostgreSQL 12 (specifically the 
> postgis/postgis:12-2.5-alpine Docker image) and running ogr2ogr from 
> Homebrew's GDAL 3.5.3 package on MacOS 12.6 (amd64).
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221211/e81eadbd/attachment.htm>

From cliveswan at gmail.com  Mon Dec 12 01:33:55 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 12 Dec 2022 09:33:55 +0000
Subject: [gdal-dev] ERROR 13: The specified key does not exist
Message-ID: <CA+kQ3mtfttB_hEzhpa48-JoNFfa7gV4YB4fNKYSUL+XhRUNxiA@mail.gmail.com>

Greetings,

I have been using the security details for weeks, now getting an odd error.
AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
*ERROR 4:* Attempt to create new tiff file `/vsis3/summer-outputs/3/coastal-
-2020.tif' failed: Permission denied
Input file size is 450000, 225000*ERROR 13*: The specified key does
not exist *<< ??*
*### Script below*
#!/bin/bash

LOG_FILE=/home/ubuntu/run_translate.log

exec 1>>${LOG_FILE}
exec 2>>${LOG_FILE}

## 5_UK_rasters >> 3_data_ready

gdal_translate /vsis3/summer-outputs/5/coastal-2020.vrt /vsis3/
summer-outputs/3/coastal-2020.tif -co BIGTIFF=YES  -co
NUM_THREADS=ALL_CPUS --config GDAL_CACHEMAX 100000 --config CPL_TMPDIR
/data/tmp --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
--config AWS_ACCESS_KEY_ID KEY_ID --config AWS_SECRET_ACCESS_KEY
ACCESS_KEY
echo end script

-- 

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/13c88ee2/attachment-0001.htm>

From cliveswan at gmail.com  Mon Dec 12 02:41:17 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 12 Dec 2022 10:41:17 +0000
Subject: [gdal-dev] ERROR 13: The specified key does not exist
Message-ID: <CA+kQ3msqh8AHK47vvs2SpAGsaFs29npMkRm8-1mhO8tbusat3A@mail.gmail.com>

I deleted all the vrt files, in case the error was related to the
bucket/key relationship.

The AWS key has not been updated.

I reran the script again, I am still getting a permissions error??

*ERROR 4:* Attempt to create new tiff file
`/vsis3/summer-outputs/5/coastal.tif' failed: Permission denied
Input file size is 450000, 225000
rcp26-2030
0...10...20...30...40...50...60...70...80...90...100 - done.
*ERROR 13:* The specified key does not exist.
rcp26-2040



*Clive Swan*
    cliveswan at gmail.com
        <gdal-dev%40lists.osgeo.org?Subject=Re%3A%20%5Bgdal-dev%5D%20ERROR%2013%3A%20The%20specified%20key%20does%20not%20exist&In-Reply-To=%3CCA%2BkQ3mtfttB_hEzhpa48-JoNFfa7gV4YB4fNKYSUL%2BXhRUNxiA%40mail.gmail.com%3E>

    *Mon Dec 12 01:33:55 PST 2022*
Greetings,

I have been using the security details for weeks, now getting an odd error.
AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
*ERROR 4:* Attempt to create new tiff file `/vsis3/summer-outputs/3/coastal-
-2020.tif' failed: Permission denied
Input file size is 450000, 225000*ERROR 13*: The specified key does
not exist *<< ??*
*### Script below*
#!/bin/bash

LOG_FILE=/home/ubuntu/run_translate.log

exec 1>>${LOG_FILE}
exec 2>>${LOG_FILE}

## 5_UK_rasters >> 3_data_ready

gdal_translate /vsis3/summer-outputs/5/coastal-2020.vrt /vsis3/
summer-outputs/3/coastal-2020.tif -co BIGTIFF=YES  -co
NUM_THREADS=ALL_CPUS --config GDAL_CACHEMAX 100000 --config CPL_TMPDIR
/data/tmp --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
--config AWS_ACCESS_KEY_ID KEY_ID --config AWS_SECRET_ACCESS_KEY
ACCESS_KEY
echo end script

-- 

 Regards,


Clive Swan




-- 

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/4c28c03f/attachment.htm>

From cliveswan at gmail.com  Mon Dec 12 03:05:49 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 12 Dec 2022 11:05:49 +0000
Subject: [gdal-dev] ERROR 13: The specified key does not exist
Message-ID: <CA+kQ3mvuH++fkRQ4k2oNM_btvA9mS2WB389MKxU6K3kL7LeMPA@mail.gmail.com>

I reran the gdal_translate command using tif, not the .vrt. Now I get*
ERROR: *too many commands

I need to specify
-co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co
NUM_THREADS=ALL_CPUS --config GDAL_CACHEMAX 100000 --config CPL_TMPDIR
/data/tmp --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES


Any suggestions how I can implement the commands required??

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/772e4e5d/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 12 03:09:06 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 12 Dec 2022 11:09:06 +0000
Subject: [gdal-dev] ERROR 13: The specified key does not exist
In-Reply-To: <CA+kQ3mvuH++fkRQ4k2oNM_btvA9mS2WB389MKxU6K3kL7LeMPA@mail.gmail.com>
References: <CA+kQ3mvuH++fkRQ4k2oNM_btvA9mS2WB389MKxU6K3kL7LeMPA@mail.gmail.com>
Message-ID: <AM0PR09MB3219673CD9727F387762CDB1FDE29@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Please show the whole command that you used. That way it is much easier to find out the error in your syntax.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clive Swan
L?hetetty: maanantai 12. joulukuuta 2022 13.06
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ERROR 13: The specified key does not exist

I reran the gdal_translate command using tif, not the .vrt. Now I get ERROR: too many commands

I need to specify
-co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config GDAL_CACHEMAX 100000 --config CPL_TMPDIR /data/tmp --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES

Any suggestions how I can implement the commands required??

 Regards,



Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/6f26eaa8/attachment.htm>

From elpaso at itopen.it  Mon Dec 12 06:10:44 2022
From: elpaso at itopen.it (ElPaso)
Date: Mon, 12 Dec 2022 15:10:44 +0100
Subject: [gdal-dev] Motion: adopt RFC89: SQL query logging callback
Message-ID: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>

Hi,

Motion:

Adopt? RFC89: SQL query logging callback [1]

A draft implementation is available at [2].

An example of how client code could make use of this new functionality 
is avaiable for QGIS at [3].

Kind regards.


[1] https://github.com/OSGeo/gdal/pull/6837

[2] 
https://github.com/elpaso/gdal/tree/rfc89_sql_logging_callback_implementation

[3] https://github.com/elpaso/QGIS/tree/ogrprovider-sql-logging


-- 
Alessandro Pasotti
w3: www.itopen.it


From cliveswan at gmail.com  Mon Dec 12 06:24:42 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 12 Dec 2022 14:24:42 +0000
Subject: [gdal-dev] ERROR 13: The specified key does not exist
In-Reply-To: <86925cd6-951d-aea4-2fc2-6bc87929d694@aitchison.me.uk>
References: <CA+kQ3mtfttB_hEzhpa48-JoNFfa7gV4YB4fNKYSUL+XhRUNxiA@mail.gmail.com>
 <86925cd6-951d-aea4-2fc2-6bc87929d694@aitchison.me.uk>
Message-ID: <CA+kQ3mt4HfkEpWT3PFXLLfcYCaLGW+Aci4ox28HgqQOXejtH9A@mail.gmail.com>

Greetings,

The problem was writing directly from one AWS instance to another.
I have to write to the local instance, than copy to the other instance.

Thanks
Clive

On Mon, 12 Dec 2022 at 09:57, Andrew C Aitchison <andrew at aitchison.me.uk>
wrote:

> On Mon, 12 Dec 2022, Clive Swan wrote:
>
> > Greetings,
> >
> > I have been using the security details for weeks, now getting an odd
> error.
> > AWS_ACCESS_KEY_ID
> > AWS_SECRET_ACCESS_KEY
> > *ERROR 4:* Attempt to create new tiff file
> `/vsis3/summer-outputs/3/coastal-
> > -2020.tif' failed: Permission denied
> > Input file size is 450000, 225000*ERROR 13*: The specified key does
> > not exist *<< ??*
>
> Does it really say coastal--2020.tif with two dashes ?
>
> > *### Script below*
> > #!/bin/bash
> >
> > LOG_FILE=/home/ubuntu/run_translate.log
> >
> > exec 1>>${LOG_FILE}
> > exec 2>>${LOG_FILE}
> >
> > ## 5_UK_rasters >> 3_data_ready
> >
> > gdal_translate /vsis3/summer-outputs/5/coastal-2020.vrt /vsis3/
> > summer-outputs/3/coastal-2020.tif -co BIGTIFF=YES  -co
> > NUM_THREADS=ALL_CPUS --config GDAL_CACHEMAX 100000 --config CPL_TMPDIR
> > /data/tmp --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
> > --config AWS_ACCESS_KEY_ID KEY_ID --config AWS_SECRET_ACCESS_KEY
> > ACCESS_KEY
> > echo end script
>
> --
> Andrew C. Aitchison                      Kendal, UK
>                     andrew at aitchison.me.uk
>


-- 

 Regards,


Clive Swan

--


M: +44 7766 452665
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/22e92ebc/attachment.htm>

From michael.smith.erdc at gmail.com  Mon Dec 12 06:29:09 2022
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Mon, 12 Dec 2022 09:29:09 -0500
Subject: [gdal-dev] ERROR 13: The specified key does not exist
In-Reply-To: <CA+kQ3mt4HfkEpWT3PFXLLfcYCaLGW+Aci4ox28HgqQOXejtH9A@mail.gmail.com>
References: <CA+kQ3mtfttB_hEzhpa48-JoNFfa7gV4YB4fNKYSUL+XhRUNxiA@mail.gmail.com>
 <86925cd6-951d-aea4-2fc2-6bc87929d694@aitchison.me.uk>
 <CA+kQ3mt4HfkEpWT3PFXLLfcYCaLGW+Aci4ox28HgqQOXejtH9A@mail.gmail.com>
Message-ID: <AED4C334-23EB-427B-91E1-7FC403766A7C@gmail.com>

Clive,

 

A solution to this is to use a GDAL configuration file that will allow you to set per path options for your authentication, allowing you to use one set of credentials for read and one for write. See https://gdal.org/user/configoptions.html#gdal-configuration-file

 

Starting with GDAL 3.5, a configuration file can also contain credentials (or more generally options related to a virtual file system) for a given path prefix, that can also be set with VSISetPathSpecificOption(). Credentials should be put under a [credentials] section, and for each path prefix, under a relative subsection whose name starts with ?[.? (e.g. ?[.some_arbitrary_name]?), and whose first key is ?path?.

 

Mike

 

 

-- 

Michael Smith

US Army Corps of Engineers

Remote Sensing/GIS Center

 

 

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Clive Swan <cliveswan at gmail.com>
Date: Monday, December 12, 2022 at 9:24 AM
To: Andrew C Aitchison <andrew at aitchison.me.uk>, <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] ERROR 13: The specified key does not exist

 

Greetings,

The problem was writing directly from one AWS instance to another.

I have to write to the local instance, than copy to the other instance.

Thanks

Clive

 

On Mon, 12 Dec 2022 at 09:57, Andrew C Aitchison <andrew at aitchison.me.uk> wrote:

On Mon, 12 Dec 2022, Clive Swan wrote:

> Greetings,
>
> I have been using the security details for weeks, now getting an odd error.
> AWS_ACCESS_KEY_ID
> AWS_SECRET_ACCESS_KEY
> *ERROR 4:* Attempt to create new tiff file `/vsis3/summer-outputs/3/coastal-
> -2020.tif' failed: Permission denied
> Input file size is 450000, 225000*ERROR 13*: The specified key does
> not exist *<< ??*

Does it really say coastal--2020.tif with two dashes ?

> *### Script below*
> #!/bin/bash
>
> LOG_FILE=/home/ubuntu/run_translate.log
>
> exec 1>>${LOG_FILE}
> exec 2>>${LOG_FILE}
>
> ## 5_UK_rasters >> 3_data_ready
>
> gdal_translate /vsis3/summer-outputs/5/coastal-2020.vrt /vsis3/
> summer-outputs/3/coastal-2020.tif -co BIGTIFF=YES  -co
> NUM_THREADS=ALL_CPUS --config GDAL_CACHEMAX 100000 --config CPL_TMPDIR
> /data/tmp --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
> --config AWS_ACCESS_KEY_ID KEY_ID --config AWS_SECRET_ACCESS_KEY
> ACCESS_KEY
> echo end script

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk



-- 

 Regards,

 

Clive Swan

--

 

M: +44 7766 452665

_______________________________________________ gdal-dev mailing list gdal-dev at lists.osgeo.org https://lists.osgeo.org/mailman/listinfo/gdal-dev 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/018381b8/attachment.htm>

From jesse.r.meyer at nasa.gov  Mon Dec 12 06:44:13 2022
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Mon, 12 Dec 2022 14:44:13 +0000
Subject: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG
 raster pixel value of point intersection result
In-Reply-To: <3b0a6723-da8c-da37-5dd0-a283cbfc40d1@spatialys.com>
References: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
 <AM0PR09MB321961DC13AD42965244F71BFD1D9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <63FFE6AE-ABEA-4C37-BB01-9E2C70EA653D@nasa.gov>
 <3b0a6723-da8c-da37-5dd0-a283cbfc40d1@spatialys.com>
Message-ID: <8A4C5860-96FD-42C0-8E22-7FA9419F7B00@nasa.gov>

Thanks Even, this looks good!

In my case, then the SQL query should resemble something like `select gdal_get_layer_pixel_value('byte', 1, 'georef', ST_X(geom), ST_Y(geom))`

Where `geom` is a centroid.

From: Even Rouault <even.rouault at spatialys.com>
Date: Thursday, December 8, 2022 at 5:04 PM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>, "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG raster pixel value of point intersection result


Hi,

That sounds like a cool idea. I've had a crack at it in https://github.com/OSGeo/gdal/pull/6877<https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fpull%2F6877&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7Ce52283f9b35c4682a24208dad96832a9%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638061338794913140%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=pqdL0v9DqEOSPHY5vK0U0uiDaLktk521Oe9d3zGQ8Tc%3D&reserved=0>

Even
Le 08/12/2022 ? 22:10, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev a ?crit :
Hi,

I want to perform this on tens of thousands of GPKG databases, each possessing upwards of millions of points, so automation (and performance) is a high value.  The hope was that given both data sources leverage the same driver, there was some hope of this working with the proper incantation, especially considering the library routines available by Spatialite in SQL queries.  But without something like burn available in a SQL query then this can?t work at the query level.  This is easy to write in C/C++ but wanted to see if the database engine could handle it directly.

Jesse

From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi><mailto:jukka.rahkonen at maanmittauslaitos.fi>
Date: Thursday, December 8, 2022 at 3:45 PM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov><mailto:jesse.r.meyer at nasa.gov>, "gdal-dev at lists.osgeo.org"<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org><mailto:gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: SQL query to set column to GPKG raster pixel value of point intersection result

Hi,

It feels like quite special tool. Have you considered to use the Sample Raster Values tool in QGIS? The description of the tool is:

Sample raster values
This algorithm creates a new vector layer with the same attributes of the input layer and the raster values corresponding on the point location.
If the raster layer has more than one band, all the band values are sampled.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> Puolesta Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev
L?hetetty: torstai 8. joulukuuta 2022 20.07
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] SQL query to set column to GPKG raster pixel value of point intersection result

Hi,

I have GPKG database with features represented by point geometries.  I?d like to update these features, in a single SQL statement, to add a new column whose value is the pixel value of an external GPKG raster for which the point geometry intersects with.  I was hoping to find an OGR SQL function similar to burn for this, but I?ve come up empty handed.

Is this functionality available? Ideally, without resorting to manually updating each feature individually in a user application.  Otherwise, perhaps a feature request is in order.

Thanks,
Jesse



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7Ce52283f9b35c4682a24208dad96832a9%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638061338794913140%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=wPWcuatudI1BivRAZD%2BtVFsc2ZcakKv8UcOTmmZoU38%3D&reserved=0>

--

http://www.spatialys.com<https://gcc02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7Ce52283f9b35c4682a24208dad96832a9%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638061338794913140%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=n%2FrQoFVB9IgeT%2BsrBjWz2EevmQFv9rdqvLP2tD8upsQ%3D&reserved=0>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/2d21f4ac/attachment-0001.htm>

From jesse.r.meyer at nasa.gov  Mon Dec 12 06:47:31 2022
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Mon, 12 Dec 2022 14:47:31 +0000
Subject: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG
 raster pixel value of point intersection result
In-Reply-To: <8A4C5860-96FD-42C0-8E22-7FA9419F7B00@nasa.gov>
References: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
 <AM0PR09MB321961DC13AD42965244F71BFD1D9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <63FFE6AE-ABEA-4C37-BB01-9E2C70EA653D@nasa.gov>
 <3b0a6723-da8c-da37-5dd0-a283cbfc40d1@spatialys.com>
 <8A4C5860-96FD-42C0-8E22-7FA9419F7B00@nasa.gov>
Message-ID: <EB0E7291-CEAC-495A-BB48-E375A48FF13C@nasa.gov>

Sorry for the spam ? I meant the last message to be a question.  The tests so far only account for explicitly provided values in the query string.

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev" <gdal-dev at lists.osgeo.org>
Reply-To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>
Date: Monday, December 12, 2022 at 9:44 AM
To: Even Rouault <even.rouault at spatialys.com>, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>, "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG raster pixel value of point intersection result

Thanks Even, this looks good!

In my case, then the SQL query should resemble something like `select gdal_get_layer_pixel_value('byte', 1, 'georef', ST_X(geom), ST_Y(geom))`

Where `geom` is a centroid.

From: Even Rouault <even.rouault at spatialys.com>
Date: Thursday, December 8, 2022 at 5:04 PM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>, "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG raster pixel value of point intersection result


Hi,

That sounds like a cool idea. I've had a crack at it in https://github.com/OSGeo/gdal/pull/6877<https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fpull%2F6877&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7C863e159aea4442e6870708dadc4f678f%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638064530856204431%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=V8CA38M%2BnhrQIFDwbSnOuFxA7w0HdWG56%2Bo%2F3IhOWOk%3D&reserved=0>

Even
Le 08/12/2022 ? 22:10, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev a ?crit :
Hi,

I want to perform this on tens of thousands of GPKG databases, each possessing upwards of millions of points, so automation (and performance) is a high value.  The hope was that given both data sources leverage the same driver, there was some hope of this working with the proper incantation, especially considering the library routines available by Spatialite in SQL queries.  But without something like burn available in a SQL query then this can?t work at the query level.  This is easy to write in C/C++ but wanted to see if the database engine could handle it directly.

Jesse

From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi><mailto:jukka.rahkonen at maanmittauslaitos.fi>
Date: Thursday, December 8, 2022 at 3:45 PM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov><mailto:jesse.r.meyer at nasa.gov>, "gdal-dev at lists.osgeo.org"<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org><mailto:gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: SQL query to set column to GPKG raster pixel value of point intersection result

Hi,

It feels like quite special tool. Have you considered to use the Sample Raster Values tool in QGIS? The description of the tool is:

Sample raster values
This algorithm creates a new vector layer with the same attributes of the input layer and the raster values corresponding on the point location.
If the raster layer has more than one band, all the band values are sampled.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> Puolesta Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev
L?hetetty: torstai 8. joulukuuta 2022 20.07
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] SQL query to set column to GPKG raster pixel value of point intersection result

Hi,

I have GPKG database with features represented by point geometries.  I?d like to update these features, in a single SQL statement, to add a new column whose value is the pixel value of an external GPKG raster for which the point geometry intersects with.  I was hoping to find an OGR SQL function similar to burn for this, but I?ve come up empty handed.

Is this functionality available? Ideally, without resorting to manually updating each feature individually in a user application.  Otherwise, perhaps a feature request is in order.

Thanks,
Jesse


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7C863e159aea4442e6870708dadc4f678f%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638064530856204431%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=KsjwkCtnoLmRw6cw8LS427cMe8isV1WzLW6vPS3Yeqc%3D&reserved=0>

--

http://www.spatialys.com<https://gcc02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7C863e159aea4442e6870708dadc4f678f%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638064530856204431%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=gTxLbTlpgy0bBkF%2FtXI6tSGdOuZw2JbNGijxgxWHQoY%3D&reserved=0>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/bee1a688/attachment-0001.htm>

From even.rouault at spatialys.com  Mon Dec 12 06:54:32 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 12 Dec 2022 15:54:32 +0100
Subject: [gdal-dev] [EXTERNAL] Re: SQL query to set column to GPKG
 raster pixel value of point intersection result
In-Reply-To: <EB0E7291-CEAC-495A-BB48-E375A48FF13C@nasa.gov>
References: <DCB190A3-3752-4864-8E5F-DDA1329F326D@contoso.com>
 <AM0PR09MB321961DC13AD42965244F71BFD1D9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <63FFE6AE-ABEA-4C37-BB01-9E2C70EA653D@nasa.gov>
 <3b0a6723-da8c-da37-5dd0-a283cbfc40d1@spatialys.com>
 <8A4C5860-96FD-42C0-8E22-7FA9419F7B00@nasa.gov>
 <EB0E7291-CEAC-495A-BB48-E375A48FF13C@nasa.gov>
Message-ID: <0e2d6f77-af69-8191-7b1e-9cfc46aca74d@spatialys.com>

You don't necessarily need to pass a literal value. That can be combined 
with any other SQLite function that return the appropriate data type, 
like Spatialite functions: 
https://www.gaia-gis.it/gaia-sins/spatialite-sql-5.0.1.html

Le 12/12/2022 ? 15:47, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND 
APPLICATIONS INC] a ?crit?:
>
> Sorry for the spam ? I meant the last message to be a question.? The 
> tests so far only account for explicitly provided values in the query 
> string.
>
> *From: *gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of 
> "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] 
> via gdal-dev" <gdal-dev at lists.osgeo.org>
> *Reply-To: *"Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND 
> APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>
> *Date: *Monday, December 12, 2022 at 9:44 AM
> *To: *Even Rouault <even.rouault at spatialys.com>, Rahkonen Jukka 
> <jukka.rahkonen at maanmittauslaitos.fi>, "gdal-dev at lists.osgeo.org" 
> <gdal-dev at lists.osgeo.org>
> *Subject: *Re: [gdal-dev] [EXTERNAL] Re: SQL query to set column to 
> GPKG raster pixel value of point intersection result
>
> Thanks Even, this looks good!
>
> In my case, then the SQL query should resemble something like `select 
> gdal_get_layer_pixel_value('byte', 1, 'georef', ST_X(geom), ST_Y(geom))`
>
> Where `geom` is a centroid.
>
> *From: *Even Rouault <even.rouault at spatialys.com>
> *Date: *Thursday, December 8, 2022 at 5:04 PM
> *To: *"Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS 
> INC]" <jesse.r.meyer at nasa.gov>, Rahkonen Jukka 
> <jukka.rahkonen at maanmittauslaitos.fi>, "gdal-dev at lists.osgeo.org" 
> <gdal-dev at lists.osgeo.org>
> *Subject: *Re: [gdal-dev] [EXTERNAL] Re: SQL query to set column to 
> GPKG raster pixel value of point intersection result
>
> Hi,
>
> That sounds like a cool idea. I've had a crack at it in 
> https://github.com/OSGeo/gdal/pull/6877 
> <https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fpull%2F6877&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7C863e159aea4442e6870708dadc4f678f%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638064530856204431%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=V8CA38M%2BnhrQIFDwbSnOuFxA7w0HdWG56%2Bo%2F3IhOWOk%3D&reserved=0>
>
> Even
>
> Le 08/12/2022 ? 22:10, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS 
> AND APPLICATIONS INC] via gdal-dev a ?crit?:
>
>     Hi,
>
>     I want to perform this on tens of thousands of GPKG databases,
>     each possessing upwards of millions of points, so automation (and
>     performance) is a high value.? The hope was that given both data
>     sources leverage the same driver, there was some hope of this
>     working with the proper incantation, especially considering the
>     library routines available by Spatialite in SQL queries.? But
>     without something like burn available in a SQL query then this
>     can?t work at the query level.? This is easy to write in C/C++ but
>     wanted to see if the database engine could handle it directly.
>
>     Jesse
>
>     *From: *Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>     <mailto:jukka.rahkonen at maanmittauslaitos.fi>
>     *Date: *Thursday, December 8, 2022 at 3:45 PM
>     *To: *"Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND
>     APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>
>     <mailto:jesse.r.meyer at nasa.gov>, "gdal-dev at lists.osgeo.org"
>     <mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org>
>     <mailto:gdal-dev at lists.osgeo.org>
>     *Subject: *[EXTERNAL] Re: SQL query to set column to GPKG raster
>     pixel value of point intersection result
>
>     Hi,
>
>     It feels like quite special tool. Have you considered to use the
>     Sample Raster Values tool in QGIS? The description of the tool is:
>
>     Sample raster values
>
>     This algorithm creates a new vector layer with the same attributes
>     of the input layer and the raster values corresponding on the
>     point location.
>
>     If the raster layer has more than one band, all the band values
>     are sampled.
>
>     -Jukka Rahkonen-
>
>     *L?hett?j?:*gdal-dev <gdal-dev-bounces at lists.osgeo.org>
>     <mailto:gdal-dev-bounces at lists.osgeo.org> *Puolesta *Meyer, Jesse
>     R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev
>     *L?hetetty:* torstai 8. joulukuuta 2022 20.07
>     *Vastaanottaja:* gdal-dev at lists.osgeo.org
>     *Aihe:* [gdal-dev] SQL query to set column to GPKG raster pixel
>     value of point intersection result
>
>     Hi,
>
>     I have GPKG database with features represented by point
>     geometries.? I?d like to update these features, in a single SQL
>     statement, to add a new column whose value is the pixel value of
>     an external GPKG raster for which the point geometry intersects
>     with.? I was hoping to find an OGR SQL function similar to burn
>     for this, but I?ve come up empty handed.
>
>     Is this functionality available? Ideally, without resorting to
>     manually updating each feature individually in a user
>     application.? Otherwise, perhaps a feature request is in order.
>
>     Thanks,
>
>     Jesse
>
>     _______________________________________________
>
>     gdal-dev mailing list
>
>     gdal-dev at lists.osgeo.org
>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev  <https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7C863e159aea4442e6870708dadc4f678f%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638064530856204431%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=KsjwkCtnoLmRw6cw8LS427cMe8isV1WzLW6vPS3Yeqc%3D&reserved=0>
>
> -- 
> http://www.spatialys.com  <https://gcc02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&data=05%7C01%7Cjesse.r.meyer%40nasa.gov%7C863e159aea4442e6870708dadc4f678f%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C638064530856204431%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=gTxLbTlpgy0bBkF%2FtXI6tSGdOuZw2JbNGijxgxWHQoY%3D&reserved=0>
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/234da4a4/attachment.htm>

From cliveswan at gmail.com  Mon Dec 12 08:47:06 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 12 Dec 2022 16:47:06 +0000
Subject: [gdal-dev] File Size Output is wrong --
Message-ID: <CA+kQ3mtQixdVEEOuuXFnqRG+GK6N86UWpkW_u-8+E+zsDa_Tpg@mail.gmail.com>

Greetings,

I am writing the output on the local AWS Instance to avoid write
permissions error, then copying to a Bucket.
I get an error message if I leave out --config GDAL_SWATH_SIZE 1000000

I want to merge File A into File B, updating the 6GB file. The output is
622MB NOT 6GB??
(A) /vsis3/summer/1/coastal-2020.tif  = 6GB
(B) /vsis3/summer/2/coastal-2020.tif  = 622MB

Is this wrong??
(A)                                                    (B)
gdalbuildvrt -o /data/coastal-2020.vrt /vsis3/summer/1/coastal-2020.tif /
vsis3/summer/2/coastal-2020.tif

The output in /data/coastal-2020.tif should be 6GB
gdal_translate /data/coastal-2020.vrt /data/coastal-2020.tif -co
BIGTIFF=YES -co COMPRESS=LZW -  -co NUM_THREADS=ALL_CPUS --config
CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config GDAL_SWATH_SIZE
1000000
##--config AWS_ACCESS_KEY_ID            set in ./config
##--config AWS_SECRET_ACCESS_KEY set in ./config

-- 

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/4ca85bd1/attachment-0001.htm>

From j1 at jimenezshaw.com  Mon Dec 12 09:39:28 2022
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 12 Dec 2022 18:39:28 +0100
Subject: [gdal-dev] File Size Output is wrong --
In-Reply-To: <CA+kQ3mtQixdVEEOuuXFnqRG+GK6N86UWpkW_u-8+E+zsDa_Tpg@mail.gmail.com>
References: <CA+kQ3mtQixdVEEOuuXFnqRG+GK6N86UWpkW_u-8+E+zsDa_Tpg@mail.gmail.com>
Message-ID: <CADRrdKtK1GX2+PJ1Gg-g6T7eiGHrEqB5hpPnbmP75i1PHRu7uQ@mail.gmail.com>

gdalinfo of the three files (two inputs and one output) may help to
understand better the conditions.
One option is that file A is not compressed, while the output is LZW.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Mon, 12 Dec 2022 at 17:47, Clive Swan <cliveswan at gmail.com> wrote:

> Greetings,
>
> I am writing the output on the local AWS Instance to avoid write
> permissions error, then copying to a Bucket.
> I get an error message if I leave out --config GDAL_SWATH_SIZE 1000000
>
> I want to merge File A into File B, updating the 6GB file. The output is
> 622MB NOT 6GB??
> (A) /vsis3/summer/1/coastal-2020.tif  = 6GB
> (B) /vsis3/summer/2/coastal-2020.tif  = 622MB
>
> Is this wrong??
> (A)                                                    (B)
> gdalbuildvrt -o /data/coastal-2020.vrt /vsis3/summer/1/coastal-2020.tif /
> vsis3/summer/2/coastal-2020.tif
>
> The output in /data/coastal-2020.tif should be 6GB
> gdal_translate /data/coastal-2020.vrt /data/coastal-2020.tif -co
> BIGTIFF=YES -co COMPRESS=LZW -  -co NUM_THREADS=ALL_CPUS --config
> CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config GDAL_SWATH_SIZE
> 1000000
> ##--config AWS_ACCESS_KEY_ID            set in ./config
> ##--config AWS_SECRET_ACCESS_KEY set in ./config
>
> --
>
>  Regards,
>
>
> Clive Swan
>
> --
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/4371982f/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 12 12:25:41 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 12 Dec 2022 20:25:41 +0000
Subject: [gdal-dev] Ogr2ogr: when both -update and -append is needed?
Message-ID: <AM0PR09MB32193AD5C16E70B2B1BA9327FDE29@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

I saw this question https://gis.stackexchange.com/questions/447359/what-is-the-effect-of-using-update-when-merging-geojsons-with-ogr2ogr and started to think when the ogr2ogr option -update is needed even when the -append option is used. At least for some drivers -append alone seems to be enough but are there some drivers that explicitly require also -update?

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/0c3a1199/attachment.htm>

From even.rouault at spatialys.com  Mon Dec 12 12:30:37 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 12 Dec 2022 21:30:37 +0100
Subject: [gdal-dev] Ogr2ogr: when both -update and -append is needed?
In-Reply-To: <AM0PR09MB32193AD5C16E70B2B1BA9327FDE29@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB32193AD5C16E70B2B1BA9327FDE29@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <b0dad197-8275-793f-2586-ab22ea01a797@spatialys.com>

Loooong time ago you need to add both, but nowadays -append 
automatically enables -update. Just clarified it in 
https://github.com/OSGeo/gdal/commit/480456769abc11daae065bd112cb7361aa618636

Le 12/12/2022 ? 21:25, Rahkonen Jukka a ?crit?:
>
> Hi,
>
> I saw this question 
> https://gis.stackexchange.com/questions/447359/what-is-the-effect-of-using-update-when-merging-geojsons-with-ogr2ogr 
> and started to think when the ogr2ogr option -update is needed even 
> when the -append option is used. At least for some drivers -append 
> alone seems to be enough but are there some drivers that explicitly 
> require also -update?
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/a6e8abb9/attachment.htm>

From cliveswan at gmail.com  Mon Dec 12 13:45:20 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 12 Dec 2022 21:45:20 +0000
Subject: [gdal-dev] File Size Output is wrong --
In-Reply-To: <CADRrdKtK1GX2+PJ1Gg-g6T7eiGHrEqB5hpPnbmP75i1PHRu7uQ@mail.gmail.com>
References: <CA+kQ3mtQixdVEEOuuXFnqRG+GK6N86UWpkW_u-8+E+zsDa_Tpg@mail.gmail.com>
 <CADRrdKtK1GX2+PJ1Gg-g6T7eiGHrEqB5hpPnbmP75i1PHRu7uQ@mail.gmail.com>
Message-ID: <CA+kQ3mtDTn+LrKQfLiwHMV-65uO1DcxZ9GGjFYM0SECGTMkE3Q@mail.gmail.com>

Files: /data/coastal-undefended-rcp26-2020.vrt

 /vsis3/summer-outputs/3_data_ready_for_spectra/coastal-undefended-rcp26-2020.tif

 /vsis3/summer-outputs/5_UK_prod_rasters/coastal-undefended-rcp26-2020.tif
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
  NoData Value=-9999
Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999
Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999
Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999
Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999
Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999
Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999
Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999
Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
  NoData Value=-9999

On Mon, 12 Dec 2022 at 17:39, Javier Jimenez Shaw <j1 at jimenezshaw.com>
wrote:

> gdalinfo of the three files (two inputs and one output) may help to
> understand better the conditions.
> One option is that file A is not compressed, while the output is LZW.
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
> On Mon, 12 Dec 2022 at 17:47, Clive Swan <cliveswan at gmail.com> wrote:
>
>> Greetings,
>>
>> I am writing the output on the local AWS Instance to avoid write
>> permissions error, then copying to a Bucket.
>> I get an error message if I leave out --config GDAL_SWATH_SIZE 1000000
>>
>> I want to merge File A into File B, updating the 6GB file. The output is
>> 622MB NOT 6GB??
>> (A) /vsis3/summer/1/coastal-2020.tif  = 6GB
>> (B) /vsis3/summer/2/coastal-2020.tif  = 622MB
>>
>> Is this wrong??
>> (A)                                                    (B)
>> gdalbuildvrt -o /data/coastal-2020.vrt /vsis3/summer/1/coastal-2020.tif /
>> vsis3/summer/2/coastal-2020.tif
>>
>> The output in /data/coastal-2020.tif should be 6GB
>> gdal_translate /data/coastal-2020.vrt /data/coastal-2020.tif -co
>> BIGTIFF=YES -co COMPRESS=LZW -  -co NUM_THREADS=ALL_CPUS --config
>> CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config GDAL_SWATH_SIZE
>> 1000000
>> ##--config AWS_ACCESS_KEY_ID            set in ./config
>> ##--config AWS_SECRET_ACCESS_KEY set in ./config
>>
>> --
>>
>>  Regards,
>>
>>
>> Clive Swan
>>
>> --
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>

-- 

 Regards,


Clive Swan

--


M: +44 7766 452665
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/3d26d4a6/attachment-0001.htm>

From cliveswan at gmail.com  Mon Dec 12 13:48:56 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 12 Dec 2022 21:48:56 +0000
Subject: [gdal-dev] gdal_merge tries create 377 GB raster
Message-ID: <CA+kQ3muWhEq2TXeiq-h7hbbig0-8xHAt=vEVB8S1c7C84BtQjw@mail.gmail.com>

/data/coastal.tif  should be 6.9GB

I get weird output from gdal_merge??

gdal_merge.py -o /data/coastal.tif -n -9999 -co BIGTIFF=YES -co
COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co
NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
 --config GDAL_SWATH_SIZE 1000000  /vsis3/summer/1/coastal.tif
/vsis3/summer/2/coastal.tif  & disown -h
[1] 507311
ubuntu at ip-172-31-31-16:~$ 0Traceback (most recent call last):
  File "/usr/bin/gdal_merge.py", line 11, in <module>
    sys.exit(main(sys.argv))
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line
530, in main
    fi.copy_into(t_fh, band, band, nodata, verbose)
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line
284, in copy_into
    return raster_copy(s_fh, sw_xoff, sw_yoff, sw_xsize, sw_ysize, s_band,
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line 56,
in raster_copy
    return raster_copy_with_nodata(
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line 96,
in raster_copy_with_nodata
    data_src = s_band.ReadAsArray(s_xoff, s_yoff, s_xsize, s_ysize,
  File "/usr/lib/python3/dist-packages/osgeo/gdal.py", line 3653, in
ReadAsArray
    return gdal_array.BandReadAsArray(self, xoff, yoff,
  File "/usr/lib/python3/dist-packages/osgeo/gdal_array.py", line 422, in
BandReadAsArray
    buf_obj = numpy.empty([buf_ysize, buf_xsize], dtype=typecode)
numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for
an array with shape (225000, 450000) and data type float32


-- 

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221212/e03612fd/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 12 23:01:46 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 13 Dec 2022 07:01:46 +0000
Subject: [gdal-dev] gdal_merge tries create 377 GB raster
In-Reply-To: <CA+kQ3muWhEq2TXeiq-h7hbbig0-8xHAt=vEVB8S1c7C84BtQjw@mail.gmail.com>
References: <CA+kQ3muWhEq2TXeiq-h7hbbig0-8xHAt=vEVB8S1c7C84BtQjw@mail.gmail.com>
Message-ID: <AM0PR09MB321929BCCB5ABEDADFE215DFFDE39@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

It looks like the Python script gdal_merge.py wants to read all the data into a single array, and that is a big array because the image that covers the whole world with Pixel Size = (0.000800000000000,-0.000800000000000) is big, 450000 by 225000 pixels. Probably gdal_merge is not the right tool for your use case. I would have a try with gdalwarp. Use the big image (or a copy of that) as a target and warp the small one into it. The result may not have the smallest possible file size one because it is not so simple to update a compressed image with new compressed data.

You provided gdalinfo from the vrt but could you provide gdalinfo also from the real files:
       /vsis3/summer-outputs/3_data_ready_for_spectra/coastal-undefended-rcp26-2020.tif
       /vsis3/summer-outputs/5_UK_prod_rasters/coastal-undefended-rcp26-2020.tif

-Jukka Rahkonen-



L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clive Swan
L?hetetty: maanantai 12. joulukuuta 2022 23.49
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdal_merge tries create 377 GB raster

/data/coastal.tif  should be 6.9GB

I get weird output from gdal_merge??

gdal_merge.py -o /data/coastal.tif -n -9999 -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config GDAL_SWATH_SIZE 1000000  /vsis3/summer/1/coastal.tif /vsis3/summer/2/coastal.tif  & disown -h
[1] 507311
ubuntu at ip-172-31-31-16:~$ 0Traceback (most recent call last):
  File "/usr/bin/gdal_merge.py", line 11, in <module>
    sys.exit(main(sys.argv))
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line 530, in main
    fi.copy_into(t_fh, band, band, nodata, verbose)
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line 284, in copy_into
    return raster_copy(s_fh, sw_xoff, sw_yoff, sw_xsize, sw_ysize, s_band,
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line 56, in raster_copy
    return raster_copy_with_nodata(
  File "/usr/lib/python3/dist-packages/osgeo_utils/gdal_merge.py", line 96, in raster_copy_with_nodata
    data_src = s_band.ReadAsArray(s_xoff, s_yoff, s_xsize, s_ysize,
  File "/usr/lib/python3/dist-packages/osgeo/gdal.py", line 3653, in ReadAsArray
    return gdal_array.BandReadAsArray(self, xoff, yoff,
  File "/usr/lib/python3/dist-packages/osgeo/gdal_array.py", line 422, in BandReadAsArray
    buf_obj = numpy.empty([buf_ysize, buf_xsize], dtype=typecode)
numpy.core._exceptions._ArrayMemoryError: Unable to allocate 377. GiB for an array with shape (225000, 450000) and data type float32


--

 Regards,



Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/82a1df11/attachment.htm>

From even.rouault at spatialys.com  Tue Dec 13 07:18:54 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 13 Dec 2022 16:18:54 +0100
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
Message-ID: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>

Hi,

https://github.com/qgis/QGIS/issues/51188 has been brought to my 
attention. The issue is that the new background building of the RTree of 
GeoPackage files introduced in 3.6.0 didn't work well with committing 
transactions in between, which is easily triggered by ogr2ogr. All 
features were inserted but with default settings ~ 10% of them lacked an 
entry in the spatial index, which can be enough to break interactive 
display and workflows relying on spatial filtering. When using ogr2ogr, 
I believe the issue can only be seen when creating layers with more than 
100 000 features, since that's the default value for the interval at 
which transactions are committed.

I've a fix ready in https://github.com/OSGeo/gdal/pull/6911. The fix 
itself is a simple two-liner: 
https://github.com/OSGeo/gdal/pull/6911/commits/3f5f6225fe82e0c2e0241e4f66bfb861cdf4fe9d

Given the status of GeoPackage being the default format for QGIS, I 
believe this is a severe enough issue to warrant an advanced 3.6.1 
release, and an official retraction of 3.6.0.

Thoughts ?

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From cliveswan at gmail.com  Tue Dec 13 07:23:04 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Tue, 13 Dec 2022 15:23:04 +0000
Subject: [gdal-dev] gdalwarp running very slow
Message-ID: <CA+kQ3msXUsuuGhTW3_+1XR0bGTz25jJbXWA9Pk2BaTEXW+oZcQ@mail.gmail.com>

Greetings,

I am running gdalwarp on a 6GB (output) and 600MB (input) tif image, the
AWS Instance has approx 60 VCPU
It has taken over 6 hours so far - still running, is it possible to
optimise this and speed it up??

gdalwarp -r near -overwrite coastal-2020.tif   5_UK_coastal-2020.tif -co
BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co
NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES

-- 

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/c6c6077e/attachment.htm>

From sean.gillies at gmail.com  Tue Dec 13 07:40:44 2022
From: sean.gillies at gmail.com (Sean Gillies)
Date: Tue, 13 Dec 2022 08:40:44 -0700
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
Message-ID: <CAOodmJoyrRttAwYomMuyf06Ak4Q0nOp6sY6Efger8n_kOX1a-A@mail.gmail.com>

No objection from me!


On Tue, Dec 13, 2022, 8:19 AM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> https://github.com/qgis/QGIS/issues/51188 has been brought to my
> attention. The issue is that the new background building of the RTree of
> GeoPackage files introduced in 3.6.0 didn't work well with committing
> transactions in between, which is easily triggered by ogr2ogr. All
> features were inserted but with default settings ~ 10% of them lacked an
> entry in the spatial index, which can be enough to break interactive
> display and workflows relying on spatial filtering. When using ogr2ogr,
> I believe the issue can only be seen when creating layers with more than
> 100 000 features, since that's the default value for the interval at
> which transactions are committed.
>
> I've a fix ready in https://github.com/OSGeo/gdal/pull/6911. The fix
> itself is a simple two-liner:
>
> https://github.com/OSGeo/gdal/pull/6911/commits/3f5f6225fe82e0c2e0241e4f66bfb861cdf4fe9d
>
> Given the status of GeoPackage being the default format for QGIS, I
> believe this is a severe enough issue to warrant an advanced 3.6.1
> release, and an official retraction of 3.6.0.
>
> Thoughts ?
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/f50801b1/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec 13 07:41:35 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 13 Dec 2022 15:41:35 +0000
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
Message-ID: <AM0PR09MB3219D08A9FA80430D0FFFFDCFDE39@AM0PR09MB3219.eurprd09.prod.outlook.com>

+1 for the hotfix.

-Jukka Rahkonen-


-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
L?hetetty: tiistai 13. joulukuuta 2022 17.19
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?

Hi,

https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fqgis%2FQGIS%2Fissues%2F51188&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2761f315f6bd4eb6c91f08dadd1d6bbd%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638065415688838146%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=I%2BM6iKoyeESbOVeR9csXkA6ATaKh4GNbRKldfhF0pJs%3D&amp;reserved=0 has been brought to my attention. The issue is that the new background building of the RTree of GeoPackage files introduced in 3.6.0 didn't work well with committing transactions in between, which is easily triggered by ogr2ogr. All features were inserted but with default settings ~ 10% of them lacked an entry in the spatial index, which can be enough to break interactive display and workflows relying on spatial filtering. When using ogr2ogr, I believe the issue can only be seen when creating layers with more than
100 000 features, since that's the default value for the interval at which transactions are committed.

I've a fix ready in https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fpull%2F6911&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2761f315f6bd4eb6c91f08dadd1d6bbd%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638065415688838146%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=sII0PhAG2VreyRvIn5e8cfjNLq5ZSlunDTJm9FpMdmU%3D&amp;reserved=0. The fix itself is a simple two-liner: 
https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fpull%2F6911%2Fcommits%2F3f5f6225fe82e0c2e0241e4f66bfb861cdf4fe9d&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2761f315f6bd4eb6c91f08dadd1d6bbd%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638065415688838146%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=vpl4%2FHFkLRyjtBlgGULabBjsZuxLnhBzRK%2BOwFA6RAE%3D&amp;reserved=0

Given the status of GeoPackage being the default format for QGIS, I believe this is a severe enough issue to warrant an advanced 3.6.1 release, and an official retraction of 3.6.0.

Thoughts ?

Even

--
https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2761f315f6bd4eb6c91f08dadd1d6bbd%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638065415688838146%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=W1%2BeCIrV8xPlGUfw3h%2BeO4dGKryoyh94CwJWE0uQ1s4%3D&amp;reserved=0
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2761f315f6bd4eb6c91f08dadd1d6bbd%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638065415688838146%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=rX4HSCp1kbHMMMuttm8kKl91BRK9JE6K%2BQk3pvzc6Zs%3D&amp;reserved=0

From dmorissette at mapgears.com  Tue Dec 13 07:47:48 2022
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Tue, 13 Dec 2022 10:47:48 -0500
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
Message-ID: <4f7ae36f-067e-4033-6cdb-e6551a006255@mapgears.com>

+1 for 3.6.1 with this fix.

Daniel


On 2022-12-13 10:18, Even Rouault via gdal-dev wrote:
> Hi,
> 
> https://github.com/qgis/QGIS/issues/51188 has been brought to my 
> attention. The issue is that the new background building of the RTree of 
> GeoPackage files introduced in 3.6.0 didn't work well with committing 
> transactions in between, which is easily triggered by ogr2ogr. All 
> features were inserted but with default settings ~ 10% of them lacked an 
> entry in the spatial index, which can be enough to break interactive 
> display and workflows relying on spatial filtering. When using ogr2ogr, 
> I believe the issue can only be seen when creating layers with more than 
> 100 000 features, since that's the default value for the interval at 
> which transactions are committed.
> 
> I've a fix ready in https://github.com/OSGeo/gdal/pull/6911. The fix 
> itself is a simple two-liner: 
> https://github.com/OSGeo/gdal/pull/6911/commits/3f5f6225fe82e0c2e0241e4f66bfb861cdf4fe9d
> 
> Given the status of GeoPackage being the default format for QGIS, I 
> believe this is a severe enough issue to warrant an advanced 3.6.1 
> release, and an official retraction of 3.6.0.
> 
> Thoughts ?
> 
> Even
> 

-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201


From sebastic at xs4all.nl  Tue Dec 13 07:37:13 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Tue, 13 Dec 2022 16:37:13 +0100
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
Message-ID: <95c72ef1-5f9d-67f8-b4d6-51ad17437ed7@xs4all.nl>

On 12/13/22 16:18, Even Rouault via gdal-dev wrote:
> Given the status of GeoPackage being the default format for QGIS, I 
> believe this is a severe enough issue to warrant an advanced 3.6.1 
> release, and an official retraction of 3.6.0.
> 
> Thoughts ?

Yes, please.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1


From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec 13 07:49:18 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 13 Dec 2022 15:49:18 +0000
Subject: [gdal-dev] gdalwarp running very slow
In-Reply-To: <CA+kQ3msXUsuuGhTW3_+1XR0bGTz25jJbXWA9Pk2BaTEXW+oZcQ@mail.gmail.com>
References: <CA+kQ3msXUsuuGhTW3_+1XR0bGTz25jJbXWA9Pk2BaTEXW+oZcQ@mail.gmail.com>
Message-ID: <AM0PR09MB3219BC842909C8CBA5F091E5FDE39@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

If you are still struggling with the same old problem could you please finally send the gdalinfo reports of your two input files which are this time:
coastal-2020.tif
5_UK_coastal-2020.tif

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clive Swan
L?hetetty: tiistai 13. joulukuuta 2022 17.23
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdalwarp running very slow

Greetings,
I am running gdalwarp on a 6GB (output) and 600MB (input) tif image, the AWS Instance has approx 60 VCPU
It has taken over 6 hours so far - still running, is it possible to optimise this and speed it up??

gdalwarp -r near -overwrite coastal-2020.tif   5_UK_coastal-2020.tif -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES

--

 Regards,



Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/e80c5a17/attachment.htm>

From howard at hobu.co  Tue Dec 13 07:52:47 2022
From: howard at hobu.co (Howard Butler)
Date: Tue, 13 Dec 2022 09:52:47 -0600
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <4f7ae36f-067e-4033-6cdb-e6551a006255@mapgears.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
 <4f7ae36f-067e-4033-6cdb-e6551a006255@mapgears.com>
Message-ID: <0DA45D7D-4287-48BC-B429-361360389D44@hobu.co>

+1 

> On Dec 13, 2022, at 9:47 AM, Daniel Morissette <dmorissette at mapgears.com> wrote:
> 
> +1 for 3.6.1 with this fix.
> 
> Daniel
> 
> 
> On 2022-12-13 10:18, Even Rouault via gdal-dev wrote:
>> Hi,
>> https://github.com/qgis/QGIS/issues/51188 has been brought to my attention. The issue is that the new background building of the RTree of GeoPackage files introduced in 3.6.0 didn't work well with committing transactions in between, which is easily triggered by ogr2ogr. All features were inserted but with default settings ~ 10% of them lacked an entry in the spatial index, which can be enough to break interactive display and workflows relying on spatial filtering. When using ogr2ogr, I believe the issue can only be seen when creating layers with more than 100 000 features, since that's the default value for the interval at which transactions are committed.
>> I've a fix ready in https://github.com/OSGeo/gdal/pull/6911. The fix itself is a simple two-liner: https://github.com/OSGeo/gdal/pull/6911/commits/3f5f6225fe82e0c2e0241e4f66bfb861cdf4fe9d
>> Given the status of GeoPackage being the default format for QGIS, I believe this is a severe enough issue to warrant an advanced 3.6.1 release, and an official retraction of 3.6.0.
>> Thoughts ?
>> Even
> 
> -- 
> Daniel Morissette
> Mapgears Inc
> T: +1 418-696-5056 #201
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



From cliveswan at gmail.com  Tue Dec 13 09:22:05 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Tue, 13 Dec 2022 17:22:05 +0000
Subject: [gdal-dev] gdalwarp running very slow
Message-ID: <CA+kQ3muFbEM_4fRiHsYieT=+OBDBJ8gF80zVX==D6svoQ7akQQ@mail.gmail.com>

 Greetings,

I am using the same files, I copied them from an AWS Bucket to a local AWS
Instance.
I tried gdal_merge << tries to create 300GB file
I tried gdal_translate ran but created 2.5 GB not 6.9 GB file
Now trying gdalwarp.

the gdalinfo is the same in both datasets:

coastal-2020.tif (6.9GB)

Driver: GTiff/GeoTIFF
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)
Metadata:
  AREA_OR_POINT=Area
  datetime_created=2022-11-14 18:05:14.053301
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
  PREDICTOR=3
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
  Description = score
  NoData Value=-9999
Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_value
  NoData Value=-9999
Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_min
  NoData Value=-9999
Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_max
  NoData Value=-9999
Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood
  NoData Value=-9999
Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = return_time
  NoData Value=-9999
Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood_confidence
  NoData Value=-9999
Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = climate_reliability
  NoData Value=-9999
Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = hazard_reliability
  NoData Value=-9999

5_UK_coastal-2020.tif (600MB)

Driver: GTiff/GeoTIFF
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)
Metadata:
  AREA_OR_POINT=Area
  datetime_created=2022-11-14 18:05:14.053301
  hostname=posix.uname_result(sysname='Linux', nodename='ip-172-31-12-125',
release='5.15.0-1022-aws', version='#26~20.04.1-Ubuntu SMP Sat Oct 15
03:22:07 UTC 2022', machine='x86_64')
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
  PREDICTOR=3
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
  Description = score
  NoData Value=-9999
Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_value
  NoData Value=-9999
Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_min
  NoData Value=-9999
Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_max
  NoData Value=-9999
Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood
  NoData Value=-9999
Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = return_time
  NoData Value=-9999
Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood_confidence
  NoData Value=-9999
Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = climate_reliability
  NoData Value=-9999
Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = hazard_reliability
  NoData Value=-9999

-- 

 Regards,


Clive Swan

--

Hi,

If you are still struggling with the same old problem could you please
finally send the gdalinfo reports of your two input files which are
this time:
coastal-2020.tif
5_UK_coastal-2020.tif

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org
<https://lists.osgeo.org/mailman/listinfo/gdal-dev>> Puolesta Clive
Swan
L?hetetty: tiistai 13. joulukuuta 2022 17.23
Vastaanottaja: gdal-dev at lists.osgeo.org
<https://lists.osgeo.org/mailman/listinfo/gdal-dev>
Aihe: [gdal-dev] gdalwarp running very slow

Greetings,
I am running gdalwarp on a 6GB (output) and 600MB (input) tif image,
the AWS Instance has approx 60 VCPU
It has taken over 6 hours so far - still running, is it possible to
optimise this and speed it up??

gdalwarp -r near -overwrite coastal-2020.tif   5_UK_coastal-2020.tif
-co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128
 -co NUM_THREADS=ALL_CPUS --config
CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/9f56f652/attachment-0001.htm>

From even.rouault at spatialys.com  Tue Dec 13 12:39:12 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 13 Dec 2022 21:39:12 +0100
Subject: [gdal-dev] libtiff v4.5.0 rc2 available
Message-ID: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>

Hi,

The changes in IFD loop detection are non-trivial enough to justify a 
rc2, so here it is:

- https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz
- https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz.sig
- https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz
- https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz.sig
- https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip
- https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip.sig

Hopefully this will be the final release candidate for 4.5.0. Please 
test and report.

The changes since rc1 are:
- restore formatting of tiffvers.h so that FindTIFF.cmake can infer 
libtiff version number
- addition of TIFFLIB_MAJOR_VERSION, TIFFLIB_MINOR_VERSION, 
TIFFLIB_MICRO_VERSION in tiffvers.h
- introduction of TIFFLIB_AT_LEAST(major, minor, micro) macro in tiffvers.h
- CMake: restore BUILD_SHARED_LIBS=ON default setting for top-level builds
- IFD loop detection: changed algorithm to use a hashset/hashmap for 
good performance
- tdir_t type updated to uint32_t. This type is now used for the return 
value of TIFFCurrentDirectory and TIFFNumberOfDirectories, and as the 
argument of TIFFSetDirectory and TIFFUnlinkDirectory
- Increase the maximum number of IFDs that libtiff can browse through 
from 65535 to 1048576. This value is a build-time setting, available in 
tif_config.h, that can be configured with CMake's TIFF_MAX_DIR_COUNT and 
variable or autoconf's --with-max-dir-count option.
- tiffinfo: support more than 64k IFDs.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From schwehr at gmail.com  Tue Dec 13 13:39:55 2022
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 13 Dec 2022 13:39:55 -0800
Subject: [gdal-dev] [Tiff] libtiff v4.5.0 rc2 available
In-Reply-To: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>
References: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>
Message-ID: <CACmBxyuehb-_3VgJQk-6-po=u1ge3UBP=8xOD5rSv26mvVs_Aw@mail.gmail.com>

I'm seeing mac osx and ios failures at my most recent sync of
c4516f9dc72bad7f2c4a8f704169afa0342e44ca
<https://www.google.com/url?sa=D&q=https%3A%2F%2Fgitlab.com%2Flibtiff%2Flibtiff%2Fcommit%2Fc4516f9dc72bad7f2c4a8f704169afa0342e44ca>
:

third_party/tiff/libtiff/tif_dir.c:1988:17: error: format specifies type
'unsigned short' but the argument has type 'tdir_t' (aka 'unsigned int')
[-Werror,-Wformat]
                *nextdirnum, *nextdiroff, *nextdiroff, (int)(*nextdirnum) -
1);
                ^~~~~~~~~~~
third_party/tiff/libtiff/tif_dir.c:2164:27: error: format specifies type
'unsigned short' but the argument has type 'tdir_t' (aka 'unsigned int')
[-Werror,-Wformat]
                          dirn);
                          ^~~~



On Tue, Dec 13, 2022 at 12:39 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> The changes in IFD loop detection are non-trivial enough to justify a
> rc2, so here it is:
>
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip.sig
>
> Hopefully this will be the final release candidate for 4.5.0. Please
> test and report.
>
> The changes since rc1 are:
> - restore formatting of tiffvers.h so that FindTIFF.cmake can infer
> libtiff version number
> - addition of TIFFLIB_MAJOR_VERSION, TIFFLIB_MINOR_VERSION,
> TIFFLIB_MICRO_VERSION in tiffvers.h
> - introduction of TIFFLIB_AT_LEAST(major, minor, micro) macro in tiffvers.h
> - CMake: restore BUILD_SHARED_LIBS=ON default setting for top-level builds
> - IFD loop detection: changed algorithm to use a hashset/hashmap for
> good performance
> - tdir_t type updated to uint32_t. This type is now used for the return
> value of TIFFCurrentDirectory and TIFFNumberOfDirectories, and as the
> argument of TIFFSetDirectory and TIFFUnlinkDirectory
> - Increase the maximum number of IFDs that libtiff can browse through
> from 65535 to 1048576. This value is a build-time setting, available in
> tif_config.h, that can be configured with CMake's TIFF_MAX_DIR_COUNT and
> variable or autoconf's --with-max-dir-count option.
> - tiffinfo: support more than 64k IFDs.
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> Tiff mailing list
> Tiff at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/tiff
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/471ac1ac/attachment.htm>

From even.rouault at spatialys.com  Tue Dec 13 13:47:56 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 13 Dec 2022 22:47:56 +0100
Subject: [gdal-dev] [Tiff] libtiff v4.5.0 rc2 available
In-Reply-To: <CACmBxyuehb-_3VgJQk-6-po=u1ge3UBP=8xOD5rSv26mvVs_Aw@mail.gmail.com>
References: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>
 <CACmBxyuehb-_3VgJQk-6-po=u1ge3UBP=8xOD5rSv26mvVs_Aw@mail.gmail.com>
Message-ID: <ce97eb57-225c-2f14-7bcd-e2c741149cf3@spatialys.com>

Hi Kurt,

thanks for the feedback (and invalidating my prophecy that rc2 would be 
the last one :-))

should be fixed with 
https://gitlab.com/libtiff/libtiff/-/merge_requests/444.

Is that enough to get the build working for you before I generate a rc3 
with that extra fix ?

Even

Le 13/12/2022 ? 22:39, Kurt Schwehr a ?crit?:
> I'm seeing mac osx and ios failures at my most recent sync of 
> c4516f9dc72bad7f2c4a8f704169afa0342e44ca 
> <https://www.google.com/url?sa=D&q=https%3A%2F%2Fgitlab.com%2Flibtiff%2Flibtiff%2Fcommit%2Fc4516f9dc72bad7f2c4a8f704169afa0342e44ca>: 
>
>
> third_party/tiff/libtiff/tif_dir.c:1988:17: error: format specifies 
> type 'unsigned short' but the argument has type 'tdir_t' (aka 
> 'unsigned int') [-Werror,-Wformat]
> ? ? ? ? ? ? ? ? *nextdirnum, *nextdiroff, *nextdiroff, 
> (int)(*nextdirnum) - 1);
> ? ? ? ? ? ? ? ? ^~~~~~~~~~~
> third_party/tiff/libtiff/tif_dir.c:2164:27: error: format specifies 
> type 'unsigned short' but the argument has type 'tdir_t' (aka 
> 'unsigned int') [-Werror,-Wformat]
> ? ? ? ? ? ? ? ? ? ? ? ? ? dirn);
> ? ? ? ? ? ? ? ? ? ? ? ? ? ^~~~
>
>
>
> On Tue, Dec 13, 2022 at 12:39 PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Hi,
>
>     The changes in IFD loop detection are non-trivial enough to justify a
>     rc2, so here it is:
>
>     - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz
>     - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz.sig
>     - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz
>     - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz.sig
>     - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip
>     - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip.sig
>
>     Hopefully this will be the final release candidate for 4.5.0. Please
>     test and report.
>
>     The changes since rc1 are:
>     - restore formatting of tiffvers.h so that FindTIFF.cmake can infer
>     libtiff version number
>     - addition of TIFFLIB_MAJOR_VERSION, TIFFLIB_MINOR_VERSION,
>     TIFFLIB_MICRO_VERSION in tiffvers.h
>     - introduction of TIFFLIB_AT_LEAST(major, minor, micro) macro in
>     tiffvers.h
>     - CMake: restore BUILD_SHARED_LIBS=ON default setting for
>     top-level builds
>     - IFD loop detection: changed algorithm to use a hashset/hashmap for
>     good performance
>     - tdir_t type updated to uint32_t. This type is now used for the
>     return
>     value of TIFFCurrentDirectory and TIFFNumberOfDirectories, and as the
>     argument of TIFFSetDirectory and TIFFUnlinkDirectory
>     - Increase the maximum number of IFDs that libtiff can browse through
>     from 65535 to 1048576. This value is a build-time setting,
>     available in
>     tif_config.h, that can be configured with CMake's
>     TIFF_MAX_DIR_COUNT and
>     variable or autoconf's --with-max-dir-count option.
>     - tiffinfo: support more than 64k IFDs.
>
>     Even
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>     _______________________________________________
>     Tiff mailing list
>     Tiff at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/tiff
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/c7018b62/attachment.htm>

From schwehr at gmail.com  Tue Dec 13 13:58:29 2022
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 13 Dec 2022 13:58:29 -0800
Subject: [gdal-dev] [Tiff] libtiff v4.5.0 rc2 available
In-Reply-To: <ce97eb57-225c-2f14-7bcd-e2c741149cf3@spatialys.com>
References: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>
 <CACmBxyuehb-_3VgJQk-6-po=u1ge3UBP=8xOD5rSv26mvVs_Aw@mail.gmail.com>
 <ce97eb57-225c-2f14-7bcd-e2c741149cf3@spatialys.com>
Message-ID: <CACmBxyvdai62Lbxn70p7a7vvTNaGnkX0dgatLGD2cFgOqCC7Pg@mail.gmail.com>

I patched that in and it works for me.

Thanks!

On Tue, Dec 13, 2022 at 1:47 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi Kurt,
>
> thanks for the feedback (and invalidating my prophecy that rc2 would be
> the last one :-))
>
> should be fixed with
> https://gitlab.com/libtiff/libtiff/-/merge_requests/444.
>
> Is that enough to get the build working for you before I generate a rc3
> with that extra fix ?
>
> Even
> Le 13/12/2022 ? 22:39, Kurt Schwehr a ?crit :
>
> I'm seeing mac osx and ios failures at my most recent sync of
> c4516f9dc72bad7f2c4a8f704169afa0342e44ca
> <https://www.google.com/url?sa=D&q=https%3A%2F%2Fgitlab.com%2Flibtiff%2Flibtiff%2Fcommit%2Fc4516f9dc72bad7f2c4a8f704169afa0342e44ca>:
>
>
> third_party/tiff/libtiff/tif_dir.c:1988:17: error: format specifies type
> 'unsigned short' but the argument has type 'tdir_t' (aka 'unsigned int')
> [-Werror,-Wformat]
>                 *nextdirnum, *nextdiroff, *nextdiroff, (int)(*nextdirnum)
> - 1);
>                 ^~~~~~~~~~~
> third_party/tiff/libtiff/tif_dir.c:2164:27: error: format specifies type
> 'unsigned short' but the argument has type 'tdir_t' (aka 'unsigned int')
> [-Werror,-Wformat]
>                           dirn);
>                           ^~~~
>
>
>
> On Tue, Dec 13, 2022 at 12:39 PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Hi,
>>
>> The changes in IFD loop detection are non-trivial enough to justify a
>> rc2, so here it is:
>>
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz.sig
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz.sig
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip
>> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip.sig
>>
>> Hopefully this will be the final release candidate for 4.5.0. Please
>> test and report.
>>
>> The changes since rc1 are:
>> - restore formatting of tiffvers.h so that FindTIFF.cmake can infer
>> libtiff version number
>> - addition of TIFFLIB_MAJOR_VERSION, TIFFLIB_MINOR_VERSION,
>> TIFFLIB_MICRO_VERSION in tiffvers.h
>> - introduction of TIFFLIB_AT_LEAST(major, minor, micro) macro in
>> tiffvers.h
>> - CMake: restore BUILD_SHARED_LIBS=ON default setting for top-level builds
>> - IFD loop detection: changed algorithm to use a hashset/hashmap for
>> good performance
>> - tdir_t type updated to uint32_t. This type is now used for the return
>> value of TIFFCurrentDirectory and TIFFNumberOfDirectories, and as the
>> argument of TIFFSetDirectory and TIFFUnlinkDirectory
>> - Increase the maximum number of IFDs that libtiff can browse through
>> from 65535 to 1048576. This value is a build-time setting, available in
>> tif_config.h, that can be configured with CMake's TIFF_MAX_DIR_COUNT and
>> variable or autoconf's --with-max-dir-count option.
>> - tiffinfo: support more than 64k IFDs.
>>
>> Even
>>
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> Tiff mailing list
>> Tiff at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/tiff
>>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/e40fffc1/attachment-0001.htm>

From even.rouault at spatialys.com  Tue Dec 13 14:35:05 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 13 Dec 2022 23:35:05 +0100
Subject: [gdal-dev] rc3 is available (was Re: libtiff v4.5.0 rc2 available)
In-Reply-To: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>
References: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>
Message-ID: <a10f90ed-fe67-94ce-36cb-d2e7a563189d@spatialys.com>

Here's RC3 with the fix for the issue Kurt raised (and a few relatted 
formatting printf() tidy up):

- https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.gz
- https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.gz.sig
- https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.xz
- https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.xz.sig
- https://download.osgeo.org/libtiff/tiff-4.5.0rc3.zip
- https://download.osgeo.org/libtiff/tiff-4.5.0rc3.zip.sig

Le 13/12/2022 ? 21:39, Even Rouault a ?crit?:
> Hi,
>
> The changes in IFD loop detection are non-trivial enough to justify a 
> rc2, so here it is:
>
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip.sig
>
> Hopefully this will be the final release candidate for 4.5.0. Please 
> test and report.
>
> The changes since rc1 are:
> - restore formatting of tiffvers.h so that FindTIFF.cmake can infer 
> libtiff version number
> - addition of TIFFLIB_MAJOR_VERSION, TIFFLIB_MINOR_VERSION, 
> TIFFLIB_MICRO_VERSION in tiffvers.h
> - introduction of TIFFLIB_AT_LEAST(major, minor, micro) macro in 
> tiffvers.h
> - CMake: restore BUILD_SHARED_LIBS=ON default setting for top-level 
> builds
> - IFD loop detection: changed algorithm to use a hashset/hashmap for 
> good performance
> - tdir_t type updated to uint32_t. This type is now used for the 
> return value of TIFFCurrentDirectory and TIFFNumberOfDirectories, and 
> as the argument of TIFFSetDirectory and TIFFUnlinkDirectory
> - Increase the maximum number of IFDs that libtiff can browse through 
> from 65535 to 1048576. This value is a build-time setting, available 
> in tif_config.h, that can be configured with CMake's 
> TIFF_MAX_DIR_COUNT and variable or autoconf's --with-max-dir-count 
> option.
> - tiffinfo: support more than 64k IFDs.
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Tue Dec 13 15:19:11 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 14 Dec 2022 00:19:11 +0100
Subject: [gdal-dev] GDAL 3.6.1 rc1 available
Message-ID: <5f128576-273d-e9cb-da93-80cbab1b0d98@spatialys.com>

Hi,

As mentioned in earlier email, this release is done ahead of the planned 
schedule to fix a corruption when generating spatial index of GeoPackage 
file with large number of features with GDAL 3.6.0, which will be 
officially retracted once 3.6.1 is promoted.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.6.1/gdal-3.6.1rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.6.1/gdal-3.6.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.6.1/gdal361rc1.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.6.1/gdalautotest-3.6.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.6.1/gdalautotest-3.6.1rc1.zip

The NEWS file is here :

 ? https://github.com/OSGeo/gdal/blob/v3.6.1RC1/NEWS.md

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From daniel.mannarino at gmail.com  Tue Dec 13 18:46:36 2022
From: daniel.mannarino at gmail.com (Daniel Mannarino)
Date: Tue, 13 Dec 2022 21:46:36 -0500
Subject: [gdal-dev] Trouble using TEMPORARY=ON with ogr2ogr
In-Reply-To: <c2978771-64c7-5dc8-63d9-2c6ce7632902@spatialys.com>
References: <CAO8qHHGKVmgVGVjr63Pi9R7E5jC7pgHe-QirFbRiRcgj9nsM_g@mail.gmail.com>
 <c2978771-64c7-5dc8-63d9-2c6ce7632902@spatialys.com>
Message-ID: <CAO8qHHELkpGWobbcOPgFOjg94ZyNU-MQFqr=6au0FNW0OPT4iQ@mail.gmail.com>

Thank you (and Jeremy Palmer) so much!
I eagerly await the release with the fix. I'd be happy to contribute a
usage example to the documentation if that's helpful.
Daniel Mannarino

On Sun, Dec 11, 2022 at 4:58 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> FYI Jeremy Palmer has just submitted a fix for that:
> https://github.com/OSGeo/gdal/pull/6896
> Le 30/11/2022 ? 16:12, Daniel Mannarino a ?crit :
>
> Hello!
>
>
> I'm having trouble using the temporary table option of ogr2ogr:
> https://gdal.org/drivers/vector/pg.html#layer-creation-options
>
> Ultimately I am trying to load data from a Shapefile into a temporary
> table, enrich the rows in the temporary table, and then copy from the
> temporary table into a final table. However I cannot get Postgres and
> ogr2ogr to work together. It sounds to me from the logs that they disagree
> on the table name. In my example code below I have removed everything that
> is to happen after loading the data (enriching, copying) for clarity.
>
>
> Very little is said about the temporary table option on the web, but from
> the source (and Postgres logs) it looks like ogr2ogr assumes a schema of
> "pg_temp_1":
> https://github.com/OSGeo/gdal/blob/dc39f7d68095621842a2547ab06c60a03fd34a19/ogr/ogrsf_frmts/pg/ogrpgdatasource.cpp#L1865-L1872
>
>
> It sounds to me from the Postgres docs this isn't safe to assume, but
> let's say it is for the moment.
>
>
> Here is my simplified script:
>
> #!/bin/bash
>
> set -e
>
>
> PGHOST="<host>"
>
> PGDATABASE="<db>"
>
> PGUSER="<user>"
>
> PGPASSWORD="<pass>"
>
> PGPORT=<port>
>
>
> LOCAL_FILE="/vsizip/test.shp.zip"
>
> SRC_LAYER="test"
>
> FID_NAME="gfw_fid"
>
> GEOMETRY_NAME="geom"
>
> TEMP_SCHEMA="pg_temp_1"
>
> TEMP_TABLE="bazinga"
>
>
>
> ogr2ogr -f "PostgreSQL" PG:"password=$PGPASSWORD host=$PGHOST port=$PGPORT
> dbname=$PGDATABASE user=$PGUSER" \
>
>     "$LOCAL_FILE" "$SRC_LAYER" \
>
>     -lco GEOMETRY_NAME="$GEOMETRY_NAME" \
>
>     -lco SPATIAL_INDEX=NONE \
>
>     -lco FID="$FID_NAME" \
>
>     -lco TEMPORARY=ON \
>
>     -nlt PROMOTE_TO_MULTI \
>
>     -nln "$TEMP_SCHEMA.$TEMP_TABLE" \
>
>    -t_srs EPSG:4326 \
>
>     --config PG_USE_COPY YES \
>
>     -makevalid -update
>
>
> # End of script
>
>
>
> Here is the Postgres log from attempting to run this script with the
> Shapefile in the PS:
>
>
> # START LOG
>
> 2022-11-28 21:16:51.206 UTC [504] LOG:  statement: set client_encoding to
> 'UTF8'
>
> 2022-11-28 21:16:51.209 UTC [504] LOG:  execute <unnamed>: SHOW
> client_encoding
>
> 2022-11-28 21:16:51.239 UTC [504] LOG:  execute <unnamed>: SELECT
> n.nspname FROM pg_proc p JOIN pg_namespace n ON n.oid = p.pronamespace
> WHERE proname = 'postgis_version'
>
> 2022-11-28 21:16:51.245 UTC [504] LOG:  execute <unnamed>: SELECT version()
>
> 2022-11-28 21:16:51.246 UTC [504] LOG:  execute <unnamed>: SHOW
> standard_conforming_strings
>
> 2022-11-28 21:16:51.250 UTC [504] LOG:  execute <unnamed>: SELECT oid,
> typname FROM pg_type WHERE typname IN ('geometry', 'geography') AND
> typtype='b'
>
> 2022-11-28 21:16:51.323 UTC [504] LOG:  execute <unnamed>: SELECT
> postgis_version()
>
> 2022-11-28 21:16:51.326 UTC [504] LOG:  execute <unnamed>: SET
> ENABLE_SEQSCAN = ON
>
> 2022-11-28 21:16:51.342 UTC [504] LOG:  execute <unnamed>: SELECT 1 FROM
> information_schema.tables WHERE table_name = 'geometry_columns' LIMIT 1
>
> 2022-11-28 21:16:51.345 UTC [504] LOG:  execute <unnamed>: SELECT 1 FROM
> information_schema.tables WHERE table_name = 'spatial_ref_sys' LIMIT 1
>
> 2022-11-28 21:16:51.354 UTC [504] LOG:  execute <unnamed>: SELECT
> ST_Srid('POINT EMPTY'::GEOMETRY)
>
> 2022-11-28 21:16:51.356 UTC [504] LOG:  execute <unnamed>: SELECT
> current_schema()
>
> 2022-11-28 21:16:51.394 UTC [504] LOG:  execute <unnamed>: BEGIN
>
> 2022-11-28 21:16:51.415 UTC [504] LOG:  execute <unnamed>: SELECT c.oid
> FROM pg_class c JOIN pg_namespace n ON c.relnamespace=n.oid WHERE c.relname
> = 'bazinga' AND n.nspname = 'pg_temp_1'
>
> 2022-11-28 21:16:51.418 UTC [504] LOG:  execute <unnamed>: SELECT c.oid
> FROM pg_class c JOIN pg_namespace n ON c.relnamespace=n.oid WHERE c.relname
> = 'bazinga' AND n.nspname = 'pg_temp_1'
>
> 2022-11-28 21:16:51.439 UTC [504] LOG:  execute <unnamed>: SELECT
> c.relname, n.nspname, c.relkind, a.attname, t.typname,
> postgis_typmod_dims(a.atttypmod) dim, postgis_typmod_srid(a.atttypmod)
> srid, postgis_typmod_type(a.atttypmod)::text geomtyp,
> array_agg(pg_get_constraintdef(s.oid))::text att_constraints, a.attnotnull,
> d.description FROM pg_class c JOIN pg_attribute a ON a.attrelid=c.oid JOIN
> pg_namespace n ON c.relnamespace = n.oid AND c.relkind in ('r','v','m','f')
> AND NOT ( n.nspname = 'public' AND c.relname = 'raster_columns' ) JOIN
> pg_type t ON a.atttypid = t.oid AND (t.typname = 'geometry'::name OR
> t.typname = 'geography'::name) LEFT JOIN pg_constraint s ON s.connamespace
> = n.oid AND s.conrelid = c.oid AND a.attnum = ANY (s.conkey) AND
> (pg_get_constraintdef(s.oid) LIKE '%geometrytype(% = %' OR
> pg_get_constraintdef(s.oid) LIKE '%ndims(% = %' OR
> pg_get_constraintdef(s.oid) LIKE '%srid(% = %') LEFT JOIN pg_description d
> ON d.objoid = c.oid AND d.classoid = 'pg_class'::regclass::oid AND
> d.objsubid = 0 GROUP BY c.relname, n.nspname, c.relkind, a.attname,
> t.typname, dim, srid, geomtyp, a.attnotnull, c.oid, a.attnum, d.description
> ORDER BY c.oid, a.attnum
>
> 2022-11-28 21:16:51.452 UTC [504] LOG:  execute <unnamed>: SELECT srid
> FROM spatial_ref_sys WHERE auth_name = 'EPSG' AND auth_srid = 4326
>
> 2022-11-28 21:16:51.545 UTC [504] LOG:  execute <unnamed>: CREATE
> TEMPORARY TABLE "bazinga" ( "gfw_fid" SERIAL, PRIMARY KEY ("gfw_fid"),
> "fid" NUMERIC(11,0), "geom" geometry(MULTIPOLYGON,4326) )
>
> 2022-11-28 21:16:51.575 UTC [504] LOG:  execute <unnamed>: COMMENT ON
> TABLE "pg_temp_1"."bazinga" IS NULL
>
> 2022-11-28 21:16:51.575 UTC [504] ERROR:  relation "pg_temp_1.bazinga"
> does not exist
>
> 2022-11-28 21:16:51.575 UTC [504] STATEMENT:  COMMENT ON TABLE
> "pg_temp_1"."bazinga" IS NULL
>
> 2022-11-28 21:16:51.585 UTC [504] ERROR:  current transaction is aborted,
> commands ignored until end of transaction block
>
> 2022-11-28 21:16:51.585 UTC [504] STATEMENT:  COPY "pg_temp_1"."bazinga"
> ("geom", "fid") FROM STDIN;
>
> 2022-11-28 21:16:51.587 UTC [504] LOG:  execute <unnamed>: ROLLBACK
>
>
> # END LOG
>
>
>
> I have tried many variations of quoting the table and schema name to no
> avail (including
>
>     -nln "\"$TEMP_SCHEMA\".\"$TEMP_TABLE\"" \
>
> ).
>
>
> I also tried wrapping the whole thing in a transaction by specifying
>
>     -doo PRELUDE_STATEMENTS="BEGIN;" \
>
>     -doo CLOSING_STATEMENTS="COMMIT;" \
>
>
> Can anyone explain how to get this to work? I actually first tried to
> create a temporary table by myself with -doo, but ran into other problems
> and will leave that for another thread.
>
>
> Thanks!
>
> Daniel Mannarino
>
>
> PS: Here's the Shapefile I'm using:
> https://github.com/wri/gfw-data-api/blob/master/tests/fixtures/test.shp.zip
>
> PPS: I am running PostgreSQL 12 (specifically the
> postgis/postgis:12-2.5-alpine Docker image) and running ogr2ogr from
> Homebrew's GDAL 3.5.3 package on MacOS 12.6 (amd64).
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221213/349b976d/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec 13 23:18:50 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 14 Dec 2022 07:18:50 +0000
Subject: [gdal-dev] gdalwarp running very slow
In-Reply-To: <CA+kQ3muFbEM_4fRiHsYieT=+OBDBJ8gF80zVX==D6svoQ7akQQ@mail.gmail.com>
References: <CA+kQ3muFbEM_4fRiHsYieT=+OBDBJ8gF80zVX==D6svoQ7akQQ@mail.gmail.com>
Message-ID: <AM0PR09MB32196BDD9C295B3D4A7A3F6DFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Thank you for the information about the source files. I do not yet understand what you are trying to do and why. The both images have the same size 450000 and 225000 and they cover the same area. Is the "image 5_UK_coastal-2020.tif" just NoData with pixel value -9999 everywhere outside the UK? The name of the image makes me think so.

-Jukka Rahkonen-


L?hett?j?: Clive Swan <cliveswan at gmail.com>
L?hetetty: tiistai 13. joulukuuta 2022 19.22
Vastaanottaja: gdal-dev at lists.osgeo.org
Kopio: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: [gdal-dev] gdalwarp running very slow

 Greetings,
I am using the same files, I copied them from an AWS Bucket to a local AWS Instance.
I tried gdal_merge << tries to create 300GB file
I tried gdal_translate ran but created 2.5 GB not 6.9 GB file
Now trying gdalwarp.

the gdalinfo is the same in both datasets:

coastal-2020.tif (6.9GB)
Driver: GTiff/GeoTIFF
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)
Metadata:
  AREA_OR_POINT=Area
  datetime_created=2022-11-14 18:05:14.053301
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
  PREDICTOR=3
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
  Description = score
  NoData Value=-9999
Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_value
  NoData Value=-9999
Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_min
  NoData Value=-9999
Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_max
  NoData Value=-9999
Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood
  NoData Value=-9999
Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = return_time
  NoData Value=-9999
Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood_confidence
  NoData Value=-9999
Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = climate_reliability
  NoData Value=-9999
Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = hazard_reliability
  NoData Value=-9999


5_UK_coastal-2020.tif (600MB)
Driver: GTiff/GeoTIFF
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)
Metadata:
  AREA_OR_POINT=Area
  datetime_created=2022-11-14 18:05:14.053301
  hostname=posix.uname_result(sysname='Linux', nodename='ip-172-31-12-125', release='5.15.0-1022-aws', version='#26~20.04.1-Ubuntu SMP Sat Oct 15 03:22:07 UTC 2022', machine='x86_64')
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
  PREDICTOR=3
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
  Description = score
  NoData Value=-9999
Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_value
  NoData Value=-9999
Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_min
  NoData Value=-9999
Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_max
  NoData Value=-9999
Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood
  NoData Value=-9999
Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = return_time
  NoData Value=-9999
Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood_confidence
  NoData Value=-9999
Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = climate_reliability
  NoData Value=-9999
Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = hazard_reliability
  NoData Value=-9999

--

 Regards,



Clive Swan

--

Hi,



If you are still struggling with the same old problem could you please finally send the gdalinfo reports of your two input files which are this time:

coastal-2020.tif

5_UK_coastal-2020.tif



-Jukka Rahkonen-





L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C5d7db77b38f444c43dcf08dadd2e925b%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638065489336507804%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=nrK3Bq8p1cpYu%2Ff4qQO4TriuOaupVTK%2FPk47Sv6KYnQ%3D&reserved=0>> Puolesta Clive Swan

L?hetetty: tiistai 13. joulukuuta 2022 17.23

Vastaanottaja: gdal-dev at lists.osgeo.org<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C5d7db77b38f444c43dcf08dadd2e925b%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638065489336507804%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=nrK3Bq8p1cpYu%2Ff4qQO4TriuOaupVTK%2FPk47Sv6KYnQ%3D&reserved=0>

Aihe: [gdal-dev] gdalwarp running very slow



Greetings,

I am running gdalwarp on a 6GB (output) and 600MB (input) tif image, the AWS Instance has approx 60 VCPU

It has taken over 6 hours so far - still running, is it possible to optimise this and speed it up??



gdalwarp -r near -overwrite coastal-2020.tif   5_UK_coastal-2020.tif -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221214/c180b143/attachment-0001.htm>

From cliveswan at gmail.com  Wed Dec 14 08:33:44 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Wed, 14 Dec 2022 16:33:44 +0000
Subject: [gdal-dev] gdalwarp running very slow
In-Reply-To: <AM0PR09MB32197E9D500115EFBF3ED8BBFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <CA+kQ3muFbEM_4fRiHsYieT=+OBDBJ8gF80zVX==D6svoQ7akQQ@mail.gmail.com>
 <AM0PR09MB32196BDD9C295B3D4A7A3F6DFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB3959DD337E74534708C90F3DA0E09@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB32197E9D500115EFBF3ED8BBFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CA+kQ3msje4GxUE+XmpCU-K9wbYt5WzosXqzhujT4N+Q7H3EhtA@mail.gmail.com>

I want to *APPEND* the UK data into the international.tif
The updated international size should also be: 450000, 225000

*I first tried *
gdalbuildvrt -o /data/coastal-2020.vrt  /vsis3/summer/3/coastal-2020.tif
/vsis3/summer/5/coastal-2020.tif

gdal_translate /data/coastal-2020.vrt  /data/3/coastal-2020.tif
/data/5/coastal-2020.tif   -n -9999 -co BIGTIFF=YES -co COMPRESS=LZW -co
BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config
CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config

*The output was rubbish*


The UK image size is: 18376, 17086
The international size is: 450000, 225000

I tried
/data/3/coastal-2020-test.tif = 7GB
/data/5/coastal-2020.tif  = 700MB

gdalwarp -r near -overwrite /data/3/coastal-2020.tif
/data/3/coastal-2020-test1.tif  -co BIGTIFF=YES -co COMPRESS=LZW -co
BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS -co PREDICTOR=3
--config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES & disown -h

The AWS Instance with over 60 VCPU ran for over 8 hours


I tried:
/data/5/coastal-2020.tif  = 700MB
/data/3/coastal-2020-test.tif = 7GB

gdalwarp -r near -overwrite /data/5/coastal-2020.tif
/data/3/coastal-2020-test.tif  -co BIGTIFF=YES -co COMPRESS=LZW -co
BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS -co PREDICTOR=3
--config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES

The output is: 18376, 17086 *not* 450000, 225000

Any assistance appreciated

Thanks

Clive

On Wed, 14 Dec 2022 at 09:23, Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> I don?t mean that you should try this and that blindly but to describe
> what data you have in your hands and what you are planning to do with it so
> that the other GDAL users could consider what reasonable alternatives you
> could have. I have never done anything that is even close to your use case
> but due to other experience I can see potential issues in a few places:
>
>    - You try to update image A that has a size 450000 by 225000 pixels
>    with image B that has the same size. The result would be A updated into a
>    full copy of B if all pixels in B are valid.
>    - However, image B probably has very much NoData (we do not know
>    because you have not told that) and if GDAL deals with NoData correctly the
>    result would be A updated with valid pixels from B and that is probably
>    what is desired.
>    - However, we do not know how effectively GDAL skips the nodata pixels
>    of B. It may be fast or not. If we know that most part of the world is
>    NoData it might be good to crop image B to include just the area where
>    there is data. That?s maybe UK in your case. If skipping the NoData is fast
>    then cropping won?t give speedup but it is cheap to test.
>    - You have compressed images. LZW algorithm is compressing some data
>    more effectively than some other. If you expect that you can replace a
>    chunk of LZW compressed data inside a TIFF file with another chunk of LZW
>    compressed data in place you are wrong. The new chunk of data may be larger
>    and it just cannot fit into the same space. Assumption that updating a 6 GB
>    image with 600 MB new data would yield a 6 GB image is not correct with
>    compressed data.
>    - I can imagine that there could be other technical reasons to write
>    the replacing data at the end of the existing TIFF and update the image
>    directories. If the image size is critical it may require re-writing the
>    updated TIFF into a new TIFF file. The complete re-write can be done in
>    most optimal way. See this wiki page
>    https://trac.osgeo.org/gdal/wiki/UserDocs/GdalWarp#GeoTIFFoutput-coCOMPRESSisbroken
>    - If the images are in AWS it is possible that the process should be
>    somehow different than with local images. I have no experience about AWS
>    yet.
>    - A 450000 by 225000 image is rather big. It is possible that it would
>    be faster to split the image into smaller parts, update the parts that need
>    updating, and combine the parts back into a big image. Or keep the parts
>    and combine them virtually with gdalbuildvrt into VRT.
>
>
>
> Your use case is not so usual and it is rather heavy but there are
> certainly several ways to do what you want. What should be avoided it to
> select an inefficient method and try to optimize it.
>
>
>
> Good luck with your experiments,
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Clive Swan <cliveswan at gmail.com>
> *L?hetetty:* keskiviikko 14. joulukuuta 2022 10.29
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: [gdal-dev] gdalwarp running very slow
>
>
>
> Hi Jukka,
>
>
>
> Thanks for that, was really stressed.
>
> I will export the UK extent, and rerun the script.
>
>
>
> Thanks
>
> Clive
>
>
>
> Sent from Outlook for Android
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2FAAb9ysg&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C23104e51c7df4d425ea008daddad3302%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066033206354325%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=y3osHPcjOOvs6KrQUG6q2u1%2Bzyp8dCprHYhf%2Fza4aKY%3D&reserved=0>
> ------------------------------
>
> *From:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Sent:* Wednesday, December 14, 2022 7:18:50 AM
> *To:* Clive Swan <cliveswan at gmail.com>; gdal-dev at lists.osgeo.org <
> gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdalwarp running very slow
>
>
>
> Hi,
>
>
>
> Thank you for the information about the source files. I do not yet
> understand what you are trying to do and why. The both images have the same
> size 450000 and 225000 and they cover the same area. Is the ?image
> 5_UK_coastal-2020.tif? just NoData with pixel value -9999 everywhere
> outside the UK? The name of the image makes me think so.
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
> *L?hett?j?:* Clive Swan <cliveswan at gmail.com>
> *L?hetetty:* tiistai 13. joulukuuta 2022 19.22
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Kopio:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* [gdal-dev] gdalwarp running very slow
>
>
>
>  Greetings,
>
> I am using the same files, I copied them from an AWS Bucket to a local AWS
> Instance.
>
> I tried gdal_merge << tries to create 300GB file
>
> I tried gdal_translate ran but created 2.5 GB not 6.9 GB file
>
> Now trying gdalwarp.
>
>
>
> the gdalinfo is the same in both datasets:
>
> coastal-2020.tif (6.9GB)
>
> Driver: GTiff/GeoTIFF
> Size is 450000, 225000
> Coordinate System is:
> GEOGCRS["WGS 84",
>     DATUM["World Geodetic System 1984",
>         ELLIPSOID["WGS 84",6378137,298.257223563,
>             LENGTHUNIT["metre",1]]],
>     PRIMEM["Greenwich",0,
>         ANGLEUNIT["degree",0.0174532925199433]],
>     CS[ellipsoidal,2],
>         AXIS["geodetic latitude (Lat)",north,
>             ORDER[1],
>             ANGLEUNIT["degree",0.0174532925199433]],
>         AXIS["geodetic longitude (Lon)",east,
>             ORDER[2],
>             ANGLEUNIT["degree",0.0174532925199433]],
>     ID["EPSG",4326]]
> Data axis to CRS axis mapping: 2,1
> Origin = (-180.000000000000000,90.000000000000000)
> Pixel Size = (0.000800000000000,-0.000800000000000)
> Metadata:
>   AREA_OR_POINT=Area
>   datetime_created=2022-11-14 18:05:14.053301
> Image Structure Metadata:
>   COMPRESSION=LZW
>   INTERLEAVE=BAND
>   PREDICTOR=3
> Corner Coordinates:
> Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
> Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
> Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
> Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
> Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
> Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
>   Description = score
>   NoData Value=-9999
> Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = severity_value
>   NoData Value=-9999
> Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = severity_min
>   NoData Value=-9999
> Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = severity_max
>   NoData Value=-9999
> Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = likelihood
>   NoData Value=-9999
> Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = return_time
>   NoData Value=-9999
> Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = likelihood_confidence
>   NoData Value=-9999
> Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = climate_reliability
>   NoData Value=-9999
> Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = hazard_reliability
>   NoData Value=-9999
>
>
>
> 5_UK_coastal-2020.tif (600MB)
>
> Driver: GTiff/GeoTIFF
> Size is 450000, 225000
> Coordinate System is:
> GEOGCRS["WGS 84",
>     DATUM["World Geodetic System 1984",
>         ELLIPSOID["WGS 84",6378137,298.257223563,
>             LENGTHUNIT["metre",1]]],
>     PRIMEM["Greenwich",0,
>         ANGLEUNIT["degree",0.0174532925199433]],
>     CS[ellipsoidal,2],
>         AXIS["geodetic latitude (Lat)",north,
>             ORDER[1],
>             ANGLEUNIT["degree",0.0174532925199433]],
>         AXIS["geodetic longitude (Lon)",east,
>             ORDER[2],
>             ANGLEUNIT["degree",0.0174532925199433]],
>     ID["EPSG",4326]]
> Data axis to CRS axis mapping: 2,1
> Origin = (-180.000000000000000,90.000000000000000)
> Pixel Size = (0.000800000000000,-0.000800000000000)
> Metadata:
>   AREA_OR_POINT=Area
>   datetime_created=2022-11-14 18:05:14.053301
>   hostname=posix.uname_result(sysname='Linux',
> nodename='ip-172-31-12-125', release='5.15.0-1022-aws',
> version='#26~20.04.1-Ubuntu SMP Sat Oct 15 03:22:07 UTC 2022',
> machine='x86_64')
> Image Structure Metadata:
>   COMPRESSION=LZW
>   INTERLEAVE=BAND
>   PREDICTOR=3
> Corner Coordinates:
> Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
> Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
> Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
> Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
> Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
> Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
>   Description = score
>   NoData Value=-9999
> Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = severity_value
>   NoData Value=-9999
> Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = severity_min
>   NoData Value=-9999
> Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = severity_max
>   NoData Value=-9999
> Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = likelihood
>   NoData Value=-9999
> Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = return_time
>   NoData Value=-9999
> Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = likelihood_confidence
>   NoData Value=-9999
> Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = climate_reliability
>   NoData Value=-9999
> Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
>   Description = hazard_reliability
>   NoData Value=-9999
>
> --
>
>  Regards,
>
>
>
> Clive Swan
>
> --
>
> Hi,
>
>
>
> If you are still struggling with the same old problem could you please finally send the gdalinfo reports of your two input files which are this time:
>
> coastal-2020.tif
>
> 5_UK_coastal-2020.tif
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C23104e51c7df4d425ea008daddad3302%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066033206354325%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=CXQisAtn9pOYceYi%2FOb3t5q5cnSyvuCXcbUQcttrOWw%3D&reserved=0>> Puolesta Clive Swan
>
> L?hetetty: tiistai 13. joulukuuta 2022 17.23
>
> Vastaanottaja: gdal-dev at lists.osgeo.org <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C23104e51c7df4d425ea008daddad3302%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066033206510566%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=7dYGZEvrPMXi%2BDKseAc4HeYW%2FdDa%2BAqEAQfwX%2B6bF5E%3D&reserved=0>
>
> Aihe: [gdal-dev] gdalwarp running very slow
>
>
>
> Greetings,
>
> I am running gdalwarp on a 6GB (output) and 600MB (input) tif image, the AWS Instance has approx 60 VCPU
>
> It has taken over 6 hours so far - still running, is it possible to optimise this and speed it up??
>
>
>
> gdalwarp -r near -overwrite coastal-2020.tif   5_UK_coastal-2020.tif -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
>
>

-- 

 Regards,


Clive Swan

--


M: +44 7766 452665
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221214/4cebd162/attachment-0001.htm>

From andrew at aitchison.me.uk  Wed Dec 14 09:49:39 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 14 Dec 2022 17:49:39 +0000 (GMT)
Subject: [gdal-dev] gdalwarp running very slow
In-Reply-To: <CA+kQ3msje4GxUE+XmpCU-K9wbYt5WzosXqzhujT4N+Q7H3EhtA@mail.gmail.com>
References: <CA+kQ3muFbEM_4fRiHsYieT=+OBDBJ8gF80zVX==D6svoQ7akQQ@mail.gmail.com>
 <AM0PR09MB32196BDD9C295B3D4A7A3F6DFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB3959DD337E74534708C90F3DA0E09@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB32197E9D500115EFBF3ED8BBFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CA+kQ3msje4GxUE+XmpCU-K9wbYt5WzosXqzhujT4N+Q7H3EhtA@mail.gmail.com>
Message-ID: <cf9b8c5f-66a9-322a-b992-edc05d9e46bf@aitchison.me.uk>

On Wed, 14 Dec 2022, Clive Swan wrote:

> I want to *APPEND* the UK data into the international.tif
> The updated international size should also be: 450000, 225000
>
> *I first tried *
> gdalbuildvrt -o /data/coastal-2020.vrt  /vsis3/summer/3/coastal-2020.tif
> /vsis3/summer/5/coastal-2020.tif
>
> gdal_translate /data/coastal-2020.vrt  /data/3/coastal-2020.tif
> /data/5/coastal-2020.tif   -n -9999 -co BIGTIFF=YES -co COMPRESS=LZW -co
> BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config
> CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config
>
> *The output was rubbish*
>
>
> The UK image size is: 18376, 17086

> 5_UK_coastal-2020.tif (600MB)
>
> Driver: GTiff/GeoTIFF
> Size is 450000, 225000
 		...		...
> Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
> Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
> Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
> Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
> Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)

... which is why we thought the UK data was 450000, 225000

I might be tempted to add "-co TILED=YES"
but I am still not very clear about what is actually going on.

> The international size is: 450000, 225000
>
> I tried
> /data/3/coastal-2020-test.tif = 7GB
> /data/5/coastal-2020.tif  = 700MB
>
> gdalwarp -r near -overwrite /data/3/coastal-2020.tif
> /data/3/coastal-2020-test1.tif  -co BIGTIFF=YES -co COMPRESS=LZW -co
> BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS -co PREDICTOR=3
> --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES & disown -h
>
> The AWS Instance with over 60 VCPU ran for over 8 hours
>
>
> I tried:
> /data/5/coastal-2020.tif  = 700MB
> /data/3/coastal-2020-test.tif = 7GB
>
> gdalwarp -r near -overwrite /data/5/coastal-2020.tif
  > /data/3/coastal-2020-test.tif  -co BIGTIFF=YES -co COMPRESS=LZW -co
> BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS -co PREDICTOR=3
> --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
>
> The output is: 18376, 17086 *not* 450000, 225000
>
> Any assistance appreciated
>
> Thanks
>
> Clive
>
> On Wed, 14 Dec 2022 at 09:23, Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
>> Hi,
>>
>>
>>
>> I don?t mean that you should try this and that blindly but to describe
>> what data you have in your hands and what you are planning to do with it so
>> that the other GDAL users could consider what reasonable alternatives you
>> could have. I have never done anything that is even close to your use case
>> but due to other experience I can see potential issues in a few places:
>>
>>    - You try to update image A that has a size 450000 by 225000 pixels
>>    with image B that has the same size. The result would be A updated into a
>>    full copy of B if all pixels in B are valid.
>>    - However, image B probably has very much NoData (we do not know
>>    because you have not told that) and if GDAL deals with NoData correctly the
>>    result would be A updated with valid pixels from B and that is probably
>>    what is desired.
>>    - However, we do not know how effectively GDAL skips the nodata pixels
>>    of B. It may be fast or not. If we know that most part of the world is
>>    NoData it might be good to crop image B to include just the area where
>>    there is data. That?s maybe UK in your case. If skipping the NoData is fast
>>    then cropping won?t give speedup but it is cheap to test.
>>    - You have compressed images. LZW algorithm is compressing some data
>>    more effectively than some other. If you expect that you can replace a
>>    chunk of LZW compressed data inside a TIFF file with another chunk of LZW
>>    compressed data in place you are wrong. The new chunk of data may be larger
>>    and it just cannot fit into the same space. Assumption that updating a 6 GB
>>    image with 600 MB new data would yield a 6 GB image is not correct with
>>    compressed data.
>>    - I can imagine that there could be other technical reasons to write
>>    the replacing data at the end of the existing TIFF and update the image
>>    directories. If the image size is critical it may require re-writing the
>>    updated TIFF into a new TIFF file. The complete re-write can be done in
>>    most optimal way. See this wiki page
>>    https://trac.osgeo.org/gdal/wiki/UserDocs/GdalWarp#GeoTIFFoutput-coCOMPRESSisbroken
>>    - If the images are in AWS it is possible that the process should be
>>    somehow different than with local images. I have no experience about AWS
>>    yet.
>>    - A 450000 by 225000 image is rather big. It is possible that it would
>>    be faster to split the image into smaller parts, update the parts that need
>>    updating, and combine the parts back into a big image. Or keep the parts
>>    and combine them virtually with gdalbuildvrt into VRT.
>>
>>
>>
>> Your use case is not so usual and it is rather heavy but there are
>> certainly several ways to do what you want. What should be avoided it to
>> select an inefficient method and try to optimize it.
>>
>>
>>
>> Good luck with your experiments,
>>
>>
>>
>> -Jukka-
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *L?hett?j?:* Clive Swan <cliveswan at gmail.com>
>> *L?hetetty:* keskiviikko 14. joulukuuta 2022 10.29
>> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>> *Aihe:* Re: [gdal-dev] gdalwarp running very slow
>>
>>
>>
>> Hi Jukka,
>>
>>
>>
>> Thanks for that, was really stressed.
>>
>> I will export the UK extent, and rerun the script.
>>
>>
>>
>> Thanks
>>
>> Clive
>>
>>
>>
>> Sent from Outlook for Android
>> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2FAAb9ysg&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C23104e51c7df4d425ea008daddad3302%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066033206354325%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=y3osHPcjOOvs6KrQUG6q2u1%2Bzyp8dCprHYhf%2Fza4aKY%3D&reserved=0>
>> ------------------------------
>>
>> *From:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>> *Sent:* Wednesday, December 14, 2022 7:18:50 AM
>> *To:* Clive Swan <cliveswan at gmail.com>; gdal-dev at lists.osgeo.org <
>> gdal-dev at lists.osgeo.org>
>> *Subject:* Re: [gdal-dev] gdalwarp running very slow
>>
>>
>>
>> Hi,
>>
>>
>>
>> Thank you for the information about the source files. I do not yet
>> understand what you are trying to do and why. The both images have the same
>> size 450000 and 225000 and they cover the same area. Is the ?image
>> 5_UK_coastal-2020.tif? just NoData with pixel value -9999 everywhere
>> outside the UK? The name of the image makes me think so.
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>>
>>
>> *L?hett?j?:* Clive Swan <cliveswan at gmail.com>
>> *L?hetetty:* tiistai 13. joulukuuta 2022 19.22
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Kopio:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>> *Aihe:* [gdal-dev] gdalwarp running very slow
>>
>>
>>
>>  Greetings,
>>
>> I am using the same files, I copied them from an AWS Bucket to a local AWS
>> Instance.
>>
>> I tried gdal_merge << tries to create 300GB file
>>
>> I tried gdal_translate ran but created 2.5 GB not 6.9 GB file
>>
>> Now trying gdalwarp.
>>
>>
>>
>> the gdalinfo is the same in both datasets:
>>
>> coastal-2020.tif (6.9GB)
>>
>> Driver: GTiff/GeoTIFF
>> Size is 450000, 225000
>> Coordinate System is:
>> GEOGCRS["WGS 84",
>>     DATUM["World Geodetic System 1984",
>>         ELLIPSOID["WGS 84",6378137,298.257223563,
>>             LENGTHUNIT["metre",1]]],
>>     PRIMEM["Greenwich",0,
>>         ANGLEUNIT["degree",0.0174532925199433]],
>>     CS[ellipsoidal,2],
>>         AXIS["geodetic latitude (Lat)",north,
>>             ORDER[1],
>>             ANGLEUNIT["degree",0.0174532925199433]],
>>         AXIS["geodetic longitude (Lon)",east,
>>             ORDER[2],
>>             ANGLEUNIT["degree",0.0174532925199433]],
>>     ID["EPSG",4326]]
>> Data axis to CRS axis mapping: 2,1
>> Origin = (-180.000000000000000,90.000000000000000)
>> Pixel Size = (0.000800000000000,-0.000800000000000)
>> Metadata:
>>   AREA_OR_POINT=Area
>>   datetime_created=2022-11-14 18:05:14.053301
>> Image Structure Metadata:
>>   COMPRESSION=LZW
>>   INTERLEAVE=BAND
>>   PREDICTOR=3
>> Corner Coordinates:
>> Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
>> Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
>> Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
>> Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
>> Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
>> Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
>>   Description = score
>>   NoData Value=-9999
>> Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = severity_value
>>   NoData Value=-9999
>> Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = severity_min
>>   NoData Value=-9999
>> Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = severity_max
>>   NoData Value=-9999
>> Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = likelihood
>>   NoData Value=-9999
>> Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = return_time
>>   NoData Value=-9999
>> Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = likelihood_confidence
>>   NoData Value=-9999
>> Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = climate_reliability
>>   NoData Value=-9999
>> Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = hazard_reliability
>>   NoData Value=-9999
>>
>>
>>
>> 5_UK_coastal-2020.tif (600MB)
>>
>> Driver: GTiff/GeoTIFF
>> Size is 450000, 225000
>> Coordinate System is:
>> GEOGCRS["WGS 84",
>>     DATUM["World Geodetic System 1984",
>>         ELLIPSOID["WGS 84",6378137,298.257223563,
>>             LENGTHUNIT["metre",1]]],
>>     PRIMEM["Greenwich",0,
>>         ANGLEUNIT["degree",0.0174532925199433]],
>>     CS[ellipsoidal,2],
>>         AXIS["geodetic latitude (Lat)",north,
>>             ORDER[1],
>>             ANGLEUNIT["degree",0.0174532925199433]],
>>         AXIS["geodetic longitude (Lon)",east,
>>             ORDER[2],
>>             ANGLEUNIT["degree",0.0174532925199433]],
>>     ID["EPSG",4326]]
>> Data axis to CRS axis mapping: 2,1
>> Origin = (-180.000000000000000,90.000000000000000)
>> Pixel Size = (0.000800000000000,-0.000800000000000)
>> Metadata:
>>   AREA_OR_POINT=Area
>>   datetime_created=2022-11-14 18:05:14.053301
>>   hostname=posix.uname_result(sysname='Linux',
>> nodename='ip-172-31-12-125', release='5.15.0-1022-aws',
>> version='#26~20.04.1-Ubuntu SMP Sat Oct 15 03:22:07 UTC 2022',
>> machine='x86_64')
>> Image Structure Metadata:
>>   COMPRESSION=LZW
>>   INTERLEAVE=BAND
>>   PREDICTOR=3
>> Corner Coordinates:
>> Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
>> Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
>> Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
>> Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
>> Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
>> Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
>>   Description = score
>>   NoData Value=-9999
>> Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = severity_value
>>   NoData Value=-9999
>> Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = severity_min
>>   NoData Value=-9999
>> Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = severity_max
>>   NoData Value=-9999
>> Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = likelihood
>>   NoData Value=-9999
>> Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = return_time
>>   NoData Value=-9999
>> Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = likelihood_confidence
>>   NoData Value=-9999
>> Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = climate_reliability
>>   NoData Value=-9999
>> Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
>>   Description = hazard_reliability
>>   NoData Value=-9999
>>
>> --
>>
>>  Regards,
>>
>>
>>
>> Clive Swan
>>
>> --
>>
>> Hi,
>>
>>
>>
>> If you are still struggling with the same old problem could you please finally send the gdalinfo reports of your two input files which are this time:
>>
>> coastal-2020.tif
>>
>> 5_UK_coastal-2020.tif
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>>
>>
>> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C23104e51c7df4d425ea008daddad3302%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066033206354325%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=CXQisAtn9pOYceYi%2FOb3t5q5cnSyvuCXcbUQcttrOWw%3D&reserved=0>> Puolesta Clive Swan
>>
>> L?hetetty: tiistai 13. joulukuuta 2022 17.23
>>
>> Vastaanottaja: gdal-dev at lists.osgeo.org <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C23104e51c7df4d425ea008daddad3302%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066033206510566%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=7dYGZEvrPMXi%2BDKseAc4HeYW%2FdDa%2BAqEAQfwX%2B6bF5E%3D&reserved=0>
>>
>> Aihe: [gdal-dev] gdalwarp running very slow
>>
>>
>>
>> Greetings,
>>
>> I am running gdalwarp on a 6GB (output) and 600MB (input) tif image, the AWS Instance has approx 60 VCPU
>>
>> It has taken over 6 hours so far - still running, is it possible to optimise this and speed it up??
>>
>>
>>
>> gdalwarp -r near -overwrite coastal-2020.tif   5_UK_coastal-2020.tif -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES
>>
>>
>
> -- 
>
> Regards,
>
>
> Clive Swan
>
> --
>
>
> M: +44 7766 452665
>

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec 14 10:55:25 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 14 Dec 2022 18:55:25 +0000
Subject: [gdal-dev] gdalwarp running very slow
In-Reply-To: <CA+kQ3msje4GxUE+XmpCU-K9wbYt5WzosXqzhujT4N+Q7H3EhtA@mail.gmail.com>
References: <CA+kQ3muFbEM_4fRiHsYieT=+OBDBJ8gF80zVX==D6svoQ7akQQ@mail.gmail.com>
 <AM0PR09MB32196BDD9C295B3D4A7A3F6DFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB3959DD337E74534708C90F3DA0E09@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB32197E9D500115EFBF3ED8BBFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CA+kQ3msje4GxUE+XmpCU-K9wbYt5WzosXqzhujT4N+Q7H3EhtA@mail.gmail.com>
Message-ID: <AM0PR09MB321953ADA263AD85A0F68F9EFDE09@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

You send new mails faster than I can read and understand the previous ones but here comes some quick comments.

  *   The gdalbuildvrt command looks good but it would be kind to tell which file is international and which one is UK. It is not obvious to me by the paths /5/ and /3/. You want to write the international file first into the VRT and UK after that to suit your workflow.
  *   This does not make sense: gdal_translate /data/coastal-2020.vrt  /data/3/coastal-2020.tif /data/5/coastal-2020.tif.  gdal_translate needs one input and one output, so: gdal_translate /data/coastal-2020.vrt output.tif
  *   I think that gdal_translate does not have option -n
  *   NUM_THREADS=ALL_CPUS is not a creation option -co, but an open option -oo, or it can be used as a configuration option
  *   It may be that -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  can really be used without -co TILED=YES. I have never tried. It is still essential that the output is tiled.
  *   Without testing I am not sure if the issues above make the input rubbish but it is possible.
  *   Your second and third trials are doomed to do something else than what you want very soon: gdalwarp -r near -overwrite. Overwrite switch means that the existing outputfile will be deleted and a new one with the same name will be created. You wanted just update the target file so don't use -overwrite. And when you use an existing file as a target the creation options have no effect; the target file is already created with some options.
  *   Now you understand why The output is: 18376, 17086 not 450000, 225000. (if not I can give a hint: what file did the -overwrite delete?)

I suppose that you start getting frustrated because testing all kind of random commands with huge images takes a long time ("The AWS Instance with over 60 VCPU ran for over 8 hours"). However, you could have made all your mistakes much faster with much smaller files (1000 by 1000 pixels for example). Make the commands work with small images and when you are satisfied test them with bigger images. That said, I cannot promise that you will have good performance with updating 450000, 225000 sized LZW compressed GeoTIFF. I have never tried anything like that with such a big image myself.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clive Swan
L?hetetty: keskiviikko 14. joulukuuta 2022 18.34
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdalwarp running very slow


I want to APPEND the UK data into the international.tif
The updated international size should also be: 450000, 225000

I first tried
gdalbuildvrt -o /data/coastal-2020.vrt  /vsis3/summer/3/coastal-2020.tif /vsis3/summer/5/coastal-2020.tif

gdal_translate /data/coastal-2020.vrt  /data/3/coastal-2020.tif /data/5/coastal-2020.tif   -n -9999 -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES  --config
The output was rubbish


The UK image size is: 18376, 17086
The international size is: 450000, 225000

I tried
/data/3/coastal-2020-test.tif = 7GB
/data/5/coastal-2020.tif  = 700MB

gdalwarp -r near -overwrite /data/3/coastal-2020.tif /data/3/coastal-2020-test1.tif  -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS -co PREDICTOR=3 --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES & disown -h

The AWS Instance with over 60 VCPU ran for over 8 hours

I tried:
/data/5/coastal-2020.tif  = 700MB
/data/3/coastal-2020-test.tif = 7GB

gdalwarp -r near -overwrite /data/5/coastal-2020.tif /data/3/coastal-2020-test.tif  -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS -co PREDICTOR=3 --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES

The output is: 18376, 17086 not 450000, 225000

Any assistance appreciated
Thanks
Clive

On Wed, 14 Dec 2022 at 09:23, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

I don't mean that you should try this and that blindly but to describe what data you have in your hands and what you are planning to do with it so that the other GDAL users could consider what reasonable alternatives you could have. I have never done anything that is even close to your use case but due to other experience I can see potential issues in a few places:

  *   You try to update image A that has a size 450000 by 225000 pixels with image B that has the same size. The result would be A updated into a full copy of B if all pixels in B are valid.
  *   However, image B probably has very much NoData (we do not know because you have not told that) and if GDAL deals with NoData correctly the result would be A updated with valid pixels from B and that is probably what is desired.
  *   However, we do not know how effectively GDAL skips the nodata pixels of B. It may be fast or not. If we know that most part of the world is NoData it might be good to crop image B to include just the area where there is data. That's maybe UK in your case. If skipping the NoData is fast then cropping won't give speedup but it is cheap to test.
  *   You have compressed images. LZW algorithm is compressing some data more effectively than some other. If you expect that you can replace a chunk of LZW compressed data inside a TIFF file with another chunk of LZW compressed data in place you are wrong. The new chunk of data may be larger and it just cannot fit into the same space. Assumption that updating a 6 GB image with 600 MB new data would yield a 6 GB image is not correct with compressed data.
  *   I can imagine that there could be other technical reasons to write the replacing data at the end of the existing TIFF and update the image directories. If the image size is critical it may require re-writing the updated TIFF into a new TIFF file. The complete re-write can be done in most optimal way. See this wiki page https://trac.osgeo.org/gdal/wiki/UserDocs/GdalWarp#GeoTIFFoutput-coCOMPRESSisbroken<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Ftrac.osgeo.org%2Fgdal%2Fwiki%2FUserDocs%2FGdalWarp%23GeoTIFFoutput-coCOMPRESSisbroken&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C5b67ce172b5b4c48990108daddf10a33%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066324581688598%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=JyLbYpMyvjON3BsPZ9INgBNAy8DUGMwrJ2TVv6%2BhGHY%3D&reserved=0>
  *   If the images are in AWS it is possible that the process should be somehow different than with local images. I have no experience about AWS yet.
  *   A 450000 by 225000 image is rather big. It is possible that it would be faster to split the image into smaller parts, update the parts that need updating, and combine the parts back into a big image. Or keep the parts and combine them virtually with gdalbuildvrt into VRT.

Your use case is not so usual and it is rather heavy but there are certainly several ways to do what you want. What should be avoided it to select an inefficient method and try to optimize it.

Good luck with your experiments,

-Jukka-




L?hett?j?: Clive Swan <cliveswan at gmail.com<mailto:cliveswan at gmail.com>>
L?hetetty: keskiviikko 14. joulukuuta 2022 10.29
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [gdal-dev] gdalwarp running very slow

Hi Jukka,

Thanks for that, was really stressed.
I will export the UK extent, and rerun the script.

Thanks
Clive

Sent from Outlook for Android<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2FAAb9ysg&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C5b67ce172b5b4c48990108daddf10a33%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066324581688598%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=VrXwCU6Hs%2FdjSHmxQBVIXJI30tUikSCe36HZaTNpiYA%3D&reserved=0>
________________________________
From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Wednesday, December 14, 2022 7:18:50 AM
To: Clive Swan <cliveswan at gmail.com<mailto:cliveswan at gmail.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: Re: [gdal-dev] gdalwarp running very slow


Hi,



Thank you for the information about the source files. I do not yet understand what you are trying to do and why. The both images have the same size 450000 and 225000 and they cover the same area. Is the "image 5_UK_coastal-2020.tif" just NoData with pixel value -9999 everywhere outside the UK? The name of the image makes me think so.



-Jukka Rahkonen-





L?hett?j?: Clive Swan <cliveswan at gmail.com<mailto:cliveswan at gmail.com>>
L?hetetty: tiistai 13. joulukuuta 2022 19.22
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Kopio: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: [gdal-dev] gdalwarp running very slow



 Greetings,

I am using the same files, I copied them from an AWS Bucket to a local AWS Instance.

I tried gdal_merge << tries to create 300GB file

I tried gdal_translate ran but created 2.5 GB not 6.9 GB file

Now trying gdalwarp.



the gdalinfo is the same in both datasets:

coastal-2020.tif (6.9GB)

Driver: GTiff/GeoTIFF
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)
Metadata:
  AREA_OR_POINT=Area
  datetime_created=2022-11-14 18:05:14.053301
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
  PREDICTOR=3
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
  Description = score
  NoData Value=-9999
Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_value
  NoData Value=-9999
Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_min
  NoData Value=-9999
Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_max
  NoData Value=-9999
Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood
  NoData Value=-9999
Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = return_time
  NoData Value=-9999
Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood_confidence
  NoData Value=-9999
Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = climate_reliability
  NoData Value=-9999
Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = hazard_reliability
  NoData Value=-9999



5_UK_coastal-2020.tif (600MB)

Driver: GTiff/GeoTIFF
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)
Metadata:
  AREA_OR_POINT=Area
  datetime_created=2022-11-14 18:05:14.053301
  hostname=posix.uname_result(sysname='Linux', nodename='ip-172-31-12-125', release='5.15.0-1022-aws', version='#26~20.04.1-Ubuntu SMP Sat Oct 15 03:22:07 UTC 2022', machine='x86_64')
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
  PREDICTOR=3
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)
Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
  Description = score
  NoData Value=-9999
Band 2 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_value
  NoData Value=-9999
Band 3 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_min
  NoData Value=-9999
Band 4 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = severity_max
  NoData Value=-9999
Band 5 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood
  NoData Value=-9999
Band 6 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = return_time
  NoData Value=-9999
Band 7 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = likelihood_confidence
  NoData Value=-9999
Band 8 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = climate_reliability
  NoData Value=-9999
Band 9 Block=128x128 Type=Float32, ColorInterp=Undefined
  Description = hazard_reliability
  NoData Value=-9999

--

 Regards,



Clive Swan

--

Hi,



If you are still struggling with the same old problem could you please finally send the gdalinfo reports of your two input files which are this time:

coastal-2020.tif

5_UK_coastal-2020.tif



-Jukka Rahkonen-





L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C5b67ce172b5b4c48990108daddf10a33%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066324581688598%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=ksdZuGTu2MsFwMcQTQT1XXt4v8JHhDTDgbVbna0zfoA%3D&reserved=0>> Puolesta Clive Swan

L?hetetty: tiistai 13. joulukuuta 2022 17.23

Vastaanottaja: gdal-dev at lists.osgeo.org<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C5b67ce172b5b4c48990108daddf10a33%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638066324581688598%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=ksdZuGTu2MsFwMcQTQT1XXt4v8JHhDTDgbVbna0zfoA%3D&reserved=0>

Aihe: [gdal-dev] gdalwarp running very slow



Greetings,

I am running gdalwarp on a 6GB (output) and 600MB (input) tif image, the AWS Instance has approx 60 VCPU

It has taken over 6 hours so far - still running, is it possible to optimise this and speed it up??



gdalwarp -r near -overwrite coastal-2020.tif   5_UK_coastal-2020.tif -co BIGTIFF=YES -co COMPRESS=LZW -co BLOCKXSIZE=128 -co BLOCKYSIZE=128  -co NUM_THREADS=ALL_CPUS --config CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE YES


--

 Regards,



Clive Swan

--



M: +44 7766 452665
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221214/405d2fe3/attachment-0001.htm>

From schwehr at gmail.com  Wed Dec 14 19:46:51 2022
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 14 Dec 2022 19:46:51 -0800
Subject: [gdal-dev] [Tiff] rc3 is available (was Re: libtiff v4.5.0 rc2
 available)
In-Reply-To: <a10f90ed-fe67-94ce-36cb-d2e7a563189d@spatialys.com>
References: <c111521e-640a-2185-d38e-bdcd4b077d8e@spatialys.com>
 <a10f90ed-fe67-94ce-36cb-d2e7a563189d@spatialys.com>
Message-ID: <CACmBxyuhuWXruZi=KcGkNqDV-Lot9HpVcuWo3ivNcMMZVy-MpQ@mail.gmail.com>

I've made it to
https://gitlab.com/libtiff/libtiff/commit/193c94b30ca5c7720454a786672ec48718ef3698
the >1M tests all work.

Just starting on c2a28a12.  It's a smoke test of 1K tests.  I should know
the rest in about 12 hours.

On Tue, Dec 13, 2022 at 2:36 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Here's RC3 with the fix for the issue Kurt raised (and a few relatted
> formatting printf() tidy up):
>
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.gz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.gz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.xz
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc3.tar.xz.sig
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc3.zip
> - https://download.osgeo.org/libtiff/tiff-4.5.0rc3.zip.sig
>
> Le 13/12/2022 ? 21:39, Even Rouault a ?crit :
> > Hi,
> >
> > The changes in IFD loop detection are non-trivial enough to justify a
> > rc2, so here it is:
> >
> > - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz
> > - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.gz.sig
> > - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz
> > - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.tar.xz.sig
> > - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip
> > - https://download.osgeo.org/libtiff/tiff-4.5.0rc2.zip.sig
> >
> > Hopefully this will be the final release candidate for 4.5.0. Please
> > test and report.
> >
> > The changes since rc1 are:
> > - restore formatting of tiffvers.h so that FindTIFF.cmake can infer
> > libtiff version number
> > - addition of TIFFLIB_MAJOR_VERSION, TIFFLIB_MINOR_VERSION,
> > TIFFLIB_MICRO_VERSION in tiffvers.h
> > - introduction of TIFFLIB_AT_LEAST(major, minor, micro) macro in
> > tiffvers.h
> > - CMake: restore BUILD_SHARED_LIBS=ON default setting for top-level
> > builds
> > - IFD loop detection: changed algorithm to use a hashset/hashmap for
> > good performance
> > - tdir_t type updated to uint32_t. This type is now used for the
> > return value of TIFFCurrentDirectory and TIFFNumberOfDirectories, and
> > as the argument of TIFFSetDirectory and TIFFUnlinkDirectory
> > - Increase the maximum number of IFDs that libtiff can browse through
> > from 65535 to 1048576. This value is a build-time setting, available
> > in tif_config.h, that can be configured with CMake's
> > TIFF_MAX_DIR_COUNT and variable or autoconf's --with-max-dir-count
> > option.
> > - tiffinfo: support more than 64k IFDs.
> >
> > Even
> >
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> Tiff mailing list
> Tiff at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/tiff
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221214/c0fc352b/attachment.htm>

From even.rouault at spatialys.com  Thu Dec 15 07:00:54 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 15 Dec 2022 16:00:54 +0100
Subject: [gdal-dev] libtiff 4.5.0 is released
Message-ID: <7e872eb9-415b-bd59-8b7e-376e82c0d73b@spatialys.com>

Hi,

I've promoted rc3 as the final 4.5.0 release.

Read about this release at 
https://libtiff.gitlab.io/libtiff/releases/v4.5.0.html

Note in particular the ABI change due to symbol versioning (SONAME 
bumped to 6), and API and behavior changes related to the following items:
- Related to IFD-Loop detection refactoring, the number of IFDs that 
libtiff can browse through has been extended from 65535 to 1048576. This 
value is a build-time setting that can be configured with CMake's 
TIFF_MAX_DIR_COUNT variable or autoconf's --with-max-dir-count option.
- tdir_t type updated to uint32_t. This type is now used for the return 
value of TIFFCurrentDirectory() and TIFFNumberOfDirectories(), and as 
the argument of TIFFSetDirectory() and TIFFUnlinkDirectory()

The release tarball can be downloaded at:

https://download.osgeo.org/libtiff/tiff-4.5.0.tar.gz
https://download.osgeo.org/libtiff/tiff-4.5.0.tar.xz
https://download.osgeo.org/libtiff/tiff-4.5.0.zip

Signatures:
https://download.osgeo.org/libtiff/tiff-4.5.0.tar.gz.sig
https://download.osgeo.org/libtiff/tiff-4.5.0.tar.xz.sig
https://download.osgeo.org/libtiff/tiff-4.5.0.zip.sig

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Dec 15 07:29:27 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 15 Dec 2022 16:29:27 +0100
Subject: [gdal-dev] GDAL 3.6.1 is released
Message-ID: <7527f59c-5960-0b55-3988-fd3441879756@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the 
release of the GDAL/OGR 3.6.1 bug fix version.

Important: GDAL 3.6.1 officially retracts GDAL 3.6.0 which could cause 
corruption of the spatial index of GeoPackage files it created (in 
tables with 100 000 features or more): cf 
https://github.com/qgis/QGIS/issues/51188 and 
https://github.com/OSGeo/gdal/pull/6911. GDAL 3.6.1 fixes that issue. 
Setting OGR_GPKG_ALLOW_THREADED_RTREE=NO environment variable (at 
generation time) also works around the issue with GDAL 3.6.0. Users who 
have generated corrupted GeoPackage files with 3.6.0 can regnerate them 
with 3.6.1 with, for example, "ogr2ogr out_ok.gpkg in_corrupted.gpkg" 
(assuming a GeoPackage file with vector content only)

Consult the release notes for the list of issues addressed :
 ? https://github.com/OSGeo/gdal/blob/v3.6.1/NEWS.md

The sources are available at:

 ??? https://download.osgeo.org/gdal/3.6.1/gdal-3.6.1.tar.xz
 ??? https://download.osgeo.org/gdal/3.6.1/gdal-3.6.1.tar.gz
 ??? https://download.osgeo.org/gdal/3.6.1/gdal361.zip

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Dec 15 11:35:41 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 15 Dec 2022 20:35:41 +0100
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
Message-ID: <bd67e965-30ed-4706-4530-e17e0c5bfa09@spatialys.com>

Question: now that 3.6.1 is out, what to do with the 
osgeo/gdal:xxxx-3.6.0 docker images:

- keep them

- remove them

- alias them to the 3.6.1 ones which are now available ?

The same holds with source tarballs of 3.6.0 available on 
download.osgeo.org/gdal/3.6.0 or as github release. Digging into 
history, we retracted 1.7.0 in 
https://trac.osgeo.org/gdal/wiki/DownloadSource#a1.7.0retracted-January2010 
and as far as I can see in http://download.osgeo.org/gdal/old_releases/ 
, the 1.7.0 tarballs were also removed from download.

Even

Le 13/12/2022 ? 16:18, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> https://github.com/qgis/QGIS/issues/51188 has been brought to my 
> attention. The issue is that the new background building of the RTree 
> of GeoPackage files introduced in 3.6.0 didn't work well with 
> committing transactions in between, which is easily triggered by 
> ogr2ogr. All features were inserted but with default settings ~ 10% of 
> them lacked an entry in the spatial index, which can be enough to 
> break interactive display and workflows relying on spatial filtering. 
> When using ogr2ogr, I believe the issue can only be seen when creating 
> layers with more than 100 000 features, since that's the default value 
> for the interval at which transactions are committed.
>
> I've a fix ready in https://github.com/OSGeo/gdal/pull/6911. The fix 
> itself is a simple two-liner: 
> https://github.com/OSGeo/gdal/pull/6911/commits/3f5f6225fe82e0c2e0241e4f66bfb861cdf4fe9d
>
> Given the status of GeoPackage being the default format for QGIS, I 
> believe this is a severe enough issue to warrant an advanced 3.6.1 
> release, and an official retraction of 3.6.0.
>
> Thoughts ?
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sebastic at xs4all.nl  Thu Dec 15 11:47:11 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Thu, 15 Dec 2022 20:47:11 +0100
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <bd67e965-30ed-4706-4530-e17e0c5bfa09@spatialys.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
 <bd67e965-30ed-4706-4530-e17e0c5bfa09@spatialys.com>
Message-ID: <c9bf81d4-f32a-a465-1a10-e0c8db15d074@xs4all.nl>

On 12/15/22 20:35, Even Rouault wrote:
> The same holds with source tarballs of 3.6.0 available on 
> download.osgeo.org/gdal/3.6.0 or as github release. Digging into 
> history, we retracted 1.7.0 in 
> https://trac.osgeo.org/gdal/wiki/DownloadSource#a1.7.0retracted-January2010 and as far as I can see in http://download.osgeo.org/gdal/old_releases/ , the 1.7.0 tarballs were also removed from download.

Why try to scrub buggy releases from the history?

They are not infectious diseases that need to be avoided like the plague.

The release happened so the artifacts associated with it should remain, 
because of a significant bug a new release was published sooner than 
expected to reduce the time the latest release is affected.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1


From gdt at lexort.com  Thu Dec 15 12:11:06 2022
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 15 Dec 2022 15:11:06 -0500
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <bd67e965-30ed-4706-4530-e17e0c5bfa09@spatialys.com> (Even
 Rouault's message of "Thu, 15 Dec 2022 20:35:41 +0100")
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
 <bd67e965-30ed-4706-4530-e17e0c5bfa09@spatialys.com>
Message-ID: <rmimt7o77hh.fsf@s1.lexort.com>


Even Rouault <even.rouault at spatialys.com> writes:

> Question: now that 3.6.1 is out, what to do with the
> osgeo/gdal:xxxx-3.6.0 docker images:
>
> - keep them
>
> - remove them
>
> - alias them to the 3.6.1 ones which are now available ?

Basically I'm with Bas on this.

But even more strongly, do not alias 3.6.0 to 3.6.1.  If someone asks
for 3.6.0, getting it is fine, and getting an error is ok, but getting
something else is not ok.

As a packger  I don't really care, because I was fortunate to still be
waiting to get around to 3.6.0 (part cmake, part life in general, part
being a little shy about .0).  So I will, when I get to it, go right to
3.6.1.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221215/671a47a3/attachment.sig>

From daniel.fred.evans at gmail.com  Thu Dec 15 12:48:21 2022
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Thu, 15 Dec 2022 20:48:21 +0000
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <rmimt7o77hh.fsf@s1.lexort.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
 <bd67e965-30ed-4706-4530-e17e0c5bfa09@spatialys.com>
 <rmimt7o77hh.fsf@s1.lexort.com>
Message-ID: <CANnaQaaZvNTpBABbXdvmOEf-6UZZoFSrJtGTuM=p0y_wWkEc7Q@mail.gmail.com>

Similar thoughts here, too. Thinking particularly of the Docker image, the
main use case for them is ensuring a reproducible build on the user's side.
Those using the `latest` tag (indicating they're not so bothered about
versions) will start building with 3.6.1 automatically anyway. Those who
have pinned builds to 3.6.0 presumably want to avoid unexpected changes -
and given it's short life, I expect those are users who follow GDAL quite
closely.

I also don't get the impression this is *significantly* worse than the
normal bugfixes we see with any release - minor bugs like coordinate
rounding and interpolation issues have affected plenty of raster datasets
in the past, but we wouldn't consider a retraction of all GDAL versions up
to that point.

Regards,
Daniel



On Thu, 15 Dec 2022 at 20:11, Greg Troxel <gdt at lexort.com> wrote:

>
> Even Rouault <even.rouault at spatialys.com> writes:
>
> > Question: now that 3.6.1 is out, what to do with the
> > osgeo/gdal:xxxx-3.6.0 docker images:
> >
> > - keep them
> >
> > - remove them
> >
> > - alias them to the 3.6.1 ones which are now available ?
>
> Basically I'm with Bas on this.
>
> But even more strongly, do not alias 3.6.0 to 3.6.1.  If someone asks
> for 3.6.0, getting it is fine, and getting an error is ok, but getting
> something else is not ok.
>
> As a packger  I don't really care, because I was fortunate to still be
> waiting to get around to 3.6.0 (part cmake, part life in general, part
> being a little shy about .0).  So I will, when I get to it, go right to
> 3.6.1.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221215/281d1c87/attachment.htm>

From even.rouault at spatialys.com  Thu Dec 15 12:54:53 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 15 Dec 2022 21:54:53 +0100
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <CANnaQaaZvNTpBABbXdvmOEf-6UZZoFSrJtGTuM=p0y_wWkEc7Q@mail.gmail.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
 <bd67e965-30ed-4706-4530-e17e0c5bfa09@spatialys.com>
 <rmimt7o77hh.fsf@s1.lexort.com>
 <CANnaQaaZvNTpBABbXdvmOEf-6UZZoFSrJtGTuM=p0y_wWkEc7Q@mail.gmail.com>
Message-ID: <88da057a-5aab-b066-907d-d72329575be8@spatialys.com>


Le 15/12/2022 ? 21:48, Daniel Evans a ?crit?:
> Similar thoughts here, too. Thinking particularly of the Docker image, 
> the main use case for them is ensuring a reproducible build on the 
> user's side. Those using the `latest` tag (indicating they're not so 
> bothered about versions) will start building with 3.6.1 automatically 
> anyway.

Actually no: the :latest Docker image actually correspond to master 
builds, at least as currently setup, and they are infrequently refreshed 
(too long to refresh them nightly now they involve doing arm64 cross 
building)

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Dec 15 14:38:36 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 15 Dec 2022 23:38:36 +0100
Subject: [gdal-dev] Motion: adopt RFC89: SQL query logging callback
In-Reply-To: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
References: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
Message-ID: <78f1667f-f629-8a8f-1b67-608b508018cf@spatialys.com>

+1 Even

Le 12/12/2022 ? 15:10, ElPaso a ?crit?:
> Hi,
>
> Motion:
>
> Adopt? RFC89: SQL query logging callback [1]
>
> A draft implementation is available at [2].
>
> An example of how client code could make use of this new functionality 
> is avaiable for QGIS at [3].
>
> Kind regards.
>
>
> [1] https://github.com/OSGeo/gdal/pull/6837
>
> [2] 
> https://github.com/elpaso/gdal/tree/rfc89_sql_logging_callback_implementation
>
> [3] https://github.com/elpaso/QGIS/tree/ogrprovider-sql-logging
>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From cliveswan at gmail.com  Fri Dec 16 02:10:34 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Fri, 16 Dec 2022 10:10:34 +0000
Subject: [gdal-dev] Move pixel ULx ULy - what is dx_dy + dy_dx
Message-ID: <CA+kQ3mvivQsuzob-oEh0q5+tUQh=-Y1asiCh45DKEgxNH0PJkA@mail.gmail.com>

Greetings,

I want to shift the UL x, UL y of an image.

I am trying to find out what the *dx_dy + dy_dx* is.

The code is:

import gdal
### open dataset with update permission
ds = gdal.Open('/data/coastal-2020.tif', gdal.GA_Update)
### get the geotransform as a tuple of 6
gt = ds.GetGeoTransform()
### unpack geotransform into variables
x_tl = (-180.0000000)
x_res = 0.000800000000000
*dx_dy* =
y_tl =  (90.0000000)
*dy_dx* =
y_res = -0.000800000000000

x_tl, x_res, *dx_dy*, y_tl, *dy_dx*, y_res = gt

# compute shift of 1 pixel RIGHT in X direction
shift_x = 1 * x_res
# compute shift of 2 pixels UP in Y direction
# y_res likely negative, because Y decreases with increasing Y index
shift_y = -2 * y_res

# make new geotransform
gt_update = (x_tl + shift_x, x_res, dx_dy, y_tl + shift_y, dy_dx, y_res)


>From gdalinfo:
Size is 450000, 225000
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.000800000000000,-0.000800000000000)

Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
  PREDICTOR=3
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)



-- 

 Regards,


Clive Swan

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221216/e99b9349/attachment.htm>

From cliveswan at gmail.com  Fri Dec 16 02:14:46 2022
From: cliveswan at gmail.com (Clive Swan)
Date: Fri, 16 Dec 2022 10:14:46 +0000
Subject: [gdal-dev] Move pixel ULx ULy - what is dx_dy + dy_dx
Message-ID: <CA+kQ3muBo03CcP3VzTkr_abcN0xULUt3nJ2QhEiMo1Khte1rEQ@mail.gmail.com>

Greetings,

Is dx_dy, dy_dx = (0,0)
The Top Left/Right value??

-- 

 Regards,


Clive Swan

--


M: +44 7766 452665
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221216/25d3bc6c/attachment-0001.htm>

From andrew at aitchison.me.uk  Fri Dec 16 02:38:31 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Fri, 16 Dec 2022 10:38:31 +0000 (GMT)
Subject: [gdal-dev] Move pixel ULx ULy - what is dx_dy + dy_dx
In-Reply-To: <CA+kQ3mvivQsuzob-oEh0q5+tUQh=-Y1asiCh45DKEgxNH0PJkA@mail.gmail.com>
References: <CA+kQ3mvivQsuzob-oEh0q5+tUQh=-Y1asiCh45DKEgxNH0PJkA@mail.gmail.com>
Message-ID: <db2f9720-d595-e454-4e4d-a0d9367bea98@aitchison.me.uk>

On Fri, 16 Dec 2022, Clive Swan wrote:

> Greetings,
>
> I want to shift the UL x, UL y of an image.
>
> I am trying to find out what the *dx_dy + dy_dx* is.

They represent (part of) the rotation;
technically I think that they are they are the "skew".
For a *translation* they are both equal to zero.

> Is dx_dy, dy_dx = (0,0)
> The Top Left/Right value??

For your transform, yes they are zero,
but no, not the Top Left/Right.

> The code is:
>
> import gdal
> ### open dataset with update permission
> ds = gdal.Open('/data/coastal-2020.tif', gdal.GA_Update)
> ### get the geotransform as a tuple of 6
> gt = ds.GetGeoTransform()
> ### unpack geotransform into variables
> x_tl = (-180.0000000)
> x_res = 0.000800000000000
> *dx_dy* =
> y_tl =  (90.0000000)
> *dy_dx* =
> y_res = -0.000800000000000
>
> x_tl, x_res, *dx_dy*, y_tl, *dy_dx*, y_res = gt
>
> # compute shift of 1 pixel RIGHT in X direction
> shift_x = 1 * x_res
> # compute shift of 2 pixels UP in Y direction
> # y_res likely negative, because Y decreases with increasing Y index
> shift_y = -2 * y_res
>
> # make new geotransform
> gt_update = (x_tl + shift_x, x_res, dx_dy, y_tl + shift_y, dy_dx, y_res)

x and y are in *degrees*.
You *can* shift your map left/right = east/west, but odd things may happen
at 180 degree longitude, since a common convention is that this
is the left-right border.
However, you cannot shift your map up/down = north/south as this will move
(in your case) the top of the map north of the north pole.
This is particularly bad with any Mercator projection,
since the north pole is already at infinity on the map.

>> From gdalinfo:
> Size is 450000, 225000
> Coordinate System is:
> GEOGCRS["WGS 84",
>    DATUM["World Geodetic System 1984",
>        ELLIPSOID["WGS 84",6378137,298.257223563,
>            LENGTHUNIT["metre",1]]],
>    PRIMEM["Greenwich",0,
>        ANGLEUNIT["degree",0.0174532925199433]],
>    CS[ellipsoidal,2],
>        AXIS["geodetic latitude (Lat)",north,
>            ORDER[1],
>            ANGLEUNIT["degree",0.0174532925199433]],
>        AXIS["geodetic longitude (Lon)",east,
>            ORDER[2],
>            ANGLEUNIT["degree",0.0174532925199433]],
>    ID["EPSG",4326]]
> Data axis to CRS axis mapping: 2,1
> Origin = (-180.000000000000000,90.000000000000000)
> Pixel Size = (0.000800000000000,-0.000800000000000)
>
> Image Structure Metadata:
>  COMPRESSION=LZW
>  INTERLEAVE=BAND
>  PREDICTOR=3
> Corner Coordinates:
> Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"N)
> Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00"W, 90d 0' 0.00"S)
> Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"N)
> Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00"E, 90d 0' 0.00"S)
> Center      (   0.0000000,   0.0000000) (  0d 0' 0.01"E,  0d 0' 0.01"N)

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From bontepaarden at gmail.com  Fri Dec 16 15:30:23 2022
From: bontepaarden at gmail.com (Paul Meems)
Date: Sat, 17 Dec 2022 00:30:23 +0100
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
Message-ID: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>

Hello List,

We're trying to update MapWinGIS which is using the GDAL libraries from
gisinternals.com
Currently, we use the stable daily of December 9:
*release-1928-gdal-3-5-mapserver-8-0*

I'm using VS2019 (on Windows) to compile and I'm having issues with two
lines in gdal_pam.h, around line 215.
We need to change these two lines:

   - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
   std::numeric_limits<int64_t>::min();
   - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
   std::numeric_limits<uint64_t>::max();

To

   - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 = LLONG_MIN;
   - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 = LLONG_MAX;

I prefer not to alter the files from gisinternals.com. Is this what we can
solve on our end?
Is it related to the C++ version? We use these:

   - ISO C++14 Standard (/std:c++14)
   - ISO C11 Standard (/std:c11)

Thanks for any advice.

Paul Meems
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221217/2ed517ec/attachment.htm>

From schwehr at gmail.com  Fri Dec 16 15:40:33 2022
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 16 Dec 2022 15:40:33 -0800
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
Message-ID: <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>

What exact error are you getting?

On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com> wrote:

> Hello List,
>
> We're trying to update MapWinGIS which is using the GDAL libraries from
> gisinternals.com
> Currently, we use the stable daily of December 9:
> *release-1928-gdal-3-5-mapserver-8-0*
>
> I'm using VS2019 (on Windows) to compile and I'm having issues with two
> lines in gdal_pam.h, around line 215.
> We need to change these two lines:
>
>    - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>    std::numeric_limits<int64_t>::min();
>    - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>    std::numeric_limits<uint64_t>::max();
>
> To
>
>    - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 = LLONG_MIN;
>    - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 = LLONG_MAX;
>
> I prefer not to alter the files from gisinternals.com. Is this what we
> can solve on our end?
> Is it related to the C++ version? We use these:
>
>    - ISO C++14 Standard (/std:c++14)
>    - ISO C11 Standard (/std:c11)
>
> Thanks for any advice.
>
> Paul Meems
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221216/cbe1ed35/attachment.htm>

From bontepaarden at gmail.com  Fri Dec 16 15:46:59 2022
From: bontepaarden at gmail.com (Paul Meems)
Date: Sat, 17 Dec 2022 00:46:59 +0100
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
Message-ID: <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>

Thanks, Kurt for your response.

I'm getting a very vague error message:
E0040 expected an identifier.

Regards,

Paul

Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr <schwehr at gmail.com>:

> What exact error are you getting?
>
> On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com> wrote:
>
>> Hello List,
>>
>> We're trying to update MapWinGIS which is using the GDAL libraries from
>> gisinternals.com
>> Currently, we use the stable daily of December 9:
>> *release-1928-gdal-3-5-mapserver-8-0*
>>
>> I'm using VS2019 (on Windows) to compile and I'm having issues with two
>> lines in gdal_pam.h, around line 215.
>> We need to change these two lines:
>>
>>    - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>>    std::numeric_limits<int64_t>::min();
>>    - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>>    std::numeric_limits<uint64_t>::max();
>>
>> To
>>
>>    - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 = LLONG_MIN;
>>    - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 = LLONG_MAX;
>>
>> I prefer not to alter the files from gisinternals.com. Is this what we
>> can solve on our end?
>> Is it related to the C++ version? We use these:
>>
>>    - ISO C++14 Standard (/std:c++14)
>>    - ISO C11 Standard (/std:c11)
>>
>> Thanks for any advice.
>>
>> Paul Meems
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221217/eeada8f7/attachment.htm>

From schwehr at gmail.com  Fri Dec 16 15:59:02 2022
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 16 Dec 2022 15:59:02 -0800
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
 <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
Message-ID: <CACmBxyuFRKwg089fpt4aBM+pzh6Qr02vgLBvJwhGxKVC0DY5aA@mail.gmail.com>

My suggestion is try a small example program with not much more than those
two lines and then give the exact / complete compile line and output.

Better yet, try to reproduce it with a small example on compiler explorer:
https://godbolt.org/

On Fri, Dec 16, 2022 at 3:47 PM Paul Meems <bontepaarden at gmail.com> wrote:

> Thanks, Kurt for your response.
>
> I'm getting a very vague error message:
> E0040 expected an identifier.
>
> Regards,
>
> Paul
>
> Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr <schwehr at gmail.com>:
>
>> What exact error are you getting?
>>
>> On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com>
>> wrote:
>>
>>> Hello List,
>>>
>>> We're trying to update MapWinGIS which is using the GDAL libraries from
>>> gisinternals.com
>>> Currently, we use the stable daily of December 9:
>>> *release-1928-gdal-3-5-mapserver-8-0*
>>>
>>> I'm using VS2019 (on Windows) to compile and I'm having issues with two
>>> lines in gdal_pam.h, around line 215.
>>> We need to change these two lines:
>>>
>>>    - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>>>    std::numeric_limits<int64_t>::min();
>>>    - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>>>    std::numeric_limits<uint64_t>::max();
>>>
>>> To
>>>
>>>    - constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 = LLONG_MIN;
>>>    - constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>>>    LLONG_MAX;
>>>
>>> I prefer not to alter the files from gisinternals.com. Is this what we
>>> can solve on our end?
>>> Is it related to the C++ version? We use these:
>>>
>>>    - ISO C++14 Standard (/std:c++14)
>>>    - ISO C11 Standard (/std:c11)
>>>
>>> Thanks for any advice.
>>>
>>> Paul Meems
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221216/8507e1fa/attachment-0001.htm>

From dg0yt at darc.de  Fri Dec 16 22:10:30 2022
From: dg0yt at darc.de (dg0yt at darc.de)
Date: Sat, 17 Dec 2022 07:10:30 +0100 (CET)
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
 <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
Message-ID: <845326344.64481.1671257431007@office.mailbox.org>

I'm not using MSVC, so this is a guess:
Are you including 'windows.h' without 'NOMINMAX' being defined?
Then you will get macros which interfere with the limits code.

Regards, Kai.

> Paul Meems <bontepaarden at gmail.com> hat am 17.12.2022 00:46 CET geschrieben:
> 
> 
> Thanks, Kurt for your response.
> 
> I'm getting a very vague error message:
> E0040 expected an identifier.
> 
> 
>  Regards,
> 
> Paul
> 
> 
> Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr <schwehr at gmail.com>:
> > What exact error are you getting?
> > 
> > 
> > On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com> wrote:
> > > Hello List,
> > > 
> > > We're trying to update MapWinGIS which is using the GDAL libraries from gisinternals.com (http://gisinternals.com)
> > > Currently, we use the stable daily of December 9:?release-1928-gdal-3-5-mapserver-8-0
> > > 
> > > I'm using VS2019 (on Windows) to compile and I'm having issues with two lines in?gdal_pam.h, around line 215.
> > > We need to change these two lines:
> > > 
> > >   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 = std::numeric_limits<int64_t>::min();
> > >   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 = std::numeric_limits<uint64_t>::max();
> > > To
> > >   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 = LLONG_MIN;
> > >   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 = LLONG_MAX;
> > > I prefer not to alter the files from gisinternals.com (http://gisinternals.com). Is this what we can solve on our end?
> > > Is it related to the C++ version? We use these:
> > > 
> > >   * ISO C++14 Standard (/std:c++14)
> > >   * ISO C11 Standard (/std:c11)
> > > Thanks for any advice.
> > > 
> > > Paul Meems
> > > 
> > > _______________________________________________
> > >  gdal-dev mailing list
> > >  gdal-dev at lists.osgeo.org
> > >  https://lists.osgeo.org/mailman/listinfo/gdal-dev
> > > 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Sat Dec 17 13:20:12 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 17 Dec 2022 22:20:12 +0100
Subject: [gdal-dev] Code reformatting applied
Message-ID: <ec232954-ccdd-4280-402f-1ee684b46d6e@spatialys.com>

Hi,

The code reformatting has now landed into master and release/3.6 
branches per pull requests https://github.com/OSGeo/gdal/pull/6937 and 
https://github.com/OSGeo/gdal/pull/6939. I've applied it now since the 
number of opened pull requests is low. I've split the reformatting in 
one commit per modified directory, to avoid potential issues with UI 
like github that could have performance issues with a single huge commit.

For developers, when you'll have resynchronized your local copy with 
master, do the following from the top of your clone so that commits with 
code reformatting are ignored when using "git blame"

git config blame.ignoreRevsFile .git-blame-ignore-revs

This is documented in 
https://gdal.org/development/dev_practices.html#blame-ignore-file

If you have ongoing work in local branches not sent as PR, and that you 
intend to submit as a single-commit (or squashed as a single-commit on 
merging), do *not* merge master into it, otherwise you'll get conflicts. 
But you can apply the following workflow to reformat your modified files 
to comply with the formatting rules:

git fetch upstream master # assuming 'upstream' points to OSGeo/gdal
git checkout -b reformatted_branch? # to not mess up with your original work
git cherry-pick 5d80bc1 2796f2a b9c28a1 3103e5e 48c9ea8cb4? # to fetch 
modified pre-commit hook and .clang-format
pip install pre-commit # if not already done
pre-commit install # if not already done
pre-commit run --files foo/bar.cpp bar/baz.h? # put here the list of 
your modified files to reformat

Copy all your modified files as .cpp.new / .h.new ones for example

Create a new branch from latest master and copy the .cpp.new / .h.new 
files on top of the .cpp / .h ones (or use a merge tool if there have 
been conflicting changes in between to only merge your changes)

If you want your work to be merged as multiple commits, then I'm afraid 
you'll have to endure some pain to create copies of modified files by 
each commit in their before and after state, reformat those different 
versions, generate patches with the diff between the reformated 
before/after versions, and use those diffs with git apply to recreate 
commits in a new branch on top of latest master

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From schwehr at gmail.com  Sat Dec 17 13:24:33 2022
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sat, 17 Dec 2022 13:24:33 -0800
Subject: [gdal-dev] Code reformatting applied
In-Reply-To: <ec232954-ccdd-4280-402f-1ee684b46d6e@spatialys.com>
References: <ec232954-ccdd-4280-402f-1ee684b46d6e@spatialys.com>
Message-ID: <CACmBxysYCExDZ-gODYoivS5SN3_UPLgf9G4rt4PFsYb52qZDWg@mail.gmail.com>

Woohoo!  Thanks!

On Sat, Dec 17, 2022 at 1:20 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> The code reformatting has now landed into master and release/3.6
> branches per pull requests https://github.com/OSGeo/gdal/pull/6937 and
> https://github.com/OSGeo/gdal/pull/6939. I've applied it now since the
> number of opened pull requests is low. I've split the reformatting in
> one commit per modified directory, to avoid potential issues with UI
> like github that could have performance issues with a single huge commit.
>
> For developers, when you'll have resynchronized your local copy with
> master, do the following from the top of your clone so that commits with
> code reformatting are ignored when using "git blame"
>
> git config blame.ignoreRevsFile .git-blame-ignore-revs
>
> This is documented in
> https://gdal.org/development/dev_practices.html#blame-ignore-file
>
> If you have ongoing work in local branches not sent as PR, and that you
> intend to submit as a single-commit (or squashed as a single-commit on
> merging), do *not* merge master into it, otherwise you'll get conflicts.
> But you can apply the following workflow to reformat your modified files
> to comply with the formatting rules:
>
> git fetch upstream master # assuming 'upstream' points to OSGeo/gdal
> git checkout -b reformatted_branch  # to not mess up with your original
> work
> git cherry-pick 5d80bc1 2796f2a b9c28a1 3103e5e 48c9ea8cb4  # to fetch
> modified pre-commit hook and .clang-format
> pip install pre-commit # if not already done
> pre-commit install # if not already done
> pre-commit run --files foo/bar.cpp bar/baz.h  # put here the list of
> your modified files to reformat
>
> Copy all your modified files as .cpp.new / .h.new ones for example
>
> Create a new branch from latest master and copy the .cpp.new / .h.new
> files on top of the .cpp / .h ones (or use a merge tool if there have
> been conflicting changes in between to only merge your changes)
>
> If you want your work to be merged as multiple commits, then I'm afraid
> you'll have to endure some pain to create copies of modified files by
> each commit in their before and after state, reformat those different
> versions, generate patches with the diff between the reformated
> before/after versions, and use those diffs with git apply to recreate
> commits in a new branch on top of latest master
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221217/eda1d565/attachment.htm>

From bontepaarden at gmail.com  Sun Dec 18 06:32:32 2022
From: bontepaarden at gmail.com (Paul Meems)
Date: Sun, 18 Dec 2022 15:32:32 +0100
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <845326344.64481.1671257431007@office.mailbox.org>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
 <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
 <845326344.64481.1671257431007@office.mailbox.org>
Message-ID: <CAHNf2YTmDQcO9dhhuO8HvcpUQX-bTxsWsc1qjW9fqO=9Z1XydQ@mail.gmail.com>

Thanks all for your suggestions.
I did some more research and it seems to be an issue with the preprocessor
on Windows.

Adding some brackets solves the issue as well:
// old
constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
std::numeric_limits<int64_t>::min();
constexpr uint64_tGDAL_PAM_DEFAULT_NODATA_VALUE_UINT64=
std::numeric_limits<uint64_t>::max();
// new:
constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =*(*
std::numeric_limits<int64_t>::min*)*();
constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =*(*
std::numeric_limits<uint64_t>::max*)*();

I'm not sure what the impact would be for non-windows compilers, but if no
impact could this be changed in the code?

Thanks,

Paul Meems


Op za 17 dec. 2022 om 07:10 schreef <dg0yt at darc.de>:

> I'm not using MSVC, so this is a guess:
> Are you including 'windows.h' without 'NOMINMAX' being defined?
> Then you will get macros which interfere with the limits code.
>
> Regards, Kai.
>
> > Paul Meems <bontepaarden at gmail.com> hat am 17.12.2022 00:46 CET
> geschrieben:
> >
> >
> > Thanks, Kurt for your response.
> >
> > I'm getting a very vague error message:
> > E0040 expected an identifier.
> >
> >
> >  Regards,
> >
> > Paul
> >
> >
> > Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr <schwehr at gmail.com>:
> > > What exact error are you getting?
> > >
> > >
> > > On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com>
> wrote:
> > > > Hello List,
> > > >
> > > > We're trying to update MapWinGIS which is using the GDAL libraries
> from gisinternals.com (http://gisinternals.com)
> > > > Currently, we use the stable daily of December
> 9: release-1928-gdal-3-5-mapserver-8-0
> > > >
> > > > I'm using VS2019 (on Windows) to compile and I'm having issues with
> two lines in gdal_pam.h, around line 215.
> > > > We need to change these two lines:
> > > >
> > > >   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
> std::numeric_limits<int64_t>::min();
> > > >   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
> std::numeric_limits<uint64_t>::max();
> > > > To
> > > >   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
> LLONG_MIN;
> > > >   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
> LLONG_MAX;
> > > > I prefer not to alter the files from gisinternals.com (
> http://gisinternals.com). Is this what we can solve on our end?
> > > > Is it related to the C++ version? We use these:
> > > >
> > > >   * ISO C++14 Standard (/std:c++14)
> > > >   * ISO C11 Standard (/std:c11)
> > > > Thanks for any advice.
> > > >
> > > > Paul Meems
> > > >
> > > > _______________________________________________
> > > >  gdal-dev mailing list
> > > >  gdal-dev at lists.osgeo.org
> > > >  https://lists.osgeo.org/mailman/listinfo/gdal-dev
> > > >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221218/77cb17e4/attachment.htm>

From andrew at aitchison.me.uk  Sun Dec 18 09:39:11 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sun, 18 Dec 2022 17:39:11 +0000 (GMT)
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <CAHNf2YTmDQcO9dhhuO8HvcpUQX-bTxsWsc1qjW9fqO=9Z1XydQ@mail.gmail.com>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
 <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
 <845326344.64481.1671257431007@office.mailbox.org>
 <CAHNf2YTmDQcO9dhhuO8HvcpUQX-bTxsWsc1qjW9fqO=9Z1XydQ@mail.gmail.com>
Message-ID: <739ed7ba-ebee-976b-813a-fcf11174ba88@aitchison.me.uk>

On Sun, 18 Dec 2022, Paul Meems wrote:

> Thanks all for your suggestions.
> I did some more research and it seems to be an issue with the preprocessor
> on Windows.
>
> Adding some brackets solves the issue as well:
> // old
> constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
> std::numeric_limits<int64_t>::min();
> constexpr uint64_tGDAL_PAM_DEFAULT_NODATA_VALUE_UINT64=
> std::numeric_limits<uint64_t>::max();
> // new:
> constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =*(*
> std::numeric_limits<int64_t>::min*)*();
> constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =*(*
> std::numeric_limits<uint64_t>::max*)*();

Do you mean to add *(* and *)* or just ( and ) ?

> I'm not sure what the impact would be for non-windows compilers, but if no
> impact could this be changed in the code?
>
> Thanks,
>
> Paul Meems
>
>
> Op za 17 dec. 2022 om 07:10 schreef <dg0yt at darc.de>:
>
>> I'm not using MSVC, so this is a guess:
>> Are you including 'windows.h' without 'NOMINMAX' being defined?
>> Then you will get macros which interfere with the limits code.
>>
>> Regards, Kai.
>>
>>> Paul Meems <bontepaarden at gmail.com> hat am 17.12.2022 00:46 CET
>> geschrieben:
>>>
>>>
>>> Thanks, Kurt for your response.
>>>
>>> I'm getting a very vague error message:
>>> E0040 expected an identifier.
>>>
>>>
>>>  Regards,
>>>
>>> Paul
>>>
>>>
>>> Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr <schwehr at gmail.com>:
>>>> What exact error are you getting?
>>>>
>>>>
>>>> On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com>
>> wrote:
>>>>> Hello List,
>>>>>
>>>>> We're trying to update MapWinGIS which is using the GDAL libraries
>> from gisinternals.com (http://gisinternals.com)
>>>>> Currently, we use the stable daily of December
>> 9: release-1928-gdal-3-5-mapserver-8-0
>>>>>
>>>>> I'm using VS2019 (on Windows) to compile and I'm having issues with
>> two lines in gdal_pam.h, around line 215.
>>>>> We need to change these two lines:
>>>>>
>>>>>   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>> std::numeric_limits<int64_t>::min();
>>>>>   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>> std::numeric_limits<uint64_t>::max();
>>>>> To
>>>>>   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>> LLONG_MIN;
>>>>>   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>> LLONG_MAX;
>>>>> I prefer not to alter the files from gisinternals.com (
>> http://gisinternals.com). Is this what we can solve on our end?
>>>>> Is it related to the C++ version? We use these:
>>>>>
>>>>>   * ISO C++14 Standard (/std:c++14)
>>>>>   * ISO C11 Standard (/std:c11)
>>>>> Thanks for any advice.
>>>>>
>>>>> Paul Meems
>>>>>
>>>>> _______________________________________________
>>>>>  gdal-dev mailing list
>>>>>  gdal-dev at lists.osgeo.org
>>>>>  https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From bontepaarden at gmail.com  Sun Dec 18 13:18:35 2022
From: bontepaarden at gmail.com (Paul Meems)
Date: Sun, 18 Dec 2022 22:18:35 +0100
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <739ed7ba-ebee-976b-813a-fcf11174ba88@aitchison.me.uk>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
 <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
 <845326344.64481.1671257431007@office.mailbox.org>
 <CAHNf2YTmDQcO9dhhuO8HvcpUQX-bTxsWsc1qjW9fqO=9Z1XydQ@mail.gmail.com>
 <739ed7ba-ebee-976b-813a-fcf11174ba88@aitchison.me.uk>
Message-ID: <CAHNf2YRrJagwLrSszjXZ9M3SfmvgyO2kPU1gXaU7g5TAZZ2sBA@mail.gmail.com>

I made the brackets bold. That seems to result in the *
Only ( and ) are needed, no *.

Regards,
Paul

Op zo 18 dec. 2022 18:39 schreef Andrew C Aitchison <andrew at aitchison.me.uk
>:

> On Sun, 18 Dec 2022, Paul Meems wrote:
>
> > Thanks all for your suggestions.
> > I did some more research and it seems to be an issue with the
> preprocessor
> > on Windows.
> >
> > Adding some brackets solves the issue as well:
> > // old
> > constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
> > std::numeric_limits<int64_t>::min();
> > constexpr uint64_tGDAL_PAM_DEFAULT_NODATA_VALUE_UINT64=
> > std::numeric_limits<uint64_t>::max();
> > // new:
> > constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =*(*
> > std::numeric_limits<int64_t>::min*)*();
> > constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =*(*
> > std::numeric_limits<uint64_t>::max*)*();
>
> Do you mean to add *(* and *)* or just ( and ) ?
>
> > I'm not sure what the impact would be for non-windows compilers, but if
> no
> > impact could this be changed in the code?
> >
> > Thanks,
> >
> > Paul Meems
> >
> >
> > Op za 17 dec. 2022 om 07:10 schreef <dg0yt at darc.de>:
> >
> >> I'm not using MSVC, so this is a guess:
> >> Are you including 'windows.h' without 'NOMINMAX' being defined?
> >> Then you will get macros which interfere with the limits code.
> >>
> >> Regards, Kai.
> >>
> >>> Paul Meems <bontepaarden at gmail.com> hat am 17.12.2022 00:46 CET
> >> geschrieben:
> >>>
> >>>
> >>> Thanks, Kurt for your response.
> >>>
> >>> I'm getting a very vague error message:
> >>> E0040 expected an identifier.
> >>>
> >>>
> >>>  Regards,
> >>>
> >>> Paul
> >>>
> >>>
> >>> Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr <schwehr at gmail.com>:
> >>>> What exact error are you getting?
> >>>>
> >>>>
> >>>> On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com>
> >> wrote:
> >>>>> Hello List,
> >>>>>
> >>>>> We're trying to update MapWinGIS which is using the GDAL libraries
> >> from gisinternals.com (http://gisinternals.com)
> >>>>> Currently, we use the stable daily of December
> >> 9: release-1928-gdal-3-5-mapserver-8-0
> >>>>>
> >>>>> I'm using VS2019 (on Windows) to compile and I'm having issues with
> >> two lines in gdal_pam.h, around line 215.
> >>>>> We need to change these two lines:
> >>>>>
> >>>>>   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
> >> std::numeric_limits<int64_t>::min();
> >>>>>   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
> >> std::numeric_limits<uint64_t>::max();
> >>>>> To
> >>>>>   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
> >> LLONG_MIN;
> >>>>>   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
> >> LLONG_MAX;
> >>>>> I prefer not to alter the files from gisinternals.com (
> >> http://gisinternals.com). Is this what we can solve on our end?
> >>>>> Is it related to the C++ version? We use these:
> >>>>>
> >>>>>   * ISO C++14 Standard (/std:c++14)
> >>>>>   * ISO C11 Standard (/std:c11)
> >>>>> Thanks for any advice.
> >>>>>
> >>>>> Paul Meems
> >>>>>
> >>>>> _______________________________________________
> >>>>>  gdal-dev mailing list
> >>>>>  gdal-dev at lists.osgeo.org
> >>>>>  https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>>>>
> >>> _______________________________________________
> >>> gdal-dev mailing list
> >>> gdal-dev at lists.osgeo.org
> >>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >> _______________________________________________
> >> gdal-dev mailing list
> >> gdal-dev at lists.osgeo.org
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
>
> --
> Andrew C. Aitchison                      Kendal, UK
>                     andrew at aitchison.me.uk
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221218/13bfdc71/attachment.htm>

From even.rouault at spatialys.com  Sun Dec 18 13:59:56 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Dec 2022 22:59:56 +0100
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <CAHNf2YRrJagwLrSszjXZ9M3SfmvgyO2kPU1gXaU7g5TAZZ2sBA@mail.gmail.com>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
 <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
 <845326344.64481.1671257431007@office.mailbox.org>
 <CAHNf2YTmDQcO9dhhuO8HvcpUQX-bTxsWsc1qjW9fqO=9Z1XydQ@mail.gmail.com>
 <739ed7ba-ebee-976b-813a-fcf11174ba88@aitchison.me.uk>
 <CAHNf2YRrJagwLrSszjXZ9M3SfmvgyO2kPU1gXaU7g5TAZZ2sBA@mail.gmail.com>
Message-ID: <4cb0ce58-47f2-3db5-b672-651683609c2f@spatialys.com>

Paul,

I've queued your proposed fix in pull request 
https://github.com/OSGeo/gdal/pull/6943

Even

Le 18/12/2022 ? 22:18, Paul Meems a ?crit?:
> I made the brackets bold. That seems to result in the *
> Only ( and ) are needed, no *.
>
> Regards,
> Paul
>
> Op zo 18 dec. 2022 18:39 schreef Andrew C Aitchison 
> <andrew at aitchison.me.uk>:
>
>     On Sun, 18 Dec 2022, Paul Meems wrote:
>
>     > Thanks all for your suggestions.
>     > I did some more research and it seems to be an issue with the
>     preprocessor
>     > on Windows.
>     >
>     > Adding some brackets solves the issue as well:
>     > // old
>     > constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>     > std::numeric_limits<int64_t>::min();
>     > constexpr uint64_tGDAL_PAM_DEFAULT_NODATA_VALUE_UINT64=
>     > std::numeric_limits<uint64_t>::max();
>     > // new:
>     > constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =*(*
>     > std::numeric_limits<int64_t>::min*)*();
>     > constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =*(*
>     > std::numeric_limits<uint64_t>::max*)*();
>
>     Do you mean to add *(* and *)* or just ( and ) ?
>
>     > I'm not sure what the impact would be for non-windows compilers,
>     but if no
>     > impact could this be changed in the code?
>     >
>     > Thanks,
>     >
>     > Paul Meems
>     >
>     >
>     > Op za 17 dec. 2022 om 07:10 schreef <dg0yt at darc.de>:
>     >
>     >> I'm not using MSVC, so this is a guess:
>     >> Are you including 'windows.h' without 'NOMINMAX' being defined?
>     >> Then you will get macros which interfere with the limits code.
>     >>
>     >> Regards, Kai.
>     >>
>     >>> Paul Meems <bontepaarden at gmail.com> hat am 17.12.2022 00:46 CET
>     >> geschrieben:
>     >>>
>     >>>
>     >>> Thanks, Kurt for your response.
>     >>>
>     >>> I'm getting a very vague error message:
>     >>> E0040 expected an identifier.
>     >>>
>     >>>
>     >>>? Regards,
>     >>>
>     >>> Paul
>     >>>
>     >>>
>     >>> Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr
>     <schwehr at gmail.com>:
>     >>>> What exact error are you getting?
>     >>>>
>     >>>>
>     >>>> On Fri, Dec 16, 2022 at 3:31 PM Paul Meems
>     <bontepaarden at gmail.com>
>     >> wrote:
>     >>>>> Hello List,
>     >>>>>
>     >>>>> We're trying to update MapWinGIS which is using the GDAL
>     libraries
>     >> from gisinternals.com <http://gisinternals.com>
>     (http://gisinternals.com)
>     >>>>> Currently, we use the stable daily of December
>     >> 9: release-1928-gdal-3-5-mapserver-8-0
>     >>>>>
>     >>>>> I'm using VS2019 (on Windows) to compile and I'm having
>     issues with
>     >> two lines in gdal_pam.h, around line 215.
>     >>>>> We need to change these two lines:
>     >>>>>
>     >>>>>? ?* constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>     >> std::numeric_limits<int64_t>::min();
>     >>>>>? ?* constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>     >> std::numeric_limits<uint64_t>::max();
>     >>>>> To
>     >>>>>? ?* constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>     >> LLONG_MIN;
>     >>>>>? ?* constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>     >> LLONG_MAX;
>     >>>>> I prefer not to alter the files from gisinternals.com
>     <http://gisinternals.com> (
>     >> http://gisinternals.com). Is this what we can solve on our end?
>     >>>>> Is it related to the C++ version? We use these:
>     >>>>>
>     >>>>>? ?* ISO C++14 Standard (/std:c++14)
>     >>>>>? ?* ISO C11 Standard (/std:c11)
>     >>>>> Thanks for any advice.
>     >>>>>
>     >>>>> Paul Meems
>     >>>>>
>     >>>>> _______________________________________________
>     >>>>>? gdal-dev mailing list
>     >>>>> gdal-dev at lists.osgeo.org
>     >>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     >>>>>
>     >>> _______________________________________________
>     >>> gdal-dev mailing list
>     >>> gdal-dev at lists.osgeo.org
>     >>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     >> _______________________________________________
>     >> gdal-dev mailing list
>     >> gdal-dev at lists.osgeo.org
>     >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     >>
>     >
>
>     -- 
>     Andrew C. Aitchison? ? ? ? ? ? ? ? ? ? ? Kendal, UK
>     andrew at aitchison.me.uk
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221218/34d48096/attachment-0001.htm>

From bontepaarden at gmail.com  Sun Dec 18 23:40:14 2022
From: bontepaarden at gmail.com (Paul Meems)
Date: Mon, 19 Dec 2022 08:40:14 +0100
Subject: [gdal-dev] std::numeric_limits<int64_t>::min() vs LLONG_MIN
In-Reply-To: <4cb0ce58-47f2-3db5-b672-651683609c2f@spatialys.com>
References: <CAHNf2YQevxicVsay9csVY=ETeRvOV79v+GUsx7ROedYd7rdUcA@mail.gmail.com>
 <CACmBxyvGUcbNBRkg_Qr4cB9e_Q_2F1GKR26hrAJOTSfOcZgXxA@mail.gmail.com>
 <CAHNf2YRVayqAf1Tg+bTyRL3HGk0YfCNLZAMn6jD-Mo+9Ndg-_w@mail.gmail.com>
 <845326344.64481.1671257431007@office.mailbox.org>
 <CAHNf2YTmDQcO9dhhuO8HvcpUQX-bTxsWsc1qjW9fqO=9Z1XydQ@mail.gmail.com>
 <739ed7ba-ebee-976b-813a-fcf11174ba88@aitchison.me.uk>
 <CAHNf2YRrJagwLrSszjXZ9M3SfmvgyO2kPU1gXaU7g5TAZZ2sBA@mail.gmail.com>
 <4cb0ce58-47f2-3db5-b672-651683609c2f@spatialys.com>
Message-ID: <CAHNf2YQp1FKVX82hHMc8P=gAdhrKNKkDrpvrspAtggAy0x0=Yw@mail.gmail.com>

Thank you Even.


Paul

Op zo 18 dec. 2022 om 22:59 schreef Even Rouault <even.rouault at spatialys.com
>:

> Paul,
>
> I've queued your proposed fix in pull request
> https://github.com/OSGeo/gdal/pull/6943
>
> Even
> Le 18/12/2022 ? 22:18, Paul Meems a ?crit :
>
> I made the brackets bold. That seems to result in the *
> Only ( and ) are needed, no *.
>
> Regards,
> Paul
>
> Op zo 18 dec. 2022 18:39 schreef Andrew C Aitchison <
> andrew at aitchison.me.uk>:
>
>> On Sun, 18 Dec 2022, Paul Meems wrote:
>>
>> > Thanks all for your suggestions.
>> > I did some more research and it seems to be an issue with the
>> preprocessor
>> > on Windows.
>> >
>> > Adding some brackets solves the issue as well:
>> > // old
>> > constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>> > std::numeric_limits<int64_t>::min();
>> > constexpr uint64_tGDAL_PAM_DEFAULT_NODATA_VALUE_UINT64=
>> > std::numeric_limits<uint64_t>::max();
>> > // new:
>> > constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =*(*
>> > std::numeric_limits<int64_t>::min*)*();
>> > constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =*(*
>> > std::numeric_limits<uint64_t>::max*)*();
>>
>> Do you mean to add *(* and *)* or just ( and ) ?
>>
>> > I'm not sure what the impact would be for non-windows compilers, but if
>> no
>> > impact could this be changed in the code?
>> >
>> > Thanks,
>> >
>> > Paul Meems
>> >
>> >
>> > Op za 17 dec. 2022 om 07:10 schreef <dg0yt at darc.de>:
>> >
>> >> I'm not using MSVC, so this is a guess:
>> >> Are you including 'windows.h' without 'NOMINMAX' being defined?
>> >> Then you will get macros which interfere with the limits code.
>> >>
>> >> Regards, Kai.
>> >>
>> >>> Paul Meems <bontepaarden at gmail.com> hat am 17.12.2022 00:46 CET
>> >> geschrieben:
>> >>>
>> >>>
>> >>> Thanks, Kurt for your response.
>> >>>
>> >>> I'm getting a very vague error message:
>> >>> E0040 expected an identifier.
>> >>>
>> >>>
>> >>>  Regards,
>> >>>
>> >>> Paul
>> >>>
>> >>>
>> >>> Op za 17 dec. 2022 om 00:40 schreef Kurt Schwehr <schwehr at gmail.com>:
>> >>>> What exact error are you getting?
>> >>>>
>> >>>>
>> >>>> On Fri, Dec 16, 2022 at 3:31 PM Paul Meems <bontepaarden at gmail.com>
>> >> wrote:
>> >>>>> Hello List,
>> >>>>>
>> >>>>> We're trying to update MapWinGIS which is using the GDAL libraries
>> >> from gisinternals.com (http://gisinternals.com)
>> >>>>> Currently, we use the stable daily of December
>> >> 9: release-1928-gdal-3-5-mapserver-8-0
>> >>>>>
>> >>>>> I'm using VS2019 (on Windows) to compile and I'm having issues with
>> >> two lines in gdal_pam.h, around line 215.
>> >>>>> We need to change these two lines:
>> >>>>>
>> >>>>>   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>> >> std::numeric_limits<int64_t>::min();
>> >>>>>   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>> >> std::numeric_limits<uint64_t>::max();
>> >>>>> To
>> >>>>>   * constexpr int64_t GDAL_PAM_DEFAULT_NODATA_VALUE_INT64 =
>> >> LLONG_MIN;
>> >>>>>   * constexpr uint64_t GDAL_PAM_DEFAULT_NODATA_VALUE_UINT64 =
>> >> LLONG_MAX;
>> >>>>> I prefer not to alter the files from gisinternals.com (
>> >> http://gisinternals.com). Is this what we can solve on our end?
>> >>>>> Is it related to the C++ version? We use these:
>> >>>>>
>> >>>>>   * ISO C++14 Standard (/std:c++14)
>> >>>>>   * ISO C11 Standard (/std:c11)
>> >>>>> Thanks for any advice.
>> >>>>>
>> >>>>> Paul Meems
>> >>>>>
>> >>>>> _______________________________________________
>> >>>>>  gdal-dev mailing list
>> >>>>>  gdal-dev at lists.osgeo.org
>> >>>>>  https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> >>>>>
>> >>> _______________________________________________
>> >>> gdal-dev mailing list
>> >>> gdal-dev at lists.osgeo.org
>> >>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> >> _______________________________________________
>> >> gdal-dev mailing list
>> >> gdal-dev at lists.osgeo.org
>> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> >>
>> >
>>
>> --
>> Andrew C. Aitchison                      Kendal, UK
>>                     andrew at aitchison.me.uk
>>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221219/32810c71/attachment.htm>

From andrew.terry at centremaps.co.uk  Mon Dec 19 02:48:10 2022
From: andrew.terry at centremaps.co.uk (Andrew Terry)
Date: Mon, 19 Dec 2022 10:48:10 +0000
Subject: [gdal-dev] ogr pgdump commits
Message-ID: <AM6PR01MB49467AD126EC15323AA72E39A1E59@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>


Hi,

Successfully writing data to postgres using ogr2ogr with pg_dump to push data through psql in the style:

ogr2ogr --config PG_USE_COPY YES -f PGDump /vsistdout/ abc.shp | psql -d my_dbname -f -

I'm finding some warnings in my logs and pushing the output to a file I can see it creates SQL like:

SET standard_conforming_strings = OFF;
BEGIN;
COPY ....
\.
END;
COMMIT;
BEGIN;
COPY ....

As a result, I'm getting the following which I understand to be due to psql already applying it's own begin / commit:

BEGIN
COPY 72
COMMIT
WARNING:  there is no transaction in progress
COMMIT

Purely for the purposes of allowing me to avoid these WARNING messages in error logging, I wondered whether there's any way to avoid this.

Thanks!

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221219/d49ba1a3/attachment-0001.htm>

From peter.townsend at maplarge.com  Mon Dec 19 10:16:22 2022
From: peter.townsend at maplarge.com (Peter Townsend)
Date: Mon, 19 Dec 2022 12:16:22 -0600
Subject: [gdal-dev] Tolerance Condition Error ogr2ogr Albers to EPSG:4326
Message-ID: <CAMQBGmVqKK4+3McffFnWfKJ+3TOvp6=5Kgm=uR5UmF11-D3ymQ@mail.gmail.com>

I've got this test dataset of a bunch of forest areas in Alaska. The
shapefile is in Albers, and we're converting it to EPSG:4326 lat longs.

Layer name: trees
Geometry: Polygon
Feature Count: 444
Extent: (-2175230.041280, 1899842.624457) - (4895522.387686, 6909266.538422)
Layer SRS WKT:
PROJCRS["Albers",
    BASEGEOGCRS["NAD27",
        DATUM["North American Datum 1927",
            ELLIPSOID["Clarke 1866",6378206.4,294.978698213898,
                LENGTHUNIT["metre",1]],
            ID["EPSG",6267]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["Degree",0.0174532925199433]]],
    CONVERSION["unnamed",
        METHOD["Albers Equal Area",
            ID["EPSG",9822]],
        PARAMETER["Latitude of false origin",50,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8821]],
        PARAMETER["Longitude of false origin",-154,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8822]],
        PARAMETER["Latitude of 1st standard parallel",55,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8823]],
        PARAMETER["Latitude of 2nd standard parallel",65,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8824]],
        PARAMETER["Easting at false origin",0,
            LENGTHUNIT["US survey foot",0.304800609601219],
            ID["EPSG",8826]],
        PARAMETER["Northing at false origin",0,
            LENGTHUNIT["US survey foot",0.304800609601219],
            ID["EPSG",8827]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["US survey foot",0.304800609601219,
                ID["EPSG",9003]]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["US survey foot",0.304800609601219,
                ID["EPSG",9003]]]]

We're trying to upgrade our GDAL from 3.21 to 3.53, and our poor test is
getting flagged now with either "ERROR 1: Point outside of projection
domain" and/or "ERROR 1: tolerance condition error".

This is what I'm seeing:
ogr2ogr.exe -skipfailures -t_srs EPSG:4326 --debug on c:\path\output
c:\path\trees.shp
GDAL: GDALOpen(c:\path\trees.shp, this=0000027A1189CBE0) succeeds as ESRI
Shapefile.
GDAL: Using ESRI Shapefile driver
GDAL: GDALDriver::Create(ESRI
Shapefile,c:\path\output,0,0,0,Unknown,0000000000000000)
Shape: DBF Codepage = LDID/87 for c:\path\trees.shp
Shape: Treating as encoding 'ISO-8859-1'.
ERROR 1: tolerance condition error
ERROR 1: tolerance condition error
GDALVectorTranslate: 444 features written in layer 'trees'
Shape: 444 features read on layer 'trees'.
GDAL: GDALClose(c:\path\trees.shp, this=0000027A1189CBE0)
GDAL: GDALClose(c:\path\output, this=0000027A1189D4A0)
GDAL: In GDALDestroy - unloading GDAL shared library.

(Same thing happens without skipfailures.)

Now I'm 95% sure it's throwing this error because there's some vertex
somewhere in here that's in that special "dead zone" for Alaska Albers that
can't convert to 4326 (seen this before on other datasets trying to project
individual points).

What I'm wondering is this:
1) Is there any way to get GDAL to tell me what feature/coordinate threw
the error?
2) What is it doing as a fallback behavior? Skipping the point and moving
on? I still come out with the same number of features in the end.

Thanks!
-- 
Peter Townsend
Senior Software Developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221219/61199b22/attachment.htm>

From even.rouault at spatialys.com  Mon Dec 19 10:46:38 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 19 Dec 2022 19:46:38 +0100
Subject: [gdal-dev] Tolerance Condition Error ogr2ogr Albers to EPSG:4326
In-Reply-To: <CAMQBGmVqKK4+3McffFnWfKJ+3TOvp6=5Kgm=uR5UmF11-D3ymQ@mail.gmail.com>
References: <CAMQBGmVqKK4+3McffFnWfKJ+3TOvp6=5Kgm=uR5UmF11-D3ymQ@mail.gmail.com>
Message-ID: <a2c01e15-8646-4101-b5dd-cb34d8ff0816@spatialys.com>

Peter,

I suspect the reprojection of your features went fine, otherwise you 
would have got an error message like "Failed to reproject feature XXXX 
(geometry probably out of source or destination SRS)". This error 
message must come from some code that tries heuristics related to polar 
or anti-meridian geometry splitting, although normally there are 
provisions to silent non-critical reprojection errors related to those 
heuristics, but perhaps there's some silencing missing somewhere.

I could have a look if you can pass on the dataset (you can send it / a 
link for it privately if needed)

Even

Le 19/12/2022 ? 19:16, Peter Townsend via gdal-dev a ?crit?:
> I've got this test dataset of a bunch of forest areas in Alaska. The 
> shapefile is in Albers, and we're converting it to EPSG:4326 lat longs.
>
> Layer name: trees
> Geometry: Polygon
> Feature Count: 444
> Extent: (-2175230.041280, 1899842.624457) - (4895522.387686, 
> 6909266.538422)
> Layer SRS WKT:
> PROJCRS["Albers",
> ? ? BASEGEOGCRS["NAD27",
> ? ? ? ? DATUM["North American Datum 1927",
> ? ? ? ? ? ? ELLIPSOID["Clarke 1866",6378206.4,294.978698213898,
> ? ? ? ? ? ? ? ? LENGTHUNIT["metre",1]],
> ? ? ? ? ? ? ID["EPSG",6267]],
> ? ? ? ? PRIMEM["Greenwich",0,
> ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433]]],
> ? ? CONVERSION["unnamed",
> ? ? ? ? METHOD["Albers Equal Area",
> ? ? ? ? ? ? ID["EPSG",9822]],
> ? ? ? ? PARAMETER["Latitude of false origin",50,
> ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
> ? ? ? ? ? ? ID["EPSG",8821]],
> ? ? ? ? PARAMETER["Longitude of false origin",-154,
> ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
> ? ? ? ? ? ? ID["EPSG",8822]],
> ? ? ? ? PARAMETER["Latitude of 1st standard parallel",55,
> ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
> ? ? ? ? ? ? ID["EPSG",8823]],
> ? ? ? ? PARAMETER["Latitude of 2nd standard parallel",65,
> ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
> ? ? ? ? ? ? ID["EPSG",8824]],
> ? ? ? ? PARAMETER["Easting at false origin",0,
> ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219],
> ? ? ? ? ? ? ID["EPSG",8826]],
> ? ? ? ? PARAMETER["Northing at false origin",0,
> ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219],
> ? ? ? ? ? ? ID["EPSG",8827]]],
> ? ? CS[Cartesian,2],
> ? ? ? ? AXIS["(E)",east,
> ? ? ? ? ? ? ORDER[1],
> ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219,
> ? ? ? ? ? ? ? ? ID["EPSG",9003]]],
> ? ? ? ? AXIS["(N)",north,
> ? ? ? ? ? ? ORDER[2],
> ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219,
> ? ? ? ? ? ? ? ? ID["EPSG",9003]]]]
>
> We're trying to upgrade our GDAL from 3.21 to 3.53, and our poor test 
> is getting flagged now with either "ERROR 1: Point outside of 
> projection domain" and/or "ERROR 1: tolerance condition error".
>
> This is what I'm seeing:
> ogr2ogr.exe -skipfailures -t_srs EPSG:4326 --debug on c:\path\output 
> c:\path\trees.shp
> GDAL: GDALOpen(c:\path\trees.shp, this=0000027A1189CBE0) succeeds as 
> ESRI Shapefile.
> GDAL: Using ESRI Shapefile driver
> GDAL: GDALDriver::Create(ESRI 
> Shapefile,c:\path\output,0,0,0,Unknown,0000000000000000)
> Shape: DBF Codepage = LDID/87 for c:\path\trees.shp
> Shape: Treating as encoding 'ISO-8859-1'.
> ERROR 1: tolerance condition error
> ERROR 1: tolerance condition error
> GDALVectorTranslate: 444 features written in layer 'trees'
> Shape: 444 features read on layer 'trees'.
> GDAL: GDALClose(c:\path\trees.shp, this=0000027A1189CBE0)
> GDAL: GDALClose(c:\path\output, this=0000027A1189D4A0)
> GDAL: In GDALDestroy - unloading GDAL shared library.
>
> (Same thing happens without skipfailures.)
>
> Now I'm 95% sure it's throwing this error because there's some vertex 
> somewhere in here that's in that special "dead zone" for Alaska Albers 
> that can't convert to 4326 (seen this before on other datasets trying 
> to project individual points).
>
> What I'm wondering is this:
> 1) Is there any way to get GDAL to tell me what feature/coordinate 
> threw the error?
> 2) What is it doing as a fallback behavior? Skipping the point and 
> moving on? I still come out with the same number of features in the end.
>
> Thanks!
> -- 
> Peter Townsend
> Senior Software Developer
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221219/62c04ff9/attachment.htm>

From peter.townsend at maplarge.com  Mon Dec 19 10:59:45 2022
From: peter.townsend at maplarge.com (Peter Townsend)
Date: Mon, 19 Dec 2022 12:59:45 -0600
Subject: [gdal-dev] Tolerance Condition Error ogr2ogr Albers to EPSG:4326
In-Reply-To: <a2c01e15-8646-4101-b5dd-cb34d8ff0816@spatialys.com>
References: <CAMQBGmVqKK4+3McffFnWfKJ+3TOvp6=5Kgm=uR5UmF11-D3ymQ@mail.gmail.com>
 <a2c01e15-8646-4101-b5dd-cb34d8ff0816@spatialys.com>
Message-ID: <CAMQBGmV6WTBXnWvXjTE-yVDhGZiPZPgEKrftdB8+NG9KmzC=mQ@mail.gmail.com>

I figured out that the dataset is actually the "trees" shapefile from the
QGIS sample dataset. Throws the same messaging out.
https://download.qgis.org/downloads/data/

qgis_sample_data\shapefiles\trees.*

Good luck!

On Mon, Dec 19, 2022 at 12:46 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Peter,
>
> I suspect the reprojection of your features went fine, otherwise you would
> have got an error message like "Failed to reproject feature XXXX (geometry
> probably out of source or destination SRS)". This error message must come
> from some code that tries heuristics related to polar or anti-meridian
> geometry splitting, although normally there are provisions to silent
> non-critical reprojection errors related to those heuristics, but perhaps
> there's some silencing missing somewhere.
>
> I could have a look if you can pass on the dataset (you can send it / a
> link for it privately if needed)
>
> Even
> Le 19/12/2022 ? 19:16, Peter Townsend via gdal-dev a ?crit :
>
> I've got this test dataset of a bunch of forest areas in Alaska. The
> shapefile is in Albers, and we're converting it to EPSG:4326 lat longs.
>
> Layer name: trees
> Geometry: Polygon
> Feature Count: 444
> Extent: (-2175230.041280, 1899842.624457) - (4895522.387686,
> 6909266.538422)
> Layer SRS WKT:
> PROJCRS["Albers",
>     BASEGEOGCRS["NAD27",
>         DATUM["North American Datum 1927",
>             ELLIPSOID["Clarke 1866",6378206.4,294.978698213898,
>                 LENGTHUNIT["metre",1]],
>             ID["EPSG",6267]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["Degree",0.0174532925199433]]],
>     CONVERSION["unnamed",
>         METHOD["Albers Equal Area",
>             ID["EPSG",9822]],
>         PARAMETER["Latitude of false origin",50,
>             ANGLEUNIT["Degree",0.0174532925199433],
>             ID["EPSG",8821]],
>         PARAMETER["Longitude of false origin",-154,
>             ANGLEUNIT["Degree",0.0174532925199433],
>             ID["EPSG",8822]],
>         PARAMETER["Latitude of 1st standard parallel",55,
>             ANGLEUNIT["Degree",0.0174532925199433],
>             ID["EPSG",8823]],
>         PARAMETER["Latitude of 2nd standard parallel",65,
>             ANGLEUNIT["Degree",0.0174532925199433],
>             ID["EPSG",8824]],
>         PARAMETER["Easting at false origin",0,
>             LENGTHUNIT["US survey foot",0.304800609601219],
>             ID["EPSG",8826]],
>         PARAMETER["Northing at false origin",0,
>             LENGTHUNIT["US survey foot",0.304800609601219],
>             ID["EPSG",8827]]],
>     CS[Cartesian,2],
>         AXIS["(E)",east,
>             ORDER[1],
>             LENGTHUNIT["US survey foot",0.304800609601219,
>                 ID["EPSG",9003]]],
>         AXIS["(N)",north,
>             ORDER[2],
>             LENGTHUNIT["US survey foot",0.304800609601219,
>                 ID["EPSG",9003]]]]
>
> We're trying to upgrade our GDAL from 3.21 to 3.53, and our poor test is
> getting flagged now with either "ERROR 1: Point outside of projection
> domain" and/or "ERROR 1: tolerance condition error".
>
> This is what I'm seeing:
> ogr2ogr.exe -skipfailures -t_srs EPSG:4326 --debug on c:\path\output
> c:\path\trees.shp
> GDAL: GDALOpen(c:\path\trees.shp, this=0000027A1189CBE0) succeeds as ESRI
> Shapefile.
> GDAL: Using ESRI Shapefile driver
> GDAL: GDALDriver::Create(ESRI
> Shapefile,c:\path\output,0,0,0,Unknown,0000000000000000)
> Shape: DBF Codepage = LDID/87 for c:\path\trees.shp
> Shape: Treating as encoding 'ISO-8859-1'.
> ERROR 1: tolerance condition error
> ERROR 1: tolerance condition error
> GDALVectorTranslate: 444 features written in layer 'trees'
> Shape: 444 features read on layer 'trees'.
> GDAL: GDALClose(c:\path\trees.shp, this=0000027A1189CBE0)
> GDAL: GDALClose(c:\path\output, this=0000027A1189D4A0)
> GDAL: In GDALDestroy - unloading GDAL shared library.
>
> (Same thing happens without skipfailures.)
>
> Now I'm 95% sure it's throwing this error because there's some vertex
> somewhere in here that's in that special "dead zone" for Alaska Albers that
> can't convert to 4326 (seen this before on other datasets trying to project
> individual points).
>
> What I'm wondering is this:
> 1) Is there any way to get GDAL to tell me what feature/coordinate threw
> the error?
> 2) What is it doing as a fallback behavior? Skipping the point and moving
> on? I still come out with the same number of features in the end.
>
> Thanks!
> --
> Peter Townsend
> Senior Software Developer
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Peter Townsend
Senior Software Developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221219/4b63c43f/attachment-0001.htm>

From even.rouault at spatialys.com  Mon Dec 19 11:42:00 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 19 Dec 2022 20:42:00 +0100
Subject: [gdal-dev] Tolerance Condition Error ogr2ogr Albers to EPSG:4326
In-Reply-To: <CAMQBGmV6WTBXnWvXjTE-yVDhGZiPZPgEKrftdB8+NG9KmzC=mQ@mail.gmail.com>
References: <CAMQBGmVqKK4+3McffFnWfKJ+3TOvp6=5Kgm=uR5UmF11-D3ymQ@mail.gmail.com>
 <a2c01e15-8646-4101-b5dd-cb34d8ff0816@spatialys.com>
 <CAMQBGmV6WTBXnWvXjTE-yVDhGZiPZPgEKrftdB8+NG9KmzC=mQ@mail.gmail.com>
Message-ID: <2a889864-f934-18a3-2022-ae87137ee26e@spatialys.com>

Fix in https://github.com/OSGeo/gdal/pull/6945. The error is actually 
harmless as I suspected and was related to the polar geometry splitting 
heuristics not properly shutting off reprojection errors.

Even

Le 19/12/2022 ? 19:59, Peter Townsend a ?crit?:
> I figured out that the dataset is actually the "trees" shapefile from 
> the QGIS sample dataset. Throws the same messaging out.
> https://download.qgis.org/downloads/data/
>
> qgis_sample_data\shapefiles\trees.*
>
> Good luck!
>
> On Mon, Dec 19, 2022 at 12:46 PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Peter,
>
>     I suspect the reprojection of your features went fine, otherwise
>     you would have got an error message like "Failed to reproject
>     feature XXXX (geometry probably out of source or destination
>     SRS)". This error message must come from some code that tries
>     heuristics related to polar or anti-meridian geometry splitting,
>     although normally there are provisions to silent non-critical
>     reprojection errors related to those heuristics, but perhaps
>     there's some silencing missing somewhere.
>
>     I could have a look if you can pass on the dataset (you can send
>     it / a link for it privately if needed)
>
>     Even
>
>     Le 19/12/2022 ? 19:16, Peter Townsend via gdal-dev a ?crit?:
>>     I've got this test dataset of a bunch of forest areas in Alaska.
>>     The shapefile is in Albers, and we're converting it to EPSG:4326
>>     lat longs.
>>
>>     Layer name: trees
>>     Geometry: Polygon
>>     Feature Count: 444
>>     Extent: (-2175230.041280, 1899842.624457) - (4895522.387686,
>>     6909266.538422)
>>     Layer SRS WKT:
>>     PROJCRS["Albers",
>>     ? ? BASEGEOGCRS["NAD27",
>>     ? ? ? ? DATUM["North American Datum 1927",
>>     ? ? ? ? ? ? ELLIPSOID["Clarke 1866",6378206.4,294.978698213898,
>>     ? ? ? ? ? ? ? ? LENGTHUNIT["metre",1]],
>>     ? ? ? ? ? ? ID["EPSG",6267]],
>>     ? ? ? ? PRIMEM["Greenwich",0,
>>     ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433]]],
>>     ? ? CONVERSION["unnamed",
>>     ? ? ? ? METHOD["Albers Equal Area",
>>     ? ? ? ? ? ? ID["EPSG",9822]],
>>     ? ? ? ? PARAMETER["Latitude of false origin",50,
>>     ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
>>     ? ? ? ? ? ? ID["EPSG",8821]],
>>     ? ? ? ? PARAMETER["Longitude of false origin",-154,
>>     ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
>>     ? ? ? ? ? ? ID["EPSG",8822]],
>>     ? ? ? ? PARAMETER["Latitude of 1st standard parallel",55,
>>     ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
>>     ? ? ? ? ? ? ID["EPSG",8823]],
>>     ? ? ? ? PARAMETER["Latitude of 2nd standard parallel",65,
>>     ? ? ? ? ? ? ANGLEUNIT["Degree",0.0174532925199433],
>>     ? ? ? ? ? ? ID["EPSG",8824]],
>>     ? ? ? ? PARAMETER["Easting at false origin",0,
>>     ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219],
>>     ? ? ? ? ? ? ID["EPSG",8826]],
>>     ? ? ? ? PARAMETER["Northing at false origin",0,
>>     ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219],
>>     ? ? ? ? ? ? ID["EPSG",8827]]],
>>     ? ? CS[Cartesian,2],
>>     ? ? ? ? AXIS["(E)",east,
>>     ? ? ? ? ? ? ORDER[1],
>>     ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219,
>>     ? ? ? ? ? ? ? ? ID["EPSG",9003]]],
>>     ? ? ? ? AXIS["(N)",north,
>>     ? ? ? ? ? ? ORDER[2],
>>     ? ? ? ? ? ? LENGTHUNIT["US survey foot",0.304800609601219,
>>     ? ? ? ? ? ? ? ? ID["EPSG",9003]]]]
>>
>>     We're trying to upgrade our GDAL from 3.21 to 3.53, and our poor
>>     test is getting flagged now with either "ERROR 1: Point outside
>>     of projection domain" and/or "ERROR 1: tolerance condition error".
>>
>>     This is what I'm seeing:
>>     ogr2ogr.exe -skipfailures -t_srs EPSG:4326 --debug on
>>     c:\path\output c:\path\trees.shp
>>     GDAL: GDALOpen(c:\path\trees.shp, this=0000027A1189CBE0) succeeds
>>     as ESRI Shapefile.
>>     GDAL: Using ESRI Shapefile driver
>>     GDAL: GDALDriver::Create(ESRI
>>     Shapefile,c:\path\output,0,0,0,Unknown,0000000000000000)
>>     Shape: DBF Codepage = LDID/87 for c:\path\trees.shp
>>     Shape: Treating as encoding 'ISO-8859-1'.
>>     ERROR 1: tolerance condition error
>>     ERROR 1: tolerance condition error
>>     GDALVectorTranslate: 444 features written in layer 'trees'
>>     Shape: 444 features read on layer 'trees'.
>>     GDAL: GDALClose(c:\path\trees.shp, this=0000027A1189CBE0)
>>     GDAL: GDALClose(c:\path\output, this=0000027A1189D4A0)
>>     GDAL: In GDALDestroy - unloading GDAL shared library.
>>
>>     (Same thing happens without skipfailures.)
>>
>>     Now I'm 95% sure it's throwing this error because there's some
>>     vertex somewhere in here that's in that special "dead zone" for
>>     Alaska Albers that can't convert to 4326 (seen this before on
>>     other datasets trying to project individual points).
>>
>>     What I'm wondering is this:
>>     1) Is there any way to get GDAL to tell me what
>>     feature/coordinate threw the error?
>>     2) What is it doing as a fallback behavior? Skipping the point
>>     and moving on? I still come out with the same number of features
>>     in the end.
>>
>>     Thanks!
>>     -- 
>>     Peter Townsend
>>     Senior Software Developer
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
>
> -- 
> Peter Townsend
> Senior Software Developer

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221219/48995b27/attachment.htm>

From peter.townsend at maplarge.com  Mon Dec 19 11:48:30 2022
From: peter.townsend at maplarge.com (Peter Townsend)
Date: Mon, 19 Dec 2022 13:48:30 -0600
Subject: [gdal-dev] Tolerance Condition Error ogr2ogr Albers to EPSG:4326
In-Reply-To: <2a889864-f934-18a3-2022-ae87137ee26e@spatialys.com>
References: <CAMQBGmVqKK4+3McffFnWfKJ+3TOvp6=5Kgm=uR5UmF11-D3ymQ@mail.gmail.com>
 <a2c01e15-8646-4101-b5dd-cb34d8ff0816@spatialys.com>
 <CAMQBGmV6WTBXnWvXjTE-yVDhGZiPZPgEKrftdB8+NG9KmzC=mQ@mail.gmail.com>
 <2a889864-f934-18a3-2022-ae87137ee26e@spatialys.com>
Message-ID: <CAMQBGmX5tRVEaKTD3wsB5NbdV1Cj23BgydKNWRvQuzQdbG6EdQ@mail.gmail.com>

Thanks!

One more question. For the time being, is it generally ok to ignore
"tolerance condition error" and "Point outside of projection domain"? I can
make our program not care about those if it's usually harmless.

On Mon, Dec 19, 2022 at 1:42 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Fix in https://github.com/OSGeo/gdal/pull/6945. The error is actually
> harmless as I suspected and was related to the polar geometry splitting
> heuristics not properly shutting off reprojection errors.
>
> Even
> Le 19/12/2022 ? 19:59, Peter Townsend a ?crit :
>
> I figured out that the dataset is actually the "trees" shapefile from the
> QGIS sample dataset. Throws the same messaging out.
> https://download.qgis.org/downloads/data/
>
> qgis_sample_data\shapefiles\trees.*
>
> Good luck!
>
> On Mon, Dec 19, 2022 at 12:46 PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Peter,
>>
>> I suspect the reprojection of your features went fine, otherwise you
>> would have got an error message like "Failed to reproject feature XXXX
>> (geometry probably out of source or destination SRS)". This error message
>> must come from some code that tries heuristics related to polar or
>> anti-meridian geometry splitting, although normally there are provisions to
>> silent non-critical reprojection errors related to those heuristics, but
>> perhaps there's some silencing missing somewhere.
>>
>> I could have a look if you can pass on the dataset (you can send it / a
>> link for it privately if needed)
>>
>> Even
>> Le 19/12/2022 ? 19:16, Peter Townsend via gdal-dev a ?crit :
>>
>> I've got this test dataset of a bunch of forest areas in Alaska. The
>> shapefile is in Albers, and we're converting it to EPSG:4326 lat longs.
>>
>> Layer name: trees
>> Geometry: Polygon
>> Feature Count: 444
>> Extent: (-2175230.041280, 1899842.624457) - (4895522.387686,
>> 6909266.538422)
>> Layer SRS WKT:
>> PROJCRS["Albers",
>>     BASEGEOGCRS["NAD27",
>>         DATUM["North American Datum 1927",
>>             ELLIPSOID["Clarke 1866",6378206.4,294.978698213898,
>>                 LENGTHUNIT["metre",1]],
>>             ID["EPSG",6267]],
>>         PRIMEM["Greenwich",0,
>>             ANGLEUNIT["Degree",0.0174532925199433]]],
>>     CONVERSION["unnamed",
>>         METHOD["Albers Equal Area",
>>             ID["EPSG",9822]],
>>         PARAMETER["Latitude of false origin",50,
>>             ANGLEUNIT["Degree",0.0174532925199433],
>>             ID["EPSG",8821]],
>>         PARAMETER["Longitude of false origin",-154,
>>             ANGLEUNIT["Degree",0.0174532925199433],
>>             ID["EPSG",8822]],
>>         PARAMETER["Latitude of 1st standard parallel",55,
>>             ANGLEUNIT["Degree",0.0174532925199433],
>>             ID["EPSG",8823]],
>>         PARAMETER["Latitude of 2nd standard parallel",65,
>>             ANGLEUNIT["Degree",0.0174532925199433],
>>             ID["EPSG",8824]],
>>         PARAMETER["Easting at false origin",0,
>>             LENGTHUNIT["US survey foot",0.304800609601219],
>>             ID["EPSG",8826]],
>>         PARAMETER["Northing at false origin",0,
>>             LENGTHUNIT["US survey foot",0.304800609601219],
>>             ID["EPSG",8827]]],
>>     CS[Cartesian,2],
>>         AXIS["(E)",east,
>>             ORDER[1],
>>             LENGTHUNIT["US survey foot",0.304800609601219,
>>                 ID["EPSG",9003]]],
>>         AXIS["(N)",north,
>>             ORDER[2],
>>             LENGTHUNIT["US survey foot",0.304800609601219,
>>                 ID["EPSG",9003]]]]
>>
>> We're trying to upgrade our GDAL from 3.21 to 3.53, and our poor test is
>> getting flagged now with either "ERROR 1: Point outside of projection
>> domain" and/or "ERROR 1: tolerance condition error".
>>
>> This is what I'm seeing:
>> ogr2ogr.exe -skipfailures -t_srs EPSG:4326 --debug on c:\path\output
>> c:\path\trees.shp
>> GDAL: GDALOpen(c:\path\trees.shp, this=0000027A1189CBE0) succeeds as ESRI
>> Shapefile.
>> GDAL: Using ESRI Shapefile driver
>> GDAL: GDALDriver::Create(ESRI
>> Shapefile,c:\path\output,0,0,0,Unknown,0000000000000000)
>> Shape: DBF Codepage = LDID/87 for c:\path\trees.shp
>> Shape: Treating as encoding 'ISO-8859-1'.
>> ERROR 1: tolerance condition error
>> ERROR 1: tolerance condition error
>> GDALVectorTranslate: 444 features written in layer 'trees'
>> Shape: 444 features read on layer 'trees'.
>> GDAL: GDALClose(c:\path\trees.shp, this=0000027A1189CBE0)
>> GDAL: GDALClose(c:\path\output, this=0000027A1189D4A0)
>> GDAL: In GDALDestroy - unloading GDAL shared library.
>>
>> (Same thing happens without skipfailures.)
>>
>> Now I'm 95% sure it's throwing this error because there's some vertex
>> somewhere in here that's in that special "dead zone" for Alaska Albers that
>> can't convert to 4326 (seen this before on other datasets trying to project
>> individual points).
>>
>> What I'm wondering is this:
>> 1) Is there any way to get GDAL to tell me what feature/coordinate threw
>> the error?
>> 2) What is it doing as a fallback behavior? Skipping the point and moving
>> on? I still come out with the same number of features in the end.
>>
>> Thanks!
>> --
>> Peter Townsend
>> Senior Software Developer
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> Peter Townsend
> Senior Software Developer
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Peter Townsend
Senior Software Developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221219/71f6dfcd/attachment-0001.htm>

From even.rouault at spatialys.com  Mon Dec 19 11:56:10 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 19 Dec 2022 20:56:10 +0100
Subject: [gdal-dev] Tolerance Condition Error ogr2ogr Albers to EPSG:4326
In-Reply-To: <CAMQBGmX5tRVEaKTD3wsB5NbdV1Cj23BgydKNWRvQuzQdbG6EdQ@mail.gmail.com>
References: <CAMQBGmVqKK4+3McffFnWfKJ+3TOvp6=5Kgm=uR5UmF11-D3ymQ@mail.gmail.com>
 <a2c01e15-8646-4101-b5dd-cb34d8ff0816@spatialys.com>
 <CAMQBGmV6WTBXnWvXjTE-yVDhGZiPZPgEKrftdB8+NG9KmzC=mQ@mail.gmail.com>
 <2a889864-f934-18a3-2022-ae87137ee26e@spatialys.com>
 <CAMQBGmX5tRVEaKTD3wsB5NbdV1Cj23BgydKNWRvQuzQdbG6EdQ@mail.gmail.com>
Message-ID: <a01c9a2c-8451-658a-4c4b-b7c30a5dd16a@spatialys.com>


Le 19/12/2022 ? 20:48, Peter Townsend a ?crit?:
> Thanks!
>
> One more question. For the time being, is it generally ok to ignore 
> "tolerance condition error" and "Point outside of projection domain"? 
> I can make our program not care about those if it's usually harmless.

They could still be emitted if features' geometries fail to reproject. 
If you don't pass the -skip_failure flag, then you can just test ogr2ogr 
error code. If it is 0, everything is fine.


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Dec 19 19:57:57 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 20 Dec 2022 04:57:57 +0100
Subject: [gdal-dev] Motion: adopt RFC89: SQL query logging callback
In-Reply-To: <78f1667f-f629-8a8f-1b67-608b508018cf@spatialys.com>
References: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
 <78f1667f-f629-8a8f-1b67-608b508018cf@spatialys.com>
Message-ID: <936d26bf-007a-37ea-064f-3133f2ed17fc@spatialys.com>

It would be great if a few other PSC members could cast their vote.

Even

Le 15/12/2022 ? 23:38, Even Rouault a ?crit?:
> +1 Even
>
> Le 12/12/2022 ? 15:10, ElPaso a ?crit?:
>> Hi,
>>
>> Motion:
>>
>> Adopt? RFC89: SQL query logging callback [1]
>>
>> A draft implementation is available at [2].
>>
>> An example of how client code could make use of this new 
>> functionality is avaiable for QGIS at [3].
>>
>> Kind regards.
>>
>>
>> [1] https://github.com/OSGeo/gdal/pull/6837
>>
>> [2] 
>> https://github.com/elpaso/gdal/tree/rfc89_sql_logging_callback_implementation
>>
>> [3] https://github.com/elpaso/QGIS/tree/ogrprovider-sql-logging
>>
>>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From mateusz at loskot.net  Tue Dec 20 05:08:44 2022
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 20 Dec 2022 14:08:44 +0100
Subject: [gdal-dev] Motion: adopt RFC89: SQL query logging callback
In-Reply-To: <936d26bf-007a-37ea-064f-3133f2ed17fc@spatialys.com>
References: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
 <78f1667f-f629-8a8f-1b67-608b508018cf@spatialys.com>
 <936d26bf-007a-37ea-064f-3133f2ed17fc@spatialys.com>
Message-ID: <CABUeae8rskUDbQojTztpLnj-6_KRTWOjS+aBakwvOkLc=0VB_g@mail.gmail.com>

+1 Mateusz

On Tue, 20 Dec 2022 at 04:58, Even Rouault <even.rouault at spatialys.com> wrote:
>
> It would be great if a few other PSC members could cast their vote.
>
> Even
>
> Le 15/12/2022 ? 23:38, Even Rouault a ?crit :
> > +1 Even
> >
> > Le 12/12/2022 ? 15:10, ElPaso a ?crit :
> >> Hi,
> >>
> >> Motion:
> >>
> >> Adopt  RFC89: SQL query logging callback [1]
> >>
> >> A draft implementation is available at [2].
> >>
> >> An example of how client code could make use of this new
> >> functionality is avaiable for QGIS at [3].
> >>
> >> Kind regards.
> >>
> >>
> >> [1] https://github.com/OSGeo/gdal/pull/6837
> >>
> >> [2]
> >> https://github.com/elpaso/gdal/tree/rfc89_sql_logging_callback_implementation
> >>
> >> [3] https://github.com/elpaso/QGIS/tree/ogrprovider-sql-logging
> >>
> >>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Mateusz Loskot, http://mateusz.loskot.net

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec 20 05:33:37 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 20 Dec 2022 13:33:37 +0000
Subject: [gdal-dev] Motion: adopt RFC89: SQL query logging callback
In-Reply-To: <CABUeae8rskUDbQojTztpLnj-6_KRTWOjS+aBakwvOkLc=0VB_g@mail.gmail.com>
References: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
 <78f1667f-f629-8a8f-1b67-608b508018cf@spatialys.com>
 <936d26bf-007a-37ea-064f-3133f2ed17fc@spatialys.com>
 <CABUeae8rskUDbQojTztpLnj-6_KRTWOjS+aBakwvOkLc=0VB_g@mail.gmail.com>
Message-ID: <AM0PR09MB3219FCEA22C20F9B5C725A33FDEA9@AM0PR09MB3219.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Mateusz Loskot
L?hetetty: tiistai 20. joulukuuta 2022 15.09
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] Motion: adopt RFC89: SQL query logging callback

+1 Mateusz

On Tue, 20 Dec 2022 at 04:58, Even Rouault <even.rouault at spatialys.com> wrote:
>
> It would be great if a few other PSC members could cast their vote.
>
> Even
>
> Le 15/12/2022 ? 23:38, Even Rouault a ?crit :
> > +1 Even
> >
> > Le 12/12/2022 ? 15:10, ElPaso a ?crit :
> >> Hi,
> >>
> >> Motion:
> >>
> >> Adopt  RFC89: SQL query logging callback [1]
> >>
> >> A draft implementation is available at [2].
> >>
> >> An example of how client code could make use of this new 
> >> functionality is avaiable for QGIS at [3].
> >>
> >> Kind regards.
> >>
> >>
> >> [1] 
> >> https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fg
> >> ithub.com%2FOSGeo%2Fgdal%2Fpull%2F6837&data=05%7C01%7Cjukka.rahkone
> >> n%40maanmittauslaitos.fi%7Cf19200a046b54a83b1f708dae28b7087%7Cc4f8a
> >> 63255804a1c92371d5a571b71fa%7C0%7C0%7C638071385770780495%7CUnknown%
> >> 7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiL
> >> CJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=MfxEhfPPaQ3YoTgC1DGFA6VPP%2F92S
> >> PsriQamffWlkhY%3D&reserved=0
> >>
> >> [2]
> >> https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fg
> >> ithub.com%2Felpaso%2Fgdal%2Ftree%2Frfc89_sql_logging_callback_imple
> >> mentation&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cf1
> >> 9200a046b54a83b1f708dae28b7087%7Cc4f8a63255804a1c92371d5a571b71fa%7
> >> C0%7C0%7C638071385770780495%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjA
> >> wMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C
> >> &sdata=PwIJs2fUWS%2Fp2XrFoR9m3IhmGL3uEmyA7GHSWdVK3Is%3D&reserved=0
> >>
> >> [3] 
> >> https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fg
> >> ithub.com%2Felpaso%2FQGIS%2Ftree%2Fogrprovider-sql-logging&data=05%
> >> 7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cf19200a046b54a83b1f7
> >> 08dae28b7087%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638071385
> >> 770780495%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luM
> >> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=7c3m%2BEZOG
> >> p%2BHnoYXxL0bnyFhLl9qo4iErNKXNvoq9Wc%3D&reserved=0
> >>
> >>
> --
> https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.s
> patialys.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7
> Cf19200a046b54a83b1f708dae28b7087%7Cc4f8a63255804a1c92371d5a571b71fa%7
> C0%7C0%7C638071385770780495%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMD
> AiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata
> =h1FZrQ9j%2B8I97MRyLNwRE2W%2BD5yE9Zppssz%2BYb1Q8po%3D&reserved=0
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flist
> s.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahko
> nen%40maanmittauslaitos.fi%7Cf19200a046b54a83b1f708dae28b7087%7Cc4f8a6
> 3255804a1c92371d5a571b71fa%7C0%7C0%7C638071385770780495%7CUnknown%7CTW
> FpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6
> Mn0%3D%7C3000%7C%7C%7C&sdata=w1ni%2BX%2FgIbl2Y%2BT%2BXfQ7fQ4%2BTlSJanN
> lw%2BydVvIrptw%3D&reserved=0



--
Mateusz Loskot, https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fmateusz.loskot.net%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cf19200a046b54a83b1f708dae28b7087%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638071385770780495%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=we%2FvNgDNS9yym22H5FFvMaQJmajvQM%2Bf2dKk2Sw8NQM%3D&reserved=0
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cf19200a046b54a83b1f708dae28b7087%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638071385770780495%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=w1ni%2BX%2FgIbl2Y%2BT%2BXfQ7fQ4%2BTlSJanNlw%2BydVvIrptw%3D&reserved=0

From szekerest at gmail.com  Tue Dec 20 06:10:15 2022
From: szekerest at gmail.com (Tamas Szekeres)
Date: Tue, 20 Dec 2022 15:10:15 +0100
Subject: [gdal-dev] Motion: adopt RFC89: SQL query logging callback
In-Reply-To: <936d26bf-007a-37ea-064f-3133f2ed17fc@spatialys.com>
References: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
 <78f1667f-f629-8a8f-1b67-608b508018cf@spatialys.com>
 <936d26bf-007a-37ea-064f-3133f2ed17fc@spatialys.com>
Message-ID: <CACALY+Q6bMTYOaq41bYY_U-K9j_b5WDxhEMrL72YMjUHvbsgDg@mail.gmail.com>

+1

Tamas


Even Rouault <even.rouault at spatialys.com> ezt ?rta (id?pont: 2022. dec.
20., K, 4:58):

> It would be great if a few other PSC members could cast their vote.
>
> Even
>
> Le 15/12/2022 ? 23:38, Even Rouault a ?crit :
> > +1 Even
> >
> > Le 12/12/2022 ? 15:10, ElPaso a ?crit :
> >> Hi,
> >>
> >> Motion:
> >>
> >> Adopt  RFC89: SQL query logging callback [1]
> >>
> >> A draft implementation is available at [2].
> >>
> >> An example of how client code could make use of this new
> >> functionality is avaiable for QGIS at [3].
> >>
> >> Kind regards.
> >>
> >>
> >> [1] https://github.com/OSGeo/gdal/pull/6837
> >>
> >> [2]
> >>
> https://github.com/elpaso/gdal/tree/rfc89_sql_logging_callback_implementation
> >>
> >> [3] https://github.com/elpaso/QGIS/tree/ogrprovider-sql-logging
> >>
> >>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221220/515e3b26/attachment.htm>

From even.rouault at spatialys.com  Wed Dec 21 03:52:53 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 21 Dec 2022 12:52:53 +0100
Subject: [gdal-dev] Advanced 3.6.1 release and retraction of 3.6.0 ?
In-Reply-To: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
References: <621e48be-5cba-bbb4-70e0-cbc8ec589a22@spatialys.com>
Message-ID: <40404818-368f-f5d6-b5cf-fabc14894a8a@spatialys.com>

Hi,

playing lately with more complex scenarios with ogr2ogr, that time 
involving both a lot of features and multiple layers being converted at 
once to GeoPackage, I've seen error messages being emitted during 
conversions and some slowness due to SQLite3 self-locking itself for 
periods of a few seconds. This is still due to the multithreaded RTree 
implementation. I didn't notice data corruption though, but I won't 
swear it couldn't happen.

My conclusion was that is isn't safe to enable it when multiple layers 
are created in a GeoPackage file. I've thus disabled it in such 
scenarios per https://github.com/OSGeo/gdal/pull/6959. So in the 
meantime setting the OGR_GPKG_ALLOW_THREADED_RTREE environment 
variable/configuration option to NO is still a recommended workaround 
(if you write multiple layers in the same GeoPackage file). I'll 
probably issue a 3.6.2 release at the beginning of next year when 
everyone is back from their break.

Even

Le 13/12/2022 ? 16:18, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> https://github.com/qgis/QGIS/issues/51188 has been brought to my 
> attention. The issue is that the new background building of the RTree 
> of GeoPackage files introduced in 3.6.0 didn't work well with 
> committing transactions in between, which is easily triggered by 
> ogr2ogr. All features were inserted but with default settings ~ 10% of 
> them lacked an entry in the spatial index, which can be enough to 
> break interactive display and workflows relying on spatial filtering. 
> When using ogr2ogr, I believe the issue can only be seen when creating 
> layers with more than 100 000 features, since that's the default value 
> for the interval at which transactions are committed.
>
> I've a fix ready in https://github.com/OSGeo/gdal/pull/6911. The fix 
> itself is a simple two-liner: 
> https://github.com/OSGeo/gdal/pull/6911/commits/3f5f6225fe82e0c2e0241e4f66bfb861cdf4fe9d
>
> Given the status of GeoPackage being the default format for QGIS, I 
> believe this is a severe enough issue to warrant an advanced 3.6.1 
> release, and an official retraction of 3.6.0.
>
> Thoughts ?
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Dec 21 05:07:11 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 21 Dec 2022 14:07:11 +0100
Subject: [gdal-dev] Motion: adopt RFC89: SQL query logging callback
In-Reply-To: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
References: <fbf6105d-d22f-0d54-89e4-6829cac688ae@itopen.it>
Message-ID: <cecb4fdf-0915-34c0-836d-8ab0d06c4559@spatialys.com>

This motion is passed with +1 from PSC members MateuszL, JukkaR, TamasS 
and me.

Even

Le 12/12/2022 ? 15:10, ElPaso a ?crit?:
> Hi,
>
> Motion:
>
> Adopt? RFC89: SQL query logging callback [1]
>
> A draft implementation is available at [2].
>
> An example of how client code could make use of this new functionality 
> is avaiable for QGIS at [3].
>
> Kind regards.
>
>
> [1] https://github.com/OSGeo/gdal/pull/6837
>
> [2] 
> https://github.com/elpaso/gdal/tree/rfc89_sql_logging_callback_implementation
>
> [3] https://github.com/elpaso/QGIS/tree/ogrprovider-sql-logging
>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew.terry at centremaps.co.uk  Thu Dec 22 05:07:58 2022
From: andrew.terry at centremaps.co.uk (Andrew Terry)
Date: Thu, 22 Dec 2022 13:07:58 +0000
Subject: [gdal-dev] ogr gml Box handling
Message-ID: <AM6PR01MB49464C53D8AA26F594249486A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>

Hi,

Trying to pull in the bounding box / envelope "Box" when loading gml with ogr2ogr

<osgb:boundedBy>
<gml:Box srsName='osgb:BNG'>
<gml:coordinates>257023.700,620210.000 257023.700,620210.000</gml:coordinates>
</gml:Box>
</osgb:boundedBy>

I've tried <GeometryElementPath>boundedBy</GeometryElementPath> in my gfs file.

I've also tried seeing if I can pull through as a string using:

    <PropertyDefn>
      <Name>bbox</Name>
      <ElementPath>boundedBy|Box|coordinates</ElementPath>
      <Type>String</Type>
    </PropertyDefn>

Any tips - if it's even possible?

Thanks

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221222/e64d8f53/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Dec 22 05:19:45 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 22 Dec 2022 13:19:45 +0000
Subject: [gdal-dev] ogr gml Box handling
In-Reply-To: <AM6PR01MB49464C53D8AA26F594249486A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
References: <AM6PR01MB49464C53D8AA26F594249486A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
Message-ID: <AM0PR09MB3219FEE133A5F1AB29801CEDFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Sorry but I do not understand at all what you want to do. Would you, if you read your question?
Do you have some GML data that has a bounding box for each feature and you would like to convert the bbox into something? Would that be a second geometry for the attribute if the target format supports multiple geometries? Or an attribute that contains the bbox expressed as WKT of GeoJSON? Please give complete GML test data sample and an example about  what would be the ideal result.

In your example the bounding box seems to be a point so probably the data contains also just one point but probably you want to deal with more generic data.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Andrew Terry
L?hetetty: torstai 22. joulukuuta 2022 15.08
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ogr gml Box handling

Hi,

Trying to pull in the bounding box / envelope "Box" when loading gml with ogr2ogr

<osgb:boundedBy>
<gml:Box srsName='osgb:BNG'>
<gml:coordinates>257023.700,620210.000 257023.700,620210.000</gml:coordinates>
</gml:Box>
</osgb:boundedBy>

I've tried <GeometryElementPath>boundedBy</GeometryElementPath> in my gfs file.

I've also tried seeing if I can pull through as a string using:

    <PropertyDefn>
      <Name>bbox</Name>
      <ElementPath>boundedBy|Box|coordinates</ElementPath>
      <Type>String</Type>
    </PropertyDefn>

Any tips - if it's even possible?

Thanks

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221222/b496d190/attachment.htm>

From andrew.terry at centremaps.co.uk  Thu Dec 22 05:48:04 2022
From: andrew.terry at centremaps.co.uk (Andrew Terry)
Date: Thu, 22 Dec 2022 13:48:04 +0000
Subject: [gdal-dev] ogr gml Box handling
In-Reply-To: <AM0PR09MB3219FEE133A5F1AB29801CEDFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM6PR01MB49464C53D8AA26F594249486A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
 <AM0PR09MB3219FEE133A5F1AB29801CEDFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <AM6PR01MB4946C63FDE0379FDA9E01B48A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>

Hi Jukka,

Thanks for responding and apologies for not including enough context.

I'm converting GML into a SQL file form during testing using a command like:

ogr2ogr --config GML_GFS_TEMPLATE test.gfs --config PG_USE_COPY YES -skipfailures -lco spatial_index=NONE -lco create_table=off -lco schema=test -lco create_schema=off -f PGDump output.sql input.gml

An example GML with one feature would be:

<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<osgb:FeatureCollection xmlns:osgb='http://www.ordnancesurvey.co.uk/xml/namespaces/osgb' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:gml='http://www.opengis.net/gml' xmlns:xlink='http://www.w3.org/1999/xlink' xsi:schemaLocation='http://www.ordnancesurvey.co.uk/xml/namespaces/osgb http://www.ordnancesurvey.co.uk/xml/schema/v9/OSDNFFeatures.xsd' fid='LOCAL_ID_0'>
<gml:description>Ordnance Survey, (c) Crown Copyright. All rights reserved, 2022-10-27</gml:description>
<gml:boundedBy>
<gml:null>unknown</gml:null>
</gml:boundedBy>
<osgb:queryTime>2022-10-27T00:10:00</osgb:queryTime>
<osgb:queryChangeSinceDate>2022-09-15</osgb:queryChangeSinceDate>
<osgb:departedMember>
<osgb:DepartedFeature fid='osgb1000000849991256'>
<osgb:boundedBy>
<gml:Box srsName='osgb:BNG'>
<gml:coordinates>254337.630,617076.680 254337.630,617076.680</gml:coordinates>
</gml:Box>
</osgb:boundedBy>
<osgb:theme>Roads Tracks And Paths</osgb:theme>
<osgb:reasonForDeparture>Deleted</osgb:reasonForDeparture>
<osgb:deletionDate>2022-09-26</osgb:deletionDate>
</osgb:DepartedFeature>
</osgb:departedMember>
</osgb:FeatureCollection>

It defines an item's unique fid and some basic attributes along with the "Box" as a bounding box / envelope indication of its location.

Ultimately, the purpose is to form an indication of a feature to be deleted - in this case a point but not always.

ogr2ogr will load the data but doesn't understand the geometry type - and I note a bounding box doesn't seem to be mentioned under types in the documentation

A positive result would be any way to retain the content of gml:coordinates as a geometry or even as text which I could then handle within postgres as something I could turn into a geometry. My assumption has been that I would need to modify the gfs created by org2ogr to try and explicitly pull this element out

Thanks

Andy


From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Sent: 22 December 2022 13:20
To: Andrew Terry <andrew.terry at centremaps.co.uk>; gdal-dev at lists.osgeo.org
Subject: Re: ogr gml Box handling

Hi,

Sorry but I do not understand at all what you want to do. Would you, if you read your question?
Do you have some GML data that has a bounding box for each feature and you would like to convert the bbox into something? Would that be a second geometry for the attribute if the target format supports multiple geometries? Or an attribute that contains the bbox expressed as WKT of GeoJSON? Please give complete GML test data sample and an example about  what would be the ideal result.

In your example the bounding box seems to be a point so probably the data contains also just one point but probably you want to deal with more generic data.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andrew Terry
L?hetetty: torstai 22. joulukuuta 2022 15.08
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogr gml Box handling

Hi,

Trying to pull in the bounding box / envelope "Box" when loading gml with ogr2ogr

<osgb:boundedBy>
<gml:Box srsName='osgb:BNG'>
<gml:coordinates>257023.700,620210.000 257023.700,620210.000</gml:coordinates>
</gml:Box>
</osgb:boundedBy>

I've tried <GeometryElementPath>boundedBy</GeometryElementPath> in my gfs file.

I've also tried seeing if I can pull through as a string using:

    <PropertyDefn>
      <Name>bbox</Name>
      <ElementPath>boundedBy|Box|coordinates</ElementPath>
      <Type>String</Type>
    </PropertyDefn>

Any tips - if it's even possible?

Thanks

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221222/dee1c10b/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Dec 22 05:53:02 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 22 Dec 2022 14:53:02 +0100
Subject: [gdal-dev] ogr gml Box handling
In-Reply-To: <AM6PR01MB4946C63FDE0379FDA9E01B48A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
References: <AM6PR01MB49464C53D8AA26F594249486A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
 <AM0PR09MB3219FEE133A5F1AB29801CEDFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <AM6PR01MB4946C63FDE0379FDA9E01B48A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
Message-ID: <8ab606d5-756c-4941-8314-b729eeb3cc04@spatialys.com>

Andrew,

the GMLAS driver will fetch it as a string:

$ ogrinfo GMLAS:input.gml -oo remove_unused_layers=yes -al -q
Warning 1: Unhandled type: gMonthDay
Warning 1: Unhandled type: gMonthDay

Layer name: departedfeature
OGRFeature(departedfeature):1
 ? ogr_pkid (String) = FDD58DEB0E04A917AB5BAEA4DFA65C70_DepartedFeature_1
 ? fid (String) = osgb1000000849991256
 ? osgb_boundedby_box_srsname (String) = osgb:BNG
 ? osgb_boundedby_box_coordinates_decimal (String) = .
 ? osgb_boundedby_box_coordinates_cs (String) = ,
 ? osgb_boundedby_box_coordinates_ts (String) =
 ? osgb_boundedby_box_coordinates (String) = 254337.630,617076.680 
254337.630,617076.680
 ? theme (StringList) = (1:Roads Tracks And Paths)
 ? reasonfordeparture (String) = Deleted
 ? deletiondate (Date) = 2022/09/26

Even


Le 22/12/2022 ? 14:48, Andrew Terry a ?crit?:
>
> Hi Jukka,
>
> Thanks for responding and apologies for not including enough context.
>
> I?m converting GML into a SQL file form during testing using a command 
> like:
>
> ogr2ogr --config GML_GFS_TEMPLATE test.gfs --config PG_USE_COPY YES 
> -skipfailures -lco spatial_index=NONE -lco create_table=off -lco 
> schema=test -lco create_schema=off -f PGDump output.sql input.gml
>
> An example GML with one feature would be:
>
> <?xml version='1.0' encoding='UTF-8' standalone='yes'?>
>
> <osgb:FeatureCollection 
> xmlns:osgb='http://www.ordnancesurvey.co.uk/xml/namespaces/osgb' 
> xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' 
> xmlns:xs='http://www.w3.org/2001/XMLSchema' 
> xmlns:gml='http://www.opengis.net/gml' 
> xmlns:xlink='http://www.w3.org/1999/xlink' 
> xsi:schemaLocation='http://www.ordnancesurvey.co.uk/xml/namespaces/osgb 
> http://www.ordnancesurvey.co.uk/xml/schema/v9/OSDNFFeatures.xsd' 
> fid='LOCAL_ID_0'>
>
> <gml:description>Ordnance Survey, (c) Crown Copyright. All rights 
> reserved, 2022-10-27</gml:description>
>
> <gml:boundedBy>
>
> <gml:null>unknown</gml:null>
>
> </gml:boundedBy>
>
> <osgb:queryTime>2022-10-27T00:10:00</osgb:queryTime>
>
> <osgb:queryChangeSinceDate>2022-09-15</osgb:queryChangeSinceDate>
>
> <osgb:departedMember>
>
> <osgb:DepartedFeature fid='osgb1000000849991256'>
>
> <osgb:boundedBy>
>
> <gml:Box srsName='osgb:BNG'>
>
> <gml:coordinates>254337.630,617076.680 
> 254337.630,617076.680</gml:coordinates>
>
> </gml:Box>
>
> </osgb:boundedBy>
>
> <osgb:theme>Roads Tracks And Paths</osgb:theme>
>
> <osgb:reasonForDeparture>Deleted</osgb:reasonForDeparture>
>
> <osgb:deletionDate>2022-09-26</osgb:deletionDate>
>
> </osgb:DepartedFeature>
>
> </osgb:departedMember>
>
> </osgb:FeatureCollection>
>
> It defines an item?s unique fid and some basic attributes along with 
> the ?Box? as a bounding box / envelope indication of its location.
>
> Ultimately, the purpose is to form an indication of a feature to be 
> deleted ? in this case a point but not always.
>
> ogr2ogr will load the data but doesn?t understand the geometry type ? 
> and I note a bounding box doesn?t seem to be mentioned under types in 
> the documentation
>
> A positive result would be any way to retain the content of 
> gml:coordinates as a geometry or even as text which I could then 
> handle within postgres as something I could turn into a geometry. My 
> assumption has been that I would need to modify the gfs created by 
> org2ogr to try and explicitly pull this element out
>
> Thanks
>
> Andy
>
> *From:*Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Sent:* 22 December 2022 13:20
> *To:* Andrew Terry <andrew.terry at centremaps.co.uk>; 
> gdal-dev at lists.osgeo.org
> *Subject:* Re: ogr gml Box handling
>
> Hi,
>
> Sorry but I do not understand at all what you want to do. Would you, 
> if you read your question?
>
> Do you have some GML data that has a bounding box for each feature and 
> you would like to convert the bbox into something? Would that be a 
> second geometry for the attribute if the target format supports 
> multiple geometries? Or an attribute that contains the bbox expressed 
> as WKT of GeoJSON? Please give complete GML test data sample and an 
> example about ?what would be the ideal result.
>
> In your example the bounding box seems to be a point so probably the 
> data contains also just one point but probably you want to deal with 
> more generic data.
>
> -Jukka Rahkonen-
>
> *L?hett?j?:*gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Andrew Terry
> *L?hetetty:* torstai 22. joulukuuta 2022 15.08
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] ogr gml Box handling
>
> Hi,
>
> Trying to pull in the bounding box / envelope ?Box? when loading gml 
> with ogr2ogr
>
> <osgb:boundedBy>
>
> <gml:Box srsName='osgb:BNG'>
>
> <gml:coordinates>257023.700,620210.000 
> 257023.700,620210.000</gml:coordinates>
>
> </gml:Box>
>
> </osgb:boundedBy>
>
> I?ve tried <GeometryElementPath>boundedBy</GeometryElementPath> in my 
> gfs file.
>
> I?ve also tried seeing if I can pull through as a string using:
>
> ??? <PropertyDefn>
>
> ????? <Name>bbox</Name>
>
> <ElementPath>boundedBy|Box|coordinates</ElementPath>
>
> ????? <Type>String</Type>
>
> ??? </PropertyDefn>
>
> Any tips ? if it?s even possible?
>
> Thanks
>
> Andy
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221222/06c32132/attachment.htm>

From andrew.terry at centremaps.co.uk  Thu Dec 22 05:56:49 2022
From: andrew.terry at centremaps.co.uk (Andrew Terry)
Date: Thu, 22 Dec 2022 13:56:49 +0000
Subject: [gdal-dev] ogr gml Box handling
In-Reply-To: <8ab606d5-756c-4941-8314-b729eeb3cc04@spatialys.com>
References: <AM6PR01MB49464C53D8AA26F594249486A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
 <AM0PR09MB3219FEE133A5F1AB29801CEDFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <AM6PR01MB4946C63FDE0379FDA9E01B48A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
 <8ab606d5-756c-4941-8314-b729eeb3cc04@spatialys.com>
Message-ID: <AM6PR01MB49463394B93FCA61136F4521A1E89@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>

Thanks Even,

I?ll try that out

Andy



Andrew,

the GMLAS driver will fetch it as a string:

$ ogrinfo GMLAS:input.gml -oo remove_unused_layers=yes -al -q
Warning 1: Unhandled type: gMonthDay
Warning 1: Unhandled type: gMonthDay

Layer name: departedfeature
OGRFeature(departedfeature):1
  ogr_pkid (String) = FDD58DEB0E04A917AB5BAEA4DFA65C70_DepartedFeature_1
  fid (String) = osgb1000000849991256
  osgb_boundedby_box_srsname (String) = osgb:BNG
  osgb_boundedby_box_coordinates_decimal (String) = .
  osgb_boundedby_box_coordinates_cs (String) = ,
  osgb_boundedby_box_coordinates_ts (String) =
  osgb_boundedby_box_coordinates (String) = 254337.630,617076.680 254337.630,617076.680
  theme (StringList) = (1:Roads Tracks And Paths)
  reasonfordeparture (String) = Deleted
  deletiondate (Date) = 2022/09/26

Even


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221222/ea37c3f1/attachment-0001.htm>

From smcclatchie at fishocean.info  Thu Dec 22 12:53:32 2022
From: smcclatchie at fishocean.info (Sam McClatchie)
Date: Fri, 23 Dec 2022 09:53:32 +1300
Subject: [gdal-dev] problem with wrong corner coordinates in a projected
 raster
Message-ID: <93c05dc2-8a08-e4f1-54b6-8d2267cf5821@fishocean.info>

Colleagues

I want to georeference and project a raster image. I have an incorrect 
result where the image is improperly projected, and I am unsure why.

The original image is "SST_plot_New_Zealand_Whangarei_clahe.tif" 
<http://u.pc.cd/fy8>. (Note: I used links to my cloud server directory 
to avoid sending attachments to the list).? I created this image with 
known bounding box limits:

/snip

# elif region == "New_Zealand_Whangarei":
 ??? #???? lat_min = (-36.0)? # needs to exactly match the ERDDAP 
lat/lon ranges
 ??? #???? lat_max = (-35.0)
 ??? #???? lon_min = (172.5)
 ??? #???? lon_max = (175.0)

/end snip

I used these commands in the command line:

gdal_translate -of GTiff -outsize 1400 0 -a_srs EPSG:3857 -a_ullr 172.5 
-35.0 175.0 -36.0 ./SST_plot_New_Zealand_Whangarei_clahe.tif 
./test_trans.tif

gdalwarp ./test_trans.tif ./test_proj.tif

The result from gdal translate is test_trans.tif 
<http://u.pc.cd/D4EctalK>. The result from gdal warp is test_proj.tif 
<http://u.pc.cd/a2actalK>. The problem, as you will see in the 
./test_proj.tif file, is that the corner coordinates are not projected, 
which means the file is not properly projected. I'm obviously making a 
mistake.Would someone mind helping me to correct my error, please?

Best fishes

Sam

---

email signature Sam McClatchie (fisheries oceanographer)
& Elena Turin (accounting & auditing)
FishOcean Enterprises Ltd 
<https://www.nzbn.govt.nz/mynzbn/nzbndetails/9429049352344/?sw=>
www.fishocean.info <http://www.fishocean.info>
38 Upland Rd, Huia, Auckland 0604, New Zealand
cell: 027 752 8495

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221223/c7844c49/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Dec 22 14:09:29 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 22 Dec 2022 22:09:29 +0000
Subject: [gdal-dev] problem with wrong corner coordinates in a projected
 raster
In-Reply-To: <93c05dc2-8a08-e4f1-54b6-8d2267cf5821@fishocean.info>
References: <93c05dc2-8a08-e4f1-54b6-8d2267cf5821@fishocean.info>
Message-ID: <AM0PR09MB32196E9FF50A3104A78B652FFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

The coordinate system and coordinate values must match. Now they don't.
gdal_translate -of GTiff -outsize 1400 0 -a_srs EPSG:3857 -a_ullr 172.5 -35.0 175.0 -36.0

If the source image is in EPSG:4326 this should work:
gdal_translate -of GTiff -outsize 1400 0 -a_srs EPSG:4326 -a_ullr 172.5 -35.0 175.0 -36.0 in.tif out_temp.tif

and then
gdalwarp -t_srs EPSG:3857 out_temp.tif out_final.tif.

-Jukka Rahkonen-

Using -a_srs EPSG:4326 makes more sense but I am not sure if the source image is using that CRS                                                                                                                                      .

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Sam McClatchie
L?hetetty: torstai 22. joulukuuta 2022 22.54
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] problem with wrong corner coordinates in a projected raster


Colleagues

I want to georeference and project a raster image. I have an incorrect result where the image is improperly projected, and I am unsure why.

The original image is "SST_plot_New_Zealand_Whangarei_clahe.tif" <http://u.pc.cd/fy8><https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fu.pc.cd%2Ffy8&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca852b8ccc2b74558135308dae463a020%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C638073413802579283%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=EVX0k4kjH%2BPud5Ufh4Y4qkz%2BX089vO5jinTUdkja46w%3D&reserved=0>. (Note: I used links to my cloud server directory to avoid sending attachments to the list).  I created this image with known bounding box limits:

/snip

# elif region == "New_Zealand_Whangarei":
    #     lat_min = (-36.0)  # needs to exactly match the ERDDAP lat/lon ranges
    #     lat_max = (-35.0)
    #     lon_min = (172.5)
    #     lon_max = (175.0)

/end snip

I used these commands in the command line:

gdal_translate -of GTiff -outsize 1400 0 -a_srs EPSG:3857 -a_ullr 172.5 -35.0 175.0 -36.0 ./SST_plot_New_Zealand_Whangarei_clahe.tif ./test_trans.tif

gdalwarp ./test_trans.tif ./test_proj.tif

The result from gdal translate is test_trans.tif <http://u.pc.cd/D4EctalK><https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fu.pc.cd%2FD4EctalK&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca852b8ccc2b74558135308dae463a020%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C638073413802579283%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=wEh2%2B5v%2Fw%2BqlCefeLt7wCmgO6PiuO4Lnw8yjoY1NckI%3D&reserved=0>. The result from gdal warp is test_proj.tif <http://u.pc.cd/a2actalK><https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fu.pc.cd%2Fa2actalK&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca852b8ccc2b74558135308dae463a020%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C638073413802579283%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=CIPJfCE5bCY4vL6bTO3R2LAwr7IV3y1OqXfAnsVMKe0%3D&reserved=0>. The problem, as you will see in the ./test_proj.tif file, is that the corner coordinates are not projected, which means the file is not properly projected. I'm obviously making a mistake.Would someone mind helping me to correct my error, please?

Best fishes

Sam

---
Sam McClatchie (fisheries oceanographer)
& Elena Turin (accounting & auditing)
FishOcean Enterprises Ltd<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.nzbn.govt.nz%2Fmynzbn%2Fnzbndetails%2F9429049352344%2F%3Fsw%3D&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca852b8ccc2b74558135308dae463a020%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C638073413802579283%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=4EKPVYwDwvW2pqXWfH0uekwAxot%2F29pQiXdwlnJdFro%3D&reserved=0>
www.fishocean.info<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fishocean.info%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca852b8ccc2b74558135308dae463a020%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C638073413802579283%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=asijzvLfewigcCgclEpj3%2Bw1iZJg0b526UeU2hAtOy4%3D&reserved=0>
38 Upland Rd, Huia, Auckland 0604, New Zealand
cell: 027 752 8495


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221222/5c8c6001/attachment-0001.htm>

From smcclatchie at fishocean.info  Thu Dec 22 22:28:16 2022
From: smcclatchie at fishocean.info (Sam McClatchie)
Date: Fri, 23 Dec 2022 19:28:16 +1300
Subject: [gdal-dev] solved/ problem with wrong corner coordinates in a
 projected raster
In-Reply-To: <AM0PR09MB32196E9FF50A3104A78B652FFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <93c05dc2-8a08-e4f1-54b6-8d2267cf5821@fishocean.info>
 <AM0PR09MB32196E9FF50A3104A78B652FFDE89@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <07904b13-a01c-9dff-655b-80089d740df2@fishocean.info>

Hello Jukka

Thank you for that explanation and solution. It makes perfect sense, was 
easy to correct in my code, and fixed the problem.

Greatly appreciated,

Sam

email signature Sam McClatchie (fisheries oceanographer)
& Elena Turin (accounting & auditing)
FishOcean Enterprises Ltd 
<https://www.nzbn.govt.nz/mynzbn/nzbndetails/9429049352344/?sw=>
www.fishocean.info <http://www.fishocean.info>
38 Upland Rd, Huia, Auckland 0604, New Zealand
cell: 027 752 8495
[Zethalia]

The three great elemental sounds in nature are the sound of rain,
the sound of wind in a primeval wood, and the sound of outer ocean on a 
beach.
I have heard them all, and of the three elemental voices,
that of ocean is the most awesome, beautiful and varied.

Henry Beston, The Outermost House: A Year of Life on the Great Beach of 
Cape Cod

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221223/b6d4b91a/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SamMcClatchie2.jpg
Type: image/jpeg
Size: 31857 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221223/b6d4b91a/attachment-0001.jpg>

From jonas.ardo at nateko.lu.se  Sun Dec 25 05:23:10 2022
From: jonas.ardo at nateko.lu.se (=?UTF-8?Q?Jonas_Ard=c3=b6?=)
Date: Sun, 25 Dec 2022 14:23:10 +0100
Subject: [gdal-dev] Error using gdalinfo v 3.5.0 for jp2 (Sentinel-2) data
 on LINUX
Message-ID: <4be22f9f-fd05-45db-6104-206be0da1982@nateko.lu.se>

Hi

Is not? gdal v 3.5.0 supposed to read SENTINEL-2 data (jp2)? ok?
""Driver built-in by default according to 
https://gdal.org/drivers/raster/sentinel2.html#raster-sentinel2

Using CYGWIN:
$ gdalinfo.exe --version
GDAL 3.5.1, released 2022/06/30

gdalinfo.exe T28PDC_20181216T112451_AOT_10m.jp2
Driver: JP2OpenJPEG/JPEG-2000 driver based on OpenJPEG library
Files: T28PDC_20181216T112451_AOT_10m.jp2
 ?????? T28PDC_20181216T112451_AOT_10m.jp2.aux.xml
Size is 10980, 10980
Coordinate System is:
PROJCRS["WGS 84 / UTM zone 28N",
 ??? BASEGEOGCRS["WGS 84",
...


On? LINUX/CENTOS 7:
[jonasardo at aurora-nateko R10m]$ gdalinfo --version
GDAL 3.5.0, released 2022/05/10

gdalinfo T28PDC_20181216T112451_B02_10m.jp2
ERROR 4: `T28PDC_20181216T112451_B02_10m.jp2' not recognized as a 
supported file format.
gdalinfo failed - unable to open 'T28PDC_20181216T112451_B02_10m.jp2'.

Can it be some other type of error?

Regards
/Jonas Ard?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20221225/f5093c5d/attachment.htm>

From even.rouault at spatialys.com  Sun Dec 25 05:49:12 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 25 Dec 2022 14:49:12 +0100
Subject: [gdal-dev] Error using gdalinfo v 3.5.0 for jp2 (Sentinel-2)
 data on LINUX
In-Reply-To: <4be22f9f-fd05-45db-6104-206be0da1982@nateko.lu.se>
References: <4be22f9f-fd05-45db-6104-206be0da1982@nateko.lu.se>
Message-ID: <9d00e6fe-c1de-fa08-4a79-2ce7844f43b0@spatialys.com>

Hi,
>
> Is not? gdal v 3.5.0 supposed to read SENTINEL-2 data (jp2)? ok?
> ""Driver built-in by default according to 
> https://gdal.org/drivers/raster/sentinel2.html#raster-sentinel2

The Sentinel2 driver is indeed built-in, but it requires one of the 
JPEG2000 capable drivers to be also available at runtime

You can use for example one of the Docker images at 
https://github.com/OSGeo/gdal/tree/master/docker#images-of-releases to 
convert a Sentinel2 dataset to something more convenient

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew at aitchison.me.uk  Sat Dec 31 03:39:57 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sat, 31 Dec 2022 11:39:57 +0000 (GMT)
Subject: [gdal-dev] VSIFGetc and VSIFReadL
Message-ID: <db240d3e-ade7-8645-7353-60fa4c3a4cc2@aitchison.me.uk>


My plugin driver uses both VSIFGetc and VSIFReadL/VSIFWriteL
on the same stream*.

Since https://github.com/OSGeo/gdal/pull/6883 made VSILFILE* and
FILE* different, I cannot figure out which I am supposed to use.
Possibly we need a VSIFGetcL to match VSIFReadL/VSIFWriteL
just as we have the non-large-file versions VSIFGetc/VSIFRead/VSIFWrite.

Though it may be easier just to change my code to use VSIFReadL
throughout instead of VSIFGetc ...

Thanks,

---------
* "man fgetc" on Ubuntu says:
     Calls to the functions described here can be mixed with each
     other and with calls to other input functions from the stdio library
     for the same input stream.
and the stdio library includes fread/fwrite, so I think it is OK to use both.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Sat Dec 31 03:54:14 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 31 Dec 2022 12:54:14 +0100
Subject: [gdal-dev] VSIFGetc and VSIFReadL
In-Reply-To: <db240d3e-ade7-8645-7353-60fa4c3a4cc2@aitchison.me.uk>
References: <db240d3e-ade7-8645-7353-60fa4c3a4cc2@aitchison.me.uk>
Message-ID: <30176b9f-8298-3928-9486-05020f497b0a@spatialys.com>

Andrew,

Le 31/12/2022 ? 12:39, Andrew C Aitchison a ?crit?:
>
> My plugin driver uses both VSIFGetc and VSIFReadL/VSIFWriteL
> on the same stream*.
Aouch ! Surprising you didn't get crashes ! A VSILFILE* is a very 
different object from a FILE*, and invoking VSIFGetc() on a VSILFILE* 
cannot work.
>
> Since https://github.com/OSGeo/gdal/pull/6883 made VSILFILE* and
> FILE* different, I cannot figure out which I am supposed to use.
> Possibly we need a VSIFGetcL to match VSIFReadL/VSIFWriteL
> just as we have the non-large-file versions VSIFGetc/VSIFRead/VSIFWrite.
>
> Though it may be easier just to change my code to use VSIFReadL
> throughout instead of VSIFGetc ...
Yes using VSIFReadL(&ch, 1, 1, fp) should do the job. You could also 
indeed add a VSIFGetcL() if that makes things easier.
>
> Thanks,
>
> ---------
> * "man fgetc" on Ubuntu says:
> ??? Calls to the functions described here can be mixed with each
> ??? other and with calls to other input functions from the stdio library
> ??? for the same input stream.
> and the stdio library includes fread/fwrite, so I think it is OK to 
> use both.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


