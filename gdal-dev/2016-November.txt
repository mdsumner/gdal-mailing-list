From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov  1 05:46:28 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 1 Nov 2016 12:46:28 +0000
Subject: [gdal-dev] Should GDAL handle this KML superoverlay?
Message-ID: <7e301bb7b9694bd5ab3fe3a9f7d21acb@C119S212VM022.msvyvi.vaha.local>

Hi,

I have some images which are georeferenced with a KML file and they show fine with Google Earth. However, GDAL does not know what to do with them.
I put some test data here:

http://latuviitta.org/downloads/shaded.kmz
http://latuviitta.org/downloads/shaded.kml
http://latuviitta.org/downloads/shaded.png

Test with gdalinfo (GDAL 2.2-dev, has KMLSUPEROVERLAY driver)

gdalinfo shaded.kmz
ERROR 4: `shaded.kmz' not recognized as a supported file format.
gdalinfo failed - unable to open 'shaded.kmz'.

By looking at the only documentation I found from KMLSUPEROVERLAY (i.e. running "gdalinfo --format kmlsuperoverlay") it looks like KMLSUPEROVERVIEW likes to write tiles instead of referring one whole png file as in the dataset that I have.  This mail thread may be related http://osgeo-org.1560.x6.nabble.com/kmz-KMLSUPEROVERLAY-back-to-a-georeferenced-raster-td5286480.html.


-Jukka Rahkonen-


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161101/6674ddcc/attachment.html>

From even.rouault at spatialys.com  Tue Nov  1 06:09:44 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 1 Nov 2016 14:09:44 +0100
Subject: [gdal-dev] Should GDAL handle this KML superoverlay?
In-Reply-To: <7e301bb7b9694bd5ab3fe3a9f7d21acb@C119S212VM022.msvyvi.vaha.local>
References: <7e301bb7b9694bd5ab3fe3a9f7d21acb@C119S212VM022.msvyvi.vaha.local>
Message-ID: <201611011409.45040.even.rouault@spatialys.com>

Le mardi 01 novembre 2016 13:46:28, Rahkonen Jukka (MML) a écrit :
> Hi,
> 
> I have some images which are georeferenced with a KML file and they show
> fine with Google Earth. However, GDAL does not know what to do with them.
> I put some test data here:
> 
> http://latuviitta.org/downloads/shaded.kmz
> http://latuviitta.org/downloads/shaded.kml
> http://latuviitta.org/downloads/shaded.png
> 
> Test with gdalinfo (GDAL 2.2-dev, has KMLSUPEROVERLAY driver)
> 
> gdalinfo shaded.kmz
> ERROR 4: `shaded.kmz' not recognized as a supported file format.
> gdalinfo failed - unable to open 'shaded.kmz'.
> 
> By looking at the only documentation I found from KMLSUPEROVERLAY (i.e.
> running "gdalinfo --format kmlsuperoverlay") it looks like
> KMLSUPEROVERVIEW likes to write tiles instead of referring one whole png
> file as in the dataset that I have.  This mail thread may be related
> http://osgeo-org.1560.x6.nabble.com/kmz-KMLSUPEROVERLAY-back-to-a-georefer
> enced-raster-td5286480.html.

Jukka,

The driver could certainly be improved to handle this case, as it is rather 
simple compared to what it can already support (there are many potential 
variations of superoverlay or overlays, which make it hard to support them in 
a generic way). You can file an enhancement ticket.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Tue Nov  1 08:32:04 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 1 Nov 2016 16:32:04 +0100
Subject: [gdal-dev] GDAL python bindings build error (gcc command
	replaced by bash)
In-Reply-To: <57765162.6010901@uni-bonn.de>
References: <CANXASxMd0RyvruK3oqs9s3G-85cdkYZPBPapApuywa51khyQnw@mail.gmail.com>
 <57765162.6010901@uni-bonn.de>
Message-ID: <201611011632.04876.even.rouault@spatialys.com>

Le vendredi 01 juillet 2016 13:17:54, Kai Muehlbauer a écrit :
> Hi James,
> 
> I did experience the same issue. See
> 
> https://lists.osgeo.org/pipermail/gdal-dev/2016-July/044678.html
> 
> Although I did not find the root cause of this, I found that in my use
> case, copying and unsetting CC and CXX environment variables did the trick.
> 
> So what I did is:
> 
> export CF_CC=$CC
> export CF_CXX=$CXX
> unset CC CXX
> ./configure CC=$CF_CC \
>              CXX=$CF_CXX \
>              --prefix=$PREFIX
> make
> 
> Hoping for more insight by gdal-devs.

I've just hit that issue too and pushed 
https://trac.osgeo.org/gdal/changeset/36067 to fix/workaround it.
By instrumenting Python distutils code, I concluded that this is a bad 
interaction between the CXX variable of the GDALmake.opt and Python distutils 
when CXX is made of several "words" (that occurs only when CXX is defined in 
the environment too, whatever its value ! Which is probably a standard GNU 
make behaviour)

James, if you still have a tree with the configuration that hit the issue, 
could you have a look at the value of the CXX variable in GDALmake.opt ? From 
the error message, it would seem that there is /bin/bash in it, which is a bit 
surprising.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed Nov  2 03:00:45 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 2 Nov 2016 11:00:45 +0100
Subject: [gdal-dev] GDAL python bindings build error (gcc command
	replaced by bash)
In-Reply-To: <57de0308-b2b7-86ab-72cb-96dbcd546503@uni-bonn.de>
References: <CANXASxMd0RyvruK3oqs9s3G-85cdkYZPBPapApuywa51khyQnw@mail.gmail.com>
 <201611011632.04876.even.rouault@spatialys.com>
 <57de0308-b2b7-86ab-72cb-96dbcd546503@uni-bonn.de>
Message-ID: <201611021100.45915.even.rouault@spatialys.com>

Le mercredi 02 novembre 2016 10:48:32, Kai Muehlbauer a écrit :
> Hi Even,
> 
> Am 01.11.2016 um 16:32 schrieb Even Rouault:
> > Le vendredi 01 juillet 2016 13:17:54, Kai Muehlbauer a écrit :
> >> Hi James,
> >> 
> >> I did experience the same issue. See
> >> 
> >> https://lists.osgeo.org/pipermail/gdal-dev/2016-July/044678.html
> >> 
> >> Although I did not find the root cause of this, I found that in my use
> >> case, copying and unsetting CC and CXX environment variables did the
> >> trick.
> >> 
> >> So what I did is:
> >> 
> >> export CF_CC=$CC
> >> export CF_CXX=$CXX
> >> unset CC CXX
> >> ./configure CC=$CF_CC \
> >> 
> >>              CXX=$CF_CXX \
> >>              --prefix=$PREFIX
> >> 
> >> make
> >> 
> >> Hoping for more insight by gdal-devs.
> > 
> > I've just hit that issue too and pushed
> > https://trac.osgeo.org/gdal/changeset/36067 to fix/workaround it.
> > By instrumenting Python distutils code, I concluded that this is a bad
> > interaction between the CXX variable of the GDALmake.opt and Python
> > distutils when CXX is made of several "words" (that occurs only when CXX
> > is defined in the environment too, whatever its value ! Which is
> > probably a standard GNU make behaviour)
> > 
> > James, if you still have a tree with the configuration that hit the
> > issue, could you have a look at the value of the CXX variable in
> > GDALmake.opt ? From the error message, it would seem that there is
> > /bin/bash in it, which is a bit surprising.
> > 
> > Even
> 
> I took the chance to run the two builds I mentioned in my above linked
> list-email once again.
> 
> GDALmake.opt is identical in both working and breaking version.

Yes that depends if CXX is defined or not as environmenet variable.

> 
> Excerpt:
> 
> SHELL    =   /bin/sh
> LIBTOOL	=	$(SHELL) $(top_builddir)/libtool
> LIBTOOL_COMPILE_CC =	$(LIBTOOL) --mode=compile --tag=CC
> LIBTOOL_COMPILE_CXX =	$(LIBTOOL) --mode=compile --tag=CXX
> CC	=	$(LIBTOOL_COMPILE_CC) gcc
> CXX	=	$(LIBTOOL_COMPILE_CXX) g++
> 
> The only difference (for working and breaking) after running
> 
> $ ./configure --prefix=/usr/local --with-python
> 
> is within config.log and config.status.

ok, this is a libtool build, so CXX will expand to "/bin/sh libtool  --
mode=compile --tag=CXX g++".

> 
> 
> Cheers,
> Kai

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From kai.muehlbauer at uni-bonn.de  Wed Nov  2 02:48:32 2016
From: kai.muehlbauer at uni-bonn.de (Kai Muehlbauer)
Date: Wed, 2 Nov 2016 10:48:32 +0100
Subject: [gdal-dev] GDAL python bindings build error (gcc command
 replaced by bash)
In-Reply-To: <201611011632.04876.even.rouault@spatialys.com>
References: <CANXASxMd0RyvruK3oqs9s3G-85cdkYZPBPapApuywa51khyQnw@mail.gmail.com>
 <57765162.6010901@uni-bonn.de>
 <201611011632.04876.even.rouault@spatialys.com>
Message-ID: <57de0308-b2b7-86ab-72cb-96dbcd546503@uni-bonn.de>

Hi Even,

Am 01.11.2016 um 16:32 schrieb Even Rouault:
> Le vendredi 01 juillet 2016 13:17:54, Kai Muehlbauer a écrit :
>> Hi James,
>>
>> I did experience the same issue. See
>>
>> https://lists.osgeo.org/pipermail/gdal-dev/2016-July/044678.html
>>
>> Although I did not find the root cause of this, I found that in my use
>> case, copying and unsetting CC and CXX environment variables did the trick.
>>
>> So what I did is:
>>
>> export CF_CC=$CC
>> export CF_CXX=$CXX
>> unset CC CXX
>> ./configure CC=$CF_CC \
>>              CXX=$CF_CXX \
>>              --prefix=$PREFIX
>> make
>>
>> Hoping for more insight by gdal-devs.
> 
> I've just hit that issue too and pushed 
> https://trac.osgeo.org/gdal/changeset/36067 to fix/workaround it.
> By instrumenting Python distutils code, I concluded that this is a bad 
> interaction between the CXX variable of the GDALmake.opt and Python distutils 
> when CXX is made of several "words" (that occurs only when CXX is defined in 
> the environment too, whatever its value ! Which is probably a standard GNU 
> make behaviour)
> 
> James, if you still have a tree with the configuration that hit the issue, 
> could you have a look at the value of the CXX variable in GDALmake.opt ? From 
> the error message, it would seem that there is /bin/bash in it, which is a bit 
> surprising.
> 
> Even
> 

I took the chance to run the two builds I mentioned in my above linked
list-email once again.

GDALmake.opt is identical in both working and breaking version.

Excerpt:

SHELL    =   /bin/sh
LIBTOOL	=	$(SHELL) $(top_builddir)/libtool
LIBTOOL_COMPILE_CC =	$(LIBTOOL) --mode=compile --tag=CC
LIBTOOL_COMPILE_CXX =	$(LIBTOOL) --mode=compile --tag=CXX
CC	=	$(LIBTOOL_COMPILE_CC) gcc
CXX	=	$(LIBTOOL_COMPILE_CXX) g++

The only difference (for working and breaking) after running

$ ./configure --prefix=/usr/local --with-python

is within config.log and config.status.


Cheers,
Kai

From kai.muehlbauer at uni-bonn.de  Wed Nov  2 04:19:23 2016
From: kai.muehlbauer at uni-bonn.de (Kai Muehlbauer)
Date: Wed, 2 Nov 2016 12:19:23 +0100
Subject: [gdal-dev] GDAL python bindings build error (gcc command
 replaced by bash)
In-Reply-To: <201611021100.45915.even.rouault@spatialys.com>
References: <CANXASxMd0RyvruK3oqs9s3G-85cdkYZPBPapApuywa51khyQnw@mail.gmail.com>
 <201611011632.04876.even.rouault@spatialys.com>
 <57de0308-b2b7-86ab-72cb-96dbcd546503@uni-bonn.de>
 <201611021100.45915.even.rouault@spatialys.com>
Message-ID: <6c37555a-22c0-5c8f-3794-cd4148df8384@uni-bonn.de>

Am 02.11.2016 um 11:00 schrieb Even Rouault:
> Le mercredi 02 novembre 2016 10:48:32, Kai Muehlbauer a écrit :
>> Hi Even,
>>
>> Am 01.11.2016 um 16:32 schrieb Even Rouault:
>>> Le vendredi 01 juillet 2016 13:17:54, Kai Muehlbauer a écrit :
>>>> Hi James,
>>>>
>>>> I did experience the same issue. See
>>>>
>>>> https://lists.osgeo.org/pipermail/gdal-dev/2016-July/044678.html
>>>>
>>>> Although I did not find the root cause of this, I found that in my use
>>>> case, copying and unsetting CC and CXX environment variables did the
>>>> trick.
>>>>
>>>> So what I did is:
>>>>
>>>> export CF_CC=$CC
>>>> export CF_CXX=$CXX
>>>> unset CC CXX
>>>> ./configure CC=$CF_CC \
>>>>
>>>>              CXX=$CF_CXX \
>>>>              --prefix=$PREFIX
>>>>
>>>> make
>>>>
>>>> Hoping for more insight by gdal-devs.
>>>
>>> I've just hit that issue too and pushed
>>> https://trac.osgeo.org/gdal/changeset/36067 to fix/workaround it.
>>> By instrumenting Python distutils code, I concluded that this is a bad
>>> interaction between the CXX variable of the GDALmake.opt and Python
>>> distutils when CXX is made of several "words" (that occurs only when CXX
>>> is defined in the environment too, whatever its value ! Which is
>>> probably a standard GNU make behaviour)
>>>
>>> James, if you still have a tree with the configuration that hit the
>>> issue, could you have a look at the value of the CXX variable in
>>> GDALmake.opt ? From the error message, it would seem that there is
>>> /bin/bash in it, which is a bit surprising.
>>>
>>> Even
>>
>> I took the chance to run the two builds I mentioned in my above linked
>> list-email once again.
>>
>> GDALmake.opt is identical in both working and breaking version.
> 
> Yes that depends if CXX is defined or not as environmenet variable.
> 
>>
>> Excerpt:
>>
>> SHELL    =   /bin/sh
>> LIBTOOL	=	$(SHELL) $(top_builddir)/libtool
>> LIBTOOL_COMPILE_CC =	$(LIBTOOL) --mode=compile --tag=CC
>> LIBTOOL_COMPILE_CXX =	$(LIBTOOL) --mode=compile --tag=CXX
>> CC	=	$(LIBTOOL_COMPILE_CC) gcc
>> CXX	=	$(LIBTOOL_COMPILE_CXX) g++
>>
>> The only difference (for working and breaking) after running
>>
>> $ ./configure --prefix=/usr/local --with-python
>>
>> is within config.log and config.status.
> 
> ok, this is a libtool build, so CXX will expand to "/bin/sh libtool  --
> mode=compile --tag=CXX g++".

Even,

I applied your workaround to setup.py, but some calls differ (eg.
-pthread is missing). I'll attach gdal-working.txt (no CC, CXX set in
env), gdal-breaking.txt (CC, CXX set in env) and gdal-workaround.txt
(CC, CXX set in env, with applied workaround) which contain the python
build logs.

Is the missing -pthread problematic?

- Kai
-------------- next part --------------
make[2]: Entering directory '/home/kai/conda/gdal-1-test/gdal-2.1.0/swig/python'
rm -f setup_vars.ini
echo 'GNM_ENABLED=no' >> setup_vars.ini
python setup.py build
running build
running build_py
creating build
creating build/lib.linux-x86_64-2.7
copying gdal.py -> build/lib.linux-x86_64-2.7
copying ogr.py -> build/lib.linux-x86_64-2.7
copying osr.py -> build/lib.linux-x86_64-2.7
copying gdalconst.py -> build/lib.linux-x86_64-2.7
copying gdalnumeric.py -> build/lib.linux-x86_64-2.7
creating build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalnumeric.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalconst.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/__init__.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gnm.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/osr.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal_array.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/ogr.py -> build/lib.linux-x86_64-2.7/osgeo
running build_ext
building 'osgeo._gdal' extension
creating build/temp.linux-x86_64-2.7
creating build/temp.linux-x86_64-2.7/extensions

gcc -pthread -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/local/kai/conda/gdal-1-test/gdal-2.1.0/include -c extensions/gdal_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o
In file included from /usr/include/python2.7/Python.h:133:0,
                 from extensions/gdal_wrap.cpp:155:
extensions/gdal_wrap.cpp: In function ‘PyObject* _wrap_MajorObject_SetMetadata__SWIG_0(PyObject*, PyObject*)’:
/usr/include/python2.7/abstract.h:1354:62: warning: deprecated conversion from string constant to ‘char*’ [-Wwrite-strings]
 #define PyMapping_Items(O) PyObject_CallMethod(O,"items",NULL)
                                                              ^
extensions/gdal_wrap.cpp:9115:31: note: in expansion of macro ‘PyMapping_Items’
         PyObject *item_list = PyMapping_Items( obj1 );
                               ^
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/local/kai/conda/gdal-1-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_gdal.so
building 'osgeo._gdalconst' extension
gcc -pthread -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/local/kai/conda/gdal-1-test/gdal-2.1.0/include -c extensions/gdalconst_wrap.c -o build/temp.linux-x86_64-2.7/extensions/gdalconst_wrap.o
gcc -pthread -shared build/temp.linux-x86_64-2.7/extensions/gdalconst_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/local/kai/conda/gdal-1-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_gdalconst.so
building 'osgeo._osr' extension
gcc -pthread -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/local/kai/conda/gdal-1-test/gdal-2.1.0/include -c extensions/osr_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/osr_wrap.o
extensions/osr_wrap.cpp:3224:14: warning: ‘char* GDALPythonObjectToCStr(PyObject*, int*)’ defined but not used [-Wunused-function]
 static char* GDALPythonObjectToCStr(PyObject* pyObject, int* pbToFree)
              ^
extensions/osr_wrap.cpp:3254:13: warning: ‘void GDALPythonFreeCStr(void*, int)’ defined but not used [-Wunused-function]
 static void GDALPythonFreeCStr(void* ptr, int bToFree)
             ^
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/osr_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/local/kai/conda/gdal-1-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_osr.so
building 'osgeo._ogr' extension
gcc -pthread -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/local/kai/conda/gdal-1-test/gdal-2.1.0/include -c extensions/ogr_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/ogr_wrap.o
In file included from /usr/include/python2.7/Python.h:133:0,
                 from extensions/ogr_wrap.cpp:155:
extensions/ogr_wrap.cpp: In function ‘PyObject* _wrap_MajorObject_SetMetadata__SWIG_0(PyObject*, PyObject*)’:
/usr/include/python2.7/abstract.h:1354:62: warning: deprecated conversion from string constant to ‘char*’ [-Wwrite-strings]
 #define PyMapping_Items(O) PyObject_CallMethod(O,"items",NULL)
                                                              ^
extensions/ogr_wrap.cpp:5567:31: note: in expansion of macro ‘PyMapping_Items’
         PyObject *item_list = PyMapping_Items( obj1 );
                               ^
extensions/ogr_wrap.cpp: In function ‘PyObject* _wrap_Feature_GetFieldAsIntegerList(PyObject*, PyObject*)’:
extensions/ogr_wrap.cpp:13843:48: warning: ‘pList3’ may be used uninitialized in this function [-Wmaybe-uninitialized]
       PyObject *val = PyInt_FromLong( (*arg4)[i] );
                                                ^
extensions/ogr_wrap.cpp:13798:8: note: ‘pList3’ was declared here
   int *pList3 ;
        ^
extensions/ogr_wrap.cpp: In function ‘PyObject* _wrap_Feature_GetFieldAsDoubleList(PyObject*, PyObject*)’:
extensions/ogr_wrap.cpp:14095:54: warning: ‘pList3’ may be used uninitialized in this function [-Wmaybe-uninitialized]
       PyObject *val = PyFloat_FromDouble( (*arg4)[i] );
                                                      ^
extensions/ogr_wrap.cpp:14050:11: note: ‘pList3’ was declared here
   double *pList3 ;
           ^
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/ogr_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/local/kai/conda/gdal-1-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_ogr.so
building 'osgeo._gdal_array' extension
gcc -pthread -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/local/kai/conda/gdal-1-test/gdal-2.1.0/include -c extensions/gdal_array_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_array_wrap.o
In file included from /usr/lib64/python2.7/site-packages/numpy/core/include/numpy/ndarraytypes.h:1777:0,
                 from /usr/lib64/python2.7/site-packages/numpy/core/include/numpy/ndarrayobject.h:18,
                 from /usr/lib64/python2.7/site-packages/numpy/core/include/numpy/arrayobject.h:4,
                 from extensions/gdal_array_wrap.cpp:3377:
/usr/lib64/python2.7/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:15:2: warning: #warning "Using deprecated NumPy API, disable it by " "#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-Wcpp]
 #warning "Using deprecated NumPy API, disable it by " \
  ^
extensions/gdal_array_wrap.cpp:3331:14: warning: ‘char* GDALPythonObjectToCStr(PyObject*, int*)’ defined but not used [-Wunused-function]
 static char* GDALPythonObjectToCStr(PyObject* pyObject, int* pbToFree)
              ^
extensions/gdal_array_wrap.cpp:3361:13: warning: ‘void GDALPythonFreeCStr(void*, int)’ defined but not used [-Wunused-function]
 static void GDALPythonFreeCStr(void* ptr, int bToFree)
             ^
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/gdal_array_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/local/kai/conda/gdal-1-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_gdal_array.so
make[2]: Leaving directory '/home/kai/conda/gdal-1-test/gdal-2.1.0/swig/python'
make[1]: Leaving directory '/home/kai/conda/gdal-1-test/gdal-2.1.0/swig'
rm -f gdal.pc
echo 'CONFIG_VERSION='`cat ./VERSION`'' >> gdal.pc
echo 'CONFIG_INST_PREFIX=/usr/local' >> gdal.pc
echo 'CONFIG_INST_LIBS=-L/usr/local/lib64 -lgdal' >> gdal.pc
echo 'CONFIG_INST_CFLAGS=-I/usr/local/include' >> gdal.pc
echo 'CONFIG_INST_DATA=/usr/local/share/gdal/data' >> gdal.pc
cat gdal.pc.in >> gdal.pc
-------------- next part --------------
make[2]: Entering directory '/home/kai/conda/gdal-2-test/gdal-2.1.0/swig/python'
rm -f setup_vars.ini
echo 'GNM_ENABLED=no' >> setup_vars.ini
python setup.py build
running build
running build_py
creating build
creating build/lib.linux-x86_64-2.7
copying gdal.py -> build/lib.linux-x86_64-2.7
copying ogr.py -> build/lib.linux-x86_64-2.7
copying osr.py -> build/lib.linux-x86_64-2.7
copying gdalconst.py -> build/lib.linux-x86_64-2.7
copying gdalnumeric.py -> build/lib.linux-x86_64-2.7
creating build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalnumeric.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalconst.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/__init__.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gnm.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/osr.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal_array.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/ogr.py -> build/lib.linux-x86_64-2.7/osgeo
running build_ext
building 'osgeo._gdal' extension
creating build/temp.linux-x86_64-2.7
creating build/temp.linux-x86_64-2.7/extensions

/bin/sh /home/kai/conda/gdal-2-test/gdal-2.1.0/libtool --mode=compile --tag=CC gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o

libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_wrap.cpp  -fPIC -DPIC -o build/temp.linux-x86_64-2.7/extensions/.libs/gdal_wrap.o

In file included from /usr/include/python2.7/Python.h:133:0,
                 from extensions/gdal_wrap.cpp:155:
extensions/gdal_wrap.cpp: In function 'PyObject* _wrap_MajorObject_SetMetadata__SWIG_0(PyObject*, PyObject*)':
/usr/include/python2.7/abstract.h:1354:62: warning: deprecated conversion from string constant to 'char*' [-Wwrite-strings]
 #define PyMapping_Items(O) PyObject_CallMethod(O,"items",NULL)
                                                              ^
extensions/gdal_wrap.cpp:9115:31: note: in expansion of macro 'PyMapping_Items'
         PyObject *item_list = PyMapping_Items( obj1 );
                               ^
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o >/dev/null 2>&1

/bin/sh -pthread -shared build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/home/kai/conda/gdal-2-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_gdal.so
/bin/sh: -d: Ungültige Option
error: command '/bin/sh' failed with exit status 1
GNUmakefile:74: recipe for target 'build' failed
make[2]: *** [build] Error 1
make[2]: Leaving directory '/home/kai/conda/gdal-2-test/gdal-2.1.0/swig/python'
GNUmakefile:30: recipe for target 'build' failed
make[1]: *** [build] Error 2
make[1]: Leaving directory '/home/kai/conda/gdal-2-test/gdal-2.1.0/swig'
GNUmakefile:104: recipe for target 'swig-modules' failed
make: *** [swig-modules] Error 2
-------------- next part --------------
make[2]: Entering directory '/home/kai/conda/gdal-2-test/gdal-2.1.0/swig/python'
rm -f setup_vars.ini
echo 'GNM_ENABLED=no' >> setup_vars.ini
python setup.py build
WARNING: "CXX=/bin/sh /home/kai/conda/gdal-2-test/gdal-2.1.0/libtool --mode=compile --tag=CXX g++" was defined in the environment and contains more than one word. Unsetting it since that is incompatible of distutils
running build
running build_py
creating build
creating build/lib.linux-x86_64-2.7
copying gdal.py -> build/lib.linux-x86_64-2.7
copying ogr.py -> build/lib.linux-x86_64-2.7
copying osr.py -> build/lib.linux-x86_64-2.7
copying gdalconst.py -> build/lib.linux-x86_64-2.7
copying gdalnumeric.py -> build/lib.linux-x86_64-2.7
creating build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalnumeric.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalconst.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/__init__.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gnm.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/osr.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal_array.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/ogr.py -> build/lib.linux-x86_64-2.7/osgeo
running build_ext
building 'osgeo._gdal' extension
creating build/temp.linux-x86_64-2.7
creating build/temp.linux-x86_64-2.7/extensions

/bin/sh /home/kai/conda/gdal-2-test/gdal-2.1.0/libtool --mode=compile --tag=CC gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_wrap.cpp  -fPIC -DPIC -o build/temp.linux-x86_64-2.7/extensions/.libs/gdal_wrap.o
In file included from /usr/include/python2.7/Python.h:133:0,
                 from extensions/gdal_wrap.cpp:155:
extensions/gdal_wrap.cpp: In function 'PyObject* _wrap_MajorObject_SetMetadata__SWIG_0(PyObject*, PyObject*)':
/usr/include/python2.7/abstract.h:1354:62: warning: deprecated conversion from string constant to 'char*' [-Wwrite-strings]
 #define PyMapping_Items(O) PyObject_CallMethod(O,"items",NULL)
                                                              ^
extensions/gdal_wrap.cpp:9115:31: note: in expansion of macro 'PyMapping_Items'
         PyObject *item_list = PyMapping_Items( obj1 );
                               ^
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o >/dev/null 2>&1
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/home/kai/conda/gdal-2-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_gdal.so
building 'osgeo._gdalconst' extension
/bin/sh /home/kai/conda/gdal-2-test/gdal-2.1.0/libtool --mode=compile --tag=CC gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdalconst_wrap.c -o build/temp.linux-x86_64-2.7/extensions/gdalconst_wrap.o
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdalconst_wrap.c  -fPIC -DPIC -o build/temp.linux-x86_64-2.7/extensions/.libs/gdalconst_wrap.o
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdalconst_wrap.c -o build/temp.linux-x86_64-2.7/extensions/gdalconst_wrap.o >/dev/null 2>&1
gcc -pthread -shared build/temp.linux-x86_64-2.7/extensions/gdalconst_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/home/kai/conda/gdal-2-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_gdalconst.so
building 'osgeo._osr' extension
/bin/sh /home/kai/conda/gdal-2-test/gdal-2.1.0/libtool --mode=compile --tag=CC gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/osr_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/osr_wrap.o
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/osr_wrap.cpp  -fPIC -DPIC -o build/temp.linux-x86_64-2.7/extensions/.libs/osr_wrap.o
extensions/osr_wrap.cpp:3224:14: warning: 'char* GDALPythonObjectToCStr(PyObject*, int*)' defined but not used [-Wunused-function]
 static char* GDALPythonObjectToCStr(PyObject* pyObject, int* pbToFree)
              ^
extensions/osr_wrap.cpp:3254:13: warning: 'void GDALPythonFreeCStr(void*, int)' defined but not used [-Wunused-function]
 static void GDALPythonFreeCStr(void* ptr, int bToFree)
             ^
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/osr_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/osr_wrap.o >/dev/null 2>&1
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/osr_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/home/kai/conda/gdal-2-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_osr.so
building 'osgeo._ogr' extension
/bin/sh /home/kai/conda/gdal-2-test/gdal-2.1.0/libtool --mode=compile --tag=CC gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/ogr_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/ogr_wrap.o
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/ogr_wrap.cpp  -fPIC -DPIC -o build/temp.linux-x86_64-2.7/extensions/.libs/ogr_wrap.o
In file included from /usr/include/python2.7/Python.h:133:0,
                 from extensions/ogr_wrap.cpp:155:
extensions/ogr_wrap.cpp: In function 'PyObject* _wrap_MajorObject_SetMetadata__SWIG_0(PyObject*, PyObject*)':
/usr/include/python2.7/abstract.h:1354:62: warning: deprecated conversion from string constant to 'char*' [-Wwrite-strings]
 #define PyMapping_Items(O) PyObject_CallMethod(O,"items",NULL)
                                                              ^
extensions/ogr_wrap.cpp:5567:31: note: in expansion of macro 'PyMapping_Items'
         PyObject *item_list = PyMapping_Items( obj1 );
                               ^
extensions/ogr_wrap.cpp: In function 'PyObject* _wrap_Feature_GetFieldAsIntegerList(PyObject*, PyObject*)':
extensions/ogr_wrap.cpp:13843:48: warning: 'pList3' may be used uninitialized in this function [-Wmaybe-uninitialized]
       PyObject *val = PyInt_FromLong( (*arg4)[i] );
                                                ^
extensions/ogr_wrap.cpp:13798:8: note: 'pList3' was declared here
   int *pList3 ;
        ^
extensions/ogr_wrap.cpp: In function 'PyObject* _wrap_Feature_GetFieldAsDoubleList(PyObject*, PyObject*)':
extensions/ogr_wrap.cpp:14095:54: warning: 'pList3' may be used uninitialized in this function [-Wmaybe-uninitialized]
       PyObject *val = PyFloat_FromDouble( (*arg4)[i] );
                                                      ^
extensions/ogr_wrap.cpp:14050:11: note: 'pList3' was declared here
   double *pList3 ;
           ^
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/ogr_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/ogr_wrap.o >/dev/null 2>&1
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/ogr_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/home/kai/conda/gdal-2-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_ogr.so
building 'osgeo._gdal_array' extension
/bin/sh /home/kai/conda/gdal-2-test/gdal-2.1.0/libtool --mode=compile --tag=CC gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_array_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_array_wrap.o
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_array_wrap.cpp  -fPIC -DPIC -o build/temp.linux-x86_64-2.7/extensions/.libs/gdal_array_wrap.o
In file included from /usr/lib64/python2.7/site-packages/numpy/core/include/numpy/ndarraytypes.h:1777:0,
                 from /usr/lib64/python2.7/site-packages/numpy/core/include/numpy/ndarrayobject.h:18,
                 from /usr/lib64/python2.7/site-packages/numpy/core/include/numpy/arrayobject.h:4,
                 from extensions/gdal_array_wrap.cpp:3377:
/usr/lib64/python2.7/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:15:2: warning: #warning "Using deprecated NumPy API, disable it by " "#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-Wcpp]
 #warning "Using deprecated NumPy API, disable it by " \
  ^
extensions/gdal_array_wrap.cpp:3331:14: warning: 'char* GDALPythonObjectToCStr(PyObject*, int*)' defined but not used [-Wunused-function]
 static char* GDALPythonObjectToCStr(PyObject* pyObject, int* pbToFree)
              ^
extensions/gdal_array_wrap.cpp:3361:13: warning: 'void GDALPythonFreeCStr(void*, int)' defined but not used [-Wunused-function]
 static void GDALPythonFreeCStr(void* ptr, int bToFree)
             ^
libtool: compile:  gcc -fno-strict-aliasing -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DNDEBUG -fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -DOPENSSL_LOAD_CONF -fPIC -I../../port -I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm -I../../apps -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/home/kai/conda/gdal-2-test/gdal-2.1.0/include -c extensions/gdal_array_wrap.cpp -o build/temp.linux-x86_64-2.7/extensions/gdal_array_wrap.o >/dev/null 2>&1
g++ -pthread -shared build/temp.linux-x86_64-2.7/extensions/gdal_array_wrap.o -L../../.libs -L../../ -L/usr/lib64 -L/home/kai/conda/gdal-2-test/gdal-2.1.0/lib -lpython2.7 -lgdal -o build/lib.linux-x86_64-2.7/osgeo/_gdal_array.so
make[2]: Leaving directory '/home/kai/conda/gdal-2-test/gdal-2.1.0/swig/python'
make[1]: Leaving directory '/home/kai/conda/gdal-2-test/gdal-2.1.0/swig'

From even.rouault at spatialys.com  Wed Nov  2 04:50:24 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 2 Nov 2016 12:50:24 +0100
Subject: [gdal-dev] GDAL python bindings build error (gcc command
	replaced by bash)
In-Reply-To: <6c37555a-22c0-5c8f-3794-cd4148df8384@uni-bonn.de>
References: <CANXASxMd0RyvruK3oqs9s3G-85cdkYZPBPapApuywa51khyQnw@mail.gmail.com>
 <201611021100.45915.even.rouault@spatialys.com>
 <6c37555a-22c0-5c8f-3794-cd4148df8384@uni-bonn.de>
Message-ID: <201611021250.24888.even.rouault@spatialys.com>

Le mercredi 02 novembre 2016 12:19:23, Kai Muehlbauer a écrit :
> Am 02.11.2016 um 11:00 schrieb Even Rouault:
> > Le mercredi 02 novembre 2016 10:48:32, Kai Muehlbauer a écrit :
> >> Hi Even,
> >> 
> >> Am 01.11.2016 um 16:32 schrieb Even Rouault:
> >>> Le vendredi 01 juillet 2016 13:17:54, Kai Muehlbauer a écrit :
> >>>> Hi James,
> >>>> 
> >>>> I did experience the same issue. See
> >>>> 
> >>>> https://lists.osgeo.org/pipermail/gdal-dev/2016-July/044678.html
> >>>> 
> >>>> Although I did not find the root cause of this, I found that in my use
> >>>> case, copying and unsetting CC and CXX environment variables did the
> >>>> trick.
> >>>> 
> >>>> So what I did is:
> >>>> 
> >>>> export CF_CC=$CC
> >>>> export CF_CXX=$CXX
> >>>> unset CC CXX
> >>>> ./configure CC=$CF_CC \
> >>>> 
> >>>>              CXX=$CF_CXX \
> >>>>              --prefix=$PREFIX
> >>>> 
> >>>> make
> >>>> 
> >>>> Hoping for more insight by gdal-devs.
> >>> 
> >>> I've just hit that issue too and pushed
> >>> https://trac.osgeo.org/gdal/changeset/36067 to fix/workaround it.
> >>> By instrumenting Python distutils code, I concluded that this is a bad
> >>> interaction between the CXX variable of the GDALmake.opt and Python
> >>> distutils when CXX is made of several "words" (that occurs only when
> >>> CXX is defined in the environment too, whatever its value ! Which is
> >>> probably a standard GNU make behaviour)
> >>> 
> >>> James, if you still have a tree with the configuration that hit the
> >>> issue, could you have a look at the value of the CXX variable in
> >>> GDALmake.opt ? From the error message, it would seem that there is
> >>> /bin/bash in it, which is a bit surprising.
> >>> 
> >>> Even
> >> 
> >> I took the chance to run the two builds I mentioned in my above linked
> >> list-email once again.
> >> 
> >> GDALmake.opt is identical in both working and breaking version.
> > 
> > Yes that depends if CXX is defined or not as environmenet variable.
> > 
> >> Excerpt:
> >> 
> >> SHELL    =   /bin/sh
> >> LIBTOOL	=	$(SHELL) $(top_builddir)/libtool
> >> LIBTOOL_COMPILE_CC =	$(LIBTOOL) --mode=compile --tag=CC
> >> LIBTOOL_COMPILE_CXX =	$(LIBTOOL) --mode=compile --tag=CXX
> >> CC	=	$(LIBTOOL_COMPILE_CC) gcc
> >> CXX	=	$(LIBTOOL_COMPILE_CXX) g++
> >> 
> >> The only difference (for working and breaking) after running
> >> 
> >> $ ./configure --prefix=/usr/local --with-python
> >> 
> >> is within config.log and config.status.
> > 
> > ok, this is a libtool build, so CXX will expand to "/bin/sh libtool  --
> > mode=compile --tag=CXX g++".
> 
> Even,
> 
> I applied your workaround to setup.py, but some calls differ (eg.
> -pthread is missing). I'll attach gdal-working.txt (no CC, CXX set in
> env), gdal-breaking.txt (CC, CXX set in env) and gdal-workaround.txt
> (CC, CXX set in env, with applied workaround) which contain the python
> build logs.
> 
> Is the missing -pthread problematic?

I don't think so. We could also apply the same logic for CC as the one I added 
for CXX if it proved to be needed.

> 
> - Kai

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed Nov  2 07:38:56 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 2 Nov 2016 15:38:56 +0100
Subject: [gdal-dev] Changes in Travis-CI setup + AppVeyor
Message-ID: <201611021538.56298.even.rouault@spatialys.com>

Hi,

I've refactored a bit the way the multiple test configurations are managed with 
Travis-CI. Previously there was a default single test environment (Precise 
64bit) in .travis.yml in trunk, and I had a cron job that merged trunk into 
custom git branches with different .travis.yml configurations for other test 
environments. 
One major drawback of this is that those alternate configurations were not 
tested for pull requests, or when developing a custom branch.
I've now changed that to use the possibility of doing matrices in .travis.yml. 
The various scripts are now in gdal/ci/travis/${BUILD_NAME}

I've also enabled ccache builds in most setups, which speed up builds.

One of the only advantage of having different git branches for different 
environments was to be able to have different badges. But I just found 
https://github.com/exogen/badge-matrix which offer a way of having badges per 
matrix item, so this is now used in 
https://github.com/OSGeo/gdal/blob/trunk/README.md

There are a few custom builds that are still managed the old way :
- the one that creates the test coverage. Could potentially be merged into the 
main one, but as we upload coverage results in the result repository only for 
changes, that's not useful for PR / feature branches. Plus there is an 
encrypted variable that should be re-encrypted for the OSGeo/gdal repository
- the one that runs the clang static analyzer checks. Its length is very close 
to the timeout limit of Travis-CI jobs, so it regularly fails, and given its 
length, it wouldn't be very valuable for quick feedback. Currently it runs at 
most 1 time per hour.

For AppVeyor, I've migrated the appveyor.yml for the vc12_full branch into 
trunk (which is the one with the most dependencies), so it is now available 
for pull requests. A matrix based approach could likely be done too to test 
different versions (current setup test x86 and x64 builds), but I didn't pursue 
that. So the vc9 and vc13 branches are still using the old merge-from-trunk 
approach.


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From bishop.dev at gmail.com  Wed Nov  2 12:01:45 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Wed, 2 Nov 2016 22:01:45 +0300
Subject: [gdal-dev] Changes in Travis-CI setup + AppVeyor
In-Reply-To: <201611021538.56298.even.rouault@spatialys.com>
References: <201611021538.56298.even.rouault@spatialys.com>
Message-ID: <832bef37-0831-8858-63d7-8602cde54e0f@gmail.com>

Hi Even,

Bravo! Well done!

Best regards,
     Dmitry

02.11.16 17:38, Even Rouault пишет:
> Hi,
>
> I've refactored a bit the way the multiple test configurations are managed with
> Travis-CI. Previously there was a default single test environment (Precise
> 64bit) in .travis.yml in trunk, and I had a cron job that merged trunk into
> custom git branches with different .travis.yml configurations for other test
> environments.
> One major drawback of this is that those alternate configurations were not
> tested for pull requests, or when developing a custom branch.
> I've now changed that to use the possibility of doing matrices in .travis.yml.
> The various scripts are now in gdal/ci/travis/${BUILD_NAME}
>
> I've also enabled ccache builds in most setups, which speed up builds.
>
> One of the only advantage of having different git branches for different
> environments was to be able to have different badges. But I just found
> https://github.com/exogen/badge-matrix which offer a way of having badges per
> matrix item, so this is now used in
> https://github.com/OSGeo/gdal/blob/trunk/README.md
>
> There are a few custom builds that are still managed the old way :
> - the one that creates the test coverage. Could potentially be merged into the
> main one, but as we upload coverage results in the result repository only for
> changes, that's not useful for PR / feature branches. Plus there is an
> encrypted variable that should be re-encrypted for the OSGeo/gdal repository
> - the one that runs the clang static analyzer checks. Its length is very close
> to the timeout limit of Travis-CI jobs, so it regularly fails, and given its
> length, it wouldn't be very valuable for quick feedback. Currently it runs at
> most 1 time per hour.
>
> For AppVeyor, I've migrated the appveyor.yml for the vc12_full branch into
> trunk (which is the one with the most dependencies), so it is now available
> for pull requests. A matrix based approach could likely be done too to test
> different versions (current setup test x86 and x64 builds), but I didn't pursue
> that. So the vc9 and vc13 branches are still using the old merge-from-trunk
> approach.
>
>
> Even
>


From rex200789 at gmail.com  Wed Nov  2 13:46:46 2016
From: rex200789 at gmail.com (Renison)
Date: Wed, 2 Nov 2016 13:46:46 -0700 (MST)
Subject: [gdal-dev] Simple circle in OGR
Message-ID: <1478119606967-5294053.post@n6.nabble.com>

Hello all, I am trying to create a simple circle geometry in OGR. My approach
so far has been something like this:

            SpatialReference defaultGeoSys = new SpatialReference("");
            defaultGeoSys.SetWellKnownGeogCS("EPSG:4326");

            //define a circle using point and buffer
            string pointlineString = "POINT (" + longitude + " " + latitude
+")";
            var circle = OGR.Ogr.CreateGeometryFromWkt(ref pointlineString,
defaultGeoSys);
            circle.Buffer(MilesToMeters(radiusInMiles), 2000);
            
But the circle.Buffer(params,params) does not seem to create a circle. All I
have is a point and a radius. Is there a way to achieve what I want?





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Simple-circle-in-OGR-tp5294053.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov  2 15:21:13 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 2 Nov 2016 15:21:13 -0700 (MST)
Subject: [gdal-dev] Simple circle in OGR
In-Reply-To: <1478119606967-5294053.post@n6.nabble.com>
References: <1478119606967-5294053.post@n6.nabble.com>
Message-ID: <1478125273398-5294064.post@n6.nabble.com>

Hi,

If you have defaultGeoSys.SetWellKnownGeogCS("EPSG:4326") then perhaps units
are supposed to be in degrees.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Simple-circle-in-OGR-tp5294053p5294064.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From mwtoews at gmail.com  Wed Nov  2 16:33:57 2016
From: mwtoews at gmail.com (Mike Toews)
Date: Thu, 3 Nov 2016 12:33:57 +1300
Subject: [gdal-dev] Simple circle in OGR
In-Reply-To: <1478119606967-5294053.post@n6.nabble.com>
References: <1478119606967-5294053.post@n6.nabble.com>
Message-ID: <CAM2FmMoEDA4Qyq1vvw=z-vAfsc2vLuDQmPLYBbYokkk2--=LnA@mail.gmail.com>

On 3 November 2016 at 09:46, Renison <rex200789 at gmail.com> wrote:
> Hello all, I am trying to create a simple circle geometry in OGR. My approach
> so far has been something like this:
>
>             SpatialReference defaultGeoSys = new SpatialReference("");
>             defaultGeoSys.SetWellKnownGeogCS("EPSG:4326");
>
>             //define a circle using point and buffer
>             string pointlineString = "POINT (" + longitude + " " + latitude
> +")";
>             var circle = OGR.Ogr.CreateGeometryFromWkt(ref pointlineString,
> defaultGeoSys);
>             circle.Buffer(MilesToMeters(radiusInMiles), 2000);
>
> But the circle.Buffer(params,params) does not seem to create a circle. All I
> have is a point and a radius. Is there a way to achieve what I want?

Buffer operates in Cartesian space, and uses the same units as the
SRS, therefore these are degrees.

One strategy for a simple Point is to create a Cartesian buffer from
(0, 0) and project it to EPSG:2193 from a custom azimuthal equidistant
projection centred at the point location, e.g. a PROJ.4 string
"+proj=aeqd +lat_0=" + latitude + " +lon_0=" + longitude + " +x_0=0
+y_0=0"

See http://gis.stackexchange.com/a/121539/1872 for this recipe in R.
You can make something similar with OSR.

Cheers,
-Mike

From even.rouault at spatialys.com  Thu Nov  3 06:57:11 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 3 Nov 2016 14:57:11 +0100
Subject: [gdal-dev] Motion: adopt RFC 65: IETF RFC7946 GeoJSON
In-Reply-To: <201610291502.43594.even.rouault@spatialys.com>
References: <201610291502.43594.even.rouault@spatialys.com>
Message-ID: <201611031457.11864.even.rouault@spatialys.com>

Le samedi 29 octobre 2016 15:02:43, Even Rouault a écrit :
> Hi,
> 
> I move to formally adopt RFC 65: IETF RFC7946 GeoJSON
> 
> https://trac.osgeo.org/gdal/wiki/rfc65_rfc7946_geojson
> 
> The implementation has been committed into trunk the past days.
> 
> -------
> 

I declare this motion passed with +1 from JukkaR, HowardB, DanielM and myself.

> 
> Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From johan.vandewauw at gmail.com  Thu Nov  3 07:08:29 2016
From: johan.vandewauw at gmail.com (Johan Van de Wauw)
Date: Thu, 3 Nov 2016 15:08:29 +0100
Subject: [gdal-dev] Fwd: arcsde ogr driver and GDAL 2+
In-Reply-To: <CAJOp35m1+ysmO+vA3bzm8Rb1-5-p4zguD5EkTyF1r9TvbnjCzQ@mail.gmail.com>
References: <CAJOp35m1+ysmO+vA3bzm8Rb1-5-p4zguD5EkTyF1r9TvbnjCzQ@mail.gmail.com>
Message-ID: <CAJOp35nsB0GehFxL8nWiEwQiozWQsE46Kb7x1iFyNP_qfo3FsA@mail.gmail.com>

Hi all,

I wonder if anyone has used the arcsde driver with GDAL 2+

I immediately bumped on two issues:
the first is a compilation error, see patch:
https://github.com/johanvdw/gdal/commit/b83ef2eaf1c2bcca8b012d4fb39ee0589302fe93

The second is an error because there are both an OGR and a raster driver:
johan at wp1270-debian:~/test# ogrinfo arcsde.vrt sde_layer
Error opening file for reading: No such file or directory
ERROR 1: A non OGR driver is registered with the same name: SDE
FAILURE:
Unable to open datasource `arcsde.vrt' with the following drivers.

I could fix this error by renaming the ogr driver:
https://github.com/johanvdw/gdal/commit/dc3c5f50af10372995a1cff23bd874694309231a
Not sure though if that is the best possible fix.

After that fix there was still an error which I'm still investigating,
but I'd like to know if this is a good way to fix that error or if I
should do sth else.

I got the driver working before on 1.9 -> 1.11.5, but this also
required some plumbing (linking gdal to pthread_atfork.o, which can be
extracted on debian as:
ar -xv /usr/lib/x86_64-linux-gnu/libpthread.a pthread_atfork.o
). See the problems reported here: [1]

Kind Regards,
Johan
[1] https://lists.osgeo.org/pipermail/gdal-dev/2011-September/030195.html

From even.rouault at spatialys.com  Thu Nov  3 07:23:44 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 3 Nov 2016 15:23:44 +0100
Subject: [gdal-dev] Fwd: arcsde ogr driver and GDAL 2+
In-Reply-To: <CAJOp35nsB0GehFxL8nWiEwQiozWQsE46Kb7x1iFyNP_qfo3FsA@mail.gmail.com>
References: <CAJOp35m1+ysmO+vA3bzm8Rb1-5-p4zguD5EkTyF1r9TvbnjCzQ@mail.gmail.com>
 <CAJOp35nsB0GehFxL8nWiEwQiozWQsE46Kb7x1iFyNP_qfo3FsA@mail.gmail.com>
Message-ID: <201611031523.44950.even.rouault@spatialys.com>

Le jeudi 03 novembre 2016 15:08:29, Johan Van de Wauw a écrit :
> Hi all,
> 
> I wonder if anyone has used the arcsde driver with GDAL 2+

Nobody has maintained it in years. Never compiled it myself.

> 
> I immediately bumped on two issues:
> the first is a compilation error, see patch:
> https://github.com/johanvdw/gdal/commit/b83ef2eaf1c2bcca8b012d4fb39ee058930
> 2fe93

Applied in trunk and 2.1 branch per https://trac.osgeo.org/gdal/ticket/6714

> 
> The second is an error because there are both an OGR and a raster driver:
> johan at wp1270-debian:~/test# ogrinfo arcsde.vrt sde_layer
> Error opening file for reading: No such file or directory
> ERROR 1: A non OGR driver is registered with the same name: SDE
> FAILURE:
> Unable to open datasource `arcsde.vrt' with the following drivers.
> 
> I could fix this error by renaming the ogr driver:
> https://github.com/johanvdw/gdal/commit/dc3c5f50af10372995a1cff23bd87469430
> 9231a Not sure though if that is the best possible fix.

I've applied a variation and used "OGR_SDE" instead (similarly to the OGR_VRT 
vs VRT drivers). So that the logic in  OGRSFDriverRegistrar::GetDriverByName() 
can select the right driver when used the old OGR driver API with the SDE 
name.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From stefano.iacovella at gmail.com  Thu Nov  3 08:06:38 2016
From: stefano.iacovella at gmail.com (Stefano Iacovella)
Date: Thu, 3 Nov 2016 16:06:38 +0100
Subject: [gdal-dev] Fwd: arcsde ogr driver and GDAL 2+
In-Reply-To: <201611031523.44950.even.rouault@spatialys.com>
References: <CAJOp35m1+ysmO+vA3bzm8Rb1-5-p4zguD5EkTyF1r9TvbnjCzQ@mail.gmail.com>
 <CAJOp35nsB0GehFxL8nWiEwQiozWQsE46Kb7x1iFyNP_qfo3FsA@mail.gmail.com>
 <201611031523.44950.even.rouault@spatialys.com>
Message-ID: <CAG9OqYoUK7qnKkkGEqUhGtN3ujk8pSdjPNrU75a5zbTuhqkNcg@mail.gmail.com>

2016-11-03 15:23 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:

> Le jeudi 03 novembre 2016 15:08:29, Johan Van de Wauw a écrit :
> > Hi all,
> >
> > I wonder if anyone has used the arcsde driver with GDAL 2+
>
> Nobody has maintained it in years. Never compiled it myself.
>

moreover since release 10.3 ESRI deprecated the ArcSDE product.
Consequently the SDK, that is mandatory for compiling GDAL with ArcSDE
driver, is no more available for customers.
So your only chance to use GDAL with ArcSDE is to use an obsolete release
of the product.

https://blogs.esri.com/esri/supportcenter/2015/02/11/where-is-the-install-for-arcsde-10-3/

Hope this helps

Stefano

---------------------------------------------------
41.95581N 12.52854E


http://www.linkedin.com/in/stefanoiacovella

http://twitter.com/#!/Iacovellas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161103/4b2dc42f/attachment.html>

From rex200789 at gmail.com  Thu Nov  3 09:47:14 2016
From: rex200789 at gmail.com (Renison)
Date: Thu, 3 Nov 2016 09:47:14 -0700 (MST)
Subject: [gdal-dev] Simple circle in OGR
In-Reply-To: <1478119606967-5294053.post@n6.nabble.com>
References: <1478119606967-5294053.post@n6.nabble.com>
Message-ID: <1478191634390-5294217.post@n6.nabble.com>

Figured it out like this:
            SpatialReference defaultGeoSys = new SpatialReference("");
            defaultGeoSys.SetWellKnownGeogCS("EPSG:4326");

            //define a circle using point and buffer        
            string pointlineString = "POINT (" + longitude + " " + latitude
+ ")";
            Geometry center = OGR.Ogr.CreateGeometryFromWkt(ref
pointlineString, defaultGeoSys);
            Geometry bufferDefn = center.Buffer(radiusInMiles, 10000);
            Geometry bufferDefnPolygon = bufferDefn.GetGeometryRef(0);

            Geometry actualCircle = Ogr.ForceToPolygon(bufferDefnPolygon);

The actualCircle serves my purpose of within and intersects. This is just a
fyi if someone else has an issue like this.



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Simple-circle-in-OGR-tp5294053p5294217.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From rex200789 at gmail.com  Thu Nov  3 09:51:28 2016
From: rex200789 at gmail.com (Renison)
Date: Thu, 3 Nov 2016 09:51:28 -0700 (MST)
Subject: [gdal-dev] Simple circle in OGR
In-Reply-To: <1478191634390-5294217.post@n6.nabble.com>
References: <1478119606967-5294053.post@n6.nabble.com>
 <1478191634390-5294217.post@n6.nabble.com>
Message-ID: <1478191888469-5294219.post@n6.nabble.com>

Forgot to add that this is not a pure circle per-se, it is a polygon
comprised of 10000 points on the circumference of the buffer from the
reference point. I have used WGS84 projection for source circle and checking
the concerned OGR geometry.



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Simple-circle-in-OGR-tp5294053p5294219.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From daniele.romagnoli at geo-solutions.it  Thu Nov  3 10:19:36 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Thu, 3 Nov 2016 18:19:36 +0100
Subject: [gdal-dev] Question on gdalwarp, srcnodata and dstalpha
Message-ID: <CAJaHrDwA=k147_LFadA=pbbAB9n2g71H5z=8uzyYPUZumaGK8Q@mail.gmail.com>

Hi List,
I was checking a gdalwarp (GDAL 2.1.2) invokation with a colleague and I
have a question.

I know that when warping a geotiff with internal NODATA_VALUES=0 0 0
metadata, only RGB pixels = 0 0 0 are handled as nodata whilst pixels like
"0 2 4", "50 0 0" will not right?

In the past, I had issues using -scrnodata 0 instead of embedded
NODATA_VALUES=0 0 0, getting results with sparse nodata around due to
band_i = 0 being interpreted as a nodata pixels. This is why I usually
suggest to define the NODATA_VALUES metadata to make sure only the exact
triplet is handled as nodata.

However, today we have processed a simple UTM RGB dataset (without
NODATA_VALUES metadata defined) using this command:
gdalwarp -t_srs EPSG:4326 -srcnodata 0 -dstnodata None -dstalpha

And the result is properly rendered: the alpha mask is zero only where the
input pixels are "0 0 0" which is exactly what we needed.
Do something has been changed in the latest versions? Is the alpha band
mask being set to zero only when all input pixels are zero?

Thanks for the clarification.
Cheers,
Daniele

-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161103/ec78246a/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov  3 23:39:27 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 4 Nov 2016 06:39:27 +0000
Subject: [gdal-dev] Attach database and GeoPackage
Message-ID: <2515abc2e5e94c3a8455a2cfc80b7f8b@C119S212VM022.msvyvi.vaha.local>

Hi,

I have been thinking that it could be nice to be able to open GeoPackage with attached database https://www.sqlite.org/lang_attach.html. Attaching database that contains spatial tables would probably give too much troubles because reading the spatial metadata of the attached db through the master db so that GeoPackage clients understands what happens feels difficult.  However, attaching tables with pure attribute data (aspatial tables) might make some sense by allowing to keep the heavy but stable geometries in one db and more frequently updated attributes in another. Wondering if there could be some open option like -oo attach_database=path_to_another_sqlite_db. I do not have any clear use case in my mind yet, just thinking.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161104/4bf2e02b/attachment.html>

From johan.vandewauw at gmail.com  Fri Nov  4 02:48:42 2016
From: johan.vandewauw at gmail.com (Johan Van de Wauw)
Date: Fri, 4 Nov 2016 10:48:42 +0100
Subject: [gdal-dev] Fwd: arcsde ogr driver and GDAL 2+
In-Reply-To: <CAG9OqYoUK7qnKkkGEqUhGtN3ujk8pSdjPNrU75a5zbTuhqkNcg@mail.gmail.com>
References: <CAJOp35m1+ysmO+vA3bzm8Rb1-5-p4zguD5EkTyF1r9TvbnjCzQ@mail.gmail.com>
 <CAJOp35nsB0GehFxL8nWiEwQiozWQsE46Kb7x1iFyNP_qfo3FsA@mail.gmail.com>
 <201611031523.44950.even.rouault@spatialys.com>
 <CAG9OqYoUK7qnKkkGEqUhGtN3ujk8pSdjPNrU75a5zbTuhqkNcg@mail.gmail.com>
Message-ID: <CAJOp35nJ2idWsVos4LZgLX2urTSzicawkuC+VdUR6q_Rr4JkKA@mail.gmail.com>

On Thu, Nov 3, 2016 at 4:06 PM, Stefano Iacovella
<stefano.iacovella at gmail.com> wrote:
>
> 2016-11-03 15:23 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:
>>
>> Le jeudi 03 novembre 2016 15:08:29, Johan Van de Wauw a écrit :
>> > Hi all,
>> >
>> > I wonder if anyone has used the arcsde driver with GDAL 2+
>>
>> Nobody has maintained it in years. Never compiled it myself.
>
>
> moreover since release 10.3 ESRI deprecated the ArcSDE product.
> Consequently the SDK, that is mandatory for compiling GDAL with ArcSDE
> driver, is no more available for customers.
> So your only chance to use GDAL with ArcSDE is to use an obsolete release of
> the product.
>
We are aware of that. In fact my customer is migrating all their
applications to an open source stack, but this takes time. This custom
version of gdal is part of the migration track.

I can confirm now that gdal 2.1.2 with the patches applied works fine
with esri arcsde 10.2 sdk (on ubuntu).

Kind Regards,
Johan

From stefano.iacovella at gmail.com  Fri Nov  4 02:50:49 2016
From: stefano.iacovella at gmail.com (Stefano Iacovella)
Date: Fri, 4 Nov 2016 10:50:49 +0100
Subject: [gdal-dev] Fwd: arcsde ogr driver and GDAL 2+
In-Reply-To: <CAJOp35nJ2idWsVos4LZgLX2urTSzicawkuC+VdUR6q_Rr4JkKA@mail.gmail.com>
References: <CAJOp35m1+ysmO+vA3bzm8Rb1-5-p4zguD5EkTyF1r9TvbnjCzQ@mail.gmail.com>
 <CAJOp35nsB0GehFxL8nWiEwQiozWQsE46Kb7x1iFyNP_qfo3FsA@mail.gmail.com>
 <201611031523.44950.even.rouault@spatialys.com>
 <CAG9OqYoUK7qnKkkGEqUhGtN3ujk8pSdjPNrU75a5zbTuhqkNcg@mail.gmail.com>
 <CAJOp35nJ2idWsVos4LZgLX2urTSzicawkuC+VdUR6q_Rr4JkKA@mail.gmail.com>
Message-ID: <CAG9OqYpgz47hbbZgzLA-p0_11mEnVSMnbwZnkVbLzLW7wEQxJw@mail.gmail.com>

Thanks Johan for letting us know it can work

All the best

Stefano

---------------------------------------------------
41.95581N 12.52854E


http://www.linkedin.com/in/stefanoiacovella

http://twitter.com/#!/Iacovellas

2016-11-04 10:48 GMT+01:00 Johan Van de Wauw <johan.vandewauw at gmail.com>:

> On Thu, Nov 3, 2016 at 4:06 PM, Stefano Iacovella
> <stefano.iacovella at gmail.com> wrote:
> >
> > 2016-11-03 15:23 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:
> >>
> >> Le jeudi 03 novembre 2016 15:08:29, Johan Van de Wauw a écrit :
> >> > Hi all,
> >> >
> >> > I wonder if anyone has used the arcsde driver with GDAL 2+
> >>
> >> Nobody has maintained it in years. Never compiled it myself.
> >
> >
> > moreover since release 10.3 ESRI deprecated the ArcSDE product.
> > Consequently the SDK, that is mandatory for compiling GDAL with ArcSDE
> > driver, is no more available for customers.
> > So your only chance to use GDAL with ArcSDE is to use an obsolete
> release of
> > the product.
> >
> We are aware of that. In fact my customer is migrating all their
> applications to an open source stack, but this takes time. This custom
> version of gdal is part of the migration track.
>
> I can confirm now that gdal 2.1.2 with the patches applied works fine
> with esri arcsde 10.2 sdk (on ubuntu).
>
> Kind Regards,
> Johan
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161104/730281e7/attachment.html>

From even.rouault at spatialys.com  Fri Nov  4 03:25:46 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 4 Nov 2016 11:25:46 +0100
Subject: [gdal-dev] Attach database and GeoPackage
In-Reply-To: <2515abc2e5e94c3a8455a2cfc80b7f8b@C119S212VM022.msvyvi.vaha.local>
References: <2515abc2e5e94c3a8455a2cfc80b7f8b@C119S212VM022.msvyvi.vaha.local>
Message-ID: <201611041125.47181.even.rouault@spatialys.com>

Le vendredi 04 novembre 2016 07:39:27, Rahkonen Jukka (MML) a écrit :
> Hi,
> 
> I have been thinking that it could be nice to be able to open GeoPackage
> with attached database https://www.sqlite.org/lang_attach.html. Attaching
> database that contains spatial tables would probably give too much
> troubles because reading the spatial metadata of the attached db through
> the master db so that GeoPackage clients understands what happens feels
> difficult.  However, attaching tables with pure attribute data (aspatial
> tables) might make some sense by allowing to keep the heavy but stable
> geometries in one db and more frequently updated attributes in another.
> Wondering if there could be some open option like -oo
> attach_database=path_to_another_sqlite_db. I do not have any clear use
> case in my mind yet, just thinking.

Hi Jukka,

You can already attach another sqlite (not necessarily GPKG by the way) to a GPKG
by using the ExecuteSQL() interface

See the below python script:

from osgeo import ogr
ds = ogr.Open('poly.gpkg')
ds.ExecuteSQL("ATTACH DATABASE 'idlink.gpkg' AS aux")
sql_lyr = ds.ExecuteSQL("SELECT * FROM poly p JOIN aux.idlink AS id ON p.eas_id = id.eas_id")
f = sql_lyr.GetNextFeature()
f.DumpReadable()
ds.ReleaseResultSet(sql_lyr)


Output:

OGRFeature(SELECT):1
  AREA (Real) = 215229.266
  EAS_ID (Integer64) = 168
  PRFEDEA (String) = 35043411
  NAME (String) = _168_
  POLYGON ((479819.84375 4765180.5,479690.1875 4765259.5,479647.0 4765369.5,479730.375 4765400.5,480039.03125 4765539.5,480035.34375 4765558.5,480159.78125 
4765610.5,480202.28125 4765482.0,480365.0 4765015.5,480389.6875 4764950.0,480133.96875 4764856.5,480080.28125 4764979.5,480082.96875 4765049.5,480088.8125 
4765139.5,480059.90625 4765239.5,480019.71875 4765319.5,479980.21875 4765409.5,479909.875 4765370.0,479859.875 4765270.0,479819.84375 4765180.5))


Actually you can even use the SQL SQLite dialect and its ability to open another OGR source as a joint layer.
The trick when the main OGR datasource is already a GPKG is to specify the "indirect_sqlite" dialect. But performance will be
slower than with the attach method due to GPKG/SQLite->OGR->SQLite->OGR round-trips.

ogrinfo poly.gpkg -sql "select * from poly p join \"idlink.gpkg\".idlink id  ON p.eas_id = id.eas_id" -dialect indirect_sqlite

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From a.amici at bopen.eu  Fri Nov  4 07:13:31 2016
From: a.amici at bopen.eu (Alessandro Amici)
Date: Fri, 04 Nov 2016 14:13:31 +0000
Subject: [gdal-dev] Release: Elevation 1.0.0 download global SRTM 30m DEM on
	demand
Message-ID: <CAF0=-Ter8gSsbqDtMNvJAKvOz-AuSez0US+CadOP=cEgan9Oww@mail.gmail.com>

I am pleased to announce the release of version 1.0.0 of Elevation, a tool
for easy access to global terrain digital elevation models, SRTM 30m DEM
and SRTM 90m DEM:

http://elevation.bopen.eu/en/stable/quickstart.html

Elevation is currently considered feature complete, its command-line and
python APIs are frozen and it sees constant production use. If you
encounter any problems, please file an issue along with a detailed
description on the development page:

https://github.com/bopen/elevation

Contributions are highly welcomed and appreciated, every little help
counts, so do not hesitate!

The project is free and open source software distributed under the terms of
the Apache License, Version 2.0. and the development has been sponsored by
my employer B-Open Solutions http://bopen.eu.

Alessandro - @alexamici <https://twitter.com/alexamici>
CTO at B-Open Solutions - http://bopen.eu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161104/23adfbdd/attachment.html>

From issworld2000 at yahoo.com  Fri Nov  4 07:59:26 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 4 Nov 2016 14:59:26 +0000 (UTC)
Subject: [gdal-dev] Release: Elevation 1.0.0 download global SRTM 30m
 DEM on	demand
In-Reply-To: <CAF0=-Ter8gSsbqDtMNvJAKvOz-AuSez0US+CadOP=cEgan9Oww@mail.gmail.com>
References: <CAF0=-Ter8gSsbqDtMNvJAKvOz-AuSez0US+CadOP=cEgan9Oww@mail.gmail.com>
Message-ID: <865807636.267731.1478271566707@mail.yahoo.com>

Hi Alessandro,

This looks great!

Is the range of both 1 arc-second and 3 arc-second raster data limited to 56 latitude south, and 60 latitude north?
Thank you for the reply.

Kind regards,
Djordje Spasic
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161104/aa7fadf9/attachment-0001.html>

From a.amici at bopen.eu  Fri Nov  4 08:11:41 2016
From: a.amici at bopen.eu (Alessandro Amici)
Date: Fri, 04 Nov 2016 15:11:41 +0000
Subject: [gdal-dev] Release: Elevation 1.0.0 download global SRTM 30m
 DEM on demand
In-Reply-To: <865807636.267731.1478271566707@mail.yahoo.com>
References: <CAF0=-Ter8gSsbqDtMNvJAKvOz-AuSez0US+CadOP=cEgan9Oww@mail.gmail.com>
 <865807636.267731.1478271566707@mail.yahoo.com>
Message-ID: <CAF0=-TeVwDRTEETkqGZifFp7BB7S_KmUN3KRyTX+iSNjPFUB=w@mail.gmail.com>

Djordje,

yes, Elevation downloads and merges on demand the SRTM tiles from two
different data providers, all limitations of the SRTM data apply.

Thanks!
Alessandro


On Fri, 4 Nov 2016 at 16:02 Djordje Spasic <issworld2000 at yahoo.com> wrote:

> Hi Alessandro,
>
> This looks great!
>
> Is the range of both 1 arc-second and 3 arc-second raster data limited to
> 56 latitude south, and 60 latitude north?
>
> Thank you for the reply.
>
> Kind regards,
> Djordje Spasic
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161104/0b2ae2ff/attachment.html>

From issworld2000 at yahoo.com  Fri Nov  4 08:22:43 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 4 Nov 2016 15:22:43 +0000 (UTC)
Subject: [gdal-dev] Release: Elevation 1.0.0 download global SRTM 30m
 DEM on demand
In-Reply-To: <CAF0=-TeVwDRTEETkqGZifFp7BB7S_KmUN3KRyTX+iSNjPFUB=w@mail.gmail.com>
References: <CAF0=-Ter8gSsbqDtMNvJAKvOz-AuSez0US+CadOP=cEgan9Oww@mail.gmail.com>
 <865807636.267731.1478271566707@mail.yahoo.com>
 <CAF0=-TeVwDRTEETkqGZifFp7BB7S_KmUN3KRyTX+iSNjPFUB=w@mail.gmail.com>
Message-ID: <86100258.282443.1478272963855@mail.yahoo.com>

Thank you Alessandro!

Kind regards,
Djordje Spasic
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161104/868b6c53/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov  4 10:00:10 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 4 Nov 2016 17:00:10 +0000
Subject: [gdal-dev] Make gdal_polygonize to support the mask band
Message-ID: <7f3859a83dc44305afc693db5d991098@C119S212VM022.msvyvi.vaha.local>

Hi,

Once again someone wants to get the footprints of valid data in images http://gis.stackexchange.com/questions/216624/creating-a-shapefile-for-footprint-of-tasters-valid-data-areas-with-gdal.

A year ago, in here https://lists.osgeo.org/pipermail/gdal-dev/2015-October/042859.html
Even suggested to create a mask-only image with 
gdal_translate in.tif mask.tif -b mask
and then polygonize that into vectors with gdal_polygonize.

I wonder how hard it would be to make gdal_polygonize to find the mask band directly and recognize it with "-b mask" just like gdal_translate does.

-Jukka Rahkonen-

From even.rouault at spatialys.com  Sun Nov  6 07:53:29 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Nov 2016 16:53:29 +0100
Subject: [gdal-dev] Make gdal_polygonize to support the mask band
In-Reply-To: <7f3859a83dc44305afc693db5d991098@C119S212VM022.msvyvi.vaha.local>
References: <7f3859a83dc44305afc693db5d991098@C119S212VM022.msvyvi.vaha.local>
Message-ID: <201611061653.29813.even.rouault@spatialys.com>

Le vendredi 04 novembre 2016 18:00:10, Rahkonen Jukka (MML) a écrit :
> Hi,
> 
> Once again someone wants to get the footprints of valid data in images
> http://gis.stackexchange.com/questions/216624/creating-a-shapefile-for-foo
> tprint-of-tasters-valid-data-areas-with-gdal.
> 
> A year ago, in here
> https://lists.osgeo.org/pipermail/gdal-dev/2015-October/042859.html Even
> suggested to create a mask-only image with
> gdal_translate in.tif mask.tif -b mask
> and then polygonize that into vectors with gdal_polygonize.
> 
> I wonder how hard it would be to make gdal_polygonize to find the mask band
> directly and recognize it with "-b mask" just like gdal_translate does.

Not that hard. I just added support for that.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Sun Nov  6 08:33:47 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Nov 2016 17:33:47 +0100
Subject: [gdal-dev] Question on gdalwarp, srcnodata and dstalpha
In-Reply-To: <CAJaHrDwA=k147_LFadA=pbbAB9n2g71H5z=8uzyYPUZumaGK8Q@mail.gmail.com>
References: <CAJaHrDwA=k147_LFadA=pbbAB9n2g71H5z=8uzyYPUZumaGK8Q@mail.gmail.com>
Message-ID: <201611061733.47926.even.rouault@spatialys.com>

Le jeudi 03 novembre 2016 18:19:36, Daniele Romagnoli a écrit :
> Hi List,
> I was checking a gdalwarp (GDAL 2.1.2) invokation with a colleague and I
> have a question.
> 
> I know that when warping a geotiff with internal NODATA_VALUES=0 0 0
> metadata, only RGB pixels = 0 0 0 are handled as nodata whilst pixels like
> "0 2 4", "50 0 0" will not right?
> 
> In the past, I had issues using -scrnodata 0 instead of embedded
> NODATA_VALUES=0 0 0, getting results with sparse nodata around due to
> band_i = 0 being interpreted as a nodata pixels. This is why I usually
> suggest to define the NODATA_VALUES metadata to make sure only the exact
> triplet is handled as nodata.
> 
> However, today we have processed a simple UTM RGB dataset (without
> NODATA_VALUES metadata defined) using this command:
> gdalwarp -t_srs EPSG:4326 -srcnodata 0 -dstnodata None -dstalpha
> 
> And the result is properly rendered: the alpha mask is zero only where the
> input pixels are "0 0 0" which is exactly what we needed.
> Do something has been changed in the latest versions? Is the alpha band
> mask being set to zero only when all input pixels are zero?

Hi Daniele,

This is a good question, and I would have thought the same as you. But when 
digging further, the nodata values must be indeed fully matched for all 
components to consider a pixel as transparent. And this has been the case for 
the last 11 years :-)) : https://trac.osgeo.org/gdal/changeset/8286

My confusion came from the fact that the default behaviour of the warping 
engine used by gdalwarp is not that one (see UNIFIED_SRC_NODATA option in 
http://www.gdal.org/structGDALWarpOptions.html#a0ed77f9917bb96c7a9aabd73d4d06e08), 
but gdalwarp override it to have the UNIFIED_SRC_NODATA=YES behaviour.

I've also just added support in trunk to be able to specify 
UNIFIED_SRC_NODATA=NO explicitly if wished.

See :

Let create a dataset with a single pixel R,G,B=10,20,30 with
gdal_translate byte.tif rgb.tif -b 1 -b 1 -b 1 -scale_1 0 255 10 10 \
    -scale_2 0 255 20 20  -scale_3 0 255 30 30 -srcwin 0 0 1 1

By default:
gdalwarp rgb.tif out.tif -overwrite  -srcnodata 10 -dstnodata None -dstalpha
lead to (R,G,B,A)=(10,20,30,255)

And (in trunk):
gdalwarp rgb.tif out.tif -overwrite  -srcnodata 10 -dstnodata None -dstalpha \
		 -wo UNIFIED_SRC_NODATA=NO -wo INIT_DEST=127
lead to (R,G,B,A)=(127,20,30,255)

==> Nodata is applied band per band, and alpha is considered to be 255 as soon 
as at least one band is valid.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From esacree at knology.net  Sun Nov  6 18:27:26 2016
From: esacree at knology.net (esacree)
Date: Sun, 6 Nov 2016 19:27:26 -0700 (MST)
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile Matrix
 Set's Tile Level?
Message-ID: <1478485646278-5294530.post@n6.nabble.com>

I am trying to use the new GDAL_WMTS driver with GDAL Version 2.1.  
Problem:  The thread that receives the data from the server gets a GDAL data
set handle with a total data buffer size of 4,294,967,296 for a 4 band
image.

Questions:  
1.	 Does GDAL_WMTS driver return all tiles combined into a single image
memory buffer?  
2.	Is the data buffer returned for WMTS retrieved the same way as for WMS
with a call to the GDAL Data Set rasterio function?
3.	Is there any way to control which tile level in the TileMatrixSet is
returned for GDAL_WMTS?   A TileLevel tag is in the GDAL_WMS XML definition
http://www.gdal.org/frmt_wms.html  but not in the GDAL_WMTS
definition/example http://www.gdal.org/frmt_wmts.html 

According to the returned data parameters, the image is huge 32K x 32K x 4
with around 4GB of memory needed to create a 4 band image.  The area
requested is a fairly small area around the Cumberland River.

Here’s a sample of the Service Request sent to the WMTS server.  The XML is
similar to the request generated by GDAL_Translate for the server.  The
DataWindow coordinates are much smaller and in range of the server’s data. 
Request coordinates were converted from EPSG:26926 to EPSG:3857 for the
request shown below.

<GDAL_WMTS>     
<GetCapabilitiesUrl>http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS/1.0.0/WMTSCapabilities.xml</GetCapabilitiesUrl>
        <Layer>USGSShadedReliefOnly</Layer>
        
        <TileMatrixSet>default028mm</TileMatrixSet>
    <DataWindow>
        <UpperLeftX>-9664344.849763</UpperLeftX>
        <UpperLeftY>4328551.472775</UpperLeftY>
        <LowerRightX>-9646502.672226</LowerRightX>
       <LowerRightY>4318753.685277</LowerRightY>
    </DataWindow>
    <BandsCount>4</BandsCount>
    <Cache />
    <UnsafeSSL>true</UnsafeSSL>
    <ZeroBlockHttpCodes>204,404</ZeroBlockHttpCodes>
    <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
</GDAL_WMTS>

With the exception of the DataWindow parameters, the request matches the
test request generated by GDAL_Translate for the server.  The DataWindow 
values are well within the full range of the WMTS Server for the requested
layer.

Thanks in advance!

Elaine




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/GDAL-WMTS-Driver-How-do-you-control-the-Tile-Matrix-Set-s-Tile-Level-tp5294530.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Sun Nov  6 23:11:42 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 7 Nov 2016 00:11:42 -0700 (MST)
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile
 Matrix Set's Tile Level?
In-Reply-To: <1478485646278-5294530.post@n6.nabble.com>
References: <1478485646278-5294530.post@n6.nabble.com>
Message-ID: <1478502702743-5294539.post@n6.nabble.com>

Hi,

Did you forget to include your request? Or do you mean that you asked
gdal_translate just to convert the whole data source that you defined with
that xml file into some other format without defining the window by using
-spat or -projwin?

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/GDAL-WMTS-Driver-How-do-you-control-the-Tile-Matrix-Set-s-Tile-Level-tp5294530p5294539.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From daniele.romagnoli at geo-solutions.it  Mon Nov  7 00:29:35 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 7 Nov 2016 09:29:35 +0100
Subject: [gdal-dev] Question on gdalwarp, srcnodata and dstalpha
In-Reply-To: <201611061733.47926.even.rouault@spatialys.com>
References: <CAJaHrDwA=k147_LFadA=pbbAB9n2g71H5z=8uzyYPUZumaGK8Q@mail.gmail.com>
 <201611061733.47926.even.rouault@spatialys.com>
Message-ID: <CAJaHrDyJC0H8JUBd++SNw7-t9-M1Qz9803+LxFBf1-GZR+DpNw@mail.gmail.com>

Hi Even,
thanks for the feedback.

On Sun, Nov 6, 2016 at 5:33 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le jeudi 03 novembre 2016 18:19:36, Daniele Romagnoli a écrit :
> > Hi List,
> > I was checking a gdalwarp (GDAL 2.1.2) invokation with a colleague and I
> > have a question.
> >
> > I know that when warping a geotiff with internal NODATA_VALUES=0 0 0
> > metadata, only RGB pixels = 0 0 0 are handled as nodata whilst pixels
> like
> > "0 2 4", "50 0 0" will not right?
> >
> > In the past, I had issues using -scrnodata 0 instead of embedded
> > NODATA_VALUES=0 0 0, getting results with sparse nodata around due to
> > band_i = 0 being interpreted as a nodata pixels. This is why I usually
> > suggest to define the NODATA_VALUES metadata to make sure only the exact
> > triplet is handled as nodata.
> >
> > However, today we have processed a simple UTM RGB dataset (without
> > NODATA_VALUES metadata defined) using this command:
> > gdalwarp -t_srs EPSG:4326 -srcnodata 0 -dstnodata None -dstalpha
> >
> > And the result is properly rendered: the alpha mask is zero only where
> the
> > input pixels are "0 0 0" which is exactly what we needed.
> > Do something has been changed in the latest versions? Is the alpha band
> > mask being set to zero only when all input pixels are zero?
>
> Hi Daniele,
>
> This is a good question, and I would have thought the same as you. But when
> digging further, the nodata values must be indeed fully matched for all
> components to consider a pixel as transparent. And this has been the case
> for
> the last 11 years :-)) : https://trac.osgeo.org/gdal/changeset/8286
>
> My confusion came from the fact that the default behaviour of the warping
> engine used by gdalwarp is not that one (see UNIFIED_SRC_NODATA option in
> http://www.gdal.org/structGDALWarpOptions.html#
> a0ed77f9917bb96c7a9aabd73d4d06e08),
> but gdalwarp override it to have the UNIFIED_SRC_NODATA=YES behaviour.
>

Thanks for the investigation.

At this point, if this behavior is there since 11 years, I guess that the
cause of the issues I had in the past was probably involving a gdaladdo
after a gdalwarp in my processing. So that gdalwarp was internally
considering nodata a fully matching 0 triplets to produce the high res
output whilst gdaladdo was considering nodata on band basis, separately,
producing scattered no data.

Cheers,
Daniele


>
> I've also just added support in trunk to be able to specify
> UNIFIED_SRC_NODATA=NO explicitly if wished.
>
> See :
>
> Let create a dataset with a single pixel R,G,B=10,20,30 with
> gdal_translate byte.tif rgb.tif -b 1 -b 1 -b 1 -scale_1 0 255 10 10 \
>     -scale_2 0 255 20 20  -scale_3 0 255 30 30 -srcwin 0 0 1 1
>
> By default:
> gdalwarp rgb.tif out.tif -overwrite  -srcnodata 10 -dstnodata None
> -dstalpha
> lead to (R,G,B,A)=(10,20,30,255)
>
> And (in trunk):
> gdalwarp rgb.tif out.tif -overwrite  -srcnodata 10 -dstnodata None
> -dstalpha \
>                  -wo UNIFIED_SRC_NODATA=NO -wo INIT_DEST=127
> lead to (R,G,B,A)=(127,20,30,255)
>
> ==> Nodata is applied band per band, and alpha is considered to be 255 as
> soon
> as at least one band is valid.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161107/d55104b0/attachment.html>

From jyrki_von_karkki at mailbox.org  Mon Nov  7 00:33:58 2016
From: jyrki_von_karkki at mailbox.org (Jyrki Von Karkki)
Date: Mon, 7 Nov 2016 09:33:58 +0100
Subject: [gdal-dev] gdal on freebsd
Message-ID: <1916742e-c6f0-ba79-52ea-e1c594937624@mailbox.org>

Hi all

I'm having a bit of an issue with the postgresql/postgis driver on 
freebsd. It simply does not appear installed.

$ ogrinfo --formats | grep -i post
     PGDUMP -vector- (w+v): PostgreSQL SQL dump

But on my (linux) desktop for instance it does appear:

$ ogrinfo --formats | ag post
   PostgreSQL -vector- (rw+): PostgreSQL/PostGIS
   PGDUMP -vector- (w+v): PostgreSQL SQL dump

Google has been not very helpful so far.
I was wondering if anyone here might know something?
Any help appreciated
Thanks!

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov  7 06:00:25 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 7 Nov 2016 07:00:25 -0700 (MST)
Subject: [gdal-dev] Make gdal_polygonize to support the mask band
In-Reply-To: <201611061653.29813.even.rouault@spatialys.com>
References: <7f3859a83dc44305afc693db5d991098@C119S212VM022.msvyvi.vaha.local>
 <201611061653.29813.even.rouault@spatialys.com>
Message-ID: <1478527225545-5294630.post@n6.nabble.com>

Even Rouault-2 wrote
> Le vendredi 04 novembre 2016 18:00:10, Rahkonen Jukka (MML) a écrit :
>> Hi,
>> 
>> Once again someone wants to get the footprints of valid data in images
>> http://gis.stackexchange.com/questions/216624/creating-a-shapefile-for-foo
>> tprint-of-tasters-valid-data-areas-with-gdal.
>> 
>> A year ago, in here
>> https://lists.osgeo.org/pipermail/gdal-dev/2015-October/042859.html Even
>> suggested to create a mask-only image with
>> gdal_translate in.tif mask.tif -b mask
>> and then polygonize that into vectors with gdal_polygonize.
>> 
>> I wonder how hard it would be to make gdal_polygonize to find the mask
>> band
>> directly and recognize it with "-b mask" just like gdal_translate does.
> 
> Not that hard. I just added support for that.
> 
> Even

Thanks, and here is a little post-process command with SQLite SQL dialect
that can be used for removing the no-data polygons and holes which are
created by gdal_polygonize and leave just the yes-data area 

ogr2ogr -f GML -dialect SQLite -sql "select
ST_BuildArea(ST_ExteriorRing(geometry)) from mask where DN=255"
raster_data_polygon.gml mask.gml

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Make-gdal-polygonize-to-support-the-mask-band-tp5294371p5294630.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From esacree at knology.net  Mon Nov  7 08:32:34 2016
From: esacree at knology.net (esacree)
Date: Mon, 7 Nov 2016 09:32:34 -0700 (MST)
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile
 Matrix Set's Tile Level?
In-Reply-To: <1478502702743-5294539.post@n6.nabble.com>
References: <1478485646278-5294530.post@n6.nabble.com>
 <1478502702743-5294539.post@n6.nabble.com>
Message-ID: <1478536354582-5294667.post@n6.nabble.com>

I am trying to generate a WMTS Service Request XML file in C++ code for the
GDAL_WMTS driver in GDAL 2.1.  Just using the gdal_translate command to
generate a working sample XML file for debugging the C++ code.

Are there any GDAL_WMTS driver XML tag parameters to request a specific Tile
Level within the TileMatrixSet or specify the output image size?   The
server has one TileMatrixSet with 20 levels.  Since the server is trying to
send back 4GB of data, it must be returning the most detailed level.

The WMS example shows TileLevel and SizeX, SizeY image parameters.   The
WMTS example XML file does not show these DataWIndow XML parameters.  Can
they be used with GDAL_WMTS driver in the GDAL XML Service Request file?  Or
is there a different way to limit the tile level and output image size for
WMTS requests?

gdal_translate is used for debugging here.  The command is similar to the
example at the bottom of http://www.gdal.org/frmt_wmts.html.  

gdal_translate
"WMTS:http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/wmts/1.0.0/WMTSCapabilities.xml,layer=USGSShadedReliefOnly" 
wmts.xml -of WMTS


Thanks!

Elaine





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/GDAL-WMTS-Driver-How-do-you-control-the-Tile-Matrix-Set-s-Tile-Level-tp5294530p5294667.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Mon Nov  7 08:40:05 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 7 Nov 2016 17:40:05 +0100
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile
	Matrix Set's Tile Level?
In-Reply-To: <1478536354582-5294667.post@n6.nabble.com>
References: <1478485646278-5294530.post@n6.nabble.com>
 <1478502702743-5294539.post@n6.nabble.com>
 <1478536354582-5294667.post@n6.nabble.com>
Message-ID: <201611071740.05379.even.rouault@spatialys.com>

Le lundi 07 novembre 2016 17:32:34, esacree a écrit :
> I am trying to generate a WMTS Service Request XML file in C++ code for the
> GDAL_WMTS driver in GDAL 2.1.

As you don't provide us with any code snippet, this is just guessing of what 
you might be doing, but I suppose you are doing something like

RasterIO( 0, 0, rasterxsize, rasterysize, .., rasterxsize, rasterysize)

which requests the dataset at full resolution.

2 options  :
 * specify a smaller size for the buffer dimensions :
 RasterIO( 0, 0, rasterxsize, rasterysize, .., bufferxsize,  bufferysize)

 * use GDALRasterBand::GetOverview() to get an overview band and issue 
RasterIO() on it.

They are more or less equivalent. Option 1) will use option 2) internally.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From esacree at knology.net  Mon Nov  7 13:07:09 2016
From: esacree at knology.net (esacree)
Date: Mon, 7 Nov 2016 14:07:09 -0700 (MST)
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile
 Matrix Set's Tile Level?
In-Reply-To: <201611071740.05379.even.rouault@spatialys.com>
References: <1478485646278-5294530.post@n6.nabble.com>
 <1478502702743-5294539.post@n6.nabble.com>
 <1478536354582-5294667.post@n6.nabble.com>
 <201611071740.05379.even.rouault@spatialys.com>
Message-ID: <1478552829988-5294705.post@n6.nabble.com>

Code Snippet:


GDAL_WMTS XML file – area around Cumberland River:

Code is trying to get raster tiles from the server not capabilities.  Using
the example for the Local Service Description File here:
http://www.gdal.org/frmt_wmts.html .

1.  Here is the WMTS XML file generated to request tiles for the area.  Note
there is no image size limit specified in the request below.  A WMS request
is limited by size in the XML file.

<GDAL_WMTS>
       
<GetCapabilitiesUrl>http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS/1.0.0/WMTSCapabilities.xml</GetCapabilitiesUrl>
        <Layer>USGSShadedReliefOnly</Layer>
        
        <TileMatrixSet>default028mm</TileMatrixSet>
    <DataWindow>
        <UpperLeftX>-9664344.849763</UpperLeftX>
        <UpperLeftY>4328551.472775</UpperLeftY>
        <LowerRightX>-9646502.672226</LowerRightX>
        <LowerRightY>4318753.685277</LowerRightY>
    </DataWindow>
    <BandsCount>4</BandsCount>
    <Cache />
    <UnsafeSSL>true</UnsafeSSL>
    <ZeroBlockHttpCodes>204,404</ZeroBlockHttpCodes>
    <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
</GDAL_WMTS>

2.  Call to GDAL Open with the above XML file name to create the data set
using the XML Service Request file:

  GDALDataset* pdataset = (GDALDataset*)GDALOpen(xmlPath.c_str(),
GA_ReadOnly);
  if (!pdataset) 
  {
	OutputDebugStringA("GDALOpen failure");
	OutputDebugStringA(CPLGetLastErrorMsg());
    return false;
  }

// Note:  For the WMTS request above, the full raster image size of about
56K x 39K is coming back GetRasterXSize and GetRasterYSize.  For the older
GDAL_WMS the image sizes are the request size specified in the WMS XML
Service Request File.  There is no limit on the image size in the WMTS Tile
server request.

Here is the data setup in the info struct.  The info data is used later by
the call back function that gets the raster data:

  info->m_width  = pdataset->GetRasterXSize();  // Returning full size image
pixel width
  info->m_height = pdataset->GetRasterYSize();  // Returning full size image
pixel height

info->m_dtype = GDTByte;
info->m_dbands = 4;
nPixelSpace = 4; // 4 Bytes per pixel for RGBA
nLineSpace = m_width * nPixelSpace;
nBandSpace = 1; 
int	bandMap[] = { 1,2,3,4 };

3.  Data Receipt:  Later Data coming into the GDAL thread call back
function:

err = pdataset->RasterIO(	GF_Read, 0, 0,  info->m_width, info->m_height,
				(void*)tmpbuff, info->m_width, info->m_height,
				info->m_dtype,  info->m_dbands, bandMap,
				nPixelSpace, nLineSpace, nBandSpace);


Elaine





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/GDAL-WMTS-Driver-How-do-you-control-the-Tile-Matrix-Set-s-Tile-Level-tp5294530p5294705.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Mon Nov  7 13:29:10 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 7 Nov 2016 22:29:10 +0100
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile
	Matrix Set's Tile Level?
In-Reply-To: <1478552829988-5294705.post@n6.nabble.com>
References: <1478485646278-5294530.post@n6.nabble.com>
 <201611071740.05379.even.rouault@spatialys.com>
 <1478552829988-5294705.post@n6.nabble.com>
Message-ID: <201611072229.10965.even.rouault@spatialys.com>

Le lundi 07 novembre 2016 22:07:09, esacree a écrit :
> Code Snippet:
> 
> 
> GDAL_WMTS XML file – area around Cumberland River:
> 
> Code is trying to get raster tiles from the server not capabilities.  Using
> the example for the Local Service Description File here:
> http://www.gdal.org/frmt_wmts.html .
> 
> 1.  Here is the WMTS XML file generated to request tiles for the area. 
> Note there is no image size limit specified in the request below.  A WMS
> request is limited by size in the XML file.
> 
> <GDAL_WMTS>
> 
> <GetCapabilitiesUrl>http://basemap.nationalmap.gov/arcgis/rest/services/USG
> SShadedReliefOnly/MapServer/WMTS/1.0.0/WMTSCapabilities.xml</GetCapabilitie
> sUrl> <Layer>USGSShadedReliefOnly</Layer>
> 
>         <TileMatrixSet>default028mm</TileMatrixSet>
>     <DataWindow>
>         <UpperLeftX>-9664344.849763</UpperLeftX>
>         <UpperLeftY>4328551.472775</UpperLeftY>
>         <LowerRightX>-9646502.672226</LowerRightX>
>         <LowerRightY>4318753.685277</LowerRightY>
>     </DataWindow>
>     <BandsCount>4</BandsCount>
>     <Cache />
>     <UnsafeSSL>true</UnsafeSSL>
>     <ZeroBlockHttpCodes>204,404</ZeroBlockHttpCodes>
>     <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
> </GDAL_WMTS>
> 
> 2.  Call to GDAL Open with the above XML file name to create the data set
> using the XML Service Request file:
> 
>   GDALDataset* pdataset = (GDALDataset*)GDALOpen(xmlPath.c_str(),
> GA_ReadOnly);
>   if (!pdataset)
>   {
> 	OutputDebugStringA("GDALOpen failure");
> 	OutputDebugStringA(CPLGetLastErrorMsg());
>     return false;
>   }
> 
> // Note:  For the WMTS request above, the full raster image size of about
> 56K x 39K is coming back GetRasterXSize and GetRasterYSize.  For the older
> GDAL_WMS the image sizes are the request size specified in the WMS XML
> Service Request File.  There is no limit on the image size in the WMTS Tile
> server request.
> 
> Here is the data setup in the info struct.  The info data is used later by
> the call back function that gets the raster data:
> 
>   info->m_width  = pdataset->GetRasterXSize();  // Returning full size
> image pixel width
>   info->m_height = pdataset->GetRasterYSize();  // Returning full size
> image pixel height
> 
> info->m_dtype = GDTByte;
> info->m_dbands = 4;
> nPixelSpace = 4; // 4 Bytes per pixel for RGBA
> nLineSpace = m_width * nPixelSpace;
> nBandSpace = 1;
> int	bandMap[] = { 1,2,3,4 };
> 
> 3.  Data Receipt:  Later Data coming into the GDAL thread call back
> function:
> 
> err = pdataset->RasterIO(	GF_Read, 0, 0,  info->m_width, info->m_height,
> 				(void*)tmpbuff, info->m_width, info->m_height,
> 				info->m_dtype,  info->m_dbands, bandMap,
> 				nPixelSpace, nLineSpace, nBandSpace);
> 
> 

OK so you are requesting a  56K x 39K  image in a single request. If that's 
too big (which is likely), then ask for smaller buffer dimensions like

 err = pdataset->RasterIO(	GF_Read, 0, 0,  info->m_width, info->m_height,
 				(void*)tmpbuff, info->m_width / 16, info->m_height / 16,
 				info->m_dtype,  info->m_dbands, bandMap,
 				nPixelSpace, nLineSpace, nBandSpace);

> Elaine
> 
> 
> 
> 
> 
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/GDAL-WMTS-Driver-How-do-you-control-th
> e-Tile-Matrix-Set-s-Tile-Level-tp5294530p5294705.html Sent from the GDAL -
> Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From esacree at knology.net  Mon Nov  7 14:54:23 2016
From: esacree at knology.net (esacree)
Date: Mon, 7 Nov 2016 15:54:23 -0700 (MST)
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile
 Matrix Set's Tile Level?
In-Reply-To: <201611072229.10965.even.rouault@spatialys.com>
References: <1478485646278-5294530.post@n6.nabble.com>
 <1478502702743-5294539.post@n6.nabble.com>
 <1478536354582-5294667.post@n6.nabble.com>
 <201611071740.05379.even.rouault@spatialys.com>
 <1478552829988-5294705.post@n6.nabble.com>
 <201611072229.10965.even.rouault@spatialys.com>
Message-ID: <1478559263187-5294729.post@n6.nabble.com>

Yes, I tried setting the width and height in the pdataset->RasterIO call to
2048 x 1024.  (Based on window size, enlarged to next power of 2. )  

It doesn't crash which is good. Error code appears successful. But I am just
getting a black image now.  



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/GDAL-WMTS-Driver-How-do-you-control-the-Tile-Matrix-Set-s-Tile-Level-tp5294530p5294729.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From kit at hypostasis.com  Mon Nov  7 15:10:27 2016
From: kit at hypostasis.com (kit at hypostasis.com)
Date: Mon, 07 Nov 2016 15:10:27 -0800
Subject: [gdal-dev] gdal on freebsd
In-Reply-To: <1916742e-c6f0-ba79-52ea-e1c594937624@mailbox.org>
References: <1916742e-c6f0-ba79-52ea-e1c594937624@mailbox.org>
Message-ID: <97e2344fc1e84fbc358dcd1f09a73a7c@hypostasis.com>

cd /usr/ports/graphics/gdal
make config
[select the options that you want]
make install clean

should do the trick

it appears that PostGIS Vector is not part of the default package, but 
is in the port as an option


  # ogrinfo --formats | grep -i post
   PostgreSQL -vector- (rw+): PostgreSQL/PostGIS
   PGDUMP -vector- (w+v): PostgreSQL SQL dump



On 2016-11-07 00:33, Jyrki Von Karkki wrote:
> Hi all
> 
> I'm having a bit of an issue with the postgresql/postgis driver on
> freebsd. It simply does not appear installed.
> 
> $ ogrinfo --formats | grep -i post
>     PGDUMP -vector- (w+v): PostgreSQL SQL dump
> 
> But on my (linux) desktop for instance it does appear:
> 
> $ ogrinfo --formats | ag post
>   PostgreSQL -vector- (rw+): PostgreSQL/PostGIS
>   PGDUMP -vector- (w+v): PostgreSQL SQL dump
> 
> Google has been not very helpful so far.
> I was wondering if anyone here might know something?
> Any help appreciated
> Thanks!
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

From mwtoews at gmail.com  Mon Nov  7 15:10:19 2016
From: mwtoews at gmail.com (Mike Toews)
Date: Tue, 8 Nov 2016 12:10:19 +1300
Subject: [gdal-dev] gdal on freebsd
In-Reply-To: <1916742e-c6f0-ba79-52ea-e1c594937624@mailbox.org>
References: <1916742e-c6f0-ba79-52ea-e1c594937624@mailbox.org>
Message-ID: <CAM2FmMqKtarXWdttP08_7+fFnk+oL-fExPuKRp2VBROy-qhowQ@mail.gmail.com>

On 7 November 2016 at 21:33, Jyrki Von Karkki
<jyrki_von_karkki at mailbox.org> wrote:
> Hi all
>
> I'm having a bit of an issue with the postgresql/postgis driver on freebsd.
> It simply does not appear installed.

How did you install GDAL? The PostgreSQL driver is not always
available since it not compiled by default.

If you are compiling GDAL from source, see --with-pg=ARG from the
configure script. Also be sure to have the development headers for
libpq.

From jyrki_von_karkki at mailbox.org  Mon Nov  7 23:24:05 2016
From: jyrki_von_karkki at mailbox.org (Jyrki Von Karkki)
Date: Tue, 8 Nov 2016 08:24:05 +0100
Subject: [gdal-dev] gdal on freebsd
In-Reply-To: <97e2344fc1e84fbc358dcd1f09a73a7c@hypostasis.com>
References: <1916742e-c6f0-ba79-52ea-e1c594937624@mailbox.org>
 <97e2344fc1e84fbc358dcd1f09a73a7c@hypostasis.com>
Message-ID: <51838c66-cc2c-0e42-dc04-8cc69f6c69b6@mailbox.org>

Thank you both
That will work :)


On 08/11/16 00:10, kit at hypostasis.com wrote:
> cd /usr/ports/graphics/gdal
> make config
> [select the options that you want]
> make install clean
>
> should do the trick
>
> it appears that PostGIS Vector is not part of the default package, but
> is in the port as an option
>
>
>  # ogrinfo --formats | grep -i post
>   PostgreSQL -vector- (rw+): PostgreSQL/PostGIS
>   PGDUMP -vector- (w+v): PostgreSQL SQL dump
>
>
>
> On 2016-11-07 00:33, Jyrki Von Karkki wrote:
>> Hi all
>>
>> I'm having a bit of an issue with the postgresql/postgis driver on
>> freebsd. It simply does not appear installed.
>>
>> $ ogrinfo --formats | grep -i post
>>     PGDUMP -vector- (w+v): PostgreSQL SQL dump
>>
>> But on my (linux) desktop for instance it does appear:
>>
>> $ ogrinfo --formats | ag post
>>   PostgreSQL -vector- (rw+): PostgreSQL/PostGIS
>>   PGDUMP -vector- (w+v): PostgreSQL SQL dump
>>
>> Google has been not very helpful so far.
>> I was wondering if anyone here might know something?
>> Any help appreciated
>> Thanks!
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

From sebastic at xs4all.nl  Tue Nov  8 23:12:16 2016
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Wed, 9 Nov 2016 08:12:16 +0100
Subject: [gdal-dev] DODS driver (packagers recommended to disable it)
Message-ID: <d4c9c576-f859-9bce-5b11-744de6f2d57b@xs4all.nl>

Via Launchpad issue #1640360 [0] I was informed about a segfault in the
DODS driver when fed a JSON URL. In the related IRC discussion packagers
are recommended to disable the DODS driver. [1]

Is the DODS driver so error prone to make this recommendation?

The driver has been enabled for a very long time in the gdal Debian
package, so I'm surprised about the recommendation to disable it now.

The GDAL_SKIP=DODS env var seems like a fine workaround for this
specific issue, since the Launchpad issue is the first to report issues
with it. If the OpenEx function handles other JSON data correctly, and
only fails for the proprietary arcgis service, that doesn't seem like a
good a reason to disable the DODS driver which would disadvantage its users.

[0] https://bugs.launchpad.net/ubuntu/+source/gdal/+bug/1640360
[1] http://irclogs.geoapt.com/osgeo/%23osgeo.2016-11-09.log

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From t.sawka at visimind.pl  Wed Nov  9 00:41:08 2016
From: t.sawka at visimind.pl (Tomasz Sawka)
Date: Wed, 9 Nov 2016 09:41:08 +0100
Subject: [gdal-dev] Geospatial PDF - page size in Adobe Reader
Message-ID: <CABUxgwiep-ryEE31iE05H8uS_2Lfh0=8u-h8ZbLVP1Ttt5UnVg@mail.gmail.com>

Hello

I'm using GDAL 2.1.2 with added patch to PDF driver made by Even Rouault (
https://trac.osgeo.org/gdal/changeset/34856/). I'm trying to correctly
create PDF maps for printing in specified page format and DPI value.

According to this page http://www.papersizes.org/a-sizes-in-pixels.htm I
was preparing raster file in appropriate resolution:
A4 with 72 DPI = 595 x 842
A4 with 300 DPI = 2480 x 3508
A4 with 600 DPI = 4960 x 7016

Then i used CreateCopy  with  DPI value set to desired one and
WRITE_USERUNIT to yes.
When i check created files with gdalinfo all looks fine. The DPI value and
raster size
matches above values.  But when I open files in Adobe Reader the reported
size of page is correct only for 72 DPI. For example:

gdalinfo                                     Adobe Reader
 72 DPI, 595 x 842                    210 x 297 mm
 300 DPI, 2480 x 3508              874.9 x 1 237.5 mm
 600 DPI, 4960 x 7016              1750 x 2 475 mm

I've noticed that the  size reported by Adobe Reader match rule:
DPI / 72 * 210 x DPI / 72 * 297

Now I'm completely confused. Sitting on this subject for few weeks now, any
clues or explanation of this behavior are highly appreciated.

Best regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161109/0531be80/attachment.html>

From even.rouault at spatialys.com  Wed Nov  9 02:03:43 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 9 Nov 2016 11:03:43 +0100
Subject: [gdal-dev] DODS driver (packagers recommended to disable it)
In-Reply-To: <d4c9c576-f859-9bce-5b11-744de6f2d57b@xs4all.nl>
References: <d4c9c576-f859-9bce-5b11-744de6f2d57b@xs4all.nl>
Message-ID: <201611091103.44489.even.rouault@spatialys.com>

Le mercredi 09 novembre 2016 08:12:16, Sebastiaan Couwenberg a écrit :
> Via Launchpad issue #1640360 [0] I was informed about a segfault in the
> DODS driver when fed a JSON URL. In the related IRC discussion packagers
> are recommended to disable the DODS driver. [1]
> 
> Is the DODS driver so error prone to make this recommendation?

Hi Bas,

AFAIR, I hadn't compiled it in years before a few minutes ago (nor can I remember
any question or bug reports related to it in recent time, except crashes or annoyances[1] occuring
with non DODS related URL, hence a sign it might be only of marginal use) and
my past memories with it were not so good when it is fed with "random" URLs. I somehow
remember crashes occuring in libdap itself (perhaps due to how the driver uses it?),
but perhaps the situation in it has improved with more recent versions of libdap.

Here the crash occurred in the GDAL driver code, so I've fixed it per https://trac.osgeo.org/gdal/ticket/6718 /
https://trac.osgeo.org/gdal/changeset/36175, which you might backport in the Debian
package.

Note: I just tried on a valid DODS URL in trunk
http://nomads.ncdc.noaa.gov/dods/NCEP_NAM/subsets/nam_218_winds?ugrd10m[0][y][x]
and it crashed. Appeared to be a trunk-only regression (now fixed) introduced 2 months ago.
So nobody using trunk has used the GDAL DODS driver in the mean time (which probably
doesn't tell much when you multiply low pct of users tracking trunck * low pct of users
using the DODS driver :-))
I also see that the tests in the test suite are skipped since none of the test servers used
seem to be valid anymore.

Even

[1] https://trac.osgeo.org/gdal/ticket/6682

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed Nov  9 02:07:06 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 9 Nov 2016 11:07:06 +0100
Subject: [gdal-dev] Geospatial PDF - page size in Adobe Reader
In-Reply-To: <CABUxgwiep-ryEE31iE05H8uS_2Lfh0=8u-h8ZbLVP1Ttt5UnVg@mail.gmail.com>
References: <CABUxgwiep-ryEE31iE05H8uS_2Lfh0=8u-h8ZbLVP1Ttt5UnVg@mail.gmail.com>
Message-ID: <201611091107.06141.even.rouault@spatialys.com>

Le mercredi 09 novembre 2016 09:41:08, Tomasz Sawka a écrit :
> Hello
> 
> I'm using GDAL 2.1.2 with added patch to PDF driver made by Even Rouault (
> https://trac.osgeo.org/gdal/changeset/34856/). I'm trying to correctly
> create PDF maps for printing in specified page format and DPI value.
> 
> According to this page http://www.papersizes.org/a-sizes-in-pixels.htm I
> was preparing raster file in appropriate resolution:
> A4 with 72 DPI = 595 x 842
> A4 with 300 DPI = 2480 x 3508
> A4 with 600 DPI = 4960 x 7016
> 
> Then i used CreateCopy  with  DPI value set to desired one and
> WRITE_USERUNIT to yes.

As far as I understand the documentation of the option ("When UserUnit is not 
recorded, the printed size will depends on the DPI value."), you should try 
with WRITE_USERUNIT=NO (or not specify it since you specify the DPI value)


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From csbruce at cubewerx.com  Wed Nov  9 09:12:16 2016
From: csbruce at cubewerx.com (Craig Bruce)
Date: Wed, 9 Nov 2016 13:12:16 -0400
Subject: [gdal-dev] GDAL 2.1.2 compilation error
Message-ID: <07d763a8-6d70-4718-ebc4-92830966268d@cubewerx.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161109/c42b7412/attachment.html>

From sebastic at xs4all.nl  Wed Nov  9 11:06:03 2016
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Wed, 9 Nov 2016 20:06:03 +0100
Subject: [gdal-dev] DODS driver (packagers recommended to disable it)
In-Reply-To: <201611091103.44489.even.rouault@spatialys.com>
References: <d4c9c576-f859-9bce-5b11-744de6f2d57b@xs4all.nl>
 <201611091103.44489.even.rouault@spatialys.com>
Message-ID: <a132e765-bcee-86a3-4733-b8ac3b7df100@xs4all.nl>

On 11/09/2016 11:03 AM, Even Rouault wrote:
> Le mercredi 09 novembre 2016 08:12:16, Sebastiaan Couwenberg a écrit :
>> Via Launchpad issue #1640360 [0] I was informed about a segfault in the
>> DODS driver when fed a JSON URL. In the related IRC discussion packagers
>> are recommended to disable the DODS driver. [1]
>>
>> Is the DODS driver so error prone to make this recommendation?
> 
> AFAIR, I hadn't compiled it in years before a few minutes ago (nor can I remember
> any question or bug reports related to it in recent time, except crashes or annoyances[1] occuring
> with non DODS related URL, hence a sign it might be only of marginal use) and
> my past memories with it were not so good when it is fed with "random" URLs. I somehow
> remember crashes occuring in libdap itself (perhaps due to how the driver uses it?),
> but perhaps the situation in it has improved with more recent versions of libdap.
> 
> Here the crash occurred in the GDAL driver code, so I've fixed it per https://trac.osgeo.org/gdal/ticket/6718 /
> https://trac.osgeo.org/gdal/changeset/36175, which you might backport in the Debian
> package.

Thanks for the fix, I've included it as a patch in the Debian package.
That's a much better option than disabling the DODS driver in my opinion
as it avoids an ABI break.

I'll first upload a new gdal revision to Debian before including the
patch in the UbuntuGIS packages too.

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From even.rouault at spatialys.com  Wed Nov  9 12:14:31 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 9 Nov 2016 21:14:31 +0100
Subject: [gdal-dev] GDAL 2.1.2 compilation error
In-Reply-To: <07d763a8-6d70-4718-ebc4-92830966268d@cubewerx.com>
References: <07d763a8-6d70-4718-ebc4-92830966268d@cubewerx.com>
Message-ID: <201611092114.31968.even.rouault@spatialys.com>

Craig,

I've downloaded a Fedora 15 x86_64 DVD iso (setup with Development 
environment) and just tried on GDAL 2.1.2
 ./configure \
          --disable-shared \
          --enable-static \
          --with-pic \
          --without-ld-shared \
          --without-libtool 
and it builds fine. Both with gcc 4.6.0 that comes with the DVD, and 4.6.3 
after the updates.
So it would seem that it is one of the dependency that might cause the issue 
(which seems odd)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From csbruce at cubewerx.com  Thu Nov 10 08:06:53 2016
From: csbruce at cubewerx.com (Craig Bruce)
Date: Thu, 10 Nov 2016 12:06:53 -0400
Subject: [gdal-dev] GDAL 2.1.2 compilation error
In-Reply-To: <201611092114.31968.even.rouault@spatialys.com>
References: <07d763a8-6d70-4718-ebc4-92830966268d@cubewerx.com>
 <201611092114.31968.even.rouault@spatialys.com>
Message-ID: <64fc50c0-c6ad-1c77-ef0c-4f1bee73f188@cubewerx.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161110/5d566462/attachment.html>

From n.rhode at rjm.de  Thu Nov 10 14:09:13 2016
From: n.rhode at rjm.de (Nils Rhode)
Date: Thu, 10 Nov 2016 23:09:13 +0100
Subject: [gdal-dev] gdal2tiles pixel shift in output tiles
Message-ID: <F4BDF018-B7E9-440C-AD37-2B0059723508@rjm.de>


Hi everbody,
 
I would like to calculate large geotiff files (10.000 x 10.000px) with the help of gdal2tiles in little (256x256px) tiles. The process works fine. 
However, the result is not perfect. There is a slight shift in the tiles. I've already tried different resampling methods and get the same result every time.
Here is my statement: Gdal2tiles.py -s EPSG: 25832 -z 11-20 /home/input/file.tif output_path /
 
I think there might be a problem with transforming EPSG:25832 to EPSG:3857 – but if I try to transform with gdalwarp – same problem...
Could it be related to nearblack?
 
Does somebody has any idea?
 
(Image oft he pixel shift: https://i.stack.imgur.com/E7iQO.jpg )
 
 
Thanks a lot,
Nils
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161110/d1ed8148/attachment.html>

From esacree at knology.net  Thu Nov 10 15:48:17 2016
From: esacree at knology.net (esacree)
Date: Thu, 10 Nov 2016 16:48:17 -0700 (MST)
Subject: [gdal-dev] GDAL WMTS Driver - How do you control the Tile
 Matrix Set's Tile Level?
In-Reply-To: <201611072229.10965.even.rouault@spatialys.com>
References: <1478485646278-5294530.post@n6.nabble.com>
 <1478502702743-5294539.post@n6.nabble.com>
 <1478536354582-5294667.post@n6.nabble.com>
 <201611071740.05379.even.rouault@spatialys.com>
 <1478552829988-5294705.post@n6.nabble.com>
 <201611072229.10965.even.rouault@spatialys.com>
Message-ID: <1478821697213-5295238.post@n6.nabble.com>


WMTS request is set up in the XML file. That I posted a few days ago in the
message chain.
The data set rasterio call has width=2048, height=1024, bands=4.

The call to rasterio does take some time.  Acts like it is trying to get the
data.
But the data comes back black (all zeroes).

I have debugged into GDAL 2.1.1 code.  The input data buffer is being
cleared to 0.  The tile data is 256x256 and it is black.  GDAL does not
return an error code.

I used ArcGIS to reproject my LAS data to EPSG:3857 to exactly match the
WMTS image data without needing to reproject the image.  EPSG:3857 WMTS
requested coordinates match LAS data.  Similar WMS data request on these
coordinates works fine.

GDAL code appears to be trying to copy the Tile data at line 352 in
rasterio.cpp function: GDALRasterBand::IRasterIO.
GDAL Code Snippet
    /* type to type conversion */

    if( eRWFlag == GF_Read )
                            
	GDALCopyWords( pabySrcBlock + iSrcOffset,
 eDataType, nBandDataSize,
   
                       ((GByte *) pData) + iBufOffset + (GPtrDiff_t)k *
nLineSpace,

		      eBufType, (int)nPixelSpace, nXSpan );


Question:  Why is the WMTS tile data black?  Why is there no error?


Stack trace in GDALRasterBand::IRasterIO:  Around line 307 in file
rasterio.cpp:

>	gdal201d.dll!GDALRasterBand::IRasterIO(GDALRWFlag eRWFlag, int nXOff, int
nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize,
GDALDataType eBufType, __int64 nPixelSpace, __int64 nLineSpace,
GDALRasterIOExtraArg * psExtraArg) Line 320	C++
 	gdal201d.dll!GDALDataset::BlockBasedRasterIO(GDALRWFlag eRWFlag, int
nXOff, int nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int
nBufYSize, GDALDataType eBufType, int nBandCount, int * panBandMap, __int64
nPixelSpace, __int64 nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg *
psExtraArg) Line 2935	C++
 	gdal201d.dll!GDALDataset::IRasterIO(GDALRWFlag eRWFlag, int nXOff, int
nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize,
GDALDataType eBufType, int nBandCount, int * panBandMap, __int64
nPixelSpace, __int64 nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg *
psExtraArg) Line 1527	C++
 	gdal201d.dll!GDALWMSDataset::IRasterIO(GDALRWFlag rw, int x0, int y0, int
sx, int sy, void * buffer, int bsx, int bsy, GDALDataType bdt, int
band_count, int * band_map, __int64 nPixelSpace, __int64 nLineSpace, __int64
nBandSpace, GDALRasterIOExtraArg * psExtraArg) Line 571	C++
 	gdal201d.dll!GDALDataset::RasterIO(GDALRWFlag eRWFlag, int nXOff, int
nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize,
GDALDataType eBufType, int nBandCount, int * panBandMap, __int64
nPixelSpace, __int64 nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg *
psExtraArg) Line 1997	C++
 	gdal201d.dll!VRTSimpleSource::DatasetRasterIO(int nXOff, int nYOff, int
nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize, GDALDataType
eBufType, int nBandCount, int * panBandMap, __int64 nPixelSpace, __int64
nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg * psExtraArgIn) Line
1411	C++
 	gdal201d.dll!VRTDataset::IRasterIO(GDALRWFlag eRWFlag, int nXOff, int
nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize,
GDALDataType eBufType, int nBandCount, int * panBandMap, __int64
nPixelSpace, __int64 nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg *
psExtraArg) Line 1517	C++
 	gdal201d.dll!GDALDataset::RasterIO(GDALRWFlag eRWFlag, int nXOff, int
nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize,
GDALDataType eBufType, int nBandCount, int * panBandMap, __int64
nPixelSpace, __int64 nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg *
psExtraArg) Line 1997	C++
 	gdal201d.dll!WMTSDataset::IRasterIO(GDALRWFlag eRWFlag, int nXOff, int
nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize,
GDALDataType eBufType, int nBandCount, int * panBandMap, __int64
nPixelSpace, __int64 nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg *
psExtraArg) Line 484	C++
 	gdal201d.dll!GDALDataset::RasterIO(GDALRWFlag eRWFlag, int nXOff, int
nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize,
GDALDataType eBufType, int nBandCount, int * panBandMap, __int64
nPixelSpace, __int64 nLineSpace, __int64 nBandSpace, GDALRasterIOExtraArg *
psExtraArg) Line 1997	C++
 	LASSymbols.dll!LayerUpdateProc(void * lpParameter) Line 2179	C++




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/GDAL-WMTS-Driver-How-do-you-control-the-Tile-Matrix-Set-s-Tile-Level-tp5294530p5295238.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From issworld2000 at yahoo.com  Fri Nov 11 05:14:58 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 11 Nov 2016 13:14:58 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
References: <617222265.2072385.1478870098129.ref@mail.yahoo.com>
Message-ID: <617222265.2072385.1478870098129@mail.yahoo.com>

Hello,

I am converting an .osm file to .shp files by using ogr2ogr.exe with the following syntax:


ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" output.shp input.os


In what way should I change the upper "config" syntax so that the "building:..." keys (fields) are always replaced with: "bldg:..."?

For example I would like to have all of these keys:   "building:use", "building:level", "building:color"be converted to:   "bldg:use", "bldg:level", "bldg:color"But the "building" key, should remain "building". It should not be changed.

How can I do this with ogr2ogr.exe?

I assume that there might be some other application which is able to do this, but I would like to know how to do it with ogr2ogr.exe.

I would welcome any kind of advice.
Thank you.


Djordje Spasic
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/935a16d2/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 11 05:36:30 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 11 Nov 2016 06:36:30 -0700 (MST)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <617222265.2072385.1478870098129@mail.yahoo.com>
References: <617222265.2072385.1478870098129@mail.yahoo.com>
Message-ID: <1478871390885-5295342.post@n6.nabble.com>

Hi,

You can rename the fields with SQL

ogrinfo -dialect sqlite -sql "select geometry, building as bldg 
from multipolygons" hamburg-latest.osm.pbf

....
Geometry Column = GEOMETRY
bldg: String (0.0)
....

Slight drawback is that you must include all the attributes in SELECT but
you can save the command into text file for reuse.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-How-to-replace-an-osm-key-tp5295339p5295342.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From issworld2000 at yahoo.com  Fri Nov 11 05:50:34 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 11 Nov 2016 13:50:34 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <1478871390885-5295342.post@n6.nabble.com>
References: <617222265.2072385.1478870098129@mail.yahoo.com>
 <1478871390885-5295342.post@n6.nabble.com>
Message-ID: <986482274.2093583.1478872234371@mail.yahoo.com>

Hi Jukka,

Thank you for the quick and informative reply!
But I am not sure I understood you.

So first I need to convert the .osm file to .shp files with ogr2ogr.exe
And then I am calling the ogrinfo.exe on specific .shp file (multipolygons.dbf ?)

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" output.shp input.osm
ogrinfo.exe -dialect sqlite -sql "select geometry, building as bldg 
from output.shp/multipolygons.dbf" input.osm.pbf

? 

    On Friday, November 11, 2016 2:36 PM, jratike80 <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 

 Hi,

You can rename the fields with SQL

ogrinfo -dialect sqlite -sql "select geometry, building as bldg 
from multipolygons" hamburg-latest.osm.pbf

....
Geometry Column = GEOMETRY
bldg: String (0.0)
....

Slight drawback is that you must include all the attributes in SELECT but
you can save the command into text file for reuse.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-How-to-replace-an-osm-key-tp5295339p5295342.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman/listinfo/gdal-dev

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/09eb27a5/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 11 06:14:29 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 11 Nov 2016 14:14:29 +0000
Subject: [gdal-dev] How to replace an osm key?
Message-ID: <dc43515442754b55ab66118bc62936c7@C119S212VM022.msvyvi.vaha.local>

Hi,

Ogrinfo and ogr2ogr usually accept the same syntax and therefore I gave the ogrinfo example. I apologize, it can’t be self-evident for all GDAL users.

You can do the whole thing with one command like this:

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile"
-dialect sqlite –sql "select geometry, building as bldg from multipolygons” output.shp input.osm

You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …” and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons).

-Jukka Rahkonen-



Djordje Spasic wrote:

Hi Jukka,

Thank you for the quick and informative reply!

But I am not sure I understood you.

So first I need to convert the .osm file to .shp files with ogr2ogr.exe
And then I am calling the ogrinfo.exe on specific .shp file (multipolygons.dbf ?)

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" output.shp input.osm

ogrinfo.exe -dialect sqlite -sql "select geometry, building as bldg
from output.shp/multipolygons.dbf" input.osm.pbf

?

On Friday, November 11, 2016 2:36 PM, jratike80 <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:

Hi,

You can rename the fields with SQL

ogrinfo -dialect sqlite -sql "select geometry, building as bldg
from multipolygons" hamburg-latest.osm.pbf

....
Geometry Column = GEOMETRY
bldg: String (0.0)
....

Slight drawback is that you must include all the attributes in SELECT but
you can save the command into text file for reuse.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-How-to-replace-an-osm-key-tp5295339p5295342.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/a6ab5105/attachment-0001.html>

From issworld2000 at yahoo.com  Fri Nov 11 06:38:23 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 11 Nov 2016 14:38:23 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <dc43515442754b55ab66118bc62936c7@C119S212VM022.msvyvi.vaha.local>
References: <dc43515442754b55ab66118bc62936c7@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1547450815.2141428.1478875103326@mail.yahoo.com>

 Thank you for the reply Jukka.


> and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons).
What does this part mean?
That I need to call ogr2ogr.exe four times:
ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multipolygons” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from points” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from lines” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multilinestrings” output.shp input.osm
?
Doesn't "building:..." key (field) only exist among the multipolygons?




> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
I didn't understand you this part either.

The "select geometry, building as bldg, another_attribute as attr_2 …” part needs to include only those keys (fields) which I would like to get changed? Not all the others which I would like to have them remain the same as in original .osm file?

If I misunderstood you, can you please provide an example syntax?

Thank you, and my apology for further disturbance.

Djordje


----------------    On Friday, November 11, 2016 3:14 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 
 #yiv4201955791 #yiv4201955791 -- _filtered #yiv4201955791 {font-family:Helvetica;panose-1:2 11 6 4 2 2 2 2 2 4;} _filtered #yiv4201955791 {panose-1:2 4 5 3 5 4 6 3 2 4;} _filtered #yiv4201955791 {font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;} _filtered #yiv4201955791 {font-family:Verdana;panose-1:2 11 6 4 3 5 4 4 2 4;}#yiv4201955791 #yiv4201955791 p.yiv4201955791MsoNormal, #yiv4201955791 li.yiv4201955791MsoNormal, #yiv4201955791 div.yiv4201955791MsoNormal {margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;}#yiv4201955791 a:link, #yiv4201955791 span.yiv4201955791MsoHyperlink {color:blue;text-decoration:underline;}#yiv4201955791 a:visited, #yiv4201955791 span.yiv4201955791MsoHyperlinkFollowed {color:purple;text-decoration:underline;}#yiv4201955791 span.yiv4201955791Shkpostityyli17 {color:#1F497D;}#yiv4201955791 .yiv4201955791MsoChpDefault {font-size:10.0pt;} _filtered #yiv4201955791 {margin:70.85pt 2.0cm 70.85pt 2.0cm;}#yiv4201955791 div.yiv4201955791WordSection1 {}#yiv4201955791 Hi,    Ogrinfo and ogr2ogr usually accept the same syntax and therefore I gave the ogrinfo example. I apologize, it can’t be self-evident for all GDAL users.    You can do the whole thing with one command like this:    ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multipolygons” output.shp input.osm    You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …” and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons).    -Jukka Rahkonen- 

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/fae82303/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 11 07:04:22 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 11 Nov 2016 15:04:22 +0000
Subject: [gdal-dev] How to replace an osm key?
Message-ID: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>

Hi,

“Building” tag can exist in any layer. It is controlled with the osmconf.ini file https://svn.osgeo.org/gdal/trunk/gdal/data/osmconf.ini

It is true that by default it is selected only for multipolygons. However, I suppose that in the native OSM data the building tag is sometimes used also on points and relations (other_relations for GDAL). I also aimed at a general answer that could be useful for all tags and layers in OSM data.

-Jukka Rahkonen-

Lähettäjä: Djordje Spasic [mailto:issworld2000 at yahoo.com]
Lähetetty: 11. marraskuuta 2016 16:38
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] How to replace an osm key?

Thank you for the reply Jukka.

> and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons).
What does this part mean?
That I need to call ogr2ogr.exe four times:
ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multipolygons” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from points” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from lines” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multilinestrings” output.shp input.osm
?
Doesn't "building:..." key (field) only exist among the multipolygons?



> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
I didn't understand you this part either.

The "select geometry, building as bldg, another_attribute as attr_2 …” part needs to include only those keys (fields) which I would like to get changed? Not all the others which I would like to have them remain the same as in original .osm file?

If I misunderstood you, can you please provide an example syntax?

Thank you, and my apology for further disturbance.

Djordje


----------------
On Friday, November 11, 2016 3:14 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:

Hi,

Ogrinfo and ogr2ogr usually accept the same syntax and therefore I gave the ogrinfo example. I apologize, it can’t be self-evident for all GDAL users.

You can do the whole thing with one command like this:

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile"
-dialect sqlite –sql "select geometry, building as bldg from multipolygons” output.shp input.osm

You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …” and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons).

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/16873aa0/attachment-0001.html>

From dmorissette at mapgears.com  Fri Nov 11 07:35:15 2016
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Fri, 11 Nov 2016 10:35:15 -0500
Subject: [gdal-dev] Planning code sprint in Daytona Beach,
 FL (please vote on dates if interested)
Message-ID: <98f4decf-0919-83c6-b879-69819f1f3162@mapgears.com>

(I apologize in advance for the cross-posting.)

We are considering holding the annual "C Tribe" Code Sprint in Daytona 
Beach, FL and are currently considering two dates.

If you are interested in attending, then please confirm your interest 
and the dates that work for you in this Doodle. We will keep the doodle 
open until early next week:

http://doodle.com/poll/vyyew4ibbwcdp6ka

You can find out more about the plan as it evolves in the wiki:

https://wiki.osgeo.org/wiki/Daytona_Beach_Code_Sprint_2017

and follow the full discussion on the "tosprint" list:

https://lists.osgeo.org/pipermail/tosprint/2016-November/000644.html


* Note that the "C Tribe Sprint" is labelled this way only for 
historical reasons since and is really open to all "tribes". The goal is 
cross-project collaboration and all OSGeo projects are invited.

Daniel

From landa.martin at gmail.com  Fri Nov 11 07:53:02 2016
From: landa.martin at gmail.com (Martin Landa)
Date: Fri, 11 Nov 2016 16:53:02 +0100
Subject: [gdal-dev] ogr2ogr PG->SHP lacks EPSG code
Message-ID: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>

Hi,

when trying to convert PostGIS data to Shapefiles I discovered strange
issue. Input data:

ogrinfo "PG:dbname=gismentors" ruian.kraje  -so
..
Layer SRS WKT:
PROJCS["S-JTSK / Krovak East North",
    GEOGCS["S-JTSK",
        DATUM["System_Jednotne_Trigonometricke_Site_Katastralni",
            SPHEROID["Bessel 1841",6377397.155,299.1528128,
                AUTHORITY["EPSG","7004"]],
            TOWGS84[570.8,85.7,462.8,4.998,1.587,5.261,3.56],
            AUTHORITY["EPSG","6156"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4156"]],
    PROJECTION["Krovak"],
    AUTHORITY["EPSG","5514"]]
...

After conversion done by:

ogr2ogr -f 'ESRI Shapefile' -lco 'ENCODING=UTF-8' kraje.shp
"PG:dbname=gismentors" ruian.kraje

EPSG codes (5514) disappears:

ogrinfo  kraje.shp kraje -so
...
Layer SRS WKT:
PROJCS["S_JTSK_Krovak_East_North",
    GEOGCS["GCS_S-JTSK",
        DATUM["System_Jednotne_Trigonometricke_Site_Katastralni",
            SPHEROID["Bessel_1841",6377397.155,299.1528128]],
        PRIMEM["Greenwich",0],
        UNIT["Degree",0.017453292519943295]],
    PROJECTION["Krovak"],
    PARAMETER["latitude_of_center",49.5],
    PARAMETER["longitude_of_center",24.83333333333333],
    PARAMETER["azimuth",30.28813972222222],
    PARAMETER["pseudo_standard_parallel_1",78.5],
    PARAMETER["scale_factor",0.9999],
    PARAMETER["false_easting",0],
    PARAMETER["false_northing",0],
    UNIT["Meter",1]]

Any idea what could be wrong? Thanks! Martin

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From esacree at knology.net  Fri Nov 11 08:11:21 2016
From: esacree at knology.net (esacree)
Date: Fri, 11 Nov 2016 09:11:21 -0700 (MST)
Subject: [gdal-dev] Can GDAL WMS driver still access Google Maps and
 VirtualEarth (Bing)?
Message-ID: <1478880681620-5295373.post@n6.nabble.com>


Are the GDAL WMS documented examples for the Google and VirtualEarth tile
servers still correct?

Both Google and VirtualEarth documentation say you have to get a key.  It
looks like things have changed since the GDAL WMS documentation was written
for Google and VirtualEarth.

Thanks in advance for any information!

Elaine




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Can-GDAL-WMS-driver-still-access-Google-Maps-and-VirtualEarth-Bing-tp5295373.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From issworld2000 at yahoo.com  Fri Nov 11 09:07:24 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 11 Nov 2016 17:07:24 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>
References: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1904180681.2248334.1478884044435@mail.yahoo.com>

Thank you Jukka.

I understand now why I need to repeat the same syntax 4 times (by only changing multipolygon/multilinestrings/lines/points).



Can you explain this part as well please:

> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
?


----------------
    On Friday, November 11, 2016 4:04 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 
Hi,    “Building” tag can exist in any layer. It is controlled with the osmconf.ini filehttps://svn.osgeo.org/gdal/trunk/gdal/data/osmconf.ini    It is true that by default it is selected only for multipolygons. However, I suppose that in the native OSM data the building tag is sometimes used also on points and relations (other_relations for GDAL). I also aimed at a general answer that could be useful for all tags and layers in OSM data.    -Jukka Rahkonen-    Lähettäjä: Djordje Spasic [mailto:issworld2000 at yahoo.com]
Lähetetty: 11. marraskuuta 2016 16:38
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] How to replace an osm key?    Thank you for the reply Jukka.    
> and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons). 
What does this part mean?
That I need to call ogr2ogr.exe four times: 
ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multipolygons” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg frompoints” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg fromlines” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg frommultilinestrings” output.shp input.osm 
? Doesn't "building:..." key (field) only exist among the multipolygons?          
> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …” 
I didn't understand you this part either.

The "select geometry, building as bldg, another_attribute as attr_2 …” part needs to include only those keys (fields) which I would like to get changed? Not all the others which I would like to have them remain the same as in original .osm file?

If I misunderstood you, can you please provide an example syntax?

Thank you, and my apology for further disturbance.

Djordje    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/5d3762c4/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 11 09:46:46 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 11 Nov 2016 17:46:46 +0000
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <1904180681.2248334.1478884044435@mail.yahoo.com>
References: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>,
 <1904180681.2248334.1478884044435@mail.yahoo.com>
Message-ID: <8371443d7d1b4bf8b782dcf8254a7e3e@C119S212VM022.msvyvi.vaha.local>

Hi,

If you select geometry and attribute "foo" that's all you get. If you want attribute "bar" as well you must do "select geometry,foo,bar from your_table". That is plain SQL, you will find tutorials from the web.

-Jukka-
________________________________
Lähettäjä: Djordje Spasic<mailto:issworld2000 at yahoo.com>
Lähetetty: ‎11.‎11.‎2016 19:10
Vastaanottaja: Rahkonen Jukka (MML)<mailto:jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] How to replace an osm key?

Thank you Jukka.

I understand now why I need to repeat the same syntax 4 times (by only changing multipolygon/multilinestrings/lines/points).



Can you explain this part as well please:
> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
?


----------------
On Friday, November 11, 2016 4:04 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:

Hi,

“Building” tag can exist in any layer. It is controlled with the osmconf.ini file https://svn.osgeo.org/gdal/trunk/gdal/data/osmconf.ini

It is true that by default it is selected only for multipolygons. However, I suppose that in the native OSM data the building tag is sometimes used also on points and relations (other_relations for GDAL). I also aimed at a general answer that could be useful for all tags and layers in OSM data.

-Jukka Rahkonen-

Lähettäjä: Djordje Spasic [mailto:issworld2000 at yahoo.com]
Lähetetty: 11. marraskuuta 2016 16:38
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] How to replace an osm key?

Thank you for the reply Jukka.

> and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons).
What does this part mean?
That I need to call ogr2ogr.exe four times:
ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multipolygons” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from points” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from lines” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg from multilinestrings” output.shp input.osm
?
Doesn't "building:..." key (field) only exist among the multipolygons?



> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
I didn't understand you this part either.

The "select geometry, building as bldg, another_attribute as attr_2 …” part needs to include only those keys (fields) which I would like to get changed? Not all the others which I would like to have them remain the same as in original .osm file?

If I misunderstood you, can you please provide an example syntax?

Thank you, and my apology for further disturbance.

Djordje
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/c7eccac9/attachment-0001.html>

From even.rouault at spatialys.com  Fri Nov 11 09:56:37 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 11 Nov 2016 18:56:37 +0100
Subject: [gdal-dev] ogr2ogr PG->SHP lacks EPSG code
In-Reply-To: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>
References: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>
Message-ID: <201611111856.37508.even.rouault@spatialys.com>

Le vendredi 11 novembre 2016 16:53:02, Martin Landa a écrit :
> Hi,
> 
> when trying to convert PostGIS data to Shapefiles I discovered strange
> issue. Input data:
> 
> ogrinfo "PG:dbname=gismentors" ruian.kraje  -so
> ..
> Layer SRS WKT:
> PROJCS["S-JTSK / Krovak East North",
>     GEOGCS["S-JTSK",
>         DATUM["System_Jednotne_Trigonometricke_Site_Katastralni",
>             SPHEROID["Bessel 1841",6377397.155,299.1528128,
>                 AUTHORITY["EPSG","7004"]],
>             TOWGS84[570.8,85.7,462.8,4.998,1.587,5.261,3.56],
>             AUTHORITY["EPSG","6156"]],
>         PRIMEM["Greenwich",0,
>             AUTHORITY["EPSG","8901"]],
>         UNIT["degree",0.0174532925199433,
>             AUTHORITY["EPSG","9122"]],
>         AUTHORITY["EPSG","4156"]],
>     PROJECTION["Krovak"],
>     AUTHORITY["EPSG","5514"]]
> ...
> 
> After conversion done by:
> 
> ogr2ogr -f 'ESRI Shapefile' -lco 'ENCODING=UTF-8' kraje.shp
> "PG:dbname=gismentors" ruian.kraje
> 
> EPSG codes (5514) disappears:
> 
> ogrinfo  kraje.shp kraje -so
> ...
> Layer SRS WKT:
> PROJCS["S_JTSK_Krovak_East_North",
>     GEOGCS["GCS_S-JTSK",
>         DATUM["System_Jednotne_Trigonometricke_Site_Katastralni",
>             SPHEROID["Bessel_1841",6377397.155,299.1528128]],
>         PRIMEM["Greenwich",0],
>         UNIT["Degree",0.017453292519943295]],
>     PROJECTION["Krovak"],
>     PARAMETER["latitude_of_center",49.5],
>     PARAMETER["longitude_of_center",24.83333333333333],
>     PARAMETER["azimuth",30.28813972222222],
>     PARAMETER["pseudo_standard_parallel_1",78.5],
>     PARAMETER["scale_factor",0.9999],
>     PARAMETER["false_easting",0],
>     PARAMETER["false_northing",0],
>     UNIT["Meter",1]]
> 
> Any idea what could be wrong? Thanks! Martin

The WKT variant of ESRI Shapefile .prj doesn't have EPSG codes (nor TOWGS84 
node by the way). At least that was how it was historically and GDAL "morphs" 
OGC WKT to ESRI WKT this way (there are other variations in names of 
projection methods and parameters). Regarding the EPSG code, for some reason, 
I believe this might perhaps have changed in recent ArcGIS versions but I'm 
not sure. Perhaps someone could confirm


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From issworld2000 at yahoo.com  Fri Nov 11 09:55:34 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 11 Nov 2016 17:55:34 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <8371443d7d1b4bf8b782dcf8254a7e3e@C119S212VM022.msvyvi.vaha.local>
References: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>
 <1904180681.2248334.1478884044435@mail.yahoo.com>
 <8371443d7d1b4bf8b782dcf8254a7e3e@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1608514955.2280872.1478886934792@mail.yahoo.com>

Thank you Jukka.

Does this:

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg, foo, bar from multipolygons” output.shp input.osm
replace the part from the osmconfig.ini file:

# keys to report as OGR fields
attributes=building,foo,bar

?
 
----------------------------
    On Friday, November 11, 2016 6:46 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 

 Hi,

If you select geometry and attribute "foo" that's all you get. If you want attribute "bar" as well you must do "select geometry,foo,bar from your_table". That is plain SQL, you will find tutorials from the web.

-Jukka-
Lähettäjä:Djordje Spasic
Lähetetty:‎11.‎11.‎2016 19:10
Vastaanottaja:Rahkonen Jukka (MML);gdal-dev at lists.osgeo.org
Aihe:Re: [gdal-dev] How to replace an osm key?

Thank you Jukka.

I understand now why I need to repeat the same syntax 4 times (by only changing multipolygon/multilinestrings/lines/points).



Can you explain this part as well please:

> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
?


----------------


   On Friday, November 11, 2016 4:04 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:

Hi, “Building” tag can exist in any layer. It is controlled with the osmconf.ini filehttps://svn.osgeo.org/gdal/trunk/gdal/data/osmconf.ini It is true that by default it is selected only for multipolygons. However, I suppose that in the native OSM data the building tag is sometimes used also on points and relations (other_relations for GDAL). I also aimed at a general answer that could be useful for all tags and layers in OSM data. -Jukka Rahkonen- Lähettäjä: Djordje Spasic [mailto:issworld2000 at yahoo.com]
Lähetetty: 11. marraskuuta 2016 16:38
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] How to replace an osm key? Thank you for the reply Jukka. 
> and you must run the query separately for all the layers ( points, lines, multilinestrings, multipolygons).
What does this part mean?
That I need to call ogr2ogr.exe four times:
ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg frommultipolygons” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg frompoints” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg fromlines” output.shp input.osm

ogr2ogr.exe --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite –sql "select geometry, building as bldg frommultilinestrings” output.shp input.osm
?Doesn't "building:..." key (field) only exist among the multipolygons?   
> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
I didn't understand you this part either.

The "select geometry, building as bldg, another_attribute as attr_2 …” part needs to include only those keys (fields) which I would like to get changed? Not all the others which I would like to have them remain the same as in original .osm file?

If I misunderstood you, can you please provide an example syntax?

Thank you, and my apology for further disturbance.

Djordje
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161111/3af095c0/attachment.html>

From issworld2000 at yahoo.com  Fri Nov 11 17:34:20 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Sat, 12 Nov 2016 01:34:20 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <1608514955.2280872.1478886934792@mail.yahoo.com>
References: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>
 <1904180681.2248334.1478884044435@mail.yahoo.com>
 <8371443d7d1b4bf8b782dcf8254a7e3e@C119S212VM022.msvyvi.vaha.local>
 <1608514955.2280872.1478886934792@mail.yahoo.com>
Message-ID: <2032630375.2523733.1478914460099@mail.yahoo.com>

 Hi Jukka,

I have just tried to rename the fields with SQL. Here is the syntax:
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite -sql "select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons" output_shps input.osm
It raises the following error message:
ERROR 1: In ExecutableSQL<>: sqlite3_prepare<select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons>:
no such column: height

Interestingly when I convert an .osm file to .shp files without using the SQL syntax, then the multipolygons.shp file does contain the "height" field. Not all shapes inside it contain it, but some do.

So why is the upper "no such column: height" error message raised?

Is something wrong with the SQL syntax?

Thank you for the reply.

Kind regards,
Djordje

----------------------------


    On Friday, November 11, 2016 6:46 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 

 Hi,

If you select geometry and attribute "foo" that's all you get. If you want attribute "bar" as well you must do "select geometry,foo,bar from your_table". That is plain SQL, you will find tutorials from the web.

-Jukka-
Lähettäjä:Djordje Spasic
Lähetetty:‎11.‎11.‎2016 19:10
Vastaanottaja:Rahkonen Jukka (MML);gdal-dev at lists.osgeo.org
Aihe:Re: [gdal-dev] How to replace an osm key?

Thank you Jukka.

I understand now why I need to repeat the same syntax 4 times (by only changing multipolygon/multilinestrings/lines/points).



Can you explain this part as well please:

> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
?


   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161112/0133163e/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Sat Nov 12 01:29:18 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Sat, 12 Nov 2016 09:29:18 +0000
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <2032630375.2523733.1478914460099@mail.yahoo.com>
References: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>
 <1904180681.2248334.1478884044435@mail.yahoo.com>
 <8371443d7d1b4bf8b782dcf8254a7e3e@C119S212VM022.msvyvi.vaha.local>
 <1608514955.2280872.1478886934792@mail.yahoo.com>,
 <2032630375.2523733.1478914460099@mail.yahoo.com>
Message-ID: <63b9512f1fa94d1c892aed87fc707896@C119S212VM022.msvyvi.vaha.local>

Hi,

Related to your previous question, you can use SQL select only for fields which are included in osmconf.ini. Perhaps "height" is not. 'building:levels' may make a surprise for you, if ogr2ogr follows SQL specification it will select a fixed string. You should use double quotes instead and they may require escaping but I do not remember with which character. Start with easy test and more attributes with odd names one by one.

-Jukka-
________________________________
Lähettäjä: Djordje Spasic<mailto:issworld2000 at yahoo.com>
Lähetetty: ‎12.‎11.‎2016 3:37
Vastaanottaja: Rahkonen Jukka (MML)<mailto:jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: VS: [gdal-dev] How to replace an osm key?

Hi Jukka,

I have just tried to rename the fields with SQL. Here is the syntax:
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite -sql "select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons" output_shps input.osm
It raises the following error message:
ERROR 1: In ExecutableSQL<>: sqlite3_prepare<select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons>:
no such column: height
Interestingly when I convert an .osm file to .shp files without using the SQL syntax, then the multipolygons.shp file does contain the "height" field. Not all shapes inside it contain it, but some do.

So why is the upper "no such column: height" error message raised?

Is something wrong with the SQL syntax?

Thank you for the reply.

Kind regards,
Djordje

----------------------------


On Friday, November 11, 2016 6:46 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:


Hi,

If you select geometry and attribute "foo" that's all you get. If you want attribute "bar" as well you must do "select geometry,foo,bar from your_table". That is plain SQL, you will find tutorials from the web.

-Jukka-
________________________________
Lähettäjä: Djordje Spasic<mailto:issworld2000 at yahoo.com>
Lähetetty: ‎11.‎11.‎2016 19:10
Vastaanottaja: Rahkonen Jukka (MML)<mailto:jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] How to replace an osm key?

Thank you Jukka.

I understand now why I need to repeat the same syntax 4 times (by only changing multipolygon/multilinestrings/lines/points).



Can you explain this part as well please:
> You must edit the SQL parameter to include all the fields that you want to get into the result  "select geometry, building as bldg, another_attribute as attr_2 …”
?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161112/7106afb1/attachment-0001.html>

From issworld2000 at yahoo.com  Sat Nov 12 02:24:27 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Sat, 12 Nov 2016 10:24:27 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <63b9512f1fa94d1c892aed87fc707896@C119S212VM022.msvyvi.vaha.local>
References: <04834a7705af4ca0aea73a61c1700800@C119S212VM022.msvyvi.vaha.local>
 <1904180681.2248334.1478884044435@mail.yahoo.com>
 <8371443d7d1b4bf8b782dcf8254a7e3e@C119S212VM022.msvyvi.vaha.local>
 <1608514955.2280872.1478886934792@mail.yahoo.com>
 <2032630375.2523733.1478914460099@mail.yahoo.com>
 <63b9512f1fa94d1c892aed87fc707896@C119S212VM022.msvyvi.vaha.local>
Message-ID: <162823971.2649397.1478946267916@mail.yahoo.com>

Thank you for the reply Jukka.

Neither "building:levels" nor "height" fields were located in osmconf.ini under the "[multipolygons]".
I have just added them as you suggested, and now the previously mentioned command creates the .shp file without raising an error.I tried the initial:

-dialect sqlite -sql "select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons" "C:\ladybug\osm_files\barcelona_shp_files" 

and
-dialect sqlite -sql "select geometry, building as bldg, \"building:levels\" as bldg_level, height as height from multipolygons" "C:\ladybug\osm_files\barcelona_shp_files" 

And they both work.
The problem is that: once the .shp file is created, and I open it, all shapes have the "building:level" value for the "bldg_level" field. Here is a screenshot:
https://www.dropbox.com/s/nmlkkzr85w225qb/sql_choosing_keys.jpg?dl=0

Why is this happening?

Kind Regards,
Djordje

-----------------------


    On Saturday, November 12, 2016 10:29 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 

 Hi,

Related to your previous question, you can use SQL select only for fields which are included in osmconf.ini. Perhaps "height" is not. 'building:levels' may make a surprise for you, if ogr2ogr follows SQL specification it will select a fixed string. You should use double quotes instead and they may require escaping but I do not remember with which character. Start with easy test and more attributes with odd names one by one.

-Jukka-
Lähettäjä:Djordje Spasic
Lähetetty:‎12.‎11.‎2016 3:37
Vastaanottaja:Rahkonen Jukka (MML);gdal-dev at lists.osgeo.org
Aihe:Re: VS: [gdal-dev] How to replace an osm key?

Hi Jukka,

I have just tried to rename the fields with SQL. Here is the syntax:
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile"-dialect sqlite -sql "select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons" output_shps input.osm
It raises the following error message:
ERROR 1: In ExecutableSQL<>: sqlite3_prepare<select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons>:
no such column: height

Interestingly when I convert an .osm file to .shp files without using the SQL syntax, then the multipolygons.shp file does contain the "height" field. Not all shapes inside it contain it, but some do.

So why is the upper "no such column: height" error message raised?

Is something wrong with the SQL syntax?

Thank you for the reply.

Kind regards,
Djordje   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161112/e1118d6f/attachment.html>

From landa.martin at gmail.com  Sat Nov 12 14:27:30 2016
From: landa.martin at gmail.com (Martin Landa)
Date: Sat, 12 Nov 2016 23:27:30 +0100
Subject: [gdal-dev] ogr2ogr PG->SHP lacks EPSG code
In-Reply-To: <201611111856.37508.even.rouault@spatialys.com>
References: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>
 <201611111856.37508.even.rouault@spatialys.com>
Message-ID: <CA+Ei1Oe7eqP3MojkDyvae0gw2=a4u2iaJsi47nGVKO7FXLNvOA@mail.gmail.com>

Hi,

2016-11-11 18:56 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:
> The WKT variant of ESRI Shapefile .prj doesn't have EPSG codes (nor TOWGS84
> node by the way). At least that was how it was historically and GDAL "morphs"
> OGC WKT to ESRI WKT this way (there are other variations in names of
> projection methods and parameters). Regarding the EPSG code, for some reason,
> I believe this might perhaps have changed in recent ArcGIS versions but I'm
> not sure. Perhaps someone could confirm

you are right, EPSG codes are missing when producing SHP in ArcGIS
(tested 10.4 version) [1]. The problem is that such Shapefiles are not
recognized by QGIS as EPSG 5514 (QGIS shows user-defined SRS 1000).
Any idea? Thanks, Martin

[1] http://147.32.131.147/landa/Export_Output.prj.txt

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From hellik at web.de  Sat Nov 12 16:19:09 2016
From: hellik at web.de (Helmut Kudrnovsky)
Date: Sat, 12 Nov 2016 17:19:09 -0700 (MST)
Subject: [gdal-dev] ogr2ogr PG->SHP lacks EPSG code
In-Reply-To: <CA+Ei1Oe7eqP3MojkDyvae0gw2=a4u2iaJsi47nGVKO7FXLNvOA@mail.gmail.com>
References: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>
 <201611111856.37508.even.rouault@spatialys.com>
 <CA+Ei1Oe7eqP3MojkDyvae0gw2=a4u2iaJsi47nGVKO7FXLNvOA@mail.gmail.com>
Message-ID: <1478996349570-5295464.post@n6.nabble.com>

Martin Landa wrote
> Hi,
> 
> 2016-11-11 18:56 GMT+01:00 Even Rouault &lt;

> even.rouault@

> &gt;:
>> The WKT variant of ESRI Shapefile .prj doesn't have EPSG codes (nor
>> TOWGS84
>> node by the way). At least that was how it was historically and GDAL
>> "morphs"
>> OGC WKT to ESRI WKT this way (there are other variations in names of
>> projection methods and parameters). Regarding the EPSG code, for some
>> reason,
>> I believe this might perhaps have changed in recent ArcGIS versions but
>> I'm
>> not sure. Perhaps someone could confirm
> 
> you are right, EPSG codes are missing when producing SHP in ArcGIS
> (tested 10.4 version) [1]. The problem is that such Shapefiles are not
> recognized by QGIS as EPSG 5514 (QGIS shows user-defined SRS 1000).
> Any idea? Thanks, Martin
> 
> [1] http://147.32.131.147/landa/Export_Output.prj.txt

the same can be often observed for srs used in Austria that aren't be
recognized by QGIS cause of a "missing" EPSG code. 




-----
best regards
Helmut
--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-ogr2ogr-PG-SHP-lacks-EPSG-code-tp5295371p5295464.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Sun Nov 13 04:29:33 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 13 Nov 2016 13:29:33 +0100
Subject: [gdal-dev] ogr2ogr PG->SHP lacks EPSG code
In-Reply-To: <CA+Ei1Oe7eqP3MojkDyvae0gw2=a4u2iaJsi47nGVKO7FXLNvOA@mail.gmail.com>
References: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>
 <201611111856.37508.even.rouault@spatialys.com>
 <CA+Ei1Oe7eqP3MojkDyvae0gw2=a4u2iaJsi47nGVKO7FXLNvOA@mail.gmail.com>
Message-ID: <201611131329.34162.even.rouault@spatialys.com>

Le samedi 12 novembre 2016 23:27:30, Martin Landa a écrit :
> Hi,
> 
> 2016-11-11 18:56 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:
> > The WKT variant of ESRI Shapefile .prj doesn't have EPSG codes (nor
> > TOWGS84 node by the way). At least that was how it was historically and
> > GDAL "morphs" OGC WKT to ESRI WKT this way (there are other variations
> > in names of projection methods and parameters). Regarding the EPSG code,
> > for some reason, I believe this might perhaps have changed in recent
> > ArcGIS versions but I'm not sure. Perhaps someone could confirm
> 
> you are right, EPSG codes are missing when producing SHP in ArcGIS
> (tested 10.4 version) [1]. The problem is that such Shapefiles are not
> recognized by QGIS as EPSG 5514 (QGIS shows user-defined SRS 1000).
> Any idea? Thanks, Martin

Probably because of the missing TOWGS84 node in the ESRI WKT:

$ gdalsrsinfo ESRI::Export_Output.prj.txt

PROJ.4 : '+proj=krovak +lat_0=49.5 +lon_0=24.83333333333333 
+alpha=30.28813975277778 +k=0.9999 +x_0=0 +y_0=0 +ellps=bessel +units=m 
+no_defs '

versus the srs.db in QGIS resources has

$ ogrinfo resources/srs.db -sql "select parameters from tbl_srs where 
srid=5514" -q

Layer name: SELECT
OGRFeature(SELECT):0
  parameters (String) = +proj=krovak +lat_0=49.5 +lon_0=24.83333333333333 
+alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 +ellps=bessel 
+towgs84=542.5,89.2,456.9,5.517,2.275,5.516,6.96 +pm=greenwich +units=m 
+no_defs

One of the issue is that qgis srs.db has a towgs84 value different from the 
GDAL one. As QGIS tries to add the missing towgs84 from the EPSG database 
sync'ed frm GDAL from the name of the datum, it tries with 
"+towgs84=589,76,480,0,0,0,0" which is the shift for 
System_Jednotne_Trigonometricke_Site_Katastralni datum, hence the mismatch

(Not sure if the additional +pm=greenwich in qgis srs.db might also be a 
problem in the matching logic)

Looking at git history, I see:

commit 2ffbbded16fa8f4425ccb1be4a04186a43b93754
Author: Radim Blazek <radim.blazek at gmail.com>
Date:   Wed Jun 12 11:12:56 2013 +0200

    Updated towgs84 parameters of JTSK CRS, the towgs84 values were calculated 
for area of Czech and Slovak Republic as it is described here: 
http://grass.fsv.cvut
    
    UPDATE tbl_srs set parameters = '+proj=krovak +lat_0=49.5 
+lon_0=24.83333333333333 +alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 
+ellps=bessel +towgs84=542.
    
    UPDATE tbl_srs set parameters = '+proj=krovak +lat_0=49.5 
+lon_0=24.83333333333333 +alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 
+ellps=bessel +towgs84=542.
    
    UPDATE tbl_srs set parameters = '+proj=krovak +lat_0=49.5 +lon_0=42.5 
+alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 +ellps=bessel 
+towgs84=542.5,89.2,456.9,
    
    UPDATE tbl_srs set parameters = '+proj=krovak +lat_0=49.5 +lon_0=42.5 
+alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 +ellps=bessel 
+towgs84=542.5,89.2,456.9,
    
    UPDATE tbl_srs set parameters = '+proj=krovak +lat_0=49.5 
+lon_0=24.83333333333333 +alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 
+ellps=bessel +towgs84=542.

I guess QGIS should also try to match the 'description' column of srs.db with 
the name of the PROJCS gotten from GDAL (with some laundering logic for 
spaces, / to underscore, as done when exporting to ESRI), instead/in addition 
to proj.4 strings

Welcome to SRS hell !


> 
> [1] http://147.32.131.147/landa/Export_Output.prj.txt

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 14 04:59:22 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 14 Nov 2016 12:59:22 +0000
Subject: [gdal-dev] How to replace an osm key?
Message-ID: <17b5a83afee84c5f84427e42dffd22a4@C119S212VM022.msvyvi.vaha.local>

Hi,

If you enclose something between single quotes in SQL it becomes a string.
SELECT ’building’  -> selects literally the given *string* –building—
However,

SELECT "building" -> selects the *value* of *field* –building-- (or “identifier” as is it called in SQL)

See for example https://www.sqlite.org/lang_keywords.html

I tested on Windows with trunk version of GDAL that this syntax works:

ogrinfo -dialect sqlite -sql "select geometry, "building" as bldg
from multipolygons where "building" is not null limit 1" hamburg-latest.osm.pbf

By reading this old thread http://osgeo-org.1560.x6.nabble.com/gdal-dev-OGR-SQL-Excecuting-select-where-column-name-contains-quot-quot-td5006377.html some older GDAL versions may need some more tweaking and inner double quotes must be escaped by back slash as \”

ogrinfo -dialect sqlite -sql "select geometry, \"building\" as bldg
from multipolygons where \"building\" is not null limit 1" hamburg-latest.osm.pbf


-Jukka Rahkonen-

Djordje Spasic wrote:

Thank you for the reply Jukka.

Neither "building:levels" nor "height" fields were located in osmconf.ini under the "[multipolygons]".
I have just added them as you suggested, and now the previously mentioned command creates the .shp file without raising an error.
I tried the initial:
-dialect sqlite -sql "select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons" "C:\ladybug\osm_files\barcelona_shp_files"
and
-dialect sqlite -sql "select geometry, building as bldg, \"building:levels\" as bldg_level, height as height from multipolygons" "C:\ladybug\osm_files\barcelona_shp_files"
And they both work.

The problem is that: once the .shp file is created, and I open it, all shapes have the "building:level" value for the "bldg_level" field. Here is a screenshot:
https://www.dropbox.com/s/nmlkkzr85w225qb/sql_choosing_keys.jpg?dl=0

Why is this happening?

Kind Regards,
Djordje

-----------------------

On Saturday, November 12, 2016 10:29 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:

Hi,

Related to your previous question, you can use SQL select only for fields which are included in osmconf.ini. Perhaps "height" is not. 'building:levels' may make a surprise for you, if ogr2ogr follows SQL specification it will select a fixed string. You should use double quotes instead and they may require escaping but I do not remember with which character. Start with easy test and more attributes with odd names one by one.

-Jukka-
________________________________
Lähettäjä: Djordje Spasic<mailto:issworld2000 at yahoo.com>
Lähetetty: ‎12.‎11.‎2016 3:37
Vastaanottaja: Rahkonen Jukka (MML)<mailto:jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: VS: [gdal-dev] How to replace an osm key?
Hi Jukka,
I have just tried to rename the fields with SQL. Here is the syntax:
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite -sql "select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons" output_shps input.osm
It raises the following error message:
ERROR 1: In ExecutableSQL<>: sqlite3_prepare<select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons>:
no such column: height
Interestingly when I convert an .osm file to .shp files without using the SQL syntax, then the multipolygons.shp file does contain the "height" field. Not all shapes inside it contain it, but some do.

So why is the upper "no such column: height" error message raised?

Is something wrong with the SQL syntax?

Thank you for the reply.

Kind regards,
Djordje
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161114/cb7441e0/attachment-0001.html>

From issworld2000 at yahoo.com  Mon Nov 14 07:20:58 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Mon, 14 Nov 2016 15:20:58 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <17b5a83afee84c5f84427e42dffd22a4@C119S212VM022.msvyvi.vaha.local>
References: <17b5a83afee84c5f84427e42dffd22a4@C119S212VM022.msvyvi.vaha.local>
Message-ID: <649276421.3771618.1479136858131@mail.yahoo.com>

Thank you Jukka,

How should I edit the command you gave me:

"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite -sql "select geometry, \"building\" as bldg from multipolygons where \"building\" is not null limit 1" "C:\output_shp_files" "C:\input.osm"

so that "building", "building:levels", and "height" fields are included, not only the "building" field?
 

    On Monday, November 14, 2016 2:10 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 

 #yiv1051054434 #yiv1051054434 -- _filtered #yiv1051054434 {font-family:Helvetica;panose-1:2 11 6 4 2 2 2 2 2 4;} _filtered #yiv1051054434 {panose-1:2 4 5 3 5 4 6 3 2 4;} _filtered #yiv1051054434 {font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;} _filtered #yiv1051054434 {font-family:Verdana;panose-1:2 11 6 4 3 5 4 4 2 4;}#yiv1051054434 #yiv1051054434 p.yiv1051054434MsoNormal, #yiv1051054434 li.yiv1051054434MsoNormal, #yiv1051054434 div.yiv1051054434MsoNormal {margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;}#yiv1051054434 a:link, #yiv1051054434 span.yiv1051054434MsoHyperlink {color:blue;text-decoration:underline;}#yiv1051054434 a:visited, #yiv1051054434 span.yiv1051054434MsoHyperlinkFollowed {color:purple;text-decoration:underline;}#yiv1051054434 span.yiv1051054434Shkpostityyli17 {color:#1F497D;}#yiv1051054434 span.yiv1051054434Shkpostityyli18 {color:windowtext;}#yiv1051054434 .yiv1051054434MsoChpDefault {font-size:10.0pt;} _filtered #yiv1051054434 {margin:70.85pt 2.0cm 70.85pt 2.0cm;}#yiv1051054434 div.yiv1051054434WordSection1 {}#yiv1051054434 Hi,    If you enclose something between single quotes in SQL it becomes a string.  SELECT ’building’  -> selects literally the given *string* –building— However,    SELECT "building" -> selects the *value* of *field* –building-- (or “identifier” as is it called in SQL)    See for examplehttps://www.sqlite.org/lang_keywords.html    I tested on Windows with trunk version of GDAL that this syntax works:    ogrinfo -dialect sqlite -sql "select geometry, "building" as bldg from multipolygons where "building" is not null limit 1" hamburg-latest.osm.pbf    By reading this old threadhttp://osgeo-org.1560.x6.nabble.com/gdal-dev-OGR-SQL-Excecuting-select-where-column-name-contains-quot-quot-td5006377.html some older GDAL versions may need some more tweaking and inner double quotes must be escaped by back slash as \”    ogrinfo -dialect sqlite -sql "select geometry, \"building\" as bldg from multipolygons where \"building\" is not null limit 1" hamburg-latest.osm.pbf       -Jukka Rahkonen-    Djordje Spasic wrote:    Thank you for the reply Jukka.

Neither "building:levels" nor "height" fields were located in osmconf.ini under the "[multipolygons]".
I have just added them as you suggested, and now the previously mentioned command creates the .shp file without raising an error. I tried the initial: 
-dialect sqlite -sql "select geometry, building as bldg,'building:levels' as bldg_level, height as height from multipolygons" "C:\ladybug\osm_files\barcelona_shp_files" 
and 
-dialect sqlite -sql "select geometry, building as bldg,\"building:levels\" as bldg_level, height as height from multipolygons" "C:\ladybug\osm_files\barcelona_shp_files" 
And they both work.    The problem is that: once the .shp file is created, and I open it, all shapes have the "building:level" value for the "bldg_level" field. Here is a screenshot:
https://www.dropbox.com/s/nmlkkzr85w225qb/sql_choosing_keys.jpg?dl=0

Why is this happening?

Kind Regards,
Djordje    -----------------------    On Saturday, November 12, 2016 10:29 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:    Hi,

Related to your previous question, you can use SQL select only for fields which are included in osmconf.ini. Perhaps "height" is not. 'building:levels' may make a surprise for you, if ogr2ogr follows SQL specification it will select a fixed string. You should use double quotes instead and they may require escaping but I do not remember with which character. Start with easy test and more attributes with odd names one by one.

-Jukka- Lähettäjä:Djordje Spasic
Lähetetty:‎12.‎11.‎2016 3:37
Vastaanottaja:Rahkonen Jukka (MML);gdal-dev at lists.osgeo.org
Aihe:Re: VS: [gdal-dev] How to replace an osm key? Hi Jukka, I have just tried to rename the fields with SQL. Here is the syntax: 
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile"-dialect sqlite -sql "select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons" output_shps input.osm 
It raises the following error message: 
ERROR 1: In ExecutableSQL<>: sqlite3_prepare<select geometry, building as bldg, 'building:levels' as bldg_level, height as height from multipolygons>:
no such column: height 
Interestingly when I convert an .osm file to .shp files without using the SQL syntax, then the multipolygons.shp file does contain the "height" field. Not all shapes inside it contain it, but some do.

So why is the upper "no such column: height" error message raised?

Is something wrong with the SQL syntax?

Thank you for the reply.

Kind regards,
Djordje  

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161114/26c0f16b/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 14 07:44:12 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 14 Nov 2016 15:44:12 +0000
Subject: [gdal-dev] How to replace an osm key?
Message-ID: <bdfb64dbd79f4da99141e65f8526a377@C119S212VM022.msvyvi.vaha.local>

Hi,

If your version and environment requires escaping, then you need to do

"select geometry, \"building\" as bldg,\"building:levels\" as bldg_levels,\”height\” as height from multipolygons ... "
It may work also without escaping as
"select geometry, "building" as bldg,"building:levels" as bldg_levels,height as height from multipolygons ... "

If you plan to follow the SQL route I really recommend you to read some SQL tutorials and exercise at home. I am sure that you will learn the basics soon and tutorials are always in the web while I am not. SQL is so close to English and that you can think that you are making a (comma separated) shopping list
“SELECT milk,bread,juice FROM Wal-Mart”.

-Jukka-




Lähettäjä: Djordje Spasic [mailto:issworld2000 at yahoo.com]
Lähetetty: 14. marraskuuta 2016 17:21
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: VS: [gdal-dev] How to replace an osm key?

Thank you Jukka,

How should I edit the command you gave me:
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite -sql "select geometry, \"building\" as bldg from multipolygons where \"building\" is not null limit 1" "C:\output_shp_files" "C:\input.osm"
so that "building", "building:levels", and "height" fields are included, not only the "building" field?

On Monday, November 14, 2016 2:10 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:

Hi,

If you enclose something between single quotes in SQL it becomes a string.
SELECT ’building’  -> selects literally the given *string* –building—
However,

SELECT "building" -> selects the *value* of *field* –building-- (or “identifier” as is it called in SQL)

See for example https://www.sqlite.org/lang_keywords.html

I tested on Windows with trunk version of GDAL that this syntax works:

ogrinfo -dialect sqlite -sql "select geometry, "building" as bldg
from multipolygons where "building" is not null limit 1" hamburg-latest.osm.pbf

By reading this old thread http://osgeo-org.1560.x6.nabble.com/gdal-dev-OGR-SQL-Excecuting-select-where-column-name-contains-quot-quot-td5006377.html some older GDAL versions may need some more tweaking and inner double quotes must be escaped by back slash as \”

ogrinfo -dialect sqlite -sql "select geometry, \"building\" as bldg
from multipolygons where \"building\" is not null limit 1" hamburg-latest.osm.pbf


-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161114/931f84f8/attachment-0001.html>

From issworld2000 at yahoo.com  Mon Nov 14 08:31:52 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Mon, 14 Nov 2016 16:31:52 +0000 (UTC)
Subject: [gdal-dev] How to replace an osm key?
In-Reply-To: <bdfb64dbd79f4da99141e65f8526a377@C119S212VM022.msvyvi.vaha.local>
References: <bdfb64dbd79f4da99141e65f8526a377@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1453691413.3854272.1479141112605@mail.yahoo.com>

Thank you Jukka,

> If you plan to follow the SQL route I really recommend you to read some SQL tutorials and exercise at home. I am sure that you will learn the basics soon and tutorials are always in the web while I am not. SQL is so close to English and that you can think that you are making a (comma separated) shopping list

“SELECT milk,bread,juice FROM Wal-Mart”.
I will definitely have to do this. It's just I need a quick solution to this specific issue, for now.



> If your version and environment requires escaping, then you need to do 

"select geometry, \"building\" as bldg,\"building:levels\" as bldg_levels,\”height\” as height from multipolygons ... "
It may work also without escaping as"select geometry, "building" as bldg,"building:levels" as bldg_levels,height as height from multipolygons ... "

We tried something similar few days ago:

"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite -sql "select geometry, building as bldg, \"building:levels\" as bldg_level, height as height from multipolygons" "C:\output_shp_files" "C:\input.osm"

and it created a .shp file with invalid "building:level" values.What confuses me now is where to insert the newly added "is not null limit 1" part.


By the way, I have just tested the syntax you gave me today, with "building:levels" field:
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -dialect sqlite -sql "select geometry, \"building:levels\" as bldg_level from multipolygons where \"building:levels\" is not null limit 1" "C:\output_shp_files" "C:\input.osm"

and it again creates shapes with "bldg_level" field, and a value "building:levels" for each shape, under the "bldg_level" key.

I used ogr2ogr.exe from both GDAL 1.11.4 and GDAL 2.1.0 (downloaded from gisinternals.com).

They both resulted in the same error of all shapes having the "building:levels" value for "bldg_level" key.

I tried testing on a couple of .osm files, and got the same errors on all of them.

Is this a bug in ogr2ogr.exe?

If it is, whom do I need to contact?

Or is this a conflict with the osmconf.ini file's settings?
I uploaded it in here:
https://www.dropbox.com/s/rp242or1lhwggoo/osmconf.ini?dl=0

Thank you and my apologies for further disturbance.
 


----------------
    On Monday, November 14, 2016 4:44 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 

  #yiv9851596120 #yiv9851596120 -- filtered {font-family:Helvetica;panose-1:2 11 6 4 2 2 2 2 2 4;}#yiv9851596120 filtered {panose-1:2 4 5 3 5 4 6 3 2 4;}#yiv9851596120 filtered {font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;}#yiv9851596120 filtered {font-family:Verdana;panose-1:2 11 6 4 3 5 4 4 2 4;}#yiv9851596120 p.yiv9851596120MsoNormal, #yiv9851596120 li.yiv9851596120MsoNormal, #yiv9851596120 div.yiv9851596120MsoNormal {margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;}#yiv9851596120 a:link, #yiv9851596120 span.yiv9851596120MsoHyperlink {color:blue;text-decoration:underline;}#yiv9851596120 a:visited, #yiv9851596120 span.yiv9851596120MsoHyperlinkFollowed {color:purple;text-decoration:underline;}#yiv9851596120 p.yiv9851596120msonormal, #yiv9851596120 li.yiv9851596120msonormal, #yiv9851596120 div.yiv9851596120msonormal {margin-right:0cm;margin-left:0cm;font-size:12.0pt;}#yiv9851596120 p.yiv9851596120msochpdefault, #yiv9851596120 li.yiv9851596120msochpdefault, #yiv9851596120 div.yiv9851596120msochpdefault {margin-right:0cm;margin-left:0cm;font-size:12.0pt;}#yiv9851596120 p.yiv9851596120msonormal1, #yiv9851596120 li.yiv9851596120msonormal1, #yiv9851596120 div.yiv9851596120msonormal1 {margin:0cm;margin-bottom:.0001pt;font-size:12.0pt;}#yiv9851596120 p.yiv9851596120msochpdefault1, #yiv9851596120 li.yiv9851596120msochpdefault1, #yiv9851596120 div.yiv9851596120msochpdefault1 {margin-right:0cm;margin-left:0cm;font-size:10.0pt;}#yiv9851596120 span.yiv9851596120msohyperlink {}#yiv9851596120 span.yiv9851596120msohyperlinkfollowed {}#yiv9851596120 span.yiv9851596120shkpostityyli17 {}#yiv9851596120 span.yiv9851596120shkpostityyli18 {}#yiv9851596120 span.yiv9851596120msohyperlink1 {color:blue;text-decoration:underline;}#yiv9851596120 span.yiv9851596120msohyperlinkfollowed1 {color:purple;text-decoration:underline;}#yiv9851596120 span.yiv9851596120shkpostityyli171 {color:#1F497D;}#yiv9851596120 span.yiv9851596120shkpostityyli181 {color:windowtext;}#yiv9851596120 span.yiv9851596120Shkpostityyli29 {color:#1F497D;}#yiv9851596120 span.yiv9851596120Shkpostityyli30 {color:#1F497D;}#yiv9851596120 .yiv9851596120MsoChpDefault {font-size:10.0pt;}#yiv9851596120 filtered {margin:70.85pt 2.0cm 70.85pt 2.0cm;}#yiv9851596120 div.yiv9851596120WordSection1 {}#yiv9851596120 Hi,    If your version and environment requires escaping, then you need to do    "select geometry, \"building\" as bldg,\"building:levels\" as bldg_levels,\”height\” as height from multipolygons ... " It may work also without escaping as "select geometry, "building" as bldg,"building:levels" as bldg_levels,height as height from multipolygons ... "    If you plan to follow the SQL route I really recommend you to read some SQL tutorials and exercise at home. I am sure that you will learn the basics soon and tutorials are always in the web while I am not. SQL is so close to English and that you can think that you are making a (comma separated) shopping list “SELECT milk,bread,juice FROM Wal-Mart”.    -Jukka-             Lähettäjä: Djordje Spasic [mailto:issworld2000 at yahoo.com]
Lähetetty: 14. marraskuuta 2016 17:21
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>;gdal-dev at lists.osgeo.org
Aihe: Re: VS: [gdal-dev] How to replace an osm key?    Thank you Jukka,

How should I edit the command you gave me: 
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile"-dialect sqlite -sql "select geometry, \"building\" as bldg from multipolygons where \"building\" is not null limit 1" "C:\output_shp_files" "C:\input.osm" 
so that "building", "building:levels", and "height" fields are included, not only the "building" field?    On Monday, November 14, 2016 2:10 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:    Hi,   If you enclose something between single quotes in SQL it becomes a string.  SELECT ’building’  -> selects literally the given *string* –building— However,   SELECT "building" -> selects the *value* of *field* –building-- (or “identifier” as is it called in SQL)   See for examplehttps://www.sqlite.org/lang_keywords.html   I tested on Windows with trunk version of GDAL that this syntax works:   ogrinfo -dialect sqlite -sql "select geometry, "building" as bldg from multipolygons where "building" is not null limit 1" hamburg-latest.osm.pbf   By reading this old threadhttp://osgeo-org.1560.x6.nabble.com/gdal-dev-OGR-SQL-Excecuting-select-where-column-name-contains-quot-quot-td5006377.html some older GDAL versions may need some more tweaking and inner double quotes must be escaped by back slash as \”   ogrinfo -dialect sqlite -sql "select geometry, \"building\" as bldg from multipolygons where \"building\" is not null limit 1" hamburg-latest.osm.pbf     -Jukka Rahkonen-   

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161114/b484832b/attachment-0001.html>

From andb at balk.dk  Tue Nov 15 11:03:29 2016
From: andb at balk.dk (Anders Kragh Barfod (andb))
Date: Tue, 15 Nov 2016 20:03:29 +0100
Subject: [gdal-dev] Read CSV from API with ogr2ogr
Message-ID: <388521239CF13649836C25C4EE842D69018D66DFE10C@POSTVDB1.balk.dk>

Hi List.

I'm trying to convert a CSV to PostgreSQL with ogr2ogr, but the CSV is coming from an API:


http://api.statbank.dk/v1/data/FT/CSV?delimiter=Semicolon&HOVEDDELE=*&Tid=*

I have tried following ogr2ogr:

ogr2ogr -f PostgreSQL PG:"dbname=postgres host=localhost port=5432 user=postgres password=xxx" CSV:"/vsicurl/http://api.statbank.dk/v1/data/FT/CSV?delimiter=Semicolon&HOVEDDELE=*&Tid=*" -nln FT -lco SEPARATOR=SEMICOLON

But are getting: Unable to open data source....
I can get it working if I download the CSV and use ogr2ogr, but would prefer to fetch it straight from the API to reduce the steps in my script.

Thanks in advance.

Anders
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161115/c7ff1a3c/attachment.html>

From even.rouault at spatialys.com  Tue Nov 15 11:49:41 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 15 Nov 2016 20:49:41 +0100
Subject: [gdal-dev] Read CSV from API with ogr2ogr
In-Reply-To: <388521239CF13649836C25C4EE842D69018D66DFE10C@POSTVDB1.balk.dk>
References: <388521239CF13649836C25C4EE842D69018D66DFE10C@POSTVDB1.balk.dk>
Message-ID: <2550321.lazeN8MrmN@even-i700>

On mardi 15 novembre 2016 20:03:29 CET Anders Kragh Barfod (andb) wrote:
> Hi List.
> 
> I'm trying to convert a CSV to PostgreSQL with ogr2ogr, but the CSV is
> coming from an API:
> 
> 
> http://api.statbank.dk/v1/data/FT/CSV?delimiter=Semicolon&HOVEDDELE=*&Tid=*
> 
> I have tried following ogr2ogr:
> 
> ogr2ogr -f PostgreSQL PG:"dbname=postgres host=localhost port=5432
> user=postgres password=xxx"
> CSV:"/vsicurl/http://api.statbank.dk/v1/data/FT/CSV?delimiter=Semicolon&HOV
> EDDELE=*&Tid=*" -nln FT -lco SEPARATOR=SEMICOLON
> 
> But are getting: Unable to open data source....
> I can get it working if I download the CSV and use ogr2ogr, but would prefer
> to fetch it straight from the API to reduce the steps in my script.

Anders,

The server doesn't seem to support range GET requests, but I see this works if 
you use the /vsicurl_streaming/ virtual file system (and CSV reading is in 
streaming, so this matches well)

ogrinfo  -ro CSV:"/vsicurl_streaming/http://api.statbank.dk/v1/data/FT/CSV?
delimiter=Semicolon&HOVEDDELE=*&Tid=*" -al -q

Note that -lco SEPARATOR=SEMICOLON is useless. -lco stands for layer creation 
option, so this should be for the output driver, here PostgreSQL

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From piero.campa at gmail.com  Wed Nov 16 01:09:06 2016
From: piero.campa at gmail.com (Piero Campa)
Date: Wed, 16 Nov 2016 02:09:06 -0700 (MST)
Subject: [gdal-dev] gdalwarp for affine transformation?
In-Reply-To: <CAG4NReL6auA6Q3FYVwAJWV9qibhpKRFzx_9t4mS+u_yZsD72DA@mail.gmail.com>
References: <CAG4NReL6auA6Q3FYVwAJWV9qibhpKRFzx_9t4mS+u_yZsD72DA@mail.gmail.com>
Message-ID: <1479287346667-5295980.post@n6.nabble.com>

Hi,

if you mean to use directly the GDAL library, then have a look at the data
model: http://www.gdal.org/gdal_datamodel.html
You will find the "Affine GeoTransform" section there.

If you are using GDAL utilities, it seems that none of them can let you
define a transformation matrix (is that confirmed?), so I believe that you
might get it through WKT2 [1] and its "Math Transform" API:

 - derive a "fitted CS" [2] with the affine transform you want to apply;
 - use gdal_translate to reproject your original image to the transformed
one.

An example of fitted CS that applies a rotation to the original Google
mercator:

==============================================
FITTED_CS["-22.5°-rotated map CRS",
    PARAM_MT["Affine",
        PARAMETER["num_row",3],
        PARAMETER["num_col",3],
        PARAMETER["elt_0_0",0.9238795325112865],
        PARAMETER["elt_0_1",0.3826834323650904],
        PARAMETER["elt_1_0",-0.3826834323650904],
        PARAMETER["elt_1_1",0.9238795325112865]],
    PROJCS["Google Mercator",
        GEOGCS["WGS 84",
            DATUM["World Geodetic System 1984",
                SPHEROID["WGS 84",6378137.0,298.257223563,
                    AUTHORITY["EPSG","7030"]],
                AUTHORITY["EPSG","6326"]],
            PRIMEM["Greenwich",0.0,
                AUTHORITY["EPSG","8901"]],
            UNIT["degree",0.017453292519943295],
            AXIS["Geodetic latitude",NORTH],
            AXIS["Geodetic longitude",EAST],
            AUTHORITY["EPSG","4326"]],
        PROJECTION["Mercator_1SP"],
        PARAMETER["semi_minor",6356752.314],
        PARAMETER["latitude_of_origin",0.0],
        PARAMETER["central_meridian",0.0],
        PARAMETER["scale_factor",1.0],
        PARAMETER["false_easting",0.0],
        PARAMETER["false_northing",0.0],
        UNIT["m",1.0],
        AXIS["Easting",EAST],
        AXIS["Northing",NORTH],
        AUTHORITY["EPSG","900913"]]]
==============================================

-Piero

 [1]
http://docs.geotools.org/stable/javadocs/org/opengis/referencing/doc-files/WKT.html
 [2]
http://docs.geotools.org/stable/javadocs/org/opengis/referencing/doc-files/WKT.html#FITTED_CS



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-gdalwarp-for-affine-transformation-tp5062492p5295980.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From piero.campa at gmail.com  Wed Nov 16 01:23:09 2016
From: piero.campa at gmail.com (Piero Campa)
Date: Wed, 16 Nov 2016 02:23:09 -0700 (MST)
Subject: [gdal-dev] gdalwarp for affine transformation?
In-Reply-To: <1479287346667-5295980.post@n6.nabble.com>
References: <CAG4NReL6auA6Q3FYVwAJWV9qibhpKRFzx_9t4mS+u_yZsD72DA@mail.gmail.com>
 <1479287346667-5295980.post@n6.nabble.com>
Message-ID: <1479288189452-5295984.post@n6.nabble.com>

Piero Campa wrote
>  - use gdal_translate to reproject your original image to the transformed
> one.

Sorry, I meant gdalwarp.



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-gdalwarp-for-affine-transformation-tp5062492p5295984.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Wed Nov 16 02:05:22 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 16 Nov 2016 11:05:22 +0100
Subject: [gdal-dev] gdalwarp for affine transformation?
In-Reply-To: <1479287346667-5295980.post@n6.nabble.com>
References: <CAG4NReL6auA6Q3FYVwAJWV9qibhpKRFzx_9t4mS+u_yZsD72DA@mail.gmail.com>
 <1479287346667-5295980.post@n6.nabble.com>
Message-ID: <3985260.YXQ156Eu6X@even-i700>

On mercredi 16 novembre 2016 02:09:06 CET Piero Campa wrote:
> Hi,
> 
> if you mean to use directly the GDAL library, then have a look at the data
> model: http://www.gdal.org/gdal_datamodel.html
> You will find the "Affine GeoTransform" section there.
> 
> If you are using GDAL utilities, it seems that none of them can let you
> define a transformation matrix (is that confirmed?), so I believe that you
> might get it through WKT2 [1] and its "Math Transform" API:
> 
>  - derive a "fitted CS" [2] with the affine transform you want to apply;
>  - use gdal_translate to reproject your original image to the transformed
> one.

Piero,

FITTED_CS is not supported by GDAL. But you could do it this way:

1) # Create a black image of the right size and SRS
gdal_translate random.tif temp.vrt -of VRT -outsize ... -a_srs ... -scale 0 1 0 0
2) Edit the <GeoTransform> node in my.vrt
3) gdal_translate my.vrt out.tif
4) gdalwarp src.tif out.tif

(where random.tif can be src.tif to have the right number of bands)

Or variation:

1) gdal_translate random.tif out.tif -outsize ... -a_srs ... -scale 0 1 0 0

2) python
from osgeo import gdal
ds = gdal.Open('out.tif', gdal.GA_Update)
ds.SetGeoTransform([a, b, c, d, e, f])

3) gdalwarp src.tif out.tif



Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From piero.campa at gmail.com  Wed Nov 16 06:19:58 2016
From: piero.campa at gmail.com (Piero Campalani)
Date: Wed, 16 Nov 2016 15:19:58 +0100
Subject: [gdal-dev] gdalwarp for affine transformation?
In-Reply-To: <3985260.YXQ156Eu6X@even-i700>
References: <CAG4NReL6auA6Q3FYVwAJWV9qibhpKRFzx_9t4mS+u_yZsD72DA@mail.gmail.com>
 <1479287346667-5295980.post@n6.nabble.com> <3985260.YXQ156Eu6X@even-i700>
Message-ID: <CAMp9JaMWDpSWFb1Z-_dGgufvL8JqkZdvwsNYPqPm5MzpaUo_FA@mail.gmail.com>

On 16 November 2016 at 11:05, Even Rouault <even.rouault at spatialys.com>
wrote:
>
> Piero,
>
> FITTED_CS is not supported by GDAL.

​Thank you Even.
I was indeed coming back to say that I tried it out and couldn't:

​    ``ERROR 1: Translating source or target SRS failed​''

Thanks for the alternatives, that is very interesting.

-Piero
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161116/167840ee/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 17 00:06:24 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 17 Nov 2016 08:06:24 +0000
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
Message-ID: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>

Hi,

I noticed that Even was editing the ogr2ogr help about the -dim parameter and  remembered that I think that it does not have an effect on the OCI driver. For forcing a new Oracle table into 2D you must use the OCI drivers own layer creation option "DIM" instead http://www.gdal.org/drv_oci.html. I am not sure if that happens also with the current GDAL version.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161117/5ea49bb4/attachment.html>

From even.rouault at spatialys.com  Thu Nov 17 01:16:40 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 17 Nov 2016 10:16:40 +0100
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
In-Reply-To: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>
References: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>
Message-ID: <2743190.0m9gBcTssE@even-i700>

On jeudi 17 novembre 2016 08:06:24 CET Rahkonen Jukka (MML) wrote:
> Hi,
> 
> I noticed that Even was editing the ogr2ogr help about the -dim parameter
> and  remembered that I think that it does not have an effect on the OCI
> driver. For forcing a new Oracle table into 2D you must use the OCI drivers
> own layer creation option "DIM" instead http://www.gdal.org/drv_oci.html. I
> am not sure if that happens also with the current GDAL version.

Yes you would still need to play with the DIM layer creation option for OCI. I 
dug into history and am wondering if the current behaviour of the OCI driver 
to not use the dimension of the geometry type passed to the CreateLayer() 
method by default, but use instead 3 as default and use DIM creation option as 
an override has some rationale specific to Oracle behaviour, or is just a 
matter of history ( https://trac.osgeo.org/gdal/changeset/4057 : 14 years 
ago).
Would it make sense to change it to the behaviour of the PostGIS driver that 
usess the dimension of the geometry type passed to the CreateLayer() method by 
default by default, unless DIM is defined ( https://trac.osgeo.org/gdal/
changeset/7303 : 12 years ago)

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From michael.smith.erdc at gmail.com  Thu Nov 17 03:49:09 2016
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Thu, 17 Nov 2016 05:49:09 -0600
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
In-Reply-To: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>
References: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>
Message-ID: <AD9DEA77-DE0F-46ED-9656-854F5D664053@gmail.com>

Yes even the current version needs the layer creation option for dim. I would be +1 for this change (never really understood why it was this way). I think we are probably one of the biggest users of the oracle driver and I think this would be a good improvement. 

Sent from my iPhone

> On Nov 17, 2016, at 2:06 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> 
> Hi,
>  
> I noticed that Even was editing the ogr2ogr help about the –dim parameter and  remembered that I think that it does not have an effect on the OCI driver. For forcing a new Oracle table into 2D you must use the OCI drivers own layer creation option “DIM” instead http://www.gdal.org/drv_oci.html. I am not sure if that happens also with the current GDAL version.
>  
> -Jukka Rahkonen-
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161117/289f803c/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 17 03:54:25 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 17 Nov 2016 11:54:25 +0000
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
Message-ID: <8bf7d475f7164b048f7030fd1f8e0197@C119S212VM022.msvyvi.vaha.local>

Hi,

I would also check how ogr2ogr options –a_srs and –t_srs  behave or if the OCI driver option –lco SRID is still needed.

-Jukka-

Lähettäjä: Michael Smith [mailto:michael.smith.erdc at gmail.com]
Lähetetty: 17. marraskuuta 2016 13:49
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] Ogr2ogr -dim and Oracle

Yes even the current version needs the layer creation option for dim. I would be +1 for this change (never really understood why it was this way). I think we are probably one of the biggest users of the oracle driver and I think this would be a good improvement.

Sent from my iPhone

On Nov 17, 2016, at 2:06 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

I noticed that Even was editing the ogr2ogr help about the –dim parameter and  remembered that I think that it does not have an effect on the OCI driver. For forcing a new Oracle table into 2D you must use the OCI drivers own layer creation option “DIM” instead http://www.gdal.org/drv_oci.html. I am not sure if that happens also with the current GDAL version.

-Jukka Rahkonen-
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161117/c29e7119/attachment.html>

From michael.smith.erdc at gmail.com  Thu Nov 17 04:05:25 2016
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Thu, 17 Nov 2016 06:05:25 -0600
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
In-Reply-To: <8bf7d475f7164b048f7030fd1f8e0197@C119S212VM022.msvyvi.vaha.local>
References: <8bf7d475f7164b048f7030fd1f8e0197@C119S212VM022.msvyvi.vaha.local>
Message-ID: <0810B882-418B-4BA1-A773-E9D9E12E9940@gmail.com>

For the srid, I would say keep that as an srs doesn't always map cleanly to an srid. 

Sent from my iPhone

> On Nov 17, 2016, at 5:54 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> 
> Hi,
>  
> I would also check how ogr2ogr options –a_srs and –t_srs  behave or if the OCI driver option –lco SRID is still needed.
>  
> -Jukka-
>  
> Lähettäjä: Michael Smith [mailto:michael.smith.erdc at gmail.com] 
> Lähetetty: 17. marraskuuta 2016 13:49
> Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
> Kopio: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
> Aihe: Re: [gdal-dev] Ogr2ogr -dim and Oracle
>  
> Yes even the current version needs the layer creation option for dim. I would be +1 for this change (never really understood why it was this way). I think we are probably one of the biggest users of the oracle driver and I think this would be a good improvement. 
> 
> Sent from my iPhone
> 
> On Nov 17, 2016, at 2:06 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> 
> Hi,
>  
> I noticed that Even was editing the ogr2ogr help about the –dim parameter and  remembered that I think that it does not have an effect on the OCI driver. For forcing a new Oracle table into 2D you must use the OCI drivers own layer creation option “DIM” instead http://www.gdal.org/drv_oci.html. I am not sure if that happens also with the current GDAL version.
>  
> -Jukka Rahkonen-
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161117/89368564/attachment-0001.html>

From even.rouault at spatialys.com  Thu Nov 17 04:40:54 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 17 Nov 2016 13:40:54 +0100
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
In-Reply-To: <AD9DEA77-DE0F-46ED-9656-854F5D664053@gmail.com>
References: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>
 <AD9DEA77-DE0F-46ED-9656-854F5D664053@gmail.com>
Message-ID: <201611171340.54321.even.rouault@spatialys.com>

Le jeudi 17 novembre 2016 12:49:09, Michael Smith a écrit :
> Yes even the current version needs the layer creation option for dim. I
> would be +1 for this change (never really understood why it was this way).
> I think we are probably one of the biggest users of the oracle driver and
> I think this would be a good improvement.

OK, I've just changed that in trunk to use the dimension of the passed 
geometry type.

Regarding SRS / SRID, as far as I can see, there's a logic to try to guess the 
SRID from the SRS based first on a very small list of hard-coded EPSG SRS 
(EPSG:4326,4322,4269,4277,27700), and then trying to find an entry with the 
same WKTEXT in MDSYS.CS_SRS

> 
> Sent from my iPhone
> 
> > On Nov 17, 2016, at 2:06 AM, Rahkonen Jukka (MML)
> > <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> > 
> > Hi,
> > 
> > I noticed that Even was editing the ogr2ogr help about the –dim parameter
> > and  remembered that I think that it does not have an effect on the OCI
> > driver. For forcing a new Oracle table into 2D you must use the OCI
> > drivers own layer creation option “DIM” instead
> > http://www.gdal.org/drv_oci.html. I am not sure if that happens also
> > with the current GDAL version.
> > 
> > -Jukka Rahkonen-
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From lucena_ivan at hotmail.com  Thu Nov 17 05:19:10 2016
From: lucena_ivan at hotmail.com (Ivan Lucena)
Date: Thu, 17 Nov 2016 13:19:10 +0000
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
In-Reply-To: <201611171340.54321.even.rouault@spatialys.com>
References: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>
 <AD9DEA77-DE0F-46ED-9656-854F5D664053@gmail.com>,
 <201611171340.54321.even.rouault@spatialys.com>
Message-ID: <BLUPR19MB01452D78BF6F7BA607B2ED36F2B10@BLUPR19MB0145.namprd19.prod.outlook.com>

Hi Even,

Did you try your change?

There has been a lot of changes in both sides over the years that are not reflected on the OCI driver code.

That hard coded SRID conversion should be deleted since EPSG is fully supported now.

He georaster driver uses some PLSQL functions to try to match WKT to possible SRIDs. That could be added to the OCI. I think.

Regards 
Ivan


> On Nov 17, 2016, at 7:38 AM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> Le jeudi 17 novembre 2016 12:49:09, Michael Smith a écrit :
>> Yes even the current version needs the layer creation option for dim. I
>> would be +1 for this change (never really understood why it was this way).
>> I think we are probably one of the biggest users of the oracle driver and
>> I think this would be a good improvement.
> 
> OK, I've just changed that in trunk to use the dimension of the passed 
> geometry type.
> 
> Regarding SRS / SRID, as far as I can see, there's a logic to try to guess the 
> SRID from the SRS based first on a very small list of hard-coded EPSG SRS 
> (EPSG:4326,4322,4269,4277,27700), and then trying to find an entry with the 
> same WKTEXT in MDSYS.CS_SRS
> 
>> 
>> Sent from my iPhone
>> 
>>> On Nov 17, 2016, at 2:06 AM, Rahkonen Jukka (MML)
>>> <jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>> 
>>> Hi,
>>> 
>>> I noticed that Even was editing the ogr2ogr help about the –dim parameter
>>> and  remembered that I think that it does not have an effect on the OCI
>>> driver. For forcing a new Oracle table into 2D you must use the OCI
>>> drivers own layer creation option “DIM” instead
>>> http://www.gdal.org/drv_oci.html. I am not sure if that happens also
>>> with the current GDAL version.
>>> 
>>> -Jukka Rahkonen-
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Thu Nov 17 06:02:47 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 17 Nov 2016 15:02:47 +0100
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
In-Reply-To: <BLUPR19MB01452D78BF6F7BA607B2ED36F2B10@BLUPR19MB0145.namprd19.prod.outlook.com>
References: <d75be60d10394d379e231cc90d7488da@C119S212VM022.msvyvi.vaha.local>
 <201611171340.54321.even.rouault@spatialys.com>
 <BLUPR19MB01452D78BF6F7BA607B2ED36F2B10@BLUPR19MB0145.namprd19.prod.outlook.com>
Message-ID: <201611171502.47645.even.rouault@spatialys.com>

Le jeudi 17 novembre 2016 14:19:10, Ivan Lucena a écrit :
> Hi Even,
> 
> Did you try your change?

Yes

> 
> There has been a lot of changes in both sides over the years that are not
> reflected on the OCI driver code.
> 
> That hard coded SRID conversion should be deleted since EPSG is fully
> supported now.

Do you know which since which version of OCI this "now" apply ?

With 11.2.0, I see things like :

OGRFeature(select * from MDSYS.CS_SRS):6
  CS_NAME (String) = NAD83(CSRS98) / UTM zone 17N
  SRID (Integer64) = 2150
  AUTH_SRID (Integer64) = 2150
  AUTH_NAME (String) = Geomatics Canada.
  WKTEXT (String) = PROJCS["NAD83(CSRS98) / UTM zone 17N", GEOGCS [ 
"NAD83(CSRS98)", DATUM ["NAD83 Canadian Spatial Reference System (EPSG ID 
6140)", SPHEROID ["GRS 1980 (EPSG ID 7019)", 6378137.0, 298.257222101]], 
PRIMEM [ "Greenwich", 0.000000 ], UNIT ["degree minute second hemisphere", 
0.0174532925199433]], PROJECTION ["Transverse Mercator"], PARAMETER 
["Latitude_Of_Origin", 0.0], PARAMETER ["Central_Meridian", -81.0], PARAMETER 
["Scale_Factor", 0.9996], PARAMETER ["False_Easting", 500000.0], PARAMETER 
["False_Northing", 0.0], UNIT ["Meter", 1.0]]
  WKTEXT3D (String) = PROJCS[
  "NAD83(CSRS98) / UTM zone 17N",
  GEOGCS["NAD83(CSRS98)",
    DATUM["NAD83 Canadian Spatial Reference System",
      SPHEROID[
        "GRS 1980",
        6378137.0,
        298.257222101,
        AUTHORITY["EPSG", "7019"]],
      TOWGS84[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
      AUTHORITY["EPSG", "6140"]],
    PRIMEM["Greenwich", 0.000000, AUTHORITY["EPSG","8901"]],
    UNIT["degree minute second hemisphere", 0.0174532925199433, 
AUTHORITY["EPSG", "9108"]],
    AXIS["Lat", NORTH],
    AXIS["Long", EAST],
    AUTHORITY["EPSG", "4140"]],
  PROJECTION ["Transverse Mercator"],
  PARAMETER ["Latitude_Of_Origin", 0.0],
  PARAMETER ["Central_Meridian", -81.0],
  PARAMETER ["Scale_Factor", 0.9996],
  PARAMETER ["False_Easting", 500000.0],
  PARAMETER ["False_Northing", 0.0],
  UNIT["metre", 1.0, AUTHORITY["EPSG", "9001"]],
  AXIS["E", EAST],
  AXIS["N", NORTH],
  AUTHORITY["EPSG", "2150"]]

What surprises me is the AUTH_NAME which is not EPSG (for other codes it is 
null). So it is not entirely clear how you would find the SRID if you can't 
search by AUTH_NAME = 'EPSG' AND AUTH_SRID = epsg_code. Skimming through the 
list, it seems that SRID = AUTH_SRID for EPSG codes however.

> 
> He georaster driver uses some PLSQL functions to try to match WKT to
> possible SRIDs. That could be added to the OCI. I think.

OK. Good to know

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 17 06:18:43 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 17 Nov 2016 14:18:43 +0000
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
Message-ID: <1565313da7464540a3ac6e8ae8c085fa@C119S212VM022.msvyvi.vaha.local>

Hi,

Probably SDO_COORD_REF_SYS is what to use nowadays even I guess that it points to MDSYS tables. Looks like something has changed with Oracle 10.2 and I believe that it is very hard to use so old Oracle version without paying much extra.
https://docs.oracle.com/database/121/SPATL/GUID-7DEF5C91-777C-4023-AE2E-E2E29F5213D2.htm#SPATL652 

-Jukka Rahkonen- 


Even Rouault wrote:

Le jeudi 17 novembre 2016 14:19:10, Ivan Lucena a écrit :
> Hi Even,
> 
>> Did you try your change?

>Yes

>> 
> There has been a lot of changes in both sides over the years that are 
> not reflected on the OCI driver code.
> 
> That hard coded SRID conversion should be deleted since EPSG is fully 
> supported now.

Do you know which since which version of OCI this "now" apply ?

With 11.2.0, I see things like :

OGRFeature(select * from MDSYS.CS_SRS):6
  CS_NAME (String) = NAD83(CSRS98) / UTM zone 17N
  SRID (Integer64) = 2150
  AUTH_SRID (Integer64) = 2150
  AUTH_NAME (String) = Geomatics Canada.
  WKTEXT (String) = PROJCS["NAD83(CSRS98) / UTM zone 17N", GEOGCS [ "NAD83(CSRS98)", DATUM ["NAD83 Canadian Spatial Reference System (EPSG ID 6140)", SPHEROID ["GRS 1980 (EPSG ID 7019)", 6378137.0, 298.257222101]], PRIMEM [ "Greenwich", 0.000000 ], UNIT ["degree minute second hemisphere", 0.0174532925199433]], PROJECTION ["Transverse Mercator"], PARAMETER ["Latitude_Of_Origin", 0.0], PARAMETER ["Central_Meridian", -81.0], PARAMETER ["Scale_Factor", 0.9996], PARAMETER ["False_Easting", 500000.0], PARAMETER ["False_Northing", 0.0], UNIT ["Meter", 1.0]]
  WKTEXT3D (String) = PROJCS[
  "NAD83(CSRS98) / UTM zone 17N",
  GEOGCS["NAD83(CSRS98)",
    DATUM["NAD83 Canadian Spatial Reference System",
      SPHEROID[
        "GRS 1980",
        6378137.0,
        298.257222101,
        AUTHORITY["EPSG", "7019"]],
      TOWGS84[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
      AUTHORITY["EPSG", "6140"]],
    PRIMEM["Greenwich", 0.000000, AUTHORITY["EPSG","8901"]],
    UNIT["degree minute second hemisphere", 0.0174532925199433, AUTHORITY["EPSG", "9108"]],
    AXIS["Lat", NORTH],
    AXIS["Long", EAST],
    AUTHORITY["EPSG", "4140"]],
  PROJECTION ["Transverse Mercator"],
  PARAMETER ["Latitude_Of_Origin", 0.0],
  PARAMETER ["Central_Meridian", -81.0],
  PARAMETER ["Scale_Factor", 0.9996],
  PARAMETER ["False_Easting", 500000.0],
  PARAMETER ["False_Northing", 0.0],
  UNIT["metre", 1.0, AUTHORITY["EPSG", "9001"]],
  AXIS["E", EAST],
  AXIS["N", NORTH],
  AUTHORITY["EPSG", "2150"]]

What surprises me is the AUTH_NAME which is not EPSG (for other codes it is null). So it is not entirely clear how you would find the SRID if you can't search by AUTH_NAME = 'EPSG' AND AUTH_SRID = epsg_code. Skimming through the list, it seems that SRID = AUTH_SRID for EPSG codes however.

> 
> He georaster driver uses some PLSQL functions to try to match WKT to
> possible SRIDs. That could be added to the OCI. I think.

OK. Good to know

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From lucena_ivan at hotmail.com  Thu Nov 17 09:15:44 2016
From: lucena_ivan at hotmail.com (Ivan Lucena)
Date: Thu, 17 Nov 2016 17:15:44 +0000
Subject: [gdal-dev] Ogr2ogr -dim and Oracle
In-Reply-To: <1565313da7464540a3ac6e8ae8c085fa@C119S212VM022.msvyvi.vaha.local>
References: <1565313da7464540a3ac6e8ae8c085fa@C119S212VM022.msvyvi.vaha.local>
Message-ID: <BLUPR19MB0145063A451F7B76C89841F4F2B10@BLUPR19MB0145.namprd19.prod.outlook.com>

Hi,


a) If you look at this code here [1] from the raster driver, there are two function, FIND_GEOG_CRS and FIND_PROJ_CRS, that uses the WKT string to find matches with inside SRS.


That runs independently from Authority code and returns a list of possible matches SRIDs. The driver takes the first one automatically.


Looking back on that code, there is a lot of property-name strings that need to be adjusted, adding or removing some "_" or uppercase here and there.


b) I believe that EPSG codes are supported since version 11.


c) The -lco SRID is still useful. The way the OCI driver code works now "-a_srs EPSG:4326" will be translated to SRID 8078 (or something like that).


That is how the driver was originally developed, when EPSG was not supported yet. By using -lco SRID 4326 users can overwrite that.



I am kind of thinking about merging the two Oracle driver into one "raster/vector" driver. Any advice on that will be gladly accepted.



Regards,

Ivan


[1] - https://trac.osgeo.org/gdal/browser/trunk/gdal/frmts/georaster/georaster_dataset.cpp#L1673


________________________________
From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Sent: Thursday, November 17, 2016 9:18:43 AM
To: Even Rouault; Ivan Lucena
Cc: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Ogr2ogr -dim and Oracle

Hi,

Probably SDO_COORD_REF_SYS is what to use nowadays even I guess that it points to MDSYS tables. Looks like something has changed with Oracle 10.2 and I believe that it is very hard to use so old Oracle version without paying much extra.
https://docs.oracle.com/database/121/SPATL/GUID-7DEF5C91-777C-4023-AE2E-E2E29F5213D2.htm#SPATL652

-Jukka Rahkonen-


Even Rouault wrote:

Le jeudi 17 novembre 2016 14:19:10, Ivan Lucena a écrit :
> Hi Even,
>
>> Did you try your change?

>Yes

>>
> There has been a lot of changes in both sides over the years that are
> not reflected on the OCI driver code.
>
> That hard coded SRID conversion should be deleted since EPSG is fully
> supported now.

Do you know which since which version of OCI this "now" apply ?

With 11.2.0, I see things like :

OGRFeature(select * from MDSYS.CS_SRS):6
  CS_NAME (String) = NAD83(CSRS98) / UTM zone 17N
  SRID (Integer64) = 2150
  AUTH_SRID (Integer64) = 2150
  AUTH_NAME (String) = Geomatics Canada.
  WKTEXT (String) = PROJCS["NAD83(CSRS98) / UTM zone 17N", GEOGCS [ "NAD83(CSRS98)", DATUM ["NAD83 Canadian Spatial Reference System (EPSG ID 6140)", SPHEROID ["GRS 1980 (EPSG ID 7019)", 6378137.0, 298.257222101]], PRIMEM [ "Greenwich", 0.000000 ], UNIT ["degree minute second hemisphere", 0.0174532925199433]], PROJECTION ["Transverse Mercator"], PARAMETER ["Latitude_Of_Origin", 0.0], PARAMETER ["Central_Meridian", -81.0], PARAMETER ["Scale_Factor", 0.9996], PARAMETER ["False_Easting", 500000.0], PARAMETER ["False_Northing", 0.0], UNIT ["Meter", 1.0]]
  WKTEXT3D (String) = PROJCS[
  "NAD83(CSRS98) / UTM zone 17N",
  GEOGCS["NAD83(CSRS98)",
    DATUM["NAD83 Canadian Spatial Reference System",
      SPHEROID[
        "GRS 1980",
        6378137.0,
        298.257222101,
        AUTHORITY["EPSG", "7019"]],
      TOWGS84[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
      AUTHORITY["EPSG", "6140"]],
    PRIMEM["Greenwich", 0.000000, AUTHORITY["EPSG","8901"]],
    UNIT["degree minute second hemisphere", 0.0174532925199433, AUTHORITY["EPSG", "9108"]],
    AXIS["Lat", NORTH],
    AXIS["Long", EAST],
    AUTHORITY["EPSG", "4140"]],
  PROJECTION ["Transverse Mercator"],
  PARAMETER ["Latitude_Of_Origin", 0.0],
  PARAMETER ["Central_Meridian", -81.0],
  PARAMETER ["Scale_Factor", 0.9996],
  PARAMETER ["False_Easting", 500000.0],
  PARAMETER ["False_Northing", 0.0],
  UNIT["metre", 1.0, AUTHORITY["EPSG", "9001"]],
  AXIS["E", EAST],
  AXIS["N", NORTH],
  AUTHORITY["EPSG", "2150"]]

What surprises me is the AUTH_NAME which is not EPSG (for other codes it is null). So it is not entirely clear how you would find the SRID if you can't search by AUTH_NAME = 'EPSG' AND AUTH_SRID = epsg_code. Skimming through the list, it seems that SRID = AUTH_SRID for EPSG codes however.

>
> He georaster driver uses some PLSQL functions to try to match WKT to
> possible SRIDs. That could be added to the OCI. I think.

OK. Good to know

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161117/f417a24e/attachment-0001.html>

From esacree at knology.net  Thu Nov 17 12:37:52 2016
From: esacree at knology.net (esacree)
Date: Thu, 17 Nov 2016 13:37:52 -0700 (MST)
Subject: [gdal-dev] Recommended lib Curl version for GDAL 2.1.2 and WMTS
Message-ID: <1479415072500-5296336.post@n6.nabble.com>


Which version of libCurl is recommended for use with GDAL 2.1.2 and the
GDAL_WMTS driver?

We have been using libCurl version 7.45 dated 7-Oct-2016.  The newest
version is 7.51 dated 2-Nov-2016.  7.51 contains a very long list of fixes. 
The upgrade could be time consuming to rebuild everything.  We thought we
should ask if it is needed for GDAL_WMTS.  It appears to be set up correctly
but the WMTS server returns transparent images.  That could indicate an HTTP
issue with libCurl.

Thanks!

Elaine



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Recommended-lib-Curl-version-for-GDAL-2-1-2-and-WMTS-tp5296336.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From esacree at knology.net  Thu Nov 17 12:53:47 2016
From: esacree at knology.net (esacree)
Date: Thu, 17 Nov 2016 13:53:47 -0700 (MST)
Subject: [gdal-dev] Index Tiling Questions for WMTS, Bing, Google/TMS
Message-ID: <1479416027406-5296337.post@n6.nabble.com>


A few questions based on the GDAL examples for Google, Bing/VirtualEarth and
WMTS tile servers. 

1.  Google Maps has the tile/image origin in the upper left corner.  TMS has
the tile image origin in the lower left corner.   Where should the
tile/image origin be for Google maps when using the GDAL_WMS driver with the
TMS service?  Does it use the Google Maps tile origin or the TMS tile
origin?

2.  For WMTS where is the image origin?  I've read that the origin is at the
lower left corner as for TMS. Is this correct?

3.  For the USGS NationalMap WMTS servers there are 2 TileMatrixSets.  One
is default0028nm and the other is the GoogleMapsCompatible tile matrix set. 
Should both tile matrix sets be indexed the same way?

3.  For Bing/VirtualEarth the GDAL example is extremely brief.  It doesn't
show a data window or tile counts in the example.  A look at the
minidriver_virtualearth.cpp file doesn't help.  How do you get
Bing/VirtualEarth to retrieve more than one tile at a time?

Thanks!

Elaine



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Index-Tiling-Questions-for-WMTS-Bing-Google-TMS-tp5296337.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Thu Nov 17 13:11:09 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 17 Nov 2016 22:11:09 +0100
Subject: [gdal-dev] Recommended lib Curl version for GDAL 2.1.2 and WMTS
In-Reply-To: <1479415072500-5296336.post@n6.nabble.com>
References: <1479415072500-5296336.post@n6.nabble.com>
Message-ID: <201611172211.09673.even.rouault@spatialys.com>

Le jeudi 17 novembre 2016 21:37:52, esacree a écrit :
> Which version of libCurl is recommended for use with GDAL 2.1.2 and the
> GDAL_WMTS driver?

None in particular. Should hopefully work will all of them issued in the last 
5 years.

> 
> We have been using libCurl version 7.45 dated 7-Oct-2016.  The newest
> version is 7.51 dated 2-Nov-2016.  7.51 contains a very long list of fixes.
> The upgrade could be time consuming to rebuild everything.  We thought we
> should ask if it is needed for GDAL_WMTS.  It appears to be set up
> correctly but the WMTS server returns transparent images.  That could
> indicate an HTTP issue with libCurl.

I doubt it. You could enable CPL_DEBUG=HTTP as env. variable to display the 
URLs of the images that are downloaded. Paste them in a browser: if the images 
are transparent as well, then the issue is on the server side. Or more 
presumably the server works fine but you are requesting in an area without 
data, or at a zoom level where it has no data.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Thu Nov 17 13:21:27 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 17 Nov 2016 22:21:27 +0100
Subject: [gdal-dev] Index Tiling Questions for WMTS, Bing, Google/TMS
In-Reply-To: <1479416027406-5296337.post@n6.nabble.com>
References: <1479416027406-5296337.post@n6.nabble.com>
Message-ID: <201611172221.27956.even.rouault@spatialys.com>

Le jeudi 17 novembre 2016 21:53:47, esacree a écrit :
> A few questions based on the GDAL examples for Google, Bing/VirtualEarth
> and WMTS tile servers.
> 
> 1.  Google Maps has the tile/image origin in the upper left corner.  TMS
> has the tile image origin in the lower left corner.   Where should the
> tile/image origin be for Google maps when using the GDAL_WMS driver with
> the TMS service?  Does it use the Google Maps tile origin or the TMS tile
> origin?

See the example mentionned in http://gdal.org/frmt_wms.html :
http://gdal.org/frmt_wms_googlemaps_tms.xml

==> <YOrigin>top</YOrigin>


> 
> 2.  For WMTS where is the image origin?  I've read that the origin is at
> the lower left corner as for TMS. Is this correct?

No, this is top-left. See http://www.opengeospatial.org/standards/wmts page 9 
:
"Each tile in a tile matrix is identified by its TileCol and TileRow indices 
that have their
0,0 origin in the tile next to the top left corner of the tile matrix and that 
increases
towards the right and towards the bottom respectively, as shown in figure 2."


> 
> 3.  For the USGS NationalMap WMTS servers there are 2 TileMatrixSets.  One
> is default0028nm and the other is the GoogleMapsCompatible tile matrix set.
> Should both tile matrix sets be indexed the same way?

Yes ? Not sure to understand. The way WMTS works is the same of course 
whatever the tile matrix set, but indices will possibly change. That's an 
implementation detail anyway that you shouldn't care about when using the GDAL 
driver.

> 
> 3.  For Bing/VirtualEarth the GDAL example is extremely brief.  It doesn't
> show a data window or tile counts in the example.  A look at the
> minidriver_virtualearth.cpp file doesn't help.  How do you get
> Bing/VirtualEarth to retrieve more than one tile at a time?

Looking quickly at the VirtualEarth example, there's nothing particular to do 
in the definition once you've set the URL.

$ gdal_translate http://gdal.org/frmt_wms_virtualearth.xml out.tif \
		-outsize 1024 1024 --debug HTTP

HTTP: Fetch(http://gdal.org/frmt_wms_virtualearth.xml)
Input file size is 134217728, 134217728
0HTTP: Requesting [1/4] 
http://a2.ortho.tiles.virtualearth.net/tiles/a00.jpeg?g=90
HTTP: Requesting [2/4] 
http://a3.ortho.tiles.virtualearth.net/tiles/a01.jpeg?g=90
HTTP: Requesting [3/4] 
http://a0.ortho.tiles.virtualearth.net/tiles/a10.jpeg?g=90
HTTP: Requesting [4/4] 
http://a1.ortho.tiles.virtualearth.net/tiles/a11.jpeg?g=90
HTTP: Request [0] http://a2.ortho.tiles.virtualearth.net/tiles/a00.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [1] http://a3.ortho.tiles.virtualearth.net/tiles/a01.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [2] http://a0.ortho.tiles.virtualearth.net/tiles/a10.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [3] http://a1.ortho.tiles.virtualearth.net/tiles/a11.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
...10...20..HTTP: Requesting [1/4] 
http://a3.ortho.tiles.virtualearth.net/tiles/a02.jpeg?g=90
HTTP: Requesting [2/4] 
http://a0.ortho.tiles.virtualearth.net/tiles/a03.jpeg?g=90
HTTP: Requesting [3/4] 
http://a1.ortho.tiles.virtualearth.net/tiles/a12.jpeg?g=90
HTTP: Requesting [4/4] 
http://a2.ortho.tiles.virtualearth.net/tiles/a13.jpeg?g=90
HTTP: Request [0] http://a3.ortho.tiles.virtualearth.net/tiles/a02.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [1] http://a0.ortho.tiles.virtualearth.net/tiles/a03.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [2] http://a1.ortho.tiles.virtualearth.net/tiles/a12.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [3] http://a2.ortho.tiles.virtualearth.net/tiles/a13.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
.30...40...50HTTP: Requesting [1/4] 
http://a0.ortho.tiles.virtualearth.net/tiles/a20.jpeg?g=90
HTTP: Requesting [2/4] 
http://a1.ortho.tiles.virtualearth.net/tiles/a21.jpeg?g=90
HTTP: Requesting [3/4] 
http://a2.ortho.tiles.virtualearth.net/tiles/a30.jpeg?g=90
HTTP: Requesting [4/4] 
http://a3.ortho.tiles.virtualearth.net/tiles/a31.jpeg?g=90
HTTP: Request [0] http://a0.ortho.tiles.virtualearth.net/tiles/a20.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [1] http://a1.ortho.tiles.virtualearth.net/tiles/a21.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [2] http://a2.ortho.tiles.virtualearth.net/tiles/a30.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [3] http://a3.ortho.tiles.virtualearth.net/tiles/a31.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
...60...70..HTTP: Requesting [1/4] 
http://a1.ortho.tiles.virtualearth.net/tiles/a22.jpeg?g=90
HTTP: Requesting [2/4] 
http://a2.ortho.tiles.virtualearth.net/tiles/a23.jpeg?g=90
HTTP: Requesting [3/4] 
http://a3.ortho.tiles.virtualearth.net/tiles/a32.jpeg?g=90
HTTP: Requesting [4/4] 
http://a0.ortho.tiles.virtualearth.net/tiles/a33.jpeg?g=90
HTTP: Request [0] http://a1.ortho.tiles.virtualearth.net/tiles/a22.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [1] http://a2.ortho.tiles.virtualearth.net/tiles/a23.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [2] http://a3.ortho.tiles.virtualearth.net/tiles/a32.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
HTTP: Request [3] http://a0.ortho.tiles.virtualearth.net/tiles/a33.jpeg?g=90 : 
status = 200, content type = image/jpeg, error = (null)
.80...90...100 - done.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From issworld2000 at yahoo.com  Thu Nov 17 13:20:02 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Thu, 17 Nov 2016 21:20:02 +0000 (UTC)
Subject: [gdal-dev] Why are fields required in osmconf.ini file?
References: <1439833652.2357388.1479417602055.ref@mail.yahoo.com>
Message-ID: <1439833652.2357388.1479417602055@mail.yahoo.com>

Hello,

When converting an .osm file to .shp files with ogr2ogr.exe, one needs to define a list of required fields (keys) in gdal-data\osmconf.ini file, for each geometry type (points, lines, multipolygons, multilinestrings).Like so (labelled in red color):
[points]#common attributesosm_id=yesosm_version=noosm_timestamp=noosm_uid=noosm_user=noosm_changeset=no #keys to report as OGR fieldsattributes=name,barrier,highway,ref,address,is_in,place,man_made
Why is that so? Why do field names need to be predefined before their extraction from the .osm file?

Why can't only those fields which already exist in the .osm file, be extracted?


Thank you for the reply.

Kind regards,
Djordje Spasic

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161117/e1af7b1d/attachment-0001.html>

From even.rouault at spatialys.com  Thu Nov 17 13:31:10 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 17 Nov 2016 22:31:10 +0100
Subject: [gdal-dev] Why are fields required in osmconf.ini file?
In-Reply-To: <1439833652.2357388.1479417602055@mail.yahoo.com>
References: <1439833652.2357388.1479417602055.ref@mail.yahoo.com>
 <1439833652.2357388.1479417602055@mail.yahoo.com>
Message-ID: <201611172231.10810.even.rouault@spatialys.com>

Le jeudi 17 novembre 2016 22:20:02, Djordje Spasic a écrit :
> Hello,
> 
> When converting an .osm file to .shp files with ogr2ogr.exe, one needs to
> define a list of required fields (keys) in gdal-data\osmconf.ini file, for
> each geometry type (points, lines, multipolygons, multilinestrings).Like
> so (labelled in red color): [points]#common
> attributesosm_id=yesosm_version=noosm_timestamp=noosm_uid=noosm_user=noosm
> _changeset=no #keys to report as OGR
> fieldsattributes=name,barrier,highway,ref,address,is_in,place,man_made Why
> is that so? Why do field names need to be predefined before their
> extraction from the .osm file?
> 
> Why can't only those fields which already exist in the .osm file, be
> extracted?

That would require doing 2 read passes of the file to determine which fields 
exist. There's no header mentionning which fields are used. The whole file has 
to be read.

> 
> 
> Thank you for the reply.
> 
> Kind regards,
> Djordje Spasic

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From issworld2000 at yahoo.com  Thu Nov 17 13:34:20 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Thu, 17 Nov 2016 21:34:20 +0000 (UTC)
Subject: [gdal-dev] Why are fields required in osmconf.ini file?
In-Reply-To: <201611172231.10810.even.rouault@spatialys.com>
References: <1439833652.2357388.1479417602055.ref@mail.yahoo.com>
 <1439833652.2357388.1479417602055@mail.yahoo.com>
 <201611172231.10810.even.rouault@spatialys.com>
Message-ID: <1993499212.2329738.1479418460584@mail.yahoo.com>

Thank you for the quick reply Even!

So this required predefined set of fields is a necessary step for any .osm file conversion with ogr2ogr.exe?
Not only conversion from .osm to .shp?
But also to .pbf, geojson etc. ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161117/d5279822/attachment.html>

From naoliv at gmail.com  Thu Nov 17 19:28:07 2016
From: naoliv at gmail.com (Nelson A. de Oliveira)
Date: Fri, 18 Nov 2016 01:28:07 -0200
Subject: [gdal-dev] Converting MULTILINESTRING to LINESTRING
Message-ID: <CAARFvTUgn3Tgn5o63_mT=iLg+=wiK8S-shCK=GThWdiC0-RZTQ@mail.gmail.com>

Hi!

Sorry if it's not the appropriated place to ask this, but is there a
way to convert MULTILINESTRING to LINESTRING?
For example:

=====
ogr2ogr -f "SQLite" -gt 65536 -dsco SPATIALITE=YES database.sqlite shape.shp
ERROR 1: Cannot insert feature with geometry of type MULTILINESTRING
in column GEOMETRY. Type LINESTRING expected
ERROR 1: Unable to write feature 178 from layer merged.
ERROR 1: Terminating translation prematurely after failed
translation of layer merged (use -skipfailures to skip errors)
=====

I don't want to skip the features, but convert them.

I could open the shapefile in QGIS and use "Multipart to Singleparts",
but it will be a non-automatic and non-cli step.
Is there a way to do this with ogr2ogr (or other related tool), please?

Thank you!

Best regards,
Nelson

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 17 23:54:49 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 18 Nov 2016 00:54:49 -0700 (MST)
Subject: [gdal-dev] Why are fields required in osmconf.ini file?
In-Reply-To: <1993499212.2329738.1479418460584@mail.yahoo.com>
References: <1439833652.2357388.1479417602055@mail.yahoo.com>
 <201611172231.10810.even.rouault@spatialys.com>
 <1993499212.2329738.1479418460584@mail.yahoo.com>
Message-ID: <1479455689300-5296397.post@n6.nabble.com>

georges wrote
> Thank you for the quick reply Even!
> 
> So this required predefined set of fields is a necessary step for any .osm
> file conversion with ogr2ogr.exe?
> Not only conversion from .osm to .shp?
> But also to .pbf, geojson etc. ?

Only exception and highly recommended if you want to get all the tags is to
use PostGIS and "all_tags" which puts everything into hstore:

ogr2ogr -f PostgreSQL "PG:dbname=osm" test.pbf -lco
COLUMN_TYPES=all_tags=hstore

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Why-are-fields-required-in-osmconf-ini-file-tp5296342p5296397.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 18 00:01:09 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 18 Nov 2016 01:01:09 -0700 (MST)
Subject: [gdal-dev] Converting MULTILINESTRING to LINESTRING
In-Reply-To: <CAARFvTUgn3Tgn5o63_mT=iLg+=wiK8S-shCK=GThWdiC0-RZTQ@mail.gmail.com>
References: <CAARFvTUgn3Tgn5o63_mT=iLg+=wiK8S-shCK=GThWdiC0-RZTQ@mail.gmail.com>
Message-ID: <1479456069985-5296402.post@n6.nabble.com>

Nelson A. de Oliveira wrote
> Hi!
> 
> Sorry if it's not the appropriated place to ask this, but is there a
> way to convert MULTILINESTRING to LINESTRING?
> For example:
> 
> =====
> ogr2ogr -f "SQLite" -gt 65536 -dsco SPATIALITE=YES database.sqlite
> shape.shp
> ERROR 1: Cannot insert feature with geometry of type MULTILINESTRING
> in column GEOMETRY. Type LINESTRING expected
> ERROR 1: Unable to write feature 178 from layer merged.
> ERROR 1: Terminating translation prematurely after failed
> translation of layer merged (use -skipfailures to skip errors)
> =====
> 
> I don't want to skip the features, but convert them.
> 
> I could open the shapefile in QGIS and use "Multipart to Singleparts",
> but it will be a non-automatic and non-cli step.
> Is there a way to do this with ogr2ogr (or other related tool), please?
> 
> Thank you!
> 
> Best regards,
> Nelson

If you want to write all that you have in the shapefile into Spatialite, use
ogr2ogr with switch -nlt PROMOTE_TO_MULTI. Obviously your shapefile contains
a mixture of linestrings and multilinestrings. However, if you want to
explode multilinestrings into linestrings use switch -explodecollections.
Both are documented in http://www.gdal.org/ogr2ogr.html.




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Converting-MULTILINESTRING-to-LINESTRING-tp5296370p5296402.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From issworld2000 at yahoo.com  Fri Nov 18 01:17:41 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 18 Nov 2016 09:17:41 +0000 (UTC)
Subject: [gdal-dev] Why are fields required in osmconf.ini file?
In-Reply-To: <1479455689300-5296397.post@n6.nabble.com>
References: <1439833652.2357388.1479417602055@mail.yahoo.com>
 <201611172231.10810.even.rouault@spatialys.com>
 <1993499212.2329738.1479418460584@mail.yahoo.com>
 <1479455689300-5296397.post@n6.nabble.com>
Message-ID: <2092404119.2674144.1479460661500@mail.yahoo.com>

Thank you for the useful reply Jukka!

The command you gave me:

ogr2ogr -f PostgreSQL "PG:dbname=osm" test.pbf -lco
COLUMN_TYPES=all_tags=hstore
does the same thing as "all_tags=yes" in the osmconf.ini file:

# uncomment to create "all_tags" field. "all_tags" and "other_tags" are exclusive
all_tags=yes
?

If not, then what is the difference between these two?
 

    On Friday, November 18, 2016 8:55 AM, jratike80 <jukka.rahkonen at maanmittauslaitos.fi> wrote:
 

 georges wrote
> Thank you for the quick reply Even!
> 
> So this required predefined set of fields is a necessary step for any .osm
> file conversion with ogr2ogr.exe?
> Not only conversion from .osm to .shp?
> But also to .pbf, geojson etc. ?

Only exception and highly recommended if you want to get all the tags is to
use PostGIS and "all_tags" which puts everything into hstore:

ogr2ogr -f PostgreSQL "PG:dbname=osm" test.pbf -lco
COLUMN_TYPES=all_tags=hstore

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Why-are-fields-required-in-osmconf-ini-file-tp5296342p5296397.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman/listinfo/gdal-dev

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161118/30ad61af/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 18 01:33:26 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 18 Nov 2016 09:33:26 +0000
Subject: [gdal-dev] Why are fields required in osmconf.ini file?
Message-ID: <d741dd21b4454a0ea274a731ee93f3f0@C119S212VM022.msvyvi.vaha.local>

You need to have both: include all_tags in osmconf.ini and define with the ogr2ogr command that field “all_tags” in PostGIS should be initialized as hstore. If you do not define column type all_tags will probably become text type column. Make a test and you will see it.

-Jukka Rahkonen-

Djordje Spasic wrote:

Re: [gdal-dev] Why are fields required in osmconf.ini file?

Thank you for the useful reply Jukka!

The command you gave me:

ogr2ogr -f PostgreSQL "PG:dbname=osm" test.pbf -lco
COLUMN_TYPES=all_tags=hstore
does the same thing as "all_tags=yes" in the osmconf.ini file:

# uncomment to create "all_tags" field. "all_tags" and "other_tags" are exclusive
all_tags=yes
?

If not, then what is the difference between these two?

On Friday, November 18, 2016 8:55 AM, jratike80 <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:

georges wrote

> Thank you for the quick reply Even!
>
> So this required predefined set of fields is a necessary step for any .osm
> file conversion with ogr2ogr.exe?
> Not only conversion from .osm to .shp?
> But also to .pbf, geojson etc. ?


Only exception and highly recommended if you want to get all the tags is to
use PostGIS and "all_tags" which puts everything into hstore:

ogr2ogr -f PostgreSQL "PG:dbname=osm" test.pbf -lco
COLUMN_TYPES=all_tags=hstore

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Why-are-fields-required-in-osmconf-ini-file-tp5296342p5296397.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161118/3b37a84c/attachment-0001.html>

From sean at mapbox.com  Fri Nov 18 02:09:27 2016
From: sean at mapbox.com (Sean Gillies)
Date: Fri, 18 Nov 2016 11:09:27 +0100
Subject: [gdal-dev] xtensor: C++ multi-dimensional arrays with broadcasting
	and lazy computing
Message-ID: <CADPhZXzngv+5GAVdypwD8NX=iHTRkXr_=U9gT1gTFk46pxOKfw@mail.gmail.com>

Ari and all,

When I saw the announcement of https://github.com/QuantStack/xtensor I
immediately thought of recent conversations here. Maybe worth a look?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161118/b09d5f9e/attachment.html>

From naoliv at gmail.com  Fri Nov 18 05:53:06 2016
From: naoliv at gmail.com (Nelson A. de Oliveira)
Date: Fri, 18 Nov 2016 11:53:06 -0200
Subject: [gdal-dev] Converting MULTILINESTRING to LINESTRING
In-Reply-To: <1479456069985-5296402.post@n6.nabble.com>
References: <CAARFvTUgn3Tgn5o63_mT=iLg+=wiK8S-shCK=GThWdiC0-RZTQ@mail.gmail.com>
 <1479456069985-5296402.post@n6.nabble.com>
Message-ID: <CAARFvTUSsFuTqotQ+hC4D5fdud5evgzAJkbUoO_v8AC6zPv8rw@mail.gmail.com>

Hi!

On Fri, Nov 18, 2016 at 6:01 AM, jratike80
<jukka.rahkonen at maanmittauslaitos.fi> wrote:
> However, if you want to
> explode multilinestrings into linestrings use switch -explodecollections.

This one.
I wasn't seeing an explanation for this in "ogr2ogr --long-usage" (it
seems that I need to read more the full manual)

Thank you!

Best regards,
Nelson

From issworld2000 at yahoo.com  Fri Nov 18 07:25:31 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Fri, 18 Nov 2016 15:25:31 +0000 (UTC)
Subject: [gdal-dev] Why are fields required in osmconf.ini file?
In-Reply-To: <d741dd21b4454a0ea274a731ee93f3f0@C119S212VM022.msvyvi.vaha.local>
References: <d741dd21b4454a0ea274a731ee93f3f0@C119S212VM022.msvyvi.vaha.local>
Message-ID: <229762109.2900630.1479482731029@mail.yahoo.com>

Thank you Jukka.

Can the command you gave me:

ogr2ogr -f PostgreSQL "PG:dbname=osm" test.pbf -lco
COLUMN_TYPES=all_tags=hstore

be edited so that the output file is a .shp instead of .pbf?
"C:\gdal\ogr2ogr.exe" --config OSM_USE_CUSTOM_INDEXING NO -skipfailures -f "ESRI Shapefile" -f PostgreSQL "PG:dbname=osm" "C:\output.osm" -lco COLUMN_TYPES=all_tags=hstore

?

I am converting an .osm to .shp files.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161118/63a129c2/attachment.html>

From issworld2000 at yahoo.com  Fri Nov 18 17:30:41 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Sat, 19 Nov 2016 01:30:41 +0000 (UTC)
Subject: [gdal-dev] identifying the fields from the .osm file
References: <103690806.11821.1479519041764.ref@mail.yahoo.com>
Message-ID: <103690806.11821.1479519041764@mail.yahoo.com>

During the last couple of days, both Jukka and Even helped me with some .osm file issues. And I am grateful on that.

I would like to ask one more question, if that's ok:
Is it possible to open an .osm file through ogr2ogr.exe and somehow read all the fields (keys) used in that .osm file? The final list of those fields do not have to be unique, they can repeat.
Is it possible to somehow save all those fields to a .shp or .txt file through ogr2ogr.exe?

Thank you for the reply.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/808ecadf/attachment.html>

From etienne.trimaille at gmail.com  Fri Nov 18 17:39:51 2016
From: etienne.trimaille at gmail.com (Etienne Trimaille)
Date: Sat, 19 Nov 2016 08:39:51 +0700
Subject: [gdal-dev] identifying the fields from the .osm file
In-Reply-To: <103690806.11821.1479519041764@mail.yahoo.com>
References: <103690806.11821.1479519041764.ref@mail.yahoo.com>
 <103690806.11821.1479519041764@mail.yahoo.com>
Message-ID: <CAMtDFL+eah2Cg7zE=y3dX7Z6fxMXK5TYMNCTa-ry0czOs6G=pQ@mail.gmail.com>

Hi,

With ogr2ogr, you can't read all keys from an OSM file.

As Even said, you have to use another loop to read all available keys in
the file. You can have a look at the QGIS QuickOSM plugin. You can open a
OSM file and ask the plugin to read all keys available in the file.

2016-11-19 8:30 GMT+07:00 Djordje Spasic <issworld2000 at yahoo.com>:

> During the last couple of days, both Jukka and Even helped me with some
> .osm file issues. And I am grateful on that.
>
> I would like to ask one more question, if that's ok:
> Is it possible to open an .osm file through ogr2ogr.exe and somehow read
> all the fields (keys) used in that .osm file? The final list of those
> fields do not have to be unique, they can repeat.
> Is it possible to somehow save all those fields to a .shp or .txt file
> through ogr2ogr.exe?
>
> Thank you for the reply.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/5cc83702/attachment.html>

From issworld2000 at yahoo.com  Sat Nov 19 01:57:57 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Sat, 19 Nov 2016 09:57:57 +0000 (UTC)
Subject: [gdal-dev] identifying the fields from the .osm file
In-Reply-To: <CAMtDFL+eah2Cg7zE=y3dX7Z6fxMXK5TYMNCTa-ry0czOs6G=pQ@mail.gmail.com>
References: <103690806.11821.1479519041764.ref@mail.yahoo.com>
 <103690806.11821.1479519041764@mail.yahoo.com>
 <CAMtDFL+eah2Cg7zE=y3dX7Z6fxMXK5TYMNCTa-ry0czOs6G=pQ@mail.gmail.com>
Message-ID: <1757149020.118575.1479549477506@mail.yahoo.com>

Thank you for the quick reply Etienne!

I am stuck with ogr2ogr.exe, or GDAL C# libraries. I can not use QGIS or other applications.
Indeed Even told me that identifying all fields in the .osm file, would require doing 2 read passes of the .osm file.
I thought that maybe there is a way of doing exactly that, where in the first read I would get all the fields, find only those that are unique, and then perform a second read by setting these fields in the osmconf.ini file? 

    On Saturday, November 19, 2016 2:40 AM, Etienne Trimaille <etienne.trimaille at gmail.com> wrote:
 

 Hi,
With ogr2ogr, you can't read all keys from an OSM file.
As Even said, you have to use another loop to read all available keys in the file. You can have a look at the QGIS QuickOSM plugin. You can open a OSM file and ask the plugin to read all keys available in the file.
2016-11-19 8:30 GMT+07:00 Djordje Spasic <issworld2000 at yahoo.com>:

During the last couple of days, both Jukka and Even helped me with some .osm file issues. And I am grateful on that.

I would like to ask one more question, if that's ok:
Is it possible to open an .osm file through ogr2ogr.exe and somehow read all the fields (keys) used in that .osm file? The final list of those fields do not have to be unique, they can repeat.
Is it possible to somehow save all those fields to a .shp or .txt file through ogr2ogr.exe?

Thank you for the reply.

______________________________ _________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman /listinfo/gdal-dev




   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/54a21dfc/attachment.html>

From bishop.dev at gmail.com  Sat Nov 19 05:52:09 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Sat, 19 Nov 2016 16:52:09 +0300
Subject: [gdal-dev] CAD (DWG) Driver
Message-ID: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>

Hi,

I fixed all reported by Even and Kurt errors and recommendations in CAD 
(DWG) driver and most of recommendations in OpenCAD library. The pull 
request (https://github.com/OSGeo/gdal/pull/164) passed all the checks 
successful. It seems to me the driver is ready to merge to the trunk. 
This will simplify testing and reviewing the new driver by community.

There are some problems in big_endian and xcode CI tests, because of 
C++11 compiler flags (not a problem of CAD driver code, etc.) - I 
disable C++11 (and appropriate the CAD driver too) in this tests. It 
seems to me that not blocking issue and I can merge the code to trunk.

Are there any objections?

Just a note: the OpenCAD library and GDAL CAD driver were developed 
during Google Summer of Code 2016.

-- 
Best regards,
     Dmitry

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/4c56f86b/attachment.html>

From even.rouault at spatialys.com  Sat Nov 19 06:18:22 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 19 Nov 2016 15:18:22 +0100
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
Message-ID: <1831867.Mghkbx2Czi@even-i700>

On samedi 19 novembre 2016 16:52:09 CET Dmitry Baryshnikov wrote:
> Hi,
> 
> I fixed all reported by Even and Kurt errors and recommendations in CAD
> (DWG) driver and most of recommendations in OpenCAD library. The pull
> request (https://github.com/OSGeo/gdal/pull/164) passed all the checks
> successful. It seems to me the driver is ready to merge to the trunk.
> This will simplify testing and reviewing the new driver by community.
> 
> There are some problems in big_endian and xcode CI tests, because of
> C++11 compiler flags (not a problem of CAD driver code, etc.) - I
> disable C++11 (and appropriate the CAD driver too) in this tests. It
> seems to me that not blocking issue and I can merge the code to trunk.
> 
> Are there any objections?

Massive +1

I've just noticed your comment https://github.com/OSGeo/gdal/pull/
164#issuecomment-261525037 about the issue with C++11 in the GeoTIFF driver. 
I've just fixed that code, so you can now likely re-enable C++11 in the 
big_endian and mac envs


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Sat Nov 19 07:24:52 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 19 Nov 2016 16:24:52 +0100
Subject: [gdal-dev] Changing layer name of GeoJSON datasets
Message-ID: <6520911.KhM1kxATtH@even-i700>

Hi

Currently the GeoJSON datasource always return "OGRGeoJSON" as a layer name, 
which is quite boring (if you convert the geojson into a multi-layer capable 
dataousrce, you always have to rename the layer to something more meaningful)

I'd consider changing that to take the basename of the datasource, ie "my" if 
the filename is "/path/to/my.geojson". This would be similar to many other 
drivers like Shapefile, CSV, MapInfo File, JML ... (ie drivers with a single 
layer per file)

For URLS coming from HTTP services with query parameters "?foo=bar&...", we 
would likely keep the "OGRGeoJSON" name.

I'd also consider adding and reading a "name" extension member in the 
FeatureCollection object to store/retrieve the layer name. This would have the 
priority over the filename based rule when it exists.

{
	"type": "FeatureCollection",
	"name": "layer_name",
	"features": [
	}
}

Thoughts ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From landa.martin at gmail.com  Sat Nov 19 07:34:16 2016
From: landa.martin at gmail.com (Martin Landa)
Date: Sat, 19 Nov 2016 16:34:16 +0100
Subject: [gdal-dev] ogr2ogr PG->SHP lacks EPSG code
In-Reply-To: <201611131329.34162.even.rouault@spatialys.com>
References: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>
 <201611111856.37508.even.rouault@spatialys.com>
 <CA+Ei1Oe7eqP3MojkDyvae0gw2=a4u2iaJsi47nGVKO7FXLNvOA@mail.gmail.com>
 <201611131329.34162.even.rouault@spatialys.com>
Message-ID: <CA+Ei1OcK-QB5Bar41KmKB9vvGam6L5VwKmcCyDiON_rHh9Na8w@mail.gmail.com>

Hi,

2016-11-13 13:29 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:

thanks for detailed insight. BTW, ogr2ogr couldn't also generates .qpj
when srs epgs code is given?

Martrin

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From jmckenna at gatewaygeomatics.com  Sat Nov 19 07:42:29 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Sat, 19 Nov 2016 11:42:29 -0400
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
Message-ID: <c0d6a7d7-8cfb-51d3-7407-072ca8ab6469@gatewaygeomatics.com>

On 2016-11-19 9:52 AM, Dmitry Baryshnikov wrote:
> Hi,
>
> I fixed all reported by Even and Kurt errors and recommendations in CAD
> (DWG) driver and most of recommendations in OpenCAD library. The pull
> request (https://github.com/OSGeo/gdal/pull/164) passed all the checks
> successful. It seems to me the driver is ready to merge to the trunk.
> This will simplify testing and reviewing the new driver by community.
>
> There are some problems in big_endian and xcode CI tests, because of
> C++11 compiler flags (not a problem of CAD driver code, etc.)  - I
> disable C++11 (and appropriate the CAD driver too) in this tests. It
> seems to me that not blocking issue and I can merge the code to trunk.
>
> Are there any objections?
>
> Just a note: the OpenCAD library and GDAL CAD driver were developed
> during Google Summer of Code 2016.
>

Could you also be sure to document this driver (and its build steps for 
unix and windows) at https://trac.osgeo.org/gdal/wiki/BuildHints ?  You 
could list your driver there with the others in the section "External 
Library Issues"

Thanks!

-jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From even.rouault at spatialys.com  Sat Nov 19 07:48:30 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 19 Nov 2016 16:48:30 +0100
Subject: [gdal-dev] ogr2ogr PG->SHP lacks EPSG code
In-Reply-To: <CA+Ei1OcK-QB5Bar41KmKB9vvGam6L5VwKmcCyDiON_rHh9Na8w@mail.gmail.com>
References: <CA+Ei1Od0kVJwBdGWMETNb=8T88cLMYiiO2enpRL-eLpMh7fKrg@mail.gmail.com>
 <201611131329.34162.even.rouault@spatialys.com>
 <CA+Ei1OcK-QB5Bar41KmKB9vvGam6L5VwKmcCyDiON_rHh9Na8w@mail.gmail.com>
Message-ID: <2848313.QNIVCC9sAk@even-i700>

On samedi 19 novembre 2016 16:34:16 CET Martin Landa wrote:
> Hi,
> 
> 2016-11-13 13:29 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:
> 
> thanks for detailed insight. BTW, ogr2ogr couldn't also generates .qpj
> when srs epgs code is given?

It could certainly do this, but the question is more: should it do it ? Adding 
another file in addition to the already many ones generated doesn't sound very 
appealing. And then on the reading side, you'd have the question of which of 
.qpj and .prj is prioritary (I guess .qpj would be prioritary)?

For something completely unrelated, I've a bit improved the reading of .prj 
file as GDAL SRS by calling AutoIdentifyEPSG() ( http://www.gdal.org/
classOGRSpatialReference.html#acb0373c83927bfd694048da6f79e33ea ), which can 
help retrieving the EPSG code for the most common SRS (very few ones, don't be 
too enthousiastic!)
Anyway while looking at that, I saw a mention in the code to https://
trac.osgeo.org/gdal/ticket/6485, which mentions .prj files with EPSG codes in 
them. I'm not sure what has generated those .prj files, but I'm wondering what 
would be the consequence of OGR keeping the EPSG code in a .prj file (while 
still "morphing" SRS names, datum names, projection names and projection 
parameters like we do). Would ESRI software (and others) choke on that ?

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From etienne.trimaille at gmail.com  Sat Nov 19 08:09:06 2016
From: etienne.trimaille at gmail.com (Etienne Trimaille)
Date: Sat, 19 Nov 2016 23:09:06 +0700
Subject: [gdal-dev] identifying the fields from the .osm file
In-Reply-To: <1757149020.118575.1479549477506@mail.yahoo.com>
References: <103690806.11821.1479519041764.ref@mail.yahoo.com>
 <103690806.11821.1479519041764@mail.yahoo.com>
 <CAMtDFL+eah2Cg7zE=y3dX7Z6fxMXK5TYMNCTa-ry0czOs6G=pQ@mail.gmail.com>
 <1757149020.118575.1479549477506@mail.yahoo.com>
Message-ID: <CAMtDFLJHCLXiUpKPrjCYkh1az6OREuZvN-y7+F=gANPdxqFi1Q@mail.gmail.com>

The parsing is done using python in the plugin. We can just use the parser
by calling the python file. Python is included when you install osgeo4w.

Yes you can set the osmconf.ini or directly use the goal ogr api to write
the output file.

On 19 Nov 2016 18:00, "Djordje Spasic" <issworld2000 at yahoo.com> wrote:

> Thank you for the quick reply Etienne!
>
> I am stuck with ogr2ogr.exe, or GDAL C# libraries. I can not use QGIS or
> other applications.
>
> Indeed Even told me that identifying all fields in the .osm file, would
> require doing 2 read passes of the .osm file.
> I thought that maybe there is a way of doing exactly that, where in the
> first read I would get all the fields, find only those that are unique, and
> then perform a second read by setting these fields in the osmconf.ini file?
>
>
> On Saturday, November 19, 2016 2:40 AM, Etienne Trimaille <
> etienne.trimaille at gmail.com> wrote:
>
>
> Hi,
>
> With ogr2ogr, you can't read all keys from an OSM file.
>
> As Even said, you have to use another loop to read all available keys in
> the file. You can have a look at the QGIS QuickOSM plugin. You can open a
> OSM file and ask the plugin to read all keys available in the file.
>
> 2016-11-19 8:30 GMT+07:00 Djordje Spasic <issworld2000 at yahoo.com>:
>
> During the last couple of days, both Jukka and Even helped me with some
> .osm file issues. And I am grateful on that.
>
> I would like to ask one more question, if that's ok:
> Is it possible to open an .osm file through ogr2ogr.exe and somehow read
> all the fields (keys) used in that .osm file? The final list of those
> fields do not have to be unique, they can repeat.
> Is it possible to somehow save all those fields to a .shp or .txt file
> through ogr2ogr.exe?
>
> Thank you for the reply.
>
> ______________________________ _________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman /listinfo/gdal-dev
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/0cfd4dcd/attachment.html>

From bishop.dev at gmail.com  Sat Nov 19 08:14:24 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Sat, 19 Nov 2016 19:14:24 +0300
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <c0d6a7d7-8cfb-51d3-7407-072ca8ab6469@gatewaygeomatics.com>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
 <c0d6a7d7-8cfb-51d3-7407-072ca8ab6469@gatewaygeomatics.com>
Message-ID: <70cc901f-71b1-dab3-b2b1-dd712f4517fd@gmail.com>

Hi Jeff,

This driver has no external dependencies (we use an internal copy of 
OpenCAD library). So it builds without any problem.

Best regards,
     Dmitry

19.11.16 18:42, Jeff McKenna пишет:
> On 2016-11-19 9:52 AM, Dmitry Baryshnikov wrote:
>> Hi,
>>
>> I fixed all reported by Even and Kurt errors and recommendations in CAD
>> (DWG) driver and most of recommendations in OpenCAD library. The pull
>> request (https://github.com/OSGeo/gdal/pull/164) passed all the checks
>> successful. It seems to me the driver is ready to merge to the trunk.
>> This will simplify testing and reviewing the new driver by community.
>>
>> There are some problems in big_endian and xcode CI tests, because of
>> C++11 compiler flags (not a problem of CAD driver code, etc.)  - I
>> disable C++11 (and appropriate the CAD driver too) in this tests. It
>> seems to me that not blocking issue and I can merge the code to trunk.
>>
>> Are there any objections?
>>
>> Just a note: the OpenCAD library and GDAL CAD driver were developed
>> during Google Summer of Code 2016.
>>
>
> Could you also be sure to document this driver (and its build steps 
> for unix and windows) at https://trac.osgeo.org/gdal/wiki/BuildHints 
> ?  You could list your driver there with the others in the section 
> "External Library Issues"
>
> Thanks!
>
> -jeff
>
>
>
>


From bishop.dev at gmail.com  Sat Nov 19 08:34:02 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Sat, 19 Nov 2016 19:34:02 +0300
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <1831867.Mghkbx2Czi@even-i700>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
 <1831867.Mghkbx2Czi@even-i700>
Message-ID: <5808fa45-34f5-103d-8ede-da697afd1acf@gmail.com>

Hi Even,

The big_endian test now is ok. But osx crash at the exiting of python 
after all test finished successfully.

This is error message:

libc++abi.dylib: terminating with uncaught exception of type std::__1::system_error: mutex lock failed: Invalid argument
./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6           python run_all.py

I find out that this may be the result of resources free order:
https://github.com/dmlc/mxnet/issues/309
https://github.com/google/benchmark/issues/52

No idea why this occurred then C++11 used. I'll try to use osx CI test disabling the CAD driver to exclude this possible issue.

Best regards,
     Dmitry

19.11.16 17:18, Even Rouault пишет:
> On samedi 19 novembre 2016 16:52:09 CET Dmitry Baryshnikov wrote:
>> Hi,
>>
>> I fixed all reported by Even and Kurt errors and recommendations in CAD
>> (DWG) driver and most of recommendations in OpenCAD library. The pull
>> request (https://github.com/OSGeo/gdal/pull/164) passed all the checks
>> successful. It seems to me the driver is ready to merge to the trunk.
>> This will simplify testing and reviewing the new driver by community.
>>
>> There are some problems in big_endian and xcode CI tests, because of
>> C++11 compiler flags (not a problem of CAD driver code, etc.) - I
>> disable C++11 (and appropriate the CAD driver too) in this tests. It
>> seems to me that not blocking issue and I can merge the code to trunk.
>>
>> Are there any objections?
> Massive +1
>
> I've just noticed your comment https://github.com/OSGeo/gdal/pull/
> 164#issuecomment-261525037 about the issue with C++11 in the GeoTIFF driver.
> I've just fixed that code, so you can now likely re-enable C++11 in the
> big_endian and mac envs
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/8a1b3041/attachment-0001.html>

From even.rouault at spatialys.com  Sat Nov 19 08:49:25 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 19 Nov 2016 17:49:25 +0100
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <5808fa45-34f5-103d-8ede-da697afd1acf@gmail.com>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
 <1831867.Mghkbx2Czi@even-i700>
 <5808fa45-34f5-103d-8ede-da697afd1acf@gmail.com>
Message-ID: <7873061.FYxrsrM0Qa@even-i700>

On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
> Hi Even,
> 
> The big_endian test now is ok. But osx crash at the exiting of python
> after all test finished successfully.
> 
> This is error message:
> 
> libc++abi.dylib: terminating with uncaught exception of type
> std::__1::system_error: mutex lock failed: Invalid argument
> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6          
> python run_all.py
> 
> I find out that this may be the result of resources free order:
> https://github.com/dmlc/mxnet/issues/309
> https://github.com/google/benchmark/issues/52
> 
> No idea why this occurred then C++11 used. I'll try to use osx CI test
> disabling the CAD driver to exclude this possible issue.
> 

Hum, I think this might be indeed an issue with resource free order between 
the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the 
static C++11 mutex Kurt introduced in
https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd148826d45d9fa9

If this mutex gets destroyed before GDALDestroy() is called, then things might 
indeed crash.

I think we should remove this static C++11 mutex. Kurt ?

(Another option would be to remove the library destructor function. I've the 
feeling they cause more harm than good.)

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From schwehr at gmail.com  Sat Nov 19 10:06:26 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sat, 19 Nov 2016 10:06:26 -0800
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <7873061.FYxrsrM0Qa@even-i700>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
 <1831867.Mghkbx2Czi@even-i700>
 <5808fa45-34f5-103d-8ede-da697afd1acf@gmail.com>
 <7873061.FYxrsrM0Qa@even-i700>
Message-ID: <CACmBxysE_yyRtWmOCc=A6kEPLiwdkpi4k6=HEk8jJVpAuM_9ww@mail.gmail.com>

I'm really not sure.

You can certainly try removing that C++11 mutex.  It was added based on the
comment at that point in the code.  We'll just have to keep an eye out for
possible occasional flakes.  If that's the case, we'll need to carefully
work through the logic and try to figure out a solution that works for
everything.

+1 for getting the driver into the tree.  It will be easier to make
additional changes to either it or GDAL with it in the same tree.

On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
> > Hi Even,
> >
> > The big_endian test now is ok. But osx crash at the exiting of python
> > after all test finished successfully.
> >
> > This is error message:
> >
> > libc++abi.dylib: terminating with uncaught exception of type
> > std::__1::system_error: mutex lock failed: Invalid argument
> > ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
> > python run_all.py
> >
> > I find out that this may be the result of resources free order:
> > https://github.com/dmlc/mxnet/issues/309
> > https://github.com/google/benchmark/issues/52
> >
> > No idea why this occurred then C++11 used. I'll try to use osx CI test
> > disabling the CAD driver to exclude this possible issue.
> >
>
> Hum, I think this might be indeed an issue with resource free order between
> the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
> static C++11 mutex Kurt introduced in
> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
> 26d45d9fa9
>
> If this mutex gets destroyed before GDALDestroy() is called, then things
> might
> indeed crash.
>
> I think we should remove this static C++11 mutex. Kurt ?
>
> (Another option would be to remove the library destructor function. I've
> the
> feeling they cause more harm than good.)
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/da36d65e/attachment.html>

From even.rouault at spatialys.com  Sat Nov 19 10:24:16 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 19 Nov 2016 19:24:16 +0100
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <CACmBxysE_yyRtWmOCc=A6kEPLiwdkpi4k6=HEk8jJVpAuM_9ww@mail.gmail.com>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
 <7873061.FYxrsrM0Qa@even-i700>
 <CACmBxysE_yyRtWmOCc=A6kEPLiwdkpi4k6=HEk8jJVpAuM_9ww@mail.gmail.com>
Message-ID: <1731467.ZNQqGo50XJ@even-i700>

On samedi 19 novembre 2016 10:06:26 CET Kurt Schwehr wrote:
> I'm really not sure.

Not sure that the crash mentionned by Dmitry is related to that ? It looks 
like a really good canditate to me. That's the only C++11 mutex in GDAL, with 
2  other ones in the GeoTIFF driver (and those are likely not triggered at 
process termination)

> 
> You can certainly try removing that C++11 mutex.  It was added based on the
> comment at that point in the code.  We'll just have to keep an eye out for
> possible occasional flakes.  If that's the case, we'll need to carefully
> work through the logic and try to figure out a solution that works for
> everything.

I doubt we will see flakes related to that. The mutex was added to prevent 
races in GDALDestroyDriverManager(), but I'm not aware of code in GDAL and its 
utilities that would call it from several threads. And the function has always 
been documented as thread-unsafe.

> 
> +1 for getting the driver into the tree.  It will be easier to make
> additional changes to either it or GDAL with it in the same tree.
> 
> On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
> > > Hi Even,
> > > 
> > > The big_endian test now is ok. But osx crash at the exiting of python
> > > after all test finished successfully.
> > > 
> > > This is error message:
> > > 
> > > libc++abi.dylib: terminating with uncaught exception of type
> > > std::__1::system_error: mutex lock failed: Invalid argument
> > > ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
> > > python run_all.py
> > > 
> > > I find out that this may be the result of resources free order:
> > > https://github.com/dmlc/mxnet/issues/309
> > > https://github.com/google/benchmark/issues/52
> > > 
> > > No idea why this occurred then C++11 used. I'll try to use osx CI test
> > > disabling the CAD driver to exclude this possible issue.
> > 
> > Hum, I think this might be indeed an issue with resource free order
> > between
> > the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
> > static C++11 mutex Kurt introduced in
> > https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
> > 26d45d9fa9
> > 
> > If this mutex gets destroyed before GDALDestroy() is called, then things
> > might
> > indeed crash.
> > 
> > I think we should remove this static C++11 mutex. Kurt ?
> > 
> > (Another option would be to remove the library destructor function. I've
> > the
> > feeling they cause more harm than good.)
> > 
> > --
> > Spatialys - Geospatial professional services
> > http://www.spatialys.com


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From bishop.dev at gmail.com  Sat Nov 19 11:22:13 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Sat, 19 Nov 2016 22:22:13 +0300
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <1731467.ZNQqGo50XJ@even-i700>
References: <54451b86-7515-9d8f-b7e9-51242f4bab63@gmail.com>
 <7873061.FYxrsrM0Qa@even-i700>
 <CACmBxysE_yyRtWmOCc=A6kEPLiwdkpi4k6=HEk8jJVpAuM_9ww@mail.gmail.com>
 <1731467.ZNQqGo50XJ@even-i700>
Message-ID: <69e67501-5af0-d09a-bf2a-4faed559ad6f@gmail.com>

I commented out the C++11 mutex in gdaldrivermanager.cpp 
<https://github.com/OSGeo/gdal/pull/164/commits/d1449e2eb5a85a6ec2520ad77ee579015fe14197#diff-e3e90e0089f1b70ddf36ebe89a73a733> 
- this helps. OSX CI test passed successfully.

https://travis-ci.org/OSGeo/gdal/jobs/177297023

Best regards,
     Dmitry

19.11.16 21:24, Even Rouault пишет:
> On samedi 19 novembre 2016 10:06:26 CET Kurt Schwehr wrote:
>> I'm really not sure.
> Not sure that the crash mentionned by Dmitry is related to that ? It looks
> like a really good canditate to me. That's the only C++11 mutex in GDAL, with
> 2  other ones in the GeoTIFF driver (and those are likely not triggered at
> process termination)
>
>> You can certainly try removing that C++11 mutex.  It was added based on the
>> comment at that point in the code.  We'll just have to keep an eye out for
>> possible occasional flakes.  If that's the case, we'll need to carefully
>> work through the logic and try to figure out a solution that works for
>> everything.
> I doubt we will see flakes related to that. The mutex was added to prevent
> races in GDALDestroyDriverManager(), but I'm not aware of code in GDAL and its
> utilities that would call it from several threads. And the function has always
> been documented as thread-unsafe.
>
>> +1 for getting the driver into the tree.  It will be easier to make
>> additional changes to either it or GDAL with it in the same tree.
>>
>> On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
>>
>> wrote:
>>> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
>>>> Hi Even,
>>>>
>>>> The big_endian test now is ok. But osx crash at the exiting of python
>>>> after all test finished successfully.
>>>>
>>>> This is error message:
>>>>
>>>> libc++abi.dylib: terminating with uncaught exception of type
>>>> std::__1::system_error: mutex lock failed: Invalid argument
>>>> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
>>>> python run_all.py
>>>>
>>>> I find out that this may be the result of resources free order:
>>>> https://github.com/dmlc/mxnet/issues/309
>>>> https://github.com/google/benchmark/issues/52
>>>>
>>>> No idea why this occurred then C++11 used. I'll try to use osx CI test
>>>> disabling the CAD driver to exclude this possible issue.
>>> Hum, I think this might be indeed an issue with resource free order
>>> between
>>> the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
>>> static C++11 mutex Kurt introduced in
>>> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
>>> 26d45d9fa9
>>>
>>> If this mutex gets destroyed before GDALDestroy() is called, then things
>>> might
>>> indeed crash.
>>>
>>> I think we should remove this static C++11 mutex. Kurt ?
>>>
>>> (Another option would be to remove the library destructor function. I've
>>> the
>>> feeling they cause more harm than good.)
>>>
>>> --
>>> Spatialys - Geospatial professional services
>>> http://www.spatialys.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/78087c6b/attachment.html>

From issworld2000 at yahoo.com  Sat Nov 19 11:45:40 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Sat, 19 Nov 2016 19:45:40 +0000 (UTC)
Subject: [gdal-dev] identifying the fields from the .osm file
In-Reply-To: <CAMtDFLJHCLXiUpKPrjCYkh1az6OREuZvN-y7+F=gANPdxqFi1Q@mail.gmail.com>
References: <103690806.11821.1479519041764.ref@mail.yahoo.com>
 <103690806.11821.1479519041764@mail.yahoo.com>
 <CAMtDFL+eah2Cg7zE=y3dX7Z6fxMXK5TYMNCTa-ry0czOs6G=pQ@mail.gmail.com>
 <1757149020.118575.1479549477506@mail.yahoo.com>
 <CAMtDFLJHCLXiUpKPrjCYkh1az6OREuZvN-y7+F=gANPdxqFi1Q@mail.gmail.com>
Message-ID: <840769665.311796.1479584740697@mail.yahoo.com>

Thank you Etienne.
I am very interested in your reply, but I haven't quite understand you.
The ogr2ogr.exe file is using a particular python script to read the .osm file and identify its unique fields?
Can you be a bit more specific please? Solving this issue will mean a lot to me.
Sorry for disturbance, and thank you for the clarification in advance.Regards,
Djordje


    On Saturday, November 19, 2016 5:09 PM, Etienne Trimaille <etienne.trimaille at gmail.com> wrote:
 

 The parsing is done using python in the plugin. We can just use the parser by calling the python file. Python is included when you install osgeo4w.Yes you can set the osmconf.ini or directly use the goal ogr api to write the output file.
On 19 Nov 2016 18:00, "Djordje Spasic" <issworld2000 at yahoo.com> wrote:

Thank you for the quick reply Etienne!

I am stuck with ogr2ogr.exe, or GDAL C# libraries. I can not use QGIS or other applications.
Indeed Even told me that identifying all fields in the .osm file, would require doing 2 read passes of the .osm file.
I thought that maybe there is a way of doing exactly that, where in the first read I would get all the fields, find only those that are unique, and then perform a second read by setting these fields in the osmconf.ini file? 

    On Saturday, November 19, 2016 2:40 AM, Etienne Trimaille <etienne.trimaille at gmail.com> wrote:
 

 Hi,
With ogr2ogr, you can't read all keys from an OSM file.
As Even said, you have to use another loop to read all available keys in the file. You can have a look at the QGIS QuickOSM plugin. You can open a OSM file and ask the plugin to read all keys available in the file.
2016-11-19 8:30 GMT+07:00 Djordje Spasic <issworld2000 at yahoo.com>:

During the last couple of days, both Jukka and Even helped me with some .osm file issues. And I am grateful on that.

I would like to ask one more question, if that's ok:
Is it possible to open an .osm file through ogr2ogr.exe and somehow read all the fields (keys) used in that .osm file? The final list of those fields do not have to be unique, they can repeat.
Is it possible to somehow save all those fields to a .shp or .txt file through ogr2ogr.exe?

Thank you for the reply.

______________________________ _________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman /listinfo/gdal-dev




   


   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/ebd0edd4/attachment-0001.html>

From andre+joost at nurfuerspam.de  Sun Nov 20 00:18:36 2016
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Sun, 20 Nov 2016 09:18:36 +0100
Subject: [gdal-dev] identifying the fields from the .osm file
In-Reply-To: <840769665.311796.1479584740697@mail.yahoo.com>
References: <103690806.11821.1479519041764.ref@mail.yahoo.com>
 <103690806.11821.1479519041764@mail.yahoo.com>
 <CAMtDFL+eah2Cg7zE=y3dX7Z6fxMXK5TYMNCTa-ry0czOs6G=pQ@mail.gmail.com>
 <1757149020.118575.1479549477506@mail.yahoo.com>
 <CAMtDFLJHCLXiUpKPrjCYkh1az6OREuZvN-y7+F=gANPdxqFi1Q@mail.gmail.com>
 <840769665.311796.1479584740697@mail.yahoo.com>
Message-ID: <o0rm9f$2em$1@blaine.gmane.org>

Am 19.11.2016 um 20:45 schrieb Djordje Spasic:
> Thank you Etienne.
> I am very interested in your reply, but I haven't quite understand you.
> The ogr2ogr.exe file is using a particular python script to read the .osm file and identify its unique fields?
> Can you be a bit more specific please? Solving this issue will mean a lot to me.
> Sorry for disturbance, and thank you for the clarification in advance.Regards,
> Djordje
>

I guess Etienne wants you to visit https://github.com/3liz/QuickOSM 
("the plugin") and look into the python code there to investigate how 
the QuickOSM plugin is able to read the .osm file twice to get the 
complete attribute list.

HTH,
André Joost



From sean at mapbox.com  Sun Nov 20 00:43:19 2016
From: sean at mapbox.com (Sean Gillies)
Date: Sun, 20 Nov 2016 09:43:19 +0100
Subject: [gdal-dev] Changing layer name of GeoJSON datasets
In-Reply-To: <6520911.KhM1kxATtH@even-i700>
References: <6520911.KhM1kxATtH@even-i700>
Message-ID: <CADPhZXzSHQ+q+3EyK5v+jQ3zx8FkTH5AHz=WOkRSrcYB_cvhZA@mail.gmail.com>

Hi Even,

All the above (or below) sounds good to me. Could a "description" member be
added as well?

On Sat, Nov 19, 2016 at 4:24 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi
>
> Currently the GeoJSON datasource always return "OGRGeoJSON" as a layer
> name,
> which is quite boring (if you convert the geojson into a multi-layer
> capable
> dataousrce, you always have to rename the layer to something more
> meaningful)
>
> I'd consider changing that to take the basename of the datasource, ie "my"
> if
> the filename is "/path/to/my.geojson". This would be similar to many other
> drivers like Shapefile, CSV, MapInfo File, JML ... (ie drivers with a
> single
> layer per file)
>
> For URLS coming from HTTP services with query parameters "?foo=bar&...", we
> would likely keep the "OGRGeoJSON" name.
>
> I'd also consider adding and reading a "name" extension member in the
> FeatureCollection object to store/retrieve the layer name. This would have
> the
> priority over the filename based rule when it exists.
>
> {
>         "type": "FeatureCollection",
>         "name": "layer_name",
>         "features": [
>         }
> }
>
> Thoughts ?
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev




-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161120/84231546/attachment.html>

From even.rouault at spatialys.com  Sun Nov 20 09:26:18 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 20 Nov 2016 18:26:18 +0100
Subject: [gdal-dev] Changing layer name of GeoJSON datasets
In-Reply-To: <CADPhZXzSHQ+q+3EyK5v+jQ3zx8FkTH5AHz=WOkRSrcYB_cvhZA@mail.gmail.com>
References: <6520911.KhM1kxATtH@even-i700>
 <CADPhZXzSHQ+q+3EyK5v+jQ3zx8FkTH5AHz=WOkRSrcYB_cvhZA@mail.gmail.com>
Message-ID: <3428131.Fs2vjHPPhI@even-i700>

On dimanche 20 novembre 2016 09:43:19 CET Sean Gillies wrote:
> Hi Even,
> 
> All the above (or below) sounds good to me. Could a "description" member be
> added as well?

Yes. Implemented per https://trac.osgeo.org/gdal/changeset/36339

> 
> On Sat, Nov 19, 2016 at 4:24 PM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > Hi
> > 
> > Currently the GeoJSON datasource always return "OGRGeoJSON" as a layer
> > name,
> > which is quite boring (if you convert the geojson into a multi-layer
> > capable
> > dataousrce, you always have to rename the layer to something more
> > meaningful)
> > 
> > I'd consider changing that to take the basename of the datasource, ie "my"
> > if
> > the filename is "/path/to/my.geojson". This would be similar to many other
> > drivers like Shapefile, CSV, MapInfo File, JML ... (ie drivers with a
> > single
> > layer per file)
> > 
> > For URLS coming from HTTP services with query parameters "?foo=bar&...",
> > we
> > would likely keep the "OGRGeoJSON" name.
> > 
> > I'd also consider adding and reading a "name" extension member in the
> > FeatureCollection object to store/retrieve the layer name. This would have
> > the
> > priority over the filename based rule when it exists.
> > 
> > {
> > 
> >         "type": "FeatureCollection",
> >         "name": "layer_name",
> >         "features": [
> >         }
> > 
> > }
> > 
> > Thoughts ?
> > 
> > Even
> > 
> > --
> > Spatialys - Geospatial professional services
> > http://www.spatialys.com
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > http://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From michael-gdal at michaelzfreeman.org  Sun Nov 20 11:07:58 2016
From: michael-gdal at michaelzfreeman.org (Michael Z Freeman)
Date: Sun, 20 Nov 2016 19:07:58 -0000
Subject: [gdal-dev] Unable to extract features from KML
Message-ID: <80ad2738b3dc5fc601725af0f301f1da.squirrel@server105.webhostingbuzz.com>

Hi,

Even through "ogrinfo" can see all the fields and the features in my KML I
can never get ogr2ogr to actually give me the feature info that I want:
name, description, point, polygon. The only format that actually shows is
JSON but that is a real pain to import into PostGreSQL. CSV and PostGreSQL
get to the "MultiGeometry" KML that contains POINT and POLYGON and then
seem to give up.

I am quite new to GDAL and spent some time working through manuals, FAQ
and did a list search and can only find "Re: missing point in
MultiGeometry KML file" which may be a solution as the answer specifies
having to have "<coordinates>" in triplets and lo and behold the source
KML is missing the "Z" dimension that should be set to 0. However a test I
did adding the third triplet still gives the same results.

Any help very much appreciated.

GDAL 1.11.3, released 2015/09/16

PRIMARY KML FEED (REGIONATED):
http://pirlwww.lpl.arizona.edu/~rbeyer/kml/HiRISE_PDS.kml

KML FEED WEBPAGE: http://rossbeyer.net/science/kml/

EXTRACTED REGION: http://files.michaelzfreeman.org/MC-01-0-0-0.kml

USED COMMANDS:

ogrinfo -ro fields=YES -geom=YES Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml >
ogrinfo_hirise.txt

ogr2ogr -f PGDump output_pgdump Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml

ogr2ogr -f CSV output.csv Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml

http://files.michaelzfreeman.org/ogrinfo_hirise.txt

http://files.michaelzfreeman.org/output_pgdump

http://files.michaelzfreeman.org/output.csv

---

Michael Z Freeman
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ogrinfo_hirise.txt
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161120/9e33a62d/attachment-0001.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: output.csv
Type: text/comma-separated-values
Size: 9039 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161120/9e33a62d/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: output_pgdump
Type: application/octet-stream
Size: 22524 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161120/9e33a62d/attachment-0001.obj>

From jukka.rahkonen at maanmittauslaitos.fi  Sun Nov 20 23:30:18 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 21 Nov 2016 00:30:18 -0700 (MST)
Subject: [gdal-dev] Unable to extract features from KML
In-Reply-To: <80ad2738b3dc5fc601725af0f301f1da.squirrel@server105.webhostingbuzz.com>
References: <80ad2738b3dc5fc601725af0f301f1da.squirrel@server105.webhostingbuzz.com>
Message-ID: <1479713418864-5296708.post@n6.nabble.com>

Hi,

The main problem is that KML support such data models which do not suit well
with the simple feature model of GDAL. You can get some information about
that by reading http://www.gdal.org/drv_libkml.html.

In your case each feature has two geometries: one point and one polygon.
Best that can be done with the simple feature model it to push them both
into one geometry which in that case must be a geometry collection. Here is
one example from your data

GEOMETRYCOLLECTION (POINT (-1.282 87.1064),POLYGON ((3.02457 87.0792,2.22294
86.9806,-5.655 87.1168,-5.098 87.2201,3.02457 87.0792)))

You can save geometry collections into PostGIS if you use ogr2ogr with
switch "-nlt geometry". However, saving geometry collections into PostGIS
may not solve your problem because only few GIS programs can handle geometry
collections well.

A better option for you might be to explode the collections and save points
and polygons as separate features into PostGIS. The ogr2ogr command to use
is like

ogr2ogr -f PGDump output_pgdump -nlt geometry -explodecollections
Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml

If you want to have a quick look at your data, use JML as outputformat and
open the result with OpenJUMP. It shows both the geometry collections and
exploded collections fine for me with names and descriptions.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Unable-to-extract-features-from-KML-tp5296670p5296708.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 21 07:48:14 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 21 Nov 2016 15:48:14 +0000
Subject: [gdal-dev] GDAL and ElasticSearch 5.0
Message-ID: <a396c51dcd49486b8bc47a45b4f7cd0c@C119S212VM022.msvyvi.vaha.local>

Hi,

I tried to test new ElasticSearch version with no success and I wonder what is wrong. My command and debug data follows.


ogr2ogr -f "ElasticSearch" http://localhost:9200
-s_srs epsg:3067 -t_srs epsg:4326 test_es50.shp --debug on

GDAL: GDALOpen(test_es50.shp, this=0000000002454920) succeeds as ESRI Shapefile.
HTTP: Fetch(http://localhost:9200)
HTTP: These HTTP headers were set: Accept: text/plain, application/json
GeoJSON: No valid GeoJSON data found in source 'http://localhost:9200'
GDAL: GDALDriver::Create(ElasticSearch,http://localhost:9200,0,0,0,Unknown,00000
00000000000)
HTTP: Fetch(http://localhost:9200/_stats)
HTTP: Fetch(http://localhost:9200/test_es50)
HTTP: Fetch(http://localhost:9200/test_es50)
HTTP: These POSTFIELDS were sent:
HTTP: These HTTP headers were set: Content-Type: application/x-javascript;
charset=UTF-8
ERROR 1: HTTP error code : 400
ERROR 1: No handler found for uri [/test_es50] and method [POST]
ERROR 1: Terminating translation prematurely after failed
translation of layer test_es50 (use -skipfailures to skip errors)
GDAL: GDALClose(http://localhost:9200, this=00000000024545E0)
GDAL: GDALClose(test_es50.shp, this=0000000002454920)

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161121/78c2e483/attachment.html>

From tom.kralidis at canada.ca  Mon Nov 21 07:51:42 2016
From: tom.kralidis at canada.ca (Kralidis, Tom (EC))
Date: Mon, 21 Nov 2016 15:51:42 +0000
Subject: [gdal-dev] GDAL and ElasticSearch 5.0
In-Reply-To: <a396c51dcd49486b8bc47a45b4f7cd0c@C119S212VM022.msvyvi.vaha.local>
References: <a396c51dcd49486b8bc47a45b4f7cd0c@C119S212VM022.msvyvi.vaha.local>
Message-ID: <a4ddd8d084b641049a41549f68204966@PELEPCDEXC028.birch.int.bell.ca>

Jukka: I'm testing the same, for starters it would be valuable to identify which ES
version(s) are supported in [1].

..Tom

[1] http://www.gdal.org/drv_elasticsearch.html


From: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] On Behalf Of Rahkonen Jukka (MML)
Sent: 21 November 2016 10:48
To: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org)
Subject: [gdal-dev] GDAL and ElasticSearch 5.0

Hi,

I tried to test new ElasticSearch version with no success and I wonder what is wrong. My command and debug data follows.


ogr2ogr -f "ElasticSearch" http://localhost:9200 
-s_srs epsg:3067 -t_srs epsg:4326 test_es50.shp --debug on

GDAL: GDALOpen(test_es50.shp, this=0000000002454920) succeeds as ESRI Shapefile.
HTTP: Fetch(http://localhost:9200)
HTTP: These HTTP headers were set: Accept: text/plain, application/json
GeoJSON: No valid GeoJSON data found in source 'http://localhost:9200'
GDAL: GDALDriver::Create(ElasticSearch,http://localhost:9200,0,0,0,Unknown,00000
00000000000)
HTTP: Fetch(http://localhost:9200/_stats)
HTTP: Fetch(http://localhost:9200/test_es50)
HTTP: Fetch(http://localhost:9200/test_es50)
HTTP: These POSTFIELDS were sent:
HTTP: These HTTP headers were set: Content-Type: application/x-javascript;
charset=UTF-8
ERROR 1: HTTP error code : 400
ERROR 1: No handler found for uri [/test_es50] and method [POST]
ERROR 1: Terminating translation prematurely after failed
translation of layer test_es50 (use -skipfailures to skip errors)
GDAL: GDALClose(http://localhost:9200, this=00000000024545E0)
GDAL: GDALClose(test_es50.shp, this=0000000002454920)

-Jukka Rahkonen-

From even.rouault at spatialys.com  Mon Nov 21 08:26:45 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 21 Nov 2016 17:26:45 +0100
Subject: [gdal-dev] GDAL and ElasticSearch 5.0
In-Reply-To: <a4ddd8d084b641049a41549f68204966@PELEPCDEXC028.birch.int.bell.ca>
References: <a396c51dcd49486b8bc47a45b4f7cd0c@C119S212VM022.msvyvi.vaha.local>
 <a4ddd8d084b641049a41549f68204966@PELEPCDEXC028.birch.int.bell.ca>
Message-ID: <7709994.4rmnRryc6z@even-i700>

Hi,

I've just tested and confirm that ES 5.0 isn't compatible of current driver. 
I've created https://trac.osgeo.org/gdal/ticket/6724 to track this.

> Jukka: I'm testing the same, for starters it would be valuable to identify
> which ES version(s) are supported in [1].

Looking at commit messages, initial support was for 1.X I think and 2.X  was 
added per https://trac.osgeo.org/gdal/ticket/6346. I've added this in the doc.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From nigel.westbury at 1spatial.com  Mon Nov 21 02:10:25 2016
From: nigel.westbury at 1spatial.com (Nigel Westbury)
Date: Mon, 21 Nov 2016 10:10:25 +0000
Subject: [gdal-dev] CAD (DWG) Driver
Message-ID: <HE1PR07MB141735F1E56BA69C38430680B8B50@HE1PR07MB1417.eurprd07.prod.outlook.com>

The DWG driver contribution is much appreciated.  It currently supports older versions of files up to R1015 (AutoCAD 2000).  The DWG format was relatively straight forward up to that version.  In 2004 the format became rather more complex, including simple xor encryption and LZ77 compression of most of the records.  In 2007 the format became considerably more complex again, including Reed-Solomon encoding.  In 2010 the format became simpler again, going back to a format more similar to the 2004 format.  Our experience here at 1Spatial is that customers are on versions 2010 or 2013.  I have not received a DWG file from an earlier version from a customer.  Therefore we have implemented a library for reading versions 2010 and later (https://github.com/westbury/dwg-lib).  This has been implemented in Java and could readily be ported to C or otherwise compiled to a DLL, though as it is currently under active development this would need some thought to avoid maintaining two copies.  Alternatively we could leave it in Java and call it much as the GDAL GeoMedia driver does for Jackcess.   We have put the code under the MIT licence so that it would be available to GDAL.  The work was implemented by reference to the Open Design Specification for .dwg files Version 5.3.  We do plan on limited writing too, but probably updates to certain elements only, no support for outputting a complete DWG file from scratch.

Nigel Westbury

-----Original Message-----
From: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] On Behalf Of gdal-dev-request at lists.osgeo.org
Sent: 19 November 2016 19:49
To: gdal-dev at lists.osgeo.org
Subject: gdal-dev Digest, Vol 150, Issue 33

Send gdal-dev mailing list submissions to
gdal-dev at lists.osgeo.org

To subscribe or unsubscribe via the World Wide Web, visit
http://lists.osgeo.org/mailman/listinfo/gdal-dev
or, via email, send a message with subject or body 'help' to
gdal-dev-request at lists.osgeo.org

You can reach the person managing the list at
gdal-dev-owner at lists.osgeo.org

When replying, please edit your Subject line so it is more specific than "Re: Contents of gdal-dev digest..."


Today's Topics:

   1. Re: CAD (DWG) Driver (Even Rouault)
   2. Re: CAD (DWG) Driver (Kurt Schwehr)
   3. Re: CAD (DWG) Driver (Even Rouault)
   4. Re: CAD (DWG) Driver (Dmitry Baryshnikov)
   5. Re: identifying the fields from the .osm file (Djordje Spasic)


----------------------------------------------------------------------

Message: 1
Date: Sat, 19 Nov 2016 17:49:25 +0100
From: Even Rouault <even.rouault at spatialys.com>
To: Dmitry Baryshnikov <bishop.dev at gmail.com>, schwehr at gmail.com,
gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] CAD (DWG) Driver
Message-ID: <7873061.FYxrsrM0Qa at even-i700>
Content-Type: text/plain; charset="us-ascii"

On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
> Hi Even,
>
> The big_endian test now is ok. But osx crash at the exiting of python
> after all test finished successfully.
>
> This is error message:
>
> libc++abi.dylib: terminating with uncaught exception of type
> std::__1::system_error: mutex lock failed: Invalid argument
> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
> python run_all.py
>
> I find out that this may be the result of resources free order:
> https://github.com/dmlc/mxnet/issues/309
> https://github.com/google/benchmark/issues/52
>
> No idea why this occurred then C++11 used. I'll try to use osx CI test
> disabling the CAD driver to exclude this possible issue.
>

Hum, I think this might be indeed an issue with resource free order between the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the static C++11 mutex Kurt introduced in
https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd148826d45d9fa9

If this mutex gets destroyed before GDALDestroy() is called, then things might indeed crash.

I think we should remove this static C++11 mutex. Kurt ?

(Another option would be to remove the library destructor function. I've the feeling they cause more harm than good.)

--
Spatialys - Geospatial professional services http://www.spatialys.com


------------------------------

Message: 2
Date: Sat, 19 Nov 2016 10:06:26 -0800
From: Kurt Schwehr <schwehr at gmail.com>
To: Even Rouault <even.rouault at spatialys.com>
Cc: Dmitry Baryshnikov <bishop.dev at gmail.com>, gdal dev
<gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] CAD (DWG) Driver
Message-ID:
<CACmBxysE_yyRtWmOCc=A6kEPLiwdkpi4k6=HEk8jJVpAuM_9ww at mail.gmail.com>
Content-Type: text/plain; charset="utf-8"

I'm really not sure.

You can certainly try removing that C++11 mutex.  It was added based on the
comment at that point in the code.  We'll just have to keep an eye out for
possible occasional flakes.  If that's the case, we'll need to carefully
work through the logic and try to figure out a solution that works for
everything.

+1 for getting the driver into the tree.  It will be easier to make
additional changes to either it or GDAL with it in the same tree.

On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
> > Hi Even,
> >
> > The big_endian test now is ok. But osx crash at the exiting of python
> > after all test finished successfully.
> >
> > This is error message:
> >
> > libc++abi.dylib: terminating with uncaught exception of type
> > std::__1::system_error: mutex lock failed: Invalid argument
> > ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
> > python run_all.py
> >
> > I find out that this may be the result of resources free order:
> > https://github.com/dmlc/mxnet/issues/309
> > https://github.com/google/benchmark/issues/52
> >
> > No idea why this occurred then C++11 used. I'll try to use osx CI test
> > disabling the CAD driver to exclude this possible issue.
> >
>
> Hum, I think this might be indeed an issue with resource free order between
> the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
> static C++11 mutex Kurt introduced in
> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
> 26d45d9fa9
>
> If this mutex gets destroyed before GDALDestroy() is called, then things
> might
> indeed crash.
>
> I think we should remove this static C++11 mutex. Kurt ?
>
> (Another option would be to remove the library destructor function. I've
> the
> feeling they cause more harm than good.)
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



--
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/da36d65e/attachment-0001.html>

------------------------------

Message: 3
Date: Sat, 19 Nov 2016 19:24:16 +0100
From: Even Rouault <even.rouault at spatialys.com>
To: Kurt Schwehr <schwehr at gmail.com>
Cc: Dmitry Baryshnikov <bishop.dev at gmail.com>, gdal dev
<gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] CAD (DWG) Driver
Message-ID: <1731467.ZNQqGo50XJ at even-i700>
Content-Type: text/plain; charset="us-ascii"

On samedi 19 novembre 2016 10:06:26 CET Kurt Schwehr wrote:
> I'm really not sure.

Not sure that the crash mentionned by Dmitry is related to that ? It looks
like a really good canditate to me. That's the only C++11 mutex in GDAL, with
2  other ones in the GeoTIFF driver (and those are likely not triggered at
process termination)

>
> You can certainly try removing that C++11 mutex.  It was added based on the
> comment at that point in the code.  We'll just have to keep an eye out for
> possible occasional flakes.  If that's the case, we'll need to carefully
> work through the logic and try to figure out a solution that works for
> everything.

I doubt we will see flakes related to that. The mutex was added to prevent
races in GDALDestroyDriverManager(), but I'm not aware of code in GDAL and its
utilities that would call it from several threads. And the function has always
been documented as thread-unsafe.

>
> +1 for getting the driver into the tree.  It will be easier to make
> additional changes to either it or GDAL with it in the same tree.
>
> On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
>
> wrote:
> > On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
> > > Hi Even,
> > >
> > > The big_endian test now is ok. But osx crash at the exiting of python
> > > after all test finished successfully.
> > >
> > > This is error message:
> > >
> > > libc++abi.dylib: terminating with uncaught exception of type
> > > std::__1::system_error: mutex lock failed: Invalid argument
> > > ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
> > > python run_all.py
> > >
> > > I find out that this may be the result of resources free order:
> > > https://github.com/dmlc/mxnet/issues/309
> > > https://github.com/google/benchmark/issues/52
> > >
> > > No idea why this occurred then C++11 used. I'll try to use osx CI test
> > > disabling the CAD driver to exclude this possible issue.
> >
> > Hum, I think this might be indeed an issue with resource free order
> > between
> > the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
> > static C++11 mutex Kurt introduced in
> > https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
> > 26d45d9fa9
> >
> > If this mutex gets destroyed before GDALDestroy() is called, then things
> > might
> > indeed crash.
> >
> > I think we should remove this static C++11 mutex. Kurt ?
> >
> > (Another option would be to remove the library destructor function. I've
> > the
> > feeling they cause more harm than good.)
> >
> > --
> > Spatialys - Geospatial professional services
> > http://www.spatialys.com


--
Spatialys - Geospatial professional services
http://www.spatialys.com


------------------------------

Message: 4
Date: Sat, 19 Nov 2016 22:22:13 +0300
From: Dmitry Baryshnikov <bishop.dev at gmail.com>
To: Even Rouault <even.rouault at spatialys.com>, Kurt Schwehr
<schwehr at gmail.com>
Cc: gdal dev <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] CAD (DWG) Driver
Message-ID: <69e67501-5af0-d09a-bf2a-4faed559ad6f at gmail.com>
Content-Type: text/plain; charset="utf-8"; Format="flowed"

I commented out the C++11 mutex in gdaldrivermanager.cpp
<https://github.com/OSGeo/gdal/pull/164/commits/d1449e2eb5a85a6ec2520ad77ee579015fe14197#diff-e3e90e0089f1b70ddf36ebe89a73a733>
- this helps. OSX CI test passed successfully.

https://travis-ci.org/OSGeo/gdal/jobs/177297023

Best regards,
     Dmitry

19.11.16 21:24, Even Rouault пишет:
> On samedi 19 novembre 2016 10:06:26 CET Kurt Schwehr wrote:
>> I'm really not sure.
> Not sure that the crash mentionned by Dmitry is related to that ? It looks
> like a really good canditate to me. That's the only C++11 mutex in GDAL, with
> 2  other ones in the GeoTIFF driver (and those are likely not triggered at
> process termination)
>
>> You can certainly try removing that C++11 mutex.  It was added based on the
>> comment at that point in the code.  We'll just have to keep an eye out for
>> possible occasional flakes.  If that's the case, we'll need to carefully
>> work through the logic and try to figure out a solution that works for
>> everything.
> I doubt we will see flakes related to that. The mutex was added to prevent
> races in GDALDestroyDriverManager(), but I'm not aware of code in GDAL and its
> utilities that would call it from several threads. And the function has always
> been documented as thread-unsafe.
>
>> +1 for getting the driver into the tree.  It will be easier to make
>> additional changes to either it or GDAL with it in the same tree.
>>
>> On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
>>
>> wrote:
>>> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
>>>> Hi Even,
>>>>
>>>> The big_endian test now is ok. But osx crash at the exiting of python
>>>> after all test finished successfully.
>>>>
>>>> This is error message:
>>>>
>>>> libc++abi.dylib: terminating with uncaught exception of type
>>>> std::__1::system_error: mutex lock failed: Invalid argument
>>>> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
>>>> python run_all.py
>>>>
>>>> I find out that this may be the result of resources free order:
>>>> https://github.com/dmlc/mxnet/issues/309
>>>> https://github.com/google/benchmark/issues/52
>>>>
>>>> No idea why this occurred then C++11 used. I'll try to use osx CI test
>>>> disabling the CAD driver to exclude this possible issue.
>>> Hum, I think this might be indeed an issue with resource free order
>>> between
>>> the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
>>> static C++11 mutex Kurt introduced in
>>> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
>>> 26d45d9fa9
>>>
>>> If this mutex gets destroyed before GDALDestroy() is called, then things
>>> might
>>> indeed crash.
>>>
>>> I think we should remove this static C++11 mutex. Kurt ?
>>>
>>> (Another option would be to remove the library destructor function. I've
>>> the
>>> feeling they cause more harm than good.)
>>>
>>> --
>>> Spatialys - Geospatial professional services
>>> http://www.spatialys.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/78087c6b/attachment-0001.html>

------------------------------

Message: 5
Date: Sat, 19 Nov 2016 19:45:40 +0000 (UTC)
From: Djordje Spasic <issworld2000 at yahoo.com>
To: Etienne Trimaille <etienne.trimaille at gmail.com>
Cc: "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] identifying the fields from the .osm file
Message-ID: <840769665.311796.1479584740697 at mail.yahoo.com>
Content-Type: text/plain; charset="utf-8"

Thank you Etienne.
I am very interested in your reply, but I haven't quite understand you.
The ogr2ogr.exe file is using a particular python script to read the .osm file and identify its unique fields?
Can you be a bit more specific please? Solving this issue will mean a lot to me.
Sorry for disturbance, and thank you for the clarification in advance.Regards,
Djordje


    On Saturday, November 19, 2016 5:09 PM, Etienne Trimaille <etienne.trimaille at gmail.com> wrote:


 The parsing is done using python in the plugin. We can just use the parser by calling the python file. Python is included when you install osgeo4w.Yes you can set the osmconf.ini or directly use the goal ogr api to write the output file.
On 19 Nov 2016 18:00, "Djordje Spasic" <issworld2000 at yahoo.com> wrote:

Thank you for the quick reply Etienne!

I am stuck with ogr2ogr.exe, or GDAL C# libraries. I can not use QGIS or other applications.
Indeed Even told me that identifying all fields in the .osm file, would require doing 2 read passes of the .osm file.
I thought that maybe there is a way of doing exactly that, where in the first read I would get all the fields, find only those that are unique, and then perform a second read by setting these fields in the osmconf.ini file?

    On Saturday, November 19, 2016 2:40 AM, Etienne Trimaille <etienne.trimaille at gmail.com> wrote:


 Hi,
With ogr2ogr, you can't read all keys from an OSM file.
As Even said, you have to use another loop to read all available keys in the file. You can have a look at the QGIS QuickOSM plugin. You can open a OSM file and ask the plugin to read all keys available in the file.
2016-11-19 8:30 GMT+07:00 Djordje Spasic <issworld2000 at yahoo.com>:

During the last couple of days, both Jukka and Even helped me with some .osm file issues. And I am grateful on that.

I would like to ask one more question, if that's ok:
Is it possible to open an .osm file through ogr2ogr.exe and somehow read all the fields (keys) used in that .osm file? The final list of those fields do not have to be unique, they can repeat.
Is it possible to somehow save all those fields to a .shp or .txt file through ogr2ogr.exe?

Thank you for the reply.

______________________________ _________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman /listinfo/gdal-dev








-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/ebd0edd4/attachment.html>

------------------------------

Subject: Digest Footer

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman/listinfo/gdal-dev

------------------------------

End of gdal-dev Digest, Vol 150, Issue 33
*****************************************
 [http://www.1spatial.com/signatures/1SpatialLogo_Small.jpg] <http://www.1spatial.com>





[http://www.1spatial.com/wp-content/themes/1spatial/images/youtube.png]<http://www.youtube.com/user/1SpatialGroup> [http://www.1spatial.com/wp-content/themes/1spatial/images/facebook.png] <https://www.facebook.com/1Spatial>  [http://www.1spatial.com/wp-content/themes/1spatial/images/linkedIn.png] <http://www.linkedin.com/company/1spatial>  [http://www.1spatial.com/wp-content/themes/1spatial/images/twitter.png] <http://www.twitter.com/1spatial>

________________________________

The information in this e-mail is confidential and may be legally privileged. It is intended solely for the addressee. Access to this email by anyone else is unauthorised. Any views or opinions expressed in this e-mail may be solely those of the author and are not necessarily those of 1Spatial Plc. This email has been scanned for viruses and message content. 1Spatial Group Limited is a company registered in England and Wales No.4785688. Registered Office: Tennyson House, Cambridge Business Park, Cambridge CB4 0WZ

From michael-gdal at michaelzfreeman.org  Mon Nov 21 10:35:03 2016
From: michael-gdal at michaelzfreeman.org (Michael Z Freeman)
Date: Mon, 21 Nov 2016 18:35:03 -0000
Subject: [gdal-dev] Unable to extract features from KML
In-Reply-To: <1479713418864-5296708.post@n6.nabble.com>
References: <80ad2738b3dc5fc601725af0f301f1da.squirrel@server105.webhostingbuzz.com>
 <1479713418864-5296708.post@n6.nabble.com>
Message-ID: <163a5cddf17a471c15ab9b40ca88228d.squirrel@server105.webhostingbuzz.com>

Hi,

Thanks for this !

I eventually realised that I'd got in a muddle because I had failed to
understand what "wkb_geometry" is (
https://en.wikipedia.org/wiki/Well-known_text ). I think I thought it was
the gdal way for setting the SRID or something like this. So after seeing
the light I am using ...

ogr2ogr -f PostgreSQL PG:"dbname=original_hirise" -nlt geometry
MC-01-0-0-0_1.kml

SELECT ST_AsText(wkb_geometry) FROM mc_01_0_0_0_1;

... shows ...

GEOMETRYCOLLECTION(POINT(-30.415 88.0473),POLYGON((-28.14 87.938,-31.75
87.9205,-32.947 88.1536,-28.884 88.1731,-28.14 87.938))).
[...]

I'll be using PHP so the multigeometry should be fine for the moment and
seems easy enough to access ...

SELECT * FROM mc_01_0_0_0_1 WHERE
ST_DWithin(ST_CollectionExtract(wkb_geometry, 1),
ST_SetSRID(ST_MakePoint(-30.332,87.4992), 4326), 0.2);

... which gives two results with the correct coordinates.

Sorted ! (as we say here).

Best

Michael Z Freeman

On Mon, November 21, 2016 7:30 am, jratike80 wrote:
> Hi,
>
>
> The main problem is that KML support such data models which do not suit
> well with the simple feature model of GDAL. You can get some information
> about that by reading http://www.gdal.org/drv_libkml.html.
>
> In your case each feature has two geometries: one point and one polygon.
> Best that can be done with the simple feature model it to push them both
> into one geometry which in that case must be a geometry collection. Here
> is one example from your data
>
> GEOMETRYCOLLECTION (POINT (-1.282 87.1064),POLYGON ((3.02457
> 87.0792,2.22294
> 86.9806,-5.655 87.1168,-5.098 87.2201,3.02457 87.0792)))
>
>
> You can save geometry collections into PostGIS if you use ogr2ogr with
> switch "-nlt geometry". However, saving geometry collections into PostGIS
> may not solve your problem because only few GIS programs can handle
> geometry collections well.
>
> A better option for you might be to explode the collections and save
> points and polygons as separate features into PostGIS. The ogr2ogr command
> to use is like
>
> ogr2ogr -f PGDump output_pgdump -nlt geometry -explodecollections
> Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml
>
>
> If you want to have a quick look at your data, use JML as outputformat
> and open the result with OpenJUMP. It shows both the geometry collections
> and exploded collections fine for me with names and descriptions.
>
> -Jukka Rahkonen-
>
>
>
>
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/gdal-dev-Unable-to-extract-features-f
> rom-KML-tp5296670p5296708.html Sent from the GDAL - Dev mailing list
> archive at Nabble.com. _______________________________________________
> gdal-dev mailing list gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev



From a.neumann at carto.net  Mon Nov 21 23:21:16 2016
From: a.neumann at carto.net (Neumann, Andreas)
Date: Tue, 22 Nov 2016 08:21:16 +0100
Subject: [gdal-dev] Antialiasing problem with gdaladdo at edges/nodata
	sections
Message-ID: <20e8a35a910908e26ec8c5e06a8abbcd@carto.net>

Hi, 

I have Orthoimages where the boundaries aren't rectangular, but they
have corners and sometimes even diagonal edges. 

I noticed, that after creating pyramids/overview with gdaladdo, that I
get antialiasing/rendering artefacts that aren't present in the original
image at full resolution. See attached image that shows the problem. I
used a pink background to emphasize the problem. 

My nodata values are set to white (rgb 255,255,255) in the original
image. 

Here is the gdaladdo command that I used: 

gdaladdo -r cubic --config BIGTIFF_OVERVIEW YES --config
COMPRESS_OVERVIEW JPEG --config JPEG_QUALITY 85 --config
PHOTOMETRIC_OVERVIEW YCBCR --config INTERLEAVE_OVERVIEW PIXEL
dop2002_lv95.tif 2 4 8 16 32 64 128 256 512 1024 

This is the output of gdalinfo on the original image: 

----------------------- 

Driver: GTiff/GeoTIFF
Files: dop2002_lv95 - Kopie.tif
Size is 240000, 190000
Coordinate System is:
PROJCS["CH1903+ / LV95",
GEOGCS["CH1903+",
DATUM["CH1903+",
SPHEROID["Bessel 1841",6377397.155,299.1528128,
AUTHORITY["EPSG","7004"]],
TOWGS84[674.374,15.056,405.346,0,0,0,0],
AUTHORITY["EPSG","6150"]],
PRIMEM["Greenwich",0,
AUTHORITY["EPSG","8901"]],
UNIT["degree",0.0174532925199433,
AUTHORITY["EPSG","9122"]],
AUTHORITY["EPSG","4150"]],
PROJECTION["Hotine_Oblique_Mercator_Azimuth_Center"],
PARAMETER["latitude_of_center",46.95240555555556],
PARAMETER["longitude_of_center",7.439583333333333],
PARAMETER["azimuth",90],
PARAMETER["rectified_grid_angle",90],
PARAMETER["scale_factor",1],
PARAMETER["false_easting",2600000],
PARAMETER["false_northing",1200000],
UNIT["metre",1,
AUTHORITY["EPSG","9001"]],
AXIS["Easting",EAST],
AXIS["Northing",NORTH],
AUTHORITY["EPSG","2056"]]
Origin = (672000.000000000000000,234000.000000000000000)
Pixel Size = (0.100000000000000,-0.100000000000000)
Metadata:
AREA_OR_POINT=Area
TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)
TIFFTAG_XRESOLUTION=1
TIFFTAG_YRESOLUTION=1
Image Structure Metadata:
COMPRESSION=YCbCr JPEG
INTERLEAVE=PIXEL
SOURCE_COLOR_SPACE=YCbCr
Corner Coordinates:
Upper Left ( 672000.000, 234000.000) ( 13d51' 5.78"W, 35d55'48.10"N)
Lower Left ( 672000.000, 215000.000) ( 13d47'45.10"W, 35d46' 1.03"N)
Upper Right ( 696000.000, 234000.000) ( 13d35'53.15"W, 35d59'13.56"N)
Lower Right ( 696000.000, 215000.000) ( 13d32'34.61"W, 35d49'25.99"N)
Center ( 684000.000, 224500.000) ( 13d41'49.73"W, 35d52'37.44"N)
Band 1 Block=256x256 Type=Byte, ColorInterp=Red
NoData Value=255
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
NoData Value=255
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
NoData Value=255 

-------------------------------------------------------------------------------


Is there a way to get rid of these artefacts at the nodata borders? 

Thank you and greetings, 

Andreas 

  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161122/5a064dec/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: gdaladdo_nodata_problem.jpg
Type: image/jpeg
Size: 18390 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161122/5a064dec/attachment-0001.jpg>

From bontepaarden at gmail.com  Mon Nov 21 23:57:12 2016
From: bontepaarden at gmail.com (Paul Meems)
Date: Tue, 22 Nov 2016 08:57:12 +0100
Subject: [gdal-dev] Process MicaSense raw data using GDAL
Message-ID: <CAHNf2YQ+aF7vPVz8JvyE2mAjDu09DxvMPovDZf-jn3gEN7Ov9g@mail.gmail.com>

I'm investigating if we can process the raw data made by MicaSense using
GDAL so we don't need to upload the data first and then get the multi-band
GeoTiff back.

The camera has 5 lenses maken 5 tiff-files each time. Each band (R, G, B,
RedEx, NearInf) in its own file.
Due to the direction and the tilt of the drone these 5 images are slightly
shifted.
Each tiff-file has 1 GPS coordinate in EXIF.

What I need to do is
* convert the tiff with the EXIF to a proper GeoTiff
* Stitch all tiffs of the same band together
* Shift all stitched band image to align them

My main question:
"Does anybody on this list already have experience with these kind of data?"

Sub question will be 'What is the best workflow to perform the 3 steps I
mentioned?"

Thanks,

Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161122/3d451f83/attachment.html>

From pablo.larraondo at anu.edu.au  Mon Nov 21 23:53:14 2016
From: pablo.larraondo at anu.edu.au (Pablo Rozas Larraondo)
Date: Tue, 22 Nov 2016 18:53:14 +1100
Subject: [gdal-dev] slow netCDF read times
Message-ID: <CAGOzVw=Wdks07TRZjuS6qDd1b+20eFjL7gUxaS63yupP4nNDHg@mail.gmail.com>

Hello,

I've come across some NetCDF4 files where GDAL is taking a surprisingly
long time to read data from them. For example this is an example public
file containing precipitation data:

ftp://ftp.chg.ucsb.edu/pub/org/chg/products/CHIRPS-2.0/
global_dekad/netcdf/chirps-v2.0.2015.dekads.nc

If I use GDAL to read a small top left block (500x500) from one of its time
bands, it takes approximately 1 minute on my computer. Source code is
available here:

https://gist.github.com/monkeybutter/769a24bcf87682171eb87ac05c9347c5

The equivalent operation is completed in less than a second using the
NetCDF library and even reading the whole file takes around 6 seconds with
the same library.

I've tried to profile the GDAL program to get more insight and understand
what's causing the overhead with not much success. All I know is that the
deflate function is using 96% of the resources. I also guess that the way
this file is chunked has something to do with its performance. Can anyone
suggest any idea for better understanding what's happening here?

Thank you for your help,
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161122/87556c73/attachment.html>

From a.neumann at carto.net  Tue Nov 22 00:08:02 2016
From: a.neumann at carto.net (Neumann, Andreas)
Date: Tue, 22 Nov 2016 09:08:02 +0100
Subject: [gdal-dev] Nodata values in RGB orthoimages (GeoTiff)
Message-ID: <9accb02d62ae9aa4848363c883846b3a@carto.net>

Hi, 

Is there a way to store nodata values in GeoTiffs that don't match an
RGB value? I used either white or black as nodata values, but in some
rare cases these black or white pixel values do appear as valid data in
the image. 

How can I properly store nodata values in RGB Orthoimages in GeoTiffs
where the borders aren't purely rectangular? 

Would I have to use a hard mask for regions where there is no data, or
is there a trick with an alpha band? 

Thank you for any hints and greetings, 

Andreas 

  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161122/e5b81e83/attachment.html>

From Julien.Demaria at acri-st.fr  Tue Nov 22 01:07:28 2016
From: Julien.Demaria at acri-st.fr (Julien Demaria)
Date: Tue, 22 Nov 2016 09:07:28 +0000
Subject: [gdal-dev] slow netCDF read times
In-Reply-To: <CAGOzVw=Wdks07TRZjuS6qDd1b+20eFjL7gUxaS63yupP4nNDHg@mail.gmail.com>
References: <CAGOzVw=Wdks07TRZjuS6qDd1b+20eFjL7gUxaS63yupP4nNDHg@mail.gmail.com>
Message-ID: <3B970FB76033264EB34479EC8A365E1102E7482FA8@vwiexc030.acri.local>

Hi,

Maybe this is a problem with your NetCDF internal chunks cache too small and related to this ticket: https://trac.osgeo.org/gdal/ticket/5291
You can change this per-variable cache using this C function: http://www.unidata.ucar.edu/software/netcdf/docs/group__variables.html#ga2788cbfc6880ec70c304292af2bc7546
Else a workaround may be to rechunk your data using nccopy to have chunks of the same size than your reading window.
Another solution is to recompile your NetCDF library to set more chunks cache.

Regards,

Julien

De : gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] De la part de Pablo Rozas Larraondo
Envoyé : mardi 22 novembre 2016 08:53
À : gdal-dev at lists.osgeo.org
Objet : [gdal-dev] slow netCDF read times

Hello,

I've come across some NetCDF4 files where GDAL is taking a surprisingly long time to read data from them. For example this is an example public file containing precipitation data:

ftp://ftp.chg.ucsb.edu/pub/org/chg/products/CHIRPS-2.0/global_dekad/netcdf/chirps-v2.0.2015.dekads.nc

If I use GDAL to read a small top left block (500x500) from one of its time bands, it takes approximately 1 minute on my computer. Source code is available here:

https://gist.github.com/monkeybutter/769a24bcf87682171eb87ac05c9347c5

The equivalent operation is completed in less than a second using the NetCDF library and even reading the whole file takes around 6 seconds with the same library.

I've tried to profile the GDAL program to get more insight and understand what's causing the overhead with not much success. All I know is that the deflate function is using 96% of the resources. I also guess that the way this file is chunked has something to do with its performance. Can anyone suggest any idea for better understanding what's happening here?

Thank you for your help,
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161122/5933a843/attachment.html>

From bishop.dev at gmail.com  Tue Nov 22 01:45:17 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Tue, 22 Nov 2016 12:45:17 +0300
Subject: [gdal-dev] CAD (DWG) Driver
In-Reply-To: <HE1PR07MB141735F1E56BA69C38430680B8B50@HE1PR07MB1417.eurprd07.prod.outlook.com>
References: <HE1PR07MB141735F1E56BA69C38430680B8B50@HE1PR07MB1417.eurprd07.prod.outlook.com>
Message-ID: <9377465c-6ab0-8a37-9fa3-0fc5a3ca1c53@gmail.com>

Hi Nigel,

Thank you for information. I think enhancing OpenCAD library with 
support of additional DWG versions is right way. I'll study your code.


Best regards,
     Dmitry

21.11.16 13:10, Nigel Westbury пишет:
> The DWG driver contribution is much appreciated.  It currently supports older versions of files up to R1015 (AutoCAD 2000).  The DWG format was relatively straight forward up to that version.  In 2004 the format became rather more complex, including simple xor encryption and LZ77 compression of most of the records.  In 2007 the format became considerably more complex again, including Reed-Solomon encoding.  In 2010 the format became simpler again, going back to a format more similar to the 2004 format.  Our experience here at 1Spatial is that customers are on versions 2010 or 2013.  I have not received a DWG file from an earlier version from a customer.  Therefore we have implemented a library for reading versions 2010 and later (https://github.com/westbury/dwg-lib).  This has been implemented in Java and could readily be ported to C or otherwise compiled to a DLL, though as it is currently under active development this would need some thought to avoid maintaining two copies.  Alternatively we could leave it in Java and call it much as the GDAL GeoMedia driver does for Jackcess.   We have put the code under the MIT licence so that it would be available to GDAL.  The work was implemented by reference to the Open Design Specification for .dwg files Version 5.3.  We do plan on limited writing too, but probably updates to certain elements only, no support for outputting a complete DWG file from scratch.
>
> Nigel Westbury
>
> -----Original Message-----
> From: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] On Behalf Of gdal-dev-request at lists.osgeo.org
> Sent: 19 November 2016 19:49
> To: gdal-dev at lists.osgeo.org
> Subject: gdal-dev Digest, Vol 150, Issue 33
>
> Send gdal-dev mailing list submissions to
> gdal-dev at lists.osgeo.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
> or, via email, send a message with subject or body 'help' to
> gdal-dev-request at lists.osgeo.org
>
> You can reach the person managing the list at
> gdal-dev-owner at lists.osgeo.org
>
> When replying, please edit your Subject line so it is more specific than "Re: Contents of gdal-dev digest..."
>
>
> Today's Topics:
>
>     1. Re: CAD (DWG) Driver (Even Rouault)
>     2. Re: CAD (DWG) Driver (Kurt Schwehr)
>     3. Re: CAD (DWG) Driver (Even Rouault)
>     4. Re: CAD (DWG) Driver (Dmitry Baryshnikov)
>     5. Re: identifying the fields from the .osm file (Djordje Spasic)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sat, 19 Nov 2016 17:49:25 +0100
> From: Even Rouault <even.rouault at spatialys.com>
> To: Dmitry Baryshnikov <bishop.dev at gmail.com>, schwehr at gmail.com,
> gdal-dev at lists.osgeo.org
> Subject: Re: [gdal-dev] CAD (DWG) Driver
> Message-ID: <7873061.FYxrsrM0Qa at even-i700>
> Content-Type: text/plain; charset="us-ascii"
>
> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
>> Hi Even,
>>
>> The big_endian test now is ok. But osx crash at the exiting of python
>> after all test finished successfully.
>>
>> This is error message:
>>
>> libc++abi.dylib: terminating with uncaught exception of type
>> std::__1::system_error: mutex lock failed: Invalid argument
>> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
>> python run_all.py
>>
>> I find out that this may be the result of resources free order:
>> https://github.com/dmlc/mxnet/issues/309
>> https://github.com/google/benchmark/issues/52
>>
>> No idea why this occurred then C++11 used. I'll try to use osx CI test
>> disabling the CAD driver to exclude this possible issue.
>>
> Hum, I think this might be indeed an issue with resource free order between the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the static C++11 mutex Kurt introduced in
> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd148826d45d9fa9
>
> If this mutex gets destroyed before GDALDestroy() is called, then things might indeed crash.
>
> I think we should remove this static C++11 mutex. Kurt ?
>
> (Another option would be to remove the library destructor function. I've the feeling they cause more harm than good.)
>
> --
> Spatialys - Geospatial professional services http://www.spatialys.com
>
>
> ------------------------------
>
> Message: 2
> Date: Sat, 19 Nov 2016 10:06:26 -0800
> From: Kurt Schwehr <schwehr at gmail.com>
> To: Even Rouault <even.rouault at spatialys.com>
> Cc: Dmitry Baryshnikov <bishop.dev at gmail.com>, gdal dev
> <gdal-dev at lists.osgeo.org>
> Subject: Re: [gdal-dev] CAD (DWG) Driver
> Message-ID:
> <CACmBxysE_yyRtWmOCc=A6kEPLiwdkpi4k6=HEk8jJVpAuM_9ww at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> I'm really not sure.
>
> You can certainly try removing that C++11 mutex.  It was added based on the
> comment at that point in the code.  We'll just have to keep an eye out for
> possible occasional flakes.  If that's the case, we'll need to carefully
> work through the logic and try to figure out a solution that works for
> everything.
>
> +1 for getting the driver into the tree.  It will be easier to make
> additional changes to either it or GDAL with it in the same tree.
>
> On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
>>> Hi Even,
>>>
>>> The big_endian test now is ok. But osx crash at the exiting of python
>>> after all test finished successfully.
>>>
>>> This is error message:
>>>
>>> libc++abi.dylib: terminating with uncaught exception of type
>>> std::__1::system_error: mutex lock failed: Invalid argument
>>> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
>>> python run_all.py
>>>
>>> I find out that this may be the result of resources free order:
>>> https://github.com/dmlc/mxnet/issues/309
>>> https://github.com/google/benchmark/issues/52
>>>
>>> No idea why this occurred then C++11 used. I'll try to use osx CI test
>>> disabling the CAD driver to exclude this possible issue.
>>>
>> Hum, I think this might be indeed an issue with resource free order between
>> the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
>> static C++11 mutex Kurt introduced in
>> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
>> 26d45d9fa9
>>
>> If this mutex gets destroyed before GDALDestroy() is called, then things
>> might
>> indeed crash.
>>
>> I think we should remove this static C++11 mutex. Kurt ?
>>
>> (Another option would be to remove the library destructor function. I've
>> the
>> feeling they cause more harm than good.)
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>>
>
>
> --
> --
> http://schwehr.org
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/da36d65e/attachment-0001.html>
>
> ------------------------------
>
> Message: 3
> Date: Sat, 19 Nov 2016 19:24:16 +0100
> From: Even Rouault <even.rouault at spatialys.com>
> To: Kurt Schwehr <schwehr at gmail.com>
> Cc: Dmitry Baryshnikov <bishop.dev at gmail.com>, gdal dev
> <gdal-dev at lists.osgeo.org>
> Subject: Re: [gdal-dev] CAD (DWG) Driver
> Message-ID: <1731467.ZNQqGo50XJ at even-i700>
> Content-Type: text/plain; charset="us-ascii"
>
> On samedi 19 novembre 2016 10:06:26 CET Kurt Schwehr wrote:
>> I'm really not sure.
> Not sure that the crash mentionned by Dmitry is related to that ? It looks
> like a really good canditate to me. That's the only C++11 mutex in GDAL, with
> 2  other ones in the GeoTIFF driver (and those are likely not triggered at
> process termination)
>
>> You can certainly try removing that C++11 mutex.  It was added based on the
>> comment at that point in the code.  We'll just have to keep an eye out for
>> possible occasional flakes.  If that's the case, we'll need to carefully
>> work through the logic and try to figure out a solution that works for
>> everything.
> I doubt we will see flakes related to that. The mutex was added to prevent
> races in GDALDestroyDriverManager(), but I'm not aware of code in GDAL and its
> utilities that would call it from several threads. And the function has always
> been documented as thread-unsafe.
>
>> +1 for getting the driver into the tree.  It will be easier to make
>> additional changes to either it or GDAL with it in the same tree.
>>
>> On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
>>
>> wrote:
>>> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
>>>> Hi Even,
>>>>
>>>> The big_endian test now is ok. But osx crash at the exiting of python
>>>> after all test finished successfully.
>>>>
>>>> This is error message:
>>>>
>>>> libc++abi.dylib: terminating with uncaught exception of type
>>>> std::__1::system_error: mutex lock failed: Invalid argument
>>>> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
>>>> python run_all.py
>>>>
>>>> I find out that this may be the result of resources free order:
>>>> https://github.com/dmlc/mxnet/issues/309
>>>> https://github.com/google/benchmark/issues/52
>>>>
>>>> No idea why this occurred then C++11 used. I'll try to use osx CI test
>>>> disabling the CAD driver to exclude this possible issue.
>>> Hum, I think this might be indeed an issue with resource free order
>>> between
>>> the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
>>> static C++11 mutex Kurt introduced in
>>> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
>>> 26d45d9fa9
>>>
>>> If this mutex gets destroyed before GDALDestroy() is called, then things
>>> might
>>> indeed crash.
>>>
>>> I think we should remove this static C++11 mutex. Kurt ?
>>>
>>> (Another option would be to remove the library destructor function. I've
>>> the
>>> feeling they cause more harm than good.)
>>>
>>> --
>>> Spatialys - Geospatial professional services
>>> http://www.spatialys.com
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
>
> ------------------------------
>
> Message: 4
> Date: Sat, 19 Nov 2016 22:22:13 +0300
> From: Dmitry Baryshnikov <bishop.dev at gmail.com>
> To: Even Rouault <even.rouault at spatialys.com>, Kurt Schwehr
> <schwehr at gmail.com>
> Cc: gdal dev <gdal-dev at lists.osgeo.org>
> Subject: Re: [gdal-dev] CAD (DWG) Driver
> Message-ID: <69e67501-5af0-d09a-bf2a-4faed559ad6f at gmail.com>
> Content-Type: text/plain; charset="utf-8"; Format="flowed"
>
> I commented out the C++11 mutex in gdaldrivermanager.cpp
> <https://github.com/OSGeo/gdal/pull/164/commits/d1449e2eb5a85a6ec2520ad77ee579015fe14197#diff-e3e90e0089f1b70ddf36ebe89a73a733>
> - this helps. OSX CI test passed successfully.
>
> https://travis-ci.org/OSGeo/gdal/jobs/177297023
>
> Best regards,
>       Dmitry
>
> 19.11.16 21:24, Even Rouault пишет:
>> On samedi 19 novembre 2016 10:06:26 CET Kurt Schwehr wrote:
>>> I'm really not sure.
>> Not sure that the crash mentionned by Dmitry is related to that ? It looks
>> like a really good canditate to me. That's the only C++11 mutex in GDAL, with
>> 2  other ones in the GeoTIFF driver (and those are likely not triggered at
>> process termination)
>>
>>> You can certainly try removing that C++11 mutex.  It was added based on the
>>> comment at that point in the code.  We'll just have to keep an eye out for
>>> possible occasional flakes.  If that's the case, we'll need to carefully
>>> work through the logic and try to figure out a solution that works for
>>> everything.
>> I doubt we will see flakes related to that. The mutex was added to prevent
>> races in GDALDestroyDriverManager(), but I'm not aware of code in GDAL and its
>> utilities that would call it from several threads. And the function has always
>> been documented as thread-unsafe.
>>
>>> +1 for getting the driver into the tree.  It will be easier to make
>>> additional changes to either it or GDAL with it in the same tree.
>>>
>>> On Sat, Nov 19, 2016 at 8:49 AM, Even Rouault <even.rouault at spatialys.com>
>>>
>>> wrote:
>>>> On samedi 19 novembre 2016 19:34:02 CET Dmitry Baryshnikov wrote:
>>>>> Hi Even,
>>>>>
>>>>> The big_endian test now is ok. But osx crash at the exiting of python
>>>>> after all test finished successfully.
>>>>>
>>>>> This is error message:
>>>>>
>>>>> libc++abi.dylib: terminating with uncaught exception of type
>>>>> std::__1::system_error: mutex lock failed: Invalid argument
>>>>> ./gdal/ci/travis/osx/script.sh: line 13: 56363 Abort trap: 6
>>>>> python run_all.py
>>>>>
>>>>> I find out that this may be the result of resources free order:
>>>>> https://github.com/dmlc/mxnet/issues/309
>>>>> https://github.com/google/benchmark/issues/52
>>>>>
>>>>> No idea why this occurred then C++11 used. I'll try to use osx CI test
>>>>> disabling the CAD driver to exclude this possible issue.
>>>> Hum, I think this might be indeed an issue with resource free order
>>>> between
>>>> the GDALDestroy() destructor function (in gcore/gdaldllmain.cpp) and the
>>>> static C++11 mutex Kurt introduced in
>>>> https://github.com/OSGeo/gdal/commit/a9b947d6850d496f09e668f4cd1488
>>>> 26d45d9fa9
>>>>
>>>> If this mutex gets destroyed before GDALDestroy() is called, then things
>>>> might
>>>> indeed crash.
>>>>
>>>> I think we should remove this static C++11 mutex. Kurt ?
>>>>
>>>> (Another option would be to remove the library destructor function. I've
>>>> the
>>>> feeling they cause more harm than good.)
>>>>
>>>> --
>>>> Spatialys - Geospatial professional services
>>>> http://www.spatialys.com
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/78087c6b/attachment-0001.html>
>
> ------------------------------
>
> Message: 5
> Date: Sat, 19 Nov 2016 19:45:40 +0000 (UTC)
> From: Djordje Spasic <issworld2000 at yahoo.com>
> To: Etienne Trimaille <etienne.trimaille at gmail.com>
> Cc: "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
> Subject: Re: [gdal-dev] identifying the fields from the .osm file
> Message-ID: <840769665.311796.1479584740697 at mail.yahoo.com>
> Content-Type: text/plain; charset="utf-8"
>
> Thank you Etienne.
> I am very interested in your reply, but I haven't quite understand you.
> The ogr2ogr.exe file is using a particular python script to read the .osm file and identify its unique fields?
> Can you be a bit more specific please? Solving this issue will mean a lot to me.
> Sorry for disturbance, and thank you for the clarification in advance.Regards,
> Djordje
>
>
>      On Saturday, November 19, 2016 5:09 PM, Etienne Trimaille <etienne.trimaille at gmail.com> wrote:
>
>
>   The parsing is done using python in the plugin. We can just use the parser by calling the python file. Python is included when you install osgeo4w.Yes you can set the osmconf.ini or directly use the goal ogr api to write the output file.
> On 19 Nov 2016 18:00, "Djordje Spasic" <issworld2000 at yahoo.com> wrote:
>
> Thank you for the quick reply Etienne!
>
> I am stuck with ogr2ogr.exe, or GDAL C# libraries. I can not use QGIS or other applications.
> Indeed Even told me that identifying all fields in the .osm file, would require doing 2 read passes of the .osm file.
> I thought that maybe there is a way of doing exactly that, where in the first read I would get all the fields, find only those that are unique, and then perform a second read by setting these fields in the osmconf.ini file?
>
>      On Saturday, November 19, 2016 2:40 AM, Etienne Trimaille <etienne.trimaille at gmail.com> wrote:
>
>
>   Hi,
> With ogr2ogr, you can't read all keys from an OSM file.
> As Even said, you have to use another loop to read all available keys in the file. You can have a look at the QGIS QuickOSM plugin. You can open a OSM file and ask the plugin to read all keys available in the file.
> 2016-11-19 8:30 GMT+07:00 Djordje Spasic <issworld2000 at yahoo.com>:
>
> During the last couple of days, both Jukka and Even helped me with some .osm file issues. And I am grateful on that.
>
> I would like to ask one more question, if that's ok:
> Is it possible to open an .osm file through ogr2ogr.exe and somehow read all the fields (keys) used in that .osm file? The final list of those fields do not have to be unique, they can repeat.
> Is it possible to somehow save all those fields to a .shp or .txt file through ogr2ogr.exe?
>
> Thank you for the reply.
>
> ______________________________ _________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman /listinfo/gdal-dev
>
>
>
>
>
>
>
>
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161119/ebd0edd4/attachment.html>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> ------------------------------
>
> End of gdal-dev Digest, Vol 150, Issue 33
> *****************************************
>   [http://www.1spatial.com/signatures/1SpatialLogo_Small.jpg] <http://www.1spatial.com>
>
>
>
>
>
> [http://www.1spatial.com/wp-content/themes/1spatial/images/youtube.png]<http://www.youtube.com/user/1SpatialGroup> [http://www.1spatial.com/wp-content/themes/1spatial/images/facebook.png] <https://www.facebook.com/1Spatial>  [http://www.1spatial.com/wp-content/themes/1spatial/images/linkedIn.png] <http://www.linkedin.com/company/1spatial>  [http://www.1spatial.com/wp-content/themes/1spatial/images/twitter.png] <http://www.twitter.com/1spatial>
>
> ________________________________
>
> The information in this e-mail is confidential and may be legally privileged. It is intended solely for the addressee. Access to this email by anyone else is unauthorised. Any views or opinions expressed in this e-mail may be solely those of the author and are not necessarily those of 1Spatial Plc. This email has been scanned for viruses and message content. 1Spatial Group Limited is a company registered in England and Wales No.4785688. Registered Office: Tennyson House, Cambridge Business Park, Cambridge CB4 0WZ
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev



From even.rouault at spatialys.com  Tue Nov 22 02:55:36 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Nov 2016 11:55:36 +0100
Subject: [gdal-dev] Antialiasing problem with gdaladdo at edges/nodata
	sections
In-Reply-To: <20e8a35a910908e26ec8c5e06a8abbcd@carto.net>
References: <20e8a35a910908e26ec8c5e06a8abbcd@carto.net>
Message-ID: <1525426.aTmbUVhOPm@even-i700>

Andreas,

I assume you run a recent enough version of GDAL ?

As the image uses JPEG compression, one explanation would be that the 
transition betweeen data and nodata is not "clean" (which is a feature of JPEG 
compresssion). Therefore you would need to first translate your image to a 
uncompressed one (or one with a non	-JPEG compression), and run nearblack -
white on it so as to clean those edges.

Even

> Hi,
> 
> I have Orthoimages where the boundaries aren't rectangular, but they
> have corners and sometimes even diagonal edges.
> 
> I noticed, that after creating pyramids/overview with gdaladdo, that I
> get antialiasing/rendering artefacts that aren't present in the original
> image at full resolution. See attached image that shows the problem. I
> used a pink background to emphasize the problem.
> 
> My nodata values are set to white (rgb 255,255,255) in the original
> image.
> 
> Here is the gdaladdo command that I used:
> 
> gdaladdo -r cubic --config BIGTIFF_OVERVIEW YES --config
> COMPRESS_OVERVIEW JPEG --config JPEG_QUALITY 85 --config
> PHOTOMETRIC_OVERVIEW YCBCR --config INTERLEAVE_OVERVIEW PIXEL
> dop2002_lv95.tif 2 4 8 16 32 64 128 256 512 1024
> 
> This is the output of gdalinfo on the original image:
> 
> -----------------------
> 
> Driver: GTiff/GeoTIFF
> Files: dop2002_lv95 - Kopie.tif
> Size is 240000, 190000
> Coordinate System is:
> PROJCS["CH1903+ / LV95",
> GEOGCS["CH1903+",
> DATUM["CH1903+",
> SPHEROID["Bessel 1841",6377397.155,299.1528128,
> AUTHORITY["EPSG","7004"]],
> TOWGS84[674.374,15.056,405.346,0,0,0,0],
> AUTHORITY["EPSG","6150"]],
> PRIMEM["Greenwich",0,
> AUTHORITY["EPSG","8901"]],
> UNIT["degree",0.0174532925199433,
> AUTHORITY["EPSG","9122"]],
> AUTHORITY["EPSG","4150"]],
> PROJECTION["Hotine_Oblique_Mercator_Azimuth_Center"],
> PARAMETER["latitude_of_center",46.95240555555556],
> PARAMETER["longitude_of_center",7.439583333333333],
> PARAMETER["azimuth",90],
> PARAMETER["rectified_grid_angle",90],
> PARAMETER["scale_factor",1],
> PARAMETER["false_easting",2600000],
> PARAMETER["false_northing",1200000],
> UNIT["metre",1,
> AUTHORITY["EPSG","9001"]],
> AXIS["Easting",EAST],
> AXIS["Northing",NORTH],
> AUTHORITY["EPSG","2056"]]
> Origin = (672000.000000000000000,234000.000000000000000)
> Pixel Size = (0.100000000000000,-0.100000000000000)
> Metadata:
> AREA_OR_POINT=Area
> TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)
> TIFFTAG_XRESOLUTION=1
> TIFFTAG_YRESOLUTION=1
> Image Structure Metadata:
> COMPRESSION=YCbCr JPEG
> INTERLEAVE=PIXEL
> SOURCE_COLOR_SPACE=YCbCr
> Corner Coordinates:
> Upper Left ( 672000.000, 234000.000) ( 13d51' 5.78"W, 35d55'48.10"N)
> Lower Left ( 672000.000, 215000.000) ( 13d47'45.10"W, 35d46' 1.03"N)
> Upper Right ( 696000.000, 234000.000) ( 13d35'53.15"W, 35d59'13.56"N)
> Lower Right ( 696000.000, 215000.000) ( 13d32'34.61"W, 35d49'25.99"N)
> Center ( 684000.000, 224500.000) ( 13d41'49.73"W, 35d52'37.44"N)
> Band 1 Block=256x256 Type=Byte, ColorInterp=Red
> NoData Value=255
> Band 2 Block=256x256 Type=Byte, ColorInterp=Green
> NoData Value=255
> Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
> NoData Value=255
> 
> ----------------------------------------------------------------------------
> ---
> 
> 
> Is there a way to get rid of these artefacts at the nodata borders?
> 
> Thank you and greetings,
> 
> Andreas


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From pablo.larraondo at anu.edu.au  Tue Nov 22 03:14:43 2016
From: pablo.larraondo at anu.edu.au (Pablo Rozas Larraondo)
Date: Tue, 22 Nov 2016 22:14:43 +1100
Subject: [gdal-dev] slow netCDF read times
In-Reply-To: <3B970FB76033264EB34479EC8A365E1102E7482FA8@vwiexc030.acri.local>
References: <CAGOzVw=Wdks07TRZjuS6qDd1b+20eFjL7gUxaS63yupP4nNDHg@mail.gmail.com>
 <3B970FB76033264EB34479EC8A365E1102E7482FA8@vwiexc030.acri.local>
Message-ID: <CAGOzVwksZrHD=NLp6y+v+Fjz7odVa6dyvn3TPHXGe=nvmbHsDQ@mail.gmail.com>

Thank you Julien,

Your comment is very helpful and I think the issue that you're pointing out
is very much related to my problem. I did play with setting different
chunking patterns and I saw that chunking per line solved pretty much the
performance issue, but I didn't understand why.

Also, ticket 5291 talks about BottomUp NetCDF causing grief to GDAL. I've
checked and my file is BottomUp. I've flipped it by doing:
gdal_translate -of netcdf -co "WRITE_BOTTOMUP=NO"
chirps-v2.0.1981.dekads.classic.nc out.nc

And transformed it again into NetCDF4 with its original chunking pattern
and deflate level:
nccopy -7 -c time/4,lat/250,lon/900 out.nc out2.nc

In this case GDAL reads the file almost as fast as the native netcdf
library does. From now on I'll make sure I don't produce netCDF files which
are bottom up. Does anyone know where this bottom up convention comes from
in netcdf files or why is there?

Cheers,
Pablo




On Tue, Nov 22, 2016 at 8:07 PM, Julien Demaria <Julien.Demaria at acri-st.fr>
wrote:

> Hi,
>
>
>
> Maybe this is a problem with your NetCDF internal chunks cache too small
> and related to this ticket: https://trac.osgeo.org/gdal/ticket/5291
>
> You can change this per-variable cache using this C function:
> http://www.unidata.ucar.edu/software/netcdf/docs/group__variables.html#
> ga2788cbfc6880ec70c304292af2bc7546
>
> Else a workaround may be to rechunk your data using nccopy to have chunks
> of the same size than your reading window.
>
> Another solution is to recompile your NetCDF library to set more chunks
> cache.
>
>
>
> Regards,
>
>
>
> Julien
>
>
>
> *De :* gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] *De la part de*
> Pablo Rozas Larraondo
> *Envoyé :* mardi 22 novembre 2016 08:53
> *À :* gdal-dev at lists.osgeo.org
> *Objet :* [gdal-dev] slow netCDF read times
>
>
>
> Hello,
>
>
> I've come across some NetCDF4 files where GDAL is taking a surprisingly
> long time to read data from them. For example this is an example public
> file containing precipitation data:
>
>
>
> ftp://ftp.chg.ucsb.edu/pub/org/chg/products/CHIRPS-2.0/
> global_dekad/netcdf/chirps-v2.0.2015.dekads.nc
>
>
>
> If I use GDAL to read a small top left block (500x500) from one of its
> time bands, it takes approximately 1 minute on my computer. Source code is
> available here:
>
>
>
> https://gist.github.com/monkeybutter/769a24bcf87682171eb87ac05c9347c5
>
>
>
> The equivalent operation is completed in less than a second using the
> NetCDF library and even reading the whole file takes around 6 seconds with
> the same library.
>
>
>
> I've tried to profile the GDAL program to get more insight and understand
> what's causing the overhead with not much success. All I know is that the
> deflate function is using 96% of the resources. I also guess that the way
> this file is chunked has something to do with its performance. Can anyone
> suggest any idea for better understanding what's happening here?
>
>
>
> Thank you for your help,
>
> Pablo
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161122/1399b98c/attachment.html>

From even.rouault at spatialys.com  Tue Nov 22 03:49:49 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Nov 2016 12:49:49 +0100
Subject: [gdal-dev] Nodata values in RGB orthoimages (GeoTiff)
In-Reply-To: <9accb02d62ae9aa4848363c883846b3a@carto.net>
References: <9accb02d62ae9aa4848363c883846b3a@carto.net>
Message-ID: <1592476.6F3ekTngCr@even-i700>

On mardi 22 novembre 2016 09:08:02 CET Neumann, Andreas wrote:
> Hi,
> 
> Is there a way to store nodata values in GeoTiffs that don't match an
> RGB value? I used either white or black as nodata values, but in some
> rare cases these black or white pixel values do appear as valid data in
> the image.
> 
> How can I properly store nodata values in RGB Orthoimages in GeoTiffs
> where the borders aren't purely rectangular?
> 
> Would I have to use a hard mask for regions where there is no data, or
> is there a trick with an alpha band?
> 


There are several potential issues:

* by default, nodata is dealt band-per-band. So if you have nodata at 255, but 
a RGB triplet is (255,0,0), then it will be considered as nodata for the red 
band, but valid for the green and blue bands. To avoid that you can set the 
"NODATA_VALUES=255 255 55" metadata item to indicate that the 3 components 
must match at the same time. For example with:
gdal_edit.py foo.tif -mo "NODATA_VALUES=255 255 55" -unsetnodata
Then gdaladdo should properly take that into account

* If you indeed have valid pixels at (255,255,255) in the middle of the 
raster, then the above is not sufficient, and you need to create a dedicated 
alpha channel or mask band that gdaladdo will honour as well.

You can do that with nearblack -white -setalpha/-setmask

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From esacree at knology.net  Tue Nov 22 12:51:59 2016
From: esacree at knology.net (esacree)
Date: Tue, 22 Nov 2016 13:51:59 -0700 (MST)
Subject: [gdal-dev] Question: is there a way to set the TileMatrix value
 (aka Tile Zoom Level) for GDAL_WMTS?
Message-ID: <1479847919170-5297011.post@n6.nabble.com>

Question: is there a way to set the TileMatrix value (aka Tile Zoom Level)
for GDAL_WMTS?

WMTS Tile Retrieval issue:  WMTS Is retrieving at the wrong TileMatrix
value.  WMTS retrieves tiles at the maximum tile matrix (tile level or zoom
level).  No data is being returned.

Server:       
http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS?
Capabilities: 
http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS?SERVICE=WMTS&REQUEST=GetCapabilities

1.  Tiles are always requested at the maximum tile zoom level.  Using the
max tile zoom level can result in many tiles returned. When zoomed out, a
smaller tile zoom level will give enough data and fewer tiles.  It really
needs to respond to the TileLevel like Google Maps running the TMS driver.


--------------------------------------------------
Possible Problem in WMTS Code:
--------------------------------------------------
The TileMatrix hard coded maximum tile matrix problem may be here:  GDAL
2.1.2 File: wmtsdataset.cpp, Function: WMTSDataset::Open, Line 1587 Loop
starts at Maximum matrix id value.  The loop breaks at end of processing the
maximum value.  At that point the tile matrix (tlie zoom level) is 19
(maximum).

--------------------------------------------------
Here's the first tile request built by GDAL 2.1.2:
--------------------------------------------------
AskMiniDriverForBlock - First Tile Request:
url =
"http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS/tile/1.0.0/USGSShadedReliefOnly/default/default028mm/19/205501/135727.jpg"

For TileMatrix 19 the tile coordinates look right.  But the TileMatrix value
(tile zoom level) is set to the maximum for the TileMatrixSet.  TileMatrix
was requested at 14 based on the standard ESRI map scale computation.  Using
the WMS/TMS driver, Google Maps honors the TileLevel request.  I added the
TileMatrix and/or TileLevel parameters in the GDAL_WMTS request below.  It
did not make any difference.

--------------------------------------------------
Here's the WMTS XML Request file:
--------------------------------------------------
<GDAL_WMTS>
       
<GetCapabilitiesUrl>http://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS/1.0.0/WMTSCapabilities.xml</GetCapabilitiesUrl>
        <Layer>USGSShadedReliefOnly</Layer>
        
        <TileMatrixSet>default028mm</TileMatrixSet>
        <Format>image/jpg</Format>
    <DataWindow>
        <UpperLeftX>-9662904.298813</UpperLeftX>
        <UpperLeftY>4329581.328124</UpperLeftY>
        <LowerRightX>-9647611.198187</LowerRightX>
        <LowerRightY>4319814.305876</LowerRightY>
        <TileMatrix>14</TileMatrix>   	// DOES NOT WORK, IGNORED
        <TileLevel>14</TileLevel> 	// DOES NOT WORK, IGNORED
        </DataWindow>
    <BandsCount>4</BandsCount>
    <Cache/>
    <UnsafeSSL>true</UnsafeSSL>
    <ZeroBlockHttpCodes>404</ZeroBlockHttpCodes>
    <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
</GDAL_WMTS>





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Question-is-there-a-way-to-set-the-TileMatrix-value-aka-Tile-Zoom-Level-for-GDAL-WMTS-tp5297011.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Tue Nov 22 13:12:26 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Nov 2016 22:12:26 +0100
Subject: [gdal-dev] Question: is there a way to set the TileMatrix value
	(aka Tile Zoom Level) for GDAL_WMTS?
In-Reply-To: <1479847919170-5297011.post@n6.nabble.com>
References: <1479847919170-5297011.post@n6.nabble.com>
Message-ID: <6092900.jze4vebP8R@even-i700>

The TileLevel option is not available in the WMTS driver (as not mentionned in 
http://gdal.org/frmt_wmts.html)

Looking at,

$ gdalinfo test.xml

Driver: WMTS/OGC Web Mab Tile Service
Files: test.xml
Size is 51220, 32712
Coordinate System is:
PROJCS["WGS 84 / Pseudo-Mercator",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Mercator_1SP"],
    PARAMETER["central_meridian",0],
    PARAMETER["scale_factor",1],
    PARAMETER["false_easting",0],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["X",EAST],
    AXIS["Y",NORTH],
    EXTENSION["PROJ4","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 
+x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"],
    AUTHORITY["EPSG","3857"]]
Origin = (-9662904.575207639485598,4329581.393627353012562)
Pixel Size = (0.298582141647579,-0.298582141647579)
Metadata:
  TITLE=USGSShadedReliefOnly
Image Structure Metadata:
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (-9662904.575, 4329581.394) ( 86d48'12.06"W, 36d12'36.67"N)
Lower Left  (-9662904.575, 4319814.175) ( 86d48'12.06"W, 36d 8'21.70"N)
Upper Right (-9647611.198, 4329581.394) ( 86d39'57.48"W, 36d12'36.67"N)
Lower Right (-9647611.198, 4319814.175) ( 86d39'57.48"W, 36d 8'21.70"N)
Center      (-9655257.887, 4324697.784) ( 86d44' 4.77"W, 36d10'29.21"N)
Band 1 Block=128x128 Type=Byte, ColorInterp=Red
  Overviews: 25610x16356, 12805x8178, 6402x4089, 3201x2044, 1601x1022, 
800x511, 400x256, 200x128
  Mask Flags: PER_DATASET ALPHA 
  Overviews of mask band: 25610x16356, 12805x8178, 6402x4089, 3201x2044, 
1601x1022, 800x511, 400x256, 200x128
Band 2 Block=128x128 Type=Byte, ColorInterp=Green
  Overviews: 25610x16356, 12805x8178, 6402x4089, 3201x2044, 1601x1022, 
800x511, 400x256, 200x128
  Mask Flags: PER_DATASET ALPHA 
  Overviews of mask band: 25610x16356, 12805x8178, 6402x4089, 3201x2044, 
1601x1022, 800x511, 400x256, 200x128
Band 3 Block=128x128 Type=Byte, ColorInterp=Blue
  Overviews: 25610x16356, 12805x8178, 6402x4089, 3201x2044, 1601x1022, 
800x511, 400x256, 200x128
  Mask Flags: PER_DATASET ALPHA 
  Overviews of mask band: 25610x16356, 12805x8178, 6402x4089, 3201x2044, 
1601x1022, 800x511, 400x256, 200x128
Band 4 Block=128x128 Type=Byte, ColorInterp=Alpha
  Overviews: 25610x16356, 12805x8178, 6402x4089, 3201x2044, 1601x1022, 
800x511, 400x256, 200x128

One can see that the resolution of the full resolution dataset is 
0.298582141647579 m/pixel.

This indeed corresponds to zoom level =

>>> math.log((2 * 20037508.3427892 / 256)  / 0.298582141647579)/math.log(2)
19.00000000044158

So if you want to query at zoom level 15, you need to select the 5th overview 
(the one of size 1601x1022) :

$ gdal_translate -outsize 1601 1022 --debug HTTP test.xml out.tif
[...]
HTTP: Requesting [1/7] https://basemap.nationalmap.gov/arcgis/rest/services/
USGSShadedReliefOnly/MapServer/WMTS/tile/1.0.0/USGSShadedReliefOnly/default/
default028mm/14/6424/4241.jpg
HTTP: Requesting [2/7] https://basemap.nationalmap.gov/arcgis/rest/services/
USGSShadedReliefOnly/MapServer/WMTS/tile/1.0.0/USGSShadedReliefOnly/default/
default028mm/14/6424/4242.jpg
[...]


Or equivalently use the OVERVIEW_LEVEL open option ( see
http://www.gdal.org/classGDALDataset.html#a9cb8585d0b3c16726b08e25bcc94274a )

$ gdal_translate -oo OVERVIEW_LEVEL=4 --debug HTTP test.xml out.tif


Or equivalently, download http://basemap.nationalmap.gov/arcgis/rest/services/
USGSShadedReliefOnly/MapServer/WMTS/1.0.0/WMTSCapabilities.xml locally.
Edit it to remove all TileMatrix > 14.

And refer to this file as the <GetCapabilitiesUrl> .

$ gdalinfo test.xml
Driver: WMTS/OGC Web Mab Tile Service
Files: test.xml
Size is 1601, 1023
Coordinate System is:
PROJCS["WGS 84 / Pseudo-Mercator",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Mercator_1SP"],
    PARAMETER["central_meridian",0],
    PARAMETER["scale_factor",1],
    PARAMETER["false_easting",0],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["X",EAST],
    AXIS["Y",NORTH],
    EXTENSION["PROJ4","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 
+x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"],
    AUTHORITY["EPSG","3857"]]
Origin = (-9662911.140854565426707,4329584.374663999304175)
Pixel Size = (9.554628535632952,-9.554628535632952)
Metadata:
  TITLE=USGSShadedReliefOnly
Image Structure Metadata:
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (-9662911.141, 4329584.375) ( 86d48'12.27"W, 36d12'36.75"N)
Lower Left  (-9662911.141, 4319809.990) ( 86d48'12.27"W, 36d 8'21.59"N)
Upper Right (-9647614.181, 4329584.375) ( 86d39'57.57"W, 36d12'36.75"N)
Lower Right (-9647614.181, 4319809.990) ( 86d39'57.57"W, 36d 8'21.59"N)
Center      (-9655262.661, 4324697.182) ( 86d44' 4.92"W, 36d10'29.20"N)
Band 1 Block=128x128 Type=Byte, ColorInterp=Red
  Overviews: 801x512, 400x256, 200x128
  Mask Flags: PER_DATASET ALPHA 
  Overviews of mask band: 801x512, 400x256, 200x128
Band 2 Block=128x128 Type=Byte, ColorInterp=Green
  Overviews: 801x512, 400x256, 200x128
  Mask Flags: PER_DATASET ALPHA 
  Overviews of mask band: 801x512, 400x256, 200x128
Band 3 Block=128x128 Type=Byte, ColorInterp=Blue
  Overviews: 801x512, 400x256, 200x128
  Mask Flags: PER_DATASET ALPHA 
  Overviews of mask band: 801x512, 400x256, 200x128
Band 4 Block=128x128 Type=Byte, ColorInterp=Alpha
  Overviews: 801x512, 400x256, 200x128


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From philippe.ghesquiere at airbus.com  Wed Nov 23 01:31:50 2016
From: philippe.ghesquiere at airbus.com (Bugbuster)
Date: Wed, 23 Nov 2016 02:31:50 -0700 (MST)
Subject: [gdal-dev] "Very" long path name support under windows
Message-ID: <1479893510586-5297074.post@n6.nabble.com>

Dear all,

I have already posted this question a while ago, but I just noticed it has
never been accepted by the mailing list. And I don't know how to make it
accepted today. I do feel sorry for this double-posting.

I bumped into a problem under windows (Win7 or Win8 64 bits). I try to
manage an image which directory name is "very long" (more than 260 chars) :

   cd C:\VeryLongDirectoryPath
   gdalinfo Image.tif

I get the following message :
"Error: Current working directory has a path longer than alloowed for a
Win32 working directory.
Can't start native Windows applications from here

gdalinfo: File name too long"

I have the same problem when using system calls from a Java application.

I know there is a "legacy" limitation under Windows environnement, which
limits total filename length to  MAX_PATH (i.e. 260 chars). However, many
applications are not subject to this limitation (e.g. 7z).

I am looking for a solution when using GDAL utilities with system calls from
a JAVA application
Is there a way to deal with this limitation under windows ? Should we use
the 8.3 naming convention ? And how ?

Thanks for your help.
Philippe

P.S. :
* Env. : Windows 7 or Windows 8 64-bit
* GDAL V2.0.2
* Using *Cygwin Mintty* windows : directory names are not shortened to 8
characters



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Very-long-path-name-support-under-windows-tp5297074.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Wed Nov 23 02:39:02 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 23 Nov 2016 11:39:02 +0100
Subject: [gdal-dev] "Very" long path name support under windows
In-Reply-To: <1479893510586-5297074.post@n6.nabble.com>
References: <1479893510586-5297074.post@n6.nabble.com>
Message-ID: <1973555.tfDCOh6dql@even-i700>

Philippe,

> I bumped into a problem under windows (Win7 or Win8 64 bits). I try to
> manage an image which directory name is "very long" (more than 260 chars) :
> 
>    cd C:\VeryLongDirectoryPath
>    gdalinfo Image.tif

I experimented a bit, and the truth is that Windows itself poorly supports such situation.
The explorer refuses to create long path names, so indeed I had to use Linux to create a zip
with long file names and unzip it on Windows with 7z...

Not sure how you managed to cd to a very long path.

>From Windows cmd, I tried to cd to my above long file path :

C:\Users\W7\dev\gdal\veeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeee>cd eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
The filename or extension is too long.

The only way I got to it was to copy&paste the directory From the Explorer but it
used a 8.3 filename trick to remain < 260 chars :

C:\Users\W7\dev\gdal\VEEEEE~1\EEEEEE~1\EEEEEE~1\eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeerylong>

and from there gdalinfo works.

> 
> I get the following message :
> "Error: Current working directory has a path longer than alloowed for a
> Win32 working directory.
> Can't start native Windows applications from here
> 
> gdalinfo: File name too long"

Not sure if it is an intrinsic limitation of Windows, or maybe the utilities
should use an alternate main entry point (a Windows unicode one ?) than the
C main() currently used.

> 
> I have the same problem when using system calls from a Java application.
> 
> I know there is a "legacy" limitation under Windows environnement, which
> limits total filename length to  MAX_PATH (i.e. 260 chars). However, many
> applications are not subject to this limitation (e.g. 7z).

When I added the Sentinel 2 driver in GDAL 2.1, I had to deal with this 
limitation since datasets have very long names (a newer revision of the format
will come with smaller filenames by the way) so there's some *limited* support
for long filenames.

>From a Python console:

>>> gdal.Open("c:\\users\\w7\\dev\\gdal\\veeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeee\\eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee\\eeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee\\eeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeerylong\\byte.tif")
<osgeo.gdal.Dataset; proxy of <Swig Object of type 'GDALDatasetShadow *' at 0x00
00000001FECF90> >

Internally this works by adding automagically the \\$\ prefix in the implementation
of the Open() and Stat() methods. (For some reason using a filename with the explicit
 \\$\ doesn't work in the current implementation.)

This should also hopefully works from the Java bindings (nothing Python 
specific here). But you probably cannot use the utilities through system
 calls in that situation. You'd have to use the "utilities as library methods" way.

See the gdal.Translate(), etc methods in
http://gdal.org/java/org/gdal/gdal/gdal.html#Translate(java.lang.String,%20org.gdal.gdal.Dataset,%20org.gdal.gdal.TranslateOptions)
(no nice doc, just function signatures)

and

https://trac.osgeo.org/gdal/wiki/rfc59.1_utilities_as_a_library

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov 23 04:58:56 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 23 Nov 2016 12:58:56 +0000
Subject: [gdal-dev] Question about how GDAL makes an ElasticSearch index
Message-ID: <e811707f710d4c2e9e56406eaacab5c3@C119S212VM022.msvyvi.vaha.local>

Hi,

It seems that all examples about how to query ElasticSearch with GDAL in http://www.gdal.org/drv_elasticsearch.html are failing with ElasticSearch versions 2.x.
Reason is the breaking change "A field can no longer be referenced using its short name. Instead, the full path to the field is required" as documented in
https://www.elastic.co/guide/en/elasticsearch/reference/2.0/breaking_20_mapping_changes.html

I am planning to update the documents but I would like to be sure that I have understood it right that:

-          GDAL creates an ElasticSearch index with the name = OGR layer name

-          That ES index has always _type named FeatureCollection

-          attributes of the source data are always within "properties"

Therefore this
ogrinfo -ro ES: my_type -where '{ "filter": { "term": { "EAS_ID": 168 } } }'

must be used in this way with ES 2.x
ogrinfo -ro ES: my_type -where '{ "filter": { "term": { "properties.EAS_ID": 168 } } }'

similarly the Windows escaping example
C:\GDAL_on_Windows>ogrinfo ES: my_type -where "{\"query\": { \"match\": { \"properties.NAME\": \"Helsinki\" } } }"

Do you agree?

-Jukka Rahkonen-



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161123/64592bb9/attachment-0001.html>

From even.rouault at spatialys.com  Wed Nov 23 05:11:24 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 23 Nov 2016 14:11:24 +0100
Subject: [gdal-dev] Question about how GDAL makes an ElasticSearch index
In-Reply-To: <e811707f710d4c2e9e56406eaacab5c3@C119S212VM022.msvyvi.vaha.local>
References: <e811707f710d4c2e9e56406eaacab5c3@C119S212VM022.msvyvi.vaha.local>
Message-ID: <3079715.OHOsWLSKoL@even-i700>

On mercredi 23 novembre 2016 12:58:56 CET Rahkonen Jukka (MML) wrote:
> Hi,
> 
> It seems that all examples about how to query ElasticSearch with GDAL in
> http://www.gdal.org/drv_elasticsearch.html are failing with ElasticSearch
> versions 2.x.

That's likely. They were writte against 1.X. I didn't test againt 2.X myself apart from very basic 
test when integrating the patch that brought support for it.

> Reason is the breaking change "A field can no longer be
> referenced using its short name. Instead, the full path to the field is
> required" as documented in
> https://www.elastic.co/guide/en/elasticsearch/reference/2.0/breaking_20_map
> ping_changes.html
> 
> I am planning to update the documents but I would like to be sure that I
> have understood it right that:
> 
> -          GDAL creates an ElasticSearch index with the name = OGR layer
> name

By default yes. Unless the INDEX_NAME layer creation option is used.

"""*INDEX_NAME*=name. Name of the index to create (or reuse). By default the index name 
is the layer name."""

> 
> -          That ES index has always _type named FeatureCollection

When the layer is imported by OGR, yes. Unless the MAPPING_NAME layer creation option is 
used.

"""*MAPPING_NAME=*=name. Name of the mapping type within the index. By default, the 
mapping name is "FeatureCollection" and the documents will be written as GeoJSON Feature 
objects. If another mapping name is chosen, a more "flat" structure will be used."""

> 
> -          attributes of the source data are always within "properties"

If mapping_name == FeatureCollection, yes (using a GeoJSON Feature structure). Otherwise 
they are put at the root of the document.

> 
> Therefore this
> ogrinfo -ro ES: my_type -where '{ "filter": { "term": { "EAS_ID": 168 } } }'
> 
> must be used in this way with ES 2.x
> ogrinfo -ro ES: my_type -where '{ "filter": { "term": { "properties.EAS_ID":
> 168 } } }'

I guess that would work although for ES 1.x ? In which case we can mention only the new way 
to make things simpler.

> 
> similarly the Windows escaping example
> C:\GDAL_on_Windows>ogrinfo ES: my_type -where "{\"query\": { \"match\": {
> \"properties.NAME\": \"Helsinki\" } } }"

That works on Linux as well (it is just that the single quoting is convenient, especially since it 
can be used for multi line filters)

> 
> Do you agree?

Yes, thanks.

> 
> -Jukka Rahkonen-


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161123/3a5fd15f/attachment.html>

From schwehr at gmail.com  Wed Nov 23 05:43:44 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 23 Nov 2016 05:43:44 -0800
Subject: [gdal-dev] cppcheck
Message-ID: <CACmBxytxTas7ujk9NhQneoJr0QMP6rgVw1qXpt4GixcMA88sZQ@mail.gmail.com>

Even,

Thank you for your work with getting cppcheck setup and fixing a huge
number of warnings (and suppressing a large number of false positives)!!!

-kurt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161123/1aa28d60/attachment.html>

From even.rouault at spatialys.com  Wed Nov 23 06:28:50 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 23 Nov 2016 15:28:50 +0100
Subject: [gdal-dev] cppcheck
In-Reply-To: <CACmBxytxTas7ujk9NhQneoJr0QMP6rgVw1qXpt4GixcMA88sZQ@mail.gmail.com>
References: <CACmBxytxTas7ujk9NhQneoJr0QMP6rgVw1qXpt4GixcMA88sZQ@mail.gmail.com>
Message-ID: <6068196.CiZ4NRfS1I@even-i700>

On mercredi 23 novembre 2016 05:43:44 CET Kurt Schwehr wrote:
> Even,
> 
> Thank you for your work with getting cppcheck setup and fixing a huge
> number of warnings (and suppressing a large number of false positives)!!!

I encourage you as well to extend the tooling so as to check that all the cleanups you do do 
not regress. I guess you must have some ad-hoc scripts. If there were available, that would at 
least enable new developments to meet those standards. And if they don't pass on the 
whole code base, I guess it would be possible to run them on white-listed directories (or 
exclude black-listed directories)

QGIS has a scripts/prepare-commit.sh that handles mostly code formatting (reformatting it 
automatically), but something similar that would handle formatting and/or other checks 
could be useful.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161123/c6b833f5/attachment.html>

From schwehr at gmail.com  Wed Nov 23 07:09:43 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 23 Nov 2016 07:09:43 -0800
Subject: [gdal-dev] cppcheck
In-Reply-To: <6068196.CiZ4NRfS1I@even-i700>
References: <CACmBxytxTas7ujk9NhQneoJr0QMP6rgVw1qXpt4GixcMA88sZQ@mail.gmail.com>
 <6068196.CiZ4NRfS1I@even-i700>
Message-ID: <CACmBxysVww7hrN+iCw5zrJUr+PJHrk2HJV_up3WSMhyfYNLfwQ@mail.gmail.com>

I definitely want to add some checks to that script!

A lot of what I'm doing is just reading through the code.  I have been
taking notes in hopes that I can convert some of the grep's that I do into
the script.  Right now, most of them are super high on the false positive
side of things.  e.g.

find . -name \*.cpp | xargs egrep 'TRUE|FALSE'

I also have been running a really old version of cppcheck.  It's pretty
clear that cppcheck 1.60.1 is much weaker than the current head.

I did just commit my play version of a clang-format config file that
loosely matches GDAL style.  It definitely needs help/discussion...  I had
put it in a gist, but better to get it into the code base where it might be
seen by more interested folks.  If we can make a config file that works for
the project, authors will be free to write in whatever style they want and
then just transform to GDALs style for commit.  On other projects, I
personally write some pretty sloppily formatted code and use clang-format
to get it more readable before submitting.  I know people who use
clang-format to convert files to their prefered style for editing and then
convert it back to a project's style for all edits.

https://trac.osgeo.org/gdal/changeset/36467

-k

On Wed, Nov 23, 2016 at 6:28 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mercredi 23 novembre 2016 05:43:44 CET Kurt Schwehr wrote:
>
> > Even,
>
> >
>
> > Thank you for your work with getting cppcheck setup and fixing a huge
>
> > number of warnings (and suppressing a large number of false positives)!!!
>
>
>
> I encourage you as well to extend the tooling so as to check that all the
> cleanups you do do not regress. I guess you must have some ad-hoc scripts.
> If there were available, that would at least enable new developments to
> meet those standards. And if they don't pass on the whole code base, I
> guess it would be possible to run them on white-listed directories (or
> exclude black-listed directories)
>
>
>
> QGIS has a scripts/prepare-commit.sh that handles mostly code formatting
> (reformatting it automatically), but something similar that would handle
> formatting and/or other checks could be useful.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161123/6d5cb7fd/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov 23 07:41:24 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 23 Nov 2016 15:41:24 +0000
Subject: [gdal-dev] ElasticSearch and native geometry
Message-ID: <2c7004c5716e4cb9b02ce654a4a8dcea@C119S212VM022.msvyvi.vaha.local>

Hi,

What if somebody would like to use ElasticSearch for queries but still somehow get the native geometries included in the output?  The geometry must be re-projected into EPSG:4326 for creating either geo_point or geo_shape, but can anybody suggest a clever way for saving the native geometry? It is of course possible to save it into a text field for example as WKT of JSON but could it be possible to keep the original geometry in "_source" and just create the geo_point or geo_shape on-the-fly or the index?

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161123/c43a06f9/attachment.html>

From philippe.ghesquiere at airbus.com  Wed Nov 23 08:57:55 2016
From: philippe.ghesquiere at airbus.com (Bugbuster)
Date: Wed, 23 Nov 2016 09:57:55 -0700 (MST)
Subject: [gdal-dev] "Very" long path name support under windows
In-Reply-To: <1973555.tfDCOh6dql@even-i700>
References: <1479893510586-5297074.post@n6.nabble.com>
 <1973555.tfDCOh6dql@even-i700>
Message-ID: <1479920275239-5297164.post@n6.nabble.com>

Hi Even,

thanks for your long and detailed answer. I have plenty of information I can
play around with.

In fact, I managed to "cd" to the desired directory within a *Cygwin Mintty*
windows. In this window, I do not have the "8.3 Windows renaming". In that
way, I mimicked what I get with a system call from a JAVA program.

I will try to see what we can do with the /"utilities as library methods"
way/ as you say. We just need to upgrade to Gdal V2.1 :-)

Thanks again for your help.
Philippe



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Very-long-path-name-support-under-windows-tp5297074p5297164.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From damian.dixon at gmail.com  Wed Nov 23 09:09:58 2016
From: damian.dixon at gmail.com (Damian Dixon)
Date: Wed, 23 Nov 2016 17:09:58 +0000
Subject: [gdal-dev] "Very" long path name support under windows
In-Reply-To: <1479920275239-5297164.post@n6.nabble.com>
References: <1479893510586-5297074.post@n6.nabble.com>
 <1973555.tfDCOh6dql@even-i700>
 <1479920275239-5297164.post@n6.nabble.com>
Message-ID: <CAJjdW1xVEsmpa2J0P8d9h-mvhzfweAc1RRQok0JgefJco91VeA@mail.gmail.com>

Hi Even, Philippe,

Windows has two types of paths.

The first is essentially the codepage and is about 260 characters.

The second is the unicode pathname which is probably around 32k characters.
I can't remember the actual limit.

The cmd line and explorer only use the 260 character limit.

So a unicode program can create a path that is not particularly useable via
the cmd line or via explorer. cygwin bash shell works though.

You have to use the win32 unicode versions of the file open etc... to use
the nice long paths.

Regards
Damian


On 23 November 2016 at 16:57, Bugbuster <philippe.ghesquiere at airbus.com>
wrote:

> Hi Even,
>
> thanks for your long and detailed answer. I have plenty of information I
> can
> play around with.
>
> In fact, I managed to "cd" to the desired directory within a *Cygwin
> Mintty*
> windows. In this window, I do not have the "8.3 Windows renaming". In that
> way, I mimicked what I get with a system call from a JAVA program.
>
> I will try to see what we can do with the /"utilities as library methods"
> way/ as you say. We just need to upgrade to Gdal V2.1 :-)
>
> Thanks again for your help.
> Philippe
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.
> nabble.com/Very-long-path-name-support-under-windows-
> tp5297074p5297164.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161123/cf8d4cbf/attachment.html>

From ianjlilly at gmail.com  Thu Nov 24 00:26:45 2016
From: ianjlilly at gmail.com (ianinKL)
Date: Thu, 24 Nov 2016 01:26:45 -0700 (MST)
Subject: [gdal-dev] "Very" long path name support under windows
In-Reply-To: <CAJjdW1xVEsmpa2J0P8d9h-mvhzfweAc1RRQok0JgefJco91VeA@mail.gmail.com>
References: <1479893510586-5297074.post@n6.nabble.com>
 <1973555.tfDCOh6dql@even-i700> <1479920275239-5297164.post@n6.nabble.com>
 <CAJjdW1xVEsmpa2J0P8d9h-mvhzfweAc1RRQok0JgefJco91VeA@mail.gmail.com>
Message-ID: <1479976005779-5297231.post@n6.nabble.com>

http://https://msdn.microsoft.com/en-us/library/windows/desktop/aa364963(v=vs.85).aspx
<http://https://msdn.microsoft.com/en-us/library/windows/desktop/aa364963(v=vs.85).aspx> 
Microsoft has a very succinct summary of the issue and how to address it:



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Very-long-path-name-support-under-windows-tp5297074p5297231.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/2185372a/attachment.html>

From even.rouault at spatialys.com  Thu Nov 24 01:33:13 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Nov 2016 10:33:13 +0100
Subject: [gdal-dev] Mass addition of 'override' keyword ?
Message-ID: <9261427.2BdVH6jUIX@even-i700>

Hi,

I've a branch where I've added the 'override' keyword to virtual methods that
are an override of a virtual method declared in a base class.

https://github.com/OSGeo/gdal/compare/trunk...rouault:add_override?expand=1

Of course, not completely manually, but at >90% with the help of clang-tidy.  
GCC >= 5.1 has a -Wsuggest-override warning that I've enabled
in configure to find all places missed by tidy-clang (at least with the drivers I've
enabled in that branch). And recent clang versions have a less powerful
-Winconsistent-missing-override (enabled with -Wall I think) that warns when
you have explicitly tagged an overriden method with 'override' but neglected
to do so for other overriden methods of the same class. So new code should
be override friendly.

As we still support C++03 compilers, the following tricks are used :

1) If the compiler doesn't advertize C++11 support, we #define override to empty in
cpl_port.h. But that only if -DGDAL_COMPILATION is defined (which is the case
in the Unix and Windows makefiles used to build GDAL), so as to avoid messing the
namespace of code that includes GDAL.

2) As we don't want 'override' to leak into installed headers to keep C++03
compat, then CPL_OVERRIDE is used in those files, instead of plain 'override'.
It is a #define to override is the compiler is C++11 enabled, or #define to
empty otherwise.

As words may poorly reflect the reality of the code, here's the code:
{{{
#ifdef __cplusplus

#if HAVE_CXX11 || _MSC_VER >= 1600

/** To be used in public headers only. For non-public headers or .cpp files,
 * use override directly. */
#  define CPL_OVERRIDE override

#else

/** To be used in public headers only. For non-public headers or .cpp files,
 * use override directly. */
#  define CPL_OVERRIDE

/* For GDAL source compilation only, ignore override if non C++11 compiler */
#ifdef GDAL_COMPILATION
#  define override
#endif

#endif /* __cpluscplus */

}}}

So in summary: use override in all .cpp files and non-installed .h headers.
Use CPL_OVERRIDE in installed .h headers. Will make C++11 compilers enforce
overriding, and C++03 ones ignore it.


Interestingly in the process, I found a rather odd bug which pre-existed
unnoticed. It is Windows specific. In VSIFilesystemHandler
we have a virtual method GetDiskFreeSpace(). But on Windows, if you include
<windows.h>, GetDiskFreeSpace is a #define to the ANSI Win32 function
GetDiskFreeSpaceA() ... So the VSIWin32FilesystemHandler::GetDiskFreeSpace()
method was actually evaluated as 
VSIWin32FilesystemHandler::GetDiskFreeSpaceA() by the preprocessor in
port/cpl_vsil_win32.cpp, and not as an override of the base
VSIFilesystemHandler::GetDiskFreeSpace()... Not critical since this is rarely
used, and code that use this method should be ready to receive the default -1
value for filesystems that don't implement it.

Thoughts regarding committing this?

Windows and Unix builds are happy:
* https://ci.appveyor.com/project/rouault/gdal2/build/1.0.38 (this one is
C++11. Well actually VS12 is partially C++11, but sufficiently to understand override)
* https://travis-ci.org/rouault/gdal2/builds/178478253 (mix of C++11 and C++03 configs)

Even

~~~~~~~~~~~~~~~~~

PS. For reference, here's the method I've rougly used to convert
(with clang-tidy of clang 3.8)

Create in GDAL root directory a ".clang-tidy" file with the following content:

{
    Checks: '-*,modernize-use-override'
}


Then create a Python script "apply.py" that will use the output of clang-tidy to
patch files with override. There is
some complication to avoid it to remove the "virtual" keyword while adding
the "override" one (and also avoiding tagging virtual destructors as override,
which doesn't bring anything interesting. And actually is disliked by VS 2010).
I think that for some analyzers like cppcheck, the virtual keyword
might help them better understand the logic when they don't understand the
override keyword (cppcheck 1.72 is in fact confused by the override keyword and
produces a lot of false positives, so in the cppcheck.sh script, override is
forced to be an empty #define).

{{{
import yaml
import sys

root = yaml.load( open(sys.argv[1], 'rb').read() )
replacements = root['Replacements']

files = {}

for rep in replacements:
    f = rep['FilePath']
    if not f in files:
        files[f] = []
    files[f].append(rep)

for f in files:
    content = open(f).read()
    shift = 0
    for rep in files[f]:
        # Do not apply replacements that will remove the 'virtual' keyword
        if rep['Length'] == 0 and rep['ReplacementText'] == ' override':
            insert_pos = rep['Offset'] + shift
            # Adding override to a virtual destructor is quite ugly. Don't do it
            is_destructor = False
            for i in range(80):
                if i > insert_pos:
                    break
                if content[insert_pos-1-i] == ';':
                    break
                if content[insert_pos-1-i] == '~':
                    is_destructor = True
                    break
            if not is_destructor:
                content = content[0:insert_pos] + rep['ReplacementText'] + content[insert_pos:]
                shift += len(rep['ReplacementText'])

    open(f, 'wb').write(content)
}}}

And then the main script "modernize.py"

{{{
import os
import glob

# To patch all drivers below frmts/. Adapt for other directories
for dirname in glob.glob('frmts/*'):
    for file in glob.glob(dirname + '/*.h*') + glob.glob(dirname + '/*.cpp'):
    for file in glob.glob(dirname + '/*.h*') + glob.glob(dirname + '/*.c*'):
        print file
        os.system('rm replace.yml')
        os.system('clang-tidy -export-fixes=replace.yml ' + file + ' -- -Iogr/ogrsf_frmts/gpkg -Ifrmts/vrt -I/usr/include/postgresql/ -Ifrmts/wms -I/usr/include -I/usr/include/xercesc -Ifrmts/netcdf -Ifrmts/pcidsk/sdk  -Ifrmts/pcidsk/sdk/core  -Ifrmts/pcidsk/sdk/channel  -Ifrmts/gtiff -DLERC -Ifrmts/mrf -Ifrmts/mrf/libLERC -Ifrmts/raw  -Iogr/ogrsf_frmts/sqlite  -Iogr/ogrsf_frmts/couchdb   -Iogr/ogrsf_frmts/geojson   -Iogr/ogrsf_frmts/geojson/libjson -I/usr/include/fyba  -Iogr/ogrsf_frmts/shape  -Iogr/ogrsf_frmts/pgeo  -Iogr/ogrsf_frmts/pgdump  -Iogr/ogrsf_frmts/xplane -I/usr/include/ogdi  -Iogr/ogrsf_frmts/gml -Iogr/ogrsf_frmts/mem  -Iogr/ogrsf_frmts/gtm   -Iogr/ogrsf_frmts/kml -Iogr/ogrsf_frmts/generic -DHAVE_POPPLER -I/usr/include/poppler -DHAVE_PODOFO -I/usr/include/podofo -DDEBUG -DCPL_UNUSED -DHAVE_SQLITe -DHAVE_XERCES -DHAVE_EXPAT -DHAVE_CURL -DHAVE_CRYPTOPP -DFRMT_ecw -Ignm -Ignm/gnm_frmts -I/home/even/install-libecwj2-3.3/include -I/usr/include/c++/5 -I/home/even/FileGDB_API_1.4/include -I/usr/include/x86_64-linux-gnu/c++/5 -Iport -Igcore -Iogr -Iogr/ogrsf_frmts -Ialg -std=c++11')
        os.system('python apply.py replace.yml')


}}}

Build, fix errors, and run "make install" and grep override in the installed
headers. Then use your favorite text editor to replace override by CPL_OVERRIDE
in those few files.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/67af96c6/attachment-0001.html>

From daniele.romagnoli at geo-solutions.it  Thu Nov 24 04:22:55 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Thu, 24 Nov 2016 13:22:55 +0100
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
	palette for overviews?
Message-ID: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>

Hi List,
I'm investigating on a issue I have with a paletted image with overviews,
using java ImageIO tiff reader (wait... I know on this list we discuss
about GDAL topics :) ).
I'm trying to better understand palette interpretation and palette storing
on tags and how they are handled by GDAL.

>From TIFF specifications, colormap entries are stored as short values.
I have a sample file with this color tab (as reported by gdalinfo).

Color Table (RGB with 256 entries)
  0: *164*,164,164,255
  1: *255*,255,255,255
  2: 0,0,0,255
  3: 0,0,0,255
.... repeat 0,0,0,255 to the end.

Using an Hex editor or AsTiffTagViewer, I can see the byte values of the
colormap as stored on the file.
For the first 4 mappings of the colortable the Red components are:
*A4 A4* *FF FF* 00 00 00 00
(8 bytes = 4 shorts)

As far as I have understood, this is related to that part of the
specification (quoting it, section 5):


*In a TIFF ColorMap, all the Red values come first, followed by the Green
values, then the Blue values. In the ColorMap, black is represented by
0,0,0 and white is represented by 65535, 65535, 65535*

So the second entry of the map, being white (255, 255, 255) has its red
value stored as 65535 = *FF FF *whilst the first color (164,164,164) has
its red value stored as 42148 = *A4 A4*

I see this behavior is confirmed by the way the geotiff.cpp create the
colortable:
https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L5043

panTRed[iColor] = static_cast<unsigned short>(257 * sRGB.c1);
panTGreen[iColor] = static_cast<unsigned short>(257 * sRGB.c2);
panTBlue[iColor] = static_cast<unsigned short>(257 * sRGB.c3)

Applying a color*257 multiplication allows to have its 8 bits color
representation stored into a short where intensity goes from 0 to 65535.

The issue I have is that when using gdaladdo, the overviews are generated
with a different color table.
So that the first 8 bytes of the red component stored in the colormap,as
reported by AsTiffTagViewer are:
*A4* 00 *FF* 00 00 00 00 00

When converting it back to a 0-255 color component with the formula
R*255/65535 it become *163* instead of 164.

I see in the GDAL code that both the IBuildOverviews and
CreateOverviewsFromSrcOverviews call the CreateTIFFColorTable function
which multiplies the colorMapEntry by 256 instead of 257.

https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L9137

This may explain the *A4* 00 *FF* 00 entries in the overview with respect
to the *A4 A4 FF FF *entries in the main level.

Do you have any feedback on this?
Please, let me know what do you think about it.

Best Regards,
Daniele










-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/028dc53c/attachment.html>

From even.rouault at spatialys.com  Thu Nov 24 04:35:50 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Nov 2016 13:35:50 +0100
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
	palette for overviews?
In-Reply-To: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
References: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
Message-ID: <3865696.ux6cRO9uH7@even-i700>

Daniele,

This is indeed an inconsistency I spotted a long time ago :
https://trac.osgeo.org/gdal/ticket/2213

Nobody was apparently sufficiently annoyed by this to fix it. Actually I see I proposed a patch. 
Was probably waiting for feedback. I'm not sure if there's a standardized way of converting 
between the [0,255] and [0,65535] ranges.

Even

> Hi List,
> I'm investigating on a issue I have with a paletted image with overviews,
> using java ImageIO tiff reader (wait... I know on this list we discuss
> about GDAL topics :) ).
> I'm trying to better understand palette interpretation and palette storing
> on tags and how they are handled by GDAL.
> 
> From TIFF specifications, colormap entries are stored as short values.
> I have a sample file with this color tab (as reported by gdalinfo).
> 
> Color Table (RGB with 256 entries)
>   0: *164*,164,164,255
>   1: *255*,255,255,255
>   2: 0,0,0,255
>   3: 0,0,0,255
> .... repeat 0,0,0,255 to the end.
> 
> Using an Hex editor or AsTiffTagViewer, I can see the byte values of the
> colormap as stored on the file.
> For the first 4 mappings of the colortable the Red components are:
> *A4 A4* *FF FF* 00 00 00 00
> (8 bytes = 4 shorts)
> 
> As far as I have understood, this is related to that part of the
> specification (quoting it, section 5):
> 
> 
> *In a TIFF ColorMap, all the Red values come first, followed by the Green
> values, then the Blue values. In the ColorMap, black is represented by
> 0,0,0 and white is represented by 65535, 65535, 65535*
> 
> So the second entry of the map, being white (255, 255, 255) has its red
> value stored as 65535 = *FF FF *whilst the first color (164,164,164) has
> its red value stored as 42148 = *A4 A4*
> 
> I see this behavior is confirmed by the way the geotiff.cpp create the
> colortable:
> https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L5043
> 
> panTRed[iColor] = static_cast<unsigned short>(257 * sRGB.c1);
> panTGreen[iColor] = static_cast<unsigned short>(257 * sRGB.c2);
> panTBlue[iColor] = static_cast<unsigned short>(257 * sRGB.c3)
> 
> Applying a color*257 multiplication allows to have its 8 bits color
> representation stored into a short where intensity goes from 0 to 65535.
> 
> The issue I have is that when using gdaladdo, the overviews are generated
> with a different color table.
> So that the first 8 bytes of the red component stored in the colormap,as
> reported by AsTiffTagViewer are:
> *A4* 00 *FF* 00 00 00 00 00
> 
> When converting it back to a 0-255 color component with the formula
> R*255/65535 it become *163* instead of 164.
> 
> I see in the GDAL code that both the IBuildOverviews and
> CreateOverviewsFromSrcOverviews call the CreateTIFFColorTable function
> which multiplies the colorMapEntry by 256 instead of 257.
> 
> https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L9137
> 
> This may explain the *A4* 00 *FF* 00 entries in the overview with respect
> to the *A4 A4 FF FF *entries in the main level.
> 
> Do you have any feedback on this?
> Please, let me know what do you think about it.
> 
> Best Regards,
> Daniele


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/b1d44328/attachment-0001.html>

From daniele.romagnoli at geo-solutions.it  Thu Nov 24 07:51:59 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Thu, 24 Nov 2016 16:51:59 +0100
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
 palette for overviews?
In-Reply-To: <3865696.ux6cRO9uH7@even-i700>
References: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
 <3865696.ux6cRO9uH7@even-i700>
Message-ID: <CAJaHrDw+S_sgQHx71-+vtT3cWcoGVj32T3kkYs=WQZZG24Rzzw@mail.gmail.com>

Doh!
Thanks for the feedback, Even. (Indeed it seemed strange to me that nobody
had ever noticed before)

Best Regards,
Daniele

On Thu, Nov 24, 2016 at 1:35 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Daniele,
>
>
>
> This is indeed an inconsistency I spotted a long time ago :
>
> https://trac.osgeo.org/gdal/ticket/2213
>
>
>
> Nobody was apparently sufficiently annoyed by this to fix it. Actually I
> see I proposed a patch. Was probably waiting for feedback. I'm not sure if
> there's a standardized way of converting between the [0,255] and [0,65535]
> ranges.
>
>
>
> Even
>
>
>
> > Hi List,
>
> > I'm investigating on a issue I have with a paletted image with overviews,
>
> > using java ImageIO tiff reader (wait... I know on this list we discuss
>
> > about GDAL topics :) ).
>
> > I'm trying to better understand palette interpretation and palette
> storing
>
> > on tags and how they are handled by GDAL.
>
> >
>
> > From TIFF specifications, colormap entries are stored as short values.
>
> > I have a sample file with this color tab (as reported by gdalinfo).
>
> >
>
> > Color Table (RGB with 256 entries)
>
> > 0: *164*,164,164,255
>
> > 1: *255*,255,255,255
>
> > 2: 0,0,0,255
>
> > 3: 0,0,0,255
>
> > .... repeat 0,0,0,255 to the end.
>
> >
>
> > Using an Hex editor or AsTiffTagViewer, I can see the byte values of the
>
> > colormap as stored on the file.
>
> > For the first 4 mappings of the colortable the Red components are:
>
> > *A4 A4* *FF FF* 00 00 00 00
>
> > (8 bytes = 4 shorts)
>
> >
>
> > As far as I have understood, this is related to that part of the
>
> > specification (quoting it, section 5):
>
> >
>
> >
>
> > *In a TIFF ColorMap, all the Red values come first, followed by the Green
>
> > values, then the Blue values. In the ColorMap, black is represented by
>
> > 0,0,0 and white is represented by 65535, 65535, 65535*
>
> >
>
> > So the second entry of the map, being white (255, 255, 255) has its red
>
> > value stored as 65535 = *FF FF *whilst the first color (164,164,164) has
>
> > its red value stored as 42148 = *A4 A4*
>
> >
>
> > I see this behavior is confirmed by the way the geotiff.cpp create the
>
> > colortable:
>
> > https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/
> geotiff.cpp#L5043
>
> >
>
> > panTRed[iColor] = static_cast<unsigned short>(257 * sRGB.c1);
>
> > panTGreen[iColor] = static_cast<unsigned short>(257 * sRGB.c2);
>
> > panTBlue[iColor] = static_cast<unsigned short>(257 * sRGB.c3)
>
> >
>
> > Applying a color*257 multiplication allows to have its 8 bits color
>
> > representation stored into a short where intensity goes from 0 to 65535.
>
> >
>
> > The issue I have is that when using gdaladdo, the overviews are generated
>
> > with a different color table.
>
> > So that the first 8 bytes of the red component stored in the colormap,as
>
> > reported by AsTiffTagViewer are:
>
> > *A4* 00 *FF* 00 00 00 00 00
>
> >
>
> > When converting it back to a 0-255 color component with the formula
>
> > R*255/65535 it become *163* instead of 164.
>
> >
>
> > I see in the GDAL code that both the IBuildOverviews and
>
> > CreateOverviewsFromSrcOverviews call the CreateTIFFColorTable function
>
> > which multiplies the colorMapEntry by 256 instead of 257.
>
> >
>
> > https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/
> geotiff.cpp#L9137
>
> >
>
> > This may explain the *A4* 00 *FF* 00 entries in the overview with respect
>
> > to the *A4 A4 FF FF *entries in the main level.
>
> >
>
> > Do you have any feedback on this?
>
> > Please, let me know what do you think about it.
>
> >
>
> > Best Regards,
>
> > Daniele
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/eb3ada45/attachment.html>

From even.rouault at spatialys.com  Thu Nov 24 08:01:55 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Nov 2016 17:01:55 +0100
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
	palette for overviews?
In-Reply-To: <CAJaHrDw+S_sgQHx71-+vtT3cWcoGVj32T3kkYs=WQZZG24Rzzw@mail.gmail.com>
References: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
 <3865696.ux6cRO9uH7@even-i700>
 <CAJaHrDw+S_sgQHx71-+vtT3cWcoGVj32T3kkYs=WQZZG24Rzzw@mail.gmail.com>
Message-ID: <2185217.tZo4xrGmKO@even-i700>

On jeudi 24 novembre 2016 16:51:59 CET Daniele Romagnoli wrote:
> Doh!
> Thanks for the feedback, Even. (Indeed it seemed strange to me that nobody
> had ever noticed before)

Not that much regarding software using GDAL since if you don't explicitly request the 
overview bands/datasets but rather use the subsampling RasterIO() calls, you'll never work 
directly with the color table of the overviews but still use the one of the main dataset (or 
even if you request the overviews directly I guess in most cases applications don't bother 
checking if the color table of the overview). In GDAL, overviews conceptually share the same 
palette than the main image. Otherwise subsampling RasterIO() will return values of the 
overview palette that will be interpreted with the palette of the main image. You can imagine 
the fun visual effects if the palette are not the same... So this is assumed, but not checked. 

Could be worth fixing that if that cause issues (apparently in your use case at least), but I'd be 
interested by information of what is the standard/recommanded/best-practice-in-the-
industry/etc... formulas to use for the mapping between the [0,255] and [0,65535] ranges.

> 
> Best Regards,
> Daniele
> 
> On Thu, Nov 24, 2016 at 1:35 PM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > Daniele,
> > 
> > 
> > 
> > This is indeed an inconsistency I spotted a long time ago :
> > 
> > https://trac.osgeo.org/gdal/ticket/2213
> > 
> > 
> > 
> > Nobody was apparently sufficiently annoyed by this to fix it. Actually I
> > see I proposed a patch. Was probably waiting for feedback. I'm not sure if
> > there's a standardized way of converting between the [0,255] and [0,65535]
> > ranges.
> > 
> > 
> > 
> > Even
> > 
> > > Hi List,
> > > 
> > > I'm investigating on a issue I have with a paletted image with
> > > overviews,
> > > 
> > > using java ImageIO tiff reader (wait... I know on this list we discuss
> > > 
> > > about GDAL topics :) ).
> > > 
> > > I'm trying to better understand palette interpretation and palette
> > 
> > storing
> > 
> > > on tags and how they are handled by GDAL.
> > > 
> > > 
> > > 
> > > From TIFF specifications, colormap entries are stored as short values.
> > > 
> > > I have a sample file with this color tab (as reported by gdalinfo).
> > > 
> > > 
> > > 
> > > Color Table (RGB with 256 entries)
> > > 
> > > 0: *164*,164,164,255
> > > 
> > > 1: *255*,255,255,255
> > > 
> > > 2: 0,0,0,255
> > > 
> > > 3: 0,0,0,255
> > > 
> > > .... repeat 0,0,0,255 to the end.
> > > 
> > > 
> > > 
> > > Using an Hex editor or AsTiffTagViewer, I can see the byte values of the
> > > 
> > > colormap as stored on the file.
> > > 
> > > For the first 4 mappings of the colortable the Red components are:
> > > 
> > > *A4 A4* *FF FF* 00 00 00 00
> > > 
> > > (8 bytes = 4 shorts)
> > > 
> > > 
> > > 
> > > As far as I have understood, this is related to that part of the
> > > 
> > > specification (quoting it, section 5):
> > > 
> > > 
> > > 
> > > 
> > > 
> > > *In a TIFF ColorMap, all the Red values come first, followed by the
> > > Green
> > > 
> > > values, then the Blue values. In the ColorMap, black is represented by
> > > 
> > > 0,0,0 and white is represented by 65535, 65535, 65535*
> > > 
> > > 
> > > 
> > > So the second entry of the map, being white (255, 255, 255) has its red
> > > 
> > > value stored as 65535 = *FF FF *whilst the first color (164,164,164) has
> > > 
> > > its red value stored as 42148 = *A4 A4*
> > > 
> > > 
> > > 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/6bd5ca71/attachment-0001.html>

From daniele.romagnoli at geo-solutions.it  Thu Nov 24 08:22:50 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Thu, 24 Nov 2016 17:22:50 +0100
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
 palette for overviews?
In-Reply-To: <2185217.tZo4xrGmKO@even-i700>
References: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
 <3865696.ux6cRO9uH7@even-i700>
 <CAJaHrDw+S_sgQHx71-+vtT3cWcoGVj32T3kkYs=WQZZG24Rzzw@mail.gmail.com>
 <2185217.tZo4xrGmKO@even-i700>
Message-ID: <CAJaHrDwarL7GoLvtoYxZ27UBbZpkO1bd9SNjv+Vscwsj9sK4VQ@mail.gmail.com>

On Thu, Nov 24, 2016 at 5:01 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On jeudi 24 novembre 2016 16:51:59 CET Daniele Romagnoli wrote:
>
> > Doh!
>
> > Thanks for the feedback, Even.
>


> (Indeed it seemed strange to me that nobody had ever noticed before)
>
Sorry, what I meant with that was that I didn't see that ticket before
sending my email so it seemed strange to me that nobody noticed the palette
math weirdness :)


>
>
> Not that much regarding software using GDAL since if you don't explicitly
> request the overview bands/datasets but rather use the subsampling
> RasterIO() calls, you'll never work directly with the color table of the
> overviews but still use the one of the main dataset (or even if you request
> the overviews directly I guess in most cases applications don't bother
> checking if the color table of the overview).
>

As far as I can see, the TIFFImageReader parses the metadata information
based on imageIndex (so overview number). I will double check if things
were working differently in the colormap topic before our
changes/optimizations to this class.


> In GDAL, overviews conceptually share the same palette than the main
> image. Otherwise subsampling RasterIO() will return values of the overview
> palette that will be interpreted with the palette of the main image. You
> can imagine the fun visual effects if the palette are not the same... So
> this is assumed, but not checked.
>
>
>
> Could be worth fixing that if that cause issues (apparently in your use
> case at least), but I'd be interested by information of what is the
> standard/recommanded/best-practice-in-the-industry/etc... formulas to use
> for the mapping between the [0,255] and [0,65535] ranges.
>
>
>

Cheers,
Daniele

> >
>
> > Best Regards,
>
> > Daniele
>
> >
>
> > On Thu, Nov 24, 2016 at 1:35 PM, Even Rouault <
> even.rouault at spatialys.com>
>
> >
>
> > wrote:
>
> > > Daniele,
>
> > >
>
> > >
>
> > >
>
> > > This is indeed an inconsistency I spotted a long time ago :
>
> > >
>
> > > https://trac.osgeo.org/gdal/ticket/2213
>
> > >
>
> > >
>
> > >
>
> > > Nobody was apparently sufficiently annoyed by this to fix it. Actually
> I
>
> > > see I proposed a patch. Was probably waiting for feedback. I'm not
> sure if
>
> > > there's a standardized way of converting between the [0,255] and
> [0,65535]
>
> > > ranges.
>
> > >
>
> > >
>
> > >
>
> > > Even
>
> > >
>
> > > > Hi List,
>
> > > >
>
> > > > I'm investigating on a issue I have with a paletted image with
>
> > > > overviews,
>
> > > >
>
> > > > using java ImageIO tiff reader (wait... I know on this list we
> discuss
>
> > > >
>
> > > > about GDAL topics :) ).
>
> > > >
>
> > > > I'm trying to better understand palette interpretation and palette
>
> > >
>
> > > storing
>
> > >
>
> > > > on tags and how they are handled by GDAL.
>
> > > >
>
> > > >
>
> > > >
>
> > > > From TIFF specifications, colormap entries are stored as short
> values.
>
> > > >
>
> > > > I have a sample file with this color tab (as reported by gdalinfo).
>
> > > >
>
> > > >
>
> > > >
>
> > > > Color Table (RGB with 256 entries)
>
> > > >
>
> > > > 0: *164*,164,164,255
>
> > > >
>
> > > > 1: *255*,255,255,255
>
> > > >
>
> > > > 2: 0,0,0,255
>
> > > >
>
> > > > 3: 0,0,0,255
>
> > > >
>
> > > > .... repeat 0,0,0,255 to the end.
>
> > > >
>
> > > >
>
> > > >
>
> > > > Using an Hex editor or AsTiffTagViewer, I can see the byte values of
> the
>
> > > >
>
> > > > colormap as stored on the file.
>
> > > >
>
> > > > For the first 4 mappings of the colortable the Red components are:
>
> > > >
>
> > > > *A4 A4* *FF FF* 00 00 00 00
>
> > > >
>
> > > > (8 bytes = 4 shorts)
>
> > > >
>
> > > >
>
> > > >
>
> > > > As far as I have understood, this is related to that part of the
>
> > > >
>
> > > > specification (quoting it, section 5):
>
> > > >
>
> > > >
>
> > > >
>
> > > >
>
> > > >
>
> > > > *In a TIFF ColorMap, all the Red values come first, followed by the
>
> > > > Green
>
> > > >
>
> > > > values, then the Blue values. In the ColorMap, black is represented
> by
>
> > > >
>
> > > > 0,0,0 and white is represented by 65535, 65535, 65535*
>
> > > >
>
> > > >
>
> > > >
>
> > > > So the second entry of the map, being white (255, 255, 255) has its
> red
>
> > > >
>
> > > > value stored as 65535 = *FF FF *whilst the first color (164,164,164)
> has
>
> > > >
>
> > > > its red value stored as 42148 = *A4 A4*
>
> > > >
>
> > > >
>
> > > >
>
> > > > I see this behavior is confirmed by the way the geotiff.cpp create
> the
>
> > > >
>
> > > > colortable:
>
> > > >
>
> > > > https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/
>
> > >
>
> > > geotiff.cpp#L5043
>
> > >
>
> > > > panTRed[iColor] = static_cast<unsigned short>(257 * sRGB.c1);
>
> > > >
>
> > > > panTGreen[iColor] = static_cast<unsigned short>(257 * sRGB.c2);
>
> > > >
>
> > > > panTBlue[iColor] = static_cast<unsigned short>(257 * sRGB.c3)
>
> > > >
>
> > > >
>
> > > >
>
> > > > Applying a color*257 multiplication allows to have its 8 bits color
>
> > > >
>
> > > > representation stored into a short where intensity goes from 0 to
> 65535.
>
> > > >
>
> > > >
>
> > > >
>
> > > > The issue I have is that when using gdaladdo, the overviews are
>
> > > > generated
>
> > > >
>
> > > > with a different color table.
>
> > > >
>
> > > > So that the first 8 bytes of the red component stored in the
> colormap,as
>
> > > >
>
> > > > reported by AsTiffTagViewer are:
>
> > > >
>
> > > > *A4* 00 *FF* 00 00 00 00 00
>
> > > >
>
> > > >
>
> > > >
>
> > > > When converting it back to a 0-255 color component with the formula
>
> > > >
>
> > > > R*255/65535 it become *163* instead of 164.
>
> > > >
>
> > > >
>
> > > >
>
> > > > I see in the GDAL code that both the IBuildOverviews and
>
> > > >
>
> > > > CreateOverviewsFromSrcOverviews call the CreateTIFFColorTable
> function
>
> > > >
>
> > > > which multiplies the colorMapEntry by 256 instead of 257.
>
> > > >
>
> > > >
>
> > > >
>
> > > > https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/
>
> > >
>
> > > geotiff.cpp#L9137
>
> > >
>
> > > > This may explain the *A4* 00 *FF* 00 entries in the overview with
>
> > > > respect
>
> > > >
>
> > > > to the *A4 A4 FF FF *entries in the main level.
>
> > > >
>
> > > >
>
> > > >
>
> > > > Do you have any feedback on this?
>
> > > >
>
> > > > Please, let me know what do you think about it.
>
> > > >
>
> > > >
>
> > > >
>
> > > > Best Regards,
>
> > > >
>
> > > > Daniele
>
> > >
>
> > > --
>
> > >
>
> > > Spatialys - Geospatial professional services
>
> > >
>
> > > http://www.spatialys.com
>
> > >
>
> > > _______________________________________________
>
> > > gdal-dev mailing list
>
> > > gdal-dev at lists.osgeo.org
>
> > > http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/6e1a6f73/attachment-0001.html>

From michael-gdal at michaelzfreeman.org  Thu Nov 24 08:54:31 2016
From: michael-gdal at michaelzfreeman.org (Michael Z Freeman)
Date: Thu, 24 Nov 2016 16:54:31 -0000
Subject: [gdal-dev] Unable to extract features from KML
In-Reply-To: <1479713418864-5296708.post@n6.nabble.com>
References: <80ad2738b3dc5fc601725af0f301f1da.squirrel@server105.webhostingbuzz.com>
 <1479713418864-5296708.post@n6.nabble.com>
Message-ID: <ce28d4b1895224fffabccb73352920f6.squirrel@server105.webhostingbuzz.com>

Hi,

Still having trouble with this after updating to ogr2ogr/gdal 2.1.1.

Some of it is undoubtedly my unfamiliarity with GDAL. I'm on the steep
part of the learning curve ! But fun.

"ogr2ogr -f PostgreSQL PG:"dbname=original_hirise" -a_srs "EPSG:4326" -lco
OVERWRITE=YES -explodecollections -nlt geometry
Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml"

... creates (an edited CSV exported from a PGAdmin4 query) ...

"ogc_fid","name","description","wkb_geometry"
1,"ESP_018108_2680","[...]","0101000020E61000000AD7A3703D6A3EC0744694F606035640"
2,"ESP_018108_2680","[...]","0103000020E61000000100000005000000A4703D0AD7233CC079E9263108FC55400000000000C03FC0F4FDD478E9FA5540F0A7C64B377940C0992A1895D4095640FCA9F1D24DE23CC002BC0512140B5640A4703D0AD7233CC079E9263108FC5540"
3,"ESP_018318_2675","[...]","0101000020E6100000A245B6F3FD543EC0728A8EE4F2DF5540"
4,"ESP_018318_2675","[...]","0103000020E610000001000000050000004260E5D0223B3BC00C022B8716D95540AAF1D24D62503DC0FED478E926D55540448B6CE7FBD940C0C364AA6054E6554039B4C876BE7F3FC06D567DAEB6EA55404260E5D0223B3BC00C022B8716D95540"

As you can see the geometries from the KML are exploded ... the short WKB
is a point, the longer one POLYGON geometry. However two database entries
are created for each feature ("name"). I could just merge these but I feel
that OGR can create two geometry columns each for POINT and POLYGON, in
fact this seems to be explicitly stated that it can do this in the news
release for GDAL version 2.

Should I be using some kind of SQL statement on the OGR command line to
make it do this ?

Michael Z Freeman

On Mon, November 21, 2016 7:30 am, jratike80 wrote:
> Hi,
>
>
> The main problem is that KML support such data models which do not suit
> well with the simple feature model of GDAL. You can get some information
> about that by reading http://www.gdal.org/drv_libkml.html.
>
> In your case each feature has two geometries: one point and one polygon.
> Best that can be done with the simple feature model it to push them both
> into one geometry which in that case must be a geometry collection. Here
> is one example from your data
>
> GEOMETRYCOLLECTION (POINT (-1.282 87.1064),POLYGON ((3.02457
> 87.0792,2.22294
> 86.9806,-5.655 87.1168,-5.098 87.2201,3.02457 87.0792)))
>
>
> You can save geometry collections into PostGIS if you use ogr2ogr with
> switch "-nlt geometry". However, saving geometry collections into PostGIS
> may not solve your problem because only few GIS programs can handle
> geometry collections well.
>
> A better option for you might be to explode the collections and save
> points and polygons as separate features into PostGIS. The ogr2ogr command
> to use is like
>
> ogr2ogr -f PGDump output_pgdump -nlt geometry -explodecollections
> Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml
>
>
> If you want to have a quick look at your data, use JML as outputformat
> and open the result with OpenJUMP. It shows both the geometry collections
> and exploded collections fine for me with names and descriptions.
>
> -Jukka Rahkonen-
>
>
>
>
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/gdal-dev-Unable-to-extract-features-f
> rom-KML-tp5296670p5296708.html Sent from the GDAL - Dev mailing list
> archive at Nabble.com. _______________________________________________
> gdal-dev mailing list gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev



From even.rouault at spatialys.com  Thu Nov 24 09:03:27 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Nov 2016 18:03:27 +0100
Subject: [gdal-dev] Unable to extract features from KML
In-Reply-To: <ce28d4b1895224fffabccb73352920f6.squirrel@server105.webhostingbuzz.com>
References: <80ad2738b3dc5fc601725af0f301f1da.squirrel@server105.webhostingbuzz.com>
 <1479713418864-5296708.post@n6.nabble.com>
 <ce28d4b1895224fffabccb73352920f6.squirrel@server105.webhostingbuzz.com>
Message-ID: <3151273.SmICnLHSp8@even-i700>

On jeudi 24 novembre 2016 16:54:31 CET Michael Z Freeman wrote:
> Hi,
> 
> Still having trouble with this after updating to ogr2ogr/gdal 2.1.1.
> 
> Some of it is undoubtedly my unfamiliarity with GDAL. I'm on the steep
> part of the learning curve ! But fun.
> 
> "ogr2ogr -f PostgreSQL PG:"dbname=original_hirise" -a_srs "EPSG:4326" -lco
> OVERWRITE=YES -explodecollections -nlt geometry
> Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml"
> 
> ... creates (an edited CSV exported from a PGAdmin4 query) ...
> 
> "ogc_fid","name","description","wkb_geometry"
> 1,"ESP_018108_2680","[...]","0101000020E61000000AD7A3703D6A3EC0744694F606035
> 640"
> 2,"ESP_018108_2680","[...]","0103000020E61000000100000005000000A4703D0AD723
> 
3CC079E9263108FC55400000000000C03FC0F4FDD478E9FA5540F0A7C64B377940C0992A1
895
> 
D4095640FCA9F1D24DE23CC002BC0512140B5640A4703D0AD7233CC079E9263108FC5540
"
> 3,"ESP_018318_2675","[...]","0101000020E6100000A245B6F3FD543EC0728A8EE4F2DF
> 5540"
> 4,"ESP_018318_2675","[...]","0103000020E610000001000000050000004260E5D0223B
> 
3BC00C022B8716D95540AAF1D24D62503DC0FED478E926D55540448B6CE7FBD940C0C36
4AA60
> 
54E6554039B4C876BE7F3FC06D567DAEB6EA55404260E5D0223B3BC00C022B8716D95540
"
> 
> As you can see the geometries from the KML are exploded ... the short WKB
> is a point, the longer one POLYGON geometry. However two database entries
> are created for each feature ("name"). I could just merge these but I feel
> that OGR can create two geometry columns each for POINT and POLYGON, in
> fact this seems to be explicitly stated that it can do this in the news
> release for GDAL version 2.

What you observe is the intended behaviour of -explodecollections, but not what you want.

> 
> Should I be using some kind of SQL statement on the OGR command line to
> make it do this ?

You can indeed use Spatialite SQL to do what you want if you specify the SQLite dialect 
(http://gdal.org/ogr_sql_sqlite.html). If you look at http://www.gaia-gis.it/gaia-sins/
spatialite-sql-4.3.0.html, you can see there's a ST_CollectionExtract function as well.

So something like

ogr2ogr -overwrite PG:xxxxx your.kml -dialect SQLite -sql "SELECT 
ST_CollectionExtract(geometry, 1) AS the_point, ST_COLLECTIONExtract(geometry, 3) AS 
the_polygon, * FROM the_layer"

Even

> Michael Z Freeman
> 
> On Mon, November 21, 2016 7:30 am, jratike80 wrote:
> > Hi,
> > 
> > 
> > The main problem is that KML support such data models which do not suit
> > well with the simple feature model of GDAL. You can get some information
> > about that by reading http://www.gdal.org/drv_libkml.html.
> > 
> > In your case each feature has two geometries: one point and one polygon.
> > Best that can be done with the simple feature model it to push them both
> > into one geometry which in that case must be a geometry collection. Here
> > is one example from your data
> > 
> > GEOMETRYCOLLECTION (POINT (-1.282 87.1064),POLYGON ((3.02457
> > 87.0792,2.22294
> > 86.9806,-5.655 87.1168,-5.098 87.2201,3.02457 87.0792)))
> > 
> > 
> > You can save geometry collections into PostGIS if you use ogr2ogr with
> > switch "-nlt geometry". However, saving geometry collections into PostGIS
> > may not solve your problem because only few GIS programs can handle
> > geometry collections well.
> > 
> > A better option for you might be to explode the collections and save
> > points and polygons as separate features into PostGIS. The ogr2ogr command
> > to use is like
> > 
> > ogr2ogr -f PGDump output_pgdump -nlt geometry -explodecollections
> > Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml
> > 
> > 
> > If you want to have a quick look at your data, use JML as outputformat
> > and open the result with OpenJUMP. It shows both the geometry collections
> > and exploded collections fine for me with names and descriptions.
> > 
> > -Jukka Rahkonen-
> > 
> > 
> > 
> > 
> > --
> > View this message in context:
> > http://osgeo-org.1560.x6.nabble.com/gdal-dev-Unable-to-extract-features-f
> > rom-KML-tp5296670p5296708.html Sent from the GDAL - Dev mailing list
> > archive at Nabble.com. _______________________________________________
> > gdal-dev mailing list gdal-dev at lists.osgeo.org
> > http://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/9e8ab001/attachment-0001.html>

From michael-gdal at michaelzfreeman.org  Thu Nov 24 12:33:56 2016
From: michael-gdal at michaelzfreeman.org (Michael Z Freeman)
Date: Thu, 24 Nov 2016 20:33:56 -0000
Subject: [gdal-dev] Unable to extract features from KML
In-Reply-To: <3151273.SmICnLHSp8@even-i700>
References: <80ad2738b3dc5fc601725af0f301f1da.squirrel@server105.webhostingbuzz.com>
 <1479713418864-5296708.post@n6.nabble.com>
 <ce28d4b1895224fffabccb73352920f6.squirrel@server105.webhostingbuzz.com>
 <3151273.SmICnLHSp8@even-i700>
Message-ID: <28b935d78ad67b1efac445ce78d1563d.squirrel@server105.webhostingbuzz.com>

Hi Even Rouault,

Thanks. I had not found those SQL dialect docs for some reason so no
wonder it was not making sense.

I am now using ...

ogr2ogr -overwrite -f PostgreSQL PG:"dbname=original_hirise"
Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml -nln gdal_hirise_from_kml -a_srs
"EPSG:4326" -dialect SQLite -sql "SELECT ST_CollectionExtract(geometry, 1)
AS postgis_point, ST_CollectionExtract(geometry, 3) AS postgis_polygon, *
FROM 'MC-1, Mare Boreum (North Pole), 0-0-0'"

I can access the database using QGIS and all the Polygons and Markers
appear in the correct locations. Now to import the entire HiRise feature
set :)

Michael Z Freeman

On Thu, November 24, 2016 5:03 pm, Even Rouault wrote:
> On jeudi 24 novembre 2016 16:54:31 CET Michael Z Freeman wrote:
>
>> Hi,
>>
>>
>> Still having trouble with this after updating to ogr2ogr/gdal 2.1.1.
>>
>>
>> Some of it is undoubtedly my unfamiliarity with GDAL. I'm on the steep
>> part of the learning curve ! But fun.
>>
>> "ogr2ogr -f PostgreSQL PG:"dbname=original_hirise" -a_srs "EPSG:4326"
>> -lco
>> OVERWRITE=YES -explodecollections -nlt geometry
>> Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml"
>>
>>
>> ... creates (an edited CSV exported from a PGAdmin4 query) ...
>>
>>
>> "ogc_fid","name","description","wkb_geometry"
>> 1,"ESP_018108_2680","[...]","0101000020E61000000AD7A3703D6A3EC0744694F60
>> 6035
>> 640"
>> 2,"ESP_018108_2680","[...]","0103000020E61000000100000005000000A4703D0AD
>> 723
>>
>>
> 3CC079E9263108FC55400000000000C03FC0F4FDD478E9FA5540F0A7C64B377940C0992A1
>  895
>
>>
> D4095640FCA9F1D24DE23CC002BC0512140B5640A4703D0AD7233CC079E9263108FC5540
> "
>
>> 3,"ESP_018318_2675","[...]","0101000020E6100000A245B6F3FD543EC0728A8EE4
>> F2DF
>> 5540"
>> 4,"ESP_018318_2675","[...]","0103000020E610000001000000050000004260E5D02
>> 23B
>>
>>
> 3BC00C022B8716D95540AAF1D24D62503DC0FED478E926D55540448B6CE7FBD940C0C36
> 4AA60
>
>>
> 54E6554039B4C876BE7F3FC06D567DAEB6EA55404260E5D0223B3BC00C022B8716D95540
> "
>
>>
>> As you can see the geometries from the KML are exploded ... the short
>> WKB
>> is a point, the longer one POLYGON geometry. However two database
>> entries are created for each feature ("name"). I could just merge these
>> but I feel that OGR can create two geometry columns each for POINT and
>> POLYGON, in
>> fact this seems to be explicitly stated that it can do this in the news
>> release for GDAL version 2.
>
> What you observe is the intended behaviour of -explodecollections, but
> not what you want.
>
>>
>> Should I be using some kind of SQL statement on the OGR command line to
>>  make it do this ?
>
> You can indeed use Spatialite SQL to do what you want if you specify the
> SQLite dialect
> (http://gdal.org/ogr_sql_sqlite.html). If you look at
> http://www.gaia-gis.it/gaia-sins/
> spatialite-sql-4.3.0.html, you can see there's a ST_CollectionExtract
> function as well.
>
> So something like
>
>
> ogr2ogr -overwrite PG:xxxxx your.kml -dialect SQLite -sql "SELECT
> ST_CollectionExtract(geometry, 1) AS the_point,
> ST_COLLECTIONExtract(geometry, 3) AS
> the_polygon, * FROM the_layer"
>
> Even
>
>
>> Michael Z Freeman
>>
>>
>> On Mon, November 21, 2016 7:30 am, jratike80 wrote:
>>
>>> Hi,
>>>
>>>
>>>
>>> The main problem is that KML support such data models which do not
>>> suit well with the simple feature model of GDAL. You can get some
>>> information about that by reading http://www.gdal.org/drv_libkml.html.
>>>
>>>
>>> In your case each feature has two geometries: one point and one
>>> polygon. Best that can be done with the simple feature model it to
>>> push them both into one geometry which in that case must be a geometry
>>> collection. Here is one example from your data
>>>
>>> GEOMETRYCOLLECTION (POINT (-1.282 87.1064),POLYGON ((3.02457
>>> 87.0792,2.22294
>>> 86.9806,-5.655 87.1168,-5.098 87.2201,3.02457 87.0792)))
>>>
>>>
>>>
>>> You can save geometry collections into PostGIS if you use ogr2ogr
>>> with switch "-nlt geometry". However, saving geometry collections into
>>> PostGIS
>>> may not solve your problem because only few GIS programs can handle
>>> geometry collections well.
>>>
>>> A better option for you might be to explode the collections and save
>>> points and polygons as separate features into PostGIS. The ogr2ogr
>>> command to use is like
>>>
>>> ogr2ogr -f PGDump output_pgdump -nlt geometry -explodecollections
>>> Beyer_Hirise_Areas_KML/MC-01-0-0-0.kml
>>>
>>>
>>>
>>> If you want to have a quick look at your data, use JML as
>>> outputformat and open the result with OpenJUMP. It shows both the
>>> geometry collections and exploded collections fine for me with names
>>> and descriptions.
>>>
>>> -Jukka Rahkonen-
>>>
>>>
>>>
>>>
>>>
>>> --
>>> View this message in context:
>>> http://osgeo-org.1560.x6.nabble.com/gdal-dev-Unable-to-extract-feature
>>> s-f rom-KML-tp5296670p5296708.html Sent from the GDAL - Dev mailing
>>> list archive at Nabble.com.
>>> _______________________________________________
>>> gdal-dev mailing list gdal-dev at lists.osgeo.org
>>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
>> _______________________________________________
>> gdal-dev mailing list gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com



From jonathan-lists at lightpear.com  Thu Nov 24 14:20:15 2016
From: jonathan-lists at lightpear.com (Jonathan Moules)
Date: Thu, 24 Nov 2016 22:20:15 +0000
Subject: [gdal-dev] ElasticSearch and native geometry
In-Reply-To: <2c7004c5716e4cb9b02ce654a4a8dcea@C119S212VM022.msvyvi.vaha.local>
References: <2c7004c5716e4cb9b02ce654a4a8dcea@C119S212VM022.msvyvi.vaha.local>
Message-ID: <5837679F.4090008@lightpear.com>

Hi Jukka,
I'm still very new to ElasticSearch (so take with plenty of salt!), but 
if you want to keep the geom in _source and calculate on the fly, I 
guess you could maybe try it with one of the scripting languages: 
https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html 
- Python's on there so then you'd have access to all of the py-geo stuff.

Of course, assuming it worked, the trade-off would be reduced storage 
for (considerably?) increase processing usage and complexity.

The other option would be to store the native geometry as a "binary" 
datatype - 
https://www.elastic.co/guide/en/elasticsearch/reference/current/binary.html

Cheers,
Jonathan


On 23/11/2016 15:41, Rahkonen Jukka (MML) wrote:
>
> Hi,
>
> What if somebody would like to use ElasticSearch for queries but still 
> somehow get the native geometries included in the output?  The 
> geometry must be re-projected into EPSG:4326 for creating either 
> geo_point or geo_shape, but can anybody suggest a clever way for 
> saving the native geometry? It is of course possible to save it into a 
> text field for example as WKT of JSON but could it be possible to keep 
> the original geometry in “_source” and just create the geo_point or 
> geo_shape on-the-fly or the index?
>
> -Jukka Rahkonen-
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161124/ff44e47b/attachment.html>

From daniele.romagnoli at geo-solutions.it  Fri Nov 25 02:06:08 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Fri, 25 Nov 2016 11:06:08 +0100
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
 palette for overviews?
In-Reply-To: <CAJaHrDwarL7GoLvtoYxZ27UBbZpkO1bd9SNjv+Vscwsj9sK4VQ@mail.gmail.com>
References: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
 <3865696.ux6cRO9uH7@even-i700>
 <CAJaHrDw+S_sgQHx71-+vtT3cWcoGVj32T3kkYs=WQZZG24Rzzw@mail.gmail.com>
 <2185217.tZo4xrGmKO@even-i700>
 <CAJaHrDwarL7GoLvtoYxZ27UBbZpkO1bd9SNjv+Vscwsj9sK4VQ@mail.gmail.com>
Message-ID: <CAJaHrDx58T66ysywEVR_zAKseYuQYQtNDGJpEYOQ=zoYiyYTZw@mail.gmail.com>

For future references (...mainly for me), I'm updating the previous links
using a tagged version.
Otherwise, the line numbers referring a trunk repository will point to some
comment or unrelated things :)

https://github.com/OSGeo/gdal/blob/tags/2.1.2/gdal/frmts/gtiff/geotiff.cpp#L4565
https://github.com/OSGeo/gdal/blob/tags/2.1.2/gdal/frmts/gtiff/geotiff.cpp#L8014
https://github.com/OSGeo/gdal/blob/tags/2.1.2/gdal/frmts/gtiff/geotiff.cpp#L8367

Daniele


On Thu, Nov 24, 2016 at 5:22 PM, Daniele Romagnoli <
daniele.romagnoli at geo-solutions.it> wrote:

>
>
> On Thu, Nov 24, 2016 at 5:01 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> On jeudi 24 novembre 2016 16:51:59 CET Daniele Romagnoli wrote:
>>
>> > Doh!
>>
>> > Thanks for the feedback, Even.
>>
>
>
>> (Indeed it seemed strange to me that nobody had ever noticed before)
>>
> Sorry, what I meant with that was that I didn't see that ticket before
> sending my email so it seemed strange to me that nobody noticed the palette
> math weirdness :)
>
>
>>
>>
>> Not that much regarding software using GDAL since if you don't explicitly
>> request the overview bands/datasets but rather use the subsampling
>> RasterIO() calls, you'll never work directly with the color table of the
>> overviews but still use the one of the main dataset (or even if you request
>> the overviews directly I guess in most cases applications don't bother
>> checking if the color table of the overview).
>>
>
> As far as I can see, the TIFFImageReader parses the metadata information
> based on imageIndex (so overview number). I will double check if things
> were working differently in the colormap topic before our
> changes/optimizations to this class.
>
>
>> In GDAL, overviews conceptually share the same palette than the main
>> image. Otherwise subsampling RasterIO() will return values of the overview
>> palette that will be interpreted with the palette of the main image. You
>> can imagine the fun visual effects if the palette are not the same... So
>> this is assumed, but not checked.
>>
>>
>>
>> Could be worth fixing that if that cause issues (apparently in your use
>> case at least), but I'd be interested by information of what is the
>> standard/recommanded/best-practice-in-the-industry/etc... formulas to
>> use for the mapping between the [0,255] and [0,65535] ranges.
>>
>>
>>
>
> Cheers,
> Daniele
>
>> >
>>
>> > Best Regards,
>>
>> > Daniele
>>
>> >
>>
>> > On Thu, Nov 24, 2016 at 1:35 PM, Even Rouault <
>> even.rouault at spatialys.com>
>>
>> >
>>
>> > wrote:
>>
>> > > Daniele,
>>
>> > >
>>
>> > >
>>
>> > >
>>
>> > > This is indeed an inconsistency I spotted a long time ago :
>>
>> > >
>>
>> > > https://trac.osgeo.org/gdal/ticket/2213
>>
>> > >
>>
>> > >
>>
>> > >
>>
>> > > Nobody was apparently sufficiently annoyed by this to fix it.
>> Actually I
>>
>> > > see I proposed a patch. Was probably waiting for feedback. I'm not
>> sure if
>>
>> > > there's a standardized way of converting between the [0,255] and
>> [0,65535]
>>
>> > > ranges.
>>
>> > >
>>
>> > >
>>
>> > >
>>
>> > > Even
>>
>> > >
>>
>> > > > Hi List,
>>
>> > > >
>>
>> > > > I'm investigating on a issue I have with a paletted image with
>>
>> > > > overviews,
>>
>> > > >
>>
>> > > > using java ImageIO tiff reader (wait... I know on this list we
>> discuss
>>
>> > > >
>>
>> > > > about GDAL topics :) ).
>>
>> > > >
>>
>> > > > I'm trying to better understand palette interpretation and palette
>>
>> > >
>>
>> > > storing
>>
>> > >
>>
>> > > > on tags and how they are handled by GDAL.
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > From TIFF specifications, colormap entries are stored as short
>> values.
>>
>> > > >
>>
>> > > > I have a sample file with this color tab (as reported by gdalinfo).
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > Color Table (RGB with 256 entries)
>>
>> > > >
>>
>> > > > 0: *164*,164,164,255
>>
>> > > >
>>
>> > > > 1: *255*,255,255,255
>>
>> > > >
>>
>> > > > 2: 0,0,0,255
>>
>> > > >
>>
>> > > > 3: 0,0,0,255
>>
>> > > >
>>
>> > > > .... repeat 0,0,0,255 to the end.
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > Using an Hex editor or AsTiffTagViewer, I can see the byte values
>> of the
>>
>> > > >
>>
>> > > > colormap as stored on the file.
>>
>> > > >
>>
>> > > > For the first 4 mappings of the colortable the Red components are:
>>
>> > > >
>>
>> > > > *A4 A4* *FF FF* 00 00 00 00
>>
>> > > >
>>
>> > > > (8 bytes = 4 shorts)
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > As far as I have understood, this is related to that part of the
>>
>> > > >
>>
>> > > > specification (quoting it, section 5):
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > *In a TIFF ColorMap, all the Red values come first, followed by the
>>
>> > > > Green
>>
>> > > >
>>
>> > > > values, then the Blue values. In the ColorMap, black is represented
>> by
>>
>> > > >
>>
>> > > > 0,0,0 and white is represented by 65535, 65535, 65535*
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > So the second entry of the map, being white (255, 255, 255) has its
>> red
>>
>> > > >
>>
>> > > > value stored as 65535 = *FF FF *whilst the first color
>> (164,164,164) has
>>
>> > > >
>>
>> > > > its red value stored as 42148 = *A4 A4*
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > I see this behavior is confirmed by the way the geotiff.cpp create
>> the
>>
>> > > >
>>
>> > > > colortable:
>>
>> > > >
>>
>> > > > https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/
>>
>> > >
>>
>> > > geotiff.cpp#L5043
>>
>> > >
>>
>> > > > panTRed[iColor] = static_cast<unsigned short>(257 * sRGB.c1);
>>
>> > > >
>>
>> > > > panTGreen[iColor] = static_cast<unsigned short>(257 * sRGB.c2);
>>
>> > > >
>>
>> > > > panTBlue[iColor] = static_cast<unsigned short>(257 * sRGB.c3)
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > Applying a color*257 multiplication allows to have its 8 bits color
>>
>> > > >
>>
>> > > > representation stored into a short where intensity goes from 0 to
>> 65535.
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > The issue I have is that when using gdaladdo, the overviews are
>>
>> > > > generated
>>
>> > > >
>>
>> > > > with a different color table.
>>
>> > > >
>>
>> > > > So that the first 8 bytes of the red component stored in the
>> colormap,as
>>
>> > > >
>>
>> > > > reported by AsTiffTagViewer are:
>>
>> > > >
>>
>> > > > *A4* 00 *FF* 00 00 00 00 00
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > When converting it back to a 0-255 color component with the formula
>>
>> > > >
>>
>> > > > R*255/65535 it become *163* instead of 164.
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > I see in the GDAL code that both the IBuildOverviews and
>>
>> > > >
>>
>> > > > CreateOverviewsFromSrcOverviews call the CreateTIFFColorTable
>> function
>>
>> > > >
>>
>> > > > which multiplies the colorMapEntry by 256 instead of 257.
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/
>>
>> > >
>>
>> > > geotiff.cpp#L9137
>>
>> > >
>>
>> > > > This may explain the *A4* 00 *FF* 00 entries in the overview with
>>
>> > > > respect
>>
>> > > >
>>
>> > > > to the *A4 A4 FF FF *entries in the main level.
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > Do you have any feedback on this?
>>
>> > > >
>>
>> > > > Please, let me know what do you think about it.
>>
>> > > >
>>
>> > > >
>>
>> > > >
>>
>> > > > Best Regards,
>>
>> > > >
>>
>> > > > Daniele
>>
>> > >
>>
>> > > --
>>
>> > >
>>
>> > > Spatialys - Geospatial professional services
>>
>> > >
>>
>> > > http://www.spatialys.com
>>
>> > >
>>
>> > > _______________________________________________
>>
>> > > gdal-dev mailing list
>>
>> > > gdal-dev at lists.osgeo.org
>>
>> > > http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
>
> --
> ==
> GeoServer Professional Services from the experts! Visit
> http://goo.gl/it488V for more information.
> ==
>
> Ing. Daniele Romagnoli
> Senior Software Engineer
>
> GeoSolutions S.A.S.
> Via di Montramito 3/A
> 55054  Massarosa (LU)
> Italy
> phone: +39 0584 962313
> fax:      +39 0584 1660272
>
> http://www.geo-solutions.it
> http://twitter.com/geosolutions_it
>
> -------------------------------------------------------
>
> *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
>
> Le informazioni contenute in questo messaggio di posta elettronica e/o
> nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
> loro utilizzo è consentito esclusivamente al destinatario del messaggio,
> per le finalità indicate nel messaggio stesso. Qualora riceviate questo
> messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
> darcene notizia via e-mail e di procedere alla distruzione del messaggio
> stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
> divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
> utilizzarlo per finalità diverse, costituisce comportamento contrario ai
> principi dettati dal D.Lgs. 196/2003.
>
>
>
> The information in this message and/or attachments, is intended solely for
> the attention and use of the named addressee(s) and may be confidential or
> proprietary in nature or covered by the provisions of privacy act
> (Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
> Code).Any use not in accord with its purpose, any disclosure, reproduction,
> copying, distribution, or either dissemination, either whole or partial, is
> strictly forbidden except previous formal approval of the named
> addressee(s). If you are not the intended recipient, please contact
> immediately the sender by telephone, fax or e-mail and delete the
> information in this message that has been received in error. The sender
> does not give any warranty or accept liability as the content, accuracy or
> completeness of sent messages and accepts no responsibility  for changes
> made after they were sent or for other risks which arise as a result of
> e-mail transmission, viruses, etc.
>
>


-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161125/9deee5b7/attachment-0001.html>

From ari.jolma at gmail.com  Fri Nov 25 02:27:04 2016
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 25 Nov 2016 12:27:04 +0200
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
 palette for overviews?
In-Reply-To: <2185217.tZo4xrGmKO@even-i700>
References: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
 <3865696.ux6cRO9uH7@even-i700>
 <CAJaHrDw+S_sgQHx71-+vtT3cWcoGVj32T3kkYs=WQZZG24Rzzw@mail.gmail.com>
 <2185217.tZo4xrGmKO@even-i700>
Message-ID: <e658714e-aaf8-26fd-3866-11d9f92fcc33@gmail.com>

24.11.2016, 18:01, Even Rouault kirjoitti:
>
> Could be worth fixing that if that cause issues (apparently in your 
> use case at least), but I'd be interested by information of what is 
> the standard/recommanded/best-practice-in-the-industry/etc... formulas 
> to use for the mapping between the [0,255] and [0,65535] ranges.
>

At least in the GTK circles it seems to be a standard practice to use 
the 257 as the scaling factor. See for example

http://gtk2-perl.sourceforge.net/doc/pod/Gtk2/Gdk/Color.html

Ari



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161125/1f29fe5a/attachment.html>

From daniele.romagnoli at geo-solutions.it  Fri Nov 25 03:14:52 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Fri, 25 Nov 2016 12:14:52 +0100
Subject: [gdal-dev] Troubleshooting palette management. Potential bug in
 palette for overviews?
In-Reply-To: <e658714e-aaf8-26fd-3866-11d9f92fcc33@gmail.com>
References: <CAJaHrDzchSZ1TaFfimQBG-xCZ_POunaObKmVqejqRcomE7fUTw@mail.gmail.com>
 <3865696.ux6cRO9uH7@even-i700>
 <CAJaHrDw+S_sgQHx71-+vtT3cWcoGVj32T3kkYs=WQZZG24Rzzw@mail.gmail.com>
 <2185217.tZo4xrGmKO@even-i700>
 <e658714e-aaf8-26fd-3866-11d9f92fcc33@gmail.com>
Message-ID: <CAJaHrDzgmHuvq=t+wXT_tOiv3isZ1GEKAksytKOHhWDSjygtSw@mail.gmail.com>

JAI-ImageIO TIFFDecompressor does the same (Line 0888):
https://java.net/projects/jai-imageio-core/sources/svn/content/trunk/src/share/classes/com/sun/media/imageio/plugins/tiff/TIFFDecompressor.java?rev=254

(also putting an imageio-ext link for quicker reference)
https://github.com/geosolutions-it/imageio-ext/blob/master/plugin/tiff/src/main/java/it/geosolutions/imageio/plugins/tiff/TIFFDecompressor.java#L900

Note the:
redLut[i] = (byte)((colorMap[i]*255)/65535);
which results into using a 257 scale factor.

Cheers,
Daniele


On Fri, Nov 25, 2016 at 11:27 AM, Ari Jolma <ari.jolma at gmail.com> wrote:

> 24.11.2016, 18:01, Even Rouault kirjoitti:
>
>
>
> Could be worth fixing that if that cause issues (apparently in your use
> case at least), but I'd be interested by information of what is the
> standard/recommanded/best-practice-in-the-industry/etc... formulas to use
> for the mapping between the [0,255] and [0,65535] ranges.
>
>
> At least in the GTK circles it seems to be a standard practice to use the
> 257 as the scaling factor. See for example
>
> http://gtk2-perl.sourceforge.net/doc/pod/Gtk2/Gdk/Color.html
>
> Ari
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161125/45f1a4a9/attachment.html>

From schwehr at gmail.com  Fri Nov 25 05:59:13 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 25 Nov 2016 05:59:13 -0800
Subject: [gdal-dev] Mass addition of 'override' keyword ?
In-Reply-To: <9261427.2BdVH6jUIX@even-i700>
References: <9261427.2BdVH6jUIX@even-i700>
Message-ID: <CACmBxyvnHNbOejQ7QBkrU3QHAjGHupE2pG3jvuASaqZkq3q3fw@mail.gmail.com>

Great!  +1

I've had the override keyword catch a number of bugs in other projects.

On Thu, Nov 24, 2016 at 1:33 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
>
>
> I've a branch where I've added the 'override' keyword to virtual methods
> that
>
> are an override of a virtual method declared in a base class.
>
>
>
> https://github.com/OSGeo/gdal/compare/trunk...rouault:add_
> override?expand=1
>
>
>
> Of course, not completely manually, but at >90% with the help of
> clang-tidy.
>
> GCC >= 5.1 has a -Wsuggest-override warning that I've enabled
>
> in configure to find all places missed by tidy-clang (at least with the
> drivers I've
>
> enabled in that branch). And recent clang versions have a less powerful
>
> -Winconsistent-missing-override (enabled with -Wall I think) that warns
> when
>
> you have explicitly tagged an overriden method with 'override' but
> neglected
>
> to do so for other overriden methods of the same class. So new code should
>
> be override friendly.
>
>
>
> As we still support C++03 compilers, the following tricks are used :
>
>
>
> 1) If the compiler doesn't advertize C++11 support, we #define override to
> empty in
>
> cpl_port.h. But that only if -DGDAL_COMPILATION is defined (which is the
> case
>
> in the Unix and Windows makefiles used to build GDAL), so as to avoid
> messing the
>
> namespace of code that includes GDAL.
>
>
>
> 2) As we don't want 'override' to leak into installed headers to keep C++03
>
> compat, then CPL_OVERRIDE is used in those files, instead of plain
> 'override'.
>
> It is a #define to override is the compiler is C++11 enabled, or #define to
>
> empty otherwise.
>
>
>
> As words may poorly reflect the reality of the code, here's the code:
>
> {{{
>
> #ifdef __cplusplus
>
>
>
> #if HAVE_CXX11 || _MSC_VER >= 1600
>
>
>
> /** To be used in public headers only. For non-public headers or .cpp
> files,
>
> * use override directly. */
>
> # define CPL_OVERRIDE override
>
>
>
> #else
>
>
>
> /** To be used in public headers only. For non-public headers or .cpp
> files,
>
> * use override directly. */
>
> # define CPL_OVERRIDE
>
>
>
> /* For GDAL source compilation only, ignore override if non C++11 compiler
> */
>
> #ifdef GDAL_COMPILATION
>
> # define override
>
> #endif
>
>
>
> #endif /* __cpluscplus */
>
>
>
> }}}
>
>
>
> So in summary: use override in all .cpp files and non-installed .h headers.
>
> Use CPL_OVERRIDE in installed .h headers. Will make C++11 compilers enforce
>
> overriding, and C++03 ones ignore it.
>
>
>
>
>
> Interestingly in the process, I found a rather odd bug which pre-existed
>
> unnoticed. It is Windows specific. In VSIFilesystemHandler
>
> we have a virtual method GetDiskFreeSpace(). But on Windows, if you include
>
> <windows.h>, GetDiskFreeSpace is a #define to the ANSI Win32 function
>
> GetDiskFreeSpaceA() ... So the VSIWin32FilesystemHandler::
> GetDiskFreeSpace()
>
> method was actually evaluated as
>
> VSIWin32FilesystemHandler::GetDiskFreeSpaceA() by the preprocessor in
>
> port/cpl_vsil_win32.cpp, and not as an override of the base
>
> VSIFilesystemHandler::GetDiskFreeSpace()... Not critical since this is
> rarely
>
> used, and code that use this method should be ready to receive the default
> -1
>
> value for filesystems that don't implement it.
>
>
>
> Thoughts regarding committing this?
>
>
>
> Windows and Unix builds are happy:
>
> * https://ci.appveyor.com/project/rouault/gdal2/build/1.0.38 (this one is
>
> C++11. Well actually VS12 is partially C++11, but sufficiently to
> understand override)
>
> * https://travis-ci.org/rouault/gdal2/builds/178478253 (mix of C++11 and
> C++03 configs)
>
>
>
> Even
>
>
>
> ~~~~~~~~~~~~~~~~~
>
>
>
> PS. For reference, here's the method I've rougly used to convert
>
> (with clang-tidy of clang 3.8)
>
>
>
> Create in GDAL root directory a ".clang-tidy" file with the following
> content:
>
>
>
> {
>
> Checks: '-*,modernize-use-override'
>
> }
>
>
>
>
>
> Then create a Python script "apply.py" that will use the output of
> clang-tidy to
>
> patch files with override. There is
>
> some complication to avoid it to remove the "virtual" keyword while adding
>
> the "override" one (and also avoiding tagging virtual destructors as
> override,
>
> which doesn't bring anything interesting. And actually is disliked by VS
> 2010).
>
> I think that for some analyzers like cppcheck, the virtual keyword
>
> might help them better understand the logic when they don't understand the
>
> override keyword (cppcheck 1.72 is in fact confused by the override
> keyword and
>
> produces a lot of false positives, so in the cppcheck.sh script, override
> is
>
> forced to be an empty #define).
>
>
>
> {{{
>
> import yaml
>
> import sys
>
>
>
> root = yaml.load( open(sys.argv[1], 'rb').read() )
>
> replacements = root['Replacements']
>
>
>
> files = {}
>
>
>
> for rep in replacements:
>
> f = rep['FilePath']
>
> if not f in files:
>
> files[f] = []
>
> files[f].append(rep)
>
>
>
> for f in files:
>
> content = open(f).read()
>
> shift = 0
>
> for rep in files[f]:
>
> # Do not apply replacements that will remove the 'virtual' keyword
>
> if rep['Length'] == 0 and rep['ReplacementText'] == ' override':
>
> insert_pos = rep['Offset'] + shift
>
> # Adding override to a virtual destructor is quite ugly. Don't do it
>
> is_destructor = False
>
> for i in range(80):
>
> if i > insert_pos:
>
> break
>
> if content[insert_pos-1-i] == ';':
>
> break
>
> if content[insert_pos-1-i] == '~':
>
> is_destructor = True
>
> break
>
> if not is_destructor:
>
> content = content[0:insert_pos] + rep['ReplacementText'] +
> content[insert_pos:]
>
> shift += len(rep['ReplacementText'])
>
>
>
> open(f, 'wb').write(content)
>
> }}}
>
>
>
> And then the main script "modernize.py"
>
>
>
> {{{
>
> import os
>
> import glob
>
>
>
> # To patch all drivers below frmts/. Adapt for other directories
>
> for dirname in glob.glob('frmts/*'):
>
> for file in glob.glob(dirname + '/*.h*') + glob.glob(dirname + '/*.cpp'):
>
> for file in glob.glob(dirname + '/*.h*') + glob.glob(dirname + '/*.c*'):
>
> print file
>
> os.system('rm replace.yml')
>
> os.system('clang-tidy -export-fixes=replace.yml ' + file + ' --
> -Iogr/ogrsf_frmts/gpkg -Ifrmts/vrt -I/usr/include/postgresql/ -Ifrmts/wms
> -I/usr/include -I/usr/include/xercesc -Ifrmts/netcdf -Ifrmts/pcidsk/sdk
> -Ifrmts/pcidsk/sdk/core -Ifrmts/pcidsk/sdk/channel -Ifrmts/gtiff -DLERC
> -Ifrmts/mrf -Ifrmts/mrf/libLERC -Ifrmts/raw -Iogr/ogrsf_frmts/sqlite
> -Iogr/ogrsf_frmts/couchdb -Iogr/ogrsf_frmts/geojson
> -Iogr/ogrsf_frmts/geojson/libjson -I/usr/include/fyba
> -Iogr/ogrsf_frmts/shape -Iogr/ogrsf_frmts/pgeo -Iogr/ogrsf_frmts/pgdump
> -Iogr/ogrsf_frmts/xplane -I/usr/include/ogdi -Iogr/ogrsf_frmts/gml
> -Iogr/ogrsf_frmts/mem -Iogr/ogrsf_frmts/gtm -Iogr/ogrsf_frmts/kml
> -Iogr/ogrsf_frmts/generic -DHAVE_POPPLER -I/usr/include/poppler
> -DHAVE_PODOFO -I/usr/include/podofo -DDEBUG -DCPL_UNUSED -DHAVE_SQLITe
> -DHAVE_XERCES -DHAVE_EXPAT -DHAVE_CURL -DHAVE_CRYPTOPP -DFRMT_ecw -Ignm
> -Ignm/gnm_frmts -I/home/even/install-libecwj2-3.3/include
> -I/usr/include/c++/5 -I/home/even/FileGDB_API_1.4/include
> -I/usr/include/x86_64-linux-gnu/c++/5 -Iport -Igcore -Iogr
> -Iogr/ogrsf_frmts -Ialg -std=c++11')
>
> os.system('python apply.py replace.yml')
>
>
>
>
>
> }}}
>
>
>
> Build, fix errors, and run "make install" and grep override in the
> installed
>
> headers. Then use your favorite text editor to replace override by
> CPL_OVERRIDE
>
> in those few files.
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161125/c2c111f2/attachment-0001.html>

From andrew at aitchison.me.uk  Fri Nov 25 07:48:55 2016
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Fri, 25 Nov 2016 15:48:55 +0000 (GMT)
Subject: [gdal-dev] Mass addition of 'override' keyword ?
In-Reply-To: <9261427.2BdVH6jUIX@even-i700>
References: <9261427.2BdVH6jUIX@even-i700>
Message-ID: <alpine.LRH.2.20.1611251546540.22225@warden.aitchison.me.uk>

On Thu, 24 Nov 2016, Even Rouault wrote:

> Hi,
>
> I've a branch where I've added the 'override' keyword to virtual methods that
> are an override of a virtual method declared in a base class.
>
> https://github.com/OSGeo/gdal/compare/trunk...rouault:add_override?expand=1
>
> Of course, not completely manually, but at >90% with the help of clang-tidy.
> GCC >= 5.1 has a -Wsuggest-override warning that I've enabled
> in configure to find all places missed by tidy-clang (at least with the drivers I've
> enabled in that branch). And recent clang versions have a less powerful
> -Winconsistent-missing-override (enabled with -Wall I think) that warns when
> you have explicitly tagged an overriden method with 'override' but neglected
> to do so for other overriden methods of the same class. So new code should
> be override friendly.
>
> As we still support C++03 compilers, the following tricks are used :
>
> 1) If the compiler doesn't advertize C++11 support, we #define override to empty in
> cpl_port.h. But that only if -DGDAL_COMPILATION is defined (which is the case
> in the Unix and Windows makefiles used to build GDAL), so as to avoid messing the
> namespace of code that includes GDAL.
>
> 2) As we don't want 'override' to leak into installed headers to keep C++03
> compat, then CPL_OVERRIDE is used in those files, instead of plain 'override'.
> It is a #define to override is the compiler is C++11 enabled, or #define to
> empty otherwise.
>
> As words may poorly reflect the reality of the code, here's the code:
> {{{
> #ifdef __cplusplus
>
> #if HAVE_CXX11 || _MSC_VER >= 1600
>
> /** To be used in public headers only. For non-public headers or .cpp files,
> * use override directly. */
> #  define CPL_OVERRIDE override
>
> #else
>
> /** To be used in public headers only. For non-public headers or .cpp files,
> * use override directly. */
> #  define CPL_OVERRIDE

We need an extra "#endif"
   #endif /* HAVE_CXX11 || _MSC_VER >= 1600 */
I think it goes here ?

> /* For GDAL source compilation only, ignore override if non C++11 compiler */
> #ifdef GDAL_COMPILATION
> #  define override
> #endif
>
> #endif /* __cpluscplus */
>
> }}}
>
> So in summary: use override in all .cpp files and non-installed .h headers.
> Use CPL_OVERRIDE in installed .h headers. Will make C++11 compilers enforce
> overriding, and C++03 ones ignore it.


From even.rouault at spatialys.com  Fri Nov 25 08:04:28 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 25 Nov 2016 17:04:28 +0100
Subject: [gdal-dev] Mass addition of 'override' keyword ?
In-Reply-To: <alpine.LRH.2.20.1611251546540.22225@warden.aitchison.me.uk>
References: <9261427.2BdVH6jUIX@even-i700>
 <alpine.LRH.2.20.1611251546540.22225@warden.aitchison.me.uk>
Message-ID: <3319528.F1JXrrNFG9@even-i700>

> We need an extra "#endif"
>    #endif /* HAVE_CXX11 || _MSC_VER >= 1600 */
> I think it goes here ?

Ah, sort of. I copied&pasted an extract of the whole file and my #endif /* __cpluscplus */ 
comment was indeed wrong and should have been #endif /* HAVE_CXX11 || _MSC_VER >= 
1600 */ (and the final #endif /* __cpluscplus */ is a bit later in the whole file). Fixed now. 
Thanks.

Anyway that has been now committed and everything seems to work fine
> 
> > /* For GDAL source compilation only, ignore override if non C++11 compiler
> > */ #ifdef GDAL_COMPILATION
> > #  define override
> > #endif
> > 
> > #endif /* __cpluscplus */
> > 
> > }}}

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161125/e6d28662/attachment.html>

From stefan.ziegler.de at gmail.com  Sat Nov 26 12:18:50 2016
From: stefan.ziegler.de at gmail.com (Stefan Ziegler)
Date: Sat, 26 Nov 2016 21:18:50 +0100
Subject: [gdal-dev] ogr python: copying features from postgis to postgis
Message-ID: <CAJvo+1_vbArWBW1bvGG1_wWxgX1NGwqOKpQU5ym_5B906i8mUg@mail.gmail.com>

Hi

I'm trying to copy some features from one postgis table to another postgis
table:

dstLayer.StartTransaction()

srcFeature = srcLayer.GetNextFeature()
while srcFeature is not None:
    srcLayerDefn = srcLayer.GetLayerDefn()

    dstLayerDefn = dstLayer.GetLayerDefn()
    dstFeature = ogr.Feature(dstLayerDefn)
    dstFeature.SetFID(-1)

    for i in range(0, dstLayerDefn.GetFieldCount()):
        attrName = dstLayerDefn.GetFieldDefn(i).GetNameRef()

        # ATTRIBUTES
        try:
            attrVal = srcFeature.GetField(attrName)
            dstFeature.SetField(attrName, attrVal)
        except ValueError:
            pass

    # GEOMETRY
    geom = srcFeature.GetGeometryRef()
    dstFeature.SetGeometry(geom)

    # ADD FEATURE
    dstLayer.CreateFeature(dstFeature)

    srcFeature = srcLayer.GetNextFeature()

dstLayer.CommitTransaction()

It throws an error when trying to create the new feature:

GNM: GNMRegisterAllInternal
GNM: RegisterGNMFile
GNM: RegisterGNMdatabase
PG: DBName="xanadu2"
PG: PostgreSQL version string : 'PostgreSQL 9.5.4 on x86_64-pc-linux-gnu,
compiled by gcc (Ubuntu 5.4.0-6ubuntu1~16.04.2) 5.4.0 20160609, 64-bit'
PG: PostGIS version string : '2.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1'
GDAL: GDALOpen(PG: host=localhost dbname=xanadu2 user=stefan
password=XXXXXXXXXX this=0x11e41b0) succeeds as PostgreSQL.
PG: Command Results Tuples = 11
GDAL: GDALDriver::Create(Memory,,0,0,0,Unknown,(nil))
PG: 11 features read on layer 'sql_statement'.
PG: DBName="xanadu2"
PG: PostgreSQL version string : 'PostgreSQL 9.5.4 on x86_64-pc-linux-gnu,
compiled by gcc (Ubuntu 5.4.0-6ubuntu1~16.04.2) 5.4.0 20160609, 64-bit'
PG: PostGIS version string : '2.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1'
GDAL: GDALOpen(PG: host=localhost dbname=xanadu2 user=stefan
password=XXXXXXXXXX this=0x12db330) succeeds as PostgreSQL.
PG: Primary key name (FID): t_id, type : int8
PG: Using column 't_id' as FID for table
'nachfuehrngskrise_nachfuehrungskreis'
Traceback (most recent call last):
  File "./datenumbau.py", line 117, in <module>
    dstLayer.CreateFeature(dstFeature)
  File "/usr/local/gdal_master/lib/python2.7/site-packages/osgeo/ogr.py",
line 1479, in CreateFeature
    return _ogr.Layer_CreateFeature(self, *args)
RuntimeError: OGR Error: General Error
GDAL: GDALClose(PG: host=localhost dbname=xanadu2 user=stefan
password=XXXXXXXXXX this=0x12db330)
GDAL: GDALClose(PG: host=localhost dbname=xanadu2 user=stefan
password=XXXXXXXXXX this=0x11e41b0)
GDAL: In GDALDestroy - unloading GDAL shared library.
GDAL: Force close of  (0x136abb0) in GDALDriverManager cleanup.
Mem: 1 features read on layer 'sql_statement'.

I'm bit confused about the "general error". Does anyone has an idea?

regards
Stefan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161126/c93ebf55/attachment.html>

From issworld2000 at yahoo.com  Sun Nov 27 02:49:27 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Sun, 27 Nov 2016 10:49:27 +0000 (UTC)
Subject: [gdal-dev] identifying the fields from the .osm file
In-Reply-To: <o0rm9f$2em$1@blaine.gmane.org>
References: <103690806.11821.1479519041764.ref@mail.yahoo.com>
 <103690806.11821.1479519041764@mail.yahoo.com>
 <CAMtDFL+eah2Cg7zE=y3dX7Z6fxMXK5TYMNCTa-ry0czOs6G=pQ@mail.gmail.com>
 <1757149020.118575.1479549477506@mail.yahoo.com>
 <CAMtDFLJHCLXiUpKPrjCYkh1az6OREuZvN-y7+F=gANPdxqFi1Q@mail.gmail.com>
 <840769665.311796.1479584740697@mail.yahoo.com>
 <o0rm9f$2em$1@blaine.gmane.org>
Message-ID: <892937378.1037386.1480243767948@mail.yahoo.com>

Thank you Andre.
 

    On Sunday, November 20, 2016 9:19 AM, Andre Joost <andre+joost at nurfuerspam.de> wrote:
 

 Am 19.11.2016 um 20:45 schrieb Djordje Spasic:
> Thank you Etienne.
> I am very interested in your reply, but I haven't quite understand you.
> The ogr2ogr.exe file is using a particular python script to read the .osm file and identify its unique fields?
> Can you be a bit more specific please? Solving this issue will mean a lot to me.
> Sorry for disturbance, and thank you for the clarification in advance.Regards,
> Djordje
>

I guess Etienne wants you to visit https://github.com/3liz/QuickOSM 
("the plugin") and look into the python code there to investigate how 
the QuickOSM plugin is able to read the .osm file twice to get the 
complete attribute list.

HTH,
André Joost


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman/listinfo/gdal-dev

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161127/b1e4e40a/attachment.html>

From issworld2000 at yahoo.com  Sun Nov 27 02:58:10 2016
From: issworld2000 at yahoo.com (Djordje Spasic)
Date: Sun, 27 Nov 2016 10:58:10 +0000 (UTC)
Subject: [gdal-dev] laundering of field's names in GDAL
References: <449646865.1044773.1480244290306.ref@mail.yahoo.com>
Message-ID: <449646865.1044773.1480244290306@mail.yahoo.com>

I have been puzzled with something for the last couple of days:

I am converting an .osm file to .shp files with ogr2ogr.exe.
This specific line in osmconf.ini file:

# comment to avoid laundering of keys ( ':' turned into '_' )
attribute_name_laundering=yes

determines whether colons in names of the OSM keys will be replaced (laundered) with underscores in names of .shp fields, once a conversion from .osm to .shp is completed.

The problem is that for some strange reason, this laundering always happens, regardless of how upper line looks like.

So by default the line in osmconf.ini file looks like this:
attribute_name_laundering=yes


I tried changing it to:
attribute_name_laundering=no
and
#attribute_name_laundering=yes
and
#attribute_name_laundering=no
And nothing worked. The laundering of the ":" to "_" is always performed.

Is this some sort of a bug?

Thank you for the reply.

Kind regards,
Djordje Spasic
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161127/e2342caa/attachment.html>

From gs.kevin1 at gmail.com  Sun Nov 27 05:06:59 2016
From: gs.kevin1 at gmail.com (Kevin)
Date: Mon, 28 Nov 2016 00:06:59 +1100
Subject: [gdal-dev] Question: making a raster - gdal_rasterize directly from
	Geodatabase file
Message-ID: <CA+a-Nu4Qkf81Ab8h7mxFQmnq6JgMV05bQdiZa0KdpUVSt1c9Ew@mail.gmail.com>

I wish to make a raster directly from a very large ESRI Geodatabase (GDB)
file.

The layer (State_ROAD) included in the GDB file is large: if I export the
layer into Shapefile or MapInfo Tab format, the output file size exceeds
2GB limit. So I am thinking if there is a way making a raster (road1.tif)
directly from the GDB file (COUNTRY_ROAD.gdb).

I have tried to use this cmd but failed.

gdal_rasterize -burn 1 -where "ROAD_ID < 1000000" -l State_ROAD
*COUNTRY_ROAD.gdb* State_ROAD *road1.tif*

I seek your generous help and suggestions.

Thank you!
Kevin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/840a7916/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Sun Nov 27 09:23:54 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Sun, 27 Nov 2016 10:23:54 -0700 (MST)
Subject: [gdal-dev] laundering of field's names in GDAL
In-Reply-To: <449646865.1044773.1480244290306@mail.yahoo.com>
References: <449646865.1044773.1480244290306@mail.yahoo.com>
Message-ID: <1480267434940-5297578.post@n6.nabble.com>

I believe that the answer in gis.stackexchange 
http://gis.stackexchange.com/questions/219177/can-colon-character-be-used-in-shapefile-field-names
is correct. The dBase III format that is used in shapefiles for storing
attributes does not accept colon in field names, and GDAL does not want to
write invalid shapefiles.

Laundering has an effect if data are converted into PostGIS, Spatialite or
other formats for which both "attribute_name" and "attribute:name" are valid
as field names. 

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-laundering-of-field-s-names-in-GDAL-tp5297549p5297578.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From nicolas.cadieux at archeotec.ca  Sun Nov 27 11:59:47 2016
From: nicolas.cadieux at archeotec.ca (Nicolas Cadieux)
Date: Sun, 27 Nov 2016 14:59:47 -0500
Subject: [gdal-dev] Question: making a raster - gdal_rasterize directly
	from Geodatabase file
In-Reply-To: <CA+a-Nu4Qkf81Ab8h7mxFQmnq6JgMV05bQdiZa0KdpUVSt1c9Ew@mail.gmail.com>
References: <CA+a-Nu4Qkf81Ab8h7mxFQmnq6JgMV05bQdiZa0KdpUVSt1c9Ew@mail.gmail.com>
Message-ID: <8E0FA94A-F4A4-4606-BF98-B94A06EBB5D9@archeotec.ca>

Hi,
If you go from a vector to a raster format, you will loose all the information.  Best to save to SpatialLite database.  It a single file.

> Le 27 nov. 2016 à 08:06, Kevin <gs.kevin1 at gmail.com> a écrit :
> 
> I wish to make a raster directly from a very large ESRI Geodatabase (GDB) file. 
> 
> The layer (State_ROAD) included in the GDB file is large: if I export the layer into Shapefile or MapInfo Tab format, the output file size exceeds 2GB limit. So I am thinking if there is a way making a raster (road1.tif) directly from the GDB file (COUNTRY_ROAD.gdb).
> 
> I have tried to use this cmd but failed. 
> 
> gdal_rasterize -burn 1 -where "ROAD_ID < 1000000" -l State_ROAD COUNTRY_ROAD.gdb State_ROAD road1.tif
> 
> I seek your generous help and suggestions. 
> 
> Thank you!
> Kevin
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161127/61d9afff/attachment.html>

From orontee at gmail.com  Sun Nov 27 14:27:29 2016
From: orontee at gmail.com (Matthias Meulien)
Date: Sun, 27 Nov 2016 23:27:29 +0100
Subject: [gdal-dev] Reading KML tree using LIBKML driver
Message-ID: <1480285649.10073.1.camel@gmail.com>

I am trying to recover the tree structure of KML folders while
reading  a dataset created from a .kml  or a .kmz file with the LIBKML
driver.

My idea is to loop through the dataset layers and maintain a mapping
from kmldom::ElementPtr to  layers

    std::map<kmldom::ElementPtr, OGRLayer*> parents;  

Each layer, say l1, is cast to OGRLIBKMLLayer; its associated
kmldom::ElementPtr is read using OGRLIBKMLLayer::GetKmlLayer() and a
search is performed for one of its ancestor in the parents mapping...

Is there a simpler way to recover the tree structure of KML files?

Until now I've only obtained partial results using this approach :-(
The following naive implementation works for dataset coming from a KML
file:

    for (int i = 0; i < dataset->GetLayerCount(); ++i) {
        auto* const layer = dataset->GetLayer(i);
        auto* const kmlLayer = static_cast<OGRLIBKMLLayer*>(layer);

        kmldom::ElementPtr element = kmlLayer->GetKmlLayer();
        kmldom::ElementPtr ancestor = kmlLayer.GetParent();

        std::map<kmldom::ElementPtr, OGRLayer*>::iterator s =
parents.find(ancestor);        while ((s == std::end(parents)) &&
ancestor) {
            kmldom::ElementPtr temp = ancestor->GetParent();           
   
            ancestor = temp;
            s = parents.find(ancestor);
        }
        if (s != std::end(parents)) {
            // Ok layer's parent is s->second
            ...
        } else {
            // layer is a root folder
            ...
        }
        parents[element] = layer;
    }

But it crashes on ancestor = temp when the source file is a KMZ file...
Any clue?
-- 
Matthias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161127/1d99c59b/attachment.html>

From even.rouault at spatialys.com  Sun Nov 27 15:02:35 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 28 Nov 2016 00:02:35 +0100
Subject: [gdal-dev] ogr python: copying features from postgis to postgis
In-Reply-To: <CAJvo+1_vbArWBW1bvGG1_wWxgX1NGwqOKpQU5ym_5B906i8mUg@mail.gmail.com>
References: <CAJvo+1_vbArWBW1bvGG1_wWxgX1NGwqOKpQU5ym_5B906i8mUg@mail.gmail.com>
Message-ID: <1553919.pQYFyMlHxK@even-i700>

On samedi 26 novembre 2016 21:18:50 CET Stefan Ziegler wrote:
> Hi
> 
> I'm trying to copy some features from one postgis table to another postgis
> table:
> 
> dstLayer.StartTransaction()
> 
> srcFeature = srcLayer.GetNextFeature()
> while srcFeature is not None:
>     srcLayerDefn = srcLayer.GetLayerDefn()
> 
>     dstLayerDefn = dstLayer.GetLayerDefn()
>     dstFeature = ogr.Feature(dstLayerDefn)
>     dstFeature.SetFID(-1)
> 
>     for i in range(0, dstLayerDefn.GetFieldCount()):
>         attrName = dstLayerDefn.GetFieldDefn(i).GetNameRef()
> 
>         # ATTRIBUTES
>         try:
>             attrVal = srcFeature.GetField(attrName)
>             dstFeature.SetField(attrName, attrVal)
>         except ValueError:
>             pass
> 
>     # GEOMETRY
>     geom = srcFeature.GetGeometryRef()
>     dstFeature.SetGeometry(geom)
> 
>     # ADD FEATURE
>     dstLayer.CreateFeature(dstFeature)
> 
>     srcFeature = srcLayer.GetNextFeature()
> 
> dstLayer.CommitTransaction()
> 
> It throws an error when trying to create the new feature:
> 
> GNM: GNMRegisterAllInternal
> GNM: RegisterGNMFile
> GNM: RegisterGNMdatabase
> PG: DBName="xanadu2"
> PG: PostgreSQL version string : 'PostgreSQL 9.5.4 on x86_64-pc-linux-gnu,
> compiled by gcc (Ubuntu 5.4.0-6ubuntu1~16.04.2) 5.4.0 20160609, 64-bit'
> PG: PostGIS version string : '2.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1'
> GDAL: GDALOpen(PG: host=localhost dbname=xanadu2 user=stefan
> password=XXXXXXXXXX this=0x11e41b0) succeeds as PostgreSQL.
> PG: Command Results Tuples = 11
> GDAL: GDALDriver::Create(Memory,,0,0,0,Unknown,(nil))
> PG: 11 features read on layer 'sql_statement'.
> PG: DBName="xanadu2"
> PG: PostgreSQL version string : 'PostgreSQL 9.5.4 on x86_64-pc-linux-gnu,
> compiled by gcc (Ubuntu 5.4.0-6ubuntu1~16.04.2) 5.4.0 20160609, 64-bit'
> PG: PostGIS version string : '2.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1'
> GDAL: GDALOpen(PG: host=localhost dbname=xanadu2 user=stefan
> password=XXXXXXXXXX this=0x12db330) succeeds as PostgreSQL.
> PG: Primary key name (FID): t_id, type : int8
> PG: Using column 't_id' as FID for table
> 'nachfuehrngskrise_nachfuehrungskreis'
> Traceback (most recent call last):
>   File "./datenumbau.py", line 117, in <module>
>     dstLayer.CreateFeature(dstFeature)
>   File "/usr/local/gdal_master/lib/python2.7/site-packages/osgeo/ogr.py",
> line 1479, in CreateFeature
>     return _ogr.Layer_CreateFeature(self, *args)
> RuntimeError: OGR Error: General Error
> GDAL: GDALClose(PG: host=localhost dbname=xanadu2 user=stefan
> password=XXXXXXXXXX this=0x12db330)
> GDAL: GDALClose(PG: host=localhost dbname=xanadu2 user=stefan
> password=XXXXXXXXXX this=0x11e41b0)
> GDAL: In GDALDestroy - unloading GDAL shared library.
> GDAL: Force close of  (0x136abb0) in GDALDriverManager cleanup.
> Mem: 1 features read on layer 'sql_statement'.
> 
> I'm bit confused about the "general error". Does anyone has an idea?

What if you don't enable python exceptions from GDAL errors (ie don't call 
gdal.UseExceptions(), or use gdal.DontUseExceptions()). Do you get something more 
verbose ?

> 
> regards
> Stefan


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/5cef389a/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 28 07:33:31 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 28 Nov 2016 15:33:31 +0000
Subject: [gdal-dev] How does WMTS driver detect DataWindow?
Message-ID: <6ce94baf20264c37aa1a71fc7db1cd52@C119S212VM022.msvyvi.vaha.local>

Hi,

While playing with gdal_translate and WMST my colleague found that GDAL was picking a wrong DataWindow with


gdal_translate "WMTS:http://xx.yy.fi/foo/service?REQUEST=GetCapabilities&SERVICE=WMTS,layer=bar" bar.xml -of WMTS



After some thinking we started to believe that the reason may be in the wrong WGS84BoundingBox that this WMTS service puts into GetCapabilities

<ows:WGS84BoundingBox>

<ows:LowerCorner>-6.38153862706 55.6179644952</ows:LowerCorner>

<ows:UpperCorner>60.3815386271 75.5825702342</ows:UpperCorner>

</ows:WGS84BoundingBox>



I checked with gdaltransform that longitude -6.38153862706 converts into the value that was used as the DataWindow UpperLeftX value:

<UpperLeftX>-1553364.000000402</UpperLeftX>



However, the TopLeftCorner of the TileMatrix as it is defined in the GetCapabilities has a much smaller X value: -548576.000000



<TileMatrix>

<ows:Identifier>0</ows:Identifier>

<ScaleDenominator>29257142.85714285820722579956</ScaleDenominator>

<TopLeftCorner>-548576.000000 8388608.000000</TopLeftCorner>

<TileWidth>256</TileWidth>

<TileHeight>256</TileHeight>

<MatrixWidth>1</MatrixWidth>

<MatrixHeight>1</MatrixHeight>

</TileMatrix>



Probably because of the wrong UpperLeftX value was gdal_translate seems to think that the leftmost tile in this layer has a negative TileX value

<TileX>-3924</TileX>



By reading the WMTS standard the negative index values are not valid in WMTS:

TileCol: Column index of tile matrix

Non negative integer type value between 0 and MatrixWidth-1 of this tile matrix defined in the ServiceMetadata document



BoundingBoxes does not seem to be mandatory in WMTS because they can be computed from other, mandatory parameters as it is written in the notes of Table 14 - Parts of TileMatrix data structure



"NOTE 7 The bounding box of a tile matrix is not supplied explicitly because it can be calculated from topLeftCorner, tileWidth, tileHeight and scaleDenominator."



It feels that gdal_translate should never write a DataWindow that is bigger than the extents of the TileMatrix.   Perhaps BoundingBoxes, if they exist, could be used for limiting the maximum extent, like the TileMatrixSetLimits if they are found from the GetCapabilities. Or is there something special in WMTS that makes it much more comfortable for GDAL to trust in BoundingBoxes? Like the fact that different tile levels in WMTS may have different bounding boxes?



-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/c6abc0af/attachment.html>

From Rob.Langford at salford.gov.uk  Mon Nov 28 08:07:36 2016
From: Rob.Langford at salford.gov.uk (Langford, Robert)
Date: Mon, 28 Nov 2016 16:07:36 +0000
Subject: [gdal-dev] No XLSX fields in v2.1.2
Message-ID: <8160e502f1f946c2b56c3ba950f4df42@EX13-P-MBX10-W.salford.gov.uk>

All,

Just wondering if someone could sanity check this possible bug for me.  I'm trying to read data from a Excel spreadsheet.  It was scripted and working fine on GDAL 2.1.1 but is now failing on GDAL 2.1.2.

I've attached the spreadsheet, it is generated by our back office system (Microsoft SQL Server Reporting Services (SSRS)).  I've also noticed that if I open the spreadsheet up in Excel and resave GDAL can then read it again.

Any ideas?

Many thanks,

Rob


OLD VERSION
===========
> ogrinfo --version
>> GDAL 2.1.1, released 2016/07/07
*(also tested on GDAL 1.11.1, released 2014/09/24)

> ogrinfo -so -al -ro Interactive_mapping_pet_shop_licences.xlsx --config OGR_XLSX_HEADERS FORCE
>> INFO: Open of `Interactive_mapping_pet_shop_licences.xlsx'
>>       using driver `XLSX' successful.
>>
>> Layer name: Interactive mapping - Pet Shop
>> Geometry: None
>> Feature Count: 21
>> Layer SRS WKT:
>> (unknown)
>> Licence ref: String (0.0)
>> UPRN: String (0.0)
>> Easting: String (0.0)
>> Northing: String (0.0)
>> Premises Id: Integer (0.0)
>> Business Name: String (0.0)
>> Address: String (0.0)
>> Ward Description: String (0.0)
>> 1st licensed: String (0.0)
>> Licence expiry: String (0.0)


NEW VERSION
===========
> ogrinfo --version
>> GDAL 2.1.2, released 2016/10/24

> ogrinfo -so -al -ro Interactive_mapping_pet_shop_licences.xlsx --config OGR_XLSX_HEADERS FORCE
>> INFO: Open of `Interactive_mapping_pet_shop_licences.xlsx'
>>       using driver `XLSX' successful.
>> 
>> Layer name: Interactive mapping - Pet Shop
>> Geometry: None
>> Feature Count: 0
>> Layer SRS WKT:
>> (unknown)


DISCLAIMER: The information contained in this communication/message from Rob.Langford at salford.gov.uk sent on Mon Nov 28 16:07:38 2016 is confidential. It is intended solely for the addressee(s) gdal-dev at lists.osgeo.org

Access to this message by anyone else is unauthorised. If you are not the intended recipient, any disclosure, copying, or distribution of the message, or any action or omission taken by you in reliance on it, is prohibited and may be unlawful.
As a public body, Salford City Council may be required to disclose this email [or any response to it] under the Freedom of Information Act 2000, unless the information in it is covered by one of the exemptions in the Act. 
Please immediately contact the sender, Rob.Langford at salford.gov.uk if you have received this message in error. 

For the full disclaimer please access http://www.salford.gov.uk/e-mail.  Thank you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Interactive_mapping_pet_shop_licences.xlsx
Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
Size: 8855 bytes
Desc: Interactive_mapping_pet_shop_licences.xlsx
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/d2783ca5/attachment-0001.xlsx>

From stefan.ziegler.de at gmail.com  Mon Nov 28 09:19:40 2016
From: stefan.ziegler.de at gmail.com (Stefan Ziegler)
Date: Mon, 28 Nov 2016 18:19:40 +0100
Subject: [gdal-dev] ogr python: copying features from postgis to postgis
In-Reply-To: <1553919.pQYFyMlHxK@even-i700>
References: <CAJvo+1_vbArWBW1bvGG1_wWxgX1NGwqOKpQU5ym_5B906i8mUg@mail.gmail.com>
 <1553919.pQYFyMlHxK@even-i700>
Message-ID: <CAJvo+19frYgkT2nHQ_nAeTbnPCooen2C3rk-4oX_wh-3jXTcLg@mail.gmail.com>

Hi Even

thanks for the hint:

ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
ERROR 6: CreateFeature : unsupported operation on a read-only datasource.

I didn't know that default setting is read-only mode. Changing to
"ogr.Open(dstConnString, 1)" works like a charm.

regards
Stefan

On Mon, Nov 28, 2016 at 12:02 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On samedi 26 novembre 2016 21:18:50 CET Stefan Ziegler wrote:
>
> > Hi
>
> >
>
> > I'm trying to copy some features from one postgis table to another
> postgis
>
> > table:
>
> >
>
> > dstLayer.StartTransaction()
>
> >
>
> > srcFeature = srcLayer.GetNextFeature()
>
> > while srcFeature is not None:
>
> > srcLayerDefn = srcLayer.GetLayerDefn()
>
> >
>
> > dstLayerDefn = dstLayer.GetLayerDefn()
>
> > dstFeature = ogr.Feature(dstLayerDefn)
>
> > dstFeature.SetFID(-1)
>
> >
>
> > for i in range(0, dstLayerDefn.GetFieldCount()):
>
> > attrName = dstLayerDefn.GetFieldDefn(i).GetNameRef()
>
> >
>
> > # ATTRIBUTES
>
> > try:
>
> > attrVal = srcFeature.GetField(attrName)
>
> > dstFeature.SetField(attrName, attrVal)
>
> > except ValueError:
>
> > pass
>
> >
>
> > # GEOMETRY
>
> > geom = srcFeature.GetGeometryRef()
>
> > dstFeature.SetGeometry(geom)
>
> >
>
> > # ADD FEATURE
>
> > dstLayer.CreateFeature(dstFeature)
>
> >
>
> > srcFeature = srcLayer.GetNextFeature()
>
> >
>
> > dstLayer.CommitTransaction()
>
> >
>
> > It throws an error when trying to create the new feature:
>
> >
>
> > GNM: GNMRegisterAllInternal
>
> > GNM: RegisterGNMFile
>
> > GNM: RegisterGNMdatabase
>
> > PG: DBName="xanadu2"
>
> > PG: PostgreSQL version string : 'PostgreSQL 9.5.4 on x86_64-pc-linux-gnu,
>
> > compiled by gcc (Ubuntu 5.4.0-6ubuntu1~16.04.2) 5.4.0 20160609, 64-bit'
>
> > PG: PostGIS version string : '2.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1'
>
> > GDAL: GDALOpen(PG: host=localhost dbname=xanadu2 user=stefan
>
> > password=XXXXXXXXXX this=0x11e41b0) succeeds as PostgreSQL.
>
> > PG: Command Results Tuples = 11
>
> > GDAL: GDALDriver::Create(Memory,,0,0,0,Unknown,(nil))
>
> > PG: 11 features read on layer 'sql_statement'.
>
> > PG: DBName="xanadu2"
>
> > PG: PostgreSQL version string : 'PostgreSQL 9.5.4 on x86_64-pc-linux-gnu,
>
> > compiled by gcc (Ubuntu 5.4.0-6ubuntu1~16.04.2) 5.4.0 20160609, 64-bit'
>
> > PG: PostGIS version string : '2.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1'
>
> > GDAL: GDALOpen(PG: host=localhost dbname=xanadu2 user=stefan
>
> > password=XXXXXXXXXX this=0x12db330) succeeds as PostgreSQL.
>
> > PG: Primary key name (FID): t_id, type : int8
>
> > PG: Using column 't_id' as FID for table
>
> > 'nachfuehrngskrise_nachfuehrungskreis'
>
> > Traceback (most recent call last):
>
> > File "./datenumbau.py", line 117, in <module>
>
> > dstLayer.CreateFeature(dstFeature)
>
> > File "/usr/local/gdal_master/lib/python2.7/site-packages/osgeo/ogr.py",
>
> > line 1479, in CreateFeature
>
> > return _ogr.Layer_CreateFeature(self, *args)
>
> > RuntimeError: OGR Error: General Error
>
> > GDAL: GDALClose(PG: host=localhost dbname=xanadu2 user=stefan
>
> > password=XXXXXXXXXX this=0x12db330)
>
> > GDAL: GDALClose(PG: host=localhost dbname=xanadu2 user=stefan
>
> > password=XXXXXXXXXX this=0x11e41b0)
>
> > GDAL: In GDALDestroy - unloading GDAL shared library.
>
> > GDAL: Force close of (0x136abb0) in GDALDriverManager cleanup.
>
> > Mem: 1 features read on layer 'sql_statement'.
>
> >
>
> > I'm bit confused about the "general error". Does anyone has an idea?
>
>
>
> What if you don't enable python exceptions from GDAL errors (ie don't call
> gdal.UseExceptions(), or use gdal.DontUseExceptions()). Do you get
> something more verbose ?
>
>
>
> >
>
> > regards
>
> > Stefan
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/41509a41/attachment.html>

From even.rouault at spatialys.com  Mon Nov 28 14:07:11 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 28 Nov 2016 23:07:11 +0100
Subject: [gdal-dev] How does WMTS driver detect DataWindow?
In-Reply-To: <6ce94baf20264c37aa1a71fc7db1cd52@C119S212VM022.msvyvi.vaha.local>
References: <6ce94baf20264c37aa1a71fc7db1cd52@C119S212VM022.msvyvi.vaha.local>
Message-ID: <11323655.qitxOOIONx@even-i700>

On lundi 28 novembre 2016 15:33:31 CET Rahkonen Jukka (MML) wrote:
> Hi,
> 
> While playing with gdal_translate and WMST my colleague found that GDAL was
> picking a wrong DataWindow with
> 
> 
> gdal_translate
> "WMTS:http://xx.yy.fi/foo/service?REQUEST=GetCapabilities&SERVICE=WMTS,laye
> r=bar" bar.xml -of WMTS
> 
> 
> 
> After some thinking we started to believe that the reason may be in the
> wrong WGS84BoundingBox that this WMTS service puts into GetCapabilities
> 
> <ows:WGS84BoundingBox>
> 
> <ows:LowerCorner>-6.38153862706 55.6179644952</ows:LowerCorner>
> 
> <ows:UpperCorner>60.3815386271 75.5825702342</ows:UpperCorner>
> 
> </ows:WGS84BoundingBox>
> 
> 
> 
> I checked with gdaltransform that longitude -6.38153862706 converts into the
> value that was used as the DataWindow UpperLeftX value:
> 
> <UpperLeftX>-1553364.000000402</UpperLeftX>
> 
> 
> 
> However, the TopLeftCorner of the TileMatrix as it is defined in the
> GetCapabilities has a much smaller X value: -548576.000000
> 
> 
> 
> <TileMatrix>
> 
> <ows:Identifier>0</ows:Identifier>
> 
> <ScaleDenominator>29257142.85714285820722579956</ScaleDenominator>
> 
> <TopLeftCorner>-548576.000000 8388608.000000</TopLeftCorner>
> 
> <TileWidth>256</TileWidth>
> 
> <TileHeight>256</TileHeight>
> 
> <MatrixWidth>1</MatrixWidth>
> 
> <MatrixHeight>1</MatrixHeight>
> 
> </TileMatrix>
> 
> 
> 
> Probably because of the wrong UpperLeftX value was gdal_translate seems to
> think that the leftmost tile in this layer has a negative TileX value
> 
> <TileX>-3924</TileX>
> 
> 
> 
> By reading the WMTS standard the negative index values are not valid in
> WMTS:
> 
> TileCol: Column index of tile matrix
> 
> Non negative integer type value between 0 and MatrixWidth-1 of this tile
> matrix defined in the ServiceMetadata document
> 
> 
> 
> BoundingBoxes does not seem to be mandatory in WMTS because they can be
> computed from other, mandatory parameters as it is written in the notes of
> Table 14 - Parts of TileMatrix data structure
> 
> 
> 
> "NOTE 7 The bounding box of a tile matrix is not supplied explicitly because
> it can be calculated from topLeftCorner, tileWidth, tileHeight and
> scaleDenominator."
> 
> 
> 
> It feels that gdal_translate should never write a DataWindow that is bigger
> than the extents of the TileMatrix.   Perhaps BoundingBoxes, if they exist,
> could be used for limiting the maximum extent, like the TileMatrixSetLimits
> if they are found from the GetCapabilities. Or is there something special
> in WMTS that makes it much more comfortable for GDAL to trust in
> BoundingBoxes? Like the fact that different tile levels in WMTS may have
> different bounding boxes?

Hi Jukka,

I don't recall exactly the details but there are several strategies in place in the WMTS driver 
to determine the bounding box of interest based on what you quotes: WGS84BoundingBox, 
TileMatrix, TileMatrixSetLimits. The <WGS84BoundingBox> is likely used as you noticed as 
the most prioritary to indicate the real zone of interest in case of using global tiling schemes. 
But there's probably a lack of checks to validate in case it doesn't make no sense. I believe 
the driver should be able to deal without it. What you can try is to download the 
GetCapabilites response, edit it to remove the  WGS84BoundingBox bounding box and open 
this file with gdalinfo/gdal_translate.

But anyway the driver could be made more robust for those cases. Could be worth filing a 
ticket about that.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/db99e50a/attachment.html>

From even.rouault at spatialys.com  Mon Nov 28 14:21:04 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 28 Nov 2016 23:21:04 +0100
Subject: [gdal-dev] No XLSX fields in v2.1.2
In-Reply-To: <8160e502f1f946c2b56c3ba950f4df42@EX13-P-MBX10-W.salford.gov.uk>
References: <8160e502f1f946c2b56c3ba950f4df42@EX13-P-MBX10-W.salford.gov.uk>
Message-ID: <3126619.HB1nKSk2si@even-i700>

Hi,

There was indeed some changes in the XLSX driver for 2.1.2 to fix some issues. I guess what 
you observe is an unfortunate regression linked to those changes. Would you mind filing a 
ticket in https://trac.osgeo.org/gdal/newticket about that ? Thanks

Even

> All,
> 
> Just wondering if someone could sanity check this possible bug for me.  I'm
> trying to read data from a Excel spreadsheet.  It was scripted and working
> fine on GDAL 2.1.1 but is now failing on GDAL 2.1.2.
> 
> I've attached the spreadsheet, it is generated by our back office system
> (Microsoft SQL Server Reporting Services (SSRS)).  I've also noticed that
> if I open the spreadsheet up in Excel and resave GDAL can then read it
> again.
> 
> Any ideas?
> 
> Many thanks,
> 
> Rob
> 
> 
> OLD VERSION
> ===========
> 
> > ogrinfo --version
> > 
> >> GDAL 2.1.1, released 2016/07/07
> 
> *(also tested on GDAL 1.11.1, released 2014/09/24)
> 
> > ogrinfo -so -al -ro Interactive_mapping_pet_shop_licences.xlsx --config
> > OGR_XLSX_HEADERS FORCE> 
> >> INFO: Open of `Interactive_mapping_pet_shop_licences.xlsx'
> >> 
> >>       using driver `XLSX' successful.
> >> 
> >> Layer name: Interactive mapping - Pet Shop
> >> Geometry: None
> >> Feature Count: 21
> >> Layer SRS WKT:
> >> (unknown)
> >> Licence ref: String (0.0)
> >> UPRN: String (0.0)
> >> Easting: String (0.0)
> >> Northing: String (0.0)
> >> Premises Id: Integer (0.0)
> >> Business Name: String (0.0)
> >> Address: String (0.0)
> >> Ward Description: String (0.0)
> >> 1st licensed: String (0.0)
> >> Licence expiry: String (0.0)
> 
> NEW VERSION
> ===========
> 
> > ogrinfo --version
> > 
> >> GDAL 2.1.2, released 2016/10/24
> > 
> > ogrinfo -so -al -ro Interactive_mapping_pet_shop_licences.xlsx --config
> > OGR_XLSX_HEADERS FORCE> 
> >> INFO: Open of `Interactive_mapping_pet_shop_licences.xlsx'
> >> 
> >>       using driver `XLSX' successful.
> >> 
> >> Layer name: Interactive mapping - Pet Shop
> >> Geometry: None
> >> Feature Count: 0
> >> Layer SRS WKT:
> >> (unknown)
> 
> DISCLAIMER: The information contained in this communication/message from
> Rob.Langford at salford.gov.uk sent on Mon Nov 28 16:07:38 2016 is
> confidential. It is intended solely for the addressee(s)
> gdal-dev at lists.osgeo.org
> 
> Access to this message by anyone else is unauthorised. If you are not the
> intended recipient, any disclosure, copying, or distribution of the
> message, or any action or omission taken by you in reliance on it, is
> prohibited and may be unlawful. As a public body, Salford City Council may
> be required to disclose this email [or any response to it] under the
> Freedom of Information Act 2000, unless the information in it is covered by
> one of the exemptions in the Act. Please immediately contact the sender,
> Rob.Langford at salford.gov.uk if you have received this message in error.
> 
> For the full disclaimer please access http://www.salford.gov.uk/e-mail. 
> Thank you.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/2e7e6955/attachment-0001.html>

From even.rouault at spatialys.com  Mon Nov 28 14:21:46 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 28 Nov 2016 23:21:46 +0100
Subject: [gdal-dev] ogr python: copying features from postgis to postgis
In-Reply-To: <CAJvo+19frYgkT2nHQ_nAeTbnPCooen2C3rk-4oX_wh-3jXTcLg@mail.gmail.com>
References: <CAJvo+1_vbArWBW1bvGG1_wWxgX1NGwqOKpQU5ym_5B906i8mUg@mail.gmail.com>
 <1553919.pQYFyMlHxK@even-i700>
 <CAJvo+19frYgkT2nHQ_nAeTbnPCooen2C3rk-4oX_wh-3jXTcLg@mail.gmail.com>
Message-ID: <1781276.XqpYIYiTrZ@even-i700>

On lundi 28 novembre 2016 18:19:40 CET Stefan Ziegler wrote:
> Hi Even
> 
> thanks for the hint:
> 
> ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
> ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
> ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
> ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
> ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
> ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
> 
> I didn't know that default setting is read-only mode. Changing to
> "ogr.Open(dstConnString, 1)" works like a charm.

OK, I've reproduced a similar issue. The error/exception handling in that case was suboptimal 
and should have reported the original error message in the exception text. I've now fixed 
that in GDAL trunk and you'll get :

Traceback (most recent call last):
  File "test.py", line 6, in <module>
    lyr.CreateFeature(f)
  File "/home/even/gdal/trunk/gdal/swig/python/build/lib.linux-x86_64-2.7/osgeo/ogr.py", 
line 1479, in CreateFeature
    return _ogr.Layer_CreateFeature(self, *args)
RuntimeError: CreateFeature : unsupported operation on a read-only datasource.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161128/352d91e3/attachment.html>

From Rob.Langford at salford.gov.uk  Tue Nov 29 03:45:04 2016
From: Rob.Langford at salford.gov.uk (Langford, Robert)
Date: Tue, 29 Nov 2016 11:45:04 +0000
Subject: [gdal-dev] No XLSX fields in v2.1.2
In-Reply-To: <3126619.HB1nKSk2si@even-i700>
References: <8160e502f1f946c2b56c3ba950f4df42@EX13-P-MBX10-W.salford.gov.uk>
 <3126619.HB1nKSk2si@even-i700>
Message-ID: <62c8e5eb119f4f13a3d172e2db4e2342@EX13-P-MBX10-W.salford.gov.uk>

Thanks for letting me know Even.

I've raised a ticket here: https://trac.osgeo.org/gdal/ticket/6733

First ticket I've done so wasn't sure about some of the fields, have left as defaults.

If anything further is required please let me know.

Rob

DISCLAIMER: The information contained in this communication/message from Rob.Langford at salford.gov.uk sent on Tue Nov 29 11:45:05 2016 is confidential. It is intended solely for the addressee(s) gdal-dev at lists.osgeo.org;even.rouault at spatialys.com

Access to this message by anyone else is unauthorised. If you are not the intended recipient, any disclosure, copying, or distribution of the message, or any action or omission taken by you in reliance on it, is prohibited and may be unlawful.
As a public body, Salford City Council may be required to disclose this email [or any response to it] under the Freedom of Information Act 2000, unless the information in it is covered by one of the exemptions in the Act. 
Please immediately contact the sender, Rob.Langford at salford.gov.uk if you have received this message in error. 

For the full disclaimer please access http://www.salford.gov.uk/e-mail.  Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161129/d7a4bc2f/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov 29 03:49:36 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 29 Nov 2016 11:49:36 +0000
Subject: [gdal-dev] How does WMTS driver detect DataWindow?
Message-ID: <808e5405157b4b49b807d7bae40042a1@C119S212VM022.msvyvi.vaha.local>

With a little help GDAL picks up correct extent. Removing the erroneous WGS84BoundingBox hint from GetCapabilities made it.

I consider that there is a bug in the WMTS server which is advertising invalid bounding box but I don't really know GDAL should do.
I am not good at reading the code from https://trac.osgeo.org/gdal/browser/trunk/gdal/frmts/wmts/wmtsdataset.cpp but I do see that there are comments about making a clip with the implied bounding box of the most precise tile matrix, taking into account the TileMatrix limits if they appear in GetCapabilities

The logic seems to be now


1)      Use the BoundingBox of the layer expressed in the SRS of the tile matrix set if that exists (row 1394)

2)      Otherwise use the BoundingBox of the layer expressed in some other SRS (for example WGS84) if that exists (row 1506)

3)      Otherwise use the BoundingBox of the tile matrix set if that exists (row 1550)

4)      Otherwise compute the bounding box from the definition of the most precise tile matrix (1558)

The comments about clipping are on rows 1572 and 1587.

So if the meaning was to take the advertised bounding box and clip it with the box that is computed from the tile matrix set and its limits, it seems to fail with our data

In our case the layer has this faulty
<ows:WGS84BoundingBox>
<ows:LowerCorner>-6.38153862706 55.6179644952</ows:LowerCorner>
<ows:UpperCorner>60.3815386271 75.5825702342</ows:UpperCorner>
</ows:WGS84BoundingBox>

and our most precise TM is
<TileMatrix>
<ows:Identifier>13</ows:Identifier>
<ScaleDenominator>3571.42857143</ScaleDenominator>
<TopLeftCorner>-548576.0 8388608.0</TopLeftCorner>
<TileWidth>256</TileWidth>
<TileHeight>256</TileHeight>
<MatrixWidth>8192</MatrixWidth>
<MatrixHeight>8192</MatrixHeight>
</TileMatrix>

With WGS84BoundingBox GDAL finds
<DataWindow>
    <UpperLeftX>-1553364.000000402</UpperLeftX>
    <UpperLeftY>8388608</UpperLeftY>
    <LowerRightX>2553364.000001241</LowerRightX>
    <LowerRightY>6681097.999999317</LowerRightY>
  </DataWindow>

and without WGS84BoundingBox the correct
<DataWindow>
    <UpperLeftX>-548576</UpperLeftX>
    <UpperLeftY>8388608</UpperLeftY>
    <LowerRightX>1548576</LowerRightX>
    <LowerRightY>6291456</LowerRightY>
  </DataWindow>

-Jukka Rahkonen-


Lähettäjä: Even Rouault [mailto:even.rouault at spatialys.com]
Lähetetty: 29. marraskuuta 2016 0:07
Vastaanottaja: gdal-dev at lists.osgeo.org
Kopio: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [gdal-dev] How does WMTS driver detect DataWindow?


On lundi 28 novembre 2016 15:33:31 CET Rahkonen Jukka (MML) wrote:

> Hi,

>

> While playing with gdal_translate and WMST my colleague found that GDAL was

> picking a wrong DataWindow with

>

>

> gdal_translate

> "WMTS:http://xx.yy.fi/foo/service?REQUEST=GetCapabilities&SERVICE=WMTS,laye

> r=bar" bar.xml -of WMTS

>

>

>

> After some thinking we started to believe that the reason may be in the

> wrong WGS84BoundingBox that this WMTS service puts into GetCapabilities

>

> <ows:WGS84BoundingBox>

>

> <ows:LowerCorner>-6.38153862706 55.6179644952</ows:LowerCorner>

>

> <ows:UpperCorner>60.3815386271 75.5825702342</ows:UpperCorner>

>

> </ows:WGS84BoundingBox>

>

>

>

> I checked with gdaltransform that longitude -6.38153862706 converts into the

> value that was used as the DataWindow UpperLeftX value:

>

> <UpperLeftX>-1553364.000000402</UpperLeftX>

>

>

>

> However, the TopLeftCorner of the TileMatrix as it is defined in the

> GetCapabilities has a much smaller X value: -548576.000000

>

>

>

> <TileMatrix>

>

> <ows:Identifier>0</ows:Identifier>

>

> <ScaleDenominator>29257142.85714285820722579956</ScaleDenominator>

>

> <TopLeftCorner>-548576.000000 8388608.000000</TopLeftCorner>

>

> <TileWidth>256</TileWidth>

>

> <TileHeight>256</TileHeight>

>

> <MatrixWidth>1</MatrixWidth>

>

> <MatrixHeight>1</MatrixHeight>

>

> </TileMatrix>

>

>

>

> Probably because of the wrong UpperLeftX value was gdal_translate seems to

> think that the leftmost tile in this layer has a negative TileX value

>

> <TileX>-3924</TileX>

>

>

>

> By reading the WMTS standard the negative index values are not valid in

> WMTS:

>

> TileCol: Column index of tile matrix

>

> Non negative integer type value between 0 and MatrixWidth-1 of this tile

> matrix defined in the ServiceMetadata document

>

>

>

> BoundingBoxes does not seem to be mandatory in WMTS because they can be

> computed from other, mandatory parameters as it is written in the notes of

> Table 14 - Parts of TileMatrix data structure

>

>

>

> "NOTE 7 The bounding box of a tile matrix is not supplied explicitly because

> it can be calculated from topLeftCorner, tileWidth, tileHeight and

> scaleDenominator."

>

>

>

> It feels that gdal_translate should never write a DataWindow that is bigger

> than the extents of the TileMatrix. Perhaps BoundingBoxes, if they exist,

> could be used for limiting the maximum extent, like the TileMatrixSetLimits

> if they are found from the GetCapabilities. Or is there something special

> in WMTS that makes it much more comfortable for GDAL to trust in

> BoundingBoxes? Like the fact that different tile levels in WMTS may have

> different bounding boxes?



Hi Jukka,



I don't recall exactly the details but there are several strategies in place in the WMTS driver to determine the bounding box of interest based on what you quotes: WGS84BoundingBox, TileMatrix, TileMatrixSetLimits. The <WGS84BoundingBox> is likely used as you noticed as the most prioritary to indicate the real zone of interest in case of using global tiling schemes. But there's probably a lack of checks to validate in case it doesn't make no sense. I believe the driver should be able to deal without it. What you can try is to download the GetCapabilites response, edit it to remove the WGS84BoundingBox bounding box and open this file with gdalinfo/gdal_translate.



But anyway the driver could be made more robust for those cases. Could be worth filing a ticket about that.



Even





--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161129/41eab330/attachment-0001.html>

From Odd-Ragnar.Lydersen at powel.no  Tue Nov 29 04:06:17 2016
From: Odd-Ragnar.Lydersen at powel.no (Odd Ragnar Lydersen)
Date: Tue, 29 Nov 2016 12:06:17 +0000
Subject: [gdal-dev] WFS: GetGeomFieldDefn(i)->GetNameRef() returns empty
 stirng (C++ API)
Message-ID: <BD69AB4022C5C34DAC908920605A87025A619910@MAIL.powelasa.powel.com>

I want to use GDALDataset::ExecuteSQL() to get a layer containing feature attributes selected by the user, and the geometry of the feature.

When I did this in GDAL 1.11.x, I automatically got the geometry, but now I don't.

If I get the OGRFeatureDefn for the layer, and then get the OGRGeomFieldDefn, then I get the correct geometry type, but no name. It's empty.

So then I try to call the WFS in question by putting "request=DescribeFeatureType" in the URL which I pass to GDAL
OGRInfo lists all the different layers, and what kind of geometry it contains, but where doesn't show the attributes.
Shouldn't these be saved in the config file I'm using?

>From the documentation of the wfs driver:
"At the first opening, the content of the result of the GetCapabilities request will be appended to the file, so that it can be cached for later openings of the dataset. The same applies for the DescribeFeatureType request issued to discover the field definition of each layer."

Am I missing something here, or is this a bug?

Is there another way to select a subset of feature attributes, and the feature geometry?

Odd-Ragnar Lydersen
System Developer

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161129/94ef6458/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov 29 04:53:18 2016
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 29 Nov 2016 05:53:18 -0700 (MST)
Subject: [gdal-dev] WFS: GetGeomFieldDefn(i)->GetNameRef() returns empty
 stirng (C++ API)
In-Reply-To: <BD69AB4022C5C34DAC908920605A87025A619910@MAIL.powelasa.powel.com>
References: <BD69AB4022C5C34DAC908920605A87025A619910@MAIL.powelasa.powel.com>
Message-ID: <1480423998992-5297847.post@n6.nabble.com>

With GDAL 2.2.0dev and ogrinfo  this works:





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-WFS-GetGeomFieldDefn-i-GetNameRef-returns-empty-stirng-C-API-tp5297844p5297847.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From chippy2005 at gmail.com  Tue Nov 29 08:02:23 2016
From: chippy2005 at gmail.com (Tim Waters)
Date: Tue, 29 Nov 2016 16:02:23 +0000
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
	georeferenced raster
Message-ID: <CAOKL=GxAxYaj5zfgA_XOmDiRCLL5R9A2mE1F+VOS59e1JKem9w@mail.gmail.com>

Hello,

I'm seeing an error running GDAL 1.11.3 on Ubuntu 16.04LTS and 2.10.
There was no error and it worked fine with GDAL 1.10.1 on Ubuntu
14.04LTS.

I see the error running gdal_rasterize utility and also in python.

gdal_rasterize -i  -burn 17 -b 1 -b 2 -b 3 clipping.gml -l features masked.tif

Python script for reference
https://gist.github.com/timwaters/a8da4e3e209aaae955d23446c3925125

ERROR 1: Unable to compute a transformation between pixel/line
and georeferenced coordinates for masked.tif
There is no affine transformation and no GCPs.
Segmentation fault (core dumped)

I have tried to assign the non georeferenced raster an SRS LOCAL_CS["arbitrary"]
gdal_translate -a_srs 'LOCAL_CS["arbitrary"]' masked.tif
masked_ref.tif but got the same error when rasterizing.

The use case is for mapwarper.net where people can upload images and
create clipping masks around the rectangular images (to remove borders
etc) before adding control points and geo referencing them. Ideally,
I'd like to be able to keep the clipping on the unwarped images as
it's easier for users e.g often just drawing a rectangle than doing it
on the warped ones with many vertices and having to re-do each time
the georeferencing is changed.

Is this a new bug? The changelog didn't show anything new or changed
for gdal_rasterize from what I could see but perhaps I'm missing
something obvious. Is there a workaround? Perhaps there's an
Imagemagick command that would do it?

Many thanks,

Tim

From even.rouault at spatialys.com  Tue Nov 29 14:36:42 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 29 Nov 2016 23:36:42 +0100
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
	georeferenced raster
In-Reply-To: <CAOKL=GxAxYaj5zfgA_XOmDiRCLL5R9A2mE1F+VOS59e1JKem9w@mail.gmail.com>
References: <CAOKL=GxAxYaj5zfgA_XOmDiRCLL5R9A2mE1F+VOS59e1JKem9w@mail.gmail.com>
Message-ID: <1640612.9xRjB0YkFa@even-i700>

On mardi 29 novembre 2016 16:02:23 CET Tim Waters wrote:
> Hello,
> 
> I'm seeing an error running GDAL 1.11.3 on Ubuntu 16.04LTS and 2.10.
> There was no error and it worked fine with GDAL 1.10.1 on Ubuntu
> 14.04LTS.
> 
> I see the error running gdal_rasterize utility and also in python.
> 
> gdal_rasterize -i  -burn 17 -b 1 -b 2 -b 3 clipping.gml -l features
> masked.tif
> 
> Python script for reference
> https://gist.github.com/timwaters/a8da4e3e209aaae955d23446c3925125

Tim,

Could you provide the dataset to reproduce as well ? And it seems your Python script is not 
valid since the 'sr' variable passed in rast_ogr_ds.CreateLayer( 'poly', srs=sr ) is not defined.

Eve

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161129/4e7e5c1f/attachment.html>

From mj10777 at googlemail.com  Tue Nov 29 21:44:11 2016
From: mj10777 at googlemail.com (Mark Johnson)
Date: Wed, 30 Nov 2016 06:44:11 +0100
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
	georeferenced raster
Message-ID: <CAEEbjBhSp6V5qkSv9tJEUgnTpJNqKiNPDm8nFA-ECCoBA_bQHw@mail.gmail.com>

This may be a similar problem to what was mentioned here:

#6721: Simplifing use of gdalwarp with cutline with non-georeferenced
rasters

https://trac.osgeo.org/gdal/ticket/6721
(which has not been reacted to)

There the gal was to use gdalwarp, together with a cutline, to cut out a
portion of the non georeferenced raster (sample: image with folds which
need to be removed).

Here the idea was to emulate any meter base system (such as 3395 WGS 84 /
World Mercator), creating a world file that always looks like this:

 1.00000000000000
 0.00000000000000
 0.00000000000000
 -1.00000000000000
 0.00000000000000
 0.00000000000000

Sample: small non georeferenced raster map from Wiki (1200x864):
wget
https://upload.wikimedia.org/wikipedia/commons/a/a0/Karte_berlin_akzisemauer.png
-O 18550101.Karte_berlin_akzisemauer.wiki.png
echo -e "1.00000000000000\n 0.00000000000000\n 0.00000000000000\n
-1.00000000000000\n 0.00000000000000\n 0.00000000000000" >
18550101.Karte_berlin_akzisemauer.wiki.pgw
gdal_translate -a_srs epsg:3395 18550101.Karte_berlin_akzisemauer.wiki.png
18550101.Karte_berlin_akzisemauer.wiki.ref_3395.tif
gdalinfo 18550101.Karte_berlin_akzisemauer.wiki.ref_3395.tif

Using '-te' create a cutline around the boundry shown on the map
- remembering the 'y/height' is always minus (i.e top=0, bottom=height*-1)
--> top=-50 ; bottom=-690

gdalwarp -s_srs epsg:3395 -t_srs epsg:3395 -te  220 -690 1160 -50
18550101.Karte_berlin_akzisemauer.wiki.ref_3395.tif
18550101.Karte_berlin_akzisemauer.cut.ref_3395.tif

Without a world file you get with:
gdalwarp -s_srs epsg:3395 -t_srs epsg:3395 -te  220 -690 1160 -50
18550101.Karte_berlin_akzisemauer.wiki.png
18550101.Karte_berlin_akzisemauer.cut.ref_png.tif

ERROR 1: The transformation is already "north up" or
a transformation between pixel/line and georeferenced
coordinates cannot be computed for
18550101.Karte_berlin_akzisemauer.wiki.png.
There is no affine transformation and no GCPs.
Specify transformation option SRC_METHOD=NO_GEOTRANSFORM to bypass this
check.

(which is what you got)
What the meaning of is: SRC_METHOD=NO_GEOTRANSFORM
- no idea

But with a world file the expected result comes out.

Mark Johnson Berlin Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/b635bc89/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov 30 00:56:13 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 30 Nov 2016 08:56:13 +0000
Subject: [gdal-dev] How does WMTS driver detect DataWindow?
In-Reply-To: <808e5405157b4b49b807d7bae40042a1@C119S212VM022.msvyvi.vaha.local>
References: <808e5405157b4b49b807d7bae40042a1@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1480496177120.2816@maanmittauslaitos.fi>

Hi,


I got to understand why WMTS service has so large WGS84 bounding box in GetCapabilities.  It is because the native EPSG:3067 bounding box is first converted into WGS84 by using a densified polygon geometry. The WGS84BoundingBox is then the envelope of this warped polygon. Because of warping the rectangle gets wider towards the poles. This is logical and the result does not look so bad in this image

https://gist.github.com/anonymous/2445ea91a8ac7b15bf39

However, if the bounding box goes closer to -90°S or 90°N the distortion gets bigger.  In our case the maximum latitude is at 83°N and the result it quite funny

http://latuviitta.org/downloads/WGS84BoundingBox.png


-Jukka Rahkonen-


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/9e52333c/attachment.html>

From even.rouault at spatialys.com  Wed Nov 30 03:17:06 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 30 Nov 2016 12:17:06 +0100
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
	georeferenced raster
In-Reply-To: <CAEEbjBhSp6V5qkSv9tJEUgnTpJNqKiNPDm8nFA-ECCoBA_bQHw@mail.gmail.com>
References: <CAEEbjBhSp6V5qkSv9tJEUgnTpJNqKiNPDm8nFA-ECCoBA_bQHw@mail.gmail.com>
Message-ID: <9152651.1HVLtnbT3g@even-i700>

On mercredi 30 novembre 2016 06:44:11 CET Mark Johnson wrote:
> This may be a similar problem to what was mentioned here:
> 
> #6721: Simplifing use of gdalwarp with cutline with non-georeferenced
> rasters
> 
> https://trac.osgeo.org/gdal/ticket/6721
> (which has not been reacted to)
> 
> There the gal was to use gdalwarp, together with a cutline, to cut out a
> portion of the non georeferenced raster (sample: image with folds which
> need to be removed).
> 
> Here the idea was to emulate any meter base system (such as 3395 WGS 84 /
> World Mercator), creating a world file that always looks like this:
> 
>  1.00000000000000
>  0.00000000000000
>  0.00000000000000
>  -1.00000000000000
>  0.00000000000000
>  0.00000000000000
> 
> Sample: small non georeferenced raster map from Wiki (1200x864):
> wget
> https://upload.wikimedia.org/wikipedia/commons/a/a0/Karte_berlin_akzisemauer
> .png -O 18550101.Karte_berlin_akzisemauer.wiki.png
> echo -e "1.00000000000000\n 0.00000000000000\n 0.00000000000000\n
> -1.00000000000000\n 0.00000000000000\n 0.00000000000000" >
> 18550101.Karte_berlin_akzisemauer.wiki.pgw
> gdal_translate -a_srs epsg:3395 18550101.Karte_berlin_akzisemauer.wiki.png
> 18550101.Karte_berlin_akzisemauer.wiki.ref_3395.tif
> gdalinfo 18550101.Karte_berlin_akzisemauer.wiki.ref_3395.tif
> 
> Using '-te' create a cutline around the boundry shown on the map
> - remembering the 'y/height' is always minus (i.e top=0, bottom=height*-1)
> --> top=-50 ; bottom=-690
> 
> gdalwarp -s_srs epsg:3395 -t_srs epsg:3395 -te  220 -690 1160 -50
> 18550101.Karte_berlin_akzisemauer.wiki.ref_3395.tif
> 18550101.Karte_berlin_akzisemauer.cut.ref_3395.tif
> 
> Without a world file you get with:
> gdalwarp -s_srs epsg:3395 -t_srs epsg:3395 -te  220 -690 1160 -50
> 18550101.Karte_berlin_akzisemauer.wiki.png
> 18550101.Karte_berlin_akzisemauer.cut.ref_png.tif
> 
> ERROR 1: The transformation is already "north up" or
> a transformation between pixel/line and georeferenced
> coordinates cannot be computed for
> 18550101.Karte_berlin_akzisemauer.wiki.png.
> There is no affine transformation and no GCPs.
> Specify transformation option SRC_METHOD=NO_GEOTRANSFORM to bypass this
> check.
> 
> (which is what you got)
> What the meaning of is: SRC_METHOD=NO_GEOTRANSFORM
> - no idea

This error is emitted when the source dataset has no geotransform (and no GCP and no RCP 
and no geolocation array), or has a geotransform which is the identity matrix. Both cases are 
usually non-nominal cases of gdalwarp. If you really want to proceed with the identity 
geotransform, then you have to specify -to SRC_METHOD=NO_GEOTRANSFORM to 
gdalwarp.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/27eeab08/attachment-0001.html>

From kassies at gmail.com  Wed Nov 30 04:44:54 2016
From: kassies at gmail.com (Rutger)
Date: Wed, 30 Nov 2016 05:44:54 -0700 (MST)
Subject: [gdal-dev] Converting multilayer KML to single layer output
Message-ID: <1480509894962-5298014.post@n6.nabble.com>

Hey,

I am trying to convert a kml-file containing multiple layers to a new output
(GeoJSON for example), which only supports a single layer. All geometry
types in the kml are identical, all polygon.

The only way i can make it work (by using gdal.VectorTranslate) is to first
write a single layer to a file in 'overwrite' mode. And then run almost the
identical command for the remaining layers in 'append' mode. Writing all
layers in append mode sort of works, it creates the file and writes all
layers, but it doesn't close the file properly. In the case of GeoJSON, it
doesnt write ']}' at the end of the file. 

What i currently do is:
/
res = gdal.VectorTranslate(outfile, infile, format='GeoJSON',
accessMode='overwrite', layers=layers[0], layerName='outlayer')
res = None

res = gdal.VectorTranslate(outfile, infile, format='GeoJSON',
accessMode='append', layers=layers[1:], layerName='outlayer')
res = None/

Where 'layers' is a Python list populated by iterating over the layers and
calling 'lyr.GetName()'.

I dont like needing two commands to do this, and also iterating over all
layers manually, just to get the names, seems a bit redundant. So i'm
wondering if anyone knows ways to improve upon this.

Regards,
Rutger





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Converting-multilayer-KML-to-single-layer-output-tp5298014.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From chippy2005 at gmail.com  Wed Nov 30 05:03:09 2016
From: chippy2005 at gmail.com (Tim Waters)
Date: Wed, 30 Nov 2016 13:03:09 +0000
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
 georeferenced raster
In-Reply-To: <1640612.9xRjB0YkFa@even-i700>
References: <CAOKL=GxAxYaj5zfgA_XOmDiRCLL5R9A2mE1F+VOS59e1JKem9w@mail.gmail.com>
 <1640612.9xRjB0YkFa@even-i700>
Message-ID: <CAOKL=GyNNd+70h9gy1CGHdVQA_GTMZh2Ya1wor4U5h=fFVfSPw@mail.gmail.com>

On 29 November 2016 at 22:36, Even Rouault <even.rouault at spatialys.com> wrote:
> Tim,
>
> Could you provide the dataset to reproduce as well ? And it seems your
> Python script is not valid since the 'sr' variable passed in
> rast_ogr_ds.CreateLayer( 'poly', srs=sr ) is not defined.

Hello,

Apologies for the script not working! I sanitized paths etc and broke
it, doh - I hope this email helps.

I've put all the correct files in a new GitHub repository:
https://github.com/timwaters/gdal_rasterize_error
including an expected screenshot of the inverted burn which was
generated from my box running 1.10.1

(Note that it appears that in 1.10.1 the raster does successfully get
burnt, no error or segfault is shown, but the script will output
"fail")

I've looked at whether -to SRC_METHOD=NO_GEOTRANSFORM is available for
the gdal_rasterize utility but I don't think it is?

Best regards and thanks in advance,

Tim

From schwehr at gmail.com  Wed Nov 30 06:51:52 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 30 Nov 2016 06:51:52 -0800
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
 georeferenced raster
In-Reply-To: <CAOKL=GyNNd+70h9gy1CGHdVQA_GTMZh2Ya1wor4U5h=fFVfSPw@mail.gmail.com>
References: <CAOKL=GxAxYaj5zfgA_XOmDiRCLL5R9A2mE1F+VOS59e1JKem9w@mail.gmail.com>
 <1640612.9xRjB0YkFa@even-i700>
 <CAOKL=GyNNd+70h9gy1CGHdVQA_GTMZh2Ya1wor4U5h=fFVfSPw@mail.gmail.com>
Message-ID: <CACmBxyu2nEdkfQeCcJzsBzKQg-yQn-m-v-SCAFD7ZbPmTVp60A@mail.gmail.com>

Bugger.  That segfault should be turned into a clean failure.  I looked a
bunch and wasn't sure how to safely do that.

This didn't do the job...  the segfault happens somewhere after this.

svn diff gdalrasterize.cpp
Index: gdalrasterize.cpp
===================================================================
--- gdalrasterize.cpp (revision 36569)
+++ gdalrasterize.cpp (working copy)
@@ -635,6 +635,10 @@
         pfnTransformer = GDALGenImgProjTransform;
     }

+    if( pfnTransformer == NULL )
+    {
+        return CE_Failure;
+    }
 /* -------------------------------------------------------------------- */
 /*      Establish a chunksize to operate on.  The larger the chunk      */
 /*      size the less times we need to make a pass through all the      */


On Wed, Nov 30, 2016 at 5:03 AM, Tim Waters <chippy2005 at gmail.com> wrote:

> On 29 November 2016 at 22:36, Even Rouault <even.rouault at spatialys.com>
> wrote:
> > Tim,
> >
> > Could you provide the dataset to reproduce as well ? And it seems your
> > Python script is not valid since the 'sr' variable passed in
> > rast_ogr_ds.CreateLayer( 'poly', srs=sr ) is not defined.
>
> Hello,
>
> Apologies for the script not working! I sanitized paths etc and broke
> it, doh - I hope this email helps.
>
> I've put all the correct files in a new GitHub repository:
> https://github.com/timwaters/gdal_rasterize_error
> including an expected screenshot of the inverted burn which was
> generated from my box running 1.10.1
>
> (Note that it appears that in 1.10.1 the raster does successfully get
> burnt, no error or segfault is shown, but the script will output
> "fail")
>
> I've looked at whether -to SRC_METHOD=NO_GEOTRANSFORM is available for
> the gdal_rasterize utility but I don't think it is?
>
> Best regards and thanks in advance,
>
> Tim
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/038421f4/attachment.html>

From a.neumann at carto.net  Wed Nov 30 07:21:42 2016
From: a.neumann at carto.net (Neumann, Andreas)
Date: Wed, 30 Nov 2016 16:21:42 +0100
Subject: [gdal-dev] ogr2ogr - exclude table option?
Message-ID: <445417e7aa883900373c33d66683a933@carto.net>

Hi, 

I want to convert a whole Postgis schema to a geopackage. This works
fine with  

ogr2ogr -f GPKG av_1700.gpkg PG:'dbname=dbname host=localhost
schemas=schemaname' 

Now - my problem is that the schema contains 64 tables and I want to
convert all tables except one table. 

Is there a trick with an exclude option? I know that I can list all
tables that I want to convert in the sense of a white list with
'tables=tab1,tab2,tab3', etc. - but this is complicated for this many
tables. 

I hope that there is / could be some black list option - or the
possibility of specifying a pattern for selection the tables to be
converted. 

Thank you for your reply, 

Andreas

  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/52c1f48f/attachment.html>

From ari.jolma at gmail.com  Wed Nov 30 08:43:24 2016
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 30 Nov 2016 18:43:24 +0200
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
 georeferenced raster
In-Reply-To: <CACmBxyu2nEdkfQeCcJzsBzKQg-yQn-m-v-SCAFD7ZbPmTVp60A@mail.gmail.com>
References: <CAOKL=GxAxYaj5zfgA_XOmDiRCLL5R9A2mE1F+VOS59e1JKem9w@mail.gmail.com>
 <1640612.9xRjB0YkFa@even-i700>
 <CAOKL=GyNNd+70h9gy1CGHdVQA_GTMZh2Ya1wor4U5h=fFVfSPw@mail.gmail.com>
 <CACmBxyu2nEdkfQeCcJzsBzKQg-yQn-m-v-SCAFD7ZbPmTVp60A@mail.gmail.com>
Message-ID: <4c47ff25-47ba-f52d-4c0c-4c0deb33f3c7@gmail.com>

At gdalrasterize.cpp:349 there is a call to Transformer but the 
TransformArg is NULL, which leads to segfault. Above the call there is a 
comment:

// TODO: We need to add all appropriate error checking at some point.

Obviously not all error checking is not done.

I also noticed that in Perl code there is some additional ease of use 
added to the user - she can give to the Rasterize method simply a file 
name, which implicitly assumes that the user has given options that 
cause the file to be created, and if not the result is a segfault. The 
same happens in gdal_rasterize:

gdal_rasterize -burn 17 -l features 20.gml test.tiff

results in segfault

Ari

30.11.2016, 16:51, Kurt Schwehr kirjoitti:
> Bugger.  That segfault should be turned into a clean failure.  I 
> looked a bunch and wasn't sure how to safely do that.
>
> This didn't do the job...  the segfault happens somewhere after this.
>
> svn diff gdalrasterize.cpp
> Index: gdalrasterize.cpp
> ===================================================================
> --- gdalrasterize.cpp(revision 36569)
> +++ gdalrasterize.cpp(working copy)
> @@ -635,6 +635,10 @@
>          pfnTransformer = GDALGenImgProjTransform;
>      }
> +    if( pfnTransformer == NULL )
> +    {
> +        return CE_Failure;
> +    }
>  /* 
> -------------------------------------------------------------------- */
>  /*      Establish a chunksize to operate on.  The larger the chunk   
>    */
>  /*      size the less times we need to make a pass through all the   
>    */
>
>
> On Wed, Nov 30, 2016 at 5:03 AM, Tim Waters <chippy2005 at gmail.com 
> <mailto:chippy2005 at gmail.com>> wrote:
>
>     On 29 November 2016 at 22:36, Even Rouault
>     <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>>
>     wrote:
>     > Tim,
>     >
>     > Could you provide the dataset to reproduce as well ? And it
>     seems your
>     > Python script is not valid since the 'sr' variable passed in
>     > rast_ogr_ds.CreateLayer( 'poly', srs=sr ) is not defined.
>
>     Hello,
>
>     Apologies for the script not working! I sanitized paths etc and broke
>     it, doh - I hope this email helps.
>
>     I've put all the correct files in a new GitHub repository:
>     https://github.com/timwaters/gdal_rasterize_error
>     <https://github.com/timwaters/gdal_rasterize_error>
>     including an expected screenshot of the inverted burn which was
>     generated from my box running 1.10.1
>
>     (Note that it appears that in 1.10.1 the raster does successfully get
>     burnt, no error or segfault is shown, but the script will output
>     "fail")
>
>     I've looked at whether -to SRC_METHOD=NO_GEOTRANSFORM is available for
>     the gdal_rasterize utility but I don't think it is?
>
>     Best regards and thanks in advance,
>
>     Tim
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     http://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <http://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>
>
>
> -- 
> -- 
> http://schwehr.org
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/36f8da70/attachment-0001.html>

From even.rouault at spatialys.com  Wed Nov 30 09:05:09 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 30 Nov 2016 18:05:09 +0100
Subject: [gdal-dev] ogr2ogr - exclude table option?
In-Reply-To: <445417e7aa883900373c33d66683a933@carto.net>
References: <445417e7aa883900373c33d66683a933@carto.net>
Message-ID: <35264341.ulUObXxMNe@even-i700>

On mercredi 30 novembre 2016 16:21:42 CET Neumann, Andreas wrote:
> Hi,
> 
> I want to convert a whole Postgis schema to a geopackage. This works
> fine with
> 
> ogr2ogr -f GPKG av_1700.gpkg PG:'dbname=dbname host=localhost
> schemas=schemaname'
> 
> Now - my problem is that the schema contains 64 tables and I want to
> convert all tables except one table.
> 
> Is there a trick with an exclude option? I know that I can list all
> tables that I want to convert in the sense of a white list with
> 'tables=tab1,tab2,tab3', etc. - but this is complicated for this many
> tables.
> 
> I hope that there is / could be some black list option - or the
> possibility of specifying a pattern for selection the tables to be
> converted.

Andreas,

There's no such option (there's no real technical hurdle if one would want to add one, but 
one can wonder how common this use case is)
The easiest way currently would be to drop the unwished tables after the import : ogrinfo 
your.gpkg -sql "DROP TABLE table_name". Since GDAL 2.1.2, this not only drops the table but 
also all references to it in GPKG system tables.
You could also do a tiny script to list the tables and remove the one(s) you don't want from 
the list before calling ogr2ogr / gdal.VectorTranslate()

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/0bfd4df6/attachment.html>

From even.rouault at spatialys.com  Wed Nov 30 09:53:07 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 30 Nov 2016 18:53:07 +0100
Subject: [gdal-dev] Seg fault & error running gdal_rasterize on a non
	georeferenced raster
In-Reply-To: <4c47ff25-47ba-f52d-4c0c-4c0deb33f3c7@gmail.com>
References: <CAOKL=GxAxYaj5zfgA_XOmDiRCLL5R9A2mE1F+VOS59e1JKem9w@mail.gmail.com>
 <CACmBxyu2nEdkfQeCcJzsBzKQg-yQn-m-v-SCAFD7ZbPmTVp60A@mail.gmail.com>
 <4c47ff25-47ba-f52d-4c0c-4c0deb33f3c7@gmail.com>
Message-ID: <98715626.TckRasXNsV@even-i700>

On mercredi 30 novembre 2016 18:43:24 CET Ari Jolma wrote:
> At gdalrasterize.cpp:349 there is a call to Transformer but the
> TransformArg is NULL, which leads to segfault. Above the call there is a
> comment:
> 
> // TODO: We need to add all appropriate error checking at some point.
> 
> Obviously not all error checking is not done.
> 
> I also noticed that in Perl code there is some additional ease of use
> added to the user - she can give to the Rasterize method simply a file
> name, which implicitly assumes that the user has given options that
> cause the file to be created, and if not the result is a segfault. The
> same happens in gdal_rasterize:
> 
> gdal_rasterize -burn 17 -l features 20.gml test.tiff
> 
> results in segfault

This issue is another one than Tim's one.

I've fixed both per https://trac.osgeo.org/gdal/ticket/6738

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/a837408c/attachment.html>

From esacree at knology.net  Wed Nov 30 11:55:57 2016
From: esacree at knology.net (esacree)
Date: Wed, 30 Nov 2016 12:55:57 -0700 (MST)
Subject: [gdal-dev] WMTS - Need TileLevel option Servers responding with bad
 capabilities
Message-ID: <1480535757783-5298089.post@n6.nabble.com>


Question:  Is it possible to get a TileLevel option added to the new GDAL
WMTS driver?

Reason:  WMTS servers at USGS and ESRI are returning XML Capabilities with
TileLevel 18 (Google) or TileLevel 19 (default028mm).   The USGS help desk
said that the tile servers are only serving up to Tile Level 15.  The new
GDAL WMTS driver always request data from the max TileLevel in the
Capabilities.  The mismatch between the WMTS XML capabilities and the actual
maximum TileLevel are causing the GDAL WMTS driver requests to fail with
Error 404 (not found).

I have requested that they correct the WMTS XML Capabilities documents.  

Suggestion:  Could a "TileLevel" parameter be added to the WMTS GDAL driver
to limit the TileLevel to one that is available?   A TileLevel parameter
would help work around this situation.

Thanks!

Elaine



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/WMTS-Need-TileLevel-option-Servers-responding-with-bad-capabilities-tp5298089.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From esacree at knology.net  Wed Nov 30 12:02:03 2016
From: esacree at knology.net (esacree)
Date: Wed, 30 Nov 2016 13:02:03 -0700 (MST)
Subject: [gdal-dev] Request for API Key parameter to be added to the TMS
 driver for Google and VirtualEarth/Bing
Message-ID: <1480536123145-5298091.post@n6.nabble.com>


Request:  Need an APIKey parameter for the TMS driver for use with
VirtualEarth (Bing) and Google. The requests still work without the API key. 
But, according to Google and Bing, the API Key is now required to legally
use their services.   The API keys are free from their web sites.  For low
usage, there is no current charge to use the 2 services.   Google and Bing
do charge now for very high usage customers.

Thanks!

Elaine



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Request-for-API-Key-parameter-to-be-added-to-the-TMS-driver-for-Google-and-VirtualEarth-Bing-tp5298091.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From a.neumann at carto.net  Wed Nov 30 12:11:14 2016
From: a.neumann at carto.net (Andreas Neumann)
Date: Wed, 30 Nov 2016 21:11:14 +0100
Subject: [gdal-dev] ogr2ogr - exclude table option?
In-Reply-To: <35264341.ulUObXxMNe@even-i700>
References: <445417e7aa883900373c33d66683a933@carto.net>
 <35264341.ulUObXxMNe@even-i700>
Message-ID: <93ef9bd1-8fc4-0048-d0a0-f3212dc68004@carto.net>

Hi Even,

Thanks. I will use the 'ogrinfo your.gpkg -sql "DROP TABLE table_name"' 
trick for now.

One thing though: I noticed that the filesize doesn't really shrink. Is 
there a way to compact/vacuum the geopackage after removal of the table?

The table I remove is rather big - so it would have quite an effect on 
the filesize.

----------

On the blacklist / exclude table options for table transfer from Postgis 
to GPKG - can you please send me an estimate/quote offlist? Depending on 
how much this costs, I would be interested in paying for that.

Thanks a lot,

Andreas

Am 30.11.2016 um 18:05 schrieb Even Rouault:
>
> On mercredi 30 novembre 2016 16:21:42 CET Neumann, Andreas wrote:
>
> > Hi,
>
> >
>
> > I want to convert a whole Postgis schema to a geopackage. This works
>
> > fine with
>
> >
>
> > ogr2ogr -f GPKG av_1700.gpkg PG:'dbname=dbname host=localhost
>
> > schemas=schemaname'
>
> >
>
> > Now - my problem is that the schema contains 64 tables and I want to
>
> > convert all tables except one table.
>
> >
>
> > Is there a trick with an exclude option? I know that I can list all
>
> > tables that I want to convert in the sense of a white list with
>
> > 'tables=tab1,tab2,tab3', etc. - but this is complicated for this many
>
> > tables.
>
> >
>
> > I hope that there is / could be some black list option - or the
>
> > possibility of specifying a pattern for selection the tables to be
>
> > converted.
>
> Andreas,
>
> There's no such option (there's no real technical hurdle if one would 
> want to add one, but one can wonder how common this use case is)
>
> The easiest way currently would be to drop the unwished tables after 
> the import : ogrinfo your.gpkg -sql "DROP TABLE table_name". Since 
> GDAL 2.1.2, this not only drops the table but also all references to 
> it in GPKG system tables.
>
> You could also do a tiny script to list the tables and remove the 
> one(s) you don't want from the list before calling ogr2ogr / 
> gdal.VectorTranslate()
>
> Even
>
> -- 
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/2b9f7e3f/attachment.html>

From even.rouault at spatialys.com  Wed Nov 30 12:24:47 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 30 Nov 2016 21:24:47 +0100
Subject: [gdal-dev] ogr2ogr - exclude table option?
In-Reply-To: <93ef9bd1-8fc4-0048-d0a0-f3212dc68004@carto.net>
References: <445417e7aa883900373c33d66683a933@carto.net>
 <35264341.ulUObXxMNe@even-i700>
 <93ef9bd1-8fc4-0048-d0a0-f3212dc68004@carto.net>
Message-ID: <1594021.fKzZT6hxaP@even-i700>

On mercredi 30 novembre 2016 21:11:14 CET Andreas Neumann wrote:
> Hi Even,
> 
> Thanks. I will use the 'ogrinfo your.gpkg -sql "DROP TABLE table_name"'
> trick for now.
> 
> One thing though: I noticed that the filesize doesn't really shrink. Is
> there a way to compact/vacuum the geopackage after removal of the table?

You actually mentionned the appropriate SQL command: VACUUM :-)

I've just added this new paragraph to http://gdal.org/drv_geopackage.html:

"""When dropping a table, or removing records from tables, the space they
occupied is not immediately released and kept in the pool of file pages that
SQLite may reuse later. If you need to shrink the file to its minimum size,
you need to issue an explicit "VACUUM" SQL request. Note that this will
result in a full rewrite of the file."""

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/e01a5043/attachment.html>

From a.neumann at carto.net  Wed Nov 30 12:45:51 2016
From: a.neumann at carto.net (Andreas Neumann)
Date: Wed, 30 Nov 2016 21:45:51 +0100
Subject: [gdal-dev] ogr2ogr - exclude table option?
In-Reply-To: <1594021.fKzZT6hxaP@even-i700>
References: <445417e7aa883900373c33d66683a933@carto.net>
 <35264341.ulUObXxMNe@even-i700>
 <93ef9bd1-8fc4-0048-d0a0-f3212dc68004@carto.net>
 <1594021.fKzZT6hxaP@even-i700>
Message-ID: <a42ef232-d538-39ff-482d-057a0e5c49c6@carto.net>

Thanks Even!

The VACUUM command worked and indeed the file is now much smaller.

Thank you for adding this information to the Geopackage documentation!

I wasn't aware that I could run any SQL command through ogrinfo. Nice!

Greetings,

Andreas


Am 30.11.2016 um 21:24 schrieb Even Rouault:
>
> On mercredi 30 novembre 2016 21:11:14 CET Andreas Neumann wrote:
>
> > Hi Even,
>
> >
>
> > Thanks. I will use the 'ogrinfo your.gpkg -sql "DROP TABLE table_name"'
>
> > trick for now.
>
> >
>
> > One thing though: I noticed that the filesize doesn't really shrink. Is
>
> > there a way to compact/vacuum the geopackage after removal of the table?
>
> You actually mentionned the appropriate SQL command: VACUUM :-)
>
> I've just added this new paragraph to http://gdal.org/drv_geopackage.html:
>
> """When dropping a table, or removing records from tables, the space they
>
> occupied is not immediately released and kept in the pool of file 
> pages that
>
> SQLite may reuse later. If you need to shrink the file to its minimum 
> size,
>
> you need to issue an explicit "VACUUM" SQL request. Note that this will
>
> result in a full rewrite of the file."""
>
> Even
>
> -- 
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/a05eb41f/attachment.html>

From even.rouault at spatialys.com  Wed Nov 30 13:39:35 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 30 Nov 2016 22:39:35 +0100
Subject: [gdal-dev] Converting multilayer KML to single layer output
In-Reply-To: <1480509894962-5298014.post@n6.nabble.com>
References: <1480509894962-5298014.post@n6.nabble.com>
Message-ID: <12766887.hqhanpFMqY@even-i700>

On mercredi 30 novembre 2016 05:44:54 CET Rutger wrote:
> Hey,
> 
> I am trying to convert a kml-file containing multiple layers to a new output
> (GeoJSON for example), which only supports a single layer. All geometry
> types in the kml are identical, all polygon.
> 
> The only way i can make it work (by using gdal.VectorTranslate) is to first
> write a single layer to a file in 'overwrite' mode. And then run almost the
> identical command for the remaining layers in 'append' mode. Writing all
> layers in append mode sort of works, it creates the file and writes all
> layers, but it doesn't close the file properly. In the case of GeoJSON, it
> doesnt write ']}' at the end of the file.

I can't reproduce your issue with the file not being terminated with ]}

Hum maybe this is due to trying to append several layers with layers[1:] syntax. You should 
probably 

> 
> What i currently do is:
> /
> res = gdal.VectorTranslate(outfile, infile, format='GeoJSON',
> accessMode='overwrite', layers=layers[0], layerName='outlayer')
> res = None

Note that currently layers must be provided with an array, and not without a string 
(otherwise it iterates over each character of the string...) This is a defect I'm going to fix.

Note also that the 'overwrite' mode is without effect here (and will actually not do what you 
want). overwrite is for multi-layer datasets where you want to overwrite an existing layer. In 
the GeoJSON driver, this is not implemented. You should just remove it and in that case the 
whole file will be overwritten.


> 
> res = gdal.VectorTranslate(outfile, infile, format='GeoJSON',
> accessMode='append', layers=layers[1:], layerName='outlayer')
> res = None/
> 
> Where 'layers' is a Python list populated by iterating over the layers and
> calling 'lyr.GetName()'.
> 
> I dont like needing two commands to do this, and also iterating over all
> layers manually, just to get the names, seems a bit redundant. So i'm
> wondering if anyone knows ways to improve upon this.

Actually I've just tested the following successfully (with trunk)

from osgeo import gdal

gdal.VectorTranslate('out.json', 'src', layerName = 'outlayer', format = 'GeoJSON', 
accessMode='append', layers = ['poly', 'poly2', 'poly3'])


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20161130/1d24ba63/attachment-0001.html>

