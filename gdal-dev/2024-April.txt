From mdsumner at gmail.com  Mon Apr  1 11:36:16 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 2 Apr 2024 05:36:16 +1100
Subject: [gdal-dev] HDF5 and identified fields / primary dimension
Message-ID: <CAAcGz9-y7PcDkam9+966=JK_DzLiE3ccP+E=RROTWW6GOJombA@mail.gmail.com>

This source has an array on 'feature_id' with 2729077 values, with various
fields

elevation, longitude, latitude, qBtmVertRunoff, qBucket, etc

'/vsis3/noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010000.CHRTOUT_DOMAIN1.comp'

It is accessible via the mdim api.

Structurally it is basically a table with rows per feature_id and  columns
per fields, but it has a length-1 pair of fields "time" and
"reference_time" defined on dimension time, this is like a single time step
per file (like an unlimited dimension in the classic 2D case).

Accessing with the vector API reports that it can't treat this as a table
because of those time values that don't match the feature_id dimension:

ogrinfo
NETCDF:'/vsis3/noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010000.CHRTOUT_DOMAIN1.comp'
-ro

Warning 1: The dataset has several variables that could be identified as
vector fields, but not all share the same primary dimension. Consequently
they will be ignored.

I've seen similar cases in other files. I presume the driver could be
updated to 1) choose the primary dimension and read the values while ignore
others 2) user-specify the dimension to include, or 3) user-specify the
fields to exclude

So:

- is there a workaround to enable the vector driver to focus on the primary
dimension?
- would a PR along those lines have to consider greater difficulties than
applying the proposed updates to arrays using the primary dimension only?
 I'd only consider this for strictly 1D arrays.
- degenerate dimensions could be used to copy-out the value of the other
dims (I'd consider this an optional extra)

(It's a bit special-case-y, you wouldn't want to go to multi-arrays and
have them flatten out multi-dims in a general way, I think, but degenerate
dimensions might be worth consideration )

Appreciate any thoughts, thanks! I'd quite like to have the vector-approach
work as well as the mdim approach, I think they are nicely complementary
and provide different pros and cons.

Cheers, Mike

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240402/836ba09f/attachment.htm>

From mdsumner at gmail.com  Mon Apr  1 13:33:56 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 2 Apr 2024 07:33:56 +1100
Subject: [gdal-dev] HDF5 and identified fields / primary dimension
In-Reply-To: <CAAcGz9-y7PcDkam9+966=JK_DzLiE3ccP+E=RROTWW6GOJombA@mail.gmail.com>
References: <CAAcGz9-y7PcDkam9+966=JK_DzLiE3ccP+E=RROTWW6GOJombA@mail.gmail.com>
Message-ID: <CAAcGz9_JdSb-u8DfZ6K90xsWPH7NaKq-P1GSjvmkDH4j_Qvq2Q@mail.gmail.com>

well actually, I think what I'm asking for is the intended behaviour, but
there's an error.

Is it meant to detect sets of variables on 1D dimensions and present them
as layers? That's what would make sense to me.

Still exploring.

Cheers, Mike



On Tue, Apr 2, 2024 at 5:36?AM Michael Sumner <mdsumner at gmail.com> wrote:

> This source has an array on 'feature_id' with 2729077 values, with various
> fields
>
> elevation, longitude, latitude, qBtmVertRunoff, qBucket, etc
>
>
> '/vsis3/noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010000.CHRTOUT_DOMAIN1.comp'
>
> It is accessible via the mdim api.
>
> Structurally it is basically a table with rows per feature_id and  columns
> per fields, but it has a length-1 pair of fields "time" and
> "reference_time" defined on dimension time, this is like a single time step
> per file (like an unlimited dimension in the classic 2D case).
>
> Accessing with the vector API reports that it can't treat this as a table
> because of those time values that don't match the feature_id dimension:
>
> ogrinfo
> NETCDF:'/vsis3/noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010000.CHRTOUT_DOMAIN1.comp'
> -ro
>
> Warning 1: The dataset has several variables that could be identified as
> vector fields, but not all share the same primary dimension. Consequently
> they will be ignored.
>
> I've seen similar cases in other files. I presume the driver could be
> updated to 1) choose the primary dimension and read the values while ignore
> others 2) user-specify the dimension to include, or 3) user-specify the
> fields to exclude
>
> So:
>
> - is there a workaround to enable the vector driver to focus on the
> primary dimension?
> - would a PR along those lines have to consider greater difficulties than
> applying the proposed updates to arrays using the primary dimension only?
>  I'd only consider this for strictly 1D arrays.
> - degenerate dimensions could be used to copy-out the value of the other
> dims (I'd consider this an optional extra)
>
> (It's a bit special-case-y, you wouldn't want to go to multi-arrays and
> have them flatten out multi-dims in a general way, I think, but degenerate
> dimensions might be worth consideration )
>
> Appreciate any thoughts, thanks! I'd quite like to have the
> vector-approach work as well as the mdim approach, I think they are nicely
> complementary and provide different pros and cons.
>
> Cheers, Mike
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240402/d15c011d/attachment.htm>

From even.rouault at spatialys.com  Mon Apr  1 16:46:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 2 Apr 2024 01:46:48 +0200
Subject: [gdal-dev] HDF5 and identified fields / primary dimension
In-Reply-To: <CAAcGz9-y7PcDkam9+966=JK_DzLiE3ccP+E=RROTWW6GOJombA@mail.gmail.com>
References: <CAAcGz9-y7PcDkam9+966=JK_DzLiE3ccP+E=RROTWW6GOJombA@mail.gmail.com>
Message-ID: <08cadd0a-02b5-4f30-a5fa-d627c0a29c7e@spatialys.com>

Michael,
>
> Warning 1: The dataset has several variables that could be identified 
> as vector fields, but not all share the same primary dimension. 
> Consequently they will be ignored.
Yes, the driver is super conservative/picky when trying to recognize a 
netCDF file as a vector layer, and its heuristics will return in error 
if there is any ambiguity.
>
> I've seen similar cases in other files. I presume the driver could be 
> updated to 1) choose the primary dimension and read the values while 
> ignore others 2) user-specify the dimension to include, or 3) 
> user-specify the fields to exclude

I guess option 2 could be reasonable as an open option

For that particular file, I see that the "feature_id" variable 
(corresponding to the "feature_id" dimension) has a cf_role = 
"timeseries_id" attribute, and that the global metadata has a 
featureType = "timeSeries" attribute. So given 
https://cfconventions.org/Data/cf-conventions/cf-conventions-1.11/cf-conventions.html#coordinates-metadata 
, this seems to be relatively standardized, and in that case the 
heuristics could be improve to recognize that the main dimension is 
feature_id (probably with a test that the size of the time dimension is 
1).? As far as I can see/remember, the vector layer support in netCDF 
was originally developed for the featureType=point and profile use cases 
, so some tuning for timeseries isn't unexpected

Or maybe if detecting that in the set of dimensions there is only one 
with > 1 sample and others ones are at 1, consider only the one with > 1 
sample

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Tue Apr  2 03:16:33 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 2 Apr 2024 12:16:33 +0200
Subject: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it
Message-ID: <33e059de-53c4-434b-a0a1-0cfe3d197b70@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.8.5 release candidate. This is likely to be the
last bug fix release in the 3.8.x series, with 3.9.0 coming beginning of 
May.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.8.5/gdal385rc1.zip

A snapshot of the gdalautotest suite is also available:

https://download.osgeo.org/gdal/3.8.5/gdalautotest-3.8.5rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.8.5/gdalautotest-3.8.5rc1.zip

The NEWS file is here:

 ? https://github.com/OSGeo/gdal/blob/v3.8.5RC1/NEWS.md

Motion: adopt 3.8.5RC1 as final 3.8.5

Starting with my +1

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Tue Apr  2 04:09:15 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 2 Apr 2024 11:09:15 +0000
Subject: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it
In-Reply-To: <33e059de-53c4-434b-a0a1-0cfe3d197b70@spatialys.com>
References: <33e059de-53c4-434b-a0a1-0cfe3d197b70@spatialys.com>
Message-ID: <DB9PR09MB688743B13B9BE34187D4B982FD3E2@DB9PR09MB6887.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
L?hetetty: tiistai 2. huhtikuuta 2024 13.17
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it

Hi,

I have prepared a GDAL/OGR 3.8.5 release candidate. This is likely to be the last bug fix release in the 3.8.x series, with 3.9.0 coming beginning of May.
...

Motion: adopt 3.8.5RC1 as final 3.8.5

Starting with my +1

Best regards,

Even

From howard at hobu.co  Tue Apr  2 05:49:40 2024
From: howard at hobu.co (Howard Butler)
Date: Tue, 2 Apr 2024 07:49:40 -0500
Subject: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it
In-Reply-To: <DB9PR09MB688743B13B9BE34187D4B982FD3E2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <33e059de-53c4-434b-a0a1-0cfe3d197b70@spatialys.com>
 <DB9PR09MB688743B13B9BE34187D4B982FD3E2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <49CAC166-719C-490B-98D4-B0408C82F341@hobu.co>

+1

Howard

> On Apr 2, 2024, at 6:09?AM, Rahkonen Jukka via gdal-dev <gdal-dev at lists.osgeo.org> wrote:
> 
> +1
> 
> -Jukka Rahkonen-
> 
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
> L?hetetty: tiistai 2. huhtikuuta 2024 13.17
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it
> 
> Hi,
> 
> I have prepared a GDAL/OGR 3.8.5 release candidate. This is likely to be the last bug fix release in the 3.8.x series, with 3.9.0 coming beginning of May.
> ...
> 
> Motion: adopt 3.8.5RC1 as final 3.8.5
> 
> Starting with my +1
> 
> Best regards,
> 
> Even
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From j1 at jimenezshaw.com  Tue Apr  2 08:09:08 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 2 Apr 2024 17:09:08 +0200
Subject: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it
In-Reply-To: <49CAC166-719C-490B-98D4-B0408C82F341@hobu.co>
References: <33e059de-53c4-434b-a0a1-0cfe3d197b70@spatialys.com>
 <DB9PR09MB688743B13B9BE34187D4B982FD3E2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <49CAC166-719C-490B-98D4-B0408C82F341@hobu.co>
Message-ID: <CADRrdKvC6kp8z=-T_QCi8BeZ-0RUH4WwzkCdPDRjSeappyg8zw@mail.gmail.com>

+1 Javier

On Tue, 2 Apr 2024 at 14:49, Howard Butler via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> +1
>
> Howard
>
> > On Apr 2, 2024, at 6:09?AM, Rahkonen Jukka via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
> >
> > +1
> >
> > -Jukka Rahkonen-
> >
> > -----Alkuper?inen viesti-----
> > L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even
> Rouault via gdal-dev
> > L?hetetty: tiistai 2. huhtikuuta 2024 13.17
> > Vastaanottaja: gdal-dev at lists.osgeo.org
> > Aihe: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it
> >
> > Hi,
> >
> > I have prepared a GDAL/OGR 3.8.5 release candidate. This is likely to be
> the last bug fix release in the 3.8.x series, with 3.9.0 coming beginning
> of May.
> > ...
> >
> > Motion: adopt 3.8.5RC1 as final 3.8.5
> >
> > Starting with my +1
> >
> > Best regards,
> >
> > Even
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240402/76101341/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr  3 01:56:21 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 3 Apr 2024 08:56:21 +0000
Subject: [gdal-dev] Gdaladdo and external mask band
Message-ID: <DB9PR09MB688773407A4C1371363FCACEFD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

I was making some tests with filegdb raster from Region 5 - State (usda.gov)<https://www.fs.usda.gov/detail/r5/communityforests/?cid=fseprd1009698>, file https://usfs-public.box.com/shared/static/q96eev9gnsa9hw5bwpmwpmxerbdat0vi.zip
I converted the data into GeoTIFF, added overviews, and noticed, that the GeoTIFF is very slow to browse with QGIS at small scales. I noticed that it is because gdal_translate creates an external .msk mask band, and gdaladdo does not create overviews for the mask.
Is is somehow possible to create overviews for the .msk mask either automatically or manually? Or would it create a bad mask that would not match with the corresponding overviews of the data bands?

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/8e5773a5/attachment.htm>

From nbennsasr at luxcarta.com  Wed Apr  3 02:39:10 2024
From: nbennsasr at luxcarta.com (Nejia Ben Nasr)
Date: Wed, 3 Apr 2024 09:39:10 +0000
Subject: [gdal-dev] GDAL under cygwin doesn't read geotiff
Message-ID: <PAZP264MB404589CC4D9A7DECFA9BA48CCB3D2@PAZP264MB4045.FRAP264.PROD.OUTLOOK.COM>

Hi,

I downloaded the last version of GDAL package.
gdalinfo on any tiff file give "Segmentation fault".

$ gdalinfo --version
GDAL 3.8.3, released 2024/01/04

$ gdalinfo test.tif --config CPL_DEBUG ON
GDAL: GDALOpen(test.tif, this=0xa000bbe70) succeeds as GTiff.
Driver: GTiff/GeoTIFF
Segmentation fault


CALL STACK:
cygtiff-6.dll!cygtiff-6!TIFFUnlinkDirectory (Unknown Source:0)
cygwin1.dll!bsearch(const void * key, const void * base, size_t nmemb, size_t size, int (*)(const void *, const void *) compar) (c:\cygwin64\usr\src\debug\cygwin-3.5.0-1\newlib\libc\search\bsearch.c:79)
cygtiff-6.dll!cygtiff-6!TIFFFindField (Unknown Source:0)
cygtiff-6.dll!cygtiff-6!TIFFVGetField (Unknown Source:0)
cygtiff-6.dll!cygtiff-6!TIFFGetField (Unknown Source:0)
cyggeotiff-5.dll!_GTIFGetField(tiff_t * tif, pinfo_t tag, int * count, void * val) (c:\cygwin64\usr\src\debug\libgeotiff-1.7.1-2\geo_tiffp.c:86)
cyggeotiff-5.dll!GTIFNewWithMethodsEx(void * tif, TIFFMethod * methods, GTErrorCallback error_callback, void * user_data) (c:\cygwin64\usr\src\debug\libgeotiff-1.7.1-2\geo_new.c:133)
cyggeotiff-5.dll!GTIFNewEx(void * tif, GTErrorCallback error_callback, void * user_data) (c:\cygwin64\usr\src\debug\libgeotiff-1.7.1-2\geo_new.c:84)
cyggdal-34.dll!GTiffDataset::GTIFNew(TIFF * hTIFF) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\frmts\gtiff\gtiffdataset.cpp:1613)
cyggdal-34.dll!GTiffDataset::LoadGeoreferencingAndPamIfNeeded(GTiffDataset * const this) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\frmts\gtiff\gtiffdataset_read.cpp:5833)
cyggdal-34.dll!GTiffRasterBand::GetMetadataItem(GTiffRasterBand * const this, const char * pszName, const char * pszDomain) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\frmts\gtiff\gtiffrasterband_read.cpp:1532)
cyggdal-34.dll!GDALRasterBand::GetStatistics(GDALRasterBand * const this, int bApproxOK, int bForce, double * pdfMin, double * pdfMax, double * pdfMean, double * pdfStdDev) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\gcore\gdalrasterband.cpp:4316)


I also tried to build from sources but it fail:
$ cmake .. \
   -DCMAKE_BUILD_TYPE=Release \
   -DCMAKE_INSTALL_PREFIX=/cygdrive/d/gdal-release-3.8/install \
   -DGDAL_USE_INTERNAL_LIBS=ON \
   -DGDAL_USE_EXTERNAL_LIBS=OFF \
   -DGDAL_BUILD_OPTIONAL_DRIVERS=OFF \
   -DOGR_BUILD_OPTIONAL_DRIVERS=OFF

$ make

In file included from /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/map:60,
                 from /cygdrive/d/gdal-release-3.8/gcore/gdal_priv.h:7,
                 from /cygdrive/d//gdal-release-3.8/apps/gdalinfo_lib.cpp:55:
/usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_tree.h:350:1: error: expected unqualified-id before numeric constant
  350 | 1      _Rb_tree_const_iterator(const iterator& __it) _GLIBCXX_NOEXCEPT
      | ^
make[2]: *** [apps/CMakeFiles/appslib.dir/build.make:76: apps/CMakeFiles/appslib.dir/gdalinfo_lib.cpp.o] Error 1
make[1]: *** [CMakeFiles/Makefile2:3038: apps/CMakeFiles/appslib.dir/all] Error 2
make: *** [Makefile:146: all] Error 2

Is there a Cmake option that I shoud add?

Thank you for you help!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/8b1a92e3/attachment-0001.htm>

From lnicola at dend.ro  Wed Apr  3 02:56:33 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Wed, 03 Apr 2024 12:56:33 +0300
Subject: [gdal-dev] GDAL under cygwin doesn't read geotiff
In-Reply-To: <PAZP264MB404589CC4D9A7DECFA9BA48CCB3D2@PAZP264MB4045.FRAP264.PROD.OUTLOOK.COM>
References: <PAZP264MB404589CC4D9A7DECFA9BA48CCB3D2@PAZP264MB4045.FRAP264.PROD.OUTLOOK.COM>
Message-ID: <1273e7c4-fda9-4459-822e-c4512fd42fad@betaapp.fastmail.com>

Hi,

Someone reported on IRC a similar crash about two weeks ago. As far as I can tell, that one is up to the Cygwin maintainers, so you should report it on their mailing list https://cygwin.com/lists.html#cygwin.

Not sure about the Cygwin error and how well-tested GDAL is on that platform. The Conda build might cover it, though.

Laurentiu

On Wed, Apr 3, 2024, at 12:39, Nejia Ben Nasr via gdal-dev wrote:
> Hi,
> 
> I downloaded the last version of GDAL package.
> gdalinfo on any tiff file give "Segmentation fault".
> 
> $ gdalinfo --version
> GDAL 3.8.3, released 2024/01/04
> 
> $ gdalinfo test.tif --config CPL_DEBUG ON
> GDAL: GDALOpen(test.tif, this=0xa000bbe70) succeeds as GTiff.
> Driver: GTiff/GeoTIFF
> Segmentation fault
> 
> 
> CALL STACK:
> cygtiff-6.dll!cygtiff-6!TIFFUnlinkDirectory (Unknown Source:0)
> cygwin1.dll!bsearch(const void * key, const void * base, size_t nmemb, size_t size, int (*)(const void *, const void *) compar) (c:\cygwin64\usr\src\debug\cygwin-3.5.0-1\newlib\libc\search\bsearch.c:79)
> cygtiff-6.dll!cygtiff-6!TIFFFindField (Unknown Source:0)
> cygtiff-6.dll!cygtiff-6!TIFFVGetField (Unknown Source:0)
> cygtiff-6.dll!cygtiff-6!TIFFGetField (Unknown Source:0)
> cyggeotiff-5.dll!_GTIFGetField(tiff_t * tif, pinfo_t tag, int * count, void * val) (c:\cygwin64\usr\src\debug\libgeotiff-1.7.1-2\geo_tiffp.c:86)
> cyggeotiff-5.dll!GTIFNewWithMethodsEx(void * tif, TIFFMethod * methods, GTErrorCallback error_callback, void * user_data) (c:\cygwin64\usr\src\debug\libgeotiff-1.7.1-2\geo_new.c:133)
> cyggeotiff-5.dll!GTIFNewEx(void * tif, GTErrorCallback error_callback, void * user_data) (c:\cygwin64\usr\src\debug\libgeotiff-1.7.1-2\geo_new.c:84)
> cyggdal-34.dll!GTiffDataset::GTIFNew(TIFF * hTIFF) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\frmts\gtiff\gtiffdataset.cpp:1613)
> cyggdal-34.dll!GTiffDataset::LoadGeoreferencingAndPamIfNeeded(GTiffDataset * const this) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\frmts\gtiff\gtiffdataset_read.cpp:5833)
> cyggdal-34.dll!GTiffRasterBand::GetMetadataItem(GTiffRasterBand * const this, const char * pszName, const char * pszDomain) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\frmts\gtiff\gtiffrasterband_read.cpp:1532)
> cyggdal-34.dll!GDALRasterBand::GetStatistics(GDALRasterBand * const this, int bApproxOK, int bForce, double * pdfMin, double * pdfMax, double * pdfMean, double * pdfStdDev) (c:\cygwin64\usr\src\debug\gdal-3.8.3-1\gcore\gdalrasterband.cpp:4316)
> 
> 
> I also tried to build from sources but it fail:
> $ cmake .. \
>    -DCMAKE_BUILD_TYPE=Release \
>    -DCMAKE_INSTALL_PREFIX=/cygdrive/d/gdal-release-3.8/install \
>    -DGDAL_USE_INTERNAL_LIBS=ON \
>    -DGDAL_USE_EXTERNAL_LIBS=OFF \
>    -DGDAL_BUILD_OPTIONAL_DRIVERS=OFF \
>    -DOGR_BUILD_OPTIONAL_DRIVERS=OFF 
> 
> $ make
> 
> In file included from /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/map:60,
>                  from /cygdrive/d/gdal-release-3.8/gcore/gdal_priv.h:7,
>                  from /cygdrive/d//gdal-release-3.8/apps/gdalinfo_lib.cpp:55:
> /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_tree.h:350:1: error: expected unqualified-id before numeric constant
>   350 | 1      _Rb_tree_const_iterator(const iterator& __it) _GLIBCXX_NOEXCEPT
>       | ^
> make[2]: *** [apps/CMakeFiles/appslib.dir/build.make:76: apps/CMakeFiles/appslib.dir/gdalinfo_lib.cpp.o] Error 1
> make[1]: *** [CMakeFiles/Makefile2:3038: apps/CMakeFiles/appslib.dir/all] Error 2
> make: *** [Makefile:146: all] Error 2
> 
> Is there a Cmake option that I shoud add?
> 
> Thank you for you help!
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/8eb98998/attachment.htm>

From even.rouault at spatialys.com  Wed Apr  3 07:18:03 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 Apr 2024 16:18:03 +0200
Subject: [gdal-dev] Gdaladdo and external mask band
In-Reply-To: <DB9PR09MB688773407A4C1371363FCACEFD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <DB9PR09MB688773407A4C1371363FCACEFD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <c816ce92-ac3b-4a07-9a5b-fc483a91e341@spatialys.com>

Hi Jukka,

I've realized this behaviour was actually documented in 
https://gdal.org/drivers/raster/gtiff.html#overviews-and-nodata-masks : 
"Internal overviews, external nodata mask: when running BuildOverviews() 
in update mode on the .tif file, only the overviews of the main bands 
will be generated. Overviews of the external .msk file must be 
explicitly generated by running BuildOverviews() on the .msk."

... but just after fixing it in https://github.com/OSGeo/gdal/pull/9603 
to do the expected thing: that is build overviews of the main bands and 
of the .msk

I think it is also high time to reconsider switching the default value 
of GDAL_TIFF_INTERNAL_MASK to YES : https://github.com/OSGeo/gdal/pull/9604

Even

Le 03/04/2024 ? 10:56, Rahkonen Jukka via gdal-dev a ?crit?:
>
> Hi,
>
> I was making some tests with filegdb raster from Region 5 - State 
> (usda.gov) 
> <https://www.fs.usda.gov/detail/r5/communityforests/?cid=fseprd1009698>, 
> file 
> https://usfs-public.box.com/shared/static/q96eev9gnsa9hw5bwpmwpmxerbdat0vi.zip
> I converted the data into GeoTIFF, added overviews, and noticed, that 
> the GeoTIFF is very slow to browse with QGIS at small scales. I 
> noticed that it is because gdal_translate creates an external .msk 
> mask band, and gdaladdo does not create overviews for the mask.
>
> Is is somehow possible to create overviews for the .msk mask either 
> automatically or manually? Or would it create a bad mask that would 
> not match with the corresponding overviews of the data bands?
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/2e1455b9/attachment-0001.htm>

From mdsumner at gmail.com  Wed Apr  3 07:26:25 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 4 Apr 2024 01:26:25 +1100
Subject: [gdal-dev] STACIT and limit
Message-ID: <CAAcGz99Bag7aD5YebadqjJhaYgqcjE5YfLwt7gMiQkdxYmjVUA@mail.gmail.com>

this works for me, there are ten items in the filelist:

gdalinfo "STACIT:\"
https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z\":asset=visual"
-oo MAX_ITEMS=10

and with 20 it's also fine, filelist of 20.

but, with MAX_ITEMS=40 there's the warning

Warning 1: Maximum number of items (1000) allowed to be retrieved has been
hit

and the result is SDS list split by CRS:

gdalinfo "STACIT:\"
https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z\":asset=visual"
-oo MAX_ITEMS=40
Driver: VRT/Virtual Raster
Files: none associated
Size is 0, 0
Subdatasets:
  SUBDATASET_1_NAME=STACIT:"
https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
":asset=visual,crs=EPSG_32631
  SUBDATASET_1_DESC=Asset visual of
https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
in CRS EPSG:32631
  SUBDATASET_2_NAME=STACIT:"
https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
":asset=visual,crs=EPSG_32632
  SUBDATASET_2_DESC=Asset visual of
https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
in CRS EPSG:32632


Another case is this where there should be 4 TCI.tif items, but I only get
2 subdatasets (one for each CRS)

gdalinfo "STACIT:\"
https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=179,-17,180,-16&datetime=2023-01-01T00:00:00Z/2023-01-03T23:59:59Z\
":asset=visual"

It feels like something awry with the limit for the server, or the driver,
or maybe interacting.

But, I think it's reasonable expect to not get SDS listed when an asset is
specified?

Cheers, Mike

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240404/6b1c2e04/attachment.htm>

From mdsumner at gmail.com  Wed Apr  3 07:27:58 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 4 Apr 2024 01:27:58 +1100
Subject: [gdal-dev] HDF5 and identified fields / primary dimension
In-Reply-To: <08cadd0a-02b5-4f30-a5fa-d627c0a29c7e@spatialys.com>
References: <CAAcGz9-y7PcDkam9+966=JK_DzLiE3ccP+E=RROTWW6GOJombA@mail.gmail.com>
 <08cadd0a-02b5-4f30-a5fa-d627c0a29c7e@spatialys.com>
Message-ID: <CAAcGz99=NGZ39cx1iGAoCmh1jfk2PLW7FxmNMtCKtSha_Ypg3w@mail.gmail.com>

> For that particular file, I see that the "feature_id" variable
> (corresponding to the "feature_id" dimension) has a cf_role =
> "timeseries_id" attribute, and that the global metadata has a
> featureType = "timeSeries" attribute. So given
>
> https://cfconventions.org/Data/cf-conventions/cf-conventions-1.11/cf-conventions.html#coordinates-metadata
> , this seems to be relatively standardized, and in that case the
> heuristics could be improve to recognize that the main dimension is
> feature_id (probably with a test that the size of the time dimension is
> 1).  As far as I can see/remember, the vector layer support in netCDF
> was originally developed for the featureType=point and profile use cases
> , so some tuning for timeseries isn't unexpected
>
>
Thanks!  I've made *some* progress, the deepest I've been down in that file
... I hope to be able to craft these suggestions at some point.

Cheers, Mike



> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240404/26a58d81/attachment.htm>

From mdsumner at gmail.com  Wed Apr  3 07:35:54 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 4 Apr 2024 01:35:54 +1100
Subject: [gdal-dev] STACIT and limit
In-Reply-To: <CAAcGz99Bag7aD5YebadqjJhaYgqcjE5YfLwt7gMiQkdxYmjVUA@mail.gmail.com>
References: <CAAcGz99Bag7aD5YebadqjJhaYgqcjE5YfLwt7gMiQkdxYmjVUA@mail.gmail.com>
Message-ID: <CAAcGz99qqCRn10df7ShWdtGwxubAvsi3e6WGQ6ekMBaYVBB+iQ@mail.gmail.com>

Oh, my bad. It's documented to split into SDS for multiple CRS.

Ouch that's not how I thought it was working, but it makes sense.

Thanks, Mike



On Thu, Apr 4, 2024 at 1:26?AM Michael Sumner <mdsumner at gmail.com> wrote:

> this works for me, there are ten items in the filelist:
>
> gdalinfo "STACIT:\"
> https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z\":asset=visual"
> -oo MAX_ITEMS=10
>
> and with 20 it's also fine, filelist of 20.
>
> but, with MAX_ITEMS=40 there's the warning
>
> Warning 1: Maximum number of items (1000) allowed to be retrieved has been
> hit
>
> and the result is SDS list split by CRS:
>
> gdalinfo "STACIT:\"
> https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z\":asset=visual"
> -oo MAX_ITEMS=40
> Driver: VRT/Virtual Raster
> Files: none associated
> Size is 0, 0
> Subdatasets:
>   SUBDATASET_1_NAME=STACIT:"
> https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
> ":asset=visual,crs=EPSG_32631
>   SUBDATASET_1_DESC=Asset visual of
> https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
> in CRS EPSG:32631
>   SUBDATASET_2_NAME=STACIT:"
> https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
> ":asset=visual,crs=EPSG_32632
>   SUBDATASET_2_DESC=Asset visual of
> https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=0,0,10,10&datetime=2023-01-01T00:00:00Z/2023-12-31T23:59:59Z
> in CRS EPSG:32632
>
>
> Another case is this where there should be 4 TCI.tif items, but I only get
> 2 subdatasets (one for each CRS)
>
> gdalinfo "STACIT:\"
> https://earth-search.aws.element84.com/v1/search?collections=sentinel-2-c1-l2a&bbox=179,-17,180,-16&datetime=2023-01-01T00:00:00Z/2023-01-03T23:59:59Z\
> ":asset=visual"
>
> It feels like something awry with the limit for the server, or the driver,
> or maybe interacting.
>
> But, I think it's reasonable expect to not get SDS listed when an asset is
> specified?
>
> Cheers, Mike
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240404/0ed99638/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr  3 07:48:42 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 3 Apr 2024 14:48:42 +0000
Subject: [gdal-dev] Gdaladdo and external mask band
In-Reply-To: <c816ce92-ac3b-4a07-9a5b-fc483a91e341@spatialys.com>
References: <DB9PR09MB688773407A4C1371363FCACEFD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <c816ce92-ac3b-4a07-9a5b-fc483a91e341@spatialys.com>
Message-ID: <DB9PR09MB6887AF9D4E78E00696768D35FD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

Great, I just found 21000 .msk files without overviews from my computer. My scanned map files are so small that I have not noticed that they are unnecessary slow to view. Only trying someone else's data with 70000 by 80000 pixels draw my attention.

-Jukka-

L?hett?j?: Even Rouault <even.rouault at spatialys.com>
L?hetetty: keskiviikko 3. huhtikuuta 2024 17.18
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>; 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] Gdaladdo and external mask band


Hi Jukka,

I've realized this behaviour was actually documented in https://gdal.org/drivers/raster/gtiff.html#overviews-and-nodata-masks : "Internal overviews, external nodata mask: when running BuildOverviews() in update mode on the .tif file, only the overviews of the main bands will be generated. Overviews of the external .msk file must be explicitly generated by running BuildOverviews() on the .msk."

... but just after fixing it in https://github.com/OSGeo/gdal/pull/9603 to do the expected thing: that is build overviews of the main bands and of the .msk

I think it is also high time to reconsider switching the default value of GDAL_TIFF_INTERNAL_MASK to YES : https://github.com/OSGeo/gdal/pull/9604

Even
Le 03/04/2024 ? 10:56, Rahkonen Jukka via gdal-dev a ?crit :
Hi,

I was making some tests with filegdb raster from Region 5 - State (usda.gov)<https://www.fs.usda.gov/detail/r5/communityforests/?cid=fseprd1009698>, file https://usfs-public.box.com/shared/static/q96eev9gnsa9hw5bwpmwpmxerbdat0vi.zip
I converted the data into GeoTIFF, added overviews, and noticed, that the GeoTIFF is very slow to browse with QGIS at small scales. I noticed that it is because gdal_translate creates an external .msk mask band, and gdaladdo does not create overviews for the mask.
Is is somehow possible to create overviews for the .msk mask either automatically or manually? Or would it create a bad mask that would not match with the corresponding overviews of the data bands?

-Jukka Rahkonen-



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/f25c8f33/attachment-0001.htm>

From rob.hewy at gmail.com  Wed Apr  3 07:51:10 2024
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Wed, 3 Apr 2024 07:51:10 -0700
Subject: [gdal-dev] LAUNDER option for geopackages
Message-ID: <CAG_Q50RCTAZKyHrqbNXGAptO=AjBawxLSa6KviLZze-v=jU=8Q@mail.gmail.com>

Hi,

Is there a LAUNDER for geopackages?

I ask this because at the following site:

https://www.geopackage.org/guidance/getting-started.html

Gives this specific guidance:

Note: *For maximum interoperability,* start your database identifiers
(table names, column names, etc.) with a lowercase character and only
use *lowercase
characters*, numbers 0-9, and underscores (_).

Which then turned into a *constraint* in GeoNode (I could not upload a
certain geopackage from the township of langley) where I eventually
discovered in the celery logs this error:

ERROR/ForkPoolWorker-958] {'validation_code': 'RQ1',
'validation_description': 'Layer names must start with a letter, and
*valid characters are lowercase a-z*, numbers or underscores.', 'level':
'error', 'locations': ['Error layer: Parcel_Attributes']}

I would love LAUNDER to be a more global option.

Upper for: Oracle and Shapefiles.
Lower for: Postgresql, Mysql, geopackages

Just wondering,

Rob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/c31cfbb6/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr  3 08:50:19 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 3 Apr 2024 15:50:19 +0000
Subject: [gdal-dev] LAUNDER option for geopackages
In-Reply-To: <CAG_Q50RCTAZKyHrqbNXGAptO=AjBawxLSa6KviLZze-v=jU=8Q@mail.gmail.com>
References: <CAG_Q50RCTAZKyHrqbNXGAptO=AjBawxLSa6KviLZze-v=jU=8Q@mail.gmail.com>
Message-ID: <DB9PR09MB6887913BB1CC2E8420C4A020FD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

The GeoPackage standard recommends some laundering to be done by the clients:

Implementers should be aware of the fact that SQLite table names are not case
sensitive and that table names in sqlite_master and gpkg_extensions may not have
the same case. When searching for table name references, it is recommended to
transform table names to lower case with the lower() function. See the Abstract
Test Suite for an example.

If GeoNode does not have any other reason for its requirement than what you have pointed out, then maybe it is too strict.

Having launder in GPKG driver feels still reasonable. SQLite driver has it already https://gdal.org/drivers/vector/sqlite.html.

"LAUNDER=[YES/NO]: Defaults to YES. Controls whether layer and field names will be laundered for easier use in SQLite. Laundered names will be converted to lower case and some special characters(' - #) will be changed to underscores."

It is either not documented or not implemented, but laundering identifiers to work without "quotas" would also require removing numbers from the beginning of the name. And at least % should be added to the list of special characters. But total laundering requires quite a lot https://www.sqlite.org/draft/tokenreq.html.

Laundering characters like ??? for GeoNode feels too much. Who would say into what characters to launder?

-Jukka Rahkonen-



L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Robert Hewlett via gdal-dev
L?hetetty: keskiviikko 3. huhtikuuta 2024 17.51
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] LAUNDER option for geopackages

Hi,

Is there a LAUNDER for geopackages?

I ask this because at the following site:

https://www.geopackage.org/guidance/getting-started.html

Gives this specific guidance:

Note: For maximum interoperability, start your database identifiers (table names, column names, etc.) with a lowercase character and only use lowercase characters, numbers 0-9, and underscores (_).

Which then turned into a constraint in GeoNode (I could not upload a certain geopackage from the township of langley) where I eventually discovered in the celery logs this error:

ERROR/ForkPoolWorker-958] {'validation_code': 'RQ1', 'validation_description': 'Layer names must start with a letter, and valid char
acters are lowercase a-z, numbers or underscores.', 'level': 'error', 'locations': ['Error layer: Parcel_Attributes']}

I would love LAUNDER to be a more global option.

Upper for: Oracle and Shapefiles.
Lower for: Postgresql, Mysql, geopackages

Just wondering,

Rob


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/3ea96e14/attachment.htm>

From sean.gillies at gmail.com  Wed Apr  3 10:27:05 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Wed, 3 Apr 2024 11:27:05 -0600
Subject: [gdal-dev] CVE-2024-3094 (aka "xz hackdoor") and GDAL
In-Reply-To: <2fcd1d2f-37d2-44b7-8717-8074871fa351@spatialys.com>
References: <2fcd1d2f-37d2-44b7-8717-8074871fa351@spatialys.com>
Message-ID: <CAOodmJon_nyMBFT9jcgmj7J=KjKgKNc=Y5oqARzYuO2D2GVuXQ@mail.gmail.com>

Thank you for the analysis, Even!

I've made similar announcements for the fiona and rasterio projects and
plagiarized your subject line. Fiona and rasterio wheels on PyPI include
versions of liblzma no more recent than 5.4.4 and do not include libarchive.

https://github.com/Toblerity/Fiona/discussions/1367
https://github.com/rasterio/rasterio/discussions/3047

On Sat, Mar 30, 2024 at 1:16?PM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> TLDR: no specific reason to worry.
>
> My longer analysis:
>
> Those following the recent security news have certainly come across
> https://lwn.net/Articles/967180 or similar articles, and if you don't
> have and have been running a cutting edge Linux distribution recently, you
> *should* follow related security alerts emitted by your vendor.
>
> liblzma (the library part of the xz software distribution) is an optional
> libtiff dependency for the TIFF LZMA codec, and an optional direct GDAL
> dependency since GDAL 1.8.0. Initially only used when building GDAL with
> its internal libtiff, and since GDAL 3.4.0, directly too as a Zarr codec.
>
> Beyond activity in liblzma / xz being potentially suspicious with at least
> 2 years of "contributions" by malicious actor https://github.com/JiaT75,
> which makes the current headlines, it has also been found that they
> contributed to libarchive too since 2021 (
> https://github.com/libarchive/libarchive/commits?author=JiaT75), and
> their latest commit https://github.com/libarchive/libarchive/pull/1609 is
> in particular pointed as suspicious. As far as I can see, this commit is
> present in libarchive >= 3.6. I mention libarchive because it is an
> optional GDAL dependency since GDAL 3.7.0 for the /vsi7z/ and /vsirar/
> virtual file systems.
>
> We don't have vendored copies of liblzma or libarchive in the GDAL source
> code repository.
>
> Regarding GDAL Docker images, here's the status of versions they ship:
>
> - ghcr.io/osgeo/gdal:alpine-small-3.8.4 and
> ghcr.io/osgeo/gdal:alpine-normal-3.8.4:
> xz-libs-5.4.3-r0
> libarchive-3.7.2-r0
>
> - ghcr.io/osgeo/gdal:ubuntu-full-3.8.4:
> liblzma5:amd64                5.2.5-2ubuntu1
> libarchive13:amd64            3.6.0-1ubuntu1
>
> - ghcr.io/osgeo/gdal:ubuntu-small-3.8.4:
> liblzma5:amd64              5.2.5-2ubuntu1
>
> So those liblzma versions are not currently considered as affected.
> Regarding libarchive status and the impact of JiaT75's activity there, it
> seems to me we are yet in undecided territory and it wouldn't be surprising
> to see update of those libraries in the coming weeks, as exploration of
> past activity from that compromising entity is performed.
>
> It is a good time to recall usual general best-practices:
>
> - avoid opening datasets coming from unknown or untrusted sources
>
> - if you do so, prefer doing that on dedicated workstations that don't
> have access to sensitive information
>
> - you may reduce your potential exposure by disabling at build time
> optional dependencies you don't need.
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/7d2ebe4d/attachment-0001.htm>

From mdsumner at gmail.com  Wed Apr  3 13:56:53 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 4 Apr 2024 07:56:53 +1100
Subject: [gdal-dev] discussion on xarray and the missing abstract-grid
 specification
Message-ID: <CAAcGz98AwG392hnmrzaqRw5Wf0Qdwi7NO7vXEvxv-+NA9nQm0g@mail.gmail.com>

Here's an (ahem) extremely important discussion on the prospects for xarray
to extend from the coordinates-only model (like that of netcdf) for geo
reference:

https://discourse.pangeo.io/t/example-which-highlights-the-limitations-of-netcdf-style-coordinates-for-large-geospatial-rasters/

I'm heartened to see this recognized at this level. I think GDAL per se
should feature in this discussion prominently, and not just the downstream
Python packages that are mentioned.

For my input, I'll be highlighting examples of

-  degenerate rectilinear coordinates, and the problem of whether to assign
a regular grid there (with a trivial lightweight Translate a la -a_ullr),
or to define a new regular grid and push it through the Warp api, as a
dataset that picks up or can be pointed to the 1D coordinate arrays. This
has been the crux of the issue for me, I get to decisions where it's not
clear what was intended or what should be done going forward.

- actual curvilinear coordinates, and the very very general power of that
to resolve to a regular grid with very simple specification (specify some
or nothing of target/extent/resolution/crs/dimension). Key problems here
are when the coordinate arrays are not auto-detected (rare) or when the
longitudes are unwrapped (less rare).

- that extent+dimension is complementary to the affine transform, and way
more user-friendly way to work with rasters for the assign and/or target
specification step (this is huge in R since the {raster} package ca. 2009
and very well supported by Warp and Translate). It's true that
extent+dimension can't do shear params but it's a perfectly valid way to
work and flipping from transform to extent is trivial numerically.

I hope some more voices from this community pitch in as well, very happy to
discuss here or offline about any of this.  I'm not really a technical
expert but I have a good overview of the landscape that GDAL sits in, and
I'm making similar pitches for involvement in the R communities.

Cheers, Mike

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240404/d2414839/attachment.htm>

From even.rouault at spatialys.com  Wed Apr  3 13:59:52 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 Apr 2024 22:59:52 +0200
Subject: [gdal-dev] LAUNDER option for geopackages
In-Reply-To: <DB9PR09MB6887913BB1CC2E8420C4A020FD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAG_Q50RCTAZKyHrqbNXGAptO=AjBawxLSa6KviLZze-v=jU=8Q@mail.gmail.com>
 <DB9PR09MB6887913BB1CC2E8420C4A020FD3D2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <4649b2c4-fd4f-483f-aea6-214685d6b579@spatialys.com>

Hi,

I've given this a crack at https://github.com/OSGeo/gdal/pull/9609

The newly introduced LAUNDER option for GeoPackage is indeed quite 
"extreme" compared to the existing ones, hence I've defaulted it to NO.

I've also added a LAUNDER_ASCII option to PG/PGDump to do something 
similar to GeoPackage LAUNDER.

Even

Le 03/04/2024 ? 17:50, Rahkonen Jukka via gdal-dev a ?crit?:
>
> Hi,
>
> The GeoPackage standard recommends some laundering to be done by the 
> clients:
>
> Implementers should be aware of the fact that SQLite table names are 
> not case
>
> sensitive and that table names in sqlite_master and gpkg_extensions 
> may not have
>
> the same case. When searching for table name references, it is 
> recommended to
>
> transform table names to lower case with the lower() function. See the 
> Abstract
>
> Test Suite for an example.
>
> If GeoNode does not have any other reason for its requirement than 
> what you have pointed out, then maybe it is too strict.
>
> Having launder in GPKG driver feels still reasonable. SQLite driver 
> has it already https://gdal.org/drivers/vector/sqlite.html.
>
>
> ?LAUNDER=[YES/NO]: Defaults to YES. Controls whether layer and field 
> names will be laundered for easier use in SQLite. Laundered names will 
> be converted to lower case and some special characters(' - #) will be 
> changed to underscores.?
>
> It is either not documented or not implemented, but laundering 
> identifiers to work without "quotas" would also require removing 
> numbers from the beginning of the name. And at least % should be added 
> to the list of special characters. But total laundering requires quite 
> a lot https://www.sqlite.org/draft/tokenreq.html.
>
> Laundering characters like ??? for GeoNode feels too much. Who would 
> say into what characters to launder?
>
> -Jukka Rahkonen-
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Robert Hewlett via gdal-dev
> *L?hetetty:* keskiviikko 3. huhtikuuta 2024 17.51
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] LAUNDER option for geopackages
>
> Hi,
>
> Is there a?LAUNDER for geopackages?
>
> I ask this because at the following site:
>
> https://www.geopackage.org/guidance/getting-started.html
>
> Gives this specific guidance:
>
> Note: *For maximum interoperability,* start your database identifiers 
> (table names, column names, etc.) with a lowercase character and only 
> use *lowercase characters*, numbers 0-9, and underscores (_).
>
> Which then turned into a *constraint*?in GeoNode (I could not upload a 
> certain geopackage from the township of langley) where I eventually 
> discovered?in the celery logs this error:
>
> ERROR/ForkPoolWorker-958] {'validation_code': 'RQ1', 
> 'validation_description': 'Layer names must start with a letter, and 
> *valid char
> acters are lowercase a-z*, numbers or underscores.', 'level': 'error', 
> 'locations': ['Error layer: Parcel_Attributes']}
>
> I would love?LAUNDER to be a more global option.
>
> Upper for: Oracle and Shapefiles.
>
> Lower for: Postgresql, Mysql, geopackages
>
> Just wondering,
>
> Rob
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/4769d49b/attachment.htm>

From even.rouault at spatialys.com  Wed Apr  3 14:26:58 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 Apr 2024 23:26:58 +0200
Subject: [gdal-dev] discussion on xarray and the missing abstract-grid
 specification
In-Reply-To: <CAAcGz98AwG392hnmrzaqRw5Wf0Qdwi7NO7vXEvxv-+NA9nQm0g@mail.gmail.com>
References: <CAAcGz98AwG392hnmrzaqRw5Wf0Qdwi7NO7vXEvxv-+NA9nQm0g@mail.gmail.com>
Message-ID: <781daacf-756f-4c24-af21-641da203eccc@spatialys.com>

Hi,

Not that I've a strong opinion on what GeoZarr/XArray should do, but yes 
1D coordinate arrays are a bit of a pain to deal with, when they 
actually just encode a regularly spaced grid. This is something I've hit 
in the bridge between the GDAL multidimensional API (roughly netCDF 
based) and the GDAL "classic" 2D raster API, when you want to expose a 
view of a multi-dim dataset as a classic one. There's this bit of logic 
in 
https://github.com/OSGeo/gdal/blob/master/gcore/gdalmultidim.cpp#L7334 
to guess if the 1D coordinate array is regularly spaced or not. The 
netCDF driver has a similar heuristics too. This is quite error prone, 
especially if Float32 coordinates are used. There it can be difficult to 
detect if it is a regularly spaced array but Float32 hasn't sufficient 
precision to fully encode it, or if it there are genuine irregularities 
in the spacing. For Float64, the precision issues are less a practical 
error, because comparing the expected value (assuming a regular spacing) 
with the one of the 1D coordinate array with a very small relative 
epsilon, like 1e-8, is sufficient.

Even


Le 03/04/2024 ? 22:56, Michael Sumner via gdal-dev a ?crit?:
> Here's an (ahem) extremely?important discussion on the prospects for 
> xarray to extend from the coordinates-only model (like that of netcdf) 
> for geo reference:
>
> https://discourse.pangeo.io/t/example-which-highlights-the-limitations-of-netcdf-style-coordinates-for-large-geospatial-rasters/
>
> I'm heartened to see this recognized at?this?level. I think GDAL per 
> se should feature in this discussion prominently, and not just the 
> downstream Python packages that are mentioned.
>
> For my input, I'll be highlighting examples of
>
> -? degenerate rectilinear?coordinates, and the problem of whether to 
> assign a regular grid there (with a trivial lightweight Translate a la 
> -a_ullr), or to define a new regular grid and push it through the Warp 
> api, as a dataset that picks up or can be pointed to the 1D coordinate 
> arrays. This has been the crux of the issue for me, I get to decisions 
> where it's not clear what was intended or what should be done going 
> forward.
>
> - actual curvilinear?coordinates, and the very very general power of 
> that to resolve to a regular grid with very simple specification 
> (specify some or nothing of target/extent/resolution/crs/dimension). 
> Key problems here are when the coordinate arrays are not auto-detected 
> (rare) or when the longitudes are unwrapped (less rare).
>
> - that extent+dimension is complementary to the affine transform, and 
> way more user-friendly way to work with rasters for the assign and/or 
> target specification step (this is huge in R since the {raster} 
> package ca. 2009 and very well supported by Warp and Translate). It's 
> true that extent+dimension can't do shear params but it's a perfectly 
> valid way to work and flipping from transform to extent is trivial 
> numerically.
>
> I hope some more voices from this community pitch in as well, very 
> happy to discuss here or offline?about any of this.? I'm not really a 
> technical expert but I have a good overview of the landscape that GDAL 
> sits in, and I'm making similar pitches for involvement in the R 
> communities.
>
> Cheers, Mike
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240403/32e93b28/attachment-0001.htm>

From mdsumner at gmail.com  Wed Apr  3 15:03:59 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 4 Apr 2024 09:03:59 +1100
Subject: [gdal-dev] discussion on xarray and the missing abstract-grid
 specification
In-Reply-To: <781daacf-756f-4c24-af21-641da203eccc@spatialys.com>
References: <CAAcGz98AwG392hnmrzaqRw5Wf0Qdwi7NO7vXEvxv-+NA9nQm0g@mail.gmail.com>
 <781daacf-756f-4c24-af21-641da203eccc@spatialys.com>
Message-ID: <CAAcGz9-E4WoosMtyR8883Dxb8UExmJdPa7D2FNssEKQozB8ufg@mail.gmail.com>

ah thanks Even, I understand that and it was the first example that Ryan
acknowledged was a problem a while back - he'd seen the Float32 problem in
GHRSST. Excellent to get your take and the details.

I've written up a small description of how this affects GHRSST, and my
still-undecided next step to fix it (as COGs).

https://gist.github.com/mdsumner/66aac8e54b54faa24e14b63f396dca32

(this was going to be part of my pitch to xarray and now I don't need so
much extra background to make the point).

I'm keen to collate examples if people have good ones, I have plenty though
?

Cheers, Mike

On Thu, 4 Apr 2024, 08:26 Even Rouault, <even.rouault at spatialys.com> wrote:

> Hi,
>
> Not that I've a strong opinion on what GeoZarr/XArray should do, but yes
> 1D coordinate arrays are a bit of a pain to deal with, when they actually
> just encode a regularly spaced grid. This is something I've hit in the
> bridge between the GDAL multidimensional API (roughly netCDF based) and the
> GDAL "classic" 2D raster API, when you want to expose a view of a multi-dim
> dataset as a classic one. There's this bit of logic in
> https://github.com/OSGeo/gdal/blob/master/gcore/gdalmultidim.cpp#L7334 to
> guess if the 1D coordinate array is regularly spaced or not. The netCDF
> driver has a similar heuristics too. This is quite error prone, especially
> if Float32 coordinates are used. There it can be difficult to detect if it
> is a regularly spaced array but Float32 hasn't sufficient precision to
> fully encode it, or if it there are genuine irregularities in the spacing.
> For Float64, the precision issues are less a practical error, because
> comparing the expected value (assuming a regular spacing) with the one of
> the 1D coordinate array with a very small relative epsilon, like 1e-8, is
> sufficient.
>
> Even
>
>
> Le 03/04/2024 ? 22:56, Michael Sumner via gdal-dev a ?crit :
>
> Here's an (ahem) extremely important discussion on the prospects for
> xarray to extend from the coordinates-only model (like that of netcdf) for
> geo reference:
>
>
> https://discourse.pangeo.io/t/example-which-highlights-the-limitations-of-netcdf-style-coordinates-for-large-geospatial-rasters/
>
> I'm heartened to see this recognized at this level. I think GDAL per se
> should feature in this discussion prominently, and not just the downstream
> Python packages that are mentioned.
>
> For my input, I'll be highlighting examples of
>
> -  degenerate rectilinear coordinates, and the problem of whether to
> assign a regular grid there (with a trivial lightweight Translate a la
> -a_ullr), or to define a new regular grid and push it through the Warp api,
> as a dataset that picks up or can be pointed to the 1D coordinate arrays.
> This has been the crux of the issue for me, I get to decisions where it's
> not clear what was intended or what should be done going forward.
>
> - actual curvilinear coordinates, and the very very general power of that
> to resolve to a regular grid with very simple specification (specify some
> or nothing of target/extent/resolution/crs/dimension). Key problems here
> are when the coordinate arrays are not auto-detected (rare) or when the
> longitudes are unwrapped (less rare).
>
> - that extent+dimension is complementary to the affine transform, and way
> more user-friendly way to work with rasters for the assign and/or target
> specification step (this is huge in R since the {raster} package ca. 2009
> and very well supported by Warp and Translate). It's true that
> extent+dimension can't do shear params but it's a perfectly valid way to
> work and flipping from transform to extent is trivial numerically.
>
> I hope some more voices from this community pitch in as well, very happy
> to discuss here or offline about any of this.  I'm not really a technical
> expert but I have a good overview of the landscape that GDAL sits in, and
> I'm making similar pitches for involvement in the R communities.
>
> Cheers, Mike
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240404/a0cdc253/attachment.htm>

From michael.otto at data-experts.de  Thu Apr  4 06:40:18 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Thu, 4 Apr 2024 15:40:18 +0200
Subject: [gdal-dev] Unsupported HTTPAUTH value 'BEARER', ignored
Message-ID: <OF53AFCAA7.613091E3-ONC1258AF5.004AA1D0-C1258AF5.004B18F3@data-experts.de>

Hello,

I am trying to pass an authentication for requests to WFS services. As a 
test, I have activated the logging of curl and have the errors output to a 
log file.

With HTTP-Basic authentication it seems to work with the following 
parameters (no errors are logged):
'Auth' is my ArrayList to use in java processbuilder.

Auth:[[--config, GDAL_HTTP_AUTH, BASIC, --config, GDAL_HTTP_USERPWD, 
username:password]]

But try this for Bearer :
Auth:[[--config, GDAL_HTTP_AUTH, BEARER, --config, GDAL_HTTP_BEARER, 
token]]

I get the following error in the error log:
Warning 1: Unsupported HTTPAUTH value 'BEARER', ignored.


What am I doing wrong and what can I do so that Bearer authentication is 
also accepted?
Can I use curl paramters directly instead?

Michael


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240404/465c8d64/attachment.htm>

From even.rouault at spatialys.com  Thu Apr  4 07:14:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 4 Apr 2024 16:14:59 +0200
Subject: [gdal-dev] Unsupported HTTPAUTH value 'BEARER', ignored
In-Reply-To: <OF53AFCAA7.613091E3-ONC1258AF5.004AA1D0-C1258AF5.004B18F3@data-experts.de>
References: <OF53AFCAA7.613091E3-ONC1258AF5.004AA1D0-C1258AF5.004B18F3@data-experts.de>
Message-ID: <98697203-3b3d-4bb8-8d39-e7069b86b48f@spatialys.com>

Hi,

GDAL_HTTP_AUTH=BEARER support has been added in master / GDAL 3.9dev 
only (I've just fixed an erroneous statement about it being in 3.8)

In earlier versions, you can try setting 
GDAL_HTTP_HEADERS="Authentication: Bearer {your_token_here}"

Even

Le 04/04/2024 ? 15:40, Michael Otto via gdal-dev a ?crit?:
> Hello,
>
> I am trying to pass an authentication for requests to WFS services. As 
> a test, I have activated the logging of curl and have the errors 
> output to a log file.
>
> With HTTP-Basic authentication it seems to work with the following 
> parameters (no errors are logged):
> 'Auth' is my ArrayList to use in java processbuilder.
>
> Auth:[[--config, GDAL_HTTP_AUTH, BASIC, --config, GDAL_HTTP_USERPWD, 
> username:password]]
>
> But try this for Bearer :
> Auth:[[--config, GDAL_HTTP_AUTH, BEARER, --config, GDAL_HTTP_BEARER, 
> token]]
>
> I get the following error in the error log:
> Warning 1: Unsupported HTTPAUTH value 'BEARER', ignored.
>
>
> What am I doing wrong and what can I do so that Bearer authentication 
> is also accepted?
> Can I use curl paramters directly instead?
>
> Michael
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240404/a4da2977/attachment.htm>

From even.rouault at spatialys.com  Thu Apr  4 10:04:42 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 4 Apr 2024 19:04:42 +0200
Subject: [gdal-dev] GDAL 3.8.5RC1 available, and motion to adopt it
In-Reply-To: <33e059de-53c4-434b-a0a1-0cfe3d197b70@spatialys.com>
References: <33e059de-53c4-434b-a0a1-0cfe3d197b70@spatialys.com>
Message-ID: <bd71760b-b043-4b11-90c2-d2436a989149@spatialys.com>

Hi,

motion passed with +1 from PSC members EvenR, JukkaR, HowardB and JavierJS

Even

Le 02/04/2024 ? 12:16, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I have prepared a GDAL/OGR 3.8.5 release candidate. This is likely to 
> be the
> last bug fix release in the 3.8.x series, with 3.9.0 coming beginning 
> of May.
>
> Pick up an archive among the following ones (by ascending size):
>
> ? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5rc1.tar.xz
> ? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.8.5/gdal385rc1.zip
>
> A snapshot of the gdalautotest suite is also available:
>
> https://download.osgeo.org/gdal/3.8.5/gdalautotest-3.8.5rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.8.5/gdalautotest-3.8.5rc1.zip
>
> The NEWS file is here:
>
> ? https://github.com/OSGeo/gdal/blob/v3.8.5RC1/NEWS.md
>
> Motion: adopt 3.8.5RC1 as final 3.8.5
>
> Starting with my +1
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Apr  4 10:58:16 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 4 Apr 2024 19:58:16 +0200
Subject: [gdal-dev] GDAL 3.8.5 is released
Message-ID: <5861e03f-a5ae-439e-bd48-2a0e9ef1b94c@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the 
release of the GDAL/OGR 3.8.5 bug fix version. This is the last one 
planned in the 3.8.x series, with the forthcoming 3.9.0 released planned 
for the beginning of May.

Consult the release notes for the list of issues addressed:
 ??? https://github.com/OSGeo/gdal/blob/v3.8.5/NEWS.md

The sources are available at:

 ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.xz
 ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.xz.md5
 ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.xz.sig

or

 ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.gz
 ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.gz.md5
 ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.gz.sig

or

 ??? https://download.osgeo.org/gdal/3.8.5/gdal385.zip
 ??? https://download.osgeo.org/gdal/3.8.5/gdal385.zip.md5
 ??? https://download.osgeo.org/gdal/3.8.5/gdal385.zip.sig

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From bontepaarden at gmail.com  Fri Apr  5 01:27:09 2024
From: bontepaarden at gmail.com (Paul Meems)
Date: Fri, 5 Apr 2024 10:27:09 +0200
Subject: [gdal-dev] gdal_contour: min value unexpected
Message-ID: <CAHNf2YQZ-5BuuMz7=FNkudA7hALeiL4X40izZYfc0gGLNvDHMA@mail.gmail.com>

Hello List,

I have a Surfer grid which I want to convert into polygons using
gdal_contour.
The min value of the lowest polygon is 0 which I didn't expect.
In the next step, I calculate the average of the min and max values, and in
this case that average is wrong.

These are the values of the grid:
Grid Size (X*Y):       113 x 121
NoData Value:          1.70141E+38
Minimum:               105000
Maximum:               133000

This is my command:
gdal_contour -p -f "ESRI Shapefile" -fl -97000 -37000 23000 83000 89000
95000 101000 107000 113650 121000 129000 137000 143000 149000 155000 215000
275000 335000 -amin Min -amax Max "Surfer.grd" "tmp3p4f4i.shp"

As you can see, the lowest value of the grid (105000) is between the values
101000 and 107000.
So I would expect to have the min value of the shapefile be 101000 and the
max value 107000.

But the result is:
[image: image.png]
Min is 0 and max is 107000.

I also tried setting the lowest value of the grid to 107000 (one of the
level values) but that also resulted in a min value of 0.

The polygons themselves are OK, just the min value of the lowest value is
incorrect.

I'm using GDAL 3.6.3, released 2023/03/07 on Windows.

Why is this happening?
Do I need to set an additional argument?

Please advise.

With regards,

Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240405/6b8bc245/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 5407 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240405/6b8bc245/attachment.png>

From michael.otto at data-experts.de  Fri Apr  5 02:28:29 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Fri, 5 Apr 2024 11:28:29 +0200
Subject: [gdal-dev] Antwort: Re:  Unsupported HTTPAUTH value 'BEARER',
 ignored
In-Reply-To: <98697203-3b3d-4bb8-8d39-e7069b86b48f@spatialys.com>
References: <OF53AFCAA7.613091E3-ONC1258AF5.004AA1D0-C1258AF5.004B18F3@data-experts.de>
 <98697203-3b3d-4bb8-8d39-e7069b86b48f@spatialys.com>
Message-ID: <OF337BADBD.6F686402-ONC1258AF6.0033C671-C1258AF6.00340ACC@data-experts.de>

Hello Even,

Your proposed solution (for version 3.8) seems to work.
Thank you very much.

Michael




Von:    "Even Rouault" <even.rouault at spatialys.com>
An:     "Michael Otto" <michael.otto at data-experts.de>, 
gdal-dev at lists.osgeo.org
Datum:  04.04.2024 16:15
Betreff:        Re: [gdal-dev] Unsupported HTTPAUTH value 'BEARER', 
ignored



Hi,
GDAL_HTTP_AUTH=BEARER support has been added in master / GDAL 3.9dev only 
(I've just fixed an erroneous statement about it being in 3.8)
In earlier versions, you can try setting 
GDAL_HTTP_HEADERS="Authentication: Bearer {your_token_here}"
Even
Le 04/04/2024 ? 15:40, Michael Otto via gdal-dev a ?crit :
Hello,

I am trying to pass an authentication for requests to WFS services. As a 
test, I have activated the logging of curl and have the errors output to a 
log file.

With HTTP-Basic authentication it seems to work with the following 
parameters (no errors are logged):
'Auth' is my ArrayList to use in java processbuilder.

Auth:[[--config, GDAL_HTTP_AUTH, BASIC, --config, GDAL_HTTP_USERPWD, 
username:password]]

But try this for Bearer :
Auth:[[--config, GDAL_HTTP_AUTH, BEARER, --config, GDAL_HTTP_BEARER, 
token]]

I get the following error in the error log:
Warning 1: Unsupported HTTPAUTH value 'BEARER', ignored.


What am I doing wrong and what can I do so that Bearer authentication is 
also accepted?
Can I use curl paramters directly instead?

Michael


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240405/04f27536/attachment.htm>

From even.rouault at spatialys.com  Fri Apr  5 03:37:22 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 5 Apr 2024 12:37:22 +0200
Subject: [gdal-dev] GDAL 3.8.5 is released
In-Reply-To: <5861e03f-a5ae-439e-bd48-2a0e9ef1b94c@spatialys.com>
References: <5861e03f-a5ae-439e-bd48-2a0e9ef1b94c@spatialys.com>
Message-ID: <312c07da-25cc-46f9-9b01-fcd020fd0336@spatialys.com>

The corresponding Docker images are now available: 
https://github.com/OSGeo/gdal/tree/master/docker#images-of-releases

Le 04/04/2024 ? 19:58, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> On behalf of the GDAL/OGR development team, I am pleased to announce 
> the release of the GDAL/OGR 3.8.5 bug fix version. This is the last 
> one planned in the 3.8.x series, with the forthcoming 3.9.0 released 
> planned for the beginning of May.
>
> Consult the release notes for the list of issues addressed:
> ??? https://github.com/OSGeo/gdal/blob/v3.8.5/NEWS.md
>
> The sources are available at:
>
> ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.xz
> ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.xz.md5
> ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.xz.sig
>
> or
>
> ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.gz
> ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.gz.md5
> ??? https://download.osgeo.org/gdal/3.8.5/gdal-3.8.5.tar.gz.sig
>
> or
>
> ??? https://download.osgeo.org/gdal/3.8.5/gdal385.zip
> ??? https://download.osgeo.org/gdal/3.8.5/gdal385.zip.md5
> ??? https://download.osgeo.org/gdal/3.8.5/gdal385.zip.sig
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From stephenwoodbridge37 at gmail.com  Fri Apr 12 14:24:21 2024
From: stephenwoodbridge37 at gmail.com (Stephen Woodbridge)
Date: Fri, 12 Apr 2024 17:24:21 -0400
Subject: [gdal-dev] How do I add a projection to proj 8?
Message-ID: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>

Hi all,

I've been gone for a while, but got called back to update a site I built 
and need to move from proj4 to proj 8 on Ubuntu 22.04. In the past I 
just added the following to /usr/share/proj/epsg

# HYCOM Mercator projection
<900914> +proj=merc +a=6371001 +b=6371001 +lat_ts=0.0 +lon_0=0.0 
+x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null +no_defs? <>

and was able to access it in gdal, mapserver, postgis, etc with 
"EPSG:900914"

How does one do that with the new system?

Thanks,
 ? -Steve W

-- 
This email has been checked for viruses by Avast antivirus software.
www.avast.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240412/2368a7f5/attachment.htm>

From sebastic at xs4all.nl  Fri Apr 12 21:17:45 2024
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Sat, 13 Apr 2024 06:17:45 +0200
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
Message-ID: <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>

On 4/12/24 11:24 PM, Stephen Woodbridge via gdal-dev wrote:
> and was able to access it in gdal, mapserver, postgis, etc with 
> "EPSG:900914"

I used to do that too, but switched to EPSG:3857 its non-deprecated 
equivalent. I would recommend that instead of trying to keep using a 
non-standard projection.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1


From j1 at jimenezshaw.com  Sat Apr 13 01:19:28 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sat, 13 Apr 2024 10:19:28 +0200
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
 <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>
Message-ID: <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>

If what you need is really EPSG:3857, yes, use it.

However I have seen strange parameters on your projection. The radius of
the sphere is the "average" 3671 km, and you set a false easting and
northing of just 4.4 km. Is that trying to correct the radius of the
sphere? I do not know why you need that.

Bas, are they really equivalent?

In proj you can convert to WKT1 (see that I added +type=crs):

projinfo "+proj=merc +a=6371001 +b=6371001 +lat_ts=0.0 +lon_0=0.0
+x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null +no_defs
 +type=crs" -o wkt1_gdal


On Sat, 13 Apr 2024 at 06:17, Sebastiaan Couwenberg via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> On 4/12/24 11:24 PM, Stephen Woodbridge via gdal-dev wrote:
> > and was able to access it in gdal, mapserver, postgis, etc with
> > "EPSG:900914"
>
> I used to do that too, but switched to EPSG:3857 its non-deprecated
> equivalent. I would recommend that instead of trying to keep using a
> non-standard projection.
>
> Kind Regards,
>
> Bas
>
> --
>   GPG Key ID: 4096R/6750F10AE88D4AF1
> Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240413/f35def36/attachment.htm>

From sebastic at xs4all.nl  Sat Apr 13 02:12:47 2024
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Sat, 13 Apr 2024 11:12:47 +0200
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
 <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>
 <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>
Message-ID: <cdad8b41-ca5f-4035-b1d4-e706c4fc9e53@xs4all.nl>

On 4/13/24 10:19 AM, Javier Jimenez Shaw via gdal-dev wrote:
> Bas, are they really equivalent?
As far as I know they are, where one used to use EPSG:900913 they should 
now be using EPSG:3857, as 900913 is deprecated.

  https://wiki.openstreetmap.org/wiki/Web_Mercator

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1


From j1 at jimenezshaw.com  Sat Apr 13 03:00:43 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sat, 13 Apr 2024 12:00:43 +0200
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <cdad8b41-ca5f-4035-b1d4-e706c4fc9e53@xs4all.nl>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
 <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>
 <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>
 <cdad8b41-ca5f-4035-b1d4-e706c4fc9e53@xs4all.nl>
Message-ID: <CADRrdKui1gB1Z4+DFwjWM1E1fFsSmfaJVfeC2xiMotEMqEiEQw@mail.gmail.com>

Yes, such CRS was used until EPSG:3857 was added
(900913 tries to mimic Google letters with numbers, as it was used by
google maps).

But the parameters given by Stephen are a bit different. Probably that's
why the number ends with 4

You can see the (deprecated) proj4 string of 900913 at
https://spatialreference.org/ref/epsg/900913/proj4.txt

On Sat, 13 Apr 2024 at 11:12, Sebastiaan Couwenberg via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> On 4/13/24 10:19 AM, Javier Jimenez Shaw via gdal-dev wrote:
> > Bas, are they really equivalent?
> As far as I know they are, where one used to use EPSG:900913 they should
> now be using EPSG:3857, as 900913 is deprecated.
>
>   https://wiki.openstreetmap.org/wiki/Web_Mercator
>
> Kind Regards,
>
> Bas
>
> --
>   GPG Key ID: 4096R/6750F10AE88D4AF1
> Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240413/95d5854e/attachment.htm>

From stephenwoodbridge37 at gmail.com  Sat Apr 13 08:35:56 2024
From: stephenwoodbridge37 at gmail.com (Stephen Woodbridge)
Date: Sat, 13 Apr 2024 11:35:56 -0400
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
 <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>
 <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>
Message-ID: <ffa22891-1032-41ca-98c5-f95e462d89ef@gmail.com>

Thanks, this is NOT the standard Web Mercator projection. I am aware of 
EPSG:90013 and EPSG:3857. This projection is used with HYCOM data that I 
have extracted into geotif files so that I can accurately project that 
onto EPSG:3857. It took some fiddling with the values to get to overlay 
visually correctly. HYCOM data is weird in that it uses two different 
projections based on if the data is above or below some latitude.

On 4/13/2024 4:19 AM, Javier Jimenez Shaw via gdal-dev wrote:
> If what you need is really EPSG:3857, yes, use it.
>
> However I have seen strange parameters on your projection. The radius 
> of the sphere is the "average" 3671 km, and you set a false easting 
> and northing of just 4.4 km. Is that trying to correct the radius of 
> the sphere? I do not know why you need that.
>
> Bas, are they really equivalent?
>
> In proj you can convert to WKT1 (see that I added +type=crs):
>
> projinfo "+proj=merc +a=6371001 +b=6371001 +lat_ts=0.0 +lon_0=0.0 
> +x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null +no_defs 
> ?+type=crs" -o wkt1_gdal
>
Ok I get this adding by +type=crs but how do I add it to the proj 
database so I can access it referencing it by something like EPSG:90014?

Thanks,
 ? -Steve
>
> On Sat, 13 Apr 2024 at 06:17, Sebastiaan Couwenberg via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>     On 4/12/24 11:24 PM, Stephen Woodbridge via gdal-dev wrote:
>     > and was able to access it in gdal, mapserver, postgis, etc with
>     > "EPSG:900914"
>
>     I used to do that too, but switched to EPSG:3857 its non-deprecated
>     equivalent. I would recommend that instead of trying to keep using a
>     non-standard projection.
>
>     Kind Regards,
>
>     Bas
>
>     -- 
>     ? GPG Key ID: 4096R/6750F10AE88D4AF1
>     Fingerprint: 8182 DE41 7056 408D 6146? 50D1 6750 F10A E88D 4AF1
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
This email has been checked for viruses by Avast antivirus software.
www.avast.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240413/ed315545/attachment-0001.htm>

From j1 at jimenezshaw.com  Sat Apr 13 10:26:52 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sat, 13 Apr 2024 19:26:52 +0200
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <ffa22891-1032-41ca-98c5-f95e462d89ef@gmail.com>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
 <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>
 <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>
 <ffa22891-1032-41ca-98c5-f95e462d89ef@gmail.com>
Message-ID: <CADRrdKuUTakXNL0srxBBEu4QAFB+6BBsLHM8R7ynf9ZO-GwZJw@mail.gmail.com>

On Sat, 13 Apr 2024 at 17:35, Stephen Woodbridge via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Thanks, this is NOT the standard Web Mercator projection. I am aware of
> EPSG:90013 and EPSG:3857. This projection is used with HYCOM data that I
> have extracted into geotif files so that I can accurately project that onto
> EPSG:3857. It took some fiddling with the values to get to overlay visually
> correctly. HYCOM data is weird in that it uses two different projections
> based on if the data is above or below some latitude.
>
I found something like that in the Internet. But I was not sure it was the
right one https://polar.ncep.noaa.gov/global/about/ It didn't specify the
projections, just a short description as Arctic bi-polar patch north of
47N, and Mercator south of it.

I do not know if you can specify a projection "in parts" respect to
parallel 47. Maybe in WKT2.

Where did you found those parameters for the datum and projection? They are
quite strange.

For the ellipsoid there are a few already with a similar radius:

SELECT * from ellipsoid where semi_major_axis BETWEEN 6371000 and 6371010

EPSG 7035 Sphere
PROJ EARTH 6371000.0 EPSG 9001
6371000.0 1
EPSG 7048 GRS 1980 Authalic Sphere
PROJ EARTH 6371007.0 EPSG 9001
6371007.0 0
ESRI 107047 Sphere_GRS_1980_Mean_Radius Sphere with mean radius based on
GRS80 PROJ EARTH 6371008.7714 EPSG 9001 0.0
0

And datums

SELECT * from geodetic_datum where ellipsoid_code in (7035, 7048, 107047)

EPSG 6035 Not specified (based on Authalic Sphere)
EPSG 7035 EPSG 8901




1
EPSG 6047 Not specified (based on GRS 1980 Authalic Sphere)
EPSG 7048 EPSG 8901




1
ESRI 106047 D_Sphere_GRS_1980_Mean_Radius GRS 1980 Mean Radius Sphere ESRI
107047 EPSG 8901




0

and geographic crs

SELECT * from geodetic_crs where datum_code in (6035, 6047, 106047)

EPSG 4035 Unknown datum based upon the Authalic Sphere
geographic 2D EPSG 6402 EPSG 6035
1
EPSG 4047 Unspecified datum based upon the GRS 1980 Authalic Sphere
geographic 2D EPSG 6422 EPSG 6047
1
ESRI 104047 GCS_Sphere_GRS_1980_Mean_Radius
geographic 2D EPSG 6422 ESRI 106047
0

See that EPSG ones are deprecated. (surprisingly the ellipsoid EPSG:7048 is
not deprecated, but the datum that uses it is deprecated).

On 4/13/2024 4:19 AM, Javier Jimenez Shaw via gdal-dev wrote:
>
> If what you need is really EPSG:3857, yes, use it.
>
> However I have seen strange parameters on your projection. The radius of
> the sphere is the "average" 3671 km, and you set a false easting and
> northing of just 4.4 km. Is that trying to correct the radius of the
> sphere? I do not know why you need that.
>
> Bas, are they really equivalent?
>
> In proj you can convert to WKT1 (see that I added +type=crs):
>
> projinfo "+proj=merc +a=6371001 +b=6371001 +lat_ts=0.0 +lon_0=0.0
> +x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null +no_defs
>  +type=crs" -o wkt1_gdal
>
> Ok I get this adding by +type=crs but how do I add it to the proj
> database so I can access it referencing it by something like EPSG:90014?
>
>
Is a WKT string enough?

PROJCS["unknown",
    GEOGCS["unknown",
        DATUM["unknown using nadgrids=@null",
            SPHEROID["unknown",6371001,0]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]]],
    PROJECTION["Mercator_1SP"],
    PARAMETER["central_meridian",0],
    PARAMETER["scale_factor",1],
    PARAMETER["false_easting",-4448],
    PARAMETER["false_northing",-4448],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["Easting",EAST],
    AXIS["Northing",NORTH],
    EXTENSION["PROJ4","+proj=merc +a=6371001 +b=6371001 +lat_ts=0.0
+lon_0=0.0 +x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null
+no_defs"]]

(generated with the projinfo line from prev email) Using a geographic CRS
as described above will make it nicer, and probably more compatible.

You can use it in QGIS for instance. I am not sure how does it behave in a
GeoTIFF, as it has some special tags. You can try to generate the geotiff
with gdal with that WKT, and see that happens.

About adding to proj.db as EPSG:900914, I am not sure of all the steps. But
I would say that you have to create a datum and a geographic crs (or use
one of the above), in addition to the projection (conversion, parameters,
etc) and the projected crs. And then "compile" the database.
Is it worth it?
In case you modify proj.db, instead of using EPSG, you can create your own
authority, or use "PROJ" authority. It will be cleaner.



> Thanks,
>   -Steve
>
>
> On Sat, 13 Apr 2024 at 06:17, Sebastiaan Couwenberg via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> On 4/12/24 11:24 PM, Stephen Woodbridge via gdal-dev wrote:
>> > and was able to access it in gdal, mapserver, postgis, etc with
>> > "EPSG:900914"
>>
>> I used to do that too, but switched to EPSG:3857 its non-deprecated
>> equivalent. I would recommend that instead of trying to keep using a
>> non-standard projection.
>>
>> Kind Regards,
>>
>> Bas
>>
>> --
>>   GPG Key ID: 4096R/6750F10AE88D4AF1
>> Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient>
> Virus-free.www.avast.com
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient>
> <#m_-2289715080308317683_DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240413/ca2abc89/attachment-0001.htm>

From stephenwoodbridge37 at gmail.com  Sat Apr 13 12:20:00 2024
From: stephenwoodbridge37 at gmail.com (Stephen Woodbridge)
Date: Sat, 13 Apr 2024 15:20:00 -0400
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <CADRrdKuUTakXNL0srxBBEu4QAFB+6BBsLHM8R7ynf9ZO-GwZJw@mail.gmail.com>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
 <9f90b0f7-afc9-4280-b7de-df86e22919a3@xs4all.nl>
 <CADRrdKtReQ_1eKnF-k8w_wm_+XDpWb2Vux4=F13Q3xizCKjRmw@mail.gmail.com>
 <ffa22891-1032-41ca-98c5-f95e462d89ef@gmail.com>
 <CADRrdKuUTakXNL0srxBBEu4QAFB+6BBsLHM8R7ynf9ZO-GwZJw@mail.gmail.com>
Message-ID: <81e85757-c476-4a43-a70f-d88a2c5080d6@gmail.com>

On 4/13/2024 1:26 PM, Javier Jimenez Shaw wrote:
>
> On Sat, 13 Apr 2024 at 17:35, Stephen Woodbridge via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>     Thanks, this is NOT the standard Web Mercator projection. I am
>     aware of EPSG:90013 and EPSG:3857. This projection is used with
>     HYCOM data that I have extracted into geotif files so that I can
>     accurately project that onto EPSG:3857. It took some fiddling with
>     the values to get to overlay visually correctly. HYCOM data is
>     weird in that it uses two different projections based on if the
>     data is above or below some latitude.
>
> I found something like that in the Internet. But I was not sure it was 
> the right one https://polar.ncep.noaa.gov/global/about/ It didn't 
> specify the projections, just a short description as Arctic bi-polar 
> patch north of 47N, and Mercator south of it.

Yes this what is happening with the HYCOM data. The projection 
definition in PROJ4 worked quite well for my case of web mapping in 
mapserver.
>
> I do not know if you can specify a projection "in parts" respect to 
> parallel 47. Maybe in WKT2.
>
> Where did you found those parameters for the datum and projection? 
> They are quite strange.
>
> For the ellipsoid there are a few already with a similar radius:
>
> SELECT * from ellipsoid where semi_major_axis BETWEEN 6371000 and 6371010
>
> EPSG 	7035 	Sphere 	
> 	PROJ 	EARTH 	6371000.0 	EPSG 	9001 	
> 	6371000.0 	1
> EPSG 	7048 	GRS 1980 Authalic Sphere 	
> 	PROJ 	EARTH 	6371007.0 	EPSG 	9001 	
> 	6371007.0 	0
> ESRI 	107047 	Sphere_GRS_1980_Mean_Radius 	Sphere with mean radius 
> based on GRS80 	PROJ 	EARTH 	6371008.7714 	EPSG 	9001 	0.0 	
> 	0
>
>
> And datums
>
> SELECT * from geodetic_datum where ellipsoid_code in (7035, 7048, 107047)
>
> EPSG 	6035 	Not specified (based on Authalic Sphere) 	
> 	EPSG 	7035 	EPSG 	8901 	
> 	
> 	
> 	
> 	
> 	1
> EPSG 	6047 	Not specified (based on GRS 1980 Authalic Sphere) 	
> 	EPSG 	7048 	EPSG 	8901 	
> 	
> 	
> 	
> 	
> 	1
> ESRI 	106047 	D_Sphere_GRS_1980_Mean_Radius 	GRS 1980 Mean Radius 
> Sphere 	ESRI 	107047 	EPSG 	8901 	
> 	
> 	
> 	
> 	
> 	0
>
>
> and geographic crs
>
> SELECT * from geodetic_crs where datum_code in (6035, 6047, 106047)
>
> EPSG 	4035 	Unknown datum based upon the Authalic Sphere 	
> 	geographic 2D 	EPSG 	6402 	EPSG 	6035 	
> 	1
> EPSG 	4047 	Unspecified datum based upon the GRS 1980 Authalic Sphere 	
> 	geographic 2D 	EPSG 	6422 	EPSG 	6047 	
> 	1
> ESRI 	104047 	GCS_Sphere_GRS_1980_Mean_Radius 	
> 	geographic 2D 	EPSG 	6422 	ESRI 	106047 	
> 	0
>
> See that EPSG ones are deprecated. (surprisingly the ellipsoid 
> EPSG:7048 is not deprecated, but the datum that uses it is deprecated).
>
>     On 4/13/2024 4:19 AM, Javier Jimenez Shaw via gdal-dev wrote:
>>     If what you need is really EPSG:3857, yes, use it.
>>
>>     However I have seen strange parameters on your projection. The
>>     radius of the sphere is the "average" 3671 km, and you set a
>>     false easting and northing of just 4.4 km. Is that trying to
>>     correct the radius of the sphere? I do not know why you need that.
>>
>>     Bas, are they really equivalent?
>>
>>     In proj you can convert to WKT1 (see that I added +type=crs):
>>
>>     projinfo "+proj=merc +a=6371001 +b=6371001 +lat_ts=0.0 +lon_0=0.0
>>     +x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null
>>     +no_defs ?+type=crs" -o wkt1_gdal
>>
>     Ok I get this adding by +type=crs but how do I add it to the proj
>     database so I can access it referencing it by something like
>     EPSG:90014?
>
>
> Is a WKT string enough?
>
> PROJCS["unknown",
> ? ? GEOGCS["unknown",
> ? ? ? ? DATUM["unknown using nadgrids=@null",
> ? ? ? ? ? ? SPHEROID["unknown",6371001,0]],
> ? ? ? ? PRIMEM["Greenwich",0,
> ? ? ? ? ? ? AUTHORITY["EPSG","8901"]],
> ? ? ? ? UNIT["degree",0.0174532925199433,
> ? ? ? ? ? ? AUTHORITY["EPSG","9122"]]],
> ? ? PROJECTION["Mercator_1SP"],
> ? ? PARAMETER["central_meridian",0],
> ? ? PARAMETER["scale_factor",1],
> ? ? PARAMETER["false_easting",-4448],
> ? ? PARAMETER["false_northing",-4448],
> ? ? UNIT["metre",1,
> ? ? ? ? AUTHORITY["EPSG","9001"]],
> ? ? AXIS["Easting",EAST],
> ? ? AXIS["Northing",NORTH],
> ? ? EXTENSION["PROJ4","+proj=merc +a=6371001 +b=6371001 +lat_ts=0.0 
> +lon_0=0.0 +x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null 
> +no_defs"]]
>
> (generated with the projinfo line from prev email) Using a geographic 
> CRS as described above will make it nicer, and probably more compatible.
>
> You can use it in QGIS for instance. I am not sure how does it behave 
> in a GeoTIFF, as it has some special tags. You can try to generate the 
> geotiff with gdal with that WKT, and see that happens.
>
> About adding to proj.db as EPSG:900914, I am not sure of all the 
> steps. But I would say that you have to create a datum and a 
> geographic crs (or use one of the above), in addition to the 
> projection (conversion, parameters, etc) and the projected crs. And 
> then "compile" the database.
> Is it worth it?
> In case you modify proj.db, instead of using EPSG, you can create your 
> own authority, or use "PROJ" authority. It will be cleaner.
>
Ok, thanks, I think I can work with this information. I appreciate the 
help.
I'm also considering rewriting the extraction utility to totally avoid 
using this projection. This might be the better choice long term.

Thanks,
 ? -Steve
>
>     Thanks,
>     ? -Steve
>>
>>     On Sat, 13 Apr 2024 at 06:17, Sebastiaan Couwenberg via gdal-dev
>>     <gdal-dev at lists.osgeo.org> wrote:
>>
>>         On 4/12/24 11:24 PM, Stephen Woodbridge via gdal-dev wrote:
>>         > and was able to access it in gdal, mapserver, postgis, etc
>>         with
>>         > "EPSG:900914"
>>
>>         I used to do that too, but switched to EPSG:3857 its
>>         non-deprecated
>>         equivalent. I would recommend that instead of trying to keep
>>         using a
>>         non-standard projection.
>>
>>         Kind Regards,
>>
>>         Bas
>>
>>         -- 
>>         ? GPG Key ID: 4096R/6750F10AE88D4AF1
>>         Fingerprint: 8182 DE41 7056 408D 6146? 50D1 6750 F10A E88D 4AF1
>>
>>         _______________________________________________
>>         gdal-dev mailing list
>>         gdal-dev at lists.osgeo.org
>>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>     <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient>
>     	Virus-free.www.avast.com
>     <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient>
>
>
>     <#m_-2289715080308317683_DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
This email has been checked for viruses by Avast antivirus software.
www.avast.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240413/26f47e8b/attachment-0001.htm>

From aborruso at gmail.com  Sun Apr 14 03:03:02 2024
From: aborruso at gmail.com (andy)
Date: Sun, 14 Apr 2024 12:03:02 +0200
Subject: [gdal-dev] Is there a GDAL way to use a WPS service?
Message-ID: <CAHEdGZP4RExs1m5OyTYHT3r6j4ND9zGC7m4ij_y_PW05uvxTFQ@mail.gmail.com>

Hi,
I would like to test a WPS to run coordinate conversion, And I don't know
if there is a way to do it with GDAL.

If there is not, is there a cli tool with which to do it?

Thank you,

Andrea

P.S. if there's no cli, I will use owslib via python

-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240414/b1de9b91/attachment.htm>

From even.rouault at spatialys.com  Sun Apr 14 04:03:11 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 14 Apr 2024 13:03:11 +0200
Subject: [gdal-dev] How do I add a projection to proj 8?
In-Reply-To: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
References: <e6200a06-edb6-408c-b53c-43b723142bb4@gmail.com>
Message-ID: <42d3f277-7c50-44b7-bdbd-9e490b6490e9@spatialys.com>

Stephen,

there are 2 possiblities:

- you may reuse your modified /usr/share/proj/epsg file from PROJ.4. But 
in this case, the EPSG entries of proj.db will not be used, so you will 
use only legacy CRS and transformations

- or you add a custom entry in proj.db

For the later, the following will output SQL statements that should be 
put in the DB, but they need a bit of tweaking given that the logic that 
suggests the SQL statements try to set a "proper" CRS definition which 
lacks the PROJ.4 +over or +nadgrids=@null hack

projinfo --output-id EPSG:900914 -o SQL -q "+proj=merc +a=6371001 
+b=6371001 +lat_ts=0.0 +lon_0=0.0 +x_0=-4448 +y_0=-4448 +k=1.0 +units=m 
+over +nadgrids=@null +no_defs +type=crs"

With a bit of hand tuning, if you run the following statements in your 
proj.db,

INSERT INTO ellipsoid 
VALUES('EPSG','ELLPS_GEODETIC_DATUM_GEODETIC_CRS_900914','unknown','','IAU_2015','399',6371001,'EPSG','9001',NULL,6371001,0);
INSERT INTO geodetic_datum 
VALUES('EPSG','GEODETIC_DATUM_GEODETIC_CRS_900914','unknown using 
nadgrids=@null','','EPSG','ELLPS_GEODETIC_DATUM_GEODETIC_CRS_900914','EPSG','8901',NULL,NULL,NULL,NULL,NULL,0);
INSERT INTO usage 
VALUES('EPSG','USAGE_GEODETIC_DATUM_GEODETIC_CRS_900914','geodetic_datum','EPSG','GEODETIC_DATUM_GEODETIC_CRS_900914','PROJ','EXTENT_UNKNOWN','PROJ','SCOPE_UNKNOWN');
INSERT INTO geodetic_crs 
VALUES('EPSG','GEODETIC_CRS_900914','unknown','','geographic 
2D','EPSG','6424','EPSG','GEODETIC_DATUM_GEODETIC_CRS_900914',NULL,0);
INSERT INTO usage 
VALUES('EPSG','USAGE_GEODETIC_CRS_900914','geodetic_crs','EPSG','GEODETIC_CRS_900914','PROJ','EXTENT_UNKNOWN','PROJ','SCOPE_UNKNOWN');
INSERT INTO projected_crs VALUES('EPSG','900914','unknown 
(900914)','',NULL,NULL,'EPSG','GEODETIC_CRS_900914',NULL,NULL,'+proj=merc 
+a=6371001 +b=6371001 +lat_ts=0.0 +lon_0=0.0 +x_0=-4448 +y_0=-4448 
+k=1.0 +units=m +over +nadgrids=@null +no_defs',0);
INSERT INTO usage 
VALUES('EPSG','USAGE_PROJECTED_CRS_900914','projected_crs','EPSG','900914','PROJ','EXTENT_UNKNOWN','PROJ','SCOPE_UNKNOWN');

you'll get:

PROJ_DATA=/tmp bin/projinfo EPSG:900914
PROJ.4 string:
+proj=merc +a=6371001 +b=6371001 +lat_ts=0 +lon_0=0 +x_0=-4448 
+y_0=-4448 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs

WKT2:2019 string:
PROJCRS["unknown (900914)",
 ??? BASEGEOGCRS["unknown",
 ??????? DATUM["unknown using nadgrids=@null",
 ??????????? ELLIPSOID["unknown",6371001,0,
 ??????????????? LENGTHUNIT["metre",1]]],
 ??????? PRIMEM["Greenwich",0,
 ??????????? ANGLEUNIT["degree",0.0174532925199433]]],
 ??? CONVERSION["unknown",
 ??????? METHOD["Popular Visualisation Pseudo Mercator",
 ??????????? ID["EPSG",1024]],
 ??????? PARAMETER["Latitude of natural origin",0,
 ??????????? ANGLEUNIT["degree",0.0174532925199433],
 ??????????? ID["EPSG",8801]],
 ??????? PARAMETER["Longitude of natural origin",0,
 ??????????? ANGLEUNIT["degree",0.0174532925199433],
 ??????????? ID["EPSG",8802]],
 ??????? PARAMETER["False easting",-4448,
 ??????????? LENGTHUNIT["metre",1],
 ??????????? ID["EPSG",8806]],
 ??????? PARAMETER["False northing",-4448,
 ??????????? LENGTHUNIT["metre",1],
 ??????????? ID["EPSG",8807]]],
 ??? CS[Cartesian,2],
 ??????? AXIS["(E)",east,
 ??????????? ORDER[1],
 ??????????? LENGTHUNIT["metre",1]],
 ??????? AXIS["(N)",north,
 ??????????? ORDER[2],
 ??????????? LENGTHUNIT["metre",1]],
 ??? ID["EPSG",900914]]

Even

Le 12/04/2024 ? 23:24, Stephen Woodbridge via gdal-dev a ?crit?:
> Hi all,
>
> I've been gone for a while, but got called back to update a site I 
> built and need to move from proj4 to proj 8 on Ubuntu 22.04. In the 
> past I just added the following to /usr/share/proj/epsg
>
> # HYCOM Mercator projection
> <900914> +proj=merc +a=6371001 +b=6371001 +lat_ts=0.0 +lon_0=0.0 
> +x_0=-4448 +y_0=-4448 +k=1.0 +units=m +over +nadgrids=@null +no_defs? <>
>
> and was able to access it in gdal, mapserver, postgis, etc with 
> "EPSG:900914"
>
> How does one do that with the new system?
>
> Thanks,
> ? -Steve W
>
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient> 
> 	Virus-free.www.avast.com 
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=emailclient> 
>
>
> <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240414/dec40c70/attachment.htm>

From mdsumner at gmail.com  Sun Apr 14 16:48:16 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 15 Apr 2024 09:48:16 +1000
Subject: [gdal-dev] advice on python style - get file/dataset as bytes
Message-ID: <CAAcGz99+LrjidB9xBzdjJedEwr-Cgps6wRQ8kR1ocGsr7Y8aqw@mail.gmail.com>

Hi, I'm getting some pushback on my code style. I just want the raw bytes
in-memory of a file in Python, for a manageable tiny dataset.

Is there anything especially wrong with the following?   It's essentially
the same as the answer here:

https://lists.osgeo.org/pipermail/gdal-dev/2016-August/045030.html

   (I know it needs error checks, I just mean the bare style of how to get
the task done).

temp_name = "/vsimem/some.tif"
from osgeo import gdal
gdal.UseExceptions()

## we do something with vrt
dsn = "vrt:///vsicurl/
https://github.com/cran/rgl/raw/master/inst/textures/worldsmall.png?a_ullr=-180,90,180,-90&expand=rgb
"
ds = gdal.Open(dsn)
## write to tif format, but using MEM
gdal.Translate(temp_name, ds)

## now obtain those bytes from the GDAL virtual file
f = gdal.VSIFOpenL(temp_name, 'rb')
gdal.VSIFSeekL(f, 0, 2) # end
size = gdal.VSIFTellL(f)
gdal.VSIFSeekL(f, 0, 0) # begin

## the desired result is this
data = gdal.VSIFReadL(1, size, f)

## and clean up
gdal.VSIFCloseL(f)
gdal.Unlink(temp_name)

Cheers, Mike



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240415/b6ec0495/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 15 00:32:49 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Apr 2024 09:32:49 +0200
Subject: [gdal-dev] advice on python style - get file/dataset as bytes
In-Reply-To: <CAAcGz99+LrjidB9xBzdjJedEwr-Cgps6wRQ8kR1ocGsr7Y8aqw@mail.gmail.com>
References: <CAAcGz99+LrjidB9xBzdjJedEwr-Cgps6wRQ8kR1ocGsr7Y8aqw@mail.gmail.com>
Message-ID: <832a6ff9-8fb4-499b-b431-1fb25fc0dbc8@spatialys.com>

Hi Michael,

I can't think of a better way with the current API.

There has been some work in progress in 
https://github.com/OSGeo/gdal/pull/8222 to make VSIFile accessible as a 
regular Python file, but this isn't merged

Even

Le 15/04/2024 ? 01:48, Michael Sumner via gdal-dev a ?crit?:
> Hi, I'm getting some pushback on my code style. I just want the raw 
> bytes in-memory of a file in Python, for a manageable tiny dataset.
>
> Is there anything especially wrong with the following? ?It's 
> essentially the same as the answer here:
>
> https://lists.osgeo.org/pipermail/gdal-dev/2016-August/045030.html
> ?? (I know it needs error checks, I just mean the bare style of how to 
> get the task done).
>
> temp_name = "/vsimem/some.tif"
> from osgeo import gdal
> gdal.UseExceptions()
>
> ## we do something with vrt
> dsn = 
> "vrt:///vsicurl/https://github.com/cran/rgl/raw/master/inst/textures/worldsmall.png?a_ullr=-180,90,180,-90&expand=rgb 
> <https://github.com/cran/rgl/raw/master/inst/textures/worldsmall.png?a_ullr=-180,90,180,-90&expand=rgb>"
> ds = gdal.Open(dsn)
> ## write to tif format, but using MEM
> gdal.Translate(temp_name, ds)
>
> ## now obtain those bytes from the GDAL virtual file
> f = gdal.VSIFOpenL(temp_name, 'rb')
> gdal.VSIFSeekL(f, 0, 2) # end
> size = gdal.VSIFTellL(f)
> gdal.VSIFSeekL(f, 0, 0) # begin
>
> ## the desired result is this
> data = gdal.VSIFReadL(1, size, f)
>
> ## and clean up
> gdal.VSIFCloseL(f)
> gdal.Unlink(temp_name)
>
> Cheers, Mike
>
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240415/b2ab3e24/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 15 04:25:11 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Apr 2024 13:25:11 +0200
Subject: [gdal-dev] 3.9 release schedule
Message-ID: <037aaa36-4ff1-421e-bbca-7499eb6e1a6e@spatialys.com>

Hi,

here's the updated proposed 3.9 release schedule

- Monday April 22: feature freeze, creation of release/3.9 branch and 
issue a 3.9.0beta1

- Monday May 6th: issue of 3.9.0rc1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From runette at gmail.com  Mon Apr 15 05:26:22 2024
From: runette at gmail.com (Paul Harwood)
Date: Mon, 15 Apr 2024 13:26:22 +0100
Subject: [gdal-dev] GDAL DATA PATH - test
Message-ID: <CAE8nN5N_NeMZnOVQF9QtN5AzK4123Fq-qwh4Hd0BUc6D8=5NWw@mail.gmail.com>

I have an interesting little problem.

I want to write (in the code using the API - not as a test script -
actually in C#) a command that will fail if the GDAL data path is set
incorrectly.

I am having difficulty finding a command that will fail if the path is
incorrect.

I thought that some of the commands in OSR (like ImportFromPCI ) would fail
since the data files are in the data folder - but when I try that with the
GDAL-DATA configuration item set to a path that does not exists - they do
not fail!

There are a lot of commands out there - and I do not want to have to try
them all. Does anyone have a good idea about what should fail?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240415/ec9812ea/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 15 05:42:41 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Apr 2024 14:42:41 +0200
Subject: [gdal-dev] GDAL DATA PATH - test
In-Reply-To: <CAE8nN5N_NeMZnOVQF9QtN5AzK4123Fq-qwh4Hd0BUc6D8=5NWw@mail.gmail.com>
References: <CAE8nN5N_NeMZnOVQF9QtN5AzK4123Fq-qwh4Hd0BUc6D8=5NWw@mail.gmail.com>
Message-ID: <7edceaef-c9cb-4291-a872-11fc3baea2fe@spatialys.com>

The following fails if GDAL_DATA is incorrect:

 ??????? srs = osr.SpatialReference()
 ?????? srs.SetStatePlane(403, 1)? # California III NAD83.


Le 15/04/2024 ? 14:26, Paul Harwood via gdal-dev a ?crit?:
> I have an interesting little problem.
>
> I want to write (in the code using the API - not as a test script - 
> actually in C#) a command that will fail if the GDAL data path is set 
> incorrectly.
>
> I am having difficulty finding a command that will fail if the path is 
> incorrect.
>
> I thought that some of the commands in OSR (like ImportFromPCI ) would 
> fail since the data files are in the data folder - but when I try that 
> with the GDAL-DATA configuration item set to a path that does not 
> exists - they do not fail!
>
> There are a lot of commands out there - and I do not want to have to 
> try them all. Does anyone have a good idea about what should fail?
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew at aitchison.me.uk  Mon Apr 15 10:49:31 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 15 Apr 2024 18:49:31 +0100 (BST)
Subject: [gdal-dev] Printing a size_t variable on all github platforms ?
Message-ID: <90a8ddce-6dc1-486b-bd04-056271b965f5@aitchison.me.uk>


I am trying to print a size_t variable* with CPLDebug, but
am struggling to find a format that works for all the guthub builds.

The main problem is that the "build-windows-msys2-mingw" build
does not support the format option %zu

../../../frmts/vrc/VRC.cpp:159:47: error: unknown conversion type character 'z' in format [-Werror=format=]
   159 |                  "VRC_png_read_data_fn(%p %p %zu) reached end of data",
       |                                               ^
https://github.com/andrew-aitchison/gdal/actions/runs/8691997363/job/23835554972
lines 586-8.

Since size_t is usually an unsigned int on 64-bit systems and
an unsigned long on 32-bit systems ("build-windows-msys2-mingw"
and "Alpine, gcc 32-bit") I cannot use %u or %lu either,
without conditional compiling.
I don't see any helpful definition in <inttypes.h> either

Am I missing a way of printing a size_t ?
I suppose I could cast it to an unsigned long (long?) and hope.

Thanks,

---  Pedantry

I'm ultimately trying to print "myVector.size()"
which is a "std::vector<...>::size_type", which
   https://stackoverflow.com/questions/918567/size-t-vs-containersize-type
says *may* be be different from a size_t ... but
   https://en.cppreference.com/w/cpp/types/size_t
says that std::size_t is big enough (or the type is ill-formed).

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Mon Apr 15 11:02:14 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Apr 2024 20:02:14 +0200
Subject: [gdal-dev] Printing a size_t variable on all github platforms ?
In-Reply-To: <90a8ddce-6dc1-486b-bd04-056271b965f5@aitchison.me.uk>
References: <90a8ddce-6dc1-486b-bd04-056271b965f5@aitchison.me.uk>
Message-ID: <1db7ed69-02ee-4da0-8932-752b23f1f1be@spatialys.com>

Andrew,

some hints at 
https://stackoverflow.com/questions/44382862/how-to-printf-a-size-t-without-warning-in-mingw-w64-gcc-7-1

Otherwise an alternative is to cast to uint64_t and use PRIu64

Even

Le 15/04/2024 ? 19:49, Andrew C Aitchison via gdal-dev a ?crit?:
>
> I am trying to print a size_t variable* with CPLDebug, but
> am struggling to find a format that works for all the guthub builds.
>
> The main problem is that the "build-windows-msys2-mingw" build
> does not support the format option %zu
>
> ../../../frmts/vrc/VRC.cpp:159:47: error: unknown conversion type 
> character 'z' in format [-Werror=format=]
> ? 159 |????????????????? "VRC_png_read_data_fn(%p %p %zu) reached end 
> of data",
> ????? |?????????????????????????????????????????????? ^
> https://github.com/andrew-aitchison/gdal/actions/runs/8691997363/job/23835554972 
>
> lines 586-8.
>
> Since size_t is usually an unsigned int on 64-bit systems and
> an unsigned long on 32-bit systems ("build-windows-msys2-mingw"
> and "Alpine, gcc 32-bit") I cannot use %u or %lu either,
> without conditional compiling.
> I don't see any helpful definition in <inttypes.h> either
>
> Am I missing a way of printing a size_t ?
> I suppose I could cast it to an unsigned long (long?) and hope.
>
> Thanks,
>
> ---? Pedantry
>
> I'm ultimately trying to print "myVector.size()"
> which is a "std::vector<...>::size_type", which
> https://stackoverflow.com/questions/918567/size-t-vs-containersize-type
> says *may* be be different from a size_t ... but
> ? https://en.cppreference.com/w/cpp/types/size_t
> says that std::size_t is big enough (or the type is ill-formed).
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From nhv at meganet.net  Mon Apr 15 15:08:56 2024
From: nhv at meganet.net (Norman Vine)
Date: Mon, 15 Apr 2024 18:08:56 -0400
Subject: [gdal-dev] advice on python style - get file/dataset as bytes
In-Reply-To: <CAAcGz99+LrjidB9xBzdjJedEwr-Cgps6wRQ8kR1ocGsr7Y8aqw@mail.gmail.com>
References: <CAAcGz99+LrjidB9xBzdjJedEwr-Cgps6wRQ8kR1ocGsr7Y8aqw@mail.gmail.com>
Message-ID: <B2967C67-73C5-4159-AF05-940EAC4B119C@meganet.net>

If you are using numpy ReadAsArray maybe your friend 

> On Apr 14, 2024, at 7:48 PM, Michael Sumner via gdal-dev <gdal-dev at lists.osgeo.org> wrote:
> 
> Hi, I'm getting some pushback on my code style. I just want the raw bytes in-memory of a file in Python, for a manageable tiny dataset. 
> 
> Is there anything especially wrong with the following?   It's essentially the same as the answer here: 
> 
> https://lists.osgeo.org/pipermail/gdal-dev/2016-August/045030.html
> 
> (I know it needs error checks, I just mean the bare style of how to get the task done). 
> 
> temp_name = "/vsimem/some.tif"
> from osgeo import gdal
> gdal.UseExceptions()
> 
> ## we do something with vrt
> dsn = "vrt:///vsicurl/https://github.com/cran/rgl/raw/master/inst/textures/worldsmall.png?a_ullr=-180,90,180,-90&expand=rgb"
> ds = gdal.Open(dsn)
> ## write to tif format, but using MEM
> gdal.Translate(temp_name, ds)
> 
> ## now obtain those bytes from the GDAL virtual file
> f = gdal.VSIFOpenL(temp_name, 'rb')
> gdal.VSIFSeekL(f, 0, 2) # end
> size = gdal.VSIFTellL(f)
> gdal.VSIFSeekL(f, 0, 0) # begin
> 
> ## the desired result is this
> data = gdal.VSIFReadL(1, size, f)
> 
> ## and clean up
> gdal.VSIFCloseL(f)
> gdal.Unlink(temp_name)
> 
> Cheers, Mike
> 
> 
> 
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 15 23:13:27 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 16 Apr 2024 06:13:27 +0000
Subject: [gdal-dev] Potential geopackage rtree problem on MacOS ARM64
Message-ID: <DB9PR09MB688754C843DDDA8F8B786EC5FD082@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

It seems that at least two MacOS ARM64 users have faced a problem with the new, faster rtree creation method so maybe it is worth having a look. Obviously a big dataset and right hardware is needed for testing https://gis.stackexchange.com/questions/479958/how-to-fix-failed-to-prepare-sql-error-when-creating-gpkg-file-from-osm-extrac/479964#479964

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240416/0482d3d7/attachment.htm>

From nhv at meganet.net  Mon Apr 15 13:30:16 2024
From: nhv at meganet.net (Norman Vine)
Date: Mon, 15 Apr 2024 16:30:16 -0400
Subject: [gdal-dev] advice on python style - get file/dataset as bytes
In-Reply-To: <CAAcGz99+LrjidB9xBzdjJedEwr-Cgps6wRQ8kR1ocGsr7Y8aqw@mail.gmail.com>
References: <CAAcGz99+LrjidB9xBzdjJedEwr-Cgps6wRQ8kR1ocGsr7Y8aqw@mail.gmail.com>
Message-ID: <431ACB21-DB70-49C6-BFFF-4E9CEBAB039D@meganet.net>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240415/6ae796a1/attachment.htm>

From even.rouault at spatialys.com  Tue Apr 16 12:01:01 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 Apr 2024 21:01:01 +0200
Subject: [gdal-dev] Potential geopackage rtree problem on MacOS ARM64
In-Reply-To: <DB9PR09MB688754C843DDDA8F8B786EC5FD082@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <DB9PR09MB688754C843DDDA8F8B786EC5FD082@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <967c499f-2ffe-4b21-b8e3-1f94572fc1aa@spatialys.com>

Hi,

I've investigated that today, and I can quite reliably trigger a similar 
error with our existing tests on CI, but this is impossible to diagnose 
further without direct access to a machine where the error triggers 
(when simulating taking the the error code path on Linux, the fallback 
code works, whereas it doesn't on OSX Arm64, so there's something quite 
subtle happening here). So if someone has a OSX?Arm64 and is willing to 
give me ssh access to it, that would be welcome.

In the meantime, I've submitted https://github.com/OSGeo/gdal/pull/9685 
which is just a workaround to disable (by default) the threaded RTree 
creation on that platform. It can be explicitly enabled by setting 
OGR_GPKG_ALLOW_THREADED_RTREE to YES

Even

Le 16/04/2024 ? 08:13, Rahkonen Jukka via gdal-dev a ?crit?:
>
> Hi,
>
> It seems that at least two MacOS ARM64 users have faced a problem with 
> the new, faster rtree creation method so maybe it is worth having a 
> look. Obviously a big dataset and right hardware is needed for testing 
> https://gis.stackexchange.com/questions/479958/how-to-fix-failed-to-prepare-sql-error-when-creating-gpkg-file-from-osm-extrac/479964#479964
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240416/6e94d46c/attachment.htm>

From andrew.bell.ia at gmail.com  Wed Apr 17 06:48:26 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Wed, 17 Apr 2024 09:48:26 -0400
Subject: [gdal-dev] Hungarian Notation
Message-ID: <CACJ51z2bqAyFNC7A26aJXCTraBO3JUq3biyjEz5ibE2BnsAe=A@mail.gmail.com>

Hi,

I was going to make some changes to some GDAL code and I generally want to
follow along. I see that most of the code is still using Hungarian notation
for identifier names. I haven't seen this anywhere else in like 20 years.

Is it OK to submit code without this naming convention or do we still think
it's important. I didn't see an RFC or documentation that covers this, but
there's lots so I may have missed it.

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240417/9cffd84e/attachment.htm>

From lnicola at dend.ro  Wed Apr 17 06:59:14 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Wed, 17 Apr 2024 16:59:14 +0300
Subject: [gdal-dev] Hungarian Notation
In-Reply-To: <CACJ51z2bqAyFNC7A26aJXCTraBO3JUq3biyjEz5ibE2BnsAe=A@mail.gmail.com>
References: <CACJ51z2bqAyFNC7A26aJXCTraBO3JUq3biyjEz5ibE2BnsAe=A@mail.gmail.com>
Message-ID: <fd09b2ec-6052-49ac-8bd1-a4bd05e59798@app.fastmail.com>

Hi Andrew,

I think GDAL uses a mix of styles, but if you dislike Hungarian notation, it's still important to distinguish between "systems" (e.g. dwBytes) and "apps" (e.g. cchWideChar) notation.

The first one just repeats the variable type, which is mostly redundant, but the second actually gives you more information. Is that variable counting bytes, elements, or characters? Is it a NULL-terminated string, or a byte bufer with an associated length?

If you look at https://learn.microsoft.com/en-us/windows/win32/api/stringapiset/nf-stringapiset-widechartomultibyte, you'll see how Hungarian notation makes it easy (assuming you're used to it) to understand what cchWideChar and cbMultiByte mean, even though both are int.

Laurentiu

On Wed, Apr 17, 2024, at 16:48, Andrew Bell via gdal-dev wrote:
> Hi,
> 
> I was going to make some changes to some GDAL code and I generally want to follow along. I see that most of the code is still using Hungarian notation for identifier names. I haven't seen this anywhere else in like 20 years.
> 
> Is it OK to submit code without this naming convention or do we still think it's important. I didn't see an RFC or documentation that covers this, but there's lots so I may have missed it.
> 
> Thanks,
> 
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240417/8adb2d75/attachment.htm>

From even.rouault at spatialys.com  Wed Apr 17 09:09:07 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 Apr 2024 18:09:07 +0200
Subject: [gdal-dev] Hungarian Notation
In-Reply-To: <CACJ51z2bqAyFNC7A26aJXCTraBO3JUq3biyjEz5ibE2BnsAe=A@mail.gmail.com>
References: <CACJ51z2bqAyFNC7A26aJXCTraBO3JUq3biyjEz5ibE2BnsAe=A@mail.gmail.com>
Message-ID: <065df789-087f-4a2b-b38b-320c006c889a@spatialys.com>

Hi,

This is described in https://gdal.org/development/rfc/rfc8_devguide.html 
. I've submitted https://github.com/OSGeo/gdal/pull/9689 so it is going 
to be linked to 
https://gdal.org/development/dev_practices.html#making-changes-to-gdal

I'd probably agree that at my beginnings in GDAL, I might have felt 
unfamiliar with the Hungarian notation, but now I've fully internalized 
it, so I hardly notice it. It would be interesting to have opinions of 
other developers if they find it inconvenient/a hurdle, are neutral or 
like it.? The thing is that if we decide to no longer use it, the 
inconsistency of mixing free style naming and Hungarian notation might 
be problematic and make code confusing. We should probably aim at being 
consistent at least at the scope of a given function or file.

Even

Le 17/04/2024 ? 15:48, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> I was going to make some changes to some GDAL code and I generally 
> want to follow along. I see that most of the code is still using 
> Hungarian notation for identifier names. I haven't seen this anywhere 
> else in like 20 years.
>
> Is it OK to submit code without this naming convention or do we still 
> think it's important. I didn't see an RFC or documentation that covers 
> this, but there's lots so I may have missed it.
>
> Thanks,
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240417/85e7adc3/attachment.htm>

From schwehr at gmail.com  Wed Apr 17 09:49:10 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 17 Apr 2024 09:49:10 -0700
Subject: [gdal-dev] Hungarian Notation
In-Reply-To: <065df789-087f-4a2b-b38b-320c006c889a@spatialys.com>
References: <CACJ51z2bqAyFNC7A26aJXCTraBO3JUq3biyjEz5ibE2BnsAe=A@mail.gmail.com>
 <065df789-087f-4a2b-b38b-320c006c889a@spatialys.com>
Message-ID: <CACmBxyvo2LCZzuUUTs6XyjgMMpS9C6-SqvW=0Uhme6LXib9-0g@mail.gmail.com>

My personal take:

I slightly Hungarian notation and it seems to me like needing that extra
notation points to other coding style issues. However, I think moving away
from it would be a chaotic mess for GDAL. It would be a massive change to
switch it all. Consistency is critical.

On Wed, Apr 17, 2024 at 9:10?AM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> This is described in https://gdal.org/development/rfc/rfc8_devguide.html
> . I've submitted https://github.com/OSGeo/gdal/pull/9689 so it is going
> to be linked to
> https://gdal.org/development/dev_practices.html#making-changes-to-gdal
>
> I'd probably agree that at my beginnings in GDAL, I might have felt
> unfamiliar with the Hungarian notation, but now I've fully internalized it,
> so I hardly notice it. It would be interesting to have opinions of other
> developers if they find it inconvenient/a hurdle, are neutral or like it.
> The thing is that if we decide to no longer use it, the inconsistency of
> mixing free style naming and Hungarian notation might be problematic and
> make code confusing. We should probably aim at being consistent at least at
> the scope of a given function or file.
>
> Even
> Le 17/04/2024 ? 15:48, Andrew Bell via gdal-dev a ?crit :
>
> Hi,
>
> I was going to make some changes to some GDAL code and I generally want to
> follow along. I see that most of the code is still using Hungarian notation
> for identifier names. I haven't seen this anywhere else in like 20 years.
>
> Is it OK to submit code without this naming convention or do we still
> think it's important. I didn't see an RFC or documentation that covers
> this, but there's lots so I may have missed it.
>
> Thanks,
>
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240417/a5516cbf/attachment-0001.htm>

From jmcglinchy at hydrosat.com  Wed Apr 17 14:30:25 2024
From: jmcglinchy at hydrosat.com (Joseph McGlinchy)
Date: Wed, 17 Apr 2024 21:30:25 +0000
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
Message-ID: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>

Hello,

I am attempting to implement georegistration through RPC. I have the following information I've used to calibrate the RPC coefficients, using all terms for numerator and denominator for both sample and line equations.


  *
image grid, stored in tiff format with no geo-information associated with it, so it reflects the imaging orientation
  *
a 'ground' grid, which corresponds to the longitude/latitude coordinates for each pixel determined from a line-of-sight vector and imaging system coordinates where the pseudo-rays intersect the WGS84 geoid
  *
a random sample of up to 4000 image coordinate / object space coordinate pairs (I arrived at this number through trial and error; using all pixels explodes RAM)
  *
elevation extracted at the longitude/latitude coordinates from a DEM, in this case, SRTM, but have also tried using NASADEM

I am able to write out an image to EPSG:4326 by populating the RPC metadata and using the non-georeferenced image data. However, I am struggling to use gdalwarp? in a reliable way to orthorectify that data, let alone writing it out in a way that 'bakes in' the georegistration with the RPCs whether that is in EPSG:4326 or the local UTM zone. I see strips of the image "ripped out" with odd curves in various places throughout the image.

The only way I've been able to use gdalwarp? to write the image at all is with the following parameters (any DEM reference is to the SRTM DEM):

gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" -to "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list of polygon coordinates comprising the long/lat grid))'" -to "RPC_MAX_ITERATIONS=101" input_with_RPCs.tiff output.tiff

This is the only configuration i can use to run gdalwarp? successfully.  removing any single RPC_X tranformer option gives me bogus output. The RPC_HEIGHT value i specify above is not close to the mean or median elevation of the extent of my data; mean is ~195m and median is ~150m.

With the debug turned on, any other set of parameters gives me failed RPC convergence on several points. I am able to reproduce this regularly by specifying RPC_DEM=dem.tif, where dem.tif is the same data I used to extract elevation values when calibrating the RPCs. I am seeing normalized latitude and longitude values with magnitude > 1 (I checked every location in the image, based on the metadata, the range is not outside of [-1,1]), as well as normalized altitude values with magnitude > 1 (there are some, not many, that have magnitude of 1.75).

My workflow can be summarized as:


  1.
load grids (image data, longitude, latitude)
  2.
randomly sample up to 4000 points in image coordinates, object coordinates
     *
assign z-value from SRTM DEM
     *
evaluate if any of the points are in NODATA areas of SRTM (image is coastal, so there are NODATA areas for SRTM here), if so, remove those and generate more points
  3.
normalize coordinates of grids to be in [-1,1], recording offsets and scale
  4.
 calibrate RPC coefficients using all terms
  5.
write out GeoTIFF with image grid for pixels, along with RPC required metadata fields and CRS EPSG:4326

System information (please let me know if more is needed)
OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 x86_64) (Windows Subsystem for Linux)
GDAL 3.6.0 (python)

Thank you in advance for any insight into this process! I am happy to package up any of the data I am using, as well. I have placed the initial data from the end of Step 5 described above, along with some additional files, a sample gdalwarp call, and a file-list.txt, at https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing

If more is needed for anyone interested in having a look, please let me know and I'll upload.


Cheers,
Joe

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240417/c3fea5d2/attachment-0001.htm>

From even.rouault at spatialys.com  Wed Apr 17 15:20:10 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Apr 2024 00:20:10 +0200
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
In-Reply-To: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
References: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
Message-ID: <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>

Hi,


I haven't done myself that exercice but I know that computing RPC values 
that are stable enough might be challenging, so perhaps the issue is 
related to that


A few other remarks:

- your gdalwarp command line refers to? RPC_DEM_SRS and 
RPC_DEM_MISSING_VALUE but doesn't include a RPC_DEM itself, hence those 
are likely to be non effective

- you generally don't want to use both RPC_HEIGHT and RPC_DEM. 
RPC_HEIGHT is essentially useful when you don't have a DEM available, 
and thus fallback taking an average elevation

- there's a subtlety regarding DEM. RPC reference for altitudes is WGS84 
ellipsoidal height, not orthometric/MSL altitude. But DEM values use 
orthometric/MSL altitude, hence a geoid correction must be applied. So 
you'd rather want to use RPC_DEM_SRS=EPSG:4326+5773 for example to use 
the EGM96 geoid (cf https://github.com/OSGeo/gdal/issues/3298). That 
said, misusing orthometric altitude vs ellipsoidal height generally 
accounts for small shifts, not big ones

- you could use gdaltransform with all your -to parameter and 
input_with_RPCs.tiff to check at least that the forward RPC 
transformation path works correctly (the one from longitude, latitude -> 
column, line). And with -i to check the inverse RPC transformer. The 
inverse RPC transformer can have a hard time converging in montainous 
areas or for images off-nadir


Even


Le 17/04/2024 ? 23:30, Joseph McGlinchy via gdal-dev a ?crit?:
> Hello,
>
> I am attempting to implement georegistration through RPC. I have the 
> following information I've used to calibrate the RPC coefficients, 
> using all terms for numerator and denominator for both sample and line 
> equations.
>
>  *
>     image grid, stored in tiff format with no geo-information
>     associated with it, so it reflects the imaging orientation
>  *
>     a 'ground' grid, which corresponds to the longitude/latitude
>     coordinates for each pixel determined from a line-of-sight vector
>     and imaging system coordinates where the pseudo-rays intersect the
>     WGS84 geoid
>  *
>     a random sample of up to 4000 image coordinate / object space
>     coordinate pairs (I arrived at this number through trial and
>     error; using all pixels explodes RAM)
>  *
>     elevation extracted at the longitude/latitude coordinates from a
>     DEM, in this case, SRTM, but have also tried using NASADEM
>
>
> I am able to write out an image to EPSG:4326 by populating the RPC 
> metadata and using the non-georeferenced image data. However, I am 
> struggling to use |gdalwarp|? in a reliable way to orthorectify that 
> data, let alone writing it out in a way that 'bakes in' the 
> georegistration with the RPCs whether that is in EPSG:4326 or the 
> local UTM zone. I see strips of the image "ripped out" with odd curves 
> in various places throughout the image.
>
> The only way I've been able to use |gdalwarp|? to write the image at 
> all is with the following parameters (any DEM reference is to the SRTM 
> DEM):
>
> gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to 
> "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" 
> -to "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list 
> of polygon coordinates comprising the long/lat grid))'" -to 
> "RPC_MAX_ITERATIONS=101" input_with_RPCs.tiff output.tiff
>
> This is the only configuration i can use to run |gdalwarp|? 
> successfully.? removing any single RPC_X tranformer option gives me 
> bogus output. The RPC_HEIGHT value i specify above is not close to the 
> mean or median elevation of the extent of my data; mean is ~195m and 
> median is ~150m.
>
> With the debug turned on, any other set of parameters gives me failed 
> RPC convergence on several points. I am able to reproduce this 
> regularly by specifying RPC_DEM=dem.tif, where dem.tif is the same 
> data I used to extract elevation values when calibrating the RPCs. I 
> am seeing normalized latitude and longitude values with magnitude > 1 
> (I checked every location in the image, based on the metadata, the 
> range is not outside of [-1,1]), as well as normalized altitude values 
> with magnitude > 1 (there are some, not many, that have magnitude of 
> 1.75).
>
> My workflow can be summarized as:
>
> 1.
>     load grids (image data, longitude, latitude)
> 2.
>     randomly sample up to 4000 points in image coordinates, object
>     coordinates
>     1.
>         assign z-value from SRTM DEM
>     2.
>         evaluate if any of the points are in NODATA areas of SRTM
>         (image is coastal, so there are NODATA areas for SRTM here),
>         if so, remove those and generate more points
> 3.
>     normalize coordinates of grids to be in [-1,1], recording offsets
>     and scale
> 4.
>     ?calibrate RPC coefficients using all terms
> 5.
>     write out GeoTIFF with image grid for pixels, along with RPC
>     required metadata fields and CRS EPSG:4326
>
>
> System information (please let me know if more is needed)
> OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 
> x86_64) (Windows Subsystem for Linux)
> GDAL 3.6.0 (python)
>
> Thank you in advance for any insight into this process! I am happy to 
> package up any of the data I am using, as well. I have placed the 
> initial data from the end of Step 5 described above, along with some 
> additional files, a sample gdalwarp call, and a file-list.txt, at 
> https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing 
> <https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing>
>
> If more is needed for anyone interested in having a look, please let 
> me know and I'll upload.
>
>
> Cheers,
> Joe
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240418/70863c28/attachment.htm>

From jmcglinchy at hydrosat.com  Wed Apr 17 18:33:00 2024
From: jmcglinchy at hydrosat.com (Joseph McGlinchy)
Date: Thu, 18 Apr 2024 01:33:00 +0000
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
In-Reply-To: <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>
References: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>
Message-ID: <AM9PR07MB710643932259277B2F1D0030A10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>

Hi Even,

Thank you for this great response. I'll try out some of those things you mention on the CRS of the DEM and correcting for the geoid; I had also been reading that any height values used in this process need to be heights above the ellipsoid.

I had seen good outputs from gdaltransform?, both forward and inverse, and can get back to the corner coordinates, center coordinates, etc. in both lon/lat and sample/line so it could be a subtlety of the DEM + CRS, or the more challenging issue of stable RPCs.

On the topic of stable RPCs, do you happen to know if it is enough to zero out the higher-order terms after the full set of coefficients are fit? Since there are squared terms in the higher-order coefficients, that could definitely be part of the issue, even if it works mathematically.

thanks!
Joe
________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Wednesday, April 17, 2024 4:20 PM
To: Joseph McGlinchy <jmcglinchy at hydrosat.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] gdalwarp with RPCs causing bogus output


Hi,


I haven't done myself that exercice but I know that computing RPC values that are stable enough might be challenging, so perhaps the issue is related to that


A few other remarks:

- your gdalwarp command line refers to  RPC_DEM_SRS and RPC_DEM_MISSING_VALUE but doesn't include a RPC_DEM itself, hence those are likely to be non effective

- you generally don't want to use both RPC_HEIGHT and RPC_DEM.  RPC_HEIGHT is essentially useful when you don't have a DEM available, and thus fallback taking an average elevation

- there's a subtlety regarding DEM. RPC reference for altitudes is WGS84 ellipsoidal height, not orthometric/MSL altitude. But DEM values use orthometric/MSL altitude, hence a geoid correction must be applied. So you'd rather want to use RPC_DEM_SRS=EPSG:4326+5773 for example to use the EGM96 geoid (cf https://github.com/OSGeo/gdal/issues/3298). That said, misusing orthometric altitude vs ellipsoidal height generally accounts for small shifts, not big ones

- you could use gdaltransform with all your -to parameter and input_with_RPCs.tiff to check at least that the forward RPC transformation path works correctly (the one from longitude, latitude -> column, line). And with -i to check the inverse RPC transformer. The inverse RPC transformer can have a hard time converging in montainous areas or for images off-nadir


Even


Le 17/04/2024 ? 23:30, Joseph McGlinchy via gdal-dev a ?crit :
Hello,

I am attempting to implement georegistration through RPC. I have the following information I've used to calibrate the RPC coefficients, using all terms for numerator and denominator for both sample and line equations.


  *
image grid, stored in tiff format with no geo-information associated with it, so it reflects the imaging orientation
  *
a 'ground' grid, which corresponds to the longitude/latitude coordinates for each pixel determined from a line-of-sight vector and imaging system coordinates where the pseudo-rays intersect the WGS84 geoid
  *
a random sample of up to 4000 image coordinate / object space coordinate pairs (I arrived at this number through trial and error; using all pixels explodes RAM)
  *
elevation extracted at the longitude/latitude coordinates from a DEM, in this case, SRTM, but have also tried using NASADEM

I am able to write out an image to EPSG:4326 by populating the RPC metadata and using the non-georeferenced image data. However, I am struggling to use gdalwarp? in a reliable way to orthorectify that data, let alone writing it out in a way that 'bakes in' the georegistration with the RPCs whether that is in EPSG:4326 or the local UTM zone. I see strips of the image "ripped out" with odd curves in various places throughout the image.

The only way I've been able to use gdalwarp? to write the image at all is with the following parameters (any DEM reference is to the SRTM DEM):

gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" -to "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list of polygon coordinates comprising the long/lat grid))'" -to "RPC_MAX_ITERATIONS=101" input_with_RPCs.tiff output.tiff

This is the only configuration i can use to run gdalwarp? successfully.  removing any single RPC_X tranformer option gives me bogus output. The RPC_HEIGHT value i specify above is not close to the mean or median elevation of the extent of my data; mean is ~195m and median is ~150m.

With the debug turned on, any other set of parameters gives me failed RPC convergence on several points. I am able to reproduce this regularly by specifying RPC_DEM=dem.tif, where dem.tif is the same data I used to extract elevation values when calibrating the RPCs. I am seeing normalized latitude and longitude values with magnitude > 1 (I checked every location in the image, based on the metadata, the range is not outside of [-1,1]), as well as normalized altitude values with magnitude > 1 (there are some, not many, that have magnitude of 1.75).

My workflow can be summarized as:


  1.
load grids (image data, longitude, latitude)
  2.
randomly sample up to 4000 points in image coordinates, object coordinates
     *
assign z-value from SRTM DEM
     *
evaluate if any of the points are in NODATA areas of SRTM (image is coastal, so there are NODATA areas for SRTM here), if so, remove those and generate more points
  3.
normalize coordinates of grids to be in [-1,1], recording offsets and scale
  4.
 calibrate RPC coefficients using all terms
  5.
write out GeoTIFF with image grid for pixels, along with RPC required metadata fields and CRS EPSG:4326

System information (please let me know if more is needed)
OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 x86_64) (Windows Subsystem for Linux)
GDAL 3.6.0 (python)

Thank you in advance for any insight into this process! I am happy to package up any of the data I am using, as well. I have placed the initial data from the end of Step 5 described above, along with some additional files, a sample gdalwarp call, and a file-list.txt, at https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing

If more is needed for anyone interested in having a look, please let me know and I'll upload.


Cheers,
Joe




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240418/169348aa/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Apr 18 03:37:09 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Apr 2024 12:37:09 +0200
Subject: [gdal-dev] Adding a CI "stale" workflow for pull requests without
 activity
Message-ID: <8ba94aeb-76bb-4cd9-b854-43d105230b39@spatialys.com>

Hi,

I'm proposing in https://github.com/OSGeo/gdal/pull/9693 that we add a 
CI "stale" workflow for pull requests without activity. It is mostly a 
copy&paste from QGIS similar workflow with the following changes:
- restrict the scope to pull requests only and not tickets (although we 
could potentially also do that for tickets that are in the "awaiting 
feedback" state)
- increase the period to tag a pull request as "stale" to 28 days 
without activity. The stale bot adds a message in the PR explaining 
that, and that they have an extra delay of 14 days to make it progress, 
otherwise it will be automatically closed. So basically a PR without 
activity for 6 weeks will be automatically closed. I think this is a 
fair delay.

The rationale for that is that it makes the cognitive load of PR 
reviewers lower by avoiding to have to read repeatedly a list of stale 
PRs, and it also encourages contributors to either make their work 
progress towards completion (or just make them realize that they don't 
have the bandwidth or motivation to make it further progress, which is 
also fine).

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From daniel.fred.evans at gmail.com  Thu Apr 18 04:44:20 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Thu, 18 Apr 2024 12:44:20 +0100
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
In-Reply-To: <AM9PR07MB710643932259277B2F1D0030A10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
References: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>
 <AM9PR07MB710643932259277B2F1D0030A10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
Message-ID: <CANnaQabdZqprrRqFiJ=YgR6oRRaJ9jNFLAWgBncoF=-TzCCbJA@mail.gmail.com>

Hi Joe,

Trying your commands with GDAL 3.8.3, the results don't seem to be as bad
as what you're reporting - I don't see big strips missing. Adding in the
DEM file as Even mentioned, it seems to be doing what I'd expect (the
correction isn't "right" because of the georeferencing offset, but it's
doing what it's told using the underlying DEM).

Any possibility of trying a newer GDAL version in case there has been a fix
since 3.6.0?

Cheers,
Daniel

On Thu, 18 Apr 2024 at 02:35, Joseph McGlinchy via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi Even,
>
> Thank you for this great response. I'll try out some of those things you
> mention on the CRS of the DEM and correcting for the geoid; I had also been
> reading that any height values used in this process need to be heights
> above the ellipsoid.
>
> I had seen good outputs from gdaltransform?, both forward and inverse,
> and can get back to the corner coordinates, center coordinates, etc. in
> both lon/lat and sample/line so it could be a subtlety of the DEM + CRS, or
> the more challenging issue of stable RPCs.
>
> On the topic of stable RPCs, do you happen to know if it is enough to zero
> out the higher-order terms after the full set of coefficients are fit?
> Since there are squared terms in the higher-order coefficients, that could
> definitely be part of the issue, even if it works mathematically.
>
> thanks!
> Joe
> ------------------------------
> *From:* Even Rouault <even.rouault at spatialys.com>
> *Sent:* Wednesday, April 17, 2024 4:20 PM
> *To:* Joseph McGlinchy <jmcglinchy at hydrosat.com>; gdal-dev at lists.osgeo.org
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdalwarp with RPCs causing bogus output
>
>
> Hi,
>
>
> I haven't done myself that exercice but I know that computing RPC values
> that are stable enough might be challenging, so perhaps the issue is
> related to that
>
>
> A few other remarks:
>
> - your gdalwarp command line refers to  RPC_DEM_SRS and
> RPC_DEM_MISSING_VALUE but doesn't include a RPC_DEM itself, hence those are
> likely to be non effective
>
> - you generally don't want to use both RPC_HEIGHT and RPC_DEM.  RPC_HEIGHT
> is essentially useful when you don't have a DEM available, and thus
> fallback taking an average elevation
>
> - there's a subtlety regarding DEM. RPC reference for altitudes is WGS84
> ellipsoidal height, not orthometric/MSL altitude. But DEM values use
> orthometric/MSL altitude, hence a geoid correction must be applied. So
> you'd rather want to use RPC_DEM_SRS=EPSG:4326+5773 for example to use the
> EGM96 geoid (cf https://github.com/OSGeo/gdal/issues/3298). That said,
> misusing orthometric altitude vs ellipsoidal height generally accounts for
> small shifts, not big ones
>
> - you could use gdaltransform with all your -to parameter and
> input_with_RPCs.tiff to check at least that the forward RPC transformation
> path works correctly (the one from longitude, latitude -> column, line).
> And with -i to check the inverse RPC transformer. The inverse RPC
> transformer can have a hard time converging in montainous areas or for
> images off-nadir
>
>
> Even
>
>
> Le 17/04/2024 ? 23:30, Joseph McGlinchy via gdal-dev a ?crit :
>
> Hello,
>
> I am attempting to implement georegistration through RPC. I have the
> following information I've used to calibrate the RPC coefficients, using
> all terms for numerator and denominator for both sample and line equations.
>
>
>    - image grid, stored in tiff format with no geo-information associated
>    with it, so it reflects the imaging orientation
>    - a 'ground' grid, which corresponds to the longitude/latitude
>    coordinates for each pixel determined from a line-of-sight vector and
>    imaging system coordinates where the pseudo-rays intersect the WGS84 geoid
>    - a random sample of up to 4000 image coordinate / object space
>    coordinate pairs (I arrived at this number through trial and error; using
>    all pixels explodes RAM)
>    - elevation extracted at the longitude/latitude coordinates from a
>    DEM, in this case, SRTM, but have also tried using NASADEM
>
>
> I am able to write out an image to EPSG:4326 by populating the RPC
> metadata and using the non-georeferenced image data. However, I am
> struggling to use gdalwarp? in a reliable way to orthorectify that data,
> let alone writing it out in a way that 'bakes in' the georegistration with
> the RPCs whether that is in EPSG:4326 or the local UTM zone. I see strips
> of the image "ripped out" with odd curves in various places throughout the
> image.
>
> The only way I've been able to use gdalwarp? to write the image at all is
> with the following parameters (any DEM reference is to the SRTM DEM):
>
> gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to
> "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" -to
> "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list of polygon
> coordinates comprising the long/lat grid))'" -to "RPC_MAX_ITERATIONS=101"
> input_with_RPCs.tiff output.tiff
>
> This is the only configuration i can use to run gdalwarp? successfully.
> removing any single RPC_X tranformer option gives me bogus output. The
> RPC_HEIGHT value i specify above is not close to the mean or median
> elevation of the extent of my data; mean is ~195m and median is ~150m.
>
> With the debug turned on, any other set of parameters gives me failed RPC
> convergence on several points. I am able to reproduce this regularly by
> specifying RPC_DEM=dem.tif, where dem.tif is the same data I used to
> extract elevation values when calibrating the RPCs. I am seeing normalized
> latitude and longitude values with magnitude > 1 (I checked every location
> in the image, based on the metadata, the range is not outside of [-1,1]),
> as well as normalized altitude values with magnitude > 1 (there are some,
> not many, that have magnitude of 1.75).
>
> My workflow can be summarized as:
>
>
>    1. load grids (image data, longitude, latitude)
>    2. randomly sample up to 4000 points in image coordinates, object
>    coordinates
>    1. assign z-value from SRTM DEM
>       2. evaluate if any of the points are in NODATA areas of SRTM (image
>       is coastal, so there are NODATA areas for SRTM here), if so, remove those
>       and generate more points
>       3. normalize coordinates of grids to be in [-1,1], recording
>    offsets and scale
>    4.  calibrate RPC coefficients using all terms
>    5. write out GeoTIFF with image grid for pixels, along with RPC
>    required metadata fields and CRS EPSG:4326
>
>
> System information (please let me know if more is needed)
> OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 x86_64)
> (Windows Subsystem for Linux)
> GDAL 3.6.0 (python)
>
> Thank you in advance for any insight into this process! I am happy to
> package up any of the data I am using, as well. I have placed the initial
> data from the end of Step 5 described above, along with some additional
> files, a sample gdalwarp call, and a file-list.txt, at
> https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing
>
> If more is needed for anyone interested in having a look, please let me
> know and I'll upload.
>
>
> Cheers,
> Joe
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240418/36d79edd/attachment-0001.htm>

From jmcglinchy at hydrosat.com  Thu Apr 18 07:39:29 2024
From: jmcglinchy at hydrosat.com (Joseph McGlinchy)
Date: Thu, 18 Apr 2024 14:39:29 +0000
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
In-Reply-To: <CANnaQabdZqprrRqFiJ=YgR6oRRaJ9jNFLAWgBncoF=-TzCCbJA@mail.gmail.com>
References: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>
 <AM9PR07MB710643932259277B2F1D0030A10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <CANnaQabdZqprrRqFiJ=YgR6oRRaJ9jNFLAWgBncoF=-TzCCbJA@mail.gmail.com>
Message-ID: <AM9PR07MB71066293982276F82BE8186AA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>

Hi Daniel,

Thanks for trying with the data! I appreciate that. The gdal command I provided in the sample-gdal-call.txt file is the only one I could get to have "good" looking results. What command did you use to include the DEM?

If there has been a fix between 3.6 and 3.8.3 that helps with this, then I'm happy to try it. I'll give that a look too.

thanks!
Joe
________________________________
From: Daniel Evans <daniel.fred.evans at gmail.com>
Sent: Thursday, April 18, 2024 5:44 AM
To: Joseph McGlinchy <jmcglinchy at hydrosat.com>
Cc: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] gdalwarp with RPCs causing bogus output

Hi Joe,

Trying your commands with GDAL 3.8.3, the results don't seem to be as bad as what you're reporting - I don't see big strips missing. Adding in the DEM file as Even mentioned, it seems to be doing what I'd expect (the correction isn't "right" because of the georeferencing offset, but it's doing what it's told using the underlying DEM).

Any possibility of trying a newer GDAL version in case there has been a fix since 3.6.0?

Cheers,
Daniel

On Thu, 18 Apr 2024 at 02:35, Joseph McGlinchy via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi Even,

Thank you for this great response. I'll try out some of those things you mention on the CRS of the DEM and correcting for the geoid; I had also been reading that any height values used in this process need to be heights above the ellipsoid.

I had seen good outputs from gdaltransform?, both forward and inverse, and can get back to the corner coordinates, center coordinates, etc. in both lon/lat and sample/line so it could be a subtlety of the DEM + CRS, or the more challenging issue of stable RPCs.

On the topic of stable RPCs, do you happen to know if it is enough to zero out the higher-order terms after the full set of coefficients are fit? Since there are squared terms in the higher-order coefficients, that could definitely be part of the issue, even if it works mathematically.

thanks!
Joe
________________________________
From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Wednesday, April 17, 2024 4:20 PM
To: Joseph McGlinchy <jmcglinchy at hydrosat.com<mailto:jmcglinchy at hydrosat.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: Re: [gdal-dev] gdalwarp with RPCs causing bogus output


Hi,


I haven't done myself that exercice but I know that computing RPC values that are stable enough might be challenging, so perhaps the issue is related to that


A few other remarks:

- your gdalwarp command line refers to  RPC_DEM_SRS and RPC_DEM_MISSING_VALUE but doesn't include a RPC_DEM itself, hence those are likely to be non effective

- you generally don't want to use both RPC_HEIGHT and RPC_DEM.  RPC_HEIGHT is essentially useful when you don't have a DEM available, and thus fallback taking an average elevation

- there's a subtlety regarding DEM. RPC reference for altitudes is WGS84 ellipsoidal height, not orthometric/MSL altitude. But DEM values use orthometric/MSL altitude, hence a geoid correction must be applied. So you'd rather want to use RPC_DEM_SRS=EPSG:4326+5773 for example to use the EGM96 geoid (cf https://github.com/OSGeo/gdal/issues/3298). That said, misusing orthometric altitude vs ellipsoidal height generally accounts for small shifts, not big ones

- you could use gdaltransform with all your -to parameter and input_with_RPCs.tiff to check at least that the forward RPC transformation path works correctly (the one from longitude, latitude -> column, line). And with -i to check the inverse RPC transformer. The inverse RPC transformer can have a hard time converging in montainous areas or for images off-nadir


Even


Le 17/04/2024 ? 23:30, Joseph McGlinchy via gdal-dev a ?crit :
Hello,

I am attempting to implement georegistration through RPC. I have the following information I've used to calibrate the RPC coefficients, using all terms for numerator and denominator for both sample and line equations.


  *
image grid, stored in tiff format with no geo-information associated with it, so it reflects the imaging orientation
  *
a 'ground' grid, which corresponds to the longitude/latitude coordinates for each pixel determined from a line-of-sight vector and imaging system coordinates where the pseudo-rays intersect the WGS84 geoid
  *
a random sample of up to 4000 image coordinate / object space coordinate pairs (I arrived at this number through trial and error; using all pixels explodes RAM)
  *
elevation extracted at the longitude/latitude coordinates from a DEM, in this case, SRTM, but have also tried using NASADEM

I am able to write out an image to EPSG:4326 by populating the RPC metadata and using the non-georeferenced image data. However, I am struggling to use gdalwarp? in a reliable way to orthorectify that data, let alone writing it out in a way that 'bakes in' the georegistration with the RPCs whether that is in EPSG:4326 or the local UTM zone. I see strips of the image "ripped out" with odd curves in various places throughout the image.

The only way I've been able to use gdalwarp? to write the image at all is with the following parameters (any DEM reference is to the SRTM DEM):

gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" -to "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list of polygon coordinates comprising the long/lat grid))'" -to "RPC_MAX_ITERATIONS=101" input_with_RPCs.tiff output.tiff

This is the only configuration i can use to run gdalwarp? successfully.  removing any single RPC_X tranformer option gives me bogus output. The RPC_HEIGHT value i specify above is not close to the mean or median elevation of the extent of my data; mean is ~195m and median is ~150m.

With the debug turned on, any other set of parameters gives me failed RPC convergence on several points. I am able to reproduce this regularly by specifying RPC_DEM=dem.tif, where dem.tif is the same data I used to extract elevation values when calibrating the RPCs. I am seeing normalized latitude and longitude values with magnitude > 1 (I checked every location in the image, based on the metadata, the range is not outside of [-1,1]), as well as normalized altitude values with magnitude > 1 (there are some, not many, that have magnitude of 1.75).

My workflow can be summarized as:


  1.
load grids (image data, longitude, latitude)
  2.
randomly sample up to 4000 points in image coordinates, object coordinates
     *
assign z-value from SRTM DEM
     *
evaluate if any of the points are in NODATA areas of SRTM (image is coastal, so there are NODATA areas for SRTM here), if so, remove those and generate more points
  3.
normalize coordinates of grids to be in [-1,1], recording offsets and scale
  4.
 calibrate RPC coefficients using all terms
  5.
write out GeoTIFF with image grid for pixels, along with RPC required metadata fields and CRS EPSG:4326

System information (please let me know if more is needed)
OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 x86_64) (Windows Subsystem for Linux)
GDAL 3.6.0 (python)

Thank you in advance for any insight into this process! I am happy to package up any of the data I am using, as well. I have placed the initial data from the end of Step 5 described above, along with some additional files, a sample gdalwarp call, and a file-list.txt, at https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing

If more is needed for anyone interested in having a look, please let me know and I'll upload.


Cheers,
Joe




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240418/1540c949/attachment-0001.htm>

From daniel.fred.evans at gmail.com  Thu Apr 18 08:03:46 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Thu, 18 Apr 2024 16:03:46 +0100
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
In-Reply-To: <AM9PR07MB71066293982276F82BE8186AA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
References: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>
 <AM9PR07MB710643932259277B2F1D0030A10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <CANnaQabdZqprrRqFiJ=YgR6oRRaJ9jNFLAWgBncoF=-TzCCbJA@mail.gmail.com>
 <AM9PR07MB71066293982276F82BE8186AA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
Message-ID: <CANnaQaZyFyTQGOFfbrOUWJAfHX=iSpHtoR6ow6Cj5ErDBovbCw@mail.gmail.com>

Hi Joe,

My minimal change is just to add the missing "RPC_DEM=srtm_12_05.tif" and
remove the "RPC_HEIGHT=350". RPC_HEIGHT appears to override the use of any
supplied DEM, and the docs at least hint that this is the expected
behaviour.

```
gdalwarp --config CPL_DEBUG ON \
    -t_srs EPSG:32610 \
    -rpc \
    -to "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" \
    -to "RPC_DEM_MISSING_VALUE=0.001" \
    -to "RPC_FOOTPRINT='POLYGON ((-123.12941327726458 38.01872167010621,
-121.67068342817124 37.82615456858018, -121.87575337280391
37.11164114368971, -123.32135086275996 37.30124603928108,
-123.12941327726458 38.01872167010621))'" \
    -to "RPC_MAX_ITERATIONS=101" \
    -to "RPC_DEM=srtm_12_05.tif" \
    manyPts4000_SRTM_test_NptRPC.tiff \
    output.tiff
```

Changing to "RPC_DEM_SRS=EPSG:4326+5773" as Even suggested gives a
noticeable change around the DEM locations of dams and lakes with the
updated CRS, e.g. west and north of Livermore CA. Whether that's an
improvement, or an undesired change due to the DEM being treated
differently between generating the RPCs and using them, I'm not sure!

Daniel

On Thu, 18 Apr 2024 at 15:39, Joseph McGlinchy <jmcglinchy at hydrosat.com>
wrote:

> Hi Daniel,
>
> Thanks for trying with the data! I appreciate that. The gdal command I
> provided in the sample-gdal-call.txt file is the only one I could get to
> have "good" looking results. What command did you use to include the DEM?
>
> If there has been a fix between 3.6 and 3.8.3 that helps with this, then
> I'm happy to try it. I'll give that a look too.
>
> thanks!
> Joe
> ------------------------------
> *From:* Daniel Evans <daniel.fred.evans at gmail.com>
> *Sent:* Thursday, April 18, 2024 5:44 AM
> *To:* Joseph McGlinchy <jmcglinchy at hydrosat.com>
> *Cc:* Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdalwarp with RPCs causing bogus output
>
> Hi Joe,
>
> Trying your commands with GDAL 3.8.3, the results don't seem to be as bad
> as what you're reporting - I don't see big strips missing. Adding in the
> DEM file as Even mentioned, it seems to be doing what I'd expect (the
> correction isn't "right" because of the georeferencing offset, but it's
> doing what it's told using the underlying DEM).
>
> Any possibility of trying a newer GDAL version in case there has been a
> fix since 3.6.0?
>
> Cheers,
> Daniel
>
> On Thu, 18 Apr 2024 at 02:35, Joseph McGlinchy via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi Even,
>
> Thank you for this great response. I'll try out some of those things you
> mention on the CRS of the DEM and correcting for the geoid; I had also been
> reading that any height values used in this process need to be heights
> above the ellipsoid.
>
> I had seen good outputs from gdaltransform?, both forward and inverse,
> and can get back to the corner coordinates, center coordinates, etc. in
> both lon/lat and sample/line so it could be a subtlety of the DEM + CRS, or
> the more challenging issue of stable RPCs.
>
> On the topic of stable RPCs, do you happen to know if it is enough to zero
> out the higher-order terms after the full set of coefficients are fit?
> Since there are squared terms in the higher-order coefficients, that could
> definitely be part of the issue, even if it works mathematically.
>
> thanks!
> Joe
> ------------------------------
> *From:* Even Rouault <even.rouault at spatialys.com>
> *Sent:* Wednesday, April 17, 2024 4:20 PM
> *To:* Joseph McGlinchy <jmcglinchy at hydrosat.com>; gdal-dev at lists.osgeo.org
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdalwarp with RPCs causing bogus output
>
>
> Hi,
>
>
> I haven't done myself that exercice but I know that computing RPC values
> that are stable enough might be challenging, so perhaps the issue is
> related to that
>
>
> A few other remarks:
>
> - your gdalwarp command line refers to  RPC_DEM_SRS and
> RPC_DEM_MISSING_VALUE but doesn't include a RPC_DEM itself, hence those are
> likely to be non effective
>
> - you generally don't want to use both RPC_HEIGHT and RPC_DEM.  RPC_HEIGHT
> is essentially useful when you don't have a DEM available, and thus
> fallback taking an average elevation
>
> - there's a subtlety regarding DEM. RPC reference for altitudes is WGS84
> ellipsoidal height, not orthometric/MSL altitude. But DEM values use
> orthometric/MSL altitude, hence a geoid correction must be applied. So
> you'd rather want to use RPC_DEM_SRS=EPSG:4326+5773 for example to use the
> EGM96 geoid (cf https://github.com/OSGeo/gdal/issues/3298). That said,
> misusing orthometric altitude vs ellipsoidal height generally accounts for
> small shifts, not big ones
>
> - you could use gdaltransform with all your -to parameter and
> input_with_RPCs.tiff to check at least that the forward RPC transformation
> path works correctly (the one from longitude, latitude -> column, line).
> And with -i to check the inverse RPC transformer. The inverse RPC
> transformer can have a hard time converging in montainous areas or for
> images off-nadir
>
>
> Even
>
>
> Le 17/04/2024 ? 23:30, Joseph McGlinchy via gdal-dev a ?crit :
>
> Hello,
>
> I am attempting to implement georegistration through RPC. I have the
> following information I've used to calibrate the RPC coefficients, using
> all terms for numerator and denominator for both sample and line equations.
>
>
>    - image grid, stored in tiff format with no geo-information associated
>    with it, so it reflects the imaging orientation
>    - a 'ground' grid, which corresponds to the longitude/latitude
>    coordinates for each pixel determined from a line-of-sight vector and
>    imaging system coordinates where the pseudo-rays intersect the WGS84 geoid
>    - a random sample of up to 4000 image coordinate / object space
>    coordinate pairs (I arrived at this number through trial and error; using
>    all pixels explodes RAM)
>    - elevation extracted at the longitude/latitude coordinates from a
>    DEM, in this case, SRTM, but have also tried using NASADEM
>
>
> I am able to write out an image to EPSG:4326 by populating the RPC
> metadata and using the non-georeferenced image data. However, I am
> struggling to use gdalwarp? in a reliable way to orthorectify that data,
> let alone writing it out in a way that 'bakes in' the georegistration with
> the RPCs whether that is in EPSG:4326 or the local UTM zone. I see strips
> of the image "ripped out" with odd curves in various places throughout the
> image.
>
> The only way I've been able to use gdalwarp? to write the image at all is
> with the following parameters (any DEM reference is to the SRTM DEM):
>
> gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to
> "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" -to
> "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list of polygon
> coordinates comprising the long/lat grid))'" -to "RPC_MAX_ITERATIONS=101"
> input_with_RPCs.tiff output.tiff
>
> This is the only configuration i can use to run gdalwarp? successfully.
> removing any single RPC_X tranformer option gives me bogus output. The
> RPC_HEIGHT value i specify above is not close to the mean or median
> elevation of the extent of my data; mean is ~195m and median is ~150m.
>
> With the debug turned on, any other set of parameters gives me failed RPC
> convergence on several points. I am able to reproduce this regularly by
> specifying RPC_DEM=dem.tif, where dem.tif is the same data I used to
> extract elevation values when calibrating the RPCs. I am seeing normalized
> latitude and longitude values with magnitude > 1 (I checked every location
> in the image, based on the metadata, the range is not outside of [-1,1]),
> as well as normalized altitude values with magnitude > 1 (there are some,
> not many, that have magnitude of 1.75).
>
> My workflow can be summarized as:
>
>
>    1. load grids (image data, longitude, latitude)
>    2. randomly sample up to 4000 points in image coordinates, object
>    coordinates
>    1. assign z-value from SRTM DEM
>       2. evaluate if any of the points are in NODATA areas of SRTM (image
>       is coastal, so there are NODATA areas for SRTM here), if so, remove those
>       and generate more points
>       3. normalize coordinates of grids to be in [-1,1], recording
>    offsets and scale
>    4.  calibrate RPC coefficients using all terms
>    5. write out GeoTIFF with image grid for pixels, along with RPC
>    required metadata fields and CRS EPSG:4326
>
>
> System information (please let me know if more is needed)
> OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 x86_64)
> (Windows Subsystem for Linux)
> GDAL 3.6.0 (python)
>
> Thank you in advance for any insight into this process! I am happy to
> package up any of the data I am using, as well. I have placed the initial
> data from the end of Step 5 described above, along with some additional
> files, a sample gdalwarp call, and a file-list.txt, at
> https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing
>
> If more is needed for anyone interested in having a look, please let me
> know and I'll upload.
>
>
> Cheers,
> Joe
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240418/a29957e2/attachment-0001.htm>

From jmcglinchy at hydrosat.com  Thu Apr 18 11:02:12 2024
From: jmcglinchy at hydrosat.com (Joseph McGlinchy)
Date: Thu, 18 Apr 2024 18:02:12 +0000
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
In-Reply-To: <CANnaQaZyFyTQGOFfbrOUWJAfHX=iSpHtoR6ow6Cj5ErDBovbCw@mail.gmail.com>
References: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>
 <AM9PR07MB710643932259277B2F1D0030A10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <CANnaQabdZqprrRqFiJ=YgR6oRRaJ9jNFLAWgBncoF=-TzCCbJA@mail.gmail.com>
 <AM9PR07MB71066293982276F82BE8186AA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <CANnaQaZyFyTQGOFfbrOUWJAfHX=iSpHtoR6ow6Cj5ErDBovbCw@mail.gmail.com>
Message-ID: <AM9PR07MB7106F33DC9DBDED2A44ED4DAA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>

Hi Daniel,

Thank you.  I tried your commands exactly with gdal 3.8.3 and am seeing the odd type of output I was describing in the northeastern most reaches of the images. Would you be willing to verify if you see that or not?

Here is the result of the debug messaging. I think a screenshot which shows what I see results in the message being over the size limit.

GDAL: GDALOpen(../manyPts4000_SRTM_test_NptRPC.tiff, this=0x5584b5c21370) succeeds as GTiff.
GDAL: GDALOpen(output_gdal38.tiff, this=0x5584b5c4c950) succeeds as GTiff.
GDALWARP: Defining SKIP_NOSOURCE=YES
Processing ../manyPts4000_SRTM_test_NptRPC.tiff [1/1] : 0WARP: Copying metadata from first source to destination dataset
WARP: Set SOURCE_EXTRA=5 warping options due to RPC warping
WARP: Set SAMPLE_STEPS=ALL warping options due to RPC DEM warping
GDAL: GDALOpen(srtm_12_05.tif, this=0x5584b5c522a0) succeeds as GTiff.
RPC: Short-circuiting coordinate transformation from DEM SRS to WGS 84 due to apparent nop
GDAL: GDAL_CACHEMAX = 1504 MB
GTiff: ScanDirectories()
GDAL: GDALDefaultOverviews::OverviewScan()
Using internal nodata values (e.g. 0) for image ../manyPts4000_SRTM_test_NptRPC.tiff.
WARP: band=0 dstNoData=0.000000
RPC: Failed Iterations 101: Got: -121.6743548438707,37.81305392714289  Offset=0.200509,-7.35862
WARP: At least one point failed after direct transform
RPC: Failed Iterations 101: Got: -121.6743548438707,37.81305392714289  Offset=0.200509,-7.35862
RPC: Failed Iterations 101: Got: -121.6756957607436,37.81515846637773  Offset=-0.0317686,-12.1573
RPC: Failed Iterations 101: Got: -121.6759688314497,37.81397923057818  Offset=-0.0782949,-21.942
RPC: Failed Iterations 101: Got: -121.6760567085541,37.81393132082147  Offset=-0.0200723,-13.2144
RPC: Failed Iterations 101: Got: -121.6758750148136,37.8150256294207  Offset=0.0121725,-8.26664
RPC: Failed Iterations 101: Got: -121.6758055299304,37.81513471897441  Offset=0.0111142,-9.29081
RPC: Failed Iterations 101: Got: -121.6757471773221,37.81517816256341  Offset=0.00786933,-9.66179
RPC: Failed Iterations 101: Got: -121.6757610763044,37.81516845364766  Offset=0.00852169,-9.58453
GDAL: GDALSuggestedWarpOutput(): 1 out of 3249 points failed to transform.
GDAL: GDALWarpKernel()::GWKNearestShort() Src=0,0,2383x2800 Dst=0,0,2411x3318
...10...20...30...40...50GDAL: GDALWarpKernel()::GWKNearestShort() Src=1710,0,1460x1401 Dst=2411,0,1205x1659
...60GDAL: GDALWarpKernel()::GWKNearestShort() Src=2833,0,1263x2458 Dst=3616,0,1206x829
...GDAL: GDALWarpKernel()::GWKNearestShort() Src=2995,148,1101x1054 Dst=3616,829,1206x830
70..GDAL: GDALWarpKernel()::GWKNearestShort() Src=2036,993,2060x1807 Dst=2411,1659,2411x1659
.80...90...100 - done.
GDAL: GDALClose(srtm_12_05.tif, this=0x5584b5c522a0)
GDAL: Flushing dirty blocks: 0...10...20...30...40...50...60...70...80...90...100 - done.
GDAL: GDALClose(output_gdal38.tiff, this=0x5584b5c4c950)
GDAL: GDALClose(../manyPts4000_SRTM_test_NptRPC.tiff, this=0x5584b5c21370)
________________________________
From: Daniel Evans <daniel.fred.evans at gmail.com>
Sent: Thursday, April 18, 2024 9:03 AM
To: Joseph McGlinchy <jmcglinchy at hydrosat.com>
Cc: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] gdalwarp with RPCs causing bogus output

Hi Joe,

My minimal change is just to add the missing "RPC_DEM=srtm_12_05.tif" and remove the "RPC_HEIGHT=350". RPC_HEIGHT appears to override the use of any supplied DEM, and the docs at least hint that this is the expected behaviour.

```
gdalwarp --config CPL_DEBUG ON \
    -t_srs EPSG:32610 \
    -rpc \
    -to "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" \
    -to "RPC_DEM_MISSING_VALUE=0.001" \
    -to "RPC_FOOTPRINT='POLYGON ((-123.12941327726458 38.01872167010621, -121.67068342817124 37.82615456858018, -121.87575337280391 37.11164114368971, -123.32135086275996 37.30124603928108, -123.12941327726458 38.01872167010621))'" \
    -to "RPC_MAX_ITERATIONS=101" \
    -to "RPC_DEM=srtm_12_05.tif" \
    manyPts4000_SRTM_test_NptRPC.tiff \
    output.tiff
```

Changing to "RPC_DEM_SRS=EPSG:4326+5773" as Even suggested gives a noticeable change around the DEM locations of dams and lakes with the updated CRS, e.g. west and north of Livermore CA. Whether that's an improvement, or an undesired change due to the DEM being treated differently between generating the RPCs and using them, I'm not sure!

Daniel

On Thu, 18 Apr 2024 at 15:39, Joseph McGlinchy <jmcglinchy at hydrosat.com<mailto:jmcglinchy at hydrosat.com>> wrote:
Hi Daniel,

Thanks for trying with the data! I appreciate that. The gdal command I provided in the sample-gdal-call.txt file is the only one I could get to have "good" looking results. What command did you use to include the DEM?

If there has been a fix between 3.6 and 3.8.3 that helps with this, then I'm happy to try it. I'll give that a look too.

thanks!
Joe
________________________________
From: Daniel Evans <daniel.fred.evans at gmail.com<mailto:daniel.fred.evans at gmail.com>>
Sent: Thursday, April 18, 2024 5:44 AM
To: Joseph McGlinchy <jmcglinchy at hydrosat.com<mailto:jmcglinchy at hydrosat.com>>
Cc: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: Re: [gdal-dev] gdalwarp with RPCs causing bogus output

Hi Joe,

Trying your commands with GDAL 3.8.3, the results don't seem to be as bad as what you're reporting - I don't see big strips missing. Adding in the DEM file as Even mentioned, it seems to be doing what I'd expect (the correction isn't "right" because of the georeferencing offset, but it's doing what it's told using the underlying DEM).

Any possibility of trying a newer GDAL version in case there has been a fix since 3.6.0?

Cheers,
Daniel

On Thu, 18 Apr 2024 at 02:35, Joseph McGlinchy via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi Even,

Thank you for this great response. I'll try out some of those things you mention on the CRS of the DEM and correcting for the geoid; I had also been reading that any height values used in this process need to be heights above the ellipsoid.

I had seen good outputs from gdaltransform?, both forward and inverse, and can get back to the corner coordinates, center coordinates, etc. in both lon/lat and sample/line so it could be a subtlety of the DEM + CRS, or the more challenging issue of stable RPCs.

On the topic of stable RPCs, do you happen to know if it is enough to zero out the higher-order terms after the full set of coefficients are fit? Since there are squared terms in the higher-order coefficients, that could definitely be part of the issue, even if it works mathematically.

thanks!
Joe
________________________________
From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Wednesday, April 17, 2024 4:20 PM
To: Joseph McGlinchy <jmcglinchy at hydrosat.com<mailto:jmcglinchy at hydrosat.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: Re: [gdal-dev] gdalwarp with RPCs causing bogus output


Hi,


I haven't done myself that exercice but I know that computing RPC values that are stable enough might be challenging, so perhaps the issue is related to that


A few other remarks:

- your gdalwarp command line refers to  RPC_DEM_SRS and RPC_DEM_MISSING_VALUE but doesn't include a RPC_DEM itself, hence those are likely to be non effective

- you generally don't want to use both RPC_HEIGHT and RPC_DEM.  RPC_HEIGHT is essentially useful when you don't have a DEM available, and thus fallback taking an average elevation

- there's a subtlety regarding DEM. RPC reference for altitudes is WGS84 ellipsoidal height, not orthometric/MSL altitude. But DEM values use orthometric/MSL altitude, hence a geoid correction must be applied. So you'd rather want to use RPC_DEM_SRS=EPSG:4326+5773 for example to use the EGM96 geoid (cf https://github.com/OSGeo/gdal/issues/3298). That said, misusing orthometric altitude vs ellipsoidal height generally accounts for small shifts, not big ones

- you could use gdaltransform with all your -to parameter and input_with_RPCs.tiff to check at least that the forward RPC transformation path works correctly (the one from longitude, latitude -> column, line). And with -i to check the inverse RPC transformer. The inverse RPC transformer can have a hard time converging in montainous areas or for images off-nadir


Even


Le 17/04/2024 ? 23:30, Joseph McGlinchy via gdal-dev a ?crit :
Hello,

I am attempting to implement georegistration through RPC. I have the following information I've used to calibrate the RPC coefficients, using all terms for numerator and denominator for both sample and line equations.


  *
image grid, stored in tiff format with no geo-information associated with it, so it reflects the imaging orientation
  *
a 'ground' grid, which corresponds to the longitude/latitude coordinates for each pixel determined from a line-of-sight vector and imaging system coordinates where the pseudo-rays intersect the WGS84 geoid
  *
a random sample of up to 4000 image coordinate / object space coordinate pairs (I arrived at this number through trial and error; using all pixels explodes RAM)
  *
elevation extracted at the longitude/latitude coordinates from a DEM, in this case, SRTM, but have also tried using NASADEM

I am able to write out an image to EPSG:4326 by populating the RPC metadata and using the non-georeferenced image data. However, I am struggling to use gdalwarp? in a reliable way to orthorectify that data, let alone writing it out in a way that 'bakes in' the georegistration with the RPCs whether that is in EPSG:4326 or the local UTM zone. I see strips of the image "ripped out" with odd curves in various places throughout the image.

The only way I've been able to use gdalwarp? to write the image at all is with the following parameters (any DEM reference is to the SRTM DEM):

gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" -to "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list of polygon coordinates comprising the long/lat grid))'" -to "RPC_MAX_ITERATIONS=101" input_with_RPCs.tiff output.tiff

This is the only configuration i can use to run gdalwarp? successfully.  removing any single RPC_X tranformer option gives me bogus output. The RPC_HEIGHT value i specify above is not close to the mean or median elevation of the extent of my data; mean is ~195m and median is ~150m.

With the debug turned on, any other set of parameters gives me failed RPC convergence on several points. I am able to reproduce this regularly by specifying RPC_DEM=dem.tif, where dem.tif is the same data I used to extract elevation values when calibrating the RPCs. I am seeing normalized latitude and longitude values with magnitude > 1 (I checked every location in the image, based on the metadata, the range is not outside of [-1,1]), as well as normalized altitude values with magnitude > 1 (there are some, not many, that have magnitude of 1.75).

My workflow can be summarized as:


  1.
load grids (image data, longitude, latitude)
  2.
randomly sample up to 4000 points in image coordinates, object coordinates
     *
assign z-value from SRTM DEM
     *
evaluate if any of the points are in NODATA areas of SRTM (image is coastal, so there are NODATA areas for SRTM here), if so, remove those and generate more points
  3.
normalize coordinates of grids to be in [-1,1], recording offsets and scale
  4.
 calibrate RPC coefficients using all terms
  5.
write out GeoTIFF with image grid for pixels, along with RPC required metadata fields and CRS EPSG:4326

System information (please let me know if more is needed)
OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 x86_64) (Windows Subsystem for Linux)
GDAL 3.6.0 (python)

Thank you in advance for any insight into this process! I am happy to package up any of the data I am using, as well. I have placed the initial data from the end of Step 5 described above, along with some additional files, a sample gdalwarp call, and a file-list.txt, at https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing

If more is needed for anyone interested in having a look, please let me know and I'll upload.


Cheers,
Joe




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240418/0f368c55/attachment-0001.htm>

From andrew at aitchison.me.uk  Thu Apr 18 14:54:51 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Thu, 18 Apr 2024 22:54:51 +0100 (BST)
Subject: [gdal-dev] Adding a CI "stale" workflow for pull requests
 without activity
In-Reply-To: <8ba94aeb-76bb-4cd9-b854-43d105230b39@spatialys.com>
References: <8ba94aeb-76bb-4cd9-b854-43d105230b39@spatialys.com>
Message-ID: <2e1fd3b6-1b45-c12b-3bd5-fa653e6f0b82@aitchison.me.uk>

On Thu, 18 Apr 2024, Even Rouault via gdal-dev wrote:

> I'm proposing in https://github.com/OSGeo/gdal/pull/9693 that we add a CI 
> "stale" workflow for pull requests without activity. It is mostly a 
> copy&paste from QGIS similar workflow with the following changes:
> - restrict the scope to pull requests only and not tickets (although we could 
> potentially also do that for tickets that are in the "awaiting feedback" 
> state)
> - increase the period to tag a pull request as "stale" to 28 days without 
> activity. The stale bot adds a message in the PR explaining that, and that 
> they have an extra delay of 14 days to make it progress, otherwise it will be 
> automatically closed. So basically a PR without activity for 6 weeks will be 
> automatically closed. I think this is a fair delay.
>
> The rationale for that is that it makes the cognitive load of PR reviewers 
> lower by avoiding to have to read repeatedly a list of stale PRs, and it also 
> encourages contributors to either make their work progress towards completion 
> (or just make them realize that they don't have the bandwidth or motivation 
> to make it further progress, which is also fine).

I assume this is for PRs awaiting response from the requester,
not PRs awaiting a response from a reviewer ?

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Thu Apr 18 14:59:57 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Apr 2024 23:59:57 +0200
Subject: [gdal-dev] Adding a CI "stale" workflow for pull requests
 without activity
In-Reply-To: <2e1fd3b6-1b45-c12b-3bd5-fa653e6f0b82@aitchison.me.uk>
References: <8ba94aeb-76bb-4cd9-b854-43d105230b39@spatialys.com>
 <2e1fd3b6-1b45-c12b-3bd5-fa653e6f0b82@aitchison.me.uk>
Message-ID: <43319eb7-4ccd-4e29-998a-9054d8db1780@spatialys.com>


Le 18/04/2024 ? 23:54, Andrew C Aitchison via gdal-dev a ?crit?:
> On Thu, 18 Apr 2024, Even Rouault via gdal-dev wrote:
>
>> I'm proposing in https://github.com/OSGeo/gdal/pull/9693 that we add 
>> a CI "stale" workflow for pull requests without activity. It is 
>> mostly a copy&paste from QGIS similar workflow with the following 
>> changes:
>> - restrict the scope to pull requests only and not tickets (although 
>> we could potentially also do that for tickets that are in the 
>> "awaiting feedback" state)
>> - increase the period to tag a pull request as "stale" to 28 days 
>> without activity. The stale bot adds a message in the PR explaining 
>> that, and that they have an extra delay of 14 days to make it 
>> progress, otherwise it will be automatically closed. So basically a 
>> PR without activity for 6 weeks will be automatically closed. I think 
>> this is a fair delay.
>>
>> The rationale for that is that it makes the cognitive load of PR 
>> reviewers lower by avoiding to have to read repeatedly a list of 
>> stale PRs, and it also encourages contributors to either make their 
>> work progress towards completion (or just make them realize that they 
>> don't have the bandwidth or motivation to make it further progress, 
>> which is also fine).
>
> I assume this is for PRs awaiting response from the requester,
> not PRs awaiting a response from a reviewer ?

I don't believe the bot can understand that subtlety. At least that's a 
way for the submitter to remember to ping for submitters to give a review

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Apr 18 16:31:27 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 19 Apr 2024 01:31:27 +0200
Subject: [gdal-dev] Potential geopackage rtree problem on MacOS ARM64
In-Reply-To: <967c499f-2ffe-4b21-b8e3-1f94572fc1aa@spatialys.com>
References: <DB9PR09MB688754C843DDDA8F8B786EC5FD082@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <967c499f-2ffe-4b21-b8e3-1f94572fc1aa@spatialys.com>
Message-ID: <1da65f0e-9698-4a7c-98fa-8eb04e9621b7@spatialys.com>

ok, I believe I've now a fix in https://github.com/OSGeo/gdal/pull/9700 
. Probably a subtle multi-threading issue related to different memory 
ordering between M1 and Intel CPUs (or just that it was easier to 
trigger on M1)

Le 16/04/2024 ? 21:01, Even Rouault via gdal-dev a ?crit?:
>
> Hi,
>
> I've investigated that today, and I can quite reliably trigger a 
> similar error with our existing tests on CI, but this is impossible to 
> diagnose further without direct access to a machine where the error 
> triggers (when simulating taking the the error code path on Linux, the 
> fallback code works, whereas it doesn't on OSX Arm64, so there's 
> something quite subtle happening here). So if someone has a OSX?Arm64 
> and is willing to give me ssh access to it, that would be welcome.
>
> In the meantime, I've submitted 
> https://github.com/OSGeo/gdal/pull/9685 which is just a workaround to 
> disable (by default) the threaded RTree creation on that platform. It 
> can be explicitly enabled by setting OGR_GPKG_ALLOW_THREADED_RTREE to YES
>
> Even
>
> Le 16/04/2024 ? 08:13, Rahkonen Jukka via gdal-dev a ?crit?:
>>
>> Hi,
>>
>> It seems that at least two MacOS ARM64 users have faced a problem 
>> with the new, faster rtree creation method so maybe it is worth 
>> having a look. Obviously a big dataset and right hardware is needed 
>> for testing 
>> https://gis.stackexchange.com/questions/479958/how-to-fix-failed-to-prepare-sql-error-when-creating-gpkg-file-from-osm-extrac/479964#479964
>>
>> -Jukka Rahkonen-
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/b4407a74/attachment.htm>

From bontepaarden at gmail.com  Fri Apr 19 00:29:58 2024
From: bontepaarden at gmail.com (Paul Meems)
Date: Fri, 19 Apr 2024 09:29:58 +0200
Subject: [gdal-dev] gdal_contour: min value unexpected
In-Reply-To: <CAHNf2YQZ-5BuuMz7=FNkudA7hALeiL4X40izZYfc0gGLNvDHMA@mail.gmail.com>
References: <CAHNf2YQZ-5BuuMz7=FNkudA7hALeiL4X40izZYfc0gGLNvDHMA@mail.gmail.com>
Message-ID: <CAHNf2YQnhkaySyBaukFJx8DmovcT9NTPgo=MQjXVNzJZfZf-Kg@mail.gmail.com>

Hi List,

I tried my command on GDAL 3.8.4, released 2024/02/08.
And the results are the same. The lowest value is still incorrect.

I can't imagine this is a bug that was never noticed before.
So I assume I'm doing something wrong. But I can't figure it out.

Please give me some advice.

Regards,

Paul

Op vr 5 apr 2024 om 10:27 schreef Paul Meems <bontepaarden at gmail.com>:

> Hello List,
>
> I have a Surfer grid which I want to convert into polygons using
> gdal_contour.
> The min value of the lowest polygon is 0 which I didn't expect.
> In the next step, I calculate the average of the min and max values, and
> in this case that average is wrong.
>
> These are the values of the grid:
> Grid Size (X*Y):       113 x 121
> NoData Value:          1.70141E+38
> Minimum:               105000
> Maximum:               133000
>
> This is my command:
> gdal_contour -p -f "ESRI Shapefile" -fl -97000 -37000 23000 83000 89000
> 95000 101000 107000 113650 121000 129000 137000 143000 149000 155000 215000
> 275000 335000 -amin Min -amax Max "Surfer.grd" "tmp3p4f4i.shp"
>
> As you can see, the lowest value of the grid (105000) is between the
> values 101000 and 107000.
> So I would expect to have the min value of the shapefile be 101000 and the
> max value 107000.
>
> But the result is:
> [image: image.png]
> Min is 0 and max is 107000.
>
> I also tried setting the lowest value of the grid to 107000 (one of the
> level values) but that also resulted in a min value of 0.
>
> The polygons themselves are OK, just the min value of the lowest value is
> incorrect.
>
> I'm using GDAL 3.6.3, released 2023/03/07 on Windows.
>
> Why is this happening?
> Do I need to set an additional argument?
>
> Please advise.
>
> With regards,
>
> Paul
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/4261554a/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 5407 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/4261554a/attachment-0001.png>

From matteo.ghetta at gmail.com  Fri Apr 19 01:25:50 2024
From: matteo.ghetta at gmail.com (Matteo Ghetta)
Date: Fri, 19 Apr 2024 10:25:50 +0200
Subject: [gdal-dev] Export PG to GPKG with foreign keys
Message-ID: <95d7dbdf-3dd0-466f-939a-c9793ac17516@gmail.com>

Hi all,

I'm trying to export a PG table with several foreign keys to a geopackage.

What I tried so far are the native QGIS export and the QGIS Processing 
algorithm "Package layer" with the "Export related layers following..." 
option activated.

I'm checking ogr2ogr but I cannot see any option to include the export 
of the foreign keys. Is this option available in order to have a 
geopackage with the original table with all the other related tables?

Cheers and thanks for any suggestion!

Matteo

From even.rouault at spatialys.com  Fri Apr 19 02:32:29 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 19 Apr 2024 11:32:29 +0200
Subject: [gdal-dev] Export PG to GPKG with foreign keys
In-Reply-To: <95d7dbdf-3dd0-466f-939a-c9793ac17516@gmail.com>
References: <95d7dbdf-3dd0-466f-939a-c9793ac17516@gmail.com>
Message-ID: <b95be17e-68ee-40c3-99bc-735122810472@spatialys.com>


Le 19/04/2024 ? 10:25, Matteo Ghetta via gdal-dev a ?crit?:
> Hi all,
>
> I'm trying to export a PG table with several foreign keys to a 
> geopackage.
>
> What I tried so far are the native QGIS export and the QGIS Processing 
> algorithm "Package layer" with the "Export related layers 
> following..." option activated.
>
> I'm checking ogr2ogr but I cannot see any option to include the export 
> of the foreign keys. Is this option available in order to have a 
> geopackage with the original table with all the other related tables?

In short, no

It might be possible to use the relationship API of 
https://gdal.org/api/gdaldataset_cpp.html#_CPPv4NK11GDALDataset20GetRelationshipNamesE12CSLConstList 
to build something around it. But adding foreign key constraint 
themselves would be tricky as it requires to rewrite the CREATE TABLE.

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Fri Apr 19 02:46:07 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 19 Apr 2024 11:46:07 +0200
Subject: [gdal-dev] gdal_contour: min value unexpected
In-Reply-To: <CAHNf2YQnhkaySyBaukFJx8DmovcT9NTPgo=MQjXVNzJZfZf-Kg@mail.gmail.com>
References: <CAHNf2YQZ-5BuuMz7=FNkudA7hALeiL4X40izZYfc0gGLNvDHMA@mail.gmail.com>
 <CAHNf2YQnhkaySyBaukFJx8DmovcT9NTPgo=MQjXVNzJZfZf-Kg@mail.gmail.com>
Message-ID: <2efdbf5e-bab8-44a3-be99-d507edb8f2e0@spatialys.com>

Hi,
>
> I can't imagine this is a bug that was never noticed before.
Why? If everybody followed that reasoning nobody will report and hardly 
any bug would be fixed. (and there are a number of known bugs that 
nobody has had time to fix either)
> So I assume I'm doing something wrong. But I can't figure?it out.

The best is to file a ticket with all the elements to reproduce 
(including a dataset)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/7c19aed2/attachment.htm>

From bontepaarden at gmail.com  Fri Apr 19 06:48:20 2024
From: bontepaarden at gmail.com (Paul Meems)
Date: Fri, 19 Apr 2024 15:48:20 +0200
Subject: [gdal-dev] gdal_contour: min value unexpected
In-Reply-To: <2efdbf5e-bab8-44a3-be99-d507edb8f2e0@spatialys.com>
References: <CAHNf2YQZ-5BuuMz7=FNkudA7hALeiL4X40izZYfc0gGLNvDHMA@mail.gmail.com>
 <CAHNf2YQnhkaySyBaukFJx8DmovcT9NTPgo=MQjXVNzJZfZf-Kg@mail.gmail.com>
 <2efdbf5e-bab8-44a3-be99-d507edb8f2e0@spatialys.com>
Message-ID: <CAHNf2YTs7eB0MGB-XXFk=G8QuY6w+gW4gJ3p66P6uS+Ycma1+A@mail.gmail.com>

Thanks Even,

I create a ticket: https://github.com/OSGeo/gdal/issues/9705

With regards,

Paul

Op vr 19 apr 2024 om 11:46 schreef Even Rouault <even.rouault at spatialys.com
>:

> Hi,
>
>
> I can't imagine this is a bug that was never noticed before.
>
> Why? If everybody followed that reasoning nobody will report and hardly
> any bug would be fixed. (and there are a number of known bugs that nobody
> has had time to fix either)
>
> So I assume I'm doing something wrong. But I can't figure it out.
>
> The best is to file a ticket with all the elements to reproduce (including
> a dataset)
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/207390ea/attachment.htm>

From sean.gillies at gmail.com  Fri Apr 19 07:48:45 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Fri, 19 Apr 2024 08:48:45 -0600
Subject: [gdal-dev] Block cache and VRT sources
Message-ID: <CAOodmJpp1BUvmeRdt=fwFaG84Z9o0XozHqX8W9M1pwrxK0C2aQ@mail.gmail.com>

Happy Friday, folks!

Are the source rasters of a VRT added to the block cache such that
different VRTs using the same source can avoid reads from disk or the
network? Or is it intended that the VSI cache covers this need instead?

Thanks,

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/96ecf10a/attachment.htm>

From even.rouault at spatialys.com  Fri Apr 19 08:09:26 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 19 Apr 2024 17:09:26 +0200
Subject: [gdal-dev] Block cache and VRT sources
In-Reply-To: <CAOodmJpp1BUvmeRdt=fwFaG84Z9o0XozHqX8W9M1pwrxK0C2aQ@mail.gmail.com>
References: <CAOodmJpp1BUvmeRdt=fwFaG84Z9o0XozHqX8W9M1pwrxK0C2aQ@mail.gmail.com>
Message-ID: <d957009a-1fe2-4bf9-930e-d457f4bcb481@spatialys.com>

Sean,

Within a given GDALDataset opened on a VRT, if the VRT references 
several times the same source, only one GDALDataset will be opened for 
it, so you may benefit from the block cache mechanism (if it is 
triggered. VRTSource::IRasterIO() calls IRasterIO() on the source band, 
which doesn't necessarily always trigger block-based reading).? But if 
you open another VRT (or the same one), it will not share the same 
GDALDataset for sources that may be common with the first one, so no 
re-use of existing block cache. For network sources, the I/O cache at 
the /vsicurl/ level works however on filenames, not VSIFILE* instances, 
so you will save network reads

Even

Le 19/04/2024 ? 16:48, Sean Gillies via gdal-dev a ?crit?:
> Happy Friday, folks!
>
> Are the source rasters of a VRT added to the block cache such that 
> different VRTs using the same source can avoid reads from disk or the 
> network? Or is it intended that the VSI cache covers this need instead?
>
> Thanks,
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/60892224/attachment.htm>

From sean.gillies at gmail.com  Fri Apr 19 08:28:36 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Fri, 19 Apr 2024 09:28:36 -0600
Subject: [gdal-dev] Block cache and VRT sources
In-Reply-To: <d957009a-1fe2-4bf9-930e-d457f4bcb481@spatialys.com>
References: <CAOodmJpp1BUvmeRdt=fwFaG84Z9o0XozHqX8W9M1pwrxK0C2aQ@mail.gmail.com>
 <d957009a-1fe2-4bf9-930e-d457f4bcb481@spatialys.com>
Message-ID: <CAOodmJpo0n3hJDKbqzSsj0o28f4itwVB8zGjcsFXnbjNFCHQXg@mail.gmail.com>

Even,

Does the shared attribute of a VRT sourceFilename element not affect
caching at all? Is the cache avoided so that potentially stale data isn't
propagated, or for other reasons?

On Fri, Apr 19, 2024 at 9:09?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Sean,
>
> Within a given GDALDataset opened on a VRT, if the VRT references several
> times the same source, only one GDALDataset will be opened for it, so you
> may benefit from the block cache mechanism (if it is triggered.
> VRTSource::IRasterIO() calls IRasterIO() on the source band, which doesn't
> necessarily always trigger block-based reading).  But if you open another
> VRT (or the same one), it will not share the same GDALDataset for sources
> that may be common with the first one, so no re-use of existing block
> cache. For network sources, the I/O cache at the /vsicurl/ level works
> however on filenames, not VSIFILE* instances, so you will save network reads
>
> Even
> Le 19/04/2024 ? 16:48, Sean Gillies via gdal-dev a ?crit :
>
> Happy Friday, folks!
>
> Are the source rasters of a VRT added to the block cache such that
> different VRTs using the same source can avoid reads from disk or the
> network? Or is it intended that the VSI cache covers this need instead?
>
> Thanks,
>
>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/75c846df/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Apr 19 08:35:02 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 19 Apr 2024 17:35:02 +0200
Subject: [gdal-dev] Block cache and VRT sources
In-Reply-To: <CAOodmJpo0n3hJDKbqzSsj0o28f4itwVB8zGjcsFXnbjNFCHQXg@mail.gmail.com>
References: <CAOodmJpp1BUvmeRdt=fwFaG84Z9o0XozHqX8W9M1pwrxK0C2aQ@mail.gmail.com>
 <d957009a-1fe2-4bf9-930e-d457f4bcb481@spatialys.com>
 <CAOodmJpo0n3hJDKbqzSsj0o28f4itwVB8zGjcsFXnbjNFCHQXg@mail.gmail.com>
Message-ID: <0e4fc7e5-eccd-40b2-9ed7-0670b86f043b@spatialys.com>


Le 19/04/2024 ? 17:28, Sean Gillies a ?crit?:
> Even,
>
> Does the shared attribute of a VRT sourceFilename element not affect 
> caching at all?

If shared is set to 0, then one GDALDataset per VRTSource will be 
opened. This has little benefit.

The scope of sharing was initially greater since it extented to 
potentially several GDALDataset instance of VRT, but this wasn't safe in 
multithreaded scenarios where you would read one VRT in a thread, 
another one in another thread, but both would point to let's same the 
same TIFF GDALDataset. Hence the scope of sharing was reduced to a 
single GDALDataset VRT instance to be safe by default.

> Is the cache avoided so that potentially stale data isn't propagated, 
> or for other reasons?
Are you reacting to "if it is triggered. VRTSource::IRasterIO() calls 
IRasterIO() on the source band, which doesn't necessarily always trigger 
block-based reading" ?? I just meant that calling IRasterIO() on a 
GDALDataset/GDALRasterBand doesn't necessarily cause the block cache to 
trigger. This is dependent of the driver and the parameters of the 
request. And this isn't specific to use it from a VRT.
>
> On Fri, Apr 19, 2024 at 9:09?AM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Sean,
>
>     Within a given GDALDataset opened on a VRT, if the VRT references
>     several times the same source, only one GDALDataset will be opened
>     for it, so you may benefit from the block cache mechanism (if it
>     is triggered. VRTSource::IRasterIO() calls IRasterIO() on the
>     source band, which doesn't necessarily always trigger block-based
>     reading).? But if you open another VRT (or the same one), it will
>     not share the same GDALDataset for sources that may be common with
>     the first one, so no re-use of existing block cache. For network
>     sources, the I/O cache at the /vsicurl/ level works however on
>     filenames, not VSIFILE* instances, so you will save network reads
>
>     Even
>
>     Le 19/04/2024 ? 16:48, Sean Gillies via gdal-dev a ?crit?:
>>     Happy Friday, folks!
>>
>>     Are the source rasters of a VRT added to the block cache such
>>     that different VRTs using the same source can avoid reads from
>>     disk or the network? Or is it intended that the VSI cache covers
>>     this need instead?
>>
>>     Thanks,
>
>
>
> -- 
> Sean Gillies

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/76dfd00b/attachment.htm>

From sean.gillies at gmail.com  Fri Apr 19 08:54:49 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Fri, 19 Apr 2024 09:54:49 -0600
Subject: [gdal-dev] Block cache and VRT sources
In-Reply-To: <0e4fc7e5-eccd-40b2-9ed7-0670b86f043b@spatialys.com>
References: <CAOodmJpp1BUvmeRdt=fwFaG84Z9o0XozHqX8W9M1pwrxK0C2aQ@mail.gmail.com>
 <d957009a-1fe2-4bf9-930e-d457f4bcb481@spatialys.com>
 <CAOodmJpo0n3hJDKbqzSsj0o28f4itwVB8zGjcsFXnbjNFCHQXg@mail.gmail.com>
 <0e4fc7e5-eccd-40b2-9ed7-0670b86f043b@spatialys.com>
Message-ID: <CAOodmJqrKZ6uu50Y806wLCeyLT3MRzSoBoqSa+8BLcc0imKMWQ@mail.gmail.com>

Thanks, Even. I think I've got my head around it. Since I've never written
a driver, I've never fully learned the difference between IReadBlock and
IRasterIO or where one is used instead of the other. But I'm learning that
now.

On Fri, Apr 19, 2024 at 9:35?AM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 19/04/2024 ? 17:28, Sean Gillies a ?crit :
>
> Even,
>
> Does the shared attribute of a VRT sourceFilename element not affect
> caching at all?
>
> If shared is set to 0, then one GDALDataset per VRTSource will be opened.
> This has little benefit.
>
> The scope of sharing was initially greater since it extented to
> potentially several GDALDataset instance of VRT, but this wasn't safe in
> multithreaded scenarios where you would read one VRT in a thread, another
> one in another thread, but both would point to let's same the same TIFF
> GDALDataset. Hence the scope of sharing was reduced to a single GDALDataset
> VRT instance to be safe by default.
>
> Is the cache avoided so that potentially stale data isn't propagated, or
> for other reasons?
>
> Are you reacting to "if it is triggered. VRTSource::IRasterIO() calls
> IRasterIO() on the source band, which doesn't necessarily always trigger
> block-based reading" ?  I just meant that calling IRasterIO() on a
> GDALDataset/GDALRasterBand doesn't necessarily cause the block cache to
> trigger. This is dependent of the driver and the parameters of the request.
> And this isn't specific to use it from a VRT.
>
>
> On Fri, Apr 19, 2024 at 9:09?AM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Sean,
>>
>> Within a given GDALDataset opened on a VRT, if the VRT references several
>> times the same source, only one GDALDataset will be opened for it, so you
>> may benefit from the block cache mechanism (if it is triggered.
>> VRTSource::IRasterIO() calls IRasterIO() on the source band, which doesn't
>> necessarily always trigger block-based reading).  But if you open another
>> VRT (or the same one), it will not share the same GDALDataset for sources
>> that may be common with the first one, so no re-use of existing block
>> cache. For network sources, the I/O cache at the /vsicurl/ level works
>> however on filenames, not VSIFILE* instances, so you will save network reads
>>
>> Even
>> Le 19/04/2024 ? 16:48, Sean Gillies via gdal-dev a ?crit :
>>
>> Happy Friday, folks!
>>
>> Are the source rasters of a VRT added to the block cache such that
>> different VRTs using the same source can avoid reads from disk or the
>> network? Or is it intended that the VSI cache covers this need instead?
>>
>> Thanks,
>>
>>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/d328cd8a/attachment.htm>

From nraley at gaig.com  Fri Apr 19 14:52:59 2024
From: nraley at gaig.com (Raley, Nathan)
Date: Fri, 19 Apr 2024 21:52:59 +0000
Subject: [gdal-dev] Merging Multi-Band Drone Imagery
Message-ID: <CYXPR19MB8403E49E9CB4613CDA9B8A77B00D2@CYXPR19MB8403.namprd19.prod.outlook.com>

I have individual TIFS from the different sensors on the drone.  Currently, I have the R, G, NIR, and Redge bands.  Is the correct method to merge these into a multi-band image that I can then view as NDVI or apply other algorithms against just to use:

gdal_merge.py -separate R.TIF G.TIF NIR.TIF RE.TIF -o multispec.tif

I noticed that only the first band is listing as:
Band 1 Block=2580x1 Type=UInt16, ColorInterp=Gray
whereas all the others are listing:
Band 2 Block=2580x1 Type=UInt16, ColorInterp=Undefined

Any attempts to define them as ColorInterp=Gray through gdal_edit fails to yield any results.

I was just wanting to confirm I have the correct workflow here.  I haven't had any luck viewing the multispec.tif within QGIS by applying any RasterCalculations on the bands in the multispec.tif, so I was wanting to confirm I'm not doing anything incorrectly.

I've also attempted to pull out the blue band from the RGB camera, and add that to the multispec.tif as well, after scaling it from the 0-255 to the 0-65535, and that displays the blue band in there.  I can then ColorInterp bands 1, 2, and 3 as red, green, and blue, then it appears to let me specify the 4 and 5 bands as gray, but the colors are way off.

Can anyone offer some assistance?

Thanks,
Nathan

This email transmission, including any attachments, is intended solely for the addressee named above, and may contain confidential or privileged information. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please notify the sender immediately by reply email and destroy the message and its attachments.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240419/d85fe2b4/attachment.htm>

From j1 at jimenezshaw.com  Sat Apr 20 01:36:14 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sat, 20 Apr 2024 10:36:14 +0200
Subject: [gdal-dev] Merging Multi-Band Drone Imagery
In-Reply-To: <CYXPR19MB8403E49E9CB4613CDA9B8A77B00D2@CYXPR19MB8403.namprd19.prod.outlook.com>
References: <CYXPR19MB8403E49E9CB4613CDA9B8A77B00D2@CYXPR19MB8403.namprd19.prod.outlook.com>
Message-ID: <CADRrdKtVVOMqGssGD7CjGx6ESEH+bPUKZ06tmWxhBrkaApp+=A@mail.gmail.com>

Hi Nathan

Unfortunately there is not ColorInterp for NIR or RedEdge. But you can use
the "Description" of the bands. QGIS will use that name. I do not know how
to do it in gdal_merge (I did in C++).

About computing the NDVI, as far as I know there is no trick to do it in
the "Layer Styling". If anybody knows how to do it, please tell us! So the
solution is to use a raster calculator, and do the maths there.

Representing the "true" colors in QGIS of such images is not easy. Are they
radiometrically corrected? QGIS will try to adjust the min and max value of
each band, that are usually very different. You should adjust it properly.

Cheers

On Fri, 19 Apr 2024 at 23:52, Raley, Nathan via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> I have individual TIFS from the different sensors on the drone.
> Currently, I have the R, G, NIR, and Redge bands.  Is the correct method to
> merge these into a multi-band image that I can then view as NDVI or apply
> other algorithms against just to use:
>
> gdal_merge.py -separate R.TIF G.TIF NIR.TIF RE.TIF -o multispec.tif
>
> I noticed that only the first band is listing as:
> Band 1 Block=2580x1 Type=UInt16, ColorInterp=Gray
> whereas all the others are listing:
> Band 2 Block=2580x1 Type=UInt16, ColorInterp=Undefined
>
> Any attempts to define them as ColorInterp=Gray through gdal_edit fails to
> yield any results.
>
> I was just wanting to confirm I have the correct workflow here.  I haven?t
> had any luck viewing the multispec.tif within QGIS by applying any
> RasterCalculations on the bands in the multispec.tif, so I was wanting to
> confirm I?m not doing anything incorrectly.
>
> I?ve also attempted to pull out the blue band from the RGB camera, and add
> that to the multispec.tif as well, after scaling it from the 0-255 to the
> 0-65535, and that displays the blue band in there.  I can then ColorInterp
> bands 1, 2, and 3 as red, green, and blue, then it appears to let me
> specify the 4 and 5 bands as gray, but the colors are way off.
>
> Can anyone offer some assistance?
>
>
>
> Thanks,
>
> Nathan
>
>
> ------------------------------
> This email transmission, including any attachments, is intended solely for
> the addressee named above, and may contain confidential or privileged
> information. If you are not the intended recipient, be aware that any
> disclosure, copying, distribution or use of the contents of this e-mail is
> prohibited. If you have received this e-mail in error, please notify the
> sender immediately by reply email and destroy the message and its
> attachments.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240420/84b966b4/attachment.htm>

From matteo.ghetta at gmail.com  Sun Apr 21 22:59:29 2024
From: matteo.ghetta at gmail.com (Matteo Ghetta)
Date: Mon, 22 Apr 2024 07:59:29 +0200
Subject: [gdal-dev] Export PG to GPKG with foreign keys
In-Reply-To: <b95be17e-68ee-40c3-99bc-735122810472@spatialys.com>
References: <95d7dbdf-3dd0-466f-939a-c9793ac17516@gmail.com>
 <b95be17e-68ee-40c3-99bc-735122810472@spatialys.com>
Message-ID: <02acb4b0-7686-43ee-8c3e-1097db3eec75@gmail.com>

Hi Even,

thanks for the reply! I had this feeling, but now I'm sure

Cheers and thanks

Matteo

On 4/19/24 11:32, Even Rouault wrote:
> 
> Le 19/04/2024 ? 10:25, Matteo Ghetta via gdal-dev a ?crit?:
>> Hi all,
>>
>> I'm trying to export a PG table with several foreign keys to a 
>> geopackage.
>>
>> What I tried so far are the native QGIS export and the QGIS Processing 
>> algorithm "Package layer" with the "Export related layers 
>> following..." option activated.
>>
>> I'm checking ogr2ogr but I cannot see any option to include the export 
>> of the foreign keys. Is this option available in order to have a 
>> geopackage with the original table with all the other related tables?
> 
> In short, no
> 
> It might be possible to use the relationship API of 
> https://gdal.org/api/gdaldataset_cpp.html#_CPPv4NK11GDALDataset20GetRelationshipNamesE12CSLConstList to build something around it. But adding foreign key constraint themselves would be tricky as it requires to rewrite the CREATE TABLE.
> 
> Even
> 
> 

From mirza.nawandish at haritaevi.com  Mon Apr 22 03:25:47 2024
From: mirza.nawandish at haritaevi.com (Shahrukh Mirza Nawandish)
Date: Mon, 22 Apr 2024 13:25:47 +0300
Subject: [gdal-dev] Issue with 3D GeoJSON to 3D DXF Conversion
Message-ID: <42751713781203@mail.yandex.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/49daee3a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: input.geojson
Type: application/json
Size: 1373 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/49daee3a/attachment.json>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 22 04:18:18 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 22 Apr 2024 11:18:18 +0000
Subject: [gdal-dev] Issue with 3D GeoJSON to 3D DXF Conversion
In-Reply-To: <42751713781203@mail.yandex.com>
References: <42751713781203@mail.yandex.com>
Message-ID: <DB9PR09MB6887D1C33E89EB0606FD177FFD122@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

By reading the documentation https://gdal.org/drivers/vector/dxf.html#dxf-writer what you see is expected. --config DXF_WRITE_HATCH FALSE is writing polylines and polylines have vertices with different Z coordinates. --config DXF_WRITE_HATCH TRUE writes polygons. The polygons have same elevation value at each vertex, and that is also documented:
?You may need to do this [to use DXF_WRITE_HATCH FALSE] if your geometries do not have a constant elevation, as the DXF HATCH entity cannot represent such geometries.?

-Jukka Rahkonen-



L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Shahrukh Mirza Nawandish via gdal-dev
L?hetetty: maanantai 22. huhtikuuta 2024 13.26
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Issue with 3D GeoJSON to 3D DXF Conversion

Dear GDAL Team,

I hope this email finds you well. I'm encountering an issue converting 3D GeoJSON polygons to DXF format using ogr2ogr. During conversion, the elevation data becomes uniform for all points within the polygon. Additionally, when using "DXF_WRITE_HATCH," the geometry becomes a polyline instead of a polygon.

Attached are the GeoJSON data and conversion code for your reference. Could you please assist in resolving this discrepancy?
ogr2ogr -f "DXF" output.dxf input.geojson -t_srs EPSG:32737 --config DXF_WRITE_HATCH FALSE


Thank you for your attention to this matter.

--
Sayg?lar?mla / Kind Regards

Shahrukh Mirza NAWANDISH
Havac?l?k Bilgi Sistemleri / Aeronautical Information Systems
Yaz?l?m Geli?tirme Uzm. Yrd. / Software Development Assist. Specialist
Bilgisayar Programc?s? / Computer Programmer MCA

T:+90 312 266 66 98
M:+90 538 519 72 67
 E:mirza.nawandish at haritaevi.com
?: Ankara-Istanbul-Bucharest<https://www.haritaevi.com/en/about-us/contact>
www.haritaevi.com<http://www.haritaevi.com/>
www.obstacleanalyze.com<http://www.obstacleanalyze.com/>
www.aixm.haritaevi.com<https://aixm.haritaevi.com/>
www.aerodatamarket.com<http://www.aerodatamarket.com/>
[https://avatars.mds.yandex.net/get-mail-signature/2434044/d24bf65965f2be07edc47ff3c25b0348/orig]<https://www.instagram.com/haritaevi/?hl=tr>[https://avatars.mds.yandex.net/get-mail-signature/200369/c75763261eac7fb671922d147573080b/orig]<https://www.linkedin.com/company/haritaevi-havac%C4%B1l%C4%B1k-m%C3%BChendislik-a-%C5%9F/>[https://avatars.mds.yandex.net/get-mail-signature/2434044/1cd6e615d44979bf9b0d6b0ea9c47182/orig]<https://twitter.com/haritaevi>[https://avatars.mds.yandex.net/get-mail-signature/232821/ec6941b191f27730d3a5f92fd846beb4/orig]<https://www.youtube.com/channel/UCZHA_PmyMLg__KOfNgOLJYg?view_as=subscriber>[https://avatars.mds.yandex.net/get-mail-signature/232821/0545b2da2dc9f49f532774615ec45e51/orig]<https://www.facebook.com/haritaevi/>[https://www.haritaevi.com/wp-content/uploads/2022/02/disclaimer_1.png]<https://www.haritaevi.com/disclaimer> [https://avatars.mds.yandex.net/get-mail-signature/2434044/58c47a3a908e28fdb209656734002f36/orig] <https://fidic.org/> [https://avatars.mds.yandex.net/get-mail-signature/2423644/1ccfc2184635533811e43aeeae4bf6c1/orig] <https://www.efcanet.org/> [https://avatars.mds.yandex.net/get-mail-signature/2423644/405b95fb41fb8db77dcee35ff542f333/orig] <https://www.haritaevi.com/en/about-us/quality-policy> [https://avatars.mds.yandex.net/get-mail-signature/1539903/c89e02562564f32028015473ea475742/orig] <https://www.haritaevi.com/en/about-us/information-security-policy>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/f9377961/attachment-0001.htm>

From even.rouault at spatialys.com  Mon Apr 22 05:12:33 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Apr 2024 14:12:33 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
Message-ID: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>

Hi,

I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.

The NEWS file is here:

 ? https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md

For packagers, 
https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may 
make it more attractive to build some drivers that typically have heavy 
dependencies as plugins, installable in separate packages, due to the 
load time penalty having being improved. It is let to the appreciation 
of packagers to decide which drivers are worth building as plugins 
installable in a separate package.
You may also pass CMake options 
([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so 
user get a hint of which package they need to install when GDAL detects 
that a file may be opened by a plugin which is not available on the file 
system but known to have been built as a plugin. Cf 
https://gdal.org/development/building_from_source.html#deferred-loaded-plugins 
for more details.

For end-users, the following utilities have been updated to use a new 
argument parsing framework: gdaladdo, gdalinfo, gdal_translate, 
gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo, 
ogr2ogr, sozip.
This helps detecting errors such as specifying twice an argument that 
should be specified once (where generally the last instance was the one 
used). While we have tried to retain backwards compatibility for nominal 
use cases, obviously if you have scripts that accidentally specify an 
argument several times whereas it should be specified at most once, they 
will have to be corrected.

Docker images with 3.9.0beta1 are currently cooking.

master is now marked as 3.10.0dev, and the release/3.9 branch has been 
created. All bugfixes for 3.9 should be backported into it.

Source snapshots at:

- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
- https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip

Autotest snapshots:

- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From rob.hewy at gmail.com  Mon Apr 22 06:18:59 2024
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Mon, 22 Apr 2024 06:18:59 -0700
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
Message-ID: <CAG_Q50ShdO9WL1gxnHKSgsCKgNAAuGPsFTwk0TeN0ZyjUJAYLg@mail.gmail.com>

Any advice on how to become a tester such as testing on prefered OS and
setup?

I have access to a proxmox server but I usually stick to LINUX OSes.

Or is at easy as following the notes here:
https://gdal.org/development/dev_environment.html

Ubuntu 22.x is the goto right now.

Any advice would be appreciated.

Rob


On Mon, Apr 22, 2024 at 5:12?AM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>
> The NEWS file is here:
>
>    https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md
>
> For packagers,
> https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may
> make it more attractive to build some drivers that typically have heavy
> dependencies as plugins, installable in separate packages, due to the
> load time penalty having being improved. It is let to the appreciation
> of packagers to decide which drivers are worth building as plugins
> installable in a separate package.
> You may also pass CMake options
> ([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so
> user get a hint of which package they need to install when GDAL detects
> that a file may be opened by a plugin which is not available on the file
> system but known to have been built as a plugin. Cf
>
> https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
> for more details.
>
> For end-users, the following utilities have been updated to use a new
> argument parsing framework: gdaladdo, gdalinfo, gdal_translate,
> gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo,
> ogr2ogr, sozip.
> This helps detecting errors such as specifying twice an argument that
> should be specified once (where generally the last instance was the one
> used). While we have tried to retain backwards compatibility for nominal
> use cases, obviously if you have scripts that accidentally specify an
> argument several times whereas it should be specified at most once, they
> will have to be corrected.
>
> Docker images with 3.9.0beta1 are currently cooking.
>
> master is now marked as 3.10.0dev, and the release/3.9 branch has been
> created. All bugfixes for 3.9 should be backported into it.
>
> Source snapshots at:
>
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
> - https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip
>
> Autotest snapshots:
>
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/e32fa785/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 22 06:25:56 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Apr 2024 15:25:56 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <CAG_Q50ShdO9WL1gxnHKSgsCKgNAAuGPsFTwk0TeN0ZyjUJAYLg@mail.gmail.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <CAG_Q50ShdO9WL1gxnHKSgsCKgNAAuGPsFTwk0TeN0ZyjUJAYLg@mail.gmail.com>
Message-ID: <f1ed6632-63ce-4ec8-9b85-5609c63b370a@spatialys.com>

Robert,

If you want to use ready-made binaries, then using Conda gdal-master 
builds might be the easiest way for all major platforms: 
https://gdal.org/download.html#gdal-master-conda-builds . They track 
gdal master, but that's more or less the same as 3.9.0beta1 right now.

Otherwise if you want to build from source, you can take inspiration 
from the build recipe we use for continuous integration:

https://github.com/OSGeo/gdal/blob/master/.github/workflows/ubuntu_22.04/Dockerfile.ci
https://github.com/OSGeo/gdal/blob/master/.github/workflows/ubuntu_22.04/build.sh

(you don't necessarily need all the dependencies)

And as I mentioned, Docker images are building. Should be ready by tomorrow.

Even

Le 22/04/2024 ? 15:18, Robert Hewlett via gdal-dev a ?crit?:
> Any advice on how?to become a tester such as testing on prefered OS 
> and setup?
>
> I have access to a proxmox server but I usually stick to LINUX OSes.
>
> Or is at easy as following?the notes here:
> https://gdal.org/development/dev_environment.html
>
> Ubuntu 22.x is the goto right now.
>
> Any advice would be appreciated.
>
> Rob
>
>
> On Mon, Apr 22, 2024 at 5:12?AM Even Rouault via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>     Hi,
>
>     I've prepared a beta1 of GDAL 3.9.0 to get feedback from early
>     testers.
>
>     The NEWS file is here:
>
>     https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md
>
>     For packagers,
>     https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html
>     may
>     make it more attractive to build some drivers that typically have
>     heavy
>     dependencies as plugins, installable in separate packages, due to the
>     load time penalty having being improved. It is let to the
>     appreciation
>     of packagers to decide which drivers are worth building as plugins
>     installable in a separate package.
>     You may also pass CMake options
>     ([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so
>     user get a hint of which package they need to install when GDAL
>     detects
>     that a file may be opened by a plugin which is not available on
>     the file
>     system but known to have been built as a plugin. Cf
>     https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
>
>     for more details.
>
>     For end-users, the following utilities have been updated to use a new
>     argument parsing framework: gdaladdo, gdalinfo, gdal_translate,
>     gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo,
>     ogr2ogr, sozip.
>     This helps detecting errors such as specifying twice an argument that
>     should be specified once (where generally the last instance was
>     the one
>     used). While we have tried to retain backwards compatibility for
>     nominal
>     use cases, obviously if you have scripts that accidentally specify an
>     argument several times whereas it should be specified at most
>     once, they
>     will have to be corrected.
>
>     Docker images with 3.9.0beta1 are currently cooking.
>
>     master is now marked as 3.10.0dev, and the release/3.9 branch has
>     been
>     created. All bugfixes for 3.9 should be backported into it.
>
>     Source snapshots at:
>
>     - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
>     - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
>     - https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip
>
>     Autotest snapshots:
>
>     - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
>     - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip
>
>     Even
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/067c0e0a/attachment.htm>

From nraley at gaig.com  Mon Apr 22 07:19:54 2024
From: nraley at gaig.com (Raley, Nathan)
Date: Mon, 22 Apr 2024 14:19:54 +0000
Subject: [gdal-dev] Question on building multi band composite and going back
 to RGB GeoTiff
Message-ID: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>

I currently have a RGB geotiff composite image that has a Byte datatype.  I also have individual band images for R, G, Redge, and NIR that are UInt16 datatypes.  Since I'm missing the Blue band from the individual bands, I was attempting to extract the blue band from the RGB composite image, scale it up to the UInt16 datatype, and build a composite VRT with R, G, B, NIR, RE bands included in it.  I was then attempting to extract the RGB bands from the multispec VRT in order to see if the process was working as intended, but I'm getting an extremely blue image.

Can anyone shed some light as to what I may be doing wrong here?

I started by building a VRT for each band:
gdal_translate source_RGB.tif b.vrt -ot UInt16 -of VRT -b 3 -scale 0 255 0 65535
gdalbuildvrt -b 1 r.vrt source_R.tif
gdalbuildvrt -b 1 g.vrt source_G.tif
gdalbuildvrt -b 1 nir.vrt source_NIR.tif
gdalbuildvrt -b 1 re.vrt source_RE.tif

I then merged the VRTs:
gdalbuildvrt -separate multispec.vrt r.vrt g.vrt b.vrt nir.vrt re.vrt

I now have a multispec.vrt with the R, G, B, NIR, and RE bands, all with a UInt16 datatype.

Now, I attempted to rebuild a RGB GeoTiff from the composite VRT with something like:
gdal_translate -ot Byte -of GTiff -b 1 -b 2 -b 3 -scale 0 65535 0 255 -co PHOTOMETRIC=RGB multispec.vrt multispec.tif

Viewing the result in QGIS appears overly blue.  What am I doing wrong here?

Thanks,
Nathan

This email transmission, including any attachments, is intended solely for the addressee named above, and may contain confidential or privileged information. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please notify the sender immediately by reply email and destroy the message and its attachments.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/235b1515/attachment-0001.htm>

From daniel.fred.evans at gmail.com  Mon Apr 22 07:28:55 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Mon, 22 Apr 2024 15:28:55 +0100
Subject: [gdal-dev] Question on building multi band composite and going
 back to RGB GeoTiff
In-Reply-To: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>
References: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>
Message-ID: <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>

Hi Nathan,

My initial suspicion might just be that the scaling the data provider did
to go from the raw data to a human-eye-friendly RGB composite isn't the
conversion you're assuming.

I know that with the data I regularly work with, it may be provided as
Uint16, but the data range doesn't extend all the way to 65535.

If you compare the values in the separate R and G images to the RGB
composite, do they appear to match the conversion you're assuming, or is
there a different scaling (and possibly offset)?

Cheers,
Daniel

On Mon, 22 Apr 2024, 15:20 Raley, Nathan via gdal-dev, <
gdal-dev at lists.osgeo.org> wrote:

> I currently have a RGB geotiff composite image that has a Byte datatype.
> I also have individual band images for R, G, Redge, and NIR that are UInt16
> datatypes.  Since I?m missing the Blue band from the individual bands, I
> was attempting to extract the blue band from the RGB composite image, scale
> it up to the UInt16 datatype, and build a composite VRT with R, G, B, NIR,
> RE bands included in it.  I was then attempting to extract the RGB bands
> from the multispec VRT in order to see if the process was working as
> intended, but I?m getting an extremely blue image.
>
> Can anyone shed some light as to what I may be doing wrong here?
>
> I started by building a VRT for each band:
>
> gdal_translate source_RGB.tif b.vrt -ot UInt16 -of VRT -b 3 -scale 0 255 0
> 65535
>
> gdalbuildvrt -b 1 r.vrt source_R.tif
> gdalbuildvrt -b 1 g.vrt source_G.tif
> gdalbuildvrt -b 1 nir.vrt source_NIR.tif
> gdalbuildvrt -b 1 re.vrt source_RE.tif
>
>
>
> I then merged the VRTs:
>
> gdalbuildvrt -separate multispec.vrt r.vrt g.vrt b.vrt nir.vrt re.vrt
>
>
>
> I now have a multispec.vrt with the R, G, B, NIR, and RE bands, all with a
> UInt16 datatype.
>
>
>
> Now, I attempted to rebuild a RGB GeoTiff from the composite VRT with
> something like:
>
> gdal_translate -ot Byte -of GTiff -b 1 -b 2 -b 3 -scale 0 65535 0 255 -co
> PHOTOMETRIC=RGB multispec.vrt multispec.tif
>
>
>
> Viewing the result in QGIS appears overly blue.  What am I doing wrong
> here?
>
>
>
> Thanks,
>
> Nathan
>
>
> ------------------------------
> This email transmission, including any attachments, is intended solely for
> the addressee named above, and may contain confidential or privileged
> information. If you are not the intended recipient, be aware that any
> disclosure, copying, distribution or use of the contents of this e-mail is
> prohibited. If you have received this e-mail in error, please notify the
> sender immediately by reply email and destroy the message and its
> attachments.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/a0bd92c2/attachment.htm>

From daniel.fred.evans at gmail.com  Mon Apr 22 07:30:40 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Mon, 22 Apr 2024 15:30:40 +0100
Subject: [gdal-dev] gdalwarp with RPCs causing bogus output
In-Reply-To: <AM9PR07MB7106F33DC9DBDED2A44ED4DAA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
References: <AM9PR07MB7106CB04CA1DA76705A6BC59A10F2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <edcb37f5-cf1e-4b53-8408-aa65cb5cc030@spatialys.com>
 <AM9PR07MB710643932259277B2F1D0030A10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <CANnaQabdZqprrRqFiJ=YgR6oRRaJ9jNFLAWgBncoF=-TzCCbJA@mail.gmail.com>
 <AM9PR07MB71066293982276F82BE8186AA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
 <CANnaQaZyFyTQGOFfbrOUWJAfHX=iSpHtoR6ow6Cj5ErDBovbCw@mail.gmail.com>
 <AM9PR07MB7106F33DC9DBDED2A44ED4DAA10E2@AM9PR07MB7106.eurprd07.prod.outlook.com>
Message-ID: <CANnaQaasTetpcgqM5HcYTbPva3TCwSxBrghAoWwYLxjjU+d1iQ@mail.gmail.com>

Hi Joe,

Now you've pointed them out, I do see those little bits in the north east.
I hadn't zoomed in enough on the right area. Sadly, I've not much advice to
offer on whether it's expected, and/or how to avoid it.

(Apologies for the slow and unhelpful reply!)

Cheers,
Daniel

On Thu, 18 Apr 2024, 19:02 Joseph McGlinchy, <jmcglinchy at hydrosat.com>
wrote:

> Hi Daniel,
>
> Thank you.  I tried your commands exactly with gdal 3.8.3 and am seeing
> the odd type of output I was describing in the northeastern most reaches of
> the images. Would you be willing to verify if you see that or not?
>
> Here is the result of the debug messaging. I think a screenshot which
> shows what I see results in the message being over the size limit.
>
> GDAL: GDALOpen(../manyPts4000_SRTM_test_NptRPC.tiff, this=0x5584b5c21370)
> succeeds as GTiff.
> GDAL: GDALOpen(output_gdal38.tiff, this=0x5584b5c4c950) succeeds as GTiff.
> GDALWARP: Defining SKIP_NOSOURCE=YES
> Processing ../manyPts4000_SRTM_test_NptRPC.tiff [1/1] : 0WARP: Copying
> metadata from first source to destination dataset
> WARP: Set SOURCE_EXTRA=5 warping options due to RPC warping
> WARP: Set SAMPLE_STEPS=ALL warping options due to RPC DEM warping
> GDAL: GDALOpen(srtm_12_05.tif, this=0x5584b5c522a0) succeeds as GTiff.
> RPC: Short-circuiting coordinate transformation from DEM SRS to WGS 84 due
> to apparent nop
> GDAL: GDAL_CACHEMAX = 1504 MB
> GTiff: ScanDirectories()
> GDAL: GDALDefaultOverviews::OverviewScan()
> Using internal nodata values (e.g. 0) for image
> ../manyPts4000_SRTM_test_NptRPC.tiff.
> WARP: band=0 dstNoData=0.000000
> RPC: Failed Iterations 101: Got: -121.6743548438707,37.81305392714289
>  Offset=0.200509,-7.35862
> WARP: At least one point failed after direct transform
> RPC: Failed Iterations 101: Got: -121.6743548438707,37.81305392714289
>  Offset=0.200509,-7.35862
> RPC: Failed Iterations 101: Got: -121.6756957607436,37.81515846637773
>  Offset=-0.0317686,-12.1573
> RPC: Failed Iterations 101: Got: -121.6759688314497,37.81397923057818
>  Offset=-0.0782949,-21.942
> RPC: Failed Iterations 101: Got: -121.6760567085541,37.81393132082147
>  Offset=-0.0200723,-13.2144
> RPC: Failed Iterations 101: Got: -121.6758750148136,37.8150256294207
>  Offset=0.0121725,-8.26664
> RPC: Failed Iterations 101: Got: -121.6758055299304,37.81513471897441
>  Offset=0.0111142,-9.29081
> RPC: Failed Iterations 101: Got: -121.6757471773221,37.81517816256341
>  Offset=0.00786933,-9.66179
> RPC: Failed Iterations 101: Got: -121.6757610763044,37.81516845364766
>  Offset=0.00852169,-9.58453
> GDAL: GDALSuggestedWarpOutput(): 1 out of 3249 points failed to transform.
> GDAL: GDALWarpKernel()::GWKNearestShort() Src=0,0,2383x2800
> Dst=0,0,2411x3318
> ...10...20...30...40...50GDAL: GDALWarpKernel()::GWKNearestShort()
> Src=1710,0,1460x1401 Dst=2411,0,1205x1659
> ...60GDAL: GDALWarpKernel()::GWKNearestShort() Src=2833,0,1263x2458
> Dst=3616,0,1206x829
> ...GDAL: GDALWarpKernel()::GWKNearestShort() Src=2995,148,1101x1054
> Dst=3616,829,1206x830
> 70..GDAL: GDALWarpKernel()::GWKNearestShort() Src=2036,993,2060x1807
> Dst=2411,1659,2411x1659
> .80...90...100 - done.
> GDAL: GDALClose(srtm_12_05.tif, this=0x5584b5c522a0)
> GDAL: Flushing dirty blocks:
> 0...10...20...30...40...50...60...70...80...90...100 - done.
> GDAL: GDALClose(output_gdal38.tiff, this=0x5584b5c4c950)
> GDAL: GDALClose(../manyPts4000_SRTM_test_NptRPC.tiff, this=0x5584b5c21370)
> ------------------------------
> *From:* Daniel Evans <daniel.fred.evans at gmail.com>
> *Sent:* Thursday, April 18, 2024 9:03 AM
> *To:* Joseph McGlinchy <jmcglinchy at hydrosat.com>
> *Cc:* Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdalwarp with RPCs causing bogus output
>
> Hi Joe,
>
> My minimal change is just to add the missing "RPC_DEM=srtm_12_05.tif" and
> remove the "RPC_HEIGHT=350". RPC_HEIGHT appears to override the use of any
> supplied DEM, and the docs at least hint that this is the expected
> behaviour.
>
> ```
> gdalwarp --config CPL_DEBUG ON \
>     -t_srs EPSG:32610 \
>     -rpc \
>     -to "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" \
>     -to "RPC_DEM_MISSING_VALUE=0.001" \
>     -to "RPC_FOOTPRINT='POLYGON ((-123.12941327726458 38.01872167010621,
> -121.67068342817124 37.82615456858018, -121.87575337280391
> 37.11164114368971, -123.32135086275996 37.30124603928108,
> -123.12941327726458 38.01872167010621))'" \
>     -to "RPC_MAX_ITERATIONS=101" \
>     -to "RPC_DEM=srtm_12_05.tif" \
>     manyPts4000_SRTM_test_NptRPC.tiff \
>     output.tiff
> ```
>
> Changing to "RPC_DEM_SRS=EPSG:4326+5773" as Even suggested gives a
> noticeable change around the DEM locations of dams and lakes with the
> updated CRS, e.g. west and north of Livermore CA. Whether that's an
> improvement, or an undesired change due to the DEM being treated
> differently between generating the RPCs and using them, I'm not sure!
>
> Daniel
>
> On Thu, 18 Apr 2024 at 15:39, Joseph McGlinchy <jmcglinchy at hydrosat.com>
> wrote:
>
> Hi Daniel,
>
> Thanks for trying with the data! I appreciate that. The gdal command I
> provided in the sample-gdal-call.txt file is the only one I could get to
> have "good" looking results. What command did you use to include the DEM?
>
> If there has been a fix between 3.6 and 3.8.3 that helps with this, then
> I'm happy to try it. I'll give that a look too.
>
> thanks!
> Joe
> ------------------------------
> *From:* Daniel Evans <daniel.fred.evans at gmail.com>
> *Sent:* Thursday, April 18, 2024 5:44 AM
> *To:* Joseph McGlinchy <jmcglinchy at hydrosat.com>
> *Cc:* Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdalwarp with RPCs causing bogus output
>
> Hi Joe,
>
> Trying your commands with GDAL 3.8.3, the results don't seem to be as bad
> as what you're reporting - I don't see big strips missing. Adding in the
> DEM file as Even mentioned, it seems to be doing what I'd expect (the
> correction isn't "right" because of the georeferencing offset, but it's
> doing what it's told using the underlying DEM).
>
> Any possibility of trying a newer GDAL version in case there has been a
> fix since 3.6.0?
>
> Cheers,
> Daniel
>
> On Thu, 18 Apr 2024 at 02:35, Joseph McGlinchy via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi Even,
>
> Thank you for this great response. I'll try out some of those things you
> mention on the CRS of the DEM and correcting for the geoid; I had also been
> reading that any height values used in this process need to be heights
> above the ellipsoid.
>
> I had seen good outputs from gdaltransform?, both forward and inverse,
> and can get back to the corner coordinates, center coordinates, etc. in
> both lon/lat and sample/line so it could be a subtlety of the DEM + CRS, or
> the more challenging issue of stable RPCs.
>
> On the topic of stable RPCs, do you happen to know if it is enough to zero
> out the higher-order terms after the full set of coefficients are fit?
> Since there are squared terms in the higher-order coefficients, that could
> definitely be part of the issue, even if it works mathematically.
>
> thanks!
> Joe
> ------------------------------
> *From:* Even Rouault <even.rouault at spatialys.com>
> *Sent:* Wednesday, April 17, 2024 4:20 PM
> *To:* Joseph McGlinchy <jmcglinchy at hydrosat.com>; gdal-dev at lists.osgeo.org
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] gdalwarp with RPCs causing bogus output
>
>
> Hi,
>
>
> I haven't done myself that exercice but I know that computing RPC values
> that are stable enough might be challenging, so perhaps the issue is
> related to that
>
>
> A few other remarks:
>
> - your gdalwarp command line refers to  RPC_DEM_SRS and
> RPC_DEM_MISSING_VALUE but doesn't include a RPC_DEM itself, hence those are
> likely to be non effective
>
> - you generally don't want to use both RPC_HEIGHT and RPC_DEM.  RPC_HEIGHT
> is essentially useful when you don't have a DEM available, and thus
> fallback taking an average elevation
>
> - there's a subtlety regarding DEM. RPC reference for altitudes is WGS84
> ellipsoidal height, not orthometric/MSL altitude. But DEM values use
> orthometric/MSL altitude, hence a geoid correction must be applied. So
> you'd rather want to use RPC_DEM_SRS=EPSG:4326+5773 for example to use the
> EGM96 geoid (cf https://github.com/OSGeo/gdal/issues/3298). That said,
> misusing orthometric altitude vs ellipsoidal height generally accounts for
> small shifts, not big ones
>
> - you could use gdaltransform with all your -to parameter and
> input_with_RPCs.tiff to check at least that the forward RPC transformation
> path works correctly (the one from longitude, latitude -> column, line).
> And with -i to check the inverse RPC transformer. The inverse RPC
> transformer can have a hard time converging in montainous areas or for
> images off-nadir
>
>
> Even
>
>
> Le 17/04/2024 ? 23:30, Joseph McGlinchy via gdal-dev a ?crit :
>
> Hello,
>
> I am attempting to implement georegistration through RPC. I have the
> following information I've used to calibrate the RPC coefficients, using
> all terms for numerator and denominator for both sample and line equations.
>
>
>    - image grid, stored in tiff format with no geo-information associated
>    with it, so it reflects the imaging orientation
>    - a 'ground' grid, which corresponds to the longitude/latitude
>    coordinates for each pixel determined from a line-of-sight vector and
>    imaging system coordinates where the pseudo-rays intersect the WGS84 geoid
>    - a random sample of up to 4000 image coordinate / object space
>    coordinate pairs (I arrived at this number through trial and error; using
>    all pixels explodes RAM)
>    - elevation extracted at the longitude/latitude coordinates from a
>    DEM, in this case, SRTM, but have also tried using NASADEM
>
>
> I am able to write out an image to EPSG:4326 by populating the RPC
> metadata and using the non-georeferenced image data. However, I am
> struggling to use gdalwarp? in a reliable way to orthorectify that data,
> let alone writing it out in a way that 'bakes in' the georegistration with
> the RPCs whether that is in EPSG:4326 or the local UTM zone. I see strips
> of the image "ripped out" with odd curves in various places throughout the
> image.
>
> The only way I've been able to use gdalwarp? to write the image at all is
> with the following parameters (any DEM reference is to the SRTM DEM):
>
> gdalwarp --config CPL_DEBUG ON -t_srs EPSG:32610 -rpc -to
> "RPC_DEM_SRS=+proj=longlat +datum=WGS84 +no_def" -to "RPC_HEIGHT=350" -to
> "RPC_DEM_MISSING_VALUE=0.001" -to "RPC_FOOTPRINT='POLYGON ((list of polygon
> coordinates comprising the long/lat grid))'" -to "RPC_MAX_ITERATIONS=101"
> input_with_RPCs.tiff output.tiff
>
> This is the only configuration i can use to run gdalwarp? successfully.
> removing any single RPC_X tranformer option gives me bogus output. The
> RPC_HEIGHT value i specify above is not close to the mean or median
> elevation of the extent of my data; mean is ~195m and median is ~150m.
>
> With the debug turned on, any other set of parameters gives me failed RPC
> convergence on several points. I am able to reproduce this regularly by
> specifying RPC_DEM=dem.tif, where dem.tif is the same data I used to
> extract elevation values when calibrating the RPCs. I am seeing normalized
> latitude and longitude values with magnitude > 1 (I checked every location
> in the image, based on the metadata, the range is not outside of [-1,1]),
> as well as normalized altitude values with magnitude > 1 (there are some,
> not many, that have magnitude of 1.75).
>
> My workflow can be summarized as:
>
>
>    1. load grids (image data, longitude, latitude)
>    2. randomly sample up to 4000 points in image coordinates, object
>    coordinates
>    1. assign z-value from SRTM DEM
>       2. evaluate if any of the points are in NODATA areas of SRTM (image
>       is coastal, so there are NODATA areas for SRTM here), if so, remove those
>       and generate more points
>       3. normalize coordinates of grids to be in [-1,1], recording
>    offsets and scale
>    4.  calibrate RPC coefficients using all terms
>    5. write out GeoTIFF with image grid for pixels, along with RPC
>    required metadata fields and CRS EPSG:4326
>
>
> System information (please let me know if more is needed)
> OS: Ubuntu 20.04 LTS (GNU/Linux 5.10.16.3-microsoft-standard-WSL2 x86_64)
> (Windows Subsystem for Linux)
> GDAL 3.6.0 (python)
>
> Thank you in advance for any insight into this process! I am happy to
> package up any of the data I am using, as well. I have placed the initial
> data from the end of Step 5 described above, along with some additional
> files, a sample gdalwarp call, and a file-list.txt, at
> https://drive.google.com/drive/folders/1BfevhKQa4ZHi_OQfiX_rUk2sqeoNVhyM?usp=sharing
>
> If more is needed for anyone interested in having a look, please let me
> know and I'll upload.
>
>
> Cheers,
> Joe
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/2f8db95e/attachment-0001.htm>

From jluis at ualg.pt  Mon Apr 22 07:38:44 2024
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Mon, 22 Apr 2024 14:38:44 +0000
Subject: [gdal-dev] Question on building multi band composite and going
 back to RGB GeoTiff
In-Reply-To: <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>
References: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>
 <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>
Message-ID: <GVXPR04MB99260F49AEE8C430475CA815A6122@GVXPR04MB9926.eurprd04.prod.outlook.com>

Hi,

This is not a direct answer but maybe you?d be interested in this Julia package that addresses for example the automatic histogram stretching needed to produce nice true color images. Its target is Landsat and Sentinel data but there is nothing(?) that prevents it to work with data from other proveniences. Lots of GDAL work under the hood.

https://www.generic-mapping-tools.org/RemoteS.jl/dev/gallery/L8cube_img/remotes_L8_cube_img/

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Daniel Evans via gdal-dev
Sent: Monday, April 22, 2024 3:29 PM
To: Raley, Nathan <nraley at gaig.com>
Cc: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Question on building multi band composite and going back to RGB GeoTiff

Hi Nathan,

My initial suspicion might just be that the scaling the data provider did to go from the raw data to a human-eye-friendly RGB composite isn't the conversion you're assuming.

I know that with the data I regularly work with, it may be provided as Uint16, but the data range doesn't extend all the way to 65535.

If you compare the values in the separate R and G images to the RGB composite, do they appear to match the conversion you're assuming, or is there a different scaling (and possibly offset)?

Cheers,
Daniel

On Mon, 22 Apr 2024, 15:20 Raley, Nathan via gdal-dev, <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
I currently have a RGB geotiff composite image that has a Byte datatype.  I also have individual band images for R, G, Redge, and NIR that are UInt16 datatypes.  Since I?m missing the Blue band from the individual bands, I was attempting to extract the blue band from the RGB composite image, scale it up to the UInt16 datatype, and build a composite VRT with R, G, B, NIR, RE bands included in it.  I was then attempting to extract the RGB bands from the multispec VRT in order to see if the process was working as intended, but I?m getting an extremely blue image.

Can anyone shed some light as to what I may be doing wrong here?

I started by building a VRT for each band:
gdal_translate source_RGB.tif b.vrt -ot UInt16 -of VRT -b 3 -scale 0 255 0 65535
gdalbuildvrt -b 1 r.vrt source_R.tif
gdalbuildvrt -b 1 g.vrt source_G.tif
gdalbuildvrt -b 1 nir.vrt source_NIR.tif
gdalbuildvrt -b 1 re.vrt source_RE.tif

I then merged the VRTs:
gdalbuildvrt -separate multispec.vrt r.vrt g.vrt b.vrt nir.vrt re.vrt

I now have a multispec.vrt with the R, G, B, NIR, and RE bands, all with a UInt16 datatype.

Now, I attempted to rebuild a RGB GeoTiff from the composite VRT with something like:
gdal_translate -ot Byte -of GTiff -b 1 -b 2 -b 3 -scale 0 65535 0 255 -co PHOTOMETRIC=RGB multispec.vrt multispec.tif

Viewing the result in QGIS appears overly blue.  What am I doing wrong here?

Thanks,
Nathan

________________________________
This email transmission, including any attachments, is intended solely for the addressee named above, and may contain confidential or privileged information. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please notify the sender immediately by reply email and destroy the message and its attachments.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/6a5322f1/attachment.htm>

From nraley at gaig.com  Mon Apr 22 07:31:58 2024
From: nraley at gaig.com (Raley, Nathan)
Date: Mon, 22 Apr 2024 14:31:58 +0000
Subject: [gdal-dev] Question on building multi band composite and going
 back to RGB GeoTiff
In-Reply-To: <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>
References: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>
 <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>
Message-ID: <CYXPR19MB840341529EEC32BDD9F7D545B0122@CYXPR19MB8403.namprd19.prod.outlook.com>

Hmm, good catch.  Looking at the stats for the red band:

Band 1 Block=128x128 Type=UInt16, ColorInterp=Gray
  Min=130.000 Max=36265.000
  Minimum=130.000, Maximum=36265.000, Mean=10415.962, StdDev=3502.933
  NoData Value=0
  Metadata:
    STATISTICS_MAXIMUM=36265
    STATISTICS_MEAN=10415.961859513
    STATISTICS_MINIMUM=130
    STATISTICS_STDDEV=3502.9325925887
    STATISTICS_VALID_PERCENT=49

So, is there no way to actually do this via command line, or am I going to have to write a python lib to actually read through these and determine what they should be scaled to?

From: Daniel Evans <daniel.fred.evans at gmail.com>
Sent: Monday, April 22, 2024 9:29 AM
To: Raley, Nathan <nraley at gaig.com>
Cc: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Subject: [External] Re: [gdal-dev] Question on building multi band composite and going back to RGB GeoTiff

Hi Nathan, My initial suspicion might just be that the scaling the data provider did to go from the raw data to a human-eye-friendly RGB composite isn't the conversion you're assuming. I know that with the data I regularly work with,

Hi Nathan,

My initial suspicion might just be that the scaling the data provider did to go from the raw data to a human-eye-friendly RGB composite isn't the conversion you're assuming.

I know that with the data I regularly work with, it may be provided as Uint16, but the data range doesn't extend all the way to 65535.

If you compare the values in the separate R and G images to the RGB composite, do they appear to match the conversion you're assuming, or is there a different scaling (and possibly offset)?

Cheers,
Daniel

On Mon, 22 Apr 2024, 15:20 Raley, Nathan via gdal-dev, <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
I currently have a RGB geotiff composite image that has a Byte datatype.  I also have individual band images for R, G, Redge, and NIR that are UInt16 datatypes.  Since I?m missing the Blue band from the individual bands, I was attempting to extract the blue band from the RGB composite image, scale it up to the UInt16 datatype, and build a composite VRT with R, G, B, NIR, RE bands included in it.  I was then attempting to extract the RGB bands from the multispec VRT in order to see if the process was working as intended, but I?m getting an extremely blue image.

Can anyone shed some light as to what I may be doing wrong here?

I started by building a VRT for each band:
gdal_translate source_RGB.tif b.vrt -ot UInt16 -of VRT -b 3 -scale 0 255 0 65535
gdalbuildvrt -b 1 r.vrt source_R.tif
gdalbuildvrt -b 1 g.vrt source_G.tif
gdalbuildvrt -b 1 nir.vrt source_NIR.tif
gdalbuildvrt -b 1 re.vrt source_RE.tif

I then merged the VRTs:
gdalbuildvrt -separate multispec.vrt r.vrt g.vrt b.vrt nir.vrt re.vrt

I now have a multispec.vrt with the R, G, B, NIR, and RE bands, all with a UInt16 datatype.

Now, I attempted to rebuild a RGB GeoTiff from the composite VRT with something like:
gdal_translate -ot Byte -of GTiff -b 1 -b 2 -b 3 -scale 0 65535 0 255 -co PHOTOMETRIC=RGB multispec.vrt multispec.tif

Viewing the result in QGIS appears overly blue.  What am I doing wrong here?

Thanks,
Nathan

________________________________
This email transmission, including any attachments, is intended solely for the addressee named above, and may contain confidential or privileged information. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please notify the sender immediately by reply email and destroy the message and its attachments.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://urldefense.com/v3/__https:/lists.osgeo.org/mailman/listinfo/gdal-dev__;!!CsmrWXz9mOkSc4Hdn1fjj00!wHjHtqIprjw9nQ3elKNFMUWmEwR3sKx-zrxpsNEk-kBIhomauYshqPep8-beAmn7Ma8NlmL95Mqf9c8fol37c2o$>

This email transmission, including any attachments, is intended solely for the addressee named above, and may contain confidential or privileged information. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please notify the sender immediately by reply email and destroy the message and its attachments.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/89255c4c/attachment-0001.htm>

From andrew at aitchison.me.uk  Mon Apr 22 08:49:00 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 22 Apr 2024 16:49:00 +0100 (BST)
Subject: [gdal-dev] Question on building multi band composite and going
 back to RGB GeoTiff
In-Reply-To: <CYXPR19MB840341529EEC32BDD9F7D545B0122@CYXPR19MB8403.namprd19.prod.outlook.com>
References: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>
 <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>
 <CYXPR19MB840341529EEC32BDD9F7D545B0122@CYXPR19MB8403.namprd19.prod.outlook.com>
Message-ID: <cfb68a02-5cc5-6848-8b52-49d6a5bb557c@aitchison.me.uk>

On Mon, 22 Apr 2024, Raley, Nathan via gdal-dev wrote:

> Hmm, good catch.  Looking at the stats for the red band:
>
> Band 1 Block=128x128 Type=UInt16, ColorInterp=Gray
>  Min=130.000 Max=36265.000
>  Minimum=130.000, Maximum=36265.000, Mean=10415.962, StdDev=3502.933
>  NoData Value=0
>  Metadata:
>    STATISTICS_MAXIMUM=36265
>    STATISTICS_MEAN=10415.961859513
>    STATISTICS_MINIMUM=130
>    STATISTICS_STDDEV=3502.9325925887
>    STATISTICS_VALID_PERCENT=49
>
> So, is there no way to actually do this via command line, or am I going to have to write a python lib to actually read through these and determine what they should be scaled to?

There is gdal_transform -scale (and -scale_2 etc.)

What are you going to do with the resulting file ?
QGIS allows you to make these sorts of adjustments at view-time.

Remember that the max and min values present in an image may not represent
the full range and the next-door image may have a larger or smaller range
(or just a shifted range). Imagine a row of three tiles; the middle on on 
the edge of a glacier, the first entirely on the glacier and the last 
entirely off the glacier. You may wish to apply the same scaling to all 
three.

> From: Daniel Evans <daniel.fred.evans at gmail.com>
> Sent: Monday, April 22, 2024 9:29 AM
> To: Raley, Nathan <nraley at gaig.com>
> Cc: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
> Subject: [External] Re: [gdal-dev] Question on building multi band composite and going back to RGB GeoTiff
>
> Hi Nathan, My initial suspicion might just be that the scaling the data provider did to go from the raw data to a human-eye-friendly RGB composite isn't the conversion you're assuming. I know that with the data I regularly work with,
>
> Hi Nathan,
>
> My initial suspicion might just be that the scaling the data provider did to go from the raw data to a human-eye-friendly RGB composite isn't the conversion you're assuming.
>
> I know that with the data I regularly work with, it may be provided as Uint16, but the data range doesn't extend all the way to 65535.
>
> If you compare the values in the separate R and G images to the RGB composite, do they appear to match the conversion you're assuming, or is there a different scaling (and possibly offset)?
>
> Cheers,
> Daniel
>
> On Mon, 22 Apr 2024, 15:20 Raley, Nathan via gdal-dev, <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
> I currently have a RGB geotiff composite image that has a Byte datatype.  I also have individual band images for R, G, Redge, and NIR that are UInt16 datatypes.  Since I?m missing the Blue band from the individual bands, I was attempting to extract the blue band from the RGB composite image, scale it up to the UInt16 datatype, and build a composite VRT with R, G, B, NIR, RE bands included in it.  I was then attempting to extract the RGB bands from the multispec VRT in order to see if the process was working as intended, but I?m getting an extremely blue image.
>
> Can anyone shed some light as to what I may be doing wrong here?
>
> I started by building a VRT for each band:
> gdal_translate source_RGB.tif b.vrt -ot UInt16 -of VRT -b 3 -scale 0 255 0 65535
> gdalbuildvrt -b 1 r.vrt source_R.tif
> gdalbuildvrt -b 1 g.vrt source_G.tif
> gdalbuildvrt -b 1 nir.vrt source_NIR.tif
> gdalbuildvrt -b 1 re.vrt source_RE.tif
>
> I then merged the VRTs:
> gdalbuildvrt -separate multispec.vrt r.vrt g.vrt b.vrt nir.vrt re.vrt
>
> I now have a multispec.vrt with the R, G, B, NIR, and RE bands, all with a UInt16 datatype.
>
> Now, I attempted to rebuild a RGB GeoTiff from the composite VRT with something like:
> gdal_translate -ot Byte -of GTiff -b 1 -b 2 -b 3 -scale 0 65535 0 255 -co PHOTOMETRIC=RGB multispec.vrt multispec.tif
>
> Viewing the result in QGIS appears overly blue.  What am I doing wrong here?
>
> Thanks,
> Nathan
>
> ________________________________
> This email transmission, including any attachments, is intended solely for the addressee named above, and may contain confidential or privileged information. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please notify the sender immediately by reply email and destroy the message and its attachments.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://urldefense.com/v3/__https:/lists.osgeo.org/mailman/listinfo/gdal-dev__;!!CsmrWXz9mOkSc4Hdn1fjj00!wHjHtqIprjw9nQ3elKNFMUWmEwR3sKx-zrxpsNEk-kBIhomauYshqPep8-beAmn7Ma8NlmL95Mqf9c8fol37c2o$>
>
> This email transmission, including any attachments, is intended solely for the addressee named above, and may contain confidential or privileged information. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please notify the sender immediately by reply email and destroy the message and its attachments.
>

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From sean.gillies at gmail.com  Mon Apr 22 09:14:55 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Mon, 22 Apr 2024 10:14:55 -0600
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
Message-ID: <CAOodmJpAuodwA8eSdU6MrZ1HWYDt-1u7PH3TzmMFLVuOMRuHKg@mail.gmail.com>

Hi Even,

Rasterio's test suite has 4 errors with GDAL 3.9.0beta1.

Metadata output of gdalinfo has changed. As soon as there are docker images
I'll look more closely at this.

Writing a mask to a Rasterio RGB.byte.tif dataset no longer creates a
RGB.byte.tif.msk
file:
https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2231
.

The text of an error message which was "tests/data/corrupt.tif, band 1:
IReadBlock failed at X offset 1, Y offset 1: TIFFReadEncodedTile() failed."
in 3.8 has changed to "corrupt.tif, band 1: IReadBlock failed at X offset
1, Y offset 1: TIFFReadEncodedTile() failed." This is not a big deal, we
can adjust Rasterio's test.

Behavior of SRC_METHOD/DST_METHOD=NO_GEOTRANSFORM for warp options seems to
have changed:
https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2287.
I'm not entirely sure what the intent is in Rasterio's test, will dig into
that. I just wanted to say that I see a change in GDAL.


On Mon, Apr 22, 2024 at 6:12?AM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>
> The NEWS file is here:
>
>    https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md
>
> For packagers,
> https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may
> make it more attractive to build some drivers that typically have heavy
> dependencies as plugins, installable in separate packages, due to the
> load time penalty having being improved. It is let to the appreciation
> of packagers to decide which drivers are worth building as plugins
> installable in a separate package.
> You may also pass CMake options
> ([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so
> user get a hint of which package they need to install when GDAL detects
> that a file may be opened by a plugin which is not available on the file
> system but known to have been built as a plugin. Cf
>
> https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
> for more details.
>
> For end-users, the following utilities have been updated to use a new
> argument parsing framework: gdaladdo, gdalinfo, gdal_translate,
> gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo,
> ogr2ogr, sozip.
> This helps detecting errors such as specifying twice an argument that
> should be specified once (where generally the last instance was the one
> used). While we have tried to retain backwards compatibility for nominal
> use cases, obviously if you have scripts that accidentally specify an
> argument several times whereas it should be specified at most once, they
> will have to be corrected.
>
> Docker images with 3.9.0beta1 are currently cooking.
>
> master is now marked as 3.10.0dev, and the release/3.9 branch has been
> created. All bugfixes for 3.9 should be backported into it.
>
> Source snapshots at:
>
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
> - https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip
>
> Autotest snapshots:
>
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip
>
> Even
>
>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/84716b2f/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 22 09:48:34 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 22 Apr 2024 16:48:34 +0000
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <CAOodmJpAuodwA8eSdU6MrZ1HWYDt-1u7PH3TzmMFLVuOMRuHKg@mail.gmail.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <CAOodmJpAuodwA8eSdU6MrZ1HWYDt-1u7PH3TzmMFLVuOMRuHKg@mail.gmail.com>
Message-ID: <DB9PR09MB68876510A9BCC59F8F08BE96FD122@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

The mask thing may happen due to https://github.com/OSGeo/gdal/pull/9604.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Sean Gillies via gdal-dev
L?hetetty: maanantai 22. huhtikuuta 2024 19.15
Vastaanottaja: Even Rouault <even.rouault at spatialys.com>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] GDAL 3.9.0beta1 available for testing

Hi Even,

Rasterio's test suite has 4 errors with GDAL 3.9.0beta1.

Metadata output of gdalinfo has changed. As soon as there are docker images I'll look more closely at this.

Writing a mask to a Rasterio RGB.byte.tif dataset no longer creates a RGB.byte.tif.msk file: https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2231.

The text of an error message which was "tests/data/corrupt.tif, band 1: IReadBlock failed at X offset 1, Y offset 1: TIFFReadEncodedTile() failed." in 3.8 has changed to "corrupt.tif, band 1: IReadBlock failed at X offset 1, Y offset 1: TIFFReadEncodedTile() failed." This is not a big deal, we can adjust Rasterio's test.

Behavior of SRC_METHOD/DST_METHOD=NO_GEOTRANSFORM for warp options seems to have changed: https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2287. I'm not entirely sure what the intent is in Rasterio's test, will dig into that. I just wanted to say that I see a change in GDAL.


On Mon, Apr 22, 2024 at 6:12?AM Even Rouault via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi,

I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.

The NEWS file is here:

   https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md

For packagers,
https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may
make it more attractive to build some drivers that typically have heavy
dependencies as plugins, installable in separate packages, due to the
load time penalty having being improved. It is let to the appreciation
of packagers to decide which drivers are worth building as plugins
installable in a separate package.
You may also pass CMake options
([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so
user get a hint of which package they need to install when GDAL detects
that a file may be opened by a plugin which is not available on the file
system but known to have been built as a plugin. Cf
https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
for more details.

For end-users, the following utilities have been updated to use a new
argument parsing framework: gdaladdo, gdalinfo, gdal_translate,
gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo,
ogr2ogr, sozip.
This helps detecting errors such as specifying twice an argument that
should be specified once (where generally the last instance was the one
used). While we have tried to retain backwards compatibility for nominal
use cases, obviously if you have scripts that accidentally specify an
argument several times whereas it should be specified at most once, they
will have to be corrected.

Docker images with 3.9.0beta1 are currently cooking.

master is now marked as 3.10.0dev, and the release/3.9 branch has been
created. All bugfixes for 3.9 should be backported into it.

Source snapshots at:

- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
- https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip

Autotest snapshots:

- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip

Even


--
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/bf8291b4/attachment-0001.htm>

From even.rouault at spatialys.com  Mon Apr 22 10:27:36 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Apr 2024 19:27:36 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <CAOodmJpAuodwA8eSdU6MrZ1HWYDt-1u7PH3TzmMFLVuOMRuHKg@mail.gmail.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <CAOodmJpAuodwA8eSdU6MrZ1HWYDt-1u7PH3TzmMFLVuOMRuHKg@mail.gmail.com>
Message-ID: <6c5ccc05-8dc3-4972-94b2-daef0b5bd8d8@spatialys.com>

Sean,
> Rasterio's test suite has 4 errors with GDAL 3.9.0beta1.
>
> Metadata output of gdalinfo has changed.

ok, I've run locally rasterio tests and I see gdalinfo now outputs:

Metadata:
 ? a=1
 ? b=2
 ? AREA_OR_POINT=Area

whereas the test expects

Metadata:
 ? a=1
 ? AREA_OR_POINT=Area
 ? b=2

Order of metadata items shouldn't be relied upon. I believe we have 
changed something internally (likely changing from char** to 
CPLStringList that does sorting) that might indeed have affected it. You 
could also potentially use "gdalinfo -json" output to get something 
easier to parse. But don't you have a rasterio API to get GDAL metadata 
that would avoid using gdalinfo at all?

> As soon as there are docker images I'll look more closely at this.
ghcr.io/osgeo/gdal:ubuntu-full-3.9.0beta1 is already available
>
> Writing a mask to a Rasterio RGB.byte.tif dataset no longer creates a 
> RGB.byte.tif.msk file: 
> https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2231.

Yes, this is intended. Due to this change:

GTiff driver:
 ?* change default value of GDAL_TIFF_INTERNAL_MASK config option to YES

You might run the test under GDAL_TIFF_INTERNAL_MASK=NO if you want to 
test external mask.

>
> The text of an error message which was "tests/data/corrupt.tif, band 
> 1: IReadBlock failed at X offset 1, Y offset 1: TIFFReadEncodedTile() 
> failed." in 3.8 has changed to "corrupt.tif, band 1: IReadBlock failed 
> at X offset 1, Y offset 1: TIFFReadEncodedTile() failed." This is not 
> a big deal, we can adjust Rasterio's test.
Yes, related to 
https://github.com/OSGeo/gdal/commit/cb5161d907e8b4fa5cb68aaf891c1a258d6475b0
>
> Behavior of SRC_METHOD/DST_METHOD=NO_GEOTRANSFORM for warp options 
> seems to have changed: 
> https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2287. 
> I'm not entirely sure what the intent is in Rasterio's test, will dig 
> into that. I just wanted to say that I see a change in GDAL.

ok, this is related to https://github.com/OSGeo/gdal/pull/9336 , which 
indeed wasn't honoring the SRC_METHOD=NO_GEOTRANSFORM and was using 
directly the geotransform from the source dataset.

Fix queued in https://github.com/OSGeo/gdal/pull/9724

(that said, tests reprojecting from 4326 to 3857 while ignoring the 
geotransform are a bit weird)

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/433c64cb/attachment.htm>

From j1 at jimenezshaw.com  Mon Apr 22 11:13:14 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 22 Apr 2024 20:13:14 +0200
Subject: [gdal-dev] Question on building multi band composite and going
 back to RGB GeoTiff
In-Reply-To: <cfb68a02-5cc5-6848-8b52-49d6a5bb557c@aitchison.me.uk>
References: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>
 <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>
 <CYXPR19MB840341529EEC32BDD9F7D545B0122@CYXPR19MB8403.namprd19.prod.outlook.com>
 <cfb68a02-5cc5-6848-8b52-49d6a5bb557c@aitchison.me.uk>
Message-ID: <CADRrdKvFojpDUKQ+Aa_4gJU=mzQ8q9RmWhsvrXFmBDXvH1j_Fw@mail.gmail.com>

In addition to all the previous, what about gamma correction?
Maybe your RGB images are gamma corrected, while the other bands are not.
In that case you will be comparing apples and oranges (in addition to the
scaling problems described before).
That also means that using the multispectral images (even if you had a Blue
one) without gamma correction will have a strange color for us humans using
a monitor.

What I did in the past was to "fake" blue as a combination of red and green
(yes, it is not perfect, but better than nothing), and apply a gamma of 2
to all the bands.

Other "nice" option is to display them as CIR
https://www.mngeo.state.mn.us/chouse/airphoto/cir.html

Cheers
Javier

On Mon, 22 Apr 2024 at 17:49, Andrew C Aitchison via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> On Mon, 22 Apr 2024, Raley, Nathan via gdal-dev wrote:
>
> > Hmm, good catch.  Looking at the stats for the red band:
> >
> > Band 1 Block=128x128 Type=UInt16, ColorInterp=Gray
> >  Min=130.000 Max=36265.000
> >  Minimum=130.000, Maximum=36265.000, Mean=10415.962, StdDev=3502.933
> >  NoData Value=0
> >  Metadata:
> >    STATISTICS_MAXIMUM=36265
> >    STATISTICS_MEAN=10415.961859513
> >    STATISTICS_MINIMUM=130
> >    STATISTICS_STDDEV=3502.9325925887
> >    STATISTICS_VALID_PERCENT=49
> >
> > So, is there no way to actually do this via command line, or am I going
> to have to write a python lib to actually read through these and determine
> what they should be scaled to?
>
> There is gdal_transform -scale (and -scale_2 etc.)
>
> What are you going to do with the resulting file ?
> QGIS allows you to make these sorts of adjustments at view-time.
>
> Remember that the max and min values present in an image may not represent
> the full range and the next-door image may have a larger or smaller range
> (or just a shifted range). Imagine a row of three tiles; the middle on on
> the edge of a glacier, the first entirely on the glacier and the last
> entirely off the glacier. You may wish to apply the same scaling to all
> three.
>
> > From: Daniel Evans <daniel.fred.evans at gmail.com>
> > Sent: Monday, April 22, 2024 9:29 AM
> > To: Raley, Nathan <nraley at gaig.com>
> > Cc: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <
> gdal-dev at lists.osgeo.org>
> > Subject: [External] Re: [gdal-dev] Question on building multi band
> composite and going back to RGB GeoTiff
> >
> > Hi Nathan, My initial suspicion might just be that the scaling the data
> provider did to go from the raw data to a human-eye-friendly RGB composite
> isn't the conversion you're assuming. I know that with the data I regularly
> work with,
> >
> > Hi Nathan,
> >
> > My initial suspicion might just be that the scaling the data provider
> did to go from the raw data to a human-eye-friendly RGB composite isn't the
> conversion you're assuming.
> >
> > I know that with the data I regularly work with, it may be provided as
> Uint16, but the data range doesn't extend all the way to 65535.
> >
> > If you compare the values in the separate R and G images to the RGB
> composite, do they appear to match the conversion you're assuming, or is
> there a different scaling (and possibly offset)?
> >
> > Cheers,
> > Daniel
> >
> > On Mon, 22 Apr 2024, 15:20 Raley, Nathan via gdal-dev, <
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
> > I currently have a RGB geotiff composite image that has a Byte
> datatype.  I also have individual band images for R, G, Redge, and NIR that
> are UInt16 datatypes.  Since I?m missing the Blue band from the individual
> bands, I was attempting to extract the blue band from the RGB composite
> image, scale it up to the UInt16 datatype, and build a composite VRT with
> R, G, B, NIR, RE bands included in it.  I was then attempting to extract
> the RGB bands from the multispec VRT in order to see if the process was
> working as intended, but I?m getting an extremely blue image.
> >
> > Can anyone shed some light as to what I may be doing wrong here?
> >
> > I started by building a VRT for each band:
> > gdal_translate source_RGB.tif b.vrt -ot UInt16 -of VRT -b 3 -scale 0 255
> 0 65535
> > gdalbuildvrt -b 1 r.vrt source_R.tif
> > gdalbuildvrt -b 1 g.vrt source_G.tif
> > gdalbuildvrt -b 1 nir.vrt source_NIR.tif
> > gdalbuildvrt -b 1 re.vrt source_RE.tif
> >
> > I then merged the VRTs:
> > gdalbuildvrt -separate multispec.vrt r.vrt g.vrt b.vrt nir.vrt re.vrt
> >
> > I now have a multispec.vrt with the R, G, B, NIR, and RE bands, all with
> a UInt16 datatype.
> >
> > Now, I attempted to rebuild a RGB GeoTiff from the composite VRT with
> something like:
> > gdal_translate -ot Byte -of GTiff -b 1 -b 2 -b 3 -scale 0 65535 0 255
> -co PHOTOMETRIC=RGB multispec.vrt multispec.tif
> >
> > Viewing the result in QGIS appears overly blue.  What am I doing wrong
> here?
> >
> > Thanks,
> > Nathan
> >
> > ________________________________
> > This email transmission, including any attachments, is intended solely
> for the addressee named above, and may contain confidential or privileged
> information. If you are not the intended recipient, be aware that any
> disclosure, copying, distribution or use of the contents of this e-mail is
> prohibited. If you have received this e-mail in error, please notify the
> sender immediately by reply email and destroy the message and its
> attachments.
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev<
> https://urldefense.com/v3/__https:/lists.osgeo.org/mailman/listinfo/gdal-dev__;!!CsmrWXz9mOkSc4Hdn1fjj00!wHjHtqIprjw9nQ3elKNFMUWmEwR3sKx-zrxpsNEk-kBIhomauYshqPep8-beAmn7Ma8NlmL95Mqf9c8fol37c2o$
> >
> >
> > This email transmission, including any attachments, is intended solely
> for the addressee named above, and may contain confidential or privileged
> information. If you are not the intended recipient, be aware that any
> disclosure, copying, distribution or use of the contents of this e-mail is
> prohibited. If you have received this e-mail in error, please notify the
> sender immediately by reply email and destroy the message and its
> attachments.
> >
>
> --
> Andrew C. Aitchison                      Kendal, UK
>                     andrew at aitchison.me.uk
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/e95563f2/attachment.htm>

From a.pau at creaf.uab.cat  Mon Apr 22 12:29:34 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 22 Apr 2024 19:29:34 +0000
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
Message-ID: <PAXPR07MB7775376997EFF8B1DB6A2FB8A2122@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
I only want to advice that https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip is not found.
Thanks.

-----Mensaje original-----
De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Even Rouault via gdal-dev
Enviado el: dilluns, 22 d?abril de 2024 14:13
Para: gdal-dev at lists.osgeo.org
Asunto: [gdal-dev] GDAL 3.9.0beta1 available for testing

Hi,

I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.

The NEWS file is here:

 ? https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md

For packagers,
https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may make it more attractive to build some drivers that typically have heavy dependencies as plugins, installable in separate packages, due to the load time penalty having being improved. It is let to the appreciation of packagers to decide which drivers are worth building as plugins installable in a separate package.
You may also pass CMake options
([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so user get a hint of which package they need to install when GDAL detects that a file may be opened by a plugin which is not available on the file system but known to have been built as a plugin. Cf https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
for more details.

For end-users, the following utilities have been updated to use a new argument parsing framework: gdaladdo, gdalinfo, gdal_translate, gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo, ogr2ogr, sozip.
This helps detecting errors such as specifying twice an argument that should be specified once (where generally the last instance was the one used). While we have tried to retain backwards compatibility for nominal use cases, obviously if you have scripts that accidentally specify an argument several times whereas it should be specified at most once, they will have to be corrected.

Docker images with 3.9.0beta1 are currently cooking.

master is now marked as 3.10.0dev, and the release/3.9 branch has been created. All bugfixes for 3.9 should be backported into it.

Source snapshots at:

- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
- https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip

Autotest snapshots:

- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip

Even

--
http://www.spatialys.com
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Mon Apr 22 12:37:04 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Apr 2024 21:37:04 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <PAXPR07MB7775376997EFF8B1DB6A2FB8A2122@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <PAXPR07MB7775376997EFF8B1DB6A2FB8A2122@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <3a867107-bc83-4789-89ef-ca526a55eca6@spatialys.com>

It should have read https://download.osgeo.org/gdal/3.9.0/gdal390beta1.zip

Le 22/04/2024 ? 21:29, Abel Pau via gdal-dev a ?crit?:
> Hi,
> I only want to advice that https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip is not found.
> Thanks.
>
> -----Mensaje original-----
> De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Even Rouault via gdal-dev
> Enviado el: dilluns, 22 d?abril de 2024 14:13
> Para: gdal-dev at lists.osgeo.org
> Asunto: [gdal-dev] GDAL 3.9.0beta1 available for testing
>
> Hi,
>
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>
> The NEWS file is here:
>
>   ? https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md
>
> For packagers,
> https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may make it more attractive to build some drivers that typically have heavy dependencies as plugins, installable in separate packages, due to the load time penalty having being improved. It is let to the appreciation of packagers to decide which drivers are worth building as plugins installable in a separate package.
> You may also pass CMake options
> ([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so user get a hint of which package they need to install when GDAL detects that a file may be opened by a plugin which is not available on the file system but known to have been built as a plugin. Cf https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
> for more details.
>
> For end-users, the following utilities have been updated to use a new argument parsing framework: gdaladdo, gdalinfo, gdal_translate, gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo, ogr2ogr, sozip.
> This helps detecting errors such as specifying twice an argument that should be specified once (where generally the last instance was the one used). While we have tried to retain backwards compatibility for nominal use cases, obviously if you have scripts that accidentally specify an argument several times whereas it should be specified at most once, they will have to be corrected.
>
> Docker images with 3.9.0beta1 are currently cooking.
>
> master is now marked as 3.10.0dev, and the release/3.9 branch has been created. All bugfixes for 3.9 should be backported into it.
>
> Source snapshots at:
>
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
> - https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip
>
> Autotest snapshots:
>
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From holger.jaekel at gmx.de  Mon Apr 22 14:28:58 2024
From: holger.jaekel at gmx.de (Holger Jaekel)
Date: Mon, 22 Apr 2024 23:28:58 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
Message-ID: <fceaf807-b818-4f40-9de6-b54831832412@gmx.de>

Hi Even,

Am 22.04.24 um 14:12 schrieb Even Rouault via gdal-dev:
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.

I tried to build on Alpine Linux Edge and got the following error:


/builds/hjaekel/aports/community/gdal/src/gdal-3.9.0beta1/ogr/ogr_core.h:38:10:
fatal error: gdal_version.h: No such file or directory
    38 | #include "gdal_version.h"
       |          ^~~~~~~~~~~~~~~~
compilation terminated.


gdal_version.h seems not to be generated to build/gcore.

You can find the full build logs here:
https://gitlab.alpinelinux.org/hjaekel/aports/-/pipelines/228841

Holger


From even.rouault at spatialys.com  Mon Apr 22 14:52:06 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Apr 2024 23:52:06 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <fceaf807-b818-4f40-9de6-b54831832412@gmx.de>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <fceaf807-b818-4f40-9de6-b54831832412@gmx.de>
Message-ID: <be418c17-56ff-4a4b-80a0-8c825ed8f0d7@spatialys.com>

Holger,

thanks for the report. This should be fixed per 
https://github.com/OSGeo/gdal/commit/fba559b5bd8d33aac215681df4f6a613517a6c43 
which I've backported to the release/3.9 branch

A workaround is to explicitly run "cmake --target 
generate_gdal_version_h" before building all other targets

Even

Le 22/04/2024 ? 23:28, Holger Jaekel via gdal-dev a ?crit?:
> Hi Even,
>
> Am 22.04.24 um 14:12 schrieb Even Rouault via gdal-dev:
>> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>
> I tried to build on Alpine Linux Edge and got the following error:
>
>
> /builds/hjaekel/aports/community/gdal/src/gdal-3.9.0beta1/ogr/ogr_core.h:38:10: 
>
> fatal error: gdal_version.h: No such file or directory
> ?? 38 | #include "gdal_version.h"
> ????? |????????? ^~~~~~~~~~~~~~~~
> compilation terminated.
>
>
> gdal_version.h seems not to be generated to build/gcore.
>
> You can find the full build logs here:
> https://gitlab.alpinelinux.org/hjaekel/aports/-/pipelines/228841
>
> Holger
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sean.gillies at gmail.com  Mon Apr 22 14:54:25 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Mon, 22 Apr 2024 15:54:25 -0600
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <DB9PR09MB68876510A9BCC59F8F08BE96FD122@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <CAOodmJpAuodwA8eSdU6MrZ1HWYDt-1u7PH3TzmMFLVuOMRuHKg@mail.gmail.com>
 <DB9PR09MB68876510A9BCC59F8F08BE96FD122@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAOodmJpQgesrpH3HfC7QYS5_gsKrdOongU0u8yY-ddAw9OgfDw@mail.gmail.com>

Thanks, Jukka!

On Mon, Apr 22, 2024 at 10:48?AM Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> The mask thing may happen due to https://github.com/OSGeo/gdal/pull/9604.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Sean
> Gillies via gdal-dev
> *L?hetetty:* maanantai 22. huhtikuuta 2024 19.15
> *Vastaanottaja:* Even Rouault <even.rouault at spatialys.com>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] GDAL 3.9.0beta1 available for testing
>
>
>
> Hi Even,
>
>
>
> Rasterio's test suite has 4 errors with GDAL 3.9.0beta1.
>
>
>
> Metadata output of gdalinfo has changed. As soon as there are docker
> images I'll look more closely at this.
>
>
>
> Writing a mask to a Rasterio RGB.byte.tif dataset no longer creates a RGB.byte.tif.msk
> file:
> https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2231
> .
>
>
>
> The text of an error message which was "tests/data/corrupt.tif, band 1:
> IReadBlock failed at X offset 1, Y offset 1: TIFFReadEncodedTile() failed."
> in 3.8 has changed to "corrupt.tif, band 1: IReadBlock failed at X offset
> 1, Y offset 1: TIFFReadEncodedTile() failed." This is not a big deal, we
> can adjust Rasterio's test.
>
>
>
> Behavior of SRC_METHOD/DST_METHOD=NO_GEOTRANSFORM for warp options seems
> to have changed:
> https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2287.
> I'm not entirely sure what the intent is in Rasterio's test, will dig into
> that. I just wanted to say that I see a change in GDAL.
>
>
>
>
>
> On Mon, Apr 22, 2024 at 6:12?AM Even Rouault via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi,
>
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>
> The NEWS file is here:
>
>    https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md
>
> For packagers,
> https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may
> make it more attractive to build some drivers that typically have heavy
> dependencies as plugins, installable in separate packages, due to the
> load time penalty having being improved. It is let to the appreciation
> of packagers to decide which drivers are worth building as plugins
> installable in a separate package.
> You may also pass CMake options
> ([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so
> user get a hint of which package they need to install when GDAL detects
> that a file may be opened by a plugin which is not available on the file
> system but known to have been built as a plugin. Cf
>
> https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
> for more details.
>
> For end-users, the following utilities have been updated to use a new
> argument parsing framework: gdaladdo, gdalinfo, gdal_translate,
> gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo,
> ogr2ogr, sozip.
> This helps detecting errors such as specifying twice an argument that
> should be specified once (where generally the last instance was the one
> used). While we have tried to retain backwards compatibility for nominal
> use cases, obviously if you have scripts that accidentally specify an
> argument several times whereas it should be specified at most once, they
> will have to be corrected.
>
> Docker images with 3.9.0beta1 are currently cooking.
>
> master is now marked as 3.10.0dev, and the release/3.9 branch has been
> created. All bugfixes for 3.9 should be backported into it.
>
> Source snapshots at:
>
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
> - https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip
>
> Autotest snapshots:
>
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip
>
> Even
>
>
>
> --
>
> Sean Gillies
>


-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/970a7167/attachment-0001.htm>

From sean.gillies at gmail.com  Mon Apr 22 14:56:19 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Mon, 22 Apr 2024 15:56:19 -0600
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <6c5ccc05-8dc3-4972-94b2-daef0b5bd8d8@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <CAOodmJpAuodwA8eSdU6MrZ1HWYDt-1u7PH3TzmMFLVuOMRuHKg@mail.gmail.com>
 <6c5ccc05-8dc3-4972-94b2-daef0b5bd8d8@spatialys.com>
Message-ID: <CAOodmJrpT+yNuvCnu0z1kGnJMmnW3T2U0vJV+kirGVLJM6_qQg@mail.gmail.com>

Thanks for the fix and suggestions! I'm looking forward to 3.9.0.

On Mon, Apr 22, 2024 at 11:27?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Sean,
>
> Rasterio's test suite has 4 errors with GDAL 3.9.0beta1.
>
> Metadata output of gdalinfo has changed.
>
> ok, I've run locally rasterio tests and I see gdalinfo now outputs:
> Metadata:
>   a=1
>   b=2
>   AREA_OR_POINT=Area
>
> whereas the test expects
>
> Metadata:
>   a=1
>   AREA_OR_POINT=Area
>   b=2
>
> Order of metadata items shouldn't be relied upon. I believe we have
> changed something internally (likely changing from char** to CPLStringList
> that does sorting) that might indeed have affected it. You could also
> potentially use "gdalinfo -json" output to get something easier to parse.
> But don't you have a rasterio API to get GDAL metadata that would avoid
> using gdalinfo at all?
>
> As soon as there are docker images I'll look more closely at this.
>
> ghcr.io/osgeo/gdal:ubuntu-full-3.9.0beta1 is already available
>
>
> Writing a mask to a Rasterio RGB.byte.tif dataset no longer creates a RGB.byte.tif.msk
> file:
> https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2231
> .
>
> Yes, this is intended. Due to this change:
> GTiff driver:
>  * change default value of GDAL_TIFF_INTERNAL_MASK config option to YES
>
> You might run the test under GDAL_TIFF_INTERNAL_MASK=NO if you want to
> test external mask.
>
>
> The text of an error message which was "tests/data/corrupt.tif, band 1:
> IReadBlock failed at X offset 1, Y offset 1: TIFFReadEncodedTile() failed."
> in 3.8 has changed to "corrupt.tif, band 1: IReadBlock failed at X offset
> 1, Y offset 1: TIFFReadEncodedTile() failed." This is not a big deal, we
> can adjust Rasterio's test.
>
> Yes, related to
> https://github.com/OSGeo/gdal/commit/cb5161d907e8b4fa5cb68aaf891c1a258d6475b0
>
>
> Behavior of SRC_METHOD/DST_METHOD=NO_GEOTRANSFORM for warp options seems
> to have changed:
> https://github.com/rasterio/rasterio/actions/runs/8786444142/job/24109342188#step:8:2287.
> I'm not entirely sure what the intent is in Rasterio's test, will dig into
> that. I just wanted to say that I see a change in GDAL.
>
> ok, this is related to https://github.com/OSGeo/gdal/pull/9336 , which
> indeed wasn't honoring the SRC_METHOD=NO_GEOTRANSFORM and was using
> directly the geotransform from the source dataset.
>
> Fix queued in https://github.com/OSGeo/gdal/pull/9724
>
> (that said, tests reprojecting from 4326 to 3857 while ignoring the
> geotransform are a bit weird)
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240422/03caac76/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 22 14:56:45 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Apr 2024 23:56:45 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
Message-ID: <b95819aa-48ed-496c-951f-0a311054be29@spatialys.com>

The Docker images are now available:

ghcr.io/osgeo/gdal:alpine-small-3.9.0beta1
ghcr.io/osgeo/gdal:ubuntu-small-3.9.0beta1
ghcr.io/osgeo/gdal:alpine-normal-3.9.0beta1
ghcr.io/osgeo/gdal:ubuntu-full-3.9.0beta1

Le 22/04/2024 ? 14:12, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>
> The NEWS file is here:
>
> ? https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md
>
> For packagers, 
> https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html 
> may make it more attractive to build some drivers that typically have 
> heavy dependencies as plugins, installable in separate packages, due 
> to the load time penalty having being improved. It is let to the 
> appreciation of packagers to decide which drivers are worth building 
> as plugins installable in a separate package.
> You may also pass CMake options 
> ([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so 
> user get a hint of which package they need to install when GDAL 
> detects that a file may be opened by a plugin which is not available 
> on the file system but known to have been built as a plugin. Cf 
> https://gdal.org/development/building_from_source.html#deferred-loaded-plugins 
> for more details.
>
> For end-users, the following utilities have been updated to use a new 
> argument parsing framework: gdaladdo, gdalinfo, gdal_translate, 
> gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo, 
> ogr2ogr, sozip.
> This helps detecting errors such as specifying twice an argument that 
> should be specified once (where generally the last instance was the 
> one used). While we have tried to retain backwards compatibility for 
> nominal use cases, obviously if you have scripts that accidentally 
> specify an argument several times whereas it should be specified at 
> most once, they will have to be corrected.
>
> Docker images with 3.9.0beta1 are currently cooking.
>
> master is now marked as 3.10.0dev, and the release/3.9 branch has been 
> created. All bugfixes for 3.9 should be backported into it.
>
> Source snapshots at:
>
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
> - https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip
>
> Autotest snapshots:
>
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From dg0yt at darc.de  Mon Apr 22 23:14:18 2024
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Tue, 23 Apr 2024 08:14:18 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
Message-ID: <76164a4a-e8d0-40f4-a87c-51b6d0defe5e@darc.de>

Am 22.04.24 um 14:12 schrieb Even Rouault via gdal-dev:
> Hi,
>
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.

I did a test build in vcpkg, and I see downstream problems with static 
linkage. It now raises:

CMake Error at /mnt/vss/_work/1/s/scripts/buildsystems/vcpkg.cmake:859 
(_find_package):
 ? _find_package given CONFIGS option followed by invalid file name "3.8".
 ? The names given must be file names without a path and with a ".cmake"
 ? extension.
Call Stack (most recent call first):
/mnt/vcpkg-ci/downloads/tools/cmake-3.29.2-linux/cmake-3.29.2-linux-x86_64/share/cmake-3.29/Modules/CMakeFindDependencyMacro.cmake:76 
(find_package)
 ? /mnt/vcpkg-ci/installed/x64-linux/share/gdal/GDALConfig.cmake:37 
(find_dependency)
/mnt/vcpkg-ci/installed/x64-linux/share/gdal/vcpkg-cmake-wrapper.cmake:13 
(_find_package)
 ? /mnt/vss/_work/1/s/scripts/buildsystems/vcpkg.cmake:813 (include)
 ? CMakeLists.txt:36 (find_package)

(Don't get distracted by vcpkg: _find_package is CMake's? regular 
find_package.)

IIUC the generated CMake config is wrong when dependency versions are 
used together with config names, as in:

find_dependency(GEOS NAMES GEOS CONFIGS geos-config.cmake 3.8)
find_dependency(NetCDF NAMES netCDF CONFIGS netCDFConfig.cmake 4.7)

AFAICT the version number must be the 2nd argument. Maybe VERSION wasn't 
used often enough before, or/and it is a new CMake feature.

A tentative patch is attached, end-to-end tests pending.

Kai


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240423/92755cbc/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: find-dependency.patch
Type: text/x-patch
Size: 870 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240423/92755cbc/attachment.bin>

From thomas.bonfort at gmail.com  Tue Apr 23 00:56:23 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Tue, 23 Apr 2024 09:56:23 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
Message-ID: <CAOM3y2gKJ6bKf+JKoQTTygMtAJrjoSO+r-Pmhxv3X3Gfb1OeCQ@mail.gmail.com>

All OK with https://github.com/airbusgeo/godal 's test suite, with changes
that did have to be made to account for the default gtiff mask band
handling (I believe this change should have been kept back until 4.0. I am
not asking for it to be reverted)

regards,
TB

On Mon, Apr 22, 2024 at 2:12?PM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>
> The NEWS file is here:
>
>    https://github.com/OSGeo/gdal/blob/v3.9.0beta1/NEWS.md
>
> For packagers,
> https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html may
> make it more attractive to build some drivers that typically have heavy
> dependencies as plugins, installable in separate packages, due to the
> load time penalty having being improved. It is let to the appreciation
> of packagers to decide which drivers are worth building as plugins
> installable in a separate package.
> You may also pass CMake options
> ([GDAL/OGR]_DRIVER_<driver_name>_PLUGIN_INSTALLATION_MESSAGE=xxx) so
> user get a hint of which package they need to install when GDAL detects
> that a file may be opened by a plugin which is not available on the file
> system but known to have been built as a plugin. Cf
>
> https://gdal.org/development/building_from_source.html#deferred-loaded-plugins
> for more details.
>
> For end-users, the following utilities have been updated to use a new
> argument parsing framework: gdaladdo, gdalinfo, gdal_translate,
> gdalwarp, gdal_grid, gdal_viewshed, gdalbuildvrt, nearblack, ogrinfo,
> ogr2ogr, sozip.
> This helps detecting errors such as specifying twice an argument that
> should be specified once (where generally the last instance was the one
> used). While we have tried to retain backwards compatibility for nominal
> use cases, obviously if you have scripts that accidentally specify an
> argument several times whereas it should be specified at most once, they
> will have to be corrected.
>
> Docker images with 3.9.0beta1 are currently cooking.
>
> master is now marked as 3.10.0dev, and the release/3.9 branch has been
> created. All bugfixes for 3.9 should be backported into it.
>
> Source snapshots at:
>
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta1.tar.xz
> - https://download.osgeo.org/gdal/3.9.0/gdal380beta1.zip
>
> Autotest snapshots:
>
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta1.zip
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240423/2e10ffa8/attachment-0001.htm>

From jgomezdans at gmail.com  Tue Apr 23 09:15:31 2024
From: jgomezdans at gmail.com (Jose Gomez-Dans)
Date: Tue, 23 Apr 2024 17:15:31 +0100
Subject: [gdal-dev] Best way to GTiff options for hyperspectral data
Message-ID: <CAMWde5rSdgzjmcgBux6c7M58xyvF1mfaussW6nvYMuEHr4vZCw@mail.gmail.com>

Hello,

I have quite a lot of very large hyperspectral data (>600 bands). The data
is in ENVI BIL format, but I would like to use GTiff for it, and possibly
access the data via HTTPS for processing and visualisation. I notice that
in the STAC world, it's one file per band, which gets a bit tiring quickly
;-) Are there some recommendations for this kind of data? I will need to
look at a few bands "spatially" (e.g. build a false colour RGB), but also
quickly access the whole spectrum.

Thanks!
Jose
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240423/2e9d8a1f/attachment.htm>

From holger.jaekel at gmx.de  Tue Apr 23 09:58:56 2024
From: holger.jaekel at gmx.de (Holger Jaekel)
Date: Tue, 23 Apr 2024 18:58:56 +0200
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
In-Reply-To: <be418c17-56ff-4a4b-80a0-8c825ed8f0d7@spatialys.com>
References: <5d80ad65-c434-4502-b450-adaa738f5491@spatialys.com>
 <fceaf807-b818-4f40-9de6-b54831832412@gmx.de>
 <be418c17-56ff-4a4b-80a0-8c825ed8f0d7@spatialys.com>
Message-ID: <bae6e37c-5365-4198-84d2-e03ec1b80dfe@gmx.de>

Even,

Thanks for the quick fix, I can confirm that it works.

Holger

Am 22.04.24 um 23:52 schrieb Even Rouault:
> Holger,
>
> thanks for the report. This should be fixed per
> https://github.com/OSGeo/gdal/commit/fba559b5bd8d33aac215681df4f6a613517a6c43 which I've backported to the release/3.9 branch
>
> A workaround is to explicitly run "cmake --target
> generate_gdal_version_h" before building all other targets
>
> Even
>
> Le 22/04/2024 ? 23:28, Holger Jaekel via gdal-dev a ?crit?:
>> Hi Even,
>>
>> Am 22.04.24 um 14:12 schrieb Even Rouault via gdal-dev:
>>> I've prepared a beta1 of GDAL 3.9.0 to get feedback from early testers.
>>
>> I tried to build on Alpine Linux Edge and got the following error:
>>
>>
>> /builds/hjaekel/aports/community/gdal/src/gdal-3.9.0beta1/ogr/ogr_core.h:38:10:
>> fatal error: gdal_version.h: No such file or directory
>> ?? 38 | #include "gdal_version.h"
>> ????? |????????? ^~~~~~~~~~~~~~~~
>> compilation terminated.
>>
>>
>> gdal_version.h seems not to be generated to build/gcore.
>>
>> You can find the full build logs here:
>> https://gitlab.alpinelinux.org/hjaekel/aports/-/pipelines/228841
>>
>> Holger
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


From public at postholer.com  Tue Apr 23 10:00:39 2024
From: public at postholer.com (Scott)
Date: Tue, 23 Apr 2024 10:00:39 -0700
Subject: [gdal-dev] Best way to GTiff options for hyperspectral data
In-Reply-To: <CAMWde5rSdgzjmcgBux6c7M58xyvF1mfaussW6nvYMuEHr4vZCw@mail.gmail.com>
References: <CAMWde5rSdgzjmcgBux6c7M58xyvF1mfaussW6nvYMuEHr4vZCw@mail.gmail.com>
Message-ID: <49cbb9a3-9b98-4818-8678-8234194bc2e9@postholer.com>

You might create a Cloud Optimized GeoTiff (COG) from ENVI for 
frequently use band combinations, such as:

gdalwarp -f COG -co COMPRESSION=DEFLATE -t_srs EPSG:4326 \
    -src_band 23 -dst_band 1 \
    -src_band 130 -dst_band 2 \
    -src_band 420 -dst_band 3 \
[envi file] new.tif

Now, you have a COG that can be efficiently accessed over the web for 
visualization/analysis using software like Leaflet and 
georaster-for-leaflet.

You can can style (analyze) band(s) pixel values using 
georaster-for-leaflet by defining custom palettes. Note, the more bands 
and the larger the data type will mean more data. So, a single band, 
byte value will always load fastest. Doing something like a 3 band Int16 
isn't painfully slow. I've got tons of examples for COG (and FGB) at 
CloudNaitveMaps.com

https://leafletjs.com/
https://github.com/GeoTIFF/georaster-layer-for-leaflet


On 4/23/24 09:15, Jose Gomez-Dans via gdal-dev wrote:
> Hello,
> 
> I have quite a lot of very large hyperspectral data (>600 bands). The 
> data is in ENVI BIL format, but I would like to use GTiff for it, and 
> possibly access the data via HTTPS for processing and visualisation. I 
> notice that in the STAC world, it's one file per band, which gets a bit 
> tiring quickly ;-) Are there some recommendations for this kind of data? 
> I will need to look at a few bands "spatially" (e.g. build a false 
> colour RGB), but also quickly access the whole spectrum.
> 
> Thanks!
> Jose
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From knudsen.thomas at gmail.com  Tue Apr 23 12:39:33 2024
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Tue, 23 Apr 2024 21:39:33 +0200
Subject: [gdal-dev] Question on building multi band composite and going
 back to RGB GeoTiff
In-Reply-To: <CADRrdKvFojpDUKQ+Aa_4gJU=mzQ8q9RmWhsvrXFmBDXvH1j_Fw@mail.gmail.com>
References: <CYXPR19MB8403A82EE81923FA56AB6A5AB0122@CYXPR19MB8403.namprd19.prod.outlook.com>
 <CANnaQaaBbd3sKuD9n85Nyq6TP9ByzBtSMFFUgvWzeBWP6Qy2Ow@mail.gmail.com>
 <CYXPR19MB840341529EEC32BDD9F7D545B0122@CYXPR19MB8403.namprd19.prod.outlook.com>
 <cfb68a02-5cc5-6848-8b52-49d6a5bb557c@aitchison.me.uk>
 <CADRrdKvFojpDUKQ+Aa_4gJU=mzQ8q9RmWhsvrXFmBDXvH1j_Fw@mail.gmail.com>
Message-ID: <CAH0YoEOKPZNULx4o=1eKv9FAEtxe_4A8id-A3-ub6VR5O2O7pA@mail.gmail.com>

Way back in a different career stage, I published this method for
displaying colour-infrared as fairly convincing pseudo-true colour:
https://www.researchgate.net/publication/242078137_A_simplified_method_for_generation_of_pseudo_natural_colours_from_colour_infrared_aerial_photos

At least one company provided material based on this algorithm, as a
commercial service around 2005.

/Thomas

Den man. 22. apr. 2024 kl. 20.13 skrev Javier Jimenez Shaw via gdal-dev <
gdal-dev at lists.osgeo.org>:

> In addition to all the previous, what about gamma correction?
> Maybe your RGB images are gamma corrected, while the other bands are not.
> In that case you will be comparing apples and oranges (in addition to the
> scaling problems described before).
> That also means that using the multispectral images (even if you had a
> Blue one) without gamma correction will have a strange color for us humans
> using a monitor.
>
> What I did in the past was to "fake" blue as a combination of red and
> green (yes, it is not perfect, but better than nothing), and apply a gamma
> of 2 to all the bands.
>
> Other "nice" option is to display them as CIR
> https://www.mngeo.state.mn.us/chouse/airphoto/cir.html
>
> Cheers
> Javier
>
> On Mon, 22 Apr 2024 at 17:49, Andrew C Aitchison via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> On Mon, 22 Apr 2024, Raley, Nathan via gdal-dev wrote:
>>
>> > Hmm, good catch.  Looking at the stats for the red band:
>> >
>> > Band 1 Block=128x128 Type=UInt16, ColorInterp=Gray
>> >  Min=130.000 Max=36265.000
>> >  Minimum=130.000, Maximum=36265.000, Mean=10415.962, StdDev=3502.933
>> >  NoData Value=0
>> >  Metadata:
>> >    STATISTICS_MAXIMUM=36265
>> >    STATISTICS_MEAN=10415.961859513
>> >    STATISTICS_MINIMUM=130
>> >    STATISTICS_STDDEV=3502.9325925887
>> >    STATISTICS_VALID_PERCENT=49
>> >
>> > So, is there no way to actually do this via command line, or am I going
>> to have to write a python lib to actually read through these and determine
>> what they should be scaled to?
>>
>> There is gdal_transform -scale (and -scale_2 etc.)
>>
>> What are you going to do with the resulting file ?
>> QGIS allows you to make these sorts of adjustments at view-time.
>>
>> Remember that the max and min values present in an image may not represent
>> the full range and the next-door image may have a larger or smaller range
>> (or just a shifted range). Imagine a row of three tiles; the middle on on
>> the edge of a glacier, the first entirely on the glacier and the last
>> entirely off the glacier. You may wish to apply the same scaling to all
>> three.
>>
>> > From: Daniel Evans <daniel.fred.evans at gmail.com>
>> > Sent: Monday, April 22, 2024 9:29 AM
>> > To: Raley, Nathan <nraley at gaig.com>
>> > Cc: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <
>> gdal-dev at lists.osgeo.org>
>> > Subject: [External] Re: [gdal-dev] Question on building multi band
>> composite and going back to RGB GeoTiff
>> >
>> > Hi Nathan, My initial suspicion might just be that the scaling the data
>> provider did to go from the raw data to a human-eye-friendly RGB composite
>> isn't the conversion you're assuming. I know that with the data I regularly
>> work with,
>> >
>> > Hi Nathan,
>> >
>> > My initial suspicion might just be that the scaling the data provider
>> did to go from the raw data to a human-eye-friendly RGB composite isn't the
>> conversion you're assuming.
>> >
>> > I know that with the data I regularly work with, it may be provided as
>> Uint16, but the data range doesn't extend all the way to 65535.
>> >
>> > If you compare the values in the separate R and G images to the RGB
>> composite, do they appear to match the conversion you're assuming, or is
>> there a different scaling (and possibly offset)?
>> >
>> > Cheers,
>> > Daniel
>> >
>> > On Mon, 22 Apr 2024, 15:20 Raley, Nathan via gdal-dev, <
>> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
>> > I currently have a RGB geotiff composite image that has a Byte
>> datatype.  I also have individual band images for R, G, Redge, and NIR that
>> are UInt16 datatypes.  Since I?m missing the Blue band from the individual
>> bands, I was attempting to extract the blue band from the RGB composite
>> image, scale it up to the UInt16 datatype, and build a composite VRT with
>> R, G, B, NIR, RE bands included in it.  I was then attempting to extract
>> the RGB bands from the multispec VRT in order to see if the process was
>> working as intended, but I?m getting an extremely blue image.
>> >
>> > Can anyone shed some light as to what I may be doing wrong here?
>> >
>> > I started by building a VRT for each band:
>> > gdal_translate source_RGB.tif b.vrt -ot UInt16 -of VRT -b 3 -scale 0
>> 255 0 65535
>> > gdalbuildvrt -b 1 r.vrt source_R.tif
>> > gdalbuildvrt -b 1 g.vrt source_G.tif
>> > gdalbuildvrt -b 1 nir.vrt source_NIR.tif
>> > gdalbuildvrt -b 1 re.vrt source_RE.tif
>> >
>> > I then merged the VRTs:
>> > gdalbuildvrt -separate multispec.vrt r.vrt g.vrt b.vrt nir.vrt re.vrt
>> >
>> > I now have a multispec.vrt with the R, G, B, NIR, and RE bands, all
>> with a UInt16 datatype.
>> >
>> > Now, I attempted to rebuild a RGB GeoTiff from the composite VRT with
>> something like:
>> > gdal_translate -ot Byte -of GTiff -b 1 -b 2 -b 3 -scale 0 65535 0 255
>> -co PHOTOMETRIC=RGB multispec.vrt multispec.tif
>> >
>> > Viewing the result in QGIS appears overly blue.  What am I doing wrong
>> here?
>> >
>> > Thanks,
>> > Nathan
>> >
>> > ________________________________
>> > This email transmission, including any attachments, is intended solely
>> for the addressee named above, and may contain confidential or privileged
>> information. If you are not the intended recipient, be aware that any
>> disclosure, copying, distribution or use of the contents of this e-mail is
>> prohibited. If you have received this e-mail in error, please notify the
>> sender immediately by reply email and destroy the message and its
>> attachments.
>> > _______________________________________________
>> > gdal-dev mailing list
>> > gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev<
>> https://urldefense.com/v3/__https:/lists.osgeo.org/mailman/listinfo/gdal-dev__;!!CsmrWXz9mOkSc4Hdn1fjj00!wHjHtqIprjw9nQ3elKNFMUWmEwR3sKx-zrxpsNEk-kBIhomauYshqPep8-beAmn7Ma8NlmL95Mqf9c8fol37c2o$
>> >
>> >
>> > This email transmission, including any attachments, is intended solely
>> for the addressee named above, and may contain confidential or privileged
>> information. If you are not the intended recipient, be aware that any
>> disclosure, copying, distribution or use of the contents of this e-mail is
>> prohibited. If you have received this e-mail in error, please notify the
>> sender immediately by reply email and destroy the message and its
>> attachments.
>> >
>>
>> --
>> Andrew C. Aitchison                      Kendal, UK
>>                     andrew at aitchison.me.uk
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240423/edb30eb8/attachment.htm>

From j1 at jimenezshaw.com  Wed Apr 24 01:33:17 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 24 Apr 2024 10:33:17 +0200
Subject: [gdal-dev] Reading interpolated values on DSM
Message-ID: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>

Hi

I would like to read in QGIS or GDAL an interpolated value in a DSM (well,
actually it is a geoid model, but it is the same behaviour). See that I do
not want the pixel value, but the linear interpolation among the neighbour
pixels, assuming that the pixel value is in the center of the pixel.
For instance, this file
https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html

Is there any way to get it (without implementing the interpolation myself)?
If I understood correctly gdallocationinfo is not interpolating, just
giving the pixel value.

Thanks

.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/0c49dfbd/attachment.htm>

From runette at gmail.com  Wed Apr 24 01:51:28 2024
From: runette at gmail.com (Paul Harwood)
Date: Wed, 24 Apr 2024 09:51:28 +0100
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
Message-ID: <CAE8nN5MLouYPMb9=rN98T_Z_OXhse-NbkrDJ5mw7L=gu1vowYQ@mail.gmail.com>

If you want to do it in QGIS ...

https://plugins.qgis.org/plugins/rasterinterpolation/

On Wed, 24 Apr 2024, 09:33 Javier Jimenez Shaw via gdal-dev, <
gdal-dev at lists.osgeo.org> wrote:

> Hi
>
> I would like to read in QGIS or GDAL an interpolated value in a DSM (well,
> actually it is a geoid model, but it is the same behaviour). See that I do
> not want the pixel value, but the linear interpolation among the neighbour
> pixels, assuming that the pixel value is in the center of the pixel.
> For instance, this file
> https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html
>
> Is there any way to get it (without implementing the interpolation myself)?
> If I understood correctly gdallocationinfo is not interpolating, just
> giving the pixel value.
>
> Thanks
>
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/5711a9e9/attachment-0001.htm>

From j1 at jimenezshaw.com  Wed Apr 24 01:59:17 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 24 Apr 2024 10:59:17 +0200
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <CAE8nN5MLouYPMb9=rN98T_Z_OXhse-NbkrDJ5mw7L=gu1vowYQ@mail.gmail.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
 <CAE8nN5MLouYPMb9=rN98T_Z_OXhse-NbkrDJ5mw7L=gu1vowYQ@mail.gmail.com>
Message-ID: <CADRrdKvnV8+c0ij4qK1HMMZnF3TYS5eLU5pXe+KwpH0Lu-W0zg@mail.gmail.com>

I think it is not QGIS 3 compatible. It is very old (yes, I tried to
install from the zip,.. and failed)

On Wed, 24 Apr 2024 at 10:51, Paul Harwood <runette at gmail.com> wrote:

> If you want to do it in QGIS ...
>
> https://plugins.qgis.org/plugins/rasterinterpolation/
>
> On Wed, 24 Apr 2024, 09:33 Javier Jimenez Shaw via gdal-dev, <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi
>>
>> I would like to read in QGIS or GDAL an interpolated value in a DSM
>> (well, actually it is a geoid model, but it is the same behaviour). See
>> that I do not want the pixel value, but the linear interpolation among the
>> neighbour pixels, assuming that the pixel value is in the center of the
>> pixel.
>> For instance, this file
>> https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html
>>
>> Is there any way to get it (without implementing the interpolation
>> myself)?
>> If I understood correctly gdallocationinfo is not interpolating, just
>> giving the pixel value.
>>
>> Thanks
>>
>> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/edef76e5/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr 24 02:09:05 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 24 Apr 2024 09:09:05 +0000
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
Message-ID: <DB9PR09MB6887CD9C7DF5DEC1A1625AD8FD102@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

How about making a VRT file with doubled pixel size by applying your favourite resampling method and then making a query from the VRT file with gdallocationinfo?

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Javier Jimenez Shaw via gdal-dev
L?hetetty: keskiviikko 24. huhtikuuta 2024 11.33
Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Reading interpolated values on DSM

Hi

I would like to read in QGIS or GDAL an interpolated value in a DSM (well, actually it is a geoid model, but it is the same behaviour). See that I do not want the pixel value, but the linear interpolation among the neighbour pixels, assuming that the pixel value is in the center of the pixel.
For instance, this file
https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html

Is there any way to get it (without implementing the interpolation myself)?
If I understood correctly gdallocationinfo is not interpolating, just giving the pixel value.

Thanks

.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/f257b93b/attachment.htm>

From kreve at sdfi.dk  Wed Apr 24 03:37:12 2024
From: kreve at sdfi.dk (Kristian Evers)
Date: Wed, 24 Apr 2024 10:37:12 +0000
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
Message-ID: <db91ddf256dc43a08203a53c1da2abf9@sdfi.dk>

Hi Javier

I regularly use PROJ for that. It?s a bit of a hack but it works. Here?s a demonstration using the DVR90_2023 geoid. The lower left grid point is at (7,53.5) and the horizontal grid spacing is 0.1 degree. Below I first get the actual grid values at two adjacent grid points and then lastly interpolate the grid value in between those two points:

echo 7 53.5  | cct -t0 -z0  +proj=vgridshift +grids=dk_sdfi_dvr90_2023.tif +multiplier=1
  7.0000000000   53.5000000000       40.2720        0.0000

(fire-dev) C:\Temp\fire\obs-beregning>echo 7 53.51  | cct -t0 -z0  +proj=vgridshift +grids=dk_sdfi_dvr90_2023.tif +multiplier=1
  7.0000000000   53.5100000000       40.2590        0.0000

(fire-dev) C:\Temp\fire\obs-beregning>echo 7 53.505  | cct -t0 -z0  +proj=vgridshift +grids=dk_sdfi_dvr90_2023.tif +multiplier=1
  7.0000000000   53.5050000000       40.2655        0.0000

The grid values are obviously the third component of the output coordinates.

/Kristian


From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Javier Jimenez Shaw via gdal-dev
Sent: 24. april 2024 10:33
To: gdal dev <gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] Reading interpolated values on DSM

Hi

I would like to read in QGIS or GDAL an interpolated value in a DSM (well, actually it is a geoid model, but it is the same behaviour). See that I do not want the pixel value, but the linear interpolation among the neighbour pixels, assuming that the pixel value is in the center of the pixel.
For instance, this file
https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html

Is there any way to get it (without implementing the interpolation myself)?
If I understood correctly gdallocationinfo is not interpolating, just giving the pixel value.

Thanks

.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/82338a6d/attachment-0001.htm>

From even.rouault at spatialys.com  Wed Apr 24 03:51:22 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 24 Apr 2024 12:51:22 +0200
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
Message-ID: <8868dcad-66f3-4e13-ae48-6d55b19efeb0@spatialys.com>

Hi,

I guess this discussion, and past similar ones, calls for an 
enhancement. A new API function, like CPLErr 
GDALRasterInterpolateAtPoint(GDALRasterBandH, double dfPixel, double 
dfLocation, GDALRIOResampleAlg eInterpolation, double *pdfValue), that 
could be used by a new mode of gdallocationinfo. The 
GDALRPCGetDEMHeight() function in alg/gdal_rpc.cpp is a plausible 
candidate implementation for bilinear and bicubic (we could potentially 
restrict to that at the moment).

Even

Le 24/04/2024 ? 10:33, Javier Jimenez Shaw via gdal-dev a ?crit?:
> Hi
>
> I would like to read in QGIS or GDAL an interpolated value in a DSM 
> (well, actually it is a geoid model, but it is the same behaviour). 
> See that I do not want the pixel value, but the linear interpolation 
> among the neighbour pixels, assuming that the pixel value is in the 
> center of the pixel.
> For instance, this file
> https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html
>
> Is there any way to get it (without implementing the interpolation 
> myself)?
> If I understood correctly gdallocationinfo is not interpolating, just 
> giving the pixel value.
>
> Thanks
>
> .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/adc66b99/attachment.htm>

From mdsumner at gmail.com  Wed Apr 24 06:00:20 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 24 Apr 2024 23:00:20 +1000
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <8868dcad-66f3-4e13-ae48-6d55b19efeb0@spatialys.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
 <8868dcad-66f3-4e13-ae48-6d55b19efeb0@spatialys.com>
Message-ID: <CAAcGz9-4yOb4ygqS2408Og2PcTvKr+Xfq9SNJvXT-ya80m5KSw@mail.gmail.com>

Or a grouping function that returned the cell index for neighbours and
weighting that are involved in whatever calculation summary is wanted.

Maybe the warper could return this as a starting point rather than doing
the "task at hand". ?



On Wed, Apr 24, 2024 at 8:51?PM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I guess this discussion, and past similar ones, calls for an enhancement.
> A new API function, like CPLErr
> GDALRasterInterpolateAtPoint(GDALRasterBandH, double dfPixel, double
> dfLocation, GDALRIOResampleAlg eInterpolation, double *pdfValue), that
> could be used by a new mode of gdallocationinfo. The GDALRPCGetDEMHeight()
> function in alg/gdal_rpc.cpp is a plausible candidate implementation for
> bilinear and bicubic (we could potentially restrict to that at the moment).
>
> Even
> Le 24/04/2024 ? 10:33, Javier Jimenez Shaw via gdal-dev a ?crit :
>
> Hi
>
> I would like to read in QGIS or GDAL an interpolated value in a DSM (well,
> actually it is a geoid model, but it is the same behaviour). See that I do
> not want the pixel value, but the linear interpolation among the neighbour
> pixels, assuming that the pixel value is in the center of the pixel.
> For instance, this file
> https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html
>
> Is there any way to get it (without implementing the interpolation myself)?
> If I understood correctly gdallocationinfo is not interpolating, just
> giving the pixel value.
>
> Thanks
>
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/230b0c0f/attachment.htm>

From even.rouault at spatialys.com  Wed Apr 24 06:16:08 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 24 Apr 2024 15:16:08 +0200
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <CAAcGz9-4yOb4ygqS2408Og2PcTvKr+Xfq9SNJvXT-ya80m5KSw@mail.gmail.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
 <8868dcad-66f3-4e13-ae48-6d55b19efeb0@spatialys.com>
 <CAAcGz9-4yOb4ygqS2408Og2PcTvKr+Xfq9SNJvXT-ya80m5KSw@mail.gmail.com>
Message-ID: <a52768f1-8dd2-43e6-97f3-f85d7b14eaf1@spatialys.com>


Le 24/04/2024 ? 15:00, Michael Sumner a ?crit?:
> Or a grouping function that returned the cell index for neighbours and 
> weighting that are involved in whatever calculation?summary is wanted.
That doesn't seem super user friendly, as users would still be left to 
do the raster value extraction and applying the weights, taking into 
account nodata, etc. Not trivial. What is the advantage of this compared 
to returning the interpolated value? The only one I see is to 
potentially save a bit of computation if you need to interpolate values 
at the same location in multiple bands, but the performance gain would 
probably be marginal (or if not, then a variant of the function dealing 
with multiple bands could be offered)
>
> Maybe the warper could?return this as a starting?point rather than 
> doing the "task at hand". ?
The warper code has indeed a "FilterFuncType 
GWKGetFilterFunc(GDALResampleAlg eResampleAlg)" method that returns a 
function that returns interpolation weights and int 
GWKGetFilterRadius(GDALResampleAlg eResampleAlg). The code in 
GDALRPCGetDEMHeight() has an interesting logic where it caches a window 
of interest around the first queried pixel so that subsequent queries in 
the neighbouroud can be honoured without going to RasterIO(). This 
substantially improves performance in the RPC case, in particular during 
reverse transformation where you use an iterative method and thus may 
need a lot of DEM extraction to compute a single point.
>
>
>
> On Wed, Apr 24, 2024 at 8:51?PM Even Rouault via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>     Hi,
>
>     I guess this discussion, and past similar ones, calls for an
>     enhancement. A new API function, like CPLErr
>     GDALRasterInterpolateAtPoint(GDALRasterBandH, double dfPixel,
>     double dfLocation, GDALRIOResampleAlg eInterpolation, double
>     *pdfValue), that could be used by a new mode of gdallocationinfo.
>     The GDALRPCGetDEMHeight() function in alg/gdal_rpc.cpp is a
>     plausible candidate implementation for bilinear and bicubic (we
>     could potentially restrict to that at the moment).
>
>     Even
>
>     Le 24/04/2024 ? 10:33, Javier Jimenez Shaw via gdal-dev a ?crit?:
>>     Hi
>>
>>     I would like to read in QGIS or GDAL an interpolated value in a
>>     DSM (well, actually it is a geoid model, but it is the same
>>     behaviour). See that I do not want the pixel value, but the
>>     linear interpolation among the neighbour pixels, assuming that
>>     the pixel value is in the center of the pixel.
>>     For instance, this file
>>     https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html
>>
>>     Is there any way to get it (without implementing the
>>     interpolation myself)?
>>     If I understood correctly gdallocationinfo is not interpolating,
>>     just giving the pixel value.
>>
>>     Thanks
>>
>>     .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240424/7a6cfbc5/attachment.htm>

From even.rouault at spatialys.com  Wed Apr 24 11:45:39 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 24 Apr 2024 20:45:39 +0200
Subject: [gdal-dev] Bumping TileDB minimum from 2.7 to 2.15 for GDAL 3.9?
Message-ID: <e1a6086e-7d45-46e1-88c6-465eb35b7fb5@spatialys.com>

Hi,

A future TileDB version will remove various deprecated API that the GDAL 
TileDB driver currently uses. https://github.com/OSGeo/gdal/pull/9725 
migrates away from those deprecated APIs, but that causes the minimum 
requirement from TileDB to go from 2.7 to 2.15. It would probably be 
wise to backport this cleanup in the 3.9 branch, so that it doesn't 
cause later packaging issues, typically with conda-forge builds as soon 
as they will package the future TileDB version removing the deprecated 
APIs, which might occur during the GDAL 3.9.x life cycle. Does anyone 
see an issue in doing this bump? The few distributions I'm aware of 
shipping TileDB meet the >= 2.15 requirement: Conda-forge already ships 
TileDB 2.22, Alpine Linux is a 2.17.4.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From j1 at jimenezshaw.com  Wed Apr 24 15:00:36 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 25 Apr 2024 00:00:36 +0200
Subject: [gdal-dev] Bumping TileDB minimum from 2.7 to 2.15 for GDAL 3.9?
In-Reply-To: <e1a6086e-7d45-46e1-88c6-465eb35b7fb5@spatialys.com>
References: <e1a6086e-7d45-46e1-88c6-465eb35b7fb5@spatialys.com>
Message-ID: <CADRrdKsT5wpdM801VLS6-9+RiFc_pMJaMwTNb1ooiE_CL6m8PA@mail.gmail.com>

Not knowing any detail about TileDB, I find good this bump in GDAL 3.9.0,
that is already changing many other dependency minimum versions.

On Wed, 24 Apr 2024 at 20:45, Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> A future TileDB version will remove various deprecated API that the GDAL
> TileDB driver currently uses. https://github.com/OSGeo/gdal/pull/9725
> migrates away from those deprecated APIs, but that causes the minimum
> requirement from TileDB to go from 2.7 to 2.15. It would probably be
> wise to backport this cleanup in the 3.9 branch, so that it doesn't
> cause later packaging issues, typically with conda-forge builds as soon
> as they will package the future TileDB version removing the deprecated
> APIs, which might occur during the GDAL 3.9.x life cycle. Does anyone
> see an issue in doing this bump? The few distributions I'm aware of
> shipping TileDB meet the >= 2.15 requirement: Conda-forge already ships
> TileDB 2.22, Alpine Linux is a 2.17.4.
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240425/e67fc596/attachment.htm>

From andrew at aitchison.me.uk  Wed Apr 24 15:39:10 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 24 Apr 2024 23:39:10 +0100 (BST)
Subject: [gdal-dev] Bumping TileDB minimum from 2.7 to 2.15 for GDAL 3.9?
In-Reply-To: <e1a6086e-7d45-46e1-88c6-465eb35b7fb5@spatialys.com>
References: <e1a6086e-7d45-46e1-88c6-465eb35b7fb5@spatialys.com>
Message-ID: <139db57e-b4ec-2645-a84c-01d57b07dc81@aitchison.me.uk>


On Wed, 24 Apr 2024, Even Rouault via gdal-dev wrote:

> A future TileDB version will remove various deprecated API that the GDAL 
> TileDB driver currently uses. https://github.com/OSGeo/gdal/pull/9725 
> migrates away from those deprecated APIs, but that causes the minimum 
> requirement from TileDB to go from 2.7 to 2.15. It would probably be wise 
> to backport this cleanup in the 3.9 branch, so that it doesn't cause 
> later packaging issues, typically with conda-forge builds as soon as they 
> will package the future TileDB version removing the deprecated APIs, 
> which might occur during the GDAL 3.9.x life cycle. Does anyone see an 
> issue in doing this bump? The few distributions I'm aware of shipping 
> TileDB meet the >= 2.15 requirement: Conda-forge already ships TileDB 
> 2.22, Alpine Linux is a 2.17.4.

https://docs.tiledb.com/main/how-to/installation/building-from-source
suggests that TileDB requires a C++20 compiler.

Is that an issue ?

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Wed Apr 24 15:51:33 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 25 Apr 2024 00:51:33 +0200
Subject: [gdal-dev] Bumping TileDB minimum from 2.7 to 2.15 for GDAL 3.9?
In-Reply-To: <139db57e-b4ec-2645-a84c-01d57b07dc81@aitchison.me.uk>
References: <e1a6086e-7d45-46e1-88c6-465eb35b7fb5@spatialys.com>
 <139db57e-b4ec-2645-a84c-01d57b07dc81@aitchison.me.uk>
Message-ID: <239e2713-cfe3-422e-8128-690cdb68dd03@spatialys.com>


Le 25/04/2024 ? 00:39, Andrew C Aitchison via gdal-dev a ?crit?:
>
> On Wed, 24 Apr 2024, Even Rouault via gdal-dev wrote:
>
>> A future TileDB version will remove various deprecated API that the 
>> GDAL TileDB driver currently uses. 
>> https://github.com/OSGeo/gdal/pull/9725 migrates away from those 
>> deprecated APIs, but that causes the minimum requirement from TileDB 
>> to go from 2.7 to 2.15. It would probably be wise to backport this 
>> cleanup in the 3.9 branch, so that it doesn't cause later packaging 
>> issues, typically with conda-forge builds as soon as they will 
>> package the future TileDB version removing the deprecated APIs, which 
>> might occur during the GDAL 3.9.x life cycle. Does anyone see an 
>> issue in doing this bump? The few distributions I'm aware of shipping 
>> TileDB meet the >= 2.15 requirement: Conda-forge already ships TileDB 
>> 2.22, Alpine Linux is a 2.17.4.
>
> https://docs.tiledb.com/main/how-to/installation/building-from-source
> suggests that TileDB requires a C++20 compiler.
>
> Is that an issue ?

I don't think so. For now, the public C++ API of TileDB even of the 
latest versions is C++17 compatible.? And to build TileDB itself, 
digging into their CMakeLists.txt, I see that up to 2.16, it used to be 
C++17 compatible, so it should be possible to have a GDAL build against 
TileDB with only a C++17 compiler by sticking to TileDB 2.15 or 2.16. 
The requirement for C++20 to build TileDB has started with 2.17.0.

On a somewhat related note, I should not that the upcoming version of 
Poppler (2024.05) requires a C++20 compiler, including to include its 
headers from GDAL (as we use a somewhat semi-public/semi-private C++ 
API, not much care is done on it to be usable). So some of our 
dependencies might require C++20 in their latest versions. And before we 
switched GDAL to require C++17 we already had to force C++17 for some 
drivers like TileDB, Poppler, PDFIUM.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From Roger.Bivand at nhh.no  Thu Apr 25 02:21:10 2024
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 25 Apr 2024 09:21:10 +0000
Subject: [gdal-dev] GDAL 3.9.0beta1 available for testing
Message-ID: <SV0P279MB04755E1334247103923DD9B7EE172@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>

No adverse impacts of GDAL 3.9.0 beta1 on reverse dependency checks of 935 R packages depending on R packages sf and/or terra, both linking to GDAL. I had to wait a bit to transition to Fedora 40, gcc 14.0.1, and R 4.4.0 released yesterday, but all good as far as I can tell.

Roger

--
Roger Bivand
Emeritus Professor
Norwegian School of Economics
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
Roger.Bivand at nhh.no

From liyenew at gmail.com  Thu Apr 25 05:28:24 2024
From: liyenew at gmail.com (Liyuneh Gebre)
Date: Thu, 25 Apr 2024 15:28:24 +0300
Subject: [gdal-dev] user-defined
Message-ID: <CAE4zf44cNq1NkpSdjRgXQe=xLcM6s0U1X-=MqE+o0B6w4hQw5A@mail.gmail.com>

Dear all,
I have difficulties in accurately reprojecting a raster file to a
user-defined projection.
I used the following commands in gdal while the output is not similar to
arcpy results.  kindly offer your guidance to achieve the same result.  The
arcpy uses custom transformation and then reprojection.
gdalwarp -t_srs '+proj=laea +a=6378137.0 +f=0.0 +pm=0 +x_0=0.0 +y_0=0.0
+lon_0=20.0 +lat_0=5.0 +units=m +axis=enu +no_defs'  -dstalpha  -wo
SOURCE_EXTRA=1000 -r nearest rain_in.bil rain_projected.bil

-- 
*Liyuneh Gebre**, **Associate Researcher*

*Ethiopian Institute of Agricultural Research,EIAR*

*Cell Phone:+251 911858155*

*linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
<https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
*skype:liyenew_1*
*Addis Ababa, Ethioipa*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240425/f65049a5/attachment.htm>

From johannespaul92 at gmail.com  Thu Apr 25 05:32:06 2024
From: johannespaul92 at gmail.com (Johannes Paul)
Date: Thu, 25 Apr 2024 14:32:06 +0200
Subject: [gdal-dev] Unable to open KMZ datasource using libkml
Message-ID: <CACcmK9b09TiRkVOgv6nwDpbLuk4e4nbyCo_Z+Xye5ssjOFAO2Q@mail.gmail.com>

Hello,
using GDAL 3.8.3 compiled with libkml, I'm unable to read a specific KMZ
file, using ogrinfo (error "unable to open datasource ...")
However if I extract the .kml index file for the kmz archive, GDAL can
provide ogrinfo on this .kml index file.
I noticed from the LIBKML driver documentation that GDAL will default to
look for a *doc.kml* index file which is not the case here, so I tried to
rename my index file and I also tried to use
*--config LIBKML_USE_DOC.KML=NO* without success.
Any idea to get GDAL to read the kmz file without unarchiving the kml index
?
Thanks
Johannes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240425/269f4053/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Apr 25 05:38:17 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 25 Apr 2024 14:38:17 +0200
Subject: [gdal-dev] Unable to open KMZ datasource using libkml
In-Reply-To: <CACcmK9b09TiRkVOgv6nwDpbLuk4e4nbyCo_Z+Xye5ssjOFAO2Q@mail.gmail.com>
References: <CACcmK9b09TiRkVOgv6nwDpbLuk4e4nbyCo_Z+Xye5ssjOFAO2Q@mail.gmail.com>
Message-ID: <0e807c2f-6910-4c4c-abe9-5038b2a6e17a@spatialys.com>

Hi,

you can try something kike ogrinfo /vsizip/your.kmz/your.kml

Even

Le 25/04/2024 ? 14:32, Johannes Paul via gdal-dev a ?crit?:
> Hello,
> using GDAL 3.8.3 compiled with libkml, I'm unable to read a specific 
> KMZ file, using ogrinfo (error "unable to open datasource ...")
> However if I extract the .kml index file for the kmz archive, GDAL can 
> provide ogrinfo on this .kml index file.
> I noticed from the LIBKML driver documentation that GDAL will default 
> to look for a /doc.kml/ index file which is not the case here, so I 
> tried to rename my index file and I also tried to use 
> /--config?LIBKML_USE_DOC.KML=NO/ without success.
> Any idea to get GDAL to read the kmz file without unarchiving the kml 
> index ?
> Thanks
> Johannes
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240425/8aad49c2/attachment.htm>

From johannespaul92 at gmail.com  Thu Apr 25 05:44:16 2024
From: johannespaul92 at gmail.com (Johannes Paul)
Date: Thu, 25 Apr 2024 14:44:16 +0200
Subject: [gdal-dev] Unable to open KMZ datasource using libkml
In-Reply-To: <0e807c2f-6910-4c4c-abe9-5038b2a6e17a@spatialys.com>
References: <CACcmK9b09TiRkVOgv6nwDpbLuk4e4nbyCo_Z+Xye5ssjOFAO2Q@mail.gmail.com>
 <0e807c2f-6910-4c4c-abe9-5038b2a6e17a@spatialys.com>
Message-ID: <CACcmK9b-z6nw8khW3A1bTGzzBbNgs-yoS6hC8S0qBQNwhGbMSQ@mail.gmail.com>

Nice, thanks !

On Thu, 25 Apr 2024 at 14:38, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> you can try something kike ogrinfo /vsizip/your.kmz/your.kml
>
> Even
> Le 25/04/2024 ? 14:32, Johannes Paul via gdal-dev a ?crit :
>
> Hello,
> using GDAL 3.8.3 compiled with libkml, I'm unable to read a specific KMZ
> file, using ogrinfo (error "unable to open datasource ...")
> However if I extract the .kml index file for the kmz archive, GDAL can
> provide ogrinfo on this .kml index file.
> I noticed from the LIBKML driver documentation that GDAL will default to
> look for a *doc.kml* index file which is not the case here, so I tried to
> rename my index file and I also tried to use
> *--config LIBKML_USE_DOC.KML=NO* without success.
> Any idea to get GDAL to read the kmz file without unarchiving the kml
> index ?
> Thanks
> Johannes
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240425/fe6815de/attachment.htm>

From lefsky at gmail.com  Thu Apr 25 12:36:36 2024
From: lefsky at gmail.com (lefsky at gmail.com)
Date: Thu, 25 Apr 2024 13:36:36 -0600
Subject: [gdal-dev] gdal2tiles for floating point images
Message-ID: <CAPryQ-MO6RqJ1iSSP8w-vCaEkUWVT-a1ZBVb9Egu3T95LEvQDg@mail.gmail.com>

I'd like to have a version of gdal2tiles that handles image types other
than uint8. Is there a reason why it doesn't handle those types of images?
It appears I'd have to modify the output format from png to tiff.  I have
never modified gdal source before and I'm wondering if this modification
(which appears straightforward to a naive user) hasn't been done before.

Michael


-- 
Michael Lefsky (He/His)
Home Location: HVHF+GH
Cell: 970-980-9036
http://www.researcherid.com/rid/A-7224-2009

*?for being prematurely, and worse, intuitively right ? there?s a heavy
price. But for being wrong ? no, not so long as you?re wrong in a pack."
Gary Brecher / Portis*

*I acknowledge that I live and work on stolen land. This is the land of the
Cheyenne, Arapaho, Ute, and Ocheithi Sakowin people. To learn more about
these nations, please visit;
http://www.utemountainutetribe.com/
http://www.cheyennenation.com/
https://cheyenneandarapaho-nsn.gov/
https://native-land.ca/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240425/9972dcf3/attachment.htm>

From j1 at jimenezshaw.com  Sat Apr 27 04:01:10 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sat, 27 Apr 2024 13:01:10 +0200
Subject: [gdal-dev] don't search side car files on s3 with gdalinfo
Message-ID: <CADRrdKv2OebuvnFh29_PypWb2kji4vNqLrZxiTrERmxuNyrv4A@mail.gmail.com>

Hi

I am accessing a big file in S3. All works fine (when I learned how to set
the authentication environment variables), but gdalinfo is checking for a
lot of files that do not exist. I know there is only a GeoTIFF - COG (no
side car files)

However gdalinfo is trying to find several side car files, that are not
there. S3 returns a 403. It takes its time to search for all those files.

Is there a way to tell to gdalinfo that it should not check for those files?

Bonus: QGIS is also taking time to open it (just using 'qgis' instead of
'gdalinfo' in the command line). I think it is for the same reason. It
there a hack there as well?

Thanks.

$ AWS_ACCESS_KEY_ID=... AWS_SECRET_ACCESS_KEY=... AWS_SESSION_TOKEN=...
gdalinfo /vsis3/blah/folder/ortho.tiff
Driver: GTiff/GeoTIFF
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.tiff.aux.xml: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.aux: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.AUX: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.tiff.aux: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.tiff.AUX: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.tiff.ovr: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.tiff.OVR: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.tiff.msk: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.tiff.MSK: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.XML: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.xml: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.IMD: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.imd: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.RPB: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.rpb: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.PVL: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.pvl: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_rpc.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_RPC.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_metadata.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_METADATA.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_MTL.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_MTL.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/METADATA.DIM: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/metadata.dim: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_metadata.xml: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho_METADATA.XML: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.RPC: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.rpc: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.pass: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/ortho.PASS: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/summary.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/SUMMARY.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/HDRdisplay.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/HDRdisplay.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/HDRho_display.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/HDRho_display.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/RPCdisplay.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/RPCdisplay.TXT: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/RPCho_display.txt: 403
Warning 1: HTTP response code on
https://blah.s3.amazonaws.com/folder/RPCho_display.TXT: 403
Files: /vsis3/blah/folder/ortho.tiff
...

.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240427/7bb173db/attachment.htm>

From michael.smith.erdc at gmail.com  Sat Apr 27 04:12:26 2024
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Sat, 27 Apr 2024 07:12:26 -0400
Subject: [gdal-dev] don't search side car files on s3 with gdalinfo
In-Reply-To: <CADRrdKv2OebuvnFh29_PypWb2kji4vNqLrZxiTrERmxuNyrv4A@mail.gmail.com>
References: <CADRrdKv2OebuvnFh29_PypWb2kji4vNqLrZxiTrERmxuNyrv4A@mail.gmail.com>
Message-ID: <09D60B3C-3CEA-430D-AB8A-B1F82E7F0735@gmail.com>

Javier,

 

You can control with the GDAL_DISABLE_READDIR_ON_OPEN configuration parameter (https://gdal.org/user/configoptions.html). Typically, I set GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR which will disable this.

 

Mike

 

 

-- 

Michael Smith

Remote Sensing/GIS Center

US Army Corps of Engineers

 

 

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Javier Jimenez Shaw via gdal-dev <gdal-dev at lists.osgeo.org>
Reply-To: Javier Jimenez Shaw <j1 at jimenezshaw.com>
Date: Saturday, April 27, 2024 at 7:01 AM
To: gdal dev <gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] don't search side car files on s3 with gdalinfo

 

Hi

 

I am accessing a big file in S3. All works fine (when I learned how to set the authentication environment variables), but gdalinfo is checking for a lot of files that do not exist. I know there is only a GeoTIFF - COG (no side car files)

 

However gdalinfo is trying to find several side car files, that are not there. S3 returns a 403. It takes its time to search for all those files.

 

Is there a way to tell to gdalinfo that it should not check for those files?

 

Bonus: QGIS is also taking time to open it (just using 'qgis' instead of 'gdalinfo' in the command line). I think it is for the same reason. It there a hack there as well?

 

Thanks.

 

$ AWS_ACCESS_KEY_ID=... AWS_SECRET_ACCESS_KEY=... AWS_SESSION_TOKEN=... gdalinfo /vsis3/blah/folder/ortho.tiff
Driver: GTiff/GeoTIFF
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.tiff.aux.xml: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.aux: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.AUX: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.tiff.aux: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.tiff.AUX: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.tiff.ovr: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.tiff.OVR: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.tiff.msk: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.tiff.MSK: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.XML: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.xml: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.IMD: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.imd: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.RPB: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.rpb: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.PVL: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.pvl: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_rpc.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_RPC.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_metadata.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_METADATA.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_MTL.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_MTL.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/METADATA.DIM: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/metadata.dim: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_metadata.xml: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho_METADATA.XML: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.RPC: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.rpc: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.pass: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/ortho.PASS: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/summary.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/SUMMARY.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/HDRdisplay.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/HDRdisplay.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/HDRho_display.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/HDRho_display.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/RPCdisplay.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/RPCdisplay.TXT: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/RPCho_display.txt: 403
Warning 1: HTTP response code on https://blah.s3.amazonaws.com/folder/RPCho_display.TXT: 403
Files: /vsis3/blah/folder/ortho.tiff

...

 

.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__

_______________________________________________ gdal-dev mailing list gdal-dev at lists.osgeo.org https://lists.osgeo.org/mailman/listinfo/gdal-dev 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240427/13ced694/attachment-0001.htm>

From even.rouault at spatialys.com  Sat Apr 27 04:48:31 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 27 Apr 2024 13:48:31 +0200
Subject: [gdal-dev] don't search side car files on s3 with gdalinfo
In-Reply-To: <09D60B3C-3CEA-430D-AB8A-B1F82E7F0735@gmail.com>
References: <CADRrdKv2OebuvnFh29_PypWb2kji4vNqLrZxiTrERmxuNyrv4A@mail.gmail.com>
 <09D60B3C-3CEA-430D-AB8A-B1F82E7F0735@gmail.com>
Message-ID: <85011746-3d4f-472e-8f94-88787e3ce875@spatialys.com>

yes, GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR is the trick to both disable 
directory listing and preventing individual file probing.

Javier, do you have GDAL_DISABLE_READDIR_ON_OPEN=YES also set? Otherwise 
if GDAL_DISABLE_READDIR_ON_OPEN is not set, GDAL will normally issue a 
S3 directory listing call, which should prevent later individual file 
probing (if we have the list of files in the directory, we just need to 
check the list, and don't need to do individual open()/GET attempts). 
But that director listing is sometimes still undesirable if doing it in 
a folder with a large number of files hence 
GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR. Or maybe you don't have 
directory listing permission in that folder/bucket?

Related to that, Howard filed https://github.com/OSGeo/gdal/issues/9443 
recently. but it is not that simple to find a different default behavior 
that doesn't result in functional regressions.

I was wondering if a solution, restricted to COG, couldn't be to put a 
hint in the so-called "header ghost area" 
(https://gdal.org/drivers/raster/cog.html#header-ghost-area), like 
SIDECAR_FILES=NO, that could be used by the GTiff driver. Not sure if it 
is the right way to address the issue however (and would work only for 
new files of course, and probably only on explicit user choice at file 
creation, because there could be scenarios where a user would want to 
provide side car files)

Le 27/04/2024 ? 13:12, Michael Smith via gdal-dev a ?crit?:
>
> Javier,
>
> You can control with the GDAL_DISABLE_READDIR_ON_OPEN configuration 
> parameter (https://gdal.org/user/configoptions.html). Typically, I set 
> GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR which will disable this.
>
> Mike
>
> -- 
>
> Michael Smith
>
> Remote Sensing/GIS Center
>
> US Army Corps of Engineers
>
> *From: *gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of 
> Javier Jimenez Shaw via gdal-dev <gdal-dev at lists.osgeo.org>
> *Reply-To: *Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *Date: *Saturday, April 27, 2024 at 7:01 AM
> *To: *gdal dev <gdal-dev at lists.osgeo.org>
> *Subject: *[gdal-dev] don't search side car files on s3 with gdalinfo
>
> Hi
>
> I am accessing a big file in S3. All works fine (when I learned how to 
> set the authentication environment variables), but gdalinfo is 
> checking for a lot of files that do not exist. I know there is only a 
> GeoTIFF - COG (no side car files)
>
> However gdalinfo is trying to find several side car files, that are 
> not there. S3 returns a 403. It takes its time to search for all those 
> files.
>
> Is there a way to tell to gdalinfo that it should not check for those 
> files?
>
> Bonus: QGIS is also taking time to open it (just using 'qgis' instead 
> of 'gdalinfo' in the command line). I think it is for the same reason. 
> It there a hack there as well?
>
> Thanks.
>
> $ AWS_ACCESS_KEY_ID=... AWS_SECRET_ACCESS_KEY=... 
> AWS_SESSION_TOKEN=... gdalinfo /vsis3/blah/folder/ortho.tiff
> Driver: GTiff/GeoTIFF
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.tiff.aux.xml: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.aux: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.AUX: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.tiff.aux: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.tiff.AUX: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.tiff.ovr: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.tiff.OVR: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.tiff.msk: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.tiff.MSK: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.XML: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.xml: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.IMD: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.imd: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.RPB: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.rpb: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.PVL: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.pvl: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_rpc.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_RPC.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_metadata.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_METADATA.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_MTL.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_MTL.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/METADATA.DIM: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/metadata.dim: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_metadata.xml: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho_METADATA.XML: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.RPC: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.rpc: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.pass: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/ortho.PASS: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/summary.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/SUMMARY.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/HDRdisplay.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/HDRdisplay.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/HDRho_display.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/HDRho_display.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/RPCdisplay.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/RPCdisplay.TXT: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/RPCho_display.txt: 403
> Warning 1: HTTP response code on 
> https://blah.s3.amazonaws.com/folder/RPCho_display.TXT: 403
> Files: /vsis3/blah/folder/ortho.tiff
>
> ...
>
> .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
>
> _______________________________________________ gdal-dev mailing list 
> gdal-dev at lists.osgeo.org 
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240427/89a4944f/attachment.htm>

From j1 at jimenezshaw.com  Sat Apr 27 05:08:33 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sat, 27 Apr 2024 14:08:33 +0200
Subject: [gdal-dev] don't search side car files on s3 with gdalinfo
In-Reply-To: <85011746-3d4f-472e-8f94-88787e3ce875@spatialys.com>
References: <CADRrdKv2OebuvnFh29_PypWb2kji4vNqLrZxiTrERmxuNyrv4A@mail.gmail.com>
 <09D60B3C-3CEA-430D-AB8A-B1F82E7F0735@gmail.com>
 <85011746-3d4f-472e-8f94-88787e3ce875@spatialys.com>
Message-ID: <CADRrdKvtUL=NTb4Ru2fTTsDHSERDY3SiJ39amuWbgaQbQwNxXw@mail.gmail.com>

Thanks Michael and Even

GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR works perfectly for me, in gdalinfo
and QGIS. Great.

Even. No, I was not setting GDAL_DISABLE_READDIR_ON_OPEN at all. I think I
do not have directory listing permission in that folder/bucket (that is why
it returns a 403, and not a 404, right?)

Cheers,
Javier.

On Sat, 27 Apr 2024 at 13:48, Even Rouault <even.rouault at spatialys.com>
wrote:

> yes, GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR is the trick to both disable
> directory listing and preventing individual file probing.
>
> Javier, do you have GDAL_DISABLE_READDIR_ON_OPEN=YES also set? Otherwise
> if GDAL_DISABLE_READDIR_ON_OPEN is not set, GDAL will normally issue a S3
> directory listing call, which should prevent later individual file probing
> (if we have the list of files in the directory, we just need to check the
> list, and don't need to do individual open()/GET attempts). But that
> director listing is sometimes still undesirable if doing it in a folder
> with a large number of files hence GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR.
> Or maybe you don't have directory listing permission in that folder/bucket?
>
> Related to that, Howard filed https://github.com/OSGeo/gdal/issues/9443
> recently. but it is not that simple to find a different default behavior
> that doesn't result in functional regressions.
>
> I was wondering if a solution, restricted to COG, couldn't be to put a
> hint in the so-called "header ghost area" (
> https://gdal.org/drivers/raster/cog.html#header-ghost-area), like
> SIDECAR_FILES=NO, that could be used by the GTiff driver. Not sure if it is
> the right way to address the issue however (and would work only for new
> files of course, and probably only on explicit user choice at file
> creation, because there could be scenarios where a user would want to
> provide side car files)
> Le 27/04/2024 ? 13:12, Michael Smith via gdal-dev a ?crit :
>
> Javier,
>
>
>
> You can control with the GDAL_DISABLE_READDIR_ON_OPEN configuration
> parameter (https://gdal.org/user/configoptions.html). Typically, I set
> GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR which will disable this.
>
>
>
> Mike
>
>
>
>
>
> --
>
> Michael Smith
>
> Remote Sensing/GIS Center
>
> US Army Corps of Engineers
>
>
>
>
>
> *From: *gdal-dev <gdal-dev-bounces at lists.osgeo.org>
> <gdal-dev-bounces at lists.osgeo.org> on behalf of Javier Jimenez Shaw via
> gdal-dev <gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org>
> *Reply-To: *Javier Jimenez Shaw <j1 at jimenezshaw.com> <j1 at jimenezshaw.com>
> *Date: *Saturday, April 27, 2024 at 7:01 AM
> *To: *gdal dev <gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org>
> *Subject: *[gdal-dev] don't search side car files on s3 with gdalinfo
>
>
>
> Hi
>
>
>
> I am accessing a big file in S3. All works fine (when I learned how to set
> the authentication environment variables), but gdalinfo is checking for a
> lot of files that do not exist. I know there is only a GeoTIFF - COG (no
> side car files)
>
>
>
> However gdalinfo is trying to find several side car files, that are not
> there. S3 returns a 403. It takes its time to search for all those files.
>
>
>
> Is there a way to tell to gdalinfo that it should not check for those
> files?
>
>
>
> Bonus: QGIS is also taking time to open it (just using 'qgis' instead of
> 'gdalinfo' in the command line). I think it is for the same reason. It
> there a hack there as well?
>
>
>
> Thanks.
>
>
>
> $ AWS_ACCESS_KEY_ID=... AWS_SECRET_ACCESS_KEY=... AWS_SESSION_TOKEN=...
> gdalinfo /vsis3/blah/folder/ortho.tiff
> Driver: GTiff/GeoTIFF
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.tiff.aux.xml: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.aux: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.AUX: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.tiff.aux: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.tiff.AUX: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.tiff.ovr: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.tiff.OVR: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.tiff.msk: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.tiff.MSK: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.XML: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.xml: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.IMD: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.imd: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.RPB: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.rpb: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.PVL: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.pvl: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_rpc.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_RPC.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_metadata.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_METADATA.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_MTL.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_MTL.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/METADATA.DIM: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/metadata.dim: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_metadata.xml: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho_METADATA.XML: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.RPC: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.rpc: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.pass: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/ortho.PASS: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/summary.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/SUMMARY.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/HDRdisplay.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/HDRdisplay.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/HDRho_display.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/HDRho_display.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/RPCdisplay.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/RPCdisplay.TXT: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/RPCho_display.txt: 403
> Warning 1: HTTP response code on
> https://blah.s3.amazonaws.com/folder/RPCho_display.TXT: 403
> Files: /vsis3/blah/folder/ortho.tiff
>
> ...
>
>
>
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
>
> _______________________________________________ gdal-dev mailing list
> gdal-dev at lists.osgeo.org https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240427/e03bd576/attachment-0001.htm>

From mdsumner at gmail.com  Sun Apr 28 15:52:36 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 29 Apr 2024 08:52:36 +1000
Subject: [gdal-dev] lost python api doc?
Message-ID: <CAAcGz9-ndkko5cu25gE_WLGHcFNRF=x2+jD06dNDqdKH+ML8MQ@mail.gmail.com>

I'm confused about how to browse the python api docs, I used to just web
search "osgeo.gdal Warp", and then scan down the first result page to find
"Warp(" and I had the documentation I needed.

Where is that now? (Why can't I find it, sorry - grepping the sources for
"Warp(" only results in RFC 59 references, so I think this might be a real
problem).

If I'm just navigating the API docs incorrectly I'd appreciate a
walkthrough to find the signature and param descripts for "Warp()". Thanks!

Cheers, Mike


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/98c94f23/attachment.htm>

From even.rouault at spatialys.com  Sun Apr 28 15:59:32 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Apr 2024 00:59:32 +0200
Subject: [gdal-dev] lost python api doc?
In-Reply-To: <CAAcGz9-ndkko5cu25gE_WLGHcFNRF=x2+jD06dNDqdKH+ML8MQ@mail.gmail.com>
References: <CAAcGz9-ndkko5cu25gE_WLGHcFNRF=x2+jD06dNDqdKH+ML8MQ@mail.gmail.com>
Message-ID: <2a96c872-d18c-4e02-9618-42a06f932252@spatialys.com>

Michael,

The Python doc got reorganized one month ago 
(https://github.com/OSGeo/gdal/pull/9575), so perhaps Google hasn't 
updated yet the new references

If you look for gdal.warp on gdal.org directly : 
https://gdal.org/search.html?q=gdal.warp&check_keywords=yes&area=default

that leads to https://gdal.org/api/python/utilities.html#osgeo.gdal.Warp

Even

Le 29/04/2024 ? 00:52, Michael Sumner via gdal-dev a ?crit?:
> I'm confused about how to browse the python api docs, I used to just 
> web search "osgeo.gdal Warp", and then scan down the first result page 
> to find "Warp(" and I had the documentation I needed.
>
> Where is that now? (Why can't I find it, sorry - grepping the sources 
> for "Warp(" only results in RFC 59 references, so I think this might 
> be a real problem).
>
> If I'm just navigating the API docs incorrectly I'd appreciate a 
> walkthrough to find the signature and param descripts for "Warp()". 
> Thanks!
>
> Cheers, Mike
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/72148242/attachment.htm>

From mdsumner at gmail.com  Sun Apr 28 16:03:44 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 29 Apr 2024 09:03:44 +1000
Subject: [gdal-dev] lost python api doc?
In-Reply-To: <2a96c872-d18c-4e02-9618-42a06f932252@spatialys.com>
References: <CAAcGz9-ndkko5cu25gE_WLGHcFNRF=x2+jD06dNDqdKH+ML8MQ@mail.gmail.com>
 <2a96c872-d18c-4e02-9618-42a06f932252@spatialys.com>
Message-ID: <CAAcGz98-JSuU5q9BNjsLme35R7DD3JDscAywQdSGi5RNW=m22A@mail.gmail.com>

Ah awesome, thank you!



On Mon, Apr 29, 2024 at 8:59?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Michael,
>
> The Python doc got reorganized one month ago (
> https://github.com/OSGeo/gdal/pull/9575), so perhaps Google hasn't
> updated yet the new references
>
> If you look for gdal.warp on gdal.org directly :
> https://gdal.org/search.html?q=gdal.warp&check_keywords=yes&area=default
>
> that leads to https://gdal.org/api/python/utilities.html#osgeo.gdal.Warp
>
> Even
> Le 29/04/2024 ? 00:52, Michael Sumner via gdal-dev a ?crit :
>
> I'm confused about how to browse the python api docs, I used to just web
> search "osgeo.gdal Warp", and then scan down the first result page to find
> "Warp(" and I had the documentation I needed.
>
> Where is that now? (Why can't I find it, sorry - grepping the sources for
> "Warp(" only results in RFC 59 references, so I think this might be a real
> problem).
>
> If I'm just navigating the API docs incorrectly I'd appreciate a
> walkthrough to find the signature and param descripts for "Warp()". Thanks!
>
> Cheers, Mike
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/824c66a1/attachment.htm>

From eruiz at aplitop.com  Mon Apr 29 01:17:21 2024
From: eruiz at aplitop.com (Elena Ruiz)
Date: Mon, 29 Apr 2024 08:17:21 +0000
Subject: [gdal-dev] Transparent background in hillshade map
Message-ID: <AS8P192MB219187A6E59F4F0AC997622CBB1B2@AS8P192MB2191.EURP192.PROD.OUTLOOK.COM>

Hello, I am using GDAL version 3.6.2 to make a Hillshade map from an elevation map (tif) using the gdaldem command.
My question is because I need the background of the image generated with the previous command to be transparent,
I have tried different ways but it usually gives me this error:

ERROR 1: Error: band 1 has no color table

These are the commands I have tried:
gdal_translate -b 1 -b 1 -b 1 -b 1 -ot UInt16 --> Generates image with four bands, but all in white
gdal_translate -co PHOTOMETRIC=RGB -co ALPHA=YES--> gives ERROR1
gdal_translate -expand rgba --> gives ERROR1
gdalwarp -dstalpha -->creates an image with a transparent background with two bands, but AUTOCAD does not recognize it well and considers the entire image transparent and not just the background.

Could you give me any solution?
Thanks and regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/5414fd3d/attachment-0001.htm>

From felipe at uma.es  Mon Apr 29 02:15:53 2024
From: felipe at uma.es (Luis Felipe Romero)
Date: Mon, 29 Apr 2024 11:15:53 +0200
Subject: [gdal-dev] Total Viewshed and GDAL
In-Reply-To: <07e4bfb1-0639-3a89-1407-c89f6e5d8d1b@uma.es>
References: <07e4bfb1-0639-3a89-1407-c89f6e5d8d1b@uma.es>
Message-ID: <e17ab807-6e84-4315-a043-ca3d7d8021d2@uma.es>

Hi,

After several months working on other things, I have returned to an application of the total viewshed.

What I have done is use Tamas Szekeres' C++ code as a template and, at least on Windows, I have managed to compile and run. With just a GPU it is quite fast: on a 6000x6000 raster it does the calculations in less than a minute, although it can take two or three hours without a GPU on a PC with 8 
cores. In multiple viewshed mode, the time is reduced proportionally.

On this page I have uploaded more info and some images of a national parks project I am working on. https://github.com/luisfromero/ppnn

It's still a little premature to share it, because I need to do many more tests, compile in Linux, etc., but my main doubt right now is that I need to shape the part of the tool necessary for calculating solar radiation:

In the so-called "mode 3" the visible horizon from each point is calculated, which together with other parameters such as tilt and head allow the calculation of solar radiation in the presence of shadows.

My question is the file format for the horizon data. For now, it's just an array with dimx?dimy?360 byte (using a one degree precision), and I'm considering different formats. For example, save it simply as an output file (compressed, preferably), but it could be compacted into a geopackage (as a 
metadata file or in a database, I don't know). They could even be saved in a multiband raster along with the elevation, tilt and head data from the? DEM. In short, everything necessary to then easily calculate the radiation in a fixed period of time.

Thanks for any suggestions!

Luis F Romero

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 29 02:56:40 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 29 Apr 2024 09:56:40 +0000
Subject: [gdal-dev] Total Viewshed and GDAL
In-Reply-To: <e17ab807-6e84-4315-a043-ca3d7d8021d2@uma.es>
References: <07e4bfb1-0639-3a89-1407-c89f6e5d8d1b@uma.es>
 <e17ab807-6e84-4315-a043-ca3d7d8021d2@uma.es>
Message-ID: <DB9PR09MB68873979CD6F68147B378E8BFD1B2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

Can this tool utilize digital surface model and deal with obstacles like buildings and trees?

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Luis Felipe Romero via gdal-dev
L?hetetty: maanantai 29. huhtikuuta 2024 12.16
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] Total Viewshed and GDAL

Hi,

After several months working on other things, I have returned to an application of the total viewshed.

What I have done is use Tamas Szekeres' C++ code as a template and, at least on Windows, I have managed to compile and run. With just a GPU it is quite fast: on a 6000x6000 raster it does the calculations in less than a minute, although it can take two or three hours without a GPU on a PC with 8 cores. In multiple viewshed mode, the time is reduced proportionally.

On this page I have uploaded more info and some images of a national parks project I am working on. https://github.com/luisfromero/ppnn

It's still a little premature to share it, because I need to do many more tests, compile in Linux, etc., but my main doubt right now is that I need to shape the part of the tool necessary for calculating solar radiation:

In the so-called "mode 3" the visible horizon from each point is calculated, which together with other parameters such as tilt and head allow the calculation of solar radiation in the presence of shadows.

My question is the file format for the horizon data. For now, it's just an array with dimx?dimy?360 byte (using a one degree precision), and I'm considering different formats. For example, save it simply as an output file (compressed, preferably), but it could be compacted into a geopackage (as a metadata file or in a database, I don't know). They could even be saved in a multiband raster along with the elevation, tilt and head data from the  DEM. In short, everything necessary to then easily calculate the radiation in a fixed period of time.

Thanks for any suggestions!

Luis F Romero
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Mon Apr 29 05:26:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Apr 2024 14:26:48 +0200
Subject: [gdal-dev] GDAL 3.9.0beta2 available for testing
Message-ID: <70b44dfb-2f63-43f3-9fa4-bd45f960fde8@spatialys.com>

Hi,

I've prepared a beta2 of GDAL 3.9.0 as there have been a few non-trivial 
changes since beta1

The major ones are:

* pyproject.toml: use numpy>=2.0.0rc1 for python >=3.9 (#9751)
* Docker: update ubuntu-small and ubuntu-full to 24.04
* TileDB: migrate away from deprecated APIs, and bump minimum version to 
2.15

Other bugfixes:

* CMake: add missing dependency to generate_gdal_version_h target when 
building {plugin}_core targets
* CMake: fix generated find_dependency
* Miramon: various fixes
* GDALSuggestedWarpOutput2(): make changes of PR #9336 honour 
SRC_METHOD=NO_GEOTRANSFORM. Fixes failure on rasterio 
tests/test_warpedvrt.py::test_transformer_options__width_height
* Update p-ranav/argparse to latest master; ogrinfo and ogr2ogr: update 
to use store_into(GIntBig&)
* GDALOpen(): avoid double '.' in error messages related to plugin drivers
* Add OSRIsDerivedProjected() / OGRSpatialReference::IsDerivedProjected()
* OGR_CT: use PROJJSON internally rather than in WKT:2019 (#9732)
* GDALArgumentParser: fix dealing with positional arguments that are 
negative numeric values
* GDALVectorInfo(): fix 3.9.0beta1 regression regarding passing layer names
* Internal libtiff: updated to latest upstream
* gdalinfo and ogrinfo -json: add newline character at end of JSON 
output (qgis#57266)
* OGRFeature::SetField(): add warnings when detecting some lossy 
conversions (refs #9792)
* Arrow/Parquet: fix writing empty point Z with 
GEOMETRY_ENCODING=GEOARROW_INTERLEAVED, and test spatial filtering of 
that encoding (qgis#57228)
* OGRLayer::WriteArrowBatch(): add tolerance for field type mismatches 
if int32/int64/real; Also add an option IF_FIELD_NOT_PRESERVED=ERROR to 
error out when lossy conversion occurs. (#9792)
* Parquet: fix ResetReading() implementation, when using the 
ParquetDataset API and when there's a single batch
* Parquet: fix opening single file Parquet datasets with the 
ParquetDataset API when using PARQUET:filename.parquet
* OGRCloneArrowArray(): add missing support for 'tss:' Arrow type

Docker images with 3.9.0beta2 are currently cooking.

Source snapshots at:

- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta2.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta2.tar.xz
- https://download.osgeo.org/gdal/3.9.0/gdal390beta2.zip

Autotest snapshots:

- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta2.tar.gz
- https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta2.zip

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From groechenig at zt-gis.at  Mon Apr 29 05:43:38 2024
From: groechenig at zt-gis.at (=?iso-8859-1?Q?Simon_Gr=F6chenig?=)
Date: Mon, 29 Apr 2024 12:43:38 +0000
Subject: [gdal-dev] Reading DXF block attributes
Message-ID: <DU0P251MB06734139F076E69DC9BF816D8E1B2@DU0P251MB0673.EURP251.PROD.OUTLOOK.COM>

Hi all,

I attempt to copy DXF data to GPKG using the following command:

ogr2ogr --config DXF_MERGE_BLOCK_GEOMETRIES FALSE --config DXF_INLINE_BLOCKS FALSE -f "GPKG" D:/tmp/632_20-2N.gpkg D:/tmp/632_20-2N.dxf --debug ON

My DXF contains some blocks with several block attributes. According to https://gdal.org/drivers/vector/dxf.html, the attributes should be written to the BlockAttributes field if DXF_INLINE_BLOCKS is set to false. However, this field remains empty ("") in my case.

Can you confirm that ogr2ogr can read DXF block attributes? (according to the known issues at Github, writing block attributes is not yet supported)

Any ideas why the field BlockAttributes (also BlockScale, BlockOCSNormal, BlockOCSCoords) is set to "" in the GPKG? BlockName and BlockAngle are set correctly.

Best regards
Simon


_______________________________

Vermessungskanzlei Neumayr

Simon Gr?chenig - Geoinformation



Albin Egger-Str. 10

9900 Lienz

Tel: +43 4852 68568 31

Mobil: +43 664 1544804

Email: groechenig at zt-gis.at<mailto:groechenig at zt-gis.at>

Web: http://www.zt-gis.at/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/9225c7a5/attachment-0001.htm>

From liyenew at gmail.com  Mon Apr 29 05:57:10 2024
From: liyenew at gmail.com (Liyuneh Gebre)
Date: Mon, 29 Apr 2024 15:57:10 +0300
Subject: [gdal-dev] Re-post, user-defined
Message-ID: <CAE4zf46tV7mfiEAYKrMjhDQVdfRPnSpzdcje3a47FE0HvMgY3A@mail.gmail.com>

Dear all,
I am requesting again if you kind have some responds or direction, thank you
I have difficulties in accurately reprojecting a raster file to a
user-defined projection.
I used the following commands in gdal while the output is not similar to
arcpy results.  kindly offer your guidance to achieve the same result.  The
arcpy uses custom transformation and then reprojection.
gdalwarp -t_srs '+proj=laea +a=6378137.0 +f=0.0 +pm=0 +x_0=0.0 +y_0=0.0
+lon_0=20.0 +lat_0=5.0 +units=m +axis=enu +no_defs'  -dstalpha  -wo
SOURCE_EXTRA=1000 -r nearest rain_in.bil rain_projected.bil


*Liyuneh Gebre**, **Associate Researcher*

*Ethiopian Institute of Agricultural Research,EIAR*

*Cell Phone:+251 911858155*

*linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
<https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
*skype:liyenew_1*
*Addis Ababa, Ethioipa*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/7fb81d87/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 29 06:23:47 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Apr 2024 15:23:47 +0200
Subject: [gdal-dev] Re-post, user-defined
In-Reply-To: <CAE4zf46tV7mfiEAYKrMjhDQVdfRPnSpzdcje3a47FE0HvMgY3A@mail.gmail.com>
References: <CAE4zf46tV7mfiEAYKrMjhDQVdfRPnSpzdcje3a47FE0HvMgY3A@mail.gmail.com>
Message-ID: <9694b249-bf48-4e93-8485-c90086c891bb@spatialys.com>

Hi,

it is difficult to help you with just the elements you've provided.

What could be helpful is:

- the output of gdalinfo on the input file

- the output of gdalinfo on the output file generate by ArcPy

- how you define the target projection in ArcPy

- the output of gdalinfo on the output file generate by GDAL

- links to all the above files

- the GDAL version you use


Totally blind guess: try to add "+towgs84=0,0,0 " in your -t_srs PROJ 
string, to ask PROJ to consider that your target CRS datum has the same 
center and axis orientation as WGS84 (and thus go to geographic <--> 
geocentric conversion when changing datums). Otherwise without datum 
shifts, PROJ will consider that longitude,latitude coordinates of the 
geographic CRS underlying the source and target CRS is the same.

Even

Le 29/04/2024 ? 14:57, Liyuneh Gebre via gdal-dev a ?crit?:
> Dear all,
> I am requesting again if you kind have some responds or direction, 
> thank you
> I have difficulties in accurately reprojecting a raster file to a 
> user-defined projection.
> I used the following commands in gdal while the output is not similar 
> to arcpy results.? kindly offer your guidance to achieve the same 
> result.? The arcpy uses custom transformation and then reprojection.
> gdalwarp -t_srs '+proj=laea +a=6378137.0 +f=0.0 +pm=0 +x_0=0.0 
> +y_0=0.0 +lon_0=20.0 +lat_0=5.0 +units=m +axis=enu +no_defs'? 
> -dstalpha -wo SOURCE_EXTRA=1000 -r nearest rain_in.bil rain_projected.bil
>
>
> /*Liyuneh Gebre*//, ////Associate Researcher///
> /Ethiopian Institute of Agricultural Research,EIAR
> /
> /Cell Phone:+251 911858155
> /
> /linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
> /
> //skype:liyenew_1//
> /Addis Ababa, Ethioipa/
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/be5ab434/attachment.htm>

From jan.heckman at gmail.com  Mon Apr 29 07:23:28 2024
From: jan.heckman at gmail.com (Jan Heckman)
Date: Mon, 29 Apr 2024 16:23:28 +0200
Subject: [gdal-dev] Inquire mapped column names for conversion to shapefile
Message-ID: <CAKMUAtAnhSF91dDLNbmXYDEcOwr11txpgs2bTLvRiPLt-5uRVg@mail.gmail.com>

Hi everyone,
I want to make a map of original (let's say postgresql/postgis) column
names to those used in a shapefile after conversion; assuming that at least
some column names in postgis will be over 10 characters in length, and
shortening may produce conflicts. Basically I know how this is done,
appending _<n>, but I hope that there is preferably a python method
available in Qgis python to get the list of column names used in the
shapefile.
Any help or pointers are welcome!
Thanks,
Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/f3a20935/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 29 07:31:00 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Apr 2024 16:31:00 +0200
Subject: [gdal-dev] Inquire mapped column names for conversion to
 shapefile
In-Reply-To: <CAKMUAtAnhSF91dDLNbmXYDEcOwr11txpgs2bTLvRiPLt-5uRVg@mail.gmail.com>
References: <CAKMUAtAnhSF91dDLNbmXYDEcOwr11txpgs2bTLvRiPLt-5uRVg@mail.gmail.com>
Message-ID: <c536832d-1aa4-43e4-8c1f-1f880c4e0b71@spatialys.com>

Hi,

Something like:


from osgeo import ogr
original_field_names = [ "toolongforshapefile1", "toolongforshapefile2"]
map_to_shp = {}
tmpfilename = "/vsimem/temp.shp"
ds = ogr.GetDriverByName("ESRI Shapefile").CreateDataSource(tmpfilename)
lyr = ds.CreateLayer("temp")
lyr_defn = lyr.GetLayerDefn()
for name in original_field_names:
 ??? lyr.CreateField(ogr.FieldDefn(name))
 ??? shp_field_name = lyr_defn.GetFieldDefn(lyr_defn.GetFieldCount() - 
1).GetNameRef()
 ??? map_to_shp[name] = shp_field_name
ds = None
ogr.GetDriverByName("ESRI Shapefile").DeleteDataSource(tmpfilename)
print(map_to_shp)

Even

Le 29/04/2024 ? 16:23, Jan Heckman via gdal-dev a ?crit?:
> Hi everyone,
> I want to make a map of original (let's say postgresql/postgis) column 
> names to those used in a shapefile after conversion; assuming that at 
> least some column names in postgis will be over 10 characters in 
> length, and shortening may produce conflicts. Basically I know how 
> this is done, appending _<n>, but I hope that there is preferably a 
> python method available in Qgis python to get the list of column names 
> used in the shapefile.
> Any help or pointers are welcome!
> Thanks,
> Jan
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jan.heckman at gmail.com  Mon Apr 29 07:46:36 2024
From: jan.heckman at gmail.com (Jan Heckman)
Date: Mon, 29 Apr 2024 16:46:36 +0200
Subject: [gdal-dev] Inquire mapped column names for conversion to
 shapefile
In-Reply-To: <c536832d-1aa4-43e4-8c1f-1f880c4e0b71@spatialys.com>
References: <CAKMUAtAnhSF91dDLNbmXYDEcOwr11txpgs2bTLvRiPLt-5uRVg@mail.gmail.com>
 <c536832d-1aa4-43e4-8c1f-1f880c4e0b71@spatialys.com>
Message-ID: <CAKMUAtC5qOh0TFyp-0DffQd9y0x8KRGPbLPoPrUunCzm0F+5+A@mail.gmail.com>

That's pretty cool, you just saved me an awful lot of time!
Thanks,
Jan

On Mon, Apr 29, 2024 at 4:31?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> Something like:
>
>
> from osgeo import ogr
> original_field_names = [ "toolongforshapefile1", "toolongforshapefile2"]
> map_to_shp = {}
> tmpfilename = "/vsimem/temp.shp"
> ds = ogr.GetDriverByName("ESRI Shapefile").CreateDataSource(tmpfilename)
> lyr = ds.CreateLayer("temp")
> lyr_defn = lyr.GetLayerDefn()
> for name in original_field_names:
>      lyr.CreateField(ogr.FieldDefn(name))
>      shp_field_name = lyr_defn.GetFieldDefn(lyr_defn.GetFieldCount() -
> 1).GetNameRef()
>      map_to_shp[name] = shp_field_name
> ds = None
> ogr.GetDriverByName("ESRI Shapefile").DeleteDataSource(tmpfilename)
> print(map_to_shp)
>
> Even
>
> Le 29/04/2024 ? 16:23, Jan Heckman via gdal-dev a ?crit :
> > Hi everyone,
> > I want to make a map of original (let's say postgresql/postgis) column
> > names to those used in a shapefile after conversion; assuming that at
> > least some column names in postgis will be over 10 characters in
> > length, and shortening may produce conflicts. Basically I know how
> > this is done, appending _<n>, but I hope that there is preferably a
> > python method available in Qgis python to get the list of column names
> > used in the shapefile.
> > Any help or pointers are welcome!
> > Thanks,
> > Jan
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/c152ad4f/attachment-0001.htm>

From j1 at jimenezshaw.com  Mon Apr 29 09:01:12 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 29 Apr 2024 18:01:12 +0200
Subject: [gdal-dev] Reading interpolated values on DSM
In-Reply-To: <a52768f1-8dd2-43e6-97f3-f85d7b14eaf1@spatialys.com>
References: <CADRrdKvRc1eGhqxOhZAEPkeaVu7YKvdGk9J-XR1Y_QmSEHKbYA@mail.gmail.com>
 <8868dcad-66f3-4e13-ae48-6d55b19efeb0@spatialys.com>
 <CAAcGz9-4yOb4ygqS2408Og2PcTvKr+Xfq9SNJvXT-ya80m5KSw@mail.gmail.com>
 <a52768f1-8dd2-43e6-97f3-f85d7b14eaf1@spatialys.com>
Message-ID: <CADRrdKtUR00fRKNKYHhdUL6FEMMnN6vKbpEOiDOF61jDS0R+kQ@mail.gmail.com>

Hi all

Thanks for your answers

Just to get some values, the VRT was enough to get an idea. Thanks Jukka.
The questions was more like "this should be somewhere, and I do not find
it", but apparently "it was not there".
I see that GDALRasterInterpolateAtPoint could be useful (I am surprised it
was was not needed before). I will try to add it at some point.

Best regards,
Javier.

On Wed, 24 Apr 2024 at 15:16, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 24/04/2024 ? 15:00, Michael Sumner a ?crit :
>
> Or a grouping function that returned the cell index for neighbours and
> weighting that are involved in whatever calculation summary is wanted.
>
> That doesn't seem super user friendly, as users would still be left to do
> the raster value extraction and applying the weights, taking into account
> nodata, etc. Not trivial. What is the advantage of this compared to
> returning the interpolated value? The only one I see is to potentially save
> a bit of computation if you need to interpolate values at the same location
> in multiple bands, but the performance gain would probably be marginal (or
> if not, then a variant of the function dealing with multiple bands could be
> offered)
>
>
> Maybe the warper could return this as a starting point rather than doing
> the "task at hand". ?
>
> The warper code has indeed a "FilterFuncType
> GWKGetFilterFunc(GDALResampleAlg eResampleAlg)" method that returns a
> function that returns interpolation weights and int
> GWKGetFilterRadius(GDALResampleAlg eResampleAlg). The code in
> GDALRPCGetDEMHeight() has an interesting logic where it caches a window of
> interest around the first queried pixel so that subsequent queries in the
> neighbouroud can be honoured without going to RasterIO(). This
> substantially improves performance in the RPC case, in particular during
> reverse transformation where you use an iterative method and thus may need
> a lot of DEM extraction to compute a single point.
>
>
>
>
> On Wed, Apr 24, 2024 at 8:51?PM Even Rouault via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi,
>>
>> I guess this discussion, and past similar ones, calls for an enhancement.
>> A new API function, like CPLErr
>> GDALRasterInterpolateAtPoint(GDALRasterBandH, double dfPixel, double
>> dfLocation, GDALRIOResampleAlg eInterpolation, double *pdfValue), that
>> could be used by a new mode of gdallocationinfo. The GDALRPCGetDEMHeight()
>> function in alg/gdal_rpc.cpp is a plausible candidate implementation for
>> bilinear and bicubic (we could potentially restrict to that at the moment).
>>
>> Even
>> Le 24/04/2024 ? 10:33, Javier Jimenez Shaw via gdal-dev a ?crit :
>>
>> Hi
>>
>> I would like to read in QGIS or GDAL an interpolated value in a DSM
>> (well, actually it is a geoid model, but it is the same behaviour). See
>> that I do not want the pixel value, but the linear interpolation among the
>> neighbour pixels, assuming that the pixel value is in the center of the
>> pixel.
>> For instance, this file
>> https://www.isgeoid.polimi.it/Geoid/Asia/Japan/japan2000_g.html
>>
>> Is there any way to get it (without implementing the interpolation
>> myself)?
>> If I understood correctly gdallocationinfo is not interpolating, just
>> giving the pixel value.
>>
>> Thanks
>>
>> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/3ce9e311/attachment.htm>

From mdsumner at gmail.com  Mon Apr 29 12:10:49 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 30 Apr 2024 05:10:49 +1000
Subject: [gdal-dev] HDF5 and geolocation arrays
Message-ID: <CAAcGz9-VkL1qz4hqZPEPGHWBPqKQyyYmDJxxBrsDc1-8Azp8KQ@mail.gmail.com>

This HDF5 (requires earthdata credentials your "Authorization: Bearer
<token>" in GDAL_HTTP_HEADERS, or equiv) presents without geolocation
arrays.

gdalinfo "/vsicurl/
https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"
-sd 26
Driver: HDF5Image/HDF5 Dataset
Files: /vsicurl/
https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
Size is 608, 896
Metadata:
  Conventions=CF-1.6
  HDFEOS_INFORMATION_HDFEOSVersion=HDFEOS_5.1.15
  history=This version of the Sea Ice processing code contains updates
provided by the science team on September 16, 2019. For details on these
updates, see the release notes provided in the DAP.
  institution=NASA's AMSR Science Investigator-led Processing System (SIPS)
  references=Please cite these data as: Markus, T., J. C. Comiso, and W. N.
Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures,
Sea Ice Concentration, Motion & Snow Depth Polar Grids, Version 1.
[Indicate subset used]. Boulder, Colorado USA. NASA National Snow and Ice
Data Center Distributed Active Archive Center. doi:
https://doi.org/10.5067/RA1MIJOYPK3P.
  source=satellite observation
  title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea
Ice Concentration, Motion & Snow Depth Polar Grids
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  896.0)
Upper Right (  608.0,    0.0)
Lower Right (  608.0,  896.0)
Center      (  304.0,  448.0)
Band 1 Block=608x1 Type=Int32, ColorInterp=Undefined
  Metadata:
    comment=data value meaning: 0 -- Open Water, 110 -- missing/not
calculated, 120 -- Land
    coordinates=lon lat
    long_name=Sea ice concentration daily average
    units=percent



gdalinfo --version
GDAL 3.9.0dev-cb4d30f56d, released 2024/04/15

The geolocation arrays are sds 33 and 32 respectively:

HDF5:"/vsicurl/
https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
"://HDFEOS/GRIDS/NpPolarGrid12km/lon

HDF5:"/vsicurl/
https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
"://HDFEOS/GRIDS/NpPolarGrid12km/lat

And things work when lining those up in VRT with warp. Can the HDF5 driver
be made to auto-detect these geolocation arrays?

I see that the NETCDF driver actually does:

gdalinfo "NetCDF:/vsicurl/
https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"
-sd 26

I'm asking as an email rather than pursuing the fix because, these data are
actually a regular grid on the north and south poles, and so geolocation by
arrays is sub-optimal  the specification is listed in

https://nsidc.org/sites/default/files/au_si12-v001-userguide_1.pdf

and the two parameter sets are

Np-north: -te -3850000,  -5350000, 3750000, 5850000 -t_srs EPSG:3411
Sp-south: -te -3950000,  -3950000, 3950000, 4350000 -t_srs EPSG:3412

Is this generally something we should pursue within GDAL? It seems like an
endless task to detect-on-open exactly this situation and assign the easy
fix, but this is a pretty fundamental data stream and it's very common so
the longlat/arrays might be numerically detectable with other
heuristics hinting that it's polar (??) and there are plenty of other
sources that present equivalents in the right way e.g. this one:

"/vsicurl/
https://noaadata.apps.nsidc.org/NOAA/G02135/north/daily/geotiff/2012/07_Jul/N_20120702_concentration_v3.0.tif
"

The right approach is probably to inform the providers and get the right
metadata baked in ... but there's pros and cons to either. I'm not sure
there's even enough information in these files to clearly detect the
situation, it would be a bit like the NSIDCbin driver with its very strict
requirements.

Cheers, Mike


--

Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/321d2cec/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 29 13:08:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Apr 2024 22:08:48 +0200
Subject: [gdal-dev] HDF5 and geolocation arrays
In-Reply-To: <CAAcGz9-VkL1qz4hqZPEPGHWBPqKQyyYmDJxxBrsDc1-8Azp8KQ@mail.gmail.com>
References: <CAAcGz9-VkL1qz4hqZPEPGHWBPqKQyyYmDJxxBrsDc1-8Azp8KQ@mail.gmail.com>
Message-ID: <0701e396-da22-4f01-a502-d208b1d346fe@spatialys.com>

Michael,

actually support for those products was already there at 95% since they 
use the HDF5EOS GRID formalism which we support since 3.7. But that 
particular type of products has an oddity. They have an empty 
GROUP=Dimension within the GROUP=GridStructure in the HDF5EOS metadata, 
which our parser didn't like as we use the information in this group to 
map dimension names to dimension index and size. Fixed/worked around in 
https://github.com/OSGeo/gdal/pull/9807 . Hard to tell if those products 
are in fault given that the HDF5EOS specification at 
https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-008-v1.1.pdf 
, appendix A, is extremely minimum regarding the HDF5EOS metadata itself 
(for once, I complain for a spec to be too minimal !), and the example 
they give for grids doesn't make sense to me (the declared dimension 
names and sizes have nothing to do with the ones use in the grid)

I now get:

$ gdalinfo 
HDF5:"AMSR_U2_L3_SeaIce12km_B04_20120702.he5"://HDFEOS/GRIDS/SpPolarGrid12km/Data_Fields/SI_12km_SH_18H_ASC
Driver: HDF5Image/HDF5 Dataset
Files: AMSR_U2_L3_SeaIce12km_B04_20120702.he5
Size is 632, 664
Coordinate System is:
PROJCRS["unnamed",
 ??? BASEGEOGCRS["Unknown datum based upon the custom spheroid",
 ??????? DATUM["Not specified (based on custom spheroid)",
 ??????????? ELLIPSOID["Custom spheroid",6378273,0,
 ??????????????? LENGTHUNIT["metre",1,
 ??????????????????? ID["EPSG",9001]]]],
 ??????? PRIMEM["Greenwich",0,
 ??????????? ANGLEUNIT["degree",0.0174532925199433,
 ??????????????? ID["EPSG",9122]]]],
 ??? CONVERSION["Polar Stereographic (variant B)",
 ??????? METHOD["Polar Stereographic (variant B)",
 ??????????? ID["EPSG",9829]],
 ??????? PARAMETER["Latitude of standard parallel",-70,
 ??????????? ANGLEUNIT["degree",0.0174532925199433],
 ??????????? ID["EPSG",8832]],
 ??????? PARAMETER["Longitude of origin",0,
 ??????????? ANGLEUNIT["degree",0.0174532925199433],
 ??????????? ID["EPSG",8833]],
 ??????? PARAMETER["False easting",0,
 ??????????? LENGTHUNIT["metre",1],
 ??????????? ID["EPSG",8806]],
 ??????? PARAMETER["False northing",0,
 ??????????? LENGTHUNIT["metre",1],
 ??????????? ID["EPSG",8807]]],
 ??? CS[Cartesian,2],
 ??????? AXIS["(E)",north,
 ??????????? MERIDIAN[90,
 ??????????????? ANGLEUNIT["degree",0.0174532925199433,
 ??????????????????? ID["EPSG",9122]]],
 ??????????? ORDER[1],
 ??????????? LENGTHUNIT["Meter",1]],
 ??????? AXIS["(N)",north,
 ??????????? MERIDIAN[0,
 ??????????????? ANGLEUNIT["degree",0.0174532925199433,
 ??????????????????? ID["EPSG",9122]]],
 ??????????? ORDER[2],
 ??????????? LENGTHUNIT["Meter",1]]]
Data axis to CRS axis mapping: 1,2
Origin = (-3950000.000000000000000,4350000.000000000000000)
Pixel Size = (12500.000000000000000,-12500.000000000000000)
Metadata:
 ? Conventions=CF-1.6
 ? HDFEOS_INFORMATION_HDFEOSVersion=HDFEOS_5.1.15
 ? history=This version of the Sea Ice processing code contains updates 
provided by the science team on September 16, 2019. For details on these 
updates, see the release notes provided in the DAP.
 ? institution=NASA's AMSR Science Investigator-led Processing System (SIPS)
 ? references=Please cite these data as: Markus, T., J. C. Comiso, and 
W. N. Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness 
Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids, 
Version 1. [Indicate subset used]. Boulder, Colorado USA. NASA National 
Snow and Ice Data Center Distributed Active Archive Center. doi: 
https://doi.org/10.5067/RA1MIJOYPK3P.
 ? source=satellite observation
 ? title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, 
Sea Ice Concentration, Motion & Snow Depth Polar Grids
Corner Coordinates:
Upper Left? (-3950000.000, 4350000.000) ( 42d14'27.21"W, 39d11'27.54"S)
Lower Left? (-3950000.000,-3950000.000) (135d 0' 0.00"W, 41d23'59.41"S)
Upper Right ( 3950000.000, 4350000.000) ( 42d14'27.21"E, 39d11'27.54"S)
Lower Right ( 3950000.000,-3950000.000) (135d 0' 0.00"E, 41d23'59.41"S)
Center????? (?????? 0.000,? 200000.000) (? 0d 0' 0.01"E, 88d 8'51.76"S)
Band 1 Block=632x1 Type=Int32, ColorInterp=Undefined
 ? NoData Value=0
 ? Metadata:
 ??? add_offset=0
 ??? coordinates=lon lat
 ??? long_name=18.7 GHz horizontal daily average ascending Tbs
 ??? packing_convention=netCDF
 ??? packing_convention_description=unpacked = scale_factor x packed + 
add_offset
 ??? scale_factor=0.1
 ??? standard_name=brightness_temperature
 ??? units=degree_kelvin
 ??? _FillValue=0

Even

Le 29/04/2024 ? 21:10, Michael Sumner via gdal-dev a ?crit?:
> This HDF5 (requires earthdata credentials your "Authorization: Bearer 
> <token>" in GDAL_HTTP_HEADERS, or equiv) presents without geolocation 
> arrays.
>
> gdalinfo 
> "/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5" 
> -sd 26
> Driver: HDF5Image/HDF5 Dataset
> Files: 
> /vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> Size is 608, 896
> Metadata:
> ? Conventions=CF-1.6
> ? HDFEOS_INFORMATION_HDFEOSVersion=HDFEOS_5.1.15
> ? history=This version of the Sea Ice processing code contains updates 
> provided by the science team on September 16, 2019. For details on 
> these updates, see the release notes provided in the DAP.
> ? institution=NASA's AMSR Science Investigator-led Processing System 
> (SIPS)
> ? references=Please cite these data as: Markus, T., J. C. Comiso, and 
> W. N. Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness 
> Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids, 
> Version 1. [Indicate subset used]. Boulder, Colorado USA. NASA 
> National Snow and Ice Data Center Distributed Active Archive Center. 
> doi: https://doi.org/10.5067/RA1MIJOYPK3P.
> ? source=satellite observation
> ? title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, 
> Sea Ice Concentration, Motion & Snow Depth Polar Grids
> Corner Coordinates:
> Upper Left ?( ? ?0.0, ? ?0.0)
> Lower Left ?( ? ?0.0, ?896.0)
> Upper Right ( ?608.0, ? ?0.0)
> Lower Right ( ?608.0, ?896.0)
> Center ? ? ?( ?304.0, ?448.0)
> Band 1 Block=608x1 Type=Int32, ColorInterp=Undefined
> ? Metadata:
> ? ? comment=data value meaning: 0 -- Open Water, 110 -- missing/not 
> calculated, 120 -- Land
> ? ? coordinates=lon lat
> ? ? long_name=Sea ice concentration daily average
> ? ? units=percent
>
>
>
> gdalinfo --version
> GDAL 3.9.0dev-cb4d30f56d, released 2024/04/15
>
> The geolocation arrays are sds 33 and 32 respectively:
>
> HDF5:"/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"://HDFEOS/GRIDS/NpPolarGrid12km/lon
>
> HDF5:"/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"://HDFEOS/GRIDS/NpPolarGrid12km/lat
>
> And things work when lining those up in VRT with warp. Can the HDF5 
> driver be made to auto-detect these geolocation arrays?
>
> I see that the NETCDF driver actually does:
>
> gdalinfo 
> "NetCDF:/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5" 
> -sd 26
>
> I'm asking as an email rather than pursuing the fix because, these 
> data are actually a regular grid on the north and south poles, and so 
> geolocation by arrays is sub-optimal? the specification is listed in
>
> https://nsidc.org/sites/default/files/au_si12-v001-userguide_1.pdf
>
> and the two parameter sets are
>
> Np-north: -te?-3850000,? -5350000, 3750000, 5850000 -t_srs EPSG:3411
> Sp-south: -te?-3950000,? -3950000, 3950000, 4350000 -t_srs EPSG:3412
>
> Is this generally something we should pursue within GDAL? It seems 
> like an endless task to detect-on-open exactly this situation and 
> assign the easy fix, but this is a pretty fundamental data stream and 
> it's very common so the longlat/arrays might be numerically detectable 
> with other heuristics?hinting that it's polar (??) and there are 
> plenty of other sources that?present equivalents in the right way e.g. 
> this one:
>
> "/vsicurl/https://noaadata.apps.nsidc.org/NOAA/G02135/north/daily/geotiff/2012/07_Jul/N_20120702_concentration_v3.0.tif"
>
> The right approach is probably to inform the providers and get the 
> right metadata baked in ... but there's pros and cons to either. I'm 
> not sure there's even enough information in these files to clearly 
> detect the situation, it would be a bit like the NSIDCbin driver with 
> its very strict requirements.
>
> Cheers, Mike
>
>
> --
>
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/edff31eb/attachment-0001.htm>

From mdsumner at gmail.com  Mon Apr 29 13:42:02 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 30 Apr 2024 06:42:02 +1000
Subject: [gdal-dev] HDF5 and geolocation arrays
In-Reply-To: <0701e396-da22-4f01-a502-d208b1d346fe@spatialys.com>
References: <CAAcGz9-VkL1qz4hqZPEPGHWBPqKQyyYmDJxxBrsDc1-8Azp8KQ@mail.gmail.com>
 <0701e396-da22-4f01-a502-d208b1d346fe@spatialys.com>
Message-ID: <CAAcGz99b5tABgaM9wza85zDC9TJ8L4P1OGWkJ_1gbzbDhqSUDg@mail.gmail.com>

Oh wow, that's fantastic - thanks so much. Lots for me to learn from there
too, with the  HDF5EOS GRID details.

Cheers, Mike

On Tue, Apr 30, 2024 at 6:08?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Michael,
>
> actually support for those products was already there at 95% since they
> use the HDF5EOS GRID formalism which we support since 3.7. But that
> particular type of products has an oddity. They have an empty
> GROUP=Dimension within the GROUP=GridStructure in the HDF5EOS metadata,
> which our parser didn't like as we use the information in this group to map
> dimension names to dimension index and size. Fixed/worked around in
> https://github.com/OSGeo/gdal/pull/9807 . Hard to tell if those products
> are in fault given that the HDF5EOS specification at
> https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-008-v1.1.pdf
> , appendix A, is extremely minimum regarding the HDF5EOS metadata itself
> (for once, I complain for a spec to be too minimal !), and the example they
> give for grids doesn't make sense to me (the declared dimension names and
> sizes have nothing to do with the ones use in the grid)
>
> I now get:
>
> $ gdalinfo
> HDF5:"AMSR_U2_L3_SeaIce12km_B04_20120702.he5"://HDFEOS/GRIDS/SpPolarGrid12km/Data_Fields/SI_12km_SH_18H_ASC
> Driver: HDF5Image/HDF5 Dataset
> Files: AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> Size is 632, 664
> Coordinate System is:
> PROJCRS["unnamed",
>     BASEGEOGCRS["Unknown datum based upon the custom spheroid",
>         DATUM["Not specified (based on custom spheroid)",
>             ELLIPSOID["Custom spheroid",6378273,0,
>                 LENGTHUNIT["metre",1,
>                     ID["EPSG",9001]]]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["degree",0.0174532925199433,
>                 ID["EPSG",9122]]]],
>     CONVERSION["Polar Stereographic (variant B)",
>         METHOD["Polar Stereographic (variant B)",
>             ID["EPSG",9829]],
>         PARAMETER["Latitude of standard parallel",-70,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8832]],
>         PARAMETER["Longitude of origin",0,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8833]],
>         PARAMETER["False easting",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8806]],
>         PARAMETER["False northing",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8807]]],
>     CS[Cartesian,2],
>         AXIS["(E)",north,
>             MERIDIAN[90,
>                 ANGLEUNIT["degree",0.0174532925199433,
>                     ID["EPSG",9122]]],
>             ORDER[1],
>             LENGTHUNIT["Meter",1]],
>         AXIS["(N)",north,
>             MERIDIAN[0,
>                 ANGLEUNIT["degree",0.0174532925199433,
>                     ID["EPSG",9122]]],
>             ORDER[2],
>             LENGTHUNIT["Meter",1]]]
> Data axis to CRS axis mapping: 1,2
> Origin = (-3950000.000000000000000,4350000.000000000000000)
> Pixel Size = (12500.000000000000000,-12500.000000000000000)
> Metadata:
>   Conventions=CF-1.6
>   HDFEOS_INFORMATION_HDFEOSVersion=HDFEOS_5.1.15
>   history=This version of the Sea Ice processing code contains updates
> provided by the science team on September 16, 2019. For details on these
> updates, see the release notes provided in the DAP.
>   institution=NASA's AMSR Science Investigator-led Processing System (SIPS)
>   references=Please cite these data as: Markus, T., J. C. Comiso, and W.
> N. Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness
> Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids,
> Version 1. [Indicate subset used]. Boulder, Colorado USA. NASA National
> Snow and Ice Data Center Distributed Active Archive Center. doi:
> https://doi.org/10.5067/RA1MIJOYPK3P.
>   source=satellite observation
>   title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea
> Ice Concentration, Motion & Snow Depth Polar Grids
> Corner Coordinates:
> Upper Left  (-3950000.000, 4350000.000) ( 42d14'27.21"W, 39d11'27.54"S)
> Lower Left  (-3950000.000,-3950000.000) (135d 0' 0.00"W, 41d23'59.41"S)
> Upper Right ( 3950000.000, 4350000.000) ( 42d14'27.21"E, 39d11'27.54"S)
> Lower Right ( 3950000.000,-3950000.000) (135d 0' 0.00"E, 41d23'59.41"S)
> Center      (       0.000,  200000.000) (  0d 0' 0.01"E, 88d 8'51.76"S)
> Band 1 Block=632x1 Type=Int32, ColorInterp=Undefined
>   NoData Value=0
>   Metadata:
>     add_offset=0
>     coordinates=lon lat
>     long_name=18.7 GHz horizontal daily average ascending Tbs
>     packing_convention=netCDF
>     packing_convention_description=unpacked = scale_factor x packed +
> add_offset
>     scale_factor=0.1
>     standard_name=brightness_temperature
>     units=degree_kelvin
>     _FillValue=0
>
> Even
> Le 29/04/2024 ? 21:10, Michael Sumner via gdal-dev a ?crit :
>
> This HDF5 (requires earthdata credentials your "Authorization: Bearer
> <token>" in GDAL_HTTP_HEADERS, or equiv) presents without geolocation
> arrays.
>
> gdalinfo "/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"
> -sd 26
> Driver: HDF5Image/HDF5 Dataset
> Files: /vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> Size is 608, 896
> Metadata:
>   Conventions=CF-1.6
>   HDFEOS_INFORMATION_HDFEOSVersion=HDFEOS_5.1.15
>   history=This version of the Sea Ice processing code contains updates
> provided by the science team on September 16, 2019. For details on these
> updates, see the release notes provided in the DAP.
>   institution=NASA's AMSR Science Investigator-led Processing System (SIPS)
>   references=Please cite these data as: Markus, T., J. C. Comiso, and W.
> N. Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness
> Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids,
> Version 1. [Indicate subset used]. Boulder, Colorado USA. NASA National
> Snow and Ice Data Center Distributed Active Archive Center. doi:
> https://doi.org/10.5067/RA1MIJOYPK3P.
>   source=satellite observation
>   title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea
> Ice Concentration, Motion & Snow Depth Polar Grids
> Corner Coordinates:
> Upper Left  (    0.0,    0.0)
> Lower Left  (    0.0,  896.0)
> Upper Right (  608.0,    0.0)
> Lower Right (  608.0,  896.0)
> Center      (  304.0,  448.0)
> Band 1 Block=608x1 Type=Int32, ColorInterp=Undefined
>   Metadata:
>     comment=data value meaning: 0 -- Open Water, 110 -- missing/not
> calculated, 120 -- Land
>     coordinates=lon lat
>     long_name=Sea ice concentration daily average
>     units=percent
>
>
>
> gdalinfo --version
> GDAL 3.9.0dev-cb4d30f56d, released 2024/04/15
>
> The geolocation arrays are sds 33 and 32 respectively:
>
> HDF5:"/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> "://HDFEOS/GRIDS/NpPolarGrid12km/lon
>
> HDF5:"/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> "://HDFEOS/GRIDS/NpPolarGrid12km/lat
>
> And things work when lining those up in VRT with warp. Can the HDF5 driver
> be made to auto-detect these geolocation arrays?
>
> I see that the NETCDF driver actually does:
>
> gdalinfo "NetCDF:/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"
> -sd 26
>
> I'm asking as an email rather than pursuing the fix because, these data
> are actually a regular grid on the north and south poles, and so
> geolocation by arrays is sub-optimal  the specification is listed in
>
> https://nsidc.org/sites/default/files/au_si12-v001-userguide_1.pdf
>
> and the two parameter sets are
>
> Np-north: -te -3850000,  -5350000, 3750000, 5850000 -t_srs EPSG:3411
> Sp-south: -te -3950000,  -3950000, 3950000, 4350000 -t_srs EPSG:3412
>
> Is this generally something we should pursue within GDAL? It seems like an
> endless task to detect-on-open exactly this situation and assign the easy
> fix, but this is a pretty fundamental data stream and it's very common so
> the longlat/arrays might be numerically detectable with other
> heuristics hinting that it's polar (??) and there are plenty of other
> sources that present equivalents in the right way e.g. this one:
>
> "/vsicurl/
> https://noaadata.apps.nsidc.org/NOAA/G02135/north/daily/geotiff/2012/07_Jul/N_20120702_concentration_v3.0.tif
> "
>
> The right approach is probably to inform the providers and get the right
> metadata baked in ... but there's pros and cons to either. I'm not sure
> there's even enough information in these files to clearly detect the
> situation, it would be a bit like the NSIDCbin driver with its very strict
> requirements.
>
> Cheers, Mike
>
>
> --
>
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/c347716d/attachment.htm>

From mdsumner at gmail.com  Mon Apr 29 14:00:10 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 30 Apr 2024 07:00:10 +1000
Subject: [gdal-dev] gdal2tiles for floating point images
In-Reply-To: <CAPryQ-MO6RqJ1iSSP8w-vCaEkUWVT-a1ZBVb9Egu3T95LEvQDg@mail.gmail.com>
References: <CAPryQ-MO6RqJ1iSSP8w-vCaEkUWVT-a1ZBVb9Egu3T95LEvQDg@mail.gmail.com>
Message-ID: <CAAcGz9_KtdFwRYYsZYFYUfrifUEMv0i2roJtmswf=KAS5Wpq-A@mail.gmail.com>

On Fri, Apr 26, 2024 at 5:37?AM lefsky--- via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> I'd like to have a version of gdal2tiles that handles image types other
> than uint8. Is there a reason why it doesn't handle those types of images?
> It appears I'd have to modify the output format from png to tiff.  I have
> never modified gdal source before and I'm wondering if this modification
> (which appears straightforward to a naive user) hasn't been done before.
>


Hello, it appears to be sufficient to add GTiff to tiledriver options,
handle the file extension, and add an option to override the error/message
that advises conversion to Byte:

https://github.com/OSGeo/gdal/compare/master...dis-organization:gdal:gdal2tiles-nonbyte

I wanted this myself as I'm working on a version of the tiling in an R
package, and I'm not confident enough about it without being able to
compare to gdal2tiles.py.

It will need care to prepare it and merge into GDAL itself, with some
thought about documentation, implications for html output (it's compleltely
incompatible with the html produced I expect), and tests, but if you want
to use it locally it seems ok and I'm happy to follow up off-list.

Note that you can use VRT to reference such a tiled output for numeric
data, I used it for a tiled global elevation source here (so if we fold
this into GDAL that could be a nice option to include, VRT for reading as
TMS):

https://github.com/hypertidy/sds/blob/main/R/sources.R#L41

Cheers, Mike




>
> Michael
>
>
> --
> Michael Lefsky (He/His)
> Home Location: HVHF+GH
> Cell: 970-980-9036
> http://www.researcherid.com/rid/A-7224-2009
>
> *?for being prematurely, and worse, intuitively right ? there?s a heavy
> price. But for being wrong ? no, not so long as you?re wrong in a pack."
> Gary Brecher / Portis*
>
> *I acknowledge that I live and work on stolen land. This is the land of
> the Cheyenne, Arapaho, Ute, and Ocheithi Sakowin people. To learn more
> about these nations, please visit;
> http://www.utemountainutetribe.com/
> http://www.cheyennenation.com/
> https://cheyenneandarapaho-nsn.gov/
> https://native-land.ca/
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/738758fc/attachment-0001.htm>

From andrew.bell.ia at gmail.com  Mon Apr 29 14:27:27 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Mon, 29 Apr 2024 17:27:27 -0400
Subject: [gdal-dev] Test problem After Merge
Message-ID: <CACJ51z3jigezS0dmv5tNj3MA==8Lp8AQbiTo4stoSQRbVQv3FA@mail.gmail.com>

Hi,

I just merged master into my branch and I'm now getting an error when
trying to run a test. If someone might know what happened, I'd appreciate a
tip.

(gdal) [master] $ pytest -v autotest/utilities/test_gdal_viewshed.py
ImportError while loading conftest
'/Users/abell/gdal.2/build/autotest/conftest.py'.
autotest/conftest.py:9: in <module>
    from osgeo import gdal, ogr, osr
swig/python/osgeo/gdal.py:3942: in <module>
    from . import ogr
swig/python/osgeo/ogr.py:608: in <module>
    from . import osr
swig/python/osgeo/osr.py:13: in <module>
    from . import _osr
E   ImportError: dlopen(/Users/abell/gdal.2/build/swig/python/osgeo/_
osr.cpython-312-darwin.so, 0x0002): symbol not found in flat namespace
'_OSRIsDerivedProjected'

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/c6c6e3b4/attachment.htm>

From jluis at ualg.pt  Mon Apr 29 14:37:45 2024
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Mon, 29 Apr 2024 21:37:45 +0000
Subject: [gdal-dev] HDF5 and geolocation arrays
In-Reply-To: <CAAcGz9-VkL1qz4hqZPEPGHWBPqKQyyYmDJxxBrsDc1-8Azp8KQ@mail.gmail.com>
References: <CAAcGz9-VkL1qz4hqZPEPGHWBPqKQyyYmDJxxBrsDc1-8Azp8KQ@mail.gmail.com>
Message-ID: <GVXPR04MB9926046300ADA009D2B2B560A61B2@GVXPR04MB9926.eurprd04.prod.outlook.com>

> This HDF5 (requires earthdata credentials your "Authorization: Bearer <token>" in GDAL_HTTP_HEADERS, or equiv) presents without geolocation arrays.

gdalinfo "/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5" -sd 26


Excuse for this little derail, but how do we do that? I mean, the credentials. I tried with both:

gdalinfo --config GDAL_HTTP_HEADERS=login:passw "/vsicurl/https://n5eil01u.ecs.nsidc.org/?

and

gdalinfo  "/vsicurl/https://login:passwd at n5eil01u.ecs.nsidc.org?

but both errored with

ERROR 3: Cannot read 4029 bytes
gdalinfo failed - unable to open '/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5'.

and

ERROR 3: Cannot read 4029 bytes
gdalinfo failed - unable to open '/vsicurl/https://login:passwd at n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5'.


Thanks

Joaquim

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Michael Sumner via gdal-dev
Sent: Monday, April 29, 2024 8:11 PM
To: gdal-dev <gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] HDF5 and geolocation arrays

This HDF5 (requires earthdata credentials your "Authorization: Bearer <token>" in GDAL_HTTP_HEADERS, or equiv) presents without geolocation arrays.

gdalinfo "/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5" -sd 26
Driver: HDF5Image/HDF5 Dataset
Files: /vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
Size is 608, 896
Metadata:
  Conventions=CF-1.6
  HDFEOS_INFORMATION_HDFEOSVersion=HDFEOS_5.1.15
  history=This version of the Sea Ice processing code contains updates provided by the science team on September 16, 2019. For details on these updates, see the release notes provided in the DAP.
  institution=NASA's AMSR Science Investigator-led Processing System (SIPS)
  references=Please cite these data as: Markus, T., J. C. Comiso, and W. N. Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids, Version 1. [Indicate subset used]. Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center. doi: https://doi.org/10.5067/RA1MIJOYPK3P.
  source=satellite observation
  title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  896.0)
Upper Right (  608.0,    0.0)
Lower Right (  608.0,  896.0)
Center      (  304.0,  448.0)
Band 1 Block=608x1 Type=Int32, ColorInterp=Undefined
  Metadata:
    comment=data value meaning: 0 -- Open Water, 110 -- missing/not calculated, 120 -- Land
    coordinates=lon lat
    long_name=Sea ice concentration daily average
    units=percent



gdalinfo --version
GDAL 3.9.0dev-cb4d30f56d, released 2024/04/15

The geolocation arrays are sds 33 and 32 respectively:

HDF5:"/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"://HDFEOS/GRIDS/NpPolarGrid12km/lon

HDF5:"/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"://HDFEOS/GRIDS/NpPolarGrid12km/lat

And things work when lining those up in VRT with warp. Can the HDF5 driver be made to auto-detect these geolocation arrays?

I see that the NETCDF driver actually does:

gdalinfo "NetCDF:/vsicurl/https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5" -sd 26

I'm asking as an email rather than pursuing the fix because, these data are actually a regular grid on the north and south poles, and so geolocation by arrays is sub-optimal  the specification is listed in

https://nsidc.org/sites/default/files/au_si12-v001-userguide_1.pdf

and the two parameter sets are

Np-north: -te -3850000,  -5350000, 3750000, 5850000 -t_srs EPSG:3411
Sp-south: -te -3950000,  -3950000, 3950000, 4350000 -t_srs EPSG:3412

Is this generally something we should pursue within GDAL? It seems like an endless task to detect-on-open exactly this situation and assign the easy fix, but this is a pretty fundamental data stream and it's very common so the longlat/arrays might be numerically detectable with other heuristics hinting that it's polar (??) and there are plenty of other sources that present equivalents in the right way e.g. this one:

"/vsicurl/https://noaadata.apps.nsidc.org/NOAA/G02135/north/daily/geotiff/2012/07_Jul/N_20120702_concentration_v3.0.tif"

The right approach is probably to inform the providers and get the right metadata baked in ... but there's pros and cons to either. I'm not sure there's even enough information in these files to clearly detect the situation, it would be a bit like the NSIDCbin driver with its very strict requirements.

Cheers, Mike


--

Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com<mailto:mdsumner at gmail.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/932176f4/attachment-0001.htm>

From even.rouault at spatialys.com  Mon Apr 29 14:37:56 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Apr 2024 23:37:56 +0200
Subject: [gdal-dev] Test problem After Merge
In-Reply-To: <CACJ51z3jigezS0dmv5tNj3MA==8Lp8AQbiTo4stoSQRbVQv3FA@mail.gmail.com>
References: <CACJ51z3jigezS0dmv5tNj3MA==8Lp8AQbiTo4stoSQRbVQv3FA@mail.gmail.com>
Message-ID: <a0829b34-ce67-48b3-8dc8-32faf7eb244d@spatialys.com>

Andrew,

Perhaps you're running updated GDAL Python bindings against a libgdal 
that hasn't been rebuilt recently? OSRIsDerivedProjected() has been 
added recently both in libgdal and the bindings

Even

Le 29/04/2024 ? 23:27, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> I just merged master into my branch and I'm now getting an error when 
> trying to run a test. If someone might know what happened, I'd 
> appreciate a tip.
>
> (gdal) [master] $ pytest -v autotest/utilities/test_gdal_viewshed.py
> ImportError while loading conftest 
> '/Users/abell/gdal.2/build/autotest/conftest.py'.
> autotest/conftest.py:9: in <module>
> ? ? from osgeo import gdal, ogr, osr
> swig/python/osgeo/gdal.py:3942: in <module>
> ? ? from . import ogr
> swig/python/osgeo/ogr.py:608: in <module>
> ? ? from . import osr
> swig/python/osgeo/osr.py:13: in <module>
> ? ? from . import _osr
> E ? ImportError: 
> dlopen(/Users/abell/gdal.2/build/swig/python/osgeo/_osr.cpython-312-darwin.so 
> <http://osr.cpython-312-darwin.so>, 0x0002): symbol not found in flat 
> namespace '_OSRIsDerivedProjected'
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240429/8a241bc0/attachment.htm>

From liyenew at gmail.com  Mon Apr 29 15:00:17 2024
From: liyenew at gmail.com (Liyuneh Gebre)
Date: Tue, 30 Apr 2024 01:00:17 +0300
Subject: [gdal-dev] Re-post, user-defined
In-Reply-To: <9694b249-bf48-4e93-8485-c90086c891bb@spatialys.com>
References: <CAE4zf46tV7mfiEAYKrMjhDQVdfRPnSpzdcje3a47FE0HvMgY3A@mail.gmail.com>
 <9694b249-bf48-4e93-8485-c90086c891bb@spatialys.com>
Message-ID: <CAE4zf47u06CxE4Qp5=B=WdAag1jYTvyyX0m0vf-9q894GtHTng@mail.gmail.com>

Hi Even,
thank you for your response,
gdal version is: GDAL 3.6.4, released 2023/04/17
I got the defined target projection included in the link. yes, it's
geocentric and for further exploration the custom project transformation
file .gtf extension is also included.
https://u.pcloud.link/publink/show?code=kZj5wh0ZtFWXtI9UGjQiD6KXxn5A9hiWDpEX

On Mon, Apr 29, 2024 at 4:23?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> it is difficult to help you with just the elements you've provided.
>
> What could be helpful is:
>
> - the output of gdalinfo on the input file
>
> - the output of gdalinfo on the output file generate by ArcPy
>
> - how you define the target projection in ArcPy
>
> - the output of gdalinfo on the output file generate by GDAL
>
> - links to all the above files
>
> - the GDAL version you use
>
>
> Totally blind guess: try to add "+towgs84=0,0,0 " in your -t_srs PROJ
> string, to ask PROJ to consider that your target CRS datum has the same
> center and axis orientation as WGS84 (and thus go to geographic <-->
> geocentric conversion when changing datums). Otherwise without datum
> shifts, PROJ will consider that longitude,latitude coordinates of the
> geographic CRS underlying the source and target CRS is the same.
>
> Even
> Le 29/04/2024 ? 14:57, Liyuneh Gebre via gdal-dev a ?crit :
>
> Dear all,
> I am requesting again if you kind have some responds or direction, thank
> you
> I have difficulties in accurately reprojecting a raster file to a
> user-defined projection.
> I used the following commands in gdal while the output is not similar to
> arcpy results.  kindly offer your guidance to achieve the same result.  The
> arcpy uses custom transformation and then reprojection.
> gdalwarp -t_srs '+proj=laea +a=6378137.0 +f=0.0 +pm=0 +x_0=0.0 +y_0=0.0
> +lon_0=20.0 +lat_0=5.0 +units=m +axis=enu +no_defs'  -dstalpha  -wo
> SOURCE_EXTRA=1000 -r nearest rain_in.bil rain_projected.bil
>
>
> *Liyuneh Gebre**, **Associate Researcher*
>
> *Ethiopian Institute of Agricultural Research,EIAR *
>
> *Cell Phone:+251 911858155 *
>
> *linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
> <https://www.linkedin.com/in/liyuneh-gebre-b842b440/> *
> *skype:liyenew_1*
> *Addis Ababa, Ethioipa*
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
*Liyuneh Gebre**, **Associate Researcher*

*Ethiopian Institute of Agricultural Research,EIAR*

*Cell Phone:+251 911858155*

*linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
<https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
*skype:liyenew_1*
*Addis Ababa, Ethioipa*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/a6407fd7/attachment.htm>

From even.rouault at spatialys.com  Mon Apr 29 15:11:44 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 Apr 2024 00:11:44 +0200
Subject: [gdal-dev] Re-post, user-defined
In-Reply-To: <CAE4zf47u06CxE4Qp5=B=WdAag1jYTvyyX0m0vf-9q894GtHTng@mail.gmail.com>
References: <CAE4zf46tV7mfiEAYKrMjhDQVdfRPnSpzdcje3a47FE0HvMgY3A@mail.gmail.com>
 <9694b249-bf48-4e93-8485-c90086c891bb@spatialys.com>
 <CAE4zf47u06CxE4Qp5=B=WdAag1jYTvyyX0m0vf-9q894GtHTng@mail.gmail.com>
Message-ID: <763f43b4-ce79-4410-9d46-49addd1b0b01@spatialys.com>

At first sight, I'd say that the ArcPy output is incorrect. The SRS 
definition of its output doesn't match what you want since it has

PARAMETER["Latitude of natural origin",20,
ANGLEUNIT["degree",0.0174532925199433],
ID["EPSG",8801]],
PARAMETER["Longitude of natural origin",6378137,
ANGLEUNIT["degree",0.0174532925199433],
ID["EPSG",8802]],
PARAMETER["False easting",5,
LENGTHUNIT["metre",1],
ID["EPSG",8806]],

The "Longitude of natural origin" is completely wrong, and should be 5 
given the PROJ.4 string you mentionned

And the the "False easting" should be 0.

The output of GDAL looks plausible.


Le 30/04/2024 ? 00:00, Liyuneh Gebre a ?crit?:
> Hi Even,
> thank you for your response,
> gdal version is: GDAL 3.6.4, released 2023/04/17
> I got the defined target projection included in the link. yes, it's 
> geocentric and for further exploration the custom project 
> transformation file .gtf extension is also included.
> https://u.pcloud.link/publink/show?code=kZj5wh0ZtFWXtI9UGjQiD6KXxn5A9hiWDpEX
>
> On Mon, Apr 29, 2024 at 4:23?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Hi,
>
>     it is difficult to help you with just the elements you've provided.
>
>     What could be helpful is:
>
>     - the output of gdalinfo on the input file
>
>     - the output of gdalinfo on the output file generate by ArcPy
>
>     - how you define the target projection in ArcPy
>
>     - the output of gdalinfo on the output file generate by GDAL
>
>     - links to all the above files
>
>     - the GDAL version you use
>
>
>     Totally blind guess: try to add "+towgs84=0,0,0 " in your -t_srs
>     PROJ string, to ask PROJ to consider that your target CRS datum
>     has the same center and axis orientation as WGS84 (and thus go to
>     geographic <--> geocentric conversion when changing datums).
>     Otherwise without datum shifts, PROJ will consider that
>     longitude,latitude coordinates of the geographic CRS underlying
>     the source and target CRS is the same.
>
>     Even
>
>     Le 29/04/2024 ? 14:57, Liyuneh Gebre via gdal-dev a ?crit?:
>>     Dear all,
>>     I am requesting again if you kind have some responds or
>>     direction, thank you
>>     I have difficulties in accurately reprojecting a raster file to a
>>     user-defined projection.
>>     I used the following commands in gdal while the output is not
>>     similar to arcpy results.? kindly offer your guidance to achieve
>>     the same result.? The arcpy uses custom transformation and then
>>     reprojection.
>>     gdalwarp -t_srs '+proj=laea +a=6378137.0 +f=0.0 +pm=0 +x_0=0.0
>>     +y_0=0.0 +lon_0=20.0 +lat_0=5.0 +units=m +axis=enu +no_defs'?
>>     -dstalpha -wo SOURCE_EXTRA=1000 -r nearest rain_in.bil
>>     rain_projected.bil
>>
>>
>>     /*Liyuneh Gebre*//, ////Associate Researcher///
>>     /Ethiopian Institute of Agricultural Research,EIAR
>>     /
>>     /Cell Phone:+251 911858155
>>     /
>>     /linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
>>     /
>>     //skype:liyenew_1//
>>     /Addis Ababa, Ethioipa/
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
>
> -- 
> /*Liyuneh Gebre*//, ////Associate Researcher///
> /Ethiopian Institute of Agricultural Research,EIAR
> /
> /Cell Phone:+251 911858155
> /
> /linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
> /
> //skype:liyenew_1//
> /Addis Ababa, Ethioipa/

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/022e06ac/attachment-0001.htm>

From liyenew at gmail.com  Mon Apr 29 16:55:50 2024
From: liyenew at gmail.com (Liyuneh Gebre)
Date: Tue, 30 Apr 2024 02:55:50 +0300
Subject: [gdal-dev] Re-post, user-defined
In-Reply-To: <763f43b4-ce79-4410-9d46-49addd1b0b01@spatialys.com>
References: <CAE4zf46tV7mfiEAYKrMjhDQVdfRPnSpzdcje3a47FE0HvMgY3A@mail.gmail.com>
 <9694b249-bf48-4e93-8485-c90086c891bb@spatialys.com>
 <CAE4zf47u06CxE4Qp5=B=WdAag1jYTvyyX0m0vf-9q894GtHTng@mail.gmail.com>
 <763f43b4-ce79-4410-9d46-49addd1b0b01@spatialys.com>
Message-ID: <CAE4zf465xasEy4aS0n7U8ads=yVrpq180sHhgLropKX+YVvKwA@mail.gmail.com>

Well the arcpy made transformation before re-projection. Appended the
sample script in the shared folder as txt. Anyway how can I achieve this
ArcPy output re-projection from gdal with the given gdalinfo on the input
file  and by editing the PROJ.4 string (target projection )?
PARAMETER["Latitude of natural origin",20,
ANGLEUNIT["degree",0.0174532925199433],
ID["EPSG",8801]],
PARAMETER["Longitude of natural origin",6378137,
ANGLEUNIT["degree",0.0174532925199433],
ID["EPSG",8802]],
PARAMETER["False easting",5,
LENGTHUNIT["metre",1],
ID["EPSG",8806]],

On Tue, Apr 30, 2024 at 1:11?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> At first sight, I'd say that the ArcPy output is incorrect. The SRS
> definition of its output doesn't match what you want since it has
>
> PARAMETER["Latitude of natural origin",20,
> ANGLEUNIT["degree",0.0174532925199433],
> ID["EPSG",8801]],
> PARAMETER["Longitude of natural origin",6378137,
> ANGLEUNIT["degree",0.0174532925199433],
> ID["EPSG",8802]],
> PARAMETER["False easting",5,
> LENGTHUNIT["metre",1],
> ID["EPSG",8806]],
>
> The "Longitude of natural origin" is completely wrong, and should be 5
> given the PROJ.4 string you mentionned
>
> And the the "False easting" should be 0.
>
> The output of GDAL looks plausible.
>
>
> Le 30/04/2024 ? 00:00, Liyuneh Gebre a ?crit :
>
> Hi Even,
> thank you for your response,
> gdal version is: GDAL 3.6.4, released 2023/04/17
> I got the defined target projection included in the link. yes, it's
> geocentric and for further exploration the custom project transformation
> file .gtf extension is also included.
>
> https://u.pcloud.link/publink/show?code=kZj5wh0ZtFWXtI9UGjQiD6KXxn5A9hiWDpEX
>
> On Mon, Apr 29, 2024 at 4:23?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Hi,
>>
>> it is difficult to help you with just the elements you've provided.
>>
>> What could be helpful is:
>>
>> - the output of gdalinfo on the input file
>>
>> - the output of gdalinfo on the output file generate by ArcPy
>>
>> - how you define the target projection in ArcPy
>>
>> - the output of gdalinfo on the output file generate by GDAL
>>
>> - links to all the above files
>>
>> - the GDAL version you use
>>
>>
>> Totally blind guess: try to add "+towgs84=0,0,0 " in your -t_srs PROJ
>> string, to ask PROJ to consider that your target CRS datum has the same
>> center and axis orientation as WGS84 (and thus go to geographic <-->
>> geocentric conversion when changing datums). Otherwise without datum
>> shifts, PROJ will consider that longitude,latitude coordinates of the
>> geographic CRS underlying the source and target CRS is the same.
>>
>> Even
>> Le 29/04/2024 ? 14:57, Liyuneh Gebre via gdal-dev a ?crit :
>>
>> Dear all,
>> I am requesting again if you kind have some responds or direction, thank
>> you
>> I have difficulties in accurately reprojecting a raster file to a
>> user-defined projection.
>> I used the following commands in gdal while the output is not similar to
>> arcpy results.  kindly offer your guidance to achieve the same result.  The
>> arcpy uses custom transformation and then reprojection.
>> gdalwarp -t_srs '+proj=laea +a=6378137.0 +f=0.0 +pm=0 +x_0=0.0 +y_0=0.0
>> +lon_0=20.0 +lat_0=5.0 +units=m +axis=enu +no_defs'  -dstalpha  -wo
>> SOURCE_EXTRA=1000 -r nearest rain_in.bil rain_projected.bil
>>
>>
>> *Liyuneh Gebre**, **Associate Researcher*
>>
>> *Ethiopian Institute of Agricultural Research,EIAR *
>>
>> *Cell Phone:+251 911858155 *
>>
>> *linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
>> <https://www.linkedin.com/in/liyuneh-gebre-b842b440/> *
>> *skype:liyenew_1*
>> *Addis Ababa, Ethioipa*
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> *Liyuneh Gebre**, **Associate Researcher*
>
> *Ethiopian Institute of Agricultural Research,EIAR *
>
> *Cell Phone:+251 911858155 *
>
> *linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
> <https://www.linkedin.com/in/liyuneh-gebre-b842b440/> *
> *skype:liyenew_1*
> *Addis Ababa, Ethioipa*
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
*Liyuneh Gebre**, **Associate Researcher*

*Ethiopian Institute of Agricultural Research,EIAR*

*Cell Phone:+251 911858155*

*linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
<https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
*skype:liyenew_1*
*Addis Ababa, Ethioipa*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/ec6aeba7/attachment.htm>

From mdsumner at gmail.com  Mon Apr 29 17:53:29 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 30 Apr 2024 10:53:29 +1000
Subject: [gdal-dev] HDF5 and geolocation arrays
In-Reply-To: <GVXPR04MB9926046300ADA009D2B2B560A61B2@GVXPR04MB9926.eurprd04.prod.outlook.com>
References: <CAAcGz9-VkL1qz4hqZPEPGHWBPqKQyyYmDJxxBrsDc1-8Azp8KQ@mail.gmail.com>
 <GVXPR04MB9926046300ADA009D2B2B560A61B2@GVXPR04MB9926.eurprd04.prod.outlook.com>
Message-ID: <CAAcGz9-uFK3-Y8vvk7e3vFsQh+Deeb0-NPfzyJT4HV4p6UqSzw@mail.gmail.com>

you need

gdalinfo --config GDAL_HTTP_HEADERS="Authorization: Bearer <long token>"
 "/vsicurl/https://n5eil01u.ecs.nsidc.org/?

Where "<long token>" is an Earthdata access token from your account.

https://urs.earthdata.nasa.gov/documentation/for_users/user_token

HTH   (there are other methods like setting GDAL_HTTP_HEADER_FILE to an
actual file with that "Authorization: Bearer ..." content.



On Tue, Apr 30, 2024 at 7:37?AM Joaquim Manuel Freire Lu?s <jluis at ualg.pt>
wrote:

> > This HDF5 (requires earthdata credentials your "Authorization: Bearer
> <token>" in GDAL_HTTP_HEADERS, or equiv) presents without geolocation
> arrays.
>
>
>
> gdalinfo "/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"
> -sd 26
>
>
>
> Excuse for this little derail, but how do we do that? I mean, the
> credentials. I tried with both:
>
>
>
> gdalinfo --config GDAL_HTTP_HEADERS=login:passw "/vsicurl/
> https://n5eil01u.ecs.nsidc.org/?
>
>
>
> and
>
>
>
> gdalinfo  "/vsicurl/https://login:passwd at n5eil01u.ecs.nsidc.org?
>
>
>
> but both errored with
>
>
>
> ERROR 3: Cannot read 4029 bytes
>
> gdalinfo failed - unable to open '/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> '.
>
>
>
> and
>
>
>
> ERROR 3: Cannot read 4029 bytes
>
> gdalinfo failed - unable to open '/vsicurl/
> https://login:passwd at n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> '.
>
>
>
>
>
> Thanks
>
>
>
> Joaquim
>
>
>
> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Michael
> Sumner via gdal-dev
> *Sent:* Monday, April 29, 2024 8:11 PM
> *To:* gdal-dev <gdal-dev at lists.osgeo.org>
> *Subject:* [gdal-dev] HDF5 and geolocation arrays
>
>
>
> This HDF5 (requires earthdata credentials your "Authorization: Bearer
> <token>" in GDAL_HTTP_HEADERS, or equiv) presents without geolocation
> arrays.
>
>
>
> gdalinfo "/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"
> -sd 26
> Driver: HDF5Image/HDF5 Dataset
> Files: /vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> Size is 608, 896
> Metadata:
>   Conventions=CF-1.6
>   HDFEOS_INFORMATION_HDFEOSVersion=HDFEOS_5.1.15
>   history=This version of the Sea Ice processing code contains updates
> provided by the science team on September 16, 2019. For details on these
> updates, see the release notes provided in the DAP.
>   institution=NASA's AMSR Science Investigator-led Processing System (SIPS)
>   references=Please cite these data as: Markus, T., J. C. Comiso, and W.
> N. Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness
> Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids,
> Version 1. [Indicate subset used]. Boulder, Colorado USA. NASA National
> Snow and Ice Data Center Distributed Active Archive Center. doi:
> https://doi.org/10.5067/RA1MIJOYPK3P.
>   source=satellite observation
>   title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea
> Ice Concentration, Motion & Snow Depth Polar Grids
> Corner Coordinates:
> Upper Left  (    0.0,    0.0)
> Lower Left  (    0.0,  896.0)
> Upper Right (  608.0,    0.0)
> Lower Right (  608.0,  896.0)
> Center      (  304.0,  448.0)
> Band 1 Block=608x1 Type=Int32, ColorInterp=Undefined
>   Metadata:
>     comment=data value meaning: 0 -- Open Water, 110 -- missing/not
> calculated, 120 -- Land
>     coordinates=lon lat
>     long_name=Sea ice concentration daily average
>     units=percent
>
>
>
>
>
>
>
> gdalinfo --version
> GDAL 3.9.0dev-cb4d30f56d, released 2024/04/15
>
>
>
> The geolocation arrays are sds 33 and 32 respectively:
>
>
>
> HDF5:"/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> "://HDFEOS/GRIDS/NpPolarGrid12km/lon
>
>
>
> HDF5:"/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5
> "://HDFEOS/GRIDS/NpPolarGrid12km/lat
>
>
>
> And things work when lining those up in VRT with warp. Can the HDF5 driver
> be made to auto-detect these geolocation arrays?
>
>
>
> I see that the NETCDF driver actually does:
>
>
>
> gdalinfo "NetCDF:/vsicurl/
> https://n5eil01u.ecs.nsidc.org/AMSA/AU_SI12.001/2012.07.02/AMSR_U2_L3_SeaIce12km_B04_20120702.he5"
> -sd 26
>
>
>
> I'm asking as an email rather than pursuing the fix because, these data
> are actually a regular grid on the north and south poles, and so
> geolocation by arrays is sub-optimal  the specification is listed in
>
>
>
> https://nsidc.org/sites/default/files/au_si12-v001-userguide_1.pdf
>
>
>
> and the two parameter sets are
>
>
>
> Np-north: -te -3850000,  -5350000, 3750000, 5850000 -t_srs EPSG:3411
>
> Sp-south: -te -3950000,  -3950000, 3950000, 4350000 -t_srs EPSG:3412
>
>
>
> Is this generally something we should pursue within GDAL? It seems like an
> endless task to detect-on-open exactly this situation and assign the easy
> fix, but this is a pretty fundamental data stream and it's very common so
> the longlat/arrays might be numerically detectable with other
> heuristics hinting that it's polar (??) and there are plenty of other
> sources that present equivalents in the right way e.g. this one:
>
>
>
> "/vsicurl/
> https://noaadata.apps.nsidc.org/NOAA/G02135/north/daily/geotiff/2012/07_Jul/N_20120702_concentration_v3.0.tif
> "
>
>
>
> The right approach is probably to inform the providers and get the right
> metadata baked in ... but there's pros and cons to either. I'm not sure
> there's even enough information in these files to clearly detect the
> situation, it would be a bit like the NSIDCbin driver with its very strict
> requirements.
>
>
>
> Cheers, Mike
>
>
>
>
>
> --
>
>
>
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/c971a35d/attachment-0001.htm>

From mdsumner at gmail.com  Tue Apr 30 00:45:12 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 30 Apr 2024 17:45:12 +1000
Subject: [gdal-dev] another problem HDF5
Message-ID: <CAAcGz99bXB460BF6Pn22+tyCi7OaUgxkFYc25+=wfGQKh-NWiQ@mail.gmail.com>

This time, with:

https://n5eil01u.ecs.nsidc.org/ATLAS/ATL20.004/2018.10.14/ATL20-01_20181001010615_00370101_004_01.h5

NETCDF gets the geotransform (from x_grid,y_grid which report in the
metadata) but no crs:

  gdalinfo NETCDF:ATL20-02_20181001010615_00370101_004_01.h5 -sd 1 -nomd
Driver: netCDF/Network Common Data Format
Files: ATL20-02_20181001010615_00370101_004_01.h5
Size is 316, 332
Origin = (-3950000.000000000000000,4350000.000000000000000)
Pixel Size = (25000.000000000000000,-25000.000000000000000)
Corner Coordinates:
Upper Left  (-3950000.000, 4350000.000)
Lower Left  (-3950000.000,-3950000.000)
Upper Right ( 3950000.000, 4350000.000)
Lower Right ( 3950000.000,-3950000.000)
Center      (       0.000,  200000.000)
Band 1 Block=500x500 Type=Float64, ColorInterp=Undefined
  Unit Type: degrees_north


HDF5 doesn't get geotransform or crs:

gdalinfo ATL20-02_20181001010615_00370101_004_01.h5 -sd 1 -nomd
Driver: HDF5Image/HDF5 Dataset
Files: ATL20-02_20181001010615_00370101_004_01.h5
Size is 316, 332
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  332.0)
Upper Right (  316.0,    0.0)
Lower Right (  316.0,  332.0)
Center      (  158.0,  166.0)
Band 1 Block=500x500 Type=Float32, ColorInterp=Undefined
  NoData Value=3.4028235e+38

This is unproblematically NSIDC 25km south, there's no mix of poles in this
one. I honestly don't know what to expect from these files generally though
I get my hopes up sometimes haha.

I'll have to keep notes and explore more deeply with native HDF5 tools.

Cheers, Mike




-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/3217587b/attachment.htm>

From andrew.bell.ia at gmail.com  Tue Apr 30 05:51:45 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Tue, 30 Apr 2024 08:51:45 -0400
Subject: [gdal-dev] Test problem After Merge
In-Reply-To: <a0829b34-ce67-48b3-8dc8-32faf7eb244d@spatialys.com>
References: <CACJ51z3jigezS0dmv5tNj3MA==8Lp8AQbiTo4stoSQRbVQv3FA@mail.gmail.com>
 <a0829b34-ce67-48b3-8dc8-32faf7eb244d@spatialys.com>
Message-ID: <CACJ51z1iUAWxb-j7GV4VZ5Zhexsp-BedWJb28QBxzu0u-azQHA@mail.gmail.com>

Hi all,

I removed all files from the build and started over, building using the
same procedure that I used with the source from a couple of weeks ago
without problem and now I get the following error:

(gdal) [master] $ pytest -v autotest/utilities/test_gdal_viewshed.py
ImportError while loading conftest
'/Users/abell/gdal.2/build/autotest/conftest.py'.
autotest/conftest.py:9: in <module>
    from osgeo import gdal, ogr, osr
swig/python/osgeo/__init__.py:35: in <module>
    _gdal = swig_import_helper()
swig/python/osgeo/__init__.py:32: in swig_import_helper
    return importlib.import_module('_gdal')
E   ModuleNotFoundError: No module named '_gdal'


PYTHONPATH is set as follows:

(gdal) [master] $ env | grep PYTHONPATH
PYTHONPATH=/Users/abell/gdal.2/build/swig/python:


The osgeo directory referenced from PYTHONPATH contains the following:

(gdal) [master] $ ls -l /Users/abell/gdal.2/build/swig/python/osgeo
total 6136
-rw-r--r--  1 abell  staff    4758 Apr 30 08:00 __init__.py
drwxr-xr-x  3 abell  staff      96 Apr 30 08:01 __pycache__
-rwxr-xr-x  1 abell  staff  970248 Apr 30 08:00 _gdal.cpython-312-darwin.so
-rwxr-xr-x  1 abell  staff  136376 Apr 30 08:00 _
gdal_array.cpython-312-darwin.so
-rwxr-xr-x  1 abell  staff   54352 Apr 30 08:00 _
gdalconst.cpython-312-darwin.so
-rwxr-xr-x  1 abell  staff  104072 Apr 30 08:00 _gnm.cpython-312-darwin.so
-rwxr-xr-x  1 abell  staff  717640 Apr 30 08:00 _ogr.cpython-312-darwin.so
-rwxr-xr-x  1 abell  staff  416120 Apr 30 08:00 _osr.cpython-312-darwin.so
-rw-r--r--  1 abell  staff  336675 Apr 30 08:00 gdal.py
-rw-r--r--  1 abell  staff   33746 Apr 30 08:00 gdal_array.py
-rw-r--r--  1 abell  staff   12517 Apr 30 08:00 gdalconst.py
-rw-r--r--  1 abell  staff     214 Apr 30 08:00 gdalnumeric.py
-rw-r--r--  1 abell  staff   14413 Apr 30 08:00 gnm.py
-rw-r--r--  1 abell  staff  221167 Apr 30 08:00 ogr.py
-rw-r--r--  1 abell  staff   84266 Apr 30 08:00 osr.py

I would have thought the file _gdal.cpython-312-darwin.so would have been
found and loaded, but my expertise in this is limited. I tried tracing with
PYTHONVERBOSE set, but the only references to _gdal I saw were in the same
error message quoted above.

Thanks for any help,

On Mon, Apr 29, 2024 at 5:37?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Andrew,
>
> Perhaps you're running updated GDAL Python bindings against a libgdal that
> hasn't been rebuilt recently? OSRIsDerivedProjected() has been added
> recently both in libgdal and the bindings
>

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/da733f80/attachment.htm>

From even.rouault at spatialys.com  Tue Apr 30 06:04:35 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 Apr 2024 15:04:35 +0200
Subject: [gdal-dev] another problem HDF5
In-Reply-To: <CAAcGz99bXB460BF6Pn22+tyCi7OaUgxkFYc25+=wfGQKh-NWiQ@mail.gmail.com>
References: <CAAcGz99bXB460BF6Pn22+tyCi7OaUgxkFYc25+=wfGQKh-NWiQ@mail.gmail.com>
Message-ID: <5d9164ed-60fd-41e3-bffd-05423d55faa3@spatialys.com>

Hi,

oh well, so this i actually a HDF5 file using netCDF conventions, but 
likely created with the HDF5 API itself. Per se, this isn't the issue, 
as you've figured it, we can convince the netCDF driver to open it. The 
lack of CRS comes from the fact that the land_mask_map variable has this 
attribute:

 ??????????????? land_mask_map:grid_mapping = "crs: grid_x crs: grid_y" ;

Which tries to point to the "crs" variable where the CRS is defined. In 
99% of the products, the value of grid_mapping would be just "crs", and 
life would be good.

Here they use the "second format" for grid_mapping, described at 
https://cfconventions.org/Data/cf-conventions/cf-conventions-1.11/cf-conventions.html#grid-mappings-and-projections

"In the second format, it is a blank-separated list of words 
"<gridMappingVariable>: <coordinatesVariable> [<coordinatesVariable> ??] 
[<gridMappingVariable>: <coordinatesVariable>??]", which identifies one 
or more grid mapping variables, and with each grid mapping associates 
one or more coordinatesVariables, i.e. coordinate variables or auxiliary 
coordinate variables."

That documentation isn't 100% crystal clear but the later example 5.10 
"British National Grid" gives an example:

temp:grid_mapping = "crsOSGB: x y crsWGS84: lat lon" ;

So you can point to several crs variables, but for each you need to 
define *all* the relevant axis. The way it is done in the product you 
point doesn't match that philosophy (if they wanted to use the second 
format that should rather set "crs: grid_x grid_y", but using the second 
format here is just asking for troubles), and GDAL doesn't manage to 
parse it.

You could tune netCDFDataset::SetProjectionFromVar() to recognize this 
weird value for grid_mapping in netCDFDataset::SetProjectionFromVar(), 
around line 3287, but I don't feel myself personally motivated to do 
that, if that product is just an outlier, so I leave it to you as an 
exercise if you wish :-). I guess just testing against the hardcoded 
"crs: grid_x crs: grid_y" value would be good enough to handle that outlier.

(Someone, super bored, should author a book about with horror stories 
with netCDF and HDF georeferencing. There's a lot of material. Although 
likely not to be a best seller)

Even

Le 30/04/2024 ? 09:45, Michael Sumner via gdal-dev a ?crit?:
> This time, with:
>
> https://n5eil01u.ecs.nsidc.org/ATLAS/ATL20.004/2018.10.14/ATL20-01_20181001010615_00370101_004_01.h5
>
> NETCDF gets the geotransform (from x_grid,y_grid which report in the 
> metadata) but no crs:
>
> ? gdalinfo NETCDF:ATL20-02_20181001010615_00370101_004_01.h5 -sd 1 -nomd
> Driver: netCDF/Network Common Data Format
> Files: ATL20-02_20181001010615_00370101_004_01.h5
> Size is 316, 332
> Origin = (-3950000.000000000000000,4350000.000000000000000)
> Pixel Size = (25000.000000000000000,-25000.000000000000000)
> Corner Coordinates:
> Upper Left ?(-3950000.000, 4350000.000)
> Lower Left ?(-3950000.000,-3950000.000)
> Upper Right ( 3950000.000, 4350000.000)
> Lower Right ( 3950000.000,-3950000.000)
> Center ? ? ?( ? ? ? 0.000, ?200000.000)
> Band 1 Block=500x500 Type=Float64, ColorInterp=Undefined
> ? Unit Type: degrees_north
>
>
> HDF5 doesn't get geotransform or crs:
>
> gdalinfo ATL20-02_20181001010615_00370101_004_01.h5 -sd 1 -nomd
> Driver: HDF5Image/HDF5 Dataset
> Files: ATL20-02_20181001010615_00370101_004_01.h5
> Size is 316, 332
> Corner Coordinates:
> Upper Left ?( ? ?0.0, ? ?0.0)
> Lower Left ?( ? ?0.0, ?332.0)
> Upper Right ( ?316.0, ? ?0.0)
> Lower Right ( ?316.0, ?332.0)
> Center ? ? ?( ?158.0, ?166.0)
> Band 1 Block=500x500 Type=Float32, ColorInterp=Undefined
> ? NoData Value=3.4028235e+38
>
> This is unproblematically NSIDC 25km south, there's no mix of poles in 
> this one. I honestly don't know what to expect from these files 
> generally though I get my hopes up sometimes haha.
>
> I'll have to keep notes and explore more deeply with native HDF5 tools.
>
> Cheers, Mike
>
>
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/51b20ccf/attachment.htm>

From even.rouault at spatialys.com  Tue Apr 30 06:18:36 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 Apr 2024 15:18:36 +0200
Subject: [gdal-dev] Test problem After Merge
In-Reply-To: <CACJ51z1iUAWxb-j7GV4VZ5Zhexsp-BedWJb28QBxzu0u-azQHA@mail.gmail.com>
References: <CACJ51z3jigezS0dmv5tNj3MA==8Lp8AQbiTo4stoSQRbVQv3FA@mail.gmail.com>
 <a0829b34-ce67-48b3-8dc8-32faf7eb244d@spatialys.com>
 <CACJ51z1iUAWxb-j7GV4VZ5Zhexsp-BedWJb28QBxzu0u-azQHA@mail.gmail.com>
Message-ID: <aec11185-393a-4614-bdad-cfa164bc8b72@spatialys.com>

Andrew,

first, check that you can use the command line utilities like gdalinfo, 
so you may need to adjust your PATH, DYLD_LIBRARY_PATH and GDAL_DATA. 
The Bash script scripts/setdevenv.sh might help setting up stuff (not 
totally sure if it works on Mac though).

Also try in a Python interpreter "from osgeo import gdal" to see if the 
exception is more verbose. If your GDAL lib links against libraries that 
are not in the default library search path, GDAL command line utilities 
might still be able to find them, but loading libgdal through the Python 
bindings might fail (at least that happens to me on Linux, cf 
https://github.com/OSGeo/gdal/pull/9783)

Also try otool -L on libgdal.dylib and on _gdal.cpython-312-darwin.so

Actually your issue looks superficially like the one we have in our CI 
since a few days : https://github.com/OSGeo/gdal/issues/9723 / 
https://github.com/actions/setup-python/issues/849 . Python bindings on 
macos-14 arm64 github were working fine, and suddenly broke at runtime 
with an exception similar to you whereas nobody significant changed 
between working and non-working builds. It looked correlated to some 
update on the github action components, but perhaps that's something 
else. Do you know if there was an operating system update on your system 
recently?

Even

Le 30/04/2024 ? 14:51, Andrew Bell via gdal-dev a ?crit?:
> Hi all,
>
> I removed all files from the build and started over, building using 
> the same procedure that I used with the source from a couple of weeks 
> ago without problem and now I get the following error:
>
> (gdal) [master] $ pytest -v autotest/utilities/test_gdal_viewshed.py
> ImportError while loading conftest 
> '/Users/abell/gdal.2/build/autotest/conftest.py'.
> autotest/conftest.py:9: in <module>
> ? ? from osgeo import gdal, ogr, osr
> swig/python/osgeo/__init__.py:35: in <module>
> ? ? _gdal = swig_import_helper()
> swig/python/osgeo/__init__.py:32: in swig_import_helper
> ? ? return importlib.import_module('_gdal')
> E ? ModuleNotFoundError: No module named '_gdal'
>
>
> PYTHONPATH is set as follows:
>
> (gdal) [master] $ env | grep PYTHONPATH
> PYTHONPATH=/Users/abell/gdal.2/build/swig/python:
>
>
> The osgeo directory referenced from PYTHONPATH contains the following:
>
> (gdal) [master] $ ls -l /Users/abell/gdal.2/build/swig/python/osgeo
> total 6136
> -rw-r--r-- ?1 abell ?staff ? ?4758 Apr 30 08:00 __init__.py
> drwxr-xr-x ?3 abell ?staff ? ? ?96 Apr 30 08:01 __pycache__
> -rwxr-xr-x ?1 abell ?staff ?970248 Apr 30 08:00 
> _gdal.cpython-312-darwin.so <http://gdal.cpython-312-darwin.so>
> -rwxr-xr-x ?1 abell ?staff ?136376 Apr 30 08:00 
> _gdal_array.cpython-312-darwin.so 
> <http://gdal_array.cpython-312-darwin.so>
> -rwxr-xr-x ?1 abell ?staff ? 54352 Apr 30 08:00 
> _gdalconst.cpython-312-darwin.so <http://gdalconst.cpython-312-darwin.so>
> -rwxr-xr-x ?1 abell ?staff ?104072 Apr 30 08:00 
> _gnm.cpython-312-darwin.so <http://gnm.cpython-312-darwin.so>
> -rwxr-xr-x ?1 abell ?staff ?717640 Apr 30 08:00 
> _ogr.cpython-312-darwin.so <http://ogr.cpython-312-darwin.so>
> -rwxr-xr-x ?1 abell ?staff ?416120 Apr 30 08:00 
> _osr.cpython-312-darwin.so <http://osr.cpython-312-darwin.so>
> -rw-r--r-- ?1 abell ?staff ?336675 Apr 30 08:00 gdal.py
> -rw-r--r-- ?1 abell ?staff ? 33746 Apr 30 08:00 gdal_array.py
> -rw-r--r-- ?1 abell ?staff ? 12517 Apr 30 08:00 gdalconst.py
> -rw-r--r-- ?1 abell ?staff ? ? 214 Apr 30 08:00 gdalnumeric.py
> -rw-r--r-- ?1 abell ?staff ? 14413 Apr 30 08:00 gnm.py
> -rw-r--r-- ?1 abell ?staff ?221167 Apr 30 08:00 ogr.py
> -rw-r--r-- ?1 abell ?staff ? 84266 Apr 30 08:00 osr.py
>
> I would have thought the file _gdal.cpython-312-darwin.so 
> <http://gdal.cpython-312-darwin.so> would have been found and loaded, 
> but my expertise in this is limited. I tried tracing with 
> PYTHONVERBOSE set, but the only references to _gdal I saw were in the 
> same error message quoted above.
>
> Thanks for any help,
>
> On Mon, Apr 29, 2024 at 5:37?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Andrew,
>
>     Perhaps you're running updated GDAL Python bindings against a
>     libgdal that hasn't been rebuilt recently? OSRIsDerivedProjected()
>     has been added recently both in libgdal and the bindings
>
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/d7c6f0d2/attachment-0001.htm>

From mdsumner at gmail.com  Tue Apr 30 06:37:15 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 30 Apr 2024 23:37:15 +1000
Subject: [gdal-dev] gdal2tiles for floating point images
In-Reply-To: <CAAcGz9_KtdFwRYYsZYFYUfrifUEMv0i2roJtmswf=KAS5Wpq-A@mail.gmail.com>
References: <CAPryQ-MO6RqJ1iSSP8w-vCaEkUWVT-a1ZBVb9Egu3T95LEvQDg@mail.gmail.com>
 <CAAcGz9_KtdFwRYYsZYFYUfrifUEMv0i2roJtmswf=KAS5Wpq-A@mail.gmail.com>
Message-ID: <CAAcGz98bMQw7DnCHJM0rzi_twW00wjm5Z5oveqURku3xoAq94w@mail.gmail.com>

Ok so my naive edits are clearly not enough, they still get written as Byte
so it's deeper in the target spec and spread across a few places I'm not
ready to get across yet.

Happy to pursue in the longer term though.

Cheers, Mike


On Tue, Apr 30, 2024 at 7:00?AM Michael Sumner <mdsumner at gmail.com> wrote:

>
>
> On Fri, Apr 26, 2024 at 5:37?AM lefsky--- via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> I'd like to have a version of gdal2tiles that handles image types other
>> than uint8. Is there a reason why it doesn't handle those types of images?
>> It appears I'd have to modify the output format from png to tiff.  I have
>> never modified gdal source before and I'm wondering if this modification
>> (which appears straightforward to a naive user) hasn't been done before.
>>
>
>
> Hello, it appears to be sufficient to add GTiff to tiledriver options,
> handle the file extension, and add an option to override the error/message
> that advises conversion to Byte:
>
>
> https://github.com/OSGeo/gdal/compare/master...dis-organization:gdal:gdal2tiles-nonbyte
>
> I wanted this myself as I'm working on a version of the tiling in an R
> package, and I'm not confident enough about it without being able to
> compare to gdal2tiles.py.
>
> It will need care to prepare it and merge into GDAL itself, with some
> thought about documentation, implications for html output (it's compleltely
> incompatible with the html produced I expect), and tests, but if you want
> to use it locally it seems ok and I'm happy to follow up off-list.
>
> Note that you can use VRT to reference such a tiled output for numeric
> data, I used it for a tiled global elevation source here (so if we fold
> this into GDAL that could be a nice option to include, VRT for reading as
> TMS):
>
> https://github.com/hypertidy/sds/blob/main/R/sources.R#L41
>
> Cheers, Mike
>
>
>
>
>>
>> Michael
>>
>>
>> --
>> Michael Lefsky (He/His)
>> Home Location: HVHF+GH
>> Cell: 970-980-9036
>> http://www.researcherid.com/rid/A-7224-2009
>>
>> *?for being prematurely, and worse, intuitively right ? there?s a heavy
>> price. But for being wrong ? no, not so long as you?re wrong in a pack."
>> Gary Brecher / Portis*
>>
>> *I acknowledge that I live and work on stolen land. This is the land of
>> the Cheyenne, Arapaho, Ute, and Ocheithi Sakowin people. To learn more
>> about these nations, please visit;
>> http://www.utemountainutetribe.com/
>> http://www.cheyennenation.com/
>> https://cheyenneandarapaho-nsn.gov/
>> https://native-land.ca/
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/57124955/attachment.htm>

From howard at hobu.co  Tue Apr 30 07:58:44 2024
From: howard at hobu.co (Howard Butler)
Date: Tue, 30 Apr 2024 09:58:44 -0500
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
Message-ID: <FAB650DC-9F6F-4688-929D-24A47C0C1DCC@hobu.co>

Howard Butler, Even Rouault, Dan Baston, Alessandro Pasotti, Javier Jimenez Shaw, and OSGeo Treasurer Mike Smith held the monthly GDAL Maintainers Meeting on 03/28/2024. The following items were discussed and reported upon:

Discussion Items
----------------------------

* GDAL 3.9.0 RC1 is expected 06 MAY 2024, with the final release to follow. A NEWS entry listing all of its enhancements and bug fixes is available from https://github.com/OSGeo/gdal/blob/release/3.9/NEWS.md
* GDAL 3.10 is expected to be the release number after 3.9. A release named 4.0 is being tabled until there are enough major items to warrant it.
* The OGC CRS Standards Working Group has added a work item of constructing a CRSJSON definition. PROJJSON is being used as the starting point for that effort, although it is unclear if compatibility between them is to be a priority. Participate through your OGC channels if this topic is important to you. https://lists.osgeo.org/pipermail/proj/2024-April/011375.html 

Maintenance activities update
------------------------------------------

Dan

* Python API documentation is complete. See https://gdal.org/api/index.html#python-api for live preview of its updates
* Random order testing now working except for one sticky issue with library load ordering
* Added Numpy masked array
* Updated to use os.pathlike where reasonable
* VSIFile* methods no longer crash on closed file handles
* Adjust ogr.DataSource and alias ogr.Dataset (Python bindings only)
* Future activities include, adding some developer guide updates, testing instructions, and investigation of expressing RAII tools such as smart pointers into C++ API 

Alessandro

* PR reviews
* Investigation of gdalwarp and VSI caching behavior
* Adapting the argparse https://github.com/p-ranav/argparse argument parser to more utilities. The new argument parsing code supports integrated help, translation possibilities, and long help in addition to standardizing how GDAL utilities behave in regards to consumption and expression of command line arguments.

Even

* Docker image updates including bumping osgeo/gdal base image to Ubuntu 24.04
* Preparation and verification of the GDAL bindings for Numpy 2.0 
* TileDB version bump
* GDAL 3.9 release preparation
* Release notes for GDAL 3.9 https://github.com/OSGeo/gdal/blob/release/3.9/NEWS.md
* GDAL 3.8.5 release 

The next GDAL Maintainers Meeting is 05/23/2024 at 13:00 UTC. Any GDAL PR contributors are welcome to join by reaching out to me for an invite.

Howard

From andrew.bell.ia at gmail.com  Tue Apr 30 08:41:59 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Tue, 30 Apr 2024 11:41:59 -0400
Subject: [gdal-dev] Test problem After Merge
In-Reply-To: <aec11185-393a-4614-bdad-cfa164bc8b72@spatialys.com>
References: <CACJ51z3jigezS0dmv5tNj3MA==8Lp8AQbiTo4stoSQRbVQv3FA@mail.gmail.com>
 <a0829b34-ce67-48b3-8dc8-32faf7eb244d@spatialys.com>
 <CACJ51z1iUAWxb-j7GV4VZ5Zhexsp-BedWJb28QBxzu0u-azQHA@mail.gmail.com>
 <aec11185-393a-4614-bdad-cfa164bc8b72@spatialys.com>
Message-ID: <CACJ51z1H_OYPr1SDELa_-KXk8RRL5peok1+n4uy-dNEAAB3xjA@mail.gmail.com>

On Tue, Apr 30, 2024 at 9:18?AM Even Rouault <even.rouault at spatialys.com>
wrote:

Even,

> Also try in a Python interpreter "from osgeo import gdal" to see if the
> exception is more verbose. If your GDAL lib links against libraries that
> are not in the default library search path, GDAL command line utilities
> might still be able to find them, but loading libgdal through the Python
> bindings might fail (at least that happens to me on Linux, cf
> https://github.com/OSGeo/gdal/pull/9783)
>
Also try otool -L on libgdal.dylib and on _gdal.cpython-312-darwin.so
>
This was indeed the issue. I didn't think there was a version of GDAL in my
environment, but it must have gotten in by error at some point. When the
SWIG library _gdal...so was created, a dependency was created for the
system-located library (version 34) rather than the one in the build
(version 35). I'd have to do more research to figure out how to rectify
this, if desired.

Thanks for your help. The python failure message wasn't too helpful on its
own.

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/02046ce1/attachment.htm>

From j1 at jimenezshaw.com  Tue Apr 30 09:58:13 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 30 Apr 2024 18:58:13 +0200
Subject: [gdal-dev] gdal2tiles for floating point images
In-Reply-To: <CAAcGz98bMQw7DnCHJM0rzi_twW00wjm5Z5oveqURku3xoAq94w@mail.gmail.com>
References: <CAPryQ-MO6RqJ1iSSP8w-vCaEkUWVT-a1ZBVb9Egu3T95LEvQDg@mail.gmail.com>
 <CAAcGz9_KtdFwRYYsZYFYUfrifUEMv0i2roJtmswf=KAS5Wpq-A@mail.gmail.com>
 <CAAcGz98bMQw7DnCHJM0rzi_twW00wjm5Z5oveqURku3xoAq94w@mail.gmail.com>
Message-ID: <CADRrdKsnanFmZ0EvaDpHdV0x1Lb4qBvnBGcrKhk1rwCiiYtpJA@mail.gmail.com>

I know that this is not what you want... but have you considered to use
COG? Openlayers supports it, Leaflet I am not sure (I hope it does, at
least via plugin).
To improve performance, I warped to web mercator with GDAL, so Openlayers
is not wasting time on the reprojection.

On Tue, 30 Apr 2024 at 15:37, Michael Sumner via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Ok so my naive edits are clearly not enough, they still get written as
> Byte so it's deeper in the target spec and spread across a few places I'm
> not ready to get across yet.
>
> Happy to pursue in the longer term though.
>
> Cheers, Mike
>
>
> On Tue, Apr 30, 2024 at 7:00?AM Michael Sumner <mdsumner at gmail.com> wrote:
>
>>
>>
>> On Fri, Apr 26, 2024 at 5:37?AM lefsky--- via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> I'd like to have a version of gdal2tiles that handles image types other
>>> than uint8. Is there a reason why it doesn't handle those types of images?
>>> It appears I'd have to modify the output format from png to tiff.  I have
>>> never modified gdal source before and I'm wondering if this modification
>>> (which appears straightforward to a naive user) hasn't been done before.
>>>
>>
>>
>> Hello, it appears to be sufficient to add GTiff to tiledriver options,
>> handle the file extension, and add an option to override the error/message
>> that advises conversion to Byte:
>>
>>
>> https://github.com/OSGeo/gdal/compare/master...dis-organization:gdal:gdal2tiles-nonbyte
>>
>> I wanted this myself as I'm working on a version of the tiling in an R
>> package, and I'm not confident enough about it without being able to
>> compare to gdal2tiles.py.
>>
>> It will need care to prepare it and merge into GDAL itself, with some
>> thought about documentation, implications for html output (it's compleltely
>> incompatible with the html produced I expect), and tests, but if you want
>> to use it locally it seems ok and I'm happy to follow up off-list.
>>
>> Note that you can use VRT to reference such a tiled output for numeric
>> data, I used it for a tiled global elevation source here (so if we fold
>> this into GDAL that could be a nice option to include, VRT for reading as
>> TMS):
>>
>> https://github.com/hypertidy/sds/blob/main/R/sources.R#L41
>>
>> Cheers, Mike
>>
>>
>>
>>
>>>
>>> Michael
>>>
>>>
>>> --
>>> Michael Lefsky (He/His)
>>> Home Location: HVHF+GH
>>> Cell: 970-980-9036
>>> http://www.researcherid.com/rid/A-7224-2009
>>>
>>> *?for being prematurely, and worse, intuitively right ? there?s a heavy
>>> price. But for being wrong ? no, not so long as you?re wrong in a pack."
>>> Gary Brecher / Portis*
>>>
>>> *I acknowledge that I live and work on stolen land. This is the land of
>>> the Cheyenne, Arapaho, Ute, and Ocheithi Sakowin people. To learn more
>>> about these nations, please visit;
>>> http://www.utemountainutetribe.com/
>>> http://www.cheyennenation.com/
>>> https://cheyenneandarapaho-nsn.gov/
>>> https://native-land.ca/
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/82b129fa/attachment-0001.htm>

From even.rouault at spatialys.com  Tue Apr 30 10:41:32 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 Apr 2024 19:41:32 +0200
Subject: [gdal-dev] Test problem After Merge
In-Reply-To: <CACJ51z1H_OYPr1SDELa_-KXk8RRL5peok1+n4uy-dNEAAB3xjA@mail.gmail.com>
References: <CACJ51z3jigezS0dmv5tNj3MA==8Lp8AQbiTo4stoSQRbVQv3FA@mail.gmail.com>
 <a0829b34-ce67-48b3-8dc8-32faf7eb244d@spatialys.com>
 <CACJ51z1iUAWxb-j7GV4VZ5Zhexsp-BedWJb28QBxzu0u-azQHA@mail.gmail.com>
 <aec11185-393a-4614-bdad-cfa164bc8b72@spatialys.com>
 <CACJ51z1H_OYPr1SDELa_-KXk8RRL5peok1+n4uy-dNEAAB3xjA@mail.gmail.com>
Message-ID: <b20395e6-06af-4058-8978-35a735efd9a6@spatialys.com>

Andrew,

interestingly adding the debug traces I suggested to you to the GDAL CI 
MacOS 14 build witch no longer worked turns out to reveal the exact same 
issue as yours! (funny that I didn't even consider doing that myself ! 
interesting case where helping others actually is helping oneself :-))? 
_gdal.cpython-312-darwin.so was also linking against libgdal.so.34 (GDAL 
3.8.5) instead of libgdal.so.35 (libgdal 3.10dev). The reason is that 
this CI configuration uses conda-forge to install dependencies, and it 
accidentally installed libgdal itself, instead of just its dependencies 
(it add a "conda install --only-deps libgdal libgdal-arrow-parquet" 
line, but I missed that libgdal *is* a dependency of 
libgdal-arrow-parquet... )

Looking at the compilation log, I see:

arm64-apple-darwin20.0.0-clang++ -bundle -undefined dynamic_lookup 
-Wl,-rpath,/Users/runner/miniconda3/envs/test/lib 
-L/Users/runner/miniconda3/envs/test/lib 
-Wl,-rpath,/Users/runner/miniconda3/envs/test/lib 
-L/Users/runner/miniconda3/envs/test/lib 
-Wl,-headerpad_max_install_names -Wl,-dead_strip_dylibs 
-Wl,-rpath,/Users/runner/miniconda3/envs/test/lib 
-L/Users/runner/miniconda3/envs/test/lib -ftree-vectorize -fPIC 
-fstack-protector-strong -O2 -pipe -isystem 
/Users/runner/miniconda3/envs/test/include -D_FORTIFY_SOURCE=2 -isystem 
/Users/runner/miniconda3/envs/test/include 
build/temp.macosx-11.0-arm64-cpython-312/extensions/gdal_wrap.o 
-L/Users/runner/work/gdal/gdal/build -lgdal -o 
build/lib.macosx-11.0-arm64-cpython-312/osgeo/_gdal.cpython-312-darwin.so

So something in the Python extension building logic (conda 
customizations?) adds this -L/Users/runner/miniconda3/envs/test/lib 
where the "libgdal" from conda-forge is found, which apparently takes 
precedence over the "-L/Users/runner/work/gdal/gdal/build -lgdal" 
towards the end of the line, which is the bit that links against the 
libgdal of the build tree.

For my CI case removing libgdal from the installed conda-forge packages 
fixed the issue, but it would be nice if we could avoid/detect the issue 
in the first place. If so, that would likely be some magic to add into 
swig/python/setup.py.in. It might be tricky to do so though. Like 
detecting -Larg in the linking options and looking for a 
libgdal.so/dylib in them... ? Yuck. Or perhaps do some postprocessing 
check that the resulting extension .so links against the expected libgdal?

Even

Le 30/04/2024 ? 17:41, Andrew Bell a ?crit?:
> On Tue, Apr 30, 2024 at 9:18?AM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
> Even,
>
>     Also try in a Python interpreter "from osgeo import gdal" to see
>     if the exception is more verbose. If your GDAL lib links against
>     libraries that are not in the default library search path, GDAL
>     command line utilities might still be able to find them, but
>     loading libgdal through the Python bindings might fail (at least
>     that happens to me on Linux, cf
>     https://github.com/OSGeo/gdal/pull/9783)
>
>     Also try otool -L on libgdal.dylib and on
>     _gdal.cpython-312-darwin.so <http://gdal.cpython-312-darwin.so>
>
> This was indeed the issue. I didn't think there was a version of GDAL 
> in my environment, but it must have gotten in by error at some point. 
> When the SWIG library _gdal...so was created, a dependency was created 
> for the system-located library (version 34) rather than the one in the 
> build (version 35). I'd have to do more research to figure out how to 
> rectify this, if desired.
>
> Thanks for your help. The python failure message wasn't too helpful on 
> its own.
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240430/7fa347ab/attachment.htm>

