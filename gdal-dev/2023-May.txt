From adamgutonski at protonmail.com  Mon May  1 10:20:59 2023
From: adamgutonski at protonmail.com (adamgutonski)
Date: Mon, 01 May 2023 17:20:59 +0000
Subject: [gdal-dev] Java Binding Versions in GDAL Docker Ubuntu Full
Message-ID: <D_lsFwKL8uuWhurGpjyvnwyNaYiybmFR6rP93jWDmhlHKxCVRkSzQgxWa4sdSbUi3po7ASABYI7jhSs_u4e_E1kEfu8Esd9jdZ5TrvXVXC8=@protonmail.com>

Hello,

I am setting up a Docker container which copies from the GDAL ubuntu-full image, and I noticed that the Java bindings with ubuntu-full are for Java Version 11 only. I am using Java Version 17. Are there any deprecated features or potential caveats to be aware of when using Java 17 and the GDAL bindings that have been compiled for 11? I can't find any information online about this and I do not know how one would rebuild the container bindings. Perhaps the bindings be updated in ubuntu-full in the future?

Thank you for any information you can provide.

Kind regards,
Adam Gutonski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230501/6169dc40/attachment.htm>

From even.rouault at spatialys.com  Mon May  1 13:08:16 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 1 May 2023 22:08:16 +0200
Subject: [gdal-dev] Java Binding Versions in GDAL Docker Ubuntu Full
In-Reply-To: <D_lsFwKL8uuWhurGpjyvnwyNaYiybmFR6rP93jWDmhlHKxCVRkSzQgxWa4sdSbUi3po7ASABYI7jhSs_u4e_E1kEfu8Esd9jdZ5TrvXVXC8=@protonmail.com>
References: <D_lsFwKL8uuWhurGpjyvnwyNaYiybmFR6rP93jWDmhlHKxCVRkSzQgxWa4sdSbUi3po7ASABYI7jhSs_u4e_E1kEfu8Esd9jdZ5TrvXVXC8=@protonmail.com>
Message-ID: <c58d0792-0763-3fa8-e9e1-04cb893a8a2e@spatialys.com>

Fixed per https://github.com/OSGeo/gdal/pull/7669

Le 01/05/2023 ? 19:20, adamgutonski via gdal-dev a ?crit?:
> Hello,
>
> I am setting up a Docker container which copies from the GDAL 
> ubuntu-full image, and I noticed that the Java bindings with 
> ubuntu-full are for Java Version 11 only.? I am using Java Version 
> 17.? Are there any deprecated features or potential caveats to be 
> aware of when using Java 17 and the GDAL bindings that have been 
> compiled for 11?? I can't find any information online about this and I 
> do not know how one would rebuild the container bindings.? Perhaps the 
> bindings be updated in ubuntu-full in the future?
>
> Thank you for any information you can provide.
>
> Kind regards,
> Adam Gutonski
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230501/9422ee38/attachment.htm>

From adamgutonski at protonmail.com  Mon May  1 13:10:37 2023
From: adamgutonski at protonmail.com (adamgutonski)
Date: Mon, 01 May 2023 20:10:37 +0000
Subject: [gdal-dev] Java Binding Versions in GDAL Docker Ubuntu Full
In-Reply-To: <c58d0792-0763-3fa8-e9e1-04cb893a8a2e@spatialys.com>
References: <D_lsFwKL8uuWhurGpjyvnwyNaYiybmFR6rP93jWDmhlHKxCVRkSzQgxWa4sdSbUi3po7ASABYI7jhSs_u4e_E1kEfu8Esd9jdZ5TrvXVXC8=@protonmail.com>
 <c58d0792-0763-3fa8-e9e1-04cb893a8a2e@spatialys.com>
Message-ID: <nQ-6_YnOkPOaZLgMsf2_UJCT-UqcZp-0t1o0fXd9Rz9hUYYHvjmHeWbb7kLYWMFufALXiQNBU0PNw0DdfLrDJOcXAEBg_SR5a9yJ1-L8hgw=@protonmail.com>

Amazing Even, thank you!

Sent with [Proton Mail](https://proton.me/) secure email.

------- Original Message -------
On Monday, May 1st, 2023 at 4:08 PM, Even Rouault <even.rouault at spatialys.com> wrote:

> Fixed per https://github.com/OSGeo/gdal/pull/7669
>
> Le 01/05/2023 ? 19:20, adamgutonski via gdal-dev a ?crit :
>
>> Hello,
>>
>> I am setting up a Docker container which copies from the GDAL ubuntu-full image, and I noticed that the Java bindings with ubuntu-full are for Java Version 11 only. I am using Java Version 17. Are there any deprecated features or potential caveats to be aware of when using Java 17 and the GDAL bindings that have been compiled for 11? I can't find any information online about this and I do not know how one would rebuild the container bindings. Perhaps the bindings be updated in ubuntu-full in the future?
>>
>> Thank you for any information you can provide.
>>
>> Kind regards,
>> Adam Gutonski
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>>
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230501/43f32923/attachment.htm>

From even.rouault at spatialys.com  Tue May  2 07:03:49 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 2 May 2023 16:03:49 +0200
Subject: [gdal-dev] GDAL 3.7.0 release candidate available
Message-ID: <1b769b16-d969-1058-fbe8-7a4dbfc13aff@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.7.0 release candidate.

NEWS at:

 ? https://github.com/OSGeo/gdal/blob/v3.7.0RC1/NEWS.md

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.7.0/gdal-3.7.0rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.7.0/gdal-3.7.0rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.7.0/gdal370rc1.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.7.0/gdalautotest-3.7.0rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.7.0/gdalautotest-3.7.0rc1.zip

A snapshot of the documentation is at:

 ? https://download.osgeo.org/gdal/3.7.0/gdal370doc.zip

Note that the generated files for the Python bindings are no longer included
in the sources, so SWIG must be available at build time.

I'll call for a vote promoting it to next week if no serious problems 
are reported before.

The "release/3.7" branch has been created for all bug fixes related to 
3.7.x.
master is now targeting 3.8.0dev.

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From holger.jaekel at gmx.de  Tue May  2 10:57:16 2023
From: holger.jaekel at gmx.de (Holger Jaekel)
Date: Tue, 2 May 2023 19:57:16 +0200
Subject: [gdal-dev] GDAL 3.7.0 release candidate available
In-Reply-To: <1b769b16-d969-1058-fbe8-7a4dbfc13aff@spatialys.com>
References: <1b769b16-d969-1058-fbe8-7a4dbfc13aff@spatialys.com>
Message-ID: <a47427a0-0610-c48d-6353-371b274e5191@gmx.de>

Even,

Am 02.05.23 um 16:03 schrieb Even Rouault:
> I have prepared a GDAL/OGR 3.7.0 release candidate.

The release candidate builds well on Alpine Linux Edge. I just observed
that the files gfs.xsd and gml_registry.xsd were mentioned in the news
but not copied to /usr/share/lib/gdal

Also the filename is ogrinfo_output.schema.json and not
ogrinfo_output.json.schema as it says in the news.

Best
   Holger

From even.rouault at spatialys.com  Tue May  2 11:14:52 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 2 May 2023 20:14:52 +0200
Subject: [gdal-dev] GDAL 3.7.0 release candidate available
In-Reply-To: <a47427a0-0610-c48d-6353-371b274e5191@gmx.de>
References: <1b769b16-d969-1058-fbe8-7a4dbfc13aff@spatialys.com>
 <a47427a0-0610-c48d-6353-371b274e5191@gmx.de>
Message-ID: <6dd43d64-e7d3-9b8d-7012-5232b334efde@spatialys.com>

Holger,

thanks for the feedback. Fixed per 
https://github.com/OSGeo/gdal/commit/b0039c648073713578bb0360f92a6c859a011832 
and backport to the 3.7 branch

I will probably not issue a new RC just because of that as those files 
aren't used by the code, so this will probably be only in 3.7.1

Even

Le 02/05/2023 ? 19:57, Holger Jaekel a ?crit?:
> Even,
>
> Am 02.05.23 um 16:03 schrieb Even Rouault:
>> I have prepared a GDAL/OGR 3.7.0 release candidate.
>
> The release candidate builds well on Alpine Linux Edge. I just observed
> that the files gfs.xsd and gml_registry.xsd were mentioned in the news
> but not copied to /usr/share/lib/gdal
>
> Also the filename is ogrinfo_output.schema.json and not
> ogrinfo_output.json.schema as it says in the news.
>
> Best
> ? Holger
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From craig.destigter at koordinates.com  Tue May  2 18:10:53 2023
From: craig.destigter at koordinates.com (Craig de Stigter)
Date: Wed, 3 May 2023 13:10:53 +1200
Subject: [gdal-dev] Deciding whether to use WFS paging after opening the
 datasource
Message-ID: <CAF1M8pdXRmdPpgRSNZRd3m1FkHqV8CpP_fEvaTFFYO4MW+q-qw@mail.gmail.com>

Hi folks

We're having trouble with OGR trying to fetch a response from this WFS2
URL:
https://geo.irceline.be/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=realtime:pm25_24hmean_station&COUNT=1000000&STARTINDEX=0

The error from the server is

Cannot do natural order without a primary key, please add it or specify a
> manual sort over existing attributes
>

This seems fair enough on the surface - we specified *STARTINDEX=0* but the
server is unable to support paging for this dataset due to no natural sort
order.

We'd happily disable paging for this dataset - it has a fairly low number
of features - but we would prefer to implement a general purpose solution
rather than special-case this particular dataset.

It would make sense to open the datasource, check the feature count by
doing a 'hits' query (we're doing this anyway), and then use paging if
there are more than 1000000 features - otherwise don't use paging.

However I can't find a way to accomplish this with GDAL. The
*OGR_WFS_PAGING_ALLOWED* config var is only checked when the datasource is
opened - so you can't open the datasource, check the feature count and then
change the paging behaviour.

I can imagine either of these changes in GDAL itself might fix this:

1. GDAL could check *OGR_WFS_PAGING_ALLOWED* when actually first issuing
GetFeature requests, rather than during datasource creation
2. GDAL could omit the pagination parameters if the feature count is
already known and is less than the page size

How would you suggest we proceed?

-- 
Regards,
Craig

Platform Engineer
Koordinates

+64 21 256 9488 <+64%2021%20256%209488> / koordinates.com / @koordinates
<https://twitter.com/koordinates>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/184bc866/attachment.htm>

From mtobby59 at gmail.com  Tue May  2 19:20:30 2023
From: mtobby59 at gmail.com (Tobby Moalem)
Date: Wed, 3 May 2023 05:20:30 +0300
Subject: [gdal-dev] JPEG2000 change progression order without decoding
Message-ID: <CALGHxB1eYJPkRVjucppLi3LV6pMSwr=4yS8yz7B3F4z2vkjJAw@mail.gmail.com>

I wonder if there is a way to change the progression order of jpeg2000
images, without the need of decoding it and then encode it again. For
example if I have an image with RPCL progression and I want to convert it
to LRCP. Is there a way to only move bits around (change the order of the
file) instead of needing to transcode the image all over again (which may
take a long time)?

Thanks in advance,
Tobby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/c7adf9d9/attachment.htm>

From even.rouault at spatialys.com  Wed May  3 04:52:33 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 May 2023 13:52:33 +0200
Subject: [gdal-dev] Deciding whether to use WFS paging after opening the
 datasource
In-Reply-To: <CAF1M8pdXRmdPpgRSNZRd3m1FkHqV8CpP_fEvaTFFYO4MW+q-qw@mail.gmail.com>
References: <CAF1M8pdXRmdPpgRSNZRd3m1FkHqV8CpP_fEvaTFFYO4MW+q-qw@mail.gmail.com>
Message-ID: <48600ac8-a494-b9a2-8f66-357994645aa6@spatialys.com>

Craig,

Both options you propose are reasonable. I'd perhaps have a slight 
preference for option 2 (is my understanding correct that the user would 
be responsible to issue GetFeatureCount() manually before calling 
GetNextFeature() ? we don't want to systematically call 
GetFeatureCount() because it could be potentially a rather costly 
operation for some servers).

It could be enhanced with allowing a CHECK_WITH_HITS value for 
OGR_WFS_PAGING_ALLOWED (or perhaps through a new specific open option ?) 
that would automatically issue the feature count request (that could be 
useful for ogr2ogr types of scenario where the user can't easily cause 
ogr2ogr to issue GetFeatureCount())

Even

Le 03/05/2023 ? 03:10, Craig de Stigter a ?crit?:
> Hi folks
>
> We're having trouble with OGR trying to fetch a response from this 
> WFS2 URL: 
> https://geo.irceline.be/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=realtime:pm25_24hmean_station&COUNT=1000000&STARTINDEX=0 
> <https://geo.irceline.be/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=realtime:pm25_24hmean_station&COUNT=1000000&STARTINDEX=0>
>
> The error from the server is
>
>     Cannot do natural order without a primary key, please add it or
>     specify a manual sort over existing attributes
>
>
> This seems fair enough on the surface - we specified *STARTINDEX=0* 
> but the server is unable to support paging for this dataset due to no 
> natural sort order.
>
> We'd happily disable paging for this dataset - it has a fairly low 
> number of features - but we would prefer to implement a general 
> purpose solution rather than special-case this particular dataset.
>
> It would make sense to open the datasource, check the feature count by 
> doing a 'hits' query (we're doing this anyway), and then use paging if 
> there are more than 1000000 features - otherwise don't use paging.
>
> However I can't find a way to accomplish this with GDAL. The 
> *OGR_WFS_PAGING_ALLOWED* config var is only checked when the 
> datasource is opened - so you can't open the datasource, check the 
> feature count and then change the paging behaviour.
>
> I can imagine either of these changes in GDAL itself might fix this:
>
> 1. GDAL could check *OGR_WFS_PAGING_ALLOWED* when actually first 
> issuing GetFeature requests, rather than during datasource creation
> 2. GDAL could omit the pagination parameters if the feature count is 
> already known and is less than the page size
>
> How would you suggest we proceed?
>
> -- 
> Regards,
> Craig
>
> Platform Engineer
> Koordinates
>
> +64 21 256 9488 <tel:+64%2021%20256%209488>?/ koordinates.com 
> <http://koordinates.com/>?/ @koordinates <https://twitter.com/koordinates>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/e3a96647/attachment.htm>

From mcalzado at carto.com  Wed May  3 05:22:48 2023
From: mcalzado at carto.com (Moises Calzado)
Date: Wed, 3 May 2023 14:22:48 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
Message-ID: <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>

Hi Even,

Thanks so much for taking a look into that one!

I have one doubt regarding the CSVT content, as we're not really using it,
but it's required when using the GEOMETRY_NAME layer creation option, as
can be checked in the CSV driver documentation:


>    -
>
>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry column.
>    Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>
> We really need this flag as we are processing files that contain
geometries with different column names, and we always want the same
geometry name in the generated output. Are we losing something when using
that flag to avoid this problem?
In my humble opinion, generating an invalid CSV when using the -lco
CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
strings containing line breaks can't be quoted.

Could you please shed some light on this?

Looking forward to your reply,
Regards.

El mi?, 3 may 2023 a las 14:00, Even Rouault (<even.rouault at spatialys.com>)
escribi?:

> you didn't post to the list
> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>
> Hi Even,
>
> Thanks so much for taking a look into that one!
>
> I have one doubt regarding the CSVT content, as we're not really using it,
> but it's required when using the GEOMETRY_NAME layer creation option, as
> can be checked in the CSV driver documentation:
>
>
>>    -
>>
>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry column.
>>    Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>
>> We really need this flag as we are processing files that contain
> geometries with different column names, and we always want the same
> geometry name in the generated output. Are we losing something when using
> that flag to avoid this problem?
> In my humble opinion, generating an invalid CSV when using the -lco
> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
> strings containing line breaks can't be quoted.
>
> Could you please shed some light on this?
>
> Looking forward to your reply,
> Regards.
>
> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<even.rouault at spatialys.com>)
> escribi?:
>
>> Moises,
>>
>> as far as I can see with your example, the CSV driver behaves "properly"
>> in reading and writing of field values with line breaks.
>>
>> It follows the "Fields with embedded line breaks must be quoted" rule of
>> https://en.wikipedia.org/wiki/Comma-separated_values
>>
>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>
>> $ cat out.csv
>> id,descriptio
>> "1",This is my third row
>> "2","this is
>> my string
>> "
>> "3",This is my third row
>>
>> $ ogrinfo out.csv -al
>> INFO: Open of `out.csv'
>>       using driver `CSV' successful.
>>
>> Layer name: out
>> Geometry: None
>> Feature Count: 3
>> Layer SRS WKT:
>> (unknown)
>> id: String (0.0)
>> descriptio: String (0.0)
>> OGRFeature(out):1
>>   id (String) = 1
>>   descriptio (String) = This is my third row
>>
>> OGRFeature(out):2
>>   id (String) = 2
>>   descriptio (String) = this is
>> my string
>>
>>
>> OGRFeature(out):3
>>   id (String) = 3
>>   descriptio (String) = This is my third row
>>
>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is going
>> to result in an invalid CSV file which will mix both the .csvt and .csv
>> content
>>
>> Even
>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>
>> Hello!
>>
>> We're trying to convert a Shapefile into a CSV using ogr2ogr and we're
>> having some issues while dealing with some columns that contain line breaks
>> inside their values. If we have a line with the following string, ogr2ogr
>> detects that the line break is a new line and it returns two lines.
>>
>> "this is my \n value"
>>
>>
>> That's the command that we're executing:
>>
>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/ /vsizip/shapefile.zip
>>> -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco GEOMETRY=AS_WKT -lco
>>> GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>
>>
>> Is this an expected behaviour, or is there any way to avoid this?
>> Sharing an example Shapefile so that you can try to reproduce that
>> behaviour:
>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>
>> Thanks so much in advance,
>> Regards.
>>
>> --
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
> <https://spatial-data-science-conference.com/2023/london/>
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
*Moises Calzado*

Support Engineer

+34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/511ad1e3/attachment-0001.htm>

From even.rouault at spatialys.com  Wed May  3 05:25:40 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 May 2023 14:25:40 +0200
Subject: [gdal-dev] JPEG2000 change progression order without decoding
In-Reply-To: <CALGHxB1eYJPkRVjucppLi3LV6pMSwr=4yS8yz7B3F4z2vkjJAw@mail.gmail.com>
References: <CALGHxB1eYJPkRVjucppLi3LV6pMSwr=4yS8yz7B3F4z2vkjJAw@mail.gmail.com>
Message-ID: <96b839f6-67d6-0ddf-7391-fee106cc18b3@spatialys.com>

I don't have in mind OSS to do that, but the kdu_transcode utility from 
Kakadu (proprietary) should be able to do it. Cf 
https://trac.osgeo.org/gdal/ticket/3295 / 
https://kakadusoftware.com/wp-content/uploads/Usage_Examples.txt

Le 03/05/2023 ? 04:20, Tobby Moalem a ?crit?:
> I wonder if there is a way to change the progression order of jpeg2000 
> images, without the need of decoding it and then encode it again. For 
> example if I have an image with RPCL progression and I want to convert 
> it to LRCP. Is there a way to only move bits around (change the order 
> of the file) instead of needing to transcode the image all over again 
> (which may take a long time)?
>
> Thanks in advance,
> Tobby
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed May  3 05:33:42 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 May 2023 14:33:42 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
Message-ID: <c5c1407b-4289-7708-4615-5c51395a8b8f@spatialys.com>


Le 03/05/2023 ? 14:22, Moises Calzado via gdal-dev a ?crit?:
> Hi Even,
>
> Thanks so much for taking a look into that one!
>
> I have one doubt regarding the CSVT content, as we're not really using 
> it, but it's required when using the GEOMETRY_NAME layer creation 
> option, as can be checked in the CSV driver documentation:
>
>      *
>
>         GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>         column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES.
>         Defaults to WKT
>
> We really need this flag as we are processing files that?contain 
> geometries with different column names, and we always want the same 
> geometry name in the generated output. Are we losing something when 
> using that flag to avoid this problem?

The reason? for requiring CREASE_CSVT=YES is that when reading back a 
.csv without a .csvt the geometry column must be named WKT. Unless you 
specify the GEOM_POSSIBLE_NAMES open option (which must have been a 
later addition). That said it could be reasonable to relax that coupling 
and allow GEOMETRY_NAME without CREATE_CSVT=YES, with a warning in the 
doc about the consequence I just mentioned before

> In my humble opinion, generating an invalid CSV when using the -lco 
> CREATE_CSVT=YES looks like a bug for me,

Are you speaking about emitting the .prj and .csvt content when writing 
to /vsistdout ? Yes, I'd tend to agree they should not be emitted in 
that mode.

> as I can't see the reason why strings containing line breaks can't be 
> quoted.
I'm not following you about the issue with line breaks. In my previous 
message, I showed I didn't reproduce any issue: the CSV driver emits 
fields with double quotes, even when there are line breaks. Can you be 
more specific about what's wrong ? I don't see the connection with 
GEOMETRY_NAME.
>
> Could you please shed some light on this?
>
> Looking forward to your reply,
> Regards.
>
> El mi?, 3 may 2023 a las 14:00, Even Rouault 
> (<even.rouault at spatialys.com>) escribi?:
>
>     you didn't post to the list
>
>     Le 03/05/2023 ? 13:49, Moises Calzado a ?crit?:
>>     Hi Even,
>>
>>     Thanks so much for taking a look into that one!
>>
>>     I have one doubt regarding the CSVT content, as we're not really
>>     using it, but it's required when using the GEOMETRY_NAME layer
>>     creation option, as can be checked in the CSV driver documentation:
>>
>>          *
>>
>>             GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of
>>             geometry column. Only used if GEOMETRY=AS_WKT and
>>             CREATE_CSVT=YES. Defaults to WKT
>>
>>     We really need this flag as we are processing files that?contain
>>     geometries with different column names, and we always want the
>>     same geometry name in the generated output. Are we losing
>>     something when using that flag to avoid this problem?
>>     In my humble opinion, generating an invalid CSV when using the
>>     -lco CREATE_CSVT=YES looks like a bug for me, as I can't see the
>>     reason why strings containing line breaks can't be quoted.
>>
>>     Could you please shed some light on this?
>>
>>     Looking forward to your reply,
>>     Regards.
>>
>>     El s?b, 29 abr 2023 a las 15:44, Even Rouault
>>     (<even.rouault at spatialys.com>) escribi?:
>>
>>         Moises,
>>
>>         as far as I can see with your example, the CSV driver behaves
>>         "properly" in reading and writing of field values with line
>>         breaks.
>>
>>         It follows the "Fields with embedded line breaks must be
>>         quoted" rule of
>>         https://en.wikipedia.org/wiki/Comma-separated_values
>>
>>         $ ogr2ogr out.csv /vsizip/dataframe.zip
>>
>>         $ cat out.csv
>>         id,descriptio
>>         "1",This is my third row
>>         "2","this is
>>         my string
>>         "
>>         "3",This is my third row
>>
>>         $ ogrinfo out.csv -al
>>         INFO: Open of `out.csv'
>>         ????? using driver `CSV' successful.
>>
>>         Layer name: out
>>         Geometry: None
>>         Feature Count: 3
>>         Layer SRS WKT:
>>         (unknown)
>>         id: String (0.0)
>>         descriptio: String (0.0)
>>         OGRFeature(out):1
>>         ? id (String) = 1
>>         ? descriptio (String) = This is my third row
>>
>>         OGRFeature(out):2
>>         ? id (String) = 2
>>         ? descriptio (String) = this is
>>         my string
>>
>>
>>         OGRFeature(out):3
>>         ? id (String) = 3
>>         ? descriptio (String) = This is my third row
>>
>>         But in your example using /vsistdout/ and -lco
>>         CREATE_CSVT=YES is going to result in an invalid CSV file
>>         which will mix both the .csvt and .csv content
>>
>>         Even
>>
>>         Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit?:
>>>         Hello!
>>>
>>>         We're trying to convert a Shapefile into a CSV using ogr2ogr
>>>         and we're having some issues while dealing with some columns
>>>         that contain line breaks inside their values. If we have a
>>>         line with the following string, ogr2ogr detects that the
>>>         line break is a new line and it returns two lines.
>>>
>>>             "this is my \n value"
>>>
>>>
>>>         That's the command that we're executing:
>>>
>>>             ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>             /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs
>>>             EPSG:4326 -lco GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom
>>>             -lco CREATE_CSVT=YES > result.csv
>>>
>>>
>>>         Is this an expected behaviour, or is there any way to avoid
>>>         this?
>>>         Sharing an example Shapefile so that you can try to
>>>         reproduce that behaviour:
>>>         https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>
>>>         Thanks so much in advance,
>>>         Regards.
>>>
>>>         -- 
>>>         *Moises Calzado*
>>>
>>>         Support Engineer
>>>
>>>         +34671264286 | mcalzado at carto.com | CARTO
>>>         <https://www.carto.com/>
>>>
>>>         <https://spatial-data-science-conference.com/2023/london/>
>>>
>>>         _______________________________________________
>>>         gdal-dev mailing list
>>>         gdal-dev at lists.osgeo.org
>>>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>         -- 
>>         http://www.spatialys.com
>>         My software is free, but my time generally not.
>>
>>
>>
>>     -- 
>>     *Moises Calzado*
>>
>>     Support Engineer
>>
>>     +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>>     <https://spatial-data-science-conference.com/2023/london/>
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
>
> -- 
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/43fdbc32/attachment.htm>

From rob.hewy at gmail.com  Wed May  3 06:10:39 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Wed, 3 May 2023 06:10:39 -0700
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
Message-ID: <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>

The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with QGIS
And geopandas. The column name that I use in the CSV is usually geom and
WKT shows up in the CSVT file which seems to be a one line file that hints
at the data types in the CSV file.

I hope that makes sense.

CSVT
Integer, Integer,WKT

CSV
line_id,point_id,geom
1,1,"POINT(1000 1000)"

PRJ
EPSG:26910




On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi Even,
>
> Thanks so much for taking a look into that one!
>
> I have one doubt regarding the CSVT content, as we're not really using it,
> but it's required when using the GEOMETRY_NAME layer creation option, as
> can be checked in the CSV driver documentation:
>
>
>>    -
>>
>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry column.
>>    Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>
>> We really need this flag as we are processing files that contain
> geometries with different column names, and we always want the same
> geometry name in the generated output. Are we losing something when using
> that flag to avoid this problem?
> In my humble opinion, generating an invalid CSV when using the -lco
> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
> strings containing line breaks can't be quoted.
>
> Could you please shed some light on this?
>
> Looking forward to your reply,
> Regards.
>
> El mi?, 3 may 2023 a las 14:00, Even Rouault (<even.rouault at spatialys.com>)
> escribi?:
>
>> you didn't post to the list
>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>
>> Hi Even,
>>
>> Thanks so much for taking a look into that one!
>>
>> I have one doubt regarding the CSVT content, as we're not really using
>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>> as can be checked in the CSV driver documentation:
>>
>>
>>>    -
>>>
>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>
>>> We really need this flag as we are processing files that contain
>> geometries with different column names, and we always want the same
>> geometry name in the generated output. Are we losing something when using
>> that flag to avoid this problem?
>> In my humble opinion, generating an invalid CSV when using the -lco
>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>> strings containing line breaks can't be quoted.
>>
>> Could you please shed some light on this?
>>
>> Looking forward to your reply,
>> Regards.
>>
>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>> even.rouault at spatialys.com>) escribi?:
>>
>>> Moises,
>>>
>>> as far as I can see with your example, the CSV driver behaves "properly"
>>> in reading and writing of field values with line breaks.
>>>
>>> It follows the "Fields with embedded line breaks must be quoted" rule of
>>> https://en.wikipedia.org/wiki/Comma-separated_values
>>>
>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>
>>> $ cat out.csv
>>> id,descriptio
>>> "1",This is my third row
>>> "2","this is
>>> my string
>>> "
>>> "3",This is my third row
>>>
>>> $ ogrinfo out.csv -al
>>> INFO: Open of `out.csv'
>>>       using driver `CSV' successful.
>>>
>>> Layer name: out
>>> Geometry: None
>>> Feature Count: 3
>>> Layer SRS WKT:
>>> (unknown)
>>> id: String (0.0)
>>> descriptio: String (0.0)
>>> OGRFeature(out):1
>>>   id (String) = 1
>>>   descriptio (String) = This is my third row
>>>
>>> OGRFeature(out):2
>>>   id (String) = 2
>>>   descriptio (String) = this is
>>> my string
>>>
>>>
>>> OGRFeature(out):3
>>>   id (String) = 3
>>>   descriptio (String) = This is my third row
>>>
>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is going
>>> to result in an invalid CSV file which will mix both the .csvt and .csv
>>> content
>>>
>>> Even
>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>
>>> Hello!
>>>
>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and we're
>>> having some issues while dealing with some columns that contain line breaks
>>> inside their values. If we have a line with the following string, ogr2ogr
>>> detects that the line break is a new line and it returns two lines.
>>>
>>> "this is my \n value"
>>>
>>>
>>> That's the command that we're executing:
>>>
>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>
>>>
>>> Is this an expected behaviour, or is there any way to avoid this?
>>> Sharing an example Shapefile so that you can try to reproduce that
>>> behaviour:
>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>
>>> Thanks so much in advance,
>>> Regards.
>>>
>>> --
>>> *Moises Calzado*
>>>
>>> Support Engineer
>>>
>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>> <https://spatial-data-science-conference.com/2023/london/>
>>>
>>> _______________________________________________
>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
>>
>> --
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
> <https://spatial-data-science-conference.com/2023/london/>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/b0280c48/attachment-0001.htm>

From mcalzado at carto.com  Wed May  3 08:56:43 2023
From: mcalzado at carto.com (Moises Calzado)
Date: Wed, 3 May 2023 17:56:43 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
Message-ID: <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>

We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if with
that option we could use the GEOMETRY_NAME without using the
CREATE_CSVT=YES option.

Regarding emitting the .prj and .csvt in /vsistdout mode, that's why I'm
saying that there is an issue while generating the resultant CSV.
The way we see it is that when using the /vsistdout mode, the result is a
CSV file with the .prj information in the first line, and the .csvt in the
second line. We're dealing with the result deleting the first two lines and
using the rest of the content as a CSV, which should be equal to the result
obtained when using ogr2ogr without the CREATE_CSVT=YES option.
Probably we're losing something, but as we see it, the generated CSV should
be a valid one. Does that make sense?

Thanks so much for your help!

El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
escribi?:

> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with QGIS
> And geopandas. The column name that I use in the CSV is usually geom and
> WKT shows up in the CSVT file which seems to be a one line file that hints
> at the data types in the CSV file.
>
> I hope that makes sense.
>
> CSVT
> Integer, Integer,WKT
>
> CSV
> line_id,point_id,geom
> 1,1,"POINT(1000 1000)"
>
> PRJ
> EPSG:26910
>
>
>
>
> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi Even,
>>
>> Thanks so much for taking a look into that one!
>>
>> I have one doubt regarding the CSVT content, as we're not really using
>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>> as can be checked in the CSV driver documentation:
>>
>>
>>>    -
>>>
>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>
>>> We really need this flag as we are processing files that contain
>> geometries with different column names, and we always want the same
>> geometry name in the generated output. Are we losing something when using
>> that flag to avoid this problem?
>> In my humble opinion, generating an invalid CSV when using the -lco
>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>> strings containing line breaks can't be quoted.
>>
>> Could you please shed some light on this?
>>
>> Looking forward to your reply,
>> Regards.
>>
>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<even.rouault at spatialys.com>)
>> escribi?:
>>
>>> you didn't post to the list
>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>
>>> Hi Even,
>>>
>>> Thanks so much for taking a look into that one!
>>>
>>> I have one doubt regarding the CSVT content, as we're not really using
>>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>>> as can be checked in the CSV driver documentation:
>>>
>>>
>>>>    -
>>>>
>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>
>>>> We really need this flag as we are processing files that contain
>>> geometries with different column names, and we always want the same
>>> geometry name in the generated output. Are we losing something when using
>>> that flag to avoid this problem?
>>> In my humble opinion, generating an invalid CSV when using the -lco
>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>> strings containing line breaks can't be quoted.
>>>
>>> Could you please shed some light on this?
>>>
>>> Looking forward to your reply,
>>> Regards.
>>>
>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>> even.rouault at spatialys.com>) escribi?:
>>>
>>>> Moises,
>>>>
>>>> as far as I can see with your example, the CSV driver behaves
>>>> "properly" in reading and writing of field values with line breaks.
>>>>
>>>> It follows the "Fields with embedded line breaks must be quoted" rule
>>>> of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>
>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>
>>>> $ cat out.csv
>>>> id,descriptio
>>>> "1",This is my third row
>>>> "2","this is
>>>> my string
>>>> "
>>>> "3",This is my third row
>>>>
>>>> $ ogrinfo out.csv -al
>>>> INFO: Open of `out.csv'
>>>>       using driver `CSV' successful.
>>>>
>>>> Layer name: out
>>>> Geometry: None
>>>> Feature Count: 3
>>>> Layer SRS WKT:
>>>> (unknown)
>>>> id: String (0.0)
>>>> descriptio: String (0.0)
>>>> OGRFeature(out):1
>>>>   id (String) = 1
>>>>   descriptio (String) = This is my third row
>>>>
>>>> OGRFeature(out):2
>>>>   id (String) = 2
>>>>   descriptio (String) = this is
>>>> my string
>>>>
>>>>
>>>> OGRFeature(out):3
>>>>   id (String) = 3
>>>>   descriptio (String) = This is my third row
>>>>
>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is going
>>>> to result in an invalid CSV file which will mix both the .csvt and .csv
>>>> content
>>>>
>>>> Even
>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>
>>>> Hello!
>>>>
>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and we're
>>>> having some issues while dealing with some columns that contain line breaks
>>>> inside their values. If we have a line with the following string, ogr2ogr
>>>> detects that the line break is a new line and it returns two lines.
>>>>
>>>> "this is my \n value"
>>>>
>>>>
>>>> That's the command that we're executing:
>>>>
>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>
>>>>
>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>> Sharing an example Shapefile so that you can try to reproduce that
>>>> behaviour:
>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>
>>>> Thanks so much in advance,
>>>> Regards.
>>>>
>>>> --
>>>> *Moises Calzado*
>>>>
>>>> Support Engineer
>>>>
>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>> -- http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>>
>>>
>>> --
>>> *Moises Calzado*
>>>
>>> Support Engineer
>>>
>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>> <https://spatial-data-science-conference.com/2023/london/>
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
>>
>> --
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>> <https://spatial-data-science-conference.com/2023/london/>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
*Moises Calzado*

Support Engineer

+34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/fbe9b3da/attachment.htm>

From rob.hewy at gmail.com  Wed May  3 09:13:29 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Wed, 3 May 2023 09:13:29 -0700
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
Message-ID: <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>

Just to clarify, instead of getting three files you are getting one with
all the info: types, projection, data?

https://giswiki.hsr.ch/GeoCSV

On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if
> with that option we could use the GEOMETRY_NAME without using the
> CREATE_CSVT=YES option.
>
> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why I'm
> saying that there is an issue while generating the resultant CSV.
> The way we see it is that when using the /vsistdout mode, the result is a
> CSV file with the .prj information in the first line, and the .csvt in the
> second line. We're dealing with the result deleting the first two lines and
> using the rest of the content as a CSV, which should be equal to the result
> obtained when using ogr2ogr without the CREATE_CSVT=YES option.
> Probably we're losing something, but as we see it, the generated CSV
> should be a valid one. Does that make sense?
>
> Thanks so much for your help!
>
> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
> escribi?:
>
>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with QGIS
>> And geopandas. The column name that I use in the CSV is usually geom and
>> WKT shows up in the CSVT file which seems to be a one line file that hints
>> at the data types in the CSV file.
>>
>> I hope that makes sense.
>>
>> CSVT
>> Integer, Integer,WKT
>>
>> CSV
>> line_id,point_id,geom
>> 1,1,"POINT(1000 1000)"
>>
>> PRJ
>> EPSG:26910
>>
>>
>>
>>
>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> Hi Even,
>>>
>>> Thanks so much for taking a look into that one!
>>>
>>> I have one doubt regarding the CSVT content, as we're not really using
>>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>>> as can be checked in the CSV driver documentation:
>>>
>>>
>>>>    -
>>>>
>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>
>>>> We really need this flag as we are processing files that contain
>>> geometries with different column names, and we always want the same
>>> geometry name in the generated output. Are we losing something when using
>>> that flag to avoid this problem?
>>> In my humble opinion, generating an invalid CSV when using the -lco
>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>> strings containing line breaks can't be quoted.
>>>
>>> Could you please shed some light on this?
>>>
>>> Looking forward to your reply,
>>> Regards.
>>>
>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>> even.rouault at spatialys.com>) escribi?:
>>>
>>>> you didn't post to the list
>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>
>>>> Hi Even,
>>>>
>>>> Thanks so much for taking a look into that one!
>>>>
>>>> I have one doubt regarding the CSVT content, as we're not really using
>>>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>>>> as can be checked in the CSV driver documentation:
>>>>
>>>>
>>>>>    -
>>>>>
>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>
>>>>> We really need this flag as we are processing files that contain
>>>> geometries with different column names, and we always want the same
>>>> geometry name in the generated output. Are we losing something when using
>>>> that flag to avoid this problem?
>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>> strings containing line breaks can't be quoted.
>>>>
>>>> Could you please shed some light on this?
>>>>
>>>> Looking forward to your reply,
>>>> Regards.
>>>>
>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>> even.rouault at spatialys.com>) escribi?:
>>>>
>>>>> Moises,
>>>>>
>>>>> as far as I can see with your example, the CSV driver behaves
>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>
>>>>> It follows the "Fields with embedded line breaks must be quoted" rule
>>>>> of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>
>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>
>>>>> $ cat out.csv
>>>>> id,descriptio
>>>>> "1",This is my third row
>>>>> "2","this is
>>>>> my string
>>>>> "
>>>>> "3",This is my third row
>>>>>
>>>>> $ ogrinfo out.csv -al
>>>>> INFO: Open of `out.csv'
>>>>>       using driver `CSV' successful.
>>>>>
>>>>> Layer name: out
>>>>> Geometry: None
>>>>> Feature Count: 3
>>>>> Layer SRS WKT:
>>>>> (unknown)
>>>>> id: String (0.0)
>>>>> descriptio: String (0.0)
>>>>> OGRFeature(out):1
>>>>>   id (String) = 1
>>>>>   descriptio (String) = This is my third row
>>>>>
>>>>> OGRFeature(out):2
>>>>>   id (String) = 2
>>>>>   descriptio (String) = this is
>>>>> my string
>>>>>
>>>>>
>>>>> OGRFeature(out):3
>>>>>   id (String) = 3
>>>>>   descriptio (String) = This is my third row
>>>>>
>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is
>>>>> going to result in an invalid CSV file which will mix both the .csvt and
>>>>> .csv content
>>>>>
>>>>> Even
>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>
>>>>> Hello!
>>>>>
>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and we're
>>>>> having some issues while dealing with some columns that contain line breaks
>>>>> inside their values. If we have a line with the following string, ogr2ogr
>>>>> detects that the line break is a new line and it returns two lines.
>>>>>
>>>>> "this is my \n value"
>>>>>
>>>>>
>>>>> That's the command that we're executing:
>>>>>
>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>
>>>>>
>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>> Sharing an example Shapefile so that you can try to reproduce that
>>>>> behaviour:
>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>
>>>>> Thanks so much in advance,
>>>>> Regards.
>>>>>
>>>>> --
>>>>> *Moises Calzado*
>>>>>
>>>>> Support Engineer
>>>>>
>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>>> -- http://www.spatialys.com
>>>>> My software is free, but my time generally not.
>>>>>
>>>>>
>>>>
>>>> --
>>>> *Moises Calzado*
>>>>
>>>> Support Engineer
>>>>
>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>
>>>> -- http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>>
>>>
>>> --
>>> *Moises Calzado*
>>>
>>> Support Engineer
>>>
>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>> <https://spatial-data-science-conference.com/2023/london/>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
> <https://spatial-data-science-conference.com/2023/london/>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/c4624796/attachment-0001.htm>

From mcalzado at carto.com  Wed May  3 09:15:43 2023
From: mcalzado at carto.com (Moises Calzado)
Date: Wed, 3 May 2023 18:15:43 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
Message-ID: <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>

Hi Robert,

Yes, we're getting one with all the info!

El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
escribi?:

> Just to clarify, instead of getting three files you are getting one with
> all the info: types, projection, data?
>
> https://giswiki.hsr.ch/GeoCSV
>
> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if
>> with that option we could use the GEOMETRY_NAME without using the
>> CREATE_CSVT=YES option.
>>
>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why I'm
>> saying that there is an issue while generating the resultant CSV.
>> The way we see it is that when using the /vsistdout mode, the result is a
>> CSV file with the .prj information in the first line, and the .csvt in the
>> second line. We're dealing with the result deleting the first two lines and
>> using the rest of the content as a CSV, which should be equal to the result
>> obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>> Probably we're losing something, but as we see it, the generated CSV
>> should be a valid one. Does that make sense?
>>
>> Thanks so much for your help!
>>
>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>> escribi?:
>>
>>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with QGIS
>>> And geopandas. The column name that I use in the CSV is usually geom and
>>> WKT shows up in the CSVT file which seems to be a one line file that hints
>>> at the data types in the CSV file.
>>>
>>> I hope that makes sense.
>>>
>>> CSVT
>>> Integer, Integer,WKT
>>>
>>> CSV
>>> line_id,point_id,geom
>>> 1,1,"POINT(1000 1000)"
>>>
>>> PRJ
>>> EPSG:26910
>>>
>>>
>>>
>>>
>>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>>> gdal-dev at lists.osgeo.org> wrote:
>>>
>>>> Hi Even,
>>>>
>>>> Thanks so much for taking a look into that one!
>>>>
>>>> I have one doubt regarding the CSVT content, as we're not really using
>>>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>>>> as can be checked in the CSV driver documentation:
>>>>
>>>>
>>>>>    -
>>>>>
>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>
>>>>> We really need this flag as we are processing files that contain
>>>> geometries with different column names, and we always want the same
>>>> geometry name in the generated output. Are we losing something when using
>>>> that flag to avoid this problem?
>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>> strings containing line breaks can't be quoted.
>>>>
>>>> Could you please shed some light on this?
>>>>
>>>> Looking forward to your reply,
>>>> Regards.
>>>>
>>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>>> even.rouault at spatialys.com>) escribi?:
>>>>
>>>>> you didn't post to the list
>>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>>
>>>>> Hi Even,
>>>>>
>>>>> Thanks so much for taking a look into that one!
>>>>>
>>>>> I have one doubt regarding the CSVT content, as we're not really using
>>>>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>>>>> as can be checked in the CSV driver documentation:
>>>>>
>>>>>
>>>>>>    -
>>>>>>
>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>
>>>>>> We really need this flag as we are processing files that contain
>>>>> geometries with different column names, and we always want the same
>>>>> geometry name in the generated output. Are we losing something when using
>>>>> that flag to avoid this problem?
>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>> strings containing line breaks can't be quoted.
>>>>>
>>>>> Could you please shed some light on this?
>>>>>
>>>>> Looking forward to your reply,
>>>>> Regards.
>>>>>
>>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>
>>>>>> Moises,
>>>>>>
>>>>>> as far as I can see with your example, the CSV driver behaves
>>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>>
>>>>>> It follows the "Fields with embedded line breaks must be quoted" rule
>>>>>> of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>>
>>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>>
>>>>>> $ cat out.csv
>>>>>> id,descriptio
>>>>>> "1",This is my third row
>>>>>> "2","this is
>>>>>> my string
>>>>>> "
>>>>>> "3",This is my third row
>>>>>>
>>>>>> $ ogrinfo out.csv -al
>>>>>> INFO: Open of `out.csv'
>>>>>>       using driver `CSV' successful.
>>>>>>
>>>>>> Layer name: out
>>>>>> Geometry: None
>>>>>> Feature Count: 3
>>>>>> Layer SRS WKT:
>>>>>> (unknown)
>>>>>> id: String (0.0)
>>>>>> descriptio: String (0.0)
>>>>>> OGRFeature(out):1
>>>>>>   id (String) = 1
>>>>>>   descriptio (String) = This is my third row
>>>>>>
>>>>>> OGRFeature(out):2
>>>>>>   id (String) = 2
>>>>>>   descriptio (String) = this is
>>>>>> my string
>>>>>>
>>>>>>
>>>>>> OGRFeature(out):3
>>>>>>   id (String) = 3
>>>>>>   descriptio (String) = This is my third row
>>>>>>
>>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is
>>>>>> going to result in an invalid CSV file which will mix both the .csvt and
>>>>>> .csv content
>>>>>>
>>>>>> Even
>>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>>
>>>>>> Hello!
>>>>>>
>>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and
>>>>>> we're having some issues while dealing with some columns that contain line
>>>>>> breaks inside their values. If we have a line with the following string,
>>>>>> ogr2ogr detects that the line break is a new line and it returns two lines.
>>>>>>
>>>>>> "this is my \n value"
>>>>>>
>>>>>>
>>>>>> That's the command that we're executing:
>>>>>>
>>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>>
>>>>>>
>>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>>> Sharing an example Shapefile so that you can try to reproduce that
>>>>>> behaviour:
>>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>>
>>>>>> Thanks so much in advance,
>>>>>> Regards.
>>>>>>
>>>>>> --
>>>>>> *Moises Calzado*
>>>>>>
>>>>>> Support Engineer
>>>>>>
>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>
>>>>>> -- http://www.spatialys.com
>>>>>> My software is free, but my time generally not.
>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> *Moises Calzado*
>>>>>
>>>>> Support Engineer
>>>>>
>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>
>>>>> -- http://www.spatialys.com
>>>>> My software is free, but my time generally not.
>>>>>
>>>>>
>>>>
>>>> --
>>>> *Moises Calzado*
>>>>
>>>> Support Engineer
>>>>
>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
>>
>> --
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>> <https://spatial-data-science-conference.com/2023/london/>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
*Moises Calzado*

Support Engineer

+34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/25f46be7/attachment-0001.htm>

From rob.hewy at gmail.com  Wed May  3 09:38:08 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Wed, 3 May 2023 09:38:08 -0700
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
Message-ID: <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>

Hi,

Not to start a controversy but it feels like the standard hints at three
files. Did the standard change?

If it is three files which works for me in QGIS and geopandas i.e. data
lands where it is suppose to, then more layer creations options are needed
to handle the SRID/CRS

CREATE_PRJ=YES/NO
or -t_srs and/or -s_srs triggers the dot-prj file being created.

Just saying ?.

In the meantime would a short python script help parse the one file into
three?


On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi Robert,
>
> Yes, we're getting one with all the info!
>
> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
> escribi?:
>
>> Just to clarify, instead of getting three files you are getting one with
>> all the info: types, projection, data?
>>
>> https://giswiki.hsr.ch/GeoCSV
>>
>> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if
>>> with that option we could use the GEOMETRY_NAME without using the
>>> CREATE_CSVT=YES option.
>>>
>>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why I'm
>>> saying that there is an issue while generating the resultant CSV.
>>> The way we see it is that when using the /vsistdout mode, the result is
>>> a CSV file with the .prj information in the first line, and the .csvt in
>>> the second line. We're dealing with the result deleting the first two lines
>>> and using the rest of the content as a CSV, which should be equal to the
>>> result obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>>> Probably we're losing something, but as we see it, the generated CSV
>>> should be a valid one. Does that make sense?
>>>
>>> Thanks so much for your help!
>>>
>>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>>> escribi?:
>>>
>>>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with
>>>> QGIS And geopandas. The column name that I use in the CSV is usually geom
>>>> and WKT shows up in the CSVT file which seems to be a one line file that
>>>> hints at the data types in the CSV file.
>>>>
>>>> I hope that makes sense.
>>>>
>>>> CSVT
>>>> Integer, Integer,WKT
>>>>
>>>> CSV
>>>> line_id,point_id,geom
>>>> 1,1,"POINT(1000 1000)"
>>>>
>>>> PRJ
>>>> EPSG:26910
>>>>
>>>>
>>>>
>>>>
>>>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>
>>>>> Hi Even,
>>>>>
>>>>> Thanks so much for taking a look into that one!
>>>>>
>>>>> I have one doubt regarding the CSVT content, as we're not really using
>>>>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>>>>> as can be checked in the CSV driver documentation:
>>>>>
>>>>>
>>>>>>    -
>>>>>>
>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>
>>>>>> We really need this flag as we are processing files that contain
>>>>> geometries with different column names, and we always want the same
>>>>> geometry name in the generated output. Are we losing something when using
>>>>> that flag to avoid this problem?
>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>> strings containing line breaks can't be quoted.
>>>>>
>>>>> Could you please shed some light on this?
>>>>>
>>>>> Looking forward to your reply,
>>>>> Regards.
>>>>>
>>>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>
>>>>>> you didn't post to the list
>>>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>>>
>>>>>> Hi Even,
>>>>>>
>>>>>> Thanks so much for taking a look into that one!
>>>>>>
>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>
>>>>>>
>>>>>>>    -
>>>>>>>
>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>
>>>>>>> We really need this flag as we are processing files that contain
>>>>>> geometries with different column names, and we always want the same
>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>> that flag to avoid this problem?
>>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>> strings containing line breaks can't be quoted.
>>>>>>
>>>>>> Could you please shed some light on this?
>>>>>>
>>>>>> Looking forward to your reply,
>>>>>> Regards.
>>>>>>
>>>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>
>>>>>>> Moises,
>>>>>>>
>>>>>>> as far as I can see with your example, the CSV driver behaves
>>>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>>>
>>>>>>> It follows the "Fields with embedded line breaks must be quoted"
>>>>>>> rule of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>>>
>>>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>>>
>>>>>>> $ cat out.csv
>>>>>>> id,descriptio
>>>>>>> "1",This is my third row
>>>>>>> "2","this is
>>>>>>> my string
>>>>>>> "
>>>>>>> "3",This is my third row
>>>>>>>
>>>>>>> $ ogrinfo out.csv -al
>>>>>>> INFO: Open of `out.csv'
>>>>>>>       using driver `CSV' successful.
>>>>>>>
>>>>>>> Layer name: out
>>>>>>> Geometry: None
>>>>>>> Feature Count: 3
>>>>>>> Layer SRS WKT:
>>>>>>> (unknown)
>>>>>>> id: String (0.0)
>>>>>>> descriptio: String (0.0)
>>>>>>> OGRFeature(out):1
>>>>>>>   id (String) = 1
>>>>>>>   descriptio (String) = This is my third row
>>>>>>>
>>>>>>> OGRFeature(out):2
>>>>>>>   id (String) = 2
>>>>>>>   descriptio (String) = this is
>>>>>>> my string
>>>>>>>
>>>>>>>
>>>>>>> OGRFeature(out):3
>>>>>>>   id (String) = 3
>>>>>>>   descriptio (String) = This is my third row
>>>>>>>
>>>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is
>>>>>>> going to result in an invalid CSV file which will mix both the .csvt and
>>>>>>> .csv content
>>>>>>>
>>>>>>> Even
>>>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>>>
>>>>>>> Hello!
>>>>>>>
>>>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and
>>>>>>> we're having some issues while dealing with some columns that contain line
>>>>>>> breaks inside their values. If we have a line with the following string,
>>>>>>> ogr2ogr detects that the line break is a new line and it returns two lines.
>>>>>>>
>>>>>>> "this is my \n value"
>>>>>>>
>>>>>>>
>>>>>>> That's the command that we're executing:
>>>>>>>
>>>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>>>
>>>>>>>
>>>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>>>> Sharing an example Shapefile so that you can try to reproduce that
>>>>>>> behaviour:
>>>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>>>
>>>>>>> Thanks so much in advance,
>>>>>>> Regards.
>>>>>>>
>>>>>>> --
>>>>>>> *Moises Calzado*
>>>>>>>
>>>>>>> Support Engineer
>>>>>>>
>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>
>>>>>>> -- http://www.spatialys.com
>>>>>>> My software is free, but my time generally not.
>>>>>>>
>>>>>>>
>>>>>>
>>>>>> --
>>>>>> *Moises Calzado*
>>>>>>
>>>>>> Support Engineer
>>>>>>
>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>
>>>>>> -- http://www.spatialys.com
>>>>>> My software is free, but my time generally not.
>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> *Moises Calzado*
>>>>>
>>>>> Support Engineer
>>>>>
>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>
>>>
>>> --
>>> *Moises Calzado*
>>>
>>> Support Engineer
>>>
>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>> <https://spatial-data-science-conference.com/2023/london/>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
> <https://spatial-data-science-conference.com/2023/london/>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/d27bbaa0/attachment-0001.htm>

From rob.hewy at gmail.com  Wed May  3 12:04:55 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Wed, 3 May 2023 12:04:55 -0700
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
Message-ID: <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>

Hi,

I just tested with : GDAL 3.6.4, released 2023/04/17

Using the ogr2ogr as follows:
ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
I get three files but no geometry

ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco GEOMETRY=AS_WKT
I get three file with the geometry as WKT with the column name WKT

*WKT*,id,poi_name,poi_types
"POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
"POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"

ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
I get three file with the geometry as WKT but the column called  *geom*
*geom*,id,poi_name,poi_types
"POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
"POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"

What does
*ogr2ogr --version *
report back



On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com> wrote:

> Hi,
>
> Not to start a controversy but it feels like the standard hints at three
> files. Did the standard change?
>
> If it is three files which works for me in QGIS and geopandas i.e. data
> lands where it is suppose to, then more layer creations options are needed
> to handle the SRID/CRS
>
> CREATE_PRJ=YES/NO
> or -t_srs and/or -s_srs triggers the dot-prj file being created.
>
> Just saying ?.
>
> In the meantime would a short python script help parse the one file into
> three?
>
>
> On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi Robert,
>>
>> Yes, we're getting one with all the info!
>>
>> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
>> escribi?:
>>
>>> Just to clarify, instead of getting three files you are getting one with
>>> all the info: types, projection, data?
>>>
>>> https://giswiki.hsr.ch/GeoCSV
>>>
>>> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
>>> gdal-dev at lists.osgeo.org> wrote:
>>>
>>>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if
>>>> with that option we could use the GEOMETRY_NAME without using the
>>>> CREATE_CSVT=YES option.
>>>>
>>>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why
>>>> I'm saying that there is an issue while generating the resultant CSV.
>>>> The way we see it is that when using the /vsistdout mode, the result is
>>>> a CSV file with the .prj information in the first line, and the .csvt in
>>>> the second line. We're dealing with the result deleting the first two lines
>>>> and using the rest of the content as a CSV, which should be equal to the
>>>> result obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>>>> Probably we're losing something, but as we see it, the generated CSV
>>>> should be a valid one. Does that make sense?
>>>>
>>>> Thanks so much for your help!
>>>>
>>>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>>>> escribi?:
>>>>
>>>>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with
>>>>> QGIS And geopandas. The column name that I use in the CSV is usually geom
>>>>> and WKT shows up in the CSVT file which seems to be a one line file that
>>>>> hints at the data types in the CSV file.
>>>>>
>>>>> I hope that makes sense.
>>>>>
>>>>> CSVT
>>>>> Integer, Integer,WKT
>>>>>
>>>>> CSV
>>>>> line_id,point_id,geom
>>>>> 1,1,"POINT(1000 1000)"
>>>>>
>>>>> PRJ
>>>>> EPSG:26910
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>
>>>>>> Hi Even,
>>>>>>
>>>>>> Thanks so much for taking a look into that one!
>>>>>>
>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>
>>>>>>
>>>>>>>    -
>>>>>>>
>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>
>>>>>>> We really need this flag as we are processing files that contain
>>>>>> geometries with different column names, and we always want the same
>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>> that flag to avoid this problem?
>>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>> strings containing line breaks can't be quoted.
>>>>>>
>>>>>> Could you please shed some light on this?
>>>>>>
>>>>>> Looking forward to your reply,
>>>>>> Regards.
>>>>>>
>>>>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>
>>>>>>> you didn't post to the list
>>>>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>>>>
>>>>>>> Hi Even,
>>>>>>>
>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>
>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>
>>>>>>>
>>>>>>>>    -
>>>>>>>>
>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>
>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>> geometries with different column names, and we always want the same
>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>> that flag to avoid this problem?
>>>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>
>>>>>>> Could you please shed some light on this?
>>>>>>>
>>>>>>> Looking forward to your reply,
>>>>>>> Regards.
>>>>>>>
>>>>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>
>>>>>>>> Moises,
>>>>>>>>
>>>>>>>> as far as I can see with your example, the CSV driver behaves
>>>>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>>>>
>>>>>>>> It follows the "Fields with embedded line breaks must be quoted"
>>>>>>>> rule of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>>>>
>>>>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>>>>
>>>>>>>> $ cat out.csv
>>>>>>>> id,descriptio
>>>>>>>> "1",This is my third row
>>>>>>>> "2","this is
>>>>>>>> my string
>>>>>>>> "
>>>>>>>> "3",This is my third row
>>>>>>>>
>>>>>>>> $ ogrinfo out.csv -al
>>>>>>>> INFO: Open of `out.csv'
>>>>>>>>       using driver `CSV' successful.
>>>>>>>>
>>>>>>>> Layer name: out
>>>>>>>> Geometry: None
>>>>>>>> Feature Count: 3
>>>>>>>> Layer SRS WKT:
>>>>>>>> (unknown)
>>>>>>>> id: String (0.0)
>>>>>>>> descriptio: String (0.0)
>>>>>>>> OGRFeature(out):1
>>>>>>>>   id (String) = 1
>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>
>>>>>>>> OGRFeature(out):2
>>>>>>>>   id (String) = 2
>>>>>>>>   descriptio (String) = this is
>>>>>>>> my string
>>>>>>>>
>>>>>>>>
>>>>>>>> OGRFeature(out):3
>>>>>>>>   id (String) = 3
>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>
>>>>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is
>>>>>>>> going to result in an invalid CSV file which will mix both the .csvt and
>>>>>>>> .csv content
>>>>>>>>
>>>>>>>> Even
>>>>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>>>>
>>>>>>>> Hello!
>>>>>>>>
>>>>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and
>>>>>>>> we're having some issues while dealing with some columns that contain line
>>>>>>>> breaks inside their values. If we have a line with the following string,
>>>>>>>> ogr2ogr detects that the line break is a new line and it returns two lines.
>>>>>>>>
>>>>>>>> "this is my \n value"
>>>>>>>>
>>>>>>>>
>>>>>>>> That's the command that we're executing:
>>>>>>>>
>>>>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>>>>
>>>>>>>>
>>>>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>>>>> Sharing an example Shapefile so that you can try to reproduce that
>>>>>>>> behaviour:
>>>>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>>>>
>>>>>>>> Thanks so much in advance,
>>>>>>>> Regards.
>>>>>>>>
>>>>>>>> --
>>>>>>>> *Moises Calzado*
>>>>>>>>
>>>>>>>> Support Engineer
>>>>>>>>
>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>
>>>>>>>> -- http://www.spatialys.com
>>>>>>>> My software is free, but my time generally not.
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> *Moises Calzado*
>>>>>>>
>>>>>>> Support Engineer
>>>>>>>
>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>
>>>>>>> -- http://www.spatialys.com
>>>>>>> My software is free, but my time generally not.
>>>>>>>
>>>>>>>
>>>>>>
>>>>>> --
>>>>>> *Moises Calzado*
>>>>>>
>>>>>> Support Engineer
>>>>>>
>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing list
>>>>>> gdal-dev at lists.osgeo.org
>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>>
>>>>
>>>> --
>>>> *Moises Calzado*
>>>>
>>>> Support Engineer
>>>>
>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
>>
>> --
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>> <https://spatial-data-science-conference.com/2023/london/>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230503/f566b7d8/attachment-0001.htm>

From joana at doublebyte.net  Thu May  4 03:57:46 2023
From: joana at doublebyte.net (Joana Simoes)
Date: Thu, 4 May 2023 11:57:46 +0100
Subject: [gdal-dev] Upcoming Tiling Interfaces Code Sprint
Message-ID: <4cf5b851-3f92-875f-479c-b98e1c2a3923@doublebyte.net>

*Hello,*

*

The Tiling Interfaces Code Sprint, hosted by the Open Geospatial 
Consortium (OGC) and the National Geospatial-Intelligence Agency (NGA)? 
will run from the 12th to the 14th of June at the Moonshot Labs 
<https://www.nga.mil/resources/Moonshot_Labs.html> (St. Louis, MO, US)


A Code Sprint is a three day hybrid event, where dozens of developers 
from around the world come together to code and share their ideas 
regarding sharing geospatial information. This code sprint in 
particular, will focus on the following standards: OGC API - Tiles, OGC 
API - Maps, Changesets API, Vector Tiles Extension to GeoPackage, 
Variable Width Tile Matrix, OGC Web Map Tile Service (WMTS). Some of 
these standards already have some support on GDAL, although they could 
benefit from testing/reviews/extensions.

*

*You can find more information, including a registration link in the 
code sprint website: https://developer.ogc.org/sprints/21/ 
<https://developer.ogc.org/sprints/21/>
*

*If you plan to attend in-person, be aware that in-person registrations 
close very soon (on the 10th of May).
*

*Hope to see you at the code sprint,*

*All the Best,*

*Joana*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230504/dc0076a4/attachment.htm>

From mcalzado at carto.com  Thu May  4 04:58:28 2023
From: mcalzado at carto.com (Moises Calzado)
Date: Thu, 4 May 2023 13:58:28 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
Message-ID: <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>

Hi Robert!

I think that we're losing a bit the main issue that we reported, as in fact
the problem is related with line breaks in the output generated while using
/vsistdout and the CREATE_CSVT=YES option.

Even pointed out that avoiding that flag it works as expected, but when
it's used the generated output is not okay as the "Fields with embedded
line breaks must be quoted" rule is not followed.
IMHO although the generated output is not a CSV itself, we should be able
to delete the first two lines (projection info and types) and deal with the
rest of the content as a CSV.

What we're doing is streaming the output of the /vsistdout driver to
another process that perform some steps with the resultant CSV. In all
cases it works correctly, as the output of the ogr2ogr execution is a valid
CSV when deleting the first two lines, but in the case reported in my first
email it's not.
The CREATE_CSVT=YES option is mandatory for us as for the moment, it's
requires to use the GEOMETRY_NAME=*geom *one, so we don't have any
workaround.

Just wanted to confirm if that's expected for you (generating an output
that it's not a valid CSV in the end)!

El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com>)
escribi?:

> Hi,
>
> I just tested with : GDAL 3.6.4, released 2023/04/17
>
> Using the ogr2ogr as follows:
> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
> I get three files but no geometry
>
> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
> GEOMETRY=AS_WKT
> I get three file with the geometry as WKT with the column name WKT
>
> *WKT*,id,poi_name,poi_types
> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>
> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
> I get three file with the geometry as WKT but the column called  *geom*
> *geom*,id,poi_name,poi_types
> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>
> What does
> *ogr2ogr --version *
> report back
>
>
>
> On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com> wrote:
>
>> Hi,
>>
>> Not to start a controversy but it feels like the standard hints at three
>> files. Did the standard change?
>>
>> If it is three files which works for me in QGIS and geopandas i.e. data
>> lands where it is suppose to, then more layer creations options are needed
>> to handle the SRID/CRS
>>
>> CREATE_PRJ=YES/NO
>> or -t_srs and/or -s_srs triggers the dot-prj file being created.
>>
>> Just saying ?.
>>
>> In the meantime would a short python script help parse the one file into
>> three?
>>
>>
>> On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> Hi Robert,
>>>
>>> Yes, we're getting one with all the info!
>>>
>>> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
>>> escribi?:
>>>
>>>> Just to clarify, instead of getting three files you are getting one
>>>> with all the info: types, projection, data?
>>>>
>>>> https://giswiki.hsr.ch/GeoCSV
>>>>
>>>> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>
>>>>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if
>>>>> with that option we could use the GEOMETRY_NAME without using the
>>>>> CREATE_CSVT=YES option.
>>>>>
>>>>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why
>>>>> I'm saying that there is an issue while generating the resultant CSV.
>>>>> The way we see it is that when using the /vsistdout mode, the result
>>>>> is a CSV file with the .prj information in the first line, and the .csvt in
>>>>> the second line. We're dealing with the result deleting the first two lines
>>>>> and using the rest of the content as a CSV, which should be equal to the
>>>>> result obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>>>>> Probably we're losing something, but as we see it, the generated CSV
>>>>> should be a valid one. Does that make sense?
>>>>>
>>>>> Thanks so much for your help!
>>>>>
>>>>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>>>>> escribi?:
>>>>>
>>>>>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with
>>>>>> QGIS And geopandas. The column name that I use in the CSV is usually geom
>>>>>> and WKT shows up in the CSVT file which seems to be a one line file that
>>>>>> hints at the data types in the CSV file.
>>>>>>
>>>>>> I hope that makes sense.
>>>>>>
>>>>>> CSVT
>>>>>> Integer, Integer,WKT
>>>>>>
>>>>>> CSV
>>>>>> line_id,point_id,geom
>>>>>> 1,1,"POINT(1000 1000)"
>>>>>>
>>>>>> PRJ
>>>>>> EPSG:26910
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>>
>>>>>>> Hi Even,
>>>>>>>
>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>
>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>
>>>>>>>
>>>>>>>>    -
>>>>>>>>
>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>
>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>> geometries with different column names, and we always want the same
>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>> that flag to avoid this problem?
>>>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>
>>>>>>> Could you please shed some light on this?
>>>>>>>
>>>>>>> Looking forward to your reply,
>>>>>>> Regards.
>>>>>>>
>>>>>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>
>>>>>>>> you didn't post to the list
>>>>>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>>>>>
>>>>>>>> Hi Even,
>>>>>>>>
>>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>>
>>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>>
>>>>>>>>
>>>>>>>>>    -
>>>>>>>>>
>>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>>
>>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>>> geometries with different column names, and we always want the same
>>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>>> that flag to avoid this problem?
>>>>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>>
>>>>>>>> Could you please shed some light on this?
>>>>>>>>
>>>>>>>> Looking forward to your reply,
>>>>>>>> Regards.
>>>>>>>>
>>>>>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>>
>>>>>>>>> Moises,
>>>>>>>>>
>>>>>>>>> as far as I can see with your example, the CSV driver behaves
>>>>>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>>>>>
>>>>>>>>> It follows the "Fields with embedded line breaks must be quoted"
>>>>>>>>> rule of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>>>>>
>>>>>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>>>>>
>>>>>>>>> $ cat out.csv
>>>>>>>>> id,descriptio
>>>>>>>>> "1",This is my third row
>>>>>>>>> "2","this is
>>>>>>>>> my string
>>>>>>>>> "
>>>>>>>>> "3",This is my third row
>>>>>>>>>
>>>>>>>>> $ ogrinfo out.csv -al
>>>>>>>>> INFO: Open of `out.csv'
>>>>>>>>>       using driver `CSV' successful.
>>>>>>>>>
>>>>>>>>> Layer name: out
>>>>>>>>> Geometry: None
>>>>>>>>> Feature Count: 3
>>>>>>>>> Layer SRS WKT:
>>>>>>>>> (unknown)
>>>>>>>>> id: String (0.0)
>>>>>>>>> descriptio: String (0.0)
>>>>>>>>> OGRFeature(out):1
>>>>>>>>>   id (String) = 1
>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>
>>>>>>>>> OGRFeature(out):2
>>>>>>>>>   id (String) = 2
>>>>>>>>>   descriptio (String) = this is
>>>>>>>>> my string
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> OGRFeature(out):3
>>>>>>>>>   id (String) = 3
>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>
>>>>>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is
>>>>>>>>> going to result in an invalid CSV file which will mix both the .csvt and
>>>>>>>>> .csv content
>>>>>>>>>
>>>>>>>>> Even
>>>>>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>>>>>
>>>>>>>>> Hello!
>>>>>>>>>
>>>>>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and
>>>>>>>>> we're having some issues while dealing with some columns that contain line
>>>>>>>>> breaks inside their values. If we have a line with the following string,
>>>>>>>>> ogr2ogr detects that the line break is a new line and it returns two lines.
>>>>>>>>>
>>>>>>>>> "this is my \n value"
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> That's the command that we're executing:
>>>>>>>>>
>>>>>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>>>>>> Sharing an example Shapefile so that you can try to reproduce that
>>>>>>>>> behaviour:
>>>>>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>>>>>
>>>>>>>>> Thanks so much in advance,
>>>>>>>>> Regards.
>>>>>>>>>
>>>>>>>>> --
>>>>>>>>> *Moises Calzado*
>>>>>>>>>
>>>>>>>>> Support Engineer
>>>>>>>>>
>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>>
>>>>>>>>> -- http://www.spatialys.com
>>>>>>>>> My software is free, but my time generally not.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> --
>>>>>>>> *Moises Calzado*
>>>>>>>>
>>>>>>>> Support Engineer
>>>>>>>>
>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>
>>>>>>>> -- http://www.spatialys.com
>>>>>>>> My software is free, but my time generally not.
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> *Moises Calzado*
>>>>>>>
>>>>>>> Support Engineer
>>>>>>>
>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>> _______________________________________________
>>>>>>> gdal-dev mailing list
>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing list
>>>>>> gdal-dev at lists.osgeo.org
>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> *Moises Calzado*
>>>>>
>>>>> Support Engineer
>>>>>
>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>
>>>
>>> --
>>> *Moises Calzado*
>>>
>>> Support Engineer
>>>
>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>> <https://spatial-data-science-conference.com/2023/london/>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
*Moises Calzado*

Support Engineer

+34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230504/ffcfc59f/attachment-0001.htm>

From rob.hewy at gmail.com  Thu May  4 06:07:26 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Thu, 4 May 2023 06:07:26 -0700
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
 <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
Message-ID: <CAG_Q50QPXcDfb3wFqm6qQrsTjkc8qkWKvg-ujViVRv_kYU7h4w@mail.gmail.com>

Hi,

Traced back through the thread and found your sample data set and was able
to convert it to a CSV file that both Calc, Excel and QGIS loaded without
issue.

The command I used the three files
ogr2ogr -f CSV df.csv dataframe.shp -lco CREATE_CSVT=YES -lco
GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom

The redirect > result.csv is potentially why you have one, all out (3
files) put into one file.

The column name in the csv file is geom and not WKT.

I will try to post some images.

The command was run on a windows 10 Laptop.






On Thu, May 4, 2023 at 4:59?AM Moises Calzado via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi Robert!
>
> I think that we're losing a bit the main issue that we reported, as in
> fact the problem is related with line breaks in the output generated while
> using /vsistdout and the CREATE_CSVT=YES option.
>
> Even pointed out that avoiding that flag it works as expected, but when
> it's used the generated output is not okay as the "Fields with embedded
> line breaks must be quoted" rule is not followed.
> IMHO although the generated output is not a CSV itself, we should be able
> to delete the first two lines (projection info and types) and deal with the
> rest of the content as a CSV.
>
> What we're doing is streaming the output of the /vsistdout driver to
> another process that perform some steps with the resultant CSV. In all
> cases it works correctly, as the output of the ogr2ogr execution is a valid
> CSV when deleting the first two lines, but in the case reported in my first
> email it's not.
> The CREATE_CSVT=YES option is mandatory for us as for the moment, it's
> requires to use the GEOMETRY_NAME=*geom *one, so we don't have any
> workaround.
>
> Just wanted to confirm if that's expected for you (generating an output
> that it's not a valid CSV in the end)!
>
> El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com>)
> escribi?:
>
>> Hi,
>>
>> I just tested with : GDAL 3.6.4, released 2023/04/17
>>
>> Using the ogr2ogr as follows:
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
>> I get three files but no geometry
>>
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>> GEOMETRY=AS_WKT
>> I get three file with the geometry as WKT with the column name WKT
>>
>> *WKT*,id,poi_name,poi_types
>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>>
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
>> I get three file with the geometry as WKT but the column called  *geom*
>> *geom*,id,poi_name,poi_types
>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>>
>> What does
>> *ogr2ogr --version *
>> report back
>>
>>
>>
>> On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com> wrote:
>>
>>> Hi,
>>>
>>> Not to start a controversy but it feels like the standard hints at three
>>> files. Did the standard change?
>>>
>>> If it is three files which works for me in QGIS and geopandas i.e. data
>>> lands where it is suppose to, then more layer creations options are needed
>>> to handle the SRID/CRS
>>>
>>> CREATE_PRJ=YES/NO
>>> or -t_srs and/or -s_srs triggers the dot-prj file being created.
>>>
>>> Just saying ?.
>>>
>>> In the meantime would a short python script help parse the one file into
>>> three?
>>>
>>>
>>> On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
>>> gdal-dev at lists.osgeo.org> wrote:
>>>
>>>> Hi Robert,
>>>>
>>>> Yes, we're getting one with all the info!
>>>>
>>>> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
>>>> escribi?:
>>>>
>>>>> Just to clarify, instead of getting three files you are getting one
>>>>> with all the info: types, projection, data?
>>>>>
>>>>> https://giswiki.hsr.ch/GeoCSV
>>>>>
>>>>> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>
>>>>>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great
>>>>>> if with that option we could use the GEOMETRY_NAME without using the
>>>>>> CREATE_CSVT=YES option.
>>>>>>
>>>>>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why
>>>>>> I'm saying that there is an issue while generating the resultant CSV.
>>>>>> The way we see it is that when using the /vsistdout mode, the result
>>>>>> is a CSV file with the .prj information in the first line, and the .csvt in
>>>>>> the second line. We're dealing with the result deleting the first two lines
>>>>>> and using the rest of the content as a CSV, which should be equal to the
>>>>>> result obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>>>>>> Probably we're losing something, but as we see it, the generated CSV
>>>>>> should be a valid one. Does that make sense?
>>>>>>
>>>>>> Thanks so much for your help!
>>>>>>
>>>>>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>>>>>> escribi?:
>>>>>>
>>>>>>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with
>>>>>>> QGIS And geopandas. The column name that I use in the CSV is usually geom
>>>>>>> and WKT shows up in the CSVT file which seems to be a one line file that
>>>>>>> hints at the data types in the CSV file.
>>>>>>>
>>>>>>> I hope that makes sense.
>>>>>>>
>>>>>>> CSVT
>>>>>>> Integer, Integer,WKT
>>>>>>>
>>>>>>> CSV
>>>>>>> line_id,point_id,geom
>>>>>>> 1,1,"POINT(1000 1000)"
>>>>>>>
>>>>>>> PRJ
>>>>>>> EPSG:26910
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>>>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>>>
>>>>>>>> Hi Even,
>>>>>>>>
>>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>>
>>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>>
>>>>>>>>
>>>>>>>>>    -
>>>>>>>>>
>>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>>
>>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>>> geometries with different column names, and we always want the same
>>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>>> that flag to avoid this problem?
>>>>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>>
>>>>>>>> Could you please shed some light on this?
>>>>>>>>
>>>>>>>> Looking forward to your reply,
>>>>>>>> Regards.
>>>>>>>>
>>>>>>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>>
>>>>>>>>> you didn't post to the list
>>>>>>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>>>>>>
>>>>>>>>> Hi Even,
>>>>>>>>>
>>>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>>>
>>>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>>    -
>>>>>>>>>>
>>>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>>>
>>>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>>>> geometries with different column names, and we always want the same
>>>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>>>> that flag to avoid this problem?
>>>>>>>>> In my humble opinion, generating an invalid CSV when using the
>>>>>>>>> -lco CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>>>
>>>>>>>>> Could you please shed some light on this?
>>>>>>>>>
>>>>>>>>> Looking forward to your reply,
>>>>>>>>> Regards.
>>>>>>>>>
>>>>>>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>>>
>>>>>>>>>> Moises,
>>>>>>>>>>
>>>>>>>>>> as far as I can see with your example, the CSV driver behaves
>>>>>>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>>>>>>
>>>>>>>>>> It follows the "Fields with embedded line breaks must be quoted"
>>>>>>>>>> rule of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>>>>>>
>>>>>>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>>>>>>
>>>>>>>>>> $ cat out.csv
>>>>>>>>>> id,descriptio
>>>>>>>>>> "1",This is my third row
>>>>>>>>>> "2","this is
>>>>>>>>>> my string
>>>>>>>>>> "
>>>>>>>>>> "3",This is my third row
>>>>>>>>>>
>>>>>>>>>> $ ogrinfo out.csv -al
>>>>>>>>>> INFO: Open of `out.csv'
>>>>>>>>>>       using driver `CSV' successful.
>>>>>>>>>>
>>>>>>>>>> Layer name: out
>>>>>>>>>> Geometry: None
>>>>>>>>>> Feature Count: 3
>>>>>>>>>> Layer SRS WKT:
>>>>>>>>>> (unknown)
>>>>>>>>>> id: String (0.0)
>>>>>>>>>> descriptio: String (0.0)
>>>>>>>>>> OGRFeature(out):1
>>>>>>>>>>   id (String) = 1
>>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>>
>>>>>>>>>> OGRFeature(out):2
>>>>>>>>>>   id (String) = 2
>>>>>>>>>>   descriptio (String) = this is
>>>>>>>>>> my string
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> OGRFeature(out):3
>>>>>>>>>>   id (String) = 3
>>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>>
>>>>>>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is
>>>>>>>>>> going to result in an invalid CSV file which will mix both the .csvt and
>>>>>>>>>> .csv content
>>>>>>>>>>
>>>>>>>>>> Even
>>>>>>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>>>>>>
>>>>>>>>>> Hello!
>>>>>>>>>>
>>>>>>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and
>>>>>>>>>> we're having some issues while dealing with some columns that contain line
>>>>>>>>>> breaks inside their values. If we have a line with the following string,
>>>>>>>>>> ogr2ogr detects that the line break is a new line and it returns two lines.
>>>>>>>>>>
>>>>>>>>>> "this is my \n value"
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> That's the command that we're executing:
>>>>>>>>>>
>>>>>>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>>>>>>> Sharing an example Shapefile so that you can try to reproduce
>>>>>>>>>> that behaviour:
>>>>>>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>>>>>>
>>>>>>>>>> Thanks so much in advance,
>>>>>>>>>> Regards.
>>>>>>>>>>
>>>>>>>>>> --
>>>>>>>>>> *Moises Calzado*
>>>>>>>>>>
>>>>>>>>>> Support Engineer
>>>>>>>>>>
>>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO
>>>>>>>>>> <https://www.carto.com/>
>>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>>>
>>>>>>>>>> -- http://www.spatialys.com
>>>>>>>>>> My software is free, but my time generally not.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>> --
>>>>>>>>> *Moises Calzado*
>>>>>>>>>
>>>>>>>>> Support Engineer
>>>>>>>>>
>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>>
>>>>>>>>> -- http://www.spatialys.com
>>>>>>>>> My software is free, but my time generally not.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> --
>>>>>>>> *Moises Calzado*
>>>>>>>>
>>>>>>>> Support Engineer
>>>>>>>>
>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>> _______________________________________________
>>>>>>>> gdal-dev mailing list
>>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> gdal-dev mailing list
>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> *Moises Calzado*
>>>>>>
>>>>>> Support Engineer
>>>>>>
>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing list
>>>>>> gdal-dev at lists.osgeo.org
>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>>
>>>>
>>>> --
>>>> *Moises Calzado*
>>>>
>>>> Support Engineer
>>>>
>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
> <https://spatial-data-science-conference.com/2023/london/>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230504/7f6d0732/attachment-0001.htm>

From rob.hewy at gmail.com  Thu May  4 06:31:17 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Thu, 4 May 2023 06:31:17 -0700
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAG_Q50QPXcDfb3wFqm6qQrsTjkc8qkWKvg-ujViVRv_kYU7h4w@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
 <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
 <CAG_Q50QPXcDfb3wFqm6qQrsTjkc8qkWKvg-ujViVRv_kYU7h4w@mail.gmail.com>
Message-ID: <CAG_Q50Qtt3+PToObeut76qe1nOb_4Pihbqy8t1pdVdmny1_n4Q@mail.gmail.com>

Hi.

Here is an image of your dataframe.shp converted to CSV displayed in QGIS:

https://i.imgur.com/6f6VFNf.png

The dot CSV file in Excel and Calc
https://i.imgur.com/twmfIPp.png

On Thu, May 4, 2023 at 6:07?AM Robert Hewlett <rob.hewy at gmail.com> wrote:

> Hi,
>
> Traced back through the thread and found your sample data set and was able
> to convert it to a CSV file that both Calc, Excel and QGIS loaded without
> issue.
>
> The command I used the three files
> ogr2ogr -f CSV df.csv dataframe.shp -lco CREATE_CSVT=YES -lco
> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom
>
> The redirect > result.csv is potentially why you have one, all out (3
> files) put into one file.
>
> The column name in the csv file is geom and not WKT.
>
> I will try to post some images.
>
> The command was run on a windows 10 Laptop.
>
>
>
>
>
>
> On Thu, May 4, 2023 at 4:59?AM Moises Calzado via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi Robert!
>>
>> I think that we're losing a bit the main issue that we reported, as in
>> fact the problem is related with line breaks in the output generated while
>> using /vsistdout and the CREATE_CSVT=YES option.
>>
>> Even pointed out that avoiding that flag it works as expected, but when
>> it's used the generated output is not okay as the "Fields with embedded
>> line breaks must be quoted" rule is not followed.
>> IMHO although the generated output is not a CSV itself, we should be able
>> to delete the first two lines (projection info and types) and deal with the
>> rest of the content as a CSV.
>>
>> What we're doing is streaming the output of the /vsistdout driver to
>> another process that perform some steps with the resultant CSV. In all
>> cases it works correctly, as the output of the ogr2ogr execution is a valid
>> CSV when deleting the first two lines, but in the case reported in my first
>> email it's not.
>> The CREATE_CSVT=YES option is mandatory for us as for the moment, it's
>> requires to use the GEOMETRY_NAME=*geom *one, so we don't have any
>> workaround.
>>
>> Just wanted to confirm if that's expected for you (generating an output
>> that it's not a valid CSV in the end)!
>>
>> El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com>)
>> escribi?:
>>
>>> Hi,
>>>
>>> I just tested with : GDAL 3.6.4, released 2023/04/17
>>>
>>> Using the ogr2ogr as follows:
>>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
>>> I get three files but no geometry
>>>
>>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>>> GEOMETRY=AS_WKT
>>> I get three file with the geometry as WKT with the column name WKT
>>>
>>> *WKT*,id,poi_name,poi_types
>>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional
>>> Park,"1"
>>>
>>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
>>> I get three file with the geometry as WKT but the column called  *geom*
>>> *geom*,id,poi_name,poi_types
>>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional
>>> Park,"1"
>>>
>>> What does
>>> *ogr2ogr --version *
>>> report back
>>>
>>>
>>>
>>> On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com>
>>> wrote:
>>>
>>>> Hi,
>>>>
>>>> Not to start a controversy but it feels like the standard hints at
>>>> three files. Did the standard change?
>>>>
>>>> If it is three files which works for me in QGIS and geopandas i.e. data
>>>> lands where it is suppose to, then more layer creations options are needed
>>>> to handle the SRID/CRS
>>>>
>>>> CREATE_PRJ=YES/NO
>>>> or -t_srs and/or -s_srs triggers the dot-prj file being created.
>>>>
>>>> Just saying ?.
>>>>
>>>> In the meantime would a short python script help parse the one file
>>>> into three?
>>>>
>>>>
>>>> On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>
>>>>> Hi Robert,
>>>>>
>>>>> Yes, we're getting one with all the info!
>>>>>
>>>>> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
>>>>> escribi?:
>>>>>
>>>>>> Just to clarify, instead of getting three files you are getting one
>>>>>> with all the info: types, projection, data?
>>>>>>
>>>>>> https://giswiki.hsr.ch/GeoCSV
>>>>>>
>>>>>> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
>>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>>
>>>>>>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great
>>>>>>> if with that option we could use the GEOMETRY_NAME without using the
>>>>>>> CREATE_CSVT=YES option.
>>>>>>>
>>>>>>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why
>>>>>>> I'm saying that there is an issue while generating the resultant CSV.
>>>>>>> The way we see it is that when using the /vsistdout mode, the result
>>>>>>> is a CSV file with the .prj information in the first line, and the .csvt in
>>>>>>> the second line. We're dealing with the result deleting the first two lines
>>>>>>> and using the rest of the content as a CSV, which should be equal to the
>>>>>>> result obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>>>>>>> Probably we're losing something, but as we see it, the generated CSV
>>>>>>> should be a valid one. Does that make sense?
>>>>>>>
>>>>>>> Thanks so much for your help!
>>>>>>>
>>>>>>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>>>>>>> escribi?:
>>>>>>>
>>>>>>>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with
>>>>>>>> QGIS And geopandas. The column name that I use in the CSV is usually geom
>>>>>>>> and WKT shows up in the CSVT file which seems to be a one line file that
>>>>>>>> hints at the data types in the CSV file.
>>>>>>>>
>>>>>>>> I hope that makes sense.
>>>>>>>>
>>>>>>>> CSVT
>>>>>>>> Integer, Integer,WKT
>>>>>>>>
>>>>>>>> CSV
>>>>>>>> line_id,point_id,geom
>>>>>>>> 1,1,"POINT(1000 1000)"
>>>>>>>>
>>>>>>>> PRJ
>>>>>>>> EPSG:26910
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>>>>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>>>>
>>>>>>>>> Hi Even,
>>>>>>>>>
>>>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>>>
>>>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>>    -
>>>>>>>>>>
>>>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>>>
>>>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>>>> geometries with different column names, and we always want the same
>>>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>>>> that flag to avoid this problem?
>>>>>>>>> In my humble opinion, generating an invalid CSV when using the
>>>>>>>>> -lco CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>>>
>>>>>>>>> Could you please shed some light on this?
>>>>>>>>>
>>>>>>>>> Looking forward to your reply,
>>>>>>>>> Regards.
>>>>>>>>>
>>>>>>>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>>>
>>>>>>>>>> you didn't post to the list
>>>>>>>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>>>>>>>
>>>>>>>>>> Hi Even,
>>>>>>>>>>
>>>>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>>>>
>>>>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>>    -
>>>>>>>>>>>
>>>>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of
>>>>>>>>>>>    geometry column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults
>>>>>>>>>>>    to WKT
>>>>>>>>>>>
>>>>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>>>>> geometries with different column names, and we always want the same
>>>>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>>>>> that flag to avoid this problem?
>>>>>>>>>> In my humble opinion, generating an invalid CSV when using the
>>>>>>>>>> -lco CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>>>>
>>>>>>>>>> Could you please shed some light on this?
>>>>>>>>>>
>>>>>>>>>> Looking forward to your reply,
>>>>>>>>>> Regards.
>>>>>>>>>>
>>>>>>>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>>>>
>>>>>>>>>>> Moises,
>>>>>>>>>>>
>>>>>>>>>>> as far as I can see with your example, the CSV driver behaves
>>>>>>>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>>>>>>>
>>>>>>>>>>> It follows the "Fields with embedded line breaks must be quoted"
>>>>>>>>>>> rule of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>>>>>>>
>>>>>>>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>>>>>>>
>>>>>>>>>>> $ cat out.csv
>>>>>>>>>>> id,descriptio
>>>>>>>>>>> "1",This is my third row
>>>>>>>>>>> "2","this is
>>>>>>>>>>> my string
>>>>>>>>>>> "
>>>>>>>>>>> "3",This is my third row
>>>>>>>>>>>
>>>>>>>>>>> $ ogrinfo out.csv -al
>>>>>>>>>>> INFO: Open of `out.csv'
>>>>>>>>>>>       using driver `CSV' successful.
>>>>>>>>>>>
>>>>>>>>>>> Layer name: out
>>>>>>>>>>> Geometry: None
>>>>>>>>>>> Feature Count: 3
>>>>>>>>>>> Layer SRS WKT:
>>>>>>>>>>> (unknown)
>>>>>>>>>>> id: String (0.0)
>>>>>>>>>>> descriptio: String (0.0)
>>>>>>>>>>> OGRFeature(out):1
>>>>>>>>>>>   id (String) = 1
>>>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>>>
>>>>>>>>>>> OGRFeature(out):2
>>>>>>>>>>>   id (String) = 2
>>>>>>>>>>>   descriptio (String) = this is
>>>>>>>>>>> my string
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> OGRFeature(out):3
>>>>>>>>>>>   id (String) = 3
>>>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>>>
>>>>>>>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES
>>>>>>>>>>> is going to result in an invalid CSV file which will mix both the .csvt and
>>>>>>>>>>> .csv content
>>>>>>>>>>>
>>>>>>>>>>> Even
>>>>>>>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>>>>>>>
>>>>>>>>>>> Hello!
>>>>>>>>>>>
>>>>>>>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and
>>>>>>>>>>> we're having some issues while dealing with some columns that contain line
>>>>>>>>>>> breaks inside their values. If we have a line with the following string,
>>>>>>>>>>> ogr2ogr detects that the line break is a new line and it returns two lines.
>>>>>>>>>>>
>>>>>>>>>>> "this is my \n value"
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> That's the command that we're executing:
>>>>>>>>>>>
>>>>>>>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>>>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>>>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>>>>>>>> Sharing an example Shapefile so that you can try to reproduce
>>>>>>>>>>> that behaviour:
>>>>>>>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>>>>>>>
>>>>>>>>>>> Thanks so much in advance,
>>>>>>>>>>> Regards.
>>>>>>>>>>>
>>>>>>>>>>> --
>>>>>>>>>>> *Moises Calzado*
>>>>>>>>>>>
>>>>>>>>>>> Support Engineer
>>>>>>>>>>>
>>>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO
>>>>>>>>>>> <https://www.carto.com/>
>>>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>>>>
>>>>>>>>>>> -- http://www.spatialys.com
>>>>>>>>>>> My software is free, but my time generally not.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> --
>>>>>>>>>> *Moises Calzado*
>>>>>>>>>>
>>>>>>>>>> Support Engineer
>>>>>>>>>>
>>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO
>>>>>>>>>> <https://www.carto.com/>
>>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>>>
>>>>>>>>>> -- http://www.spatialys.com
>>>>>>>>>> My software is free, but my time generally not.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>> --
>>>>>>>>> *Moises Calzado*
>>>>>>>>>
>>>>>>>>> Support Engineer
>>>>>>>>>
>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>> _______________________________________________
>>>>>>>>> gdal-dev mailing list
>>>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> gdal-dev mailing list
>>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> *Moises Calzado*
>>>>>>>
>>>>>>> Support Engineer
>>>>>>>
>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>> _______________________________________________
>>>>>>> gdal-dev mailing list
>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing list
>>>>>> gdal-dev at lists.osgeo.org
>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> *Moises Calzado*
>>>>>
>>>>> Support Engineer
>>>>>
>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
>>
>> --
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>> <https://spatial-data-science-conference.com/2023/london/>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230504/6822d072/attachment-0001.htm>

From even.rouault at spatialys.com  Thu May  4 06:39:53 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 4 May 2023 15:39:53 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
 <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
Message-ID: <8908304d-82e1-5f6a-6b48-f3e8020c7158@spatialys.com>

Moises,

please fild 2 issues in the github issue tracker:

- one about /vsistdout/ where .csvt and .prj content shouldn't be emitted

- one about decoupling the layer GEOMETRY_NAME creation option with 
CREATE_CSVT=YES

Even

Le 04/05/2023 ? 13:58, Moises Calzado via gdal-dev a ?crit?:
> Hi Robert!
>
> I think that we're losing a bit the main issue that we reported, as in 
> fact the problem?is related with line breaks in the output generated 
> while using /vsistdout and the CREATE_CSVT=YES option.
>
> Even pointed out that avoiding that flag it works as expected, but 
> when it's used the generated output is not okay as the "Fields with 
> embedded line breaks must be quoted" rule is not followed.
> IMHO although the generated output is not a CSV itself, we should be 
> able to delete the first two lines (projection info and types) and 
> deal with the rest of the content as a CSV.
>
> What we're doing is streaming the output?of the /vsistdout driver to 
> another process that perform some steps with the resultant CSV. In all 
> cases it works correctly, as the output of the ogr2ogr execution is a 
> valid CSV when deleting the first two lines, but in the case reported 
> in my first email it's not.
> The CREATE_CSVT=YES option is mandatory for us as for the moment, it's 
> requires to use the GEOMETRY_NAME=*geom *one, so we don't have any 
> workaround.
>
> Just wanted to confirm if that's expected for you (generating an 
> output that it's not a valid CSV in the end)!
>
> El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com>) 
> escribi?:
>
>     Hi,
>
>     I just tested with :?GDAL 3.6.4, released 2023/04/17
>
>     Using the ogr2ogr as follows:
>     ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
>     I get three files but no geometry
>
>     ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>     GEOMETRY=AS_WKT
>     I get three file with the geometry as WKT with the column name WKT
>
>     *WKT*,id,poi_name,poi_types
>     "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>     "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional
>     Park,"1"
>
>     ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>     GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
>     I get three file with the geometry as WKT but the column?called *geom*
>     *geom*,id,poi_name,poi_types
>     "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>     "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional
>     Park,"1"
>
>     What does
>     *ogr2ogr --version *
>     report back
>
>
>
>     On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com>
>     wrote:
>
>         Hi,
>
>         Not to start a controversy?but it feels like the standard
>         hints at three files. Did the standard change?
>
>         If it is three files which works for me in QGIS and geopandas
>         i.e. data lands where it is suppose?to, then more layer
>         creations options are needed to handle the SRID/CRS
>
>         CREATE_PRJ=YES/NO
>         or -t_srs and/or -s_srs triggers the dot-prj file being created.
>
>         Just saying ?.
>
>         In the meantime would a short python script help parse the one
>         file into three?
>
>
>         On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev
>         <gdal-dev at lists.osgeo.org> wrote:
>
>             Hi Robert,
>
>             Yes, we're getting one with all the info!
>
>             El mi?, 3 may 2023 a las 18:14, Robert Hewlett
>             (<rob.hewy at gmail.com>) escribi?:
>
>                 Just to clarify, instead of getting?three files you
>                 are getting one with all the info: types, projection,
>                 data?
>
>                 https://giswiki.hsr.ch/GeoCSV
>
>                 On Wed, May 3, 2023 at 8:57?AM Moises Calzado via
>                 gdal-dev <gdal-dev at lists.osgeo.org> wrote:
>
>                     We're also specifying the GEOM_POSSIBLE_NAMES, so
>                     it would be great if with that option we could use
>                     the GEOMETRY_NAME without using the
>                     CREATE_CSVT=YES option.
>
>                     Regarding emitting the .prj and .csvt in
>                     /vsistdout mode, that's why I'm saying that there
>                     is an issue while generating the resultant CSV.
>                     The way we see it is that when using the
>                     /vsistdout mode, the result is a CSV file with the
>                     .prj information in the first line, and the .csvt
>                     in the second line. We're dealing with the result
>                     deleting the first two lines and using the rest of
>                     the content as a CSV, which should be equal to the
>                     result obtained when using ogr2ogr without the
>                     CREATE_CSVT=YES option.
>                     Probably we're losing something, but as we see it,
>                     the generated CSV should be a valid one. Does that
>                     make sense?
>
>                     Thanks so much?for your help!
>
>                     El mi?, 3 may 2023 a las 15:10, Robert Hewlett
>                     (<rob.hewy at gmail.com>) escribi?:
>
>                         The .CSVT and .PRJ help to make a proper
>                         geocsv dataset. Helps with QGIS And geopandas.
>                         The column name that I use in the CSV is
>                         usually geom and WKT shows up in the CSVT file
>                         which seems to be a one line file that hints
>                         at the data types in the CSV file.
>
>                         I hope that makes?sense.
>
>                         CSVT
>                         Integer, Integer,WKT
>
>                         CSV
>                         line_id,point_id,geom
>                         1,1,"POINT(1000 1000)"
>
>                         PRJ
>                         EPSG:26910
>
>
>
>
>                         On Wed, May 3, 2023, 05:23 Moises Calzado via
>                         gdal-dev <gdal-dev at lists.osgeo.org> wrote:
>
>                             Hi Even,
>
>                             Thanks so much for taking a look into that
>                             one!
>
>                             I have one doubt regarding the CSVT
>                             content, as we're not really using it, but
>                             it's required when using the GEOMETRY_NAME
>                             layer creation option, as can be checked
>                             in the CSV driver documentation:
>
>                                  *
>
>                                     GEOMETRY_NAME=name (Starting with
>                                     GDAL 2.1): Name of geometry
>                                     column. Only used if
>                                     GEOMETRY=AS_WKT and
>                                     CREATE_CSVT=YES. Defaults to WKT
>
>                             We really need this flag as we are
>                             processing files that?contain geometries
>                             with different column names, and we always
>                             want the same geometry name in the
>                             generated output. Are we losing something
>                             when using that flag to avoid this problem?
>                             In my humble opinion, generating an
>                             invalid CSV when using the -lco
>                             CREATE_CSVT=YES looks like a bug for me,
>                             as I can't see the reason why strings
>                             containing line breaks can't be quoted.
>
>                             Could you please shed some light on this?
>
>                             Looking forward to your reply,
>                             Regards.
>
>                             El mi?, 3 may 2023 a las 14:00, Even
>                             Rouault (<even.rouault at spatialys.com>)
>                             escribi?:
>
>                                 you didn't post to the list
>
>                                 Le 03/05/2023 ? 13:49, Moises Calzado
>                                 a ?crit?:
>>                                 Hi Even,
>>
>>                                 Thanks so much for taking a look into
>>                                 that one!
>>
>>                                 I have one doubt regarding the CSVT
>>                                 content, as we're not really using
>>                                 it, but it's required when using the
>>                                 GEOMETRY_NAME layer creation option,
>>                                 as can be checked in the CSV driver
>>                                 documentation:
>>
>>                                      *
>>
>>                                         GEOMETRY_NAME=name (Starting
>>                                         with GDAL 2.1): Name of
>>                                         geometry column. Only used if
>>                                         GEOMETRY=AS_WKT and
>>                                         CREATE_CSVT=YES. Defaults to WKT
>>
>>                                 We really need this flag as we are
>>                                 processing files that?contain
>>                                 geometries with different column
>>                                 names, and we always want the same
>>                                 geometry name in the generated
>>                                 output. Are we losing something when
>>                                 using that flag to avoid this problem?
>>                                 In my humble opinion, generating an
>>                                 invalid CSV when using the -lco
>>                                 CREATE_CSVT=YES looks like a bug for
>>                                 me, as I can't see the reason why
>>                                 strings containing line breaks can't
>>                                 be quoted.
>>
>>                                 Could you please shed some light on this?
>>
>>                                 Looking forward to your reply,
>>                                 Regards.
>>
>>                                 El s?b, 29 abr 2023 a las 15:44, Even
>>                                 Rouault
>>                                 (<even.rouault at spatialys.com>) escribi?:
>>
>>                                     Moises,
>>
>>                                     as far as I can see with your
>>                                     example, the CSV driver behaves
>>                                     "properly" in reading and writing
>>                                     of field values with line breaks.
>>
>>                                     It follows the "Fields with
>>                                     embedded line breaks must be
>>                                     quoted" rule of
>>                                     https://en.wikipedia.org/wiki/Comma-separated_values
>>
>>                                     $ ogr2ogr out.csv
>>                                     /vsizip/dataframe.zip
>>
>>                                     $ cat out.csv
>>                                     id,descriptio
>>                                     "1",This is my third row
>>                                     "2","this is
>>                                     my string
>>                                     "
>>                                     "3",This is my third row
>>
>>                                     $ ogrinfo out.csv -al
>>                                     INFO: Open of `out.csv'
>>                                     ????? using driver `CSV' successful.
>>
>>                                     Layer name: out
>>                                     Geometry: None
>>                                     Feature Count: 3
>>                                     Layer SRS WKT:
>>                                     (unknown)
>>                                     id: String (0.0)
>>                                     descriptio: String (0.0)
>>                                     OGRFeature(out):1
>>                                     ? id (String) = 1
>>                                     ? descriptio (String) = This is
>>                                     my third row
>>
>>                                     OGRFeature(out):2
>>                                     ? id (String) = 2
>>                                     ? descriptio (String) = this is
>>                                     my string
>>
>>
>>                                     OGRFeature(out):3
>>                                     ? id (String) = 3
>>                                     ? descriptio (String) = This is
>>                                     my third row
>>
>>                                     But in your example using
>>                                     /vsistdout/ and -lco
>>                                     CREATE_CSVT=YES is going to
>>                                     result in an invalid CSV file
>>                                     which will mix both the .csvt and
>>                                     .csv content
>>
>>                                     Even
>>
>>                                     Le 24/04/2023 ? 13:34, Moises
>>                                     Calzado via gdal-dev a ?crit?:
>>>                                     Hello!
>>>
>>>                                     We're trying to convert a
>>>                                     Shapefile into a CSV using
>>>                                     ogr2ogr and we're having some
>>>                                     issues while dealing with some
>>>                                     columns that contain line breaks
>>>                                     inside their values. If we have
>>>                                     a line with the following
>>>                                     string, ogr2ogr detects that the
>>>                                     line break is a new line and it
>>>                                     returns two lines.
>>>
>>>                                         "this is my \n value"
>>>
>>>
>>>                                     That's the command that we're
>>>                                     executing:
>>>
>>>                                         ogr2ogr -f CSV -skipfailures
>>>                                         -makevalid /vsistdout/
>>>                                         /vsizip/shapefile.zip
>>>                                         -simplify 0.00001 -dim XY
>>>                                         -t_srs EPSG:4326 -lco
>>>                                         GEOMETRY=AS_WKT -lco
>>>                                         GEOMETRY_NAME=geom -lco
>>>                                         CREATE_CSVT=YES > result.csv
>>>
>>>
>>>                                     Is this an expected behaviour,
>>>                                     or is there any way to avoid this?
>>>                                     Sharing an example Shapefile so
>>>                                     that you can try to reproduce
>>>                                     that behaviour:
>>>                                     https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>
>>>                                     Thanks so much in advance,
>>>                                     Regards.
>>>
>>>                                     -- 
>>>                                     *Moises Calzado*
>>>
>>>                                     Support Engineer
>>>
>>>                                     +34671264286 |
>>>                                     mcalzado at carto.com | CARTO
>>>                                     <https://www.carto.com/>
>>>
>>>                                     <https://spatial-data-science-conference.com/2023/london/>
>>>
>>>
>>>                                     _______________________________________________
>>>                                     gdal-dev mailing list
>>>                                     gdal-dev at lists.osgeo.org
>>>                                     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>                                     -- 
>>                                     http://www.spatialys.com
>>                                     My software is free, but my time generally not.
>>
>>
>>
>>                                 -- 
>>                                 *Moises Calzado*
>>
>>                                 Support Engineer
>>
>>                                 +34671264286 | mcalzado at carto.com |
>>                                 CARTO <https://www.carto.com/>
>>
>>                                 <https://spatial-data-science-conference.com/2023/london/>
>>
>
>                                 -- 
>                                 http://www.spatialys.com
>                                 My software is free, but my time generally not.
>
>
>
>                             -- 
>                             *Moises Calzado*
>
>                             Support Engineer
>
>                             +34671264286 | mcalzado at carto.com | CARTO
>                             <https://www.carto.com/>
>
>                             <https://spatial-data-science-conference.com/2023/london/>
>
>                             _______________________________________________
>                             gdal-dev mailing list
>                             gdal-dev at lists.osgeo.org
>                             https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>                         _______________________________________________
>                         gdal-dev mailing list
>                         gdal-dev at lists.osgeo.org
>                         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>                     -- 
>                     *Moises Calzado*
>
>                     Support Engineer
>
>                     +34671264286 | mcalzado at carto.com | CARTO
>                     <https://www.carto.com/>
>
>                     <https://spatial-data-science-conference.com/2023/london/>
>
>                     _______________________________________________
>                     gdal-dev mailing list
>                     gdal-dev at lists.osgeo.org
>                     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>                 _______________________________________________
>                 gdal-dev mailing list
>                 gdal-dev at lists.osgeo.org
>                 https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>             -- 
>             *Moises Calzado*
>
>             Support Engineer
>
>             +34671264286 | mcalzado at carto.com | CARTO
>             <https://www.carto.com/>
>
>             <https://spatial-data-science-conference.com/2023/london/>
>             _______________________________________________
>             gdal-dev mailing list
>             gdal-dev at lists.osgeo.org
>             https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> -- 
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230504/805aaf03/attachment-0001.htm>

From mcalzado at carto.com  Fri May  5 02:32:24 2023
From: mcalzado at carto.com (Moises Calzado)
Date: Fri, 5 May 2023 11:32:24 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <8908304d-82e1-5f6a-6b48-f3e8020c7158@spatialys.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
 <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
 <8908304d-82e1-5f6a-6b48-f3e8020c7158@spatialys.com>
Message-ID: <CAObRW4Tho7gZ9LOWW-95Pehy4Xryqd0L1LPsP8ja66Z8Z0FRbQ@mail.gmail.com>

Hi Even!

I've just created the two issues:
- https://github.com/OSGeo/gdal/issues/7699
- https://github.com/OSGeo/gdal/issues/7700

Robert, as I explained before, we need the `/vsistdout/` driver as we're
processing the file in streaming mode, so we can't save the result to the
storage.
Unforteunately, the problem arises when using that driver.

El jue, 4 may 2023 a las 15:39, Even Rouault (<even.rouault at spatialys.com>)
escribi?:

> Moises,
>
> please fild 2 issues in the github issue tracker:
>
> - one about /vsistdout/ where .csvt and .prj content shouldn't be emitted
>
> - one about decoupling the layer GEOMETRY_NAME creation option with
> CREATE_CSVT=YES
>
> Even
> Le 04/05/2023 ? 13:58, Moises Calzado via gdal-dev a ?crit :
>
> Hi Robert!
>
> I think that we're losing a bit the main issue that we reported, as in
> fact the problem is related with line breaks in the output generated while
> using /vsistdout and the CREATE_CSVT=YES option.
>
> Even pointed out that avoiding that flag it works as expected, but when
> it's used the generated output is not okay as the "Fields with embedded
> line breaks must be quoted" rule is not followed.
> IMHO although the generated output is not a CSV itself, we should be able
> to delete the first two lines (projection info and types) and deal with the
> rest of the content as a CSV.
>
> What we're doing is streaming the output of the /vsistdout driver to
> another process that perform some steps with the resultant CSV. In all
> cases it works correctly, as the output of the ogr2ogr execution is a valid
> CSV when deleting the first two lines, but in the case reported in my first
> email it's not.
> The CREATE_CSVT=YES option is mandatory for us as for the moment, it's
> requires to use the GEOMETRY_NAME=*geom *one, so we don't have any
> workaround.
>
> Just wanted to confirm if that's expected for you (generating an output
> that it's not a valid CSV in the end)!
>
> El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com>)
> escribi?:
>
>> Hi,
>>
>> I just tested with : GDAL 3.6.4, released 2023/04/17
>>
>> Using the ogr2ogr as follows:
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
>> I get three files but no geometry
>>
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>> GEOMETRY=AS_WKT
>> I get three file with the geometry as WKT with the column name WKT
>>
>> *WKT*,id,poi_name,poi_types
>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>>
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
>> I get three file with the geometry as WKT but the column called  *geom*
>> *geom*,id,poi_name,poi_types
>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>>
>> What does
>> *ogr2ogr --version *
>> report back
>>
>>
>>
>> On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com> wrote:
>>
>>> Hi,
>>>
>>> Not to start a controversy but it feels like the standard hints at three
>>> files. Did the standard change?
>>>
>>> If it is three files which works for me in QGIS and geopandas i.e. data
>>> lands where it is suppose to, then more layer creations options are needed
>>> to handle the SRID/CRS
>>>
>>> CREATE_PRJ=YES/NO
>>> or -t_srs and/or -s_srs triggers the dot-prj file being created.
>>>
>>> Just saying ?.
>>>
>>> In the meantime would a short python script help parse the one file into
>>> three?
>>>
>>>
>>> On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
>>> gdal-dev at lists.osgeo.org> wrote:
>>>
>>>> Hi Robert,
>>>>
>>>> Yes, we're getting one with all the info!
>>>>
>>>> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
>>>> escribi?:
>>>>
>>>>> Just to clarify, instead of getting three files you are getting one
>>>>> with all the info: types, projection, data?
>>>>>
>>>>> https://giswiki.hsr.ch/GeoCSV
>>>>>
>>>>> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>
>>>>>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great
>>>>>> if with that option we could use the GEOMETRY_NAME without using the
>>>>>> CREATE_CSVT=YES option.
>>>>>>
>>>>>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why
>>>>>> I'm saying that there is an issue while generating the resultant CSV.
>>>>>> The way we see it is that when using the /vsistdout mode, the result
>>>>>> is a CSV file with the .prj information in the first line, and the .csvt in
>>>>>> the second line. We're dealing with the result deleting the first two lines
>>>>>> and using the rest of the content as a CSV, which should be equal to the
>>>>>> result obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>>>>>> Probably we're losing something, but as we see it, the generated CSV
>>>>>> should be a valid one. Does that make sense?
>>>>>>
>>>>>> Thanks so much for your help!
>>>>>>
>>>>>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>>>>>> escribi?:
>>>>>>
>>>>>>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with
>>>>>>> QGIS And geopandas. The column name that I use in the CSV is usually geom
>>>>>>> and WKT shows up in the CSVT file which seems to be a one line file that
>>>>>>> hints at the data types in the CSV file.
>>>>>>>
>>>>>>> I hope that makes sense.
>>>>>>>
>>>>>>> CSVT
>>>>>>> Integer, Integer,WKT
>>>>>>>
>>>>>>> CSV
>>>>>>> line_id,point_id,geom
>>>>>>> 1,1,"POINT(1000 1000)"
>>>>>>>
>>>>>>> PRJ
>>>>>>> EPSG:26910
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>>>>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>>>>
>>>>>>>> Hi Even,
>>>>>>>>
>>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>>
>>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>>
>>>>>>>>
>>>>>>>>>    -
>>>>>>>>>
>>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>>
>>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>>> geometries with different column names, and we always want the same
>>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>>> that flag to avoid this problem?
>>>>>>>> In my humble opinion, generating an invalid CSV when using the -lco
>>>>>>>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>>
>>>>>>>> Could you please shed some light on this?
>>>>>>>>
>>>>>>>> Looking forward to your reply,
>>>>>>>> Regards.
>>>>>>>>
>>>>>>>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<
>>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>>
>>>>>>>>> you didn't post to the list
>>>>>>>>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>>>>>>>>
>>>>>>>>> Hi Even,
>>>>>>>>>
>>>>>>>>> Thanks so much for taking a look into that one!
>>>>>>>>>
>>>>>>>>> I have one doubt regarding the CSVT content, as we're not really
>>>>>>>>> using it, but it's required when using the GEOMETRY_NAME layer creation
>>>>>>>>> option, as can be checked in the CSV driver documentation:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>>    -
>>>>>>>>>>
>>>>>>>>>>    GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry
>>>>>>>>>>    column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>>>>>>>>>
>>>>>>>>>> We really need this flag as we are processing files that contain
>>>>>>>>> geometries with different column names, and we always want the same
>>>>>>>>> geometry name in the generated output. Are we losing something when using
>>>>>>>>> that flag to avoid this problem?
>>>>>>>>> In my humble opinion, generating an invalid CSV when using the
>>>>>>>>> -lco CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>>>>>>>>> strings containing line breaks can't be quoted.
>>>>>>>>>
>>>>>>>>> Could you please shed some light on this?
>>>>>>>>>
>>>>>>>>> Looking forward to your reply,
>>>>>>>>> Regards.
>>>>>>>>>
>>>>>>>>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>>>>>>>>> even.rouault at spatialys.com>) escribi?:
>>>>>>>>>
>>>>>>>>>> Moises,
>>>>>>>>>>
>>>>>>>>>> as far as I can see with your example, the CSV driver behaves
>>>>>>>>>> "properly" in reading and writing of field values with line breaks.
>>>>>>>>>>
>>>>>>>>>> It follows the "Fields with embedded line breaks must be quoted"
>>>>>>>>>> rule of https://en.wikipedia.org/wiki/Comma-separated_values
>>>>>>>>>>
>>>>>>>>>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>>>>>>>>>
>>>>>>>>>> $ cat out.csv
>>>>>>>>>> id,descriptio
>>>>>>>>>> "1",This is my third row
>>>>>>>>>> "2","this is
>>>>>>>>>> my string
>>>>>>>>>> "
>>>>>>>>>> "3",This is my third row
>>>>>>>>>>
>>>>>>>>>> $ ogrinfo out.csv -al
>>>>>>>>>> INFO: Open of `out.csv'
>>>>>>>>>>       using driver `CSV' successful.
>>>>>>>>>>
>>>>>>>>>> Layer name: out
>>>>>>>>>> Geometry: None
>>>>>>>>>> Feature Count: 3
>>>>>>>>>> Layer SRS WKT:
>>>>>>>>>> (unknown)
>>>>>>>>>> id: String (0.0)
>>>>>>>>>> descriptio: String (0.0)
>>>>>>>>>> OGRFeature(out):1
>>>>>>>>>>   id (String) = 1
>>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>>
>>>>>>>>>> OGRFeature(out):2
>>>>>>>>>>   id (String) = 2
>>>>>>>>>>   descriptio (String) = this is
>>>>>>>>>> my string
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> OGRFeature(out):3
>>>>>>>>>>   id (String) = 3
>>>>>>>>>>   descriptio (String) = This is my third row
>>>>>>>>>>
>>>>>>>>>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is
>>>>>>>>>> going to result in an invalid CSV file which will mix both the .csvt and
>>>>>>>>>> .csv content
>>>>>>>>>>
>>>>>>>>>> Even
>>>>>>>>>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>>>>>>>>>
>>>>>>>>>> Hello!
>>>>>>>>>>
>>>>>>>>>> We're trying to convert a Shapefile into a CSV using ogr2ogr and
>>>>>>>>>> we're having some issues while dealing with some columns that contain line
>>>>>>>>>> breaks inside their values. If we have a line with the following string,
>>>>>>>>>> ogr2ogr detects that the line break is a new line and it returns two lines.
>>>>>>>>>>
>>>>>>>>>> "this is my \n value"
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> That's the command that we're executing:
>>>>>>>>>>
>>>>>>>>>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/
>>>>>>>>>>> /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco
>>>>>>>>>>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Is this an expected behaviour, or is there any way to avoid this?
>>>>>>>>>> Sharing an example Shapefile so that you can try to reproduce
>>>>>>>>>> that behaviour:
>>>>>>>>>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>>>>>>>>>
>>>>>>>>>> Thanks so much in advance,
>>>>>>>>>> Regards.
>>>>>>>>>>
>>>>>>>>>> --
>>>>>>>>>> *Moises Calzado*
>>>>>>>>>>
>>>>>>>>>> Support Engineer
>>>>>>>>>>
>>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO
>>>>>>>>>> <https://www.carto.com/>
>>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>>>
>>>>>>>>>> -- http://www.spatialys.com
>>>>>>>>>> My software is free, but my time generally not.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>> --
>>>>>>>>> *Moises Calzado*
>>>>>>>>>
>>>>>>>>> Support Engineer
>>>>>>>>>
>>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>>>
>>>>>>>>> -- http://www.spatialys.com
>>>>>>>>> My software is free, but my time generally not.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> --
>>>>>>>> *Moises Calzado*
>>>>>>>>
>>>>>>>> Support Engineer
>>>>>>>>
>>>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>>>> _______________________________________________
>>>>>>>> gdal-dev mailing list
>>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> gdal-dev mailing list
>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> *Moises Calzado*
>>>>>>
>>>>>> Support Engineer
>>>>>>
>>>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing list
>>>>>> gdal-dev at lists.osgeo.org
>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>>
>>>>
>>>> --
>>>> *Moises Calzado*
>>>>
>>>> Support Engineer
>>>>
>>>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>>> <https://spatial-data-science-conference.com/2023/london/>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
> <https://spatial-data-science-conference.com/2023/london/>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
*Moises Calzado*

Support Engineer

+34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230505/eb7f5bef/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May  5 02:57:53 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 5 May 2023 09:57:53 +0000
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAObRW4Tho7gZ9LOWW-95Pehy4Xryqd0L1LPsP8ja66Z8Z0FRbQ@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
 <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
 <8908304d-82e1-5f6a-6b48-f3e8020c7158@spatialys.com>
 <CAObRW4Tho7gZ9LOWW-95Pehy4Xryqd0L1LPsP8ja66Z8Z0FRbQ@mail.gmail.com>
Message-ID: <AM0PR09MB321971B5EC944884D7252592FD729@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Have you considered to output GeoJSONseq https://gdal.org/drivers/vector/geojsonseq.html instead of CSV, that for my mind is a workaround as a geodata format. Maybe JSON could handle your newlines by the same.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Moises Calzado via gdal-dev
L?hetetty: perjantai 5. toukokuuta 2023 12.32
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] Ogr2ogr CSV driver not handling correctly line breaks inside columns

Hi Even!

I've just created the two issues:
- https://github.com/OSGeo/gdal/issues/7699
- https://github.com/OSGeo/gdal/issues/7700

Robert, as I explained before, we need the `/vsistdout/` driver as we're processing the file in streaming mode, so we can't save the result to the storage.
Unforteunately, the problem arises when using that driver.

El jue, 4 may 2023 a las 15:39, Even Rouault (<even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>) escribi?:

Moises,

please fild 2 issues in the github issue tracker:

- one about /vsistdout/ where .csvt and .prj content shouldn't be emitted

- one about decoupling the layer GEOMETRY_NAME creation option with CREATE_CSVT=YES

Even
Le 04/05/2023 ? 13:58, Moises Calzado via gdal-dev a ?crit :
Hi Robert!

I think that we're losing a bit the main issue that we reported, as in fact the problem is related with line breaks in the output generated while using /vsistdout and the CREATE_CSVT=YES option.

Even pointed out that avoiding that flag it works as expected, but when it's used the generated output is not okay as the "Fields with embedded line breaks must be quoted" rule is not followed.
IMHO although the generated output is not a CSV itself, we should be able to delete the first two lines (projection info and types) and deal with the rest of the content as a CSV.

What we're doing is streaming the output of the /vsistdout driver to another process that perform some steps with the resultant CSV. In all cases it works correctly, as the output of the ogr2ogr execution is a valid CSV when deleting the first two lines, but in the case reported in my first email it's not.
The CREATE_CSVT=YES option is mandatory for us as for the moment, it's requires to use the GEOMETRY_NAME=geom one, so we don't have any workaround.

Just wanted to confirm if that's expected for you (generating an output that it's not a valid CSV in the end)!

El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com<mailto:rob.hewy at gmail.com>>) escribi?:
Hi,

I just tested with : GDAL 3.6.4, released 2023/04/17

Using the ogr2ogr as follows:
ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
I get three files but no geometry

ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco GEOMETRY=AS_WKT
I get three file with the geometry as WKT with the column name WKT

WKT,id,poi_name,poi_types
"POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
"POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"

ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom
I get three file with the geometry as WKT but the column called  geom
geom,id,poi_name,poi_types
"POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
"POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"

What does
ogr2ogr --version
report back



On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com<mailto:rob.hewy at gmail.com>> wrote:
Hi,

Not to start a controversy but it feels like the standard hints at three files. Did the standard change?

If it is three files which works for me in QGIS and geopandas i.e. data lands where it is suppose to, then more layer creations options are needed to handle the SRID/CRS

CREATE_PRJ=YES/NO
or -t_srs and/or -s_srs triggers the dot-prj file being created.

Just saying ?.

In the meantime would a short python script help parse the one file into three?


On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi Robert,

Yes, we're getting one with all the info!

El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com<mailto:rob.hewy at gmail.com>>) escribi?:
Just to clarify, instead of getting three files you are getting one with all the info: types, projection, data?
https://giswiki.hsr.ch/GeoCSV

On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if with that option we could use the GEOMETRY_NAME without using the CREATE_CSVT=YES option.

Regarding emitting the .prj and .csvt in /vsistdout mode, that's why I'm saying that there is an issue while generating the resultant CSV.
The way we see it is that when using the /vsistdout mode, the result is a CSV file with the .prj information in the first line, and the .csvt in the second line. We're dealing with the result deleting the first two lines and using the rest of the content as a CSV, which should be equal to the result obtained when using ogr2ogr without the CREATE_CSVT=YES option.
Probably we're losing something, but as we see it, the generated CSV should be a valid one. Does that make sense?

Thanks so much for your help!

El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com<mailto:rob.hewy at gmail.com>>) escribi?:
The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with QGIS And geopandas. The column name that I use in the CSV is usually geom and WKT shows up in the CSVT file which seems to be a one line file that hints at the data types in the CSV file.

I hope that makes sense.

CSVT
Integer, Integer,WKT

CSV
line_id,point_id,geom
1,1,"POINT(1000 1000)"

PRJ
EPSG:26910




On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi Even,

Thanks so much for taking a look into that one!

I have one doubt regarding the CSVT content, as we're not really using it, but it's required when using the GEOMETRY_NAME layer creation option, as can be checked in the CSV driver documentation:


?       GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
We really need this flag as we are processing files that contain geometries with different column names, and we always want the same geometry name in the generated output. Are we losing something when using that flag to avoid this problem?
In my humble opinion, generating an invalid CSV when using the -lco CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why strings containing line breaks can't be quoted.

Could you please shed some light on this?

Looking forward to your reply,
Regards.

El mi?, 3 may 2023 a las 14:00, Even Rouault (<even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>) escribi?:

you didn't post to the list
Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
Hi Even,

Thanks so much for taking a look into that one!

I have one doubt regarding the CSVT content, as we're not really using it, but it's required when using the GEOMETRY_NAME layer creation option, as can be checked in the CSV driver documentation:


?       GEOMETRY_NAME=name (Starting with GDAL 2.1): Name of geometry column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
We really need this flag as we are processing files that contain geometries with different column names, and we always want the same geometry name in the generated output. Are we losing something when using that flag to avoid this problem?
In my humble opinion, generating an invalid CSV when using the -lco CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why strings containing line breaks can't be quoted.

Could you please shed some light on this?

Looking forward to your reply,
Regards.

El s?b, 29 abr 2023 a las 15:44, Even Rouault (<even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>) escribi?:

Moises,

as far as I can see with your example, the CSV driver behaves "properly" in reading and writing of field values with line breaks.

It follows the "Fields with embedded line breaks must be quoted" rule of https://en.wikipedia.org/wiki/Comma-separated_values

$ ogr2ogr out.csv /vsizip/dataframe.zip

$ cat out.csv
id,descriptio
"1",This is my third row
"2","this is
my string
"
"3",This is my third row

$ ogrinfo out.csv -al
INFO: Open of `out.csv'
      using driver `CSV' successful.

Layer name: out
Geometry: None
Feature Count: 3
Layer SRS WKT:
(unknown)
id: String (0.0)
descriptio: String (0.0)
OGRFeature(out):1
  id (String) = 1
  descriptio (String) = This is my third row

OGRFeature(out):2
  id (String) = 2
  descriptio (String) = this is
my string


OGRFeature(out):3
  id (String) = 3
  descriptio (String) = This is my third row

But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is going to result in an invalid CSV file which will mix both the .csvt and .csv content

Even
Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
Hello!

We're trying to convert a Shapefile into a CSV using ogr2ogr and we're having some issues while dealing with some columns that contain line breaks inside their values. If we have a line with the following string, ogr2ogr detects that the line break is a new line and it returns two lines.

"this is my \n value"

That's the command that we're executing:

ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/ /vsizip/shapefile.zip -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco GEOMETRY=AS_WKT -lco GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv

Is this an expected behaviour, or is there any way to avoid this?
Sharing an example Shapefile so that you can try to reproduce that behaviour: https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing

Thanks so much in advance,
Regards.

--
Moises Calzado

Support Engineer

+34671264286 | mcalzado at carto.com<mailto:mcalzado at carto.com> | CARTO<https://www.carto.com/>
[https://storage.googleapis.com/carto-it-files/signature/SDSC-2023-LND_Signature-mail.jpg]<https://spatial-data-science-conference.com/2023/london/>


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.


--
Moises Calzado

Support Engineer

+34671264286 | mcalzado at carto.com<mailto:mcalzado at carto.com> | CARTO<https://www.carto.com/>
[https://storage.googleapis.com/carto-it-files/signature/SDSC-2023-LND_Signature-mail.jpg]<https://spatial-data-science-conference.com/2023/london/>

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.


--
Moises Calzado

Support Engineer

+34671264286 | mcalzado at carto.com<mailto:mcalzado at carto.com> | CARTO<https://www.carto.com/>
[https://storage.googleapis.com/carto-it-files/signature/SDSC-2023-LND_Signature-mail.jpg]<https://spatial-data-science-conference.com/2023/london/>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
Moises Calzado

Support Engineer

+34671264286 | mcalzado at carto.com<mailto:mcalzado at carto.com> | CARTO<https://www.carto.com/>
[https://storage.googleapis.com/carto-it-files/signature/SDSC-2023-LND_Signature-mail.jpg]<https://spatial-data-science-conference.com/2023/london/>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
Moises Calzado

Support Engineer

+34671264286 | mcalzado at carto.com<mailto:mcalzado at carto.com> | CARTO<https://www.carto.com/>
[https://storage.googleapis.com/carto-it-files/signature/SDSC-2023-LND_Signature-mail.jpg]<https://spatial-data-science-conference.com/2023/london/>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
Moises Calzado

Support Engineer

+34671264286 | mcalzado at carto.com<mailto:mcalzado at carto.com> | CARTO<https://www.carto.com/>
[https://storage.googleapis.com/carto-it-files/signature/SDSC-2023-LND_Signature-mail.jpg]<https://spatial-data-science-conference.com/2023/london/>


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.


--
Moises Calzado

Support Engineer

+34671264286 | mcalzado at carto.com<mailto:mcalzado at carto.com> | CARTO<https://www.carto.com/>
[https://storage.googleapis.com/carto-it-files/signature/SDSC-2023-LND_Signature-mail.jpg]<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230505/a1085aaf/attachment-0001.htm>

From rob.hewy at gmail.com  Fri May  5 06:12:47 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Fri, 5 May 2023 06:12:47 -0700
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <AM0PR09MB321971B5EC944884D7252592FD729@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
 <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
 <8908304d-82e1-5f6a-6b48-f3e8020c7158@spatialys.com>
 <CAObRW4Tho7gZ9LOWW-95Pehy4Xryqd0L1LPsP8ja66Z8Z0FRbQ@mail.gmail.com>
 <AM0PR09MB321971B5EC944884D7252592FD729@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CAG_Q50S0pLg14D0Xd-X-OORY89x6pChjGTWZc-BUgeZo7adVGA@mail.gmail.com>

Can something such as
head -n -2
Be part of the pipeline?

The 3 text files are being combined into 1 stream.

   - Line 1 CRS/SRID from the .prj
   - Line 2 Types from the .cvst
   - Line 3 to the end from the .csv

Which is great in some ways as the SRID does not go missing and header info
is at the head.

It is just that I found from line 3 to the end were well formed with the
renamed geometry column but I am testing on Windows 10 with 3.6.

I do not know if /vsizip/ as output is allowed or works i.e. all three text
files as one streamed zip file then extract just the CSV file later in the
process.

Moving to a one file spatial format as mentioned above might help. It is
just that a GeoCSV dataset is a combination of three files.

Maybe a many-to-one-back-to-many-scenario might help.

There are several multi-file spatial formats that would need to be zipped
so that you could stream just one thing.

I hope that makes sense.


.



On Fri, May 5, 2023 at 2:58?AM Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Have you considered to output GeoJSONseq
> https://gdal.org/drivers/vector/geojsonseq.html instead of CSV, that for
> my mind is a workaround as a geodata format. Maybe JSON could handle your
> newlines by the same.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Moises
> Calzado via gdal-dev
> *L?hetetty:* perjantai 5. toukokuuta 2023 12.32
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
> breaks inside columns
>
>
>
> Hi Even!
>
>
>
> I've just created the two issues:
>
> - https://github.com/OSGeo/gdal/issues/7699
>
> - https://github.com/OSGeo/gdal/issues/7700
>
>
>
> Robert, as I explained before, we need the `/vsistdout/` driver as we're
> processing the file in streaming mode, so we can't save the result to the
> storage.
>
> Unforteunately, the problem arises when using that driver.
>
>
>
> El jue, 4 may 2023 a las 15:39, Even Rouault (<even.rouault at spatialys.com>)
> escribi?:
>
> Moises,
>
> please fild 2 issues in the github issue tracker:
>
> - one about /vsistdout/ where .csvt and .prj content shouldn't be emitted
>
> - one about decoupling the layer GEOMETRY_NAME creation option with
> CREATE_CSVT=YES
>
> Even
>
> Le 04/05/2023 ? 13:58, Moises Calzado via gdal-dev a ?crit :
>
> Hi Robert!
>
>
>
> I think that we're losing a bit the main issue that we reported, as in
> fact the problem is related with line breaks in the output generated while
> using /vsistdout and the CREATE_CSVT=YES option.
>
>
>
> Even pointed out that avoiding that flag it works as expected, but when
> it's used the generated output is not okay as the "Fields with embedded
> line breaks must be quoted" rule is not followed.
>
> IMHO although the generated output is not a CSV itself, we should be able
> to delete the first two lines (projection info and types) and deal with the
> rest of the content as a CSV.
>
>
>
> What we're doing is streaming the output of the /vsistdout driver to
> another process that perform some steps with the resultant CSV. In all
> cases it works correctly, as the output of the ogr2ogr execution is a valid
> CSV when deleting the first two lines, but in the case reported in my first
> email it's not.
>
> The CREATE_CSVT=YES option is mandatory for us as for the moment, it's
> requires to use the GEOMETRY_NAME=*geom *one, so we don't have any
> workaround.
>
>
>
> Just wanted to confirm if that's expected for you (generating an output
> that it's not a valid CSV in the end)!
>
>
>
> El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com>)
> escribi?:
>
> Hi,
>
>
>
> I just tested with : GDAL 3.6.4, released 2023/04/17
>
>
>
> Using the ogr2ogr as follows:
>
> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
>
> I get three files but no geometry
>
>
>
> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
> GEOMETRY=AS_WKT
>
> I get three file with the geometry as WKT with the column name WKT
>
>
>
> *WKT*,id,poi_name,poi_types
>
> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>
>
>
> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
>
> I get three file with the geometry as WKT but the column called  *geom*
>
> *geom*,id,poi_name,poi_types
> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>
>
>
> What does
>
> *ogr2ogr --version *
>
> report back
>
>
>
>
>
>
>
> On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com> wrote:
>
> Hi,
>
>
>
> Not to start a controversy but it feels like the standard hints at three
> files. Did the standard change?
>
>
>
> If it is three files which works for me in QGIS and geopandas i.e. data
> lands where it is suppose to, then more layer creations options are needed
> to handle the SRID/CRS
>
>
>
> CREATE_PRJ=YES/NO
>
> or -t_srs and/or -s_srs triggers the dot-prj file being created.
>
>
>
> Just saying ?.
>
>
>
> In the meantime would a short python script help parse the one file into
> three?
>
>
>
>
>
> On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi Robert,
>
>
>
> Yes, we're getting one with all the info!
>
>
>
> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
> escribi?:
>
> Just to clarify, instead of getting three files you are getting one with
> all the info: types, projection, data?
>
> https://giswiki.hsr.ch/GeoCSV
>
>
>
> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if
> with that option we could use the GEOMETRY_NAME without using the
> CREATE_CSVT=YES option.
>
>
>
> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why I'm
> saying that there is an issue while generating the resultant CSV.
>
> The way we see it is that when using the /vsistdout mode, the result is a
> CSV file with the .prj information in the first line, and the .csvt in the
> second line. We're dealing with the result deleting the first two lines and
> using the rest of the content as a CSV, which should be equal to the result
> obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>
> Probably we're losing something, but as we see it, the generated CSV
> should be a valid one. Does that make sense?
>
>
>
> Thanks so much for your help!
>
>
>
> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
> escribi?:
>
> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with QGIS
> And geopandas. The column name that I use in the CSV is usually geom and
> WKT shows up in the CSVT file which seems to be a one line file that hints
> at the data types in the CSV file.
>
>
>
> I hope that makes sense.
>
>
>
> CSVT
>
> Integer, Integer,WKT
>
>
>
> CSV
>
> line_id,point_id,geom
>
> 1,1,"POINT(1000 1000)"
>
>
>
> PRJ
>
> EPSG:26910
>
>
>
>
>
>
>
>
>
> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi Even,
>
>
>
> Thanks so much for taking a look into that one!
>
>
>
> I have one doubt regarding the CSVT content, as we're not really using it,
> but it's required when using the GEOMETRY_NAME layer creation option, as
> can be checked in the CSV driver documentation:
>
>
>
> ?       *GEOMETRY_NAME*=name (Starting with GDAL 2.1): Name of geometry
> column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>
> We really need this flag as we are processing files that contain
> geometries with different column names, and we always want the same
> geometry name in the generated output. Are we losing something when using
> that flag to avoid this problem?
>
> In my humble opinion, generating an invalid CSV when using the -lco
> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
> strings containing line breaks can't be quoted.
>
>
>
> Could you please shed some light on this?
>
>
>
> Looking forward to your reply,
>
> Regards.
>
>
>
> El mi?, 3 may 2023 a las 14:00, Even Rouault (<even.rouault at spatialys.com>)
> escribi?:
>
> you didn't post to the list
>
> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>
> Hi Even,
>
>
>
> Thanks so much for taking a look into that one!
>
>
>
> I have one doubt regarding the CSVT content, as we're not really using it,
> but it's required when using the GEOMETRY_NAME layer creation option, as
> can be checked in the CSV driver documentation:
>
>
>
> ?       *GEOMETRY_NAME*=name (Starting with GDAL 2.1): Name of geometry
> column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>
> We really need this flag as we are processing files that contain
> geometries with different column names, and we always want the same
> geometry name in the generated output. Are we losing something when using
> that flag to avoid this problem?
>
> In my humble opinion, generating an invalid CSV when using the -lco
> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
> strings containing line breaks can't be quoted.
>
>
>
> Could you please shed some light on this?
>
>
>
> Looking forward to your reply,
>
> Regards.
>
>
>
> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<even.rouault at spatialys.com>)
> escribi?:
>
> Moises,
>
> as far as I can see with your example, the CSV driver behaves "properly"
> in reading and writing of field values with line breaks.
>
> It follows the "Fields with embedded line breaks must be quoted" rule of
> https://en.wikipedia.org/wiki/Comma-separated_values
>
> $ ogr2ogr out.csv /vsizip/dataframe.zip
>
> $ cat out.csv
> id,descriptio
> "1",This is my third row
> "2","this is
> my string
> "
> "3",This is my third row
>
> $ ogrinfo out.csv -al
> INFO: Open of `out.csv'
>       using driver `CSV' successful.
>
> Layer name: out
> Geometry: None
> Feature Count: 3
> Layer SRS WKT:
> (unknown)
> id: String (0.0)
> descriptio: String (0.0)
> OGRFeature(out):1
>   id (String) = 1
>   descriptio (String) = This is my third row
>
> OGRFeature(out):2
>   id (String) = 2
>   descriptio (String) = this is
> my string
>
>
> OGRFeature(out):3
>   id (String) = 3
>   descriptio (String) = This is my third row
>
> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is going to
> result in an invalid CSV file which will mix both the .csvt and .csv content
>
> Even
>
> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>
> Hello!
>
>
>
> We're trying to convert a Shapefile into a CSV using ogr2ogr and we're
> having some issues while dealing with some columns that contain line breaks
> inside their values. If we have a line with the following string, ogr2ogr
> detects that the line break is a new line and it returns two lines.
>
>
>
> "this is my \n value"
>
>
>
> That's the command that we're executing:
>
>
>
> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/ /vsizip/shapefile.zip
> -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco GEOMETRY=AS_WKT -lco
> GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>
>
>
> Is this an expected behaviour, or is there any way to avoid this?
>
> Sharing an example Shapefile so that you can try to reproduce that
> behaviour:
> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>
>
>
> Thanks so much in advance,
>
> Regards.
>
>
>
> --
>
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
>
>
> --
>
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
>
>
> --
>
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> --
>
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> --
>
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> --
>
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
>
>
> --
>
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230505/bfd66ad1/attachment-0001.htm>

From even.rouault at spatialys.com  Mon May  8 06:02:48 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 8 May 2023 15:02:48 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release
Message-ID: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>

Hi,

Motion:

Adopt GDAL 3.7.0RC1 as 3.7.0 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From howard at hobu.co  Mon May  8 06:53:04 2023
From: howard at hobu.co (Howard Butler)
Date: Mon, 8 May 2023 08:53:04 -0500
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release
In-Reply-To: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
References: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
Message-ID: <3B00A5F8-E998-4AF7-83B0-8E3B3552690F@hobu.co>



> On May 8, 2023, at 8:02 AM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> Hi,
> 
> Motion:
> 
> Adopt GDAL 3.7.0RC1 as 3.7.0 release
> 
> Starting with my +1

+1

Howard

From mcalzado at carto.com  Mon May  8 07:33:56 2023
From: mcalzado at carto.com (Moises Calzado)
Date: Mon, 8 May 2023 16:33:56 +0200
Subject: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
 breaks inside columns
In-Reply-To: <CAG_Q50S0pLg14D0Xd-X-OORY89x6pChjGTWZc-BUgeZo7adVGA@mail.gmail.com>
References: <CAObRW4Tm7-Kg76344Aoh1Mix24-yT2Szd9ivqvV0eMRP=KTEag@mail.gmail.com>
 <cdd2eba6-f6c8-6d64-c1cc-f0fda993f9c5@spatialys.com>
 <CAObRW4R_N_8Qfov6yN1AJLA0vaGAHuK8cKy-b5q-XXxGcRkU0g@mail.gmail.com>
 <68fe3cdb-9e89-00c6-f996-e8c72e57f67a@spatialys.com>
 <CAObRW4S=gXvqPTwRE6in2brL=MV1P6_-Eq03r17vGfmTp7wOLA@mail.gmail.com>
 <CAG_Q50Rgep4TBXabkp6d6OUhS8qTadQ-txk9WDWJf94iBdz34Q@mail.gmail.com>
 <CAObRW4S-Fk-HwoETTHcqf6PQnu__XqaVCtj1J3ow0fpXEn2-Yw@mail.gmail.com>
 <CAG_Q50RYmFUNQZm90VGTMF8hgYi4fhFMug5Rof0pgJwFtyjrjw@mail.gmail.com>
 <CAObRW4QXRQwSJP=edHBuKSwma7y_RSj++eFwJyWgcf0He_k0cw@mail.gmail.com>
 <CAG_Q50T8z4aEC7OTyoJmj7+uk=wx=EnfnX8VOxtoOTopc9Ux_w@mail.gmail.com>
 <CAG_Q50SyJ+jqeyF4N0NNwzJp5KJiq8y4gpAN759+ksXhSTEbMQ@mail.gmail.com>
 <CAObRW4RcKugQn-xEEJ1ccPdKiH-rettZRQCV1VAniLy1sn984A@mail.gmail.com>
 <8908304d-82e1-5f6a-6b48-f3e8020c7158@spatialys.com>
 <CAObRW4Tho7gZ9LOWW-95Pehy4Xryqd0L1LPsP8ja66Z8Z0FRbQ@mail.gmail.com>
 <AM0PR09MB321971B5EC944884D7252592FD729@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CAG_Q50S0pLg14D0Xd-X-OORY89x6pChjGTWZc-BUgeZo7adVGA@mail.gmail.com>
Message-ID: <CAObRW4S+qLUUKehuk2JC6oDdZUQ05Ku3gbqfS0=4tYS2eexEyQ@mail.gmail.com>

Hey Robert!

We already have something like head -n -2 in our pipeline, but the problem
is that the CSV that should be generated when omitting these two lines is
not valid, as it doesn't double quote the strings with line breaks.

Jukka, thanks so much for the alternative approach proposal! We'll check if
the GeoJSONseq output works as expected and we'll evaluate if the actual
process can be updated with this new approach.

Once more, thanks so much for all your help on that one. We really
appreciate it!

Regards.

El vie, 5 may 2023 a las 15:13, Robert Hewlett (<rob.hewy at gmail.com>)
escribi?:

> Can something such as
> head -n -2
> Be part of the pipeline?
>
> The 3 text files are being combined into 1 stream.
>
>    - Line 1 CRS/SRID from the .prj
>    - Line 2 Types from the .cvst
>    - Line 3 to the end from the .csv
>
> Which is great in some ways as the SRID does not go missing and header
> info is at the head.
>
> It is just that I found from line 3 to the end were well formed with the
> renamed geometry column but I am testing on Windows 10 with 3.6.
>
> I do not know if /vsizip/ as output is allowed or works i.e. all three
> text files as one streamed zip file then extract just the CSV file later in
> the process.
>
> Moving to a one file spatial format as mentioned above might help. It is
> just that a GeoCSV dataset is a combination of three files.
>
> Maybe a many-to-one-back-to-many-scenario might help.
>
> There are several multi-file spatial formats that would need to be zipped
> so that you could stream just one thing.
>
> I hope that makes sense.
>
>
> .
>
>
>
> On Fri, May 5, 2023 at 2:58?AM Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
>> Hi,
>>
>>
>>
>> Have you considered to output GeoJSONseq
>> https://gdal.org/drivers/vector/geojsonseq.html instead of CSV, that for
>> my mind is a workaround as a geodata format. Maybe JSON could handle your
>> newlines by the same.
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Moises
>> Calzado via gdal-dev
>> *L?hetetty:* perjantai 5. toukokuuta 2023 12.32
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] Ogr2ogr CSV driver not handling correctly line
>> breaks inside columns
>>
>>
>>
>> Hi Even!
>>
>>
>>
>> I've just created the two issues:
>>
>> - https://github.com/OSGeo/gdal/issues/7699
>>
>> - https://github.com/OSGeo/gdal/issues/7700
>>
>>
>>
>> Robert, as I explained before, we need the `/vsistdout/` driver as we're
>> processing the file in streaming mode, so we can't save the result to the
>> storage.
>>
>> Unforteunately, the problem arises when using that driver.
>>
>>
>>
>> El jue, 4 may 2023 a las 15:39, Even Rouault (<even.rouault at spatialys.com>)
>> escribi?:
>>
>> Moises,
>>
>> please fild 2 issues in the github issue tracker:
>>
>> - one about /vsistdout/ where .csvt and .prj content shouldn't be emitted
>>
>> - one about decoupling the layer GEOMETRY_NAME creation option with
>> CREATE_CSVT=YES
>>
>> Even
>>
>> Le 04/05/2023 ? 13:58, Moises Calzado via gdal-dev a ?crit :
>>
>> Hi Robert!
>>
>>
>>
>> I think that we're losing a bit the main issue that we reported, as in
>> fact the problem is related with line breaks in the output generated while
>> using /vsistdout and the CREATE_CSVT=YES option.
>>
>>
>>
>> Even pointed out that avoiding that flag it works as expected, but when
>> it's used the generated output is not okay as the "Fields with embedded
>> line breaks must be quoted" rule is not followed.
>>
>> IMHO although the generated output is not a CSV itself, we should be able
>> to delete the first two lines (projection info and types) and deal with the
>> rest of the content as a CSV.
>>
>>
>>
>> What we're doing is streaming the output of the /vsistdout driver to
>> another process that perform some steps with the resultant CSV. In all
>> cases it works correctly, as the output of the ogr2ogr execution is a valid
>> CSV when deleting the first two lines, but in the case reported in my first
>> email it's not.
>>
>> The CREATE_CSVT=YES option is mandatory for us as for the moment, it's
>> requires to use the GEOMETRY_NAME=*geom *one, so we don't have any
>> workaround.
>>
>>
>>
>> Just wanted to confirm if that's expected for you (generating an output
>> that it's not a valid CSV in the end)!
>>
>>
>>
>> El mi?, 3 may 2023 a las 21:05, Robert Hewlett (<rob.hewy at gmail.com>)
>> escribi?:
>>
>> Hi,
>>
>>
>>
>> I just tested with : GDAL 3.6.4, released 2023/04/17
>>
>>
>>
>> Using the ogr2ogr as follows:
>>
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES
>>
>> I get three files but no geometry
>>
>>
>>
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>> GEOMETRY=AS_WKT
>>
>> I get three file with the geometry as WKT with the column name WKT
>>
>>
>>
>> *WKT*,id,poi_name,poi_types
>>
>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>>
>>
>>
>> ogr2ogr -f CSV poi_out.csv poi.shp -lco CREATE_CSVT=YES -lco
>> GEOMETRY=AS_WKT -lco GEOMETRY_NAME=*geom*
>>
>> I get three file with the geometry as WKT but the column called  *geom*
>>
>> *geom*,id,poi_name,poi_types
>> "POINT (508878.602179846 5433913.2763688)","1",crescent,"4"
>> "POINT (517836.918121302 5447702.01715829)","2",Tynehead Regional Park,"1"
>>
>>
>>
>> What does
>>
>> *ogr2ogr --version *
>>
>> report back
>>
>>
>>
>>
>>
>>
>>
>> On Wed, May 3, 2023 at 9:38?AM Robert Hewlett <rob.hewy at gmail.com> wrote:
>>
>> Hi,
>>
>>
>>
>> Not to start a controversy but it feels like the standard hints at three
>> files. Did the standard change?
>>
>>
>>
>> If it is three files which works for me in QGIS and geopandas i.e. data
>> lands where it is suppose to, then more layer creations options are needed
>> to handle the SRID/CRS
>>
>>
>>
>> CREATE_PRJ=YES/NO
>>
>> or -t_srs and/or -s_srs triggers the dot-prj file being created.
>>
>>
>>
>> Just saying ?.
>>
>>
>>
>> In the meantime would a short python script help parse the one file into
>> three?
>>
>>
>>
>>
>>
>> On Wed, May 3, 2023 at 9:16?AM Moises Calzado via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>> Hi Robert,
>>
>>
>>
>> Yes, we're getting one with all the info!
>>
>>
>>
>> El mi?, 3 may 2023 a las 18:14, Robert Hewlett (<rob.hewy at gmail.com>)
>> escribi?:
>>
>> Just to clarify, instead of getting three files you are getting one with
>> all the info: types, projection, data?
>>
>> https://giswiki.hsr.ch/GeoCSV
>>
>>
>>
>> On Wed, May 3, 2023 at 8:57?AM Moises Calzado via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>> We're also specifying the GEOM_POSSIBLE_NAMES, so it would be great if
>> with that option we could use the GEOMETRY_NAME without using the
>> CREATE_CSVT=YES option.
>>
>>
>>
>> Regarding emitting the .prj and .csvt in /vsistdout mode, that's why I'm
>> saying that there is an issue while generating the resultant CSV.
>>
>> The way we see it is that when using the /vsistdout mode, the result is a
>> CSV file with the .prj information in the first line, and the .csvt in the
>> second line. We're dealing with the result deleting the first two lines and
>> using the rest of the content as a CSV, which should be equal to the result
>> obtained when using ogr2ogr without the CREATE_CSVT=YES option.
>>
>> Probably we're losing something, but as we see it, the generated CSV
>> should be a valid one. Does that make sense?
>>
>>
>>
>> Thanks so much for your help!
>>
>>
>>
>> El mi?, 3 may 2023 a las 15:10, Robert Hewlett (<rob.hewy at gmail.com>)
>> escribi?:
>>
>> The .CSVT and .PRJ help to make a proper geocsv dataset. Helps with QGIS
>> And geopandas. The column name that I use in the CSV is usually geom and
>> WKT shows up in the CSVT file which seems to be a one line file that hints
>> at the data types in the CSV file.
>>
>>
>>
>> I hope that makes sense.
>>
>>
>>
>> CSVT
>>
>> Integer, Integer,WKT
>>
>>
>>
>> CSV
>>
>> line_id,point_id,geom
>>
>> 1,1,"POINT(1000 1000)"
>>
>>
>>
>> PRJ
>>
>> EPSG:26910
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> On Wed, May 3, 2023, 05:23 Moises Calzado via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>> Hi Even,
>>
>>
>>
>> Thanks so much for taking a look into that one!
>>
>>
>>
>> I have one doubt regarding the CSVT content, as we're not really using
>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>> as can be checked in the CSV driver documentation:
>>
>>
>>
>> ?       *GEOMETRY_NAME*=name (Starting with GDAL 2.1): Name of geometry
>> column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>
>> We really need this flag as we are processing files that contain
>> geometries with different column names, and we always want the same
>> geometry name in the generated output. Are we losing something when using
>> that flag to avoid this problem?
>>
>> In my humble opinion, generating an invalid CSV when using the -lco
>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>> strings containing line breaks can't be quoted.
>>
>>
>>
>> Could you please shed some light on this?
>>
>>
>>
>> Looking forward to your reply,
>>
>> Regards.
>>
>>
>>
>> El mi?, 3 may 2023 a las 14:00, Even Rouault (<even.rouault at spatialys.com>)
>> escribi?:
>>
>> you didn't post to the list
>>
>> Le 03/05/2023 ? 13:49, Moises Calzado a ?crit :
>>
>> Hi Even,
>>
>>
>>
>> Thanks so much for taking a look into that one!
>>
>>
>>
>> I have one doubt regarding the CSVT content, as we're not really using
>> it, but it's required when using the GEOMETRY_NAME layer creation option,
>> as can be checked in the CSV driver documentation:
>>
>>
>>
>> ?       *GEOMETRY_NAME*=name (Starting with GDAL 2.1): Name of geometry
>> column. Only used if GEOMETRY=AS_WKT and CREATE_CSVT=YES. Defaults to WKT
>>
>> We really need this flag as we are processing files that contain
>> geometries with different column names, and we always want the same
>> geometry name in the generated output. Are we losing something when using
>> that flag to avoid this problem?
>>
>> In my humble opinion, generating an invalid CSV when using the -lco
>> CREATE_CSVT=YES looks like a bug for me, as I can't see the reason why
>> strings containing line breaks can't be quoted.
>>
>>
>>
>> Could you please shed some light on this?
>>
>>
>>
>> Looking forward to your reply,
>>
>> Regards.
>>
>>
>>
>> El s?b, 29 abr 2023 a las 15:44, Even Rouault (<
>> even.rouault at spatialys.com>) escribi?:
>>
>> Moises,
>>
>> as far as I can see with your example, the CSV driver behaves "properly"
>> in reading and writing of field values with line breaks.
>>
>> It follows the "Fields with embedded line breaks must be quoted" rule of
>> https://en.wikipedia.org/wiki/Comma-separated_values
>>
>> $ ogr2ogr out.csv /vsizip/dataframe.zip
>>
>> $ cat out.csv
>> id,descriptio
>> "1",This is my third row
>> "2","this is
>> my string
>> "
>> "3",This is my third row
>>
>> $ ogrinfo out.csv -al
>> INFO: Open of `out.csv'
>>       using driver `CSV' successful.
>>
>> Layer name: out
>> Geometry: None
>> Feature Count: 3
>> Layer SRS WKT:
>> (unknown)
>> id: String (0.0)
>> descriptio: String (0.0)
>> OGRFeature(out):1
>>   id (String) = 1
>>   descriptio (String) = This is my third row
>>
>> OGRFeature(out):2
>>   id (String) = 2
>>   descriptio (String) = this is
>> my string
>>
>>
>> OGRFeature(out):3
>>   id (String) = 3
>>   descriptio (String) = This is my third row
>>
>> But in your example using /vsistdout/ and -lco CREATE_CSVT=YES is going
>> to result in an invalid CSV file which will mix both the .csvt and .csv
>> content
>>
>> Even
>>
>> Le 24/04/2023 ? 13:34, Moises Calzado via gdal-dev a ?crit :
>>
>> Hello!
>>
>>
>>
>> We're trying to convert a Shapefile into a CSV using ogr2ogr and we're
>> having some issues while dealing with some columns that contain line breaks
>> inside their values. If we have a line with the following string, ogr2ogr
>> detects that the line break is a new line and it returns two lines.
>>
>>
>>
>> "this is my \n value"
>>
>>
>>
>> That's the command that we're executing:
>>
>>
>>
>> ogr2ogr -f CSV -skipfailures -makevalid /vsistdout/ /vsizip/shapefile.zip
>> -simplify 0.00001 -dim XY -t_srs EPSG:4326 -lco GEOMETRY=AS_WKT -lco
>> GEOMETRY_NAME=geom -lco CREATE_CSVT=YES > result.csv
>>
>>
>>
>> Is this an expected behaviour, or is there any way to avoid this?
>>
>> Sharing an example Shapefile so that you can try to reproduce that
>> behaviour:
>> https://drive.google.com/file/d/1gFqfTP02KTFoavJyyO-Ix05YwZB2tS24/view?usp=sharing
>>
>>
>>
>> Thanks so much in advance,
>>
>> Regards.
>>
>>
>>
>> --
>>
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>>
>>
>> _______________________________________________
>>
>> gdal-dev mailing list
>>
>> gdal-dev at lists.osgeo.org
>>
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> --
>>
>> http://www.spatialys.com
>>
>> My software is free, but my time generally not.
>>
>>
>>
>>
>> --
>>
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>> --
>>
>> http://www.spatialys.com
>>
>> My software is free, but my time generally not.
>>
>>
>>
>>
>> --
>>
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>> --
>>
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>> --
>>
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>> --
>>
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>> <https://spatial-data-science-conference.com/2023/london/>
>>
>>
>>
>> _______________________________________________
>>
>> gdal-dev mailing list
>>
>> gdal-dev at lists.osgeo.org
>>
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> --
>>
>> http://www.spatialys.com
>>
>> My software is free, but my time generally not.
>>
>>
>>
>>
>> --
>>
>> *Moises Calzado*
>>
>> Support Engineer
>>
>> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>>
>> <https://spatial-data-science-conference.com/2023/london/>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
*Moises Calzado*

Support Engineer

+34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230508/bae88347/attachment-0001.htm>

From stenger at lat-lon.de  Mon May  8 08:56:55 2023
From: stenger at lat-lon.de (Dirk Stenger)
Date: Mon, 8 May 2023 17:56:55 +0200
Subject: [gdal-dev] Integration of GDAL 3.5 into a custom Docker Image
Message-ID: <958e04e2-1e55-d67d-860a-3a401d227725@lat-lon.de>

Dear GDAL community,

We try to integrate GDAL 3.5 into a Debian 11 Docker Image to use it 
with the OSGeo project deegree.

For that, we created a fork of the GDAL project [1], copied the 
ubuntu-full configuration of the release/3.5 branch, modified it to use 
Debian 11 and pushed it to the fork. You can find the results here: [2]
In a next step, we are trying to build debian-full with our Jenkins and 
to integrate the resulting image into our Debian 11 Docker Image with 
deegree.

However, the build is still not successful and fails with following 
message (I already posted this a couple of weeks ago):

/[91mrsync: [sender] change_dir "lat-lon/gdal:debian-full/proj/x86_64" 
(in gdal-docker-cache) failed: No such file or directory (2)//
//[0m[91mrsync error: some files/attrs were not transferred (see 
previous errors) (code 23) at main.c(1819) [Receiver=3.2.3]//
//[0m[91mrsync: [Receiver] read error: Connection reset by peer (104)//
//[0mThe command '/bin/sh -c . /buildscripts/bh-set-envvars.sh???? && 
DESTDIR=/build_tmp_proj /buildscripts/bh-proj.sh????? && 
LD_LIBRARY_PATH=/build_tmp_proj/usr/local/lib 
/build_tmp_proj/usr/local/bin/projsync --target-dir /tmp/proj_grids 
--all????? && rm -rf /build_tmp_proj' returned a non-zero code: 23/

This leads us to several questions:

- Is this a good way to integrate a custom GDAL version into a third 
party project while using Docker? Are there alternative approaches?
- Are any other (e.g. OSGeo) projects trying to implement a similar 
workflow? If yes, did you also encounter problems? If not, how did you 
exactly integrate GDAL into your custom Dockerfile?
- How long will GDAL 3.5 be supported? I did not find any maintenance 
schedule on the website.
- Is the Docker build of release/3.5 branch still maintained or could it 
happen that e.g. a remote resource disappears meaning that the build 
does not work anymore?

Also, we can offer to provide our results to the open source project 
GDAL which might help others as well.

Best regards,
Dirk Stenger

[1] https://github.com/lat-lon/gdal/tree/release/3.5-debian11
[2] 
https://github.com/lat-lon/gdal/tree/release/3.5-debian11/docker/debian-full 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230508/7d7d4b47/attachment.htm>

From even.rouault at spatialys.com  Mon May  8 09:14:55 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 8 May 2023 18:14:55 +0200
Subject: [gdal-dev] Integration of GDAL 3.5 into a custom Docker Image
In-Reply-To: <958e04e2-1e55-d67d-860a-3a401d227725@lat-lon.de>
References: <958e04e2-1e55-d67d-860a-3a401d227725@lat-lon.de>
Message-ID: <a2768ae9-bed1-3ac8-e850-d3e990bcba88@spatialys.com>

Dirk,

>
> /[91mrsync: [sender] change_dir "lat-lon/gdal:debian-full/proj/x86_64" 
> (in gdal-docker-cache) failed: No such file or directory (2)//
> //[0m[91mrsync error: some files/attrs were not transferred (see 
> previous errors) (code 23) at main.c(1819) [Receiver=3.2.3]//
> //[0m[91mrsync: [Receiver] read error: Connection reset by peer (104)//
> //[0mThe command '/bin/sh -c . /buildscripts/bh-set-envvars.sh???? && 
> DESTDIR=/build_tmp_proj /buildscripts/bh-proj.sh????? && 
> LD_LIBRARY_PATH=/build_tmp_proj/usr/local/lib 
> /build_tmp_proj/usr/local/bin/projsync --target-dir /tmp/proj_grids 
> --all????? && rm -rf /build_tmp_proj' returned a non-zero code: 23/

 From the above it is not clear if the issue is with rsync or projsync.

rsync is just an optimization do have host caching of build artifacts 
when doing repeated builds. You could safely strip that off from the 
script, or just pass -t RSYNC_REMOTE="" in the docker build invokation.

>
> - How long will GDAL 3.5 be supported? I did not find any maintenance 
> schedule on the website.
We only support the branch of the last released feature version. So when 
3.7.0 will be officially approved (in a couple days), only 3.7.x will be 
supported, and until 3.8.0 will be released in ~6 months.
> - Is the Docker build of release/3.5 branch still maintained or could 
> it happen that e.g. a remote resource disappears meaning that the 
> build does not work anymore?

The Docker build scripts tend to break regularly due to remote resources 
changing, typically with the Apache Arrow libraries. But you may also 
remove that if you don't need a build with everything.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230508/883dea3c/attachment.htm>

From eruiz at aplitop.com  Tue May  9 01:47:39 2023
From: eruiz at aplitop.com (Elena Ruiz)
Date: Tue, 9 May 2023 08:47:39 +0000
Subject: [gdal-dev] Space Disk/Memory of Image
References: <3d652b5c-aa92-4a2a-85be-25316f1f7b0b.ba94d704-e79f-4907-b4e6-7c540f2b307c.d3b8f967-4ac2-4387-954a-ecda5fc65211@emailsignatures365.codetwo.com>
Message-ID: <AM0P192MB0498FCAC0D013034388ECD37BB769@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>

Hello, I need to know the disk size of an image, I calculate it using the following formula:

Disk size=( sizex*sizey*bits per pixel)/8 =memory size without compression

But when the image is compressed on disk it occupies less and the size in memory is much larger, is there some method in the C++ GDAL API, to obtain the size on disk, size on memory, or the compression factor?
Example:
SizeX: 60416
SizeY:38656
Bits per pixel:24

Size memory= (60416*38656*24)/8=7.006.322.688 bytes
Size disk=2.137.644.631 bytes

The format image is COG - Cloud Optimized GeoTIFF generator, and has JPEG compression

Thanks and regards
________________________________

[https://www.aplitop.com/descargas/firma1.jpg]


Elena Ruiz
Sofware Development & Technical Support
Tel. +34 952 43 97 71
eruiz at aplitop.com
Sumatra, 9 - 29190 M?laga (Spain)
www.aplitop.com

[cid:SocialLink_Facebook_32x32_a745adb8-c250-4372-8480-e77f503dad3d.png]<https://www.facebook.com/AplitopSL/>   [cid:SocialLink_Twitter_32x32_858247f6-9d4a-4740-a6b3-9b5ebfd98a97.png] <https://twitter.com/aplitop>    [cid:SocialLink_Linkedin_32x32_154d63de-bf68-468f-9eb0-ffed102fac77.png] <https://www.linkedin.com/company/aplitop>    [cid:SocialLink_Youtube_32x32_0dea15dd-3774-4086-be9d-f62560b70c86.png] <https://www.youtube.com/user/aplitop>


In accordance with the provisions of the European Regulation of Data Protection 2016/679 (Reglamento Europeo de Protecci?n de Datos 2016/679), we inform you that the data and the information you provide us through this medium will be used by APLITOP, S.L., with C.I.F. B-92543396 and with address at C / Sumatra, 9, Malaga, 29190, in order to answer your questions and inform you about our products. The data provided will be kept as long as it does not request its cessation and will not be transferred to third parties except in cases where there is a legal obligation. You have the right to access your personal data, correct inaccurate data or request its deletion when the data is no longer necessary for the purposes that were collected, as well as any rights recognized in the RGPD 2016/679
<https://www.aplitop.com/New/en/443/publication-of-point-clouds-on-web>

<https://www.aplitop.com/New/en/438/tcpmdt-v9-is-here><https://www.aplitop.com/Event/en/429/aplitop-at-intergeo-2022-essen>

<https://www.aplitop.com/Event/en/358/intergeo-2019>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/fb19a843/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Facebook_32x32_a745adb8-c250-4372-8480-e77f503dad3d.png
Type: image/png
Size: 365 bytes
Desc: SocialLink_Facebook_32x32_a745adb8-c250-4372-8480-e77f503dad3d.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/fb19a843/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Twitter_32x32_858247f6-9d4a-4740-a6b3-9b5ebfd98a97.png
Type: image/png
Size: 619 bytes
Desc: SocialLink_Twitter_32x32_858247f6-9d4a-4740-a6b3-9b5ebfd98a97.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/fb19a843/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Linkedin_32x32_154d63de-bf68-468f-9eb0-ffed102fac77.png
Type: image/png
Size: 468 bytes
Desc: SocialLink_Linkedin_32x32_154d63de-bf68-468f-9eb0-ffed102fac77.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/fb19a843/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Youtube_32x32_0dea15dd-3774-4086-be9d-f62560b70c86.png
Type: image/png
Size: 817 bytes
Desc: SocialLink_Youtube_32x32_0dea15dd-3774-4086-be9d-f62560b70c86.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/fb19a843/attachment-0003.png>

From jukka.rahkonen at maanmittauslaitos.fi  Tue May  9 02:05:02 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 9 May 2023 09:05:02 +0000
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release
In-Reply-To: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
References: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
Message-ID: <AM0PR09MB32198019B51948CC026BED7FFD769@AM0PR09MB3219.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: maanantai 8. toukokuuta 2023 16.03
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release

Hi,

Motion:

Adopt GDAL 3.7.0RC1 as 3.7.0 release

Starting with my +1

Even

--
http://www.spatialys.com/
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From lnicola at dend.ro  Tue May  9 02:08:04 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Tue, 09 May 2023 12:08:04 +0300
Subject: [gdal-dev] Space Disk/Memory of Image
In-Reply-To: <AM0P192MB0498FCAC0D013034388ECD37BB769@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>
References: <3d652b5c-aa92-4a2a-85be-25316f1f7b0b.ba94d704-e79f-4907-b4e6-7c540f2b307c.d3b8f967-4ac2-4387-954a-ecda5fc65211@emailsignatures365.codetwo.com>
 <AM0P192MB0498FCAC0D013034388ECD37BB769@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>
Message-ID: <cd3dc8ce-bd49-4989-9b7a-3100a7595389@betaapp.fastmail.com>

Hello,

The GDAL API actually has a couple of methods that return the size of a file (not dataset) on disk: VSIStatL <https://gdal.org/doxygen/cpl__vsi_8h.html#ac92fbd5e6fc143b026001b32c4c19ed1>, VSIStatExL <https://gdal.org/doxygen/cpl__vsi_8h.html#ad1a691db1ba2f43add25a5c0d6498da6>. Since these work on files, they're not going to return valid results for multi-file formats. On the flip side, they support e.g. reading from ZIP files, which can come in handy.

If you want to compute the compressed size of an image you have in memory, that's not really possible. The compression factor will depend on the image contents, and the only way to determine it is to actually do it and see how large the result is. You can even compress it without writing to disk, using /vsimem/.

To get the uncompressed size, you're basically correct for simple images. You can multiply by the number of bands, which is 3 for an RGB image (like in your case), or 4 for RGBA. But some formats like NetCDF support multiple images in a single file, or even data with 3 or more dimensions. For those, there's no single width and height to use in a formula.

Regards,
Laurentiu

On Tue, May 9, 2023, at 11:47, Elena Ruiz wrote:
> Hello, I need to know the disk size of an image, I calculate it using the following formula:
>  
> Disk size=( sizex*sizey*bits per pixel)/8 =memory size without compression
>  
> But when the image is compressed on disk it occupies less and the size in memory is much larger, is there some method in the C++ GDAL API, to obtain the size on disk, size on memory, or the compression factor?
> Example:
> SizeX: 60416
> SizeY:38656
> Bits per pixel:24
>  
> Size memory= (60416*38656*24)/8=7.006.322.688 bytes
> Size disk=2.137.644.631 bytes
>  
> The format image is *COG ? Cloud Optimized GeoTIFF generator, and has JPEG compression*
>  
> Thanks and regards
> 
> 
> 
> *Elena Ruiz *
> Sofware Development & Technical Support
> Tel. +34 952 43 97 71 
> eruiz at aplitop.com
> Sumatra, 9 - 29190 M?laga (Spain)
> *www.aplitop.com
> 
 <https://www.facebook.com/AplitopSL/>    <https://twitter.com/aplitop>    <https://www.linkedin.com/company/aplitop>    <https://www.youtube.com/user/aplitop>*
> In accordance with the provisions of the European Regulation of Data Protection 2016/679 (Reglamento Europeo de Protecci?n de Datos 2016/679), we inform you that the data and the information you provide us through this medium will be used by APLITOP, S.L., with C.I.F. B-92543396 and with address at C / Sumatra, 9, Malaga, 29190, in order to answer your questions and inform you about our products. The data provided will be kept as long as it does not request its cessation and will not be transferred to third parties except in cases where there is a legal obligation. You have the right to access your personal data, correct inaccurate data or request its deletion when the data is no longer necessary for the purposes that were collected, as well as any rights recognized in the RGPD 2016/679
 <https://www.aplitop.com/New/en/443/publication-of-point-clouds-on-web>
> 
> 
 <https://www.aplitop.com/New/en/438/tcpmdt-v9-is-here> <https://www.aplitop.com/Event/en/429/aplitop-at-intergeo-2022-essen>
> 
 <https://www.aplitop.com/Event/en/358/intergeo-2019>
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/3aec691c/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Facebook_32x32_a745adb8-c250-4372-8480-e77f503dad3d.png
Type: image/png
Size: 365 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/3aec691c/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Twitter_32x32_858247f6-9d4a-4740-a6b3-9b5ebfd98a97.png
Type: image/png
Size: 619 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/3aec691c/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Linkedin_32x32_154d63de-bf68-468f-9eb0-ffed102fac77.png
Type: image/png
Size: 468 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/3aec691c/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Youtube_32x32_0dea15dd-3774-4086-be9d-f62560b70c86.png
Type: image/png
Size: 817 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/3aec691c/attachment-0003.png>

From bradh at frogmouth.net  Tue May  9 02:09:46 2023
From: bradh at frogmouth.net (Brad Hards)
Date: Tue, 09 May 2023 19:09:46 +1000
Subject: [gdal-dev] Space Disk/Memory of Image
In-Reply-To: <AM0P192MB0498FCAC0D013034388ECD37BB769@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>
References: <3d652b5c-aa92-4a2a-85be-25316f1f7b0b.ba94d704-e79f-4907-b4e6-7c540f2b307c.d3b8f967-4ac2-4387-954a-ecda5fc65211@emailsignatures365.codetwo.com>
 <AM0P192MB0498FCAC0D013034388ECD37BB769@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>
Message-ID: <5931248.lOV4Wx5bFT@audax>

On Tuesday, 9 May 2023 6:47:39 PM AEST Elena Ruiz wrote:
> Hello, I need to know the disk size of an image, I calculate it using the
> following formula:
> 
> Disk size=( sizex*sizey*bits per pixel)/8 =memory size without compression
> 
> But when the image is compressed on disk it occupies less and the size in
> memory is much larger, is there some method in the C++ GDAL API, to obtain
> the size on disk, size on memory, or the compression factor? 

I think the math is fine for the size in memory (although depending on tiling, 
you might not have it all loaded).

For size on disk, the GDAL API probably isn't the best option. Why not use 
stat(2)/fstat(2)/lstat(2)? That will almost always be faster and at least as 
accurate than anything you can calculate.

Brad




From vijay.kurhade at gmail.com  Tue May  9 04:54:36 2023
From: vijay.kurhade at gmail.com (Vijay Kurhade)
Date: Tue, 9 May 2023 17:24:36 +0530
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
Message-ID: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>

Hi;

I have a long pending issue with Shapefile and using proper Geo-coordinates
for it;
i need to place it in Pune, India with actual 4 Geo-Coordinates but
everytime My shapefile gets placed into earth's center mostly Africa.

What is the solution; How can I ensure the shapefile uses those lat/long 4
coordinates and is placed on Pune, India in Map rather than somewhere else?

Thanks in Advance.

Regards-
Vijay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/a148d5e1/attachment.htm>

From dmorissette at mapgears.com  Tue May  9 05:33:03 2023
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Tue, 9 May 2023 08:33:03 -0400
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release
In-Reply-To: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
References: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
Message-ID: <713d11c0-646c-97cc-087e-c276fb8265bb@mapgears.com>

+1

Daniel

On 2023-05-08 09:02, Even Rouault wrote:
> Hi,
> 
> Motion:
> 
> Adopt GDAL 3.7.0RC1 as 3.7.0 release
> 
> Starting with my +1
> 
> Even
> 

-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201


From mateusz at loskot.net  Tue May  9 05:35:05 2023
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 9 May 2023 14:35:05 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release
In-Reply-To: <713d11c0-646c-97cc-087e-c276fb8265bb@mapgears.com>
References: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
 <713d11c0-646c-97cc-087e-c276fb8265bb@mapgears.com>
Message-ID: <CABUeae_ZJMiP=No-2GaBQbGTWMNaeQ_sndzAxCQmUdJFbfpMvA@mail.gmail.com>

+1 Mateusz

On Tue, 9 May 2023 at 14:33, Daniel Morissette <dmorissette at mapgears.com> wrote:
>
> +1
>
> Daniel
>
> On 2023-05-08 09:02, Even Rouault wrote:
> > Hi,
> >
> > Motion:
> >
> > Adopt GDAL 3.7.0RC1 as 3.7.0 release
> >
> > Starting with my +1
> >
> > Even
> >
>
> --
> Daniel Morissette
> Mapgears Inc
> T: +1 418-696-5056 #201
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Mateusz Loskot, http://mateusz.loskot.net

From rob.hewy at gmail.com  Tue May  9 05:37:52 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Tue, 9 May 2023 05:37:52 -0700
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
In-Reply-To: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
References: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
Message-ID: <CAG_Q50RoBEWteTqaeew71yvoB+fDNHAKLZJxX8zboYi5JNff_w@mail.gmail.com>

It sounds like the lat and longs are being plotted as Web Mercator meters.
I could be wrong


Is there a .PRJ file?

How are you viewing the data:
QGIS
Open layers
Leaflet



On Tue, May 9, 2023, 04:55 Vijay Kurhade <vijay.kurhade at gmail.com> wrote:

> Hi;
>
> I have a long pending issue with Shapefile and using proper
> Geo-coordinates for it;
> i need to place it in Pune, India with actual 4 Geo-Coordinates but
> everytime My shapefile gets placed into earth's center mostly Africa.
>
> What is the solution; How can I ensure the shapefile uses those lat/long 4
> coordinates and is placed on Pune, India in Map rather than somewhere else?
>
> Thanks in Advance.
>
> Regards-
> Vijay
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/4ed75b48/attachment.htm>

From j1 at jimenezshaw.com  Tue May  9 08:21:16 2023
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 9 May 2023 17:21:16 +0200
Subject: [gdal-dev] Reading raster file
Message-ID: <CADRrdKtc9QLxEFfc65rStgEbJHio_GEV1kMUsJY77txn9UHEBA@mail.gmail.com>

Hi

I want to read the Argentinian Geoid model with GDAL.
It is an ascii raster floating-point file with just one band.
https://dnsg.ign.gob.ar/apps/geoidear/documentos/GEOIDE-Ar16.gri (22 MB)


The content is starts with:

   -57.0007400000   -20.0166670000   -76.0000000000   -52.0161870000
0.01666700000000001   0.01666700000000000

13.278 13.310 13.321 13.322 13.357 13.383 13.429 13.442
13.477 13.504 13.516 13.549 13.574 13.549 13.570 13.602
13.623 13.584 13.574 13.661 13.766 13.802 13.823 13.821
13.835 13.881 13.907 13.944 14.005 14.060 14.085 14.070
14.098 14.153 14.221 14.259 14.277 14.396 14.446 14.451
14.390 14.471 14.572 14.645 14.681 14.674 14.702 14.745
14.796 14.843 14.872 14.872 14.952 15.065 15.110 15.053
15.056 15.050 15.095 15.126 15.125 15.154 15.222 15.261
15.244 15.369 15.480 15.519 15.464 15.462 15.505 15.477

and finishes with

19.069 19.065 19.057 19.047 19.039 19.031 19.021 19.012
19.004 18.997 18.990 18.987 18.987 18.988 18.991 18.998
19.001 19.009 19.027 19.042 19.067 19.141 19.209 19.208
19.179 19.156 19.147 19.150 19.152 19.156 19.164 19.155

Total number of lines: 399602

It seems to have a width of 1440 and height of 2220.

gdalinfo says

$ gdalinfo GEOIDE-Ar16.gri
ERROR 1: Maximum number of characters allowed reached.
ERROR 1: Couldn't determine X spacing
gdalinfo failed - unable to open 'GEOIDE-Ar16.gri'.

I do not know which exact format it is. I can deduce the meaning of the
values (specially knowing that it covers Argentina ;), but I would like to
read it directly if possible.

Is that a know format for GDAL?

Thanks,
Javier.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/84bbe878/attachment.htm>

From even.rouault at spatialys.com  Tue May  9 10:12:59 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 9 May 2023 19:12:59 +0200
Subject: [gdal-dev] Reading raster file
In-Reply-To: <CADRrdKtc9QLxEFfc65rStgEbJHio_GEV1kMUsJY77txn9UHEBA@mail.gmail.com>
References: <CADRrdKtc9QLxEFfc65rStgEbJHio_GEV1kMUsJY77txn9UHEBA@mail.gmail.com>
Message-ID: <fcf6dd8d-7548-db3e-5f02-42db5e996314@spatialys.com>

Javier,

The error message comes from the XYZ driver which is confused and 
believes it might be for it, but this is definitely not a .xyz file

There are quite a lot of variations of ASCII grid formats. This one 
reminds me a bit of the IGN France ones that are handled by the 
https://github.com/OSGeo/gdal-extra-drivers/blob/master/src/ignfheightasciigrid/ignfheightasciigrid.cpp 
driver (note that it has been retired as out of tree), but I can see 
that this .gri file has min_lat, max_lat first whereas the French ones 
have min_lon, max_lon :-)

I've tried with 
https://www.isgeoid.polimi.it/Geoid/America/Argentina/public/GEOIDEAR16_20160419.isg, 
linked from 
https://www.isgeoid.polimi.it/Geoid/America/Argentina/argentina2016_g.html 
.? Hopefully it has the same content as the .gri file. I had to push in 
https://github.com/OSGeo/gdal/pull/7730 a fix to open it as the rounding 
of coordinates & resolution is quite rough in those .isg files.

with the fix:

$ gdalinfo GEOIDEAR16_20160419.isg -mm
Driver: ISG/International Service for the Geoid
Files: GEOIDEAR16_20160419.isg
Size is 1440, 2220
Coordinate System is:
GEOGCRS["WGS 84",
 ??? DATUM["World Geodetic System 1984",
 ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
 ??????????? LENGTHUNIT["metre",1]]],
 ??? PRIMEM["Greenwich",0,
 ??????? ANGLEUNIT["degree",0.0174532925199433]],
 ??? CS[ellipsoidal,2],
 ??????? AXIS["geodetic latitude (Lat)",north,
 ??????????? ORDER[1],
 ??????????? ANGLEUNIT["degree",0.0174532925199433]],
 ??????? AXIS["geodetic longitude (Lon)",east,
 ??????????? ORDER[2],
 ??????????? ANGLEUNIT["degree",0.0174532925199433]],
 ??? ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (-76.009853500000006,-20.008733500000002)
Pixel Size = (0.016667000000000,-0.016667000000000)
Metadata:
 ? MODEL_NAME=GEOIDEAR16
 ? MODEL_TYPE=gravimetric
Corner Coordinates:
Upper Left? ( -76.0098535, -20.0087335) ( 76d 0'35.47"W, 20d 0'31.44"S)
Lower Left? ( -76.0098535, -57.0094735) ( 76d 0'35.47"W, 57d 0'34.10"S)
Upper Right ( -52.0093735, -20.0087335) ( 52d 0'33.74"W, 20d 0'31.44"S)
Lower Right ( -52.0093735, -57.0094735) ( 52d 0'33.74"W, 57d 0'34.10"S)
Center????? ( -64.0096135, -38.5091035) ( 64d 0'34.61"W, 38d30'32.77"S)
Band 1 Block=1440x1 Type=Float32, ColorInterp=Undefined
 ??? Computed Min/Max=-6.007,45.203
 ? NoData Value=-9999
 ? Unit Type: meters


Note that CRS is hard coded to WGS 84 by the driver, and should be 
altered to something more relevant.

Even


Le 09/05/2023 ? 17:21, Javier Jimenez Shaw a ?crit?:
> Hi
>
> I want to read the Argentinian Geoid model with GDAL.
> It is an ascii raster floating-point file with just one band.
> https://dnsg.ign.gob.ar/apps/geoidear/documentos/GEOIDE-Ar16.gri (22 MB)
>
>
> The content is starts with:
>
> ?? -57.0007400000 ? -20.0166670000 ? -76.0000000000 -52.0161870000 ? 
> 0.01666700000000001 ? 0.01666700000000000
>
> 13.278 13.310 13.321 13.322 13.357 13.383 13.429 13.442
> 13.477 13.504 13.516 13.549 13.574 13.549 13.570 13.602
> 13.623 13.584 13.574 13.661 13.766 13.802 13.823 13.821
> 13.835 13.881 13.907 13.944 14.005 14.060 14.085 14.070
> 14.098 14.153 14.221 14.259 14.277 14.396 14.446 14.451
> 14.390 14.471 14.572 14.645 14.681 14.674 14.702 14.745
> 14.796 14.843 14.872 14.872 14.952 15.065 15.110 15.053
> 15.056 15.050 15.095 15.126 15.125 15.154 15.222 15.261
> 15.244 15.369 15.480 15.519 15.464 15.462 15.505 15.477
>
> and finishes with
>
> 19.069 19.065 19.057 19.047 19.039 19.031 19.021 19.012
> 19.004 18.997 18.990 18.987 18.987 18.988 18.991 18.998
> 19.001 19.009 19.027 19.042 19.067 19.141 19.209 19.208
> 19.179 19.156 19.147 19.150 19.152 19.156 19.164 19.155
>
> Total number of lines: 399602
>
> It seems to have a width of 1440 and height of 2220.
>
> gdalinfo says
>
> $ gdalinfo GEOIDE-Ar16.gri
> ERROR 1: Maximum number of characters allowed reached.
> ERROR 1: Couldn't determine X spacing
> gdalinfo failed - unable to open 'GEOIDE-Ar16.gri'.
>
> I do not know which exact format it is. I can deduce the meaning of 
> the values (specially knowing that it covers Argentina ;), but I would 
> like to read it directly if possible.
>
> Is that a know format for GDAL?
>
> Thanks,
> Javier.
> .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/843d85dc/attachment-0001.htm>

From rob.hewy at gmail.com  Tue May  9 12:57:44 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Tue, 9 May 2023 12:57:44 -0700
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
In-Reply-To: <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
References: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
 <CAG_Q50RoBEWteTqaeew71yvoB+fDNHAKLZJxX8zboYi5JNff_w@mail.gmail.com>
 <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
Message-ID: <CAG_Q50QyGEuNARDbbJTPtCZeX1WP-aoFAsRPvxAcLZvxviUMcA@mail.gmail.com>

Hi,

Different from what I originally thought.

Does the image below demonstrate the problem?
https://i.imgur.com/lAMwZmG.png

Looks like a scale issue as well.

Rob



On Tue, May 9, 2023 at 12:13?PM Vijay Kurhade <vijay.kurhade at gmail.com>
wrote:

> Hi Robert;
>
> I am sharing a shape file and AutoCAD (.dwg) file. I have geo-coordinated
> the CAD file and then converted it into .shp file using following steps:
>
> 1)      Selected ?geographic location? option in AutoCAD
>
> 2)      Entered latitude (18.5652) and longitude (73.7888) and elevation
> (606 meters)
>
> 3)      Selected ?GIS coordinate system? as ?WORLD-MERCATOR(WGS84)
>
> 4)      Selected time zone as ?GMT+5:30 Chennai, Kolkata, Mumbai, New
> Delhi?
>
> 5)      Drawing unit ?Inches?
>
> 6)      Selected geo-graphic location in the AutoCAD drawing
>
> 7)      Specified the north direction angle. Repeated the above steps to
> mark three more geographic locations in the CAD file
>
> 8)      Saved the CAD file and converted it into shape file using online
> tool ?https://mygeodata.cloud/conversion?
>
>
> I hope this helps you in analyzing the issue.
>
>
> Regards-
>
> Vijay
>
> On Tue, May 9, 2023 at 6:08?PM Robert Hewlett <rob.hewy at gmail.com> wrote:
>
>> It sounds like the lat and longs are being plotted as Web Mercator
>> meters. I could be wrong
>>
>>
>> Is there a .PRJ file?
>>
>> How are you viewing the data:
>> QGIS
>> Open layers
>> Leaflet
>>
>>
>>
>> On Tue, May 9, 2023, 04:55 Vijay Kurhade <vijay.kurhade at gmail.com> wrote:
>>
>>> Hi;
>>>
>>> I have a long pending issue with Shapefile and using proper
>>> Geo-coordinates for it;
>>> i need to place it in Pune, India with actual 4 Geo-Coordinates but
>>> everytime My shapefile gets placed into earth's center mostly Africa.
>>>
>>> What is the solution; How can I ensure the shapefile uses those lat/long
>>> 4 coordinates and is placed on Pune, India in Map rather than somewhere
>>> else?
>>>
>>> Thanks in Advance.
>>>
>>> Regards-
>>> Vijay
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/0afb8b68/attachment.htm>

From norman.barker at gmail.com  Tue May  9 13:44:47 2023
From: norman.barker at gmail.com (Norman Barker)
Date: Tue, 9 May 2023 15:44:47 -0500
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release
In-Reply-To: <CABUeae_ZJMiP=No-2GaBQbGTWMNaeQ_sndzAxCQmUdJFbfpMvA@mail.gmail.com>
References: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
 <713d11c0-646c-97cc-087e-c276fb8265bb@mapgears.com>
 <CABUeae_ZJMiP=No-2GaBQbGTWMNaeQ_sndzAxCQmUdJFbfpMvA@mail.gmail.com>
Message-ID: <CAN_Dn-GDxz9i7hWpwmEDHKByeNhz2bOQd9boQMTGmx_xqAkJgA@mail.gmail.com>

+1 Norman

On Tue, May 9, 2023 at 7:35?AM Mateusz Loskot <mateusz at loskot.net> wrote:

> +1 Mateusz
>
> On Tue, 9 May 2023 at 14:33, Daniel Morissette <dmorissette at mapgears.com>
> wrote:
> >
> > +1
> >
> > Daniel
> >
> > On 2023-05-08 09:02, Even Rouault wrote:
> > > Hi,
> > >
> > > Motion:
> > >
> > > Adopt GDAL 3.7.0RC1 as 3.7.0 release
> > >
> > > Starting with my +1
> > >
> > > Even
> > >
> >
> > --
> > Daniel Morissette
> > Mapgears Inc
> > T: +1 418-696-5056 #201
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> --
> Mateusz Loskot, http://mateusz.loskot.net
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230509/f220120a/attachment.htm>

From mdsumner at gmail.com  Wed May 10 00:03:55 2023
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 10 May 2023 17:03:55 +1000
Subject: [gdal-dev] request limit on netcdf server ?
Message-ID: <CAAcGz997pbVhLeJJOyzmZC94epajWHcCKEJ9mHOgWar6cO+uSA@mail.gmail.com>

I'm having trouble with remote dsn from here:

https://esgf.nci.org.au/thredds/catalog/esgcet/cmip5/output1/CSIRO-BOM/ACCESS1-3/rcp85/day/ocean/day/r1i1p1/cmip5.output1.CSIRO-BOM.ACCESS1-3.rcp85.day.ocean.day.r1i1p1.v20120413.html#cmip5.output1.CSIRO-BOM.ACCESS1-3.rcp85.day.ocean.day.r1i1p1.v20120413

The support tells me I have been blocked for requests from my IP that
exceed 300 in 5min. Apparently, daily you are cleared from the blocklist
but with experiments today I've had two machines blocked (and now manually
cleared). Still, it's hard to test :0

I've stripped down to this dsn, I thought limiting  the driver might limit
the requests because it won't cascade down the driver identification (but
I'm not sure if -if adds anymore than the "NETCDF:" is already doing). At
any rate I need to target a subdataset so I need that syntax.

"vrt://NETCDF:\"/vsicurl/
https://esgf.nci.org.au/thredds/fileServer/master/CMIP5/output1/CSIRO-BOM/ACCESS1-3/rcp85/day/ocean/day/r1i1p1/v20120413/tos/tos_day_ACCESS1-3_rcp85_r1i1p1_20560101-20651231.nc\
":tos?bands=1&if=NETCDF"

It takes quite a while to read one band, but the warper and RasterIO result
is good.  I think the machine is now blocked again, I wasn't able to also
run gdalinfo after warper and straight read.

I'm just doing standalone from-scratch opens, not with a persistent dataset
- I assume that would reduce the request load, which I'll try in python
when I have access again.

Questions:

1. Are there other things I can pursue to reduce my request load on the
server?

2. Can this actually be faster?  RasterIO for one band 360x300 was
minutes.  (I appreciate this might be better suited to mdim, but that seems
similarly problematic in terms of requests and performance).

I've tried the config options   GDAL_NETCDF_VERIFY_DIMS / STRICT and
GDAL_NETCDF_IGNORE_XY_AXIS_NAME_CHECK=/YES and that does seem to have
helped the warper request but RasterIO was still slow.
.
This was on GDAL 3.8.0dev-414270a94b-dirty, released 2023/05/09 (debug
build)

I see this repeated warning

Warning 1: dimension #2 (i) is not a Longitude/X dimension.
Warning 1: dimension #1 (j) is not a Latitude/Y dimension.
Warning 1: dimension #1 (i) is not a Longitude/X dimension.
Warning 1: dimension #0 (j) is not a Latitude/Y dimension.
Warning 1: dimension #1 (i) is not a Longitude/X dimension.
Warning 1: dimension #0 (j) is not a Latitude/Y dimension.

Thank you

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230510/24a285d5/attachment-0001.htm>

From devdatta at tengshe.in  Wed May 10 00:56:10 2023
From: devdatta at tengshe.in (Devdatta Tengshe)
Date: Wed, 10 May 2023 13:26:10 +0530
Subject: [gdal-dev] How to get the same behaviour as the 'Difference tool'
 of QGIS, in ogr2ogr?
Message-ID: <CAOQOUMvZjEao6NXt5asFh_dNyuBfRCNA=BHEKaAmqS94w5WbaQ@mail.gmail.com>

I have a shapefile with lines, and another with polygons. I want to
generate an output of those lines that are not covered by any polygon.

I can perfectly do this in QGIS's Difference tool, but want to do it with
og2ogr. (since it will be a part of a cronjob)

I tried to do it, using the following command:
`ogr2ogr -overwrite out.shp line.shp -dialect SQLite -sql "select
st_difference(a.geometry, b.geometry) as geometry from line as a,
'polygon.shp'.polygon as b"`

But it just generated a .dbf file.

This behavior has also been reported here:
https://gis.stackexchange.com/a/324837/442

Is this a bug, or expected behavior? Is there a better way to achieve what
I want to?


Regards,
Devdatta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230510/8668e80b/attachment.htm>

From ujaval at spatialthoughts.com  Wed May 10 01:00:23 2023
From: ujaval at spatialthoughts.com (Ujaval Gandhi)
Date: Wed, 10 May 2023 08:00:23 +0000
Subject: [gdal-dev] How to get the same behaviour as the 'Difference
 tool' of QGIS, in ogr2ogr?
In-Reply-To: <CAOQOUMvZjEao6NXt5asFh_dNyuBfRCNA=BHEKaAmqS94w5WbaQ@mail.gmail.com>
References: <CAOQOUMvZjEao6NXt5asFh_dNyuBfRCNA=BHEKaAmqS94w5WbaQ@mail.gmail.com>
Message-ID: <f4be6953-6fed-bea9-13cf-a28dbbf964a6@spatialthoughts.com>

There's a new script for doing vector overlays called ogr_layer_algebra. You can
try that https://gdal.org/programs/ogr_layer_algebra.html
[https://mailtrack.io/trace/link/8844f1b0a00bc9c8c6b7d994f2ef6776bbbad413?url=https%3A%2F%2Fgdal.org%2Fprograms%2Fogr_layer_algebra.html&userId=8747767&signature=f3a663794cf05dc3]

---
Ujaval Gandhi
Spatial Thoughts
www.spatialthoughts.com
[https://mailtrack.io/trace/link/4ddad0f9cf2b5c3c4c75c835dbf4a885ea30591b?url=http%3A%2F%2Fwww.spatialthoughts.com&userId=8747767&signature=de7d85fbbe1e0bcd]




[data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=3D]
On Wed, May 10, 2023 at 1:26?PM Devdatta Tengshe <devdatta at tengshe.in> wrote:

> I have a shapefile with lines, and another with polygons. I want to generate
> an output of those lines that are not covered by any polygon.
> 
> 
> I can perfectly do this in QGIS's Difference tool, but want to do it with
> og2ogr. (since it will be a part of a cronjob)
> 
> 
> I tried to do it, using the following command:
> `ogr2ogr -overwrite out.shp line.shp -dialect SQLite -sql "select
> st_difference(a.geometry, b.geometry) as geometry from line as a,
> 'polygon.shp'.polygon as b"`
> 
> 
> But it just generated a .dbf file.
> 
> 
> This behavior has also been reported here: https://gis.stackexchange.com/
> a/324837/442 [https://gis.stackexchange.com/a/324837/442]
> 
> 
> Is this a bug, or expected behavior? Is there a better way to achieve what I
> want to?
> 
> 
> 
> Regards,
> Devdatta
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org [gdal-dev at lists.osgeo.org]
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> [https://lists.osgeo.org/mailman/listinfo/gdal-dev]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230510/9b530909/attachment.htm>

From devdatta at tengshe.in  Wed May 10 01:24:25 2023
From: devdatta at tengshe.in (Devdatta Tengshe)
Date: Wed, 10 May 2023 13:54:25 +0530
Subject: [gdal-dev] How to get the same behaviour as the 'Difference
 tool' of QGIS, in ogr2ogr?
In-Reply-To: <f4be6953-6fed-bea9-13cf-a28dbbf964a6@spatialthoughts.com>
References: <CAOQOUMvZjEao6NXt5asFh_dNyuBfRCNA=BHEKaAmqS94w5WbaQ@mail.gmail.com>
 <f4be6953-6fed-bea9-13cf-a28dbbf964a6@spatialthoughts.com>
Message-ID: <CAOQOUMv8bAEakdOkNsoQ2-KkjVUu6Xh89E7fYe9AUwaW=HBeJQ@mail.gmail.com>

Thanks a Ton, Ujaval!

The following command gave me the expected output:
`ogr_layer_algebra.py ERASE -input_ds line.shp -method_ds polygon.shp
-output_ds output.shp`


Regards,
Devdatta


On Wed, 10 May 2023 at 13:30, Ujaval Gandhi <ujaval at spatialthoughts.com>
wrote:

> There's a new script for doing vector overlays called ogr_layer_algebra.
> You can try that https://gdal.org/programs/ogr_layer_algebra.html
> <https://mailtrack.io/trace/link/8844f1b0a00bc9c8c6b7d994f2ef6776bbbad413?w=ZGV2ZGF0dGFAdGVuZ3NoZS5pbg&url=https%3A%2F%2Fgdal.org%2Fprograms%2Fogr_layer_algebra.html&userId=8747767&signature=f3a663794cf05dc3>
> ---
> Ujaval Gandhi
> Spatial Thoughts
> www.spatialthoughts.com
> <https://mailtrack.io/trace/link/4ddad0f9cf2b5c3c4c75c835dbf4a885ea30591b?w=ZGV2ZGF0dGFAdGVuZ3NoZS5pbg&url=http%3A%2F%2Fwww.spatialthoughts.com&userId=8747767&signature=de7d85fbbe1e0bcd>
>
>
>
> On Wed, May 10, 2023 at 1:26?PM Devdatta Tengshe <devdatta at tengshe.in>
> wrote:
>
>> I have a shapefile with lines, and another with polygons. I want to
>> generate an output of those lines that are not covered by any polygon.
>>
>> I can perfectly do this in QGIS's Difference tool, but want to do it with
>> og2ogr. (since it will be a part of a cronjob)
>>
>> I tried to do it, using the following command:
>> `ogr2ogr -overwrite out.shp line.shp -dialect SQLite -sql "select
>> st_difference(a.geometry, b.geometry) as geometry from line as a,
>> 'polygon.shp'.polygon as b"`
>>
>> But it just generated a .dbf file.
>>
>> This behavior has also been reported here:
>> https://gis.stackexchange.com/a/324837/442
>>
>> Is this a bug, or expected behavior? Is there a better way to achieve
>> what I want to?
>>
>>
>> Regards,
>> Devdatta
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230510/2269fb90/attachment.htm>

From even.rouault at spatialys.com  Wed May 10 08:16:52 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 10 May 2023 17:16:52 +0200
Subject: [gdal-dev] request limit on netcdf server ?
In-Reply-To: <CAAcGz997pbVhLeJJOyzmZC94epajWHcCKEJ9mHOgWar6cO+uSA@mail.gmail.com>
References: <CAAcGz997pbVhLeJJOyzmZC94epajWHcCKEJ9mHOgWar6cO+uSA@mail.gmail.com>
Message-ID: <acaba514-89d2-2230-cacf-7e29b66a4b24@spatialys.com>

Michael,

analysis and improvements in https://github.com/OSGeo/gdal/pull/7737

Even

Le 10/05/2023 ? 09:03, Michael Sumner a ?crit?:
> I'm having trouble with remote dsn from here:
>
> https://esgf.nci.org.au/thredds/catalog/esgcet/cmip5/output1/CSIRO-BOM/ACCESS1-3/rcp85/day/ocean/day/r1i1p1/cmip5.output1.CSIRO-BOM.ACCESS1-3.rcp85.day.ocean.day.r1i1p1.v20120413.html#cmip5.output1.CSIRO-BOM.ACCESS1-3.rcp85.day.ocean.day.r1i1p1.v20120413
>
> The support tells me I have been blocked for requests from my IP that 
> exceed 300 in 5min. Apparently, daily you are cleared from the 
> blocklist but with experiments today I've had two machines blocked 
> (and now manually cleared). Still, it's hard to test :0
>
> I've stripped down to this dsn, I thought limiting? the driver might 
> limit the requests because it won't cascade down the driver 
> identification (but I'm not sure if -if adds anymore than the 
> "NETCDF:" is already doing). At any rate I need to target a subdataset 
> so I need that syntax.
>
> "vrt://NETCDF:\"/vsicurl/https://esgf.nci.org.au/thredds/fileServer/master/CMIP5/output1/CSIRO-BOM/ACCESS1-3/rcp85/day/ocean/day/r1i1p1/v20120413/tos/tos_day_ACCESS1-3_rcp85_r1i1p1_20560101-20651231.nc\ 
> <https://esgf.nci.org.au/thredds/fileServer/master/CMIP5/output1/CSIRO-BOM/ACCESS1-3/rcp85/day/ocean/day/r1i1p1/v20120413/tos/tos_day_ACCESS1-3_rcp85_r1i1p1_20560101-20651231.nc\>":tos?bands=1&if=NETCDF"
>
> It takes quite a while to read one band, but the warper and RasterIO 
> result is good.? I think the machine is now blocked again, I wasn't 
> able to also run gdalinfo after warper and straight read.
>
> I'm just doing standalone from-scratch opens, not with a persistent 
> dataset - I assume that would reduce the request load, which I'll try 
> in python when I have access again.
>
> Questions:
>
> 1. Are there other things I can pursue to reduce my request load on 
> the server?
>
> 2. Can this actually be faster?? RasterIO for one band 360x300 was 
> minutes.? (I appreciate this might be better suited to mdim, but that 
> seems similarly problematic in terms of requests and performance).
>
> I've tried the config options? ?GDAL_NETCDF_VERIFY_DIMS / STRICT and 
> GDAL_NETCDF_IGNORE_XY_AXIS_NAME_CHECK=/YES and that does seem to have 
> helped the warper request but RasterIO was still slow.
> .
> This was on GDAL 3.8.0dev-414270a94b-dirty, released 2023/05/09 (debug 
> build)
>
> I see this repeated warning
>
> Warning 1: dimension #2 (i) is not a Longitude/X dimension.
> Warning 1: dimension #1 (j) is not a Latitude/Y dimension.
> Warning 1: dimension #1 (i) is not a Longitude/X dimension.
> Warning 1: dimension #0 (j) is not a Latitude/Y dimension.
> Warning 1: dimension #1 (i) is not a Longitude/X dimension.
> Warning 1: dimension #0 (j) is not a Latitude/Y dimension.
>
> Thank you
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230510/93b15778/attachment-0001.htm>

From even.rouault at spatialys.com  Wed May 10 08:18:14 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 10 May 2023 17:18:14 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.0RC1 as 3.7.0 release
In-Reply-To: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
References: <0126f416-4216-89ab-e5dc-a83d31dc8db7@spatialys.com>
Message-ID: <681fb5df-8542-f6b3-31ac-62d57b86c592@spatialys.com>

Hi,

motion passed with +1 from PSC members HowardB, JukkaR, DanielM, 
MateuszL, NormanB and me.

Even

Le 08/05/2023 ? 15:02, Even Rouault a ?crit?:
> Hi,
>
> Motion:
>
> Adopt GDAL 3.7.0RC1 as 3.7.0 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed May 10 08:43:40 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 10 May 2023 17:43:40 +0200
Subject: [gdal-dev] GDAL 3.7.0 is released
Message-ID: <db7068b5-2469-235a-3c40-4d707ee5681d@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team and community, I am pleased to
announce the release of GDAL/OGR 3.7.0. GDAL/OGR is a C++ geospatial data
access library for raster and vector file formats, databases and web 
services.
It includes bindings for several languages, and a variety of command line
tools.

 ?? http://gdal.org/

The 3.7.0 release is a new feature release with the following highlights:

* [RFC 87](https://gdal.org/development/rfc/rfc87_signed_int8.html): Add 
GDT_Int8 support
* [RFC 88](https://gdal.org/development/rfc/rfc88_googletest.html): 
switch to GoogleTest framework for C++ tests
* [RFC 
89](https://gdal.org/development/rfc/rfc89_sql_logging_callback.html): 
SQL query logging callback
* [RFC 
90](https://gdal.org/development/rfc/rfc90_read_compressed_data.html): 
Direct access to compressed raster data
* [RFC 91](https://gdal.org/development/rfc/rfc91_dataset_close.html): 
GDALDataset::Close() method
* [RFC 93](https://gdal.org/development/rfc/rfc93_update_feature.html): 
OGRLayer::UpdateFeature() method
* [RFC 
94](https://gdal.org/development/rfc/rfc94_field_precision_width_metadata.html): 
Numeric fields width/precision metadata
* ogrinfo: make it accessible through a new GDALVectorInfo() C API call, 
and a -json switch
* Add read-only raster driver 
[NOAA_B](https://gdal.org/drivers/raster/noaa_b.html) to read NOAA 
GEOCON/NADCON5 .b grids
* Add read-only raster driver 
[NSIDCbin](https://gdal.org/drivers/raster/nsidcbin.html) for Sea Ice 
Concentrations
* Add read-only vector [GTFS](https://gdal.org/drivers/vector/gtfs.html) 
(General Transit Feed Specification) driver
* [TileDB](https://gdal.org/drivers/vector/tiledb.html): add read/write 
vector side
* Add support for [SOZip](https://sozip.org) (Seek Optimized ZIP) with 
enhanced /vsizip/ virtual file system and a new sozip utility
* [OpenFileGDB](https://gdal.org/drivers/raster/openfilegdb.html): add 
read-only support for raster datasets (.gdb v10)
* PNG: 1.7-2.0x speed-up in whole image decompression with libdeflate on 
Intel/AMD CPUs. Benefits to GPKG, MRF drivers
* [RFC 
69](https://gdal.org/development/rfc/rfc69_cplusplus_formatting.html): 
C++ code reformatting
* Code linting and security fixes
* Remove any traces of Rasdaman driver, now moved to 
OSGeo/gdal-extra-drivers repository (#4808)
* Bump of shared lib major version

More complete information on the new features and fixes in the 3.7.0 
release can be found at:

 ? https://github.com/OSGeo/gdal/blob/v3.7.0/NEWS.md

The release can be downloaded from:
 ? * https://download.osgeo.org/gdal/3.7.0/gdal370.zip - source as a zip
 ? * https://download.osgeo.org/gdal/3.7.0/gdal-3.7.0.tar.gz - source as 
.tar.gz
 ? * https://download.osgeo.org/gdal/3.7.0/gdal-3.7.0.tar.xz - source as 
.tar.xz
 ? * https://download.osgeo.org/gdal/3.7.0/gdalautotest-3.7.0.tar.gz - 
test suite
 ? * https://download.osgeo.org/gdal/3.7.0/gdal370doc.zip - 
documentation / website

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From j1 at jimenezshaw.com  Wed May 10 15:12:33 2023
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 11 May 2023 00:12:33 +0200
Subject: [gdal-dev] Reading raster file
In-Reply-To: <fcf6dd8d-7548-db3e-5f02-42db5e996314@spatialys.com>
References: <CADRrdKtc9QLxEFfc65rStgEbJHio_GEV1kMUsJY77txn9UHEBA@mail.gmail.com>
 <fcf6dd8d-7548-db3e-5f02-42db5e996314@spatialys.com>
Message-ID: <CADRrdKs4t9XtrY3fzjWGS10SY8LJiX0Y8QLBSuWwpmFxmsVyWQ@mail.gmail.com>

Thanks Even

I realized that "adjusting" the header a bit, it is read by GDAL as AAIGrid
https://gdal.org/drivers/raster/aaigrid.html

NCOLS 1440
NROWS 2220
XLLCENTER -76.0000000000
YLLCENTER -57.0007400000
CELLSIZE 0.01666700000000000
NODATA_VALUE -999


On Tue, 9 May 2023 at 19:12, Even Rouault <even.rouault at spatialys.com>
wrote:

> Javier,
>
> The error message comes from the XYZ driver which is confused and believes
> it might be for it, but this is definitely not a .xyz file
>
> There are quite a lot of variations of ASCII grid formats. This one
> reminds me a bit of the IGN France ones that are handled by the
> https://github.com/OSGeo/gdal-extra-drivers/blob/master/src/ignfheightasciigrid/ignfheightasciigrid.cpp
> driver (note that it has been retired as out of tree), but I can see that
> this .gri file has min_lat, max_lat first whereas the French ones have
> min_lon, max_lon :-)
>
> I've tried with
> https://www.isgeoid.polimi.it/Geoid/America/Argentina/public/GEOIDEAR16_20160419.isg,
> linked from
> https://www.isgeoid.polimi.it/Geoid/America/Argentina/argentina2016_g.html
> .  Hopefully it has the same content as the .gri file. I had to push in
> https://github.com/OSGeo/gdal/pull/7730 a fix to open it as the rounding
> of coordinates & resolution is quite rough in those .isg files.
>
> with the fix:
>
> $ gdalinfo GEOIDEAR16_20160419.isg -mm
> Driver: ISG/International Service for the Geoid
> Files: GEOIDEAR16_20160419.isg
> Size is 1440, 2220
> Coordinate System is:
> GEOGCRS["WGS 84",
>     DATUM["World Geodetic System 1984",
>         ELLIPSOID["WGS 84",6378137,298.257223563,
>             LENGTHUNIT["metre",1]]],
>     PRIMEM["Greenwich",0,
>         ANGLEUNIT["degree",0.0174532925199433]],
>     CS[ellipsoidal,2],
>         AXIS["geodetic latitude (Lat)",north,
>             ORDER[1],
>             ANGLEUNIT["degree",0.0174532925199433]],
>         AXIS["geodetic longitude (Lon)",east,
>             ORDER[2],
>             ANGLEUNIT["degree",0.0174532925199433]],
>     ID["EPSG",4326]]
> Data axis to CRS axis mapping: 2,1
> Origin = (-76.009853500000006,-20.008733500000002)
> Pixel Size = (0.016667000000000,-0.016667000000000)
> Metadata:
>   MODEL_NAME=GEOIDEAR16
>   MODEL_TYPE=gravimetric
> Corner Coordinates:
> Upper Left  ( -76.0098535, -20.0087335) ( 76d 0'35.47"W, 20d 0'31.44"S)
> Lower Left  ( -76.0098535, -57.0094735) ( 76d 0'35.47"W, 57d 0'34.10"S)
> Upper Right ( -52.0093735, -20.0087335) ( 52d 0'33.74"W, 20d 0'31.44"S)
> Lower Right ( -52.0093735, -57.0094735) ( 52d 0'33.74"W, 57d 0'34.10"S)
> Center      ( -64.0096135, -38.5091035) ( 64d 0'34.61"W, 38d30'32.77"S)
> Band 1 Block=1440x1 Type=Float32, ColorInterp=Undefined
>     Computed Min/Max=-6.007,45.203
>   NoData Value=-9999
>   Unit Type: meters
>
>
> Note that CRS is hard coded to WGS 84 by the driver, and should be altered
> to something more relevant.
>
> Even
>
>
> Le 09/05/2023 ? 17:21, Javier Jimenez Shaw a ?crit :
>
> Hi
>
> I want to read the Argentinian Geoid model with GDAL.
> It is an ascii raster floating-point file with just one band.
> https://dnsg.ign.gob.ar/apps/geoidear/documentos/GEOIDE-Ar16.gri (22 MB)
>
>
> The content is starts with:
>
>    -57.0007400000   -20.0166670000   -76.0000000000   -52.0161870000
> 0.01666700000000001   0.01666700000000000
>
> 13.278 13.310 13.321 13.322 13.357 13.383 13.429 13.442
> 13.477 13.504 13.516 13.549 13.574 13.549 13.570 13.602
> 13.623 13.584 13.574 13.661 13.766 13.802 13.823 13.821
> 13.835 13.881 13.907 13.944 14.005 14.060 14.085 14.070
> 14.098 14.153 14.221 14.259 14.277 14.396 14.446 14.451
> 14.390 14.471 14.572 14.645 14.681 14.674 14.702 14.745
> 14.796 14.843 14.872 14.872 14.952 15.065 15.110 15.053
> 15.056 15.050 15.095 15.126 15.125 15.154 15.222 15.261
> 15.244 15.369 15.480 15.519 15.464 15.462 15.505 15.477
>
> and finishes with
>
> 19.069 19.065 19.057 19.047 19.039 19.031 19.021 19.012
> 19.004 18.997 18.990 18.987 18.987 18.988 18.991 18.998
> 19.001 19.009 19.027 19.042 19.067 19.141 19.209 19.208
> 19.179 19.156 19.147 19.150 19.152 19.156 19.164 19.155
>
> Total number of lines: 399602
>
> It seems to have a width of 1440 and height of 2220.
>
> gdalinfo says
>
> $ gdalinfo GEOIDE-Ar16.gri
> ERROR 1: Maximum number of characters allowed reached.
> ERROR 1: Couldn't determine X spacing
> gdalinfo failed - unable to open 'GEOIDE-Ar16.gri'.
>
> I do not know which exact format it is. I can deduce the meaning of the
> values (specially knowing that it covers Argentina ;), but I would like to
> read it directly if possible.
>
> Is that a know format for GDAL?
>
> Thanks,
> Javier.
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/dad21b04/attachment.htm>

From cubukcu at haritaevi.com  Wed May 10 23:03:11 2023
From: cubukcu at haritaevi.com (=?utf-8?B?QXJ6dSDDh1VCVUvDh1U=?=)
Date: Thu, 11 May 2023 09:03:11 +0300
Subject: [gdal-dev] Question About OGR
Message-ID: <1965381683784926@mail.yandex.com.tr>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/fdfda2d2/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 8409 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/fdfda2d2/attachment-0001.png>

From vijay.kurhade at gmail.com  Wed May 10 23:53:16 2023
From: vijay.kurhade at gmail.com (Vijay Kurhade)
Date: Thu, 11 May 2023 12:23:16 +0530
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
In-Reply-To: <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
References: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
 <CAG_Q50RoBEWteTqaeew71yvoB+fDNHAKLZJxX8zboYi5JNff_w@mail.gmail.com>
 <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
Message-ID: <CAEcx6hbk9G1smC3vkeDJjpbDL+MCqGoO00r=sGgKaJQvs6UdkQ@mail.gmail.com>

Hello

I am sharing a shape file and AutoCAD (.dwg) file. I have geo-coordinated
the CAD file and then converted it into .shp file using following steps:
1)      Selected ?geographic location? option in AutoCAD

2)      Entered latitude (18.5652) and longitude (73.7888) and elevation
(606 meters)

3)      Selected ?GIS coordinate system? as ?WORLD-MERCATOR(WGS84)

4)      Selected time zone as ?GMT+5:30 Chennai, Kolkata, Mumbai, New Delhi?

5)      Drawing unit ?Inches?

6)      Selected geo-graphic location in the AutoCAD drawing

7)      Specified the north direction angle. Repeated the above steps to
mark three more geographic locations in the CAD file

8)      Saved the CAD file and converted it into shape file using online
tool ?https://mygeodata.cloud/conversion?


Link to files :
https://drive.google.com/drive/folders/1xylPKQy0uJM3zbcqyxdvdSnxCaFh8lox?usp=share_link


I hope this helps you in analyzing the issue.

Thanks in Advance.

Regards-
Vijay

Hewlett <rob.hewy at gmail.com> wrote:

> It sounds like the lat and longs are being plotted as Web Mercator meters.
>> I could be wrong
>>
>>
>> Is there a .PRJ file?
>>
>> How are you viewing the data:
>> QGIS
>> Open layers
>> Leaflet
>>
>>
>>
>> On Tue, May 9, 2023, 04:55 Vijay Kurhade <vijay.kurhade at gmail.com> wrote:
>>
>>> Hi;
>>>
>>> I have a long pending issue with Shapefile and using proper
>>> Geo-coordinates for it;
>>> i need to place it in Pune, India with actual 4 Geo-Coordinates but
>>> everytime My shapefile gets placed into earth's center mostly Africa.
>>>
>>> What is the solution; How can I ensure the shapefile uses those lat/long
>>> 4 coordinates and is placed on Pune, India in Map rather than somewhere
>>> else?
>>>
>>> Thanks in Advance.
>>>
>>> Regards-
>>> Vijay
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/fd30c057/attachment.htm>

From lnicola at dend.ro  Wed May 10 23:48:46 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 11 May 2023 09:48:46 +0300
Subject: [gdal-dev] Question About OGR
In-Reply-To: <1965381683784926@mail.yandex.com.tr>
References: <1965381683784926@mail.yandex.com.tr>
Message-ID: <aa18b28f-4182-4803-ba74-0926021f3f2c@app.fastmail.com>

Hi,

You no longer have the GDAL tools installed. I don't know how you acquired them before, but one option is something like !apt install gdal-bin (untested).

Lauren?iu

On Thu, May 11, 2023, at 09:03, Arzu ?UBUK?U wrote:
> Hello All,
>  
> I have been working on file conversion in Python for a while. I have had successful results for a long time using "*ogr2ogr*".
> However, my code has been giving the following error for a while now. I also searched a lot on the web, but I couldn't figure out why.
> I do my studies with Google Colab. Any idea about the error?
>  
> 
>  
> -- 
> Sayg?lar?mla / Kind Regards
>  
> *Arzu ?UBUK?U*
> Havac?l?k Bilgi Sistemleri / Aeronautical Information Systems
> Veri Bilimi Uzman? / Data Science Specialist
> ?statistik?i / Statistician MSc
 <https://www.haritaevi.com/en/>
> *T:*+90 312 266 66 98
> *M:*+90 531 762 79 73
> *E**:*cubukcu at haritaevi.com
> *?:* Ankara-Istanbul-Bucharest <https://www.haritaevi.com/en/about-us/contact>
> *www.haritaevi.com*
> *www.obstacleanalyze.com*
> *www.aerodatamarket.com*
 <https://www.instagram.com/haritaevi/?hl=tr> <https://www.linkedin.com/company/haritaevi-havac%C4%B1l%C4%B1k-m%C3%BChendislik-a-%C5%9F/> <https://twitter.com/haritaevi> <https://www.youtube.com/channel/UCZHA_PmyMLg__KOfNgOLJYg?view_as=subscriber> <https://www.facebook.com/haritaevi/> <https://www.haritaevi.com/disclaimer>  <https://fidic.org/> <https://www.efcanet.org/> <https://www.haritaevi.com/en/about-us/quality-policy> <https://www.haritaevi.com/en/about-us/information-security-policy>
>  
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/bfbe7178/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 8409 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/bfbe7178/attachment-0001.png>

From ujaval at spatialthoughts.com  Thu May 11 01:01:42 2023
From: ujaval at spatialthoughts.com (Ujaval Gandhi)
Date: Thu, 11 May 2023 08:01:42 +0000
Subject: [gdal-dev] Question About OGR
In-Reply-To: <aa18b28f-4182-4803-ba74-0926021f3f2c@app.fastmail.com>
References: <1965381683784926@mail.yandex.com.tr>
 <aa18b28f-4182-4803-ba74-0926021f3f2c@app.fastmail.com>
Message-ID: <e51774a4-6a06-db4a-b78a-900804f24038@spatialthoughts.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/231b1e39/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: attachment-1.png
Type: image/png
Size: 8307 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/231b1e39/attachment-0001.png>

From cubukcu at haritaevi.com  Thu May 11 04:50:54 2023
From: cubukcu at haritaevi.com (=?utf-8?B?QXJ6dSDDh1VCVUvDh1U=?=)
Date: Thu, 11 May 2023 14:50:54 +0300
Subject: [gdal-dev] Question About OGR
In-Reply-To: <e51774a4-6a06-db4a-b78a-900804f24038@spatialthoughts.com>
References: <1965381683784926@mail.yandex.com.tr>
 <aa18b28f-4182-4803-ba74-0926021f3f2c@app.fastmail.com>
 <e51774a4-6a06-db4a-b78a-900804f24038@spatialthoughts.com>
Message-ID: <7941011683805097@mail.yandex.com.tr>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/bd122a6a/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: attachment-1.png
Type: image/png
Size: 8307 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/bd122a6a/attachment-0001.png>

From eruiz at aplitop.com  Thu May 11 07:44:41 2023
From: eruiz at aplitop.com (Elena Ruiz)
Date: Thu, 11 May 2023 14:44:41 +0000
Subject: [gdal-dev] Is BigTiff or Classic Tiff?
References: <3d652b5c-aa92-4a2a-85be-25316f1f7b0b.ba94d704-e79f-4907-b4e6-7c540f2b307c.b59f58ad-581a-484c-a5db-7b9f8da3770e@emailsignatures365.codetwo.com>
Message-ID: <AM0P192MB04982928A49CB900B8BDA5EDBB749@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>

Hello, Does anyone know how I can tell if an image file is BigTiff or Classic Tiff using GDAL C++ API commands or methods?

Thanks and regards.

________________________________

[https://www.aplitop.com/descargas/firma1.jpg]


Elena Ruiz
Sofware Development & Technical Support
Tel. +34 952 43 97 71
eruiz at aplitop.com
Sumatra, 9 - 29190 M?laga (Spain)
www.aplitop.com

[cid:SocialLink_Facebook_32x32_a745adb8-c250-4372-8480-e77f503dad3d.png]<https://www.facebook.com/AplitopSL/>   [cid:SocialLink_Twitter_32x32_858247f6-9d4a-4740-a6b3-9b5ebfd98a97.png] <https://twitter.com/aplitop>    [cid:SocialLink_Linkedin_32x32_154d63de-bf68-468f-9eb0-ffed102fac77.png] <https://www.linkedin.com/company/aplitop>    [cid:SocialLink_Youtube_32x32_0dea15dd-3774-4086-be9d-f62560b70c86.png] <https://www.youtube.com/user/aplitop>


In accordance with the provisions of the European Regulation of Data Protection 2016/679 (Reglamento Europeo de Protecci?n de Datos 2016/679), we inform you that the data and the information you provide us through this medium will be used by APLITOP, S.L., with C.I.F. B-92543396 and with address at C / Sumatra, 9, Malaga, 29190, in order to answer your questions and inform you about our products. The data provided will be kept as long as it does not request its cessation and will not be transferred to third parties except in cases where there is a legal obligation. You have the right to access your personal data, correct inaccurate data or request its deletion when the data is no longer necessary for the purposes that were collected, as well as any rights recognized in the RGPD 2016/679
<https://www.aplitop.com/New/en/443/publication-of-point-clouds-on-web>

<https://www.aplitop.com/New/en/438/tcpmdt-v9-is-here><https://www.aplitop.com/Event/en/429/aplitop-at-intergeo-2022-essen>

<https://www.aplitop.com/Event/en/358/intergeo-2019>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/f3829dde/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Facebook_32x32_a745adb8-c250-4372-8480-e77f503dad3d.png
Type: image/png
Size: 365 bytes
Desc: SocialLink_Facebook_32x32_a745adb8-c250-4372-8480-e77f503dad3d.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/f3829dde/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Twitter_32x32_858247f6-9d4a-4740-a6b3-9b5ebfd98a97.png
Type: image/png
Size: 619 bytes
Desc: SocialLink_Twitter_32x32_858247f6-9d4a-4740-a6b3-9b5ebfd98a97.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/f3829dde/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Linkedin_32x32_154d63de-bf68-468f-9eb0-ffed102fac77.png
Type: image/png
Size: 468 bytes
Desc: SocialLink_Linkedin_32x32_154d63de-bf68-468f-9eb0-ffed102fac77.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/f3829dde/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SocialLink_Youtube_32x32_0dea15dd-3774-4086-be9d-f62560b70c86.png
Type: image/png
Size: 817 bytes
Desc: SocialLink_Youtube_32x32_0dea15dd-3774-4086-be9d-f62560b70c86.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/f3829dde/attachment-0003.png>

From jukka.rahkonen at maanmittauslaitos.fi  Thu May 11 08:22:53 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 11 May 2023 15:22:53 +0000
Subject: [gdal-dev] Is BigTiff or Classic Tiff?
In-Reply-To: <AM0P192MB04982928A49CB900B8BDA5EDBB749@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>
References: <3d652b5c-aa92-4a2a-85be-25316f1f7b0b.ba94d704-e79f-4907-b4e6-7c540f2b307c.b59f58ad-581a-484c-a5db-7b9f8da3770e@emailsignatures365.codetwo.com>
 <AM0P192MB04982928A49CB900B8BDA5EDBB749@AM0P192MB0498.EURP192.PROD.OUTLOOK.COM>
Message-ID: <AM0PR09MB32195A0A394CF81A3B9BAB94FD749@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

I guess that libtiff takes care of that BigTIFF Design - LibTIFF 4.5.0 documentation<https://libtiff.gitlab.io/libtiff/specification/bigtiff.html> and reads if the ID version is either 42 or 43. 43 is Bigger.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Elena Ruiz
L?hetetty: torstai 11. toukokuuta 2023 17.45
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Is BigTiff or Classic Tiff?

Hello, Does anyone know how I can tell if an image file is BigTiff or Classic Tiff using GDAL C++ API commands or methods?

Thanks and regards.

________________________________

[https://www.aplitop.com/descargas/firma1.jpg]
Elena Ruiz
Sofware Development & Technical Support
Tel. +34 952 43 97 71
eruiz at aplitop.com<mailto:eruiz at aplitop.com>
Sumatra, 9 - 29190 M?laga (Spain)
www.aplitop.com<http://www.aplitop.com/>

[cid:image001.png at 01D98435.98E3F670]<https://www.facebook.com/AplitopSL/>   [cid:image002.png at 01D98435.98E3F670] <https://twitter.com/aplitop>    [cid:image003.png at 01D98435.98E3F670] <https://www.linkedin.com/company/aplitop>    [cid:image004.png at 01D98435.98E3F670] <https://www.youtube.com/user/aplitop>

In accordance with the provisions of the European Regulation of Data Protection 2016/679 (Reglamento Europeo de Protecci?n de Datos 2016/679), we inform you that the data and the information you provide us through this medium will be used by APLITOP, S.L., with C.I.F. B-92543396 and with address at C / Sumatra, 9, Malaga, 29190, in order to answer your questions and inform you about our products. The data provided will be kept as long as it does not request its cessation and will not be transferred to third parties except in cases where there is a legal obligation. You have the right to access your personal data, correct inaccurate data or request its deletion when the data is no longer necessary for the purposes that were collected, as well as any rights recognized in the RGPD 2016/679




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/317d8d73/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 365 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/317d8d73/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 619 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/317d8d73/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 468 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/317d8d73/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 817 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230511/317d8d73/attachment-0007.png>

From ivan.lucena at outlook.com  Fri May 12 10:02:03 2023
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Fri, 12 May 2023 17:02:03 +0000
Subject: [gdal-dev] GRIB can't get nodata and cmake can't disable FileGDB
In-Reply-To: <8f7512a8-8a81-20bc-b411-0c038bce93c5@spatialys.com>
References: <IA1P223MB042509670099B81B90F2721AF2649@IA1P223MB0425.NAMP223.PROD.OUTLOOK.COM>
 <8f7512a8-8a81-20bc-b411-0c038bce93c5@spatialys.com>
Message-ID: <IA1P223MB04258CD66D6C0DA42A3CA7D5F2759@IA1P223MB0425.NAMP223.PROD.OUTLOOK.COM>

Hi Even,

I was using GCC 4.8.5 on Linux and getting the same error in openfilegdb as mentioned in (fixes #6991<https://github.com/OSGeo/gdal/issues/6991>).

So, I did what you suggested, and build GDAL 3.6 without a problem.

My mistake is that I was traying to get rid of the error by turning off the wrong driver (filegdb)!

So, everting seems to be fine with cmake. Great job in the transaction from autoconf, BTW.

And thanks again for fixing the GRIB driver. (fixes #7673, #7674).

Best regards,

Ivan
________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Saturday, April 29, 2023 9:34 AM
To: Ivan Lucena <ivan.lucena at outlook.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] GRIB can't get nodata and cmake can't disable FileGDB


Ivan,

(I see you've filed an issue for the GRIB nodata issue since.)


But I am getting a compilation error, somewhere on ogrsf_frmts/openfilegdb, and I cannot turn off that driver on cmake. The parameter -DGDAL_USE_FILEGDB=OFF seems to work fine.

For the OpenFileGDB driver, this should be -DOGR_ENABLE_DRIVER_OPENFILEGDB=OFF

-DGDAL_USE_FILEGDB=OFF is to disable the use of the proprietary SDK

I somehow recall someone had mentioned a building issue some time ago but can't find it. Anyway, I assume you may perhaps use an older compiler, like MSVC 2015 which we no longer test/support and that doesn't support some aspects of C++11. You may perhaps try to revert https://github.com/OSGeo/gdal/commit/b8076543f0fefb7106351297b845df2f8b4d8514 alternatively, or better upgrade to something more recent

More generally when you report something, be very specific and post exact error messages.

Even

--

http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230512/eeca4527/attachment.htm>

From rob.hewy at gmail.com  Fri May 12 11:52:42 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Fri, 12 May 2023 11:52:42 -0700
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
In-Reply-To: <CAEcx6hbk9G1smC3vkeDJjpbDL+MCqGoO00r=sGgKaJQvs6UdkQ@mail.gmail.com>
References: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
 <CAG_Q50RoBEWteTqaeew71yvoB+fDNHAKLZJxX8zboYi5JNff_w@mail.gmail.com>
 <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
 <CAEcx6hbk9G1smC3vkeDJjpbDL+MCqGoO00r=sGgKaJQvs6UdkQ@mail.gmail.com>
Message-ID: <CAG_Q50SctTL4V8yaTLf1FZu329oQ71ZQLOhw8yx0x8FadTUMOQ@mail.gmail.com>

Hi,

Sorry for the late reply, Still marking and meetings on this side of the
globe:

I used the site to go from dwg to dxf.

Then used ogr2ogr at the command line

ogr2ogr --version
GDAL 3.6.4, released 2023/04/17

ogr2ogr -a_srs "EPSG:4326" -f "ESRI Shapefile" ^
-gcp 12.8973 4.8524 73.7737714009421 18.546875366193724 ^
-gcp 8.75204 17.21844 73.76355401367982 18.57499038261755 ^
-gcp 23.7272 8.4155 73.79942967064645 18.55509638758041 ^
-gcp 14.3373 21.9502 73.7767221307843 18.58772458615475 ^
-skipfailures ^
shp_out geocoordinated_Pune_baner_Map.dxf

The gcps need work and I am not familiar with the area. Feels like some new
bridges and roads.

I got closer
https://i.imgur.com/PhaXlrE.png

-gcp 12.8973 4.8524 18.546875366193724 73.7737714009421 #Pashan HWY Sus Ln
-gpc 8.75204 17.21844 18.57499038261755 73.76355401367982 # Hwy 48 and
Balewadi
-gpc 23.7272 8.4155 18.55509638758041 73.79942967064645 # Baner Prathamesh
Park RD
-gpc 14.3373 21.9502 18.58772458615475 73.77672213078434 # Balewadi wakad
bridge

On Wed, May 10, 2023 at 11:54?PM Vijay Kurhade <vijay.kurhade at gmail.com>
wrote:

> Hello
>
> I am sharing a shape file and AutoCAD (.dwg) file. I have geo-coordinated
> the CAD file and then converted it into .shp file using following steps:
> 1)      Selected ?geographic location? option in AutoCAD
>
> 2)      Entered latitude (18.5652) and longitude (73.7888) and elevation
> (606 meters)
>
> 3)      Selected ?GIS coordinate system? as ?WORLD-MERCATOR(WGS84)
>
> 4)      Selected time zone as ?GMT+5:30 Chennai, Kolkata, Mumbai, New
> Delhi?
>
> 5)      Drawing unit ?Inches?
>
> 6)      Selected geo-graphic location in the AutoCAD drawing
>
> 7)      Specified the north direction angle. Repeated the above steps to
> mark three more geographic locations in the CAD file
>
> 8)      Saved the CAD file and converted it into shape file using online
> tool ?https://mygeodata.cloud/conversion?
>
>
> Link to files :
> https://drive.google.com/drive/folders/1xylPKQy0uJM3zbcqyxdvdSnxCaFh8lox?usp=share_link
>
>
> I hope this helps you in analyzing the issue.
>
> Thanks in Advance.
>
> Regards-
> Vijay
>
> Hewlett <rob.hewy at gmail.com> wrote:
>
>> It sounds like the lat and longs are being plotted as Web Mercator
>>> meters. I could be wrong
>>>
>>>
>>> Is there a .PRJ file?
>>>
>>> How are you viewing the data:
>>> QGIS
>>> Open layers
>>> Leaflet
>>>
>>>
>>>
>>> On Tue, May 9, 2023, 04:55 Vijay Kurhade <vijay.kurhade at gmail.com>
>>> wrote:
>>>
>>>> Hi;
>>>>
>>>> I have a long pending issue with Shapefile and using proper
>>>> Geo-coordinates for it;
>>>> i need to place it in Pune, India with actual 4 Geo-Coordinates but
>>>> everytime My shapefile gets placed into earth's center mostly Africa.
>>>>
>>>> What is the solution; How can I ensure the shapefile uses those
>>>> lat/long 4 coordinates and is placed on Pune, India in Map rather than
>>>> somewhere else?
>>>>
>>>> Thanks in Advance.
>>>>
>>>> Regards-
>>>> Vijay
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230512/451fec50/attachment-0001.htm>

From vijay.kurhade at gmail.com  Fri May 12 12:15:22 2023
From: vijay.kurhade at gmail.com (Vijay Kurhade)
Date: Sat, 13 May 2023 00:45:22 +0530
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
In-Reply-To: <CAG_Q50SctTL4V8yaTLf1FZu329oQ71ZQLOhw8yx0x8FadTUMOQ@mail.gmail.com>
References: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
 <CAG_Q50RoBEWteTqaeew71yvoB+fDNHAKLZJxX8zboYi5JNff_w@mail.gmail.com>
 <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
 <CAEcx6hbk9G1smC3vkeDJjpbDL+MCqGoO00r=sGgKaJQvs6UdkQ@mail.gmail.com>
 <CAG_Q50SctTL4V8yaTLf1FZu329oQ71ZQLOhw8yx0x8FadTUMOQ@mail.gmail.com>
Message-ID: <CAEcx6hZvr_v+Cq6=s61vRSpoCFhpbab5TG8b=O5Tr4LY6Nn67Q@mail.gmail.com>

Hi Rob;

You are a rockstar; yes this is very much close indeed; have struggled for
weeks and never managed to get it out of the center of the globe(African
continent).
Sincerely appreciate so much efforts you have put to help me with direction
and help.

Have a great weekend and beyond.

Regards-
Vijay

On Sat, May 13, 2023 at 12:24?AM Robert Hewlett <rob.hewy at gmail.com> wrote:

> Hi,
>
> Sorry for the late reply, Still marking and meetings on this side of the
> globe:
>
> I used the site to go from dwg to dxf.
>
> Then used ogr2ogr at the command line
>
> ogr2ogr --version
> GDAL 3.6.4, released 2023/04/17
>
> ogr2ogr -a_srs "EPSG:4326" -f "ESRI Shapefile" ^
> -gcp 12.8973 4.8524 73.7737714009421 18.546875366193724 ^
> -gcp 8.75204 17.21844 73.76355401367982 18.57499038261755 ^
> -gcp 23.7272 8.4155 73.79942967064645 18.55509638758041 ^
> -gcp 14.3373 21.9502 73.7767221307843 18.58772458615475 ^
> -skipfailures ^
> shp_out geocoordinated_Pune_baner_Map.dxf
>
> The gcps need work and I am not familiar with the area. Feels like some
> new bridges and roads.
>
> I got closer
> https://i.imgur.com/PhaXlrE.png
>
> -gcp 12.8973 4.8524 18.546875366193724 73.7737714009421 #Pashan HWY Sus Ln
> -gpc 8.75204 17.21844 18.57499038261755 73.76355401367982 # Hwy 48 and
> Balewadi
> -gpc 23.7272 8.4155 18.55509638758041 73.79942967064645 # Baner Prathamesh
> Park RD
> -gpc 14.3373 21.9502 18.58772458615475 73.77672213078434 # Balewadi wakad
> bridge
>
> On Wed, May 10, 2023 at 11:54?PM Vijay Kurhade <vijay.kurhade at gmail.com>
> wrote:
>
>> Hello
>>
>> I am sharing a shape file and AutoCAD (.dwg) file. I have geo-coordinated
>> the CAD file and then converted it into .shp file using following steps:
>> 1)      Selected ?geographic location? option in AutoCAD
>>
>> 2)      Entered latitude (18.5652) and longitude (73.7888) and elevation
>> (606 meters)
>>
>> 3)      Selected ?GIS coordinate system? as ?WORLD-MERCATOR(WGS84)
>>
>> 4)      Selected time zone as ?GMT+5:30 Chennai, Kolkata, Mumbai, New
>> Delhi?
>>
>> 5)      Drawing unit ?Inches?
>>
>> 6)      Selected geo-graphic location in the AutoCAD drawing
>>
>> 7)      Specified the north direction angle. Repeated the above steps to
>> mark three more geographic locations in the CAD file
>>
>> 8)      Saved the CAD file and converted it into shape file using online
>> tool ?https://mygeodata.cloud/conversion?
>>
>>
>> Link to files :
>> https://drive.google.com/drive/folders/1xylPKQy0uJM3zbcqyxdvdSnxCaFh8lox?usp=share_link
>>
>>
>> I hope this helps you in analyzing the issue.
>>
>> Thanks in Advance.
>>
>> Regards-
>> Vijay
>>
>> Hewlett <rob.hewy at gmail.com> wrote:
>>
>>> It sounds like the lat and longs are being plotted as Web Mercator
>>>> meters. I could be wrong
>>>>
>>>>
>>>> Is there a .PRJ file?
>>>>
>>>> How are you viewing the data:
>>>> QGIS
>>>> Open layers
>>>> Leaflet
>>>>
>>>>
>>>>
>>>> On Tue, May 9, 2023, 04:55 Vijay Kurhade <vijay.kurhade at gmail.com>
>>>> wrote:
>>>>
>>>>> Hi;
>>>>>
>>>>> I have a long pending issue with Shapefile and using proper
>>>>> Geo-coordinates for it;
>>>>> i need to place it in Pune, India with actual 4 Geo-Coordinates but
>>>>> everytime My shapefile gets placed into earth's center mostly Africa.
>>>>>
>>>>> What is the solution; How can I ensure the shapefile uses those
>>>>> lat/long 4 coordinates and is placed on Pune, India in Map rather than
>>>>> somewhere else?
>>>>>
>>>>> Thanks in Advance.
>>>>>
>>>>> Regards-
>>>>> Vijay
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230513/2cc35fa5/attachment.htm>

From djsuson at gmail.com  Sat May 13 11:53:37 2023
From: djsuson at gmail.com (Daniel Suson)
Date: Sat, 13 May 2023 13:53:37 -0500
Subject: [gdal-dev] Creating transformed maps with gdal
Message-ID: <882bf9e8-1ece-b6bf-97ec-4dc085a848db@gmail.com>

I am working on a project that involves displaying astronomical data on 
various map projections using C++. I would like to use the gdal library 
to accomplish this instead of hard coding the various projections. In 
the project I have a matrix representing the sky in RA/dec coordinates 
(astronomical equivalent to longitude/latitude) at whatever resolution 
is required. The resulting matrix is essentially geodetic in that it has 
a constant 2:1 ratio. I would like to take this matrix and create a map 
(say using the Mollweide projection as an example) that can then be 
displayed on the screen by the program. I've been looking at the c++ api 
and have found some candidate functions, but they all use data inputted 
from and outputted to files. Can anyone point me to examples that work 
with data stored in and written to memory, or else give me some ideas of 
where else to look for this within the library?

Thank you,

Dan


From thare at usgs.gov  Sat May 13 16:22:29 2023
From: thare at usgs.gov (Hare, Trent M)
Date: Sat, 13 May 2023 23:22:29 +0000
Subject: [gdal-dev] [EXTERNAL]  Creating transformed maps with gdal
In-Reply-To: <882bf9e8-1ece-b6bf-97ec-4dc085a848db@gmail.com>
References: <882bf9e8-1ece-b6bf-97ec-4dc085a848db@gmail.com>
Message-ID: <BY3PR09MB8259F860B90D9CFA35CB18E3D27A9@BY3PR09MB8259.namprd09.prod.outlook.com>

Daniel,
   GDAL is well known for its planetary data support, but not necessarily for astronomy-based data.

For RA/DEC coordinates you might want to look into using HIPs tiles and interfaces like Aladin Lite (lots of dynamic projection support in the interface, use the pull-down in the top right).
astronomy: https://aladin.cds.unistra.fr/AladinLite/
and even some planetary surfaces: https://aladin.cds.unistra.fr/AladinLite/planets-explorer/
best of both worlds (dynamic conversion of HIPs <-> WMS): https://pypi.org/project/mapproxy-hips/

I also just posted this planetary summary (for more GIS-based map servers):
https://openplanetary.discourse.group/t/quick-summary-for-planetary-map-servers-mid-2023/639

Good luck,
Trent

________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Daniel Suson <djsuson at gmail.com>
Sent: Saturday, May 13, 2023 11:53 AM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] [gdal-dev] Creating transformed maps with gdal



 This email has been received from outside of DOI - Use caution before clicking on links, opening attachments, or responding.



I am working on a project that involves displaying astronomical data on
various map projections using C++. I would like to use the gdal library
to accomplish this instead of hard coding the various projections. In
the project I have a matrix representing the sky in RA/dec coordinates
(astronomical equivalent to longitude/latitude) at whatever resolution
is required. The resulting matrix is essentially geodetic in that it has
a constant 2:1 ratio. I would like to take this matrix and create a map
(say using the Mollweide projection as an example) that can then be
displayed on the screen by the program. I've been looking at the c++ api
and have found some candidate functions, but they all use data inputted
from and outputted to files. Can anyone point me to examples that work
with data stored in and written to memory, or else give me some ideas of
where else to look for this within the library?

Thank you,

Dan

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cthare%40usgs.gov%7C909e7b9e954543b7d6d508db53e33fee%7C0693b5ba4b184d7b9341f32f400a5494%7C0%7C0%7C638196007763539331%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=ccjxZ35tnsYhYRXms9ffyq%2FYlKjX%2F3wNPB%2FmnDzzvHs%3D&reserved=0<https://lists.osgeo.org/mailman/listinfo/gdal-dev>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230513/ebf4c656/attachment.htm>

From andreaerdna at libero.it  Mon May 15 06:34:18 2023
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Mon, 15 May 2023 15:34:18 +0200
Subject: [gdal-dev] Shapefile with corrupted index: SHAPE_RESTORE_SHX=YES
 doesn't correctly repairs it.
Message-ID: <5665dc79-82ba-973a-ff4d-88106d72cb74@libero.it>

Hi devs,
in a reent QGIS issue report at 
https://github.com/qgis/QGIS/issues/53058 , an user complains about an 
ESRI Shapefile layer that was corrupted after an attribute value was 
changed and the edit was saved. The corrupted layer is opened by QGIS 
without errors or warning being reported, anyway it shows only a subset 
of the original feature geometry: a lot of records have now a null 
geometry associated, so they cannot be displayed.

After some investigations, although I don't know why and how the layer 
was corrupted, it seems to me that the issue is mostly due to a 
corruption of the .idx file: in fact it contains, for various records, 
incorrect value of index and length of the record. This generates the 
incorrect reading of such record and the following ones, until the the 
index in the .idx file and the data in the .shp file line up again.

Running the QGIS "Repair Shapefile" processing algorithm against such 
layer, the algorithm fails while the .idx file is actually updated but 
the layer becomes totally invalid and it is not possible to load it in 
QGIS. The same happens directly using ogrinfo after the .idx file was 
deleted and the SHAPE_RESTORE_SHX variable was set to YES: the .idx file 
was recreated but the layer becomes unreadable by both QGIS and ogrinfo.

Inspecting the .idx file created by ogrinfo with SHAPE_RESTORE_SHX=YES 
(which is the same as the one created by the QGIS tool "Repair 
Shapefile"), it seems to me ogr fails to properly create the .idx file: 
it incorrectly stores, in the index file header, the total length in 
16-bit words of the .shp file instead of the total length in 16-bit 
words of the .idx file itself.
In this particular case,
it stores the incorrect value 00 29 2A C2 = 2697922 16-bit words = 
5395844 bytes
instead of the correct value 00 02 1D 26 = 138534 16-bit words = 277068 
bytes

Changing such incorrect value to the correct one in the repaired .idx 
file, makes the layer valid again and showing again the previously 
missing feature geometries (with only some glitches and a missing record).

This behaviour seems weird to me, as I remember that the Repair 
Shapefile tool or the SHAPE_RESTORE_SHX=YES setting worked well to 
repair Shapefiles with corrupted index in the past.

Maybe the issue in this particular Shapefile prevent ogr to correctly 
repair the index?
For comparison, the old "Shape Checker utility" succeeds to repair the 
.idx file: it creates the same .idx file as the one created by ogr, 
apart from the total file length value which is correct.

Any clue as to what may have gone wrong during the layer editing in QGIS 
that eventually corrupted the layer?


Best regards.

Andrea Giudiceandrea

From jukka.rahkonen at maanmittauslaitos.fi  Mon May 15 06:52:48 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 15 May 2023 13:52:48 +0000
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
In-Reply-To: <5665dc79-82ba-973a-ff4d-88106d72cb74@libero.it>
References: <5665dc79-82ba-973a-ff4d-88106d72cb74@libero.it>
Message-ID: <AM0PR09MB32196257C76C81F867803C92FD789@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Am I right that .idx is an attribute index? By the documentation it feels somehow odd
" Currently the OGR Shapefile driver only supports attribute indexes for looking up specific values in a unique key column. To create an attribute index for a column issue an SQL command of the form "CREATE INDEX ON tablename USING fieldname". To drop the attribute indexes issue a command of the form "DROP INDEX ON tablename". The attribute index will accelerate WHERE clause searches of the form "fieldname = value". The attribute index is actually stored as a mapinfo format index and is not compatible with any other shapefile applications."

Restoring .SHX is not related at all.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Andrea Giudiceandrea via gdal-dev
L?hetetty: maanantai 15. toukokuuta 2023 16.34
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Shapefile with corrupted index: SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.

Hi devs,
in a reent QGIS issue report at
https://github.com/qgis/QGIS/issues/53058 , an user complains about an ESRI Shapefile layer that was corrupted after an attribute value was changed and the edit was saved. The corrupted layer is opened by QGIS without errors or warning being reported, anyway it shows only a subset of the original feature geometry: a lot of records have now a null geometry associated, so they cannot be displayed.

After some investigations, although I don't know why and how the layer was corrupted, it seems to me that the issue is mostly due to a corruption of the .idx file: in fact it contains, for various records, incorrect value of index and length of the record. This generates the incorrect reading of such record and the following ones, until the the index in the .idx file and the data in the .shp file line up again.

Running the QGIS "Repair Shapefile" processing algorithm against such layer, the algorithm fails while the .idx file is actually updated but the layer becomes totally invalid and it is not possible to load it in QGIS. The same happens directly using ogrinfo after the .idx file was deleted and the SHAPE_RESTORE_SHX variable was set to YES: the .idx file was recreated but the layer becomes unreadable by both QGIS and ogrinfo.

Inspecting the .idx file created by ogrinfo with SHAPE_RESTORE_SHX=YES (which is the same as the one created by the QGIS tool "Repair Shapefile"), it seems to me ogr fails to properly create the .idx file:
it incorrectly stores, in the index file header, the total length in 16-bit words of the .shp file instead of the total length in 16-bit words of the .idx file itself.
In this particular case,
it stores the incorrect value 00 29 2A C2 = 2697922 16-bit words =
5395844 bytes
instead of the correct value 00 02 1D 26 = 138534 16-bit words = 277068 bytes

Changing such incorrect value to the correct one in the repaired .idx file, makes the layer valid again and showing again the previously missing feature geometries (with only some glitches and a missing record).

This behaviour seems weird to me, as I remember that the Repair Shapefile tool or the SHAPE_RESTORE_SHX=YES setting worked well to repair Shapefiles with corrupted index in the past.

Maybe the issue in this particular Shapefile prevent ogr to correctly repair the index?
For comparison, the old "Shape Checker utility" succeeds to repair the .idx file: it creates the same .idx file as the one created by ogr, apart from the total file length value which is correct.

Any clue as to what may have gone wrong during the layer editing in QGIS that eventually corrupted the layer?


Best regards.

Andrea Giudiceandrea
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From rob.hewy at gmail.com  Mon May 15 08:43:40 2023
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Mon, 15 May 2023 08:43:40 -0700
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
In-Reply-To: <5665dc79-82ba-973a-ff4d-88106d72cb74@libero.it>
References: <5665dc79-82ba-973a-ff4d-88106d72cb74@libero.it>
Message-ID: <CAG_Q50Qp9TEEfR4ew_Wv_izxROisLz5-Aj9dfeaOe9U_482C2A@mail.gmail.com>

Hi,

Out of curiosity, if you isolate the shp, dbf and shx (make a copy) in a
separate folder is the data still corrupt?

Rob


On Mon, May 15, 2023 at 6:35?AM Andrea Giudiceandrea via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi devs,
> in a reent QGIS issue report at
> https://github.com/qgis/QGIS/issues/53058 , an user complains about an
> ESRI Shapefile layer that was corrupted after an attribute value was
> changed and the edit was saved. The corrupted layer is opened by QGIS
> without errors or warning being reported, anyway it shows only a subset
> of the original feature geometry: a lot of records have now a null
> geometry associated, so they cannot be displayed.
>
> After some investigations, although I don't know why and how the layer
> was corrupted, it seems to me that the issue is mostly due to a
> corruption of the .idx file: in fact it contains, for various records,
> incorrect value of index and length of the record. This generates the
> incorrect reading of such record and the following ones, until the the
> index in the .idx file and the data in the .shp file line up again.
>
> Running the QGIS "Repair Shapefile" processing algorithm against such
> layer, the algorithm fails while the .idx file is actually updated but
> the layer becomes totally invalid and it is not possible to load it in
> QGIS. The same happens directly using ogrinfo after the .idx file was
> deleted and the SHAPE_RESTORE_SHX variable was set to YES: the .idx file
> was recreated but the layer becomes unreadable by both QGIS and ogrinfo.
>
> Inspecting the .idx file created by ogrinfo with SHAPE_RESTORE_SHX=YES
> (which is the same as the one created by the QGIS tool "Repair
> Shapefile"), it seems to me ogr fails to properly create the .idx file:
> it incorrectly stores, in the index file header, the total length in
> 16-bit words of the .shp file instead of the total length in 16-bit
> words of the .idx file itself.
> In this particular case,
> it stores the incorrect value 00 29 2A C2 = 2697922 16-bit words =
> 5395844 bytes
> instead of the correct value 00 02 1D 26 = 138534 16-bit words = 277068
> bytes
>
> Changing such incorrect value to the correct one in the repaired .idx
> file, makes the layer valid again and showing again the previously
> missing feature geometries (with only some glitches and a missing record).
>
> This behaviour seems weird to me, as I remember that the Repair
> Shapefile tool or the SHAPE_RESTORE_SHX=YES setting worked well to
> repair Shapefiles with corrupted index in the past.
>
> Maybe the issue in this particular Shapefile prevent ogr to correctly
> repair the index?
> For comparison, the old "Shape Checker utility" succeeds to repair the
> .idx file: it creates the same .idx file as the one created by ogr,
> apart from the total file length value which is correct.
>
> Any clue as to what may have gone wrong during the layer editing in QGIS
> that eventually corrupted the layer?
>
>
> Best regards.
>
> Andrea Giudiceandrea
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230515/453d4e2d/attachment.htm>

From andreaerdna at libero.it  Mon May 15 09:04:33 2023
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Mon, 15 May 2023 18:04:33 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
Message-ID: <dbc1a81a-d109-8d87-9e26-2308b9278488@libero.it>

Il 15/05/2023 15:52, Rahkonen Jukka ha scritto:
> Am I right that .idx is an attribute index? By the documentation it feels somehow odd

Hi Jukka Rahkonen,
I apologise.... there was a typo in my message... where I wrote ".idx" I 
should have written ".shx".

> Il 15/05/2023 17:43, Robert Hewlett ha scritto:
>> Out of curiosity, if you isolate the shp, dbf and shx (make a copy) in a 
>> separate folder is the data still corrupt?

Yes, it is still corrupted.

Regards.

Andrea

From listaddr at gmail.com  Tue May 16 00:01:12 2023
From: listaddr at gmail.com (Marco)
Date: Tue, 16 May 2023 09:01:12 +0200
Subject: [gdal-dev] Trouble with gdal_calc.py and nodata values
Message-ID: <CAHPDOiH9m6ADtti1sLP+4KG--yxJCe1vp7GiUKHiSRrwdsY3KA@mail.gmail.com>

I'm trying to accomplish a seemingly simple task: starting from an HDF
file, convert it to GTiff, and divide all values in the raster by 10. The
original file uses -1 for nodata, and I want to preserve this value all the
way down to the final tiff.
In other words, where the original file had -1, the final file should also
have -1, and where the original file had a value, the final file should
have that value / 10.

Here are the steps I'm following:

$ gdal_translate -of GTiff -a_nodata -1 "HDF5:/tmp/myfile.hdf://MYDS
/tmp/1.tiff
Input file size is 3712, 3712
0...10...20...30...40...50...60...70...80...90...100 - done.
$ gdal_calc.py -A /tmp/1.tiff --A_band=1 --overwrite --quiet --type=Float32
--NoDataValue -1 --outfile=/tmp/2.tiff --format=GTiff
--calc="numpy.around(A/10, 2)"

This works, but 2.tiff has NaNs instead of -1's.

If I do not use the -a_nodata -1 in the first command (not sure it's
needed...should it detect it automatically from the file's metadata?), then
gdal_calc.py will happily divide the -1's and put -0.1's in the final file,
which is not what I want.

I'm probably missing something very basic here, as I'm not a regular use of
these tools and I'm putting together bits and pieces from the documentation
and random examples by myself.

$ gdal_translate --version
GDAL 3.6.2, released 2023/01/02
$ dpkg -l | grep gdal-bin
ii  gdal-bin                    3.6.2+dfsg-1build1                amd64
   Geospatial Data Abstraction Library - Utility programs

Thanks for any help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230516/7b22641d/attachment.htm>

From andreaerdna at libero.it  Tue May 16 04:41:05 2023
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Tue, 16 May 2023 13:41:05 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
Message-ID: <8a431af6-c0ad-83e1-1cb2-a6cb376d20a2@libero.it>

Il 15/05/2023 15:34, Andrea Giudiceandrea ha scritto:
> it seems to me ogr fails to properly create the .idx [EDIT: .shx] file: 
> it incorrectly stores, in the index file header, the total length in 
> 16-bit words of the .shp file instead of the total length in 16-bit 
> words of the .idx [EDIT: .shx] file itself.

Looking at the code, SHPRestoreSHX initially copies the SHP header 
(including the SHP content length) to the SHX file and then it doesn't 
updates the SHX content length in the SHX header when an error occurred 
during the reading of the SHP file.

I propose the PR https://github.com/OSGeo/gdal/pull/7774 in order to 
update the SHX content length even if an error occurred.

Maybe would it be better to let SHPRestoreSHX modify the SHX file (when 
already present) only at the end of the SHP reading procedure and only 
if no error occurred?

Best regards.

Andrea Giudiceandrea

From jan.heckman at gmail.com  Tue May 16 04:52:00 2023
From: jan.heckman at gmail.com (Jan Heckman)
Date: Tue, 16 May 2023 13:52:00 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
In-Reply-To: <8a431af6-c0ad-83e1-1cb2-a6cb376d20a2@libero.it>
References: <8a431af6-c0ad-83e1-1cb2-a6cb376d20a2@libero.it>
Message-ID: <CAKMUAtASZWkz4TnoGRLzsZJqKca-0Jd1r0MFUfta7QrG8PKyYw@mail.gmail.com>

Also out of curiosity,
Are you willing to share the shapefile, preferably at least shp and dbf,
but probably .shp alone will do and .prj helps for checking conversion
results.
Also, to be sure, the expected number of rows is relevant so as not to call
victory too soon.
Jan

On Tue, May 16, 2023 at 1:41?PM Andrea Giudiceandrea via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Il 15/05/2023 15:34, Andrea Giudiceandrea ha scritto:
> > it seems to me ogr fails to properly create the .idx [EDIT: .shx] file:
> > it incorrectly stores, in the index file header, the total length in
> > 16-bit words of the .shp file instead of the total length in 16-bit
> > words of the .idx [EDIT: .shx] file itself.
>
> Looking at the code, SHPRestoreSHX initially copies the SHP header
> (including the SHP content length) to the SHX file and then it doesn't
> updates the SHX content length in the SHX header when an error occurred
> during the reading of the SHP file.
>
> I propose the PR https://github.com/OSGeo/gdal/pull/7774 in order to
> update the SHX content length even if an error occurred.
>
> Maybe would it be better to let SHPRestoreSHX modify the SHX file (when
> already present) only at the end of the SHP reading procedure and only
> if no error occurred?
>
> Best regards.
>
> Andrea Giudiceandrea
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230516/d8d577f8/attachment.htm>

From andreaerdna at libero.it  Tue May 16 05:02:23 2023
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Tue, 16 May 2023 14:02:23 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
Message-ID: <a51247cc-dcc4-10d4-3a43-a547093f0e3e@libero.it>

Il 16/05/2023 13:52, Jan Heckman ha scritto:
> Also out of?curiosity,
> Are you willing to share the shapefile, preferably?at least shp and dbf, 
> but probably .shp alone will do and .prj helps for checking conversion 
> results.

Hi Jan,
the corrupted Shapefile layer is available in the QGIS issue report at 
https://github.com/qgis/QGIS/issues/53058

Best regards.

Andrea

From daniel.scheffler at gfz-potsdam.de  Tue May 16 10:35:40 2023
From: daniel.scheffler at gfz-potsdam.de (Daniel Scheffler)
Date: Tue, 16 May 2023 19:35:40 +0200
Subject: [gdal-dev] Fwd: Transformation of image data between pixel/line
 and projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <b1cf6b86-4922-ca9a-bdd4-ec4fff2883d7@gfz-potsdam.de>
References: <77c9bbc0-b502-afe1-f7e0-37da24909829@gfz-potsdam.de>
 <c2cf3a49-200b-91a6-dd81-1b3059859558@gfz-potsdam.de>
 <1791a553-3e0e-f5e6-659d-11ac6f708ab3@spatialys.com>
 <b1cf6b86-4922-ca9a-bdd4-ec4fff2883d7@gfz-potsdam.de>
Message-ID: <c3158573-ee48-2e4f-1516-ca80b4e6aa13@gfz-potsdam.de>

Hi!

Some time ago, I asked for an inversion of gdal.Warp based on 
GEOLOCATION arrays (longitude/latitude). Back then, my question was: How 
can I transform an image with projected coordinates back to 
cartesian/image coordinates, given that a geolocation array tells GDAL 
where to put which pixel in the output?

In 11/2021, this was unfortunately not implemented yet. However, is 
seems like in the meantime someting like this has been added:
 ??? - https://github.com/OSGeo/gdal/pull/5520
 ??? - https://github.com/OSGeo/gdal/pull/6069
 ??? - 
https://github.com/OSGeo/gdal/blob/c92b22d02c99eae0152f49595947fb3747ddc280/autotest/gcore/geoloc.py#L396

But I am not quite sure if that is what I want. If so, how would a 
Python implementation based on gdal.Warp look like? Is that documented 
somewhere?

Best,
Daniel



Am 30.11.2021 um 14:20 schrieb Daniel Scheffler:
> Ok thanks, too bad that this is not implemented. I think the inversion 
> of this transformation would be a nice feature to be added in GDAL. It 
> would be very useful to me (especially if it is accessible via the 
> Python bindings) and would ease the implementation in a processing 
> pipeline for the upcoming EnMAP hyperspectral satellite. Should I open 
> a feature request in the GDAL issue tracker on GitHub?
>
>
> Am 30.11.2021 um 14:02 schrieb Even Rouault:
>>
>>
>> Le 30/11/2021 ? 12:52, Daniel Scheffler a ?crit?:
>>> Thanks a lot for taking the time, Even, I got the transformation 
>>> from cartesian to projected coordinates to work in memory with the 
>>> GTiff driver. With MEM, NUMPY or VRT it does not work because these 
>>> formats are either not readable from /vsimem/ or don?t have a 
>>> regular file path which is needed to set the X_DATASET and Y_DATASET 
>>> keys in the GEOLOCATION metadata.
>> Ah indeed for X_DATASET/Y_DATASET, you can't use a MEM or NUMPY 
>> dataset. But a /vsimem/xxx dataset in another format should work.
>>>
>>> Regarding the inversion of this transformation, i.e., from projected 
>>> coordinates to pixel/line:
>>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>>> which is for the source dataset should be ported a few lines after 
>>>> for the target dataset.? Probably with a new transformer option to 
>>>> be able to point to an auxiliary dataset, such as a VRT one of your 
>>>> example, to extract the geolocation metadata items from it, that 
>>>> would be different from the target dataset itself, because, except 
>>>> perhaps for the netCDF case, most GDAL datasets that expose a 
>>>> GEOLOCATION metadata domain must be read-only.
>>>
>>> I don?t completely get what you mean here. To me, this sounds like 
>>> there might be a way to do the inverted transformation using the 
>>> C-API of GDAL.
>> No, I meant there's some missing code to do that.
>>> However, I am a Python developer and my C skills are a bit poor. Is 
>>> there any way to use the Python bindings here?
>>>
>>> Kind regards,
>>> Daniel
>>>
>>>
>>>
>>>
>>> Am 26.11.2021 um 12:38 schrieb Even Rouault:
>>>> Daniel,
>>>>>
>>>>> I am trying to convert image data from cartesian/image coordinates 
>>>>> to projected coordinates AND vice versa using geolocation arrays 
>>>>> in GDAL. I have two questions:
>>>>>
>>>>>  1. Since this transformation is part of a processing chain
>>>>>     implemented in Python, I try to transform the data directly
>>>>>     in-memory, i.e, without any disk access. This saves IO time
>>>>>     and avoids permission errors when trying to write temporary
>>>>>     data on Windows. How can this be done? I got correct results
>>>>>     with the code below, however, only when I temporarily write
>>>>>     the data to disk. I tried to write the data to /vsimem/ using
>>>>>     the MEM, GTiff and NUMPY drivers. However, gdal.Warp can?t
>>>>>     find the data there (FileNotFoundError). I think, also the
>>>>>     gdal.Transformer class might be useful and I found an
>>>>>     interesting thread on that here
>>>>>     <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
>>>>>     and a related test in the GDAL autotest suite (here
>>>>>     <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
>>>>>     However, I can?t get it to work for my specific case.
>>>>>
>>>> There's no reason it won't work with a in-memory dataset.
>>>>
>>>> If you use a MEM dataset, then you need to provide the dataset 
>>>> object itself as the input dataset of gdal.Warp() (the name of a 
>>>> MEM dataset is completely ignored. a MEM dataset can't be opened, 
>>>> just created).
>>>>
>>>> Similarly with a NUMPY dataset.?? With GTiff and /vsimem/, they 
>>>> behave as a regular file. If you pass it by name as input of 
>>>> gdal.Warp(), you need to make sure to close (ds = None typically) 
>>>> the dataset before, so it is properly flushed and can be opened. 
>>>> But you can also pass it as an object without that constraint.
>>>>
>>>> You can also create purely in-memory VRT files by assigning them an 
>>>> empty name. Then of course you need to provide them as objects to 
>>>> gdal.Warp()
>>>>
>>>>
>>>>>  1. My second question is how I can invert the transformation,
>>>>>     i.e., how can I transform an image with projected coordinates
>>>>>     back to cartesian/image coordinates, given that a geolocation
>>>>>     array tells GDAL where to put which pixel in the output?
>>>>>     Background is a processing pipeline for satellite data where
>>>>>     some processing steps are running in sensor geometry (image
>>>>>     data as acquired by the sensor, without any geocoding and
>>>>>     projection) and I need to provide corresponding AUX data which
>>>>>     originally come with projected coordinates.
>>>>>
>>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>>> which is for the source dataset should be ported a few lines after 
>>>> for the target dataset.? Probably with a new transformer option to 
>>>> be able to point to an auxiliary dataset, such as a VRT one of your 
>>>> example, to extract the geolocation metadata items from it, that 
>>>> would be different from the target dataset itself, because, except 
>>>> perhaps for the netCDF case, most GDAL datasets that expose a 
>>>> GEOLOCATION metadata domain must be read-only.
>>>>>
>>>>> 1.
>>>>>
>>>>>
>>>>> Here is the code I already have to convert a sample image from 
>>>>> cartesian to projected coordinates:
>>>>>
>>>>>     import os
>>>>>     from tempfile import TemporaryDirectory
>>>>>     from osgeo import gdal, osr
>>>>>     import numpy as np
>>>>>     from matplotlib import pyplot as plt
>>>>>
>>>>>
>>>>>     # get some test data
>>>>>     swath_data = np.random.randint(1, 100, (500, 400))
>>>>>     lons, lats = np.meshgrid(np.linspace(3, 5, 500),
>>>>>     ???????????????????????? np.linspace(40, 42, 400))
>>>>>
>>>>>     with TemporaryDirectory() as td:
>>>>>     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
>>>>>     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
>>>>>     ??? p_data_tmp = os.path.join(td, 'data.tif')
>>>>>     ??? p_data_vrt = os.path.join(td, 'data.vrt')
>>>>>     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')
>>>>>
>>>>>     ??? # save numpy arrays to temporary tif files
>>>>>     ??? for arr, path in zip((swath_data, lons, lats),
>>>>>     (p_data_tmp, p_lons_tmp, p_lats_tmp)):
>>>>>     ??????? rows, cols = arr.shape
>>>>>     ??????? drv = gdal.GetDriverByName('GTiff')
>>>>>     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
>>>>>     ??????? ds.GetRasterBand(1).WriteArray(arr)
>>>>>     ??????? del ds
>>>>>
>>>>>     ??? # add geolocation information to input data
>>>>>     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
>>>>>     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
>>>>>     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
>>>>>     ??? ds.SetMetadata(
>>>>>
>>>>>     ??????? dict(
>>>>>     ??????????? SRS=wgs84_wkt,
>>>>>     ??????????? X_DATASET=p_lons_tmp,
>>>>>     ??????????? Y_DATASET=p_lats_tmp,
>>>>>     ??????????? X_BAND='1',
>>>>>     ??????????? Y_BAND='1',
>>>>>     ??????????? PIXEL_OFFSET='0',
>>>>>     ??????????? LINE_OFFSET='0',
>>>>>     ??????????? PIXEL_STEP='1',
>>>>>     ??????????? LINE_STEP='1'
>>>>>     ??????? ),
>>>>>     ??????? 'GEOLOCATION'
>>>>>     ??? )del ds
>>>>>
>>>>>     ??? # warp from geolocation arrays and read the result
>>>>>     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT',
>>>>>     geoloc=True,
>>>>>     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
>>>>>     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()
>>>>>
>>>>>     # visualize input and output data
>>>>>     fig, axes = plt.subplots(1, 4)
>>>>>     for i, (arr, title) in enumerate(zip((swath_data, lons, lats,
>>>>>     data_mapgeo),
>>>>>     ????????????????????????????????? ('swath data', 'lons',
>>>>>     'lats', 'projected data'))):
>>>>>     ??? axes[i].imshow(arr, cmap='gray')
>>>>>     ??? axes[i].set_title(title)
>>>>>     plt.tight_layout()
>>>>>     plt.show()
>>>>>
>>>>>
>>>>> Any help would be highly appreciated!
>>>>>
>>>>> Best,
>>>>>
>>>>> Daniel Scheffler
>>>>>
>>>>>
>>>>> -- 
>>>>>
>>>>> M.Sc. Geogr. Daniel Scheffler
>>>>>
>>>>> Helmholtz Centre Potsdam
>>>>> GFZ German Research Centre For Geosciences
>>>>> Department 1 - Geodesy and Remote Sensing
>>>>> Section 1.4  - Remote Sensing
>>>>> Telegrafenberg, 14473 Potsdam, Germany
>>>>>
>>>>> Phone:  +49 (0)331/288-1198
>>>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>> -- 
>>>> http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>
>>> -- 
>>>
>>> M.Sc. Geogr. Daniel Scheffler
>>>
>>> Helmholtz Centre Potsdam
>>> GFZ German Research Centre For Geosciences
>>> Department 1 - Geodesy and Remote Sensing
>>> Section 1.4  - Remote Sensing
>>> Telegrafenberg, 14473 Potsdam, Germany
>>>
>>> Phone:  +49 (0)331/288-1198
>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> -- 
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- 
>
> M.Sc. Geogr. Daniel Scheffler
>
> Helmholtz Centre Potsdam
> GFZ German Research Centre For Geosciences
> Department 1 - Geodesy and Remote Sensing
> Section 1.4  - Remote Sensing
> Telegrafenberg, 14473 Potsdam, Germany
>
> Phone:  +49 (0)331/288-1198
> e-mail:daniel.scheffler at gfz-potsdam.de
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 

Dr. Daniel Scheffler

Helmholtz Centre Potsdam
GFZ German Research Centre For Geosciences
Department 1 - Geodesy and Remote Sensing
Section 1.4  - Remote Sensing and Geoinformatics
Telegrafenberg, 14473 Potsdam, Germany

Phone:  +49 (0)331/288-1198
e-mail:daniel.scheffler at gfz-potsdam.de
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230516/8b5724e7/attachment-0001.htm>

From even.rouault at spatialys.com  Tue May 16 12:34:49 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2023 21:34:49 +0200
Subject: [gdal-dev] Fwd: Transformation of image data between pixel/line
 and projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <c3158573-ee48-2e4f-1516-ca80b4e6aa13@gfz-potsdam.de>
References: <77c9bbc0-b502-afe1-f7e0-37da24909829@gfz-potsdam.de>
 <c2cf3a49-200b-91a6-dd81-1b3059859558@gfz-potsdam.de>
 <1791a553-3e0e-f5e6-659d-11ac6f708ab3@spatialys.com>
 <b1cf6b86-4922-ca9a-bdd4-ec4fff2883d7@gfz-potsdam.de>
 <c3158573-ee48-2e4f-1516-ca80b4e6aa13@gfz-potsdam.de>
Message-ID: <5ee98455-952d-cb55-e6c2-be7898804a00@spatialys.com>

Daniel,

You rightly spotted https://github.com/OSGeo/gdal/pull/6069 as the 
enabler for that capability.

if your existing target dataset has a geolocation array attached to do 
it, this should just be a matter of doing:

target_ds = gdal.Open( filename, gdal.GA_Update )

gdal.Warp(target_ds, source_ds, ... other options here ...)

If the target dataset doesn't have a geolocation array attached to it, 
you can point to an external one with the DST_GEOLOC_ARRAY tranformer option

gdal.Warp(target_ds, source_ds, 
transformerOptions=["DST_METHOD=GEOLOC_ARRAY", 
"DST_GEOLOC_ARRAY=/path/to/geoloc_dataset"], ... other options here ...)

Even

Le 16/05/2023 ? 19:35, Daniel Scheffler a ?crit?:
> Hi!
>
> Some time ago, I asked for an inversion of gdal.Warp based on 
> GEOLOCATION arrays (longitude/latitude). Back then, my question was: 
> How can I transform an image with projected coordinates back to 
> cartesian/image coordinates, given that a geolocation array tells GDAL 
> where to put which pixel in the output?
>
> In 11/2021, this was unfortunately not implemented yet. However, is 
> seems like in the meantime someting like this has been added:
> ??? - https://github.com/OSGeo/gdal/pull/5520
> ??? - https://github.com/OSGeo/gdal/pull/6069
> ??? - 
> https://github.com/OSGeo/gdal/blob/c92b22d02c99eae0152f49595947fb3747ddc280/autotest/gcore/geoloc.py#L396
>
> But I am not quite sure if that is what I want. If so, how would a 
> Python implementation based on gdal.Warp look like? Is that documented 
> somewhere?
>
> Best,
> Daniel
>
>
>
> Am 30.11.2021 um 14:20 schrieb Daniel Scheffler:
>> Ok thanks, too bad that this is not implemented. I think the 
>> inversion of this transformation would be a nice feature to be added 
>> in GDAL. It would be very useful to me (especially if it is 
>> accessible via the Python bindings) and would ease the implementation 
>> in a processing pipeline for the upcoming EnMAP hyperspectral 
>> satellite. Should I open a feature request in the GDAL issue tracker 
>> on GitHub?
>>
>>
>> Am 30.11.2021 um 14:02 schrieb Even Rouault:
>>>
>>>
>>> Le 30/11/2021 ? 12:52, Daniel Scheffler a ?crit?:
>>>> Thanks a lot for taking the time, Even, I got the transformation 
>>>> from cartesian to projected coordinates to work in memory with the 
>>>> GTiff driver. With MEM, NUMPY or VRT it does not work because these 
>>>> formats are either not readable from /vsimem/ or don?t have a 
>>>> regular file path which is needed to set the X_DATASET and 
>>>> Y_DATASET keys in the GEOLOCATION metadata.
>>> Ah indeed for X_DATASET/Y_DATASET, you can't use a MEM or NUMPY 
>>> dataset. But a /vsimem/xxx dataset in another format should work.
>>>>
>>>> Regarding the inversion of this transformation, i.e., from 
>>>> projected coordinates to pixel/line:
>>>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>>>> which is for the source dataset should be ported a few lines after 
>>>>> for the target dataset.? Probably with a new transformer option to 
>>>>> be able to point to an auxiliary dataset, such as a VRT one of 
>>>>> your example, to extract the geolocation metadata items from it, 
>>>>> that would be different from the target dataset itself, because, 
>>>>> except perhaps for the netCDF case, most GDAL datasets that expose 
>>>>> a GEOLOCATION metadata domain must be read-only.
>>>>
>>>> I don?t completely get what you mean here. To me, this sounds like 
>>>> there might be a way to do the inverted transformation using the 
>>>> C-API of GDAL.
>>> No, I meant there's some missing code to do that.
>>>> However, I am a Python developer and my C skills are a bit poor. Is 
>>>> there any way to use the Python bindings here?
>>>>
>>>> Kind regards,
>>>> Daniel
>>>>
>>>>
>>>>
>>>>
>>>> Am 26.11.2021 um 12:38 schrieb Even Rouault:
>>>>> Daniel,
>>>>>>
>>>>>> I am trying to convert image data from cartesian/image 
>>>>>> coordinates to projected coordinates AND vice versa using 
>>>>>> geolocation arrays in GDAL. I have two questions:
>>>>>>
>>>>>>  1. Since this transformation is part of a processing chain
>>>>>>     implemented in Python, I try to transform the data directly
>>>>>>     in-memory, i.e, without any disk access. This saves IO time
>>>>>>     and avoids permission errors when trying to write temporary
>>>>>>     data on Windows. How can this be done? I got correct results
>>>>>>     with the code below, however, only when I temporarily write
>>>>>>     the data to disk. I tried to write the data to /vsimem/ using
>>>>>>     the MEM, GTiff and NUMPY drivers. However, gdal.Warp can?t
>>>>>>     find the data there (FileNotFoundError). I think, also the
>>>>>>     gdal.Transformer class might be useful and I found an
>>>>>>     interesting thread on that here
>>>>>>     <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
>>>>>>     and a related test in the GDAL autotest suite (here
>>>>>>     <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
>>>>>>     However, I can?t get it to work for my specific case.
>>>>>>
>>>>> There's no reason it won't work with a in-memory dataset.
>>>>>
>>>>> If you use a MEM dataset, then you need to provide the dataset 
>>>>> object itself as the input dataset of gdal.Warp() (the name of a 
>>>>> MEM dataset is completely ignored. a MEM dataset can't be opened, 
>>>>> just created).
>>>>>
>>>>> Similarly with a NUMPY dataset.?? With GTiff and /vsimem/, they 
>>>>> behave as a regular file. If you pass it by name as input of 
>>>>> gdal.Warp(), you need to make sure to close (ds = None typically) 
>>>>> the dataset before, so it is properly flushed and can be opened. 
>>>>> But you can also pass it as an object without that constraint.
>>>>>
>>>>> You can also create purely in-memory VRT files by assigning them 
>>>>> an empty name. Then of course you need to provide them as objects 
>>>>> to gdal.Warp()
>>>>>
>>>>>
>>>>>>  1. My second question is how I can invert the transformation,
>>>>>>     i.e., how can I transform an image with projected coordinates
>>>>>>     back to cartesian/image coordinates, given that a geolocation
>>>>>>     array tells GDAL where to put which pixel in the output?
>>>>>>     Background is a processing pipeline for satellite data where
>>>>>>     some processing steps are running in sensor geometry (image
>>>>>>     data as acquired by the sensor, without any geocoding and
>>>>>>     projection) and I need to provide corresponding AUX data
>>>>>>     which originally come with projected coordinates.
>>>>>>
>>>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>>>> which is for the source dataset should be ported a few lines after 
>>>>> for the target dataset.? Probably with a new transformer option to 
>>>>> be able to point to an auxiliary dataset, such as a VRT one of 
>>>>> your example, to extract the geolocation metadata items from it, 
>>>>> that would be different from the target dataset itself, because, 
>>>>> except perhaps for the netCDF case, most GDAL datasets that expose 
>>>>> a GEOLOCATION metadata domain must be read-only.
>>>>>>
>>>>>> 1.
>>>>>>
>>>>>>
>>>>>> Here is the code I already have to convert a sample image from 
>>>>>> cartesian to projected coordinates:
>>>>>>
>>>>>>     import os
>>>>>>     from tempfile import TemporaryDirectory
>>>>>>     from osgeo import gdal, osr
>>>>>>     import numpy as np
>>>>>>     from matplotlib import pyplot as plt
>>>>>>
>>>>>>
>>>>>>     # get some test data
>>>>>>     swath_data = np.random.randint(1, 100, (500, 400))
>>>>>>     lons, lats = np.meshgrid(np.linspace(3, 5, 500),
>>>>>>     ???????????????????????? np.linspace(40, 42, 400))
>>>>>>
>>>>>>     with TemporaryDirectory() as td:
>>>>>>     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
>>>>>>     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
>>>>>>     ??? p_data_tmp = os.path.join(td, 'data.tif')
>>>>>>     ??? p_data_vrt = os.path.join(td, 'data.vrt')
>>>>>>     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')
>>>>>>
>>>>>>     ??? # save numpy arrays to temporary tif files
>>>>>>     ??? for arr, path in zip((swath_data, lons, lats),
>>>>>>     (p_data_tmp, p_lons_tmp, p_lats_tmp)):
>>>>>>     ??????? rows, cols = arr.shape
>>>>>>     ??????? drv = gdal.GetDriverByName('GTiff')
>>>>>>     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
>>>>>>     ??????? ds.GetRasterBand(1).WriteArray(arr)
>>>>>>     ??????? del ds
>>>>>>
>>>>>>     ??? # add geolocation information to input data
>>>>>>     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
>>>>>>     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
>>>>>>     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
>>>>>>     ??? ds.SetMetadata(
>>>>>>
>>>>>>     ??????? dict(
>>>>>>     ??????????? SRS=wgs84_wkt,
>>>>>>     ??????????? X_DATASET=p_lons_tmp,
>>>>>>     ??????????? Y_DATASET=p_lats_tmp,
>>>>>>     ??????????? X_BAND='1',
>>>>>>     ??????????? Y_BAND='1',
>>>>>>     ??????????? PIXEL_OFFSET='0',
>>>>>>     ??????????? LINE_OFFSET='0',
>>>>>>     ??????????? PIXEL_STEP='1',
>>>>>>     ??????????? LINE_STEP='1'
>>>>>>     ??????? ),
>>>>>>     ??????? 'GEOLOCATION'
>>>>>>     ??? )del ds
>>>>>>
>>>>>>     ??? # warp from geolocation arrays and read the result
>>>>>>     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT',
>>>>>>     geoloc=True,
>>>>>>     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
>>>>>>     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()
>>>>>>
>>>>>>     # visualize input and output data
>>>>>>     fig, axes = plt.subplots(1, 4)
>>>>>>     for i, (arr, title) in enumerate(zip((swath_data, lons, lats,
>>>>>>     data_mapgeo),
>>>>>>     ????????????????????????????????? ('swath data', 'lons',
>>>>>>     'lats', 'projected data'))):
>>>>>>     ??? axes[i].imshow(arr, cmap='gray')
>>>>>>     ??? axes[i].set_title(title)
>>>>>>     plt.tight_layout()
>>>>>>     plt.show()
>>>>>>
>>>>>>
>>>>>> Any help would be highly appreciated!
>>>>>>
>>>>>> Best,
>>>>>>
>>>>>> Daniel Scheffler
>>>>>>
>>>>>>
>>>>>> -- 
>>>>>>
>>>>>> M.Sc. Geogr. Daniel Scheffler
>>>>>>
>>>>>> Helmholtz Centre Potsdam
>>>>>> GFZ German Research Centre For Geosciences
>>>>>> Department 1 - Geodesy and Remote Sensing
>>>>>> Section 1.4  - Remote Sensing
>>>>>> Telegrafenberg, 14473 Potsdam, Germany
>>>>>>
>>>>>> Phone:  +49 (0)331/288-1198
>>>>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>>>>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing list
>>>>>> gdal-dev at lists.osgeo.org
>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>> -- 
>>>>> http://www.spatialys.com
>>>>> My software is free, but my time generally not.
>>>>
>>>> -- 
>>>>
>>>> M.Sc. Geogr. Daniel Scheffler
>>>>
>>>> Helmholtz Centre Potsdam
>>>> GFZ German Research Centre For Geosciences
>>>> Department 1 - Geodesy and Remote Sensing
>>>> Section 1.4  - Remote Sensing
>>>> Telegrafenberg, 14473 Potsdam, Germany
>>>>
>>>> Phone:  +49 (0)331/288-1198
>>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>> -- 
>>> http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- 
>>
>> M.Sc. Geogr. Daniel Scheffler
>>
>> Helmholtz Centre Potsdam
>> GFZ German Research Centre For Geosciences
>> Department 1 - Geodesy and Remote Sensing
>> Section 1.4  - Remote Sensing
>> Telegrafenberg, 14473 Potsdam, Germany
>>
>> Phone:  +49 (0)331/288-1198
>> e-mail:daniel.scheffler at gfz-potsdam.de
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- 
>
> Dr. Daniel Scheffler
>
> Helmholtz Centre Potsdam
> GFZ German Research Centre For Geosciences
> Department 1 - Geodesy and Remote Sensing
> Section 1.4  - Remote Sensing and Geoinformatics
> Telegrafenberg, 14473 Potsdam, Germany
>
> Phone:  +49 (0)331/288-1198
> e-mail:daniel.scheffler at gfz-potsdam.de
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230516/1ef9e064/attachment-0001.htm>

From aborruso at gmail.com  Tue May 16 23:27:01 2023
From: aborruso at gmail.com (andy)
Date: Wed, 17 May 2023 08:27:01 +0200
Subject: [gdal-dev] How to read tiles size of a tiff
Message-ID: <CAHEdGZM6wFzJqKLRffWv7mWhMrL1_u8VJGC4yegOZO+JwmYAzQ@mail.gmail.com>

Hi,
I've been having trouble using a tiff on openlayers, and I've found that it
depends on it having a negative tile height (-256).
This is the tiff:
https://andy-aws.s3.eu-north-1.amazonaws.com/sample_dnw_byte.tiff

I'm able to read tiles size in OL, using this

  source.getView().then(() => {
    console.log(source.getTileGrid());
  });

Is there some gdal CLI to read tiles size?
Using gdalinfo it seems to me that I do not have it.

Thank you

-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230517/c5442139/attachment.htm>

From lnicola at dend.ro  Wed May 17 00:23:17 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Wed, 17 May 2023 10:23:17 +0300
Subject: [gdal-dev] How to read tiles size of a tiff
In-Reply-To: <CAHEdGZM6wFzJqKLRffWv7mWhMrL1_u8VJGC4yegOZO+JwmYAzQ@mail.gmail.com>
References: <CAHEdGZM6wFzJqKLRffWv7mWhMrL1_u8VJGC4yegOZO+JwmYAzQ@mail.gmail.com>
Message-ID: <89c7609b-52af-403e-9818-b69242d34a0e@betaapp.fastmail.com>

Hi Andy,

gdalinfo is the tool that displays information about rasters. Yours is 337x217 pixels, with a 337x24 block size, which is completely unrelated to the OL tiling grid, and there's no -256 here.

The only unusual thing about your image is that instead of the customary positive X, negative Y cell spacing, it has (-70, 70) meters. This can sometimes cause problems, even for GDAL. OL might be assuming negative Y spacing, ending up with a negative size later.

I think you can fix it by flipping the image pixels in both directions, then updating the geotransform.

Regards,
Laurentiu

On Wed, May 17, 2023, at 09:27, andy wrote:
> Hi,
> I've been having trouble using a tiff on openlayers, and I've found that it depends on it having a negative tile height (-256).
> This is the tiff: https://andy-aws.s3.eu-north-1.amazonaws.com/sample_dnw_byte.tiff
> 
> I'm able to read tiles size in OL, using this
> 
>   source.getView().then(() => {
>     console.log(source.getTileGrid());
>   });
> 
> Is there some gdal CLI to read tiles size?
> Using gdalinfo it seems to me that I do not have it.
> 
> Thank you
> 
> --
> ___________________
> 
> Andrea Borruso
> website: https://medium.com/tantotanto
> 38? 7' 48" N, 13? 21' 9" E, EPSG:4326
> ___________________
> 
> "cercare e saper riconoscere chi e cosa,
>  in mezzo all?inferno, non ? inferno, 
> e farlo durare, e dargli spazio"
> 
> Italo Calvino
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230517/5646b40a/attachment.htm>

From aborruso at gmail.com  Wed May 17 00:44:58 2023
From: aborruso at gmail.com (andy)
Date: Wed, 17 May 2023 09:44:58 +0200
Subject: [gdal-dev] How to read tiles size of a tiff
In-Reply-To: <89c7609b-52af-403e-9818-b69242d34a0e@betaapp.fastmail.com>
References: <CAHEdGZM6wFzJqKLRffWv7mWhMrL1_u8VJGC4yegOZO+JwmYAzQ@mail.gmail.com>
 <89c7609b-52af-403e-9818-b69242d34a0e@betaapp.fastmail.com>
Message-ID: <CAHEdGZPrh10b7h8WmBQRDcxgwVswKd0AVxS_ZFCefN9ykDpv=g@mail.gmail.com>

Thank you very much Laurentiu, this was what i needed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230517/e8684270/attachment.htm>

From jan.heckman at gmail.com  Wed May 17 03:39:42 2023
From: jan.heckman at gmail.com (Jan Heckman)
Date: Wed, 17 May 2023 12:39:42 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
In-Reply-To: <a51247cc-dcc4-10d4-3a43-a547093f0e3e@libero.it>
References: <a51247cc-dcc4-10d4-3a43-a547093f0e3e@libero.it>
Message-ID: <CAKMUAtAcnZspwZDDy7WocN3Rcq+DJswM-==BEczLPx2K9Y9_xg@mail.gmail.com>

Hi all,

As noted in the QGis issues <https://github.com/qgis/QGIS/issues/53058>,
the shx has problems that ogr2ogr (or QGis Repair Shapefile) will not fix;
The error I get in cmdline with SHAPE_RESTORE_SHX=YES is "ERROR 4: Error
parsing .shp to restore .shx".
Long time ago I wrote my own version to recreate the .shx from the .shp,
and it does restore the .shx (leaving me to wonder whether my routine is
really correct);
long story short, the repaired shapefile loads fine, but the shp does not
contain the missing geometries anyway,
and the dbf doesn't have rows of missing objects (as shown in the QGis
issue).

The missing objects are presumed lost, see issue.

Looking at the .idx file I surmise that it is a foxbase/foxpro index. Good
(very) old dbase has .mdx and .ndx.
DBF index files are not part of the shapefile spec.
The layout of the file does not fully fit the few descriptions I have, but
looks like btree record blocks with keys
that may address column H (soil erosion).
The presence of this 'foreign' (in the context of shapefiles) file made be
think that perhaps the .dbf has been
modified using foxpro/foxbase, leading to an error when saving again in
QGis.
Another bit of evidence for such a scenario is that the last row in the
.dbf is garbled.
(check with LibreOffice Calc).

FWIW a link <https://www.dropbox.com/s/wj0loe0m7apuszz/test.zip?dl=0> to
the worked shapefile.

On Tue, May 16, 2023 at 2:03?PM Andrea Giudiceandrea via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Il 16/05/2023 13:52, Jan Heckman ha scritto:
> > Also out of curiosity,
> > Are you willing to share the shapefile, preferably at least shp and dbf,
> > but probably .shp alone will do and .prj helps for checking conversion
> > results.
>
> Hi Jan,
> the corrupted Shapefile layer is available in the QGIS issue report at
> https://github.com/qgis/QGIS/issues/53058
>
> Best regards.
>
> Andrea
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230517/77da08db/attachment.htm>

From jan.heckman at gmail.com  Wed May 17 03:53:47 2023
From: jan.heckman at gmail.com (Jan Heckman)
Date: Wed, 17 May 2023 12:53:47 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
In-Reply-To: <CAKMUAtAcnZspwZDDy7WocN3Rcq+DJswM-==BEczLPx2K9Y9_xg@mail.gmail.com>
References: <a51247cc-dcc4-10d4-3a43-a547093f0e3e@libero.it>
 <CAKMUAtAcnZspwZDDy7WocN3Rcq+DJswM-==BEczLPx2K9Y9_xg@mail.gmail.com>
Message-ID: <CAKMUAtADcMedKsA_7vB=f+QOS-1xx9Jf-zbhxoTps7owppZLRA@mail.gmail.com>

Have to get back on this, I did not look well at the shapefile I generated
(see last mail).
It is both better and worse. It has most of the missing objects, to my
surprise, but appears to have some invalid coordinates
which show up as horizontal lines in the west part. Still it may help in
reconstruction, I think.
Good luck,
Jan

On Wed, May 17, 2023 at 12:39?PM Jan Heckman <jan.heckman at gmail.com> wrote:

> Hi all,
>
> As noted in the QGis issues <https://github.com/qgis/QGIS/issues/53058>,
> the shx has problems that ogr2ogr (or QGis Repair Shapefile) will not fix;
> The error I get in cmdline with SHAPE_RESTORE_SHX=YES is "ERROR 4: Error
> parsing .shp to restore .shx".
> Long time ago I wrote my own version to recreate the .shx from the .shp,
> and it does restore the .shx (leaving me to wonder whether my routine is
> really correct);
> long story short, the repaired shapefile loads fine, but the shp does not
> contain the missing geometries anyway,
> and the dbf doesn't have rows of missing objects (as shown in the QGis
> issue).
>
> The missing objects are presumed lost, see issue.
>
> Looking at the .idx file I surmise that it is a foxbase/foxpro index. Good
> (very) old dbase has .mdx and .ndx.
> DBF index files are not part of the shapefile spec.
> The layout of the file does not fully fit the few descriptions I have, but
> looks like btree record blocks with keys
> that may address column H (soil erosion).
> The presence of this 'foreign' (in the context of shapefiles) file made be
> think that perhaps the .dbf has been
> modified using foxpro/foxbase, leading to an error when saving again in
> QGis.
> Another bit of evidence for such a scenario is that the last row in the
> .dbf is garbled.
> (check with LibreOffice Calc).
>
> FWIW a link <https://www.dropbox.com/s/wj0loe0m7apuszz/test.zip?dl=0> to
> the worked shapefile.
>
> On Tue, May 16, 2023 at 2:03?PM Andrea Giudiceandrea via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Il 16/05/2023 13:52, Jan Heckman ha scritto:
>> > Also out of curiosity,
>> > Are you willing to share the shapefile, preferably at least shp and
>> dbf,
>> > but probably .shp alone will do and .prj helps for checking conversion
>> > results.
>>
>> Hi Jan,
>> the corrupted Shapefile layer is available in the QGIS issue report at
>> https://github.com/qgis/QGIS/issues/53058
>>
>> Best regards.
>>
>> Andrea
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230517/f18304af/attachment-0001.htm>

From daniel.scheffler at gfz-potsdam.de  Wed May 17 06:14:30 2023
From: daniel.scheffler at gfz-potsdam.de (Daniel Scheffler)
Date: Wed, 17 May 2023 15:14:30 +0200
Subject: [gdal-dev] Fwd: Transformation of image data between pixel/line
 and projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <5ee98455-952d-cb55-e6c2-be7898804a00@spatialys.com>
References: <77c9bbc0-b502-afe1-f7e0-37da24909829@gfz-potsdam.de>
 <c2cf3a49-200b-91a6-dd81-1b3059859558@gfz-potsdam.de>
 <1791a553-3e0e-f5e6-659d-11ac6f708ab3@spatialys.com>
 <b1cf6b86-4922-ca9a-bdd4-ec4fff2883d7@gfz-potsdam.de>
 <c3158573-ee48-2e4f-1516-ca80b4e6aa13@gfz-potsdam.de>
 <5ee98455-952d-cb55-e6c2-be7898804a00@spatialys.com>
Message-ID: <a2139325-169e-bc7d-8819-8e68737dda78@gfz-potsdam.de>

Thanks, Even, that works perfectly! Very nice to have a 
GDAL-implementation for that!

Best,
Daniel



Am 16.05.2023 um 21:34 schrieb Even Rouault:
>
> Daniel,
>
> You rightly spotted https://github.com/OSGeo/gdal/pull/6069 as the 
> enabler for that capability.
>
> if your existing target dataset has a geolocation array attached to do 
> it, this should just be a matter of doing:
>
> target_ds = gdal.Open( filename, gdal.GA_Update )
>
> gdal.Warp(target_ds, source_ds, ... other options here ...)
>
> If the target dataset doesn't have a geolocation array attached to it, 
> you can point to an external one with the DST_GEOLOC_ARRAY tranformer 
> option
>
> gdal.Warp(target_ds, source_ds, 
> transformerOptions=["DST_METHOD=GEOLOC_ARRAY", 
> "DST_GEOLOC_ARRAY=/path/to/geoloc_dataset"], ... other options here ...)
>
> Even
>
> Le 16/05/2023 ? 19:35, Daniel Scheffler a ?crit?:
>> Hi!
>>
>> Some time ago, I asked for an inversion of gdal.Warp based on 
>> GEOLOCATION arrays (longitude/latitude). Back then, my question was: 
>> How can I transform an image with projected coordinates back to 
>> cartesian/image coordinates, given that a geolocation array tells 
>> GDAL where to put which pixel in the output?
>>
>> In 11/2021, this was unfortunately not implemented yet. However, is 
>> seems like in the meantime someting like this has been added:
>> ??? - https://github.com/OSGeo/gdal/pull/5520
>> ??? - https://github.com/OSGeo/gdal/pull/6069
>> ??? - 
>> https://github.com/OSGeo/gdal/blob/c92b22d02c99eae0152f49595947fb3747ddc280/autotest/gcore/geoloc.py#L396
>>
>> But I am not quite sure if that is what I want. If so, how would a 
>> Python implementation based on gdal.Warp look like? Is that 
>> documented somewhere?
>>
>> Best,
>> Daniel
>>
>>
>>
>> Am 30.11.2021 um 14:20 schrieb Daniel Scheffler:
>>> Ok thanks, too bad that this is not implemented. I think the 
>>> inversion of this transformation would be a nice feature to be added 
>>> in GDAL. It would be very useful to me (especially if it is 
>>> accessible via the Python bindings) and would ease the 
>>> implementation in a processing pipeline for the upcoming EnMAP 
>>> hyperspectral satellite. Should I open a feature request in the GDAL 
>>> issue tracker on GitHub?
>>>
>>>
>>> Am 30.11.2021 um 14:02 schrieb Even Rouault:
>>>>
>>>>
>>>> Le 30/11/2021 ? 12:52, Daniel Scheffler a ?crit?:
>>>>> Thanks a lot for taking the time, Even, I got the transformation 
>>>>> from cartesian to projected coordinates to work in memory with the 
>>>>> GTiff driver. With MEM, NUMPY or VRT it does not work because 
>>>>> these formats are either not readable from /vsimem/ or don?t have 
>>>>> a regular file path which is needed to set the X_DATASET and 
>>>>> Y_DATASET keys in the GEOLOCATION metadata.
>>>> Ah indeed for X_DATASET/Y_DATASET, you can't use a MEM or NUMPY 
>>>> dataset. But a /vsimem/xxx dataset in another format should work.
>>>>>
>>>>> Regarding the inversion of this transformation, i.e., from 
>>>>> projected coordinates to pixel/line:
>>>>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>>>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>>>>> which is for the source dataset should be ported a few lines 
>>>>>> after for the target dataset.? Probably with a new transformer 
>>>>>> option to be able to point to an auxiliary dataset, such as a VRT 
>>>>>> one of your example, to extract the geolocation metadata items 
>>>>>> from it, that would be different from the target dataset itself, 
>>>>>> because, except perhaps for the netCDF case, most GDAL datasets 
>>>>>> that expose a GEOLOCATION metadata domain must be read-only.
>>>>>
>>>>> I don?t completely get what you mean here. To me, this sounds like 
>>>>> there might be a way to do the inverted transformation using the 
>>>>> C-API of GDAL.
>>>> No, I meant there's some missing code to do that.
>>>>> However, I am a Python developer and my C skills are a bit poor. 
>>>>> Is there any way to use the Python bindings here?
>>>>>
>>>>> Kind regards,
>>>>> Daniel
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> Am 26.11.2021 um 12:38 schrieb Even Rouault:
>>>>>> Daniel,
>>>>>>>
>>>>>>> I am trying to convert image data from cartesian/image 
>>>>>>> coordinates to projected coordinates AND vice versa using 
>>>>>>> geolocation arrays in GDAL. I have two questions:
>>>>>>>
>>>>>>>  1. Since this transformation is part of a processing chain
>>>>>>>     implemented in Python, I try to transform the data directly
>>>>>>>     in-memory, i.e, without any disk access. This saves IO time
>>>>>>>     and avoids permission errors when trying to write temporary
>>>>>>>     data on Windows. How can this be done? I got correct results
>>>>>>>     with the code below, however, only when I temporarily write
>>>>>>>     the data to disk. I tried to write the data to /vsimem/
>>>>>>>     using the MEM, GTiff and NUMPY drivers. However, gdal.Warp
>>>>>>>     can?t find the data there (FileNotFoundError). I think, also
>>>>>>>     the gdal.Transformer class might be useful and I found an
>>>>>>>     interesting thread on that here
>>>>>>>     <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
>>>>>>>     and a related test in the GDAL autotest suite (here
>>>>>>>     <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
>>>>>>>     However, I can?t get it to work for my specific case.
>>>>>>>
>>>>>> There's no reason it won't work with a in-memory dataset.
>>>>>>
>>>>>> If you use a MEM dataset, then you need to provide the dataset 
>>>>>> object itself as the input dataset of gdal.Warp() (the name of a 
>>>>>> MEM dataset is completely ignored. a MEM dataset can't be opened, 
>>>>>> just created).
>>>>>>
>>>>>> Similarly with a NUMPY dataset.?? With GTiff and /vsimem/, they 
>>>>>> behave as a regular file. If you pass it by name as input of 
>>>>>> gdal.Warp(), you need to make sure to close (ds = None typically) 
>>>>>> the dataset before, so it is properly flushed and can be opened. 
>>>>>> But you can also pass it as an object without that constraint.
>>>>>>
>>>>>> You can also create purely in-memory VRT files by assigning them 
>>>>>> an empty name. Then of course you need to provide them as objects 
>>>>>> to gdal.Warp()
>>>>>>
>>>>>>
>>>>>>>  1. My second question is how I can invert the transformation,
>>>>>>>     i.e., how can I transform an image with projected
>>>>>>>     coordinates back to cartesian/image coordinates, given that
>>>>>>>     a geolocation array tells GDAL where to put which pixel in
>>>>>>>     the output? Background is a processing pipeline for
>>>>>>>     satellite data where some processing steps are running in
>>>>>>>     sensor geometry (image data as acquired by the sensor,
>>>>>>>     without any geocoding and projection) and I need to provide
>>>>>>>     corresponding AUX data which originally come with projected
>>>>>>>     coordinates.
>>>>>>>
>>>>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>>>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>>>>> which is for the source dataset should be ported a few lines 
>>>>>> after for the target dataset.? Probably with a new transformer 
>>>>>> option to be able to point to an auxiliary dataset, such as a VRT 
>>>>>> one of your example, to extract the geolocation metadata items 
>>>>>> from it, that would be different from the target dataset itself, 
>>>>>> because, except perhaps for the netCDF case, most GDAL datasets 
>>>>>> that expose a GEOLOCATION metadata domain must be read-only.
>>>>>>>
>>>>>>> 1.
>>>>>>>
>>>>>>>
>>>>>>> Here is the code I already have to convert a sample image from 
>>>>>>> cartesian to projected coordinates:
>>>>>>>
>>>>>>>     import os
>>>>>>>     from tempfile import TemporaryDirectory
>>>>>>>     from osgeo import gdal, osr
>>>>>>>     import numpy as np
>>>>>>>     from matplotlib import pyplot as plt
>>>>>>>
>>>>>>>
>>>>>>>     # get some test data
>>>>>>>     swath_data = np.random.randint(1, 100, (500, 400))
>>>>>>>     lons, lats = np.meshgrid(np.linspace(3, 5, 500),
>>>>>>>     ???????????????????????? np.linspace(40, 42, 400))
>>>>>>>
>>>>>>>     with TemporaryDirectory() as td:
>>>>>>>     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
>>>>>>>     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
>>>>>>>     ??? p_data_tmp = os.path.join(td, 'data.tif')
>>>>>>>     ??? p_data_vrt = os.path.join(td, 'data.vrt')
>>>>>>>     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')
>>>>>>>
>>>>>>>     ??? # save numpy arrays to temporary tif files
>>>>>>>     ??? for arr, path in zip((swath_data, lons, lats),
>>>>>>>     (p_data_tmp, p_lons_tmp, p_lats_tmp)):
>>>>>>>     ??????? rows, cols = arr.shape
>>>>>>>     ??????? drv = gdal.GetDriverByName('GTiff')
>>>>>>>     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
>>>>>>>     ??????? ds.GetRasterBand(1).WriteArray(arr)
>>>>>>>     ??????? del ds
>>>>>>>
>>>>>>>     ??? # add geolocation information to input data
>>>>>>>     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
>>>>>>>     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
>>>>>>>     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
>>>>>>>     ??? ds.SetMetadata(
>>>>>>>
>>>>>>>     ??????? dict(
>>>>>>>     ??????????? SRS=wgs84_wkt,
>>>>>>>     ??????????? X_DATASET=p_lons_tmp,
>>>>>>>     ??????????? Y_DATASET=p_lats_tmp,
>>>>>>>     ??????????? X_BAND='1',
>>>>>>>     ??????????? Y_BAND='1',
>>>>>>>     ??????????? PIXEL_OFFSET='0',
>>>>>>>     ??????????? LINE_OFFSET='0',
>>>>>>>     ??????????? PIXEL_STEP='1',
>>>>>>>     ??????????? LINE_STEP='1'
>>>>>>>     ??????? ),
>>>>>>>     ??????? 'GEOLOCATION'
>>>>>>>     ??? )del ds
>>>>>>>
>>>>>>>     ??? # warp from geolocation arrays and read the result
>>>>>>>     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT',
>>>>>>>     geoloc=True,
>>>>>>>     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
>>>>>>>     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()
>>>>>>>
>>>>>>>     # visualize input and output data
>>>>>>>     fig, axes = plt.subplots(1, 4)
>>>>>>>     for i, (arr, title) in enumerate(zip((swath_data, lons,
>>>>>>>     lats, data_mapgeo),
>>>>>>>     ????????????????????????????????? ('swath data', 'lons',
>>>>>>>     'lats', 'projected data'))):
>>>>>>>     ??? axes[i].imshow(arr, cmap='gray')
>>>>>>>     ??? axes[i].set_title(title)
>>>>>>>     plt.tight_layout()
>>>>>>>     plt.show()
>>>>>>>
>>>>>>>
>>>>>>> Any help would be highly appreciated!
>>>>>>>
>>>>>>> Best,
>>>>>>>
>>>>>>> Daniel Scheffler
>>>>>>>
>>>>>>>
>>>>>>> -- 
>>>>>>>
>>>>>>> M.Sc. Geogr. Daniel Scheffler
>>>>>>>
>>>>>>> Helmholtz Centre Potsdam
>>>>>>> GFZ German Research Centre For Geosciences
>>>>>>> Department 1 - Geodesy and Remote Sensing
>>>>>>> Section 1.4  - Remote Sensing
>>>>>>> Telegrafenberg, 14473 Potsdam, Germany
>>>>>>>
>>>>>>> Phone:  +49 (0)331/288-1198
>>>>>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> gdal-dev mailing list
>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>> -- 
>>>>>> http://www.spatialys.com
>>>>>> My software is free, but my time generally not.
>>>>>
>>>>> -- 
>>>>>
>>>>> M.Sc. Geogr. Daniel Scheffler
>>>>>
>>>>> Helmholtz Centre Potsdam
>>>>> GFZ German Research Centre For Geosciences
>>>>> Department 1 - Geodesy and Remote Sensing
>>>>> Section 1.4  - Remote Sensing
>>>>> Telegrafenberg, 14473 Potsdam, Germany
>>>>>
>>>>> Phone:  +49 (0)331/288-1198
>>>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>> -- 
>>>> http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>> -- 
>>>
>>> M.Sc. Geogr. Daniel Scheffler
>>>
>>> Helmholtz Centre Potsdam
>>> GFZ German Research Centre For Geosciences
>>> Department 1 - Geodesy and Remote Sensing
>>> Section 1.4  - Remote Sensing
>>> Telegrafenberg, 14473 Potsdam, Germany
>>>
>>> Phone:  +49 (0)331/288-1198
>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- 
>>
>> Dr. Daniel Scheffler
>>
>> Helmholtz Centre Potsdam
>> GFZ German Research Centre For Geosciences
>> Department 1 - Geodesy and Remote Sensing
>> Section 1.4  - Remote Sensing and Geoinformatics
>> Telegrafenberg, 14473 Potsdam, Germany
>>
>> Phone:  +49 (0)331/288-1198
>> e-mail:daniel.scheffler at gfz-potsdam.de
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 

Dr. Daniel Scheffler

Helmholtz Centre Potsdam
GFZ German Research Centre For Geosciences
Department 1 - Geodesy and Remote Sensing
Section 1.4  - Remote Sensing and Geoinformatics
Telegrafenberg, 14473 Potsdam, Germany

Phone:  +49 (0)331/288-1198
e-mail:daniel.scheffler at gfz-potsdam.de
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230517/aa3b0dfe/attachment-0001.htm>

From andreaerdna at libero.it  Wed May 17 07:12:27 2023
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Wed, 17 May 2023 16:12:27 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
Message-ID: <3ba68eb4-e8df-e17c-19d8-870343f30f48@libero.it>

Hi Jan,
thank you very much for looking at this issue.

I had already managed to restore the .shx index file, as reported in my 
first message [1] [2] by fixing the GDAL/OGR SHPRestoreSHX routine [3]. 
Even Rouault also further improved it adding extra sanity checks, a 
better logic and better error messages [4].
Obviously, SHPRestoreSHX routing doesn't take care of the the mismatch 
between the shape and dbf records number.

An old but still working Shapefile recovery tool (which also handle the 
shp / dbf mismatch) is the "Shape Checker" [5].

The .idx file may have been created by AutoCAD [6], as the user reported 
that he tried to open the corrupted Shapefile layer with AutoCAD after 
the corruption occurred.

Best regards.

Andrea


[1] https://lists.osgeo.org/pipermail/gdal-dev/2023-May/057229.html
[2] https://github.com/qgis/QGIS/issues/53058#issuecomment-1547740971
[3] https://github.com/OSGeo/gdal/pull/7774
[4] https://github.com/OSGeo/gdal/pull/7778
[5] 
https://web.archive.org/web/20091024035556/http://geocities.com/SiliconValley/Haven/2295/howto_shapechk.html
[6] 
https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/Required-files-that-make-up-a-shapefile.html



Il 17/05/2023 12:39, Jan Heckman ha scritto:
> Hi all,
> 
> As noted in the QGis issues <https://github.com/qgis/QGIS/issues/53058>, 
> the shx has problems that ogr2ogr (or QGis Repair Shapefile) will not fix;
> The error I get in cmdline with?SHAPE_RESTORE_SHX=YES is "ERROR 4: Error 
> parsing .shp to restore .shx".

From jan.heckman at gmail.com  Thu May 18 01:24:05 2023
From: jan.heckman at gmail.com (Jan Heckman)
Date: Thu, 18 May 2023 10:24:05 +0200
Subject: [gdal-dev] Shapefile with corrupted index:
 SHAPE_RESTORE_SHX=YES doesn't correctly repairs it.
In-Reply-To: <3ba68eb4-e8df-e17c-19d8-870343f30f48@libero.it>
References: <3ba68eb4-e8df-e17c-19d8-870343f30f48@libero.it>
Message-ID: <CAKMUAtD6r1Jjr7BebxwpF_=6FKzz6NWjRX7nVosgSBREdLYbeQ@mail.gmail.com>

Ok, great.
I don't use AutoCad, seems to be a good explanation for the idx, although I
have not found out whether it is
a spatial index or an .shx replacement. See
https://forums.autodesk.com/t5/autocad-map-3d-forum/2018-shape-file-idx-issue/td-p/8300100
discussing (sharing) problems with this .idx file in autocad.
I was at first convinced that some action on the .dbf was the cause of the
problem, anyway, that does not seem
too likely anymore as the dbf rows have an id field and the rows (still)
ordered ascendingly as you would expect.
Therefore the order of the shp and the dbf is likely the same.
Only the last dbf row has damage.
I am a bit unsure whether you have a valid shapefile again/still.
Unless you have a fully recovered/backed up shapefile by now, I suggest you
take a (second) look at the link
<https://www.dropbox.com/s/wj0loe0m7apuszz/test.zip?dl=0> I gave above.
I could repair the last weirdness (lines sticking out westward) and now it
looks ok, and complete.
See https://www.dropbox.com/s/bh6pfvk2haddoqf/result.png?dl=0 for a quick
glance.
In dark the shapefile as it was first shown in QGis, in pink the
(additional) objects that have been recovered.
Best regards,
Jan

On Wed, May 17, 2023 at 4:59?PM Andrea Giudiceandrea via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi Jan,
> thank you very much for looking at this issue.
>
> I had already managed to restore the .shx index file, as reported in my
> first message [1] [2] by fixing the GDAL/OGR SHPRestoreSHX routine [3].
> Even Rouault also further improved it adding extra sanity checks, a
> better logic and better error messages [4].
> Obviously, SHPRestoreSHX routing doesn't take care of the the mismatch
> between the shape and dbf records number.
>
> An old but still working Shapefile recovery tool (which also handle the
> shp / dbf mismatch) is the "Shape Checker" [5].
>
> The .idx file may have been created by AutoCAD [6], as the user reported
> that he tried to open the corrupted Shapefile layer with AutoCAD after
> the corruption occurred.
>
> Best regards.
>
> Andrea
>
>
> [1] https://lists.osgeo.org/pipermail/gdal-dev/2023-May/057229.html
> [2] https://github.com/qgis/QGIS/issues/53058#issuecomment-1547740971
> [3] https://github.com/OSGeo/gdal/pull/7774
> [4] https://github.com/OSGeo/gdal/pull/7778
> [5]
>
> https://web.archive.org/web/20091024035556/http://geocities.com/SiliconValley/Haven/2295/howto_shapechk.html
> [6]
>
> https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/Required-files-that-make-up-a-shapefile.html
>
>
>
> Il 17/05/2023 12:39, Jan Heckman ha scritto:
> > Hi all,
> >
> > As noted in the QGis issues <https://github.com/qgis/QGIS/issues/53058>,
>
> > the shx has problems that ogr2ogr (or QGis Repair Shapefile) will not
> fix;
> > The error I get in cmdline with SHAPE_RESTORE_SHX=YES is "ERROR 4: Error
> > parsing .shp to restore .shx".
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230518/f2021b82/attachment.htm>

From sean.gillies at gmail.com  Fri May 19 16:26:26 2023
From: sean.gillies at gmail.com (Sean Gillies)
Date: Fri, 19 May 2023 17:26:26 -0600
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
Message-ID: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>

Hi all,

I really appreciate the documentation at
https://gdal.org/development/building_from_source.html. But there are gaps.
For example, today I ran into

CMake Error at cmake/helpers/GdalDriverHelper.cmake:331 (message):
GDAL_ENABLE_DRIVER_AIGRID cannot be enabled because condition
OGR_ENABLE_DRIVER_AVC is not met. To ignore this error (but the driver
will not be built), set the GDAL_IGNORE_FAILED_CONDITIONS variable

This dependence isn't documented. It's a bit frustrating to work through
missing directives one at a time when adding new drivers to my build.

Is it possible for a driver's dependencies to be enabled when I enable a
driver?

If not, can we consider using GDAL maintenance funding and resources on
documenting the heck out of this system?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230519/97c87b53/attachment.htm>

From bradh at frogmouth.net  Fri May 19 17:10:41 2023
From: bradh at frogmouth.net (Brad Hards)
Date: Sat, 20 May 2023 10:10:41 +1000
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
Message-ID: <2146615.irdbgypaU6@audax>

On Saturday, 20 May 2023 9:26:26 AM AEST Sean Gillies wrote:
> Hi all,
> 
> I really appreciate the documentation at
> https://gdal.org/development/building_from_source.html. But there are gaps.
> For example, today I ran into
> 
> CMake Error at cmake/helpers/GdalDriverHelper.cmake:331 (message):
> GDAL_ENABLE_DRIVER_AIGRID cannot be enabled because condition
> OGR_ENABLE_DRIVER_AVC is not met. To ignore this error (but the driver
> will not be built), set the GDAL_IGNORE_FAILED_CONDITIONS variable
> 
> This dependence isn't documented. It's a bit frustrating to work through
> missing directives one at a time when adding new drivers to my build.

While I appreciate that it is frustrating, there probably aren't that many people who 
regularly do custom builds (and of those, having stuff magically turned on 
probably isn't expected).

There is a list in the source code:

https://github.com/OSGeo/gdal/blob/master/frmts/CMakeLists.txt[1]

- just scan fro gdal_dependent_format

and also at

https://github.com/OSGeo/gdal/blob/master/ogr/ogrsf_frmts/CMakeLists.txt#L53-L108[2]

for OGR formats

> Is it possible for a driver's dependencies to be enabled when I enable a
> driver?
> 
> If not, can we consider using GDAL maintenance funding and resources on
> documenting the heck out of this system?

While sympathising with your frustration, I don't see this as a high priority activity. 
That said, it probably wouldn't be that hard to scan through the CMakeLists with a 
simple script and generate it.

Brad

--------
[1] https://github.com/OSGeo/gdal/blob/master/frmts/CMakeLists.txt
[2] https://github.com/OSGeo/gdal/blob/master/ogr/ogrsf_frmts/
CMakeLists.txt#L53-L108
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230520/645f9c6d/attachment.htm>

From even.rouault at spatialys.com  Mon May 22 07:53:34 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 May 2023 16:53:34 +0200
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
Message-ID: <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>

Hi Sean,

I presume you got this because you defined 
OGR_BUILD_OPTIONAL_DRIVERS=OFF which then cause OGR_ENABLE_DRIVER_AVC to 
be set to OFF.

We already a quite overwhelming amount of documentation in 
https://gdal.org/development/building_from_source.html about all the 
existing variables, and I'm not sure adding an exhaustive list of all 
the inter driver dependencies will be user-digestable and could rot easily.

That said in https://github.com/OSGeo/gdal/pull/7806 I've tried to 
improve the current error message with a hint for the reason for the 
error and the (likely) reason for it to happen.

I've also added pointers in the doc page to the CMakeLists.txt files 
where the dependencies are expressed. Hopefully people who are in the 
business of making custom GDAL builds can make sense of that.

Even

Le 20/05/2023 ? 01:26, Sean Gillies a ?crit?:
> Hi all,
>
> I really appreciate the documentation at 
> https://gdal.org/development/building_from_source.html. But there are 
> gaps. For example, today I ran into
>
> CMake Error at cmake/helpers/GdalDriverHelper.cmake:331 (message):
> GDAL_ENABLE_DRIVER_AIGRID cannot be enabled because condition
> OGR_ENABLE_DRIVER_AVC is not met. To ignore this error (but the driver
> will not be built), set the GDAL_IGNORE_FAILED_CONDITIONS variable
>
> This dependence isn't documented. It's a bit frustrating to work 
> through missing directives one at a time when adding new drivers to my 
> build.
>
> Is it possible for a driver's dependencies to be enabled when I enable 
> a driver?
>
> If not, can we consider using GDAL maintenance funding and resources 
> on documenting the heck out of this system?
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230522/7bd5e7cb/attachment.htm>

From mcalzado at carto.com  Tue May 23 06:43:38 2023
From: mcalzado at carto.com (Moises Calzado)
Date: Tue, 23 May 2023 15:43:38 +0200
Subject: [gdal-dev] CSV driver inconsistent separator dealing to failures
Message-ID: <CAObRW4QNWiyyGuEYjaUDC0YKyffWYR8P6FjZJTBcT9HGx0qOVw@mail.gmail.com>

Hello everyone,

I'm trying to use ogr2ogr with a CSV file that uses semicolons as
separator, but there is a field that contain one comma. The issue that I'm
facing is that as it contains a comma, it originally takes the comma as
separator, so it's not parsed correctly.

However, when trying to open the CSV file with another application it works
like a charm, as the separator is correctly identified.

I've been having a look at the function that identifies the separator, and
it seems that if it finds two possible separators, it takes the comma as
the right one. To double-check that, I executed the command in debug mode,
and the following warning was shown:

CSV: Inconsistent separator. ';' and ',' found. Using ',' as default


In my humble opinion it makes sense to follow this approach if the
separator is not clear, but in this case the first CSV line contains
like 10 semicolons (the real separator) and just one comma. I believe that
the actual behaviour could be improved adding some way of checking the most
repeated separator. What do you think?

-- 
*Moises Calzado*

Support Engineer

+34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
<https://spatial-data-science-conference.com/2023/london/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230523/f8cffb6b/attachment.htm>

From even.rouault at spatialys.com  Tue May 23 14:38:51 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 23 May 2023 23:38:51 +0200
Subject: [gdal-dev] CSV driver inconsistent separator dealing to failures
In-Reply-To: <CAObRW4QNWiyyGuEYjaUDC0YKyffWYR8P6FjZJTBcT9HGx0qOVw@mail.gmail.com>
References: <CAObRW4QNWiyyGuEYjaUDC0YKyffWYR8P6FjZJTBcT9HGx0qOVw@mail.gmail.com>
Message-ID: <dcced45d-f3dc-ac78-b678-1ed8d9b5a5e4@spatialys.com>

Moises,
>
> In my humble opinion it makes sense to follow this approach if the 
> separator is not clear, but in this case the?first CSV line contains 
> like?10 semicolons (the real separator) and just one comma. I believe 
> that the actual behaviour could be improved adding some way of 
> checking the most repeated separator. What do you think?

That seems reasonable. You may file an enhancement ticket about that, 
with the header of the CSV file on which you hit the issue as an 
illustration. We should also probably emit a CE_Warning visible even in 
production builds when such ambiguous situation arises.

Even

>
> -- 
> *Moises Calzado*
>
> Support Engineer
>
> +34671264286 | mcalzado at carto.com | CARTO <https://www.carto.com/>
>
> <https://spatial-data-science-conference.com/2023/london/>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230523/f43864bd/attachment.htm>

From espada at agro.uba.ar  Wed May 24 07:29:40 2023
From: espada at agro.uba.ar (Ramiro Espada Guerrero)
Date: Wed, 24 May 2023 11:29:40 -0300
Subject: [gdal-dev] gdalwarp: question about methods implemented when source
 grid is denser than target.
Message-ID: <CAG=AKhV2T5NcCwd2K+qpD+QzAx6sz3ZTPjygpPYiZ5uw76+UAA@mail.gmail.com>

Hi,

I would like to know if gdalwarp does any "average" regriding when the
source grid is denser than the target grid regardless of the chosen method
for the interpolation. And if there is any document where I can follow
exactly the calculations. I tried to follow the code on github but it is
pretty difficult to follow.

I've programmed my own bilinear interpolation function in fortran and I got
smoother results when I applied -r bilinear with gdalwarp. So i wonder if
there is a pre-average regriding subroutine that is not in the
documentation page.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230524/baa67c18/attachment.htm>

From m.sulton1312 at gmail.com  Wed May 24 20:14:50 2023
From: m.sulton1312 at gmail.com (Muhamad Sulton)
Date: Thu, 25 May 2023 10:14:50 +0700
Subject: [gdal-dev] Osgeo gdal
Message-ID: <CA+yrGbGvhwAMi43QeN=9ScqgU_Jv--Oz20aB1EZ9+B4R41gdVg@mail.gmail.com>

Hi, I'm Sulton from Indonesia. I'm sorry to bother you. I have a problem
with installation osgeo library from my resources code. I want to install
it by terminal IDE but it can't. And then I want to install it from tar.gz.
I search how to install library by tar.gz, but in GDAL I haven't idea to
install with command python setup.py install. What should I do? Thank for
your time and help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230525/bb98c14a/attachment.htm>

From eric at knudstrup.org  Wed May 24 21:28:51 2023
From: eric at knudstrup.org (Eric Knudstrup)
Date: Wed, 24 May 2023 21:28:51 -0700
Subject: [gdal-dev] Space optimization of OSM XYZ tiles
Message-ID: <5409544c-9e81-bcd4-50c4-2930d3acaac6@knudstrup.org>

I've just begun experimenting with adding a mosaic of GeoTIFFs to a 
smartphone application that needs to be available offline.
I was wondering if the transcoding could be done on demand on the 70Mb 
GeoTIFFs rather than having to store hundreds of megabytes of PNG files.
Or are there other optimizations that could be done.
These particular files don't need zoom levels higher than 12.

From idan at miara.com  Wed May 24 22:41:19 2023
From: idan at miara.com (Idan Miara)
Date: Thu, 25 May 2023 08:41:19 +0300
Subject: [gdal-dev] Osgeo gdal
In-Reply-To: <CA+yrGbGvhwAMi43QeN=9ScqgU_Jv--Oz20aB1EZ9+B4R41gdVg@mail.gmail.com>
References: <CA+yrGbGvhwAMi43QeN=9ScqgU_Jv--Oz20aB1EZ9+B4R41gdVg@mail.gmail.com>
Message-ID: <CADmqiFX0ipNEjBoVM7PfVt2N6kkodgUq5c5w+955O=L9Tp8BTw@mail.gmail.com>

Hi!

If you are trying to install GDAL on Python, did you try `python -m pip
install gdal` ?

If you did and it failed, are you using Windows ? If yes, try to download
the binary whl file from:
https://github.com/cgohlke/geospatial-wheels/releases
(Note your Python version and win32/64, i.e. If you are using Python 3.11
on Windows 64 bit, download GDAL-3.6.4-cp311-cp311-win_amd64.whl
<https://github.com/cgohlke/geospatial-wheels/releases/download/v2023.4.22/GDAL-3.6.4-cp311-cp311-win_amd64.whl>,
and then run `python -m pip install GDAL-3.6.4-cp311-cp311-win_amd64.whl`

Idan

On Thu, 25 May 2023 at 06:15, Muhamad Sulton <m.sulton1312 at gmail.com> wrote:

> Hi, I'm Sulton from Indonesia. I'm sorry to bother you. I have a problem
> with installation osgeo library from my resources code. I want to install
> it by terminal IDE but it can't. And then I want to install it from tar.gz.
> I search how to install library by tar.gz, but in GDAL I haven't idea to
> install with command python setup.py install. What should I do? Thank for
> your time and help.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230525/d0b3bf98/attachment.htm>

From vijay.kurhade at gmail.com  Thu May 25 06:18:20 2023
From: vijay.kurhade at gmail.com (Vijay Kurhade)
Date: Thu, 25 May 2023 18:48:20 +0530
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
In-Reply-To: <CAG_Q50SctTL4V8yaTLf1FZu329oQ71ZQLOhw8yx0x8FadTUMOQ@mail.gmail.com>
References: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
 <CAG_Q50RoBEWteTqaeew71yvoB+fDNHAKLZJxX8zboYi5JNff_w@mail.gmail.com>
 <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
 <CAEcx6hbk9G1smC3vkeDJjpbDL+MCqGoO00r=sGgKaJQvs6UdkQ@mail.gmail.com>
 <CAG_Q50SctTL4V8yaTLf1FZu329oQ71ZQLOhw8yx0x8FadTUMOQ@mail.gmail.com>
Message-ID: <CAEcx6hZMF_=peFP0FApqeu8O8ZXUxnrtk4KcrpuwzMrF+OTdvg@mail.gmail.com>

Hi Rob;

Sorry to bother you again.

Getting shapefile size as well as other DWG-DXF conversion issues.

please refer to Doc shared on Drive : *Doc for Rob : Gdal Steps.docx*
*https://docs.google.com/document/d/16IUBzzaJZ0baCdtUsUCgTHBBE3-D-wy_/edit?usp=share_link&ouid=105159133680993726163&rtpof=true&sd=true
<https://docs.google.com/document/d/16IUBzzaJZ0baCdtUsUCgTHBBE3-D-wy_/edit?usp=share_link&ouid=105159133680993726163&rtpof=true&sd=true>*

Also;
In case you think it is possible for you to share your working Output
shapefile; which I can use till I get the size issue fixed at my end.

With Regards-
Vijay

On Sat, May 13, 2023 at 12:24?AM Robert Hewlett <rob.hewy at gmail.com> wrote:

> Hi,
>
> Sorry for the late reply, Still marking and meetings on this side of the
> globe:
>
> I used the site to go from dwg to dxf.
>
> Then used ogr2ogr at the command line
>
> ogr2ogr --version
> GDAL 3.6.4, released 2023/04/17
>
> ogr2ogr -a_srs "EPSG:4326" -f "ESRI Shapefile" ^
> -gcp 12.8973 4.8524 73.7737714009421 18.546875366193724 ^
> -gcp 8.75204 17.21844 73.76355401367982 18.57499038261755 ^
> -gcp 23.7272 8.4155 73.79942967064645 18.55509638758041 ^
> -gcp 14.3373 21.9502 73.7767221307843 18.58772458615475 ^
> -skipfailures ^
> shp_out geocoordinated_Pune_baner_Map.dxf
>
> The gcps need work and I am not familiar with the area. Feels like some
> new bridges and roads.
>
> I got closer
> https://i.imgur.com/PhaXlrE.png
>
> -gcp 12.8973 4.8524 18.546875366193724 73.7737714009421 #Pashan HWY Sus Ln
> -gpc 8.75204 17.21844 18.57499038261755 73.76355401367982 # Hwy 48 and
> Balewadi
> -gpc 23.7272 8.4155 18.55509638758041 73.79942967064645 # Baner Prathamesh
> Park RD
> -gpc 14.3373 21.9502 18.58772458615475 73.77672213078434 # Balewadi wakad
> bridge
>
> On Wed, May 10, 2023 at 11:54?PM Vijay Kurhade <vijay.kurhade at gmail.com>
> wrote:
>
>> Hello
>>
>> I am sharing a shape file and AutoCAD (.dwg) file. I have geo-coordinated
>> the CAD file and then converted it into .shp file using following steps:
>> 1)      Selected ?geographic location? option in AutoCAD
>>
>> 2)      Entered latitude (18.5652) and longitude (73.7888) and elevation
>> (606 meters)
>>
>> 3)      Selected ?GIS coordinate system? as ?WORLD-MERCATOR(WGS84)
>>
>> 4)      Selected time zone as ?GMT+5:30 Chennai, Kolkata, Mumbai, New
>> Delhi?
>>
>> 5)      Drawing unit ?Inches?
>>
>> 6)      Selected geo-graphic location in the AutoCAD drawing
>>
>> 7)      Specified the north direction angle. Repeated the above steps to
>> mark three more geographic locations in the CAD file
>>
>> 8)      Saved the CAD file and converted it into shape file using online
>> tool ?https://mygeodata.cloud/conversion?
>>
>>
>> Link to files :
>> https://drive.google.com/drive/folders/1xylPKQy0uJM3zbcqyxdvdSnxCaFh8lox?usp=share_link
>>
>>
>> I hope this helps you in analyzing the issue.
>>
>> Thanks in Advance.
>>
>> Regards-
>> Vijay
>>
>> Hewlett <rob.hewy at gmail.com> wrote:
>>
>>> It sounds like the lat and longs are being plotted as Web Mercator
>>>> meters. I could be wrong
>>>>
>>>>
>>>> Is there a .PRJ file?
>>>>
>>>> How are you viewing the data:
>>>> QGIS
>>>> Open layers
>>>> Leaflet
>>>>
>>>>
>>>>
>>>> On Tue, May 9, 2023, 04:55 Vijay Kurhade <vijay.kurhade at gmail.com>
>>>> wrote:
>>>>
>>>>> Hi;
>>>>>
>>>>> I have a long pending issue with Shapefile and using proper
>>>>> Geo-coordinates for it;
>>>>> i need to place it in Pune, India with actual 4 Geo-Coordinates but
>>>>> everytime My shapefile gets placed into earth's center mostly Africa.
>>>>>
>>>>> What is the solution; How can I ensure the shapefile uses those
>>>>> lat/long 4 coordinates and is placed on Pune, India in Map rather than
>>>>> somewhere else?
>>>>>
>>>>> Thanks in Advance.
>>>>>
>>>>> Regards-
>>>>> Vijay
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230525/29fd9b85/attachment-0001.htm>

From howard at hobu.co  Thu May 25 08:36:30 2023
From: howard at hobu.co (Howard Butler)
Date: Thu, 25 May 2023 10:36:30 -0500
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
Message-ID: <C17A4852-266D-4E0D-B5E6-4A4D297961B3@hobu.co>

Howard Butler, Even Rouault, Dan Baston, and Alessandro Pasotti held the monthly GDAL Maintainers Meeting on 05/25/2023. The following items were discussed and reported upon:

* The recent OSGeo DNS attack demonstrated that GDAL's test infrastructure is sensitive, via usage of download.osgeo.org for test data, to single point of failure. It was unclear if there is backup copies of that test data suite anywhere, and it was resolved to create a GitHub-based repository to both mirror and version control the (larger) test suite data that GDAL uses for daily operations. That repository was created at https://github.com/OSGeo/gdal-data and Dan and Even will coordinate moving content there and wiring up CI as convenient to utilize it.

* Dan continued development of Sphinx directives and documentation additions to systematically highlight, define, index, cross-link, and organize GDAL's "configuration options". Dan has updated and defined 1800! configuration options across all various types ? creation, open, dataset creation, and layer. Thanks to this effort, users will be able to more clearly see and navigate how environmental variable options control GDAL's behavior. Documentation writers will be able to conveniently add specific information that will participate in indexes and linkages of those options to other relevant information. This effort should be merged and available on gdal.org within a week or two.

* Even discussed the need for a libtiff release due to outstanding CVEs and his desire to remove some of the poorly constructed libtiff utility applications that tend to be the cause of the CVE traffic. 

* Even discussed picking up the ticket for adding a "gdal_footprint" utility https://github.com/OSGeo/gdal/issues/6264 If you are interested or have ideas about needs or how it should work, please chime in on the ticket.

* Even coordinated the release of GDAL 3.7.0 on 05/10/2023. It included ~7 RFC implementations and a massive list of bug fixes, feature updates, and enhancements. Read more at https://github.com/OSGeo/gdal/blob/v3.7.0/NEWS.md

* Alessandro continued to provide review support on GDAL PRs and picked up a family of tickets related to MSSQL that had been stagnating for a while after QGIS users reported them too. After setting up a test environment, he was able to knock out a few related bugs that will be included in future release.

The next GDAL Maintainers Meeting is 06/22/2023 at 9:00 EDT. Any PSC members are welcome to join by reaching out to me for an invite.

Howard

From even.rouault at spatialys.com  Thu May 25 12:51:16 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 25 May 2023 21:51:16 +0200
Subject: [gdal-dev] gdalwarp: question about methods implemented when
 source grid is denser than target.
In-Reply-To: <CAG=AKhV2T5NcCwd2K+qpD+QzAx6sz3ZTPjygpPYiZ5uw76+UAA@mail.gmail.com>
References: <CAG=AKhV2T5NcCwd2K+qpD+QzAx6sz3ZTPjygpPYiZ5uw76+UAA@mail.gmail.com>
Message-ID: <d3b8ac02-e312-7280-ba86-abb1b5cc7e2f@spatialys.com>

Hi,

to briefly answer your question, for the methods bilinear, cubic, 
cubicspline and lanczos who have nominal kernel radius of respective 
values 1, 2, 2 and 3 (and thus a diameter double that size), the radius 
is extended by a factor source_size / dest_size to take into account the 
downsampling ( Cf lines 1188-1195 in alg/gdalwarpkernel.cpp), and the 
weights of the resampling kernel are evaluated with a scale factor too 
(cf lines 3713-3715 / 3741-3743)

Even

Le 24/05/2023 ? 16:29, Ramiro Espada Guerrero a ?crit?:
> Hi,
>
> I would like to know if gdalwarp does any "average" regriding when the 
> source grid is denser than the target grid regardless of the chosen 
> method for the interpolation. And if there is any document where I can 
> follow exactly the calculations. I tried to follow the code on github 
> but it is pretty difficult to follow.
>
> I've programmed my own bilinear interpolation function in fortran and 
> I got smoother results when I applied -r bilinear with gdalwarp. So i 
> wonder if there is a pre-average regriding subroutine that is not in 
> the documentation page.
>
> Thanks!
>
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From mtobby59 at gmail.com  Thu May 25 23:57:41 2023
From: mtobby59 at gmail.com (Tobby Moalem)
Date: Fri, 26 May 2023 09:57:41 +0300
Subject: [gdal-dev] Extracting Jpeg2000 image from nitf file
Message-ID: <CALGHxB3=9AJGhP3uzLW801XWZJkhaHKEetSM35tiztegYZGzMw@mail.gmail.com>

Hi,
For my understanding the nitf file is used as container, where compressed
jpeg2000 can be saved inside the nitf file.
I wonder if there is a way to use gdal to extract the jpeg2000 part and
save it separately (with extension of .j2c or other jpeg2000 extensions) ?

Thanks in advance,
Tobby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230526/41b8f08b/attachment.htm>

From bradh at frogmouth.net  Fri May 26 00:53:55 2023
From: bradh at frogmouth.net (bradh at frogmouth.net)
Date: Fri, 26 May 2023 17:53:55 +1000
Subject: [gdal-dev] Extracting Jpeg2000 image from nitf file
In-Reply-To: <CALGHxB3=9AJGhP3uzLW801XWZJkhaHKEetSM35tiztegYZGzMw@mail.gmail.com>
Message-ID: <80c5a27f-cbf3-43e6-84dc-a5f7c53e6641@email.android.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230526/6e0ca04a/attachment.htm>

From lnicola at dend.ro  Fri May 26 00:55:55 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Fri, 26 May 2023 10:55:55 +0300
Subject: [gdal-dev] Space optimization of OSM XYZ tiles
In-Reply-To: <5409544c-9e81-bcd4-50c4-2930d3acaac6@knudstrup.org>
References: <5409544c-9e81-bcd4-50c4-2930d3acaac6@knudstrup.org>
Message-ID: <9aa0869a-e067-4356-8b06-1f2ef017c106@betaapp.fastmail.com>

Hi Eric,

Yes, you can transcode them on the fly with a server like https://github.com/developmentseed/titiler. I haven't used that one, but wrote a prototype of something like that in the past.

You might want to have the original in EPSG:3857, though, to avoid the need to reproject the tiles when loading them, but doing it on-the-fly is also possible in theory.

Laurentiu

On Thu, May 25, 2023, at 07:28, Eric Knudstrup via gdal-dev wrote:
> I've just begun experimenting with adding a mosaic of GeoTIFFs to a 
> smartphone application that needs to be available offline.
> I was wondering if the transcoding could be done on demand on the 70Mb 
> GeoTIFFs rather than having to store hundreds of megabytes of PNG files.
> Or are there other optimizations that could be done.
> These particular files don't need zoom levels higher than 12.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From vijay.kurhade at gmail.com  Fri May 26 01:52:06 2023
From: vijay.kurhade at gmail.com (Vijay Kurhade)
Date: Fri, 26 May 2023 14:22:06 +0530
Subject: [gdal-dev] Question regarding Shapefile Geo-cordinates
In-Reply-To: <CAFVrPyh09Ew4Wsj_iPqS_p8va+j452z8Ceeq5ojESfJsRVY7Uw@mail.gmail.com>
References: <CAEcx6hYBzW-tB=Wjdt=L9OUmkqRVV8T-NCG=gPYPbPhvQtuKsg@mail.gmail.com>
 <CAG_Q50RoBEWteTqaeew71yvoB+fDNHAKLZJxX8zboYi5JNff_w@mail.gmail.com>
 <CAEcx6hY6-_XtgMSknui1MHkS1tsmS_rMN7b2wZ=M_qM0CYW_vQ@mail.gmail.com>
 <CAEcx6hbk9G1smC3vkeDJjpbDL+MCqGoO00r=sGgKaJQvs6UdkQ@mail.gmail.com>
 <CAG_Q50SctTL4V8yaTLf1FZu329oQ71ZQLOhw8yx0x8FadTUMOQ@mail.gmail.com>
 <CAEcx6hZMF_=peFP0FApqeu8O8ZXUxnrtk4KcrpuwzMrF+OTdvg@mail.gmail.com>
 <CAFVrPyh09Ew4Wsj_iPqS_p8va+j452z8Ceeq5ojESfJsRVY7Uw@mail.gmail.com>
Message-ID: <CAEcx6hZE0g-xCcWq_FV_F=RUeKs7diu_sPXy60keOEQrBv351A@mail.gmail.com>

Hi Haddad/Rob;

I tried conversion of DWG to DXF and then ran command; but I am getting
errors I have mentioned in the shared document(on Drive); I have shared the
DXF file too.

>From the python terminal; get Size too big issue And from command line get
polygon errors.

Regds-
Vijay

On Fri, May 26, 2023 at 2:05?AM TC Haddad <tchaddad at gmail.com> wrote:

>
> Hi Vijay,
>
> in his earlier email Rob said that before he ran the command, he used the
> website you provided to convert the file format from " dwg to dxf "
>
> I think if you can export from CAD to DXF, then you can skip using the
> website. But if you are starting from DWG, then first convert it to DXF
> before trying the OGR commands.
>
> Tanya
>
> On Thu, May 25, 2023 at 6:19?AM Vijay Kurhade <vijay.kurhade at gmail.com>
> wrote:
>
>> Hi Rob;
>>
>> Sorry to bother you again.
>>
>> Getting shapefile size as well as other DWG-DXF conversion issues.
>>
>> please refer to Doc shared on Drive : *Doc for Rob : Gdal Steps.docx*
>> *https://docs.google.com/document/d/16IUBzzaJZ0baCdtUsUCgTHBBE3-D-wy_/edit?usp=share_link&ouid=105159133680993726163&rtpof=true&sd=true
>> <https://docs.google.com/document/d/16IUBzzaJZ0baCdtUsUCgTHBBE3-D-wy_/edit?usp=share_link&ouid=105159133680993726163&rtpof=true&sd=true>*
>>
>> Also;
>> In case you think it is possible for you to share your working Output
>> shapefile; which I can use till I get the size issue fixed at my end.
>>
>> With Regards-
>> Vijay
>>
>> On Sat, May 13, 2023 at 12:24?AM Robert Hewlett <rob.hewy at gmail.com>
>> wrote:
>>
>>> Hi,
>>>
>>> Sorry for the late reply, Still marking and meetings on this side of the
>>> globe:
>>>
>>> I used the site to go from dwg to dxf.
>>>
>>> Then used ogr2ogr at the command line
>>>
>>> ogr2ogr --version
>>> GDAL 3.6.4, released 2023/04/17
>>>
>>> ogr2ogr -a_srs "EPSG:4326" -f "ESRI Shapefile" ^
>>> -gcp 12.8973 4.8524 73.7737714009421 18.546875366193724 ^
>>> -gcp 8.75204 17.21844 73.76355401367982 18.57499038261755 ^
>>> -gcp 23.7272 8.4155 73.79942967064645 18.55509638758041 ^
>>> -gcp 14.3373 21.9502 73.7767221307843 18.58772458615475 ^
>>> -skipfailures ^
>>> shp_out geocoordinated_Pune_baner_Map.dxf
>>>
>>> The gcps need work and I am not familiar with the area. Feels like some
>>> new bridges and roads.
>>>
>>> I got closer
>>> https://i.imgur.com/PhaXlrE.png
>>>
>>> -gcp 12.8973 4.8524 18.546875366193724 73.7737714009421 #Pashan HWY Sus
>>> Ln
>>> -gpc 8.75204 17.21844 18.57499038261755 73.76355401367982 # Hwy 48 and
>>> Balewadi
>>> -gpc 23.7272 8.4155 18.55509638758041 73.79942967064645 # Baner
>>> Prathamesh Park RD
>>> -gpc 14.3373 21.9502 18.58772458615475 73.77672213078434 # Balewadi
>>> wakad bridge
>>>
>>> On Wed, May 10, 2023 at 11:54?PM Vijay Kurhade <vijay.kurhade at gmail.com>
>>> wrote:
>>>
>>>> Hello
>>>>
>>>> I am sharing a shape file and AutoCAD (.dwg) file. I have
>>>> geo-coordinated the CAD file and then converted it into .shp file using
>>>> following steps:
>>>> 1)      Selected ?geographic location? option in AutoCAD
>>>>
>>>> 2)      Entered latitude (18.5652) and longitude (73.7888) and
>>>> elevation (606 meters)
>>>>
>>>> 3)      Selected ?GIS coordinate system? as ?WORLD-MERCATOR(WGS84)
>>>>
>>>> 4)      Selected time zone as ?GMT+5:30 Chennai, Kolkata, Mumbai, New
>>>> Delhi?
>>>>
>>>> 5)      Drawing unit ?Inches?
>>>>
>>>> 6)      Selected geo-graphic location in the AutoCAD drawing
>>>>
>>>> 7)      Specified the north direction angle. Repeated the above steps
>>>> to mark three more geographic locations in the CAD file
>>>>
>>>> 8)      Saved the CAD file and converted it into shape file using
>>>> online tool ?https://mygeodata.cloud/conversion?
>>>>
>>>>
>>>> Link to files :
>>>> https://drive.google.com/drive/folders/1xylPKQy0uJM3zbcqyxdvdSnxCaFh8lox?usp=share_link
>>>>
>>>>
>>>> I hope this helps you in analyzing the issue.
>>>>
>>>> Thanks in Advance.
>>>>
>>>> Regards-
>>>> Vijay
>>>>
>>>> Hewlett <rob.hewy at gmail.com> wrote:
>>>>
>>>>> It sounds like the lat and longs are being plotted as Web Mercator
>>>>>> meters. I could be wrong
>>>>>>
>>>>>>
>>>>>> Is there a .PRJ file?
>>>>>>
>>>>>> How are you viewing the data:
>>>>>> QGIS
>>>>>> Open layers
>>>>>> Leaflet
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Tue, May 9, 2023, 04:55 Vijay Kurhade <vijay.kurhade at gmail.com>
>>>>>> wrote:
>>>>>>
>>>>>>> Hi;
>>>>>>>
>>>>>>> I have a long pending issue with Shapefile and using proper
>>>>>>> Geo-coordinates for it;
>>>>>>> i need to place it in Pune, India with actual 4 Geo-Coordinates but
>>>>>>> everytime My shapefile gets placed into earth's center mostly Africa.
>>>>>>>
>>>>>>> What is the solution; How can I ensure the shapefile uses those
>>>>>>> lat/long 4 coordinates and is placed on Pune, India in Map rather than
>>>>>>> somewhere else?
>>>>>>>
>>>>>>> Thanks in Advance.
>>>>>>>
>>>>>>> Regards-
>>>>>>> Vijay
>>>>>>> _______________________________________________
>>>>>>> gdal-dev mailing list
>>>>>>> gdal-dev at lists.osgeo.org
>>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>>
>>>>>> _______________________________________________
>>>>>> gdal-dev mailing list
>>>>>> gdal-dev at lists.osgeo.org
>>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>>
>>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230526/284c6c28/attachment-0001.htm>

From even.rouault at spatialys.com  Fri May 26 03:09:50 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 26 May 2023 12:09:50 +0200
Subject: [gdal-dev] Extracting Jpeg2000 image from nitf file
In-Reply-To: <CALGHxB3=9AJGhP3uzLW801XWZJkhaHKEetSM35tiztegYZGzMw@mail.gmail.com>
References: <CALGHxB3=9AJGhP3uzLW801XWZJkhaHKEetSM35tiztegYZGzMw@mail.gmail.com>
Message-ID: <ad95feff-07bd-632f-4233-8b97349130f6@spatialys.com>

Hi,

if you open such an image with debug traces (CPL_DEBUG=ON), you'll see 
something like

GDAL: GDALOpen(/vsisubfile/907_565,byte.ntf, this=....) succeeds as 
JP2OpenJPEG

which means that the JPEG2000 file starts at byte 907 with a length of 
565 bytes.

Programatically from C/C++ , you could use the GDALGetOpenDatasets() 
methods after having opening the NITF file, and look for /vsisubfile/ files

Even

Le 26/05/2023 ? 08:57, Tobby Moalem a ?crit?:
> Hi,
> For my understanding the nitf file is?used as container, where 
> compressed jpeg2000 can be saved inside the nitf file.
> I wonder if there is a way to use gdal to extract the jpeg2000 part 
> and save it separately (with extension of .j2c or other jpeg2000 
> extensions) ?
>
> Thanks in advance,
> Tobby
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From michael.smith.erdc at gmail.com  Fri May 26 06:12:47 2023
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Fri, 26 May 2023 09:12:47 -0400
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
Message-ID: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>

I assume I am doing something incorrect here but I am taking an incoming geojson feature and attempting to split it on the dateline:

Using gdal 3.7.0 from conda-forge

ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [ 179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 66.695039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 179.851649370943306, 66.507409512673448 ], [ 179.828821134787177, 66.686572724877635 ] ] ] }') 
gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON", layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
gdal.VSIFCloseL(f)
gdal.Unlink("/vsimem/out.json")

If I just do:

newds = ogr.Open(content)

I get RuntimeError: Failed to read GeoJSON data
It appears to be missing the closing ?]}?. 

If I do:
newds = ogr.Open(content+"]}")

Then it works fine.


--?
Michael Smith
Remote Sensing/GIS Center
US Army Corps of Engineers




From even.rouault at spatialys.com  Fri May 26 06:28:44 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 26 May 2023 15:28:44 +0200
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
In-Reply-To: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
References: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
Message-ID: <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>

Michael,

I've also just tried with 3.7.0 from conda-forge and this works fine for me:

I've just slightly modified your script to output more info:

from osgeo import ogr, gdal

ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [ 
179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 
66.695039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 
179.851649370943306, 66.507409512673448 ], [ 179.828821134787177, 
66.686572724877635 ] ] ] }')
gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON", 
layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
gdal.VSIFCloseL(f)
gdal.Unlink("/vsimem/out.json")
print(content)
print(len(content))

newds = ogr.Open(content)
lyr = newds.GetLayer(0)
f = lyr.GetNextFeature()
f.DumpReadable()

and it outputs:

{
"type": "FeatureCollection",
"bbox": [ 179.8288211, 66.5074095, -179.6992047, 66.6950392 ],
"features": [
{ "type": "Feature", "properties": { }, "bbox": [ 179.8288211, 
66.5074095, -179.6992047, 66.6950392 ], "geometry": { "type": 
"MultiPolygon", "coordinates": [ [ [ [ 180.0, 66.6897763 ], [ 
179.8288211, 66.6865727 ], [ 179.8516494, 66.5074095 ], [ 180.0, 
66.5101821 ], [ 180.0, 66.6897763 ] ] ], [ [ [ -179.7187868, 66.6950392 
], [ -180.0, 66.6897763 ], [ -180.0, 66.5101821 ], [ -179.6992047, 
66.5158039 ], [ -179.7187868, 66.6950392 ] ] ] ] } }
]
}

625
OGRFeature(OGRGeoJSON):0
 ? MULTIPOLYGON (((180.0 66.6897763,179.8288211 66.6865727,179.8516494 
66.5074095,180.0 66.5101821,180.0 66.6897763)),((-179.7187868 
66.6950392,-180 66.6897763,-180 66.5101821,-179.6992047 
66.5158039,-179.7187868 66.6950392)))

Even


Le 26/05/2023 ? 15:12, Michael Smith a ?crit?:
> I assume I am doing something incorrect here but I am taking an incoming geojson feature and attempting to split it on the dateline:
>
> Using gdal 3.7.0 from conda-forge
>
> ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [ 179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 66.695039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 179.851649370943306, 66.507409512673448 ], [ 179.828821134787177, 66.686572724877635 ] ] ] }')
> gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON", layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
> f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
> content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
> gdal.VSIFCloseL(f)
> gdal.Unlink("/vsimem/out.json")
>
> If I just do:
>
> newds = ogr.Open(content)
>
> I get RuntimeError: Failed to read GeoJSON data
> It appears to be missing the closing ?]}?.
>
> If I do:
> newds = ogr.Open(content+"]}")
>
> Then it works fine.
>
>
> -- 
> Michael Smith
> Remote Sensing/GIS Center
> US Army Corps of Engineers
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From michael.smith.erdc at gmail.com  Fri May 26 10:09:12 2023
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Fri, 26 May 2023 13:09:12 -0400
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
In-Reply-To: <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>
References: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
 <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>
Message-ID: <527AF414-880B-41BA-B45E-8104FFBED6E0@gmail.com>

Interesting, that is different from what I get. I guess I have to look at how I'm building gdal from conda-forge. I do compile in two plugins (mrsid and oci) but I wouldn't that it would affect things.


at 01:05:23 PM ? ipython
Python 3.11.3 | packaged by conda-forge | (main, Apr  6 2023, 08:57:19) [GCC 11.3.0]
Type 'copyright', 'credits' or 'license' for more information
IPython 8.13.2 -- An enhanced Interactive Python. Type '?' for help.

In [1]: from osgeo import ogr, gdal

In [2]: ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 66.695
   ...: 039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 179.851649370943306, 66.507409512673448 ], [ 179.828821134787177,66.
   ...: 686572724877635 ] ] ] }')
/opt/conda/envs/grid/lib/python3.11/site-packages/osgeo/gdal.py:287: FutureWarning: Neither gdal.UseExceptions() nor gdal.DontUseExceptions() has been explicitly called. In GDAL 4.0, exceptions will be enabled by default.
  warnings.warn(

In [3]: gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON",
   ...: layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
Out[3]: <osgeo.gdal.Dataset; proxy of <Swig Object of type 'GDALDatasetShadow *' at 0x7f546c1c3780> >

In [4]: f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
   ...: content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
   ...: gdal.VSIFCloseL(f)
   ...: gdal.Unlink("/vsimem/out.json")
   ...: print(content)
{
"type": "FeatureCollection",

"features": [
{ "type": "Feature", "properties": { }, "bbox": [ 179.8288211, 66.5074095, -179.6992047, 66.6950392 ], "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 180.0, 66.6897763 ], [ 179.8288211, 66.6865727 ], [ 179.8516494, 66.5074095 ], [ 180.0, 66.5101821 ], [ 180.0, 66.6897763 ] ] ], [ [ [ -179.7187868, 66.6950392 ], [ -180.0, 66.6897763 ], [ -180.0, 66.5101821 ], [ -179.6992047, 66.5158039 ], [ -179.7187868, 66.6950392 ] ] ] ] } }

In [5]: newds = ogr.Open(content)
ERROR 1: JSON parsing error: continue (at offset 620)
ERROR 4: Failed to read GeoJSON data



Mike


-- 

Michael Smith 
Remote Sensing/GIS Center 
US Army Corps of Engineers 





?On 5/26/23, 9:28 AM, "Even Rouault" <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>> wrote:


Michael,


I've also just tried with 3.7.0 from conda-forge and this works fine for me:


I've just slightly modified your script to output more info:


from osgeo import ogr, gdal


ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [ 
179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 
66.695039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 
179.851649370943306, 66.507409512673448 ], [ 179.828821134787177, 
66.686572724877635 ] ] ] }')
gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON", 
layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
gdal.VSIFCloseL(f)
gdal.Unlink("/vsimem/out.json")
print(content)
print(len(content))


newds = ogr.Open(content)
lyr = newds.GetLayer(0)
f = lyr.GetNextFeature()
f.DumpReadable()


and it outputs:


{
"type": "FeatureCollection",
"bbox": [ 179.8288211, 66.5074095, -179.6992047, 66.6950392 ],
"features": [
{ "type": "Feature", "properties": { }, "bbox": [ 179.8288211, 
66.5074095, -179.6992047, 66.6950392 ], "geometry": { "type": 
"MultiPolygon", "coordinates": [ [ [ [ 180.0, 66.6897763 ], [ 
179.8288211, 66.6865727 ], [ 179.8516494, 66.5074095 ], [ 180.0, 
66.5101821 ], [ 180.0, 66.6897763 ] ] ], [ [ [ -179.7187868, 66.6950392 
], [ -180.0, 66.6897763 ], [ -180.0, 66.5101821 ], [ -179.6992047, 
66.5158039 ], [ -179.7187868, 66.6950392 ] ] ] ] } }
]
}


625
OGRFeature(OGRGeoJSON):0
MULTIPOLYGON (((180.0 66.6897763,179.8288211 66.6865727,179.8516494 
66.5074095,180.0 66.5101821,180.0 66.6897763)),((-179.7187868 
66.6950392,-180 66.6897763,-180 66.5101821,-179.6992047 
66.5158039,-179.7187868 66.6950392)))


Even




Le 26/05/2023 ? 15:12, Michael Smith a ?crit :
> I assume I am doing something incorrect here but I am taking an incoming geojson feature and attempting to split it on the dateline:
>
> Using gdal 3.7.0 from conda-forge
>
> ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [ 179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 66.695039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 179.851649370943306, 66.507409512673448 ], [ 179.828821134787177, 66.686572724877635 ] ] ] }')
> gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON", layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
> f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
> content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
> gdal.VSIFCloseL(f)
> gdal.Unlink("/vsimem/out.json")
>
> If I just do:
>
> newds = ogr.Open(content)
>
> I get RuntimeError: Failed to read GeoJSON data
> It appears to be missing the closing ?]}?.
>
> If I do:
> newds = ogr.Open(content+"]}")
>
> Then it works fine.
>
>
> -- 
> Michael Smith
> Remote Sensing/GIS Center
> US Army Corps of Engineers
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev>


-- 
http://www.spatialys.com <http://www.spatialys.com>
My software is free, but my time generally not.







From michael.smith.erdc at gmail.com  Fri May 26 10:27:40 2023
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Fri, 26 May 2023 13:27:40 -0400
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
In-Reply-To: <F89CCA66-09B1-45B3-AABE-E3D02BEF671C@gmail.com>
References: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
 <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>
 <F89CCA66-09B1-45B3-AABE-E3D02BEF671C@gmail.com>
Message-ID: <902F0015-B83D-4281-A83B-426750EDBA23@gmail.com>

Well, a new install of gdal from conda-forge and now it works fine. Sorry for the noise.

Mike


-- 

Michael Smith 
Remote Sensing/GIS Center 
US Army Corps of Engineers 





?On 5/26/23, 1:09 PM, "Michael Smith" <michael.smith.erdc at gmail.com <mailto:michael.smith.erdc at gmail.com>> wrote:


Interesting, that is different from what I get. I guess I have to look at how I'm building gdal from conda-forge. I do compile in two plugins (mrsid and oci) but I wouldn't that it would affect things.




at 01:05:23 PM ? ipython
Python 3.11.3 | packaged by conda-forge | (main, Apr 6 2023, 08:57:19) [GCC 11.3.0]
Type 'copyright', 'credits' or 'license' for more information
IPython 8.13.2 -- An enhanced Interactive Python. Type '?' for help.


In [1]: from osgeo import ogr, gdal


In [2]: ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 66.695
...: 039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 179.851649370943306, 66.507409512673448 ], [ 179.828821134787177,66.
...: 686572724877635 ] ] ] }')
/opt/conda/envs/grid/lib/python3.11/site-packages/osgeo/gdal.py:287: FutureWarning: Neither gdal.UseExceptions() nor gdal.DontUseExceptions() has been explicitly called. In GDAL 4.0, exceptions will be enabled by default.
warnings.warn(


In [3]: gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON",
...: layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
Out[3]: <osgeo.gdal.Dataset; proxy of <Swig Object of type 'GDALDatasetShadow *' at 0x7f546c1c3780> >


In [4]: f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
...: content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
...: gdal.VSIFCloseL(f)
...: gdal.Unlink("/vsimem/out.json")
...: print(content)
{
"type": "FeatureCollection",


"features": [
{ "type": "Feature", "properties": { }, "bbox": [ 179.8288211, 66.5074095, -179.6992047, 66.6950392 ], "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 180.0, 66.6897763 ], [ 179.8288211, 66.6865727 ], [ 179.8516494, 66.5074095 ], [ 180.0, 66.5101821 ], [ 180.0, 66.6897763 ] ] ], [ [ [ -179.7187868, 66.6950392 ], [ -180.0, 66.6897763 ], [ -180.0, 66.5101821 ], [ -179.6992047, 66.5158039 ], [ -179.7187868, 66.6950392 ] ] ] ] } }


In [5]: newds = ogr.Open(content)
ERROR 1: JSON parsing error: continue (at offset 620)
ERROR 4: Failed to read GeoJSON data






Mike




-- 


Michael Smith 
Remote Sensing/GIS Center 
US Army Corps of Engineers 










?On 5/26/23, 9:28 AM, "Even Rouault" <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com> <mailto:even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>>> wrote:




Michael,




I've also just tried with 3.7.0 from conda-forge and this works fine for me:




I've just slightly modified your script to output more info:




from osgeo import ogr, gdal




ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [ 
179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 
66.695039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 
179.851649370943306, 66.507409512673448 ], [ 179.828821134787177, 
66.686572724877635 ] ] ] }')
gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON", 
layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
gdal.VSIFCloseL(f)
gdal.Unlink("/vsimem/out.json")
print(content)
print(len(content))




newds = ogr.Open(content)
lyr = newds.GetLayer(0)
f = lyr.GetNextFeature()
f.DumpReadable()




and it outputs:




{
"type": "FeatureCollection",
"bbox": [ 179.8288211, 66.5074095, -179.6992047, 66.6950392 ],
"features": [
{ "type": "Feature", "properties": { }, "bbox": [ 179.8288211, 
66.5074095, -179.6992047, 66.6950392 ], "geometry": { "type": 
"MultiPolygon", "coordinates": [ [ [ [ 180.0, 66.6897763 ], [ 
179.8288211, 66.6865727 ], [ 179.8516494, 66.5074095 ], [ 180.0, 
66.5101821 ], [ 180.0, 66.6897763 ] ] ], [ [ [ -179.7187868, 66.6950392 
], [ -180.0, 66.6897763 ], [ -180.0, 66.5101821 ], [ -179.6992047, 
66.5158039 ], [ -179.7187868, 66.6950392 ] ] ] ] } }
]
}




625
OGRFeature(OGRGeoJSON):0
MULTIPOLYGON (((180.0 66.6897763,179.8288211 66.6865727,179.8516494 
66.5074095,180.0 66.5101821,180.0 66.6897763)),((-179.7187868 
66.6950392,-180 66.6897763,-180 66.5101821,-179.6992047 
66.5158039,-179.7187868 66.6950392)))




Even








Le 26/05/2023 ? 15:12, Michael Smith a ?crit :
> I assume I am doing something incorrect here but I am taking an incoming geojson feature and attempting to split it on the dateline:
>
> Using gdal 3.7.0 from conda-forge
>
> ds = gdal.OpenEx('{ "type": "Polygon", "coordinates": [ [ [ 179.828821134787177, 66.686572724877635 ], [ -179.718786846664386, 66.695039153881993 ], [ -179.699204739767083, 66.515803857102057 ], [ 179.851649370943306, 66.507409512673448 ], [ 179.828821134787177, 66.686572724877635 ] ] ] }')
> gdal.VectorTranslate("/vsimem/out.json", ds, format="GeoJSON", layerCreationOptions=["RFC7946=YES", "WRAPDATELINE=YES", "WRITE_BBOX=YES"])
> f = gdal.VSIFOpenL("/vsimem/out.json", "rb")
> content = gdal.VSIFReadL(1, 10000, f).decode("UTF-8")
> gdal.VSIFCloseL(f)
> gdal.Unlink("/vsimem/out.json")
>
> If I just do:
>
> newds = ogr.Open(content)
>
> I get RuntimeError: Failed to read GeoJSON data
> It appears to be missing the closing ?]}?.
>
> If I do:
> newds = ogr.Open(content+"]}")
>
> Then it works fine.
>
>
> -- 
> Michael Smith
> Remote Sensing/GIS Center
> US Army Corps of Engineers
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org> <mailto:gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev> <https://lists.osgeo.org/mailman/listinfo/gdal-dev> <https://lists.osgeo.org/mailman/listinfo/gdal-dev&gt;>




-- 
http://www.spatialys.com <http://www.spatialys.com> <http://www.spatialys.com> <http://www.spatialys.com&gt;>
My software is free, but my time generally not.













From lnicola at dend.ro  Fri May 26 10:40:12 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Fri, 26 May 2023 20:40:12 +0300
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
In-Reply-To: <902F0015-B83D-4281-A83B-426750EDBA23@gmail.com>
References: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
 <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>
 <F89CCA66-09B1-45B3-AABE-E3D02BEF671C@gmail.com>
 <902F0015-B83D-4281-A83B-426750EDBA23@gmail.com>
Message-ID: <ac364880-ded3-4a22-9845-b1cea684aa35@betaapp.fastmail.com>

It's a bit strange, I can reproduce it when pasting into the REPL, but not when running from a file.

Laurentiu

On Fri, May 26, 2023, at 20:27, Michael Smith wrote:
> Well, a new install of gdal from conda-forge and now it works fine. 
> Sorry for the noise.
>
> Mike
>
>
> -- 
>
> Michael Smith 
> Remote Sensing/GIS Center 
> US Army Corps of Engineers 

From even.rouault at spatialys.com  Fri May 26 10:48:05 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 26 May 2023 19:48:05 +0200
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
In-Reply-To: <ac364880-ded3-4a22-9845-b1cea684aa35@betaapp.fastmail.com>
References: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
 <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>
 <F89CCA66-09B1-45B3-AABE-E3D02BEF671C@gmail.com>
 <902F0015-B83D-4281-A83B-426750EDBA23@gmail.com>
 <ac364880-ded3-4a22-9845-b1cea684aa35@betaapp.fastmail.com>
Message-ID: <62f7b73a-da3e-9292-ff9f-584b8c72a2a9@spatialys.com>


Le 26/05/2023 ? 19:40, Lauren?iu Nicola via gdal-dev a ?crit?:
> It's a bit strange, I can reproduce it when pasting into the REPL, but not when running from a file.

yes, the issue must come from the fact that gdal.VectorTranslate() 
returns a gdal.Dataset handle that is still active, and you could 
potentially add new features to it, hence the closing "] }" are emitted 
just when it is closed. In an interactive shell, for some reason the 
gdal.Dataset handle is not immediately closed when 
gdal.VectorTranslate() returns.

A safer way would be to explicitly do:

out_ds = gdal.VectorTranslate(...)

del out_ds

before getting the file content

>
> Laurentiu
>
> On Fri, May 26, 2023, at 20:27, Michael Smith wrote:
>> Well, a new install of gdal from conda-forge and now it works fine.
>> Sorry for the noise.
>>
>> Mike
>>
>>
>> -- 
>>
>> Michael Smith
>> Remote Sensing/GIS Center
>> US Army Corps of Engineers
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From lnicola at dend.ro  Fri May 26 10:52:59 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Fri, 26 May 2023 20:52:59 +0300
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
In-Reply-To: <62f7b73a-da3e-9292-ff9f-584b8c72a2a9@spatialys.com>
References: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
 <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>
 <F89CCA66-09B1-45B3-AABE-E3D02BEF671C@gmail.com>
 <902F0015-B83D-4281-A83B-426750EDBA23@gmail.com>
 <ac364880-ded3-4a22-9845-b1cea684aa35@betaapp.fastmail.com>
 <62f7b73a-da3e-9292-ff9f-584b8c72a2a9@spatialys.com>
Message-ID: <db1cbdad-0a62-4272-b3e5-d7262d304a06@betaapp.fastmail.com>

On Fri, May 26, 2023, at 20:48, Even Rouault wrote:
> yes, the issue must come from the fact that gdal.VectorTranslate() 
> returns a gdal.Dataset handle that is still active, and you could 

That's what I originally tried and it didn't work, but it does now. Maybe I made a typo.
Seems all right, then, sorry for the confusion.

Laurentiu

From michael.smith.erdc at gmail.com  Fri May 26 10:53:42 2023
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Fri, 26 May 2023 13:53:42 -0400
Subject: [gdal-dev] ogr.VectorTranslate to json appears to be incomplete
In-Reply-To: <62f7b73a-da3e-9292-ff9f-584b8c72a2a9@spatialys.com>
References: <A69DF130-E8B8-473C-82A1-D30C9B031739@gmail.com>
 <843a9456-9a82-e79e-4975-5831d4087b81@spatialys.com>
 <F89CCA66-09B1-45B3-AABE-E3D02BEF671C@gmail.com>
 <902F0015-B83D-4281-A83B-426750EDBA23@gmail.com>
 <ac364880-ded3-4a22-9845-b1cea684aa35@betaapp.fastmail.com>
 <62f7b73a-da3e-9292-ff9f-584b8c72a2a9@spatialys.com>
Message-ID: <F60CB500-2990-431C-A7A3-E06A42510609@gmail.com>

Yes! That is it. It explains so much. Thanks for figuring this out. I learned something important today.


-- 

Michael Smith 
Remote Sensing/GIS Center 
US Army Corps of Engineers 





?On 5/26/23, 1:48 PM, "gdal-dev on behalf of Even Rouault" <gdal-dev-bounces at lists.osgeo.org <mailto:gdal-dev-bounces at lists.osgeo.org> on behalf of even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>> wrote:




Le 26/05/2023 ? 19:40, Lauren?iu Nicola via gdal-dev a ?crit :
> It's a bit strange, I can reproduce it when pasting into the REPL, but not when running from a file.


yes, the issue must come from the fact that gdal.VectorTranslate() 
returns a gdal.Dataset handle that is still active, and you could 
potentially add new features to it, hence the closing "] }" are emitted 
just when it is closed. In an interactive shell, for some reason the 
gdal.Dataset handle is not immediately closed when 
gdal.VectorTranslate() returns.


A safer way would be to explicitly do:


out_ds = gdal.VectorTranslate(...)


del out_ds


before getting the file content


>
> Laurentiu
>
> On Fri, May 26, 2023, at 20:27, Michael Smith wrote:
>> Well, a new install of gdal from conda-forge and now it works fine.
>> Sorry for the noise.
>>
>> Mike
>>
>>
>> -- 
>>
>> Michael Smith
>> Remote Sensing/GIS Center
>> US Army Corps of Engineers
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev>


-- 
http://www.spatialys.com <http://www.spatialys.com>
My software is free, but my time generally not.


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev>





From bradh at frogmouth.net  Fri May 26 23:22:09 2023
From: bradh at frogmouth.net (Brad Hards)
Date: Sat, 27 May 2023 16:22:09 +1000
Subject: [gdal-dev] Extracting Jpeg2000 image from nitf file
In-Reply-To: <ad95feff-07bd-632f-4233-8b97349130f6@spatialys.com>
References: <CALGHxB3=9AJGhP3uzLW801XWZJkhaHKEetSM35tiztegYZGzMw@mail.gmail.com>
 <ad95feff-07bd-632f-4233-8b97349130f6@spatialys.com>
Message-ID: <4831208.31r3eYUQgx@audax>

On Friday, 26 May 2023 8:09:50 PM AEST Even Rouault wrote:
> Hi,
> 
> if you open such an image with debug traces (CPL_DEBUG=ON), you'll see
> something like
> 
> GDAL: GDALOpen(/vsisubfile/907_565,byte.ntf, this=....) succeeds as
> JP2OpenJPEG
> 
> which means that the JPEG2000 file starts at byte 907 with a length of
> 565 bytes.
> 
> Programatically from C/C++ , you could use the GDALGetOpenDatasets()
> methods after having opening the NITF file, and look for /vsisubfile/ files

I would caution that this will give you the image segment (amongst other 
segments, possibly), which may not correspond directly to the JPEG 2000 
codestream. In particular, if you have M8 compression, you may need to parse 
the image mask table off the front of that data. Also, depending on what the 
data is, the actual imagery may need to have LUT processing applied, etc.

Brad



From mtobby59 at gmail.com  Fri May 26 23:35:21 2023
From: mtobby59 at gmail.com (Tobby Moalem)
Date: Sat, 27 May 2023 09:35:21 +0300
Subject: [gdal-dev] Extracting Jpeg2000 image from nitf file
In-Reply-To: <ad95feff-07bd-632f-4233-8b97349130f6@spatialys.com>
References: <CALGHxB3=9AJGhP3uzLW801XWZJkhaHKEetSM35tiztegYZGzMw@mail.gmail.com>
 <ad95feff-07bd-632f-4233-8b97349130f6@spatialys.com>
Message-ID: <CALGHxB1sSfZZf+TjjxR_XR185eXHq5vEqbi0PbLji=UTMvDBig@mail.gmail.com>

Hi Even,
Thanks for the help.
I was wondering if I could just get this byte range from the file, and save
it as jpeg2000 (with .j2c or something like that) and have a valid jpeg2000?
My goal is to be able to extract the jpeg2000 without using gdal_translate
in order to save time and resources (cpu, ram, ...), as for my
understanding the gdal_translate will always recompress the image.

Thanks,
Tobby

On Fri, May 26, 2023 at 1:09?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> if you open such an image with debug traces (CPL_DEBUG=ON), you'll see
> something like
>
> GDAL: GDALOpen(/vsisubfile/907_565,byte.ntf, this=....) succeeds as
> JP2OpenJPEG
>
> which means that the JPEG2000 file starts at byte 907 with a length of
> 565 bytes.
>
> Programatically from C/C++ , you could use the GDALGetOpenDatasets()
> methods after having opening the NITF file, and look for /vsisubfile/ files
>
> Even
>
> Le 26/05/2023 ? 08:57, Tobby Moalem a ?crit :
> > Hi,
> > For my understanding the nitf file is used as container, where
> > compressed jpeg2000 can be saved inside the nitf file.
> > I wonder if there is a way to use gdal to extract the jpeg2000 part
> > and save it separately (with extension of .j2c or other jpeg2000
> > extensions) ?
> >
> > Thanks in advance,
> > Tobby
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230527/911d09bd/attachment.htm>

From bo.victor.thomsen at gmail.com  Sat May 27 13:08:21 2023
From: bo.victor.thomsen at gmail.com (Bo Victor Thomsen)
Date: Sat, 27 May 2023 22:08:21 +0200
Subject: [gdal-dev] Spatial view in GeoPackage
Message-ID: <524937cf-9890-6165-9949-8a549b867dd0@gmail.com>

Hi list -

I'm working with making spatial views "visible" for QGIS, i.e. so they 
look like a read-only table from the data source manager.

However, I have one problem:? QGIS doesn't recognize the crs for the 
view. I've tracked the problem down to that *OGR* dosn't recognize the 
crs for the view. Hence this mail...

What I've done:

*- creating the view: A union of parcels with the same owner (CVR-number)
CREATE VIEW marker_2019_cvr AS
 ? SELECT "CVR", SUM(COALESCE(st_area(geom),0.0)) as area_m2, count(*) 
as antal, st_multi(st_union(geom)) as geom from marker_2019 group by 1;

-- insert or update gpkg_contents
INSERT OR REPLACE INTO 
gpkg_contents(table_name,data_type,identifier,min_x,min_y,max_x,max_y,srs_id)
 ? SELECT
 ??? 'marker_2019_cvr' AS table_name,
 ??? 'features' AS data_type,
 ??? 'marker_2019_cvr' AS identifier,
 ??? MIN(ST_MinX(geom)) AS min_x,
 ??? MIN(ST_MinY(geom)) AS min_y,
 ??? MAX(ST_MaxX(geom)) AS max_x,
 ??? MAX(ST_MaxY(geom)) AS max_y,
 ??? 25832 AS srs_id -- same srs as the base layer for the view
 ? FROM marker_2019_cvr;

-- insert or update gpkg_geometry_columns
INSERT OR REPLACE INTO gpkg_geometry_columns ( table_name, column_name , 
geometry_type_name, srs_id, z, m)
 ? VALUES ('marker_2019_cvr', 'geom', 'MULTIPOLYGON', 25832, 0, 0);

-- insert or update gpkg_ogr_columns (necessary ?)
INSERT OR REPLACE INTO gpkg_ogr_contents(table_name,feature_count)
 ? SELECT
 ??? 'marker_2019_cvr' AS table_name,
 ??? count(*) AS feature_count
 ? FROM marker_2019_cvr;
*

AFAIK, this is the necessary steps to make a spatial view visible in a 
GeoPackage. And it works; sort of...

The QGIS datasource manager shows the view as a spatial table. I can add 
it to the QGIS map, but... it can't find the CRS for the layer and 
defaults to the projects CRS.

Digging a litle bit deeper: Using ogrinfo like this:

*ogrinfo -ro -so data_marker_vandloeb_soe.gpkg marker_2019_cvr*

shows the layers SRS WKT as (unknown).

Using the same command on the base layer *marker_2019 *gives the correct 
WKT.

25832 is the correct EPSG number for the CRS. And the definition exists 
in the *gpkg_spatial_ref_sys* table.

What am I doing wrong ? Or is it just "out of scope" for OGR ??

-- 
Med venlig hilsen / Best regards

Bo Victor Thomsen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230527/0c0e3644/attachment.htm>

From even.rouault at spatialys.com  Sat May 27 14:38:42 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 27 May 2023 23:38:42 +0200
Subject: [gdal-dev] Spatial view in GeoPackage
In-Reply-To: <524937cf-9890-6165-9949-8a549b867dd0@gmail.com>
References: <524937cf-9890-6165-9949-8a549b867dd0@gmail.com>
Message-ID: <afece9a3-8b07-fe63-ae12-7c70c9c398d8@spatialys.com>

Bo Victor,

there was indeed a bug in the OGR GPKG driver preventing you to do what 
you wanted. Fixed per https://github.com/OSGeo/gdal/pull/7848

The issue was specific to the fact that the geometry column of the view 
is computed, and not just the simple selection of one of a table.

Note that such GeoPackage will probably only be readable by 
implementations that install Spatialite (or Spatialite compatible 
functions). It might also be prudent to wrap the result of ST_Multi() 
with AsGPB() to force creating a GeoPackage geometry blob instead of a 
Spatialite one. The OGR GPKG driver is tolerant to receiving both types 
of geometries, but technically the content should be a GeoPackage one.

Inserting into gpkg_ogr_contents is optional. Its purpose is to 
accelerate counting the number of features. But for layers < let's say 
100 k features, it probably doesn't impact performance much.

Even

Le 27/05/2023 ? 22:08, Bo Victor Thomsen a ?crit?:
>
> Hi list -
>
> I'm working with making spatial views "visible" for QGIS, i.e. so they 
> look like a read-only table from the data source manager.
>
> However, I have one problem:? QGIS doesn't recognize the crs for the 
> view. I've tracked the problem down to that *OGR* dosn't recognize the 
> crs for the view. Hence this mail...
>
> What I've done:
>
> *- creating the view: A union of parcels with the same owner (CVR-number)
> CREATE VIEW marker_2019_cvr AS
> ? SELECT "CVR", SUM(COALESCE(st_area(geom),0.0)) as area_m2, count(*) 
> as antal, st_multi(st_union(geom)) as geom from marker_2019 group by 1;
>
> -- insert or update gpkg_contents
> INSERT OR REPLACE INTO 
> gpkg_contents(table_name,data_type,identifier,min_x,min_y,max_x,max_y,srs_id)
> ? SELECT
> ??? 'marker_2019_cvr' AS table_name,
> ??? 'features' AS data_type,
> ??? 'marker_2019_cvr' AS identifier,
> ??? MIN(ST_MinX(geom)) AS min_x,
> ??? MIN(ST_MinY(geom)) AS min_y,
> ??? MAX(ST_MaxX(geom)) AS max_x,
> ??? MAX(ST_MaxY(geom)) AS max_y,
> ??? 25832 AS srs_id -- same srs as the base layer for the view
> ? FROM marker_2019_cvr;
>
> -- insert or update gpkg_geometry_columns
> INSERT OR REPLACE INTO gpkg_geometry_columns ( table_name, column_name 
> , geometry_type_name, srs_id, z, m)
> ? VALUES ('marker_2019_cvr', 'geom', 'MULTIPOLYGON', 25832, 0, 0);
>
> -- insert or update gpkg_ogr_columns (necessary ?)
> INSERT OR REPLACE INTO gpkg_ogr_contents(table_name,feature_count)
> ? SELECT
> ??? 'marker_2019_cvr' AS table_name,
> ??? count(*) AS feature_count
> ? FROM marker_2019_cvr;
> *
>
> AFAIK, this is the necessary steps to make a spatial view visible in a 
> GeoPackage. And it works; sort of...
>
> The QGIS datasource manager shows the view as a spatial table. I can 
> add it to the QGIS map, but... it can't find the CRS for the layer and 
> defaults to the projects CRS.
>
> Digging a litle bit deeper: Using ogrinfo like this:
>
> *ogrinfo -ro -so data_marker_vandloeb_soe.gpkg marker_2019_cvr*
>
> shows the layers SRS WKT as (unknown).
>
> Using the same command on the base layer *marker_2019 *gives the 
> correct WKT.
>
> 25832 is the correct EPSG number for the CRS. And the definition 
> exists in the *gpkg_spatial_ref_sys* table.
>
> What am I doing wrong ? Or is it just "out of scope" for OGR ??
>
> -- 
> Med venlig hilsen / Best regards
>
> Bo Victor Thomsen
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230527/4065e43e/attachment.htm>

From mdsumner at gmail.com  Sat May 27 17:18:13 2023
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 28 May 2023 10:18:13 +1000
Subject: [gdal-dev] configuration option GDAL_RASTERIO_RESAMPLING
Message-ID: <CAAcGz9-gSzj1cXPhhyOiAHskhf_Tq5_oaBceFv0Oqz=opVoENA@mail.gmail.com>

Hi, I'm very happy to see the refactor of documentation for configuration
and environment options, primarily by Dan Baston in recent weeks - thanks!

https://gdal.org/user/configoptions.html

Does the GDAL_RASTERIO_RESAMPLING option belong in this list?  I'm
exploring its use versus setting resampling with the API, and I gather also
that there is not an analogous config option for the warper.

Thank you, Mike

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/24c02ce4/attachment.htm>

From dbaston at gmail.com  Sat May 27 17:33:24 2023
From: dbaston at gmail.com (Daniel Baston)
Date: Sat, 27 May 2023 20:33:24 -0400
Subject: [gdal-dev] configuration option GDAL_RASTERIO_RESAMPLING
In-Reply-To: <CAAcGz9-gSzj1cXPhhyOiAHskhf_Tq5_oaBceFv0Oqz=opVoENA@mail.gmail.com>
References: <CAAcGz9-gSzj1cXPhhyOiAHskhf_Tq5_oaBceFv0Oqz=opVoENA@mail.gmail.com>
Message-ID: <CA+K_q_p8sVjeYtB-ba7a9h7NCyJLiRsOg7U4SHH86q0S0j-6Qw@mail.gmail.com>

Hi Mike,

The content on the page you linked is for the most part a simple transfer
of what was available on the wiki, plus a few options that were previously
defined on driver or other pages. It is not complete.

There are also about 500 configuration options that are used in the code
via CPLGetConfigOption that do not appear in the documentation,
GDAL_RASTERIO_RESAMPLING being one of them. Some of these are clearly not
intended to be part of the GDAL interface, but there's still quite a bit
that can be added to the documentation. I can create an issue and post the
script I used to scan for these if others are interested in filling some of
the gaps.

Dan







On Sat, May 27, 2023 at 8:18?PM Michael Sumner <mdsumner at gmail.com> wrote:

> Hi, I'm very happy to see the refactor of documentation for configuration
> and environment options, primarily by Dan Baston in recent weeks - thanks!
>
> https://gdal.org/user/configoptions.html
>
> Does the GDAL_RASTERIO_RESAMPLING option belong in this list?  I'm
> exploring its use versus setting resampling with the API, and I gather also
> that there is not an analogous config option for the warper.
>
> Thank you, Mike
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230527/b7cbf665/attachment-0001.htm>

From mdsumner at gmail.com  Sat May 27 18:05:35 2023
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 28 May 2023 11:05:35 +1000
Subject: [gdal-dev] configuration option GDAL_RASTERIO_RESAMPLING
In-Reply-To: <CA+K_q_p8sVjeYtB-ba7a9h7NCyJLiRsOg7U4SHH86q0S0j-6Qw@mail.gmail.com>
References: <CAAcGz9-gSzj1cXPhhyOiAHskhf_Tq5_oaBceFv0Oqz=opVoENA@mail.gmail.com>
 <CA+K_q_p8sVjeYtB-ba7a9h7NCyJLiRsOg7U4SHH86q0S0j-6Qw@mail.gmail.com>
Message-ID: <CAAcGz9_8dTsVgRrRSHr2DzTXb2vzbTZs5wKmhFWKOqvgC0zT1g@mail.gmail.com>

Ah great thanks, interested to help flush these out.

Cheers, Mike






On Sun, 28 May 2023, 10:34 Daniel Baston, <dbaston at gmail.com> wrote:

> Hi Mike,
>
> The content on the page you linked is for the most part a simple transfer
> of what was available on the wiki, plus a few options that were previously
> defined on driver or other pages. It is not complete.
>
> There are also about 500 configuration options that are used in the code
> via CPLGetConfigOption that do not appear in the documentation,
> GDAL_RASTERIO_RESAMPLING being one of them. Some of these are clearly not
> intended to be part of the GDAL interface, but there's still quite a bit
> that can be added to the documentation. I can create an issue and post the
> script I used to scan for these if others are interested in filling some of
> the gaps.
>
> Dan
>
>
>
>
>
>
>
> On Sat, May 27, 2023 at 8:18?PM Michael Sumner <mdsumner at gmail.com> wrote:
>
>> Hi, I'm very happy to see the refactor of documentation for configuration
>> and environment options, primarily by Dan Baston in recent weeks - thanks!
>>
>> https://gdal.org/user/configoptions.html
>>
>> Does the GDAL_RASTERIO_RESAMPLING option belong in this list?  I'm
>> exploring its use versus setting resampling with the API, and I gather also
>> that there is not an analogous config option for the warper.
>>
>> Thank you, Mike
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/1b8bac4b/attachment.htm>

From ahmettemiz88 at gmail.com  Sun May 28 07:56:10 2023
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Sun, 28 May 2023 17:56:10 +0300
Subject: [gdal-dev] problem in GDALRasterize
Message-ID: <CAJKO1Yt7mgpqZDxWrmio-zE-fi6wFGmk3QstgWOcU4a9ydm2jQ@mail.gmail.com>

Hi,
I want to use GDALRasterize.
here is the code: (GDALRasterizeOptions is problematic)

#include "/usr/include/gdal/gdal_priv.h"
#include </usr/include/gdal/gdal.h>
#include </usr/include/gdal/gdal_utils.h>
#include <gdal/ogr_geometry.h>
#include <iostream>
#include <errno.h>

int main()
{
    // Register GDAL drivers
    GDALAllRegister();

    // Set the driver for the output raster dataset
    GDALDriver* driver = GetGDALDriverManager()->GetDriverByName("GTiff");

    // Define the dimensions and properties of the output raster dataset
    int width = 100;
    int height = 100;
    int num_bands = 1;
    GDALDataType data_type = GDT_Byte;  // Data type of the raster values
    const char* output_path = "output.tif";  // Path to the output raster
dataset

    // Create an empty raster dataset
    GDALDataset* dataset = driver->Create(output_path, width, height,
num_bands, data_type, nullptr);

    // Set the spatial reference system of the raster dataset (optional)
    OGRSpatialReference srs;
    srs.importFromEPSG(4326);  // WGS84
    char* srs_wkt = nullptr;
    srs.exportToWkt(&srs_wkt);
    dataset->SetProjection(srs_wkt);
    CPLFree(srs_wkt);

    // Open the vector file and get the layer
    const char* vector_path = "test.shp";  // Path to the input vector file
    GDALDataset* vector_dataset = (GDALDataset*)GDALOpenEx(vector_path,
   GDAL_OF_VECTOR, nullptr, nullptr, nullptr);
    OGRLayer* layer = vector_dataset->GetLayer(0);

    // Set the rasterization options
    GDALRasterizeOptions options;
    options.width = width;
    options.height = height;
    options.outputType = data_type;
    options.burnValues = nullptr;  // Optional array of values to burn into
the raster

    // Rasterize the vector layer into the output raster dataset
    GDALRasterize(dataset, num_bands, &layer, &options, nullptr, nullptr);
    // Cleanup
    GDALClose(vector_dataset);
    GDALClose(dataset);

    // Cleanup GDAL
    GDALDestroyDriverManager();

    return 0;
}

Can you tell me what is wrong ?

regards


-- 
Ahmet Temiz
Jeoloji M?h.
Afet ve Acil Durum Y?netimi Ba?kanl???
Deprem  Dairesi Ba?kanl???


________________________

Ahmet Temiz
Geological Eng.

Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/03c042b9/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Sun May 28 10:12:45 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Sun, 28 May 2023 17:12:45 +0000
Subject: [gdal-dev] Spatial view in GeoPackage
In-Reply-To: <afece9a3-8b07-fe63-ae12-7c70c9c398d8@spatialys.com>
References: <524937cf-9890-6165-9949-8a549b867dd0@gmail.com>
 <afece9a3-8b07-fe63-ae12-7c70c9c398d8@spatialys.com>
Message-ID: <AM6PR09MB3222E7F36C80B6A5806759C1FD459@AM6PR09MB3222.eurprd09.prod.outlook.com>

Hi,

Fixed for this use case, but what if user wants to use  ST_Tranform(...  in the view? Or something that may change the geometry type like ST_Intersection, ST_Buffer etc? In these cases I think that at least the usage of the spatial index of the main table should be disabled. But how could GDAL know when to skip the spatial index and when not? With a special column in gpkg_ogr_contents perhaps?

Somehow I do not feel comfortable. Maybe there should be a warning in
https://gdal.org/drivers/vector/gpkg.html#spatial-views that SpatiaLite functions should be used carefully in the views and such databases should be delivered only for known users, while views with uncomputed geometries should be safe and interoperable.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: sunnuntai 28. toukokuuta 2023 0.39
Vastaanottaja: Bo Victor Thomsen <bo.victor.thomsen at gmail.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] Spatial view in GeoPackage


Bo Victor,

there was indeed a bug in the OGR GPKG driver preventing you to do what you wanted. Fixed per https://github.com/OSGeo/gdal/pull/7848

The issue was specific to the fact that the geometry column of the view is computed, and not just the simple selection of one of a table.

Note that such GeoPackage will probably only be readable by implementations that install Spatialite (or Spatialite compatible functions). It might also be prudent to wrap the result of ST_Multi() with AsGPB() to force creating a GeoPackage geometry blob instead of a Spatialite one. The OGR GPKG driver is tolerant to receiving both types of geometries, but technically the content should be a GeoPackage one.

Inserting into gpkg_ogr_contents is optional. Its purpose is to accelerate counting the number of features. But for layers < let's say 100 k features, it probably doesn't impact performance much.

Even
Le 27/05/2023 ? 22:08, Bo Victor Thomsen a ?crit :

Hi list -

I'm working with making spatial views "visible" for QGIS, i.e. so they look like a read-only table from the data source manager.

However, I have one problem:  QGIS doesn't recognize the crs for the view. I've tracked the problem down to that OGR dosn't recognize the crs for the view. Hence this mail...

What I've done:

- creating the view: A union of parcels with the same owner (CVR-number)
CREATE VIEW marker_2019_cvr AS
  SELECT "CVR", SUM(COALESCE(st_area(geom),0.0)) as area_m2, count(*) as antal, st_multi(st_union(geom)) as geom from marker_2019 group by 1;

-- insert or update gpkg_contents
INSERT OR REPLACE INTO gpkg_contents(table_name,data_type,identifier,min_x,min_y,max_x,max_y,srs_id)
  SELECT
    'marker_2019_cvr' AS table_name,
    'features' AS data_type,
    'marker_2019_cvr' AS identifier,
    MIN(ST_MinX(geom)) AS min_x,
    MIN(ST_MinY(geom)) AS min_y,
    MAX(ST_MaxX(geom)) AS max_x,
    MAX(ST_MaxY(geom)) AS max_y,
    25832 AS srs_id -- same srs as the base layer for the view
  FROM marker_2019_cvr;

-- insert or update gpkg_geometry_columns
INSERT OR REPLACE INTO gpkg_geometry_columns ( table_name, column_name , geometry_type_name, srs_id, z, m)
  VALUES ('marker_2019_cvr', 'geom', 'MULTIPOLYGON', 25832, 0, 0);

-- insert or update gpkg_ogr_columns (necessary ?)
INSERT OR REPLACE INTO gpkg_ogr_contents(table_name,feature_count)
  SELECT
    'marker_2019_cvr' AS table_name,
    count(*) AS feature_count
  FROM marker_2019_cvr;

AFAIK, this is the necessary steps to make a spatial view visible in a GeoPackage. And it works; sort of...

The QGIS datasource manager shows the view as a spatial table. I can add it to the QGIS map, but... it can't find the CRS for the layer and defaults to the projects CRS.

Digging a litle bit deeper: Using ogrinfo like this:

ogrinfo -ro -so data_marker_vandloeb_soe.gpkg marker_2019_cvr

shows the layers SRS WKT as (unknown).

Using the same command on the base layer marker_2019 gives the correct WKT.

25832 is the correct EPSG number for the CRS. And the definition exists in the gpkg_spatial_ref_sys table.

What am I doing wrong ? Or is it just "out of scope" for OGR ??

--

Med venlig hilsen / Best regards



Bo Victor Thomsen



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/d8c16c34/attachment-0001.htm>

From jctoney at gmail.com  Sun May 28 11:12:20 2023
From: jctoney at gmail.com (Chris Toney)
Date: Sun, 28 May 2023 12:12:20 -0600
Subject: [gdal-dev] configuration option GDAL_RASTERIO_RESAMPLING
Message-ID: <CALRbqOTpQVvkr2fSU2nkpWzQga0U9_dR9GaU9bD26S3c5ya=MQ@mail.gmail.com>

Hi,
The GDAL_RASTERIO_RESAMPLING configuration option appears in the
documentation for psExtraArg in GDALDataset::RasterIO:

https://gdal.org/api/gdaldataset_cpp.html#_CPPv4N11GDALDataset8RasterIOE10GDALRWFlagiiiiPvii12GDALDataTypeiPi8GSpacing8GSpacing8GSpacingP20GDALRasterIOExtraArg

Chris


> Date: Sat, 27 May 2023 20:33:24 -0400
> From: Daniel Baston <dbaston at gmail.com>
> To: Michael Sumner <mdsumner at gmail.com>
> Cc: gdal-dev <gdal-dev at lists.osgeo.org>
> Subject: Re: [gdal-dev] configuration option GDAL_RASTERIO_RESAMPLING
> Message-ID:
    <CA+K_q_p8sVjeYtB-ba7a9h7NCyJLiRsOg7U4SHH86q0S0j-6Qw at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hi Mike,
>
> The content on the page you linked is for the most part a simple transfer
> of what was available on the wiki, plus a few options that were previously
> defined on driver or other pages. It is not complete.
>
> There are also about 500 configuration options that are used in the code
> via CPLGetConfigOption that do not appear in the documentation,
> GDAL_RASTERIO_RESAMPLING being one of them. Some of these are clearly not
> intended to be part of the GDAL interface, but there's still quite a bit
> that can be added to the documentation. I can create an issue and post the
> script I used to scan for these if others are interested in filling some
of
> the gaps.
>
> Dan



> On Sat, May 27, 2023 at 8:18?PM Michael Sumner <mdsumner at gmail.com> wrote:

> Hi, I'm very happy to see the refactor of documentation for configuration
> and environment options, primarily by Dan Baston in recent weeks - thanks!
>
> https://gdal.org/user/configoptions.html
>
> Does the GDAL_RASTERIO_RESAMPLING option belong in this list?  I'm
> exploring its use versus setting resampling with the API, and I gather
also
> that there is not an analogous config option for the warper.
>
> Thank you, Mike
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/6018e963/attachment.htm>

From sean.gillies at gmail.com  Sun May 28 12:49:46 2023
From: sean.gillies at gmail.com (Sean Gillies)
Date: Sun, 28 May 2023 13:49:46 -0600
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
Message-ID: <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>

Hi Even,

I took better notes during my latest upgrade and wrote them down here:
https://github.com/rasterio/rasterio-wheels/pull/106#issue-1720809259.

Using the CMake files as a source of truth helps. But they don't describe
everything. For example, they don't explain that GDAL needs libhdf5 to be
built with special features. That one stumped me for a while. I was seeing
a build message like "HDF5 not detected (found version 1.12.1)". I finally
found the clue in the vcpkg repo.

Also, the CMake files don't explain that the GDAL MBTiles driver depends on
the OGR MVT driver.


On Mon, May 22, 2023 at 8:53?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi Sean,
>
> I presume you got this because you defined OGR_BUILD_OPTIONAL_DRIVERS=OFF
> which then cause OGR_ENABLE_DRIVER_AVC to be set to OFF.
>
> We already a quite overwhelming amount of documentation in
> https://gdal.org/development/building_from_source.html about all the
> existing variables, and I'm not sure adding an exhaustive list of all the
> inter driver dependencies will be user-digestable and could rot easily.
>
> That said in https://github.com/OSGeo/gdal/pull/7806 I've tried to
> improve the current error message with a hint for the reason for the error
> and the (likely) reason for it to happen.
>
> I've also added pointers in the doc page to the CMakeLists.txt files where
> the dependencies are expressed. Hopefully people who are in the business of
> making custom GDAL builds can make sense of that.
>
> Even
> Le 20/05/2023 ? 01:26, Sean Gillies a ?crit :
>
> Hi all,
>
> I really appreciate the documentation at
> https://gdal.org/development/building_from_source.html. But there are
> gaps. For example, today I ran into
>
> CMake Error at cmake/helpers/GdalDriverHelper.cmake:331 (message):
> GDAL_ENABLE_DRIVER_AIGRID cannot be enabled because condition
> OGR_ENABLE_DRIVER_AVC is not met. To ignore this error (but the driver
> will not be built), set the GDAL_IGNORE_FAILED_CONDITIONS variable
>
> This dependence isn't documented. It's a bit frustrating to work through
> missing directives one at a time when adding new drivers to my build.
>
> Is it possible for a driver's dependencies to be enabled when I enable a
> driver?
>
> If not, can we consider using GDAL maintenance funding and resources on
> documenting the heck out of this system?
>
>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/b774ecff/attachment.htm>

From even.rouault at spatialys.com  Sun May 28 12:52:03 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 28 May 2023 21:52:03 +0200
Subject: [gdal-dev] Spatial view in GeoPackage
In-Reply-To: <AM6PR09MB3222E7F36C80B6A5806759C1FD459@AM6PR09MB3222.eurprd09.prod.outlook.com>
References: <524937cf-9890-6165-9949-8a549b867dd0@gmail.com>
 <afece9a3-8b07-fe63-ae12-7c70c9c398d8@spatialys.com>
 <AM6PR09MB3222E7F36C80B6A5806759C1FD459@AM6PR09MB3222.eurprd09.prod.outlook.com>
Message-ID: <4308c313-a8bd-d0a4-2819-3b17722ff4c1@spatialys.com>

Jukka,

currently the driver doesn't try to use the RTree of the base table (it 
could probably do it, but it would require first to check that both the 
FID column and geometry column of the same underlying table are available)

Jukka, Bo,

Regarding the use of Spatialite functions, I think the cleanest way is 
to define an extension to register such computed geometry column. That's 
what I've done in 
https://github.com/OSGeo/gdal/pull/7848/commits/8d7468f5342e3e9e54c11c913b8ca53f3effc4b3 
. It is the responsibility of the user creating the view to register the 
extension for its table, as show in 
https://github.com/OSGeo/gdal/blob/8d7468f5342e3e9e54c11c913b8ca53f3effc4b3/doc/source/drivers/vector/gpkg_spatialite_computed_geom_column.rst#extension-name-or-template

The 
https://github.com/OSGeo/gdal/blob/master/swig/python/gdal-utils/osgeo_utils/samples/validate_gpkg.py 
script (once updated by the PR) will use that to avoid erroring out.

Even

Le 28/05/2023 ? 19:12, Rahkonen Jukka a ?crit?:
>
> Hi,
>
> Fixed for this use case, but what if user wants to use ?ST_Tranform(? 
> ?in the view? Or something that may change the geometry type like 
> ST_Intersection, ST_Buffer etc? In these cases I think that at least 
> the usage of the spatial index of the main table should be disabled. 
> But how could GDAL know when to skip the spatial index and when not? 
> With a special column in gpkg_ogr_contents perhaps?
>
> Somehow I do not feel comfortable. Maybe there should be a warning in
>
> https://gdal.org/drivers/vector/gpkg.html#spatial-views that 
> SpatiaLite functions should be used carefully in the views and such 
> databases should be delivered only for known users, while views with 
> uncomputed geometries should be safe and interoperable.
>
> -Jukka Rahkonen-
>
> *L?hett?j?:*gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Even Rouault
> *L?hetetty:* sunnuntai 28. toukokuuta 2023 0.39
> *Vastaanottaja:* Bo Victor Thomsen <bo.victor.thomsen at gmail.com>; 
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] Spatial view in GeoPackage
>
> Bo Victor,
>
> there was indeed a bug in the OGR GPKG driver preventing you to do 
> what you wanted. Fixed per https://github.com/OSGeo/gdal/pull/7848
>
> The issue was specific to the fact that the geometry column of the 
> view is computed, and not just the simple selection of one of a table.
>
> Note that such GeoPackage will probably only be readable by 
> implementations that install Spatialite (or Spatialite compatible 
> functions). It might also be prudent to wrap the result of ST_Multi() 
> with AsGPB() to force creating a GeoPackage geometry blob instead of a 
> Spatialite one. The OGR GPKG driver is tolerant to receiving both 
> types of geometries, but technically the content should be a 
> GeoPackage one.
>
> Inserting into gpkg_ogr_contents is optional. Its purpose is to 
> accelerate counting the number of features. But for layers < let's say 
> 100 k features, it probably doesn't impact performance much.
>
> Even
>
> Le 27/05/2023 ? 22:08, Bo Victor Thomsen a ?crit?:
>
>     Hi list -
>
>     I'm working with making spatial views "visible" for QGIS, i.e. so
>     they look like a read-only table from the data source manager.
>
>     However, I have one problem:? QGIS doesn't recognize the crs for
>     the view. I've tracked the problem down to that *OGR* dosn't
>     recognize the crs for the view. Hence this mail...
>
>     What I've done:
>
>     *- creating the view: A union of parcels with the same owner
>     (CVR-number)
>     CREATE VIEW marker_2019_cvr AS
>     ? SELECT "CVR", SUM(COALESCE(st_area(geom),0.0)) as area_m2,
>     count(*) as antal, st_multi(st_union(geom)) as geom from
>     marker_2019 group by 1;
>
>     -- insert or update gpkg_contents
>     INSERT OR REPLACE INTO
>     gpkg_contents(table_name,data_type,identifier,min_x,min_y,max_x,max_y,srs_id)
>     ? SELECT
>     ??? 'marker_2019_cvr' AS table_name,
>     ??? 'features' AS data_type,
>     ??? 'marker_2019_cvr' AS identifier,
>     ??? MIN(ST_MinX(geom)) AS min_x,
>     ??? MIN(ST_MinY(geom)) AS min_y,
>     ??? MAX(ST_MaxX(geom)) AS max_x,
>     ??? MAX(ST_MaxY(geom)) AS max_y,
>     ??? 25832 AS srs_id -- same srs as the base layer for the view
>     ? FROM marker_2019_cvr;
>
>     -- insert or update gpkg_geometry_columns
>     INSERT OR REPLACE INTO gpkg_geometry_columns ( table_name,
>     column_name , geometry_type_name, srs_id, z, m)
>     ? VALUES ('marker_2019_cvr', 'geom', 'MULTIPOLYGON', 25832, 0, 0);
>
>     -- insert or update gpkg_ogr_columns (necessary ?)
>     INSERT OR REPLACE INTO gpkg_ogr_contents(table_name,feature_count)
>     ? SELECT
>     ??? 'marker_2019_cvr' AS table_name,
>     ??? count(*) AS feature_count
>     ? FROM marker_2019_cvr;*
>
>     AFAIK, this is the necessary steps to make a spatial view visible
>     in a GeoPackage. And it works; sort of...
>
>     The QGIS datasource manager shows the view as a spatial table. I
>     can add it to the QGIS map, but... it can't find the CRS for the
>     layer and defaults to the projects CRS.
>
>     Digging a litle bit deeper: Using ogrinfo like this:
>
>     *ogrinfo -ro -so data_marker_vandloeb_soe.gpkg marker_2019_cvr*
>
>     shows the layers SRS WKT as (unknown).
>
>     Using the same command on the base layer *marker_2019 *gives the
>     correct WKT.
>
>     25832 is the correct EPSG number for the CRS. And the definition
>     exists in the *gpkg_spatial_ref_sys* table.
>
>     What am I doing wrong ? Or is it just "out of scope" for OGR ??
>
>     -- 
>
>     Med venlig hilsen / Best regards
>
>     Bo Victor Thomsen
>
>
>
>     _______________________________________________
>
>     gdal-dev mailing list
>
>     gdal-dev at lists.osgeo.org
>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/5a19438a/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Sun May 28 13:00:48 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Sun, 28 May 2023 20:00:48 +0000
Subject: [gdal-dev] Spatial view in GeoPackage
In-Reply-To: <4308c313-a8bd-d0a4-2819-3b17722ff4c1@spatialys.com>
References: <524937cf-9890-6165-9949-8a549b867dd0@gmail.com>
 <afece9a3-8b07-fe63-ae12-7c70c9c398d8@spatialys.com>
 <AM6PR09MB3222E7F36C80B6A5806759C1FD459@AM6PR09MB3222.eurprd09.prod.outlook.com>
 <4308c313-a8bd-d0a4-2819-3b17722ff4c1@spatialys.com>
Message-ID: <AM0PR09MB321907686EC23481DFDEC871FD459@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

I found https://github.com/opengeospatial/geopackage/issues/282 from 5 years ago that has also discussion about views and spatial indexes.

-Jukka-

L?hett?j?: Even Rouault <even.rouault at spatialys.com>
L?hetetty: sunnuntai 28. toukokuuta 2023 22.52
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>; Bo Victor Thomsen <bo.victor.thomsen at gmail.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] Spatial view in GeoPackage


Jukka,

currently the driver doesn't try to use the RTree of the base table (it could probably do it, but it would require first to check that both the FID column and geometry column of the same underlying table are available)

Jukka, Bo,

Regarding the use of Spatialite functions, I think the cleanest way is to define an extension to register such computed geometry column. That's what I've done in https://github.com/OSGeo/gdal/pull/7848/commits/8d7468f5342e3e9e54c11c913b8ca53f3effc4b3 . It is the responsibility of the user creating the view to register the extension for its table, as show in https://github.com/OSGeo/gdal/blob/8d7468f5342e3e9e54c11c913b8ca53f3effc4b3/doc/source/drivers/vector/gpkg_spatialite_computed_geom_column.rst#extension-name-or-template

The https://github.com/OSGeo/gdal/blob/master/swig/python/gdal-utils/osgeo_utils/samples/validate_gpkg.py script (once updated by the PR) will use that to avoid erroring out.

Even
Le 28/05/2023 ? 19:12, Rahkonen Jukka a ?crit :
Hi,

Fixed for this use case, but what if user wants to use  ST_Tranform(...  in the view? Or something that may change the geometry type like ST_Intersection, ST_Buffer etc? In these cases I think that at least the usage of the spatial index of the main table should be disabled. But how could GDAL know when to skip the spatial index and when not? With a special column in gpkg_ogr_contents perhaps?

Somehow I do not feel comfortable. Maybe there should be a warning in
https://gdal.org/drivers/vector/gpkg.html#spatial-views that SpatiaLite functions should be used carefully in the views and such databases should be delivered only for known users, while views with uncomputed geometries should be safe and interoperable.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: sunnuntai 28. toukokuuta 2023 0.39
Vastaanottaja: Bo Victor Thomsen <bo.victor.thomsen at gmail.com><mailto:bo.victor.thomsen at gmail.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] Spatial view in GeoPackage


Bo Victor,

there was indeed a bug in the OGR GPKG driver preventing you to do what you wanted. Fixed per https://github.com/OSGeo/gdal/pull/7848

The issue was specific to the fact that the geometry column of the view is computed, and not just the simple selection of one of a table.

Note that such GeoPackage will probably only be readable by implementations that install Spatialite (or Spatialite compatible functions). It might also be prudent to wrap the result of ST_Multi() with AsGPB() to force creating a GeoPackage geometry blob instead of a Spatialite one. The OGR GPKG driver is tolerant to receiving both types of geometries, but technically the content should be a GeoPackage one.

Inserting into gpkg_ogr_contents is optional. Its purpose is to accelerate counting the number of features. But for layers < let's say 100 k features, it probably doesn't impact performance much.

Even
Le 27/05/2023 ? 22:08, Bo Victor Thomsen a ?crit :

Hi list -

I'm working with making spatial views "visible" for QGIS, i.e. so they look like a read-only table from the data source manager.

However, I have one problem:  QGIS doesn't recognize the crs for the view. I've tracked the problem down to that OGR dosn't recognize the crs for the view. Hence this mail...

What I've done:

- creating the view: A union of parcels with the same owner (CVR-number)
CREATE VIEW marker_2019_cvr AS
  SELECT "CVR", SUM(COALESCE(st_area(geom),0.0)) as area_m2, count(*) as antal, st_multi(st_union(geom)) as geom from marker_2019 group by 1;

-- insert or update gpkg_contents
INSERT OR REPLACE INTO gpkg_contents(table_name,data_type,identifier,min_x,min_y,max_x,max_y,srs_id)
  SELECT
    'marker_2019_cvr' AS table_name,
    'features' AS data_type,
    'marker_2019_cvr' AS identifier,
    MIN(ST_MinX(geom)) AS min_x,
    MIN(ST_MinY(geom)) AS min_y,
    MAX(ST_MaxX(geom)) AS max_x,
    MAX(ST_MaxY(geom)) AS max_y,
    25832 AS srs_id -- same srs as the base layer for the view
  FROM marker_2019_cvr;

-- insert or update gpkg_geometry_columns
INSERT OR REPLACE INTO gpkg_geometry_columns ( table_name, column_name , geometry_type_name, srs_id, z, m)
  VALUES ('marker_2019_cvr', 'geom', 'MULTIPOLYGON', 25832, 0, 0);

-- insert or update gpkg_ogr_columns (necessary ?)
INSERT OR REPLACE INTO gpkg_ogr_contents(table_name,feature_count)
  SELECT
    'marker_2019_cvr' AS table_name,
    count(*) AS feature_count
  FROM marker_2019_cvr;

AFAIK, this is the necessary steps to make a spatial view visible in a GeoPackage. And it works; sort of...

The QGIS datasource manager shows the view as a spatial table. I can add it to the QGIS map, but... it can't find the CRS for the layer and defaults to the projects CRS.

Digging a litle bit deeper: Using ogrinfo like this:

ogrinfo -ro -so data_marker_vandloeb_soe.gpkg marker_2019_cvr

shows the layers SRS WKT as (unknown).

Using the same command on the base layer marker_2019 gives the correct WKT.

25832 is the correct EPSG number for the CRS. And the definition exists in the gpkg_spatial_ref_sys table.

What am I doing wrong ? Or is it just "out of scope" for OGR ??

--

Med venlig hilsen / Best regards



Bo Victor Thomsen




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/d361db82/attachment.htm>

From even.rouault at spatialys.com  Sun May 28 13:14:15 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 28 May 2023 22:14:15 +0200
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
Message-ID: <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>

Hi Sean,
>
> Using the CMake files as a source of truth helps. But they don't 
> describe everything. For example, they don't explain that GDAL needs 
> libhdf5 to be built with special features. That one stumped me for a 
> while. I was seeing a build message like "HDF5 not detected (found 
> version 1.12.1)". I finally found the clue in the vcpkg repo.

==> https://gdal.org/development/building_from_source.html#hdf5: "The 
HDF5 CXX library is needed for the KEA 
<https://gdal.org/drivers/raster/kea.html#raster-kea> driver."

That said, it isn't obvious to realize that detection of HDF5 fails 
because of that. That's a bit of a downside with CMake FindXXXX modules 
whose output isn't always very helpful.

Actually, I've changed the logic in 
https://github.com/OSGeo/gdal/pull/7851 to only check for HDF5 CXX if we 
have found libkea before. That reduces the requirements to what is 
really needed.

>
> Also, the CMake files don't explain that the GDAL MBTiles driver 
> depends on the OGR MVT driver.

Also fixed per https://github.com/OSGeo/gdal/pull/7851.? It is easy to 
miss capturing such dependencies to a driver that is built-in by default

Even

>
>
> On Mon, May 22, 2023 at 8:53?AM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Hi Sean,
>
>     I presume you got this because you defined
>     OGR_BUILD_OPTIONAL_DRIVERS=OFF which then cause
>     OGR_ENABLE_DRIVER_AVC to be set to OFF.
>
>     We already a quite overwhelming amount of documentation in
>     https://gdal.org/development/building_from_source.html about all
>     the existing variables, and I'm not sure adding an exhaustive list
>     of all the inter driver dependencies will be user-digestable and
>     could rot easily.
>
>     That said in https://github.com/OSGeo/gdal/pull/7806 I've tried to
>     improve the current error message with a hint for the reason for
>     the error and the (likely) reason for it to happen.
>
>     I've also added pointers in the doc page to the CMakeLists.txt
>     files where the dependencies are expressed. Hopefully people who
>     are in the business of making custom GDAL builds can make sense of
>     that.
>
>     Even
>
>     Le 20/05/2023 ? 01:26, Sean Gillies a ?crit?:
>>     Hi all,
>>
>>     I really appreciate the documentation at
>>     https://gdal.org/development/building_from_source.html. But there
>>     are gaps. For example, today I ran into
>>
>>     CMake Error at cmake/helpers/GdalDriverHelper.cmake:331 (message):
>>     GDAL_ENABLE_DRIVER_AIGRID cannot be enabled because condition
>>     OGR_ENABLE_DRIVER_AVC is not met. To ignore this error (but the
>>     driver
>>     will not be built), set the GDAL_IGNORE_FAILED_CONDITIONS variable
>>
>>     This dependence isn't documented. It's a bit frustrating to work
>>     through missing directives one at a time when adding new drivers
>>     to my build.
>>
>>     Is it possible for a driver's dependencies to be enabled when I
>>     enable a driver?
>>
>>     If not, can we consider using GDAL maintenance funding and
>>     resources on documenting the heck out of this system?
>
>
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/6fd2cd68/attachment-0001.htm>

From sean.gillies at gmail.com  Sun May 28 15:20:32 2023
From: sean.gillies at gmail.com (Sean Gillies)
Date: Sun, 28 May 2023 16:20:32 -0600
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
Message-ID: <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>

On Sun, May 28, 2023 at 2:14?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi Sean,
>
>
> Using the CMake files as a source of truth helps. But they don't describe
> everything. For example, they don't explain that GDAL needs libhdf5 to be
> built with special features. That one stumped me for a while. I was seeing
> a build message like "HDF5 not detected (found version 1.12.1)". I finally
> found the clue in the vcpkg repo.
>
> ==> https://gdal.org/development/building_from_source.html#hdf5: "The
> HDF5 CXX library is needed for the KEA
> <https://gdal.org/drivers/raster/kea.html#raster-kea> driver."
>
> That said, it isn't obvious to realize that detection of HDF5 fails
> because of that. That's a bit of a downside with CMake FindXXXX modules
> whose output isn't always very helpful.
>
> Actually, I've changed the logic in
> https://github.com/OSGeo/gdal/pull/7851 to only check for HDF5 CXX if we
> have found libkea before. That reduces the requirements to what is really
> needed.
>
Thank you!

>
> Also, the CMake files don't explain that the GDAL MBTiles driver depends
> on the OGR MVT driver.
>
> Also fixed per https://github.com/OSGeo/gdal/pull/7851.  It is easy to
> miss capturing such dependencies to a driver that is built-in by default
>
> Even
>
Is MVT really a default driver? In
https://github.com/OSGeo/gdal/blob/master/ogr/ogrsf_frmts/CMakeLists.txt#L80
it looks like it has library and driver dependencies. And anyway, its
dependencies were met in my build script. It should have been discovered if
it was a default driver?

Testing build systems is tough. I know GDAL can't test that all optional
drivers can be configured and built in isolation. At the same time,
profiles of drivers between the bare minimum and
everything-but-the-kitchen-sink are useful to some communities of users,
like the projects that would like to "pip install rasterio" in their own
builds. I resented being told on this list (not by you, Even) that I could
take it or leave it with regards to the current build situation. For my
part, I can do a better job of trying rasterio wheel builds against the
upcoming versions of GDAL, and I will do so.


>
>
> On Mon, May 22, 2023 at 8:53?AM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Hi Sean,
>>
>> I presume you got this because you defined OGR_BUILD_OPTIONAL_DRIVERS=OFF
>> which then cause OGR_ENABLE_DRIVER_AVC to be set to OFF.
>>
>> We already a quite overwhelming amount of documentation in
>> https://gdal.org/development/building_from_source.html about all the
>> existing variables, and I'm not sure adding an exhaustive list of all the
>> inter driver dependencies will be user-digestable and could rot easily.
>>
>> That said in https://github.com/OSGeo/gdal/pull/7806 I've tried to
>> improve the current error message with a hint for the reason for the error
>> and the (likely) reason for it to happen.
>>
>> I've also added pointers in the doc page to the CMakeLists.txt files
>> where the dependencies are expressed. Hopefully people who are in the
>> business of making custom GDAL builds can make sense of that.
>>
>> Even
>> Le 20/05/2023 ? 01:26, Sean Gillies a ?crit :
>>
>> Hi all,
>>
>> I really appreciate the documentation at
>> https://gdal.org/development/building_from_source.html. But there are
>> gaps. For example, today I ran into
>>
>> CMake Error at cmake/helpers/GdalDriverHelper.cmake:331 (message):
>> GDAL_ENABLE_DRIVER_AIGRID cannot be enabled because condition
>> OGR_ENABLE_DRIVER_AVC is not met. To ignore this error (but the driver
>> will not be built), set the GDAL_IGNORE_FAILED_CONDITIONS variable
>>
>> This dependence isn't documented. It's a bit frustrating to work through
>> missing directives one at a time when adding new drivers to my build.
>>
>> Is it possible for a driver's dependencies to be enabled when I enable a
>> driver?
>>
>> If not, can we consider using GDAL maintenance funding and resources on
>> documenting the heck out of this system?
>>
>>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230528/aa079639/attachment.htm>

From even.rouault at spatialys.com  Sun May 28 15:50:07 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 May 2023 00:50:07 +0200
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
Message-ID: <8e912f1f-1404-50a5-da8c-5fd82bed2e5c@spatialys.com>


> Is MVT really a default driver?

You're right. It isn't. Sorry for the confusion


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230529/a6346801/attachment.htm>

From bradh at frogmouth.net  Sun May 28 16:17:58 2023
From: bradh at frogmouth.net (Brad Hards)
Date: Mon, 29 May 2023 09:17:58 +1000
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
Message-ID: <5943234.lOV4Wx5bFT@audax>

On Monday, 29 May 2023 8:20:32 AM AEST Sean Gillies wrote:
>  I resented being told on this list (not by you, Even) that I could
> take it or leave it with regards to the current build situation.

I assume this is directed at me (since I don't see anyone else on the thread).
I regret that you took my words with that intent - it wasn't what I said, and 
it wasn't what I meant. I was trying to provide a workaround.

In future, I'll try to remain silent.

Brad





From gdt at lexort.com  Sun May 28 16:43:05 2023
From: gdt at lexort.com (Greg Troxel)
Date: Sun, 28 May 2023 19:43:05 -0400
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <5943234.lOV4Wx5bFT@audax> (Brad Hards's message of "Mon, 29 May
 2023 09:17:58 +1000")
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
 <5943234.lOV4Wx5bFT@audax>
Message-ID: <rmibki4c99y.fsf@s1.lexort.com>

Brad Hards <bradh at frogmouth.net> writes:

> On Monday, 29 May 2023 8:20:32 AM AEST Sean Gillies wrote:
>>  I resented being told on this list (not by you, Even) that I could
>> take it or leave it with regards to the current build situation.
>
> I assume this is directed at me (since I don't see anyone else on the thread).
> I regret that you took my words with that intent - it wasn't what I said, and 
> it wasn't what I meant. I was trying to provide a workaround.

As someone who mostly listens on this list, I found your message
entirely reasonable and actally helpful in leading to understanding, and
thus I see it as a positive contribution.

From howard at hobu.co  Mon May 29 14:08:25 2023
From: howard at hobu.co (Howard Butler)
Date: Mon, 29 May 2023 16:08:25 -0500
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
Message-ID: <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>



> On May 28, 2023, at 5:20 PM, Sean Gillies <sean.gillies at gmail.com> wrote:
> 
> Testing build systems is tough. I know GDAL can't test that all optional drivers can be configured and built in isolation. At the same time, profiles of drivers between the bare minimum and everything-but-the-kitchen-sink are useful to some communities of users, like the projects that would like to "pip install rasterio" in their own builds. I resented being told on this list (not by you, Even) that I could take it or leave it with regards to the current build situation. For my part, I can do a better job of trying rasterio wheel builds against the upcoming versions of GDAL, and I will do so.

Now that the project has made it to CMake, I wonder if there is enthusiasm to break apart GDAL's build system to take advantage of its plugin capability in a default fashion to cut down on the massiveness of our default stuff-you-actually-want build situation. People rightly complain that libgdal.so links too much stuff, and in most cases, people don't need it all.  

What if we were to default to having drivers be free-standing CMake projects that installed versioned plugin shared objects into known locations that could be activated at library load (or use) time? GDAL has this dynamic plugin capability right now, but it is not widely used, and build configuration is not so convenient for its usage. Plugins would allow each of these drivers to link to their esoteric dependencies without polluting the common library, and the situation we have now, where multiple drivers have similar sets of dependencies, could be handled in some kind of hierarchical fashion based on common dependencies. 

For deployments like rasterio's wheels, external GDAL plugins could be loaded at runtime by the rasterio libgdal.so, and rasterio wouldn't need to be responsible for building a libgdal.so that provided kitchen sink capabilities. People could show up with their own driver plugins that included dependencies as needed.

GDAL's reputation of being hard to build and deploy is well earned and deserved. IMO, the CMake configuration has increased its build speed, system flexibility, and commonality on supported platforms, but it hasn't addressed a core challenge which is GDAL links to the world one DLL at a time. I don't know if the project wants to prioritize this topic relative to other issues, but we have some tools and resources available to us to improve the situation if so.

Howard


From even.rouault at spatialys.com  Mon May 29 15:16:51 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 May 2023 00:16:51 +0200
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
 <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>
Message-ID: <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com>


> Now that the project has made it to CMake, I wonder if there is enthusiasm to break apart GDAL's build system to take advantage of its plugin capability in a default fashion to cut down on the massiveness of our default stuff-you-actually-want build situation. People rightly complain that libgdal.so links too much stuff, and in most cases, people don't need it all.
>
> What if we were to default to having drivers be free-standing CMake projects that installed versioned plugin shared objects into known locations that could be activated at library load (or use) time? GDAL has this dynamic plugin capability right now, but it is not widely used, and build configuration is not so convenient for its usage. Plugins would allow each of these drivers to link to their esoteric dependencies without polluting the common library, and the situation we have now, where multiple drivers have similar sets of dependencies, could be handled in some kind of hierarchical fashion based on common dependencies.
>
> For deployments like rasterio's wheels, external GDAL plugins could be loaded at runtime by the rasterio libgdal.so, and rasterio wouldn't need to be responsible for building a libgdal.so that provided kitchen sink capabilities. People could show up with their own driver plugins that included dependencies as needed.
>
> GDAL's reputation of being hard to build and deploy is well earned and deserved. IMO, the CMake configuration has increased its build speed, system flexibility, and commonality on supported platforms, but it hasn't addressed a core challenge which is GDAL links to the world one DLL at a time. I don't know if the project wants to prioritize this topic relative to other issues, but we have some tools and resources available to us to improve the situation if so.

Some thoughts/questions regarding this:

- you definitely don't want to build all drivers (that can be built as 
plugins) as plugins. This works (this is actually my dev setup, to 
ensure that the core exports all the symbols needed for drivers built as 
plugins), but I've found there's a measurable penalty in doing so (300 
ms to load the 127 plugins on my system, ie each GDAL command line 
invokation will at least take 300 ms, which might be a significant 
penalty in some workflows) . So GDAL_ENABLE_PLUGINS_NO_DEPS=YES (cf 
https://gdal.org/development/building_from_source.html#cmdoption-arg-GDAL_ENABLE_PLUGINS_NO_DEPS-BOOL) 
is typically discouraged.? But 10 or so plugins should be fine.

- you can "emulate" building a single driver as plugin, by re-running a 
GDAL build with just the dependencies of that driver, and setting 
-DGDAL_ENABLE_DRIVER_xxxx_PLUGIN=ON. The only build artifact of interest 
in that use case is the [gdal|ogr]_XXX.so/dll corresponding to that 
driver. The main inconvenience I can see with this current approach is 
that you have to pay the price for the core lib to be rebuilt, whereas 
with the free-standing CMake project, you'd point to the installed GDAL 
headers & lib

- by free-standing CMake project, what do you mean ? Couldn't that just 
the existing frmts/XXXX/CMakeLists.txt file that would detect it is 
called as the top level CMakeLists.txt (probably by checking 
${CMAKE_CURRENT_SOURCE_DIR} == ${PROJECT_SOURCE_DIR}) and then change 
its logic to find libgdal and its dependencies ? And users would "cmake 
-S frmts/XXXX -B plugin_XXXX" to configure just for that plugin.

- I don't understand the "where multiple drivers have similar sets of 
dependencies, could be handled in some kind of hierarchical fashion 
based on common dependencies". why is a special case needed if several 
drivers share the same dependencies ? Or maybe you were thinking to 
drivers depending on other drivers ? That situation can indeed happen 
currently, but when it happens, such drivers aren't allowed to be built 
as plugins. They have to be built with libgdal. Both because it makes 
the build system simpler, and also to avoid deployment complication 
where you'd have to know that gdal_XXXX.so links against gdal_YYYY.so.

- we would need to keep the current monolithic CMake project approach 
working, at the very least for people doing static builds, but even for 
people doing dynamic builds as it might be still be more practical if 
you can install all the dependencies at once. Having the standalone 
capability in addition would be an extra complexity, so we need to be 
sure it addresses real use cases, and perhaps restrict it to a few 
select drivers. Obvious candidates for standalone CMake projects would 
likely be for the few drivers that have proprietary dependencies (ECW, 
JP2KAK, MrSID, Oracle, ...) and aren't shipped by FOSS binary distributions.

- offering the possibility of building just a driver as a plugin in a 
unit way would require people to build against the same GDAL headers as 
libgdal. So people would have to download the same version of the GDAL 
sources as the one used by the libgdal provided by rasterio + having the 
required SDK + installing the libs of the SDK in a path where 
Python/rasterio can find them. Is it in the expected cultural background 
of rasterio users to do that on their own ?

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230530/c60ca5c9/attachment.htm>

From jgr at osgeopt.pt  Mon May 29 15:23:24 2023
From: jgr at osgeopt.pt (Jorge Gustavo Rocha)
Date: Mon, 29 May 2023 23:23:24 +0100
Subject: [gdal-dev] WFS requests failing with /vsicurl/ against QGIS Server:
 missing Content-Length header
Message-ID: <359b0c02-e744-37b8-ee8c-309f0bf8533a@osgeopt.pt>

Hi,

I'm getting errors with WFS calls to QGIS Server using /vsicurl/. 
Against Geoserver I didn't notice this issue.

I can work on a solution, if the problem is on the QGIS Server side. I 
would love to have a second opinion on this.

What I have found:

1) The is no Content-Length: header in QGIS Server answer:

curl -L -I 
"https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016"
HTTP/1.1 200 OK
Date: Mon, 29 May 2023 22:12:32 GMT
Server: Apache/2.4.41 (Ubuntu)
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: POST, GET, OPTIONS, DELETE, PUT
Access-Control-Max-Age: 1000
Access-Control-Allow-Headers: x-requested-with, Content-Type, origin, 
authorization, accept, client-security-token
Content-Type: text/xml; subtype=gml/2.1.2; charset=utf-8

2) The is a Content-Length: header in Geoserver answer:

curl -L -I 
"https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015"
HTTP/1.1 200 OK
X-Frame-Options: SAMEORIGIN
Content-Type: application/gml+xml; version=3.2
Content-Disposition: inline; filename=features.xml
Content-Length: 494599
Server: Jetty(9.4.18.v20190429)

Example of testing calls:

This works (without vsicurl):
ogrinfo 
"https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016"
INFO: Open of 
`https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'
       using driver `GML' successful.
1: ponto_cotado

This does not work:
ogrinfo 
"/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016" 
--debug on
HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 
libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib 
nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.14
VSICURL: HEAD did not provide file size. Retrying with GET
VSICURL: 
GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016): 
response_code=200, curl error msg=Failure writing output to destination
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
VSICURL: 
GetFileList(/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin)
VSICURL: HEAD did not provide file size. Retrying with GET
VSICURL: 
GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5011): 
response_code=200, curl error msg=Failure writing output to destination
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
ogrinfo failed - unable to open 
'/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'.
DGNv8: Driver cleanup

Using docker, I can not use /vsicurl/ with WFS too:
docker run -ti --rm osgeo/gdal ogrinfo 
"/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016" 
--debug on
HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 
libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib 
nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.13
VSICURL: HEAD did not provide file size. Retrying with GET
VSICURL: 
GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016): 
response_code=200, curl error msg=Failure writing output to destination
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
VSICURL: 
GetFileList(/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin)
VSICURL: HEAD did not provide file size. Retrying with GET
VSICURL: 
GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5011): 
response_code=200, curl error msg=Failure writing output to destination
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
VSICURL: Request at offset 0, after end of file
ogrinfo failed - unable to open 
'/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'.

For a Geoserver layer, vsicurl is working:

ogrinfo 
"https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015"
INFO: Open of 
`https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015'
       using driver `GML' successful.
1: EnvironmentalMonitoringFacility

Can I assume that the problem is the missing Content-Length header in 
QGIS Server WFS answer? Should I file a bug about this in QGIS?

Regards,

Jorge

-- 
OSGeo Portugal
NIF: 509588190
email: geral at osgeopt.pt
https://www.osgeopt.pt/

Pr?ximo evento: SASIG 2017, 20 a 22 de novembro, Porto
Mais informa??es: http://osgeopt.pt/sasig2017/

From even.rouault at spatialys.com  Mon May 29 15:54:26 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 May 2023 00:54:26 +0200
Subject: [gdal-dev] WFS requests failing with /vsicurl/ against QGIS
 Server: missing Content-Length header
In-Reply-To: <359b0c02-e744-37b8-ee8c-309f0bf8533a@osgeopt.pt>
References: <359b0c02-e744-37b8-ee8c-309f0bf8533a@osgeopt.pt>
Message-ID: <421f43d6-c88e-642f-9d07-83e9ebb65d59@spatialys.com>

Jorge,

Which error for which invocation of the WFS driver do you get ? Your 
below tries are already low level attempts.

e.g the below invocation works for me without any error with GDAL master 
(in "ghcr.io/osgeo/gdal:alpine-small-3.7.0" Docker image too)

ogr2ogr tmp.gpkg 
"WFS:https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS"

The WFS driver doesn't use /vsicurl/ but /vsicurl_streaming/ . The 
former requires HTTP GET Range request support, while the later doesn't.

and when using "ogrinfo http://something", you are *not* using /vsicurl 
or /vsicurl_streaming. You are using the hidden HTTP driver that 
downloads locally the file before passing it to a driver.

I don't believe there is an issue with QGIS Server. It probably streams 
its output (didn't check though), so it cannot know in advance the 
Content-Length. The headers of the HEAD requests aren't particularly 
helpful too. Looking at the ones of the GET request, I see 
"Transfer-Encoding: chunked" for QGIS server, which is in line with a 
streamed output and OK

Even

Le 30/05/2023 ? 00:23, Jorge Gustavo Rocha a ?crit?:
> Hi,
>
> I'm getting errors with WFS calls to QGIS Server using /vsicurl/. 
> Against Geoserver I didn't notice this issue.
>
> I can work on a solution, if the problem is on the QGIS Server side. I 
> would love to have a second opinion on this.
>
> What I have found:
>
> 1) The is no Content-Length: header in QGIS Server answer:
>
> curl -L -I 
> "https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016"
> HTTP/1.1 200 OK
> Date: Mon, 29 May 2023 22:12:32 GMT
> Server: Apache/2.4.41 (Ubuntu)
> Access-Control-Allow-Origin: *
> Access-Control-Allow-Methods: POST, GET, OPTIONS, DELETE, PUT
> Access-Control-Max-Age: 1000
> Access-Control-Allow-Headers: x-requested-with, Content-Type, origin, 
> authorization, accept, client-security-token
> Content-Type: text/xml; subtype=gml/2.1.2; charset=utf-8
>
> 2) The is a Content-Length: header in Geoserver answer:
>
> curl -L -I 
> "https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015"
> HTTP/1.1 200 OK
> X-Frame-Options: SAMEORIGIN
> Content-Type: application/gml+xml; version=3.2
> Content-Disposition: inline; filename=features.xml
> Content-Length: 494599
> Server: Jetty(9.4.18.v20190429)
>
> Example of testing calls:
>
> This works (without vsicurl):
> ogrinfo 
> "https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016"
> INFO: Open of 
> `https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'
> ????? using driver `GML' successful.
> 1: ponto_cotado
>
> This does not work:
> ogrinfo 
> "/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016" 
> --debug on
> HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 
> libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib 
> nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.14
> VSICURL: HEAD did not provide file size. Retrying with GET
> VSICURL: 
> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016): 
> response_code=200, curl error msg=Failure writing output to destination
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> VSICURL: 
> GetFileList(/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin)
> VSICURL: HEAD did not provide file size. Retrying with GET
> VSICURL: 
> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5011): 
> response_code=200, curl error msg=Failure writing output to destination
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> ogrinfo failed - unable to open 
> '/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'.
> DGNv8: Driver cleanup
>
> Using docker, I can not use /vsicurl/ with WFS too:
> docker run -ti --rm osgeo/gdal ogrinfo 
> "/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016" 
> --debug on
> HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 
> libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib 
> nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.13
> VSICURL: HEAD did not provide file size. Retrying with GET
> VSICURL: 
> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016): 
> response_code=200, curl error msg=Failure writing output to destination
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> VSICURL: 
> GetFileList(/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin)
> VSICURL: HEAD did not provide file size. Retrying with GET
> VSICURL: 
> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5011): 
> response_code=200, curl error msg=Failure writing output to destination
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> VSICURL: Request at offset 0, after end of file
> ogrinfo failed - unable to open 
> '/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'.
>
> For a Geoserver layer, vsicurl is working:
>
> ogrinfo 
> "https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015"
> INFO: Open of 
> `https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015'
> ????? using driver `GML' successful.
> 1: EnvironmentalMonitoringFacility
>
> Can I assume that the problem is the missing Content-Length header in 
> QGIS Server WFS answer? Should I file a bug about this in QGIS?
>
> Regards,
>
> Jorge
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jgr at osgeopt.pt  Mon May 29 16:14:08 2023
From: jgr at osgeopt.pt (Jorge Gustavo Rocha)
Date: Tue, 30 May 2023 00:14:08 +0100
Subject: [gdal-dev] WFS requests failing with /vsicurl/ against QGIS
 Server: missing Content-Length header
In-Reply-To: <421f43d6-c88e-642f-9d07-83e9ebb65d59@spatialys.com>
References: <359b0c02-e744-37b8-ee8c-309f0bf8533a@osgeopt.pt>
 <421f43d6-c88e-642f-9d07-83e9ebb65d59@spatialys.com>
Message-ID: <3a691b13-fbcd-e271-effa-68c6db39791c@osgeopt.pt>

Hi Evan,

Thank you for the prompted answer.

I'm discussing this because I testing ogr2ogr node module and it adds 
(always) the /vsicurl/ prefix for any resource starting with http [1].
The point is /vsicurl/ can only be used with some http resources.

My question was (but you already answered it) if every WFS request 
should be callable with /vsicurl/.

Geoserver supports both /vsicurl/ and /vsicurl_streaming/ which seems 
more flexible. That's why I thought that QGIS Server should add 
Content-Length headers too.

If you consider that this is not a limitation of QGIS Server, let's keep 
as it is. I'll use /vsicurl_streaming/ for both Geoserver and QGIS 
Server calls.

Thanks for the feedback on this.

Best regards,

Jorge

[1] 
https://github.com/wavded/ogr2ogr/blob/729f321dd96414e256aa67be1bc76f0b0a9b21dc/index.ts#L105


On 29/05/23 23:54, Even Rouault wrote:
> Jorge,
> 
> Which error for which invocation of the WFS driver do you get ? Your 
> below tries are already low level attempts.
> 
> e.g the below invocation works for me without any error with GDAL master 
> (in "ghcr.io/osgeo/gdal:alpine-small-3.7.0" Docker image too)
> 
> ogr2ogr tmp.gpkg 
> "WFS:https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS"
> 
> The WFS driver doesn't use /vsicurl/ but /vsicurl_streaming/ . The 
> former requires HTTP GET Range request support, while the later doesn't.
> 
> and when using "ogrinfo http://something", you are *not* using /vsicurl 
> or /vsicurl_streaming. You are using the hidden HTTP driver that 
> downloads locally the file before passing it to a driver.
> 
> I don't believe there is an issue with QGIS Server. It probably streams 
> its output (didn't check though), so it cannot know in advance the 
> Content-Length. The headers of the HEAD requests aren't particularly 
> helpful too. Looking at the ones of the GET request, I see 
> "Transfer-Encoding: chunked" for QGIS server, which is in line with a 
> streamed output and OK
> 
> Even
> 
> Le 30/05/2023 ? 00:23, Jorge Gustavo Rocha a ?crit?:
>> Hi,
>>
>> I'm getting errors with WFS calls to QGIS Server using /vsicurl/. 
>> Against Geoserver I didn't notice this issue.
>>
>> I can work on a solution, if the problem is on the QGIS Server side. I 
>> would love to have a second opinion on this.
>>
>> What I have found:
>>
>> 1) The is no Content-Length: header in QGIS Server answer:
>>
>> curl -L -I 
>> "https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016"
>> HTTP/1.1 200 OK
>> Date: Mon, 29 May 2023 22:12:32 GMT
>> Server: Apache/2.4.41 (Ubuntu)
>> Access-Control-Allow-Origin: *
>> Access-Control-Allow-Methods: POST, GET, OPTIONS, DELETE, PUT
>> Access-Control-Max-Age: 1000
>> Access-Control-Allow-Headers: x-requested-with, Content-Type, origin, 
>> authorization, accept, client-security-token
>> Content-Type: text/xml; subtype=gml/2.1.2; charset=utf-8
>>
>> 2) The is a Content-Length: header in Geoserver answer:
>>
>> curl -L -I 
>> "https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015"
>> HTTP/1.1 200 OK
>> X-Frame-Options: SAMEORIGIN
>> Content-Type: application/gml+xml; version=3.2
>> Content-Disposition: inline; filename=features.xml
>> Content-Length: 494599
>> Server: Jetty(9.4.18.v20190429)
>>
>> Example of testing calls:
>>
>> This works (without vsicurl):
>> ogrinfo 
>> "https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016"
>> INFO: Open of 
>> `https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'
>> ????? using driver `GML' successful.
>> 1: ponto_cotado
>>
>> This does not work:
>> ogrinfo 
>> "/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016" --debug on
>> HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 
>> libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib 
>> nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.14
>> VSICURL: HEAD did not provide file size. Retrying with GET
>> VSICURL: 
>> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016): response_code=200, curl error msg=Failure writing output to destination
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: 
>> GetFileList(/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin)
>> VSICURL: HEAD did not provide file size. Retrying with GET
>> VSICURL: 
>> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5011): response_code=200, curl error msg=Failure writing output to destination
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> ogrinfo failed - unable to open 
>> '/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'.
>> DGNv8: Driver cleanup
>>
>> Using docker, I can not use /vsicurl/ with WFS too:
>> docker run -ti --rm osgeo/gdal ogrinfo 
>> "/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016" --debug on
>> HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 
>> libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib 
>> nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.13
>> VSICURL: HEAD did not provide file size. Retrying with GET
>> VSICURL: 
>> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016): response_code=200, curl error msg=Failure writing output to destination
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: 
>> GetFileList(/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin)
>> VSICURL: HEAD did not provide file size. Retrying with GET
>> VSICURL: 
>> GetFileSize(https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5011): response_code=200, curl error msg=Failure writing output to destination
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> VSICURL: Request at offset 0, after end of file
>> ogrinfo failed - unable to open 
>> '/vsicurl/https://irig-madeira.pt/postgresql/drote/public/baram_2020/cgi-bin/qgis_mapserv.fcgi?service=WFS&version=2.0.0&request=GetFeature&typename=ponto_cotado&srsname=EPSG:5016'.
>>
>> For a Geoserver layer, vsicurl is working:
>>
>> ogrinfo 
>> "https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015"
>> INFO: Open of 
>> `https://wssig3.azores.gov.pt/geoserver/ows?service=WFS&request=GetFeature&typename=ef:EnvironmentalMonitoringFacility&version=2.0.0&srsname=EPSG:5015'
>> ????? using driver `GML' successful.
>> 1: EnvironmentalMonitoringFacility
>>
>> Can I assume that the problem is the missing Content-Length header in 
>> QGIS Server WFS answer? Should I file a bug about this in QGIS?
>>
>> Regards,
>>
>> Jorge
>>

-- 
OSGeo Portugal
NIF: 509588190
email: geral at osgeopt.pt
https://www.osgeopt.pt/

Pr?ximo evento: SASIG 2017, 20 a 22 de novembro, Porto
Mais informa??es: http://osgeopt.pt/sasig2017/

From gdt at lexort.com  Mon May 29 16:21:56 2023
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 29 May 2023 19:21:56 -0400
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com> (Even
 Rouault's message of "Tue, 30 May 2023 00:16:51 +0200")
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
 <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>
 <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com>
Message-ID: <rmifs7e7mgb.fsf@s1.lexort.com>

Even Rouault <even.rouault at spatialys.com> writes:

some thoughts on the thoughts from a packaging viewpoint.

> - you definitely don't want to build all drivers (that can be built as
>   plugins) as plugins. This works (this is actually my dev setup, to
>   ensure that the core exports all the symbols needed for drivers
>   built as plugins), but I've found there's a measurable penalty in
>   doing so (300 ms to load the 127 plugins on my system, ie each GDAL
>   command line invokation will at least take 300 ms, which might be a
>   significant penalty in some workflows) . So
>   GDAL_ENABLE_PLUGINS_NO_DEPS=YES (cf
>   https://gdal.org/development/building_from_source.html#cmdoption-arg-GDAL_ENABLE_PLUGINS_NO_DEPS-BOOL)
>   is typically discouraged.? But 10 or so plugins should be fine.

Would it be reasonable to only load the plugins that will be used?  I
would think most invocations only use a few formats.

> - by free-standing CMake project, what do you mean ? Couldn't that
>   just the existing frmts/XXXX/CMakeLists.txt file that would detect
>   it is called as the top level CMakeLists.txt (probably by checking
>   ${CMAKE_CURRENT_SOURCE_DIR} == ${PROJECT_SOURCE_DIR}) and then
>   change its logic to find libgdal and its dependencies ? And users
>   would "cmake -S frmts/XXXX -B plugin_XXXX" to configure just for
>  that plugin.

>From the packaging point of view, I want one package which is core, and
another package for each plugin that has dependencies that I think
someone would reasonably want to avoid.  I would like to maintain a
Makefile.common with version and some of this, if these are released as
part of a gdal release and just built separately.  If the plugin is
truly separate (separate release schedule), then it is cleanly its own
package.

It is not ok to say "build everything and then pick out files for
different packages".  That sort of works in some systems, and not
others, and it only works in systems where the assumption is some giant
system builds once for everybody and users never compile anything.  The
point is to avoid having to install and build from source the difficult
dependencies.

> - we would need to keep the current monolithic CMake project approach
>   working, at the very least for people doing static builds, but even
>   for people doing dynamic builds as it might be still be more
>   practical if you can install all the dependencies at once. Having
>   the standalone capability in addition would be an extra complexity,
>   so we need to be sure it addresses real use cases, and perhaps
>   restrict it to a few select drivers. Obvious candidates for
>   standalone CMake projects would likely be for the few drivers that
>   have proprietary dependencies (ECW, JP2KAK, MrSID, Oracle, ...) and
>  aren't shipped by FOSS binary distributions.

(I don't follow 'and'; surely no FOSS binary distribution could have any
of these??)

I don't see why one couldn't still build plugins and just have one build
build them all.

It's not just proprietary things (which definitely need to be
separable), but big things.  One might want to avoid the pgsql driver,
for example, in the core gdal package that might just do geopackage and
geojson.  But maybe GIS and small just don't go together (and I say that
more or less seriously).

> - offering the possibility of building just a driver as a plugin in a
>   unit way would require people to build against the same GDAL headers
>   as libgdal. So people would have to download the same version of the
>   GDAL sources as the one used by the libgdal provided by rasterio +
>   having the required SDK + installing the libs of the SDK in a path
>   where Python/rasterio can find them. Is it in the expected cultural
>   background of rasterio users to do that on their own ?

Absolutely they have to and that's fine.  The headers should be
installed with the library and they should be used when plugins are
built.  There is no other sane path.  So that either means "just include
the headers in the gdal lib package" or "have gdal-core and
gdal-core-devel (or whatever FooOS calls it) packages that have the libs
and the headers respectively".  This is really no different from any
package that depends on any lib.

  

From jukka.rahkonen at maanmittauslaitos.fi  Mon May 29 23:09:36 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 30 May 2023 06:09:36 +0000
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <rmifs7e7mgb.fsf@s1.lexort.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
 <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>
 <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com>
 <rmifs7e7mgb.fsf@s1.lexort.com>
Message-ID: <AM0PR09MB32190E4C39A9457D77648189FD4B9@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

>> Obvious candidates for
>>  standalone CMake projects would likely be for the few drivers that
>>   have proprietary dependencies (ECW, JP2KAK, MrSID, Oracle, ...) and  
>> aren't shipped by FOSS binary distributions.

> (I don't follow 'and'; surely no FOSS binary distribution could have any of these??)

Maybe you can read: "...and _therefore_ aren't shipped by FOSS binary distributions"

I know nothing about building but the build system at gisinternals builds a selected set of drivers (about 20) as plugins https://github.com/gisinternals/buildsystem/blob/main/Makefile#L727.

-Jukka Rahkonen-




From ahmettemiz88 at gmail.com  Tue May 30 05:12:15 2023
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Tue, 30 May 2023 15:12:15 +0300
Subject: [gdal-dev] wrong with clipping a tif file with a polygon
Message-ID: <CAJKO1Yv4ZjqeZmXfjF8bDdbJUmncrFOpyzpwbUvt8jFqTVC-aw@mail.gmail.com>

Hi,
I am trying to clip a tif file with a polygon. But resulting output.tif
file shows nothing.

Where am I doing wrong ?

"  #include <gdal/gdal.h>
#include <gdal/gdal_priv.h>
#include <gdal/gdalwarper.h>
#include <gdal/ogrsf_frmts.h>
#include <gdal/gdalwarper.h>
#include <string> // for string class
using namespace std;

int main() {
  const char *inputPath = "input.tif";
  const char *outputPath = "output.tif";

  // clipper Polygon
  // THIS FILE MUST BE IN PIXEL/LINE COORDINATES or otherwise one should
  // copy the function gdalwarp_lib.cpp:TransformCutlineToSource()
  // from GDAL's sources
  // It is expected that it contains a single polygon feature
  const char *read_filenamePoly = "input.geojson";

  GDALDataset *hSrcDS;
  GDALDataset *hDstDS;

  GDALAllRegister();
  auto poDriver = GetGDALDriverManager()->GetDriverByName("GTiff");
  hSrcDS = (GDALDataset *)GDALOpen(inputPath, GA_ReadOnly);

  hDstDS = (GDALDataset *)poDriver->CreateCopy(
  outputPath, hSrcDS, 0, nullptr, nullptr, nullptr);
  // Without this step the cutline is useless - because the background
  // will be carried over from the original image
  hDstDS->GetRasterBand(1)->Fill(0);

  hDstDS->SetProjection(hSrcDS->GetProjectionRef());

  const char *src_srs = hSrcDS->GetProjectionRef();
  const char *dst_srs = hDstDS->GetProjectionRef();
  printf("%s ",src_srs);
  // clipper Layer
  GDALDataset *poDSClipper;
  poDSClipper = (GDALDataset *)GDALOpenEx(
    read_filenamePoly, GDAL_OF_UPDATE, NULL, NULL, NULL);

  auto poLayerClipper = poDSClipper->GetLayer(0);
  auto geom = poLayerClipper->GetNextFeature()->GetGeometryRef();
  //char* wkt = nullptr;
  if (geom != nullptr && geom->IsValid())
  {
      printf("\n geom is valid \n");
  }
  // setup warp options
  GDALWarpOptions *psWarpOptions = GDALCreateWarpOptions();
  psWarpOptions->hSrcDS = hSrcDS;
  psWarpOptions->hDstDS = hDstDS;
  psWarpOptions->nBandCount = 1;
  psWarpOptions->panSrcBands =
    (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
  psWarpOptions->panSrcBands[0] = 1;
  psWarpOptions->panDstBands =
    (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
  psWarpOptions->panDstBands[0] = 1;
  psWarpOptions->pfnProgress = GDALTermProgress;
  psWarpOptions->hCutline = geom;

  // Establish reprojection transformer.
  psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer(
    hSrcDS, src_srs, hDstDS, dst_srs, TRUE, 1000, 1);
  psWarpOptions->pfnTransformer = GDALGenImgProjTransform;
  GDALWarpOperation oOperation;
  oOperation.Initialize(psWarpOptions);
  oOperation.ChunkAndWarpImage(
    0, 0, GDALGetRasterXSize(hDstDS), GDALGetRasterYSize(hDstDS));
  GDALDestroyGenImgProjTransformer(psWarpOptions->pTransformerArg);
  GDALDestroyWarpOptions(psWarpOptions);
  GDALClose(hDstDS);
  GDALClose(hSrcDS);
}
"

-- 
Ahmet Temiz
Jeoloji M?h.
Afet ve Acil Durum Y?netimi Ba?kanl???
Deprem  Dairesi Ba?kanl???


________________________

Ahmet Temiz
Geological Eng.

Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230530/6d88e7e7/attachment-0001.htm>

From nhv at meganet.net  Tue May 30 05:24:27 2023
From: nhv at meganet.net (Norman Vine)
Date: Tue, 30 May 2023 08:24:27 -0400
Subject: [gdal-dev] wrong with clipping a tif file with a polygon
In-Reply-To: <CAJKO1Yv4ZjqeZmXfjF8bDdbJUmncrFOpyzpwbUvt8jFqTVC-aw@mail.gmail.com>
References: <CAJKO1Yv4ZjqeZmXfjF8bDdbJUmncrFOpyzpwbUvt8jFqTVC-aw@mail.gmail.com>
Message-ID: <36C3D380-FB64-441E-B876-FB4B0B32EC7A@meganet.net>

perhaps this will help
https://stackoverflow.com/questions/70664043/clip-raster-with-polygon-with-gdal-c

> On May 30, 2023, at 8:12 AM, Ahmet Temiz <ahmettemiz88 at gmail.com> wrote:
> 
> Hi,
> I am trying to clip a tif file with a polygon. But resulting output.tif file shows nothing.
> 
> Where am I doing wrong ?
> 
> "  #include <gdal/gdal.h>
> #include <gdal/gdal_priv.h>
> #include <gdal/gdalwarper.h>
> #include <gdal/ogrsf_frmts.h>
> #include <gdal/gdalwarper.h>
> #include <string> // for string class
> using namespace std;
> 
> int main() {
>   const char *inputPath = "input.tif";
>   const char *outputPath = "output.tif";
> 
>   // clipper Polygon
>   // THIS FILE MUST BE IN PIXEL/LINE COORDINATES or otherwise one should
>   // copy the function gdalwarp_lib.cpp:TransformCutlineToSource()
>   // from GDAL's sources
>   // It is expected that it contains a single polygon feature
>   const char *read_filenamePoly = "input.geojson";
> 
>   GDALDataset *hSrcDS;
>   GDALDataset *hDstDS;
> 
>   GDALAllRegister();
>   auto poDriver = GetGDALDriverManager()->GetDriverByName("GTiff");
>   hSrcDS = (GDALDataset *)GDALOpen(inputPath, GA_ReadOnly);
> 
>   hDstDS = (GDALDataset *)poDriver->CreateCopy(
>   outputPath, hSrcDS, 0, nullptr, nullptr, nullptr);
>   // Without this step the cutline is useless - because the background
>   // will be carried over from the original image
>   hDstDS->GetRasterBand(1)->Fill(0);
> 
>   hDstDS->SetProjection(hSrcDS->GetProjectionRef());
> 
>   const char *src_srs = hSrcDS->GetProjectionRef();
>   const char *dst_srs = hDstDS->GetProjectionRef();
>   printf("%s ",src_srs);
>   // clipper Layer
>   GDALDataset *poDSClipper;
>   poDSClipper = (GDALDataset *)GDALOpenEx(
>     read_filenamePoly, GDAL_OF_UPDATE, NULL, NULL, NULL);
> 
>   auto poLayerClipper = poDSClipper->GetLayer(0);
>   auto geom = poLayerClipper->GetNextFeature()->GetGeometryRef();
>   //char* wkt = nullptr;
>   if (geom != nullptr && geom->IsValid())
>   { 
>       printf("\n geom is valid \n");
>   }
>   // setup warp options
>   GDALWarpOptions *psWarpOptions = GDALCreateWarpOptions();
>   psWarpOptions->hSrcDS = hSrcDS;
>   psWarpOptions->hDstDS = hDstDS;
>   psWarpOptions->nBandCount = 1;
>   psWarpOptions->panSrcBands =
>     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
>   psWarpOptions->panSrcBands[0] = 1;
>   psWarpOptions->panDstBands =
>     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
>   psWarpOptions->panDstBands[0] = 1;
>   psWarpOptions->pfnProgress = GDALTermProgress;
>   psWarpOptions->hCutline = geom;
> 
>   // Establish reprojection transformer.
>   psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer(
>     hSrcDS, src_srs, hDstDS, dst_srs, TRUE, 1000, 1);
>   psWarpOptions->pfnTransformer = GDALGenImgProjTransform;
>   GDALWarpOperation oOperation;
>   oOperation.Initialize(psWarpOptions);
>   oOperation.ChunkAndWarpImage(
>     0, 0, GDALGetRasterXSize(hDstDS), GDALGetRasterYSize(hDstDS));
>   GDALDestroyGenImgProjTransformer(psWarpOptions->pTransformerArg);
>   GDALDestroyWarpOptions(psWarpOptions);
>   GDALClose(hDstDS);
>   GDALClose(hSrcDS);
> }
> "
> 
> -- 
> Ahmet Temiz
> Jeoloji M?h.
> Afet ve Acil Durum Y?netimi Ba?kanl???
> Deprem  Dairesi Ba?kanl???
> 
> 
> ________________________
> 
> Ahmet Temiz
> Geological Eng.
> 
> Disaster and Emergency Management
> of Presidency
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



From ahmettemiz88 at gmail.com  Tue May 30 05:56:32 2023
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Tue, 30 May 2023 15:56:32 +0300
Subject: [gdal-dev] wrong with clipping a tif file with a polygon
In-Reply-To: <36C3D380-FB64-441E-B876-FB4B0B32EC7A@meganet.net>
References: <CAJKO1Yv4ZjqeZmXfjF8bDdbJUmncrFOpyzpwbUvt8jFqTVC-aw@mail.gmail.com>
 <36C3D380-FB64-441E-B876-FB4B0B32EC7A@meganet.net>
Message-ID: <CAJKO1Yv-jD0j3yGQC4bcPNN=ZEw-g1MKDbWV5L9T98580VjiBA@mail.gmail.com>

Thank you ,

I already worked on that code. But clipping was not succesful. output.tif
is blank on qgis.

On Tue, May 30, 2023 at 3:24?PM Norman Vine <nhv at meganet.net> wrote:

> perhaps this will help
>
> https://stackoverflow.com/questions/70664043/clip-raster-with-polygon-with-gdal-c
>
> > On May 30, 2023, at 8:12 AM, Ahmet Temiz <ahmettemiz88 at gmail.com> wrote:
> >
> > Hi,
> > I am trying to clip a tif file with a polygon. But resulting output.tif
> file shows nothing.
> >
> > Where am I doing wrong ?
> >
> > "  #include <gdal/gdal.h>
> > #include <gdal/gdal_priv.h>
> > #include <gdal/gdalwarper.h>
> > #include <gdal/ogrsf_frmts.h>
> > #include <gdal/gdalwarper.h>
> > #include <string> // for string class
> > using namespace std;
> >
> > int main() {
> >   const char *inputPath = "input.tif";
> >   const char *outputPath = "output.tif";
> >
> >   // clipper Polygon
> >   // THIS FILE MUST BE IN PIXEL/LINE COORDINATES or otherwise one should
> >   // copy the function gdalwarp_lib.cpp:TransformCutlineToSource()
> >   // from GDAL's sources
> >   // It is expected that it contains a single polygon feature
> >   const char *read_filenamePoly = "input.geojson";
> >
> >   GDALDataset *hSrcDS;
> >   GDALDataset *hDstDS;
> >
> >   GDALAllRegister();
> >   auto poDriver = GetGDALDriverManager()->GetDriverByName("GTiff");
> >   hSrcDS = (GDALDataset *)GDALOpen(inputPath, GA_ReadOnly);
> >
> >   hDstDS = (GDALDataset *)poDriver->CreateCopy(
> >   outputPath, hSrcDS, 0, nullptr, nullptr, nullptr);
> >   // Without this step the cutline is useless - because the background
> >   // will be carried over from the original image
> >   hDstDS->GetRasterBand(1)->Fill(0);
> >
> >   hDstDS->SetProjection(hSrcDS->GetProjectionRef());
> >
> >   const char *src_srs = hSrcDS->GetProjectionRef();
> >   const char *dst_srs = hDstDS->GetProjectionRef();
> >   printf("%s ",src_srs);
> >   // clipper Layer
> >   GDALDataset *poDSClipper;
> >   poDSClipper = (GDALDataset *)GDALOpenEx(
> >     read_filenamePoly, GDAL_OF_UPDATE, NULL, NULL, NULL);
> >
> >   auto poLayerClipper = poDSClipper->GetLayer(0);
> >   auto geom = poLayerClipper->GetNextFeature()->GetGeometryRef();
> >   //char* wkt = nullptr;
> >   if (geom != nullptr && geom->IsValid())
> >   {
> >       printf("\n geom is valid \n");
> >   }
> >   // setup warp options
> >   GDALWarpOptions *psWarpOptions = GDALCreateWarpOptions();
> >   psWarpOptions->hSrcDS = hSrcDS;
> >   psWarpOptions->hDstDS = hDstDS;
> >   psWarpOptions->nBandCount = 1;
> >   psWarpOptions->panSrcBands =
> >     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
> >   psWarpOptions->panSrcBands[0] = 1;
> >   psWarpOptions->panDstBands =
> >     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
> >   psWarpOptions->panDstBands[0] = 1;
> >   psWarpOptions->pfnProgress = GDALTermProgress;
> >   psWarpOptions->hCutline = geom;
> >
> >   // Establish reprojection transformer.
> >   psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer(
> >     hSrcDS, src_srs, hDstDS, dst_srs, TRUE, 1000, 1);
> >   psWarpOptions->pfnTransformer = GDALGenImgProjTransform;
> >   GDALWarpOperation oOperation;
> >   oOperation.Initialize(psWarpOptions);
> >   oOperation.ChunkAndWarpImage(
> >     0, 0, GDALGetRasterXSize(hDstDS), GDALGetRasterYSize(hDstDS));
> >   GDALDestroyGenImgProjTransformer(psWarpOptions->pTransformerArg);
> >   GDALDestroyWarpOptions(psWarpOptions);
> >   GDALClose(hDstDS);
> >   GDALClose(hSrcDS);
> > }
> > "
> >
> > --
> > Ahmet Temiz
> > Jeoloji M?h.
> > Afet ve Acil Durum Y?netimi Ba?kanl???
> > Deprem  Dairesi Ba?kanl???
> >
> >
> > ________________________
> >
> > Ahmet Temiz
> > Geological Eng.
> >
> > Disaster and Emergency Management
> > of Presidency
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>

-- 
Ahmet Temiz
Jeoloji M?h.
Afet ve Acil Durum Y?netimi Ba?kanl???
Deprem  Dairesi Ba?kanl???


________________________

Ahmet Temiz
Geological Eng.

Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230530/5d1dd3c8/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue May 30 06:20:15 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 30 May 2023 13:20:15 +0000
Subject: [gdal-dev] wrong with clipping a tif file with a polygon
In-Reply-To: <CAJKO1Yv-jD0j3yGQC4bcPNN=ZEw-g1MKDbWV5L9T98580VjiBA@mail.gmail.com>
References: <CAJKO1Yv4ZjqeZmXfjF8bDdbJUmncrFOpyzpwbUvt8jFqTVC-aw@mail.gmail.com>
 <36C3D380-FB64-441E-B876-FB4B0B32EC7A@meganet.net>
 <CAJKO1Yv-jD0j3yGQC4bcPNN=ZEw-g1MKDbWV5L9T98580VjiBA@mail.gmail.com>
Message-ID: <AM0PR09MB321971841A725294FD545105FD4B9@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

I can?t really read the code, but based on what happens, maybe your cutline is outside the image. So you

  *   create an output band
  *   fill it with zeroes
  *   and then you write pixels within the cutline into the output
Because the output stays all zeroes, and there are no errors, then I guess that the pixels within your cutline are all nodata.
Maybe printing the WKT out from ?geom? could prove or disprove my guess.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Ahmet Temiz
L?hetetty: tiistai 30. toukokuuta 2023 15.57
Vastaanottaja: Norman Vine <nhv at meganet.net>
Kopio: gdal-dev <gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] wrong with clipping a tif file with a polygon

Thank you ,

I already worked on that code. But clipping was not succesful. output.tif is blank on qgis.

On Tue, May 30, 2023 at 3:24?PM Norman Vine <nhv at meganet.net<mailto:nhv at meganet.net>> wrote:
perhaps this will help
https://stackoverflow.com/questions/70664043/clip-raster-with-polygon-with-gdal-c

> On May 30, 2023, at 8:12 AM, Ahmet Temiz <ahmettemiz88 at gmail.com<mailto:ahmettemiz88 at gmail.com>> wrote:
>
> Hi,
> I am trying to clip a tif file with a polygon. But resulting output.tif file shows nothing.
>
> Where am I doing wrong ?
>
> "  #include <gdal/gdal.h>
> #include <gdal/gdal_priv.h>
> #include <gdal/gdalwarper.h>
> #include <gdal/ogrsf_frmts.h>
> #include <gdal/gdalwarper.h>
> #include <string> // for string class
> using namespace std;
>
> int main() {
>   const char *inputPath = "input.tif";
>   const char *outputPath = "output.tif";
>
>   // clipper Polygon
>   // THIS FILE MUST BE IN PIXEL/LINE COORDINATES or otherwise one should
>   // copy the function gdalwarp_lib.cpp:TransformCutlineToSource()
>   // from GDAL's sources
>   // It is expected that it contains a single polygon feature
>   const char *read_filenamePoly = "input.geojson";
>
>   GDALDataset *hSrcDS;
>   GDALDataset *hDstDS;
>
>   GDALAllRegister();
>   auto poDriver = GetGDALDriverManager()->GetDriverByName("GTiff");
>   hSrcDS = (GDALDataset *)GDALOpen(inputPath, GA_ReadOnly);
>
>   hDstDS = (GDALDataset *)poDriver->CreateCopy(
>   outputPath, hSrcDS, 0, nullptr, nullptr, nullptr);
>   // Without this step the cutline is useless - because the background
>   // will be carried over from the original image
>   hDstDS->GetRasterBand(1)->Fill(0);
>
>   hDstDS->SetProjection(hSrcDS->GetProjectionRef());
>
>   const char *src_srs = hSrcDS->GetProjectionRef();
>   const char *dst_srs = hDstDS->GetProjectionRef();
>   printf("%s ",src_srs);
>   // clipper Layer
>   GDALDataset *poDSClipper;
>   poDSClipper = (GDALDataset *)GDALOpenEx(
>     read_filenamePoly, GDAL_OF_UPDATE, NULL, NULL, NULL);
>
>   auto poLayerClipper = poDSClipper->GetLayer(0);
>   auto geom = poLayerClipper->GetNextFeature()->GetGeometryRef();
>   //char* wkt = nullptr;
>   if (geom != nullptr && geom->IsValid())
>   {
>       printf("\n geom is valid \n");
>   }
>   // setup warp options
>   GDALWarpOptions *psWarpOptions = GDALCreateWarpOptions();
>   psWarpOptions->hSrcDS = hSrcDS;
>   psWarpOptions->hDstDS = hDstDS;
>   psWarpOptions->nBandCount = 1;
>   psWarpOptions->panSrcBands =
>     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
>   psWarpOptions->panSrcBands[0] = 1;
>   psWarpOptions->panDstBands =
>     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
>   psWarpOptions->panDstBands[0] = 1;
>   psWarpOptions->pfnProgress = GDALTermProgress;
>   psWarpOptions->hCutline = geom;
>
>   // Establish reprojection transformer.
>   psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer(
>     hSrcDS, src_srs, hDstDS, dst_srs, TRUE, 1000, 1);
>   psWarpOptions->pfnTransformer = GDALGenImgProjTransform;
>   GDALWarpOperation oOperation;
>   oOperation.Initialize(psWarpOptions);
>   oOperation.ChunkAndWarpImage(
>     0, 0, GDALGetRasterXSize(hDstDS), GDALGetRasterYSize(hDstDS));
>   GDALDestroyGenImgProjTransformer(psWarpOptions->pTransformerArg);
>   GDALDestroyWarpOptions(psWarpOptions);
>   GDALClose(hDstDS);
>   GDALClose(hSrcDS);
> }
> "
>
> --
> Ahmet Temiz
> Jeoloji M?h.
> Afet ve Acil Durum Y?netimi Ba?kanl???
> Deprem  Dairesi Ba?kanl???
>
>
> ________________________
>
> Ahmet Temiz
> Geological Eng.
>
> Disaster and Emergency Management
> of Presidency
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



--
Ahmet Temiz
Jeoloji M?h.
Afet ve Acil Durum Y?netimi Ba?kanl???
Deprem  Dairesi Ba?kanl???


________________________

Ahmet Temiz
Geological Eng.

Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230530/c5671cf6/attachment-0001.htm>

From howard at hobu.co  Tue May 30 07:57:57 2023
From: howard at hobu.co (Howard Butler)
Date: Tue, 30 May 2023 09:57:57 -0500
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
 <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>
 <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com>
Message-ID: <6A156B7C-8ECE-44E2-B63D-FABA55C9E2FB@hobu.co>



> On May 29, 2023, at 5:16 PM, Even Rouault <even.rouault at spatialys.com> wrote:

> 300 ms to load the 127 plugins on my system, ie each GDAL command line invokation will at least take 300 ms, which might be a significant penalty in some workflows)

PDAL had this penalty and then we did some profiling and saw that most of the cost was the dlopen, not the finding of the plugin via the filesystem. PDAL doesn't have a GDALOpen-like single entry method where drivers are all expected to be loaded and "tried" sequentially, however. We have a map that registers some properties of the "filename" that tells us which driver to actually dlopen, which is managed by libpdal.so. Users also have the ability to explicitly say "open this file with this driver at this dll/so location", which allows them to short cut the map.

> - you can "emulate" building a single driver as plugin, by re-running a GDAL build with just the dependencies of that driver, and setting -DGDAL_ENABLE_DRIVER_xxxx_PLUGIN=ON. The only build artifact of interest in that use case is the [gdal|ogr]_XXX.so/dll corresponding to that driver. The main inconvenience I can see with this current approach is that you have to pay the price for the core lib to be rebuilt, whereas with the free-standing CMake project, you'd point to the installed GDAL headers & lib

This is not so bad because the pain is bore by those building, but the scenario below, where a user can take a clean source tree and configure/make/install only the driver(s) they want as individual projects, is ideal IMO. A packager or someone looking to build specific plugins could do so against a stock GDAL install with ease.

> - by free-standing CMake project, what do you mean ? Couldn't that just the existing frmts/XXXX/CMakeLists.txt file that would detect it is called as the top level CMakeLists.txt (probably by checking ${CMAKE_CURRENT_SOURCE_DIR} == ${PROJECT_SOURCE_DIR}) and then change its logic to find libgdal and its dependencies ? And users would "cmake -S frmts/XXXX -B plugin_XXXX" to configure just for that plugin.

Yes. Here's what we do for PDAL, where just a little bit of extra CMake stuff is required for the -DSTANDALONE=ON scenario https://github.com/PDAL/PDAL/blob/master/plugins/rxp/CMakeLists.txt and a user with a clean source tree can go into plugins/rxp and issue "cmake -DSTANDALONE=ON -DPdal_DIR=wherever -DCMAKE_INSTALL_PREFIX=wherever" and configure/make/install just the plugin. Obviously, GDAL headers/lib need to findable in this scenario, and only public stuff can be used. The source for this driver is managed inside the PDAL source tree, but it is configurable as a standalone installable project. 

> - I don't understand the "where multiple drivers have similar sets of dependencies, could be handled in some kind of hierarchical fashion based on common dependencies". why is a special case needed if several drivers share the same dependencies ? Or maybe you were thinking to drivers depending on other drivers ?

I was thinking of drivers that depended on other drivers. It isn't always obvious that some drivers are really families of dependencies.

> - we would need to keep the current monolithic CMake project approach working, at the very least for people doing static builds, but even for people doing dynamic builds as it might be still be more practical if you can install all the dependencies at once. Having the standalone capability in addition would be an extra complexity, so we need to be sure it addresses real use cases, and perhaps restrict it to a few select drivers. Obvious candidates for standalone CMake projects would likely be for the few drivers that have proprietary dependencies (ECW, JP2KAK, MrSID, Oracle, ...) and aren't shipped by FOSS binary distributions.

I totally agree that we would need to do some kind of cost/benefit to see if the complexity is worth the trouble. Our experience with PDAL is that drivers with hairy external dependencies that are either closed source or not conveniently distributed are the best candidates for this approach.

> - offering the possibility of building just a driver as a plugin in a unit way would require people to build against the same GDAL headers as libgdal.

Does it really? If communication across the boundary of the plugin to GDAL is using public GDAL pointers/classes/methods that haven't changed in many releases, does the plugin version actually need to perfectly match the main library version? For PDAL it hasn't, and we have used older binary plugins against newer main libraries with success. PDAL's interface in this regard is smaller, however, so the risk of changes causing problems are less. You could also wire in some explicit plugin versioning if you wanted a way to force a bump. I think if this were a community desire and priority, it could be done. 

> Is it in the expected cultural background of rasterio users to do that on their own ? 

My take on the culture of rasterio users is most just want to do 'pip install rasterio' and have it all work and not have to think about the fact that rasterio depends on a massive native library that must be compiled just so in order for that to happen. Rasterio does very well at abstracting GDAL away and being the pain sponge for its users. Part of that absorption duty is GDAL's build system :) 

My hunch is the ability to more easily take advantage of GDAL plugins within various GDAL binary deployment archipelagos (conda forge, pip, debiangis, vcpkg, homebrew, osgeo4w) would be leveraged if it were easier to do, it reliably worked, and it didn't come with a big performance penalty. I would love for 'pip install rasterio[ecw]' to work and not have to be updated with every GDAL release unless the ECW driver itself was actually updated. That hunch could be misinformed, however, and we would need feedback and information from the community before we should commit to changing anything significant.

Howard





From even.rouault at spatialys.com  Tue May 30 08:31:04 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 May 2023 17:31:04 +0200
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <6A156B7C-8ECE-44E2-B63D-FABA55C9E2FB@hobu.co>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
 <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>
 <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com>
 <6A156B7C-8ECE-44E2-B63D-FABA55C9E2FB@hobu.co>
Message-ID: <1d9b6951-f880-0747-ebe4-cc304d0b7ae3@spatialys.com>


> PDAL had this penalty and then we did some profiling and saw that most of the cost was the dlopen, not the finding of the plugin via the filesystem. PDAL doesn't have a GDALOpen-like single entry method where drivers are all expected to be loaded and "tried" sequentially, however. We have a map that registers some properties of the "filename" that tells us which driver to actually dlopen, which is managed by libpdal.so. Users also have the ability to explicitly say "open this file with this driver at this dll/so location", which allows them to short cut the map.

yes my profiling also shows that it is essentially due to the dlopen() time.

Loading only the plugin you need, in an automated way, is not currently 
possible, because the Identify() method is in plugins. For simple 
identification by file extensions, we could imagine having some registry 
mapping extension(s) to plugin name, but the Identify() method can do 
much more complicated stuff

>
>> - offering the possibility of building just a driver as a plugin in a unit way would require people to build against the same GDAL headers as libgdal.
> Does it really? If communication across the boundary of the plugin to GDAL is using public GDAL pointers/classes/methods that haven't changed in many releases, does the plugin version actually need to perfectly match the main library version?

Possibly 2 issues:

- you need to build a driver against the headers of the library you are 
going to run it against: even if the API remains compatible, you still 
need to build your plugins against GDAL headers of the same major.minor 
version due to ABI changes that occur almost at every feature release 
due to new virtual members or other such ABI incompatible change.

- you could possibly build driver FOO from GDAL 3.X sources against 
headers of GDAL 3.Y, but that may not be possible for all X,Y 
combinations due to some utility methods being added / changed / 
removed. For example in GDAL 3.6 we have remove the _GetProjectionRef() 
compatibility layer of GDAL 3.0. So if you build driver FOO from GDAL < 
3.6 against GDAL 3.6 headers, that isn't going to work (and probably the 
reverse)


> For PDAL it hasn't, and we have used older binary plugins against newer main libraries with success. PDAL's interface in this regard is smaller, however, so the risk of changes causing problems are less. You could also wire in some explicit plugin versioning if you wanted a way to force a bump. I think if this were a community desire and priority, it could be done.

The ABI that plugins directly or indirectly depend on is quite large. I 
don't see how we could have a stable ABI, at least not without 
significant complication and bloat.

Requiring when building a standalone plugin that you use the same X.Y 
GDAL version for the plugin source and the GDAL headers doesn't seem a 
unreasonable requirement to me.


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew at aitchison.me.uk  Tue May 30 09:04:47 2023
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 30 May 2023 17:04:47 +0100 (BST)
Subject: [gdal-dev] Improving details of the project build system and/or
 documentation
In-Reply-To: <6A156B7C-8ECE-44E2-B63D-FABA55C9E2FB@hobu.co>
References: <CAOodmJo+0DVgz9S-kNM0TF6OgXFUskstp+dV13P=gYHwxcZ_XQ@mail.gmail.com>
 <18ee1fb1-ddeb-4a50-0bc2-55460d6e6aa9@spatialys.com>
 <CAOodmJqtUO--uMQo-utQ1vuP6PJr2UK6b7Td-3odaBTtKWekkw@mail.gmail.com>
 <1db04213-40f8-55f8-ef68-3da7b96906ff@spatialys.com>
 <CAOodmJpmgMaWNWcyPrr=AggBzw-eFy-8M8vqdhjBX8AVRnXKew@mail.gmail.com>
 <55CE6F36-F0CA-483F-83BF-2B67E88A3FB7@hobu.co>
 <b1c1e409-69be-c763-a514-1671694f0b11@spatialys.com>
 <6A156B7C-8ECE-44E2-B63D-FABA55C9E2FB@hobu.co>
Message-ID: <3cba147d-d98b-64e7-5e6d-3aa738413dfe@aitchison.me.uk>

On Tue, 30 May 2023, Howard Butler wrote:

> I totally agree that we would need to do some kind of cost/benefit
> to see if the complexity is worth the trouble. Our experience with
> PDAL is that drivers with hairy external dependencies that are
> either closed source or not conveniently distributed are the best
> candidates for this approach.
>
>> - offering the possibility of building just a driver as a plugin in
>> - a unit way would require people to build against the same GDAL
>> - headers as libgdal.
>
> Does it really? If communication across the boundary of the plugin
> to GDAL is using public GDAL pointers/classes/methods that haven't
> changed in many releases, does the plugin version actually need to
> perfectly match the main library version? For PDAL it hasn't, and we
> have used older binary plugins against newer main libraries with
> success. PDAL's interface in this regard is smaller, however, so the
> risk of changes causing problems are less. You could also wire in
> some explicit plugin versioning if you wanted a way to force a
> bump. I think if this were a community desire and priority, it could
> be done.

I maintain two of my own drivers and have tooling to build them
as plugins against several different versions of GDAL, so have
done a very quick test. A plugin built against 3.6.2 will run in
3.6.0 - 3.6.4 but gdalinfo 3.7.0 aborts with the message:
   ERROR 1: <plugin> was compiled against GDAL 3.6,
   but the current library version is 3.7
Going the other way is similar.
I am not sure what would happen if gdal did not enforce matched minor versions.
While my plugins do have some #ifdefs for different GDAL versions,
the last change was https://github.com/OSGeo/gdal/pull/6609
when 3.6 dropped compatibility function _GetProjectionRef() and friends,
which should not affect 3.6.x <-> 3.7.y.
IIRC this was the first incompatibility since 3.0.

> My hunch is the ability to more easily take advantage of GDAL
> plugins within various GDAL binary deployment archipelagos (conda
> forge, pip, debiangis, vcpkg, homebrew, osgeo4w) would be leveraged
> if it were easier to do, it reliably worked, and it didn't come with
> a big performance penalty. I would love for 'pip install
> rasterio[ecw]' to work and not have to be updated with every GDAL
> release unless the ECW driver itself was actually updated. That
> hunch could be misinformed, however, and we would need feedback and
> information from the community before we should commit to changing
> anything significant.

I did submit one of my drivers for inclusion with GDAL,
but I haven't yet managed to get the code up to Even's standards,
so have thought about putting it on github as a plugin, but the
number of GDAL versions times platforms I would have to package
mean I haven't explored github packages yet.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From ahmettemiz88 at gmail.com  Tue May 30 10:59:15 2023
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Tue, 30 May 2023 20:59:15 +0300
Subject: [gdal-dev] wrong with clipping a tif file with a polygon
In-Reply-To: <AM0PR09MB321971841A725294FD545105FD4B9@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <CAJKO1Yv4ZjqeZmXfjF8bDdbJUmncrFOpyzpwbUvt8jFqTVC-aw@mail.gmail.com>
 <36C3D380-FB64-441E-B876-FB4B0B32EC7A@meganet.net>
 <CAJKO1Yv-jD0j3yGQC4bcPNN=ZEw-g1MKDbWV5L9T98580VjiBA@mail.gmail.com>
 <AM0PR09MB321971841A725294FD545105FD4B9@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CAJKO1Ys=tGGf1U7_JkgOQUGN2Qqv7W6xeO6fnEyyrpvKCoviQw@mail.gmail.com>

Thank you..
I solved the problem.  Cutting polygon has to be converted to pixel
coordinates.  I have missed that point. now it works well ..

Regards

30 May 2023 Sal 16:20 tarihinde Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> ?unu yazd?:

> Hi,
>
>
>
> I can?t really read the code, but based on what happens, maybe your
> cutline is outside the image. So you
>
>    - create an output band
>    - fill it with zeroes
>    - and then you write pixels within the cutline into the output
>
> Because the output stays all zeroes, and there are no errors, then I guess
> that the pixels within your cutline are all nodata.
>
> Maybe printing the WKT out from ?geom? could prove or disprove my guess.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Ahmet
> Temiz
> *L?hetetty:* tiistai 30. toukokuuta 2023 15.57
> *Vastaanottaja:* Norman Vine <nhv at meganet.net>
> *Kopio:* gdal-dev <gdal-dev at lists.osgeo.org>
> *Aihe:* Re: [gdal-dev] wrong with clipping a tif file with a polygon
>
>
>
> Thank you ,
>
>
>
> I already worked on that code. But clipping was not succesful. output.tif
> is blank on qgis.
>
>
>
> On Tue, May 30, 2023 at 3:24?PM Norman Vine <nhv at meganet.net> wrote:
>
> perhaps this will help
>
> https://stackoverflow.com/questions/70664043/clip-raster-with-polygon-with-gdal-c
>
> > On May 30, 2023, at 8:12 AM, Ahmet Temiz <ahmettemiz88 at gmail.com> wrote:
> >
> > Hi,
> > I am trying to clip a tif file with a polygon. But resulting output.tif
> file shows nothing.
> >
> > Where am I doing wrong ?
> >
> > "  #include <gdal/gdal.h>
> > #include <gdal/gdal_priv.h>
> > #include <gdal/gdalwarper.h>
> > #include <gdal/ogrsf_frmts.h>
> > #include <gdal/gdalwarper.h>
> > #include <string> // for string class
> > using namespace std;
> >
> > int main() {
> >   const char *inputPath = "input.tif";
> >   const char *outputPath = "output.tif";
> >
> >   // clipper Polygon
> >   // THIS FILE MUST BE IN PIXEL/LINE COORDINATES or otherwise one should
> >   // copy the function gdalwarp_lib.cpp:TransformCutlineToSource()
> >   // from GDAL's sources
> >   // It is expected that it contains a single polygon feature
> >   const char *read_filenamePoly = "input.geojson";
> >
> >   GDALDataset *hSrcDS;
> >   GDALDataset *hDstDS;
> >
> >   GDALAllRegister();
> >   auto poDriver = GetGDALDriverManager()->GetDriverByName("GTiff");
> >   hSrcDS = (GDALDataset *)GDALOpen(inputPath, GA_ReadOnly);
> >
> >   hDstDS = (GDALDataset *)poDriver->CreateCopy(
> >   outputPath, hSrcDS, 0, nullptr, nullptr, nullptr);
> >   // Without this step the cutline is useless - because the background
> >   // will be carried over from the original image
> >   hDstDS->GetRasterBand(1)->Fill(0);
> >
> >   hDstDS->SetProjection(hSrcDS->GetProjectionRef());
> >
> >   const char *src_srs = hSrcDS->GetProjectionRef();
> >   const char *dst_srs = hDstDS->GetProjectionRef();
> >   printf("%s ",src_srs);
> >   // clipper Layer
> >   GDALDataset *poDSClipper;
> >   poDSClipper = (GDALDataset *)GDALOpenEx(
> >     read_filenamePoly, GDAL_OF_UPDATE, NULL, NULL, NULL);
> >
> >   auto poLayerClipper = poDSClipper->GetLayer(0);
> >   auto geom = poLayerClipper->GetNextFeature()->GetGeometryRef();
> >   //char* wkt = nullptr;
> >   if (geom != nullptr && geom->IsValid())
> >   {
> >       printf("\n geom is valid \n");
> >   }
> >   // setup warp options
> >   GDALWarpOptions *psWarpOptions = GDALCreateWarpOptions();
> >   psWarpOptions->hSrcDS = hSrcDS;
> >   psWarpOptions->hDstDS = hDstDS;
> >   psWarpOptions->nBandCount = 1;
> >   psWarpOptions->panSrcBands =
> >     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
> >   psWarpOptions->panSrcBands[0] = 1;
> >   psWarpOptions->panDstBands =
> >     (int *)CPLMalloc(sizeof(int) * psWarpOptions->nBandCount);
> >   psWarpOptions->panDstBands[0] = 1;
> >   psWarpOptions->pfnProgress = GDALTermProgress;
> >   psWarpOptions->hCutline = geom;
> >
> >   // Establish reprojection transformer.
> >   psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer(
> >     hSrcDS, src_srs, hDstDS, dst_srs, TRUE, 1000, 1);
> >   psWarpOptions->pfnTransformer = GDALGenImgProjTransform;
> >   GDALWarpOperation oOperation;
> >   oOperation.Initialize(psWarpOptions);
> >   oOperation.ChunkAndWarpImage(
> >     0, 0, GDALGetRasterXSize(hDstDS), GDALGetRasterYSize(hDstDS));
> >   GDALDestroyGenImgProjTransformer(psWarpOptions->pTransformerArg);
> >   GDALDestroyWarpOptions(psWarpOptions);
> >   GDALClose(hDstDS);
> >   GDALClose(hSrcDS);
> > }
> > "
> >
> > --
> > Ahmet Temiz
> > Jeoloji M?h.
> > Afet ve Acil Durum Y?netimi Ba?kanl???
> > Deprem  Dairesi Ba?kanl???
> >
> >
> > ________________________
> >
> > Ahmet Temiz
> > Geological Eng.
> >
> > Disaster and Emergency Management
> > of Presidency
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> --
>
> Ahmet Temiz
> Jeoloji M?h.
> Afet ve Acil Durum Y?netimi Ba?kanl???
> Deprem  Dairesi Ba?kanl???
>
>
> ________________________
>
> Ahmet Temiz
> Geological Eng.
>
> Disaster and Emergency Management
> of Presidency
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230530/366785ab/attachment-0001.htm>

From even.rouault at spatialys.com  Tue May 30 11:08:19 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 May 2023 20:08:19 +0200
Subject: [gdal-dev] [PROJ] Migrating to PROJ-9
In-Reply-To: <1776741479.8542661.1685469700826.JavaMail.zimbra@ign.fr>
References: <1554747504.7324762.1685127274306.JavaMail.zimbra@ign.fr>
 <011ed301-0b81-9d3c-f811-53cd86410274@spatialys.com>
 <ce612851-9904-ed0f-d9d8-67da7663db1f@spatialys.com>
 <400922225.8539012.1685468809744.JavaMail.zimbra@ign.fr>
 <7426656c-1c20-39d1-b9b8-d901512d287a@spatialys.com>
 <1776741479.8542661.1685469700826.JavaMail.zimbra@ign.fr>
Message-ID: <1eaecedc-a420-7316-d297-4e23f22b5dc8@spatialys.com>


Le 30/05/2023 ? 20:01, Nicolas Bellaiche a ?crit :
 >
 >
 > That's why I get:
 >
 >? echo 3356123.5400 1303218.3090 5247430.6050 | PROJ_DEBUG=3 
./bin/cs2cs IGNF:RGR92 +to IGNF:REUN47
 >
 > pj_open_lib(proj.ini): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/proj.ini) 
- succeeded
 >
 > pj_open_lib(proj.db): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/proj.db) 
- succeeded
 >
 >? instantiate_crs type: 10:
 >
 >? instantiate_crs type: 10:
 >
 > helmert: pj_ellipsoid - final: a=6378137.000 f=1/298.257, errno=0
 >
 > helmert: pj_ellipsoid - final:??? ellps=GRS80
 >
 > helmert: Helmert parameters:
 >
 > helmert: x=? -789.99000? y=? 627.33300? z=? 89.68500
 >
 > helmert: rx= -0.60720? ry= -76.80190? rz= 10.56800
 >
 > helmert: s=? 32.20830? exact=0? convention=position_vector
 >
 > helmert: dx=? 0.00000? dy=? 0.00000? dz=? 0.00000
 >
 > helmert: drx= 0.00000? dry= 0.00000? drz= 0.00000
 >
 > helmert: ds=? 0.00000? t_epoch= 0.00000
 >
 > helmert: Transformation parameters for observation t_obs=0 (t_epoch=0):
 >
 > helmert: x: -789.99
 >
 > helmert: y: 627.333
 >
 > helmert: z: 89.685
 >
 > helmert: s: 3.22083e-05
 >
 > helmert: rx: -2.94379e-06
 >
 > helmert: ry: -0.000372346
 >
 > helmert: rz: 5.12351e-05
 >
 > helmert: theta: 0
 >
 > helmert: Rotation Matrix:
 >
 > helmert:?? |????? 1? -5.12351e-05? -0.000372346 |
 >
 > helmert:?? |? 5.12351e-05?????? 1?? 2.94379e-06 |
 >
 > helmert:?? |? 0.000372346? -2.94379e-06?????? 1 |
 >
 > 3353420.95 1304075.02 5248935.14
 >
 >
 >
 > =====================================================
 >
 >
 > (base) nbellaiche at MAC1709W003-2 Release % echo 3356123.5400 
1303218.3090 5247430.6050 | PROJ_DEBUG=3 ./bin/cs2cs +init=IGNF:RGR92 
+to +init=IGNF:REUN47
 >
 > pj_open_lib(proj.ini): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/proj.ini) 
- succeeded
 >
 > pj_open_lib(proj.db): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/proj.db) 
- succeeded
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > get_init: searching cache for key: [IGNF:RGR92]
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > get_init: searching on in init files for [IGNF:RGR92]
 >
 > get_init_string: searching for section [RGR92] in init file [IGNF]
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > key=IGNF:RGR92, value: [title=Reseau geodesique Reunion 1992 
proj=geocent towgs84=0.0000,0.0000,0.0000 a=6378137.0000 
rf=298.2572221010000 units=m no_defs]
 >
 > get_init: got [title=Reseau geodesique Reunion 1992 proj=geocent 
towgs84=0.0000,0.0000,0.0000 a=6378137.0000 rf=298.2572221010000 units=m 
no_defs], paralist[0,1]: [title=Reseau,geodesique]
 >
 >? instantiate_crs type: 19:
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > get_init: searching cache for key: [IGNF:REUN47]
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > get_init: searching on in init files for [IGNF:REUN47]
 >
 > get_init_string: searching for section [REUN47] in init file [IGNF]
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > key=IGNF:REUN47, value: [title=Reunion 1947 proj=geocent 
towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 
a=6378388.0000 rf=297.0000000000000 units=m no_defs]
 >
 > get_init: got [title=Reunion 1947 proj=geocent 
towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 
a=6378388.0000 rf=297.0000000000000 units=m no_defs], paralist[0,1]: 
[title=Reunion,1947]
 >
 >? instantiate_crs type: 19:
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > get_init: searching cache for key: [IGNF:RGR92]
 >
 > pj_open_lib(IGNF): call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF) 
- succeeded
 >
 > get_init: searching cache for key: [IGNF:REUN47]
 >
 > noop: pj_ellipsoid - final: a=6378137.000 f=1/298.257, errno=0
 >
 > noop: pj_ellipsoid - final:??? ellps=GRS80
 >
 > 3356123.54 1303218.31 5247430.61
 >
 >
 >
 >

 > Does it give a hint of what's wrong?


Yes, note the call 
fopen(/Users/nbellaiche/dev/sd-externs/macosx-clang/proj-9.1.1/nad/IGNF 
. I believe I mentioned in a early response that this IGNF file should 
no longer be used in modern PROJ versions. The IGNF file apparently uses 
the towgs84 parameter of the "REUNION-PITON DES NEIGES vers RGR92 
(RESEAU GEODESIQUE DE LA REUNION 1992)" transformation. That said, I'm 
not sure which one is the best as both the one used by current PROJ 
versions (RGR92 (RESEAU GEODESIQUE DE LA REUNION 1992) vers 
REUNION-PITON DES NEIGES)) and that one could apply...

-- 
http://www.spatialys.com
My software is free, but my time generally not.

From rykovd at gmail.com  Wed May 31 16:52:56 2023
From: rykovd at gmail.com (Denis Rykov)
Date: Thu, 1 Jun 2023 01:52:56 +0200
Subject: [gdal-dev] OAPIF Unexpected Content-Type
Message-ID: <CAJbvKNojS8H-L2Yx-xPC=iqUhHLbq3mbj2_aj2frQ7HfdvaDqg@mail.gmail.com>

I'm getting "ERROR 1: Unexpected Content-Type: (null)" in the middle of the
ogrinfo output. What does this mean? I can adjust server configuration but
it is not clear which endpoint is failing because apart from that message
everything seems to be working fine.

$ ogrinfo OAPIF:http://localhost:8080/api/resource/6750/oapif/ layer_6209
INFO: Open of `OAPIF:http://localhost:8080/api/resource/6750/oapif/'
      using driver `OAPIF' successful.

Layer name: layer_6209
Metadata:
  TITLE=Test layer
Geometry: Point
ERROR 1: Unexpected Content-Type: (null)
Feature Count: 26
Extent: (0.000000, 0.000000) - (110.275300, 49.493019)
Layer SRS WKT:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
num: Real (0.0)
link: String (0.0)
wikipedia: String (0.0)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230601/34170937/attachment.htm>

From even.rouault at spatialys.com  Wed May 31 17:09:20 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 1 Jun 2023 02:09:20 +0200
Subject: [gdal-dev] OAPIF Unexpected Content-Type
In-Reply-To: <CAJbvKNojS8H-L2Yx-xPC=iqUhHLbq3mbj2_aj2frQ7HfdvaDqg@mail.gmail.com>
References: <CAJbvKNojS8H-L2Yx-xPC=iqUhHLbq3mbj2_aj2frQ7HfdvaDqg@mail.gmail.com>
Message-ID: <d1fe2b89-ca97-c344-57df-8de5610d7aec@spatialys.com>

Denis,

You have to identify on which request this occurs

Run with CPL_DEBUG=ON CPL_CURL_VERBOSE=ON

This error is emitted when the server issues a response with a missing 
Content-Type header.

Le 01/06/2023 ? 01:52, Denis Rykov a ?crit?:
> I'm getting "ERROR 1: Unexpected Content-Type: (null)" in the middle 
> of the ogrinfo output. What does?this mean? I can adjust server 
> configuration but it is not clear which endpoint is failing because 
> apart from that message everything seems?to be working fine.
>
> $ ogrinfo OAPIF:http://localhost:8080/api/resource/6750/oapif/ layer_6209
> INFO: Open of `OAPIF:http://localhost:8080/api/resource/6750/oapif/'
> ? ? ? using driver `OAPIF' successful.
>
> Layer name: layer_6209
> Metadata:
> ? TITLE=Test layer
> Geometry: Point
> ERROR 1: Unexpected Content-Type: (null)
> Feature Count: 26
> Extent: (0.000000, 0.000000) - (110.275300, 49.493019)
> Layer SRS WKT:
> GEOGCRS["WGS 84",
> ? ? DATUM["World Geodetic System 1984",
> ? ? ? ? ELLIPSOID["WGS 84",6378137,298.257223563,
> ? ? ? ? ? ? LENGTHUNIT["metre",1]]],
> ? ? PRIMEM["Greenwich",0,
> ? ? ? ? ANGLEUNIT["degree",0.0174532925199433]],
> ? ? CS[ellipsoidal,2],
> ? ? ? ? AXIS["geodetic latitude (Lat)",north,
> ? ? ? ? ? ? ORDER[1],
> ? ? ? ? ? ? ANGLEUNIT["degree",0.0174532925199433]],
> ? ? ? ? AXIS["geodetic longitude (Lon)",east,
> ? ? ? ? ? ? ORDER[2],
> ? ? ? ? ? ? ANGLEUNIT["degree",0.0174532925199433]],
> ? ? ID["EPSG",4326]]
> Data axis to CRS axis mapping: 2,1
> num: Real (0.0)
> link: String (0.0)
> wikipedia: String (0.0)
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


