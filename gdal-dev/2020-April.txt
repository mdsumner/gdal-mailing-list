From g.lostis at kayrros.com  Thu Apr  2 03:09:35 2020
From: g.lostis at kayrros.com (Guillaume Lostis)
Date: Thu, 2 Apr 2020 12:09:35 +0200
Subject: [gdal-dev] gdal_translate on VRT gives black image
Message-ID: <CALA3rvv-dMHuOSr-KGL=G0M=G4B3pQDX9+dgMZwbw8zB2toXaA@mail.gmail.com>

Hello,

I'm posting this here instead of Github as I don't know if it is a bug or
my misuse of the VRT format in conjunction with gdal_translate.

When I create a VRT (v.vrt) with a SimpleSource pointing to a simple 20x20
pixels TIFF file and I do:
gdal_translate v.vrt t.tif
I get a black image at t.tif.

I also get the same result if I do:
gdal_translate -srcwin 0 0 20 20 v.vrt t.tif

If I change xsize or ysize to something different from 20, e.g.:
gdal_translate -srcwin 0 0 21 20 v.vrt t.tif
then I get an image with the expected content.

Here's a simple VRT that can reproduce the issue:
<VRTDataset rasterXSize="20" rasterYSize="20">
  <VRTRasterBand dataType="Byte" band="1">
    <SimpleSource>
      <SourceFilename relativeToVRT="0">/vsicurl/
https://raw.githubusercontent.com/osgeo/gdal/master/autotest/gcore/data/byte.tif
</SourceFilename>
    </SimpleSource>
  </VRTRasterBand>
</VRTDataset>

Am I doing something wrong here, or is there an explanation as to why my
TIFF is black when the srcwin is the same size as the dataset, but OK when
the srcwin is larger or smaller than the dataset?

Thanks,
Guillaume Lostis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/a2f72301/attachment.html>

From even.rouault at spatialys.com  Thu Apr  2 03:39:41 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Apr 2020 12:39:41 +0200
Subject: [gdal-dev] gdal_translate on VRT gives black image
In-Reply-To: <CALA3rvv-dMHuOSr-KGL=G0M=G4B3pQDX9+dgMZwbw8zB2toXaA@mail.gmail.com>
References: <CALA3rvv-dMHuOSr-KGL=G0M=G4B3pQDX9+dgMZwbw8zB2toXaA@mail.gmail.com>
Message-ID: <14557692.OKocpaHbMN@even-i700>

Guillaume,

It was a bug. Fix pushed.

You can workaround it by adding 

<DstRect xOff="0" yOff="0" xSize="20" ySize="20" />

as a child element of <SimpleSource>

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/6906962e/attachment.html>

From g.lostis at kayrros.com  Thu Apr  2 03:45:42 2020
From: g.lostis at kayrros.com (Guillaume Lostis)
Date: Thu, 2 Apr 2020 12:45:42 +0200
Subject: [gdal-dev] gdal_translate on VRT gives black image
In-Reply-To: <14557692.OKocpaHbMN@even-i700>
References: <CALA3rvv-dMHuOSr-KGL=G0M=G4B3pQDX9+dgMZwbw8zB2toXaA@mail.gmail.com>
 <14557692.OKocpaHbMN@even-i700>
Message-ID: <CALA3rvsueARc7Dc9o7cbH9z=nPoBaV=o2aaf1uRHp1QPkwTHXA@mail.gmail.com>

Even,

Thanks for your prompt fix and for the workaround!

Guillaume

On Thu, Apr 2, 2020 at 12:39 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Guillaume,
>
>
>
> It was a bug. Fix pushed.
>
>
>
> You can workaround it by adding
>
>
>
> <DstRect xOff="0" yOff="0" xSize="20" ySize="20" />
>
>
>
> as a child element of <SimpleSource>
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/f06a862c/attachment.html>

From even.rouault at spatialys.com  Thu Apr  2 05:57:48 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Apr 2020 14:57:48 +0200
Subject: [gdal-dev] Dealing with "default" TOWGS84 values
In-Reply-To: <rmir1x88q7k.fsf@s1.lexort.com>
References: <3645694.ToKyIBH2vB@even-i700> <rmir1x88q7k.fsf@s1.lexort.com>
Message-ID: <1665936.rGZMnuhKFH@even-i700>

Greg,

> Matching and skipping also feels fragile, rather than not using and
> having people that want to use them have to be explicit.

Thanks for your thoughts. I've taken an intermediate approach between my initial thoughts 
and your suggestion, which I hope should be a reasonable default behaviour

Implemented per https://github.com/OSGeo/gdal/pull/2370:

"""
Strip TOWGS84 when datum is known, in GTiff, Spatialite and GPKG drivers

Implements a simplified version of the idea mentioned in
https://lists.osgeo.org/pipermail/gdal-dev/2020-March/051881.html
with a variant of the more radical approach suggested in
https://lists.osgeo.org/pipermail/gdal-dev/2020-March/051885.html

That is the new method OGRSpatialReference::StripTOWGS84IfKnownDatumAndAllowed()
will remove TOWGS84 information from SRS whose datum name is known,
unless the OSR_STRIP_TOWGS84 configuration option is set to NO.
When TOWGS84 information is striped, a debug message is emitted.
"""

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/b02ddaff/attachment.html>

From are131 at psu.edu  Thu Apr  2 06:24:57 2020
From: are131 at psu.edu (Edson, Adam Robert)
Date: Thu, 2 Apr 2020 13:24:57 +0000
Subject: [gdal-dev] Accessing DES in NITF through GDAL
Message-ID: <SN6PR02MB5038542B580E6F1A1B35294993C60@SN6PR02MB5038.namprd02.prod.outlook.com>

I am working with NITF data. How are Data Extension Segments (DES) accessed through GDAL?

Thanks!
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/a056a9c8/attachment-0001.html>

From even.rouault at spatialys.com  Thu Apr  2 08:03:32 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Apr 2020 17:03:32 +0200
Subject: [gdal-dev] Accessing DES in NITF through GDAL
In-Reply-To: <SN6PR02MB5038542B580E6F1A1B35294993C60@SN6PR02MB5038.namprd02.prod.outlook.com>
References: <SN6PR02MB5038542B580E6F1A1B35294993C60@SN6PR02MB5038.namprd02.prod.outlook.com>
Message-ID: <16357713.JZVhVrN8MB@even-i700>

Adam,

> I am working with NITF data. How are Data Extension Segments (DES) accessed
> through GDAL?

Complicated topic.

TRE stored in DES are reported in the TRE and xml:TRE metadata domains.

For generic DES extraction, you need to build GDAL with the ESRI_BUILD macro 
enabled, and then they should be reported as Base64 encoded content in the 
NITF_DES metadata domain, but I haven't tried such builds recently.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/e171eeea/attachment.html>

From are131 at psu.edu  Thu Apr  2 08:53:18 2020
From: are131 at psu.edu (Edson, Adam Robert)
Date: Thu, 2 Apr 2020 15:53:18 +0000
Subject: [gdal-dev] Accessing DES in NITF through GDAL
In-Reply-To: <16357713.JZVhVrN8MB@even-i700>
References: <SN6PR02MB5038542B580E6F1A1B35294993C60@SN6PR02MB5038.namprd02.prod.outlook.com>,
 <16357713.JZVhVrN8MB@even-i700>
Message-ID: <SN6PR02MB5038F92B47DDF40D81E1D11193C60@SN6PR02MB5038.namprd02.prod.outlook.com>

I have been tasked with making GDAL capable of dealing with a new NITF type (https://calval.cr.usgs.gov/apps/sites/default/files/jacie/BarbaraEckstein.pdf) that has major buy-in from data providers. Due to the ubiquity of GDAL, making the change at this level will give the most people access.
The Spectral NITF Implementation Profile (SNIP): A New Standard for Multispectral and Hyperspectral Imagery Datasets<https://calval.cr.usgs.gov/apps/sites/default/files/jacie/BarbaraEckstein.pdf>
The NITF Standard (NITFS) consists of a file header and different “segment” types Some segments may include “tagged record extensions” (TREs), i.e., metadata headers
calval.cr.usgs.gov

________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Thursday, April 2, 2020 11:03 AM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Cc: Edson, Adam Robert <are131 at psu.edu>
Subject: Re: [gdal-dev] Accessing DES in NITF through GDAL


Adam,



> I am working with NITF data. How are Data Extension Segments (DES) accessed

> through GDAL?



Complicated topic.



TRE stored in DES are reported in the TRE and xml:TRE metadata domains.



For generic DES extraction, you need to build GDAL with the ESRI_BUILD macro enabled, and then they should be reported as Base64 encoded content in the NITF_DES metadata domain, but I haven't tried such builds recently.



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/5813b94d/attachment.html>

From even.rouault at spatialys.com  Thu Apr  2 09:05:36 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Apr 2020 18:05:36 +0200
Subject: [gdal-dev] Accessing DES in NITF through GDAL
In-Reply-To: <SN6PR02MB5038F92B47DDF40D81E1D11193C60@SN6PR02MB5038.namprd02.prod.outlook.com>
References: <SN6PR02MB5038542B580E6F1A1B35294993C60@SN6PR02MB5038.namprd02.prod.outlook.com>
 <16357713.JZVhVrN8MB@even-i700>
 <SN6PR02MB5038F92B47DDF40D81E1D11193C60@SN6PR02MB5038.namprd02.prod.outlook.com>
Message-ID: <3070323.tnA0bpkGmp@even-i700>

On jeudi 2 avril 2020 15:53:18 CEST Edson, Adam Robert wrote:
> I have been tasked with making GDAL capable of dealing with a new NITF 
type
> (https://calval.cr.usgs.gov/apps/sites/default/files/jacie/BarbaraEckstein.
> pdf) that has major buy-in from data providers. Due to the ubiquity of GDAL,
> making the change at this level will give the most people access.

Ah, from our past exchanges, I assume you're behind this recent pull request 
regarding SNIP support 
https://github.com/OSGeo/gdal/pull/2336 ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/35169fec/attachment.html>

From bradh at frogmouth.net  Thu Apr  2 09:00:40 2020
From: bradh at frogmouth.net (Brad Hards)
Date: Fri, 3 Apr 2020 03:00:40 +1100
Subject: [gdal-dev] Accessing DES in NITF through GDAL
In-Reply-To: <SN6PR02MB5038F92B47DDF40D81E1D11193C60@SN6PR02MB5038.namprd02.prod.outlook.com>
References: <SN6PR02MB5038542B580E6F1A1B35294993C60@SN6PR02MB5038.namprd02.prod.outlook.com>,
 <16357713.JZVhVrN8MB@even-i700>
 <SN6PR02MB5038F92B47DDF40D81E1D11193C60@SN6PR02MB5038.namprd02.prod.outlook.com>
Message-ID: <009701d60907$dc0626a0$941273e0$@frogmouth.net>

I think there could be value in adding CSSHPB with new code inside GDAL
NITF. See
https://github.com/OSGeo/gdal/blob/master/gdal/frmts/nitf/nitfdes.c#L209

 

Do GLAS/GFM later.

 

Brad

 

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Edson, Adam
Robert
Sent: Friday, 3 April 2020 2:53 AM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Accessing DES in NITF through GDAL

 

I have been tasked with making GDAL capable of dealing with a new NITF type
(https://calval.cr.usgs.gov/apps/sites/default/files/jacie/BarbaraEckstein.p
df) that has major buy-in from data providers. Due to the ubiquity of GDAL,
making the change at this level will give the most people access.


 
<https://calval.cr.usgs.gov/apps/sites/default/files/jacie/BarbaraEckstein.p
df> The Spectral NITF Implementation Profile (SNIP): A New Standard for
Multispectral and Hyperspectral Imagery Datasets

The NITF Standard (NITFS) consists of a file header and different "segment"
types Some segments may include "tagged record extensions" (TREs), i.e.,
metadata headers

calval.cr.usgs.gov

 

  _____  

From: Even Rouault <even.rouault at spatialys.com
<mailto:even.rouault at spatialys.com> >
Sent: Thursday, April 2, 2020 11:03 AM
To: gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
<gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org> >
Cc: Edson, Adam Robert <are131 at psu.edu <mailto:are131 at psu.edu> >
Subject: Re: [gdal-dev] Accessing DES in NITF through GDAL 

 

Adam,

 

> I am working with NITF data. How are Data Extension Segments (DES)
accessed

> through GDAL?

 

Complicated topic.

 

TRE stored in DES are reported in the TRE and xml:TRE metadata domains.

 

For generic DES extraction, you need to build GDAL with the ESRI_BUILD macro
enabled, and then they should be reported as Base64 encoded content in the
NITF_DES metadata domain, but I haven't tried such builds recently.

 

Even

 

-- 

Spatialys - Geospatial professional services

http://www.spatialys.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200403/4957119f/attachment-0001.html>

From are131 at psu.edu  Thu Apr  2 10:26:23 2020
From: are131 at psu.edu (Edson, Adam Robert)
Date: Thu, 2 Apr 2020 17:26:23 +0000
Subject: [gdal-dev] Accessing DES in NITF through GDAL
In-Reply-To: <009701d60907$dc0626a0$941273e0$@frogmouth.net>
References: <SN6PR02MB5038542B580E6F1A1B35294993C60@SN6PR02MB5038.namprd02.prod.outlook.com>,
 <16357713.JZVhVrN8MB@even-i700>
 <SN6PR02MB5038F92B47DDF40D81E1D11193C60@SN6PR02MB5038.namprd02.prod.outlook.com>,
 <009701d60907$dc0626a0$941273e0$@frogmouth.net>
Message-ID: <SN6PR02MB5038EF5C8C812BD70C6DE41993C60@SN6PR02MB5038.namprd02.prod.outlook.com>

Especially as I haven't seen a descriptive document for them yet.
________________________________
From: Brad Hards <bradh at frogmouth.net>
Sent: Thursday, April 2, 2020 12:00 PM
To: Edson, Adam Robert <are131 at psu.edu>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: RE: [gdal-dev] Accessing DES in NITF through GDAL


I think there could be value in adding CSSHPB with new code inside GDAL NITF. See https://github.com/OSGeo/gdal/blob/master/gdal/frmts/nitf/nitfdes.c#L209<https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fblob%2Fmaster%2Fgdal%2Ffrmts%2Fnitf%2Fnitfdes.c%23L209&data=02%7C01%7Care131%40psu.edu%7Cdb0f54a867014bd9d01c08d7d71f0225%7C7cf48d453ddb4389a9c1c115526eb52e%7C0%7C1%7C637214400509897086&sdata=fjKo%2BPoB13uLWVme017unoi7Vtej4UKCJ%2Bc3%2FoJthbU%3D&reserved=0>



Do GLAS/GFM later.



Brad



From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Edson, Adam Robert
Sent: Friday, 3 April 2020 2:53 AM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Accessing DES in NITF through GDAL



I have been tasked with making GDAL capable of dealing with a new NITF type (https://calval.cr.usgs.gov/apps/sites/default/files/jacie/BarbaraEckstein.pdf<https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcalval.cr.usgs.gov%2Fapps%2Fsites%2Fdefault%2Ffiles%2Fjacie%2FBarbaraEckstein.pdf&data=02%7C01%7Care131%40psu.edu%7Cdb0f54a867014bd9d01c08d7d71f0225%7C7cf48d453ddb4389a9c1c115526eb52e%7C0%7C1%7C637214400509907083&sdata=FsHOy6MExgDO2PwRfumpRdCNiPUEnf1GWLL5Nk%2FB6Zo%3D&reserved=0>) that has major buy-in from data providers. Due to the ubiquity of GDAL, making the change at this level will give the most people access.

The Spectral NITF Implementation Profile (SNIP): A New Standard for Multispectral and Hyperspectral Imagery Datasets<https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcalval.cr.usgs.gov%2Fapps%2Fsites%2Fdefault%2Ffiles%2Fjacie%2FBarbaraEckstein.pdf&data=02%7C01%7Care131%40psu.edu%7Cdb0f54a867014bd9d01c08d7d71f0225%7C7cf48d453ddb4389a9c1c115526eb52e%7C0%7C1%7C637214400509907083&sdata=FsHOy6MExgDO2PwRfumpRdCNiPUEnf1GWLL5Nk%2FB6Zo%3D&reserved=0>

The NITF Standard (NITFS) consists of a file header and different “segment” types Some segments may include “tagged record extensions” (TREs), i.e., metadata headers

calval.cr.usgs.gov



________________________________

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Thursday, April 2, 2020 11:03 AM
To: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Cc: Edson, Adam Robert <are131 at psu.edu<mailto:are131 at psu.edu>>
Subject: Re: [gdal-dev] Accessing DES in NITF through GDAL



Adam,



> I am working with NITF data. How are Data Extension Segments (DES) accessed

> through GDAL?



Complicated topic.



TRE stored in DES are reported in the TRE and xml:TRE metadata domains.



For generic DES extraction, you need to build GDAL with the ESRI_BUILD macro enabled, and then they should be reported as Base64 encoded content in the NITF_DES metadata domain, but I haven't tried such builds recently.



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com<https://nam01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&data=02%7C01%7Care131%40psu.edu%7Cdb0f54a867014bd9d01c08d7d71f0225%7C7cf48d453ddb4389a9c1c115526eb52e%7C0%7C1%7C637214400509917076&sdata=t%2FN3ibH8aUsEDcre1Qr9PdSiNr%2Fae1Nnjedd%2BKVhazc%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200402/f0aae507/attachment.html>

From nyall.dawson at gmail.com  Thu Apr  2 19:11:33 2020
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Fri, 3 Apr 2020 12:11:33 +1000
Subject: [gdal-dev] Dealing with "default" TOWGS84 values
In-Reply-To: <1665936.rGZMnuhKFH@even-i700>
References: <3645694.ToKyIBH2vB@even-i700> <rmir1x88q7k.fsf@s1.lexort.com>
 <1665936.rGZMnuhKFH@even-i700>
Message-ID: <CAB28AsiH0icWOX1rz5tSBgoRwgEP9VFO8jO8BQ3Fan4eUhTYwg@mail.gmail.com>

On Thu, 2 Apr 2020 at 22:58, Even Rouault <even.rouault at spatialys.com> wrote:

> Thanks for your thoughts. I've taken an intermediate approach between my initial thoughts and your suggestion, which I hope should be a reasonable default behaviour
>
>
>
> Implemented per https://github.com/OSGeo/gdal/pull/2370:

Just wanted to publicly state that I approve of the new logic and
believe it will result in a much improved situation for users, and
have tested the PR and can confirm it fixes the original bug reports.

Nyall

From nyall.dawson at gmail.com  Thu Apr  2 19:11:59 2020
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Fri, 3 Apr 2020 12:11:59 +1000
Subject: [gdal-dev] Dealing with "default" TOWGS84 values
In-Reply-To: <CAB28AsiH0icWOX1rz5tSBgoRwgEP9VFO8jO8BQ3Fan4eUhTYwg@mail.gmail.com>
References: <3645694.ToKyIBH2vB@even-i700> <rmir1x88q7k.fsf@s1.lexort.com>
 <1665936.rGZMnuhKFH@even-i700>
 <CAB28AsiH0icWOX1rz5tSBgoRwgEP9VFO8jO8BQ3Fan4eUhTYwg@mail.gmail.com>
Message-ID: <CAB28AsjaVtbqiCFOhHr1RFkE_kcG9ry2TRjx82vqkeXHNRCLhA@mail.gmail.com>

On Fri, 3 Apr 2020 at 12:11, Nyall Dawson <nyall.dawson at gmail.com> wrote:
>
> On Thu, 2 Apr 2020 at 22:58, Even Rouault <even.rouault at spatialys.com> wrote:
>
> > Thanks for your thoughts. I've taken an intermediate approach between my initial thoughts and your suggestion, which I hope should be a reasonable default behaviour
> >
> >
> >
> > Implemented per https://github.com/OSGeo/gdal/pull/2370:
>
> Just wanted to publicly state that I approve of the new logic and
> believe it will result in a much improved situation for users, and
> have tested the PR and can confirm it fixes the original bug reports.

Oops, and to say a big thank you to Even for his hard work here!

Nyall

From peet.whittaker at gmail.com  Fri Apr  3 02:05:53 2020
From: peet.whittaker at gmail.com (Peet Whittaker)
Date: Fri, 3 Apr 2020 10:05:53 +0100
Subject: [gdal-dev] Dealing with "default" TOWGS84 values
In-Reply-To: <CAB28AsjaVtbqiCFOhHr1RFkE_kcG9ry2TRjx82vqkeXHNRCLhA@mail.gmail.com>
References: <3645694.ToKyIBH2vB@even-i700> <rmir1x88q7k.fsf@s1.lexort.com>
 <1665936.rGZMnuhKFH@even-i700>
 <CAB28AsiH0icWOX1rz5tSBgoRwgEP9VFO8jO8BQ3Fan4eUhTYwg@mail.gmail.com>
 <CAB28AsjaVtbqiCFOhHr1RFkE_kcG9ry2TRjx82vqkeXHNRCLhA@mail.gmail.com>
Message-ID: <CAEcj7kXHpub94OaU3G0YbXazbFHjSz2y8GxhJFQxJdBQ9MzOzQ@mail.gmail.com>

On Fri, 3 Apr 2020 at 03:12, Nyall Dawson <nyall.dawson at gmail.com> wrote:

> Oops, and to say a big thank you to Even for his hard work here!
>

Seconded!

Now that the PR has been merged, is the plan to release a 3.0.5 version of
GDAL in time to be included in the QGIS 3.10.5 / 3.12.2 release (scheduled
for 17th April according to the roadmap)? Or would this end up in the GDAL
3.1.0 release (I saw something saying that this might be around the 27th of
April), which would push this back to the next next QGIS point-release
(i.e. QGIS 3.10.6) in May?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200403/abfb7002/attachment.html>

From even.rouault at spatialys.com  Fri Apr  3 02:40:06 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 03 Apr 2020 11:40:06 +0200
Subject: [gdal-dev] Dealing with "default" TOWGS84 values
In-Reply-To: <CAEcj7kXHpub94OaU3G0YbXazbFHjSz2y8GxhJFQxJdBQ9MzOzQ@mail.gmail.com>
References: <3645694.ToKyIBH2vB@even-i700>
 <CAB28AsjaVtbqiCFOhHr1RFkE_kcG9ry2TRjx82vqkeXHNRCLhA@mail.gmail.com>
 <CAEcj7kXHpub94OaU3G0YbXazbFHjSz2y8GxhJFQxJdBQ9MzOzQ@mail.gmail.com>
Message-ID: <5899046.oLqaUEzMFz@even-i700>

On vendredi 3 avril 2020 10:05:53 CEST Peet Whittaker wrote:
> On Fri, 3 Apr 2020 at 03:12, Nyall Dawson <nyall.dawson at gmail.com> wrote:
> > Oops, and to say a big thank you to Even for his hard work here!
> 
> Seconded!
> 
> Now that the PR has been merged, is the plan to release a 3.0.5 version of
> GDAL in time to be included in the QGIS 3.10.5 / 3.12.2 release (scheduled
> for 17th April according to the roadmap)? Or would this end up in the GDAL
> 3.1.0 release (I saw something saying that this might be around the 27th of
> April), which would push this back to the next next QGIS point-release
> (i.e. QGIS 3.10.6) in May?

This PR is for GDAL 3.1.0 only. I'm not completely sure it would be appropriate for the 3.0 
branch at this time of its lifetime.
3.1.0 is likely to be released before any other point release of 3.0, if there are any.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200403/39012f0f/attachment.html>

From r.l.morley82 at gmail.com  Sun Apr  5 05:47:27 2020
From: r.l.morley82 at gmail.com (Richard)
Date: Sun, 5 Apr 2020 12:47:27 +0000
Subject: [gdal-dev] Polygonize output inverted
Message-ID: <CWLP265MB2225A7948B017A1106A32C2DF8C50@CWLP265MB2225.GBRP265.PROD.OUTLOOK.COM>



Hi there,

I’m having an issue trying to use the GDAL Polygonize feature in QGIS.

My aim is to clip out or mask the background of some hyperspectral data of some diseased Cocoa leaves for my research masters project. My background up until this project with GIS has been fairly rudimentary GUI use of ArcGIS and QGIS.

My attempted workflow involves using a k-means classifier to classify the HSI raster files, then convert to vector to edit out background and use result to clip out or mask the background of my HSI data. However, when I run GDAL Polygonize the output is inverted above the input raster.

I’ve tried adding a coordinate projection to the input raster data prior to converting, but this didn’t work.

The input file info is:

CRS
EPSG:4326 - WGS 84 - Geographic
Extent
0.0000000000000000,-696.0000000000000000 : 520.0000000000000000,0.0000000000000000
Unit
degrees
Width
520
Height
696
Data type
Byte - Eight bit unsigned integer
GDAL Driver
GTiff

And the output is:


Storage

ESRI Shapefile

Comment

Encoding

macintosh

Geometry

Polygon (MultiPolygon)

CRS

EPSG:4326 - WGS 84 - Geographic

Extent

0.0000000000000000,0.0000000000000000 : 520.0000000000000000,696.0000000000000000

Unit

degrees

Feature count

761

The log from processing reads:


2020-04-05T13:21:51     INFO    gdal_polygonize.py /Users/user/Documents/qgis_test/kmns/c1a_kmns.tif /Users/user/Documents/qgis_test/c1a_vctr.shp -b 1 -f "ESRI Shapefile" c1a_vctr Class
2020-04-05T13:21:51     INFO    GDAL execution console output
             0...10...20...30...40...50...60...70...80...90...Creating output /Users/user/Documents/qgis_test/c1a_vctr.shp of format ESRI Shapefile.

             100 - done.

I’ve read a few forum posts on some similar issues, but solutions seem aimed at raster projections. It’s clear the extents are inversed, but I can’t figure out how to change them.

Any input would be gratefully received,

Richard


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200405/b3ff790d/attachment.html>

From popovictamara91 at hotmail.com  Mon Apr  6 01:11:02 2020
From: popovictamara91 at hotmail.com (popovictamara)
Date: Mon, 6 Apr 2020 01:11:02 -0700 (MST)
Subject: [gdal-dev] Using GDAL OGR for .NET in AutoCAD bug
Message-ID: <1586160662335-0.post@n6.nabble.com>

Hi,

I am using GDAL OGR .NET wrappers in my AutoCAD Civil 3D Plugin. I use it to
read datasource and convert it to AutoCAD entities. But after I use it, i
get errors in AutoCAD. Some native AutoCAD commands seem to be gone, like
MPolygon or APPLOAD. When I try to use them AutoCAD returns Unknown command
error. And this happens right after i use these three lines of code:

     [CommandMethod("GDALConfigure")]
        public static void ConfigureGDALOGR()
        {
            GdalConfiguration.ConfigureGdal();
            GdalConfiguration.ConfigureOgr();

            Ogr.RegisterAll();
        }

After I call this command in Civil 3D, he starts to act very stange. I
should also mention that this only happens in Civil 3D, on plain AutoCAD and
AutoCAD Map 3D everything is fine. It seems like OGR dll-s conflict with
some internal Civil 3D stuff. I would appreciate any suggestions on dealing
with this problem, since I wouldn't like to give up using OGR for
reading/writing vector data. I find  it very practical.

Best regards,
Tamara Popovic



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From xbartolone at gmail.com  Tue Apr  7 02:19:56 2020
From: xbartolone at gmail.com (Francesco Bartoli)
Date: Tue, 7 Apr 2020 11:19:56 +0200
Subject: [gdal-dev] Failure to fetch covid-19 data from JHU ArcGIS instance
In-Reply-To: <80876a90-a18c-47b3-8575-e7325ad038f2@Spark>
References: <80876a90-a18c-47b3-8575-e7325ad038f2@Spark>
Message-ID: <00aa2d72-874b-4326-96ba-c1b389e1520d@Spark>

Hello devs,

while the command line is working properly:

ogrinfo -ro -al "ESRIJSON:https://services1.arcgis.com/0MSEUqKaxRlEPj5g/arcgis/rest/services/ncov_cases/FeatureServer/2/query?where=objectid+%3D+objectid&f=json&outFields=*"

this python script below unexpectedly fails:

from osgeo import ogr
driver = ogr.GetDriverByName(‘ESRIJSON’)
ds = driver.Open('https://services1.arcgis.com/0MSEUqKaxRlEPj5g/arcgis/rest/services/ncov_cases/FeatureServer/2/query?where=objectid+%3D+objectid&f=json&outFields=*')

ERROR 1: Invalid Feature object. Missing ‘geometry’ member.
ERROR 1: Invalid Feature object. Missing ‘geometry’ member.

GDAL version is 3.0.4 and python 3.7.6

Do you have any hints?

Thanks,
Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200407/8854c058/attachment.html>

From even.rouault at spatialys.com  Tue Apr  7 03:29:57 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 07 Apr 2020 12:29:57 +0200
Subject: [gdal-dev] Failure to fetch covid-19 data from JHU ArcGIS
	instance
In-Reply-To: <00aa2d72-874b-4326-96ba-c1b389e1520d@Spark>
References: <80876a90-a18c-47b3-8575-e7325ad038f2@Spark>
 <00aa2d72-874b-4326-96ba-c1b389e1520d@Spark>
Message-ID: <2026766.a87TmCsvxC@even-i700>

On mardi 7 avril 2020 11:19:56 CEST Francesco Bartoli wrote:
> Hello devs,
> 
> while the command line is working properly:
> 
> ogrinfo -ro -al
> "ESRIJSON:https://services1.arcgis.com/0MSEUqKaxRlEPj5g/arcgis/rest/service
> s/ncov_cases/FeatureServer/2/query?where=objectid+%3D+objectid&f=json&outFie
> lds=*"
> 
> this python script below unexpectedly fails:
> 
> from osgeo import ogr
> driver = ogr.GetDriverByName(‘ESRIJSON’)
> ds =
> driver.Open('https://services1.arcgis.com/0MSEUqKaxRlEPj5g/arcgis/rest/serv
> ices/ncov_cases/FeatureServer/2/query?where=objectid+%3D+objectid&f=json&out
> Fields=*')
> 
> ERROR 1: Invalid Feature object. Missing ‘geometry’ member.
> ERROR 1: Invalid Feature object. Missing ‘geometry’ member.
> 
> GDAL version is 3.0.4 and python 3.7.6
> 
> Do you have any hints?

This was due to 2 features not having a geometry member as indicated in the error message. 
This is illegal in GeoJSON, but apparently legal in ESRIJSon. I've just pushed a fix to avoid this 
error message and return a feature without geometry.
With the current versions, you should still be able to process the dataset. Just those features 
will be skipped.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200407/6e43585b/attachment.html>

From xbartolone at gmail.com  Tue Apr  7 03:54:09 2020
From: xbartolone at gmail.com (Francesco Bartoli)
Date: Tue, 7 Apr 2020 12:54:09 +0200
Subject: [gdal-dev] Failure to fetch covid-19 data from JHU ArcGIS
 instance
In-Reply-To: <2026766.a87TmCsvxC@even-i700>
References: <80876a90-a18c-47b3-8575-e7325ad038f2@Spark>
 <00aa2d72-874b-4326-96ba-c1b389e1520d@Spark>
 <2026766.a87TmCsvxC@even-i700>
Message-ID: <87588848-e922-4c7d-9e9b-262764b393d3@Spark>

Thanks Even, I’ll skip them as well in the OGR provider for pygeoapi.

Thanks,
Francesco
Il 7 apr 2020, 12:29 +0200, Even Rouault <even.rouault at spatialys.com>, ha scritto:
> On mardi 7 avril 2020 11:19:56 CEST Francesco Bartoli wrote:
> > Hello devs,
> >
> > while the command line is working properly:
> >
> > ogrinfo -ro -al
> > "ESRIJSON:https://services1.arcgis.com/0MSEUqKaxRlEPj5g/arcgis/rest/service
> > s/ncov_cases/FeatureServer/2/query?where=objectid+%3D+objectid&f=json&outFie
> > lds=*"
> >
> > this python script below unexpectedly fails:
> >
> > from osgeo import ogr
> > driver = ogr.GetDriverByName(‘ESRIJSON’)
> > ds =
> > driver.Open('https://services1.arcgis.com/0MSEUqKaxRlEPj5g/arcgis/rest/serv
> > ices/ncov_cases/FeatureServer/2/query?where=objectid+%3D+objectid&f=json&out
> > Fields=*')
> >
> > ERROR 1: Invalid Feature object. Missing ‘geometry’ member.
> > ERROR 1: Invalid Feature object. Missing ‘geometry’ member.
> >
> > GDAL version is 3.0.4 and python 3.7.6
> >
> > Do you have any hints?
> This was due to 2 features not having a geometry member as indicated in the error message. This is illegal in GeoJSON, but apparently legal in ESRIJSon. I've just pushed a fix to avoid this error message and return a feature without geometry.
> With the current versions, you should still be able to process the dataset. Just those features will be skipped.
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200407/7f6cfaff/attachment.html>

From Maja.Miljak at avl.com  Tue Apr  7 05:25:54 2020
From: Maja.Miljak at avl.com (Miljak, Maja AVL/HR)
Date: Tue, 7 Apr 2020 12:25:54 +0000
Subject: [gdal-dev] question about the upgrade of xerces and expat
Message-ID: <e1bc148b79bc46a59a74699ab7a776dc@avl.com>

Hi,

is there in plan to upgrade to new versions of xerces (3.2.2) and expat (2.2.9) libraries soon?
GDAL 3.0.4 version contains, for example, expat version 2.0.1 and in the meantime various changes and security fixes happened (link to the release notes: https://libexpat.github.io/<https://urldefense.com/v3/__https:/libexpat.github.io/__;!!Oq50-tQ!74aCLByjjiJ8KhRN2vEAwqyJa8lS-WqQv-fEX2RG3hd2SDxLMaYDs6EtSYH61GN2$>). Also for xerces.

BR,
Maja

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200407/22961473/attachment-0001.html>

From even.rouault at spatialys.com  Tue Apr  7 06:06:47 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 07 Apr 2020 15:06:47 +0200
Subject: [gdal-dev] question about the upgrade of xerces and expat
In-Reply-To: <e1bc148b79bc46a59a74699ab7a776dc@avl.com>
References: <e1bc148b79bc46a59a74699ab7a776dc@avl.com>
Message-ID: <1923899.dphhz1cesA@even-i700>

Maja,

> is there in plan to upgrade to new versions of xerces (3.2.2) and expat
> (2.2.9) libraries soon? GDAL 3.0.4 version contains, for example, expat
> version 2.0.1 and in the meantime various changes and security fixes
> happened (link to the release notes:

GDAL, as a source distribution, doesn't contain xerces or expat. Those may be 
provided by binary builds, so you must report that to whoever provides those 
builds to you.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200407/583a2625/attachment.html>

From lucadeluge at gmail.com  Tue Apr  7 20:51:54 2020
From: lucadeluge at gmail.com (Luca Delucchi)
Date: Wed, 8 Apr 2020 05:51:54 +0200
Subject: [gdal-dev] ogr2ogr Too many recursion levels in expression
In-Reply-To: <1918862.tlddxRII5G@even-i700>
References: <CAK4m-3yiMRg6H3=nvjPTpeN=b3K+MZEXkCTQGJW7B2sWMrJ9_Q@mail.gmail.com>
 <1918862.tlddxRII5G@even-i700>
Message-ID: <CAK4m-3wpbF2JFuEddOY_t9Vyi55AVQxxgEJ=LxJsn4Xg49mVbw@mail.gmail.com>

On Fri, 27 Mar 2020 at 13:17, Even Rouault <even.rouault at spatialys.com> wrote:
>
> Luca,
>

Hi Even,

>
> NUTS_NAME IN ('Nordburgenland', 'Waldviertel', ... )
>

this is working, thanks
>
>
> I've also submitted a fix so that those many OR can be supported:
>
> https://github.com/OSGeo/gdal/pull/2355
>

thanks!

>
> Even
>

-- 
ciao
Luca

www.lucadelu.org

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr  8 07:06:30 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 8 Apr 2020 14:06:30 +0000
Subject: [gdal-dev] How to get a file list from a Sentinel zip?
Message-ID: <a1aef2cd7f674804b814ce4ba4b5102a@C119S212VM042.msvyvi.vaha.local>

Hi,

I am investigating this dataset https://scihub.copernicus.eu/dhus/odata/v1/Products('456d05ea-835f-4e6c-b957-751c155252a1')/%24value
download with test/test (890 MB)

There seems to be some automagic logic that recognizes that the zip is a Sentinel zip

gdalinfo S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip
...
Subdatasets:
  SUBDATASET_1_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634
  SUBDATASET_1_DESC=Bands B2, B3, B4, B8 with 10m resolution, UTM 34N
  SUBDATASET_2_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:20m:EPSG_32634
  SUBDATASET_2_DESC=Bands B5, B6, B7, B8A, B11, B12 with 20m resolution, UTM 34N
  SUBDATASET_3_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:60m:EPSG_32634
  SUBDATASET_3_DESC=Bands B1, B9 with 60m resolution, UTM 34N
  SUBDATASET_4_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:TCI:EPSG_32634
  SUBDATASET_4_DESC=True color image, UTM 34N

However, the zip file contains also vector data in gml format. Those files gets hidden by the Sentinel auto-recognizing system but if I rename the zip file into "test.zip" I can get the file list.

gdalinfo /vsizip/test.zip
ERROR 4: `/vsizip/test.zip' not recognized as a supported file format.
gdalinfo failed - unable to open '/vsizip/test.zip'.
Unable to open source `/vsizip/test.zip' directly.
The archive contains 146 files:
       /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/
. . .
/vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml

Now I can read the gml file with ogrinfo
ogrinfo /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml

and the command also works also with the original name of the zip S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip.

Two questions:

  *   How to read the full file list of a zip file that follows the structure and naming convention of Sentinel zips without using the rename trick?
  *   I must read the file list with gdalinfo because ogrinfo does not work with this kind of zip with subdirectories


ogrinfo /vsizip/test.zip
FAILURE:
Unable to open datasource `/vsizip/test.zip' with the following drivers.

Is this worth making a feature request or is there some good reason why ogrinfo cannot read the file list from zip while gdalinfo can?

-Jukka Rahkonen-



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200408/0f7b8cb6/attachment.html>

From even.rouault at spatialys.com  Wed Apr  8 07:24:18 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 08 Apr 2020 16:24:18 +0200
Subject: [gdal-dev] How to get a file list from a Sentinel zip?
In-Reply-To: <a1aef2cd7f674804b814ce4ba4b5102a@C119S212VM042.msvyvi.vaha.local>
References: <a1aef2cd7f674804b814ce4ba4b5102a@C119S212VM042.msvyvi.vaha.local>
Message-ID: <3377914.rCyEBrqixR@even-i700>

Jukka,

> ogrinfo /vsizip/test.zip
> FAILURE:
> Unable to open datasource `/vsizip/test.zip' with the following drivers.
> 
> Is this worth making a feature request or is there some good reason why
> ogrinfo cannot read the file list from zip while gdalinfo can?

That /vsizip/ reports the file list when opening a .zip as a file is mostly a
questionable convenience.

For what you want to do, a simple "unzip -l the.zip" will do the job just fine.
If you want to stay in GDAL world, the following will also do:

python gdal_ls.py -r /vsizip/the.zip

with gdal_ls.py at
https://raw.githubusercontent.com/OSGeo/gdal/master/gdal/swig/python/samples/gdal_ls.py

This is mostly useful for remote zips, where you would access a /vsizip//vsicurl/.... , to
avoid downloading them.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200408/708a8e1f/attachment.html>

From ivan.lucena at outlook.com  Wed Apr  8 07:24:25 2020
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Wed, 8 Apr 2020 14:24:25 +0000
Subject: [gdal-dev] How to get a file list from a Sentinel zip?
In-Reply-To: <a1aef2cd7f674804b814ce4ba4b5102a@C119S212VM042.msvyvi.vaha.local>
References: <a1aef2cd7f674804b814ce4ba4b5102a@C119S212VM042.msvyvi.vaha.local>
Message-ID: <MN2PR04MB5693308386A477C3E0EC2EA2F2C00@MN2PR04MB5693.namprd04.prod.outlook.com>

Jukka,

> gdalinfo S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip

> ...if I rename the zip file into “test.zip” I can get the file list.

> gdalinfo /vsizip/test.zip

You did more than renaming the file, you also added /vsizip/ but it might be a typo while editing the e-mail.

What do you get from:

gdalinfo /vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip

or the SUBDATASET_N_NAME contents you showed:

gdalinfo /vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634

?

I hope it helps,

Ivan

________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Sent: Wednesday, April 8, 2020 10:06 AM
To: 'gdal-dev at lists.osgeo.org' <gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] How to get a file list from a Sentinel zip?


Hi,



I am investigating this dataset https://scihub.copernicus.eu/dhus/odata/v1/Products('456d05ea-835f-4e6c-b957-751c155252a1')/%24value
download with test/test (890 MB)



There seems to be some automagic logic that recognizes that the zip is a Sentinel zip



gdalinfo S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip

…

Subdatasets:

  SUBDATASET_1_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634

  SUBDATASET_1_DESC=Bands B2, B3, B4, B8 with 10m resolution, UTM 34N

  SUBDATASET_2_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:20m:EPSG_32634

  SUBDATASET_2_DESC=Bands B5, B6, B7, B8A, B11, B12 with 20m resolution, UTM 34N

  SUBDATASET_3_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:60m:EPSG_32634

  SUBDATASET_3_DESC=Bands B1, B9 with 60m resolution, UTM 34N

  SUBDATASET_4_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:TCI:EPSG_32634

  SUBDATASET_4_DESC=True color image, UTM 34N



However, the zip file contains also vector data in gml format. Those files gets hidden by the Sentinel auto-recognizing system but if I rename the zip file into “test.zip” I can get the file list.



gdalinfo /vsizip/test.zip

ERROR 4: `/vsizip/test.zip' not recognized as a supported file format.

gdalinfo failed - unable to open '/vsizip/test.zip'.

Unable to open source `/vsizip/test.zip' directly.

The archive contains 146 files:

       /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/

. . .

/vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml



Now I can read the gml file with ogrinfo

ogrinfo /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml



and the command also works also with the original name of the zip S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip.



Two questions:

  *   How to read the full file list of a zip file that follows the structure and naming convention of Sentinel zips without using the rename trick?
  *   I must read the file list with gdalinfo because ogrinfo does not work with this kind of zip with subdirectories



ogrinfo /vsizip/test.zip

FAILURE:

Unable to open datasource `/vsizip/test.zip' with the following drivers.



Is this worth making a feature request or is there some good reason why ogrinfo cannot read the file list from zip while gdalinfo can?



-Jukka Rahkonen-






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200408/997013ac/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr  8 09:52:26 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 8 Apr 2020 16:52:26 +0000
Subject: [gdal-dev] How to get a file list from a Sentinel zip?
Message-ID: <6eeed9240fd342a193bc3f51f71c858a@C119S212VM042.msvyvi.vaha.local>



Ivan Lucena <ivan.lucena at outlook.com>  wrote:

> Jukka,

>> gdalinfo S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip
>>
>> ...if I rename the zip file into "test.zip" I can get the file list.
>> gdalinfo /vsizip/test.zip

>You did more than renaming the file, you also added /vsizip/ but it might be a typo while editing the e-mail.
No, it was not a typo but I did not mention that when the name of the zip file does not match the Sentinel autorecognition then using /vsizip/ is necessary or otherwise happens this:

gdalinfo test.zip
ERROR 4: `test.zip' not recognized as a supported file format.
gdalinfo failed - unable to open 'test.zip'.

>What do you get from:

>gdalinfo /vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip
This command returns the list of Sentinel raster subdatasets and the result is the same than by running gdalinfo /vsizip/

> or the SUBDATASET_N_NAME contents you showed:

>gdalinfo /vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634

The name of the subdataset is actually longer and contains also prefix "SENTINEL2_L2A:" as gdalinfo also reports it. Gdalinfo about the subdataset works as it is supposed to work with command

gdalinfo SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634

What I was interested in is not the Sentinel rasters but the vector data from the Quality Indicator (QI) directory: cloud mask vectors and defective pixels mask. I can find them by listing the files from the archive with some zip utility like 7-zip on Windows. Someone who really works with Sentinel data would probably appreciate some convenient method for finding at least all the cloud masks but I am just curious because I saw this question in gis.stackexchange https://gis.stackexchange.com/questions/357540/how-to-use-gdal-vsizip-to-access-gml-files-from-sentinel-2-zip-package/357589.


-Jukka-

>I hope it helps,


>Ivan


________________________________________
From: gdal-dev <mailto:gdal-dev-bounces at lists.osgeo.org> on behalf of Rahkonen Jukka (MML) <mailto:jukka.rahkonen at maanmittauslaitos.fi>
Sent: Wednesday, April 8, 2020 10:06 AM
To: 'gdal-dev at lists.osgeo.org' <mailto:gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] How to get a file list from a Sentinel zip? 
 
Hi,
 
I am investigating this dataset https://scihub.copernicus.eu/dhus/odata/v1/Products('456d05ea-835f-4e6c-b957-751c155252a1')/%24value
download with test/test (890 MB)
 
There seems to be some automagic logic that recognizes that the zip is a Sentinel zip
 
gdalinfo S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip
.
Subdatasets:
  SUBDATASET_1_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634
  SUBDATASET_1_DESC=Bands B2, B3, B4, B8 with 10m resolution, UTM 34N
  SUBDATASET_2_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:20m:EPSG_32634
  SUBDATASET_2_DESC=Bands B5, B6, B7, B8A, B11, B12 with 20m resolution, UTM 34N
  SUBDATASET_3_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:60m:EPSG_32634
  SUBDATASET_3_DESC=Bands B1, B9 with 60m resolution, UTM 34N
  SUBDATASET_4_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:TCI:EPSG_32634
  SUBDATASET_4_DESC=True color image, UTM 34N
 
However, the zip file contains also vector data in gml format. Those files gets hidden by the Sentinel auto-recognizing system but if I rename the zip file into "test.zip" I can get the file list.
 
gdalinfo /vsizip/test.zip
ERROR 4: `/vsizip/test.zip' not recognized as a supported file format.
gdalinfo failed - unable to open '/vsizip/test.zip'.
Unable to open source `/vsizip/test.zip' directly.
The archive contains 146 files:
       /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/
. . .
/vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml
 
Now I can read the gml file with ogrinfo
ogrinfo /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml
 
and the command also works also with the original name of the zip S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip.
 
Two questions:
. How to read the full file list of a zip file that follows the structure and naming convention of Sentinel zips without using the rename trick?
. I must read the file list with gdalinfo because ogrinfo does not work with this kind of zip with subdirectories
 
ogrinfo /vsizip/test.zip
FAILURE:
Unable to open datasource `/vsizip/test.zip' with the following drivers.
 
Is this worth making a feature request or is there some good reason why ogrinfo cannot read the file list from zip while gdalinfo can?
 
-Jukka Rahkonen-
 
 
 

From ivan.lucena at outlook.com  Wed Apr  8 11:56:21 2020
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Wed, 8 Apr 2020 18:56:21 +0000
Subject: [gdal-dev] How to get a file list from a Sentinel zip?
In-Reply-To: <6eeed9240fd342a193bc3f51f71c858a@C119S212VM042.msvyvi.vaha.local>
References: <6eeed9240fd342a193bc3f51f71c858a@C119S212VM042.msvyvi.vaha.local>
Message-ID: <MN2PR04MB5693E1F847F10D07ABC1C903F2C00@MN2PR04MB5693.namprd04.prod.outlook.com>

Hi Jukka,

I hit "Send" before knowing that Even had replied you.

Ivan


________________________________
From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Sent: Wednesday, April 8, 2020 12:52 PM
To: Ivan Lucena <ivan.lucena at outlook.com>; 'gdal-dev at lists.osgeo.org' <gdal-dev at lists.osgeo.org>
Subject: Re: How to get a file list from a Sentinel zip?



Ivan Lucena <ivan.lucena at outlook.com>  wrote:

> Jukka,

>> gdalinfo S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip
>>
>> ...if I rename the zip file into "test.zip" I can get the file list.
>> gdalinfo /vsizip/test.zip

>You did more than renaming the file, you also added /vsizip/ but it might be a typo while editing the e-mail.
No, it was not a typo but I did not mention that when the name of the zip file does not match the Sentinel autorecognition then using /vsizip/ is necessary or otherwise happens this:

gdalinfo test.zip
ERROR 4: `test.zip' not recognized as a supported file format.
gdalinfo failed - unable to open 'test.zip'.

>What do you get from:

>gdalinfo /vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip
This command returns the list of Sentinel raster subdatasets and the result is the same than by running gdalinfo /vsizip/

> or the SUBDATASET_N_NAME contents you showed:

>gdalinfo /vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634

The name of the subdataset is actually longer and contains also prefix "SENTINEL2_L2A:" as gdalinfo also reports it. Gdalinfo about the subdataset works as it is supposed to work with command

gdalinfo SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634

What I was interested in is not the Sentinel rasters but the vector data from the Quality Indicator (QI) directory: cloud mask vectors and defective pixels mask. I can find them by listing the files from the archive with some zip utility like 7-zip on Windows. Someone who really works with Sentinel data would probably appreciate some convenient method for finding at least all the cloud masks but I am just curious because I saw this question in gis.stackexchange https://gis.stackexchange.com/questions/357540/how-to-use-gdal-vsizip-to-access-gml-files-from-sentinel-2-zip-package/357589.


-Jukka-

>I hope it helps,


>Ivan


________________________________________
From: gdal-dev <mailto:gdal-dev-bounces at lists.osgeo.org> on behalf of Rahkonen Jukka (MML) <mailto:jukka.rahkonen at maanmittauslaitos.fi>
Sent: Wednesday, April 8, 2020 10:06 AM
To: 'gdal-dev at lists.osgeo.org' <mailto:gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] How to get a file list from a Sentinel zip?

Hi,

I am investigating this dataset https://scihub.copernicus.eu/dhus/odata/v1/Products('456d05ea-835f-4e6c-b957-751c155252a1')/%24value
download with test/test (890 MB)

There seems to be some automagic logic that recognizes that the zip is a Sentinel zip

gdalinfo S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip
.
Subdatasets:
  SUBDATASET_1_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:10m:EPSG_32634
  SUBDATASET_1_DESC=Bands B2, B3, B4, B8 with 10m resolution, UTM 34N
  SUBDATASET_2_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:20m:EPSG_32634
  SUBDATASET_2_DESC=Bands B5, B6, B7, B8A, B11, B12 with 20m resolution, UTM 34N
  SUBDATASET_3_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:60m:EPSG_32634
  SUBDATASET_3_DESC=Bands B1, B9 with 60m resolution, UTM 34N
  SUBDATASET_4_NAME=SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/MTD_MSIL2A.xml:TCI:EPSG_32634
  SUBDATASET_4_DESC=True color image, UTM 34N

However, the zip file contains also vector data in gml format. Those files gets hidden by the Sentinel auto-recognizing system but if I rename the zip file into "test.zip" I can get the file list.

gdalinfo /vsizip/test.zip
ERROR 4: `/vsizip/test.zip' not recognized as a supported file format.
gdalinfo failed - unable to open '/vsizip/test.zip'.
Unable to open source `/vsizip/test.zip' directly.
The archive contains 146 files:
       /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/
. . .
/vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml

Now I can read the gml file with ogrinfo
ogrinfo /vsizip/test.zip/S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.SAFE/GRANULE/L2A_T34TFS_A024972_20200403T092024/QI_DATA/MSK_TECQUA_B02.gml

and the command also works also with the original name of the zip S2A_MSIL2A_20200403T092021_N0214_R093_T34TFS_20200403T114409.zip.

Two questions:
. How to read the full file list of a zip file that follows the structure and naming convention of Sentinel zips without using the rename trick?
. I must read the file list with gdalinfo because ogrinfo does not work with this kind of zip with subdirectories

ogrinfo /vsizip/test.zip
FAILURE:
Unable to open datasource `/vsizip/test.zip' with the following drivers.

Is this worth making a feature request or is there some good reason why ogrinfo cannot read the file list from zip while gdalinfo can?

-Jukka Rahkonen-



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200408/207c621c/attachment.html>

From eduardo.kanegae at gmail.com  Wed Apr  8 13:07:29 2020
From: eduardo.kanegae at gmail.com (Eduardo Kanegae)
Date: Wed, 8 Apr 2020 17:07:29 -0300
Subject: [gdal-dev] gdal2tiles.py generating tiles not the same way WMS
	Leaflet does
Message-ID: <CAF_a5SJQ=Gp+Jgrqp_vt1dw23LEckDU8g7seTsHpjvob99m72g@mail.gmail.com>

hi there,

I'm running MapServer 7.0.6 on CentOS 6.10 and GDAL 2.2.1

*https://drive.google.com/drive/folders/1PumcXf4wNcwpV_XmvjVuH5IZrgfMiNxl
- reference images

I've created a MapServer WMS service which deploys (EPSG:3857) fine
when using Leaflet 1.6.0 WMS layer using tiled option

*image 01-wmsTiles-level10.png - my leaflet application rendering the
tile WMS url. Level 10. Red lines were put for debuging purposes using
CSS
*image 02-osmTiles-level10.png - same application view but choosing
OpenStreetMap background
*image 03-gdalTiles-level10.png - the same view, level 10, of
generated http://myserver/tilelayers/mylayer/leaflet.html application.
Which seams so different of image 01. Sounds like is generating level
12 then stretching things to level 10
*image 04-osmTiles-level10.png - same leaflet.html application and
view, but choosing OSM as background

Here's my XML wms file definition for GDAL:

<GDAL_WMS>
<Service name="WMS">
        <Version>1.1.1</Version>
        <ServerUrl>http://myserver/mywmsservice?</ServerUrl>
        <SRS>EPSG:3857</SRS>
        <ImageFormat>image/png</ImageFormat>
        <Transparent>TRUE</Transparent>
        <Layers>basemap</Layers>
</Service>
<DataWindow>
        <UpperLeftX>-5291861.4255343209952116</UpperLeftX>
        <UpperLeftY>-2562821.3254362149164081</UpperLeftY>
        <LowerRightX>-5194657.2461736341938376</LowerRightX>
        <LowerRightY>-2660014.5294833723455667</LowerRightY>
        <TileLevel>10</TileLevel>
</DataWindow>
 <BandsCount>4</BandsCount>
 <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
</GDAL_WMS>
*DataWindow extent values from *Layer / Properties / Information*
option of QGIS 3.4.15, accessing the same WMS url

 - gdal command I'm using is:

gdal2tiles.py -e -s EPSG:3857 -z 10 -v  -u
"http://myserver/tilelayers/mylayer/" -w leaflet -t "mylayer"
myxmlfile.xml "/var/www/html/tilelayers/mytmslayer/"

Thanks in advance for any help.

Eduardo Patto Kanegae
http://www.webmapit.com.br | @webmapit

From ivan.lucena at outlook.com  Wed Apr  8 15:24:14 2020
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Wed, 8 Apr 2020 22:24:14 +0000
Subject: [gdal-dev] vsicurl and HTTP error 403
Message-ID: <MN2PR04MB5693BA0A52A5F50103A41D42F2C00@MN2PR04MB5693.namprd04.prod.outlook.com>

Hi,

I am wondering if someone can help to point what I am doing wrong here.

This is data that I am trying to access:

$ gdalinfo /vsicurl/https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz
ERROR 11: HTTP response code: 403
gdalinfo failed - unable to open '/vsicurl/https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz'.

If the error 403 means permission issue, why is that I can download from a browser or using wget

$ wget https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz
$ gdalinfo /vsigzip//GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz

That makes me thinking that I should concatenating the two drivers vsigzip and vsicurl, but that doesn't help probably because I still have the permission issue.

$ gdalinfo /vsigzip//vsicurl/https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz
ERROR 4: `/vsigzip//vsicurl/https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz' does not exist in the file system, and is not recognized as a supported dataset name.
gdalinfo failed - unable to open '/vsigzip//vsicurl/https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz'.

I am using GDAL 2.3.3 on Windows, GDAL 2.3.3 Linux and GDAL 2.4.4 on Mac.

Any suggestion?

Thanks,

Ivan






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200408/5b1141ff/attachment.html>

From even.rouault at spatialys.com  Wed Apr  8 15:41:18 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 09 Apr 2020 00:41:18 +0200
Subject: [gdal-dev] vsicurl and HTTP error 403
In-Reply-To: <MN2PR04MB5693BA0A52A5F50103A41D42F2C00@MN2PR04MB5693.namprd04.prod.outlook.com>
References: <MN2PR04MB5693BA0A52A5F50103A41D42F2C00@MN2PR04MB5693.namprd04.prod.outlook.com>
Message-ID: <2626177.NupK7EfKfQ@even-i700>

Ivan,

Experimentally, I find that this particular server doesn't like HTTP requests without a
User-Agent and, more annoying, that it doesn't like Range requests used by /vsicurl/.
But as this a gzip file, seeking into it would be a inefficient process.

So the following, defining a user agent, and using /vsicurl_streaming/ that doesn't
issue range request (but require downloading everything from the beginning when
a backward seek is needed) works
gdal_translate /vsigzip//vsicurl_streaming/https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config GDAL_HTTP_USERAGENT foo

But local downloading of the file is probably a better strategy here.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200409/0532f9a6/attachment.html>

From ari.jolma at gmail.com  Thu Apr  9 01:53:24 2020
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 9 Apr 2020 11:53:24 +0300
Subject: [gdal-dev] GPKG to PostgreSQL, version 2.2.3 vs version 3.0.2
Message-ID: <1143a564-87bd-5d28-62cc-5a5f8791ad7e@gmail.com>

I have this command

ogr2ogr -update -append -f PostgreSQL PG:... merged.gpkg

which works ok in version 3.0.2 (self-compiled) but not in 2.2.3 (from 
ubuntu apt). The error is

ERROR: duplicate key value violates unique constraint "stand_pkey"
DETAIL: Key (id)=(1) already exists.
CONTEXT: COPY stand, line 1
STATEMENT: COPY "stand" ("wkb_geometry", "standid", "parcelid", 
"realestateid", "standnumber", "standnumberextension", "maingroup", 
"subgroup", "fertilityclass", "soiltype", "drainagestate", 
"ditchingyear", "thinningyear", "developmentclass", "standquality", 
"maintreespecies", "accessibility", "standinfo", "datasource", 
"growthplacedatasource", "area", "areadecrease", "creationtime", 
"updatetime") FROM STDIN;

The issue is that "stand_pkey" is "CONSTRAINT stand_pkey PRIMARY KEY 
(id)" made by the

ogr2ogr -overwrite -f PostgreSQL PG:... merged.gpkg

earlier. So it shouldn't be in the COPY data at all (the log does not 
show whether it is there) or there is something wrong with the sequence.

Is there a way to make it work in the older version?

Ari



From ivan.lucena at outlook.com  Thu Apr  9 04:52:44 2020
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Thu, 9 Apr 2020 11:52:44 +0000
Subject: [gdal-dev] vsicurl and HTTP error 403
In-Reply-To: <2626177.NupK7EfKfQ@even-i700>
References: <MN2PR04MB5693BA0A52A5F50103A41D42F2C00@MN2PR04MB5693.namprd04.prod.outlook.com>,
 <2626177.NupK7EfKfQ@even-i700>
Message-ID: <MN2PR04MB56935BBAD07EE36523D742B4F2C10@MN2PR04MB5693.namprd04.prod.outlook.com>

Even,

You are right. I wouldn't use the double /vsi in gdal_translate. It just happened that I found a corrupted file on tile x33y13 date 2013/249 and I wanted to know if I could pass the gdalinfo command to other people. I will download same sample files, run gdalinfo on my machine and  copy and paste the gdalinfo report.

Thanks man, you are the best. Take care,

Ivan

________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Wednesday, April 8, 2020 6:41 PM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Cc: Ivan Lucena <ivan.lucena at outlook.com>
Subject: Re: [gdal-dev] vsicurl and HTTP error 403


Ivan,



Experimentally, I find that this particular server doesn't like HTTP requests without a

User-Agent and, more annoying, that it doesn't like Range requests used by /vsicurl/.

But as this a gzip file, seeking into it would be a inefficient process.



So the following, defining a user agent, and using /vsicurl_streaming/ that doesn't

issue range request (but require downloading everything from the beginning when

a backward seek is needed) works

gdal_translate /vsigzip//vsicurl_streaming/https://gimms.gsfc.nasa.gov/MODIS/std/GMOD09Q1/tif/NDVI/2019/249/GMOD09Q1.A2019249.08d.latlon.x33y07.6v1.NDVI.tif.gz --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config GDAL_HTTP_USERAGENT foo



But local downloading of the file is probably a better strategy here.



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200409/608d49ad/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Apr  9 06:14:01 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 9 Apr 2020 06:14:01 -0700 (MST)
Subject: [gdal-dev] GPKG to PostgreSQL, version 2.2.3 vs version 3.0.2
In-Reply-To: <1143a564-87bd-5d28-62cc-5a5f8791ad7e@gmail.com>
References: <1143a564-87bd-5d28-62cc-5a5f8791ad7e@gmail.com>
Message-ID: <1586438041641-0.post@n6.nabble.com>

Hi,

I would have a try with -unsetfid. That should be the default when in append
mode but the test is easy.

-Jukka Rahkonen-


Ari Jolma-2 wrote
> I have this command
> 
> ogr2ogr -update -append -f PostgreSQL PG:... merged.gpkg
> 
> which works ok in version 3.0.2 (self-compiled) but not in 2.2.3 (from 
> ubuntu apt). The error is
> 
> ERROR: duplicate key value violates unique constraint "stand_pkey"
> DETAIL: Key (id)=(1) already exists.
> CONTEXT: COPY stand, line 1
> STATEMENT: COPY "stand" ("wkb_geometry", "standid", "parcelid", 
> "realestateid", "standnumber", "standnumberextension", "maingroup", 
> "subgroup", "fertilityclass", "soiltype", "drainagestate", 
> "ditchingyear", "thinningyear", "developmentclass", "standquality", 
> "maintreespecies", "accessibility", "standinfo", "datasource", 
> "growthplacedatasource", "area", "areadecrease", "creationtime", 
> "updatetime") FROM STDIN;
> 
> The issue is that "stand_pkey" is "CONSTRAINT stand_pkey PRIMARY KEY 
> (id)" made by the
> 
> ogr2ogr -overwrite -f PostgreSQL PG:... merged.gpkg
> 
> earlier. So it shouldn't be in the COPY data at all (the log does not 
> show whether it is there) or there is something wrong with the sequence.
> 
> Is there a way to make it work in the older version?
> 
> Ari
> 
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From ari.jolma at gmail.com  Thu Apr  9 07:23:23 2020
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 9 Apr 2020 17:23:23 +0300
Subject: [gdal-dev] GPKG to PostgreSQL, version 2.2.3 vs version 3.0.2
In-Reply-To: <1586438041641-0.post@n6.nabble.com>
References: <1143a564-87bd-5d28-62cc-5a5f8791ad7e@gmail.com>
 <1586438041641-0.post@n6.nabble.com>
Message-ID: <61ad543b-5449-973d-3dc9-ff85f9d3d4c5@gmail.com>

Same outcome.

There's something very strage going on as the max of the id is 305926 
(after creating the table with the first gpkg) but when I try to 
manually insert a row to the table it says "key id=39 already exists". 
If I then manually setval the sequence to 305926 I can add to the table.

So somehow the sequence is lagging behind.

Ari

jratike80 kirjoitti 9.4.2020 klo 16.14:
> Hi,
>
> I would have a try with -unsetfid. That should be the default when in append
> mode but the test is easy.
>
> -Jukka Rahkonen-
>
>
> Ari Jolma-2 wrote
>> I have this command
>>
>> ogr2ogr -update -append -f PostgreSQL PG:... merged.gpkg
>>
>> which works ok in version 3.0.2 (self-compiled) but not in 2.2.3 (from
>> ubuntu apt). The error is
>>
>> ERROR: duplicate key value violates unique constraint "stand_pkey"
>> DETAIL: Key (id)=(1) already exists.
>> CONTEXT: COPY stand, line 1
>> STATEMENT: COPY "stand" ("wkb_geometry", "standid", "parcelid",
>> "realestateid", "standnumber", "standnumberextension", "maingroup",
>> "subgroup", "fertilityclass", "soiltype", "drainagestate",
>> "ditchingyear", "thinningyear", "developmentclass", "standquality",
>> "maintreespecies", "accessibility", "standinfo", "datasource",
>> "growthplacedatasource", "area", "areadecrease", "creationtime",
>> "updatetime") FROM STDIN;
>>
>> The issue is that "stand_pkey" is "CONSTRAINT stand_pkey PRIMARY KEY
>> (id)" made by the
>>
>> ogr2ogr -overwrite -f PostgreSQL PG:... merged.gpkg
>>
>> earlier. So it shouldn't be in the COPY data at all (the log does not
>> show whether it is there) or there is something wrong with the sequence.
>>
>> Is there a way to make it work in the older version?
>>
>> Ari
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at .osgeo
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From ari.jolma at gmail.com  Thu Apr  9 23:54:37 2020
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 10 Apr 2020 09:54:37 +0300
Subject: [gdal-dev] GPKG to PostgreSQL, version 2.2.3 vs version 3.0.2
In-Reply-To: <61ad543b-5449-973d-3dc9-ff85f9d3d4c5@gmail.com>
References: <1143a564-87bd-5d28-62cc-5a5f8791ad7e@gmail.com>
 <1586438041641-0.post@n6.nabble.com>
 <61ad543b-5449-973d-3dc9-ff85f9d3d4c5@gmail.com>
Message-ID: <a01f8f7e-ac0a-7cd2-6eb6-15e3fc4bba5a@gmail.com>

Ari Jolma kirjoitti 9.4.2020 klo 17.23:
> Same outcome.
>
> There's something very strage going on as the max of the id is 305926 
> (after creating the table with the first gpkg) but when I try to 
> manually insert a row to the table it says "key id=39 already exists". 
> If I then manually setval the sequence to 305926 I can add to the table.
>
> So somehow the sequence is lagging behind.


This seems to be the case. v 3.0.2 sends

SELECT setval(pg_get_serial_sequence('"stand"', 'id'), MAX("id") FROM 
"stand";

and similar for other tables but v 2.2.3 does not.

Ari


>
> Ari
>
> jratike80 kirjoitti 9.4.2020 klo 16.14:
>> Hi,
>>
>> I would have a try with -unsetfid. That should be the default when in 
>> append
>> mode but the test is easy.
>>
>> -Jukka Rahkonen-
>>
>>
>> Ari Jolma-2 wrote
>>> I have this command
>>>
>>> ogr2ogr -update -append -f PostgreSQL PG:... merged.gpkg
>>>
>>> which works ok in version 3.0.2 (self-compiled) but not in 2.2.3 (from
>>> ubuntu apt). The error is
>>>
>>> ERROR: duplicate key value violates unique constraint "stand_pkey"
>>> DETAIL: Key (id)=(1) already exists.
>>> CONTEXT: COPY stand, line 1
>>> STATEMENT: COPY "stand" ("wkb_geometry", "standid", "parcelid",
>>> "realestateid", "standnumber", "standnumberextension", "maingroup",
>>> "subgroup", "fertilityclass", "soiltype", "drainagestate",
>>> "ditchingyear", "thinningyear", "developmentclass", "standquality",
>>> "maintreespecies", "accessibility", "standinfo", "datasource",
>>> "growthplacedatasource", "area", "areadecrease", "creationtime",
>>> "updatetime") FROM STDIN;
>>>
>>> The issue is that "stand_pkey" is "CONSTRAINT stand_pkey PRIMARY KEY
>>> (id)" made by the
>>>
>>> ogr2ogr -overwrite -f PostgreSQL PG:... merged.gpkg
>>>
>>> earlier. So it shouldn't be in the COPY data at all (the log does not
>>> show whether it is there) or there is something wrong with the 
>>> sequence.
>>>
>>> Is there a way to make it work in the older version?
>>>
>>> Ari
>>>
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at .osgeo
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>> -- 
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From ari.jolma at gmail.com  Fri Apr 10 00:07:20 2020
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 10 Apr 2020 10:07:20 +0300
Subject: [gdal-dev] GPKG to PostgreSQL, version 2.2.3 vs version 3.0.2
In-Reply-To: <a01f8f7e-ac0a-7cd2-6eb6-15e3fc4bba5a@gmail.com>
References: <1143a564-87bd-5d28-62cc-5a5f8791ad7e@gmail.com>
 <1586438041641-0.post@n6.nabble.com>
 <61ad543b-5449-973d-3dc9-ff85f9d3d4c5@gmail.com>
 <a01f8f7e-ac0a-7cd2-6eb6-15e3fc4bba5a@gmail.com>
Message-ID: <905207c6-438b-a70b-5a84-0d31dc02f38a@gmail.com>

Ari Jolma kirjoitti 10.4.2020 klo 9.54:
> This seems to be the case. v 3.0.2 sends
>
> SELECT setval(pg_get_serial_sequence('"stand"', 'id'), MAX("id") FROM 
> "stand";
>
> and similar for other tables but v 2.2.3 does not.


The fix was committed 9 Sep 2017 as a fix to #7032 to versions 2.3 and 
up but not to 2.2, which is what one still gets by default in ubuntu 18.04.

Probably a quick fix would be to issue those sequence update commands 
after all data load commands.

Ari



From rajeshreddy_m at yahoo.co.in  Sun Apr 12 12:05:40 2020
From: rajeshreddy_m at yahoo.co.in (rmaddu)
Date: Sun, 12 Apr 2020 12:05:40 -0700 (MST)
Subject: [gdal-dev] GDAL OGR2OGR MVT format multiple layers
Message-ID: <1586718340781-0.post@n6.nabble.com>

Hi,
I am writing data from json to MVT format using OGR2OGR. My requirement is
to generate multiple layers. When I open metadata.json, layerCount =1
always, i.e., single layer. How to give input as multiple layers?

How to get multiple layers in metadata.json?

I tried with below content as JSON, but not getting- 
[
 "layers": [
 { "type": "FeatureCollection",
    "name" : "Breaker",
    "features": [
      { "type": "Feature",
        "geometry": {"type": "Point", "coordinates": [102.0, 0.5]},
        "properties": {"prop0": "value0"}
        }
       ]
     },
{ "type": "FeatureCollection",
    "name" : "PCond",
    "features": [
      { "type": "Feature",
        "geometry": {"type": "Point", "coordinates": [102.0, 0.5]},
        "properties": {"prop0": "value0"}
        }
       ]
     }
  ]
]


If I place multiple shape files (multiple layers) and write those to MVT,
seeing multiple layers in metadata.json. But I want to use JSON input.

Regards,
Rajesh



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From hardienalfath93 at gmail.com  Sun Apr 12 20:13:12 2020
From: hardienalfath93 at gmail.com (duns)
Date: Mon, 13 Apr 2020 05:13:12 +0200
Subject: [gdal-dev] ISG (International Service for Geoid) driver
Message-ID: <CABv_wsARaYLZvi-6ZuWun-z_jopttzk3yNrO1nwf4R7xXSrztQ@mail.gmail.com>

Hello,

I read about the ISG in here says that driver is "New In Version 3.1"
https://gdal.org/drivers/raster/isg.html#driver-capabilities

Does this mean in the current release 3.0.4 the driver is not available
yet?
If it doesn't, is there any way to force install it somehow using
unreleased version of 3.1(if it available somewhere) ?

Thanks so much for the help.

Hardien
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200413/1dd045b0/attachment.html>

From even.rouault at spatialys.com  Tue Apr 14 02:21:04 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Apr 2020 11:21:04 +0200
Subject: [gdal-dev] ISG (International Service for Geoid) driver
In-Reply-To: <CABv_wsARaYLZvi-6ZuWun-z_jopttzk3yNrO1nwf4R7xXSrztQ@mail.gmail.com>
References: <CABv_wsARaYLZvi-6ZuWun-z_jopttzk3yNrO1nwf4R7xXSrztQ@mail.gmail.com>
Message-ID: <2748240.5xDuCUydVY@even-i700>

Hardien,

> I read about the ISG in here says that driver is "New In Version 3.1"
> https://gdal.org/drivers/raster/isg.html#driver-capabilities
> 
> Does this mean in the current release 3.0.4 the driver is not available
> yet?

Yes

> If it doesn't, is there any way to force install it somehow using
> unreleased version of 3.1(if it available somewhere) ?

Linux: https://gdal.org/download.html#linux-docker-images

Windows:
 - gdal-dev package on OSGeo4W (https://trac.osgeo.org/osgeo4w/)
 - development builds at http://gisinternals.com/development.php

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200414/b164c290/attachment.html>

From louis-philippe.rousseaulambert2 at canada.ca  Tue Apr 14 10:03:43 2020
From: louis-philippe.rousseaulambert2 at canada.ca (Rousseau Lambert2, Louis-Philippe (EC))
Date: Tue, 14 Apr 2020 17:03:43 +0000
Subject: [gdal-dev] NetCDF rotated grid support
Message-ID: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>

Hi all,

I have a NetCDF file with a rotated grid that I try to manipulate with GDAL (master build GDAL 3.1.0dev-c6bff27467, released 2020/04/14) and open in QGIS (nightly build) and it looks like the rotated grid is not recognized or supported:

ERROR 1: Only OGC WKT GEOGCS and PROJCS Projections supported for writing to NetCDF.  GEOGCRS["unnamed",BASEGEOGCRS["unknown",DATUM["unknown",ELLIPSOID["unknown",6371229,0,LENGTHUNIT["metre",1,ID["EPSG",9001]]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433],ID["EPSG",8901]]],DERIVINGCONVERSION["unknown",METHOD["PROJ ob_tran o_proj=longlat"],PARAMETER["o_lon_p",0,ANGLEUNIT["degree",0.0174532925199433,ID["EPSG",9122]]],PARAMETER["o_lat_p",31.758312,ANGLEUNIT["degree",0.0174532925199433,ID["EPSG",9122]]],PARAMETER["lon_0",-92.402969,ANGLEUNIT["degree",0.0174532925199433,ID["EPSG",9122]]]],CS[ellipsoidal,2],AXIS["longitude",east,ORDER[1],ANGLEUNIT["degree",0.0174532925199433,ID["EPSG",9122]]],AXIS["latitude",north,ORDER[2],ANGLEUNIT["degree",0.0174532925199433,ID["EPSG",9122]]]] not supported.

I also tried converting a valid GRIB2 file with a rotated grid to a NetCDF and got the same error. Note that the GRIB2 file is correctly read and opened in QGIS and with GDAL.

Here is the proj4 definition of the GRIB2 projection: "+proj=ob_tran +o_proj=longlat +o_lon_p=-0 +o_lat_p=31.758312 +lon_0=-92.402969 +R=6371229 +no_defs +type=crs"

Is this a known issue (or expected), or should the rotated grid be supported with in NetCDF ?

Thanks

LP
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200414/fc5b6349/attachment.html>

From even.rouault at spatialys.com  Tue Apr 14 10:26:34 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Apr 2020 19:26:34 +0200
Subject: [gdal-dev] NetCDF rotated grid support
In-Reply-To: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>
References: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>
Message-ID: <4840350.Rbt4YPPae9@even-i700>

Louis-Phillipe,

Reading netCDF or GRIB2 rotated grids works, but not writing 
them to netCDF. That could potentially be added, but this is not 
handled currently.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200414/604d36f7/attachment.html>

From chaoyuejoy at gmail.com  Tue Apr 14 20:30:47 2020
From: chaoyuejoy at gmail.com (Chao YUE)
Date: Wed, 15 Apr 2020 11:30:47 +0800
Subject: [gdal-dev] Algorithm to clip the inner loop of a polygon
Message-ID: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>

Dear all,

Does anyone have some experience or is aware of some algorithm that can
find and clip the inner loop formed in a polygon ? I attach one example
here. In this case I would only keep the outer points and drop the ones
that make an inner loop. I am developing some algorithm to simulate
wildland fire propagation. The algorithm is based on Richards 1990.

In the paper he described an algorithm based on two steps: (1) find the
points where a concave curvature is made. (2) search for both sides of this
point to see where any two line segments cross over each other.
But I am wondering whether there is already some existing solutions or
other better ones.

Thanks a lot for the kind help for any hints on this !
Kind regards,
Chao

Gwynfor Richards, 1990. An elliptical growth model of forest fire fronts
and its numerical solution. International journal for Numerical Methods in
Engineering, Vol. 30, 1163-1179.

[image: InnerLoop.png]

-- 
***********************************************************************************
Chao YUE（岳超）
西北农林科技大学水土保持研究所 研究员
黄土高原土壤侵蚀与旱地农业国家重点实验室
State Key Laboratory of Soil Erosion and Dryland Farming on the Loess
Plateau
Institute of Soil and Water Conservation
Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
chaoyue at ms.iswc.ac.cn
Mobile: +86 18709187546
************************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/00cb1afc/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: InnerLoop.png
Type: image/png
Size: 30127 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/00cb1afc/attachment-0001.png>

From aritchie at usgs.gov  Tue Apr 14 20:37:15 2020
From: aritchie at usgs.gov (Ritchie, Andrew C)
Date: Wed, 15 Apr 2020 03:37:15 +0000
Subject: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large jpeg
 cogs... REALLLLLY long time to unload.
Message-ID: <BY5PR09MB555454E3740C7F3A57C26437B1DB0@BY5PR09MB5554.namprd09.prod.outlook.com>

I've been working in the gdal-dev-env (version 3.1.0, installed around mid-December) on OSGeo4w (mostly because it's faster than making COGs using the GTIFF driver) on large (e.g. 102600x91100) orthophoto rasters, generating VRTs, TIFFs and COGs.

While I can do LZW, DEFLATE, and uncompressed just fine (2 minutes with all cores to make a lzw COG from a VRT), I'm struggling to make JPEG COGs. If I run a loop, I can't make it through more than one image without gdal_translate hanging at the finish for sometimes tens of hours. If I kill the process (CTRL-C doesn't always work, but task mgr does) then the resulting COG is fine (same size as if I wait n hours and the process finishes). Over the last few years I've had this issue (gdal_translate hanging at "100 - done.") on many large rasters even when building as TIFF. Also maybe worth noting, even on smaller rasters I often see GDAL hang for minutes to tens of minutes at the end of a raster build. In the past I was only been building single rasters though, so it's not that big of a deal - I can just kill the process. Not any more. I frequently build several at a time and hope to scale up.

I'm running on a threadripper 3960x with 256GB RAM that I built. All processing is on a NVMe drive. The LZW compressed tiffs (COGs) are around 1.5 - 3GB (8-bit,RGB with mask band). If I build with CPL_DEBUG=ON, depending on cachemax size, I see "potential thrashing on band one of ." at around 10-20% (even with GDAL_CACHEMAX at 80%), and if not set high enough I'm stuck at 20% for hours and hours. Then gdal hangs at "100 - done." for anywhere from 2 - 12+ hours unless I kill it. If I kill the process, the final raster builds out and appears to work fine, and is the same as if I wait X hours for it to exit. For a test with debug on I just finished, after 2.5h hung at "done" I got this line:

GDAL: GDALClose(<outfile.tif.ovr.tmp, this=000001FDC5531C50)

And another 45 minutes later the input and output tiffs closed and shared library unloaded after the RAM slowly emptied from ~30 gig over that time.

My overall command at the moment is:

gdal_translate .\<infile.tif> <outfile.tif> -of COG -co COMPRESS=JPEG -co QUALITY=90 -config GDAL_CACHEMAX "80%" -config GDAL_SWATH_SIZE "80%" -config GDAL_FORCE_CACHING YES -config GDAL_MAX_DATASET_POOL_SIZE 2048

And with lower values (and possibly if I get rid of the GDAL_FORCE_CACHING YES variable - I just added that) I have the same "hang" at 100% lasting for even longer. Again, the same COG builds in 2 minutes with LZW, but with JPEG and all the cachemax settings ramped up, it takes maybe 6 hours.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/19162212/attachment.html>

From ari.jolma at gmail.com  Tue Apr 14 21:22:11 2020
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 15 Apr 2020 07:22:11 +0300
Subject: [gdal-dev] Algorithm to clip the inner loop of a polygon
In-Reply-To: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
References: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
Message-ID: <aeff7777-d05b-415c-e2d6-cb7ff62bac83@gmail.com>

Hi,

I wrote a method to a Polygon class (in Python) that solves that problem 
because the ones in GEOS via Shapely did not seem good enough. My method 
was based on no published algorithm but just my own reasoning, it is 
probably not optimal speed-wise. I did not perform formal testing on it 
but it worked on my data, which was quite large. The basic idea was to 
build the polygon by adding points and when adding test for self 
intersections / collinearity against existing segments. The method 
returns the loops while points are added. The code is not in a public 
repo but I'll add the method below. It needs some basic methods and 
function which should be simple to add.

Ari

Chao YUE kirjoitti 15.4.2020 klo 6.30:
> Dear all,
>
> Does anyone have some experience or is aware of some algorithm that 
> can find and clip the inner loop formed in a polygon ? I attach one 
> example here. In this case I would only keep the outer points and drop 
> the ones that make an inner loop. I am developing some algorithm to 
> simulate wildland fire propagation. The algorithm is based on Richards 
> 1990.
>
> In the paper he described an algorithm based on two steps: (1) find 
> the points where a concave curvature is made. (2) search for both 
> sides of this point to see where any two line segments cross over each 
> other.
> But I am wondering whether there is already some existing solutions or 
> other better ones.
>
> Thanks a lot for the kind help for any hints on this !
> Kind regards,
> Chao
>
> Gwynfor Richards, 1990. An elliptical growth model of forest fire 
> fronts and its numerical solution. International journal for Numerical 
> Methods in Engineering, Vol. 30, 1163-1179.
>
> InnerLoop.png
>
> -- 
> ***********************************************************************************
> Chao YUE（岳超）
> 西北农林科技大学水土保持研究所 研究员
> 黄土高原土壤侵蚀与旱地农业国家重点实验室
> State Key Laboratory of Soil Erosion and Dryland Farming on the Loess 
> Plateau
> Institute of Soil and Water Conservation
> Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
> chaoyue at ms.iswc.ac.cn <mailto:chaoyue at ms.iswc.ac.cn>
> Mobile: +86 18709187546
> ************************************************************************************
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


Code copyright Simosol Oy, licence MIT

def add_point(self, p=None):
         """ Add a point to the end of points (before root)
         The first level ear (hole or in-a-point-intersecting polygon) 
is returned
         if there is such.
         p -- point to add, if None, close the ring

     self is a Polygon, which has as attributes a dict of points, where
     point = [index of previous point, index of next point, coords]
     no duplicates, no null indexes in points

            """
         n = self.n_points()
         if p is None and n < 3:
             raise ValueError("Can't close a polygon with less than 
three points.")
         if self.root is None:
             self.root = 0
             self.points[self.root] = [self.root, self.root, p]
             return
         i0 = self.points[self.root][0]
         if p is not None and p[0] == self.points[i0][2][0] and p[1] == 
self.points[i0][2][1]:
             # same point, skip
             return None
         index = i0 + 1
         while index in self.points:
             index += 1
         ear = None
         close = False
         if n > 2:
             # test for self-intersection,
             # current - new against (0-1, )1-2, ... prev(current)-current
             current_point = self.get_point(i0)
             j0 = self.root
             if p is None: # close
                 p = self.get_point(self.root)
                 j0 = self.index_of_next_point(j0)
                 close = True
             while True:
                 j1 = self.index_of_next_point(j0)
                 if j1 == i0:
                     break
                 pj0 = self.get_point(j0)
                 pj1 = self.get_point(j1)
                 x = get_line_intersection(pj0, pj1, current_point, p)

                 if type(x) is tuple: # Intersection
                     #print('intersection',pj0,pj1,current_point,p)
                     # snip away and return eventually the closed part
                     ear = self.get_noose(j1, i0, first_point=x)
                     # set new j1 and delete from j1+1 ... current
                     self.set_point(j1, x)
                     j2 = self.index_of_next_point(j1)
                     self.delete_points(j2, i0)
                     i0 = j0
                     index = j1
                     break

                 elif abs(x) == 1: # Collinear
                     if point_on_line(p, pj0, pj1): # new is on j0 - j1
                         #print('collinear new on 
j0-j1',pj0,pj1,current_point,p)
                         # is j1 on cp - new?
                         if point_in_box(pj1, current_point, p):
                             k = j1 # ear is j1 ... cp
                         else: # j0 is on cp - new
                             k = j0 # ear is j0 ... cp
                         ear = self.get_noose(k, i0)
                         self.delete_points(j1, i0)
                         i0 = j0
                         index = j1
                         break
                     elif point_on_line(pj1, current_point, p): # j1 is 
on cp - new
                         #print('collinear j1 on 
cp-new',pj0,pj1,current_point,p)
                         # ear is j1 ... cp
                         ear = self.get_noose(j1, i0)
                         self.delete_points(j1, i0)
                         i0 = j0
                         index = j1
                         break
                 j0 = j1

         if not close:
             self.points[index] = [i0, self.root, p]
             self.points[i0][1] = index
             self.points[self.root][0] = index
         return ear

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/6aab9715/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: InnerLoop.png
Type: image/png
Size: 30127 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/6aab9715/attachment-0001.png>

From ao at t-kartor.se  Tue Apr 14 23:03:40 2020
From: ao at t-kartor.se (Andreas Oxenstierna)
Date: Wed, 15 Apr 2020 08:03:40 +0200
Subject: [gdal-dev] Algorithm to clip the inner loop of a polygon
In-Reply-To: <aeff7777-d05b-415c-e2d6-cb7ff62bac83@gmail.com>
References: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
 <aeff7777-d05b-415c-e2d6-cb7ff62bac83@gmail.com>
Message-ID: <154d7069-6cd0-4b85-da02-75cdc00bf746@t-kartor.se>

Hi

Have you tested PostGIS?
ST_ExteriorRing((ST_Dump(ST_LineMerge(ST_Union(ST_Force2D(<your 
geometry>))))).geom)

should extract the points you want to keep by splitting at intersections 
- but it may fail in very complex cases. Then I would start with a 
ST_SnapToGrid with a quite high tolerance to lower the coordinate 
resolution.


> Hi,
>
> I wrote a method to a Polygon class (in Python) that solves that 
> problem because the ones in GEOS via Shapely did not seem good enough. 
> My method was based on no published algorithm but just my own 
> reasoning, it is probably not optimal speed-wise. I did not perform 
> formal testing on it but it worked on my data, which was quite large. 
> The basic idea was to build the polygon by adding points and when 
> adding test for self intersections / collinearity against existing 
> segments. The method returns the loops while points are added. The 
> code is not in a public repo but I'll add the method below. It needs 
> some basic methods and function which should be simple to add.
>
> Ari
>
> Chao YUE kirjoitti 15.4.2020 klo 6.30:
>> Dear all,
>>
>> Does anyone have some experience or is aware of some algorithm that 
>> can find and clip the inner loop formed in a polygon ? I attach one 
>> example here. In this case I would only keep the outer points and 
>> drop the ones that make an inner loop. I am developing some algorithm 
>> to simulate wildland fire propagation. The algorithm is based on 
>> Richards 1990.
>>
>> In the paper he described an algorithm based on two steps: (1) find 
>> the points where a concave curvature is made. (2) search for both 
>> sides of this point to see where any two line segments cross over 
>> each other.
>> But I am wondering whether there is already some existing solutions 
>> or other better ones.
>>
>> Thanks a lot for the kind help for any hints on this !
>> Kind regards,
>> Chao
>>
>> Gwynfor Richards, 1990. An elliptical growth model of forest fire 
>> fronts and its numerical solution. International journal for 
>> Numerical Methods in Engineering, Vol. 30, 1163-1179.
>>
>> InnerLoop.png
>>
>> -- 
>> ***********************************************************************************
>> Chao YUE（岳超）
>> 西北农林科技大学水土保持研究所 研究员
>> 黄土高原土壤侵蚀与旱地农业国家重点实验室
>> State Key Laboratory of Soil Erosion and Dryland Farming on the Loess 
>> Plateau
>> Institute of Soil and Water Conservation
>> Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
>> chaoyue at ms.iswc.ac.cn <mailto:chaoyue at ms.iswc.ac.cn>
>> Mobile: +86 18709187546
>> ************************************************************************************
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> Code copyright Simosol Oy, licence MIT
>
> def add_point(self, p=None):
>         """ Add a point to the end of points (before root)
>         The first level ear (hole or in-a-point-intersecting polygon) 
> is returned
>         if there is such.
>         p -- point to add, if None, close the ring
>
>     self is a Polygon, which has as attributes a dict of points, where
>     point = [index of previous point, index of next point, coords]
>     no duplicates, no null indexes in points
>
>            """
>         n = self.n_points()
>         if p is None and n < 3:
>             raise ValueError("Can't close a polygon with less than 
> three points.")
>         if self.root is None:
>             self.root = 0
>             self.points[self.root] = [self.root, self.root, p]
>             return
>         i0 = self.points[self.root][0]
>         if p is not None and p[0] == self.points[i0][2][0] and p[1] == 
> self.points[i0][2][1]:
>             # same point, skip
>             return None
>         index = i0 + 1
>         while index in self.points:
>             index += 1
>         ear = None
>         close = False
>         if n > 2:
>             # test for self-intersection,
>             # current - new against (0-1, )1-2, ... prev(current)-current
>             current_point = self.get_point(i0)
>             j0 = self.root
>             if p is None: # close
>                 p = self.get_point(self.root)
>                 j0 = self.index_of_next_point(j0)
>                 close = True
>             while True:
>                 j1 = self.index_of_next_point(j0)
>                 if j1 == i0:
>                     break
>                 pj0 = self.get_point(j0)
>                 pj1 = self.get_point(j1)
>                 x = get_line_intersection(pj0, pj1, current_point, p)
>
>                 if type(x) is tuple: # Intersection
> #print('intersection',pj0,pj1,current_point,p)
>                     # snip away and return eventually the closed part
>                     ear = self.get_noose(j1, i0, first_point=x)
>                     # set new j1 and delete from j1+1 ... current
>                     self.set_point(j1, x)
>                     j2 = self.index_of_next_point(j1)
>                     self.delete_points(j2, i0)
>                     i0 = j0
>                     index = j1
>                     break
>
>                 elif abs(x) == 1: # Collinear
>                     if point_on_line(p, pj0, pj1): # new is on j0 - j1
>                         #print('collinear new on 
> j0-j1',pj0,pj1,current_point,p)
>                         # is j1 on cp - new?
>                         if point_in_box(pj1, current_point, p):
>                             k = j1 # ear is j1 ... cp
>                         else: # j0 is on cp - new
>                             k = j0 # ear is j0 ... cp
>                         ear = self.get_noose(k, i0)
>                         self.delete_points(j1, i0)
>                         i0 = j0
>                         index = j1
>                         break
>                     elif point_on_line(pj1, current_point, p): # j1 is 
> on cp - new
>                         #print('collinear j1 on 
> cp-new',pj0,pj1,current_point,p)
>                         # ear is j1 ... cp
>                         ear = self.get_noose(j1, i0)
>                         self.delete_points(j1, i0)
>                         i0 = j0
>                         index = j1
>                         break
>                 j0 = j1
>
>         if not close:
>             self.points[index] = [i0, self.root, p]
>             self.points[i0][1] = index
>             self.points[self.root][0] = index
>         return ear
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Hälsningar

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins väg 12 Kristianstad
mobile: +46 733 206831
mailto: ao at t-kartor.se
http://www.t-kartor.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/87965824/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: InnerLoop.png
Type: image/png
Size: 30127 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/87965824/attachment-0001.png>

From ari.jolma at gmail.com  Wed Apr 15 00:04:15 2020
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 15 Apr 2020 10:04:15 +0300
Subject: [gdal-dev] Algorithm to clip the inner loop of a polygon
In-Reply-To: <154d7069-6cd0-4b85-da02-75cdc00bf746@t-kartor.se>
References: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
 <aeff7777-d05b-415c-e2d6-cb7ff62bac83@gmail.com>
 <154d7069-6cd0-4b85-da02-75cdc00bf746@t-kartor.se>
Message-ID: <3180ff8f-4764-014d-163a-e3fbf88e1d74@gmail.com>

Andreas Oxenstierna kirjoitti 15.4.2020 klo 9.03:
> Hi
>
> Have you tested PostGIS?
> ST_ExteriorRing((ST_Dump(ST_LineMerge(ST_Union(ST_Force2D(<your 
> geometry>))))).geom)
>
> should extract the points you want to keep by splitting at 
> intersections - but it may fail in very complex cases. Then I would 
> start with a ST_SnapToGrid with a quite high tolerance to lower the 
> coordinate resolution.


That PostGIS solution looks quite nice. Unfortunately I was not able to 
use PostGIS in my case but were restricted to Shapely, which uses GEOS. 
But then, PostGIS is mostly based on GEOS, so it should perhaps be 
doable that way too. I'm not working or using that solution I gave right 
now so won't test it.

Best,

Ari


>
>
>> Hi,
>>
>> I wrote a method to a Polygon class (in Python) that solves that 
>> problem because the ones in GEOS via Shapely did not seem good 
>> enough. My method was based on no published algorithm but just my own 
>> reasoning, it is probably not optimal speed-wise. I did not perform 
>> formal testing on it but it worked on my data, which was quite large. 
>> The basic idea was to build the polygon by adding points and when 
>> adding test for self intersections / collinearity against existing 
>> segments. The method returns the loops while points are added. The 
>> code is not in a public repo but I'll add the method below. It needs 
>> some basic methods and function which should be simple to add.
>>
>> Ari
>>
>> Chao YUE kirjoitti 15.4.2020 klo 6.30:
>>> Dear all,
>>>
>>> Does anyone have some experience or is aware of some algorithm that 
>>> can find and clip the inner loop formed in a polygon ? I attach one 
>>> example here. In this case I would only keep the outer points and 
>>> drop the ones that make an inner loop. I am developing some 
>>> algorithm to simulate wildland fire propagation. The algorithm is 
>>> based on Richards 1990.
>>>
>>> In the paper he described an algorithm based on two steps: (1) find 
>>> the points where a concave curvature is made. (2) search for both 
>>> sides of this point to see where any two line segments cross over 
>>> each other.
>>> But I am wondering whether there is already some existing solutions 
>>> or other better ones.
>>>
>>> Thanks a lot for the kind help for any hints on this !
>>> Kind regards,
>>> Chao
>>>
>>> Gwynfor Richards, 1990. An elliptical growth model of forest fire 
>>> fronts and its numerical solution. International journal for 
>>> Numerical Methods in Engineering, Vol. 30, 1163-1179.
>>>
>>> InnerLoop.png
>>>
>>> -- 
>>> ***********************************************************************************
>>> Chao YUE（岳超）
>>> 西北农林科技大学水土保持研究所 研究员
>>> 黄土高原土壤侵蚀与旱地农业国家重点实验室
>>> State Key Laboratory of Soil Erosion and Dryland Farming on the 
>>> Loess Plateau
>>> Institute of Soil and Water Conservation
>>> Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
>>> chaoyue at ms.iswc.ac.cn <mailto:chaoyue at ms.iswc.ac.cn>
>>> Mobile: +86 18709187546
>>> ************************************************************************************
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>> Code copyright Simosol Oy, licence MIT
>>
>> def add_point(self, p=None):
>>         """ Add a point to the end of points (before root)
>>         The first level ear (hole or in-a-point-intersecting polygon) 
>> is returned
>>         if there is such.
>>         p -- point to add, if None, close the ring
>>
>>     self is a Polygon, which has as attributes a dict of points, where
>>     point = [index of previous point, index of next point, coords]
>>     no duplicates, no null indexes in points
>>
>>            """
>>         n = self.n_points()
>>         if p is None and n < 3:
>>             raise ValueError("Can't close a polygon with less than 
>> three points.")
>>         if self.root is None:
>>             self.root = 0
>>             self.points[self.root] = [self.root, self.root, p]
>>             return
>>         i0 = self.points[self.root][0]
>>         if p is not None and p[0] == self.points[i0][2][0] and p[1] 
>> == self.points[i0][2][1]:
>>             # same point, skip
>>             return None
>>         index = i0 + 1
>>         while index in self.points:
>>             index += 1
>>         ear = None
>>         close = False
>>         if n > 2:
>>             # test for self-intersection,
>>             # current - new against (0-1, )1-2, ... prev(current)-current
>>             current_point = self.get_point(i0)
>>             j0 = self.root
>>             if p is None: # close
>>                 p = self.get_point(self.root)
>>                 j0 = self.index_of_next_point(j0)
>>                 close = True
>>             while True:
>>                 j1 = self.index_of_next_point(j0)
>>                 if j1 == i0:
>>                     break
>>                 pj0 = self.get_point(j0)
>>                 pj1 = self.get_point(j1)
>>                 x = get_line_intersection(pj0, pj1, current_point, p)
>>
>>                 if type(x) is tuple: # Intersection
>> #print('intersection',pj0,pj1,current_point,p)
>>                     # snip away and return eventually the closed part
>>                     ear = self.get_noose(j1, i0, first_point=x)
>>                     # set new j1 and delete from j1+1 ... current
>>                     self.set_point(j1, x)
>>                     j2 = self.index_of_next_point(j1)
>>                     self.delete_points(j2, i0)
>>                     i0 = j0
>>                     index = j1
>>                     break
>>
>>                 elif abs(x) == 1: # Collinear
>>                     if point_on_line(p, pj0, pj1): # new is on j0 - j1
>>                         #print('collinear new on 
>> j0-j1',pj0,pj1,current_point,p)
>>                         # is j1 on cp - new?
>>                         if point_in_box(pj1, current_point, p):
>>                             k = j1 # ear is j1 ... cp
>>                         else: # j0 is on cp - new
>>                             k = j0 # ear is j0 ... cp
>>                         ear = self.get_noose(k, i0)
>>                         self.delete_points(j1, i0)
>>                         i0 = j0
>>                         index = j1
>>                         break
>>                     elif point_on_line(pj1, current_point, p): # j1 
>> is on cp - new
>>                         #print('collinear j1 on 
>> cp-new',pj0,pj1,current_point,p)
>>                         # ear is j1 ... cp
>>                         ear = self.get_noose(j1, i0)
>>                         self.delete_points(j1, i0)
>>                         i0 = j0
>>                         index = j1
>>                         break
>>                 j0 = j1
>>
>>         if not close:
>>             self.points[index] = [i0, self.root, p]
>>             self.points[i0][1] = index
>>             self.points[self.root][0] = index
>>         return ear
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> -- 
> Hälsningar
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins väg 12 Kristianstad
> mobile: +46 733 206831
> mailto:ao at t-kartor.se
> http://www.t-kartor.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/dabf2d26/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: InnerLoop.png
Type: image/png
Size: 30127 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/dabf2d26/attachment-0001.png>

From andrea.aime at geo-solutions.it  Wed Apr 15 02:05:40 2020
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Wed, 15 Apr 2020 11:05:40 +0200
Subject: [gdal-dev] Does OGR support GeoPackage enums in write mode (or at
	all?)
Message-ID: <CA+nxMTtX5rpUdS+BSV7Ethwd4Vk0y9R6pDoauw5eGLRoZwrRxA@mail.gmail.com>

Hi,
I'm trying to dump a large PostGIS database into a GeoPackage. In the
original database some columns
are strings, but could be more efficiently represented as enums, as they
have a small set of values.

GeoPackage has a native notion of enums, check the spec and search for
"table 27" for an example:
http://www.geopackage.org/spec/

However I cannot find mention of them in the GPKG driver documentation:
https://gdal.org/drivers/vector/gpkg.html
I quickly grepped into the geopackage sources for "enum", could not find it
in the geopackage sources.

Also looked at the "mapFieldType" ogr2ogr parameter and at OGR SQL, did not
find anything there either.

So I'm wondering, is there direct support for enum fields? Any way to map a
string column to enum during
a ogr2ogr call?

Best Regards,

Andrea Aime == GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information. == Ing. Andrea Aime @geowolf
Technical Lead GeoSolutions S.A.S. Via di Montramito 3/A 55054 Massarosa
(LU) phone: +39 0584 962313 fax: +39 0584 1660272 mob: +39 339 8844549
http://www.geo-solutions.it http://twitter.com/geosolutions_it
------------------------------------------------------- *Con riferimento
alla normativa sul trattamento dei dati personali (Reg. UE 2016/679 -
Regolamento generale sulla protezione dei dati “GDPR”), si precisa che ogni
circostanza inerente alla presente email (il suo contenuto, gli eventuali
allegati, etc.) è un dato la cui conoscenza è riservata al/i solo/i
destinatario/i indicati dallo scrivente. Se il messaggio Le è giunto per
errore, è tenuta/o a cancellarlo, ogni altra operazione è illecita. Le
sarei comunque grato se potesse darmene notizia. This email is intended
only for the person or entity to which it is addressed and may contain
information that is privileged, confidential or otherwise protected from
disclosure. We remind that - as provided by European Regulation 2016/679
“GDPR” - copying, dissemination or use of this e-mail or the information
herein by anyone other than the intended recipient is prohibited. If you
have received this email by mistake, please notify us immediately by
telephone or e-mail.*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/7a5cbe67/attachment.html>

From even.rouault at spatialys.com  Wed Apr 15 02:36:17 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Apr 2020 11:36:17 +0200
Subject: [gdal-dev] Does OGR support GeoPackage enums in write mode (or
	at all?)
In-Reply-To: <CA+nxMTtX5rpUdS+BSV7Ethwd4Vk0y9R6pDoauw5eGLRoZwrRxA@mail.gmail.com>
References: <CA+nxMTtX5rpUdS+BSV7Ethwd4Vk0y9R6pDoauw5eGLRoZwrRxA@mail.gmail.com>
Message-ID: <3039740.UpMh5NMGPr@even-i700>

Hi Andrea,

> but could be more efficiently represented as enums, as they
>have a small set of values.

> GeoPackage has a native notion of enums, check the spec and search for
> "table 27" for an example:
> http://www.geopackage.org/spec/

My understanding of table 27 is that it is just to define constraints on the values of a column, 
but not a way to establish a integer<-->string mapping as you'd like. Unless I'm missing 
something. Of course you could create an auxiliary table with the mapping, but I'm not aware 
of a standardized way of registering it.

> So I'm wondering, is there direct support for enum fields? 

No, there's no such concept of enum fields in the OGR data model itself

The schema extension ( http://www.geopackage.org/spec/#extension_schema ) is 
minimilastically implement in the OGR GPKG driver. It just supports setting the mime_type of 
a column to "application/json" to map from/to the OGR type=string, subtype=json for 
columns.

> Any way to map a string column to enum during a ogr2ogr call?

If there was really a way to encode what you want to do in the specification, I'imagine that 
could potentially be a new driver specific option where you would provide the mapping.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/5fc56c14/attachment.html>

From andrea.aime at geo-solutions.it  Wed Apr 15 02:56:58 2020
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Wed, 15 Apr 2020 11:56:58 +0200
Subject: [gdal-dev] Does OGR support GeoPackage enums in write mode (or
	at all?)
In-Reply-To: <3039740.UpMh5NMGPr@even-i700>
References: <CA+nxMTtX5rpUdS+BSV7Ethwd4Vk0y9R6pDoauw5eGLRoZwrRxA@mail.gmail.com>
 <3039740.UpMh5NMGPr@even-i700>
Message-ID: <CA+nxMTu19nDf7mBb4ihSRYqG3UZG42tqiiwb7OAS6fTnNheeeQ@mail.gmail.com>

On Wed, Apr 15, 2020 at 11:36 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> > http://www.geopackage.org/spec/
>
>
>
> My understanding of table 27 is that it is just to define constraints on
> the values of a column, but not a way to establish a integer<-->string
> mapping as you'd like. Unless I'm missing something. Of course you could
> create an auxiliary table with the mapping, but I'm not aware of a
> standardized way of registering it.
>

I had the idea because Table 27 lists enum values (in the "value" column)
as 1, 2, 3, and while not providing an example of it,
gpkg_data_column_constraints
also has a "description" column. so my current guess is that one could use
integer numbers in "value", and provide the name of the value in
"description".
I'm going to follow up with the OGC spec lead to see if that was an actual
option, or just a thing in my mind... and will let you know what comes out
of it :-D

Cheers
Andrea

==

GeoServer Professional Services from the experts! Visit http://goo.gl/it488V
for more information. == Ing. Andrea Aime @geowolf Technical Lead
GeoSolutions S.A.S. Via di Montramito 3/A 55054 Massarosa (LU) phone: +39
0584 962313 fax: +39 0584 1660272 mob: +39 339 8844549
http://www.geo-solutions.it http://twitter.com/geosolutions_it
------------------------------------------------------- *Con riferimento
alla normativa sul trattamento dei dati personali (Reg. UE 2016/679 -
Regolamento generale sulla protezione dei dati “GDPR”), si precisa che ogni
circostanza inerente alla presente email (il suo contenuto, gli eventuali
allegati, etc.) è un dato la cui conoscenza è riservata al/i solo/i
destinatario/i indicati dallo scrivente. Se il messaggio Le è giunto per
errore, è tenuta/o a cancellarlo, ogni altra operazione è illecita. Le
sarei comunque grato se potesse darmene notizia. This email is intended
only for the person or entity to which it is addressed and may contain
information that is privileged, confidential or otherwise protected from
disclosure. We remind that - as provided by European Regulation 2016/679
“GDPR” - copying, dissemination or use of this e-mail or the information
herein by anyone other than the intended recipient is prohibited. If you
have received this email by mistake, please notify us immediately by
telephone or e-mail.*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/16f5db61/attachment.html>

From even.rouault at spatialys.com  Wed Apr 15 03:22:26 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Apr 2020 12:22:26 +0200
Subject: [gdal-dev] Does OGR support GeoPackage enums in write mode (or
	at all?)
In-Reply-To: <CA+nxMTu19nDf7mBb4ihSRYqG3UZG42tqiiwb7OAS6fTnNheeeQ@mail.gmail.com>
References: <CA+nxMTtX5rpUdS+BSV7Ethwd4Vk0y9R6pDoauw5eGLRoZwrRxA@mail.gmail.com>
 <3039740.UpMh5NMGPr@even-i700>
 <CA+nxMTu19nDf7mBb4ihSRYqG3UZG42tqiiwb7OAS6fTnNheeeQ@mail.gmail.com>
Message-ID: <4107058.FYBscgKX9p@even-i700>

On mercredi 15 avril 2020 11:56:58 CEST Andrea Aime wrote:
> On Wed, Apr 15, 2020 at 11:36 AM Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > > http://www.geopackage.org/spec/
> > 
> > My understanding of table 27 is that it is just to define constraints on
> > the values of a column, but not a way to establish a integer<-->string
> > mapping as you'd like. Unless I'm missing something. Of course you could
> > create an auxiliary table with the mapping, but I'm not aware of a
> > standardized way of registering it.
> 
> I had the idea because Table 27 lists enum values (in the "value" column)
> as 1, 2, 3, and while not providing an example of it,
> gpkg_data_column_constraints
> also has a "description" column. so my current guess is that one could use
> integer numbers in "value", and provide the name of the value in
> "description".

Oh I missed that. Table 25 indeed mentions "For ranges and globs, describes the constraint; 
for enums, describes the enum value.", so yes your idea could be workable.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/5ccc1d4b/attachment-0001.html>

From even.rouault at spatialys.com  Wed Apr 15 04:38:11 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Apr 2020 13:38:11 +0200
Subject: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large
	jpeg cogs... REALLLLLY long time to unload.
In-Reply-To: <BY5PR09MB555454E3740C7F3A57C26437B1DB0@BY5PR09MB5554.namprd09.prod.outlook.com>
References: <BY5PR09MB555454E3740C7F3A57C26437B1DB0@BY5PR09MB5554.namprd09.prod.outlook.com>
Message-ID: <1751363.68K9FcAoKA@even-i700>

Andrew,

Has your source raster an alpha band ? That could explain the difference 
since it isn't possible to directly create a YCbCrA JPEG compressed file, but 
internally a mask band must be created. However I wouldn't anticipate such 
a huge difference in performance between compression schemes. I would 
suggest not setting GDAL_CACHEMAX at all and letting it at its 5% default 
(increasing it is not always a good idea), in case it would be a performance 
issue at de-allocating cached blocks. 

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/7f128ddb/attachment.html>

From chaoyuejoy at gmail.com  Wed Apr 15 06:08:16 2020
From: chaoyuejoy at gmail.com (Chao YUE)
Date: Wed, 15 Apr 2020 21:08:16 +0800
Subject: [gdal-dev] Algorithm to clip the inner loop of a polygon
In-Reply-To: <3180ff8f-4764-014d-163a-e3fbf88e1d74@gmail.com>
References: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
 <aeff7777-d05b-415c-e2d6-cb7ff62bac83@gmail.com>
 <154d7069-6cd0-4b85-da02-75cdc00bf746@t-kartor.se>
 <3180ff8f-4764-014d-163a-e3fbf88e1d74@gmail.com>
Message-ID: <CAAN-aRF36mPjcicaKPzg5u3NZpy0=hvv_EQYtvhxJpeuHc7b_g@mail.gmail.com>

Hi Ari and Andreas,

Thanks for the information. I will check it out. Today I advanced a little
by almost implementing what's been proposed in my message there.

Regards,
Chao

On Wed, Apr 15, 2020 at 3:04 PM Ari Jolma <ari.jolma at gmail.com> wrote:

> Andreas Oxenstierna kirjoitti 15.4.2020 klo 9.03:
>
> Hi
>
> Have you tested PostGIS?
> ST_ExteriorRing((ST_Dump(ST_LineMerge(ST_Union(ST_Force2D(<your
> geometry>))))).geom)
>
> should extract the points you want to keep by splitting at intersections -
> but it may fail in very complex cases. Then I would start with a
> ST_SnapToGrid with a quite high tolerance to lower the coordinate
> resolution.
>
>
> That PostGIS solution looks quite nice. Unfortunately I was not able to
> use PostGIS in my case but were restricted to Shapely, which uses GEOS. But
> then, PostGIS is mostly based on GEOS, so it should perhaps be doable that
> way too. I'm not working or using that solution I gave right now so won't
> test it.
>
> Best,
>
> Ari
>
>
>
>
> Hi,
>
> I wrote a method to a Polygon class (in Python) that solves that problem
> because the ones in GEOS via Shapely did not seem good enough. My method
> was based on no published algorithm but just my own reasoning, it is
> probably not optimal speed-wise. I did not perform formal testing on it but
> it worked on my data, which was quite large. The basic idea was to build
> the polygon by adding points and when adding test for self intersections /
> collinearity against existing segments. The method returns the loops while
> points are added. The code is not in a public repo but I'll add the method
> below. It needs some basic methods and function which should be simple to
> add.
>
> Ari
> Chao YUE kirjoitti 15.4.2020 klo 6.30:
>
> Dear all,
>
> Does anyone have some experience or is aware of some algorithm that can
> find and clip the inner loop formed in a polygon ? I attach one example
> here. In this case I would only keep the outer points and drop the ones
> that make an inner loop. I am developing some algorithm to simulate
> wildland fire propagation. The algorithm is based on Richards 1990.
>
> In the paper he described an algorithm based on two steps: (1) find the
> points where a concave curvature is made. (2) search for both sides of this
> point to see where any two line segments cross over each other.
> But I am wondering whether there is already some existing solutions or
> other better ones.
>
> Thanks a lot for the kind help for any hints on this !
> Kind regards,
> Chao
>
> Gwynfor Richards, 1990. An elliptical growth model of forest fire fronts
> and its numerical solution. International journal for Numerical Methods in
> Engineering, Vol. 30, 1163-1179.
>
> [image: InnerLoop.png]
>
> --
>
> ***********************************************************************************
> Chao YUE（岳超）
> 西北农林科技大学水土保持研究所 研究员
> 黄土高原土壤侵蚀与旱地农业国家重点实验室
> State Key Laboratory of Soil Erosion and Dryland Farming on the Loess
> Plateau
> Institute of Soil and Water Conservation
> Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
> chaoyue at ms.iswc.ac.cn
> Mobile: +86 18709187546
>
> ************************************************************************************
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> Code copyright Simosol Oy, licence MIT
>
> def add_point(self, p=None):
>         """ Add a point to the end of points (before root)
>         The first level ear (hole or in-a-point-intersecting polygon) is
> returned
>         if there is such.
>         p -- point to add, if None, close the ring
>
>     self is a Polygon, which has as attributes a dict of points, where
>     point = [index of previous point, index of next point, coords]
>     no duplicates, no null indexes in points
>
>            """
>         n = self.n_points()
>         if p is None and n < 3:
>             raise ValueError("Can't close a polygon with less than three
> points.")
>         if self.root is None:
>             self.root = 0
>             self.points[self.root] = [self.root, self.root, p]
>             return
>         i0 = self.points[self.root][0]
>         if p is not None and p[0] == self.points[i0][2][0] and p[1] ==
> self.points[i0][2][1]:
>             # same point, skip
>             return None
>         index = i0 + 1
>         while index in self.points:
>             index += 1
>         ear = None
>         close = False
>         if n > 2:
>             # test for self-intersection,
>             # current - new against (0-1, )1-2, ... prev(current)-current
>             current_point = self.get_point(i0)
>             j0 = self.root
>             if p is None: # close
>                 p = self.get_point(self.root)
>                 j0 = self.index_of_next_point(j0)
>                 close = True
>             while True:
>                 j1 = self.index_of_next_point(j0)
>                 if j1 == i0:
>                     break
>                 pj0 = self.get_point(j0)
>                 pj1 = self.get_point(j1)
>                 x = get_line_intersection(pj0, pj1, current_point, p)
>
>                 if type(x) is tuple: # Intersection
>                     #print('intersection',pj0,pj1,current_point,p)
>                     # snip away and return eventually the closed part
>                     ear = self.get_noose(j1, i0, first_point=x)
>                     # set new j1 and delete from j1+1 ... current
>                     self.set_point(j1, x)
>                     j2 = self.index_of_next_point(j1)
>                     self.delete_points(j2, i0)
>                     i0 = j0
>                     index = j1
>                     break
>
>                 elif abs(x) == 1: # Collinear
>                     if point_on_line(p, pj0, pj1): # new is on j0 - j1
>                         #print('collinear new on
> j0-j1',pj0,pj1,current_point,p)
>                         # is j1 on cp - new?
>                         if point_in_box(pj1, current_point, p):
>                             k = j1 # ear is j1 ... cp
>                         else: # j0 is on cp - new
>                             k = j0 # ear is j0 ... cp
>                         ear = self.get_noose(k, i0)
>                         self.delete_points(j1, i0)
>                         i0 = j0
>                         index = j1
>                         break
>                     elif point_on_line(pj1, current_point, p): # j1 is on
> cp - new
>                         #print('collinear j1 on
> cp-new',pj0,pj1,current_point,p)
>                         # ear is j1 ... cp
>                         ear = self.get_noose(j1, i0)
>                         self.delete_points(j1, i0)
>                         i0 = j0
>                         index = j1
>                         break
>                 j0 = j1
>
>         if not close:
>             self.points[index] = [i0, self.root, p]
>             self.points[i0][1] = index
>             self.points[self.root][0] = index
>         return ear
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> --
> Hälsningar
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins väg 12 Kristianstad
> mobile: +46 733 206831
> mailto: ao at t-kartor.sehttp://www.t-kartor.com
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
***********************************************************************************
Chao YUE（岳超）
西北农林科技大学水土保持研究所 研究员
黄土高原土壤侵蚀与旱地农业国家重点实验室
State Key Laboratory of Soil Erosion and Dryland Farming on the Loess
Plateau
Institute of Soil and Water Conservation
Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
chaoyue at ms.iswc.ac.cn
Mobile: +86 18709187546
************************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/08fdea69/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: InnerLoop.png
Type: image/png
Size: 30127 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/08fdea69/attachment-0001.png>

From ao at t-kartor.se  Wed Apr 15 06:31:45 2020
From: ao at t-kartor.se (Andreas Oxenstierna)
Date: Wed, 15 Apr 2020 15:31:45 +0200
Subject: [gdal-dev] Algorithm to clip the inner loop of a polygon
In-Reply-To: <CAAN-aRF36mPjcicaKPzg5u3NZpy0=hvv_EQYtvhxJpeuHc7b_g@mail.gmail.com>
References: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
 <aeff7777-d05b-415c-e2d6-cb7ff62bac83@gmail.com>
 <154d7069-6cd0-4b85-da02-75cdc00bf746@t-kartor.se>
 <3180ff8f-4764-014d-163a-e3fbf88e1d74@gmail.com>
 <CAAN-aRF36mPjcicaKPzg5u3NZpy0=hvv_EQYtvhxJpeuHc7b_g@mail.gmail.com>
Message-ID: <3072e4ca-1213-6880-22b5-6698e6a976d8@t-kartor.se>

Hi

I see that I forgot to create polygons from the splitted lines

Sp the syntax should be something like:
ST_ExteriorRing((ST_Dump(ST_Polygonize(ST_LineMerge(ST_Union(ST_Force2D(<your 
geometry>)))))).geom)

> Hi Ari and Andreas,
>
> Thanks for the information. I will check it out. Today I advanced a 
> little by almost implementing what's been proposed in my message there.
>
> Regards,
> Chao
>
> On Wed, Apr 15, 2020 at 3:04 PM Ari Jolma <ari.jolma at gmail.com 
> <mailto:ari.jolma at gmail.com>> wrote:
>
>     Andreas Oxenstierna kirjoitti 15.4.2020 klo 9.03:
>>     Hi
>>
>>     Have you tested PostGIS?
>>     ST_ExteriorRing((ST_Dump(ST_LineMerge(ST_Union(ST_Force2D(<your
>>     geometry>))))).geom)
>>
>>     should extract the points you want to keep by splitting at
>>     intersections - but it may fail in very complex cases. Then I
>>     would start with a ST_SnapToGrid with a quite high tolerance to
>>     lower the coordinate resolution.
>
>
>     That PostGIS solution looks quite nice. Unfortunately I was not
>     able to use PostGIS in my case but were restricted to Shapely,
>     which uses GEOS. But then, PostGIS is mostly based on GEOS, so it
>     should perhaps be doable that way too. I'm not working or using
>     that solution I gave right now so won't test it.
>
>     Best,
>
>     Ari
>
>
>>
>>
>>>     Hi,
>>>
>>>     I wrote a method to a Polygon class (in Python) that solves that
>>>     problem because the ones in GEOS via Shapely did not seem good
>>>     enough. My method was based on no published algorithm but just
>>>     my own reasoning, it is probably not optimal speed-wise. I did
>>>     not perform formal testing on it but it worked on my data, which
>>>     was quite large. The basic idea was to build the polygon by
>>>     adding points and when adding test for self intersections /
>>>     collinearity against existing segments. The method returns the
>>>     loops while points are added. The code is not in a public repo
>>>     but I'll add the method below. It needs some basic methods and
>>>     function which should be simple to add.
>>>
>>>     Ari
>>>
>>>     Chao YUE kirjoitti 15.4.2020 klo 6.30:
>>>>     Dear all,
>>>>
>>>>     Does anyone have some experience or is aware of some
>>>>     algorithm that can find and clip the inner loop formed in a
>>>>     polygon ? I attach one example here. In this case I would only
>>>>     keep the outer points and drop the ones that make an inner
>>>>     loop. I am developing some algorithm to simulate wildland fire
>>>>     propagation. The algorithm is based on Richards 1990.
>>>>
>>>>     In the paper he described an algorithm based on two steps: (1)
>>>>     find the points where a concave curvature is made. (2) search
>>>>     for both sides of this point to see where any two line segments
>>>>     cross over each other.
>>>>     But I am wondering whether there is already some existing
>>>>     solutions or other better ones.
>>>>
>>>>     Thanks a lot for the kind help for any hints on this !
>>>>     Kind regards,
>>>>     Chao
>>>>
>>>>     Gwynfor Richards, 1990. An elliptical growth model of forest
>>>>     fire fronts and its numerical solution. International journal
>>>>     for Numerical Methods in Engineering, Vol. 30, 1163-1179.
>>>>
>>>>     InnerLoop.png
>>>>
>>>>     -- 
>>>>     ***********************************************************************************
>>>>     Chao YUE（岳超）
>>>>     西北农林科技大学水土保持研究所 研究员
>>>>     黄土高原土壤侵蚀与旱地农业国家重点实验室
>>>>     State Key Laboratory of Soil Erosion and Dryland Farming on the
>>>>     Loess Plateau
>>>>     Institute of Soil and Water Conservation
>>>>     Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
>>>>     chaoyue at ms.iswc.ac.cn <mailto:chaoyue at ms.iswc.ac.cn>
>>>>     Mobile: +86 18709187546
>>>>     ************************************************************************************
>>>>
>>>>     _______________________________________________
>>>>     gdal-dev mailing list
>>>>     gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>>>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>>
>>>     Code copyright Simosol Oy, licence MIT
>>>
>>>     def add_point(self, p=None):
>>>             """ Add a point to the end of points (before root)
>>>             The first level ear (hole or in-a-point-intersecting
>>>     polygon) is returned
>>>             if there is such.
>>>             p -- point to add, if None, close the ring
>>>
>>>         self is a Polygon, which has as attributes a dict of points,
>>>     where
>>>         point = [index of previous point, index of next point, coords]
>>>         no duplicates, no null indexes in points
>>>
>>>                """
>>>             n = self.n_points()
>>>             if p is None and n < 3:
>>>                 raise ValueError("Can't close a polygon with less
>>>     than three points.")
>>>             if self.root is None:
>>>                 self.root = 0
>>>                 self.points[self.root] = [self.root, self.root, p]
>>>                 return
>>>             i0 = self.points[self.root][0]
>>>             if p is not None and p[0] == self.points[i0][2][0] and
>>>     p[1] == self.points[i0][2][1]:
>>>                 # same point, skip
>>>                 return None
>>>             index = i0 + 1
>>>             while index in self.points:
>>>                 index += 1
>>>             ear = None
>>>             close = False
>>>             if n > 2:
>>>                 # test for self-intersection,
>>>                 # current - new against (0-1, )1-2, ...
>>>     prev(current)-current
>>>                 current_point = self.get_point(i0)
>>>                 j0 = self.root
>>>                 if p is None: # close
>>>                     p = self.get_point(self.root)
>>>                     j0 = self.index_of_next_point(j0)
>>>                     close = True
>>>                 while True:
>>>                     j1 = self.index_of_next_point(j0)
>>>                     if j1 == i0:
>>>                         break
>>>                     pj0 = self.get_point(j0)
>>>                     pj1 = self.get_point(j1)
>>>                     x = get_line_intersection(pj0, pj1,
>>>     current_point, p)
>>>
>>>                     if type(x) is tuple: # Intersection
>>>     #print('intersection',pj0,pj1,current_point,p)
>>>                         # snip away and return eventually the closed
>>>     part
>>>                         ear = self.get_noose(j1, i0, first_point=x)
>>>                         # set new j1 and delete from j1+1 ... current
>>>                         self.set_point(j1, x)
>>>                         j2 = self.index_of_next_point(j1)
>>>                         self.delete_points(j2, i0)
>>>                         i0 = j0
>>>                         index = j1
>>>                         break
>>>
>>>                     elif abs(x) == 1: # Collinear
>>>                         if point_on_line(p, pj0, pj1): # new is on
>>>     j0 - j1
>>>                             #print('collinear new on
>>>     j0-j1',pj0,pj1,current_point,p)
>>>                             # is j1 on cp - new?
>>>                             if point_in_box(pj1, current_point, p):
>>>                                 k = j1 # ear is j1 ... cp
>>>                             else: # j0 is on cp - new
>>>                                 k = j0 # ear is j0 ... cp
>>>                             ear = self.get_noose(k, i0)
>>>                             self.delete_points(j1, i0)
>>>                             i0 = j0
>>>                             index = j1
>>>                             break
>>>                         elif point_on_line(pj1, current_point, p): #
>>>     j1 is on cp - new
>>>                             #print('collinear j1 on
>>>     cp-new',pj0,pj1,current_point,p)
>>>                             # ear is j1 ... cp
>>>                             ear = self.get_noose(j1, i0)
>>>                             self.delete_points(j1, i0)
>>>                             i0 = j0
>>>                             index = j1
>>>                             break
>>>                     j0 = j1
>>>
>>>             if not close:
>>>                 self.points[index] = [i0, self.root, p]
>>>                 self.points[i0][1] = index
>>>                 self.points[self.root][0] = index
>>>             return ear
>>>
>>>
>>>     _______________________________________________
>>>     gdal-dev mailing list
>>>     gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>     -- 
>>     Hälsningar
>>
>>     Andreas Oxenstierna
>>     T-Kartor Geospatial AB
>>     Olof Mohlins väg 12 Kristianstad
>>     mobile: +46 733 206831
>>     mailto:ao at t-kartor.se  <mailto:ao at t-kartor.se>
>>     http://www.t-kartor.com
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> -- 
> ***********************************************************************************
> Chao YUE（岳超）
> 西北农林科技大学水土保持研究所 研究员
> 黄土高原土壤侵蚀与旱地农业国家重点实验室
> State Key Laboratory of Soil Erosion and Dryland Farming on the Loess 
> Plateau
> Institute of Soil and Water Conservation
> Northwest A&F University, Yangling, Shaanxi 712100, P.R. China
> chaoyue at ms.iswc.ac.cn <mailto:chaoyue at ms.iswc.ac.cn>
> Mobile: +86 18709187546
> ************************************************************************************


-- 
Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins väg 12 Kristianstad
mobile: +46 733 206831
mailto: ao at t-kartor.se
http://www.t-kartor.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/f823edf6/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: InnerLoop.png
Type: image/png
Size: 30127 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/f823edf6/attachment-0001.png>

From louis-philippe.rousseaulambert2 at canada.ca  Wed Apr 15 06:58:27 2020
From: louis-philippe.rousseaulambert2 at canada.ca (Rousseau Lambert2, Louis-Philippe (EC))
Date: Wed, 15 Apr 2020 13:58:27 +0000
Subject: [gdal-dev] NetCDF rotated grid support
References: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>
 <4840350.Rbt4YPPae9@even-i700>
Message-ID: <mailman.31.1586959120.17181.gdal-dev@lists.osgeo.org>

Thanks Even for your answer.

Than I guess it's a problem with my NetCDF projection definition since it is not projected correctly when I view it...

I also found out that I cannot reproject those NetCDF (with a rotated grid) to a standard projection like EPSG:4326, it fails with:

ERROR 1: Too many points (441 out of 441) failed to transform, unable to compute output bounds.

I will try to solve this with the data producer

Thanks

LP

On 2020-04-14 13:26, Even Rouault wrote:

Louis-Phillipe,



Reading netCDF or GRIB2 rotated grids works, but not writing them to netCDF. That could potentially be added, but this is not handled currently.



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/5f00fc02/attachment.html>

From even.rouault at spatialys.com  Wed Apr 15 07:13:05 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Apr 2020 16:13:05 +0200
Subject: [gdal-dev] NetCDF rotated grid support
References: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>
 <4840350.Rbt4YPPae9@even-i700>
Message-ID: <1687475.bTrxGPkrb0@even-i700>

Louis-Philippe,

Support for rotated grid is a nightmare due to different conventions used for GRIB, netCDF 
or PROJ ob_tran method. The GDAL GRIB and netCDF drivers normally do what is needed 
map from the native product convention to the PROJ one.

Below 2 emails I wrote some time ago the OGC CRS SWG group which might bring some light 
(or deep obscurity!) to this topic:

1)

Rotated pole/grid
From:	Even Rouault <even.rouault at spatialys.com>
To:	"crs.swg at lists.opengeospatial.org" <crs.swg at lists.opengeospatial.org>
Date:	03/10/2019 14:26
Hi again,

(was initially a part of my previous email about "Expressing a ProjectedCRS of 
a DerivedGeographicCRS", but this deserves its own thread)

Standardization of rotated pole is another interesting/annoying topic I've 
discussed with a few people privately. This tends to be tricky as I always 
stumble on different conventions regarding the semantics of parameters and the 
maths behind.

For posterity, and my own recollection, here are my latest findings:

1) PROJ's ob_tran (https://proj.org/operations/projections/ob_tran.html) 
formulas are a straightforward implementation from Snyder's "Map projections - 
a working manual", in particular equations (5-7) and (5-8b) for the forward 
path, at page 31 of https://pubs.usgs.gov/pp/1395/report.pdf

(although I've some disagreement with the 'new pole' terminology currently 
used in the above HTML help page:
https://github.com/OSGeo/PROJ/pull/1653 )

2) But they are different from the conventions used for PDS3 or ISIS3 
planetary image formats, a bit like if the forward and inverse paths had been 
switched, so you need to 'switch' parameters, do crazy things like 180 - 
pole_latitude, etc when crossing different conventions... Interestingly one 
doc for PDS3 mentions at the middle of page 10 of https://pds-imaging.jpl.nasa.gov/
documentation/Cassini_BIDRSIS.PDF that "The  derivation  
of  these  equations  is  given  in  reference  [12],  p.  29—32,  but  a  
critical  pair  of signs  appear  to  be  exchanged  between  the  formulae  
for  the  forward  and  inverse  transformations.    Reference  [13],  p.  6,  
gives  the  correct  forward  transformation,  and  reference  [14],  pp.  77—
78,  give  both  the  forward  and  inverse  transformations"

"reference [12] p29-32" is Snyder's "Map projections - a working manual" I 
mentionned before. So this somewhat acknowledges the existence of different 
conventions (not sure if there are really "wrong" and "correct" ones)
reference [13] is "Bugayevskiy, L. M., and Snyder, J. P., 1995, Map 
projections: A reference manual, Taylor & Francis, London and Bristol, 
Pennsylvania, 328 pp."
and [14] "Yang, Q. H., Snyder, J. P., and Tobler, W. R., 2000, Map projection 
transformations: Principles and applications, Taylor & Francis, London and 
Bristol, Pennsylvania, 367 pp"

PDS/ISIS3 implementation of [13] and [14] is in
https://github.com/USGS-Astrogeology/ISIS3/blob/3.8.0/isis/src/base/objs/
ObliqueCylindrical/ObliqueCylindrical.cpp#L311

3) When dealing with netCDF rotated pole, I've also seen issues with 
conventions.
An implementation of that convention is in netcdf-java:
https://github.com/Unidata/netcdf-java/blob/
3ce72c0cd167609ed8c69152bb4a004d1daa9273/cdm/core/src/main/java/ucar/unidata/
geoloc/projection/RotatedPole.java

4) GRIB2 also uses a yet another different convention (with south pole 
coordinates as parameters)
An implementation of that convention is also in netcdf-java in
https://github.com/Unidata/netcdf-java/blob/
3ce72c0cd167609ed8c69152bb4a004d1daa9273/cdm/core/src/main/java/ucar/unidata/
geoloc/projection/RotatedLatLon.java
I was also pointed by a data producer of GRIB2 rotated pole datasets that they 
used https://www.mathworks.com/matlabcentral/fileexchange/43435-rotated-grid-transform?focused=3795951&tab=function&ue&nocookie=true as the inspiration for 
their maths, and luckily it gives consistent result with the Java 
RotatedLatLon code.


All in all, a lot of confusion which I think depends if you consider north 
pole vs south pole, or the coordinates of the unrotated pole in the rotated 
grid, or the coordinates of the new rotated pole in the unrotated grid...

As far as I experimented, there's always a way of using a given implementation 
(in my case ob_tran) with the other conventions by tweaking the values of the 
3 angular parameters. So, despite the diversity of conventions, considering 
standardizing one could still be useful.

Even

2)

Re: Rotated pole/grid
From:	Even Rouault <even.rouault at spatialys.com>
To:	"crs.swg at lists.opengeospatial.org" <crs.swg at lists.opengeospatial.org>
Date:	22/11/2019 02:35
Hi,

reviving this not-so-exciting topic :-)...

For the purpose of dealing with GRIB rotated long/lat grids,
https://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_doc/grib2_temp3-1.shtml,
I'm about to use a "Pole rotation (GRIB convention)" conversion method with
the following 3 parameters, whose naming and semantics comes mostly from the above GRIB 
spec:

- "Latitude of the southern pole (GRIB convention)"
        
 Latitude of the point from the unrotated
 CRS, expressed in the unrotated CRS, that will become the south pole of the
 rotated CRS.

- "Longitude of the southern pole (GRIB convention)"

 Longitude of the point from the unrotated
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/1e55b456/attachment-0001.html>

From aritchie at usgs.gov  Wed Apr 15 12:25:46 2020
From: aritchie at usgs.gov (Ritchie, Andrew C)
Date: Wed, 15 Apr 2020 19:25:46 +0000
Subject: [gdal-dev] [EXTERNAL] Re: gdal_translate (3.1.0dev) "never"
 finishes on large jpeg cogs... REALLLLLY long time to unload.
In-Reply-To: <1751363.68K9FcAoKA@even-i700>
References: <BY5PR09MB555454E3740C7F3A57C26437B1DB0@BY5PR09MB5554.namprd09.prod.outlook.com>
 <1751363.68K9FcAoKA@even-i700>
Message-ID: <BY5PR09MB55549269873F41A6148E9163B1DB0@BY5PR09MB5554.namprd09.prod.outlook.com>

Hi Even,

Thanks for the quick response! The source dataset is a LZW cog with RGBA, and I confirmed (I think) that the issue was the mask layer by playing with the switches I used to generate the LZW cog - I didn't even have to do a JPEG COG. I can cause the same, or very similar behavior, by changing from:

-b 1 -b 2 -b 3 -b 4
to:
-b 1 -b 2 -b 3 -mask 4

with GDAL_TIFF_INTERNAL_MASK YES.

With the -b 4 switch (or omitting all -b and -mask switches), I get LZW cogs in 2 minutes. With -mask 4 I get hung up at 20% with directory thrashing messages in debug for at least 30 minutes, and I'm guessing I'll get the same behavior at the "done" message if I care to wait.

Below are the two configurations that show such a difference in performance for me. I didn't play around with CACHEMAX or MAX_DATASET_POOL_SIZE, was trying to keep it simple.

2 minute TIFFs:
gdal_translate <infile> <outfile> -b 1 -b 2 -b 3 -b 4 -of COG -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUS -co RESAMPLING=AVERAGE -config GDAL_TIFF_INTERNAL_MASK YES -config GDAL_TIF_OVR_BLOCKSIZE 128

A couple orders of magnitude longer:
gdal_translate <infile> <outfile> -b 1 -b 2 -b 3 -mask 4 -of COG -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUS -co RESAMPLING=AVERAGE -config GDAL_TIFF_INTERNAL_MASK YES -config GDAL_TIF_OVR_BLOCKSIZE 128

From: Even Rouault <even.rouault at spatialys.com>
Sent: Wednesday, April 15, 2020 4:38 AM
To: gdal-dev at lists.osgeo.org
Cc: Ritchie, Andrew C <aritchie at usgs.gov>
Subject: [EXTERNAL] Re: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large jpeg cogs... REALLLLLY long time to unload.


Andrew,

Has your source raster an alpha band ? That could explain the difference since it isn't possible to directly create a YCbCrA JPEG compressed file, but internally a mask band must be created. However I wouldn't anticipate such a huge difference in performance between compression schemes. I would suggest not setting GDAL_CACHEMAX at all and letting it at its 5% default (increasing it is not always a good idea), in case it would be a performance issue at de-allocating cached blocks.

Even

--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200415/769efa58/attachment.html>

From even.rouault at spatialys.com  Thu Apr 16 16:16:31 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 17 Apr 2020 01:16:31 +0200
Subject: [gdal-dev] Windows CI build times
Message-ID: <6887462.ldcPOGF9r1@even-i700>

Hi,

I've been a bit frustrated lately by the time spent on the GDAL AppVeyor CI builds: roughly 50 
minutes for each of the two configs we test, VS 2017 x86 and VS 2015 x64, which can cause 
huge delays in case of busy days with many pull requests etc. (those delays also impact PROJ 
since the limitation to one simultaneous build is for the whole OSGeo GitHub organization)

The immediate solution would be to just test VS 2017 x64 to cut that time down and drop 
VS2015 and x64 testing. However as strange as it sounds, there are still people using x86 
builds...

I guess porting to Azure Pipelines (which we already use to refresh gdal.org) could be a 
solution as well, since apparently they have a 10 concurrent job limit ( according to 
https://docs.microsoft.com/en-us/azure/devops/pipelines/licensing/concurrent-jobs?
view=azure-devops )

A ccache type of builds could also help since we rarely change headers. I believe I tried to 
investigate that in the past but didn't find anything really working.

If someone is looking for ideas for contribution...

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/02842297/attachment.html>

From mwtoews at gmail.com  Thu Apr 16 16:45:04 2020
From: mwtoews at gmail.com (Mike Taves)
Date: Fri, 17 Apr 2020 11:45:04 +1200
Subject: [gdal-dev] Windows CI build times
In-Reply-To: <6887462.ldcPOGF9r1@even-i700>
References: <6887462.ldcPOGF9r1@even-i700>
Message-ID: <CAM2FmMoaJwYUocZT-dJDL3wchtPc3oT1ny0FB6gkU-QgiMd4ww@mail.gmail.com>

Hi Even,

Yes, I agree these times are way longer than they should take.

It looks like Howard was investigating AZP:
https://github.com/OSGeo/PROJ/tree/azp how is that going?

It seems that many projects have shifted from AppVeyor to AZP for
performance benefits.

As you mentioned, some of the dependencies could be built and cached,
rather than using vcpkg. This is a bit more complicated, since each of
the components are built differently.

Another suggestion is to use a Ninja CMake generator (-GNinja), which
is available with AppVeyor.

On Fri, 17 Apr 2020 at 11:17, Even Rouault <even.rouault at spatialys.com> wrote:
>
> Hi,
>
> I've been a bit frustrated lately by the time spent on the GDAL AppVeyor CI builds: roughly 50 minutes for each of the two configs we test, VS 2017 x86 and VS 2015 x64, which can cause huge delays in case of busy days with many pull requests etc. (those delays also impact PROJ since the limitation to one simultaneous build is for the whole OSGeo GitHub organization)
>
> The immediate solution would be to just test VS 2017 x64 to cut that time down and drop VS2015 and x64 testing. However as strange as it sounds, there are still people using x86 builds...
> I guess porting to Azure Pipelines (which we already use to refresh gdal.org) could be a solution as well, since apparently they have a 10 concurrent job limit ( according to
> https://docs.microsoft.com/en-us/azure/devops/pipelines/licensing/concurrent-jobs?view=azure-devops )
>
> A ccache type of builds could also help since we rarely change headers. I believe I tried to investigate that in the past but didn't find anything really working.
>
> If someone is looking for ideas for contribution...

From mateusz at loskot.net  Thu Apr 16 17:46:31 2020
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 17 Apr 2020 02:46:31 +0200
Subject: [gdal-dev] Windows CI build times
In-Reply-To: <CAM2FmMoaJwYUocZT-dJDL3wchtPc3oT1ny0FB6gkU-QgiMd4ww@mail.gmail.com>
References: <6887462.ldcPOGF9r1@even-i700>
 <CAM2FmMoaJwYUocZT-dJDL3wchtPc3oT1ny0FB6gkU-QgiMd4ww@mail.gmail.com>
Message-ID: <CABUeae-1gB64sbpyEh2vW-Ce1nMv7gCZWfjAto50Oc-a7C_jZw@mail.gmail.com>

On Fri, 17 Apr 2020 at 01:45, Mike Taves <mwtoews at gmail.com> wrote:
>
> It seems that many projects have shifted from AppVeyor to AZP for
> performance benefits.

Or GitHub Actions, which is an incarnation of AzP.

> As you mentioned, some of the dependencies could be built and cached,
> rather than using vcpkg.

caching can work for the vcpkg installs on AppVeyor easily
https://github.com/boostorg/gil/blob/develop/.appveyor.yml#L75-L76

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From hellik at web.de  Fri Apr 17 06:45:30 2020
From: hellik at web.de (Helmut Kudrnovsky)
Date: Fri, 17 Apr 2020 06:45:30 -0700 (MST)
Subject: [gdal-dev] extracting only raster from a geotiff with internal
	overviews
Message-ID: <1587131130871-0.post@n6.nabble.com>

hi,

there is a large raster file (8GB) available:

http://users.cbk.waw.pl/~mkrupinski/S2GLC_Europe_2017_v1.1_grey.zip

with quite heavy internal overviews.

what I want to do, is to get rid of the internal overviews and a smaller
file.

when I do a gdal_translate to a target geotiff, are the overviews copied to
the target geotiff too?

in

https://gdal.org/drivers/raster/gtiff.html

COPY_SRC_OVERVIEWS=[YES/NO]: (CreateCopy() only) By setting this to YES
(default is NO), the potential existing overviews of the source dataset will
be copied to the target dataset without being recomputed. [...] Note that
this creation option will have no effect if general options (i.e. options
which are not creation options) of gdal_translate are used. Creation options
related to compression are also applied to the output overviews.

I've read in https://gdal.org/programs/gdaladdo.html

For internal GeoTIFF overviews (or external overviews in GeoTIFF format),
note that -clean does not shrink the file. 

gdaladdo -clean removes only the pointer to the overviews.

thanks



-----
best regards
Helmut
--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jmckenna at gatewaygeomatics.com  Fri Apr 17 06:50:54 2020
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Fri, 17 Apr 2020 10:50:54 -0300
Subject: [gdal-dev] Windows CI build times
In-Reply-To: <6887462.ldcPOGF9r1@even-i700>
References: <6887462.ldcPOGF9r1@even-i700>
Message-ID: <fdcfc786-9672-a563-0996-b4d7df6bae5c@gatewaygeomatics.com>

Hi Even,

I would vote for removing the VS2015 testing.

-jeff



On 2020-04-16 8:16 p.m., Even Rouault wrote:
> Hi,
> 
> I've been a bit frustrated lately by the time spent on the GDAL AppVeyor 
> CI builds: roughly 50 minutes for each of the two configs we test, VS 
> 2017 x86 and VS 2015 x64, which can cause huge delays in case of busy 
> days with many pull requests etc. (those delays also impact PROJ since 
> the limitation to one simultaneous build is for the whole OSGeo GitHub 
> organization)
> 
> The immediate solution would be to just test VS 2017 x64 to cut that 
> time down and drop VS2015 and x64 testing. However as strange as it 
> sounds, there are still people using x86 builds...
> 
> I guess porting to Azure Pipelines (which we already use to refresh 
> gdal.org) could be a solution as well, since apparently they have a 10 
> concurrent job limit ( according to
> 
> https://docs.microsoft.com/en-us/azure/devops/pipelines/licensing/concurrent-jobs?view=azure-devops 
> )
> 
> A ccache type of builds could also help since we rarely change headers. 
> I believe I tried to investigate that in the past but didn't find 
> anything really working.
> 
> If someone is looking for ideas for contribution...
> 
> Even
> 
> -- 
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com
> 
> 

From even.rouault at spatialys.com  Fri Apr 17 07:53:37 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 17 Apr 2020 16:53:37 +0200
Subject: [gdal-dev] extracting only raster from a geotiff with internal
	overviews
In-Reply-To: <1587131130871-0.post@n6.nabble.com>
References: <1587131130871-0.post@n6.nabble.com>
Message-ID: <21169522.j8WZYuqDG9@even-i700>

> when I do a gdal_translate to a target geotiff, are the 
overviews copied to
> the target geotiff too?

No. Do not hesitate to submit a PR with a doc improvement as 
apparently it is not clear enough.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/07eede1f/attachment.html>

From yanns.tremblay at gmail.com  Fri Apr 17 09:53:34 2020
From: yanns.tremblay at gmail.com (Yann-Sebastien Tremblay-Johnston)
Date: Fri, 17 Apr 2020 09:53:34 -0700
Subject: [gdal-dev] Interpolation used for egm96_15.gtx when using
	RPC_DEM_APPLY_VDATUM_SHIFT
Message-ID: <CA++BqZCynR4mgCP_ESr=TU10SgKbg-HS3WLfiwxbbfT2Kg0r8A@mail.gmail.com>

Hi,



I spent a bit of time learning about vertical datum shifts when performing
RPC coordinate transformations using a DEM this week, and I was curious
about how the egm96_15.gtx file is interpolated. I was able to find in
gdal_rpc.cpp that the required vdatum shift is calculated using an OGR
Coordinate Transformation between the DEM spatial reference and a wgs84
ellipsoid spatial reference, but I’m not familiar enough with OGR/PROJ to
understand exactly how the gtx file is sampled.



Would anyone be able to shed a bit of light on this or point me in the
right direction?



Cheers,


Sebastien
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/f2a6f02f/attachment-0001.html>

From even.rouault at spatialys.com  Fri Apr 17 10:09:39 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 17 Apr 2020 19:09:39 +0200
Subject: [gdal-dev] Interpolation used for egm96_15.gtx when using
	RPC_DEM_APPLY_VDATUM_SHIFT
In-Reply-To: <CA++BqZCynR4mgCP_ESr=TU10SgKbg-HS3WLfiwxbbfT2Kg0r8A@mail.gmail.com>
References: <CA++BqZCynR4mgCP_ESr=TU10SgKbg-HS3WLfiwxbbfT2Kg0r8A@mail.gmail.com>
Message-ID: <3207605.fANtN6pQPf@even-i700>

Yann-Sebastien,

> I spent a bit of time learning about vertical datum shifts when performing
> RPC coordinate transformations using a DEM this week, and I was curious
> about how the egm96_15.gtx file is interpolated. I was able to find in
> gdal_rpc.cpp that the required vdatum shift is calculated using an OGR
> Coordinate Transformation between the DEM spatial reference and a wgs84
> ellipsoid spatial reference, but I’m not familiar enough with OGR/PROJ to
> understand exactly how the gtx file is sampled.

To start with, you need the the dataset pointed by RPC_DEM is a compoundCRS with a 
vertical CRS properly defined and an existing transformation between that vertical CRS 
and WGS84, so if it is something like EPSG:XXXX+5773, that will be fine.
Interpolation of the geoid grid is done by PROJ itself, and this is bilinear interpolation.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/f19746fe/attachment.html>

From yanns.tremblay at gmail.com  Fri Apr 17 10:27:37 2020
From: yanns.tremblay at gmail.com (Yann-Sebastien Tremblay-Johnston)
Date: Fri, 17 Apr 2020 10:27:37 -0700
Subject: [gdal-dev] Interpolation used for egm96_15.gtx when using
	RPC_DEM_APPLY_VDATUM_SHIFT
In-Reply-To: <3207605.fANtN6pQPf@even-i700>
References: <CA++BqZCynR4mgCP_ESr=TU10SgKbg-HS3WLfiwxbbfT2Kg0r8A@mail.gmail.com>
 <3207605.fANtN6pQPf@even-i700>
Message-ID: <CA++BqZDFO_9cr7+OrbhTgW1XchytBu83nvQFYrXGigcLVMF2SA@mail.gmail.com>

Hi Even,

To start with, you need the the dataset pointed by RPC_DEM is a compoundCRS
> with a vertical CRS properly defined


Thanks, I initially didn't understand why this wasn't working as the SRTM
DEM I am using does not have a compoundCRS. I worked around this by
creating a VRT with the correct compoundCRS.

 Interpolation of the geoid grid is done by PROJ itself, and this is
> bilinear interpolation


Awesome, good to know. Is there anyway of configuring this?

Thanks for the quick response.

Sebastien

On Fri, Apr 17, 2020 at 10:09 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Yann-Sebastien,
>
>
>
> > I spent a bit of time learning about vertical datum shifts when
> performing
>
> > RPC coordinate transformations using a DEM this week, and I was curious
>
> > about how the egm96_15.gtx file is interpolated. I was able to find in
>
> > gdal_rpc.cpp that the required vdatum shift is calculated using an OGR
>
> > Coordinate Transformation between the DEM spatial reference and a wgs84
>
> > ellipsoid spatial reference, but I’m not familiar enough with OGR/PROJ to
>
> > understand exactly how the gtx file is sampled.
>
>
>
> To start with, you need the the dataset pointed by RPC_DEM is a
> compoundCRS with a vertical CRS properly defined and an existing
> transformation between that vertical CRS and WGS84, so if it is something
> like EPSG:XXXX+5773, that will be fine.
>
> Interpolation of the geoid grid is done by PROJ itself, and this is
> bilinear interpolation.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/f4b05034/attachment.html>

From even.rouault at spatialys.com  Fri Apr 17 10:34:03 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 17 Apr 2020 19:34:03 +0200
Subject: [gdal-dev] Interpolation used for egm96_15.gtx when using
	RPC_DEM_APPLY_VDATUM_SHIFT
In-Reply-To: <CA++BqZDFO_9cr7+OrbhTgW1XchytBu83nvQFYrXGigcLVMF2SA@mail.gmail.com>
References: <CA++BqZCynR4mgCP_ESr=TU10SgKbg-HS3WLfiwxbbfT2Kg0r8A@mail.gmail.com>
 <3207605.fANtN6pQPf@even-i700>
 <CA++BqZDFO_9cr7+OrbhTgW1XchytBu83nvQFYrXGigcLVMF2SA@mail.gmail.com>
Message-ID: <1683691.0gJLl47bDp@even-i700>

>  Interpolation of the geoid grid is done by PROJ itself, and this is
> > bilinear interpolation
> 
> Awesome, good to know. Is there anyway of configuring this?

Depends on your definition of configuring. As it is open source, everything is 
somehow configurable. Here changing the lines of code starting at
https://github.com/OSGeo/PROJ/blob/master/src/grids.cpp#L3226 :-)

But people seem to be generally happy with bilinear interpolation.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/f728eff9/attachment.html>

From andrea.aime at geo-solutions.it  Fri Apr 17 10:55:06 2020
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Fri, 17 Apr 2020 19:55:06 +0200
Subject: [gdal-dev] Does OGR support GeoPackage enums in write mode (or
	at all?)
In-Reply-To: <CA+nxMTu19nDf7mBb4ihSRYqG3UZG42tqiiwb7OAS6fTnNheeeQ@mail.gmail.com>
References: <CA+nxMTtX5rpUdS+BSV7Ethwd4Vk0y9R6pDoauw5eGLRoZwrRxA@mail.gmail.com>
 <3039740.UpMh5NMGPr@even-i700>
 <CA+nxMTu19nDf7mBb4ihSRYqG3UZG42tqiiwb7OAS6fTnNheeeQ@mail.gmail.com>
Message-ID: <CA+nxMTvyRBMz5AHmZd8AgX9MJ5Vie9AYgP5gfzi6tNts3HGmVg@mail.gmail.com>

HI Even,
talked with Jeff Yutzler, he confirmed enums are meant to be used as I
described before, but their support
has been not picked up in libraries. Believe I'm going to implement it in
GeoTools soon.

Cheers
Andrea


On Wed, Apr 15, 2020 at 11:56 AM Andrea Aime <andrea.aime at geo-solutions.it>
wrote:

> On Wed, Apr 15, 2020 at 11:36 AM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> > http://www.geopackage.org/spec/
>>
>>
>>
>> My understanding of table 27 is that it is just to define constraints on
>> the values of a column, but not a way to establish a integer<-->string
>> mapping as you'd like. Unless I'm missing something. Of course you could
>> create an auxiliary table with the mapping, but I'm not aware of a
>> standardized way of registering it.
>>
>
> I had the idea because Table 27 lists enum values (in the "value" column)
> as 1, 2, 3, and while not providing an example of it,
> gpkg_data_column_constraints
> also has a "description" column. so my current guess is that one could use
> integer numbers in "value", and provide the name of the value in
> "description".
> I'm going to follow up with the OGC spec lead to see if that was an actual
> option, or just a thing in my mind... and will let you know what comes out
> of it :-D
>
> Cheers
> Andrea
>
> ==
>
> GeoServer Professional Services from the experts! Visit
> http://goo.gl/it488V for more information. == Ing. Andrea Aime @geowolf
> Technical Lead GeoSolutions S.A.S. Via di Montramito 3/A 55054 Massarosa
> (LU) phone: +39 0584 962313 fax: +39 0584 1660272 mob: +39 339 8844549
> http://www.geo-solutions.it http://twitter.com/geosolutions_it
> ------------------------------------------------------- *Con riferimento
> alla normativa sul trattamento dei dati personali (Reg. UE 2016/679 -
> Regolamento generale sulla protezione dei dati “GDPR”), si precisa che ogni
> circostanza inerente alla presente email (il suo contenuto, gli eventuali
> allegati, etc.) è un dato la cui conoscenza è riservata al/i solo/i
> destinatario/i indicati dallo scrivente. Se il messaggio Le è giunto per
> errore, è tenuta/o a cancellarlo, ogni altra operazione è illecita. Le
> sarei comunque grato se potesse darmene notizia. This email is intended
> only for the person or entity to which it is addressed and may contain
> information that is privileged, confidential or otherwise protected from
> disclosure. We remind that - as provided by European Regulation 2016/679
> “GDPR” - copying, dissemination or use of this e-mail or the information
> herein by anyone other than the intended recipient is prohibited. If you
> have received this email by mistake, please notify us immediately by
> telephone or e-mail.*
>


-- 

Regards, Andrea Aime

== GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information. == Ing. Andrea Aime @geowolf
Technical Lead GeoSolutions S.A.S. Via di Montramito 3/A 55054 Massarosa
(LU) phone: +39 0584 962313 fax: +39 0584 1660272 mob: +39 339 8844549
http://www.geo-solutions.it http://twitter.com/geosolutions_it
------------------------------------------------------- *Con riferimento
alla normativa sul trattamento dei dati personali (Reg. UE 2016/679 -
Regolamento generale sulla protezione dei dati “GDPR”), si precisa che ogni
circostanza inerente alla presente email (il suo contenuto, gli eventuali
allegati, etc.) è un dato la cui conoscenza è riservata al/i solo/i
destinatario/i indicati dallo scrivente. Se il messaggio Le è giunto per
errore, è tenuta/o a cancellarlo, ogni altra operazione è illecita. Le
sarei comunque grato se potesse darmene notizia. This email is intended
only for the person or entity to which it is addressed and may contain
information that is privileged, confidential or otherwise protected from
disclosure. We remind that - as provided by European Regulation 2016/679
“GDPR” - copying, dissemination or use of this e-mail or the information
herein by anyone other than the intended recipient is prohibited. If you
have received this email by mistake, please notify us immediately by
telephone or e-mail.*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/bea08985/attachment-0001.html>

From mulcahy.brianp at gmail.com  Fri Apr 17 12:49:58 2020
From: mulcahy.brianp at gmail.com (Brian)
Date: Fri, 17 Apr 2020 15:49:58 -0400
Subject: [gdal-dev] vsis3 to access a .vrt
Message-ID: <CANoBQebfQK4Mw=4Bu_LmCNCnxu9L1XNTxtkgksZB3FP4CJ=_xQ@mail.gmail.com>

Is using vsis3 to access a vrt possible? I have exhausted my debugging
skills. I can read .tifs just fine but as soon as I try a vrt it gives me
corrupt empty or missing file. The call for using vsis3 is coming from
mapserver but I thought this would be a gdal issue. Could anyone verify for
me that accessing a .vrt is possible with vsis3? If not how should I be
accessing it?

I am using GDAL_VERSION master on an ubuntu 18.04 pc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/51cc3737/attachment.html>

From even.rouault at spatialys.com  Fri Apr 17 14:07:20 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 17 Apr 2020 23:07:20 +0200
Subject: [gdal-dev] vsis3 to access a .vrt
In-Reply-To: <CANoBQebfQK4Mw=4Bu_LmCNCnxu9L1XNTxtkgksZB3FP4CJ=_xQ@mail.gmail.com>
References: <CANoBQebfQK4Mw=4Bu_LmCNCnxu9L1XNTxtkgksZB3FP4CJ=_xQ@mail.gmail.com>
Message-ID: <4084222.GJK34FQHHo@even-i700>

On vendredi 17 avril 2020 15:49:58 CEST Brian wrote:
> Is using vsis3 to access a vrt possible? I have exhausted my debugging
> skills. I can read .tifs just fine but as soon as I try a vrt it gives me
> corrupt empty or missing file. The call for using vsis3 is coming from
> mapserver but I thought this would be a gdal issue. Could anyone verify for
> me that accessing a .vrt is possible with vsis3? If not how should I be
> accessing it?

Works for me (TM). There's no reason that accessing .vrt through /vsis3/ wouldn't work as 
well/as worse than a .tif

You'd have to be more specific of what you do exactly, errors you get, etc etc

Perhaps check the content of the VRT itself. If source filenames are correct, if the 
relativeToVRT attribute is properly set, etc

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/412c6d79/attachment.html>

From mulcahy.brianp at gmail.com  Fri Apr 17 15:35:46 2020
From: mulcahy.brianp at gmail.com (Brian)
Date: Fri, 17 Apr 2020 18:35:46 -0400
Subject: [gdal-dev] vsis3 to access a .vrt
In-Reply-To: <4084222.GJK34FQHHo@even-i700>
References: <CANoBQebfQK4Mw=4Bu_LmCNCnxu9L1XNTxtkgksZB3FP4CJ=_xQ@mail.gmail.com>
 <4084222.GJK34FQHHo@even-i700>
Message-ID: <CANoBQebY0qsXyTp7a+jDKXCaoHg4EDN8xKExqKowEuh_rvd6NQ@mail.gmail.com>

Its strange because it works just fine when sitting on the filesystem, but
in a private bucket the error, cant find file or missing directory or
corrupt file,  shows. I don't have the error in front of me at the moment
so that may not be the exact words. I'll keep trying if I still can't get
it to work ill see if I can rig up some data I can share.

On Fri, Apr 17, 2020, 5:07 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> On vendredi 17 avril 2020 15:49:58 CEST Brian wrote:
>
> > Is using vsis3 to access a vrt possible? I have exhausted my debugging
>
> > skills. I can read .tifs just fine but as soon as I try a vrt it gives me
>
> > corrupt empty or missing file. The call for using vsis3 is coming from
>
> > mapserver but I thought this would be a gdal issue. Could anyone verify
> for
>
> > me that accessing a .vrt is possible with vsis3? If not how should I be
>
> > accessing it?
>
>
>
> Works for me (TM). There's no reason that accessing .vrt through /vsis3/
> wouldn't work as well/as worse than a .tif
>
>
>
> You'd have to be more specific of what you do exactly, errors you get, etc
> etc
>
>
>
> Perhaps check the content of the VRT itself. If source filenames are
> correct, if the relativeToVRT attribute is properly set, etc
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200417/1ba1a60d/attachment.html>

From ahmettemiz88 at gmail.com  Sat Apr 18 04:00:26 2020
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Sat, 18 Apr 2020 14:00:26 +0300
Subject: [gdal-dev] addRingDirectly is  crashed
Message-ID: <CAJKO1Yun46s2BBL_YSULHO-60kmF9ni82neCMDiVpB149MKJWA@mail.gmail.com>

Hi,
What am I doing wrong?
addRingDirectly is  crashed

f( poGeometry != NULL && wkbFlatten(poGeometry->getGeometryType()) ==
wkbPolygon )
              {
                   OGRPolygon *poPolygon = (OGRPolygon *) poGeometry;

             // Box,
                  OGRLinearRing * poLinearRing {};
                   OGRPolygon *bbox {};

                   OGREnvelope oEnv1;

                   poPolygon->getEnvelope(&oEnv1);

                   poLinearRing = new OGRLinearRing({});
                   poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MinY  );
                   poLinearRing-> addPoint (oEnv1.MaxX,oEnv1.MinY  );
                   poLinearRing-> addPoint (oEnv1.MaxX,oEnv1.MaxY  );
                   poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MaxY  );
                   poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MinY  );

                   bbox= new OGRPolygon({});
                   bbox-> addRingDirectly(poLinearRing );   ** crash occur
                                           Segmentation fault (core dumped)

regards

-- 
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Deprem  Dairesi Başkanlığı


________________________

Ahmet Temiz
Geological Eng.

Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200418/6b8e961c/attachment.html>

From andrew at aitchison.me.uk  Sat Apr 18 06:04:21 2020
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sat, 18 Apr 2020 14:04:21 +0100 (BST)
Subject: [gdal-dev] addRingDirectly is  crashed
In-Reply-To: <CAJKO1Yun46s2BBL_YSULHO-60kmF9ni82neCMDiVpB149MKJWA@mail.gmail.com>
References: <CAJKO1Yun46s2BBL_YSULHO-60kmF9ni82neCMDiVpB149MKJWA@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2004181401430.15944@warden.aitchison.me.uk>

On Sat, 18 Apr 2020, Ahmet Temiz wrote:

> Hi,
> What am I doing wrong?
> addRingDirectly is  crashed
>
> f( poGeometry != NULL && wkbFlatten(poGeometry->getGeometryType()) ==
> wkbPolygon )
>              {
>                   OGRPolygon *poPolygon = (OGRPolygon *) poGeometry;
>
>             // Box,
>                  OGRLinearRing * poLinearRing {};
>                   OGRPolygon *bbox {};
>
>                   OGREnvelope oEnv1;
>
>                   poPolygon->getEnvelope(&oEnv1);
>
>                   poLinearRing = new OGRLinearRing({});
>                   poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MinY  );
>                   poLinearRing-> addPoint (oEnv1.MaxX,oEnv1.MinY  );
>                   poLinearRing-> addPoint (oEnv1.MaxX,oEnv1.MaxY  );
>                   poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MaxY  );
>                   poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MinY  );
>
>                   bbox= new OGRPolygon({});
>                   bbox-> addRingDirectly(poLinearRing );   ** crash occur
>                                           Segmentation fault (core dumped)


The following works for me (I don't have {} in my new ...() ):

     OGRLinearRing* linearRing = new OGRLinearRing ();

     linearRing->setCoordinateDimension(2);
     linearRing->setNumPoints(4);

     linearRing->setPoint( 0, TL.lon, TL.lat );
     linearRing->setPoint( 1, TR.lon, TR.lat );
     linearRing->setPoint( 2, BR.lon, BR.lat );
     linearRing->setPoint( 3, BL.lon, BL.lat );

     OGRPolygon* poly = new OGRPolygon ();

     poly->addRingDirectly(linearRing);
     poly->closeRings();

     poFeature->SetGeometryDirectly(poly);


From mchapman at hyperacktive.com  Sat Apr 18 06:53:51 2020
From: mchapman at hyperacktive.com (Martin Chapman)
Date: Sat, 18 Apr 2020 07:53:51 -0600
Subject: [gdal-dev] addRingDirectly is  crashed
In-Reply-To: <alpine.DEB.2.22.394.2004181401430.15944@warden.aitchison.me.uk>
References: <alpine.DEB.2.22.394.2004181401430.15944@warden.aitchison.me.uk>
Message-ID: <7A43F96E-57E0-4F2A-9D81-A9B6407502EB@hyperacktive.com>

Your point ordering is counter clockwise.  Did you intend to add a hole?  I think exterior rings must be  clockwise.  Also, I think you need to set the spatial reference of the ring.

Best regards,
Martin Chapman

> On Apr 18, 2020, at 7:15 AM, Andrew C Aitchison <andrew at aitchison.me.uk> wrote:
> 
> ﻿On Sat, 18 Apr 2020, Ahmet Temiz wrote:
> 
>> Hi,
>> What am I doing wrong?
>> addRingDirectly is  crashed
>> 
>> f( poGeometry != NULL && wkbFlatten(poGeometry->getGeometryType()) ==
>> wkbPolygon )
>>             {
>>                  OGRPolygon *poPolygon = (OGRPolygon *) poGeometry;
>> 
>>            // Box,
>>                 OGRLinearRing * poLinearRing {};
>>                  OGRPolygon *bbox {};
>> 
>>                  OGREnvelope oEnv1;
>> 
>>                  poPolygon->getEnvelope(&oEnv1);
>> 
>>                  poLinearRing = new OGRLinearRing({});
>>                  poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MinY  );
>>                  poLinearRing-> addPoint (oEnv1.MaxX,oEnv1.MinY  );
>>                  poLinearRing-> addPoint (oEnv1.MaxX,oEnv1.MaxY  );
>>                  poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MaxY  );
>>                  poLinearRing-> addPoint (oEnv1.MinX,oEnv1.MinY  );
>> 
>>                  bbox= new OGRPolygon({});
>>                  bbox-> addRingDirectly(poLinearRing );   ** crash occur
>>                                          Segmentation fault (core dumped)
> 
> 
> The following works for me (I don't have {} in my new ...() ):
> 
>    OGRLinearRing* linearRing = new OGRLinearRing ();
> 
>    linearRing->setCoordinateDimension(2);
>    linearRing->setNumPoints(4);
> 
>    linearRing->setPoint( 0, TL.lon, TL.lat );
>    linearRing->setPoint( 1, TR.lon, TR.lat );
>    linearRing->setPoint( 2, BR.lon, BR.lat );
>    linearRing->setPoint( 3, BL.lon, BL.lat );
> 
>    OGRPolygon* poly = new OGRPolygon ();
> 
>    poly->addRingDirectly(linearRing);
>    poly->closeRings();
> 
>    poFeature->SetGeometryDirectly(poly);
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Sat Apr 18 07:17:30 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 18 Apr 2020 16:17:30 +0200
Subject: [gdal-dev] addRingDirectly is  crashed
In-Reply-To: <7A43F96E-57E0-4F2A-9D81-A9B6407502EB@hyperacktive.com>
References: <alpine.DEB.2.22.394.2004181401430.15944@warden.aitchison.me.uk>
 <7A43F96E-57E0-4F2A-9D81-A9B6407502EB@hyperacktive.com>
Message-ID: <1783520.4UEGqN61jn@even-i700>

> Your point ordering is counter clockwise.

That's not relevant. GDAL doesn't care. Some formats do (shapefile), but GDAL will fix 
winding order at the driver level. At the API level, users are free to use whatever order 
they want.

>Also, I think you need to set the spatial reference of the ring.

That's not needed.

At first sight, Ahmet's code snippet looks good. There must be something else not 
shown that cause the issue. On Linux, I would use Valgrind to spot the issue.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200418/31314223/attachment.html>

From ahmettemiz88 at gmail.com  Sat Apr 18 07:46:24 2020
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Sat, 18 Apr 2020 17:46:24 +0300
Subject: [gdal-dev] Thank you all for "addRingDirectly is crashed"
Message-ID: <CAJKO1YuyGjyW0aQuD5x868eTxYt33PPy5Dwf8KDRgFbpvUvfaA@mail.gmail.com>

-- 
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Deprem  Dairesi Başkanlığı


________________________

Ahmet Temiz
Geological Eng.

Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200418/2acc0cd5/attachment.html>

From carlos at alternativaslibres.org  Sat Apr 18 08:01:43 2020
From: carlos at alternativaslibres.org (=?UTF-8?Q?Carlos_D=c3=a1vila?=)
Date: Sat, 18 Apr 2020 17:01:43 +0200
Subject: [gdal-dev] Dealing with SRTM! v3 files
Message-ID: <5708ea13-3a87-be70-70e9-776e56e132c3@alternativaslibres.org>

Hello all

I want to process SRTM1 data from Earthexplorer using mkgmap 
<http://www.mkgmap.org.uk/>, an open source software to build Garmin 
maps from OpenStreetMap data. Currently, earthexplorer serves SRTM1 data 
as *.tiff files of 3601x3601x2=24,7 MB, but also as files of half that 
size. I use gdal to convert *.tiff to *.hgt, as mkgmap is not able to 
read *.tiff.

These smaller files seem to contain the same information and gdal is 
able to convert them to *.hgt files without problems, in the same way 
than standard size ones, but mkgmap fails to read the small hgt files. 
Given gdal "understands" these small srtm files, could you give me some 
clue on how it is done, so that developers of mkgmap can add this 
capability?

Thanks in advance for any help

Carlos

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200418/2cbd0703/attachment.html>

From Mika.Heiskanen at fmi.fi  Sun Apr 19 02:08:39 2020
From: Mika.Heiskanen at fmi.fi (Heiskanen Mika (FMI))
Date: Sun, 19 Apr 2020 09:08:39 +0000
Subject: [gdal-dev] +lon_wrap difference between cs2cs and
	OGRCoordinateTransformation
Message-ID: <f6b5e54efba74cd8b99cafefb20a2674@C119S212VM014.msvyvi.vaha.local>

Hello,

I've been browsing the manuals, and cannot find any reason why cs2cs and the sample C++ program behave differently:

> echo "25w 60n" | /usr/proj70/bin/cs2cs -f "%.8f" +from +init=epsg:4326 +to +init=epsg:4326 +lon_wrap=180
335.00000000 60.00000000 0.00000000

> g++ -std=c++11 -o tese tese.cpp -I/usr/gdal30/include -L/usr/gdal30/lib -lgdal
> ./tese
Warning 1: +init=epsg:XXXX syntax is deprecated. It might return a CRS with a non-EPSG compliant axis order.
x=-25 y=60

It seems to me based on browsing the source code that both call proj_trans, and hence should probably produce
the same results. I couldn't debug any further with the RHEL7 RPM packages since the pgdg repo does not
provide the necessary debuginfo packages for GDAL or PROJ (would be nice to have them for perf too).

The +lon_0 option seems to work just fine for metric projections, but does not work for geographic conversions
such as this one.

Is there a good reason for the discrepancy which I may have missed, or should this perhaps be considered a bug?

Regards,

Mika Heiskanen


[-] = =tese.cpp------------------------------------------------------------------------------------------------------------------------------------------------------------------
#include <ogr_spatialref.h>
#include <iostream>

int main()
{
  OGRSpatialReference source;
  source.SetFromUserInput("epsg:4326");
  source.SetAxisMappingStrategy(OAMS_TRADITIONAL_GIS_ORDER);

  OGRSpatialReference target;
  target.SetFromUserInput("+init=epsg:4326 +lon_wrap=180");
  target.SetAxisMappingStrategy(OAMS_TRADITIONAL_GIS_ORDER);

  auto* trans = OGRCreateCoordinateTransformation(&source, &target);

  double x = -25;
  double y = 60;
  trans->Transform(1, &x, &y);

  std::cout << "x=" << x << " y=" << y << "\n";
}

?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200419/e450013f/attachment.html>

From Mika.Heiskanen at fmi.fi  Sun Apr 19 03:10:24 2020
From: Mika.Heiskanen at fmi.fi (Heiskanen Mika (FMI))
Date: Sun, 19 Apr 2020 10:10:24 +0000
Subject: [gdal-dev] +lon_wrap difference between cs2cs
	and	OGRCoordinateTransformation
In-Reply-To: <f6b5e54efba74cd8b99cafefb20a2674@C119S212VM014.msvyvi.vaha.local>
References: <f6b5e54efba74cd8b99cafefb20a2674@C119S212VM014.msvyvi.vaha.local>
Message-ID: <1587291024274.19043@fmi.fi>

Hi again,


By studying the source code I found out the following modification works:


  OGRCoordinateTransformationOptions opts;
  opts.SetTargetCenterLong(180);
  auto* trans = OGRCreateCoordinateTransformation(&source, &target, opts);


However, the SetTargetCenterLong API is clearly unsupported/undocumented, and is not quite the

same thing anyway as being able to specify the central longitude in the projection string. Git blame

shows the hidden API has been created to solve what seems to be a completely different issue.


Regards,


Mika Heiskanen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200419/022ec84d/attachment.html>

From even.rouault at spatialys.com  Sun Apr 19 04:36:22 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 19 Apr 2020 13:36:22 +0200
Subject: [gdal-dev] Dealing with SRTM! v3 files
In-Reply-To: <5708ea13-3a87-be70-70e9-776e56e132c3@alternativaslibres.org>
References: <5708ea13-3a87-be70-70e9-776e56e132c3@alternativaslibres.org>
Message-ID: <1805824.Gv654yTFOM@even-i700>

On samedi 18 avril 2020 17:01:43 CEST Carlos Dávila wrote:
> Hello all
> 
> I want to process SRTM1 data from Earthexplorer using mkgmap
> <http://www.mkgmap.org.uk/>, an open source software to build Garmin
> maps from OpenStreetMap data. Currently, earthexplorer serves SRTM1 data
> as *.tiff files of 3601x3601x2=24,7 MB, but also as files of half that
> size. I use gdal to convert *.tiff to *.hgt, as mkgmap is not able to
> read *.tiff.
> 
> These smaller files seem to contain the same information and gdal is
> able to convert them to *.hgt files without problems, in the same way
> than standard size ones, but mkgmap fails to read the small hgt files.
> Given gdal "understands" these small srtm files, could you give me some
> clue on how it is done, so that developers of mkgmap can add this
> capability?

The file with half size have probably width=1801 at higher latitudes (60deg I believe)

GDAL SRTMHGT driver source code at
https://github.com/OSGeo/gdal/blob/master/gdal/frmts/srtmhgt/srtmhgtdataset.cpp

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200419/4c7f48d5/attachment-0001.html>

From even.rouault at spatialys.com  Sun Apr 19 05:09:02 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 19 Apr 2020 14:09:02 +0200
Subject: [gdal-dev] +lon_wrap difference between cs2cs and
	OGRCoordinateTransformation
In-Reply-To: <f6b5e54efba74cd8b99cafefb20a2674@C119S212VM014.msvyvi.vaha.local>
References: <f6b5e54efba74cd8b99cafefb20a2674@C119S212VM014.msvyvi.vaha.local>
Message-ID: <3462291.n0E3myLlQh@even-i700>

> Is there a good reason for the discrepancy which I may have 
missed, or
> should this perhaps be considered a bug?

Was indeed a bug specific to lon_wrap or similar 'overriding' 
qualifiers not being properly taken into account on GDAL side. I've 
just fixed it

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200419/589b6001/attachment.html>

From hardienalfath93 at gmail.com  Sun Apr 19 04:35:39 2020
From: hardienalfath93 at gmail.com (duns)
Date: Sun, 19 Apr 2020 13:35:39 +0200
Subject: [gdal-dev] ISG (International Service for Geoid) driver
In-Reply-To: <2748240.5xDuCUydVY@even-i700>
References: <CABv_wsARaYLZvi-6ZuWun-z_jopttzk3yNrO1nwf4R7xXSrztQ@mail.gmail.com>
 <2748240.5xDuCUydVY@even-i700>
Message-ID: <CABv_wsDN8CSrrqD2iDjEsHNjLMRKx+Tiwk17vhYRWpEK05_OxA@mail.gmail.com>

Hello,

I am quite newbie on GDAL, my purpose is to Install GDAL 3.1 (to enable the
ISG driver capabilites) into a python environment on Anaconda 2.7 (or
3.7), but I don't find a way to install an unreleased version (in this case
GDAL 3.1). Is it possible to do so? If yes could you provide the steps?
Sorry my questions are all newbie.

Thank you,
Hardien

On Tue, 14 Apr 2020 at 11:21, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hardien,
>
>
>
> > I read about the ISG in here says that driver is "New In Version 3.1"
>
> > https://gdal.org/drivers/raster/isg.html#driver-capabilities
>
> >
>
> > Does this mean in the current release 3.0.4 the driver is not available
>
> > yet?
>
>
>
> Yes
>
>
>
> > If it doesn't, is there any way to force install it somehow using
>
> > unreleased version of 3.1(if it available somewhere) ?
>
>
>
> Linux: https://gdal.org/download.html#linux-docker-images
>
>
>
> Windows:
>
> - gdal-dev package on OSGeo4W (https://trac.osgeo.org/osgeo4w/)
>
> - development builds at http://gisinternals.com/development.php
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200419/6b13e045/attachment.html>

From even.rouault at spatialys.com  Sun Apr 19 07:09:54 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 19 Apr 2020 16:09:54 +0200
Subject: [gdal-dev] ogr2ogr -makevalid [was Re: Algorithm to clip the inner
	loop of a polygon]
In-Reply-To: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
References: <CAAN-aRFQsyoVTBceU0QhGcoPr-obmeVhUujAccYroaJwBBPUCw@mail.gmail.com>
Message-ID: <4964455.rrQeCFgTEb@even-i700>

Chao YUE,

This is probably not exactly what you want, but I wanted to mention that ogr2ogr in latest 
GDAL master has now received a -makevalid switch that relies on GEOSMakeValid() method 
of GEOS 3.8.0 or later (which itself is the port of PostGIS ST_MakeValid() to GEOS).

For people using the SQL SQLite dialect, ST_MakeValid() is also now available (still with GEOS 
>= 3.8), even against a Spatialite build that doesn't link against liblwgeom

Even

> Dear all,
> 
> Does anyone have some experience or is aware of some algorithm that can
> find and clip the inner loop formed in a polygon ? I attach one example
> here. In this case I would only keep the outer points and drop the ones
> that make an inner loop. I am developing some algorithm to simulate
> wildland fire propagation. The algorithm is based on Richards 1990.
> 
> In the paper he described an algorithm based on two steps: (1) find the
> points where a concave curvature is made. (2) search for both sides of this
> point to see where any two line segments cross over each other.
> But I am wondering whether there is already some existing solutions or
> other better ones.
> 
> Thanks a lot for the kind help for any hints on this !
> Kind regards,
> Chao
> 
> Gwynfor Richards, 1990. An elliptical growth model of forest fire fronts
> and its numerical solution. International journal for Numerical Methods in
> Engineering, Vol. 30, 1163-1179.
> 
> [image: InnerLoop.png]


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200419/b51f8b20/attachment.html>

From zoltanpillio at gmail.com  Sun Apr 19 12:21:12 2020
From: zoltanpillio at gmail.com (Pillio Zoltan)
Date: Sun, 19 Apr 2020 21:21:12 +0200
Subject: [gdal-dev] gdalwarp and gdaltransform are inconsistent
Message-ID: <CAGQhmn7vW25ZBn=8WNdprO9RH+9Pr=5RbEySABhNRMmipk=V6A@mail.gmail.com>

Hi,

I'm new here, and just started using gdal, so maybe I'm misunderstanding
something, but I found that gdalwarp and gdaltransform produces different
results.

The gdaltransform command is :
echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs EPSG:2056

and the result is:
7.43863317174838 46.9151021335816 817.714334204793

,but if I'm converting a geotif with the following command:
gdalwarp -t_srs EPSG:4326 -s_srs EPSG:2056
SWISSALTI3D_10_TIFF_CHLV95_LN02_2600_1196.tif test.tif

the height doesn't change. I'm using swisstopo example data from here:
https://cms.geo.admin.ch/Topo/swissalti3d/swissalti3dgeotifflv95.zip

I did the conversion by myself based on swisstopo documentation (link
above), and the result of gdaltransform is correct, but gdalwarp is wrong.

Do I misunderstand something, or did I make a mistake?

I'm using GDAL 2.4.2, released 2019/06/28

Thank you in advance for your help.

Best regards,
Zoltan Pillio

ps.:
I also found that setting height reference frame has no effect in these
cases:
echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs EPSG:2056
echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs
EPSG:2056+5728
echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs
EPSG:2056+5729

and the swisstopo documentation for conversion I used:
https://www.swisstopo.admin.ch/content/swisstopo-internet/en/online/calculation-services/_jcr_content/contentPar/tabs/items/documents_publicatio/tabPar/downloadlist/downloadItems/19_1467104393233.download/ch1903wgs84_e.pdf
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200419/b76f1a5d/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 20 01:08:15 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 20 Apr 2020 01:08:15 -0700 (MST)
Subject: [gdal-dev] gdalwarp and gdaltransform are inconsistent
In-Reply-To: <CAGQhmn7vW25ZBn=8WNdprO9RH+9Pr=5RbEySABhNRMmipk=V6A@mail.gmail.com>
References: <CAGQhmn7vW25ZBn=8WNdprO9RH+9Pr=5RbEySABhNRMmipk=V6A@mail.gmail.com>
Message-ID: <1587370095400-0.post@n6.nabble.com>

Hi,

When it comes to gdalwarp I believe that this part of the documentation
https://gdal.org/programs/gdalwarp.html is essential

"Starting with GDAL 2.2, if the SRS has an explicit vertical datum that
points to a PROJ.4 geoidgrids, and the input dataset is a single band
dataset, a vertical correction will be applied to the values of the
dataset."

Both EPSG:4326 and EPSG:2056 are 2D systems without explicit vertical datum.
EPSG:4979 is explicit 3D  
http://www.epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::4979 and
the compound crs syntax that you used (-s_srs EPSG:2056+5728) is explicit as
well.

I do not know how gdaltransform knows to do the conversion in Z coordinate
and how to give the -s_srs and -t_srs right for gdalwarp but I would try
next with
-s_srs EPSG:2056+5728 -t_srs epsg:4979

-Jukka Rahkonen-



Pillio Zoltan wrote
> Hi,
> 
> I'm new here, and just started using gdal, so maybe I'm misunderstanding
> something, but I found that gdalwarp and gdaltransform produces different
> results.
> 
> The gdaltransform command is :
> echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs EPSG:2056
> 
> and the result is:
> 7.43863317174838 46.9151021335816 817.714334204793
> 
> ,but if I'm converting a geotif with the following command:
> gdalwarp -t_srs EPSG:4326 -s_srs EPSG:2056
> SWISSALTI3D_10_TIFF_CHLV95_LN02_2600_1196.tif test.tif
> 
> the height doesn't change. I'm using swisstopo example data from here:
> https://cms.geo.admin.ch/Topo/swissalti3d/swissalti3dgeotifflv95.zip
> 
> I did the conversion by myself based on swisstopo documentation (link
> above), and the result of gdaltransform is correct, but gdalwarp is wrong.
> 
> Do I misunderstand something, or did I make a mistake?
> 
> I'm using GDAL 2.4.2, released 2019/06/28
> 
> Thank you in advance for your help.
> 
> Best regards,
> Zoltan Pillio
> 
> ps.:
> I also found that setting height reference frame has no effect in these
> cases:
> echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs EPSG:2056
> echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs
> EPSG:2056+5728
> echo 2600000 1196000 768 | gdaltransform -t_srs EPSG:4326 -s_srs
> EPSG:2056+5729
> 
> and the swisstopo documentation for conversion I used:
> https://www.swisstopo.admin.ch/content/swisstopo-internet/en/online/calculation-services/_jcr_content/contentPar/tabs/items/documents_publicatio/tabPar/downloadlist/downloadItems/19_1467104393233.download/ch1903wgs84_e.pdf
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 20 02:44:39 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 20 Apr 2020 02:44:39 -0700 (MST)
Subject: [gdal-dev] gdalwarp and gdaltransform are inconsistent
In-Reply-To: <1587370095400-0.post@n6.nabble.com>
References: <CAGQhmn7vW25ZBn=8WNdprO9RH+9Pr=5RbEySABhNRMmipk=V6A@mail.gmail.com>
 <1587370095400-0.post@n6.nabble.com>
Message-ID: <1587375879584-0.post@n6.nabble.com>

I would like to add that the command that you used

gdalwarp -t_srs EPSG:4326 -s_srs EPSG:2056
SWISSALTI3D_10_TIFF_CHLV95_LN02_2600_1196.tif test.tif

of course must not alter the pixel values. There are other sort of single
band raster files than DEMs and it would make no sense at all to apply datum
shifts to temperatures, pressures, slopes and so on.

-Jukka-


jratike80 wrote
> Hi,
> 
> When it comes to gdalwarp I believe that this part of the documentation
> https://gdal.org/programs/gdalwarp.html is essential
> 
> "Starting with GDAL 2.2, if the SRS has an explicit vertical datum that
> points to a PROJ.4 geoidgrids, and the input dataset is a single band
> dataset, a vertical correction will be applied to the values of the
> dataset."
> 
> Both EPSG:4326 and EPSG:2056 are 2D systems without explicit vertical
> datum.
> EPSG:4979 is explicit 3D  
> http://www.epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::4979 and
> the compound crs syntax that you used (-s_srs EPSG:2056+5728) is explicit
> as
> well.
> 
> I do not know how gdaltransform knows to do the conversion in Z coordinate
> and how to give the -s_srs and -t_srs right for gdalwarp but I would try
> next with
> -s_srs EPSG:2056+5728 -t_srs epsg:4979
> 
> -Jukka Rahkonen-





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Mon Apr 20 03:05:57 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 Apr 2020 12:05:57 +0200
Subject: [gdal-dev] gdalwarp and gdaltransform are inconsistent
In-Reply-To: <1587370095400-0.post@n6.nabble.com>
References: <CAGQhmn7vW25ZBn=8WNdprO9RH+9Pr=5RbEySABhNRMmipk=V6A@mail.gmail.com>
 <1587370095400-0.post@n6.nabble.com>
Message-ID: <4170470.YAG8nZl9qg@even-i700>

On lundi 20 avril 2020 01:08:15 CEST jratike80 wrote:
> Hi,
> 
> When it comes to gdalwarp I believe that this part of the documentation
> https://gdal.org/programs/gdalwarp.html is essential
> 
> "Starting with GDAL 2.2, if the SRS has an explicit vertical datum that
> points to a PROJ.4 geoidgrids, and the input dataset is a single band
> dataset, a vertical correction will be applied to the values of the
> dataset."
> 
> Both EPSG:4326 and EPSG:2056 are 2D systems without explicit vertical datum.
> EPSG:4979 is explicit 3D
> http://www.epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::4979 and
> the compound crs syntax that you used (-s_srs EPSG:2056+5728) is explicit as
> well.
> 
> I do not know how gdaltransform knows to do the conversion in Z coordinate

As this is with GDAL 2, and likely PROJ 4 or 5, this was a change in ellipsoidal height between 
the WGS84 and Bessel 1841 ellipsoids, but this was highly questionable, and is no longer 
done in GDAL 3 / PROJ >= 6, at least when using 2D codes.

> and how to give the -s_srs and -t_srs right for gdalwarp but I would try
> next with
> -s_srs EPSG:2056+5728 -t_srs epsg:4979

The change in Z done in gdalwarp requires:
- single band dataset
- input CRS is a geographic 3D CRS and output CRS is compound CRS (horizontal CRS + 
vertical CRS) with an explicit +geoidgrids term (or the reverse). The key here would be to 
have a vertical grid for EPSG:5728. I don't see any mentionned in EPSG. 

So provided that such grids is available, EPSG:2056+5728 would have to be replaced by 
"+init=epsg:2056 +geoidgrids=XXXXXX.gtx"

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200420/97da3292/attachment.html>

From even.rouault at spatialys.com  Mon Apr 20 03:15:59 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 Apr 2020 12:15:59 +0200
Subject: [gdal-dev] libgeotiff 1.6.0 release soon
Message-ID: <39688569.jJyS8omeEp@even-i700>

Hi,

In preparation for the upcoming GDAL 3.1.0 release, I intend to prepare a 
libgeotiff 1.6.0 release later this week. I believe things are in good shape, but 
if people want to give it a quick try to master, that's welcome.

The major point w.r.t 1.5.0 is added support for the OGC GeoTIFF 1.1 
standard.
Support for autoconf out-of-tree builds has also just been merged.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200420/81841d31/attachment.html>

From sebastic at xs4all.nl  Mon Apr 20 04:39:50 2020
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Mon, 20 Apr 2020 13:39:50 +0200
Subject: [gdal-dev] [Geotiff] libgeotiff 1.6.0 release soon
In-Reply-To: <39688569.jJyS8omeEp@even-i700>
References: <39688569.jJyS8omeEp@even-i700>
Message-ID: <81ce4124-22d2-2de3-4f47-b8057abad1c1@xs4all.nl>

On 4/20/20 12:15 PM, Even Rouault wrote:
> In preparation for the upcoming GDAL 3.1.0 release, I intend to prepare a 
> libgeotiff 1.6.0 release later this week. I believe things are in good shape, but 
> if people want to give it a quick try to master, that's welcome.

Will there be an RC before the release?

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From even.rouault at spatialys.com  Mon Apr 20 04:47:05 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 Apr 2020 13:47:05 +0200
Subject: [gdal-dev] [Geotiff] libgeotiff 1.6.0 release soon
In-Reply-To: <81ce4124-22d2-2de3-4f47-b8057abad1c1@xs4all.nl>
References: <39688569.jJyS8omeEp@even-i700>
 <81ce4124-22d2-2de3-4f47-b8057abad1c1@xs4all.nl>
Message-ID: <2366303.tLeyzj4U9G@even-i700>

On lundi 20 avril 2020 13:39:50 CEST Sebastiaan Couwenberg wrote:
> On 4/20/20 12:15 PM, Even Rouault wrote:
> > In preparation for the upcoming GDAL 3.1.0 release, I intend to prepare a
> > libgeotiff 1.6.0 release later this week. I believe things are in good
> > shape, but if people want to give it a quick try to master, that's
> > welcome.
> 
> Will there be an RC before the release?

I'll do that.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200420/6ba95123/attachment.html>

From zoltanpillio at gmail.com  Mon Apr 20 06:10:05 2020
From: zoltanpillio at gmail.com (Pillio Zoltan)
Date: Mon, 20 Apr 2020 15:10:05 +0200
Subject: [gdal-dev] gdalwarp and gdaltransform are inconsistent
In-Reply-To: <4170470.YAG8nZl9qg@even-i700>
References: <CAGQhmn7vW25ZBn=8WNdprO9RH+9Pr=5RbEySABhNRMmipk=V6A@mail.gmail.com>
 <1587370095400-0.post@n6.nabble.com> <4170470.YAG8nZl9qg@even-i700>
Message-ID: <CAGQhmn6mXZwxhsU3Ta9WQBEuPnOJhwk9Nw=LjT3KB7r9Hehwrg@mail.gmail.com>

Thank you for all your quick answer. So the conclusion is I need a geogrid
file to do it.

Even Rouault <even.rouault at spatialys.com> ezt írta (időpont: 2020. ápr.
20., H, 12:06):

> On lundi 20 avril 2020 01:08:15 CEST jratike80 wrote:
>
> > Hi,
>
> >
>
> > When it comes to gdalwarp I believe that this part of the documentation
>
> > https://gdal.org/programs/gdalwarp.html is essential
>
> >
>
> > "Starting with GDAL 2.2, if the SRS has an explicit vertical datum that
>
> > points to a PROJ.4 geoidgrids, and the input dataset is a single band
>
> > dataset, a vertical correction will be applied to the values of the
>
> > dataset."
>
> >
>
> > Both EPSG:4326 and EPSG:2056 are 2D systems without explicit vertical
> datum.
>
> > EPSG:4979 is explicit 3D
>
> > http://www.epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::4979
> and
>
> > the compound crs syntax that you used (-s_srs EPSG:2056+5728) is
> explicit as
>
> > well.
>
> >
>
> > I do not know how gdaltransform knows to do the conversion in Z
> coordinate
>
>
>
> As this is with GDAL 2, and likely PROJ 4 or 5, this was a change in
> ellipsoidal height between the WGS84 and Bessel 1841 ellipsoids, but this
> was highly questionable, and is no longer done in GDAL 3 / PROJ >= 6, at
> least when using 2D codes.
>

We checked with GDAL 3, and you rignt. And the reason why gdaltransform
result was close to the right value is because CHGeo2004 geoidal separation
was close to 0 at the checked point.


>
> > and how to give the -s_srs and -t_srs right for gdalwarp but I would try
>
> > next with
>
> > -s_srs EPSG:2056+5728 -t_srs epsg:4979
>
>
>
> The change in Z done in gdalwarp requires:
>
> - single band dataset
>
> - input CRS is a geographic 3D CRS and output CRS is compound CRS
> (horizontal CRS + vertical CRS) with an explicit +geoidgrids term (or the
> reverse). The key here would be to have a vertical grid for EPSG:5728. I
> don't see any mentionned in EPSG.
>
>
>
> So provided that such grids is available, EPSG:2056+5728 would have to be
> replaced by "+init=epsg:2056 +geoidgrids=XXXXXX.gtx"
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200420/332ce82d/attachment.html>

From hbarrett at edac.unm.edu  Mon Apr 20 14:40:16 2020
From: hbarrett at edac.unm.edu (Hays Barrett)
Date: Mon, 20 Apr 2020 15:40:16 -0600 (MDT)
Subject: [gdal-dev] Help with finding residual error for a given GCP.
Message-ID: <55319196.6652310.1587418816631.JavaMail.zimbra@edac.unm.edu>

Hello all, 
I want to get the error for each GCP before warping so I can calculate the RMSE before georeferencing. 
With a list of GCPs, is it possible to get the eventual map location of each pixel coordinate to calculate the transformation error for each GCP? 
I have tried to use GCPsToGeoTransform but that gave me a map location that was further from the intended chosen GCP coordinate than the actual post- georeferencing pixel location. 

Here is my GCPsToGeoTransform code: 
##CODE_START 

from osgeo import gdal 
#list of GCPs 
gcpjson={'0': {'row': 5305.626973704321, 'col': 1158.432032601927, 'lat': -107.18221364936802, 'lon': 35.08107313264506}, '1': {'row': 778.3230540174817, 'col': 2317.0737231100225, 'lat': -107.17634116783263, 'lon': 35.09958594602314}, '2': {'row': 3950.8777704175645, 'col': 4880.465723118029, 'lat': -107.163460244414, 'lon': 35.08679518563491}, '3': {'row': 7609.882307742781, 'col': 4407.027704042081, 'lat': -107.16570574683065, 'lon': 35.07164256912238}, '4': {'row': 1822.0904204049455, 'col': 6486.900377637105, 'lat': -107.15529960157271, 'lon': 35.096105471961536}, '5': {'row': 6291.396402113635, 'col': 7216.1033738731185, 'lat': -107.15180240538085, 'lon': 35.077317337370516}} 

#New list to put in gdal.GCP objects into 
gcpList=[] 
#Load GCP objects into gcpList 
for gcp in gcpjson: 
gcpList.append(gdal.GCP(gcpjson[gcp]['lat'],gcpjson[gcp]['lon'],0,gcpjson[gcp]['col'],gcpjson[gcp]['row'])) 

#create GeoTranform from gcp list 
GT = gdal.GCPsToGeoTransform(tuple(gcpList)) 

#Get pixel location from first GCP as a test. 
col=gcpjson['0']['col'] 
row=gcpjson['0']['row'] 
xp = GT[0] + col*GT[1] + row*GT[2] 
yp = GT[3] + col*GT[4] + row*GT[5] 
print("POINT ("+str(xp)+" "+str(yp)+" 0)") 

##CODE_END 

This prints out the WKT 'POINT (-107.18216298 35.0808978834 0)' which is kinda close to -107.18221364936802, 35.08107313264506 but looking at my post warped image the chosen pixel is right on top of the intended coordinate so I am clearly doing something (or a lot) wrong. 



Any help would be great. 
Thanks, 
-Hays 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200420/224bb145/attachment.html>

From howard at hobu.co  Mon Apr 20 18:16:41 2020
From: howard at hobu.co (Howard Butler)
Date: Mon, 20 Apr 2020 20:16:41 -0500
Subject: [gdal-dev] Windows CI build times
In-Reply-To: <CABUeae-1gB64sbpyEh2vW-Ce1nMv7gCZWfjAto50Oc-a7C_jZw@mail.gmail.com>
References: <6887462.ldcPOGF9r1@even-i700>
 <CAM2FmMoaJwYUocZT-dJDL3wchtPc3oT1ny0FB6gkU-QgiMd4ww@mail.gmail.com>
 <CABUeae-1gB64sbpyEh2vW-Ce1nMv7gCZWfjAto50Oc-a7C_jZw@mail.gmail.com>
Message-ID: <4B46FBC1-B107-4A5C-98E1-80578C885169@hobu.co>



> On Apr 16, 2020, at 7:46 PM, Mateusz Loskot <mateusz at loskot.net> wrote:
> 
> On Fri, 17 Apr 2020 at 01:45, Mike Taves <mwtoews at gmail.com> wrote:
>> 
>> It seems that many projects have shifted from AppVeyor to AZP for
>> performance benefits.
> 
> Or GitHub Actions, which is an incarnation of AzP.

Having done both GitHub Actions and AzP, I think Actions has more convenient expressiveness of job flow, a big win of integration with GitHub's API, and large directory of user-contributed actions.

We migrated PDAL to AzP last summer after our experience at the OSGeo Code Sprint in Minneapolis with AzP on the gdal.org <http://gdal.org/> refactor. A big benefit was to simply have *one* CI platform instead of two or three. It was also wall-time faster, more concurrent, and most importantly had no cost to get better performance for open source projects (you need to pay for that from Travis or AppVeyor, which the PDAL project had done).

GitHub Actions takes it even a step further, and it would be my choice for GDAL if someone has the capacity to invest the time to bring it forward. 

Howard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200420/691ba02c/attachment.html>

From even.rouault at spatialys.com  Tue Apr 21 06:18:04 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 Apr 2020 15:18:04 +0200
Subject: [gdal-dev] Help with finding residual error for a given GCP.
In-Reply-To: <55319196.6652310.1587418816631.JavaMail.zimbra@edac.unm.edu>
References: <55319196.6652310.1587418816631.JavaMail.zimbra@edac.unm.edu>
Message-ID: <6788207.jeMqpP4UNc@even-i700>

Hays,

GCPsToGeoTransform() is not used directly by gdalwarp (although it should likely be 
equivalent to running -order 1 polynomial), but by other code (OZI .map exporting, .tab 
exporting)

You rather want to use the gdal.Transformer() API which is tested in
https://github.com/OSGeo/gdal/blob/master/autotest/gcore/transformer.py

Even


> Hello all,
> I want to get the error for each GCP before warping so I can calculate the
> RMSE before georeferencing. With a list of GCPs, is it possible to get the
> eventual map location of each pixel coordinate to calculate the
> transformation error for each GCP? I have tried to use GCPsToGeoTransform
> but that gave me a map location that was further from the intended chosen
> GCP coordinate than the actual post- georeferencing pixel location.
> 
> Here is my GCPsToGeoTransform code:
> ##CODE_START
> 
> from osgeo import gdal
> #list of GCPs
> gcpjson={'0': {'row': 5305.626973704321, 'col': 1158.432032601927, 'lat':
> -107.18221364936802, 'lon': 35.08107313264506}, '1': {'row':
> 778.3230540174817, 'col': 2317.0737231100225, 'lat': -107.17634116783263,
> 'lon': 35.09958594602314}, '2': {'row': 3950.8777704175645, 'col':
> 4880.465723118029, 'lat': -107.163460244414, 'lon': 35.08679518563491},
> '3': {'row': 7609.882307742781, 'col': 4407.027704042081, 'lat':
> -107.16570574683065, 'lon': 35.07164256912238}, '4': {'row':
> 1822.0904204049455, 'col': 6486.900377637105, 'lat': -107.15529960157271,
> 'lon': 35.096105471961536}, '5': {'row': 6291.396402113635, 'col':
> 7216.1033738731185, 'lat': -107.15180240538085, 'lon': 35.077317337370516}}
> 
> #New list to put in gdal.GCP objects into
> gcpList=[]
> #Load GCP objects into gcpList
> for gcp in gcpjson:
> gcpList.append(gdal.GCP(gcpjson[gcp]['lat'],gcpjson[gcp]['lon'],0,gcpjson[gc
> p]['col'],gcpjson[gcp]['row']))
> 
> #create GeoTranform from gcp list
> GT = gdal.GCPsToGeoTransform(tuple(gcpList))
> 
> #Get pixel location from first GCP as a test.
> col=gcpjson['0']['col']
> row=gcpjson['0']['row']
> xp = GT[0] + col*GT[1] + row*GT[2]
> yp = GT[3] + col*GT[4] + row*GT[5]
> print("POINT ("+str(xp)+" "+str(yp)+" 0)")
> 
> ##CODE_END
> 
> This prints out the WKT 'POINT (-107.18216298 35.0808978834 0)' which is
> kinda close to -107.18221364936802, 35.08107313264506 but looking at my
> post warped image the chosen pixel is right on top of the intended
> coordinate so I am clearly doing something (or a lot) wrong.
> 
> 
> 
> Any help would be great.
> Thanks,
> -Hays


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200421/c9239f94/attachment-0001.html>

From aritchie at usgs.gov  Tue Apr 21 12:47:20 2020
From: aritchie at usgs.gov (Ritchie, Andrew C)
Date: Tue, 21 Apr 2020 19:47:20 +0000
Subject: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large
 jpeg cogs... REALLLLLY long time to unload.
Message-ID: <BY5PR09MB55543E3BC0FF41D201BBACD5B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>

Just wanted to follow up on this because I didn't want to leave the impression that the issue was resolved, or limited to jpeg compression. It seems to be an issue with writing the internal mask band.

When I create a mask band in a large lzw-compressed or jpeg-compressed tif using the COG driver it dramatically increases processing time over writing RGBA (hours instead of minutes), so the issue is not jpeg compression, it's the creation of the mask band. Steps to reproduce:

  1.  Take a decent-sized RGBA LZW tiff
  2.  Generate a LZW COG with -b 1 -b 2 -b 3 -b 4 -config GDAL_TIFF_INTERNAL_MASK YES and time it
  3.  Generate a LZW COG with -b 1 -b 2 -b 3 -mask 4 -config GDAL_TIFF_INTERNAL_MASK YES and time it
  4.  Compare times. When I do this with a sourcefile that's RGBA COG 102600x91100 my time doing (1) is about 2 minutes and my time doing (2) is about 120 minutes

I also noticed that the -co BIGTIFF=NO option appears to be ignored in the COG driver. I can share a file if that's helpful (can not provide a link on the listserv)

Is there a faster way to generate an external nodata mask then add it? From reading the GTIFF and COG format notes on internal masks it wasn't clear but I didn't see a way to specify copying masks in the COG driver.

From: Ritchie, Andrew C
Sent: Wednesday, April 15, 2020 12:26 PM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: RE: [EXTERNAL] Re: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large jpeg cogs... REALLLLLY long time to unload.

Hi Even,

Thanks for the quick response! The source dataset is a LZW cog with RGBA, and I confirmed (I think) that the issue was the mask layer by playing with the switches I used to generate the LZW cog - I didn't even have to do a JPEG COG. I can cause the same, or very similar behavior, by changing from:

-b 1 -b 2 -b 3 -b 4
to:
-b 1 -b 2 -b 3 -mask 4

with GDAL_TIFF_INTERNAL_MASK YES.

With the -b 4 switch (or omitting all -b and -mask switches), I get LZW cogs in 2 minutes. With -mask 4 I get hung up at 20% with directory thrashing messages in debug for at least 30 minutes, and I'm guessing I'll get the same behavior at the "done" message if I care to wait.

Below are the two configurations that show such a difference in performance for me. I didn't play around with CACHEMAX or MAX_DATASET_POOL_SIZE, was trying to keep it simple.

2 minute TIFFs:
gdal_translate <infile> <outfile> -b 1 -b 2 -b 3 -b 4 -of COG -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUS -co RESAMPLING=AVERAGE -config GDAL_TIFF_INTERNAL_MASK YES -config GDAL_TIF_OVR_BLOCKSIZE 128

A couple orders of magnitude longer:
gdal_translate <infile> <outfile> -b 1 -b 2 -b 3 -mask 4 -of COG -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUS -co RESAMPLING=AVERAGE -config GDAL_TIFF_INTERNAL_MASK YES -config GDAL_TIF_OVR_BLOCKSIZE 128

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Wednesday, April 15, 2020 4:38 AM
To: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Cc: Ritchie, Andrew C <aritchie at usgs.gov<mailto:aritchie at usgs.gov>>
Subject: [EXTERNAL] Re: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large jpeg cogs... REALLLLLY long time to unload.


Andrew,

Has your source raster an alpha band ? That could explain the difference since it isn't possible to directly create a YCbCrA JPEG compressed file, but internally a mask band must be created. However I wouldn't anticipate such a huge difference in performance between compression schemes. I would suggest not setting GDAL_CACHEMAX at all and letting it at its 5% default (increasing it is not always a good idea), in case it would be a performance issue at de-allocating cached blocks.

Even

--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200421/3c310d72/attachment.html>

From even.rouault at spatialys.com  Tue Apr 21 13:10:52 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 Apr 2020 22:10:52 +0200
Subject: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large
	jpeg cogs... REALLLLLY long time to unload.
In-Reply-To: <BY5PR09MB55543E3BC0FF41D201BBACD5B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>
References: <BY5PR09MB55543E3BC0FF41D201BBACD5B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>
Message-ID: <13572500.WEzDhVvTSm@even-i700>

Andrew,

> When I create a mask band in a large lzw-compressed or jpeg-compressed tif
> using the COG driver it dramatically increases processing time over writing
> RGBA (hours instead of minutes), so the issue is not jpeg compression, it's
> the creation of the mask band. Steps to reproduce:

There's clearly some complications & overhead internally to be able to deal with non-alpha 
mask bands. I wouldn't have expected it to be as large as you observed though. Would 
require deeper investigation to understand why that causes such performance difference.

By the way, you can drop ---config GDAL_TIFF_INTERNAL_MASK YES when using the COG 
driver. It sets it automacally.

> I also noticed that the -co BIGTIFF=NO option appears to be ignored in the
> COG driver. I can share a file if that's helpful (can not provide a link on
> the listserv)

I can't reproduce that:

gdal_translate byte.tif out.tif -of cog -co bigtiff=yes : creates a bigtiff file

gdal_translate byte.tif out.tif -of cog -co bigtiff=no -outsize 80000 80000 -co overviews=none
fails with "The TIFF file will be larger than 4GB, so BigTIFF is necessary.  Creation failed."

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200421/82a440b4/attachment-0001.html>

From rykovd at gmail.com  Tue Apr 21 14:54:03 2020
From: rykovd at gmail.com (Denis Rykov)
Date: Tue, 21 Apr 2020 23:54:03 +0200
Subject: [gdal-dev] Storing mask as part of the *.ovr file
Message-ID: <CAJbvKNocbAx=w7rS=F3Xf=giOC6_oK5BJ2H2n7Of6x9RZWf3KQ@mail.gmail.com>

Hello,

I'm using *.vrt file that is built atop of COG rasters with internal mask
(PER_DATASET) + external overview file *.vrt.ovr.
These files are stored on Azure Blob Storage and I get access to them using
/vsiaz scheme.
I've found out that when I read data from this VRT GDAL does few requests
to *.vrt.ovr to get data and lots of requests to TIFFs to extract a mask.

What are the ways to overcome this? I hope I can put mask into
sidecar *.vrt.msk file. Is that correct?
Is there a way to store a mask inside a *.vrt.ovr file?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200421/e8e013ec/attachment.html>

From palmerjnz at gmail.com  Tue Apr 21 14:57:12 2020
From: palmerjnz at gmail.com (Jeremy Palmer)
Date: Wed, 22 Apr 2020 07:57:12 +1000
Subject: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large
 jpeg cogs... REALLLLLY long time to unload.
In-Reply-To: <13572500.WEzDhVvTSm@even-i700>
References: <BY5PR09MB55543E3BC0FF41D201BBACD5B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>
 <13572500.WEzDhVvTSm@even-i700>
Message-ID: <CAA5WJYnaAeCw_zhXZAdmrn_vZjZcrBxXDUM5xX=XTJ_mknMqmA@mail.gmail.com>

Hi Andrew,

On Wed, Apr 22, 2020 at 6:11 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Andrew,
>
>
>
> > When I create a mask band in a large lzw-compressed or jpeg-compressed
> tif
>
> > using the COG driver it dramatically increases processing time over
> writing
>
> > RGBA (hours instead of minutes), so the issue is not jpeg compression,
> it's
>
> > the creation of the mask band. Steps to reproduce:
>
>
>
> There's clearly some complications & overhead internally to be able to
> deal with non-alpha mask bands. I wouldn't have expected it to be as large
> as you observed though. Would require deeper investigation to understand
> why that causes such performance difference.
>

I would also be interested to see what steps you have taken to process the
COG. We have used the driver to create both WEBP, and JPEG (including the
1bit transparency mask) COGs up to 200GB in size. It did take a couple of
days on a mid-sized AWS EC2 instance but completed OK. Note the most of the
time is taken up with the overview generation on large COGs. This will
hopefully improve soon with multi-threaded overview computation likely
coming to GDAL.

Warm Regards,
Jeremy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/ec8010bf/attachment.html>

From aritchie at usgs.gov  Tue Apr 21 15:33:23 2020
From: aritchie at usgs.gov (Ritchie, Andrew C)
Date: Tue, 21 Apr 2020 22:33:23 +0000
Subject: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large
 jpeg cogs... REALLLLLY long time to unload.
Message-ID: <BY5PR09MB55543E2F8969F0DC64A74188B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>

Hi Jeremy and Even,

Sorry I should’ve run more tests to clarify the situation re BIGTIFFs. It looks like gdal_translate honors -co BIGTIFF=NO for the raster but not the mask.

If I omit the mask, then I don’t see any bigtiff messages with -co BIGTIFF=NO. If I include the mask band (change -b 4 to -mask 4 with lzw-compressed) then with –debug on, then in the first few seconds of running I see the following lines:

COG: Generating overviews of the mask
GTIFF: File being created as a BIGTIFF.
GTIFF: Using 24 threads for compression

Incidentally, when I kill the process with ctrl-C (on a windoze machine) GDAL fails to exit gracefully (2 of 2 times this run) with the following as the final debug message

GDAL: Flushing dirty blocks: 0GTIFF: Waiting for worker job to finish handling block 0

My cmd:
gdal_translate <infile.tif> <outfile.tif> -b 1 -b 2 -b 3 -mask 4 -of cog -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUs -co RESAMPLING=AVERAGE -co BIGTIFF=NO –config GDAL_TIF_OVR_BLOCKSIZE 128 –debug ON

Jeremy – to clarify, I have confirmed that if I wait long enough, the COG will finish, so generating in the background is feasible if slow. I was just surprised that including a transparency mask increases the processing time so much. It’s necessary to reduce the file size using jpeg or webp compression and still provide transparency I guess, but it’s a huge performance penalty to pay. I don’t have enough programming experience (or time) to do profiling and figure out what the bottleneck is, and don’t get me wrong – I ❤ gdal x 10^10, but I thought this was worth mentioning because of the increase in time (which is so long I initially thought it was actually a hang).

As far as the steps to generate a COG – I output tiled tiffs, then create a VRT, then create a RGBA LZW cog, preview, and generate a JPEG COG. I only added the RGBA LZW cog because of the issues I was having generating the JPG cog – it’s actually a good point to delete the tiles in my workflow because I can go back to the LZW cog again and again if I need to since it’s lossless.

Andy

From: Jeremy Palmer <palmerjnz at gmail.com>
Sent: Tuesday, April 21, 2020 2:57 PM
To: Even Rouault <even.rouault at spatialys.com>
Cc: Ritchie, Andrew C <aritchie at usgs.gov>; gdal-dev at lists.osgeo.org
Subject: [EXTERNAL] Re: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large jpeg cogs... REALLLLLY long time to unload.

Hi Andrew,

On Wed, Apr 22, 2020 at 6:11 AM Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:

Andrew,



> When I create a mask band in a large lzw-compressed or jpeg-compressed tif

> using the COG driver it dramatically increases processing time over writing

> RGBA (hours instead of minutes), so the issue is not jpeg compression, it's

> the creation of the mask band. Steps to reproduce:



There's clearly some complications & overhead internally to be able to deal with non-alpha mask bands. I wouldn't have expected it to be as large as you observed though. Would require deeper investigation to understand why that causes such performance difference.

I would also be interested to see what steps you have taken to process the COG. We have used the driver to create both WEBP, and JPEG (including the 1bit transparency mask) COGs up to 200GB in size. It did take a couple of days on a mid-sized AWS EC2 instance but completed OK. Note the most of the time is taken up with the overview generation on large COGs. This will hopefully improve soon with multi-threaded overview computation likely coming to GDAL.

Warm Regards,
Jeremy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200421/788250ee/attachment-0001.html>

From palmerjnz at gmail.com  Wed Apr 22 00:22:23 2020
From: palmerjnz at gmail.com (Jeremy Palmer)
Date: Wed, 22 Apr 2020 17:22:23 +1000
Subject: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large
 jpeg cogs... REALLLLLY long time to unload.
In-Reply-To: <BY5PR09MB55543E2F8969F0DC64A74188B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>
References: <BY5PR09MB55543E2F8969F0DC64A74188B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>
Message-ID: <CAA5WJYkaNySMnveZpd+DiV8tMeDTJWFsahMchQH7C1G1=ngrJg@mail.gmail.com>

Hi Andy,

On Wed, Apr 22, 2020 at 8:33 AM Ritchie, Andrew C <aritchie at usgs.gov> wrote:

>
>
> Sorry I should’ve run more tests to clarify the situation re BIGTIFFs. It
> looks like gdal_translate honors -co BIGTIFF=NO for the raster but not the
> mask.
>

What's the output size of your COG when it successful completes?


>
>
> Incidentally, when I kill the process with ctrl-C (on a windoze machine)
> GDAL fails to exit gracefully (2 of 2 times this run) with the following as
> the final debug message
>
>
>
> GDAL: Flushing dirty blocks: 0GTIFF: Waiting for worker job to finish
> handling block 0
>

In my experience, the progress reporting in GDAL is not very good and can
spend a lot of time in the flushing dirty blocks process. It might be that
you can't interrupt GDAL at this point. I would wait a little longer. Even
will be able to comment further on this.

>
>
> My cmd:
>
> gdal_translate <infile.tif> <outfile.tif> -b 1 -b 2 -b 3 -mask 4 -of cog
> -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUs -co
> RESAMPLING=AVERAGE -co BIGTIFF=NO –config GDAL_TIF_OVR_BLOCKSIZE 128 –debug
> ON
>

Seems ok to me. For our processing of aerial RGB photos COGs, when we are
interested in web mapping use and a good balance between storage size and
quality, we go for something like:

gdalbuildvrt \
  -addalpha -hidenodata \
  $PWD/$TIF_FOLDER.vrt \
  $PWD/$TIF_FOLDER/*.tif

gdal_translate \
  -of COG \
  -co COMPRESS=WebP \
  -co NUM_THREADS=ALL_CPUS \
  -co BIGTIFF=YES \
  -co TILING_SCHEME=GoogleMapsCompatible \
  --config BIGTIFF_OVERVIEW YES \
  -co ALIGNED_LEVELS=3 \
  -co ADD_ALPHA=YES \
  -co BLOCKSIZE=512 \
  -co RESAMPLING=CUBIC \
  $PWD/$TIF_FOLDER.vrt $PWD/$TIF_FOLDER.webp.google.aligned.cog.tif


>
> Jeremy – to clarify, I have confirmed that if I wait long enough, the COG
> will finish, so generating in the background is feasible if slow. I was
> just surprised that including a transparency mask increases the processing
> time so much. It’s necessary to reduce the file size using jpeg or webp
> compression and still provide transparency I guess, but it’s a huge
> performance penalty to pay. I don’t have enough programming experience (or
> time) to do profiling and figure out what the bottleneck is, and don’t get
> me wrong – I ❤ gdal x 10^10, but I thought this was worth mentioning
> because of the increase in time (which is so long I initially thought it
> was actually a hang).
>

First, I would consider using WebP if you think your users can handle that.
It's way better than JPEG+Mask. Note I'm surprised that adding the mask to
the tiff is adding heaps of additional time. Can you generate your dataset
with and without the mask to see the time difference? As mentioned before,
most of the processing time is taken up in the overview generation
(especially when compared to the data compression stage, which can use all
of your CPU cores). Hopefully, some upcoming GDAL improvements can improve
this situation.


>
>
> As far as the steps to generate a COG – I output tiled tiffs, then create
> a VRT, then create a RGBA LZW cog, preview, and generate a JPEG COG. I only
> added the RGBA LZW cog because of the issues I was having generating the
> JPG cog – it’s actually a good point to delete the tiles in my workflow
> because I can go back to the LZW cog again and again if I need to since
> it’s lossless.
>

What was the issue you were having with JPEG compression? Just time to
process? I would try the above command to see if that gives a good result
(remove warping to GoogleMap projection if you don't need that as that adds
a lot to processing times)

Cheers,
Jeremy

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/265f529d/attachment.html>

From aritchie at usgs.gov  Wed Apr 22 01:24:43 2020
From: aritchie at usgs.gov (Ritchie, Andrew C)
Date: Wed, 22 Apr 2020 08:24:43 +0000
Subject: [gdal-dev] [EXTERNAL] Re: gdal_translate (3.1.0dev) "never"
 finishes on large jpeg cogs... REALLLLLY long time to unload.
In-Reply-To: <CAA5WJYkaNySMnveZpd+DiV8tMeDTJWFsahMchQH7C1G1=ngrJg@mail.gmail.com>
References: <BY5PR09MB55543E2F8969F0DC64A74188B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>
 <CAA5WJYkaNySMnveZpd+DiV8tMeDTJWFsahMchQH7C1G1=ngrJg@mail.gmail.com>
Message-ID: <DM6PR09MB5560B885E97A57FC4A8603D6B1D20@DM6PR09MB5560.namprd09.prod.outlook.com>

Hi Jeremy,

I’ve definitely identified that it’s the mask generation that takes more time and not the jpeg compression. If I force the mask in a .lzw COG the time goes from ~2.5 minutes to a couple hours, and if I just generate a 3-band jpeg with no mask, it similarly only takes about 3 minutes and exits cleanly and quickly. So any format with an alpha layer or three bands works great, but any format with a mask seems to choke, at least at the size that I’m working.

Thanks for sharing your pipeline. I like it! You only use the default quality though? I’ve found that I can generally perceive artifacts at around 85% and more like 90% if I look hard or it’s the right kind of imagery. We try to save as much detail as is reasonable since we’re generating imagery that fits into classification and mapping processes and working on machine learning workflows.

My LZW COGs are around 1-2GB, and the JPEG COGs are about 200-300MB. But I am producing data for areas easily 10x this size, so I worry what that means if we stay with the JPEG pipeline. I generated some WebP images a few years ago but hadn’t tried with COGs yet because (1) it’s incompatible with ArcMap/GlobalMapper (used by our org.) and (2) we get resistance with any file format that’s not old enough to vote. But the alpha layer support of WebP and the internal-mask-taking-just-shy-of-forever issue with JPEG might be enough to convince them. I’ll raise the issue but I’m guessing it won’t be an option in the near term. There’s a lot of momentum building for cloud-based service though, so I could be wrong.

I just modified my command to make webp at the same quality setting and it looks great in QGIS, and shrinks my test COG from 287MB to 195MB, but ArcMap hates it and so does GlobalMapper. Unfortunately as far as I can tell the only one that all three of them like is the LZW COGs but those are huge. I’m working with GlobalMapper on COGs right now, and I’ll see if I can get the ear of our people who talk with ESRI.



From: Jeremy Palmer <palmerjnz at gmail.com>
Sent: Wednesday, April 22, 2020 12:22 AM
To: Ritchie, Andrew C <aritchie at usgs.gov>
Cc: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: [EXTERNAL] Re: [gdal-dev] gdal_translate (3.1.0dev) "never" finishes on large jpeg cogs... REALLLLLY long time to unload.

Hi Andy,

On Wed, Apr 22, 2020 at 8:33 AM Ritchie, Andrew C <aritchie at usgs.gov<mailto:aritchie at usgs.gov>> wrote:

Sorry I should’ve run more tests to clarify the situation re BIGTIFFs. It looks like gdal_translate honors -co BIGTIFF=NO for the raster but not the mask.

What's the output size of your COG when it successful completes?


Incidentally, when I kill the process with ctrl-C (on a windoze machine) GDAL fails to exit gracefully (2 of 2 times this run) with the following as the final debug message

GDAL: Flushing dirty blocks: 0GTIFF: Waiting for worker job to finish handling block 0

In my experience, the progress reporting in GDAL is not very good and can spend a lot of time in the flushing dirty blocks process. It might be that you can't interrupt GDAL at this point. I would wait a little longer. Even will be able to comment further on this.

My cmd:
gdal_translate <infile.tif> <outfile.tif> -b 1 -b 2 -b 3 -mask 4 -of cog -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUs -co RESAMPLING=AVERAGE -co BIGTIFF=NO –config GDAL_TIF_OVR_BLOCKSIZE 128 –debug ON

Seems ok to me. For our processing of aerial RGB photos COGs, when we are interested in web mapping use and a good balance between storage size and quality, we go for something like:

gdalbuildvrt \
  -addalpha -hidenodata \
  $PWD/$TIF_FOLDER.vrt \
  $PWD/$TIF_FOLDER/*.tif

gdal_translate \
  -of COG \
  -co COMPRESS=WebP \
  -co NUM_THREADS=ALL_CPUS \
  -co BIGTIFF=YES \
  -co TILING_SCHEME=GoogleMapsCompatible \
  --config BIGTIFF_OVERVIEW YES \
  -co ALIGNED_LEVELS=3 \
  -co ADD_ALPHA=YES \
  -co BLOCKSIZE=512 \
  -co RESAMPLING=CUBIC \
  $PWD/$TIF_FOLDER.vrt $PWD/$TIF_FOLDER.webp.google.aligned.cog.tif


Jeremy – to clarify, I have confirmed that if I wait long enough, the COG will finish, so generating in the background is feasible if slow. I was just surprised that including a transparency mask increases the processing time so much. It’s necessary to reduce the file size using jpeg or webp compression and still provide transparency I guess, but it’s a huge performance penalty to pay. I don’t have enough programming experience (or time) to do profiling and figure out what the bottleneck is, and don’t get me wrong – I ❤ gdal x 10^10, but I thought this was worth mentioning because of the increase in time (which is so long I initially thought it was actually a hang).

First, I would consider using WebP if you think your users can handle that. It's way better than JPEG+Mask. Note I'm surprised that adding the mask to the tiff is adding heaps of additional time. Can you generate your dataset with and without the mask to see the time difference? As mentioned before, most of the processing time is taken up in the overview generation (especially when compared to the data compression stage, which can use all of your CPU cores). Hopefully, some upcoming GDAL improvements can improve this situation.


As far as the steps to generate a COG – I output tiled tiffs, then create a VRT, then create a RGBA LZW cog, preview, and generate a JPEG COG. I only added the RGBA LZW cog because of the issues I was having generating the JPG cog – it’s actually a good point to delete the tiles in my workflow because I can go back to the LZW cog again and again if I need to since it’s lossless.

What was the issue you were having with JPEG compression? Just time to process? I would try the above command to see if that gives a good result (remove warping to GoogleMap projection if you don't need that as that adds a lot to processing times)

Cheers,
Jeremy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/22219812/attachment-0001.html>

From even.rouault at spatialys.com  Wed Apr 22 03:09:37 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Apr 2020 12:09:37 +0200
Subject: [gdal-dev] Storing mask as part of the *.ovr file
In-Reply-To: <CAJbvKNocbAx=w7rS=F3Xf=giOC6_oK5BJ2H2n7Of6x9RZWf3KQ@mail.gmail.com>
References: <CAJbvKNocbAx=w7rS=F3Xf=giOC6_oK5BJ2H2n7Of6x9RZWf3KQ@mail.gmail.com>
Message-ID: <2938599.60COjL2veK@even-i700>

On mardi 21 avril 2020 23:54:03 CEST Denis Rykov wrote:
> Hello,
> 
> I'm using *.vrt file that is built atop of COG rasters with internal mask
> (PER_DATASET) + external overview file *.vrt.ovr.
> These files are stored on Azure Blob Storage and I get access to them using
> /vsiaz scheme.
> I've found out that when I read data from this VRT GDAL does few requests
> to *.vrt.ovr to get data and lots of requests to TIFFs to extract a mask.
> 
> What are the ways to overcome this? I hope I can put mask into
> sidecar *.vrt.msk file. Is that correct?
> Is there a way to store a mask inside a *.vrt.ovr file?

Hum, given a rgbmask.vrt that has a mask band, the following probably works

gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -b 1 -b 2 -b 3 -of VRT
gdal_translate rgbmask.vrt rgb_with_external_msk.vrt.msk -b mask -of VRT -mo INTERNAL_MASK_FLAGS_1=2 -mo INTERNAL_MASK_FLAGS_2=2 -mo INTERNAL_MASK_FLAGS_3=2
gdaladdo rgb_with_external_msk.vrt.msk

You could probably avoid rgb_with_external_msk.vrt referencing rgbmask.vrt, by making it directly refer to your COG sources.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/3fb0d3e4/attachment.html>

From even.rouault at spatialys.com  Wed Apr 22 04:26:19 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Apr 2020 13:26:19 +0200
Subject: [gdal-dev] [EXTERNAL] Re: gdal_translate (3.1.0dev) "never"
	finishes on large jpeg cogs... REALLLLLY long time to unload.
In-Reply-To: <DM6PR09MB5560B885E97A57FC4A8603D6B1D20@DM6PR09MB5560.namprd09.prod.outlook.com>
References: <BY5PR09MB55543E2F8969F0DC64A74188B1D50@BY5PR09MB5554.namprd09.prod.outlook.com>
 <CAA5WJYkaNySMnveZpd+DiV8tMeDTJWFsahMchQH7C1G1=ngrJg@mail.gmail.com>
 <DM6PR09MB5560B885E97A57FC4A8603D6B1D20@DM6PR09MB5560.namprd09.prod.outlook.com>
Message-ID: <5994898.MsxhmhqGsN@even-i700>

> If I omit the mask, then I don’t see any bigtiff messages with -co 
> BIGTIFF=NO. If I include the mask band (change -b 4 to -mask 4 with lzw-
> compressed) then with –debug on, then in the first few seconds of running I
> see the following lines:
> COG: Generating overviews of the mask
> GTIFF: File being created as a BIGTIFF.

Ah, yes, that's expected and you shouldn't matter. As the file that contains the
overview of the mask is temporary, it is systematically created with BIGTIFF to
avoid any potential issue with size. This has no influence on the final size.

> I’ve definitely identified that it’s the mask generation that takes more
> time and not the jpeg compression. 

Does it take more time than the following step which is "COG: Generating overviews of the imagery" ?

I've tried to replicate on a small VRT of size 10000x9259 made of 2 TIFF RGB+mask

Here's what I get (the "COG: Generating final product" has just been added in master)
with non relevant traces removed

$ gdal_translate in.vrt cog.tif -of COG --debug COG,GDAL --config CPL_TIMESTAMP YES -co COMPRESS=LZW -co PREDICTOR=2 -co NUM_THREADS=ALL_CPUs -co RESAMPLING=AVERAGE -co BIGTIFF=NO --config GDAL_TIF_OVR_BLOCKSIZE 128
[Wed Apr 22 13:17:20 2020].209431: COG: Generating overviews of the mask
[Wed Apr 22 13:17:23 2020].517241: COG: Generating overviews of the imagery
[Wed Apr 22 13:17:33 2020].255700: COG: Generating final product
[Wed Apr 22 13:17:36 2020].264771: GDAL: In GDALDestroy - unloading GDAL shared library.

So basically, generation of the overviews of the mask took 3 seconds, generation of the
overviews of imagery took 10 seconds, and final COG generation 3 seconds

Given the work actually needed to generate a COG, this is what I expect.
 
> I just modified my command to make webp at the same quality setting and it
> looks great in QGIS, and shrinks my test COG from 287MB to 195MB, but
> ArcMap hates it and so does GlobalMapper. Unfortunately as far as I can
> tell the only one that all three of them like is the LZW COGs but those are
> huge. I’m working with GlobalMapper on COGs right now, and I’ll see if I
> can get the ear of our people who talk with ESRI.

ESRI already use (some of) GDAL: they just need to enable more of it.
And GlobalMapper last time I looked (several years ago) didn't seem to use GDAL.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/f87355df/attachment.html>

From cdelancy at blackfangtechnologies.com  Wed Apr 22 05:35:23 2020
From: cdelancy at blackfangtechnologies.com (Craig Delancy)
Date: Wed, 22 Apr 2020 12:35:23 +0000
Subject: [gdal-dev] Can't read get a spatial reference from Geotiffs
 exported from QGIS (c++ API)
Message-ID: <DM6PR17MB388470CC383E0D41902E9A81C7D20@DM6PR17MB3884.namprd17.prod.outlook.com>

Hello.

I am building an application around GDAL using the C++ API, but I have ran into a snag.
Normally, after using GDAL Open on a Geotiff file, I am able to get a spatial reference containing all the information I need about the projection.
However, when I try to get a spatial reference from a Geotiff that was specifically exported from QGIS, it is always NULL.

Does anyone know why this is or have suggestions for me to look into?
So far, the only files like this are specifically from QGIS, which is strange to me.

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/4b223062/attachment-0001.html>

From alansnow21 at gmail.com  Wed Apr 22 05:59:12 2020
From: alansnow21 at gmail.com (Alan Snow)
Date: Wed, 22 Apr 2020 07:59:12 -0500
Subject: [gdal-dev] Can't read get a spatial reference from Geotiffs
 exported from QGIS (c++ API)
In-Reply-To: <DM6PR17MB388470CC383E0D41902E9A81C7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
References: <DM6PR17MB388470CC383E0D41902E9A81C7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
Message-ID: <CAGybdFQ4YTemHzCYp8iLeKHLspY6UqGiry-bCGtqTdrqtQED0g@mail.gmail.com>

Hi Craig,

Providing to this information might give us more clues:

What version of GDAL are you using? What version of GDAL is QGIS using?
What operating system are you using?


On Wed, Apr 22, 2020, 7:35 AM Craig Delancy <
cdelancy at blackfangtechnologies.com> wrote:

> Hello.
>
>
>
> I am building an application around GDAL using the C++ API, but I have ran
> into a snag.
>
> Normally, after using GDAL Open on a Geotiff file, I am able to get a
> spatial reference containing all the information I need about the
> projection.
>
> However, when I try to get a spatial reference from a Geotiff that was
> specifically exported from QGIS, it is always NULL.
>
>
>
> Does anyone know why this is or have suggestions for me to look into?
>
> So far, the only files like this are specifically from QGIS, which is
> strange to me.
>
>
>
> Thank you.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/cdfda075/attachment.html>

From even.rouault at spatialys.com  Wed Apr 22 07:36:21 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Apr 2020 16:36:21 +0200
Subject: [gdal-dev] Can't read get a spatial reference from Geotiffs
	exported from QGIS (c++ API)
In-Reply-To: <DM6PR17MB388470CC383E0D41902E9A81C7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
References: <DM6PR17MB388470CC383E0D41902E9A81C7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
Message-ID: <5175351.miuJCvH1XF@even-i700>

On mercredi 22 avril 2020 12:35:23 CEST Craig Delancy wrote:
> Hello.
> 
> I am building an application around GDAL using the C++ API, but I have ran
> into a snag. Normally, after using GDAL Open on a Geotiff file, I am able
> to get a spatial reference containing all the information I need about the
> projection. However, when I try to get a spatial reference from a Geotiff
> that was specifically exported from QGIS, it is always NULL.
> 
> Does anyone know why this is or have suggestions for me to look into?
> So far, the only files like this are specifically from QGIS, which is
> strange to me.

Does gdalinfo report the right SRS ?

I'm wondering if QGIS didn't export a side car file in some circumstances, with projection info 
(.qpj or whatever), that was specific to it, and thus would explain GDAL doesn't see it. But I'm 
pretty sure you must have options to create a real geotiff file with georeferencing 
embedded into it.

Just attach an example of / link to a (small) file (and possibly associated side car files) that 
exhibit the issue

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/5e45f580/attachment.html>

From ao at t-kartor.se  Wed Apr 22 08:14:55 2020
From: ao at t-kartor.se (Andreas Oxenstierna)
Date: Wed, 22 Apr 2020 17:14:55 +0200
Subject: [gdal-dev] Can't read get a spatial reference from Geotiffs
 exported from QGIS (c++ API)
In-Reply-To: <5175351.miuJCvH1XF@even-i700>
References: <DM6PR17MB388470CC383E0D41902E9A81C7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
 <5175351.miuJCvH1XF@even-i700>
Message-ID: <84dbeb96-9e6d-d552-3fea-6c07031c7dcd@t-kartor.se>

QGIS can certainly export valid GeoTIFFs.
But the checkbox "Add georef info" must be checked.
Which SRS is you trying to export?

To my knowledge, qpj is only created for vector data. "Identical" with 
the ESRI prj file

> On mercredi 22 avril 2020 12:35:23 CEST Craig Delancy wrote:
>
> > Hello.
>
> >
>
> > I am building an application around GDAL using the C++ API, but I 
> have ran
>
> > into a snag. Normally, after using GDAL Open on a Geotiff file, I am 
> able
>
> > to get a spatial reference containing all the information I need 
> about the
>
> > projection. However, when I try to get a spatial reference from a 
> Geotiff
>
> > that was specifically exported from QGIS, it is always NULL.
>
> >
>
> > Does anyone know why this is or have suggestions for me to look into?
>
> > So far, the only files like this are specifically from QGIS, which is
>
> > strange to me.
>
> Does gdalinfo report the right SRS ?
>
> I'm wondering if QGIS didn't export a side car file in some 
> circumstances, with projection info (.qpj or whatever), that was 
> specific to it, and thus would explain GDAL doesn't see it. But I'm 
> pretty sure you must have options to create a real geotiff file with 
> georeferencing embedded into it.
>
> Just attach an example of / link to a (small) file (and possibly 
> associated side car files) that exhibit the issue
>
> Even
>
> -- 
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins väg 12 Kristianstad
mobile: +46 733 206831
mailto: ao at t-kartor.se
http://www.t-kartor.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/fbf4662b/attachment.html>

From Mika.Heiskanen at fmi.fi  Wed Apr 22 09:45:48 2020
From: Mika.Heiskanen at fmi.fi (Heiskanen Mika (FMI))
Date: Wed, 22 Apr 2020 16:45:48 +0000
Subject: [gdal-dev] Replacement for +init when using +lon_wrap
Message-ID: <1587573948138.47332@fmi.fi>

Hello,


GDAL now warns that the +init syntax is deprecated. The documentation explains that for example

instead of +init=epsg:4326 one should just use epsg:4326. However, it does not seem to explain what

do to if one wants to modify the crs as in the following example:


> echo "25w 60n" | /usr/proj70/bin/cs2cs -f "%.8f" +from +init=epsg:4326 +to +init=epsg:4326 +lon_wrap=180
335.00000000 60.00000000 0.00000000
> echo "60n 25w" | /usr/proj70/bin/cs2cs -f "%.8f" +from epsg:4326 +to +init=epsg:4326 +lon_wrap=180
335.00000000 60.00000000 0.00000000
> echo "60n 25w" | /usr/proj70/bin/cs2cs -f "%.8f" +from epsg:4326 +to epsg:4326 +lon_wrap=180
proj_create: crs not found

It seems like one would have to replace epsg:4326 on the right hand side with the respective PROJ-string,
which is quite inconvenient. Is this the only solution once the +init syntax has been removed?
?
Regards,

Mika Heiskanen



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/53223d0a/attachment.html>

From hbarrett at edac.unm.edu  Wed Apr 22 10:17:27 2020
From: hbarrett at edac.unm.edu (Hays Barrett)
Date: Wed, 22 Apr 2020 11:17:27 -0600 (MDT)
Subject: [gdal-dev] Help with finding residual error for a given GCP.
In-Reply-To: <6788207.jeMqpP4UNc@even-i700>
References: <55319196.6652310.1587418816631.JavaMail.zimbra@edac.unm.edu>
 <6788207.jeMqpP4UNc@even-i700>
Message-ID: <709173586.6972231.1587575847141.JavaMail.zimbra@edac.unm.edu>

That works great! Thanks Evan! 


From: "Even Rouault" <even.rouault at spatialys.com> 
To: gdal-dev at lists.osgeo.org 
Cc: "Hays Barrett" <hbarrett at edac.unm.edu> 
Sent: Tuesday, April 21, 2020 7:18:04 AM 
Subject: Re: [gdal-dev] Help with finding residual error for a given GCP. 



Hays, 



GCPsToGeoTransform() is not used directly by gdalwarp (although it should likely be equivalent to running -order 1 polynomial), but by other code (OZI .map exporting, .tab exporting) 



You rather want to use the gdal.Transformer() API which is tested in 

https://github.com/OSGeo/gdal/blob/master/autotest/gcore/transformer.py 



Even 





> Hello all, 

> I want to get the error for each GCP before warping so I can calculate the 

> RMSE before georeferencing. With a list of GCPs, is it possible to get the 

> eventual map location of each pixel coordinate to calculate the 

> transformation error for each GCP? I have tried to use GCPsToGeoTransform 

> but that gave me a map location that was further from the intended chosen 

> GCP coordinate than the actual post- georeferencing pixel location. 

> 

> Here is my GCPsToGeoTransform code: 

> ##CODE_START 

> 

> from osgeo import gdal 

> #list of GCPs 

> gcpjson={'0': {'row': 5305.626973704321, 'col': 1158.432032601927, 'lat': 

> -107.18221364936802, 'lon': 35.08107313264506}, '1': {'row': 

> 778.3230540174817, 'col': 2317.0737231100225, 'lat': -107.17634116783263, 

> 'lon': 35.09958594602314}, '2': {'row': 3950.8777704175645, 'col': 

> 4880.465723118029, 'lat': -107.163460244414, 'lon': 35.08679518563491}, 

> '3': {'row': 7609.882307742781, 'col': 4407.027704042081, 'lat': 

> -107.16570574683065, 'lon': 35.07164256912238}, '4': {'row': 

> 1822.0904204049455, 'col': 6486.900377637105, 'lat': -107.15529960157271, 

> 'lon': 35.096105471961536}, '5': {'row': 6291.396402113635, 'col': 

> 7216.1033738731185, 'lat': -107.15180240538085, 'lon': 35.077317337370516}} 

> 

> #New list to put in gdal.GCP objects into 

> gcpList=[] 

> #Load GCP objects into gcpList 

> for gcp in gcpjson: 

> gcpList.append(gdal.GCP(gcpjson[gcp]['lat'],gcpjson[gcp]['lon'],0,gcpjson[gc 

> p]['col'],gcpjson[gcp]['row'])) 

> 

> #create GeoTranform from gcp list 

> GT = gdal.GCPsToGeoTransform(tuple(gcpList)) 

> 

> #Get pixel location from first GCP as a test. 

> col=gcpjson['0']['col'] 

> row=gcpjson['0']['row'] 

> xp = GT[0] + col*GT[1] + row*GT[2] 

> yp = GT[3] + col*GT[4] + row*GT[5] 

> print("POINT ("+str(xp)+" "+str(yp)+" 0)") 

> 

> ##CODE_END 

> 

> This prints out the WKT 'POINT (-107.18216298 35.0808978834 0)' which is 

> kinda close to -107.18221364936802, 35.08107313264506 but looking at my 

> post warped image the chosen pixel is right on top of the intended 

> coordinate so I am clearly doing something (or a lot) wrong. 

> 

> 

> 

> Any help would be great. 

> Thanks, 

> -Hays 





-- 

Spatialys - Geospatial professional services 

http://www.spatialys.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/94f51f88/attachment-0001.html>

From even.rouault at spatialys.com  Wed Apr 22 10:27:29 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Apr 2020 19:27:29 +0200
Subject: [gdal-dev] Can't read get a spatial reference from Geotiffs
	exported from QGIS (c++ API)
In-Reply-To: <DM6PR17MB3884FD9700368E053238242FC7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
References: <DM6PR17MB388470CC383E0D41902E9A81C7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
 <5175351.miuJCvH1XF@even-i700>
 <DM6PR17MB3884FD9700368E053238242FC7D20@DM6PR17MB3884.namprd17.prod.outlook.com>
Message-ID: <2859479.lqvZZDyOUk@even-i700>

On mercredi 22 avril 2020 14:58:15 CEST Craig Delancy wrote:
> Here is a link to the test file:

> I cannot find any other file created during the export process.
> 
> This is the full report I receive from GDALInfo:

OK, your gdalinfo output indeed lacks the CRS. But I do get it on my installation with your 
file:

PROJCRS["ETRS89 / UTM zone 30N",
    BASEGEOGCRS["ETRS89",
        DATUM["European Terrestrial Reference System 1989",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4258]],
    CONVERSION["UTM zone 30N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-3,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["unknown"],
        AREA["Europe - 6°W to 0°W and ETRS89 by country"],
        BBOX[35.26,-6,80.53,0]],
    ID["EPSG",25830]]

I'm wondering if it is not something with your installation. Perhaps PROJ_LIB not pointing to 
the PROJ resource directory.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/1308471b/attachment.html>

From even.rouault at spatialys.com  Wed Apr 22 10:28:38 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Apr 2020 19:28:38 +0200
Subject: [gdal-dev] Replacement for +init when using +lon_wrap
In-Reply-To: <1587573948138.47332@fmi.fi>
References: <1587573948138.47332@fmi.fi>
Message-ID: <3547823.cJ6CUTB0J6@even-i700>

Mika,

You're using an advanced PROJ feature, with no equivalent in ISO 
CRS modeling, so there's no direct replacement. You can still go on 
with the old syntax. Or expand to "+proj=longlat +datum=WGS84 
+lon_wrap=180" if you want to avoid the warning

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/b7da32d3/attachment.html>

From even.rouault at spatialys.com  Wed Apr 22 11:24:40 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Apr 2020 20:24:40 +0200
Subject: [gdal-dev] libgeotiff 1.6.0 RC1 available
Message-ID: <1594887.GW0vyN4rGv@even-i700>

Hi,

I've prepared a libgeotiff 1.6.0 release candidate

Sources at:
- http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.6.0rc1.tar.gz
- http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.6.0rc1.zip

It is used as the internal libgeotiff copy in GDAL master.

I'll call for a vote for promoting it to final soon if I don't hear about serious issues with it.

Changelog:

New features:
* Add support for OGC GeoTIFF 1.1
* Expose GTIFGetPCSInfoEx(), GTIFGetProjTRFInfoEx(), GTIFGetGCSInfoEx(), 
GTIFGetDatumInfoEx(), GTIFGetEllipsoidInfoEx(), GTIFGetPMInfoEx(), 
GTIFGetUOMLengthInfoEx() and GTIFGetUOMAngleInfoEx() so that users can specify their 
own PROJ context
* Add GTIFKeyGetASCII(), GTIFKeyGetSHORT() and GTIFKeyGetDOUBLE() as safer variants of 
GTIFKeyGet() with type checking
* autotools build: enable build in a separate tree from source (#37) (fixes #28)
* Use pkg-config for libtiff detection

Bug fixes:
* GTIFDecToDMS(): fix rounding issue (refs #16)
* geo_names.c: Silence warning in GetNameFromDatabase
* cpl_serv.h: add parenthesis in macro definitions
* Fix spelling errors
* geo_normalize.c: set UOMLength from GeogLinearUnits (for geocentic CRS) (GDAL #1595)
* testlistgeo: remove hardcoded path in test output (fixes https://github.com/OSGeo/
libgeotiff/issues/16#issuecomment-502267406)
* Adapt test script for PROJ 6.2 EPSG database (fixes #22)
* Use unix EOL for cmake related files (fixes #14)
* configure.ac: drop dead code
* geo_normalize.c: avoid look up of user-defined geokeys that cause PROJ warnings (fixes 
GDAL #2321)
* listgeo: fix corner coordinates for images with RasterPixelIsPoint (#36)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200422/d192111e/attachment.html>

From rykovd at gmail.com  Wed Apr 22 15:22:39 2020
From: rykovd at gmail.com (Denis Rykov)
Date: Thu, 23 Apr 2020 00:22:39 +0200
Subject: [gdal-dev] Storing mask as part of the *.ovr file
In-Reply-To: <2938599.60COjL2veK@even-i700>
References: <CAJbvKNocbAx=w7rS=F3Xf=giOC6_oK5BJ2H2n7Of6x9RZWf3KQ@mail.gmail.com>
 <2938599.60COjL2veK@even-i700>
Message-ID: <CAJbvKNr9EC_1tOceB2k_p3XM0AwCP6NARvq-cNC1ayi2mkoqpg@mail.gmail.com>

Thanks Even! I'll give it a try.

Could you please help me understand the difference between two next cases.
When I do either

    gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -mask none -b 1 -b
2 -b 3 -of VRT
    or
    gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -mask none -of VRT

I'm getting the same (I would say expected) result: VRT raster with 3
VRTRasterBand / 1  SimpleSource element per each band.

But if I do:

    gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -mask none -b 1 -b
2 -b 3 -of VRT

I'm getting VRT with:

1) 3 VRTRasterBand + 1 MaskBand
2) Each VRTRasterBand has many SimpleSource elements with various DstRect.

So it seems if we don't tell to GDAL not to use mask it copies it by
default. But why the structure of VRTRasterBand is different?



On Wed, Apr 22, 2020 at 12:09 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 21 avril 2020 23:54:03 CEST Denis Rykov wrote:
>
> > Hello,
>
> >
>
> > I'm using *.vrt file that is built atop of COG rasters with internal mask
>
> > (PER_DATASET) + external overview file *.vrt.ovr.
>
> > These files are stored on Azure Blob Storage and I get access to them
> using
>
> > /vsiaz scheme.
>
> > I've found out that when I read data from this VRT GDAL does few requests
>
> > to *.vrt.ovr to get data and lots of requests to TIFFs to extract a mask.
>
> >
>
> > What are the ways to overcome this? I hope I can put mask into
>
> > sidecar *.vrt.msk file. Is that correct?
>
> > Is there a way to store a mask inside a *.vrt.ovr file?
>
>
>
> Hum, given a rgbmask.vrt that has a mask band, the following probably works
>
>
>
> gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -b 1 -b 2 -b 3 -of VRT
>
> gdal_translate rgbmask.vrt rgb_with_external_msk.vrt.msk -b mask -of VRT
> -mo INTERNAL_MASK_FLAGS_1=2 -mo INTERNAL_MASK_FLAGS_2=2 -mo
> INTERNAL_MASK_FLAGS_3=2
>
> gdaladdo rgb_with_external_msk.vrt.msk
>
>
>
> You could probably avoid rgb_with_external_msk.vrt referencing
> rgbmask.vrt, by making it directly refer to your COG sources.
>
>
>
> Even
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200423/cc67c2e7/attachment.html>

From even.rouault at spatialys.com  Wed Apr 22 15:44:07 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 23 Apr 2020 00:44:07 +0200
Subject: [gdal-dev] Storing mask as part of the *.ovr file
In-Reply-To: <CAJbvKNr9EC_1tOceB2k_p3XM0AwCP6NARvq-cNC1ayi2mkoqpg@mail.gmail.com>
References: <CAJbvKNocbAx=w7rS=F3Xf=giOC6_oK5BJ2H2n7Of6x9RZWf3KQ@mail.gmail.com>
 <2938599.60COjL2veK@even-i700>
 <CAJbvKNr9EC_1tOceB2k_p3XM0AwCP6NARvq-cNC1ayi2mkoqpg@mail.gmail.com>
Message-ID: <54748796.4O25p259vW@even-i700>

> But if I do:
> 
>     gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -mask none -b 1 -b
> 2 -b 3 -of VRT

I guess in the above you meant without "-mask none", so 

"gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -b 1 -b 2 -b 3 -of VRT"

Well, that's a consequence of the behaviour of the 'auto' mode of -mask in
https://gdal.org/programs/gdal_translate.html#cmdoption-gdal-translate-mask
This is admitedly not super intuitive as the example I gave before lacked the "-mask none" 
when generating  rgb_with_external_msk.vrt

As you copy all non-mask input band, and mask is in auto mode, and thus copied too, this is 
equivalent to

gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -of VRT

and the VRT driver is then smart enough to detect that its source is a VRT, so it is an 
equivalent of a single "cp" of the original VRT.



-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200423/df12ad24/attachment.html>

From rykovd at gmail.com  Thu Apr 23 01:27:13 2020
From: rykovd at gmail.com (Denis Rykov)
Date: Thu, 23 Apr 2020 10:27:13 +0200
Subject: [gdal-dev] Storing mask as part of the *.ovr file
In-Reply-To: <54748796.4O25p259vW@even-i700>
References: <CAJbvKNocbAx=w7rS=F3Xf=giOC6_oK5BJ2H2n7Of6x9RZWf3KQ@mail.gmail.com>
 <2938599.60COjL2veK@even-i700>
 <CAJbvKNr9EC_1tOceB2k_p3XM0AwCP6NARvq-cNC1ayi2mkoqpg@mail.gmail.com>
 <54748796.4O25p259vW@even-i700>
Message-ID: <CAJbvKNoTZ43L8cLspvv7U3Huvdob1iyFCsjsrfr38G=Cvd1nHQ@mail.gmail.com>

Thanks! Could you please explain the meaning of INTERNAL_MASK_FLAGS_1=2? I
couldn't find it in the documentation.

On Thu, Apr 23, 2020, 12:44 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> > But if I do:
>
> >
>
> > gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -mask none -b 1 -b
>
> > 2 -b 3 -of VRT
>
>
>
> I guess in the above you meant without "-mask none", so
>
>
>
> "gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -b 1 -b 2 -b 3 -of
> VRT"
>
>
>
> Well, that's a consequence of the behaviour of the 'auto' mode of -mask in
>
> https://gdal.org/programs/gdal_translate.html#cmdoption-gdal-translate-mask
>
> This is admitedly not super intuitive as the example I gave before lacked
> the "-mask none" when generating rgb_with_external_msk.vrt
>
>
>
> As you copy all non-mask input band, and mask is in auto mode, and thus
> copied too, this is equivalent to
>
>
>
> gdal_translate rgbmask.vrt rgb_with_external_msk.vrt -of VRT
>
>
>
> and the VRT driver is then smart enough to detect that its source is a
> VRT, so it is an equivalent of a single "cp" of the original VRT.
>
>
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200423/0b2be8e3/attachment.html>

From louis-philippe.rousseaulambert2 at canada.ca  Thu Apr 23 09:14:47 2020
From: louis-philippe.rousseaulambert2 at canada.ca (Rousseau Lambert2, Louis-Philippe (EC))
Date: Thu, 23 Apr 2020 16:14:47 +0000
Subject: [gdal-dev] NetCDF rotated grid support
References: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>
 <4840350.Rbt4YPPae9@even-i700> <1687475.bTrxGPkrb0@even-i700>
Message-ID: <8e143d4edf0241d295c997515542eed3@PELEPCDEXC006.birch.int.bell.ca>

Hi Even,

I can confirm I also find that working with those projections is a nightmare ;)

I did some more tests with the rotated_pole.nc in gdal GitHub repo (https://github.com/OSGeo/gdal/tree/master/autotest/gdrivers/data) just to make sure the issue was not with my data.

I found that I also had the same issue with rotated_pole.nc when trying to display the file in QGIS using newer version of gdal (3.0.4) and Proj (6.3.1). The NetCDF which should be on Europe, is misplaced and centered on Africa (using 0,0 as origin I guess).

But, I tried to open the same file (rotated_pole.nc) in QGIS using gdal (2.4.1) and proj (5.2.0) and the file was correctly placed, thus using those versions the rotated pole grid is correctly supported/read. The issue I'm having with rotated grid seems to be only in recent version of gdal/proj.

And if I look at the projection reported int the gdalinfo I get:

  *   gdal 3.0.4 and proj 6.3.0:
     *   Driver: netCDF/Network Common Data Format Files: rotated_pole.nc Size is 137, 108 Coordinate System is: PROJCRS["unnamed", BASEGEOGCRS["unknown", DATUM["unnamed", ELLIPSOID["Spheroid",6367470,594.313048347956, LENGTHUNIT["metre",1, ID["EPSG",9001]]]], PRIMEM["Greenwich",0, ANGLEUNIT["degree",0.0174532925199433, ID["EPSG",9122]]]], CONVERSION["unnamed", METHOD["Rotated_pole"]], CS[Cartesian,2], AXIS["easting",east, ORDER[1], LENGTHUNIT["metre",1, ID["EPSG",9001]]], AXIS["northing",north, ORDER[2], LENGTHUNIT["metre",1, ID["EPSG",9001]]]] Data axis to CRS axis mapping: 1,2 PROJ.4 string is: '+proj=ob_tran +o_proj=longlat +lon_0=18 +o_lon_p=0 +o_lat_p=39.25 +a=6367470 +b=6367470 +to_meter=0.0174532925199 +wktext' Origin = (-35.470000000560987,23.650000304819269) Pixel Size = (0.440000001121970,-0.439999999286972) Metadata: NC_GLOBAL#Conventions=CF-1.4 projection#false_easting=0 projection#false_northing=0 projection#grid_north_pole_latitude=39.25 projection#grid_north_pole_longitude=-162 projection#north_pole_grid_longitude=0 projection#semi_major_axis=6367470 projection#semi_minor_axis=6356756 tg#grid_mapping=projection ... Corner Coordinates: Upper Left ( -35.4700000, 23.6500003) Lower Left ( -35.4700000, -23.8699996) Upper Right ( 24.8100002, 23.6500003) Lower Right ( 24.8100002, -23.8699996) Center ( -5.3299999, -0.1099997) Band 1 Block=137x1 Type=Int16, ColorInterp=Undefined Computed Min/Max=-3778.000,1476.000
  *   gdal 2.4.1 and proj 5.2.0:
     *   Driver: netCDF/Network Common Data Format Files: rotated_pole.nc rotated_pole.nc.aux.xml Size is 137, 108 Coordinate System is: PROJCS["unnamed", GEOGCS["unknown", DATUM["unknown", SPHEROID["Spheroid",6367470,594.3130483479559]], PRIMEM["Greenwich",0], UNIT["degree",0.0174532925199433]], PROJECTION["Rotated_pole"], EXTENSION["PROJ4","+proj=ob_tran +o_proj=longlat +lon_0=18 +o_lon_p=0 +o_lat_p=39.25 +a=6367470 +b=6367470 +to_meter=0.0174532925199 +wktext"]] PROJ.4 string is: '+proj=ob_tran +o_proj=longlat +lon_0=18 +o_lon_p=0 +o_lat_p=39.25 +a=6367470 +b=6367470 +to_meter=0.0174532925199 +wktext' Origin = (-35.470000000560987,23.650000304819269) Pixel Size = (0.440000001121970,-0.439999999286972) Metadata: NC_GLOBAL#Conventions=CF-1.4 projection#false_easting=0 projection#false_northing=0 projection#grid_north_pole_latitude=39.25 projection#grid_north_pole_longitude=-162 projection#north_pole_grid_longitude=0 projection#semi_major_axis=6367470 projection#semi_minor_axis=6356756 tg#grid_mapping=projection ... Corner Coordinates: Upper Left ( -35.4700000, 23.6500003) ( 55d 6'46.50"W, 56d15'18.83"N) Lower Left ( -35.4700000, -23.8699996) ( 16d 4'19.39"W, 18d42'19.70"N) Upper Right ( 24.8100002, 23.6500003) ( 78d43'49.95"E, 63d51'22.90"N) Lower Right ( 24.8100002, -23.8699996) ( 42d35'19.21"E, 22d45'11.78"N) Center ( -5.3299999, -0.1099997) ( 9d37'52.99"E, 50d20'18.47"N) Band 1 Block=137x1 Type=Int16, ColorInterp=Undefined Min=-3778.000 Max=1476.000 Computed Min/Max=-3778.000,1476.000

With the new versions, the EXTENSION is missing from the WKT, which I guess makes the reprojection fail when I try to view it in Qgis ?

Thanks

LP

On 2020-04-15 10:13, Even Rouault wrote:

Louis-Philippe,



Support for rotated grid is a nightmare due to different conventions used for GRIB, netCDF or PROJ ob_tran method. The GDAL GRIB and netCDF drivers normally do what is needed map from the native product convention to the PROJ one.



Below 2 emails I wrote some time ago the OGC CRS SWG group which might bring some light (or deep obscurity!) to this topic:



1)



Rotated pole/grid

From: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>

To: "crs.swg at lists.opengeospatial.org"<mailto:crs.swg at lists.opengeospatial.org> <crs.swg at lists.opengeospatial.org><mailto:crs.swg at lists.opengeospatial.org>

Date: 03/10/2019 14:26

Hi again,



(was initially a part of my previous email about "Expressing a ProjectedCRS of

a DerivedGeographicCRS", but this deserves its own thread)



Standardization of rotated pole is another interesting/annoying topic I've

discussed with a few people privately. This tends to be tricky as I always

stumble on different conventions regarding the semantics of parameters and the

maths behind.



For posterity, and my own recollection, here are my latest findings:



1) PROJ's ob_tran (https://proj.org/operations/projections/ob_tran.html)

formulas are a straightforward implementation from Snyder's "Map projections -

a working manual", in particular equations (5-7) and (5-8b) for the forward

path, at page 31 of https://pubs.usgs.gov/pp/1395/report.pdf



(although I've some disagreement with the 'new pole' terminology currently

used in the above HTML help page:

https://github.com/OSGeo/PROJ/pull/1653 )



2) But they are different from the conventions used for PDS3 or ISIS3

planetary image formats, a bit like if the forward and inverse paths had been

switched, so you need to 'switch' parameters, do crazy things like 180 -

pole_latitude, etc when crossing different conventions... Interestingly one

doc for PDS3 mentions at the middle of page 10 of https://pds-imaging.jpl.nasa.gov/documentation/Cassini_BIDRSIS.PDF that "The derivation

of these equations is given in reference [12], p. 29—32, but a

critical pair of signs appear to be exchanged between the formulae

for the forward and inverse transformations. Reference [13], p. 6,

gives the correct forward transformation, and reference [14], pp. 77—

78, give both the forward and inverse transformations"



"reference [12] p29-32" is Snyder's "Map projections - a working manual" I

mentionned before. So this somewhat acknowledges the existence of different

conventions (not sure if there are really "wrong" and "correct" ones)

reference [13] is "Bugayevskiy, L. M., and Snyder, J. P., 1995, Map

projections: A reference manual, Taylor & Francis, London and Bristol,

Pennsylvania, 328 pp."

and [14] "Yang, Q. H., Snyder, J. P., and Tobler, W. R., 2000, Map projection

transformations: Principles and applications, Taylor & Francis, London and

Bristol, Pennsylvania, 367 pp"



PDS/ISIS3 implementation of [13] and [14] is in

https://github.com/USGS-Astrogeology/ISIS3/blob/3.8.0/isis/src/base/objs/

ObliqueCylindrical/ObliqueCylindrical.cpp#L311



3) When dealing with netCDF rotated pole, I've also seen issues with

conventions.

An implementation of that convention is in netcdf-java:

https://github.com/Unidata/netcdf-java/blob/

3ce72c0cd167609ed8c69152bb4a004d1daa9273/cdm/core/src/main/java/ucar/unidata/

geoloc/projection/RotatedPole.java



4) GRIB2 also uses a yet another different convention (with south pole

coordinates as parameters)

An implementation of that convention is also in netcdf-java in

https://github.com/Unidata/netcdf-java/blob/

3ce72c0cd167609ed8c69152bb4a004d1daa9273/cdm/core/src/main/java/ucar/unidata/

geoloc/projection/RotatedLatLon.java

I was also pointed by a data producer of GRIB2 rotated pole datasets that they

used https://www.mathworks.com/matlabcentral/fileexchange/43435-rotated-grid-transform?focused=3795951&tab=function&ue&nocookie=true as the inspiration for

their maths, and luckily it gives consistent result with the Java

RotatedLatLon code.





All in all, a lot of confusion which I think depends if you consider north

pole vs south pole, or the coordinates of the unrotated pole in the rotated

grid, or the coordinates of the new rotated pole in the unrotated grid...



As far as I experimented, there's always a way of using a given implementation

(in my case ob_tran) with the other conventions by tweaking the values of the

3 angular parameters. So, despite the diversity of conventions, considering

standardizing one could still be useful.



Even



2)



Re: Rotated pole/grid

From: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>

To: "crs.swg at lists.opengeospatial.org"<mailto:crs.swg at lists.opengeospatial.org> <crs.swg at lists.opengeospatial.org><mailto:crs.swg at lists.opengeospatial.org>

Date: 22/11/2019 02:35

Hi,



reviving this not-so-exciting topic :-)...



For the purpose of dealing with GRIB rotated long/lat grids,

https://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_doc/grib2_temp3-1.shtml,

I'm about to use a "Pole rotation (GRIB convention)" conversion method with

the following 3 parameters, whose naming and semantics comes mostly from the above GRIB spec:



- "Latitude of the southern pole (GRIB convention)"

Latitude of the point from the unrotated

CRS, expressed in the unrotated CRS, that will become the south pole of the

rotated CRS.



- "Longitude of the southern pole (GRIB convention)"



Longitude of the point from the unrotated

CRS, expressed in the unrotated CRS, that will become the south pole of the

rotated CRS.



- "Axis rotation (GRIB convention)"



The angle of rotation about the new polar

axis (measured clockwise when looking from the southern to the northern pole)

of the coordinate system, assuming the new axis to have been obtained by

first rotating the sphere through southPoleLongInUnrotatedCRS degrees about

the geographic polar axis and then rotating through

(90 + southPoleLatInUnrotatedCRS) degrees so that the southern pole moved

along the (previously rotated) Greenwich meridian.



The explanation of the axis rotation parameter is rather obscure to me. Would need

some scetch... Anyway, in practice, the few datasets I've accessed to

(like the GRIB2 ones at http://collaboration.cmc.ec.gc.ca/cmc/cmos/sample_grib/ or

the GRIB1 one at https://trac.osgeo.org/gdal/ticket/7104 ) use axis rotation = 0



I explicitly chose the " (GRIB convention)" suffix for parameter names as well,

as I'm pretty sure that the semantics of similarly named parameters

for other formulations of Pole rotation could be different.



So an example of a resulting DerivedGeographicCRS:



GEOGCRS["Coordinate System imported from GRIB file",

BASEGEOGCRS["Coordinate System imported from GRIB file",

DATUM["unnamed",

ELLIPSOID["Sphere",6371229,0,

LENGTHUNIT["metre",1,

ID["EPSG",9001]]]],

PRIMEM["Greenwich",0,

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]]],

DERIVINGCONVERSION["Pole rotation (GRIB convention)",

METHOD["Pole rotation (GRIB convention)"],

PARAMETER["Latitude of the southern pole (GRIB convention)",-31.758312,

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]],

PARAMETER["Longitude of the southern pole (GRIB convention)",-92.402969,

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]],

PARAMETER["Axis rotation (GRIB convention)",0,

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]]],

CS[ellipsoidal,2],

AXIS["latitude",north,

ORDER[1],

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]],

AXIS["longitude",east,

ORDER[2],

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]]]





And the maths are below:



{{{



#include <math.h>

#include <stdio.h>



#define PI 3.141592653589793



// Implementation of https://github.com/Unidata/netcdf-java/blob/3ce72c0cd167609ed8c69152bb4a004d1daa9273/cdm/core/src/main/java/ucar/unidata/geoloc/projection/RotatedLatLon.java



void rotate(double lon, double lat, double rot1, double rot2, double cosDlat, double s, double& rlon, double &rlat)

{

double e = (lon - rot1) / 180 * PI; // east

double n = lat / 180 * PI; // north

double cn = cos(n);

double x = cn * cos(e);

double y = cn * sin(e);

double z = sin(n);

double x2 = cosDlat * x + s * z;

double z2 = -s * x + cosDlat * z;

double R = sqrt(x2 * x2 + y * y);

double e2 = atan2(y, x2);

double n2 = atan2(z2, R);

rlon = e2 / PI * 180 - rot2;

rlat = n2 / PI * 180;

}



// Unrotated -> rotated

void forward_transform(double lon, double lat, // Input

double south_pole_lat,

double south_pole_lon,

double axis_rotation,

double& rlon, double& rlat // Output

)

{

double dlat_rad = (south_pole_lat - (-90)) / 180 * PI;

double sinDlat = sin(dlat_rad);

double cosDlat = cos(dlat_rad);



rotate(lon, lat, south_pole_lon, axis_rotation, cosDlat, sinDlat, rlon, rlat);

}



int main()

{

double south_pole_lat = -39.3;

double south_pole_lon = 18;

double axis_rotation = 45;



double lon = 12;

double lat = 55;

double rlon, rlat;

forward_transform(lon, lat,

south_pole_lat, south_pole_lon, axis_rotation,

rlon, rlat);



printf("%.8f %8f\n", rlon, rlat); // -48.44759099 4.439720



// Equivalent to +proj=ob_tran +o_proj=longlat +o_lon_p=-axis_rotation +o_lat_p=-south_pole_lat +lon_0=south_pole_lon

//

//$ echo "12 55" | cs2cs -d 8 +proj=longlat +to +proj=ob_tran +o_proj=longlat +o_lon_p=-45 +o_lat_p=39.3 +lon_0=18

// -48.44759099 4.43972046 0.00000000



}



}}}





Even





--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200423/25f45852/attachment-0001.html>

From even.rouault at spatialys.com  Thu Apr 23 11:45:51 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 23 Apr 2020 20:45:51 +0200
Subject: [gdal-dev] NetCDF rotated grid support
In-Reply-To: <8e143d4edf0241d295c997515542eed3@PELEPCDEXC006.birch.int.bell.ca>
References: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>
 <1687475.bTrxGPkrb0@even-i700>
 <8e143d4edf0241d295c997515542eed3@PELEPCDEXC006.birch.int.bell.ca>
Message-ID: <3244263.sc9S96974C@even-i700>

Louis-Philippe,

> I did some more tests with the rotated_pole.nc in gdal GitHub repo
> (https://github.com/OSGeo/gdal/tree/master/autotest/gdrivers/data) just to
> make sure the issue was not with my data.
> 
> With the new versions, the EXTENSION is missing from the WKT, which I guess
> makes the reprojection fail when I try to view it in Qgis ?

Kind of... I confirm the issue. A complex interaction between GDAL and PROJ due to the 
netCDF driver using a non-standard way of expressing a rotated pole CRS.

Well, there isn't really a standardized way, but what I did for GRIB2 recently was more in the 
right direction (hopefully!)

So to address the issue, I've done 2 things:
- a fix for GDAL (in time for 3.1.0): https://github.com/OSGeo/gdal/pull/2438
- and one for PROJ: https://github.com/OSGeo/PROJ/pull/2185

The GDAL fix should probably be sufficient without the PROJ one, but I won't bet too much 
on that...

Ultimately the netCDF driver should be improved similarly to the GRIB one, that is creating a 
DERIVINGCONVERSION["Pole rotation (netCDF convention)"] instead of a hack.

So with both I now get with gdalinfo:

[...]
Coordinate System is:
GEOGCRS["unnamed",
    BASEGEOGCRS["unknown",
        DATUM["unknown",
            ELLIPSOID["unknown",6367470,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8901]]],
    DERIVINGCONVERSION["unknown",
        METHOD["PROJ ob_tran o_proj=longlat"],
        PARAMETER["lon_0",18,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]],
        PARAMETER["o_lon_p",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]],
        PARAMETER["o_lat_p",39.25,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CS[ellipsoidal,2],
        AXIS["longitude",east,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]],
        AXIS["latitude",north,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]]
[...]
Upper Left  ( -35.4700000,  23.6500003) ( 55d 6'46.50"W, 56d15'18.83"N)
Lower Left  ( -35.4700000, -23.8699996) ( 16d 4'19.39"W, 18d42'19.70"N)
Upper Right (  24.8100002,  23.6500003) ( 78d43'49.95"E, 63d51'22.90"N)
Lower Right (  24.8100002, -23.8699996) ( 42d35'19.21"E, 22d45'11.78"N)
Center      (  -5.3299999,  -0.1099997) (  9d37'52.99"E, 50d20'18.47"N)

The corner transformed in (non-rotated) geographic coordinates are now the same as GDAL 
2.4, whereas before the fix, they were centered close to (0,0) as you mentionned.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200423/5ee11b02/attachment.html>

From louis-philippe.rousseaulambert2 at canada.ca  Thu Apr 23 12:06:41 2020
From: louis-philippe.rousseaulambert2 at canada.ca (Rousseau Lambert2, Louis-Philippe (EC))
Date: Thu, 23 Apr 2020 19:06:41 +0000
Subject: [gdal-dev] NetCDF rotated grid support
References: <4f60118331af4ff3bed4be61aca73eb6@PELEPCDEXC006.birch.int.bell.ca>
 <1687475.bTrxGPkrb0@even-i700>
 <8e143d4edf0241d295c997515542eed3@PELEPCDEXC006.birch.int.bell.ca>
 <3244263.sc9S96974C@even-i700>
Message-ID: <mailman.32.1587668810.17181.gdal-dev@lists.osgeo.org>

Great thanks a lot !

I also think that something like GRIB2 would be nice for NetCDF. I will take note of this for future improvement to the NetCDF driver :)

LP

On 2020-04-23 14:46, Even Rouault wrote:

Louis-Philippe,



> I did some more tests with the rotated_pole.nc in gdal GitHub repo

> (https://github.com/OSGeo/gdal/tree/master/autotest/gdrivers/data) just to

> make sure the issue was not with my data.

>

> With the new versions, the EXTENSION is missing from the WKT, which I guess

> makes the reprojection fail when I try to view it in Qgis ?



Kind of... I confirm the issue. A complex interaction between GDAL and PROJ due to the netCDF driver using a non-standard way of expressing a rotated pole CRS.



Well, there isn't really a standardized way, but what I did for GRIB2 recently was more in the right direction (hopefully!)



So to address the issue, I've done 2 things:

- a fix for GDAL (in time for 3.1.0): https://github.com/OSGeo/gdal/pull/2438

- and one for PROJ: https://github.com/OSGeo/PROJ/pull/2185



The GDAL fix should probably be sufficient without the PROJ one, but I won't bet too much on that...



Ultimately the netCDF driver should be improved similarly to the GRIB one, that is creating a DERIVINGCONVERSION["Pole rotation (netCDF convention)"] instead of a hack.



So with both I now get with gdalinfo:



[...]

Coordinate System is:

GEOGCRS["unnamed",

BASEGEOGCRS["unknown",

DATUM["unknown",

ELLIPSOID["unknown",6367470,0,

LENGTHUNIT["metre",1,

ID["EPSG",9001]]]],

PRIMEM["Greenwich",0,

ANGLEUNIT["degree",0.0174532925199433],

ID["EPSG",8901]]],

DERIVINGCONVERSION["unknown",

METHOD["PROJ ob_tran o_proj=longlat"],

PARAMETER["lon_0",18,

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]],

PARAMETER["o_lon_p",0,

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]],

PARAMETER["o_lat_p",39.25,

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]]],

CS[ellipsoidal,2],

AXIS["longitude",east,

ORDER[1],

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]],

AXIS["latitude",north,

ORDER[2],

ANGLEUNIT["degree",0.0174532925199433,

ID["EPSG",9122]]]]

[...]

Upper Left ( -35.4700000, 23.6500003) ( 55d 6'46.50"W, 56d15'18.83"N)

Lower Left ( -35.4700000, -23.8699996) ( 16d 4'19.39"W, 18d42'19.70"N)

Upper Right ( 24.8100002, 23.6500003) ( 78d43'49.95"E, 63d51'22.90"N)

Lower Right ( 24.8100002, -23.8699996) ( 42d35'19.21"E, 22d45'11.78"N)

Center ( -5.3299999, -0.1099997) ( 9d37'52.99"E, 50d20'18.47"N)



The corner transformed in (non-rotated) geographic coordinates are now the same as GDAL 2.4, whereas before the fix, they were centered close to (0,0) as you mentionned.



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200423/19dd3bd9/attachment.html>

From even.rouault at spatialys.com  Fri Apr 24 05:00:48 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 24 Apr 2020 14:00:48 +0200
Subject: [gdal-dev] libgeotiff 1.6.0 is released
Message-ID: <4965781.DBEFvvKCqJ@even-i700>

Hi,

Based on community feedback, I've just promoted 1.6.0 RC1 to final (*)

Sources at:
- http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.6.0.tar.gz
- http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.6.0.zip

New features:
* Add support for OGC GeoTIFF 1.1
* Expose GTIFGetPCSInfoEx(), GTIFGetProjTRFInfoEx(), GTIFGetGCSInfoEx(), 
GTIFGetDatumInfoEx(), GTIFGetEllipsoidInfoEx(), GTIFGetPMInfoEx(), 
GTIFGetUOMLengthInfoEx() and GTIFGetUOMAngleInfoEx() so that users can specify their 
own PROJ context
* Add GTIFKeyGetASCII(), GTIFKeyGetSHORT() and GTIFKeyGetDOUBLE() as safer variants of 
GTIFKeyGet() with type checking
* autotools build: enable build in a separate tree from source (#37) (fixes #28)
* Use pkg-config for libtiff detection

Bug fixes:
* GTIFDecToDMS(): fix rounding issue (refs #16)
* geo_names.c: Silence warning in GetNameFromDatabase
* cpl_serv.h: add parenthesis in macro definitions
* Fix spelling errors
* geo_normalize.c: set UOMLength from GeogLinearUnits (for geocentic CRS) (GDAL #1595)
* testlistgeo: remove hardcoded path in test output (fixes https://github.com/OSGeo/
libgeotiff/issues/16#issuecomment-502267406)
* Adapt test script for PROJ 6.2 EPSG database (fixes #22)
* Use unix EOL for cmake related files (fixes #14)
* configure.ac: drop dead code
* geo_normalize.c: avoid look up of user-defined geokeys that cause PROJ warnings (fixes 
GDAL #2321)
* listgeo: fix corner coordinates for images with RasterPixelIsPoint (#36)

Even

(*) I mentioned a vote but forgot that, based on what happened for 1.5.0, metacrs was more 
or less defunct/irrelevant as a voting body, so I just went ahead

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200424/32cab4ef/attachment.html>

From david.rush at wyo.gov  Fri Apr 24 15:35:54 2020
From: david.rush at wyo.gov (David Rush)
Date: Fri, 24 Apr 2020 16:35:54 -0600
Subject: [gdal-dev] Building for Java on MacOS
Message-ID: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>

Hi.  I'm trying to get to the point where I can use GDAL with Java (on a
Mac now, Linux server box in the future).

Current box is MacOS 10.15.4.

I've D/L the binaries for 2.4 from
https://www.kyngchaos.com/software/frameworks/, and installed, which
appears to have put things
in /Library/Frameworks/GDAL.framework/Versions/2.4

but I didn't find the gdal-*.jar file anywhere in there.  I searched and
found gdal-2.4.0.jar at some heavily-advertising driven web site.

When I try to use GDAL, I get:

java.lang.UnsatisfiedLinkError: no gdalalljni in java.library.path

I cannot find a file called "gdalalljin" anywhere.  I forced my
java.library.path to be /Library/Frameworks/GDAL.framework/unix/lib, but
got the same error.

I see that I have /Library/Frameworks/GDAL.framework/unix/lib/libgdal.dylib

I then followed the directions here
https://trac.osgeo.org/gdal/wiki/BuildingOnMac and used Homebrew to build
GDAL, which appears to have installed it in /usr/local, and appears to be
version 2.4.4 (per ogr2ogr --version).

I reset my java.library.path to /usr/local/lib, but I still get the same
error:

java.lang.UnsatisfiedLinkError: no gdalalljni in java.library.path:
[/usr/local/lib]

I see that I have /usr/local/lib/libgdal.dylib

So where, exactly, can I get the Java native library that I need, and what
is the canonical source for a gdal-x.y.z.jar file, or instructions to build
one myself?

David

-- 

E-Mail to and from me, in connection with the transaction 
of public 
business, is subject to the Wyoming Public Records 
Act and may be 
disclosed to third parties.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200424/0ff0bef0/attachment.html>

From zazhil_ha at hotmail.com  Fri Apr 24 16:02:16 2020
From: zazhil_ha at hotmail.com (ZAZHIL-HA HERENA)
Date: Fri, 24 Apr 2020 23:02:16 +0000
Subject: [gdal-dev] Problem trying to use GeoRaster driver in GDAL 3.0.4
	python build
Message-ID: <BY5PR04MB712497C12F7B0B45A4950DE795D00@BY5PR04MB7124.namprd04.prod.outlook.com>

Hello experts,

I am writing to this list since I have been trying to use georaster driver in gdal using python bindings. If I use command line gdalinfo it works fine, which makes me believe that my environment is set up correctly and that my build is working fine, this is my command line example that returns good response:

gdalinfo georaster:herman/vampire at aidb,HERMAN.GEORASTER_TABLE,GEORASTER,GEORID=1

In python, if I try: GetDriverByName("georaster") or GetDriverByName("geor") it returns None. There are 218 drivers in GetDriverCount() but none seems to be called, georaster, geor or anything like that.
If I try:
dataset = gdal.Open("georaster:herman/vampire at aidb,HERMAN.GEORASTER_TABLE,GEORASTER,GEORID=1", gdal.GA_ReadOnly)
I get:
ERROR 4: georaster:herman/vampire at aidb,HERMAN.GEORASTER_TABLE,GEORASTER,GEORID=1: No such file or directory

I tried to RegisterAll() and made no difference.

The way I built it was using the following configure:


make clean distclean
./configure --prefix=/home/zherena/gdal30/gdal-3.0.4/mybuild/ --with-proj=/home/zherena/gdal30/lib6/ --with-oci-lib=$ORACLE_HOME

--with-oci-include=$ORACLE_HOME/sdk/include --with-curl=/usr/bin/curl-config --with-python=/home/zherena/anaconda3/bin/python

make

make install



and copied the osgeo generated directory to my site-packages directory.

Also, after building gdal using the previous steps, I tried:


cd swig/python

make clean; make

and copied the osgeo generated directory to my site-packages directory.

Both builds have the same result. Can someone please help?, have you ever used georaster in Python? maybe I need a special extra configuration to make it work? Appreciate your help.

Thanks,
Zazhil-ha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200424/85f0df68/attachment.html>

From cdelancy at blackfangtechnologies.com  Sat Apr 25 12:40:36 2020
From: cdelancy at blackfangtechnologies.com (Craig Delancy)
Date: Sat, 25 Apr 2020 19:40:36 +0000
Subject: [gdal-dev] Is there a way to build GDAL without FreeType?
Message-ID: <DM6PR17MB3884A0252FFA860299B4382CC7D10@DM6PR17MB3884.namprd17.prod.outlook.com>

(Windows 10, 64-bit)

Is there a way to compile GDAL (3.0.4) without the dependency on FreeType?
I am trying to integrate the GDAL libraries into an existing software, which itself already links to FreeType2. This causes a series of conflicts such as:

freetype.lib(ftbase.obj) : error LNK2005: FT_DivFix already defined in gdal_i.lib(gdal300.dll)

These prevent me from being able to link GDAL and compile the executable. Is there a way to remove the dependency, or another way to resolve the multiple definitions?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200425/6b54d5d4/attachment.html>

From woklist at kyngchaos.com  Sun Apr 26 17:10:29 2020
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Sun, 26 Apr 2020 19:10:29 -0500
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
Message-ID: <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>

I don't package GDAL java with my framework, and have no interest in java.   Sorry. 

I don't know about Homebrew.

-----
William Kyngesburye
<kyngchaos at kyngchaos.com>
<http://www.kyngchaos.com>

Don't Panic

> On Apr 24, 2020, at 5:36 PM, David Rush <david.rush at wyo.gov> wrote:
> 
> ﻿
> Hi.  I'm trying to get to the point where I can use GDAL with Java (on a Mac now, Linux server box in the future).
> 
> Current box is MacOS 10.15.4.
> 
> I've D/L the binaries for 2.4 from https://www.kyngchaos.com/software/frameworks/, and installed, which appears to have put things in /Library/Frameworks/GDAL.framework/Versions/2.4
> 
> but I didn't find the gdal-*.jar file anywhere in there.  I searched and found gdal-2.4.0.jar at some heavily-advertising driven web site.
> 
> When I try to use GDAL, I get: 
> 
> java.lang.UnsatisfiedLinkError: no gdalalljni in java.library.path
> 
> I cannot find a file called "gdalalljin" anywhere.  I forced my java.library.path to be /Library/Frameworks/GDAL.framework/unix/lib, but got the same error.
> 
> I see that I have /Library/Frameworks/GDAL.framework/unix/lib/libgdal.dylib
> 
> I then followed the directions here https://trac.osgeo.org/gdal/wiki/BuildingOnMac and used Homebrew to build GDAL, which appears to have installed it in /usr/local, and appears to be version 2.4.4 (per ogr2ogr --version).
> 
> I reset my java.library.path to /usr/local/lib, but I still get the same error:
> 
> java.lang.UnsatisfiedLinkError: no gdalalljni in java.library.path: [/usr/local/lib]
> 
> I see that I have /usr/local/lib/libgdal.dylib
> 
> So where, exactly, can I get the Java native library that I need, and what is the canonical source for a gdal-x.y.z.jar file, or instructions to build one myself?
> 
> David
> 
> 
> E-Mail to and from me, in connection with the transaction 
> of public business, is subject to the Wyoming Public Records 
> Act and may be disclosed to third parties.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200426/131883cd/attachment.html>

From jmckenna at gatewaygeomatics.com  Mon Apr 27 05:25:23 2020
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Mon, 27 Apr 2020 09:25:23 -0300
Subject: [gdal-dev] Is there a way to build GDAL without FreeType?
In-Reply-To: <DM6PR17MB3884A0252FFA860299B4382CC7D10@DM6PR17MB3884.namprd17.prod.outlook.com>
References: <DM6PR17MB3884A0252FFA860299B4382CC7D10@DM6PR17MB3884.namprd17.prod.outlook.com>
Message-ID: <e38c8bfb-061d-e9e5-1fc1-b8067d053cf2@gatewaygeomatics.com>

Hi Craig,

Maybe your GDAL build uses libPoppler, which references the Freetype 
lib; you could disable that from your GDAL build and retry.

-jeff



-- 
Jeff McKenna
MapServer Consulting and Training Services
https://gatewaygeo.com/




On 2020-04-25 4:40 p.m., Craig Delancy wrote:
> (Windows 10, 64-bit)
> 
> Is there a way to compile GDAL (3.0.4) without the dependency on FreeType?
> 
> I am trying to integrate the GDAL libraries into an existing software, 
> which itself already links to FreeType2. This causes a series of 
> conflicts such as:
> 
> freetype.lib(ftbase.obj) : error LNK2005: FT_DivFix already defined in 
> gdal_i.lib(gdal300.dll)
> 
> These prevent me from being able to link GDAL and compile the 
> executable. Is there a way to remove the dependency, or another way to 
> resolve the multiple definitions?
> 
> Thanks.
> 


From olivia.gill at sepa.org.uk  Mon Apr 27 05:49:55 2020
From: olivia.gill at sepa.org.uk (Gill, Olivia)
Date: Mon, 27 Apr 2020 12:49:55 +0000
Subject: [gdal-dev] changing table sources - .gfs templates/ogr2ogr
Message-ID: <73974960B66D2A4DAD304111B3C203C701AF998006@SEPA-APP-EXC03.sepanet.sepa.org.uk>

I'm importing data from multiple .gml files using a .gfs template.
I provide a <Name>MyName</Name> in the .gfs that corresponds to the  <ElementPath>MyName</ElementPath>

Using a connection to Oracle I am then populating a matching table called 'MyName' - this works fine. My question is how can I change the path to a different table in Oracle. I have changed the <Name>MyNameTwo</Name> and also the oracle connection path to 'MyNameTwo' but it fails to import the data even though there is no error logged.
Any help is much appreciated

Olivia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/d0d4e3c6/attachment.html>

From david.rush at wyo.gov  Mon Apr 27 06:03:28 2020
From: david.rush at wyo.gov (David Rush)
Date: Mon, 27 Apr 2020 07:03:28 -0600
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
Message-ID: <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>

All:

I think I finally found some instructions for building the Java stuff I
need:

https://trac.osgeo.org/gdal/wiki/GdalOgrInJavaBuildInstructionsUnix

That includes some notes for MacOS.  Yay.

I've set up my java.opt per this link referenced in the above link:

https://trac.osgeo.org/gdal/ticket/2401

But when I run "make" from the swig/java directory, I get this error:

GNUmakefile:1: ../../GDALmake.opt: No such file or directory
make: *** No rule to make target `../../GDALmake.opt'.  Stop.

I did a search with "find" but I don't seem to have that file.

What now?

David

On Sun, Apr 26, 2020 at 6:10 PM William Kyngesburye <woklist at kyngchaos.com>
wrote:

> I don't package GDAL java with my framework, and have no interest in java.
>   Sorry.
>
> I don't know about Homebrew.
>
> -----
> William Kyngesburye
> <kyngchaos at kyngchaos.com>
> <http://www.kyngchaos.com>
>
> Don't Panic
>
> On Apr 24, 2020, at 5:36 PM, David Rush <david.rush at wyo.gov> wrote:
>
> ﻿
> Hi.  I'm trying to get to the point where I can use GDAL with Java (on a
> Mac now, Linux server box in the future).
>
> Current box is MacOS 10.15.4.
>
> I've D/L the binaries for 2.4 from
> https://www.kyngchaos.com/software/frameworks/, and installed, which
> appears to have put things
> in /Library/Frameworks/GDAL.framework/Versions/2.4
>
> but I didn't find the gdal-*.jar file anywhere in there.  I searched and
> found gdal-2.4.0.jar at some heavily-advertising driven web site.
>
> When I try to use GDAL, I get:
>
> java.lang.UnsatisfiedLinkError: no gdalalljni in java.library.path
>
> I cannot find a file called "gdalalljin" anywhere.  I forced my
> java.library.path to be /Library/Frameworks/GDAL.framework/unix/lib, but
> got the same error.
>
> I see that I have /Library/Frameworks/GDAL.framework/unix/lib/libgdal.dylib
>
> I then followed the directions here
> https://trac.osgeo.org/gdal/wiki/BuildingOnMac and used Homebrew to build
> GDAL, which appears to have installed it in /usr/local, and appears to be
> version 2.4.4 (per ogr2ogr --version).
>
> I reset my java.library.path to /usr/local/lib, but I still get the same
> error:
>
> java.lang.UnsatisfiedLinkError: no gdalalljni in java.library.path:
> [/usr/local/lib]
>
> I see that I have /usr/local/lib/libgdal.dylib
>
> So where, exactly, can I get the Java native library that I need, and what
> is the canonical source for a gdal-x.y.z.jar file, or instructions to build
> one myself?
>
> David
>
>
> E-Mail to and from me, in connection with the transaction
> of public business, is subject to the Wyoming Public Records
> Act and may be disclosed to third parties.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>

-- 

E-Mail to and from me, in connection with the transaction 
of public 
business, is subject to the Wyoming Public Records 
Act and may be 
disclosed to third parties.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/7ba6710c/attachment-0001.html>

From even.rouault at spatialys.com  Mon Apr 27 06:11:33 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Apr 2020 15:11:33 +0200
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
 <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
Message-ID: <2001242.kW2l8oXAMP@even-i700>

On lundi 27 avril 2020 07:03:28 CEST David Rush wrote:
> All:
> 
> I think I finally found some instructions for building the Java stuff I
> need:
> 
> https://trac.osgeo.org/gdal/wiki/GdalOgrInJavaBuildInstructionsUnix
> 
> That includes some notes for MacOS.  Yay.
> 
> I've set up my java.opt per this link referenced in the above link:
> 
> https://trac.osgeo.org/gdal/ticket/2401
> 
> But when I run "make" from the swig/java directory, I get this error:
> 
> GNUmakefile:1: ../../GDALmake.opt: No such file or directory
> make: *** No rule to make target `../../GDALmake.opt'.  Stop.
> 
> I did a search with "find" but I don't seem to have that file.

You need to run ./configure to generate it. And it is strongly advise that you run the Java 
bindings against the same version of the native library for which they have been generated.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/7353f432/attachment.html>

From even.rouault at spatialys.com  Mon Apr 27 06:37:37 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Apr 2020 15:37:37 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
Message-ID: <63523553.AW4fXskrrz@even-i700>

Hi,

I have prepared a GDAL/OGR 3.1.0 release candidate.

Pick up an archive among the following ones (by ascending size):

  https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc1.tar.xz
  https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc1.tar.gz
  https://download.osgeo.org/gdal/3.1.0/gdal310rc1.zip

A snapshot of the gdalautotest suite is also available :

  https://download.osgeo.org/gdal/3.1.0/gdalautotest-3.1.0rc1.tar.gz
  https://download.osgeo.org/gdal/3.1.0/gdalautotest-3.1.0rc1.zip

A snapshot of the documentation is at:

  https://download.osgeo.org/gdal/3.1.0/gdal310doc.zip

GDAL-GRASS plugin:

  https://download.osgeo.org/gdal/3.1.0/gdal-grass-3.1.0.tar.gz

NEWS at:

  https://github.com/OSGeo/gdal/blob/v3.1.0RC1/gdal/NEWS

Packagers: note that the documentation has been revamped to use Sphinx. If you want to 
build html and man pages, in addition to Doxygen, on top of my head, you need at least the 
following Python packages: sphinx, breathe, sphinx_rtd_theme (the recipee of the Docker 
image used to build GDAL and PROJ websites is at
https://github.com/OSGeo/PROJ/blob/master/docs/docbuild/Dockerfile , but I don't think 
you need all the packages mentioned)
For man pages, the tarball already includes them, so "make install-man" can be enough if you 
don't feel like regenerating them from .rst.

I'll call for a vote promoting it to final later this week if no
serious problems are reported before.

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/40601bc4/attachment.html>

From sebastic at xs4all.nl  Mon Apr 27 06:49:44 2020
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Mon, 27 Apr 2020 15:49:44 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <63523553.AW4fXskrrz@even-i700>
References: <63523553.AW4fXskrrz@even-i700>
Message-ID: <66dcebb1-e1bd-13ac-902a-ceed4d524785@xs4all.nl>

On 4/27/20 3:37 PM, Even Rouault wrote:
> Packagers: note that the documentation has been revamped to use Sphinx. If you want to 
> build html and man pages, in addition to Doxygen, on top of my head, you need at least the 
> following Python packages: sphinx, breathe, sphinx_rtd_theme (the recipee of the Docker 
> image used to build GDAL and PROJ websites is at
> https://github.com/OSGeo/PROJ/blob/master/docs/docbuild/Dockerfile , but I don't think 
> you need all the packages mentioned)
> For man pages, the tarball already includes them, so "make install-man" can be enough if you 
> don't feel like regenerating them from .rst.

The embedded RTD theme (especially its fonts) and logo images are a
PITA. I'm tempted to just drop the libgdal-doc package are exclude the
entire doc/ subdirectory when repacking the tarball to make license &
copyright review less of a pain.

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From david.rush at wyo.gov  Mon Apr 27 07:02:10 2020
From: david.rush at wyo.gov (David Rush)
Date: Mon, 27 Apr 2020 08:02:10 -0600
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <2001242.kW2l8oXAMP@even-i700>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
 <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
 <2001242.kW2l8oXAMP@even-i700>
Message-ID: <CA+fOagTY7+Gmw3uqQTQmCf46++JyQ3JbhKTJwZYAFHd1CLYpqg@mail.gmail.com>

Thank you, Evan.  That got me to the next error:

/bin/sh: swig: command not found
make: *** [gdal_wrap.cpp] Error 127

Where/how does the "swig" script or binary come from?

David

On Mon, Apr 27, 2020 at 7:11 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> On lundi 27 avril 2020 07:03:28 CEST David Rush wrote:
>
> > All:
>
> >
>
> > I think I finally found some instructions for building the Java stuff I
>
> > need:
>
> >
>
> > https://trac.osgeo.org/gdal/wiki/GdalOgrInJavaBuildInstructionsUnix
>
> >
>
> > That includes some notes for MacOS. Yay.
>
> >
>
> > I've set up my java.opt per this link referenced in the above link:
>
> >
>
> > https://trac.osgeo.org/gdal/ticket/2401
>
> >
>
> > But when I run "make" from the swig/java directory, I get this error:
>
> >
>
> > GNUmakefile:1: ../../GDALmake.opt: No such file or directory
>
> > make: *** No rule to make target `../../GDALmake.opt'. Stop.
>
> >
>
> > I did a search with "find" but I don't seem to have that file.
>
>
>
> You need to run ./configure to generate it. And it is strongly advise that
> you run the Java bindings against the same version of the native library
> for which they have been generated.
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>

-- 

E-Mail to and from me, in connection with the transaction 
of public 
business, is subject to the Wyoming Public Records 
Act and may be 
disclosed to third parties.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/aa283cb0/attachment-0001.html>

From ivan.lucena at outlook.com  Mon Apr 27 07:18:20 2020
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Mon, 27 Apr 2020 14:18:20 +0000
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <CA+fOagTY7+Gmw3uqQTQmCf46++JyQ3JbhKTJwZYAFHd1CLYpqg@mail.gmail.com>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
 <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
 <2001242.kW2l8oXAMP@even-i700>,
 <CA+fOagTY7+Gmw3uqQTQmCf46++JyQ3JbhKTJwZYAFHd1CLYpqg@mail.gmail.com>
Message-ID: <MN2PR04MB56937941D0FEB6EA337C7EACF2AF0@MN2PR04MB5693.namprd04.prod.outlook.com>

Hi David,

I am in the process of refreshing my GDAL building process in a Mac, so I might be able to help with that question.

You need to install SWIG in your machine. And one way to do that is using the HomeBrewer [brew.sh] another is Anaconda [anaconda.com]

$ brew install swig

or

$ conda install swig

Homebrew mess with you OS and Apple updates might mess with your brew installed software. Anaconda keeps it all in a user sub-folder. It is up to you.

I am not interested in building the Java binding, only Python, but once upon a time I remember I could get all you need "just" by installing uDig [udig.refractions.net]. I mean, the GDAL Java binding was included and ready to use.

Regards,

Ivan



________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of David Rush <david.rush at wyo.gov>
Sent: Monday, April 27, 2020 10:02 AM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Building for Java on MacOS

Thank you, Evan.  That got me to the next error:

/bin/sh: swig: command not found
make: *** [gdal_wrap.cpp] Error 127

Where/how does the "swig" script or binary come from?

David

On Mon, Apr 27, 2020 at 7:11 AM Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:

On lundi 27 avril 2020 07:03:28 CEST David Rush wrote:

> All:

>

> I think I finally found some instructions for building the Java stuff I

> need:

>

> https://trac.osgeo.org/gdal/wiki/GdalOgrInJavaBuildInstructionsUnix

>

> That includes some notes for MacOS. Yay.

>

> I've set up my java.opt per this link referenced in the above link:

>

> https://trac.osgeo.org/gdal/ticket/2401

>

> But when I run "make" from the swig/java directory, I get this error:

>

> GNUmakefile:1: ../../GDALmake.opt: No such file or directory

> make: *** No rule to make target `../../GDALmake.opt'. Stop.

>

> I did a search with "find" but I don't seem to have that file.



You need to run ./configure to generate it. And it is strongly advise that you run the Java bindings against the same version of the native library for which they have been generated.



--

Spatialys - Geospatial professional services

http://www.spatialys.com


E-Mail to and from me, in connection with the transaction
of public business, is subject to the Wyoming Public Records
Act and may be disclosed to third parties.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/c9b4ac45/attachment.html>

From even.rouault at spatialys.com  Mon Apr 27 07:18:39 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Apr 2020 16:18:39 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <66dcebb1-e1bd-13ac-902a-ceed4d524785@xs4all.nl>
References: <63523553.AW4fXskrrz@even-i700>
 <66dcebb1-e1bd-13ac-902a-ceed4d524785@xs4all.nl>
Message-ID: <3556333.UkRkMUDu3N@even-i700>

Bas,

> The embedded RTD theme (especially its fonts) and logo images are a
> PITA. I'm tempted to just drop the libgdal-doc package are exclude the
> entire doc/ subdirectory when repacking the tarball to make license &
> copyright review less of a pain.

As using plain sphinx_rtd_theme gives pretty decent result too, a less radical approach would 
be to just remove the gdal/doc/source/gdal_rtd
directory and 

A) either use the following patch

"""
diff --git a/gdal/doc/source/conf.py b/gdal/doc/source/conf.py
index 34e52a5..a3a568f 100644
--- a/gdal/doc/source/conf.py
+++ b/gdal/doc/source/conf.py
@@ -48,7 +48,7 @@ exclude_patterns = [ 'programs/options/*.rst' ]
 # a list of builtin themes.
 #
 html_theme_path = ['.']
-html_theme = 'gdal_rtd'
+html_theme = 'sphinx_rtd_theme'
 
 html_context = {
   'display_github': True,
"""

B) or from the doc directory, run
make html O="-D html_theme=sphinx_rtd_theme"


The gdal_rtd theme comes from 
https://github.com/OSGeo/gdal/commit/367837c0263cca59d2762de38816c57c08502a51
which is derived from boundless_rtd theme from
https://github.com/planetfederal/sphinx-theme

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/c7d93319/attachment.html>

From david.rush at wyo.gov  Mon Apr 27 07:27:00 2020
From: david.rush at wyo.gov (David Rush)
Date: Mon, 27 Apr 2020 08:27:00 -0600
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <MN2PR04MB56937941D0FEB6EA337C7EACF2AF0@MN2PR04MB5693.namprd04.prod.outlook.com>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
 <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
 <2001242.kW2l8oXAMP@even-i700>
 <CA+fOagTY7+Gmw3uqQTQmCf46++JyQ3JbhKTJwZYAFHd1CLYpqg@mail.gmail.com>
 <MN2PR04MB56937941D0FEB6EA337C7EACF2AF0@MN2PR04MB5693.namprd04.prod.outlook.com>
Message-ID: <CA+fOagRSzuUgwNj65sUN+F_J02iLeH=UvVMKgEwqQvmjm1W=Dw@mail.gmail.com>

Ivan:

Thanks!  That worked.  On to the next error (with make in gdal/swig/java)
...

gdalconst_wrap.c:154:10: fatal error: 'jni.h' file not found
#include <jni.h>
         ^~~~~~~
1 error generated.
make: *** [gdalconst_wrap.lo] Error 1

Where *should* jni.h come from?  I can't find it anywhere in my Java
installation.

David

On Mon, Apr 27, 2020 at 8:18 AM Ivan Lucena <ivan.lucena at outlook.com> wrote:

> Hi David,
>
> I am in the process of refreshing my GDAL building process in a Mac, so I
> might be able to help with that question.
>
> You need to install SWIG in your machine. And one way to do that is using
> the HomeBrewer [brew.sh] another is Anaconda [anaconda.com]
>
> $ brew install swig
>
> or
>
> $ conda install swig
>
> Homebrew mess with you OS and Apple updates might mess with your brew
> installed software. Anaconda keeps it all in a user sub-folder. It is up
> to you.
>
> I am not interested in building the Java binding, only Python, but once
> upon a time I remember I could get all you need "just" by installing uDig [
> udig.refractions.net]. I mean, the GDAL Java binding was included and
> ready to use.
>
> Regards,
>
> Ivan
>
>
>
> ------------------------------
> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of David
> Rush <david.rush at wyo.gov>
> *Sent:* Monday, April 27, 2020 10:02 AM
> *To:* gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] Building for Java on MacOS
>
> Thank you, Evan.  That got me to the next error:
>
> /bin/sh: swig: command not found
> make: *** [gdal_wrap.cpp] Error 127
>
> Where/how does the "swig" script or binary come from?
>
> David
>
> On Mon, Apr 27, 2020 at 7:11 AM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
> On lundi 27 avril 2020 07:03:28 CEST David Rush wrote:
>
> > All:
>
> >
>
> > I think I finally found some instructions for building the Java stuff I
>
> > need:
>
> >
>
> > https://trac.osgeo.org/gdal/wiki/GdalOgrInJavaBuildInstructionsUnix
>
> >
>
> > That includes some notes for MacOS. Yay.
>
> >
>
> > I've set up my java.opt per this link referenced in the above link:
>
> >
>
> > https://trac.osgeo.org/gdal/ticket/2401
>
> >
>
> > But when I run "make" from the swig/java directory, I get this error:
>
> >
>
> > GNUmakefile:1: ../../GDALmake.opt: No such file or directory
>
> > make: *** No rule to make target `../../GDALmake.opt'. Stop.
>
> >
>
> > I did a search with "find" but I don't seem to have that file.
>
>
>
> You need to run ./configure to generate it. And it is strongly advise that
> you run the Java bindings against the same version of the native library
> for which they have been generated.
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
>
>
> E-Mail to and from me, in connection with the transaction
> of public business, is subject to the Wyoming Public Records
> Act and may be disclosed to third parties.
>

-- 

E-Mail to and from me, in connection with the transaction 
of public 
business, is subject to the Wyoming Public Records 
Act and may be 
disclosed to third parties.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/385a5150/attachment-0001.html>

From even.rouault at spatialys.com  Mon Apr 27 08:23:04 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Apr 2020 17:23:04 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <3556333.UkRkMUDu3N@even-i700>
References: <63523553.AW4fXskrrz@even-i700>
 <66dcebb1-e1bd-13ac-902a-ceed4d524785@xs4all.nl>
 <3556333.UkRkMUDu3N@even-i700>
Message-ID: <5498580.iqgzo3y7Gk@even-i700>

On lundi 27 avril 2020 16:18:39 CEST Even Rouault wrote:
> Bas,
> 
> > The embedded RTD theme (especially its fonts) and logo images are a
> > PITA. I'm tempted to just drop the libgdal-doc package are exclude the
> > entire doc/ subdirectory when repacking the tarball to make license &
> > copyright review less of a pain.

Bas, you can likely just use the plain tarball. We got confirmation from Planet 
Federal (ex Boundless) that their boundless_rtd theme, from which gdal_rtd is 
derived, can be licensed under MIT:
https://github.com/planetfederal/sphinx-theme/blob/master/LICENSE

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/a472110e/attachment.html>

From mwoo391 at gmail.com  Mon Apr 27 09:02:57 2020
From: mwoo391 at gmail.com (Maggie Wooten)
Date: Mon, 27 Apr 2020 12:02:57 -0400
Subject: [gdal-dev] Appending to a single feature class in a gdb via ogr2ogr
Message-ID: <CAB=GGNFT56e0cow26g2Jf+5ZUi6WLOfPT39hMYq3suoPEPkLXw@mail.gmail.com>

First, I apologize if I am using this mailing list improperly. This is my
first time here.

I am trying to iterate over some shapefiles (109 shapefiles to be exact)
and append them to a *single* feature class in an output geodatabase, but
the resulting output geodatabase is one with 100 feature classes that looks
like this:

INFO: Open of `output.gdb' using driver `FileGDB' successful.
1: output (Multi Polygon)
2: output_1 (Multi Polygon)
3: output_1_2 (Multi Polygon)
4: output_1_2_3 (Multi Polygon)
5: output_1_2_3_4 (Multi Polygon)
.....
99:
output_1_2_3_4_5_6_7_8_9_10_11_12_13_14_15_16_17_18_19_20_21_22_23_24_25_26_27_28_29_30_31_32_33_34_35_36_37_38_39_40_41_42_43_44_45_98
(Multi Polygon)
100:
output_1_2_3_4_5_6_7_8_9_10_11_12_13_14_15_16_17_18_19_20_21_22_23_24_25_26_27_28_29_30_31_32_33_34_35_36_37_38_39_40_41_42_43_44_45_99
(Multi Polygon)


These are the commands I'm running in the iteration:

if i == 0: "ogr2ogr -nln output -a_srs EPSG:4326 -t_srs EPSG:4326 -f
"FileGDB" output.gdb input1.shp"

else: "ogr2ogr -nln output -a_srs EPSG:4326 -t_srs EPSG:4326 -update
-append -f "FileGDB" output.gdb inputX.shp"


What am I doing wrong here? How can I get the desired result? I tried a
bunch of different things and flags and still could not get it all to
append to one feature class. Any advice would be greatly appreciated and
I'd be happy to provide whatever information may be necessary.

Thank you!
Ma
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/6cb4e9f5/attachment.html>

From even.rouault at spatialys.com  Mon Apr 27 10:20:46 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Apr 2020 19:20:46 +0200
Subject: [gdal-dev] Reconsidering release cycle length ?
Message-ID: <4319006.R1j4e70KG4@even-i700>

Hi,

I was wondering if we should not reconsider the length of our release cycles.

One year between feature versions is quite a lot. Perhaps 6 months would be a good 
compromise between having enough time to mature a complex feature and faster delivery of 
it to people not directly consuming master. A consequence of this is that our usual policy of 
supporting the last released branch during the development cycle of the next release would 
also go to 6 month (to avoid supporting too many branches at the same time), or perhaps 
even 4 (see below example)

I've also heard voices wishing to have more frequent bugfix releases. Every 2 months could 
be reasonable.

So a likely schedule could be:

T0 (now)				GDAL 3.1.0
T0 + 2 months			GDAL 3.1.1
T0 + 4 months			GDAL 3.1.2
T0 + 6 months			GDAL 3.2.0 (optionaly, a final 3.1.3)

Comparison with related projects:
- PROJ: feature version every 4 months, with a bugfix release in the middle. Potential major 
(breaking) version every year.
- QGIS: feature version every 4 months, with monthly bugfix releases (way more complicated 
than that with several versions supported in parallel, but was to make it simple...)

Of course depending on what comes to master, things could be reconsidered to let a bit more 
time for maturing a feature if needed, so 6 months is more an indication than a firm delay. 
This is also dependent on people doing the actual work. I'll do my share, but help always 
welcome. 

Thoughts ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/eef9372e/attachment-0001.html>

From andrew at aitchison.me.uk  Mon Apr 27 10:52:01 2020
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 27 Apr 2020 18:52:01 +0100 (BST)
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <CA+fOagRSzuUgwNj65sUN+F_J02iLeH=UvVMKgEwqQvmjm1W=Dw@mail.gmail.com>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
 <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
 <2001242.kW2l8oXAMP@even-i700>
 <CA+fOagTY7+Gmw3uqQTQmCf46++JyQ3JbhKTJwZYAFHd1CLYpqg@mail.gmail.com>
 <MN2PR04MB56937941D0FEB6EA337C7EACF2AF0@MN2PR04MB5693.namprd04.prod.outlook.com>
 <CA+fOagRSzuUgwNj65sUN+F_J02iLeH=UvVMKgEwqQvmjm1W=Dw@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2004271849360.410095@warden.aitchison.me.uk>

On Mon, 27 Apr 2020, David Rush wrote:

> Ivan:
>
> Thanks!  That worked.  On to the next error (with make in gdal/swig/java)
> ...
>
> gdalconst_wrap.c:154:10: fatal error: 'jni.h' file not found
> #include <jni.h>
>         ^~~~~~~
> 1 error generated.
> make: *** [gdalconst_wrap.lo] Error 1
>
> Where *should* jni.h come from?  I can't find it anywhere in my Java
> installation.

I believe it should be in the JDK (Java Development Kit)
- do you just have the JRE or Java Runtime Environment ?

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From jmckenna at gatewaygeomatics.com  Mon Apr 27 11:41:44 2020
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Mon, 27 Apr 2020 15:41:44 -0300
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <63523553.AW4fXskrrz@even-i700>
References: <63523553.AW4fXskrrz@even-i700>
Message-ID: <1f2f61cc-cebf-327b-c327-522aeacee853@gatewaygeomatics.com>

RC1 builds ok on Windows in VC2017, but, there were errors during the 
building of the docs.  I've created a pull request that fixes these 
errors on Windows (running MS4W's Python 3.7.5) : 
https://github.com/OSGeo/gdal/pull/2446

Note for packagers: the /doc/build/ output is ~112 MB  (GDAL 2.4.4 
/bin/html output was 1.6 MB)

-jeff



-- 
Jeff McKenna
MapServer Consulting and Training Services
https://gatewaygeo.com/




On 2020-04-27 10:37 a.m., Even Rouault wrote:
> Hi,
> 
> I have prepared a GDAL/OGR 3.1.0 release candidate.
> 
> Pick up an archive among the following ones (by ascending size):
> 
> https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc1.tar.xz
> 
> https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc1.tar.gz
> 
> https://download.osgeo.org/gdal/3.1.0/gdal310rc1.zip
> 
> A snapshot of the gdalautotest suite is also available :
> 
> https://download.osgeo.org/gdal/3.1.0/gdalautotest-3.1.0rc1.tar.gz
> 
> https://download.osgeo.org/gdal/3.1.0/gdalautotest-3.1.0rc1.zip
> 
> A snapshot of the documentation is at:
> 
> https://download.osgeo.org/gdal/3.1.0/gdal310doc.zip
> 
> GDAL-GRASS plugin:
> 
> https://download.osgeo.org/gdal/3.1.0/gdal-grass-3.1.0.tar.gz
> 
> NEWS at:
> 
> https://github.com/OSGeo/gdal/blob/v3.1.0RC1/gdal/NEWS
> 
> Packagers: note that the documentation has been revamped to use Sphinx. 
> If you want to build html and man pages, in addition to Doxygen, on top 
> of my head, you need at least the following Python packages: sphinx, 
> breathe, sphinx_rtd_theme (the recipee of the Docker image used to build 
> GDAL and PROJ websites is at
> 
> https://github.com/OSGeo/PROJ/blob/master/docs/docbuild/Dockerfile , but 
> I don't think you need all the packages mentioned)
> 
> For man pages, the tarball already includes them, so "make install-man" 
> can be enough if you don't feel like regenerating them from .rst.
> 
> I'll call for a vote promoting it to final later this week if no
> 
> serious problems are reported before.
> 
> Best regards,
> 
> Even
> 
> -- 
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com
> 
> 



From even.rouault at spatialys.com  Mon Apr 27 11:57:17 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Apr 2020 20:57:17 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <1f2f61cc-cebf-327b-c327-522aeacee853@gatewaygeomatics.com>
References: <63523553.AW4fXskrrz@even-i700>
 <1f2f61cc-cebf-327b-c327-522aeacee853@gatewaygeomatics.com>
Message-ID: <14707598.rLLoMae1vo@even-i700>

> 
> Note for packagers: the /doc/build/ output is ~112 MB  
(GDAL 2.4.4
> /bin/html output was 1.6 MB)

Actually, "only" 62 MB if you consider only /doc/build/html

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/9427096e/attachment.html>

From eadam at co.lincoln.or.us  Mon Apr 27 12:22:46 2020
From: eadam at co.lincoln.or.us (Eli Adam)
Date: Mon, 27 Apr 2020 12:22:46 -0700
Subject: [gdal-dev] Reconsidering release cycle length ?
In-Reply-To: <4319006.R1j4e70KG4@even-i700>
References: <4319006.R1j4e70KG4@even-i700>
Message-ID: <CACqBkM_Vj=jS5s11HE6tH4C8g1_nybc9G+4iOZWo7oj9ezc-Xw@mail.gmail.com>

On Mon, Apr 27, 2020 at 10:20 AM Even Rouault
<even.rouault at spatialys.com> wrote:
>
>
> One year between feature versions is quite a lot. Perhaps 6 months would be a good compromise between having enough time to mature a complex feature and faster delivery of it to people not directly consuming master. A consequence of this is that our usual policy of supporting the last released branch during the development cycle of the next release would also go to 6 month (to avoid supporting too many branches at the same time), or perhaps even 4 (see below example)
>
> I've also heard voices wishing to have more frequent bugfix releases. Every 2 months could be reasonable.
>
> Of course depending on what comes to master, things could be reconsidered to let a bit more time for maturing a feature if needed, so 6 months is more an indication than a firm delay. This is also dependent on people doing the actual work. I'll do my share, but help always welcome.
>

Perhaps another perspective on this is that since GDAL has a longer
release cycle, supports releases for a long time, is a fairly
innovative library with new drivers, new features, and improvements;
it compels people to track master and engage the project.  This
provides reliable testing for the project on various compilers,
hardware architecture, novel driver combinations, conflicts with other
software, and many other things that won't ever be fully covered in CI
type things.  If people were not compelled to track master, then this
engagement with the project might be reduced or pushed to releases
with a less interactive feedback (i.e. they won't be testing patches
or recent commits).  From my own personal experience, GDAL has been
the only project worth tracking master and engaging in this way.
Other projects, I wait for the release and take a binary and am less
in a position to provide testing or meaningful feedback.  Tracking
master and engaging with GDAL has been a rewarding experience for me
over the years.

Just another way to look at this.  I'm not sure if release cycle would
impact the number of people tracking master or the level of engagement
there but it might be worth considering.

I notice mostly Even's work on releases.  People wanting bug releases
more frequently could start by helping on releases.

Best regards, Eli


>
>
> Thoughts ?
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com

From david.rush at wyo.gov  Mon Apr 27 12:26:51 2020
From: david.rush at wyo.gov (David Rush)
Date: Mon, 27 Apr 2020 13:26:51 -0600
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <alpine.DEB.2.22.394.2004271849360.410095@warden.aitchison.me.uk>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
 <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
 <2001242.kW2l8oXAMP@even-i700>
 <CA+fOagTY7+Gmw3uqQTQmCf46++JyQ3JbhKTJwZYAFHd1CLYpqg@mail.gmail.com>
 <MN2PR04MB56937941D0FEB6EA337C7EACF2AF0@MN2PR04MB5693.namprd04.prod.outlook.com>
 <CA+fOagRSzuUgwNj65sUN+F_J02iLeH=UvVMKgEwqQvmjm1W=Dw@mail.gmail.com>
 <alpine.DEB.2.22.394.2004271849360.410095@warden.aitchison.me.uk>
Message-ID: <CA+fOagQFrva8kEA2P35xXnhNjyDvmVdZq0_RGSo-qChzidn8wQ@mail.gmail.com>

Andrew:

That's what I thought.  I do have the JDK (OpenJDK 11.0.2).

Ah, found it.  I think I may have both a JRE and JVM confusing things
(confusing me, at least).  Both appear to be the same version, at least.

I've changed my JAVA_HOME in java.opt to reflect where my JDK is
installed.  Also had to change the JAVA_INCLUDE in java.opt because jni.h
is under $JAVA_HOME/include rather than $JAVA_HOME/Headers.

Then it couldn't find "jni_md.h" (machine dependent things, apparently).  I
found it in my JDK installation, and copied it to the current directory
(gdal/swig/java), but it still can't seem to find it:

In file included from gdalconst_wrap.c:154:
/Library/Java/JavaVirtualMachines/jdk-11.0.2.jdk/Contents/Home/include/jni.h:45:10:
fatal error: 'jni_md.h' file not found
#include "jni_md.h"

Since the include is in quotes, it should be looking in the current
directory for it, right?  The gdalconst_wrap.c file is in the current
directory, so I'm in the right place.

Suggestions?

David

On Mon, Apr 27, 2020 at 11:52 AM Andrew C Aitchison <andrew at aitchison.me.uk>
wrote:

> On Mon, 27 Apr 2020, David Rush wrote:
>
> > Ivan:
> >
> > Thanks!  That worked.  On to the next error (with make in gdal/swig/java)
> > ...
> >
> > gdalconst_wrap.c:154:10: fatal error: 'jni.h' file not found
> > #include <jni.h>
> >         ^~~~~~~
> > 1 error generated.
> > make: *** [gdalconst_wrap.lo] Error 1
> >
> > Where *should* jni.h come from?  I can't find it anywhere in my Java
> > installation.
>
> I believe it should be in the JDK (Java Development Kit)
> - do you just have the JRE or Java Runtime Environment ?
>
> --
> Andrew C. Aitchison                                     Kendal, UK
>                         andrew at aitchison.me.uk
>

-- 

E-Mail to and from me, in connection with the transaction 
of public 
business, is subject to the Wyoming Public Records 
Act and may be 
disclosed to third parties.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/b06a7900/attachment.html>

From david.rush at wyo.gov  Mon Apr 27 12:56:45 2020
From: david.rush at wyo.gov (David Rush)
Date: Mon, 27 Apr 2020 13:56:45 -0600
Subject: [gdal-dev] Building for Java on MacOS
In-Reply-To: <CA+fOagQFrva8kEA2P35xXnhNjyDvmVdZq0_RGSo-qChzidn8wQ@mail.gmail.com>
References: <CA+fOagRVHCfLWaYR-XQqcGCY47wF5C2ZFvkjsPsp-NXBQOaAFA@mail.gmail.com>
 <FE10ACC0-1A73-4A73-93AE-291034DF5CAB@kyngchaos.com>
 <CA+fOagSc5MDW1S4VmKKv9TnacTS0y6u8igg3tgvyBw3n3fT0dA@mail.gmail.com>
 <2001242.kW2l8oXAMP@even-i700>
 <CA+fOagTY7+Gmw3uqQTQmCf46++JyQ3JbhKTJwZYAFHd1CLYpqg@mail.gmail.com>
 <MN2PR04MB56937941D0FEB6EA337C7EACF2AF0@MN2PR04MB5693.namprd04.prod.outlook.com>
 <CA+fOagRSzuUgwNj65sUN+F_J02iLeH=UvVMKgEwqQvmjm1W=Dw@mail.gmail.com>
 <alpine.DEB.2.22.394.2004271849360.410095@warden.aitchison.me.uk>
 <CA+fOagQFrva8kEA2P35xXnhNjyDvmVdZq0_RGSo-qChzidn8wQ@mail.gmail.com>
Message-ID: <CA+fOagQvaAu5dMZMPhuZdPH6f4bikp13Sip1vfiVyW=LJhATTA@mail.gmail.com>

Alright, since jni_md.h was referenced from jni.h, I tried copying jni_md.h
into the same directory as jni.h, which seems to have helped.  Or at least
got to the next error:

gnm_wrap.cpp:471:21: warning: unused function 'SWIG_JavaArrayOutDouble'
[-Wunused-function]
static jdoubleArray SWIG_JavaArrayOutDouble (JNIEnv *jenv, double *result,
jsize sz);
                    ^
94 warnings generated.
/bin/sh /Users/david/w/gdal/gdal-3.0.4/libtool --mode=link --silent g++
-std=c++11 -dynamiclib -single_module -flat_namespace -undefined suppress
gdalconst_wrap.lo gdal_wrap.lo osr_wrap.lo ogr_wrap.lo gnm_wrap.lo
 /Users/david/w/gdal/gdal-3.0.4/libgdal.la -o libgdalalljni.la -rpath
/usr/local/lib -no-undefined -version-info 26:4:0
libtool:   error: cannot find the library '/Users/david/w/gdal/gdal-3.0.4/
libgdal.la' or unhandled argument '/Users/david/w/gdal/gdal-3.0.4/libgdal.la
'
make: *** [libgdalalljni.la] Error 1

Indeed gdal-3.0.4/libgdal.la isn't there.  How do I get it?

David

On Mon, Apr 27, 2020 at 1:26 PM David Rush <david.rush at wyo.gov> wrote:

> Andrew:
>
> That's what I thought.  I do have the JDK (OpenJDK 11.0.2).
>
> Ah, found it.  I think I may have both a JRE and JVM confusing things
> (confusing me, at least).  Both appear to be the same version, at least.
>
> I've changed my JAVA_HOME in java.opt to reflect where my JDK is
> installed.  Also had to change the JAVA_INCLUDE in java.opt because jni.h
> is under $JAVA_HOME/include rather than $JAVA_HOME/Headers.
>
> Then it couldn't find "jni_md.h" (machine dependent things, apparently).
> I found it in my JDK installation, and copied it to the current directory
> (gdal/swig/java), but it still can't seem to find it:
>
> In file included from gdalconst_wrap.c:154:
> /Library/Java/JavaVirtualMachines/jdk-11.0.2.jdk/Contents/Home/include/jni.h:45:10:
> fatal error: 'jni_md.h' file not found
> #include "jni_md.h"
>
> Since the include is in quotes, it should be looking in the current
> directory for it, right?  The gdalconst_wrap.c file is in the current
> directory, so I'm in the right place.
>
> Suggestions?
>
> David
>
> On Mon, Apr 27, 2020 at 11:52 AM Andrew C Aitchison <
> andrew at aitchison.me.uk> wrote:
>
>> On Mon, 27 Apr 2020, David Rush wrote:
>>
>> > Ivan:
>> >
>> > Thanks!  That worked.  On to the next error (with make in
>> gdal/swig/java)
>> > ...
>> >
>> > gdalconst_wrap.c:154:10: fatal error: 'jni.h' file not found
>> > #include <jni.h>
>> >         ^~~~~~~
>> > 1 error generated.
>> > make: *** [gdalconst_wrap.lo] Error 1
>> >
>> > Where *should* jni.h come from?  I can't find it anywhere in my Java
>> > installation.
>>
>> I believe it should be in the JDK (Java Development Kit)
>> - do you just have the JRE or Java Runtime Environment ?
>>
>> --
>> Andrew C. Aitchison                                     Kendal, UK
>>                         andrew at aitchison.me.uk
>>
>

-- 

E-Mail to and from me, in connection with the transaction 
of public 
business, is subject to the Wyoming Public Records 
Act and may be 
disclosed to third parties.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200427/256664f6/attachment.html>

From jmckenna at gatewaygeomatics.com  Mon Apr 27 13:02:38 2020
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Mon, 27 Apr 2020 17:02:38 -0300
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <14707598.rLLoMae1vo@even-i700>
References: <63523553.AW4fXskrrz@even-i700>
 <1f2f61cc-cebf-327b-c327-522aeacee853@gatewaygeomatics.com>
 <14707598.rLLoMae1vo@even-i700>
Message-ID: <67091b4e-17d6-c50d-0141-52fad7eb01e1@gatewaygeomatics.com>

On 2020-04-27 3:57 p.m., Even Rouault wrote:
>  >
> 
>  > Note for packagers: the /doc/build/ output is ~112 MB (GDAL 2.4.4
> 
>  > /bin/html output was 1.6 MB)
> 
> Actually, "only" 62 MB if you consider only /doc/build/html
> 

True! To clarify: my post of size was not a complaint but was for 
packagers wondering the total size.  (I'm one of those who distributes 
the docs for Windows/MS4W users with GDAL, which is handy for those who 
run workshops without internet)

-jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
https://gatewaygeo.com/

From gdt at lexort.com  Mon Apr 27 16:26:02 2020
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 27 Apr 2020 19:26:02 -0400
Subject: [gdal-dev] Reconsidering release cycle length ?
In-Reply-To: <4319006.R1j4e70KG4@even-i700> (Even Rouault's message of "Mon,
 27 Apr 2020 19:20:46 +0200")
References: <4319006.R1j4e70KG4@even-i700>
Message-ID: <rmi5zdkv7cl.fsf@s1.lexort.com>

Even Rouault <even.rouault at spatialys.com> writes:

> I was wondering if we should not reconsider the length of our release cycles.

Comments from the packaging peanut gallery.

> One year between feature versions is quite a lot. Perhaps 6 months would be a good 
> compromise between having enough time to mature a complex feature and faster delivery of 
> it to people not directly consuming master. A consequence of this is that our usual policy of 
> supporting the last released branch during the development cycle of the next release would 
> also go to 6 month (to avoid supporting too many branches at the same time), or perhaps 
> even 4 (see below example)

There are multiple issues, but basically "new features" doesn't bother
me and "API withdrawals/breaks" do.

  new versions have varying degrees of awkwardness:

    bug fixes, etc., with no changes in the set of installed files:
    updates are very very easy

    new files: tiny amount of work, but no angst

    shlib major bumps or any other ABI break: more work as all depending
    packages need to be rebuilt, but not terrible.  However, shlib major
    bumps indicate API withdrawals (or poor library versioning
    practices).

    API withdrawals/breaks, i.e. things that cause things that depend on
    gdal not to build: really bad, and would delay adoption

  new versions impose work variously as above, and whether you call them
  feature or bugfixes doesn't matter too much to me.  I see the first as
  bugfix, the second as feature, and the third and fourth as breaking
  changes, with the third being awkward and the fourth serious.

  bundling shlib bumps reduces total packaging effort (but you should
  avoid shlib bumps anyway)

  Each API withdrawal basically causes the same amount of pain, and
  bundling doesn't really reduce total pain, except that if some
  depending package fixes two things at once, the savings is them
  actually having a release only once.  For withdrawals to be ok means
  that that *every* depending package has to have a *formal release*
  that builds against the new API before the new gdal release that
  withdraws the API.  (Not what you asked, but this is the big deal and
  everything else is just details.)

> I've also heard voices wishing to have more frequent bugfix releases. Every 2 months could 
> be reasonable.

>From a packaging point of view, a release with only bugfixes (whose
"NEWS" clearly states this) is very easy and welcome.   Also from a
packaging point of view, if you had a bugfix release every 2 weeks and I
got to some of them and not others, that would be fine too.

> So a likely schedule could be:
>
> T0 (now)				GDAL 3.1.0
> T0 + 2 months			GDAL 3.1.1
> T0 + 4 months			GDAL 3.1.2
> T0 + 6 months			GDAL 3.2.0 (optionaly, a final 3.1.3)

OK with me.

You didn't discuss the LTS elephant in the room.  Some systems like to
freeze a version for 5 years, and want bugfixes, while their users
simultaneously want to build new versions of other software, but only
depending on the old included versions.  My view is that since those
users aren't paying gdal to maintain LTS branches, you shouldn't worry
about this at all.

> Comparison with related projects:
> - PROJ: feature version every 4 months, with a bugfix release in the middle. Potential major 
> (breaking) version every year.

Breaking changes every year is faster than depending projects have
coped.  This really should be avoided; I don't think proj should be held
up as a good plan here.

> - QGIS: feature version every 4 months, with monthly bugfix releases (way more complicated 
> than that with several versions supported in parallel, but was to make it simple...)

That's fine, but the real issue is "other packages that need X to build
- does the most recent formal release still just build".  With qgis, not
clear how much depends on it, and I haven't heard screams about API breaks.

From gdt at lexort.com  Mon Apr 27 16:29:54 2020
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 27 Apr 2020 19:29:54 -0400
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <5498580.iqgzo3y7Gk@even-i700> (Even Rouault's message of "Mon,
 27 Apr 2020 17:23:04 +0200")
References: <63523553.AW4fXskrrz@even-i700>
 <66dcebb1-e1bd-13ac-902a-ceed4d524785@xs4all.nl>
 <3556333.UkRkMUDu3N@even-i700> <5498580.iqgzo3y7Gk@even-i700>
Message-ID: <rmi1ro8v765.fsf@s1.lexort.com>

Even Rouault <even.rouault at spatialys.com> writes:

> Bas, you can likely just use the plain tarball. We got confirmation from Planet 
> Federal (ex Boundless) that their boundless_rtd theme, from which gdal_rtd is 
> derived, can be licensed under MIT:
> https://github.com/planetfederal/sphinx-theme/blob/master/LICENSE

I'm not as particular - but if there are bits copied in, it would be
nice to have a license statement copied in with them, so this sort of
license audit to ensure that the bits are all Free is easy.

From nyall.dawson at gmail.com  Mon Apr 27 16:38:19 2020
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Tue, 28 Apr 2020 09:38:19 +1000
Subject: [gdal-dev] Reconsidering release cycle length ?
In-Reply-To: <4319006.R1j4e70KG4@even-i700>
References: <4319006.R1j4e70KG4@even-i700>
Message-ID: <CAB28Asi=6b+DGxAyvdXtBgx0DanQzfo9a_rtR_v=V_iDYz5GbQ@mail.gmail.com>

On Tue, 28 Apr 2020 at 03:21, Even Rouault <even.rouault at spatialys.com> wrote:

> One year between feature versions is quite a lot. Perhaps 6 months would be a good compromise between having enough time to mature a complex feature and faster delivery of it to people not directly consuming master. A consequence of this is that our usual policy of supporting the last released branch during the development cycle of the next release would also go to 6 month (to avoid supporting too many branches at the same time), or perhaps even 4 (see below example)

+1. One year is a very long time for funders to see a usable outcome
of their investment.

> I've also heard voices wishing to have more frequent bugfix releases. Every 2 months could be reasonable.

+1. (No blame on the GDAL project at all for this, I totally
understand that there's been no critical bug fixes in this time... but
the current release gap of ~ 3 months is a long time to wait for minor
bug fixes to be available for end users)

Nyall

From even.rouault at spatialys.com  Mon Apr 27 16:46:35 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 28 Apr 2020 01:46:35 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <rmi1ro8v765.fsf@s1.lexort.com>
References: <63523553.AW4fXskrrz@even-i700> <5498580.iqgzo3y7Gk@even-i700>
 <rmi1ro8v765.fsf@s1.lexort.com>
Message-ID: <2352925.W0ias5pnDY@even-i700>

On lundi 27 avril 2020 19:29:54 CEST Greg Troxel wrote:
> Even Rouault <even.rouault at spatialys.com> writes:
> > Bas, you can likely just use the plain tarball. We got confirmation from
> > Planet Federal (ex Boundless) that their boundless_rtd theme, from which
> > gdal_rtd is derived, can be licensed under MIT:
> > https://github.com/planetfederal/sphinx-theme/blob/master/LICENSE
> 
> I'm not as particular - but if there are bits copied in, it would be
> nice to have a license statement copied in with them, so this sort of
> license audit to ensure that the bits are all Free is easy.

Done

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200428/bf199276/attachment.html>

From even.rouault at spatialys.com  Tue Apr 28 03:04:57 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 28 Apr 2020 12:04:57 +0200
Subject: [gdal-dev] Reconsidering release cycle length ?
In-Reply-To: <CACqBkM_Vj=jS5s11HE6tH4C8g1_nybc9G+4iOZWo7oj9ezc-Xw@mail.gmail.com>
References: <4319006.R1j4e70KG4@even-i700>
 <CACqBkM_Vj=jS5s11HE6tH4C8g1_nybc9G+4iOZWo7oj9ezc-Xw@mail.gmail.com>
Message-ID: <63526498.YS5155W3aS@even-i700>

Answering to several people in a row:

@Eli

> If people were not compelled to track master, then this
> engagement with the project might be reduced or pushed to releases
> with a less interactive feedback (i.e. they won't be testing patches
> or recent commits).  From my own personal experience, GDAL has been
> the only project worth tracking master and engaging in this way.
> Other projects, I wait for the release and take a binary and am less
> in a position to provide testing or meaningful feedback.  Tracking
> master and engaging with GDAL has been a rewarding experience for me
> over the years.

I'm not sure why having shorter cycles would increase or decrease potential candidates to 
tracking master. It seems to me to be more related to their own interest in the project, which 
should be somewhat independent from the length of the cycle. People highly interested in 
the project should still track it as closely as they are used to if they want the same level of 
quality, and people more remotely interested will probably just wait for their binary 
distribution channel to bring releases to them.

Having shorter feature cycles can also help reduce developer frustration: when you start 
getting bug reports for a feature you added > 1 year ago (because most users 
understandably use a packaged version), you may have already forgotten lots of details. 
When I update the NEWS file before release, I'm sometimes surprised to have to qualify as 
new something that looks to me as having been developed years ago :-)

@Greg

>  API withdrawals/breaks

We try to avoid those when possible. But we have more frequently changes that have some 
backward compatibility challenges (generally a few per feature version), not always detected 
at build time. That can be things like:
- a new value added to a C enumeration in the API. Requiring user code to deal with this new 
possibility
- an option disappearing / being renamed for more generality
- other changes of runtime behaviour. Like in this cycle, the OGR SQL "LIKE" operator 
becoming case insensitive.

Those are documented in the MIGRATION_GUIDE.TXT file.
Adressing those changes for code using GDAL is almost equally important as making sure 
that the code still builds.

> You didn't discuss the LTS elephant in the room.

Speaking from my experience, candidates like proprietary shops that could provide $$ to 
make that happen generally resync their GDAL build with a release or some state of master 
from time to time. And perhaps potentially pick a particular bugfix of interest occasionaly.

Regarding LTS-labelled Linux distros, for the few on I've looked at, they don't seem to update 
to the latest patch release we provide for a given feature version, and are stuck to the one 
that existed at the time the .0 of the distro was frozen. Probably lack of man power, or too 
strict update policies that restrict maintainers to do cherry-picking (quite risky IMHO when 
done not with someone intimate with the code base) rather than rolling a new patch release.

For a project vetted LTS, beyond having acceptance within GDAL devs and potential funding 
for it, one difficulty would be to choose which version to LTS. Or perhaps do like QGIS does, 
just say "eh, every one out of N feature versions is the LTS.". People also tend to disagree 
what a LTS is: for some it is something mostly frozen with minimal changes (security ones), 
for others something that can receive any non-breaking change (including things that could 
qualify as features), and a lot of in-between situations (for QGIS we discussed recently the 
possibility to have several phases: an initial one where changes are accepted liberaly, and a 
last one where only "critical" bug fixes can land)

But, anyway, I've not heard yet converging demands for such a thing for GDAL.

> [Regarding PROJ] Breaking changes every year is faster than depending projects have 
coped.

Yes, was annoying but needed to keep PROJ relevant for current and future geodetic 
challenges, after years of stagnation. Our geospatial projects are lively objects that cannot 
be compared to Unix base tools that are almost set in stone forever :-)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200428/09677863/attachment-0001.html>

From Daniel.Evans at jbarisk.com  Tue Apr 28 05:30:08 2020
From: Daniel.Evans at jbarisk.com (Daniel Evans)
Date: Tue, 28 Apr 2020 12:30:08 +0000
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <1798201.77pILY3yKT@even-i700>
References: <63523553.AW4fXskrrz@even-i700>
 <LO3P123MB2953F1DFE0BF0A16D9585A3C95AC0@LO3P123MB2953.GBRP123.PROD.OUTLOOK.COM>
 <1798201.77pILY3yKT@even-i700>
Message-ID: <LO3P123MB2953BB65B31A84EF1A25C51F95AC0@LO3P123MB2953.GBRP123.PROD.OUTLOOK.COM>

Thanks Even.

Apparently I managed to reply to Even directly, not to the mailing list, which I've now copied back in.


From: Even Rouault <even.rouault at spatialys.com>
Sent: 28 April 2020 12:53
To: Daniel Evans <Daniel.Evans at jbarisk.com>
Subject: Re: [gdal-dev] GDAL 3.1.0 RC1 available


Daniel,



issue confirmed. Spotted to

https://github.com/OSGeo/gdal/pull/2395#issuecomment-620557715



Even



> Hi,

>

> I'm having difficulty compiling GDAL 3.1.0 in a Linux Docker container. I'm

> using a slightly updated version of the "gdalmanylinux" script to build

> Python packages, which you can see here:

> https://github.com/DanielFEvans/gdalmanylinux/blob/gdal_3.1.0/Dockerfile.wh

> eels

>

> I'm building with GEOS 3.8.1 (latest public release), and

> "/usr/local/bin/geos-config --version" shows that version correctly.

> However, when building GDAL (i.e. the "make" step for GDAL), it appears to

> be failing to find GEOS, or some parts of it:

>

> ...

> /bin/sh /src/gdal-3.1.0/libtool --mode=link --silent g++ -std=c++11

> gdalenhance.lo /src/gdal-3.1.0/libgdal.la -o gdalenhance

> /src/gdal-3.1.0/.libs/libgdal.so: undefined reference to `GEOSOverlaps_r'

> /src/gdal-3.1.0/.libs/libgdal.so: undefined reference to `GEOSTouches_r'

> /src/gdal-3.1.0/.libs/libgdal.so: undefined reference to `GEOSPolygonize_r'

> /src/gdal-3.1.0/.libs/libgdal.so: undefined reference to

> `GEOSGetCentroid_r' /src/gdal-3.1.0/.libs/libgdal.so: undefined reference

> to `GEOSWKBWriter_destroy_r' /src/gdal-3.1.0/.libs/libgdal.so: undefined

> reference to `GEOSSimplify_r' /src/gdal-3.1.0/.libs/libgdal.so: undefined

> reference to `GEOSContains_r' /src/gdal-3.1.0/.libs/libgdal.so: undefined

> reference to `GEOSGeom_destroy_r' ...

>

> The same build script works for GDAL 3.0.4. Is there a change I need to make

> to my build script?

>

> Let me know if more of the build output is needed.

>

> Daniel

>

> From: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> On Behalf Of Even Rouault

> Sent: 27 April 2020 14:38

> To: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

> Subject: [gdal-dev] GDAL 3.1.0 RC1 available

>

>

> Hi,

>

>

>

> I have prepared a GDAL/OGR 3.1.0 release candidate.

>

>

>

> Pick up an archive among the following ones (by ascending size):

>

>

>

> https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc1.tar.xz

>

> https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc1.tar.gz

>

> https://download.osgeo.org/gdal/3.1.0/gdal310rc1.zip

>

>

>

> A snapshot of the gdalautotest suite is also available :

>

>

>

> https://download.osgeo.org/gdal/3.1.0/gdalautotest-3.1.0rc1.tar.gz

>

> https://download.osgeo.org/gdal/3.1.0/gdalautotest-3.1.0rc1.zip

>

>

>

> A snapshot of the documentation is at:

>

>

>

> https://download.osgeo.org/gdal/3.1.0/gdal310doc.zip

>

>

>

> GDAL-GRASS plugin:

>

>

>

> https://download.osgeo.org/gdal/3.1.0/gdal-grass-3.1.0.tar.gz

>

>

>

> NEWS at:

>

>

>

> https://github.com/OSGeo/gdal/blob/v3.1.0RC1/gdal/NEWS

>

>

>

> Packagers: note that the documentation has been revamped to use Sphinx. If

> you want to build html and man pages, in addition to Doxygen, on top of my

> head, you need at least the following Python packages: sphinx, breathe,

> sphinx_rtd_theme (the recipee of the Docker image used to build GDAL and

> PROJ websites is at

>

> https://github.com/OSGeo/PROJ/blob/master/docs/docbuild/Dockerfile , but I

> don't think you need all the packages mentioned)

>

> For man pages, the tarball already includes them, so "make install-man" can

> be enough if you don't feel like regenerating them from .rst.

>

>

>

> I'll call for a vote promoting it to final later this week if no

>

> serious problems are reported before.

>

>

>

> Best regards,

>

>

>

> Even

>

>

>

> --

>

> Spatialys - Geospatial professional services

>

> http://www.spatialys.com

>

> [JBA COVID-19

> statement]<https://www.jbagroup.co.uk/sites/www.jbagroup.co.uk/files/docume

> nts/15-030%20JBA%20Business%20Continuity%20Briefing%20-%20Latest.pdf>

>

> T +44 (0) 1756 799919

> www.jbarisk.com<http://www.jbarisk.com<http://www.jbarisk.com%3chttp:/www.jbarisk.com>>

>

> [Visit our website]<http://www.jbarisk.com>

> [http://www.jbagroup.co.uk/imgstore/JBA-Email-Sig-Icons-LINKEDIN.png]

> [Follow us on Twitter] <https://twitter.com/jbarisk> Our postal address and

> registered office is JBA Risk Management Limited, 1 Broughton Park, Old

> Lane North, Broughton, Skipton, North Yorkshire BD23 3FD.

>

> Find out more about us here: www.jbarisk.com<http://www.jbarisk.com/<http://www.jbarisk.com%3chttp:/www.jbarisk.com/>> and

> follow us on Twitter @JBARisk<http://twitter.com/JBARisk> and

> LinkedIn<https://www.linkedin.com/company/2370847?trk=tyah&trkInfo=clickedV

> ertical%3Acompany%2CclickedEntityId%3A2370847%2Cidx%3A2-1-2%2CtarId%3A144741

> 4259786%2Ctas%3AJBA%20RISK%20MANAGEMENT>

>

> The JBA Group supports the JBA Trust.

>

> All JBA Risk Management's email messages contain confidential information

> and are intended only for the individual(s) named. If you are not the named

> addressee you should not disseminate, distribute or copy this e-mail.

> Please notify the sender immediately by email if you have received this

> email by mistake and delete this email from your system.

>

>

> JBA Risk Management Limited is registered in England, company number

> 07732946, 1 Broughton Park, Old Lane North, Broughton, Skipton, North

> Yorkshire, BD23 3FD, Telephone: +441756799919





--

Spatialys - Geospatial professional services

http://www.spatialys.com

[JBA COVID-19 statement]<https://www.jbagroup.co.uk/sites/www.jbagroup.co.uk/files/documents/15-030%20JBA%20Business%20Continuity%20Briefing%20-%20Latest.pdf>
Our postal address and registered office is JBA Risk Management Limited, 1 Broughton Park, Old Lane North, Broughton, Skipton, North Yorkshire BD23 3FD.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200428/80656946/attachment-0001.html>

From gdt at lexort.com  Tue Apr 28 07:21:58 2020
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 28 Apr 2020 10:21:58 -0400
Subject: [gdal-dev] Reconsidering release cycle length ?
In-Reply-To: <63526498.YS5155W3aS@even-i700> (Even Rouault's message of "Tue, 
 28 Apr 2020 12:04:57 +0200")
References: <4319006.R1j4e70KG4@even-i700>
 <CACqBkM_Vj=jS5s11HE6tH4C8g1_nybc9G+4iOZWo7oj9ezc-Xw@mail.gmail.com>
 <63526498.YS5155W3aS@even-i700>
Message-ID: <rmih7x3snax.fsf@s1.lexort.com>

Even Rouault <even.rouault at spatialys.com> writes:

> I'm not sure why having shorter cycles would increase or decrease
> potential candidates to tracking master. It seems to me to be more
> related to their own interest in the project, which should be somewhat
> independent from the length of the cycle. People highly interested in
> the project should still track it as closely as they are used to if
> they want the same level of quality, and people more remotely
> interested will probably just wait for their binary distribution
> channel to bring releases to them.

For Eli's comment, I'm not sure the release interval matters much
either.

There is an important aspect about people that just want to be users and
thus *should* be using binary releases, but feel pressed into running
git master for various reasons.  I have not really seen this with gdal,
but some projects end up giving advice like "the release is old; you
should run git master".  So I'd say "people that are simply users of
gdal feeling that they should run master is a clue that a feature
release is overdue", without suggesting that this is actually the case.
But certainly I have seen that on some projects.

> We try to avoid those when possible. But we have more frequently changes that have some 
> backward compatibility challenges (generally a few per feature version), not always detected 
> at build time. That can be things like:
> - a new value added to a C enumeration in the API. Requiring user code to deal with this new 
> possibility
> - an option disappearing / being renamed for more generality
> - other changes of runtime behaviour. Like in this cycle, the OGR SQL "LIKE" operator 
> becoming case insensitive.
>
> Those are documented in the MIGRATION_GUIDE.TXT file.
> Adressing those changes for code using GDAL is almost equally important as making sure 
> that the code still builds.

I'm not following if these are only in your 'breaking changes releases'
vs 'feature releases'.  But I have not epxerienced pain about these
changes, and with N formats, minor changes that don't cause too much
trouble are minor.

> Regarding LTS-labelled Linux distros, for the few on I've looked at,
> they don't seem to update to the latest patch release we provide for a
> given feature version, and are stuck to the one that existed at the
> time the .0 of the distro was frozen. Probably lack of man power, or
> too strict update policies that restrict maintainers to do
> cherry-picking (quite risky IMHO when done not with someone intimate
> with the code base) rather than rolling a new patch release.

I'm not a fan of LTS, and I'm really not a fan of the concept of wanting
to run LTS while also wanting to build new software at the same time.  I
agree with you that gdal shouldn't worry about this at all.


From even.rouault at spatialys.com  Tue Apr 28 08:15:58 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 28 Apr 2020 17:15:58 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <LO3P123MB2953BB65B31A84EF1A25C51F95AC0@LO3P123MB2953.GBRP123.PROD.OUTLOOK.COM>
References: <63523553.AW4fXskrrz@even-i700> <1798201.77pILY3yKT@even-i700>
 <LO3P123MB2953BB65B31A84EF1A25C51F95AC0@LO3P123MB2953.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <1961950.HPuvZTIgiX@even-i700>

Issue fixed now. I'll re-issue a RC2 soon to address this.

Unrelated notes regarding 
https://github.com/DanielFEvans/gdalmanylinux/blob/gdal_3.1.0/Dockerfile.wheels

- Jasper probably unneeded as you use openjpeg which is normally superior to it
- PROJ could be bumped to 6.3.1 or 7.0.0. And within a few days to 6.3.2 / 7.0.1 once they are 
promoted to final
- if you're somehow interested in accurate geodetic datum transformations, you'd better 
install some grids. See https://proj.org/download.html for options. With PROJ >= 7.0, you can 
also set the env variable PROJ_NETWORK=ON for on-demand fetching of needed grids 
through the network.
- openjpeg could/should be bumped to 2.3.1
- hdf5, netcdf could potentially be bumped too to 1.12.0 and 4.7.4. See https://github.com/
OSGeo/gdal/blob/master/gdal/docker/alpine-normal/Dockerfile
- webp presumably too
- --with-static-proj4=/usr/local is deprecated ==> --with-proj=/usr/local

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200428/cbca9ec8/attachment.html>

From even.rouault at spatialys.com  Tue Apr 28 12:02:45 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 28 Apr 2020 21:02:45 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC2 available
Message-ID: <5045356.a7JfxnZW0b@even-i700>

Hi,

I have prepared a second release candidate.

The changes since RC1 are:
- (reason for this RC2) fix a regression of ./configure regarding linking some dependencies 
such as GEOS, on older systems that don't support the -E switch of sed
- typo fixes
- addition of a LICENSE file for gdal_rtd doc theme
- fix for documentation building on Windows
- addition of CharLS 2.1 support

Updated files are at:

  https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc2.tar.xz
  https://download.osgeo.org/gdal/3.1.0/gdal-3.1.0rc2.tar.gz
  https://download.osgeo.org/gdal/3.1.0/gdal310rc2.zip

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200428/b6f290f0/attachment.html>

From norman.barker at gmail.com  Tue Apr 28 15:23:50 2020
From: norman.barker at gmail.com (Norman Barker)
Date: Tue, 28 Apr 2020 17:23:50 -0500
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <1961950.HPuvZTIgiX@even-i700>
References: <63523553.AW4fXskrrz@even-i700> <1798201.77pILY3yKT@even-i700>
 <LO3P123MB2953BB65B31A84EF1A25C51F95AC0@LO3P123MB2953.GBRP123.PROD.OUTLOOK.COM>
 <1961950.HPuvZTIgiX@even-i700>
Message-ID: <CAN_Dn-H9AHxY9ochnfAHOq62WXJxYTzV4GHYucKyQ8y11L3w9A@mail.gmail.com>

Hi Even,

Does https://github.com/OSGeo/gdal/pull/2397 need to be included in the
notes for this RC? I see the code is in the release which is great, thank
you.

I have checked over the other TileDB functions in this RC and it looks good
to me.

Norman

On Tue, Apr 28, 2020 at 10:16 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Issue fixed now. I'll re-issue a RC2 soon to address this.
>
>
>
> Unrelated notes regarding
>
>
> https://github.com/DanielFEvans/gdalmanylinux/blob/gdal_3.1.0/Dockerfile.wheels
>
>
>
> - Jasper probably unneeded as you use openjpeg which is normally superior
> to it
>
> - PROJ could be bumped to 6.3.1 or 7.0.0. And within a few days to 6.3.2 /
> 7.0.1 once they are promoted to final
>
> - if you're somehow interested in accurate geodetic datum transformations,
> you'd better install some grids. See https://proj.org/download.html for
> options. With PROJ >= 7.0, you can also set the env variable
> PROJ_NETWORK=ON for on-demand fetching of needed grids through the network.
>
> - openjpeg could/should be bumped to 2.3.1
>
> - hdf5, netcdf could potentially be bumped too to 1.12.0 and 4.7.4. See
> https://github.com/OSGeo/gdal/blob/master/gdal/docker/alpine-normal/Dockerfile
>
> - webp presumably too
>
> - --with-static-proj4=/usr/local is deprecated ==> --with-proj=/usr/local
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200428/9abd7bfb/attachment.html>

From even.rouault at spatialys.com  Tue Apr 28 15:33:26 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 Apr 2020 00:33:26 +0200
Subject: [gdal-dev] GDAL 3.1.0 RC1 available
In-Reply-To: <CAN_Dn-H9AHxY9ochnfAHOq62WXJxYTzV4GHYucKyQ8y11L3w9A@mail.gmail.com>
References: <63523553.AW4fXskrrz@even-i700> <1961950.HPuvZTIgiX@even-i700>
 <CAN_Dn-H9AHxY9ochnfAHOq62WXJxYTzV4GHYucKyQ8y11L3w9A@mail.gmail.com>
Message-ID: <10662244.xAITQzS8sb@even-i700>

On mardi 28 avril 2020 17:23:50 CEST Norman Barker wrote:
> Hi Even,
> 
> Does https://github.com/OSGeo/gdal/pull/2397 need to be included in the
> notes for this RC? I see the code is in the release which is great, thank
> you.

I think I intended this to be covered by the line 
 * redirect vsis3 calls to tiledb s3 direct calls

Actually now you mention it, I remember there were 2 commits with tiledb and s3, and as I 
couldn't really tell the difference with the "Enable TileDB driver to parse /vsis3/ uris" commit 
of the PR you mention, I merged them together. That's at line 397 or a 700-line long log, so 
an editorial choice :-) Hopefully curious users will understand there was things involving 
TileDB & S3 in this release :-)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200429/bb9cc57b/attachment.html>

From yanns.tremblay at gmail.com  Tue Apr 28 16:24:32 2020
From: yanns.tremblay at gmail.com (Yann-Sebastien Tremblay-Johnston)
Date: Tue, 28 Apr 2020 16:24:32 -0700
Subject: [gdal-dev] Clarifying AxisMappingStrategy for SpatialReference read
 from GeoJSON in gdal > 3
Message-ID: <CA++BqZBP2c2oyfNeLk_dLUt_YEVk52MiO9znHSqONYerv=7scA@mail.gmail.com>

Hi,

Tested using conda gdal 3.0.4 and gdal bundled with QGIS (3.0.4)

>From the documented changes in gdal > 3 with respect to honouring
coordinate order i.e. lat/lon order for EPSG:4326, I would expect that when

from osgeo import ogr
> ds = ogr.Open('test.geojson')
> layer = ds.GetLayer()
> srs = layer.GetSpatialRef()
> print(srs.GetAxisMappingStrategy())


to yield

1  # OAMS_AUTHORITY_COMPLIANT


but it yields 0 (OAMS_TRADITIONAL_GIS_ORDER).
I see that the wording in
https://gdal.org/tutorials/osr_api_tut.html?highlight=coordinate%20order#crs-and-axis-order
only
mentions the OGR Coordinate Transformation class (w.r.t honouring axis
order), so is the SpatialReference when reading from GeoJSON in how I've
shown above the intended behavior? I've tried this on both a GeoJSON
without an explicit crs designation and one with a crs
of urn:ogc:def:crs:OGC:1.3:CRS84 and both have the same result
(OAMS_TRADITIONAL_GIS_ORDER).

Cheers,

Sebastien
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200428/b8d00e2e/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Apr 28 23:49:53 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 28 Apr 2020 23:49:53 -0700 (MST)
Subject: [gdal-dev] Clarifying AxisMappingStrategy for SpatialReference
 read from GeoJSON in gdal > 3
In-Reply-To: <CA++BqZBP2c2oyfNeLk_dLUt_YEVk52MiO9znHSqONYerv=7scA@mail.gmail.com>
References: <CA++BqZBP2c2oyfNeLk_dLUt_YEVk52MiO9znHSqONYerv=7scA@mail.gmail.com>
Message-ID: <1588142993182-0.post@n6.nabble.com>

Hi,

The current GeoJSON specification defines CRS in
https://tools.ietf.org/html/rfc7946#section-4

"4.  Coordinate Reference System

   The coordinate reference system for all GeoJSON coordinates is a
   geographic coordinate reference system, using the World Geodetic
   System 1984 (WGS 84) [WGS84] datum, with longitude and latitude units
   of decimal degrees.  This is equivalent to the coordinate reference
   system identified by the Open Geospatial Consortium (OGC) URN
   urn:ogc:def:crs:OGC::CRS84.  An OPTIONAL third-position element SHALL
   be the height in meters above or below the WGS 84 reference
   ellipsoid.  In the absence of elevation values, applications
   sensitive to height or depth SHOULD interpret positions as being at
   local ground or sea level.

   Note: the use of alternative coordinate reference systems was
   specified in [GJ2008], but it has been removed from this version of
   the specification because the use of different coordinate reference
   systems -- especially in the manner specified in [GJ2008] -- has
   proven to have interoperability issues."

It has also proven that GIS users keep on using alternative coordinate
reference systems with GeoJSON. The rfc7946 says about this only:

"However, where all involved parties have a prior arrangement, alternative
coordinate reference systems can be used without risk of data being
misinterpreted."

What most involved parties do is to rely on the older GeoJSON specification
https://geojson.org/geojson-spec.html.

"A position is represented by an array of numbers. There must be at least
two elements, and may be more. The order of elements must follow x, y, z
order (easting, northing, altitude for coordinates in a projected coordinate
reference system, or longitude, latitude, altitude for coordinates in a
geographic coordinate reference system). Any number of additional elements
are allowed – interpretation and meaning of additional elements is beyond
the scope of this specification."

So rfc7946 GeoJSON is certainly using OAMS_TRADITIONAL_GIS_ORDER with
lon-lat coordinates or it is invalid, and it is rather safe to guess that if
coordinates are using any other CRS then the a prior arrangement is to use
lon-lat or easting-northing order as in the 2008 specification.

-Jukka Rahkonen-


Yann-Sebastien Tremblay-Johnston wrote
> Hi,
> 
> Tested using conda gdal 3.0.4 and gdal bundled with QGIS (3.0.4)
> 
> From the documented changes in gdal > 3 with respect to honouring
> coordinate order i.e. lat/lon order for EPSG:4326, I would expect that
> when
> 
> from osgeo import ogr
>> ds = ogr.Open('test.geojson')
>> layer = ds.GetLayer()
>> srs = layer.GetSpatialRef()
>> print(srs.GetAxisMappingStrategy())
> 
> 
> to yield
> 
> 1  # OAMS_AUTHORITY_COMPLIANT
> 
> 
> but it yields 0 (OAMS_TRADITIONAL_GIS_ORDER).
> I see that the wording in
> https://gdal.org/tutorials/osr_api_tut.html?highlight=coordinate%20order#crs-and-axis-order
> only
> mentions the OGR Coordinate Transformation class (w.r.t honouring axis
> order), so is the SpatialReference when reading from GeoJSON in how I've
> shown above the intended behavior? I've tried this on both a GeoJSON
> without an explicit crs designation and one with a crs
> of urn:ogc:def:crs:OGC:1.3:CRS84 and both have the same result
> (OAMS_TRADITIONAL_GIS_ORDER).
> 
> Cheers,
> 
> Sebastien
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Wed Apr 29 02:28:39 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 Apr 2020 11:28:39 +0200
Subject: [gdal-dev] Clarifying AxisMappingStrategy for SpatialReference
	read from GeoJSON in gdal > 3
In-Reply-To: <CA++BqZBP2c2oyfNeLk_dLUt_YEVk52MiO9znHSqONYerv=7scA@mail.gmail.com>
References: <CA++BqZBP2c2oyfNeLk_dLUt_YEVk52MiO9znHSqONYerv=7scA@mail.gmail.com>
Message-ID: <3905861.79W4BkgJM5@even-i700>

On mardi 28 avril 2020 16:24:32 CEST Yann-Sebastien Tremblay-Johnston wrote:
> Hi,
> 
> Tested using conda gdal 3.0.4 and gdal bundled with QGIS (3.0.4)
> 
> From the documented changes in gdal > 3 with respect to honouring
> coordinate order i.e. lat/lon order for EPSG:4326, I would expect that when
> 
> from osgeo import ogr
> 
> > ds = ogr.Open('test.geojson')
> > layer = ds.GetLayer()
> > srs = layer.GetSpatialRef()
> > print(srs.GetAxisMappingStrategy())
> 
> to yield
> 
> 1  # OAMS_AUTHORITY_COMPLIANT
> 
> 
> but it yields 0 (OAMS_TRADITIONAL_GIS_ORDER).
> I see that the wording in
> https://gdal.org/tutorials/osr_api_tut.html?highlight=coordinate%20order#crs
> -and-axis-order only
> mentions the OGR Coordinate Transformation class (w.r.t honouring axis
> order), so is the SpatialReference when reading from GeoJSON in how I've
> shown above the intended behavior? I've tried this on both a GeoJSON
> without an explicit crs designation and one with a crs
> of urn:ogc:def:crs:OGC:1.3:CRS84 and both have the same result
> (OAMS_TRADITIONAL_GIS_ORDER).

The behaviour of GDAL < 3 was implictly to honour OAMS_TRADITIONAL_GIS_ORDER when it 
returned coordinates, so GDAL 3.0 just takes act of this and all OGR drivers will return a SRS 
with OAMS_TRADITIONAL_GIS_ORDER. The only exception might be the GML driver if 
opening a dataset when the INVERT_AXIS_ORDER_IF_LAT_LONG=NO open option is set.

For GeoJSON, as the implicit authority is urn:ogc:def:crs:OGC:1.3:CRS84 which has 
longitude,latitude order, OAMS_AUTHORITY_COMPLIANT and 
OAMS_TRADITIONAL_GIS_ORDER are in practice equivalent.

Welcome to a new world of axis order confusion :-)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200429/e90b3b8d/attachment.html>

From aborruso at gmail.com  Wed Apr 29 23:11:32 2020
From: aborruso at gmail.com (aborruso)
Date: Wed, 29 Apr 2020 23:11:32 -0700 (MST)
Subject: [gdal-dev] VRT file and CSV source with strange name: "Failed to
 open datasource"
Message-ID: <1588227092273-0.post@n6.nabble.com>

Hi,
I have this source CSV that I would like to manage via VRT file

ogrinfo --debug ON
CSV:"/vsicurl_streaming/https://docs.google.com/spreadsheets/d/e/2PACX-1vTwuYdMYS7vKJnTETwycLEGPFG2pwhxIlPMeChXuluRLjApQwhzEy_gUgsw_9lVRrAmGhAHWEj9LDV7/pub?gid=0&single=true&output=csv"
"pub?gid=0&single=true&output=csv" -oo X_POSSIBLE_NAMES=LON -oo
Y_POSSIBLE_NAMES=LAT

The layer name I have is "pub?gid=0&single=true&output=csv".

But if I use this vrt file (I have escaped "&" char, and changed it in
"&amp;"

<OGRVRTDataSource>
<OGRVRTLayer name="pub?gid=0&amp;single=true&amp;output=csv">
    <SrcDataSource relativeToVRT="0">

CSV:/vsicurl_streaming/https://docs.google.com/spreadsheets/d/e/2PACX-1vTwuYdMYS7vKJnTETwycLEGPFG2pwhxIlPMeChXuluRLjApQwhzEy_gUgsw_9lVRrAmGhAHWEj9LDV7/pub?gid=0&amp;single=true&amp;output=csv
	</SrcDataSource>
    <GeometryType>wkbPoint</GeometryType>
    <LayerSRS>WGS84</LayerSRS>
    <GeometryField encoding="PointFromColumns" x="LON" y="LAT"/>
</OGRVRTLayer>
</OGRVRTDataSource>

and run "ogrinfo --debug ON input.vrt", I have

ERROR 1: Failed to open datasource
`CSV:/vsicurl_streaming/https://docs.google.com/spreadsheets/d/e/2PACX-1vTwuYdMYS7vKJnTETwycLEGPFG2pwhxIlPMeChXuluRLjApQwhzEy_gUgsw_9lVRrAmGhAHWEj9LDV7/pub?gid=0&single=true&output=csv
        '

What's wrong in my vrt file?

Thank you



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From knoonk at gmail.com  Wed Apr 29 23:22:58 2020
From: knoonk at gmail.com (=?UTF-8?B?SmVzw7pz?=)
Date: Thu, 30 Apr 2020 08:22:58 +0200
Subject: [gdal-dev] GDAL memory management
Message-ID: <CAAJsBuxp5WpiEL9+ydAAmfOg6of58gNasXJnU0h7xNC5c0j3UQ@mail.gmail.com>

Hi,

I have been working with C/C++ and GDAL with GEOS for some time now and I
have a question about GDAL memory management.

I wonder if there are any memory management options or tips to control
allocations and deallocations in the library since we are noticing
performance problems as our data increases in complexity, mainly OGR
operations (intersection, simplify).

For example, I would expect something to do the same as:
- std::allocator: http://www.cplusplus.com/reference/memory/allocator/
- CGAL allocator:
https://doc.cgal.org/latest/Manual/devman_memory_management.html
- SQLite memory allocation routines:
https://www.sqlite.org/c3ref/mem_methods.html

I have been looking for it, but GDAL is so big that maybe I missed
something.

Thanks,

Jesus Cano
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/40362a6b/attachment.html>

From even.rouault at spatialys.com  Thu Apr 30 02:24:40 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 30 Apr 2020 11:24:40 +0200
Subject: [gdal-dev] GDAL memory management
In-Reply-To: <CAAJsBuxp5WpiEL9+ydAAmfOg6of58gNasXJnU0h7xNC5c0j3UQ@mail.gmail.com>
References: <CAAJsBuxp5WpiEL9+ydAAmfOg6of58gNasXJnU0h7xNC5c0j3UQ@mail.gmail.com>
Message-ID: <7866334.rfKbkvb15Z@even-i700>

Jesús,

> 
> I have been working with C/C++ and GDAL with GEOS for some time now and I
> have a question about GDAL memory management.
> 
> I wonder if there are any memory management options or tips to control
> allocations and deallocations in the library since we are noticing
> performance problems as our data increases in complexity, mainly OGR
> operations (intersection, simplify).
> 
> For example, I would expect something to do the same as:
> - std::allocator: http://www.cplusplus.com/reference/memory/allocator/
> - CGAL allocator:
> https://doc.cgal.org/latest/Manual/devman_memory_management.html
> - SQLite memory allocation routines:
> https://www.sqlite.org/c3ref/mem_methods.html
> 
> I have been looking for it, but GDAL is so big that maybe I missed
> something.

Interaction between GDAL and GEOS is in ogr/ogrgeometry.cpp and ogr/
ogrgeometryfactory.cpp

Basically GDAL will export geometries to WKB and GEOS will instanciate its geometry object 
from it. The temporary WKB buffer created by GDAL is using CPLMalloc() that is just a 
wrapper over malloc().
GEOS will likely use standard C++ memory operators (new, vector) etc.
And ultimately GDAL will reconstruct a OGR Geometry from a GEOS WKB buffer, using a mix 
of C++ new and CPLMalloc

From the links you refering, it seems you'd want a way to use your own memory management 
routines. There's no such possibility in GDAL. CPLMalloc()/CPLRealloc()/CPLFree() could 
possibly be redirected to some callbacks.  On the C++ side, not sure what would be involved.

Are you really sure that the bottleneck you see are in memory allocations/deallocations 
themselves ? I'd expect more computational complexity to be the main limit.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/cd32fc54/attachment.html>

From even.rouault at spatialys.com  Thu Apr 30 02:31:43 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 30 Apr 2020 11:31:43 +0200
Subject: [gdal-dev] VRT file and CSV source with strange name: "Failed
	to open datasource"
In-Reply-To: <1588227092273-0.post@n6.nabble.com>
References: <1588227092273-0.post@n6.nabble.com>
Message-ID: <1741446.SAPWRDTlop@even-i700>

> and run "ogrinfo --debug ON input.vrt", I have

Works for me. On 2.4, I've had to add -ro to prevent the driver from trying first update mode 
and emitted warning/errors, but even without it, it managed to open the datasource

Tip: with the VRT you can actually put a nice layer name. Put the layer name you want in the 
name attribute of OGRVRTLayer, and add a <SrcLayer> element whose text is pub?
gid=0&amp;single=true&amp;output=csv :

<OGRVRTDataSource>
<OGRVRTLayer name="foo">
    <SrcDataSource relativeToVRT="0">CSV:/vsicurl_streaming/https://docs.google.com/
spreadsheets/d/e/
2PACX-1vTwuYdMYS7vKJnTETwycLEGPFG2pwhxIlPMeChXuluRLjApQwhzEy_gUgsw_9lVRrA
mGhAHWEj9LDV7/pub?gid=0&amp;single=true&amp;output=csv</SrcDataSource>
    <SrcLayer>pub?gid=0&amp;single=true&amp;output=csv</SrcLayer>
    <GeometryType>wkbPoint</GeometryType>
    <LayerSRS>WGS84</LayerSRS>
    <GeometryField encoding="PointFromColumns" x="LON" y="LAT"/>
</OGRVRTLayer>
</OGRVRTDataSource>

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/297b1467/attachment.html>

From even.rouault at spatialys.com  Thu Apr 30 02:34:52 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 30 Apr 2020 11:34:52 +0200
Subject: [gdal-dev] Motion: promote GDAL 3.1.0 RC2
Message-ID: <3621624.jAbUzChElj@even-i700>

Hi,

Having adressed the few issues raised about RC1, I believe RC2 is good to 
go.

Motion: promote GDAL 3.1.0 RC2 to final 3.1.0

Starting with my +1

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/07210586/attachment-0001.html>

From aborruso at gmail.com  Thu Apr 30 03:16:05 2020
From: aborruso at gmail.com (aborruso)
Date: Thu, 30 Apr 2020 03:16:05 -0700 (MST)
Subject: [gdal-dev] VRT file and CSV source with strange name: "Failed
 to open datasource"
In-Reply-To: <1741446.SAPWRDTlop@even-i700>
References: <1588227092273-0.post@n6.nabble.com> <1741446.SAPWRDTlop@even-i700>
Message-ID: <1588241765157-0.post@n6.nabble.com>

My error, I had a carriage return. I had

<SrcDataSource
relativeToVRT="0">CSV:/vsicurl_streaming/https://docs.google.com/spreadsheets/d/e/2PACX-1vTwuYdMYS7vKJnTETwycLEGPFG2pwhxIlPMeChXuluRLjApQwhzEy_gUgsw_9lVRrAmGhAHWEj9LDV7/pub?gid=0&amp;single=true&amp;output=csv
</SrcDataSource>

and not

<SrcDataSource
relativeToVRT="0">CSV:/vsicurl_streaming/https://docs.google.com/spreadsheets/d/e/2PACX-1vTwuYdMYS7vKJnTETwycLEGPFG2pwhxIlPMeChXuluRLjApQwhzEy_gUgsw_9lVRrAmGhAHWEj9LDV7/pub?gid=0&amp;single=true&amp;output=csv</SrcDataSource>

Thank you for your time



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jmckenna at gatewaygeomatics.com  Thu Apr 30 03:54:06 2020
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 30 Apr 2020 07:54:06 -0300
Subject: [gdal-dev] Motion: promote GDAL 3.1.0 RC2
In-Reply-To: <3621624.jAbUzChElj@even-i700>
References: <3621624.jAbUzChElj@even-i700>
Message-ID: <0e0ac744-8472-b41d-8ef1-619b2fbc0ae7@gatewaygeomatics.com>

On 2020-04-30 6:34 a.m., Even Rouault wrote:
> 
> Motion: promote GDAL 3.1.0 RC2 to final 3.1.0

+1 jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
https://gatewaygeo.com/

From knoonk at gmail.com  Thu Apr 30 04:27:01 2020
From: knoonk at gmail.com (=?UTF-8?B?SmVzw7pz?=)
Date: Thu, 30 Apr 2020 13:27:01 +0200
Subject: [gdal-dev] GDAL memory management
In-Reply-To: <7866334.rfKbkvb15Z@even-i700>
References: <CAAJsBuxp5WpiEL9+ydAAmfOg6of58gNasXJnU0h7xNC5c0j3UQ@mail.gmail.com>
 <7866334.rfKbkvb15Z@even-i700>
Message-ID: <CAAJsBuzLAscHLHEHbVfgjwoPh097j6tuLb5kB2B4oR0tz-=Bpg@mail.gmail.com>

Thanks for your answer, Even.

I would want that, yes, but I was prepared for the answer being no :(.

I also though computational complexity would be the problem, but I checked
with VTune and it points the other way (malloc, free, realloc). Moreover,
performance is worse each time I execute the same test in the same run, so
I think that would match some memory fragmentation or something like that.

Thanks again,

Jesús Cano

El jue., 30 abr. 2020 a las 11:24, Even Rouault (<even.rouault at spatialys.com>)
escribió:

> Jesús,
>
>
>
> >
>
> > I have been working with C/C++ and GDAL with GEOS for some time now and I
>
> > have a question about GDAL memory management.
>
> >
>
> > I wonder if there are any memory management options or tips to control
>
> > allocations and deallocations in the library since we are noticing
>
> > performance problems as our data increases in complexity, mainly OGR
>
> > operations (intersection, simplify).
>
> >
>
> > For example, I would expect something to do the same as:
>
> > - std::allocator: http://www.cplusplus.com/reference/memory/allocator/
>
> > - CGAL allocator:
>
> > https://doc.cgal.org/latest/Manual/devman_memory_management.html
>
> > - SQLite memory allocation routines:
>
> > https://www.sqlite.org/c3ref/mem_methods.html
>
> >
>
> > I have been looking for it, but GDAL is so big that maybe I missed
>
> > something.
>
>
>
> Interaction between GDAL and GEOS is in ogr/ogrgeometry.cpp and
> ogr/ogrgeometryfactory.cpp
>
>
>
> Basically GDAL will export geometries to WKB and GEOS will instanciate its
> geometry object from it. The temporary WKB buffer created by GDAL is using
> CPLMalloc() that is just a wrapper over malloc().
>
> GEOS will likely use standard C++ memory operators (new, vector) etc.
>
> And ultimately GDAL will reconstruct a OGR Geometry from a GEOS WKB
> buffer, using a mix of C++ new and CPLMalloc
>
>
>
> From the links you refering, it seems you'd want a way to use your own
> memory management routines. There's no such possibility in GDAL.
> CPLMalloc()/CPLRealloc()/CPLFree() could possibly be redirected to some
> callbacks. On the C++ side, not sure what would be involved.
>
>
>
> Are you really sure that the bottleneck you see are in memory
> allocations/deallocations themselves ? I'd expect more computational
> complexity to be the main limit.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/22cea0f8/attachment.html>

From howard at hobu.co  Thu Apr 30 08:41:52 2020
From: howard at hobu.co (Howard Butler)
Date: Thu, 30 Apr 2020 10:41:52 -0500
Subject: [gdal-dev] Motion: promote GDAL 3.1.0 RC2
In-Reply-To: <3621624.jAbUzChElj@even-i700>
References: <3621624.jAbUzChElj@even-i700>
Message-ID: <250B1C62-437F-4659-A315-F4F912BF281C@hobu.co>



> On Apr 30, 2020, at 4:34 AM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> Hi,
>  
> Having adressed the few issues raised about RC1, I believe RC2 is good to go.
>  
> Motion: promote GDAL 3.1.0 RC2 to final 3.1.0
>  
> Starting with my +1

+1 Howard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/3d405f99/attachment.html>

From norman.barker at gmail.com  Thu Apr 30 08:52:31 2020
From: norman.barker at gmail.com (Norman Barker)
Date: Thu, 30 Apr 2020 10:52:31 -0500
Subject: [gdal-dev] Motion: promote GDAL 3.1.0 RC2
In-Reply-To: <3621624.jAbUzChElj@even-i700>
References: <3621624.jAbUzChElj@even-i700>
Message-ID: <CAN_Dn-HHUf_o0F8JKKRZiKYxisw3d6meRiVddi3WQTM+X2hxpQ@mail.gmail.com>

On Thu, Apr 30, 2020 at 4:35 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
>
>
> Having adressed the few issues raised about RC1, I believe RC2 is good to
> go.
>
>
>
> Motion: promote GDAL 3.1.0 RC2 to final 3.1.0
>
>
>
> Starting with my +1
>
>
>
>
>
+1 Norman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/b9c51870/attachment.html>

From mateusz at loskot.net  Thu Apr 30 09:25:17 2020
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 30 Apr 2020 18:25:17 +0200
Subject: [gdal-dev] Motion: promote GDAL 3.1.0 RC2
In-Reply-To: <3621624.jAbUzChElj@even-i700>
References: <3621624.jAbUzChElj@even-i700>
Message-ID: <CABUeae_=M-NOL96gtW+7zN35fq48GAXOeAkWz+NYguiuRmS3cQ@mail.gmail.com>

On Thu, 30 Apr 2020 at 11:34, Even Rouault <even.rouault at spatialys.com> wrote:
>
> Having adressed the few issues raised about RC1, I believe RC2 is good to go.
> Motion: promote GDAL 3.1.0 RC2 to final 3.1.0
> Starting with my +1
> Even

+1 Mateusz

From dmorissette at mapgears.com  Thu Apr 30 09:54:34 2020
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Thu, 30 Apr 2020 12:54:34 -0400
Subject: [gdal-dev] Motion: promote GDAL 3.1.0 RC2
In-Reply-To: <3621624.jAbUzChElj@even-i700>
References: <3621624.jAbUzChElj@even-i700>
Message-ID: <35c63235-1e85-6807-1ccf-ce683b1ee0e3@mapgears.com>

On 2020-04-30 05:34, Even Rouault wrote:
> Hi,
> 
> Having adressed the few issues raised about RC1, I believe RC2 is good 
> to go.
> 
> Motion: promote GDAL 3.1.0 RC2 to final 3.1.0
> 

+1

Daniel

-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From kcwill2 at gmail.com  Thu Apr 30 12:46:08 2020
From: kcwill2 at gmail.com (Kurt Williams)
Date: Thu, 30 Apr 2020 12:46:08 -0700
Subject: [gdal-dev] Gdal and large tile sets
Message-ID: <CA+bFAFM7uk9+zyxi1i6n94ROK2tHZ3+GT5n_-=VxpUDQ7j04ZQ@mail.gmail.com>

Hi,

I'm using gdal to reproject a set of web-mercator tiles to
Quadralateralized-Spherified-Cube (QSC) for displaying data like LandSat on
a 3D globe.

With some difficulty, I got this working. My work flow is:
1 - georeference the tiles using translate
2 - build a vrt from the georeferenced tiles.
3 - use gdalwarp to reproject (this yields 6 large tif files, one for each
face of the cube).
4 - use gdal2tiles to dice up the resulting files into tiles.

My question is: how do I approach this with a very large tile set? (level 4
tiles result in almost 3GB tifs)

One idea is to use the -te parameter to limit the extent of the output of
warp so that the output is in smaller chunks, then build another vrt to
pass to gdal2tiles.
This approach would only work if warp uses the extent to limit the files
that it reads, otherwise I'll run out of memory.

Is there are better way?

Thanks in advance for any help you can offer.

Kurt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20200430/22f34426/attachment.html>

From loic at justmagic.com  Thu Apr 30 18:12:28 2020
From: loic at justmagic.com (=?utf-8?B?bG/Dr2M=?=)
Date: Fri, 1 May 2020 03:12:28 +0200
Subject: [gdal-dev] S-57 driver Generic attribute DSNM
Message-ID: <D551738C-51A9-4F06-99A2-60CFAE4D2FE5@justmagic.com>

Hello, 

After reading this documentation concerning the S-57 driver : 

https://gdal.org/drivers/vector/s57.html

I thought the attribute DSNM ( Dataset name) should be defined on all features, no ? 

But on the source code, the method S57GenerateStandardAttributes (s57featuredefns.cpp) always attaches theses standard feature attributes : 
GRUP, OBJL, RVER, AGEN, FIDN, FIDS but there is no mention of the DSNM attribute. 

Is it a mistake in the documentation? In the code? Or just a misunderstanding on my side? 

Thank you for your clarification,

-- loïc

