From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr  3 05:32:46 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 3 Apr 2017 12:32:46 +0000
Subject: [gdal-dev] GML lat-lon coverages and interoperability
Message-ID: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>

Cross posting intentionally.

TL;DR

I wonder if all projects under the OSGeo umbrella, starting from GDAL and Geoserver, could make a common agreement on not to use GridFunctions in GML coverages if they are not strictly needed. The other alternative would be to make all projects to support GML gridFunctions, and do it right.

Long story:

I have been trying to understand how GML coverages are used in JPEG 2000 and in WCS services.  So far I have understood that coverages can be very complex and GMLCOV and next generation CIS specifications are complex so that even the most nasty coverage types can be modelled. What seems to be missing from the specifications is a simple and unified way to model simple coverages, like orthophotos.
Not surprisingly my pain started from latitude-longitude or Northing-Easting axis order of some coordinate systems. The GDAL source code in https://trac.osgeo.org/gdal/browser/trunk/gdal/gcore/gdaljp2metadata.cpp is prepared to handle georeferencign by looking at

-          grid origin

-          offset vectors

-          EPSG database for handling the coordinate axis order in GML

At least in this place GDAL does not seem to be prepared in seeing gridFunctions which are defined in GML 3.2.1. With GridFunction it is possible to slide the starting point of the coverage with "startPoint", change the order and direction of grid axes with "axisOrder" and define weird sequences for data points "Linear"/"Boustrophedonic"/"Cantor-diagonal"/"Spiral"/"Morton"/"Hilbert"

With orthophoto coverages I believe that all cases could be handled with the default gridFunctions: startPoint at gml:Low, axisOrder +1 +2, sequence rule "Linear". As far as I have understood GDAL trusts that this is also what the other partners do. However, it seems that GeoServer developers have decided to handle the latitude-longitude axis flip in WCS 2.0.1 by changing the order of grid axis with a function instead of writing the offsetVectors to suit with the default +1 +2 axis order.

<gml:coverageFunction>
<gml:GridFunction>
<gml:sequenceRule axisOrder="+2 +1">Linear</gml:sequenceRule>
<gml:startPoint>0 0</gml:startPoint>
</gml:GridFunction>
</gml:coverageFunction>

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170403/3be0912b/attachment.html>

From andrea.aime at geo-solutions.it  Mon Apr  3 05:58:01 2017
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Mon, 3 Apr 2017 14:58:01 +0200
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
Message-ID: <CA+nxMTtqUUFw41qXqnWCjZ735G89Xpk=Zpm=BW7cvVidCPrX-w@mail.gmail.com>

On Mon, Apr 3, 2017 at 2:32 PM, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> With orthophoto coverages I believe that all cases could be handled with
> the default gridFunctions: startPoint at gml:Low, axisOrder +1 +2, sequence
> rule “Linear”. As far as I have understood GDAL trusts that this is also
> what the other partners do. However, it seems that GeoServer developers
> have decided to handle the latitude-longitude axis flip in WCS 2.0.1 by
> changing the order of grid axis with a function instead of writing the
> offsetVectors to suit with the default +1 +2 axis order.
>
>
>
> <gml:coverageFunction>
>
> <gml:GridFunction>
>
> <gml:sequenceRule axisOrder="+2 +1">Linear</gml:sequenceRule>
>
> <gml:startPoint>0 0</gml:startPoint>
>
> </gml:GridFunction>
>
> </gml:coverageFunction>
>

Hi Jukka,
the decision was not arbitrary, and imho, necessary.

Rasters pixels are normally represented as east/north, but OGC forces us to
describe geographic data in lat/lon order.
So how do you tell the client, "look, I'm telling you that the axis order
is north/east, but really, I'm giving you back data in east/north order
instead"?

Cheers
Andrea

-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170403/924f3eb9/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr  3 06:19:18 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 3 Apr 2017 13:19:18 +0000
Subject: [gdal-dev] GML lat-lon coverages and interoperability
Message-ID: <95f4e0ea278547f693c1258d36ff4506@C119S212VM022.msvyvi.vaha.local>

Great, first hit from Andrea. I am awaiting if Even strikes back. His creation (GDAL JP2OpenJPEG driver) writes out EPSG:4326 coverage into GML JP2 this way, without having gridFunction.

<gml:FeatureCollection
   xmlns:gml="http://www.opengis.net/gml"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlJP2Profile/1.0.0/gmlJP2Profile.xsd">
  <gml:boundedBy>
    <gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326">
      <gml:lowerCorner>61.7282236395245 24.7248340978191</gml:lowerCorner>
      <gml:upperCorner>61.7838827490233 24.8422668729657</gml:upperCorner>
    </gml:Envelope>
  </gml:boundedBy>
  <gml:featureMember>
    <gml:FeatureCollection>
      <gml:featureMember>
        <gml:RectifiedGridCoverage dimension="2" gml:id="RGC0001">
          <gml:rectifiedGridDomain>
            <gml:RectifiedGrid dimension="2">
              <gml:limits>
                <gml:GridEnvelope>
                  <gml:low>0 0</gml:low>
                  <gml:high>15517 7354</gml:high>
                </gml:GridEnvelope>
              </gml:limits>
              <gml:axisName>x</gml:axisName>
              <gml:axisName>y</gml:axisName>
              <gml:origin>
                <gml:Point gml:id="P0001" srsName="urn:ogc:def:crs:EPSG::4326">
                  <gml:pos>61.7838789652633 24.7248378815791</gml:pos>
                </gml:Point>
              </gml:origin>
              <gml:offsetVector srsName="urn:ogc:def:crs:EPSG::4326">0 7.56751998624388e-006</gml:offsetVector>
              <gml:offsetVector srsName="urn:ogc:def:crs:EPSG::4326">-7.56751998624388e-006 0</gml:offsetVector>
            </gml:RectifiedGrid>
          </gml:rectifiedGridDomain>
          <gml:rangeSet>
            <gml:File>
              <gml:rangeParameters/>
              <gml:fileName>gmljp2://codestream/0</gml:fileName>
              <gml:fileStructure>Record Interleaved</gml:fileStructure>
            </gml:File>
          </gml:rangeSet>
        </gml:RectifiedGridCoverage>
      </gml:featureMember>
    </gml:FeatureCollection>
  </gml:featureMember>
</gml:FeatureCollection>

-Jukka-

Lähettäjä: andrea.aime at gmail.com [mailto:andrea.aime at gmail.com] Puolesta Andrea Aime
Lähetetty: 3. huhtikuuta 2017 15:58
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>; geoserver-devel at lists.sourceforge.net
Aihe: Re: [gdal-dev] GML lat-lon coverages and interoperability

On Mon, Apr 3, 2017 at 2:32 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
With orthophoto coverages I believe that all cases could be handled with the default gridFunctions: startPoint at gml:Low, axisOrder +1 +2, sequence rule “Linear”. As far as I have understood GDAL trusts that this is also what the other partners do. However, it seems that GeoServer developers have decided to handle the latitude-longitude axis flip in WCS 2.0.1 by changing the order of grid axis with a function instead of writing the offsetVectors to suit with the default +1 +2 axis order.

<gml:coverageFunction>
<gml:GridFunction>
<gml:sequenceRule axisOrder="+2 +1">Linear</gml:sequenceRule>
<gml:startPoint>0 0</gml:startPoint>
</gml:GridFunction>
</gml:coverageFunction>

Hi Jukka,
the decision was not arbitrary, and imho, necessary.

Rasters pixels are normally represented as east/north, but OGC forces us to describe geographic data in lat/lon order.
So how do you tell the client, "look, I'm telling you that the axis order is north/east, but really, I'm giving you back data in east/north order instead"?

Cheers
Andrea

--
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it


AVVERTENZE AI SENSI DEL D.Lgs. 196/2003

Le informazioni contenute in questo messaggio di posta elettronica e/o nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il loro utilizzo è consentito esclusivamente al destinatario del messaggio, per le finalità indicate nel messaggio stesso. Qualora riceviate questo messaggio senza esserne il destinatario, Vi preghiamo cortesemente di darcene notizia via e-mail e di procedere alla distruzione del messaggio stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso, divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od utilizzarlo per finalità diverse, costituisce comportamento contrario ai principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for the attention and use of the named addressee(s) and may be confidential or proprietary in nature or covered by the provisions of privacy act (Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection Code).Any use not in accord with its purpose, any disclosure, reproduction, copying, distribution, or either dissemination, either whole or partial, is strictly forbidden except previous formal approval of the named addressee(s). If you are not the intended recipient, please contact immediately the sender by telephone, fax or e-mail and delete the information in this message that has been received in error. The sender does not give any warranty or accept liability as the content, accuracy or completeness of sent messages and accepts no responsibility  for changes made after they were sent or for other risks which arise as a result of e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170403/a5dcb4ee/attachment-0001.html>

From andrea.aime at geo-solutions.it  Mon Apr  3 06:30:50 2017
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Mon, 3 Apr 2017 15:30:50 +0200
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <95f4e0ea278547f693c1258d36ff4506@C119S212VM022.msvyvi.vaha.local>
References: <95f4e0ea278547f693c1258d36ff4506@C119S212VM022.msvyvi.vaha.local>
Message-ID: <CA+nxMTtB2JU+fmS0CDJHjJCiT0qvMFuqSvSB_Y7h2xfV62iDRA@mail.gmail.com>

On Mon, Apr 3, 2017 at 3:19 PM, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

>     <gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326">
>
>       <gml:lowerCorner>61.7282236395245 24.7248340978191</gml:lowerCorner>
>
>       <gml:upperCorner>61.7838827490233 24.8422668729657</gml:upperCorner>
>

Can you clarify which one is longitude and which one is latitude? :-)

It's one thing that really gets me about CITE tests too, if they wanted to
make order obvious without further specs, the
coordinates of test data could have had some values greater than 90 ;-)

Cheers
Andrea

-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170403/01cb6fbe/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr  3 06:37:52 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 3 Apr 2017 13:37:52 +0000
Subject: [gdal-dev] GML lat-lon coverages and interoperability
Message-ID: <7c97eb75ba9043e4af9b58346f5df5f3@C119S212VM022.msvyvi.vaha.local>

Hi,

Gdalinfo about my test image “4326.jp2”:

Size is 15518, 7355
Coordinate System is:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.257223563,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0],
    UNIT["degree",0.0174532925199433],
    AUTHORITY["EPSG","4326"]]
Origin = (24.724834097819130,61.783882749023277)
Pixel Size = (0.000007567519986,-0.000007567519986)
Image Structure Metadata:
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (  24.7248341,  61.7838827) ( 24d43'29.40"E, 61d47' 1.98"N)
Lower Left  (  24.7248341,  61.7282236) ( 24d43'29.40"E, 61d43'41.61"N)
Upper Right (  24.8422669,  61.7838827) ( 24d50'32.16"E, 61d47' 1.98"N)
Lower Right (  24.8422669,  61.7282236) ( 24d50'32.16"E, 61d43'41.61"N)

-Jukka-

Lähettäjä: andrea.aime at gmail.com [mailto:andrea.aime at gmail.com] Puolesta Andrea Aime
Lähetetty: 3. huhtikuuta 2017 16:31
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>; geoserver-devel at lists.sourceforge.net
Aihe: Re: [gdal-dev] GML lat-lon coverages and interoperability

On Mon, Apr 3, 2017 at 3:19 PM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
    <gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326">
      <gml:lowerCorner>61.7282236395245 24.7248340978191</gml:lowerCorner>
      <gml:upperCorner>61.7838827490233 24.8422668729657</gml:upperCorner>

Can you clarify which one is longitude and which one is latitude? :-)

It's one thing that really gets me about CITE tests too, if they wanted to make order obvious without further specs, the
coordinates of test data could have had some values greater than 90 ;-)

Cheers
Andrea

--
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it


AVVERTENZE AI SENSI DEL D.Lgs. 196/2003

Le informazioni contenute in questo messaggio di posta elettronica e/o nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il loro utilizzo è consentito esclusivamente al destinatario del messaggio, per le finalità indicate nel messaggio stesso. Qualora riceviate questo messaggio senza esserne il destinatario, Vi preghiamo cortesemente di darcene notizia via e-mail e di procedere alla distruzione del messaggio stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso, divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od utilizzarlo per finalità diverse, costituisce comportamento contrario ai principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for the attention and use of the named addressee(s) and may be confidential or proprietary in nature or covered by the provisions of privacy act (Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection Code).Any use not in accord with its purpose, any disclosure, reproduction, copying, distribution, or either dissemination, either whole or partial, is strictly forbidden except previous formal approval of the named addressee(s). If you are not the intended recipient, please contact immediately the sender by telephone, fax or e-mail and delete the information in this message that has been received in error. The sender does not give any warranty or accept liability as the content, accuracy or completeness of sent messages and accepts no responsibility  for changes made after they were sent or for other risks which arise as a result of e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170403/bf400b85/attachment-0001.html>

From even.rouault at spatialys.com  Mon Apr  3 13:03:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 03 Apr 2017 22:03:06 +0200
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <95f4e0ea278547f693c1258d36ff4506@C119S212VM022.msvyvi.vaha.local>
References: <95f4e0ea278547f693c1258d36ff4506@C119S212VM022.msvyvi.vaha.local>
Message-ID: <2355326.P0eZyzpfEi@even-i700>

On lundi 3 avril 2017 13:19:18 CEST Rahkonen Jukka (MML) wrote:
> Great, first hit from Andrea. I am awaiting if Even strikes back. 

I don't really have an opinion on this. I haven't read the relevant part of the GML or GMLCOV 
spec and I'm afraid I wouldn't understand it well. The GDAL GMLJP2 code just follows what 
the GMLJP2 spec and examples suggest, as well as data productions. Perhaps it is not 
"correct"...

> His
> creation (GDAL JP2OpenJPEG driver) writes out EPSG:4326 coverage into GML
> JP2 this way, without having gridFunction.
 
> <gml:FeatureCollection
>    xmlns:gml="http://www.opengis.net/gml"
>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>    xsi:schemaLocation="http://www.opengis.net/gml
> http://schemas.opengis.net/gml/3.1.1/profiles/gmlJP2Profile/1.0.0/gmlJP2Pro
> file.xsd">
 <gml:boundedBy>
>     <gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326">
>       <gml:lowerCorner>61.7282236395245 24.7248340978191</gml:lowerCorner>
>       <gml:upperCorner>61.7838827490233 24.8422668729657</gml:upperCorner>
>     </gml:Envelope>
>   </gml:boundedBy>
>   <gml:featureMember>
>     <gml:FeatureCollection>
>       <gml:featureMember>
>         <gml:RectifiedGridCoverage dimension="2" gml:id="RGC0001">
>           <gml:rectifiedGridDomain>
>             <gml:RectifiedGrid dimension="2">
>               <gml:limits>
>                 <gml:GridEnvelope>
>                   <gml:low>0 0</gml:low>
>                   <gml:high>15517 7354</gml:high>
>                 </gml:GridEnvelope>
>               </gml:limits>
>               <gml:axisName>x</gml:axisName>
>               <gml:axisName>y</gml:axisName>
>               <gml:origin>
>                 <gml:Point gml:id="P0001"
> srsName="urn:ogc:def:crs:EPSG::4326">
 <gml:pos>61.7838789652633
> 24.7248378815791</gml:pos> </gml:Point>
>               </gml:origin>
>               <gml:offsetVector srsName="urn:ogc:def:crs:EPSG::4326">0
> 7.56751998624388e-006</gml:offsetVector>
 <gml:offsetVector
> srsName="urn:ogc:def:crs:EPSG::4326">-7.56751998624388e-006
> 0</gml:offsetVector> </gml:RectifiedGrid>
>           </gml:rectifiedGridDomain>
>           <gml:rangeSet>
>             <gml:File>
>               <gml:rangeParameters/>
>               <gml:fileName>gmljp2://codestream/0</gml:fileName>
>               <gml:fileStructure>Record Interleaved</gml:fileStructure>
>             </gml:File>
>           </gml:rangeSet>
>         </gml:RectifiedGridCoverage>
>       </gml:featureMember>
>     </gml:FeatureCollection>
>   </gml:featureMember>
> </gml:FeatureCollection>
> 
> -Jukka-
> 
> Lähettäjä: andrea.aime at gmail.com [mailto:andrea.aime at gmail.com] Puolesta
> Andrea Aime
 Lähetetty: 3. huhtikuuta 2017 15:58
> Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
> Kopio: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org)
> <gdal-dev at lists.osgeo.org>; geoserver-devel at lists.sourceforge.net
 Aihe:
> Re: [gdal-dev] GML lat-lon coverages and interoperability
> 
> On Mon, Apr 3, 2017 at 2:32 PM, Rahkonen Jukka (MML)
> <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaito
> s.fi>> wrote:
 With orthophoto coverages I believe that all cases could be
> handled with the default gridFunctions: startPoint at gml:Low, axisOrder +1
> +2, sequence rule “Linear”. As far as I have understood GDAL trusts that
> this is also what the other partners do. However, it seems that GeoServer
> developers have decided to handle the latitude-longitude axis flip in WCS
> 2.0.1 by changing the order of grid axis with a function instead of writing
> the offsetVectors to suit with the default +1 +2 axis order. 
> <gml:coverageFunction>
> <gml:GridFunction>
> <gml:sequenceRule axisOrder="+2 +1">Linear</gml:sequenceRule>
> <gml:startPoint>0 0</gml:startPoint>
> </gml:GridFunction>
> </gml:coverageFunction>
> 
> Hi Jukka,
> the decision was not arbitrary, and imho, necessary.
> 
> Rasters pixels are normally represented as east/north, but OGC forces us to
> describe geographic data in lat/lon order.
 So how do you tell the client,
> "look, I'm telling you that the axis order is north/east, but really, I'm
> giving you back data in east/north order instead"? 
> Cheers
> Andrea
> 
> --
> ==
> GeoServer Professional Services from the experts! Visit
> http://goo.gl/it488V for more information.
> ==
> 
> Ing. Andrea Aime
> @geowolf
> Technical Lead
> 
> GeoSolutions S.A.S.
> Via di Montramito 3/A
> 55054  Massarosa (LU)
> phone: +39 0584 962313
> fax: +39 0584 1660272
> mob: +39  339 8844549
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170403/366f0cb6/attachment-0001.html>

From woodbri at swoodbridge.com  Mon Apr  3 19:05:58 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Mon, 3 Apr 2017 21:05:58 -0500
Subject: [gdal-dev] Is it possible to add new fields to a shapefile and
	populate then?
Message-ID: <53949e7e-cb05-95f7-eaa3-760dc506860b@swoodbridge.com>

Hi All,

I have a shapefile(s) and I want to read the features, generate some 
metrics about each feature and then add them to the that feature. I'm 
using python and one obvious way to to in effect create a new shapefile 
with the columns I need to add, then copy the existing shapefile to the 
new one adding the additional metrics.

I wondering if I can add the new columns to the shapefile, then do a 
read and update.

Pros and cons to these approaches? and how to do the later one if possible?

I looked at the python gdal/ogr cookbook and didn't this specific 
example. But I thinking of something along the lines of:

1. open the dataset for read/write
2. layer.CreateField() to add the new fields
3. loop through the features in the layer
4.    and use feature.SetField()
5.    and feature = None to commit the changes

will this work?

Thanks,
   -Steve

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr  3 21:37:04 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 3 Apr 2017 21:37:04 -0700 (MST)
Subject: [gdal-dev] Is it possible to add new fields to a shapefile and
 populate then?
In-Reply-To: <53949e7e-cb05-95f7-eaa3-760dc506860b@swoodbridge.com>
References: <53949e7e-cb05-95f7-eaa3-760dc506860b@swoodbridge.com>
Message-ID: <1491280624783-5315579.post@n6.nabble.com>

Stephen Woodbridge wrote
> Hi All,
> 
> I have a shapefile(s) and I want to read the features, generate some 
> metrics about each feature and then add them to the that feature. I'm 
> using python and one obvious way to to in effect create a new shapefile 
> with the columns I need to add, then copy the existing shapefile to the 
> new one adding the additional metrics.
> 
> I wondering if I can add the new columns to the shapefile, then do a 
> read and update.
> 
> Pros and cons to these approaches? and how to do the later one if
> possible?
> 
> I looked at the python gdal/ogr cookbook and didn't this specific 
> example. But I thinking of something along the lines of:
> 
> 1. open the dataset for read/write
> 2. layer.CreateField() to add the new fields
> 3. loop through the features in the layer
> 4.    and use feature.SetField()
> 5.    and feature = None to commit the changes
> 
> will this work?
> 
> Thanks,
>    -Steve

Hi,

You can demonstrate that it is possible with ogrinfo:

ogrinfo  -sql "alter table test add column foo integer" test.shp
ogrinfo  -dialect sqlite -sql "update test set foo=2" test.shp


-Jukka Rahkonen-






--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Is-it-possible-to-add-new-fields-to-a-shapefile-and-populate-then-tp5315568p5315579.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From woodbri at swoodbridge.com  Mon Apr  3 23:54:58 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Tue, 4 Apr 2017 01:54:58 -0500
Subject: [gdal-dev] Is it possible to add new fields to a shapefile and
 populate then?
In-Reply-To: <1491280624783-5315579.post@n6.nabble.com>
References: <53949e7e-cb05-95f7-eaa3-760dc506860b@swoodbridge.com>
 <1491280624783-5315579.post@n6.nabble.com>
Message-ID: <07586142-c2e4-7469-cc12-f8a2801e6005@swoodbridge.com>

On 4/3/2017 11:37 PM, jratike80 wrote:
> Stephen Woodbridge wrote
>> Hi All,
>>
>> I have a shapefile(s) and I want to read the features, generate some
>> metrics about each feature and then add them to the that feature. I'm
>> using python and one obvious way to to in effect create a new shapefile
>> with the columns I need to add, then copy the existing shapefile to the
>> new one adding the additional metrics.
>>
>> I wondering if I can add the new columns to the shapefile, then do a
>> read and update.
>>
>> Pros and cons to these approaches? and how to do the later one if
>> possible?
>>
>> I looked at the python gdal/ogr cookbook and didn't this specific
>> example. But I thinking of something along the lines of:
>>
>> 1. open the dataset for read/write
>> 2. layer.CreateField() to add the new fields
>> 3. loop through the features in the layer
>> 4.    and use feature.SetField()
>> 5.    and feature = None to commit the changes
>>
>> will this work?
>>
>> Thanks,
>>    -Steve
>
> Hi,
>
> You can demonstrate that it is possible with ogrinfo:
>
> ogrinfo  -sql "alter table test add column foo integer" test.shp
> ogrinfo  -dialect sqlite -sql "update test set foo=2" test.shp

Hi Jukka,

Ahh, good point, I always seem to forget that fact.
I have gotten the python code to add the new fields, but the data is not 
getting written to the file.

     # open the shapefile
     driver = ogr.GetDriverByName('ESRI Shapefile')
     dataSource = driver.Open(infile, 1) # open for rw
     if dataSource is None:
         print "ERROR: could not open '%s' as shapefile!" % (infile)
         sys.exit(1)

     layer = dataSource.GetLayer()
     layer.CreateField(ogr.FieldDefn("area",     ogr.OFTReal))


     for feature in layer:
         geom = feature.GetGeometryRef()
         feature.SetField("area", geom.GetArea())
         feature = None

     dataSource = None

In the cookbook example for "Create a New Shapefile and Add Data" there 
is a call to:

layer.CreateFeature(feature)

but I do not see an equivalent call for:

layer.UpdateFeature(feature)

So How do I update the feature and force the data to get written to the 
shapefile. I'm presuming the CreateFeature will append a new record 
which is not what I want.

-Steve

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr  3 23:55:55 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 4 Apr 2017 06:55:55 +0000
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <2355326.P0eZyzpfEi@even-i700>
References: <95f4e0ea278547f693c1258d36ff4506@C119S212VM022.msvyvi.vaha.local>,
 <2355326.P0eZyzpfEi@even-i700>
Message-ID: <1491288958702.87796@maanmittauslaitos.fi>

Hi,


Adding mapserver-dev to recipients in hope that Stephan Meissl notices and could share his opinion.  Mapserver WCS 2.0.1 does not generate axisOrder.


-Jukka Rahkonen-

________________________________
Lähettäjä: Even Rouault <even.rouault at spatialys.com>
Lähetetty: 3. huhtikuuta 2017 23:03
Vastaanottaja: gdal-dev at lists.osgeo.org
Kopio: Rahkonen Jukka (MML); Andrea Aime; geoserver-devel at lists.sourceforge.net
Aihe: Re: [gdal-dev] GML lat-lon coverages and interoperability


On lundi 3 avril 2017 13:19:18 CEST Rahkonen Jukka (MML) wrote:

> Great, first hit from Andrea. I am awaiting if Even strikes back.



I don't really have an opinion on this. I haven't read the relevant part of the GML or GMLCOV spec and I'm afraid I wouldn't understand it well. The GDAL GMLJP2 code just follows what the GMLJP2 spec and examples suggest, as well as data productions. Perhaps it is not "correct"...



> His

> creation (GDAL JP2OpenJPEG driver) writes out EPSG:4326 coverage into GML

> JP2 this way, without having gridFunction.

> <gml:FeatureCollection

> xmlns:gml="http://www.opengis.net/gml"

> xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

> xsi:schemaLocation="http://www.opengis.net/gml

> http://schemas.opengis.net/gml/3.1.1/profiles/gmlJP2Profile/1.0.0/gmlJP2Pro

> file.xsd">

<gml:boundedBy>

> <gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326">

> <gml:lowerCorner>61.7282236395245 24.7248340978191</gml:lowerCorner>

> <gml:upperCorner>61.7838827490233 24.8422668729657</gml:upperCorner>

> </gml:Envelope>

> </gml:boundedBy>

> <gml:featureMember>

> <gml:FeatureCollection>

> <gml:featureMember>

> <gml:RectifiedGridCoverage dimension="2" gml:id="RGC0001">

> <gml:rectifiedGridDomain>

> <gml:RectifiedGrid dimension="2">

> <gml:limits>

> <gml:GridEnvelope>

> <gml:low>0 0</gml:low>

> <gml:high>15517 7354</gml:high>

> </gml:GridEnvelope>

> </gml:limits>

> <gml:axisName>x</gml:axisName>

> <gml:axisName>y</gml:axisName>

> <gml:origin>

> <gml:Point gml:id="P0001"

> srsName="urn:ogc:def:crs:EPSG::4326">

<gml:pos>61.7838789652633

> 24.7248378815791</gml:pos> </gml:Point>

> </gml:origin>

> <gml:offsetVector srsName="urn:ogc:def:crs:EPSG::4326">0

> 7.56751998624388e-006</gml:offsetVector>

<gml:offsetVector

> srsName="urn:ogc:def:crs:EPSG::4326">-7.56751998624388e-006

> 0</gml:offsetVector> </gml:RectifiedGrid>

> </gml:rectifiedGridDomain>

> <gml:rangeSet>

> <gml:File>

> <gml:rangeParameters/>

> <gml:fileName>gmljp2://codestream/0</gml:fileName>

> <gml:fileStructure>Record Interleaved</gml:fileStructure>

> </gml:File>

> </gml:rangeSet>

> </gml:RectifiedGridCoverage>

> </gml:featureMember>

> </gml:FeatureCollection>

> </gml:featureMember>

> </gml:FeatureCollection>

>

> -Jukka-

>

> Lähettäjä: andrea.aime at gmail.com [mailto:andrea.aime at gmail.com] Puolesta

> Andrea Aime

Lähetetty: 3. huhtikuuta 2017 15:58

> Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>

> Kopio: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org)

> <gdal-dev at lists.osgeo.org>; geoserver-devel at lists.sourceforge.net

Aihe:

> Re: [gdal-dev] GML lat-lon coverages and interoperability

>

> On Mon, Apr 3, 2017 at 2:32 PM, Rahkonen Jukka (MML)

> <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaito

> s.fi>> wrote:

With orthophoto coverages I believe that all cases could be

> handled with the default gridFunctions: startPoint at gml:Low, axisOrder +1

> +2, sequence rule “Linear”. As far as I have understood GDAL trusts that

> this is also what the other partners do. However, it seems that GeoServer

> developers have decided to handle the latitude-longitude axis flip in WCS

> 2.0.1 by changing the order of grid axis with a function instead of writing

> the offsetVectors to suit with the default +1 +2 axis order.

> <gml:coverageFunction>

> <gml:GridFunction>

> <gml:sequenceRule axisOrder="+2 +1">Linear</gml:sequenceRule>

> <gml:startPoint>0 0</gml:startPoint>

> </gml:GridFunction>

> </gml:coverageFunction>

>

> Hi Jukka,

> the decision was not arbitrary, and imho, necessary.

>

> Rasters pixels are normally represented as east/north, but OGC forces us to

> describe geographic data in lat/lon order.

So how do you tell the client,

> "look, I'm telling you that the axis order is north/east, but really, I'm

> giving you back data in east/north order instead"?

> Cheers

> Andrea

>

> --

> ==

> GeoServer Professional Services from the experts! Visit

> http://goo.gl/it488V for more information.

> ==

>

> Ing. Andrea Aime

> @geowolf

> Technical Lead

>

> GeoSolutions S.A.S.

> Via di Montramito 3/A

> 55054 Massarosa (LU)

> phone: +39 0584 962313

> fax: +39 0584 1660272

> mob: +39 339 8844549

>

> http://www.geo-solutions.it

> http://twitter.com/geosolutions_it

>

>

> AVVERTENZE AI SENSI DEL D.Lgs. 196/2003

>

> Le informazioni contenute in questo messaggio di posta elettronica e/o nel/i

> file/s allegato/i sono da considerarsi strettamente riservate. Il loro

> utilizzo è consentito esclusivamente al destinatario del messaggio, per le

> finalità indicate nel messaggio stesso. Qualora riceviate questo messaggio

> senza esserne il destinatario, Vi preghiamo cortesemente di darcene notizia

> via e-mail e di procedere alla distruzione del messaggio stesso,

> cancellandolo dal Vostro sistema. Conservare il messaggio stesso,

> divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od

> utilizzarlo per finalità diverse, costituisce comportamento contrario ai

> principi dettati dal D.Lgs. 196/2003.

>

>

> The information in this message and/or attachments, is intended solely for

> the attention and use of the named addressee(s) and may be confidential or

> proprietary in nature or covered by the provisions of privacy act

> (Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection

> Code).Any use not in accord with its purpose, any disclosure, reproduction,

> copying, distribution, or either dissemination, either whole or partial, is

> strictly forbidden except previous formal approval of the named

> addressee(s). If you are not the intended recipient, please contact

> immediately the sender by telephone, fax or e-mail and delete the

> information in this message that has been received in error. The sender

> does not give any warranty or accept liability as the content, accuracy or

> completeness of sent messages and accepts no responsibility for changes

> made after they were sent or for other risks which arise as a result of

> e-mail transmission, viruses, etc.

> -------------------------------------------------------





--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170404/0f5e83af/attachment-0001.html>

From p.baumann at jacobs-university.de  Tue Apr  4 03:24:30 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Tue, 4 Apr 2017 12:24:30 +0200
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
Message-ID: <7ca9e954-dbad-7787-100a-66c980305c5b@jacobs-university.de>

Hi all,

introducing (outing) myself as the coverage standard / WCS editor.

To avoid the problems that other standards have with axis order, coverages
contain the axis order explicitly, in the axisLabels attribute. Here an example:

        <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
*axisLabels="Lat Long"* uomLabels="deg deg" srsDimension="2">
            <gml:lowerCorner>1 1</gml:lowerCorner>
            <gml:upperCorner>3 10</gml:upperCorner>
        </gml:Envelope>

The sequence in axisLabels is indicative. So it is not necessary to use
GridFunctions for this purpose. My personal opinion is that such mechanisms are
not optimal for fiddling with coordinate positions as they make it unnecessarily
difficult to determine the final pixel position. This seems to be the case here
as well.

On a side note, GMLCOV (aka CIS) 1.0 carries along some burden from GML, the
price for backwards compatibility. CIS 1.1 (just adopted) introduces a more
orthogonal coverage model in addition [1]. Among others, it allows a very
explicit modelling of the coordinate axes - see the examples.

You may want to take notice of the public Coverages.DWG OGC Wiki [2], we try to
provide useful information, and feedback / questions are possible, too.

HTH,
Peter

PS: I wonder why nobody just asked earlier by contacting me, or some list like
the (open) coverages.dwg list [3].

[1]
http://external.opengeospatial.org/twiki_public/pub/CoveragesDWG/CoveragesBigPicture/cis_1-1.zip
[2] http://external.opengeospatial.org/twiki_public/CoveragesDWG/WebHome
[3] https://lists.opengeospatial.org/mailman/listinfo/coverages.wg



On 04/03/2017 02:32 PM, Rahkonen Jukka (MML) wrote:
>
> Cross posting intentionally.
>
>  
>
> TL;DR
>
>  
>
> I wonder if all projects under the OSGeo umbrella, starting from GDAL and
> Geoserver, could make a common agreement on not to use GridFunctions in GML
> coverages if they are not strictly needed. The other alternative would be to
> make all projects to support GML gridFunctions, and do it right.
>
>  
>
> Long story:
>
>  
>
> I have been trying to understand how GML coverages are used in JPEG 2000 and
> in WCS services.  So far I have understood that coverages can be very complex
> and GMLCOV and next generation CIS specifications are complex so that even the
> most nasty coverage types can be modelled. What seems to be missing from the
> specifications is a simple and unified way to model simple coverages, like
> orthophotos.
>
> Not surprisingly my pain started from latitude-longitude or Northing-Easting
> axis order of some coordinate systems. The GDAL source code in
> https://trac.osgeo.org/gdal/browser/trunk/gdal/gcore/gdaljp2metadata.cpp is
> prepared to handle georeferencign by looking at
>
> -          grid origin
>
> -          offset vectors
>
> -          EPSG database for handling the coordinate axis order in GML
>
>  
>
> At least in this place GDAL does not seem to be prepared in seeing
> gridFunctions which are defined in GML 3.2.1. With GridFunction it is possible
> to slide the starting point of the coverage with “startPoint”, change the
> order and direction of grid axes with “axisOrder” and define weird sequences
> for data points
> "Linear"/"Boustrophedonic"/"Cantor-diagonal"/"Spiral"/"Morton"/"Hilbert"
>
>  
>
> With orthophoto coverages I believe that all cases could be handled with the
> default gridFunctions: startPoint at gml:Low, axisOrder +1 +2, sequence rule
> “Linear”. As far as I have understood GDAL trusts that this is also what the
> other partners do. However, it seems that GeoServer developers have decided to
> handle the latitude-longitude axis flip in WCS 2.0.1 by changing the order of
> grid axis with a function instead of writing the offsetVectors to suit with
> the default +1 +2 axis order.
>
>  
>
> <gml:coverageFunction>
>
> <gml:GridFunction>
>
> <gml:sequenceRule axisOrder="+2 +1">Linear</gml:sequenceRule>
>
> <gml:startPoint>0 0</gml:startPoint>
>
> </gml:GridFunction>
>
> </gml:coverageFunction>
>
>  
>
> -Jukka Rahkonen-
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170404/9bace762/attachment.html>

From kassies at gmail.com  Tue Apr  4 04:15:16 2017
From: kassies at gmail.com (Rutger)
Date: Tue, 4 Apr 2017 04:15:16 -0700 (MST)
Subject: [gdal-dev] Is it possible to add new fields to a shapefile and
 populate then?
In-Reply-To: <07586142-c2e4-7469-cc12-f8a2801e6005@swoodbridge.com>
References: <53949e7e-cb05-95f7-eaa3-760dc506860b@swoodbridge.com>
 <1491280624783-5315579.post@n6.nabble.com>
 <07586142-c2e4-7469-cc12-f8a2801e6005@swoodbridge.com>
Message-ID: <1491304516187-5315653.post@n6.nabble.com>

Stephen Woodbridge wrote
> On 4/3/2017 11:37 PM, jratike80 wrote:
>> Stephen Woodbridge wrote
> 
> Hi Jukka,
> 
> Ahh, good point, I always seem to forget that fact.
> I have gotten the python code to add the new fields, but the data is not 
> getting written to the file.
> 
>      # open the shapefile
>      driver = ogr.GetDriverByName('ESRI Shapefile')
>      dataSource = driver.Open(infile, 1) # open for rw
>      if dataSource is None:
>          print "ERROR: could not open '%s' as shapefile!" % (infile)
>          sys.exit(1)
> 
>      layer = dataSource.GetLayer()
>      layer.CreateField(ogr.FieldDefn("area",     ogr.OFTReal))
> 
> 
>      for feature in layer:
>          geom = feature.GetGeometryRef()
>          feature.SetField("area", geom.GetArea())
>          feature = None
> 
>      dataSource = None
> 
> In the cookbook example for "Create a New Shapefile and Add Data" there 
> is a call to:
> 
> layer.CreateFeature(feature)
> 
> but I do not see an equivalent call for:
> 
> layer.UpdateFeature(feature)
> 
> So How do I update the feature and force the data to get written to the 
> shapefile. I'm presuming the CreateFeature will append a new record 
> which is not what I want.
> 
> -Steve
> 
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev

Hey Stephen, 

I think you looking for "layer.SetFeature(feature)", which you can add right
before destroying the changed feature object withing your loop.


Regards,
Rutger




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Is-it-possible-to-add-new-fields-to-a-shapefile-and-populate-then-tp5315568p5315653.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From woodbri at swoodbridge.com  Tue Apr  4 07:19:00 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Tue, 4 Apr 2017 09:19:00 -0500
Subject: [gdal-dev] Is it possible to add new fields to a shapefile and
 populate then?
In-Reply-To: <1491304516187-5315653.post@n6.nabble.com>
References: <53949e7e-cb05-95f7-eaa3-760dc506860b@swoodbridge.com>
 <1491280624783-5315579.post@n6.nabble.com>
 <07586142-c2e4-7469-cc12-f8a2801e6005@swoodbridge.com>
 <1491304516187-5315653.post@n6.nabble.com>
Message-ID: <97780704-e8ad-be44-3d55-39899f505b73@swoodbridge.com>

Rutger,

Thanks, that did the trick.

-Steve

On 4/4/2017 6:15 AM, Rutger wrote:
> Stephen Woodbridge wrote
>> On 4/3/2017 11:37 PM, jratike80 wrote:
>>> Stephen Woodbridge wrote
>>
>> Hi Jukka,
>>
>> Ahh, good point, I always seem to forget that fact.
>> I have gotten the python code to add the new fields, but the data is not
>> getting written to the file.
>>
>>      # open the shapefile
>>      driver = ogr.GetDriverByName('ESRI Shapefile')
>>      dataSource = driver.Open(infile, 1) # open for rw
>>      if dataSource is None:
>>          print "ERROR: could not open '%s' as shapefile!" % (infile)
>>          sys.exit(1)
>>
>>      layer = dataSource.GetLayer()
>>      layer.CreateField(ogr.FieldDefn("area",     ogr.OFTReal))
>>
>>
>>      for feature in layer:
>>          geom = feature.GetGeometryRef()
>>          feature.SetField("area", geom.GetArea())
>>          feature = None
>>
>>      dataSource = None
>>
>> In the cookbook example for "Create a New Shapefile and Add Data" there
>> is a call to:
>>
>> layer.CreateFeature(feature)
>>
>> but I do not see an equivalent call for:
>>
>> layer.UpdateFeature(feature)
>>
>> So How do I update the feature and force the data to get written to the
>> shapefile. I'm presuming the CreateFeature will append a new record
>> which is not what I want.
>>
>> -Steve
>>
>> ---
>> This email has been checked for viruses by Avast antivirus software.
>> https://www.avast.com/antivirus
>>
>> _______________________________________________
>> gdal-dev mailing list
>
>> gdal-dev at .osgeo
>
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> Hey Stephen,
>
> I think you looking for "layer.SetFeature(feature)", which you can add right
> before destroying the changed feature object withing your loop.
>
>
> Regards,
> Rutger
>
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Is-it-possible-to-add-new-fields-to-a-shapefile-and-populate-then-tp5315568p5315653.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From bontepaarden at gmail.com  Tue Apr  4 07:16:24 2017
From: bontepaarden at gmail.com (Paul Meems)
Date: Tue, 4 Apr 2017 16:16:24 +0200
Subject: [gdal-dev] C# Calculate large rasters
Message-ID: <CAHNf2YTo4XDdEH6DvO9kjQE6hOR0roc4ViAtWViB7B-1dq15nA@mail.gmail.com>

Hi List,

I'm working on a C# application using the GDAL C#-bindings (v2.1.2).

I have a (potentially) large single band GeoTiff (>100MB).
I need to use this raster file, apply a formula and save as a new tiff.

I already figured out I can use CreateCopy to create a copy of the input
raster.
Next I need to loop through each pixel and apply the formula and at the end
Flush.

My worries are about the reading of the pixels.
I want to use:
band.ReadRaster
but is this the recommended workflow to change each pixel?
Won't I get out-of-memory issues when reading large dataset or doing
multiples on the same time?

Please advice.

And no I can't use Python or C++ ;(

Thanks,

Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170404/a335e036/attachment-0001.html>

From lucena_ivan at hotmail.com  Mon Apr  3 21:46:32 2017
From: lucena_ivan at hotmail.com (Ivan Lucena)
Date: Tue, 4 Apr 2017 04:46:32 +0000
Subject: [gdal-dev] GDALDEMProcessingOptionsNew with NULL psOptionForBinary
Message-ID: <MWHPR19MB132831901558C735BDB05AFCF20B0@MWHPR19MB1328.namprd19.prod.outlook.com>

Hi,


As it says in the documentation, when calling GDALDEMProcessingOptionsNew the argument psOptionForBinay should generally be NULL. [ http://gdal.org/gdal__utils_8h.html#ac6e67c9ca37448286a6031e626e551ae ]


And that should be the case for applications that only has access to the GDAL public API, gdal.h and gdal_utils.h.


But if psOptionForBinary is NULL, the DEM "Processing" parameter {shade,slope,aspect,...} is not passed or parsed. [ http://trac.osgeo.org/gdal/browser/trunk/gdal/apps/gdaldem_lib.cpp?rev=36538#L3891 ]


And the evaluation (eUtilityMode == HILL_SHADE) will never be true. [ http://trac.osgeo.org/gdal/browser/trunk/gdal/apps/gdaldem_lib.cpp?rev=36538#L3891 ]


That means -alt (altitude) cannot be used for hillshade processing.


In that scenario, if one tries to pass "-alt n", GDALDEMProcessingOptionsNew will return NULL and GDALDEMProcessing cannot be called.


Is that a bug or is t intentional? Any suggestion or workaround?


Thanks,

Ivan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170404/77327eb3/attachment.html>

From idan at miara.com  Wed Apr  5 00:59:07 2017
From: idan at miara.com (Idan Miara)
Date: Wed, 5 Apr 2017 10:59:07 +0300
Subject: [gdal-dev] using gdal_arrays in QGIS 2.99
In-Reply-To: <CAEDrt3_A+A35xm6qmW3KnQV0X34y3pxtmyO+ycL6Q=yqxyK9Jg@mail.gmail.com>
References: <CAEDrt3_A+A35xm6qmW3KnQV0X34y3pxtmyO+ycL6Q=yqxyK9Jg@mail.gmail.com>
Message-ID: <CAEDrt3-aErrxmqRt4vy0qf5-vwVPK9Pisk03vGvEtWBFhA++-g@mail.gmail.com>

Hi,

Did anyone have this problem? Any solution?

On 30 Mar 2017 5:08 PM, "Idan Miara" <idan at miara.com> wrote:

Hello,

I am trying to read a raster using gdal's ReadAsArray() method in python
3.6. I am using the gdal library provided in Qgis' 2.99 weekly release
(QGIS-OSGeo4W-2.99.0-9-Setup-x86_64.exe).

this sample script:

import gdal
x = gdal.Open(r'D:/Map Samples/1/DTM/n29w098d5dtm.tif')  #valid tif
y = x.ReadAsArray()
print(y)


produces this error:

Traceback (most recent call last):
  File "C:\PROGRA~1\QGIS2~1.99\apps\Python36\lib\site-packages\osgeo\gdal_array.py",
line 16, in swig_import_helper
    fp, pathname, description = imp.find_module('_gdal_array',
[dirname(__file__)])
  File "C:\PROGRA~1\QGIS2~1.99\apps\Python36\lib\imp.py", line 296, in
find_module
    raise ImportError(_ERR_MSG.format(name), name=name)
ImportError: No module named '_gdal_array'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\PROGRA~1\QGIS2~1.99\apps\Python36\lib\code.py", line 91, in
runcode
    exec(code, self.locals)
  File "<input>", line 1, in <module>
  File "<string>", line 3, in <module>
  File "C:\PROGRA~1\QGIS2~1.99\apps\Python36\lib\site-packages\osgeo\gdal.py",
line 1817, in ReadAsArray
    from . import gdalnumeric
  File "C:/PROGRA~1/QGIS2~1.99/apps/qgis-dev/./python\qgis\utils.py", line
647, in _import
    mod = _builtin_import(name, globals, locals, fromlist, level)
  File "C:\PROGRA~1\QGIS2~1.99\apps\Python36\lib\site-packages\osgeo\gdalnumeric.py",
line 1, in <module>
    from osgeo.gdal_array import *
  File "C:/PROGRA~1/QGIS2~1.99/apps/qgis-dev/./python\qgis\utils.py", line
647, in _import
    mod = _builtin_import(name, globals, locals, fromlist, level)
  File "C:\PROGRA~1\QGIS2~1.99\apps\Python36\lib\site-packages\osgeo\gdal_array.py",
line 26, in <module>
    _gdal_array = swig_import_helper()
  File "C:\PROGRA~1\QGIS2~1.99\apps\Python36\lib\site-packages\osgeo\gdal_array.py",
line 18, in swig_import_helper
    import _gdal_array
  File "C:/PROGRA~1/QGIS2~1.99/apps/qgis-dev/./python\qgis\utils.py", line
647, in _import
    mod = _builtin_import(name, globals, locals, fromlist, level)
ModuleNotFoundError: No module named '_gdal_array'


What can i do to use gdal's readAsArray method in my code?
Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170405/9a345ee5/attachment.html>

From andrea.aime at geo-solutions.it  Wed Apr  5 05:16:00 2017
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Wed, 5 Apr 2017 14:16:00 +0200
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <7ca9e954-dbad-7787-100a-66c980305c5b@jacobs-university.de>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <7ca9e954-dbad-7787-100a-66c980305c5b@jacobs-university.de>
Message-ID: <CA+nxMTu04=+k1HuZHdvX_URJHvO+PdmzN9EKihFmUoDSNNQkEQ@mail.gmail.com>

On Tue, Apr 4, 2017 at 12:24 PM, Peter Baumann <
p.baumann at jacobs-university.de> wrote:

> To avoid the problems that other standards have with axis order, coverages
> contain the axis order explicitly, in the axisLabels attribute. Here an
> example:
>
>         <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> <http://www.opengis.net/def/crs/EPSG/0/4326> *axisLabels="Lat Long"*
> uomLabels="deg deg" srsDimension="2">
>             <gml:lowerCorner>1 1</gml:lowerCorner>
>             <gml:upperCorner>3 10</gml:upperCorner>
>         </gml:Envelope>
>
> The sequence in axisLabels is indicative.
>

I'm looking at the WCS 2.0.1 core spec, all it says about the labels is:

"The attribute axisLabels is an ordered list of labels for all the axes of
this CRS". Label is a generic term, I don't see any dictionary giving
meaning to the labels.
So the following should all be equivalent to the client, or not?
<gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
axisLabels="Lat Long" uomLabels="deg deg" srsDimension="2">
<gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
axisLabels="a b" uomLabels="deg deg" srsDimension="2">
<gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
axisLabels="foo bar" uomLabels="deg deg" srsDimension="2">
<gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
axisLabels="Long Lat" uomLabels="deg deg" srsDimension="2">

I added the last on purpose, since they are just labels, they really carry
no meaning, and the axis order is still determined by the srsName instead
(thus, lat long).
Or not?


> So it is not necessary to use GridFunctions for this purpose. My personal
> opinion is that such mechanisms are not optimal for fiddling with
> coordinate positions as they make it unnecessarily difficult to determine
> the final pixel position. This seems to be the case here as well.
>

The function is there because we could not stomach the idea that "i j" in
raster space would be associated to up and right (in this order),
geographic coordinates systems have their own madness (or at least OGC
wants us to believe that) but we hoped the raster space wouldn't be
touched. If we remove the function, keep the lat/lon orientation for the
envelope, and assume pairwise matching like Jukka suggests, then this is
our raster (aka pixel) space:

[image: Inline image 2]
It can work of course.

Then, since you are here, a question about the axis order of the returned
coverages (let's assume geotiff for simplificity's sake). I am presuming
some uniformity across OGC standards, so if vector data in WGS84 is to be
returned in lat/lon order, does it makes sense to return also coverages in
the same order?
Projection unaware software displays vector data flipped when returned by a
compliant WFS 1.1 server... shouldn't it happen the same for WCS 2.0? Or
should rasters be considered somehow blessed and outside of this issue?

Cheers
Andrea

-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170405/670737d5/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 2567 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170405/670737d5/attachment-0001.png>

From jss5102 at gmail.com  Wed Apr  5 07:23:25 2017
From: jss5102 at gmail.com (jsherm)
Date: Wed, 5 Apr 2017 07:23:25 -0700 (MST)
Subject: [gdal-dev] GDALDEMProcessingOptionsNew with NULL
 psOptionForBinary
In-Reply-To: <MWHPR19MB132831901558C735BDB05AFCF20B0@MWHPR19MB1328.namprd19.prod.outlook.com>
References: <MWHPR19MB132831901558C735BDB05AFCF20B0@MWHPR19MB1328.namprd19.prod.outlook.com>
Message-ID: <1491402205395-5315911.post@n6.nabble.com>

Amusingly stumbled across this same problem this morning.  When working with
GDAL python 64 bit I cannot pass any altitude argument to
gdal.DEMProcessing() for hillshade.  Other arguments work fine, or if I set
the altitude argument = None it also functions.  However, I obviously would
prefer to use the altitude argument for hillshade.



Hillshade = gdal.DEMProcessing('hillshade.tif', DEM, 'hillshade',
combined=True, format = 'GTiff', altitude = 51, azimuth = 158)

returns the error:
Traceback (most recent call last):
  File "C:/DSWE_V2/DSWE_V2_P1_GDAL_distro_v2_dev.py", line 192, in <module>
    Hillshade = gdal.DEMProcessing('hillshade.tif', DEM, 'hillshade',
combined=True, format = 'GTiff', altitude = 51, azimuth = 158)
  File "C:\Python_64bit\lib\site-packages\osgeo\gdal.py", line 792, in
DEMProcessing
    return DEMProcessingInternal(destName, srcDS, processing, colorFilename,
opts, callback, callback_data)
  File "C:\Python_64bit\lib\site-packages\osgeo\gdal.py", line 2976, in
DEMProcessingInternal
    return _gdal.DEMProcessingInternal(*args)
TypeError: in method 'DEMProcessingInternal', argument 5 of type
'GDALDEMProcessingOptions *'

Thanks all
-Jake



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-GDALDEMProcessingOptionsNew-with-NULL-psOptionForBinary-tp5315796p5315911.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From p.baumann at jacobs-university.de  Wed Apr  5 11:17:11 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Wed, 5 Apr 2017 20:17:11 +0200
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <CA+nxMTu04=+k1HuZHdvX_URJHvO+PdmzN9EKihFmUoDSNNQkEQ@mail.gmail.com>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <7ca9e954-dbad-7787-100a-66c980305c5b@jacobs-university.de>
 <CA+nxMTu04=+k1HuZHdvX_URJHvO+PdmzN9EKihFmUoDSNNQkEQ@mail.gmail.com>
Message-ID: <58781414-2e0b-0e1f-9677-fbf81efaa221@jacobs-university.de>



On 04/05/2017 02:16 PM, Andrea Aime wrote:
> On Tue, Apr 4, 2017 at 12:24 PM, Peter Baumann <p.baumann at jacobs-university.de
> <mailto:p.baumann at jacobs-university.de>> wrote:
>
>     To avoid the problems that other standards have with axis order, coverages
>     contain the axis order explicitly, in the axisLabels attribute. Here an
>     example:
>
>
>             <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
>     <http://www.opengis.net/def/crs/EPSG/0/4326> *axisLabels="Lat Long"*
>     uomLabels="deg deg" srsDimension="2">
>                 <gml:lowerCorner>1 1</gml:lowerCorner>
>                 <gml:upperCorner>3 10</gml:upperCorner>
>             </gml:Envelope>
>
>     The sequence in axisLabels is indicative.
>
>
> I'm looking at the WCS 2.0.1 core spec, all it says about the labels is:
>
> "The attribute axisLabels is an ordered list of labels for all the axes of
> this CRS". Label is a generic term, I don't see any dictionary giving meaning
> to the labels.

srsName and axisLabels are inherited from GML 3.2.1 which says (cf comment in
geometryBasic0d1d.xsd):
"The attribute axisLabels is an ordered list of labels for all the axes of this
CRS. The gml:axisAbbrev value should be used for these axis labels, after spaces
and forbidden characters are removed. When the srsName attribute is included,
this attribute is optional. When the srsName attribute is omitted, this
attribute shall also be omitted."
In GMLCOV/CIS axisLabels is mandatory.

Purpose is to associate the EPSG CRS axes with the axes as used in the XML
document in a machine readable manner, without the ambiguities of other standards.
In CIS 1.0 this is via axisAbbrev, so quite rigid. Following long and winding
discussions with EPSG this has been changed in CIS 1.1 so that your examples 3
and 4 are allowed as well (identification by position, not by name).

> So the following should all be equivalent to the client, or not?
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="Lat Long" uomLabels="deg deg" srsDimension="2">

correct as per EPSG:4326

> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="a b" uomLabels="deg deg" srsDimension="2">
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="foo bar" uomLabels="deg deg" srsDimension="2">
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="Long Lat" uomLabels="deg deg" srsDimension="2">

all these are wrong in CIS 1.0, you _must_ use the axisAbbrev element. In CIS
1.1 ok, although the last one is misleading.

>
> I added the last on purpose, since they are just labels, they really carry no
> meaning, and the axis order is still determined by the srsName instead (thus,
> lat long).
> Or not?

srsName and axisLabels are inherited from GML 3.2.1 which says (cf comment in
geometryBasic0d1d.xsd):
"The attribute axisLabels is an ordered list of labels for all the axes of this
CRS. The gml:axisAbbrev value should be used for these axis labels, after spaces
and forbidden characters are removed. When the srsName attribute is included,
this attribute is optional. When the srsName attribute is omitted, this
attribute shall also be omitted."
In GMLCOV/CIS axisLabels is mandatory.



>  
>
>     So it is not necessary to use GridFunctions for this purpose. My personal
>     opinion is that such mechanisms are not optimal for fiddling with
>     coordinate positions as they make it unnecessarily difficult to determine
>     the final pixel position. This seems to be the case here as well.
>
>
> The function is there because we could not stomach the idea that "i j" in
> raster space would be associated to up and right (in this order), geographic
> coordinates systems have their own madness (or at least OGC wants us to
> believe that) but we hoped the raster space wouldn't be touched. If we remove
> the function, keep the lat/lon orientation for the envelope, and assume
> pairwise matching like Jukka suggests, then this is our raster (aka pixel) space:
>
> Inline image 2 
> It can work of course.
>
> Then, since you are here, a question about the axis order of the returned
> coverages (let's assume geotiff for simplificity's sake). I am presuming some
> uniformity across OGC standards,

that is the Holy Grail. In practice, groups work individually (which is somehow
understandable - it's all voluntary effort, although not desirable - I have
brought it to the doors of OGC many times that a centralized point of
coordination on the basics would be advantageous; that point could be OWS Common
which is under revision since some time - not sure what this will mean in
practice).

> so if vector data in WGS84 is to be returned in lat/lon order, does it makes
> sense to return also coverages in the same order?

as we seem to have EPSG as common ground, yes.

> Projection unaware software displays vector data flipped when returned by a
> compliant WFS 1.1 server... shouldn't it happen the same for WCS 2.0? Or
> should rasters be considered somehow blessed and outside of this issue?

I am always for harmonization (principle of least surprise in Software
Engineering), but you will find wildly varying opinions on this :)

HTH,
Peter


>
> Cheers
> Andrea
>
> -- 
> ==
> GeoServer Professional Services from the experts! Visit
> http://goo.gl/it488V for more information.
> ==
>
> Ing. Andrea Aime 
> @geowolf
> Technical Lead
>
> GeoSolutions S.A.S.
> Via di Montramito 3/A
> 55054  Massarosa (LU)
> phone: +39 0584 962313
> fax: +39 0584 1660272
> mob: +39  339 8844549
>
> http://www.geo-solutions.it
> http://twitter.com/geosolutions_it
>
> *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
>
> Le informazioni contenute in questo messaggio di posta elettronica e/o nel/i
> file/s allegato/i sono da considerarsi strettamente riservate. Il loro
> utilizzo è consentito esclusivamente al destinatario del messaggio, per le
> finalità indicate nel messaggio stesso. Qualora riceviate questo messaggio
> senza esserne il destinatario, Vi preghiamo cortesemente di darcene notizia
> via e-mail e di procedere alla distruzione del messaggio stesso, cancellandolo
> dal Vostro sistema. Conservare il messaggio stesso, divulgarlo anche in parte,
> distribuirlo ad altri soggetti, copiarlo, od utilizzarlo per finalità diverse,
> costituisce comportamento contrario ai principi dettati dal D.Lgs. 196/2003.
>
>  
>
> The information in this message and/or attachments, is intended solely for the
> attention and use of the named addressee(s) and may be confidential or
> proprietary in nature or covered by the provisions of privacy act (Legislative
> Decree June, 30 2003, no.196 - Italy's New Data Protection Code).Any use not
> in accord with its purpose, any disclosure, reproduction, copying,
> distribution, or either dissemination, either whole or partial, is strictly
> forbidden except previous formal approval of the named addressee(s). If you
> are not the intended recipient, please contact immediately the sender by
> telephone, fax or e-mail and delete the information in this message that has
> been received in error. The sender does not give any warranty or accept
> liability as the content, accuracy or completeness of sent messages and
> accepts no responsibility  for changes made after they were sent or for other
> risks which arise as a result of e-mail transmission, viruses, etc.
>
>
> -------------------------------------------------------

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170405/82491f4d/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 2567 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170405/82491f4d/attachment-0001.png>

From giuseppe.amatulli at gmail.com  Wed Apr  5 20:14:34 2017
From: giuseppe.amatulli at gmail.com (Giuseppe Amatulli)
Date: Wed, 5 Apr 2017 23:14:34 -0400
Subject: [gdal-dev] Summer School in Geocomputation - Italy - June 2017
Message-ID: <CAKoiDHKHD-yYKxTZGOCVR9fA1SYd+s2AKLJBiK6JdsN-+oZwxA@mail.gmail.com>

Dear colleagues,
There are still a limited number of seats available for the* International
Summer School* organized by Spatial Ecology (www.spatial-ecology.net)
<http://www.spatial-ecology.net/> held at the Univ. of Basilicata, in the
magnificent town Matera, Italy.

*Geocomputation using free and Open Source Software** (19th-23th June 2017)*

A 5 days intense experience opening new horizons on the use of the vast
potentials of Linux environment and the command line approach for *geo-data*
 processing using Bash, AWK, Python, GRASS, QGIS, GDAL/OGR, R, PKtools,
OpenForis. We will guide newbies and experienced GIS users who have never
used a command line terminal to a stage which will allow them to understand
and apply very advanced open source data processing routines. Our focus is
to enhance a self-learning approach. This allows participants to keep on
progressing and improving their skills in a continuously evolving
technological environment.

More information and registration:

www.spatial-ecology.net <http://www.spatial-ecology.net/upcoming-events>
www.spatial-ecology.net/upcoming-events
www.facebook.com/spatialecology > see events
twitter: @BigDataEcology

Best regards
Spatial Ecology – Team

-- 
Giuseppe Amatulli, Ph.D.

Research scientist at
Yale School of Forestry & Environmental Studies
Yale Center for Research Computing
Center for Science and Social Science Information
New Haven, 06511
Teaching: http://spatial-ecology.org
Work:  https://environment.yale.edu/profile/giuseppe-amatulli/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170405/913576e6/attachment.html>

From frederik at remote.org  Thu Apr  6 02:47:15 2017
From: frederik at remote.org (Frederik Ramm)
Date: Thu, 6 Apr 2017 11:47:15 +0200
Subject: [gdal-dev] SQLite driver hit and miss with spatial index
Message-ID: <04c9e0bd-fcda-7c10-c918-250f5127595a@remote.org>

Dear gdal folks,

TL;DR: ogrinfo uses an SQLite spatial index but ogr2ogr doesn't?

I'm debugging a performance issue with my "OSM Inspector" web site,
where I use a large number of SQLite files in Mapserver, and Mapserver
takes very long to pick the data it wants to display.

I have managed to boil the issue down to a test case where I have one
single SQLite file with one POINT geometry table. Without an index, the
file has 2.8 GB:

-rw-r--r-- 1 fred fred 2812314624 Apr  6 09:01 no-index.sqlite

The ~ 25 million points are spread across central Europe:

--------------------
% ogrinfo no-index.sqlite -al -so
INFO: Open of `no-index.sqlite'
      using driver `SQLite' successful.

Layer name: osmi_addresses_nodes_with_addresses
Geometry: Point
Feature Count: 25201411
Extent: (5.866213, 45.824860) - (24.162596, 55.115208)
--------------------

Then I created an index using ogr2ogr:

% ogr2ogr -f SQLite -dsco SPATIALITE=YES with-index.sqlite no-index.sqlite

resulting in a 5 GB file:

-rw-r--r-- 1 fred fred 5417050112 Apr  6 09:23 with-index.sqlite

(I also tried the spatialite command line and SELECT
CreateSpatialIndex(...) which yields the same result.)

My problem is that the spatial index seems not to be used by Mapserver,
and indeed not by ogr2ogr either. On the test machine which uses NVMe
disks, it takes about 35 seconds to extract a small subset using a
spatial query with ogr2ogr from the un-indexed file:

% time ogr2ogr -overwrite /tmp/blub.shp -spat 8.1 48.1 8.11 49.11
no-index.sqlite
real    0m38.226s

And it takes slightly *longer* when I use the indexed file but this
might be just measurement:

% time ogr2ogr -overwrite /tmp/blub.shp -spat 8.1 48.1 8.11 49.11
with-index.sqlite
real	0m41.575s

Obvoiusly, the index is not being used, or being used in a way that
yields zero performance gain. However, when I query my files with
ogrinfo, I see a noticeable difference between using and not using the
index:

--------------------
% time ogrinfo no-index.sqlite -spat 8.1 48.1 8.11 49.11 -al -so
INFO: Open of `no-index.sqlite'
      using driver `SQLite' successful.

Layer name: osmi_addresses_nodes_with_addresses
Geometry: Point
Feature Count: 2245
Extent: (5.866213, 45.824860) - (24.162596, 55.115208)
...
real    1m16.497s
--------------------
% time ogrinfo with-index.sqlite -spat 8.1 48.1 8.11 49.11 -al -so
INFO: Open of `with-index.sqlite'
      using driver `SQLite' successful.

Layer name: osmi_addresses_nodes_with_addresses
Geometry: Point
Feature Count: 2245
Extent: (5.866213, 45.824860) - (24.162596, 55.115208)
...
real    0m6.519s
--------------------

Even though the indexed version still needs 6 seconds, the line "Feature
Count: ..." appears practically instantly with the indexed version,
whereas it takes quite a while with the non-indexed.

Does anybody have an idea why this is so, and more importantly, how I
could get ogr2ogr to speed up (and with that, I should hope, also
Mapserver)?

(My Mapserver also uses a shapefile as a TILEINDEX telling it which
sqlite file to use for a specific request, but I think even if that adds
a performance penalty, it's not my main problem at the moment.)

(I'm also happy to hear recommendations of the sort "don't use SQLite at
all then, use <X> instead". Using shapefiles would be difficult due to
the 2 GB limit, and using PostGIS difficult because I'd spend a lot of
time importing newly generated data into PostGIS but both are not
totally ruled out.)

My environment is a run-off-the-mill Ubuntu 16.04 system with the
following versions:

GDAL 1.11.3
Spatialite 4.3.0
Mapserver 7.0.0

My test databases are available as

http://www.remote.org/frederik/tmp/no-index.sqlite.gz
http://www.remote.org/frederik/tmp/with-index.sqlite.gz

Bye
Frederik

-- 
Frederik Ramm  ##  eMail frederik at remote.org  ##  N49°00'09" E008°23'33"

From devquestions2 at gmail.com  Thu Apr  6 04:06:39 2017
From: devquestions2 at gmail.com (Charles Dosantos)
Date: Thu, 6 Apr 2017 07:06:39 -0400
Subject: [gdal-dev] configure: error: HDF4 support requested with arg
 "/usr/lib/hdf4", but neither hdf4 nor mfhdf lib found
Message-ID: <CAEm53ZRv9C5fUVcZXzq+mcBtvCf2VV6F0WTrPbEMA3ZgJMt_=Q@mail.gmail.com>

Hello,

I am trying to build gdal 2.1.3 on centos , but running into this error.
Many people have reported similar errors.
Is there any solution for it ?

hdf4 drivers build were configured using and the build seemed okay.

./configure --with-jpeg=/usr/lib/jpeglib --disable-netcdf --disable-fortran
--prefix=/usr/lib/hdf4


gdal configure command I used

: ./configure   --with-hdf4=/mnt/nfs/share1/software/hdf4 --disable-netcdf
--disable-fortran

Folder /usr/lib/hdf4/lib contains the libraries.

ls on  /usr/lib/hdf4/lib returns

libdf.a  libdf.la  libhdf4.settings  libmfhdf.a  libmfhdf.la

Thanks !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170406/e3e46dff/attachment.html>

From keith at speerit.nl  Thu Apr  6 04:25:37 2017
From: keith at speerit.nl (keith at speerit.nl)
Date: Thu, 6 Apr 2017 04:25:37 -0700 (MST)
Subject: [gdal-dev] Reading KMZ in Ogr Csharp
Message-ID: <1491477937098-5316108.post@n6.nabble.com>

Hello,

We’re using the gdal ogr csharp library to read kmz files (such as the
attached file), using the libkml driver. The code used to open the file:

OSGeo.OGR.Ogr.RegisterAll();
OSGeo.OGR.Ogr.Open(/*path to file*/, 0);

When trying to open the file, I get an error: Error parsing kml Style: No
id. When using other methods to open the file such as ogrinfo and ogr2ogr)
the same error is shown, but I can still read data from the file. When
opening the file in Google earth, the error is just ignored and my file is
displayed correctly. So I would expect the same to be possible when using
the csharp library. I tried using the Ogr.DonUseExceptions method, but this
also doesn’t help.

A style not having an ID isn’t very logical as it can’t be used. However, I
wouldn’t expect it to not do anything with the file. We receive files from
our clients and then read information from the files so it’s impossible to
check all files for these kind of errors and then fix them, especially when
they generate large files.

Is there possibly  a flag I can set to ignore style errors? Or is there
another workaround for this? If no, is it possible to implement such a
feature? 

Cheers,
Keith
testfile_nostyle.kmz
<http://osgeo-org.1560.x6.nabble.com/file/n5316108/testfile_nostyle.kmz>  



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Reading-KMZ-in-Ogr-Csharp-tp5316108.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From frederik at remote.org  Thu Apr  6 05:30:45 2017
From: frederik at remote.org (Frederik Ramm)
Date: Thu, 6 Apr 2017 14:30:45 +0200
Subject: [gdal-dev] SQLite driver hit and miss with spatial index
In-Reply-To: <04c9e0bd-fcda-7c10-c918-250f5127595a@remote.org>
References: <04c9e0bd-fcda-7c10-c918-250f5127595a@remote.org>
Message-ID: <f7cc7f0a-e31b-c746-dddb-74e65ec64925@remote.org>

Hi,

   while what I wrote in the previous post is still interesting and a
bit strange, I have meanwhile upgraded to GDAL 2 packages from the
ubuntugis-unstable repository for Xenial, and now the behaviour is as I
would expect it: The ogr2ogr -spat command *with* indexes takes
practically no time (0.05 seconds), and the -spat command *without*
index takes about 40 seconds as before.

Sorry for the noise then.

Bye
Frederik

-- 
Frederik Ramm  ##  eMail frederik at remote.org  ##  N49°00'09" E008°23'33"

From even.rouault at spatialys.com  Thu Apr  6 09:52:08 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 06 Apr 2017 18:52:08 +0200
Subject: [gdal-dev] Reading KMZ in Ogr Csharp
In-Reply-To: <1491477937098-5316108.post@n6.nabble.com>
References: <1491477937098-5316108.post@n6.nabble.com>
Message-ID: <3245431.hoQF7NOKVb@even-i700>

On jeudi 6 avril 2017 04:25:37 CEST keith at speerit.nl wrote:
> Hello,
> 
> We’re using the gdal ogr csharp library to read kmz files (such as the
> attached file), using the libkml driver. The code used to open the file:
> 
> OSGeo.OGR.Ogr.RegisterAll();
> OSGeo.OGR.Ogr.Open(/*path to file*/, 0);
> 
> When trying to open the file, I get an error: Error parsing kml Style: No
> id. When using other methods to open the file such as ogrinfo and ogr2ogr)
> the same error is shown, but I can still read data from the file. When
> opening the file in Google earth, the error is just ignored and my file is
> displayed correctly. So I would expect the same to be possible when using
> the csharp library. I tried using the Ogr.DonUseExceptions method, but this
> also doesn’t help.
> 
> A style not having an ID isn’t very logical as it can’t be used. However, I
> wouldn’t expect it to not do anything with the file. We receive files from
> our clients and then read information from the files so it’s impossible to
> check all files for these kind of errors and then fix them, especially when
> they generate large files.
> 
> Is there possibly  a flag I can set to ignore style errors? Or is there
> another workaround for this? If no, is it possible to implement such a
> feature?

No workaround that I can think of, apart from applying the fix I've just done in https://
trac.osgeo.org/gdal/ticket/6850

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170406/4cbfb590/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Apr  6 12:59:26 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 6 Apr 2017 12:59:26 -0700 (MST)
Subject: [gdal-dev] SQLite driver hit and miss with spatial index
In-Reply-To: <f7cc7f0a-e31b-c746-dddb-74e65ec64925@remote.org>
References: <04c9e0bd-fcda-7c10-c918-250f5127595a@remote.org>
 <f7cc7f0a-e31b-c746-dddb-74e65ec64925@remote.org>
Message-ID: <1491508766444-5316200.post@n6.nabble.com>

Frederik Ramm wrote
> Hi,
> 
>    while what I wrote in the previous post is still interesting and a
> bit strange, I have meanwhile upgraded to GDAL 2 packages from the
> ubuntugis-unstable repository for Xenial, and now the behaviour is as I
> would expect it: The ogr2ogr -spat command *with* indexes takes
> practically no time (0.05 seconds), and the -spat command *without*
> index takes about 40 seconds as before.
> 
> Sorry for the noise then.
> 
> Bye
> Frederik

Hi Frederik,

Did you also notice that your no-index.sqlite database is not a SpatiaLite
database but a SQLite db with FDO geometries? You can check it with ogrinfo:

ogrinfo no-index.sqlite -sql "select CheckSpatialMetadata()"

The return values are explained in the Spatilite SQL reference
http://www.gaia-gis.it/gaia-sins/spatialite-sql-latest.html

I do not know how FDO vs. Spatialite speeds differ in non-indexed searches
but I guess you prefer making controlled tests by change only one thing at a
time.

-Jukka Rahkonen-




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-SQLite-driver-hit-and-miss-with-spatial-index-tp5316090p5316200.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jan.heckman at gmail.com  Thu Apr  6 14:28:13 2017
From: jan.heckman at gmail.com (Jan Heckman)
Date: Thu, 6 Apr 2017 23:28:13 +0200
Subject: [gdal-dev] SQLite driver hit and miss with spatial index
In-Reply-To: <f7cc7f0a-e31b-c746-dddb-74e65ec64925@remote.org>
References: <04c9e0bd-fcda-7c10-c918-250f5127595a@remote.org>
 <f7cc7f0a-e31b-c746-dddb-74e65ec64925@remote.org>
Message-ID: <CAKMUAtAvVSoP4rcDJ7_j-hX=YbNS67e39s83CJVFFRUz-VoTkA@mail.gmail.com>

Hi,
Out of interest, I tried the tack of converting to shapefile with a .dbf
only containing the primary index OGC_FID.
This might provide an alternative for indexed access to the geometry. I see
it isn't needed anymore, but anyway,
for info and comparison:
What worked:
- shapefile record count 25201411 agrees with sqlite table.
- shapefile size (.shp): 672 MB (recordcount * 28 + 100).
- shapefile index (.sbn): 194 MB. That's quite a bit more compact than the
spatialite index?
- apparently immediate response when zooming in or inquiring by clicking
(did not measure response time accurately)
What went wrong:
- could not select the primary index for conversion using ogr2ogr ...
-select OGC_FID ...
- Got incomplete conversion when using spatialite_gui with spatiaLite
version 4.3.0.a, conversion to DBF.
  recordcount of the conversion: 19927604

This using OSGEOW prompt of Qgis 2.18.0 (with GDAL 2.1.1, released
2016/07/07), on a windows 7 machine.

Perhaps worthwhile to use the (no-index.sqlite) dataset to look into the
conversion.
Error trying to convert to shapefile with OGC_FID:
F:\>ogr2ogr -f "ESRI Shapefile" -nlt POINT -select OGC_FID test.shp
j:/downloads/no-index.sqlite
ERROR 1: Field 'OGC_FID' not found in source layer.
ERROR 1: Terminating translation prematurely after failed
translation of layer osmi_addresses_nodes_with_addresses (use -skipfailures
to skip errors)

Is the OGC_FID primary index identical to a shapefile FID, that is, not in
the table, but really a counter?
So, I'm not sure I can properly link points to the sqlite data, but
otherwise it looks doable.
Jan

On Thu, Apr 6, 2017 at 2:30 PM, Frederik Ramm <frederik at remote.org> wrote:

> Hi,
>
>    while what I wrote in the previous post is still interesting and a
> bit strange, I have meanwhile upgraded to GDAL 2 packages from the
> ubuntugis-unstable repository for Xenial, and now the behaviour is as I
> would expect it: The ogr2ogr -spat command *with* indexes takes
> practically no time (0.05 seconds), and the -spat command *without*
> index takes about 40 seconds as before.
>
> Sorry for the noise then.
>
> Bye
> Frederik
>
> --
> Frederik Ramm  ##  eMail frederik at remote.org  ##  N49°00'09" E008°23'33"
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170406/0f999e28/attachment.html>

From keith at speerit.nl  Fri Apr  7 00:45:30 2017
From: keith at speerit.nl (keith at speerit.nl)
Date: Fri, 7 Apr 2017 00:45:30 -0700 (MST)
Subject: [gdal-dev] Reading KMZ in Ogr Csharp
In-Reply-To: <3245431.hoQF7NOKVb@even-i700>
References: <1491477937098-5316108.post@n6.nabble.com>
 <3245431.hoQF7NOKVb@even-i700>
Message-ID: <1491551130397-5316258.post@n6.nabble.com>

Thank you very much, I really appreciate it.

Cheers,
Keith



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Reading-KMZ-in-Ogr-Csharp-tp5316108p5316258.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From matt.rigal at googlemail.com  Fri Apr  7 03:21:25 2017
From: matt.rigal at googlemail.com (Matthieu Rigal)
Date: Fri, 7 Apr 2017 12:21:25 +0200
Subject: [gdal-dev] Installing GDAL with Mongo support from Brew on Mac OSX
Message-ID: <CANygOGNXTO1tTW=Uqwq-L1a5ue7KKF2ONoDrNuBPXY-jpjUjDQ@mail.gmail.com>

Hi guys,

I know it is slightly out of the scope of this mailing list, but I tried
some time ago to make a small enhancement to Brew to support the build
including the Mongo driver and I'm stucked at a point with libboost.

If anybody of you had the chance to take a look and give a hint to
https://github.com/OSGeo/homebrew-osgeo4mac/pull/184 it would be highly
appreciated and I could finish this Pull Request.

Best,
Matthieu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170407/43300397/attachment.html>

From woodbri at swoodbridge.com  Fri Apr  7 13:59:49 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Fri, 7 Apr 2017 15:59:49 -0500
Subject: [gdal-dev] I can't get ogr2ogr to overwrite an existing table
Message-ID: <d249e8f0-9f33-df83-841c-b7fa868d9fb9@swoodbridge.com>

Hi all,

I'm having trouble figuring out how to overwrite an existing table with 
ogr2ogr. I have tried various combos of arguments without success.

What am I doing wrong?

ogr2ogr -t_srs EPSG:4326 -nln roads -nlt PROMOTE_TO_MULTI -f PostgreSQL 
-overwrite -lco OVERWRITE=YES -lco PRECISION=NO -lco GEOMETRY_NAME=geom 
-lco FID=gid "PG:dbname=buildings host=localhost port=5435 user=postgres 
active_schema=census" /data/census/tmp-10195/tl_2016_06013_roads.shp

ERROR 1: CREATE TABLE "census"."roads" ( "gid" SERIAL, PRIMARY KEY ("gid") )
ERROR:  relation "roads" already exists

ERROR 1: Terminating translation prematurely after failed
translation of layer tl_2016_06013_roads (use -skipfailures to skip errors)


ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f 
PostgreSQL -overwrite -lco OVERWRITE=YES -lco PRECISION=NO -lco 
GEOMETRY_NAME=geom -lco FID=gid "PG:dbname=buildings host=localhost 
port=5435 user=postgres" /data/census/tmp-10747/tl_2016_06013_roads.shp

ERROR 1: CREATE TABLE "census"."roads" ( "gid" SERIAL, PRIMARY KEY ("gid") )
ERROR:  relation "roads" already exists

ERROR 1: Terminating translation prematurely after failed
translation of layer tl_2016_06013_roads (use -skipfailures to skip errors)

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From matt.gregory at oregonstate.edu  Fri Apr  7 14:41:17 2017
From: matt.gregory at oregonstate.edu (Gregory, Matthew)
Date: Fri, 7 Apr 2017 21:41:17 +0000
Subject: [gdal-dev] multiple processor compile option for build on Windows
Message-ID: <7C48E40C135D314BA03D6471A6E38978F21A39F0@EX1.oregonstate.edu>

Hi all,

I do a funky build of GDAL where I'm still using the ArcInfo write driver (GIO) from way back.  As part of that build, I need to use a '#import' statement to get information for ESRI's type libraries.  I build on Windows using VC9, but I'm guessing any later version of VC may have similar issues.

At SVN revision 37673, the nnmake.opt was updated to allow GDAL to build with multiple processors (/MP flag).  Apparently this causes issues when one has #import statements in the code (error C2813).  I'm wondering if it's possible to change the nnmake.opt file to specify whether or not to use multiple processors in building, e.g:

!IFDEF BUILD_MULT_PROC
CXX_MULT_PROC_FLAG=/MP
!ELSE
CXX_MULT_PROC_FLAG=
!ENDIF

and then below,

OPTFLAGS= $(CXX_ANALYZE_FLAGS) $(CXX_PDB_FLAGS) $(CXX_MULT_PROC_FLAG) /nologo /MD /EHsc /Ox /FC /D_CRT_SECURE_NO_DEPRECATE /D_CRT_NONSTDC_NO_DEPRECATE /DNDEBUG

Would this cause any issues?  Or, if there's a better way for me personally to handle it, I'm all ears.

thanks, matt

From sault.don at gmail.com  Fri Apr  7 15:46:38 2017
From: sault.don at gmail.com (Saulteau Don)
Date: Fri, 7 Apr 2017 15:46:38 -0700
Subject: [gdal-dev] I can't get ogr2ogr to overwrite an existing table
In-Reply-To: <d249e8f0-9f33-df83-841c-b7fa868d9fb9@swoodbridge.com>
References: <d249e8f0-9f33-df83-841c-b7fa868d9fb9@swoodbridge.com>
Message-ID: <CAJo0jfOjdWrxauUvh-iyN19bEbcMpkdCoLutvn5h7_-2uUZV_g@mail.gmail.com>

just a guess, thinking off the top of my head but does it need the -update
flag too?

On Fri, Apr 7, 2017 at 1:59 PM, Stephen Woodbridge <woodbri at swoodbridge.com>
wrote:

> Hi all,
>
> I'm having trouble figuring out how to overwrite an existing table with
> ogr2ogr. I have tried various combos of arguments without success.
>
> What am I doing wrong?
>
> ogr2ogr -t_srs EPSG:4326 -nln roads -nlt PROMOTE_TO_MULTI -f PostgreSQL
> -overwrite -lco OVERWRITE=YES -lco PRECISION=NO -lco GEOMETRY_NAME=geom
> -lco FID=gid "PG:dbname=buildings host=localhost port=5435 user=postgres
> active_schema=census" /data/census/tmp-10195/tl_2016_06013_roads.shp
>
> ERROR 1: CREATE TABLE "census"."roads" ( "gid" SERIAL, PRIMARY KEY ("gid")
> )
> ERROR:  relation "roads" already exists
>
> ERROR 1: Terminating translation prematurely after failed
> translation of layer tl_2016_06013_roads (use -skipfailures to skip errors)
>
>
> ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f
> PostgreSQL -overwrite -lco OVERWRITE=YES -lco PRECISION=NO -lco
> GEOMETRY_NAME=geom -lco FID=gid "PG:dbname=buildings host=localhost
> port=5435 user=postgres" /data/census/tmp-10747/tl_2016_06013_roads.shp
>
> ERROR 1: CREATE TABLE "census"."roads" ( "gid" SERIAL, PRIMARY KEY ("gid")
> )
> ERROR:  relation "roads" already exists
>
> ERROR 1: Terminating translation prematurely after failed
> translation of layer tl_2016_06013_roads (use -skipfailures to skip errors)
>
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170407/84acc537/attachment.html>

From even.rouault at spatialys.com  Sat Apr  8 09:29:24 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 08 Apr 2017 18:29:24 +0200
Subject: [gdal-dev] I can't get ogr2ogr to overwrite an existing table
In-Reply-To: <d249e8f0-9f33-df83-841c-b7fa868d9fb9@swoodbridge.com>
References: <d249e8f0-9f33-df83-841c-b7fa868d9fb9@swoodbridge.com>
Message-ID: <3537971.LYKLcIK8OF@even-i700>

On vendredi 7 avril 2017 15:59:49 CEST Stephen Woodbridge wrote:
> Hi all,
> 
> I'm having trouble figuring out how to overwrite an existing table with
> ogr2ogr. I have tried various combos of arguments without success.
> 
> What am I doing wrong?

I'm not sure. Similar requests work for me with GDAL 2.1. Maybe try to manually drop the 
table (if it is a table...)

Seeing the 'CREATE TABLE "census"."roads" ( "gid" SERIAL, PRIMARY KEY ("gid") )' statement, 
it makes me wonder if you are not using an older GDAL version (Newer versions will issue a 
CREATE TABLE with all columns) that might have trouble with overwriting existing tables and 
schemas. 

Note for everyone: please mention the version you are using.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170408/524d3689/attachment.html>

From woodbri at swoodbridge.com  Sat Apr  8 09:40:42 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Sat, 8 Apr 2017 12:40:42 -0400
Subject: [gdal-dev] I can't get ogr2ogr to overwrite an existing table
In-Reply-To: <3537971.LYKLcIK8OF@even-i700>
References: <d249e8f0-9f33-df83-841c-b7fa868d9fb9@swoodbridge.com>
 <3537971.LYKLcIK8OF@even-i700>
Message-ID: <1204a477-f1e0-da0a-16fa-8a20ff7d63b0@swoodbridge.com>

On 4/8/2017 12:29 PM, Even Rouault wrote:
> On vendredi 7 avril 2017 15:59:49 CEST Stephen Woodbridge wrote:
> 
>  > Hi all,
> 
>  >
> 
>  > I'm having trouble figuring out how to overwrite an existing table with
> 
>  > ogr2ogr. I have tried various combos of arguments without success.
> 
>  >
> 
>  > What am I doing wrong?
> 
> I'm not sure. Similar requests work for me with GDAL 2.1. Maybe try to 
> manually drop the table (if it is a table...)
> 
> Seeing the 'CREATE TABLE "census"."roads" ( "gid" SERIAL, PRIMARY KEY 
> ("gid") )' statement, it makes me wonder if you are not using an older 
> GDAL version (Newer versions will issue a CREATE TABLE with all columns) 
> that might have trouble with overwriting existing tables and schemas.
> 
> Note for everyone: please mention the version you are using.

Sorry, I know that:

$ ogrinfo --version
GDAL 1.10.1, released 2013/08/26

on Ubuntu 14.04.5 LTS

ok, it is not as convenient but I can drop the table rather than rely on 
-overwrite.

Thanks,
   -Steve

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Sat Apr  8 09:41:55 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 08 Apr 2017 18:41:55 +0200
Subject: [gdal-dev] multiple processor compile option for build on
	Windows
In-Reply-To: <7C48E40C135D314BA03D6471A6E38978F21A39F0@EX1.oregonstate.edu>
References: <7C48E40C135D314BA03D6471A6E38978F21A39F0@EX1.oregonstate.edu>
Message-ID: <2510218.gfj7hEnKkf@even-i700>

On vendredi 7 avril 2017 21:41:17 CEST Gregory, Matthew wrote:
> Hi all,
> 
> I do a funky build of GDAL where I'm still using the ArcInfo write driver
> (GIO) from way back. 

Woo, first time I hear about that one. Doing some archeology, is it this thing that was 
removed 11 years ago per
https://trac.osgeo.org/gdal/browser/trunk/frmts/aigrid/giodataset.cpp?rev=4312 ?

> As part of that build, I need to use a '#import'
> statement to get information for ESRI's type libraries.  

I don't see any #import in the above file. I guess you might have customized it.

> I build on Windows
> using VC9, but I'm guessing any later version of VC may have similar
> issues.
> 
> At SVN revision 37673, the nnmake.opt was updated to allow GDAL to build
> with multiple processors (/MP flag).  Apparently this causes issues when
> one has #import statements in the code (error C2813).  I'm wondering if
> it's possible to change the nnmake.opt file to specify whether or not to
> use multiple processors in building, e.g:
> 
> !IFDEF BUILD_MULT_PROC
> CXX_MULT_PROC_FLAG=/MP
> !ELSE
> CXX_MULT_PROC_FLAG=
> !ENDIF
> 
> and then below,
> 
> OPTFLAGS= $(CXX_ANALYZE_FLAGS) $(CXX_PDB_FLAGS) $(CXX_MULT_PROC_FLAG)
> /nologo /MD /EHsc /Ox /FC /D_CRT_SECURE_NO_DEPRECATE
> /D_CRT_NONSTDC_NO_DEPRECATE /DNDEBUG
> 
> Would this cause any issues?  Or, if there's a better way for me personally
> to handle it, I'm all ears.

If you're the only one to experiment this issue, I'd prefer if you submit a patch that would use 
a IFNDEF DISABLE_MULT_PROC to disable only when requested by the user in its nmake.local

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170408/f2909f03/attachment-0001.html>

From chrislloyd2 at yahoo.co.uk  Sun Apr  9 08:38:58 2017
From: chrislloyd2 at yahoo.co.uk (CTL101)
Date: Sun, 9 Apr 2017 08:38:58 -0700 (MST)
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with large
	sqlite input
Message-ID: <1491752338527-5316545.post@n6.nabble.com>

Hi, I am attempting the following ogr2ogr sql intersect operation using gdal
2.1.3 at command line, and an input sqlite file that is 2.51GB in size. The
program has been running for a few days and seems to be processing, but is
very slow. The output file size is not incrementing as it does with small
test excerpts of the file. Has the program crashed? And how might I improve
performance? I have experimented with the -gt and --config cache options
somewhat.

ogr2ogr -gt 65536 -nlt PROMOTE_TO_MULTI25D --config OGR_SQLITE_CACHE 20480
-f SQLite -dsco SPATIALITE=YES output.sqlite input.sqlite -nln output
-dialect sqlite -sql "SELECT ST_Intersection(A.geometry, B.geometry) AS
geometry, A.name, B.name FROM inputtable1 A, inputtable2 B WHERE
ST_Intersects(A.geometry, B.geometry)"

Any advice appreciated. Regards, Chris



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From woodbri at swoodbridge.com  Sun Apr  9 10:34:38 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Sun, 9 Apr 2017 13:34:38 -0400
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <1491752338527-5316545.post@n6.nabble.com>
References: <1491752338527-5316545.post@n6.nabble.com>
Message-ID: <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>

On 4/9/2017 11:38 AM, CTL101 wrote:
> Hi, I am attempting the following ogr2ogr sql intersect operation using gdal
> 2.1.3 at command line, and an input sqlite file that is 2.51GB in size. The
> program has been running for a few days and seems to be processing, but is
> very slow. The output file size is not incrementing as it does with small
> test excerpts of the file. Has the program crashed? And how might I improve
> performance? I have experimented with the -gt and --config cache options
> somewhat.
> 
> ogr2ogr -gt 65536 -nlt PROMOTE_TO_MULTI25D --config OGR_SQLITE_CACHE 20480
> -f SQLite -dsco SPATIALITE=YES output.sqlite input.sqlite -nln output
> -dialect sqlite -sql "SELECT ST_Intersection(A.geometry, B.geometry) AS
> geometry, A.name, B.name FROM inputtable1 A, inputtable2 B WHERE
> ST_Intersects(A.geometry, B.geometry)"
> 
> Any advice appreciated. Regards, Chris

Do you have spatial indexes on both tables?

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From chrislloyd2 at yahoo.co.uk  Sun Apr  9 10:54:13 2017
From: chrislloyd2 at yahoo.co.uk (CTL101)
Date: Sun, 9 Apr 2017 10:54:13 -0700 (MST)
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
Message-ID: <1491760453548-5316552.post@n6.nabble.com>

Hi Stephen, thanks for responding. Yes I do have spatial indexes as prior
processing was filtering using ogr2ogr to select desired rows in the table
for subsequent processing. It is my understanding that ogr2ogr defaults to
producing these spatial indexes unless specifically instructed not to.

Best regards, Chris



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545p5316552.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Sun Apr  9 13:02:19 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Sun, 9 Apr 2017 13:02:19 -0700 (MST)
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <1491760453548-5316552.post@n6.nabble.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
Message-ID: <1491768139924-5316555.post@n6.nabble.com>

CTL101 wrote
> Hi Stephen, thanks for responding. Yes I do have spatial indexes as prior
> processing was filtering using ogr2ogr to select desired rows in the table
> for subsequent processing. It is my understanding that ogr2ogr defaults to
> producing these spatial indexes unless specifically instructed not to.

Hi,

Spatialite does not have a real spatial index that generally just works
transparently. GDAL is clever enough for utilizing spatial index in trivial
cases like when ogr2ogr is used with the -spat option. However, I am pretty
sure that you must enhance your query with a hand written subquery that
select rowids from the virtual SpatialIndex. I guess it can be a bit tricky
and require some thinking and testing. I would follow the example from
https://www.gaia-gis.it/fossil/libspatialite/wiki?name=SpatialIndex and test
it with a simplified version of your query first.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545p5316555.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From kkondo at jp.fujitsu.com  Sun Apr  9 19:33:38 2017
From: kkondo at jp.fujitsu.com (Kondou, Kentarou)
Date: Mon, 10 Apr 2017 02:33:38 +0000
Subject: [gdal-dev] gnm_wrap.cpp missing in GDAL-2.1.3
Message-ID: <60E62A7E-4392-4C5F-9179-0D5CAD34007D@jp.fujitsu.com>

Hello,

gnm_wrap.cpp is missing in GDAL-2.1.3.tar.gz on https://pypi.python.org/pypi/GDAL:
  https://pypi.python.org/packages/36/d7/f89ac1347185db56939c156330efbfa2e3be560060b74e31f41e514ee627/GDAL-2.1.3.tar.gz

This caused the following error when building osgeo._gnm extension:

> python -c import setuptools... --no-user-cfg install --prefix=/usr/local/Cel
> :
> :
> building 'osgeo._gnm' extension
> clang -fno-strict-aliasing -fno-common -dynamic -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -Wno-error=unused-command-line-argument-hard-error-in-future -I/usr/local/include -I/usr/local/opt/openssl/include -I/usr/local/opt/sqlite/include -I/usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/include/python2.7 -I/usr/local/lib/python2.7/site-packages/numpy/core/include -I/usr/local/Cellar/gdal2/2.1.3_2/include -c extensions/gnm_wrap.cpp -o build/temp.macosx-10.11-x86_64-2.7/extensions/gnm_wrap.o
> clang: error: no such file or directory: 'extensions/gnm_wrap.cpp'
> clang: error: no input files
> error: command 'clang' failed with exit status 1

—————————————————————————————————

Ken Kondo




From even.rouault at spatialys.com  Mon Apr 10 01:30:31 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 10 Apr 2017 10:30:31 +0200
Subject: [gdal-dev] gnm_wrap.cpp missing in GDAL-2.1.3
In-Reply-To: <60E62A7E-4392-4C5F-9179-0D5CAD34007D@jp.fujitsu.com>
References: <60E62A7E-4392-4C5F-9179-0D5CAD34007D@jp.fujitsu.com>
Message-ID: <1908463.Koh3kkL2tN@even-i700>

Hi,

> 
> gnm_wrap.cpp is missing in GDAL-2.1.3.tar.gz on
> https://pypi.python.org/pypi/GDAL:
> https://pypi.python.org/packages/36/d7/f89ac1347185db56939c156330efbfa2e3be
> 560060b74e31f41e514ee627/GDAL-2.1.3.tar.gz 
> This caused the following error when building osgeo._gnm extension:

In GDAL 2.1, GNM was disabled by default, so the generated bindings don't include 
gnm_wrap.cpp
Either rebuild your GDAL --without-gnm, or regenerate the Python bindings so 
gnm_wrap.cpp is generated.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/e5263c51/attachment.html>

From andrea.aime at geo-solutions.it  Mon Apr 10 06:06:55 2017
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Mon, 10 Apr 2017 15:06:55 +0200
Subject: [gdal-dev] GML lat-lon coverages and interoperability
In-Reply-To: <58781414-2e0b-0e1f-9677-fbf81efaa221@jacobs-university.de>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <7ca9e954-dbad-7787-100a-66c980305c5b@jacobs-university.de>
 <CA+nxMTu04=+k1HuZHdvX_URJHvO+PdmzN9EKihFmUoDSNNQkEQ@mail.gmail.com>
 <58781414-2e0b-0e1f-9677-fbf81efaa221@jacobs-university.de>
Message-ID: <CA+nxMTsFYO=EFKxH20x-5DjjLtEF1QDedAwp3DZu9UbPWaz=fw@mail.gmail.com>

Hi,
sorry I lost track of the subject. So, to close up, and approach where the
envelope is reported as "lat lon" and the "i j" raster space
axis would map pairwise, so i pointing north-wards and j east-wards, would
be considered valid?
E.g., if one rescaling says "i is going to be 200 pixels" it really means
the output image will be 200 pixels tall?

Cheers
Andrea


On Wed, Apr 5, 2017 at 8:17 PM, Peter Baumann <
p.baumann at jacobs-university.de> wrote:

>
>
> On 04/05/2017 02:16 PM, Andrea Aime wrote:
>
> On Tue, Apr 4, 2017 at 12:24 PM, Peter Baumann <
> p.baumann at jacobs-university.de> wrote:
>
>> To avoid the problems that other standards have with axis order,
>> coverages contain the axis order explicitly, in the axisLabels attribute.
>> Here an example:
>>
>>         <gml:Envelope srsName="http://www.opengis.ne
>> t/def/crs/EPSG/0/4326" <http://www.opengis.net/def/crs/EPSG/0/4326> *axisLabels="Lat
>> Long"* uomLabels="deg deg" srsDimension="2">
>>             <gml:lowerCorner>1 1</gml:lowerCorner>
>>             <gml:upperCorner>3 10</gml:upperCorner>
>>         </gml:Envelope>
>>
>> The sequence in axisLabels is indicative.
>>
>
> I'm looking at the WCS 2.0.1 core spec, all it says about the labels is:
>
> "The attribute axisLabels is an ordered list of labels for all the axes of
> this CRS". Label is a generic term, I don't see any dictionary giving
> meaning to the labels.
>
>
> srsName and axisLabels are inherited from GML 3.2.1 which says (cf comment
> in geometryBasic0d1d.xsd):
> "The attribute axisLabels is an ordered list of labels for all the axes of
> this CRS. The gml:axisAbbrev value should be used for these axis labels,
> after spaces and forbidden characters are removed. When the srsName
> attribute is included, this attribute is optional. When the srsName
> attribute is omitted, this attribute shall also be omitted."
> In GMLCOV/CIS axisLabels is mandatory.
>
> Purpose is to associate the EPSG CRS axes with the axes as used in the XML
> document in a machine readable manner, without the ambiguities of other
> standards.
> In CIS 1.0 this is via axisAbbrev, so quite rigid. Following long and
> winding discussions with EPSG this has been changed in CIS 1.1 so that your
> examples 3 and 4 are allowed as well (identification by position, not by
> name).
>
> So the following should all be equivalent to the client, or not?
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="Lat Long" uomLabels="deg deg" srsDimension="2">
>
>
> correct as per EPSG:4326
>
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="a b" uomLabels="deg deg" srsDimension="2">
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="foo bar" uomLabels="deg deg" srsDimension="2">
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/4326"
> axisLabels="Long Lat" uomLabels="deg deg" srsDimension="2">
>
>
> all these are wrong in CIS 1.0, you _must_ use the axisAbbrev element. In
> CIS 1.1 ok, although the last one is misleading.
>
>
> I added the last on purpose, since they are just labels, they really carry
> no meaning, and the axis order is still determined by the srsName instead
> (thus, lat long).
> Or not?
>
>
> srsName and axisLabels are inherited from GML 3.2.1 which says (cf comment
> in geometryBasic0d1d.xsd):
> "The attribute axisLabels is an ordered list of labels for all the axes of
> this CRS. The gml:axisAbbrev value should be used for these axis labels,
> after spaces and forbidden characters are removed. When the srsName
> attribute is included, this attribute is optional. When the srsName
> attribute is omitted, this attribute shall also be omitted."
> In GMLCOV/CIS axisLabels is mandatory.
>
>
>
>
>
>> So it is not necessary to use GridFunctions for this purpose. My personal
>> opinion is that such mechanisms are not optimal for fiddling with
>> coordinate positions as they make it unnecessarily difficult to determine
>> the final pixel position. This seems to be the case here as well.
>>
>
> The function is there because we could not stomach the idea that "i j" in
> raster space would be associated to up and right (in this order),
> geographic coordinates systems have their own madness (or at least OGC
> wants us to believe that) but we hoped the raster space wouldn't be
> touched. If we remove the function, keep the lat/lon orientation for the
> envelope, and assume pairwise matching like Jukka suggests, then this is
> our raster (aka pixel) space:
>
> [image: Inline image 2]
> It can work of course.
>
> Then, since you are here, a question about the axis order of the returned
> coverages (let's assume geotiff for simplificity's sake). I am presuming
> some uniformity across OGC standards,
>
>
> that is the Holy Grail. In practice, groups work individually (which is
> somehow understandable - it's all voluntary effort, although not desirable
> - I have brought it to the doors of OGC many times that a centralized point
> of coordination on the basics would be advantageous; that point could be
> OWS Common which is under revision since some time - not sure what this
> will mean in practice).
>
> so if vector data in WGS84 is to be returned in lat/lon order, does it
> makes sense to return also coverages in the same order?
>
>
> as we seem to have EPSG as common ground, yes.
>
> Projection unaware software displays vector data flipped when returned by
> a compliant WFS 1.1 server... shouldn't it happen the same for WCS 2.0? Or
> should rasters be considered somehow blessed and outside of this issue?
>
>
> I am always for harmonization (principle of least surprise in Software
> Engineering), but you will find wildly varying opinions on this :)
>
> HTH,
> Peter
>
>
>
> Cheers
> Andrea
>
> --
> ==
> GeoServer Professional Services from the experts! Visit
> http://goo.gl/it488V for more information.
> ==
>
> Ing. Andrea Aime
> @geowolf
> Technical Lead
>
> GeoSolutions S.A.S.
> Via di Montramito 3/A
> 55054  Massarosa (LU)
> phone: +39 0584 962313 <+39%200584%20962313>
> fax: +39 0584 1660272 <+39%200584%20166%200272>
> mob: +39  339 8844549 <+39%20339%20884%204549>
>
> http://www.geo-solutions.it
> http://twitter.com/geosolutions_it
>
> *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
>
> Le informazioni contenute in questo messaggio di posta elettronica e/o
> nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
> loro utilizzo è consentito esclusivamente al destinatario del messaggio,
> per le finalità indicate nel messaggio stesso. Qualora riceviate questo
> messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
> darcene notizia via e-mail e di procedere alla distruzione del messaggio
> stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
> divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
> utilizzarlo per finalità diverse, costituisce comportamento contrario ai
> principi dettati dal D.Lgs. 196/2003.
>
>
>
> The information in this message and/or attachments, is intended solely for
> the attention and use of the named addressee(s) and may be confidential or
> proprietary in nature or covered by the provisions of privacy act
> (Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
> Code).Any use not in accord with its purpose, any disclosure, reproduction,
> copying, distribution, or either dissemination, either whole or partial, is
> strictly forbidden except previous formal approval of the named
> addressee(s). If you are not the intended recipient, please contact
> immediately the sender by telephone, fax or e-mail and delete the
> information in this message that has been received in error. The sender
> does not give any warranty or accept liability as the content, accuracy or
> completeness of sent messages and accepts no responsibility  for changes
> made after they were sent or for other risks which arise as a result of
> e-mail transmission, viruses, etc.
>
> -------------------------------------------------------
>
>
> --
> Dr. Peter Baumann
>  - Professor of Computer Science, Jacobs University Bremen
>    www.faculty.jacobs-university.de/pbaumann
>    mail: p.baumann at jacobs-university.de
>    tel: +49-421-200-3178 <+49%20421%202003178>, fax: +49-421-200-493178 <+49%20421%20200493178>
>  - Executive Director, rasdaman GmbH Bremen (HRB 26793)
>    www.rasdaman.com, mail: baumann at rasdaman.com
>    tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882 <+49%20173%205837882>
> "Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)
>
>
>
>


-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/df76d4a6/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 2567 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/df76d4a6/attachment-0001.png>

From even.rouault at spatialys.com  Mon Apr 10 06:31:43 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 10 Apr 2017 15:31:43 +0200
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages and
	interoperability
In-Reply-To: <CA+nxMTsFYO=EFKxH20x-5DjjLtEF1QDedAwp3DZu9UbPWaz=fw@mail.gmail.com>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <58781414-2e0b-0e1f-9677-fbf81efaa221@jacobs-university.de>
 <CA+nxMTsFYO=EFKxH20x-5DjjLtEF1QDedAwp3DZu9UbPWaz=fw@mail.gmail.com>
Message-ID: <7107168.hhLIJib3oB@even-i700>

On lundi 10 avril 2017 15:06:55 CEST Andrea Aime wrote:
> Hi,
> sorry I lost track of the subject. So, to close up, and approach where the
> envelope is reported as "lat lon" and the "i j" raster space
> axis would map pairwise, so i pointing north-wards and j east-wards, would
> be considered valid?
> E.g., if one rescaling says "i is going to be 200 pixels" it really means
> the output image will be 200 pixels tall?

IMHO, importing EPSG axis order mess in raster space would seem to be foolish to me 
and cause major annoyances. Performance-wise, processing flipped rasters with classic 
algorithms that process line per line would be terrible as soon as they are large enough, 
since reading each line would in practice require to read the whole raster each time.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/a7990cbc/attachment.html>

From andrea.aime at geo-solutions.it  Mon Apr 10 06:57:03 2017
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Mon, 10 Apr 2017 15:57:03 +0200
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages and
	interoperability
In-Reply-To: <7107168.hhLIJib3oB@even-i700>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <58781414-2e0b-0e1f-9677-fbf81efaa221@jacobs-university.de>
 <CA+nxMTsFYO=EFKxH20x-5DjjLtEF1QDedAwp3DZu9UbPWaz=fw@mail.gmail.com>
 <7107168.hhLIJib3oB@even-i700>
Message-ID: <CA+nxMTvNYA79GvE_P5Xq=TwfQMWies-baJqXFcNpozj1FhMC1A@mail.gmail.com>

Hi Even,
in CIS 1.1 they state:

Coverages are assumed to have a 1:1 correlation between the axis names
given in axis-Labels and gridLabels, i.e.: they shall relate pairwise,
given by their sequence position. For example, axisLabels=“Lat Long h date”
and gridLabels={i j k l} implies a correspondence of Lat with i, Long with
j, h with k, and date with l.

If there is no 1:1 correspondence between geographic and raster space axis,
then I see no other way but to use Function to explicitly correlate the two.
How would you propose to proceed instead?

Cheers
Andrea


On Mon, Apr 10, 2017 at 3:31 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On lundi 10 avril 2017 15:06:55 CEST Andrea Aime wrote:
>
> > Hi,
>
> > sorry I lost track of the subject. So, to close up, and approach where
> the
>
> > envelope is reported as "lat lon" and the "i j" raster space
>
> > axis would map pairwise, so i pointing north-wards and j east-wards,
> would
>
> > be considered valid?
>
> > E.g., if one rescaling says "i is going to be 200 pixels" it really means
>
> > the output image will be 200 pixels tall?
>
>
>
> IMHO, importing EPSG axis order mess in raster space would seem to be
> foolish to me and cause major annoyances. Performance-wise, processing
> flipped rasters with classic algorithms that process line per line would be
> terrible as soon as they are large enough, since reading each line would in
> practice require to read the whole raster each time.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> ------------------------------------------------------------
> ------------------
> Check out the vibrant tech community on one of the world's most
> engaging tech sites, Slashdot.org! http://sdm.link/slashdot
> _______________________________________________
> Geoserver-devel mailing list
> Geoserver-devel at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/geoserver-devel
>
>


-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/72118399/attachment.html>

From even.rouault at spatialys.com  Mon Apr 10 07:23:31 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 10 Apr 2017 16:23:31 +0200
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages and
	interoperability
In-Reply-To: <CA+nxMTvNYA79GvE_P5Xq=TwfQMWies-baJqXFcNpozj1FhMC1A@mail.gmail.com>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <7107168.hhLIJib3oB@even-i700>
 <CA+nxMTvNYA79GvE_P5Xq=TwfQMWies-baJqXFcNpozj1FhMC1A@mail.gmail.com>
Message-ID: <4158738.fBMHjsndya@even-i700>

On lundi 10 avril 2017 15:57:03 CEST Andrea Aime wrote:
> Hi Even,
> in CIS 1.1 they state:
> 
> Coverages are assumed to have a 1:1 correlation between the axis names
> given in axis-Labels and gridLabels, i.e.: they shall relate pairwise,
> given by their sequence position. For example, axisLabels=“Lat Long h date”
> and gridLabels={i j k l} implies a correspondence of Lat with i, Long with
> j, h with k, and date with l.
> 
> If there is no 1:1 correspondence between geographic and raster space axis,
> then I see no other way but to use Function to explicitly correlate the two.
> How would you propose to proceed instead?

Well, Function might be helpful then (and happily ignored by code that assumes that usual 
raster order will be used). However I'm not sure in which way GDAL is involved in this 
discussion :-) Regarding GMLJP2, GDAL will ignore Function on reading it, and not write it. So 
I think that on the read side, that should be OK in practice. So, there could potentially be 
issues on the write side for rasters generated by GDAL and read by other software that 
would assume that a georeferencing with Lat Long order would imply the raster first axis to 
be Lat ? Or perhaps issues in the GDAL WCS client ? Perhaps Jukka could give more precisions 
if there are actual interoperability problems.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/5e27556a/attachment-0001.html>

From chrislloyd2 at yahoo.co.uk  Mon Apr 10 07:29:18 2017
From: chrislloyd2 at yahoo.co.uk (CTL101)
Date: Mon, 10 Apr 2017 07:29:18 -0700 (MST)
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <1491768139924-5316555.post@n6.nabble.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
 <1491768139924-5316555.post@n6.nabble.com>
Message-ID: <1491834558851-5316670.post@n6.nabble.com>

Hi Jukka, Thanks for your advice and the useful link. I have done as you
suggested and put together a revised query and tested in on a sample. This
worked successfully and significantly more quickly. I will now test on the
full dataset. The following is my command as it stands. Is this what you
envisaged and do you have any further tips to optimise? Regards, Chris

ogr2ogr -gt 65536 -nlt PROMOTE_TO_MULTI25D --config OGR_SQLITE_CACHE 20480
-f SQLite -dsco SPATIALITE=YES output.sqlite input.sqlite -nln outputtable
-dialect sqlite -sql "SELECT ST_Intersection(A.geometry, B.geometry) AS
geometry, A.acolumnname, B.acolumnname FROM inputtable1 A, inputtable2 B
WHERE ST_Intersects(A.geometry, B.geometry) AND A.ogc_fid IN (SELECT
A.ogc_fid FROM SpatialIndex WHERE f_table_name = 'inputtable1' AND
search_frame = B.geometry)"




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545p5316670.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 10 07:56:15 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 10 Apr 2017 14:56:15 +0000
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages
	and	interoperability
Message-ID: <d6518b267a8b4087aaa2fddbae15ff3f@C119S212VM022.msvyvi.vaha.local>

Hi,

Even wrote:
However I'm not sure in which way GDAL is involved in this discussion :-)


I am preparing for the future when GDAL will have a support for WCS 2.0.1 and it will try to read EPSG:4326 coverage data from GeoServers witch describe coverage like this: http://demo.geo-solutions.it/geoserver/wcs?service=WCS&version=2.0.1&request=DescribeCoverage&coverageID=nurc__Arc_Sample

I have a feeling that without a) making GDAL to interpret gridFunction or b) Geoserver changing the way to define rectified grid (if it is possible) GDAL will fail. If not before then at latest when it tries to read a subset of coverage or to put the server to do server side scaling to size.

Andrea wrote:

If there is no 1:1 correspondence between geographic and raster space axis, then I see no other way but to use Function to explicitly correlate the two.
How would you propose to proceed instead?

Perhaps with offset vectors? An example taken from “OGC GML in JPEG 2000 (GMLJP2) Encoding StandardPart 1: Core”


<gml:domainSet>
<gml:RectifiedGrid gml:id="rg0001_C0002" dimension="2"
srsName="http://www.opengis.net/def/crs/EPSG/0/4326">
<gml:limits>
<gml:GridEnvelope>
<gml:low>1 1</gml:low>
<gml:high>3 10</gml:high>
</gml:GridEnvelope>
</gml:limits>
<gml:axisLabels>Lat Long</gml:axisLabels>
<gml:origin>
<gml:Point gml:id="P0001">
<gml:pos>9.9 9.9</gml:pos>
</gml:Point>
</gml:origin>
<gml:offsetVector>0 3.71e-005</gml:offsetVector>
<gml:offsetVector>-3.71e-005 0</gml:offsetVector>
</gml:RectifiedGrid>

I hope I have understood right when I believe that this advice means “Read data from the JPEG 2000 file in sequence. Place the first data value to the origin and the second one where the first offsetVector points. It is: keep the latitude and increase the longitude by 3.71e-005 . Continue till the “high” limit of Long axis (10). Now the first row  is full. Place the 11th value where the second offsetVector points – so decrease Lat by -3.71e-005 and keep Long at the initial value. Fill the second row. Then one more step down and fill the 3rd row. You have finished”.

So even the grid axes are “column first – rows next” it is possible to fill the grid by streaming from the data source that is organized as “rows first” like JPEG 2000 or GeoTIFF. I can imagine I could demonstrate that if I had a chess board and 64 beans, even if someone rotates the board by 90 degrees.

I must admit that I am not at all sure that I have understood it right. Actually it is not even important for me. I just would like to see WCS to work fluently so that all the servers and clients would understand each other. Somehow I have hoped the OGC would support this goal by giving understandable examples and best practice documents.


By the way, Mr Baumann told that  coverages.wg-owner at lists.opengeospatial.org<mailto:coverages.wg-owner at lists.opengeospatial.org> is an open list but it does not seem to be open for everybody:


"This is an OGC member's only list. More information can be found at:

http://www.opengeospatial.org/ogc/join . If your organization is a member, please have your organization's representative create you an OGC portal account. Once you have an account, you may then request access to the desired lists. If you have questions, you may send you and your company's contact information along with an explanation to ListMaster @OpenGeospatial.org . Thank you. OGC ListMaster"



-Jukka Rahkonen-







Lähettäjä: Andrea Aime [mailto:andrea.aime at geo-solutions.it]
Lähetetty: 10. huhtikuuta 2017 16:57
Vastaanottaja: Even Rouault <even.rouault at spatialys.com>
Kopio: Geoserver-devel <geoserver-devel at lists.sourceforge.net>; 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>; Peter Baumann <p.baumann at jacobs-university.de>
Aihe: Re: [Geoserver-devel] [gdal-dev] GML lat-lon coverages and interoperability

Hi Even,
in CIS 1.1 they state:

Coverages are assumed to have a 1:1 correlation between the axis names given in axis-Labels and gridLabels, i.e.: they shall relate pairwise, given by their sequence position. For example, axisLabels=“Lat Long h date” and gridLabels={i j k l} implies a correspondence of Lat with i, Long with j, h with k, and date with l.

If there is no 1:1 correspondence between geographic and raster space axis, then I see no other way but to use Function to explicitly correlate the two.
How would you propose to proceed instead?

Cheers
Andrea


On Mon, Apr 10, 2017 at 3:31 PM, Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:

On lundi 10 avril 2017 15:06:55 CEST Andrea Aime wrote:

> Hi,

> sorry I lost track of the subject. So, to close up, and approach where the

> envelope is reported as "lat lon" and the "i j" raster space

> axis would map pairwise, so i pointing north-wards and j east-wards, would

> be considered valid?

> E.g., if one rescaling says "i is going to be 200 pixels" it really means

> the output image will be 200 pixels tall?



IMHO, importing EPSG axis order mess in raster space would seem to be foolish to me and cause major annoyances. Performance-wise, processing flipped rasters with classic algorithms that process line per line would be terrible as soon as they are large enough, since reading each line would in practice require to read the whole raster each time.



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com

------------------------------------------------------------------------------
Check out the vibrant tech community on one of the world's most
engaging tech sites, Slashdot.org! http://sdm.link/slashdot
_______________________________________________
Geoserver-devel mailing list
Geoserver-devel at lists.sourceforge.net<mailto:Geoserver-devel at lists.sourceforge.net>
https://lists.sourceforge.net/lists/listinfo/geoserver-devel



--
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it


AVVERTENZE AI SENSI DEL D.Lgs. 196/2003

Le informazioni contenute in questo messaggio di posta elettronica e/o nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il loro utilizzo è consentito esclusivamente al destinatario del messaggio, per le finalità indicate nel messaggio stesso. Qualora riceviate questo messaggio senza esserne il destinatario, Vi preghiamo cortesemente di darcene notizia via e-mail e di procedere alla distruzione del messaggio stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso, divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od utilizzarlo per finalità diverse, costituisce comportamento contrario ai principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for the attention and use of the named addressee(s) and may be confidential or proprietary in nature or covered by the provisions of privacy act (Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection Code).Any use not in accord with its purpose, any disclosure, reproduction, copying, distribution, or either dissemination, either whole or partial, is strictly forbidden except previous formal approval of the named addressee(s). If you are not the intended recipient, please contact immediately the sender by telephone, fax or e-mail and delete the information in this message that has been received in error. The sender does not give any warranty or accept liability as the content, accuracy or completeness of sent messages and accepts no responsibility  for changes made after they were sent or for other risks which arise as a result of e-mail transmission, viruses, etc.

-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/f9f48bc7/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 10 08:20:09 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 10 Apr 2017 08:20:09 -0700 (MST)
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <1491834558851-5316670.post@n6.nabble.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
 <1491768139924-5316555.post@n6.nabble.com>
 <1491834558851-5316670.post@n6.nabble.com>
Message-ID: <1491837609924-5316681.post@n6.nabble.com>

CTL101 wrote
> Hi Jukka, Thanks for your advice and the useful link. I have done as you
> suggested and put together a revised query and tested in on a sample. This
> worked successfully and significantly more quickly. I will now test on the
> full dataset. The following is my command as it stands. Is this what you
> envisaged and do you have any further tips to optimise? Regards, Chris
> 
> ogr2ogr -gt 65536 -nlt PROMOTE_TO_MULTI25D --config OGR_SQLITE_CACHE 20480
> -f SQLite -dsco SPATIALITE=YES output.sqlite input.sqlite -nln outputtable
> -dialect sqlite -sql "SELECT ST_Intersection(A.geometry, B.geometry) AS
> geometry, A.acolumnname, B.acolumnname FROM inputtable1 A, inputtable2 B
> WHERE ST_Intersects(A.geometry, B.geometry) AND A.ogc_fid IN (SELECT
> A.ogc_fid FROM SpatialIndex WHERE f_table_name = 'inputtable1' AND
> search_frame = B.geometry)"

Hi,

It looks good to me but I know only the basics. If you are not happy with
the speed write to Spatialite forum
https://groups.google.com/forum/#!forum/spatialite-users. Processing with
Spatialite is not always extremely fast and ST_Intersection may be the heavy
part.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545p5316681.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From p.baumann at jacobs-university.de  Mon Apr 10 09:28:55 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Mon, 10 Apr 2017 18:28:55 +0200
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages and
 interoperability
In-Reply-To: <4158738.fBMHjsndya@even-i700>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <7107168.hhLIJib3oB@even-i700>
 <CA+nxMTvNYA79GvE_P5Xq=TwfQMWies-baJqXFcNpozj1FhMC1A@mail.gmail.com>
 <4158738.fBMHjsndya@even-i700>
Message-ID: <f4295c1e-837e-6a6c-7d5c-6df12408bf70@jacobs-university.de>

Hi all,

why not simply check against the compliance tests of WCS 2 and maybe a reference
implementation? Might be the easiest for answering all such questions.

cheers,

Peter


On 04/10/2017 04:23 PM, Even Rouault wrote:
>
> On lundi 10 avril 2017 15:57:03 CEST Andrea Aime wrote:
>
> > Hi Even,
>
> > in CIS 1.1 they state:
>
> >
>
> > Coverages are assumed to have a 1:1 correlation between the axis names
>
> > given in axis-Labels and gridLabels, i.e.: they shall relate pairwise,
>
> > given by their sequence position. For example, axisLabels=“Lat Long h date”
>
> > and gridLabels={i j k l} implies a correspondence of Lat with i, Long with
>
> > j, h with k, and date with l.
>
> >
>
> > If there is no 1:1 correspondence between geographic and raster space axis,
>
> > then I see no other way but to use Function to explicitly correlate the two.
>
> > How would you propose to proceed instead?
>
>  
>
> Well, Function might be helpful then (and happily ignored by code that assumes
> that usual raster order will be used). However I'm not sure in which way GDAL
> is involved in this discussion :-) Regarding GMLJP2, GDAL will ignore Function
> on reading it, and not write it. So I think that on the read side, that should
> be OK in practice. So, there could potentially be issues on the write side for
> rasters generated by GDAL and read by other software that would assume that a
> georeferencing with Lat Long order would imply the raster first axis to be Lat
> ? Or perhaps issues in the GDAL WCS client ? Perhaps Jukka could give more
> precisions if there are actual interoperability problems.
>
>  
>
> Even
>
>  
>
> -- 
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170410/c97ae4d8/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Apr 10 10:22:42 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 10 Apr 2017 10:22:42 -0700 (MST)
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages and
	interoperability
In-Reply-To: <f4295c1e-837e-6a6c-7d5c-6df12408bf70@jacobs-university.de>
References: <5c7f1db772a34b96aeb11c26c21e7878@C119S212VM022.msvyvi.vaha.local>
 <7ca9e954-dbad-7787-100a-66c980305c5b@jacobs-university.de>
 <CA+nxMTu04=+k1HuZHdvX_URJHvO+PdmzN9EKihFmUoDSNNQkEQ@mail.gmail.com>
 <58781414-2e0b-0e1f-9677-fbf81efaa221@jacobs-university.de>
 <CA+nxMTsFYO=EFKxH20x-5DjjLtEF1QDedAwp3DZu9UbPWaz=fw@mail.gmail.com>
 <7107168.hhLIJib3oB@even-i700>
 <CA+nxMTvNYA79GvE_P5Xq=TwfQMWies-baJqXFcNpozj1FhMC1A@mail.gmail.com>
 <4158738.fBMHjsndya@even-i700>
 <f4295c1e-837e-6a6c-7d5c-6df12408bf70@jacobs-university.de>
Message-ID: <1491844962970-5316705.post@n6.nabble.com>

Peter Baumann wrote
> Hi all,
> 
> why not simply check against the compliance tests of WCS 2 and maybe a
> reference
> implementation? Might be the easiest for answering all such questions.
> 
> cheers,
> 
> Peter

Hi,

I could not find exact match for raster image (GeoTIFF) case from
http://cite.opengeospatial.org/teamengine/about/wcs/2.0.1/site/ or
http://schemas.opengis.net/wcs/2.0/examples/.


When it comes to reference implementation, by following the link
http://standards.rasdaman.org/ to the WCS endpoint demo using service
http://ows.rasdaman.org/rasdaman/ows and then to coverage BlueMarbleCov I
can read that DescribeCoverage contains this:

    <coverageFunction>
      <GridFunction>
        <sequenceRule axisOrder="+2 +1">Linear</sequenceRule>
        <startPoint>0 0</startPoint>
      </GridFunction>
    </coverageFunction>
    <gmlcov:metadata/>
    <domainSet>
      <RectifiedGrid dimension="2" gml:id="BlueMarbleCov-grid">
        <limits>
          <GridEnvelope>
            <low>0 0</low>
            <high>17999 8999</high>
          </GridEnvelope>
        </limits>
        <axisLabels>Lat Long</axisLabels>
        <origin>
          <Point gml:id="BlueMarbleCov-origin"
srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">
            <pos>89.99 -179.99</pos>
          </Point>
        </origin>
        <offsetVector
srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">-0.02 0</offsetVector>
        <offsetVector
srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">0 0.02</offsetVector>
      </RectifiedGrid>

So both the Rasdaman demo and Geoserver are using gridFunction axisOrder +2
+1 with EPSG:4326. However, on April 4th you wrote on this mailing list:

"So it is not necessary to use GridFunctions for this purpose. My personal
opinion is that such mechanisms are not optimal for fiddling with coordinate
positions as they make it unnecessarily
difficult to determine the final pixel position."

I am not yet sure what is the conclusion.

-Jukka Rahkonen-






--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-GML-lat-lon-coverages-and-interoperability-tp5315441p5316705.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From chrislloyd2 at yahoo.co.uk  Mon Apr 10 14:51:43 2017
From: chrislloyd2 at yahoo.co.uk (CTL101)
Date: Mon, 10 Apr 2017 14:51:43 -0700 (MST)
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <1491837609924-5316681.post@n6.nabble.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
 <1491768139924-5316555.post@n6.nabble.com>
 <1491834558851-5316670.post@n6.nabble.com>
 <1491837609924-5316681.post@n6.nabble.com>
Message-ID: <1491861103215-5316746.post@n6.nabble.com>

I've removed the intersection part after realising that I didn't need it as
the intersection geometry is already calculated in the input  (slow hand
clap me!)

So after investigating a bit more I have:
ogr2ogr -gt unlimited -nlt PROMOTE_TO_MULTI25D --config OGR_SQLITE_CACHE
10240 -f SQLite -dsco SPATIALITE=YES output.sqlite input.sqlite -nln
outputtable -dialect sqlite -sql "SELECT A.* FROM inputtable1 A, inputtable2
B WHERE ST_Intersects(A.geometry, B.geometry) AND A.ogc_fid IN (SELECT
A.ogc_fid FROM SpatialIndex WHERE f_table_name = 'inputtable1' AND
search_frame = B.geometry)"

This is now running on the large tables, and still seems really slow. But it
may actually finish this time so who knows. I have looked at the link that
Jukka suggests, and perused the forum but these seem like very complex
programming based solutions to elaborate problems. Surely there is a simple
way to get more speed out of gdal - especially now that the heavy lifting
has been removed almost altogether from my relatively simple query?



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545p5316746.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From woodbri at swoodbridge.com  Mon Apr 10 15:12:54 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Mon, 10 Apr 2017 18:12:54 -0400
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <1491861103215-5316746.post@n6.nabble.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
 <1491768139924-5316555.post@n6.nabble.com>
 <1491834558851-5316670.post@n6.nabble.com>
 <1491837609924-5316681.post@n6.nabble.com>
 <1491861103215-5316746.post@n6.nabble.com>
Message-ID: <19c0e309-0758-b0ea-9ef6-43dec1c479b6@swoodbridge.com>

On 4/10/2017 5:51 PM, CTL101 wrote:
> I've removed the intersection part after realising that I didn't need it as
> the intersection geometry is already calculated in the input  (slow hand
> clap me!)
> 
> So after investigating a bit more I have:
> ogr2ogr -gt unlimited -nlt PROMOTE_TO_MULTI25D --config OGR_SQLITE_CACHE
> 10240 -f SQLite -dsco SPATIALITE=YES output.sqlite input.sqlite -nln
> outputtable -dialect sqlite -sql "SELECT A.* FROM inputtable1 A, inputtable2
> B WHERE ST_Intersects(A.geometry, B.geometry) AND A.ogc_fid IN (SELECT
> A.ogc_fid FROM SpatialIndex WHERE f_table_name = 'inputtable1' AND
> search_frame = B.geometry)"
> 
> This is now running on the large tables, and still seems really slow. But it
> may actually finish this time so who knows. I have looked at the link that
> Jukka suggests, and perused the forum but these seem like very complex
> programming based solutions to elaborate problems. Surely there is a simple
> way to get more speed out of gdal - especially now that the heavy lifting
> has been removed almost altogether from my relatively simple query?

There are a lot of other factors on the speed, like:

how many interactions between the table A and B?
how many points are in each feature?

If you have postgresql installed you could load you two tables there and 
try similar queries to get a comparison of performance.

-Steve

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From chrislloyd2 at yahoo.co.uk  Mon Apr 10 15:38:46 2017
From: chrislloyd2 at yahoo.co.uk (CTL101)
Date: Mon, 10 Apr 2017 15:38:46 -0700 (MST)
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <19c0e309-0758-b0ea-9ef6-43dec1c479b6@swoodbridge.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
 <1491768139924-5316555.post@n6.nabble.com>
 <1491834558851-5316670.post@n6.nabble.com>
 <1491837609924-5316681.post@n6.nabble.com>
 <1491861103215-5316746.post@n6.nabble.com>
 <19c0e309-0758-b0ea-9ef6-43dec1c479b6@swoodbridge.com>
Message-ID: <1491863926923-5316749.post@n6.nabble.com>

Hi again Steve, The input is osm data, filtered so that only highways of some
significance remain. I am trying to get road intersections as points based
on certain criteria. I have an ogr2ogr sqlite based workflow that works on
test data. But scaling up is proving to be a problem for this particular
intersect operation, which occurs early on. Based on my source and sample
data i would say that there are possibly several million intersections
between the tables to compute. The intersection is between lines (roads),
but I am only interested in the point output where lines meet. If there is a
more efficient algorithm that i could use in ogr2ogr then i would be
grateful of advice.

I had not considered postgresql for this part of the process but would
prefer to streamline the workflow rather than create a new one if avoidable.
Might conversion of the sqlite tables to another format in ogr2ogr yield
significant performance dividends? Or do I need to resign myself to trying a
fresh approach?
Regards, Chris



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545p5316749.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From sault.don at gmail.com  Mon Apr 10 16:52:13 2017
From: sault.don at gmail.com (Donovan Cameron)
Date: Mon, 10 Apr 2017 16:52:13 -0700
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <19c0e309-0758-b0ea-9ef6-43dec1c479b6@swoodbridge.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
 <1491768139924-5316555.post@n6.nabble.com>
 <1491834558851-5316670.post@n6.nabble.com>
 <1491837609924-5316681.post@n6.nabble.com>
 <1491861103215-5316746.post@n6.nabble.com>
 <19c0e309-0758-b0ea-9ef6-43dec1c479b6@swoodbridge.com>
Message-ID: <bf61a81c-ef11-23cf-f078-d0012de02283@gmail.com>

I've also noticed for some intersections, especially where I want to 
extract points that intersect polygons, it can be quicker to do a 
ST_Within test - given that points will usually either be within or 
outside of a polygon, or touching the boundary of a polygon.


On 2017-04-10 03:12 PM, Stephen Woodbridge wrote:
> On 4/10/2017 5:51 PM, CTL101 wrote:
>> I've removed the intersection part after realising that I didn't need 
>> it as
>> the intersection geometry is already calculated in the input (slow hand
>> clap me!)
>>
>> So after investigating a bit more I have:
>> ogr2ogr -gt unlimited -nlt PROMOTE_TO_MULTI25D --config OGR_SQLITE_CACHE
>> 10240 -f SQLite -dsco SPATIALITE=YES output.sqlite input.sqlite -nln
>> outputtable -dialect sqlite -sql "SELECT A.* FROM inputtable1 A, 
>> inputtable2
>> B WHERE ST_Intersects(A.geometry, B.geometry) AND A.ogc_fid IN (SELECT
>> A.ogc_fid FROM SpatialIndex WHERE f_table_name = 'inputtable1' AND
>> search_frame = B.geometry)"
>>
>> This is now running on the large tables, and still seems really slow. 
>> But it
>> may actually finish this time so who knows. I have looked at the link 
>> that
>> Jukka suggests, and perused the forum but these seem like very complex
>> programming based solutions to elaborate problems. Surely there is a 
>> simple
>> way to get more speed out of gdal - especially now that the heavy 
>> lifting
>> has been removed almost altogether from my relatively simple query?
>
> There are a lot of other factors on the speed, like:
>
> how many interactions between the table A and B?
> how many points are in each feature?
>
> If you have postgresql installed you could load you two tables there 
> and try similar queries to get a comparison of performance.
>
> -Steve
>
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Kind regards,

Donovan


From woodbri at swoodbridge.com  Mon Apr 10 19:11:19 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Mon, 10 Apr 2017 22:11:19 -0400
Subject: [gdal-dev] ogr2ogr intersect very slow at command line with
 large sqlite input
In-Reply-To: <1491863926923-5316749.post@n6.nabble.com>
References: <1491752338527-5316545.post@n6.nabble.com>
 <3a0970bc-06c9-b9a0-4f15-9aae057bffdf@swoodbridge.com>
 <1491760453548-5316552.post@n6.nabble.com>
 <1491768139924-5316555.post@n6.nabble.com>
 <1491834558851-5316670.post@n6.nabble.com>
 <1491837609924-5316681.post@n6.nabble.com>
 <1491861103215-5316746.post@n6.nabble.com>
 <19c0e309-0758-b0ea-9ef6-43dec1c479b6@swoodbridge.com>
 <1491863926923-5316749.post@n6.nabble.com>
Message-ID: <ef23c418-47e6-ed83-8921-2d8b085054f1@swoodbridge.com>

Chris,

I'm not suggesting that you change your workflow yet, only that you try 
some experiments. I've worked with both Spatialite and postgis, but I 
have much more experience with postgis.

While they both have many of same functions, the interactions with the 
indexes is much more automatic and intuitive with postgis. I was 
recently surprised to learn that st_intersects() is faster than 
st_dwithin() in postgis. I can't say if the same is true for spatialite 
because of the indexing differences that you have already run into.

Regarding your roads data, OSM stores everything as two noded straight 
line segments, but many import tools chain them together into multiple 
point line segments, which makes the bbox for the linestring larger, 
which causes it to intersect with more other linestring bboxes so more 
computational test.

If you are only looking for intersections at line ends and only 
intersections at line ends where the roads have different names then you 
could try a different approach

create a table of line end points, you could snap the floating point xy 
values to a grid.

create table nodes (nid serial, geom geometry);
insert into nodes (geom)
select distinct geom
select st_snaptogrid(st_startpoint(geom), 0.000001) as geom from table
union all
select st_snaptogrid(st_endpoint(geom), 0.000001) as geom from table;

Then create a table assigning nid values to the lines

create table node2line (gid integer, nid integer, wend integer);

-- insert the start nodes into table
insert into node2line
select a.gid, b.nid, 0
   from table a, nodes b
  where st_snaptogrid(st_startpoint(a.geom), 0.000001)=b.geom;

-- insert the end nodes into table
insert into node2line
select a.gid, b.nid, 1
   from table a, nodes b
  where st_snaptogrid(st_endpoint(a.geom), 0.000001)=b.geom;

-- get the intersections from the node ids
select a.nid, a.gid, a.wend, b.gid, b.wend
   from node2line a, node2line b
  where a.nid=b.nid;

You will probably want to add some more filtering to eliminate dups, and 
maybe another join to match sort out street names. But this can be done 
mostly with simple btree indexes.

Also because you have snaptogrid, you can make the geom column text and 
and populate it with st_astext()

I do something similar in postgis in my geocoder to identify intersections.

-Steve

On 4/10/2017 6:38 PM, CTL101 wrote:
> Hi again Steve, The input is osm data, filtered so that only highways of some
> significance remain. I am trying to get road intersections as points based
> on certain criteria. I have an ogr2ogr sqlite based workflow that works on
> test data. But scaling up is proving to be a problem for this particular
> intersect operation, which occurs early on. Based on my source and sample
> data i would say that there are possibly several million intersections
> between the tables to compute. The intersection is between lines (roads),
> but I am only interested in the point output where lines meet. If there is a
> more efficient algorithm that i could use in ogr2ogr then i would be
> grateful of advice.
> 
> I had not considered postgresql for this part of the process but would
> prefer to streamline the workflow rather than create a new one if avoidable.
> Might conversion of the sqlite tables to another format in ogr2ogr yield
> significant performance dividends? Or do I need to resign myself to trying a
> fresh approach?
> Regards, Chris
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr2ogr-intersect-very-slow-at-command-line-with-large-sqlite-input-tp5316545p5316749.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From piero.campa at gmail.com  Tue Apr 11 00:13:35 2017
From: piero.campa at gmail.com (Piero Campalani)
Date: Tue, 11 Apr 2017 09:13:35 +0200
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages and
	interoperability
Message-ID: <CAMp9JaOT3Xay__VevcgJAUj7u2qSj=CivV+8seSTPw5a6_Df+g@mail.gmail.com>

​Hi Jukka,​

On 10 April 2017 at 16:56, <gdal-dev-request at lists.osgeo.org> wrote:

> Andrea wrote:
>
> If there is no 1:1 correspondence between geographic and raster space
> axis, then I see no other way but to use Function to explicitly correlate
> the two.
> How would you propose to proceed instead?
>
> Perhaps with offset vectors?
>


l'lI just chime​ in to confirm you that: yes, offset vectors are the right
means.

There is no need for raster and CRS axis to have 1) the same dimensionality
(you want to describe a 2D grid in a 3D cube) and neither 2) the same axis
ordering.

Indeed raster/CRS axis pairing can make sense only when the raster is
diligently aligned with the CRS space, otherwise that would makes no sense.

@see
http://rasdaman.org/wiki/PetascopeUserGuide#GridaxislabelsandCRSaxislabels
http://rasdaman.org/attachment/wiki/PetascopeUserGuide/GridDomainSetAxes.png

hth,
-Piero
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170411/9d31e6fa/attachment.html>

From ari.jolma at gmail.com  Tue Apr 11 00:30:33 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 11 Apr 2017 10:30:33 +0300
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
Message-ID: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>

How could I pull into travis the binaries of the latest released GDAL 
(now 2.1.3)?

There seems to be experimental debian package 
https://packages.debian.org/experimental/libgdal-dev

Does anybody have experience with them?

Right now I'm pulling in the source code and building it in the overall 
build but that's really slow.

Ari



From sebastic at xs4all.nl  Tue Apr 11 00:49:24 2017
From: sebastic at xs4all.nl (Bas Couwenberg)
Date: Tue, 11 Apr 2017 09:49:24 +0200
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
Message-ID: <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>

On 2017-04-11 09:30, Ari Jolma wrote:
> How could I pull into travis the binaries of the latest released GDAL
> (now 2.1.3)?
> 
> There seems to be experimental debian package
> https://packages.debian.org/experimental/libgdal-dev
> 
> Does anybody have experience with them?

OSGeo-Live includes these packages, (re)built for Ubuntu xenial.

> Right now I'm pulling in the source code and building it in the
> overall build but that's really slow.

The ubuntugis-unstable PPA has the GDAL 2.1.3 packages for xenial too 
(from OSGeo-Live), you can add the PPA in the travis setup script and 
install the packages from there.

  
https://launchpad.net/~ubuntugis/+archive/ubuntu/ubuntugis-unstable/+packages

Kind Regards,

Bas

From ari.jolma at gmail.com  Tue Apr 11 01:05:18 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 11 Apr 2017 11:05:18 +0300
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
 <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
Message-ID: <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>

11.04.2017, 10:49, Bas Couwenberg kirjoitti:
> On 2017-04-11 09:30, Ari Jolma wrote:
>> How could I pull into travis the binaries of the latest released GDAL
>> (now 2.1.3)?
>>
>> There seems to be experimental debian package
>> https://packages.debian.org/experimental/libgdal-dev
>>
>> Does anybody have experience with them?
>
> OSGeo-Live includes these packages, (re)built for Ubuntu xenial.
>
>> Right now I'm pulling in the source code and building it in the
>> overall build but that's really slow.
>
> The ubuntugis-unstable PPA has the GDAL 2.1.3 packages for xenial too 
> (from OSGeo-Live), you can add the PPA in the travis setup script and 
> install the packages from there.

What's the package name I should use?

sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable -y
gpg: keyring `/tmp/tmp2gKbLJ/secring.gpg' created
gpg: keyring `/tmp/tmp2gKbLJ/pubring.gpg' created
gpg: requesting key 314DF160 from hkp server keyserver.ubuntu.com
gpg: /tmp/tmp2gKbLJ/trustdb.gpg: trustdb created
gpg: key 314DF160: public key "Launchpad ubuntugis-stable" imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)
OK


sudo apt-get update


$ sudo apt-get install libgdal-dev_2.1.3
Reading package lists... Done
Building dependency tree
Reading state information... Done
E: Unable to locate package libgdal-dev_2.1.3
E: Couldn't find any package by regex 'libgdal-dev_2.1.3'

Ari
> https://launchpad.net/~ubuntugis/+archive/ubuntu/ubuntugis-unstable/+packages 
> Kind Regards, Bas _______________________________________________ 
> gdal-dev mailing list gdal-dev at lists.osgeo.org 
> https://lists.osgeo.org/mailman/listinfo/gdal-dev 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170411/c9311d86/attachment.html>

From gcpp.kalxas at gmail.com  Tue Apr 11 03:05:39 2017
From: gcpp.kalxas at gmail.com (Angelos Tzotsos)
Date: Tue, 11 Apr 2017 13:05:39 +0300
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
 <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
 <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>
Message-ID: <3edc65ff-439c-2db8-b769-363aaf970801@gmail.com>

Hi Ari,

sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
sudo apt-get update
sudo apt-get install libgdal-dev

This should do it.

Cheers,
Angelos

On 04/11/2017 11:05 AM, Ari Jolma wrote:
> 11.04.2017, 10:49, Bas Couwenberg kirjoitti:
>> On 2017-04-11 09:30, Ari Jolma wrote:
>>> How could I pull into travis the binaries of the latest released GDAL
>>> (now 2.1.3)?
>>>
>>> There seems to be experimental debian package
>>> https://packages.debian.org/experimental/libgdal-dev
>>>
>>> Does anybody have experience with them?
>>
>> OSGeo-Live includes these packages, (re)built for Ubuntu xenial.
>>
>>> Right now I'm pulling in the source code and building it in the
>>> overall build but that's really slow.
>>
>> The ubuntugis-unstable PPA has the GDAL 2.1.3 packages for xenial too 
>> (from OSGeo-Live), you can add the PPA in the travis setup script and 
>> install the packages from there.
>
> What's the package name I should use?
>
> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable -y
> gpg: keyring `/tmp/tmp2gKbLJ/secring.gpg' created
> gpg: keyring `/tmp/tmp2gKbLJ/pubring.gpg' created
> gpg: requesting key 314DF160 from hkp server keyserver.ubuntu.com
> gpg: /tmp/tmp2gKbLJ/trustdb.gpg: trustdb created
> gpg: key 314DF160: public key "Launchpad ubuntugis-stable" imported
> gpg: Total number processed: 1
> gpg:               imported: 1  (RSA: 1)
> OK
>
>
> sudo apt-get update
>
>
> $ sudo apt-get install libgdal-dev_2.1.3
> Reading package lists... Done
> Building dependency tree
> Reading state information... Done
> E: Unable to locate package libgdal-dev_2.1.3
> E: Couldn't find any package by regex 'libgdal-dev_2.1.3'
>
> Ari
>> https://launchpad.net/~ubuntugis/+archive/ubuntu/ubuntugis-unstable/+packages 
>> Kind Regards, Bas _______________________________________________ 
>> gdal-dev mailing list gdal-dev at lists.osgeo.org 
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev 
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Angelos Tzotsos, PhD
Charter Member
Open Source Geospatial Foundation
http://users.ntua.gr/tzotsos

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170411/c675b936/attachment.html>

From ari.jolma at gmail.com  Tue Apr 11 03:22:14 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 11 Apr 2017 13:22:14 +0300
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <3edc65ff-439c-2db8-b769-363aaf970801@gmail.com>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
 <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
 <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>
 <3edc65ff-439c-2db8-b769-363aaf970801@gmail.com>
Message-ID: <e767fe77-8f55-323b-9c94-6a87ce7f14c9@gmail.com>

11.04.2017, 13:05, Angelos Tzotsos kirjoitti:
> Hi Ari,
>
> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
> sudo apt-get update
> sudo apt-get install libgdal-dev
>
> This should do it.

No. I tried that before (found it in my .travis.yml file...) and it 
pulls in older version 1.10.0.

Ari

>
> Cheers,
> Angelos
>
> On 04/11/2017 11:05 AM, Ari Jolma wrote:
>> 11.04.2017, 10:49, Bas Couwenberg kirjoitti:
>>> On 2017-04-11 09:30, Ari Jolma wrote:
>>>> How could I pull into travis the binaries of the latest released GDAL
>>>> (now 2.1.3)?
>>>>
>>>> There seems to be experimental debian package
>>>> https://packages.debian.org/experimental/libgdal-dev
>>>>
>>>> Does anybody have experience with them?
>>>
>>> OSGeo-Live includes these packages, (re)built for Ubuntu xenial.
>>>
>>>> Right now I'm pulling in the source code and building it in the
>>>> overall build but that's really slow.
>>>
>>> The ubuntugis-unstable PPA has the GDAL 2.1.3 packages for xenial 
>>> too (from OSGeo-Live), you can add the PPA in the travis setup 
>>> script and install the packages from there.
>>
>> What's the package name I should use?
>>
>> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable -y
>> gpg: keyring `/tmp/tmp2gKbLJ/secring.gpg' created
>> gpg: keyring `/tmp/tmp2gKbLJ/pubring.gpg' created
>> gpg: requesting key 314DF160 from hkp server keyserver.ubuntu.com
>> gpg: /tmp/tmp2gKbLJ/trustdb.gpg: trustdb created
>> gpg: key 314DF160: public key "Launchpad ubuntugis-stable" imported
>> gpg: Total number processed: 1
>> gpg:               imported: 1  (RSA: 1)
>> OK
>>
>>
>> sudo apt-get update
>>
>>
>> $ sudo apt-get install libgdal-dev_2.1.3
>> Reading package lists... Done
>> Building dependency tree
>> Reading state information... Done
>> E: Unable to locate package libgdal-dev_2.1.3
>> E: Couldn't find any package by regex 'libgdal-dev_2.1.3'
>>
>> Ari
>>> https://launchpad.net/~ubuntugis/+archive/ubuntu/ubuntugis-unstable/+packages 
>>> Kind Regards, Bas _______________________________________________ 
>>> gdal-dev mailing list gdal-dev at lists.osgeo.org 
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev 
>>
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> -- 
> Angelos Tzotsos, PhD
> Charter Member
> Open Source Geospatial Foundation
> http://users.ntua.gr/tzotsos
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170411/44969dd6/attachment-0001.html>

From sebastic at xs4all.nl  Tue Apr 11 03:28:24 2017
From: sebastic at xs4all.nl (Bas Couwenberg)
Date: Tue, 11 Apr 2017 12:28:24 +0200
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <e767fe77-8f55-323b-9c94-6a87ce7f14c9@gmail.com>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
 <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
 <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>
 <3edc65ff-439c-2db8-b769-363aaf970801@gmail.com>
 <e767fe77-8f55-323b-9c94-6a87ce7f14c9@gmail.com>
Message-ID: <747e351433ac6896b9a0bb85c38df781@xs4all.nl>

On 2017-04-11 12:22, Ari Jolma wrote:
> 11.04.2017, 13:05, Angelos Tzotsos kirjoitti:
>> Hi Ari,
>> 
>> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
>> sudo apt-get update
>> sudo apt-get install libgdal-dev
>> 
>> This should do it.
> 
> No. I tried that before (found it in my .travis.yml file...) and it
> pulls in older version 1.10.0.

You can install the 2.1.3 version explicitly with:

  sudo apt-get install libgdal-dev=2.1.3+dfsg-1~xenial2

But this will fail when the version is updated in the PPA.

Is the travis environment using Ubuntu xenial, and not an older LTS like 
trusty or precise? It's probably trusty since that ships with GDAL 
1.10.1.

For those older LTS releases the UbuntuGIS packages haven't been updated 
yet. Depending on manpower and motivation we may be able to updated the 
trusty packages in the near future.

Ideally the travis environment is upgraded to xenial for which the best 
support is available and the default packages in Ubuntu itself are much 
more current.

Kind Regards,

Bas

From gcpp.kalxas at gmail.com  Tue Apr 11 03:28:32 2017
From: gcpp.kalxas at gmail.com (Angelos Tzotsos)
Date: Tue, 11 Apr 2017 13:28:32 +0300
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <e767fe77-8f55-323b-9c94-6a87ce7f14c9@gmail.com>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
 <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
 <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>
 <3edc65ff-439c-2db8-b769-363aaf970801@gmail.com>
 <e767fe77-8f55-323b-9c94-6a87ce7f14c9@gmail.com>
Message-ID: <1bee49d6-0f1c-a045-a03b-f1ed66cc5fbb@gmail.com>

In that case, you are either using a ppa mixed environment (perhaps you 
use the postgres ppa?) or you are using a package that still depends on 
the upstream gdal version.

On 04/11/2017 01:22 PM, Ari Jolma wrote:
> 11.04.2017, 13:05, Angelos Tzotsos kirjoitti:
>> Hi Ari,
>>
>> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
>> sudo apt-get update
>> sudo apt-get install libgdal-dev
>>
>> This should do it.
>
> No. I tried that before (found it in my .travis.yml file...) and it 
> pulls in older version 1.10.0.
>
> Ari
>
>>
>> Cheers,
>> Angelos
>>
>> On 04/11/2017 11:05 AM, Ari Jolma wrote:
>>> 11.04.2017, 10:49, Bas Couwenberg kirjoitti:
>>>> On 2017-04-11 09:30, Ari Jolma wrote:
>>>>> How could I pull into travis the binaries of the latest released GDAL
>>>>> (now 2.1.3)?
>>>>>
>>>>> There seems to be experimental debian package
>>>>> https://packages.debian.org/experimental/libgdal-dev
>>>>>
>>>>> Does anybody have experience with them?
>>>>
>>>> OSGeo-Live includes these packages, (re)built for Ubuntu xenial.
>>>>
>>>>> Right now I'm pulling in the source code and building it in the
>>>>> overall build but that's really slow.
>>>>
>>>> The ubuntugis-unstable PPA has the GDAL 2.1.3 packages for xenial 
>>>> too (from OSGeo-Live), you can add the PPA in the travis setup 
>>>> script and install the packages from there.
>>>
>>> What's the package name I should use?
>>>
>>> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable -y
>>> gpg: keyring `/tmp/tmp2gKbLJ/secring.gpg' created
>>> gpg: keyring `/tmp/tmp2gKbLJ/pubring.gpg' created
>>> gpg: requesting key 314DF160 from hkp server keyserver.ubuntu.com
>>> gpg: /tmp/tmp2gKbLJ/trustdb.gpg: trustdb created
>>> gpg: key 314DF160: public key "Launchpad ubuntugis-stable" imported
>>> gpg: Total number processed: 1
>>> gpg:               imported: 1  (RSA: 1)
>>> OK
>>>
>>>
>>> sudo apt-get update
>>>
>>>
>>> $ sudo apt-get install libgdal-dev_2.1.3
>>> Reading package lists... Done
>>> Building dependency tree
>>> Reading state information... Done
>>> E: Unable to locate package libgdal-dev_2.1.3
>>> E: Couldn't find any package by regex 'libgdal-dev_2.1.3'
>>>
>>> Ari
>>>> https://launchpad.net/~ubuntugis/+archive/ubuntu/ubuntugis-unstable/+packages 
>>>> Kind Regards, Bas _______________________________________________ 
>>>> gdal-dev mailing list gdal-dev at lists.osgeo.org 
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev 
>>>
>>>
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>> -- 
>> Angelos Tzotsos, PhD
>> Charter Member
>> Open Source Geospatial Foundation
>> http://users.ntua.gr/tzotsos
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Angelos Tzotsos, PhD
Charter Member
Open Source Geospatial Foundation
http://users.ntua.gr/tzotsos

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170411/95a1d085/attachment.html>

From p.baumann at jacobs-university.de  Tue Apr 11 03:45:39 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Tue, 11 Apr 2017 12:45:39 +0200
Subject: [gdal-dev] [Geoserver-devel] GML lat-lon coverages and
 interoperability
In-Reply-To: <CAMp9JaOT3Xay__VevcgJAUj7u2qSj=CivV+8seSTPw5a6_Df+g@mail.gmail.com>
References: <CAMp9JaOT3Xay__VevcgJAUj7u2qSj=CivV+8seSTPw5a6_Df+g@mail.gmail.com>
Message-ID: <017845a4-43ab-b690-420f-8fb9e7aa30d4@jacobs-university.de>

Hi all,

Piero is right - what I said applies to the case that grid and CRS axes align -
which addresses the vast marjotiy of cases in my experience. However, OGC
coverages (to some extent CIS 1.0, more with CIS 1.1) can also address more
complex cases (irregular grids, grids embedded in higher-dimensional spaces,
grids given by sensor models, etc.), but naturally description of such grids
gets increasingly involved.

To put it differently: parameters omitted use defaults that try to keep usage
simple.

My 2 philosophical cents,

Peter


On 04/11/2017 09:13 AM, Piero Campalani wrote:
> ​Hi Jukka,​
>
> On 10 April 2017 at 16:56, <gdal-dev-request at lists.osgeo.org
> <mailto:gdal-dev-request at lists.osgeo.org>> wrote:
>
>     Andrea wrote:
>
>     If there is no 1:1 correspondence between geographic and raster space
>     axis, then I see no other way but to use Function to explicitly correlate
>     the two.
>     How would you propose to proceed instead?
>
>     Perhaps with offset vectors?
>
>
>
> l'lI just chime​ in to confirm you that: yes, offset vectors are the right means.
>
> There is no need for raster and CRS axis to have 1) the same dimensionality
> (you want to describe a 2D grid in a 3D cube) and neither 2) the same axis
> ordering.
>
> Indeed raster/CRS axis pairing can make sense only when the raster is
> diligently aligned with the CRS space, otherwise that would makes no sense.
>
> @see
> http://rasdaman.org/wiki/PetascopeUserGuide#GridaxislabelsandCRSaxislabels
> http://rasdaman.org/attachment/wiki/PetascopeUserGuide/GridDomainSetAxes.png
>
> hth,
> -Piero
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170411/593005d8/attachment.html>

From ari.jolma at gmail.com  Tue Apr 11 03:48:35 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 11 Apr 2017 13:48:35 +0300
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <747e351433ac6896b9a0bb85c38df781@xs4all.nl>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
 <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
 <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>
 <3edc65ff-439c-2db8-b769-363aaf970801@gmail.com>
 <e767fe77-8f55-323b-9c94-6a87ce7f14c9@gmail.com>
 <747e351433ac6896b9a0bb85c38df781@xs4all.nl>
Message-ID: <84117854-a9b7-161f-787a-8036691136c4@gmail.com>

11.04.2017, 13:28, Bas Couwenberg kirjoitti:
> On 2017-04-11 12:22, Ari Jolma wrote:
>> 11.04.2017, 13:05, Angelos Tzotsos kirjoitti:
>>> Hi Ari,
>>>
>>> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
>>> sudo apt-get update
>>> sudo apt-get install libgdal-dev
>>>
>>> This should do it.
>>
>> No. I tried that before (found it in my .travis.yml file...) and it
>> pulls in older version 1.10.0.
>
> You can install the 2.1.3 version explicitly with:
>
>  sudo apt-get install libgdal-dev=2.1.3+dfsg-1~xenial2

It seems it did not even try this. Probably because it is precise?

>
> But this will fail when the version is updated in the PPA.
>
> Is the travis environment using Ubuntu xenial, and not an older LTS 
> like trusty or precise? It's probably trusty since that ships with 
> GDAL 1.10.1.

It is precise. Trusty build environment is in beta.


>
> For those older LTS releases the UbuntuGIS packages haven't been 
> updated yet. Depending on manpower and motivation we may be able to 
> updated the trusty packages in the near future.

It would save a lot of build time at least for me.

The reason for me is that many of my project use the GDAL Perl bindings 
and for the tests I pull in the latest from CPAN, which is based on the 
latest released GDAL.

>
> Ideally the travis environment is upgraded to xenial for which the 
> best support is available and the default packages in Ubuntu itself 
> are much more current.

ok

Thanks,

Ari

>
> Kind Regards,
>
> Bas
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From w.vollprecht at gmail.com  Tue Apr 11 17:14:01 2017
From: w.vollprecht at gmail.com (Wolf Vollprecht)
Date: Tue, 11 Apr 2017 17:14:01 -0700 (MST)
Subject: [gdal-dev] xtensor: C++ multi-dimensional arrays with
 broadcasting and lazy computing
In-Reply-To: <CADPhZXzngv+5GAVdypwD8NX=iHTRkXr_=U9gT1gTFk46pxOKfw@mail.gmail.com>
References: <CADPhZXzngv+5GAVdypwD8NX=iHTRkXr_=U9gT1gTFk46pxOKfw@mail.gmail.com>
Message-ID: <1491956041459-5316912.post@n6.nabble.com>

Hi, 

I am a core contributor to xtensor. We've greatly improved the library since
this was posted! Maybe you want to  have another look? And if you have
questions, or ideas for a good use case for xtensor, let me know here or
shoot us a message on gitter (gitter.im/QuantStack/Lobby) and we'll help you
out (hopefully!).

Cheers,

Wolf



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-xtensor-C-multi-dimensional-arrays-with-broadcasting-and-lazy-computing-tp5296439p5316912.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr 12 00:40:04 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 12 Apr 2017 07:40:04 +0000
Subject: [gdal-dev] SQLite-SQL problem with some layer names
Message-ID: <1491982804600.36719@maanmittauslaitos.fi>

Hi,

I have problems in using the SQLite dialect if layer names contains numbers or underscores. I am on Windows. 

ogrinfo -dialect sqlite 3d.shp -sql "select * from 3d"
INFO: Open of `3d.shp'
      using driver `ESRI Shapefile' successful.
ERROR 1: In ExecuteSQL(): sqlite3_prepare(select * from 3d):
  unrecognized token: "3d"

Same happens with a proper SQL with double quotes around the identifier
ogrinfo -dialect sqlite 3d.shp -sql "select * from "3d""

However, with single quotes it works
ogrinfo -dialect sqlite 3d.shp -sql "select * from '3d'"
Even this one, yields a correct result
ogrinfo -dialect sqlite 3d.shp -sql "select 'fixed_string'  from '3d'"

Layers without numbers or underscores in names behave right 
ogrinfo -dialect sqlite test.shp -sql "select * from "test"'"

Is there something that could be fixed in the code, or should I add a line to two into the documentation http://www.gdal.org/ogr_sql_sqlite.html?

-Jukka Rahkonen-

From even.rouault at spatialys.com  Wed Apr 12 01:08:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 12 Apr 2017 10:08:06 +0200
Subject: [gdal-dev] SQLite-SQL problem with some layer names
In-Reply-To: <1491982804600.36719@maanmittauslaitos.fi>
References: <1491982804600.36719@maanmittauslaitos.fi>
Message-ID: <1662815.Svi4D1aqjY@even-i700>

Hi Jukka,

> 
> I have problems in using the SQLite dialect if layer names contains numbers
> or underscores. I am on Windows.

This is just an issue with proper escaping of double quotes in the shell. Identifiers that start 
with a number (and possibly underscore I haven't checked) need to be put between double 
quotes per the SQL standard. And as the SQL statement itself is put between double quotes, 
you need to escape those internal double quotes with \

ogrinfo  -dialect sqlite 3d.shp -sql "select * from \"3d\""

Works on both Linux (bash) and Windows cmd

> 
> ogrinfo -dialect sqlite 3d.shp -sql "select * from 3d"
> INFO: Open of `3d.shp'
>       using driver `ESRI Shapefile' successful.
> ERROR 1: In ExecuteSQL(): sqlite3_prepare(select * from 3d):
>   unrecognized token: "3d"
> 
> Same happens with a proper SQL with double quotes around the identifier
> ogrinfo -dialect sqlite 3d.shp -sql "select * from "3d""

My understanding is that the parsing of the above is the concatenation of:
select * from
3d
(empty string)

so equivalent to no quoting of the identifier.

> 
> However, with single quotes it works
> ogrinfo -dialect sqlite 3d.shp -sql "select * from '3d'"

SQLite tolerates single quoting around identifiers, but that cannot be used for column names 
(otherwise you get a fixed string)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170412/bd37ce56/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr 12 07:45:57 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 12 Apr 2017 14:45:57 +0000
Subject: [gdal-dev] SQLite-SQL problem with some layer names
In-Reply-To: <1662815.Svi4D1aqjY@even-i700>
References: <1491982804600.36719@maanmittauslaitos.fi>,
 <1662815.Svi4D1aqjY@even-i700>
Message-ID: <1492008357130.36161@maanmittauslaitos.fi>

Hi,

Hi,


I had a try with editing the .dox file that is used for generating http://www.gdal.org/ogr_sql_sqlite.html<http://www.gdal.org/ogr_sql_sqlite.html> with changeset #37971. Could you check if the text makes sense and appears right?


-Jukka-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170412/a970eb9f/attachment.html>

From woodbri at swoodbridge.com  Wed Apr 12 10:23:06 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Wed, 12 Apr 2017 13:23:06 -0400
Subject: [gdal-dev] What is the best strategy for handling multiple banded
	tiffs
Message-ID: <24db03c3-8021-4c5d-8047-2e774a9caa28@swoodbridge.com>

Hi all,

I'm reworking my code dealing with NAIP imagery that has R, G, B, IR 
bands, and I generate a mask band when reprojecting it. I also have the 
option to generate another computed band based on a sobel operator.

In the past, I separated them R, G, B, mask into jpeg ycbcr compressed 
tiff and had separate files for the IR, and the sobel data and used a 
VRT file to pull all these together into a single image for additional 
processing.

Ideally, I would like to have one file, rather than 4 files (RGB, IR, 
sobel, and the VRT) because over large areas the management of all these 
files is a pain. Also when displaying and working with large areas I 
need to mosaic the images into a seemless area using a vrt file or 
tileindex.

I need a way to display the various bands, and mapserver is my tool of 
choice, but I probably need to be able to display them via qgis also, 
which I have not experience with but reading older posts, I might need 
to create a vrt file. In mapserver I can select bands using PROCESSING 
options on layers.

Questions?

1. Does it make sense to try and do this with one tiff with 6 bands?
2. What would be the best workflow for doing this? I'm thinking 
something like:

# remove any collar
nearblack -co TILED=YES -of GTiff -nb 0 -near 0 -setmask -q -o temp1.tif 
doqq.tif

# warp to EPSG:4326 (does -dstalpha convert mask band to an alpha band?)
gdalwarp -t_srs EPSG:4326 -dstalpha -co TILED=YES temp1.tif rgba.tif

# make sobel gray scale single band image
makesobel.py rgba.tif sobel.tif

# create a temp.vrt file with bands R, G, B, Alpha|mask, IR, sobel

# and finally build a tif using the temp.vrt
# I'm not sure what is the best way build the final tif given the mask
# and whether I should use gdalwarp or gdal_translate for this step
gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG 
--CONFIG GDAL_TIFF_INTERNAL_MASK YES temp.vrt final.tif

# and build overviews
gdaladdo -clean -r average final.tif 2 4 8 16 32 64 128

I'm not clear on how the mask band or alpha channel(band?) interacts 
with the various commands at each step in the workflow.

Thanks,
   -Steve

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Wed Apr 12 11:01:50 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 12 Apr 2017 20:01:50 +0200
Subject: [gdal-dev] What is the best strategy for handling multiple
	banded tiffs
In-Reply-To: <24db03c3-8021-4c5d-8047-2e774a9caa28@swoodbridge.com>
References: <24db03c3-8021-4c5d-8047-2e774a9caa28@swoodbridge.com>
Message-ID: <4159255.PfolhmHsHc@even-i700>

On mercredi 12 avril 2017 13:23:06 CEST Stephen Woodbridge wrote:
> Hi all,
> 
> I'm reworking my code dealing with NAIP imagery that has R, G, B, IR
> bands, and I generate a mask band when reprojecting it. I also have the
> option to generate another computed band based on a sobel operator.
> 
> In the past, I separated them R, G, B, mask into jpeg ycbcr compressed
> tiff and had separate files for the IR, and the sobel data and used a
> VRT file to pull all these together into a single image for additional
> processing.
> 
> Ideally, I would like to have one file, rather than 4 files (RGB, IR,
> sobel, and the VRT) because over large areas the management of all these
> files is a pain. Also when displaying and working with large areas I
> need to mosaic the images into a seemless area using a vrt file or
> tileindex.
> 
> I need a way to display the various bands, and mapserver is my tool of
> choice, but I probably need to be able to display them via qgis also,
> which I have not experience with but reading older posts, I might need
> to create a vrt file. In mapserver I can select bands using PROCESSING
> options on layers.
> 
> Questions?
> 
> 1. Does it make sense to try and do this with one tiff with 6 bands?
> 2. What would be the best workflow for doing this? I'm thinking
> something like:
> 
> # remove any collar
> nearblack -co TILED=YES -of GTiff -nb 0 -near 0 -setmask -q -o temp1.tif
> doqq.tif
> 
> # warp to EPSG:4326 (does -dstalpha convert mask band to an alpha band?)

Yes

> gdalwarp -t_srs EPSG:4326 -dstalpha -co TILED=YES temp1.tif rgba.tif
> 
> # make sobel gray scale single band image
> makesobel.py rgba.tif sobel.tif
> 
> # create a temp.vrt file with bands R, G, B, Alpha|mask, IR, sobel
> 
> # and finally build a tif using the temp.vrt
> # I'm not sure what is the best way build the final tif given the mask
> # and whether I should use gdalwarp or gdal_translate for this step
> gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG
> --CONFIG GDAL_TIFF_INTERNAL_MASK YES temp.vrt final.tif

--> This will only work as intended if there's a mask band identified as a mask and not an 
alpha band in the VRT.


> 
> # and build overviews
> gdaladdo -clean -r average final.tif 2 4 8 16 32 64 128
> 
> I'm not clear on how the mask band or alpha channel(band?) interacts
> with the various commands at each step in the workflow.
> 
> Thanks,
>    -Steve
> 
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170412/d9909fa9/attachment-0001.html>

From woodbri at swoodbridge.com  Wed Apr 12 14:40:56 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Wed, 12 Apr 2017 17:40:56 -0400
Subject: [gdal-dev] What is the best strategy for handling multiple
 banded tiffs
In-Reply-To: <4159255.PfolhmHsHc@even-i700>
References: <24db03c3-8021-4c5d-8047-2e774a9caa28@swoodbridge.com>
 <4159255.PfolhmHsHc@even-i700>
Message-ID: <bf0caf00-cc4a-af4e-e48f-288777488763@swoodbridge.com>

I'm working with:

GDAL 1.10.1, released 2013/08/26 (native)
GDAL 2.1.0, released 2016/04/25  (in a docker container)

All these results are from 2.1.

I don't think I need the nearblack call as the NAIP imagery does not 
appear to have collars. So I'm removing it from the workflow for now.

The source DOQQ has these bands where band 4 is the IR:
Band 1 Block=6472x1 Type=Byte, ColorInterp=Red
Band 2 Block=6472x1 Type=Byte, ColorInterp=Green
Band 3 Block=6472x1 Type=Byte, ColorInterp=Blue
Band 4 Block=6472x1 Type=Byte, ColorInterp=Undefined

gdalwarp -t_srs EPSG:4326 -dstalpha  -co TILED=YES 
m_3311805_ne_11_1_20140513.tif epsg4326.tif

Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
Band 2 Block=256x256 Type=Byte, ColorInterp=Undefined
Band 3 Block=256x256 Type=Byte, ColorInterp=Undefined
Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha

So this is annoying, but probably fixable, band 4 is the IR if I add an 
*.aux.xml file setting the color interupt, at least on 2.1, adding it on 
1.10.1 does not help. It does not appear that it is possible to create a 
mask band only an alpha band at this point.

The compressing this:

gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -b 1 
-b 2 -b 3 -b 4 -mask 5 epsg4326.tif out.tif

Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
   Mask Flags: PER_DATASET
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
   Mask Flags: PER_DATASET
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
   Mask Flags: PER_DATASET
Band 4 Block=256x256 Type=Byte, ColorInterp=Alpha
   Mask Flags: PER_DATASET

It dropped the source band 4 (IR)

gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG 
epsg4326.tif out2.tif

Input file size is 7232, 7056
0...10...20...30...40...50...60...70...80...90...100 - done.
ERROR 1: JPEGLib:Too many color components: 5, max 4
ERROR 1: WriteEncodedTile/Strip() failed.
ERROR 1: JPEGLib:Too many color components: 5, max 4
ERROR 1: WriteEncodedTile/Strip() failed.
ERROR 1: JPEGLib:Too many color components: 5, max 4
ERROR 1: WriteEncodedTile/Strip() failed.

So is it possible to compress multiple bands using jpeg compression? 
(other than an RGB or RGBA or RGB mask?

So, if I want to end up with a single tif file with bands (R, G, B, 
Alpha|mask, IR, sobel) that is jpeg compressed is this possible?

What is the workflow to do that?

Or is the best I can do is to create separate RGBA file, an IR file and 
a sobel file and bring them together via a VRT file?

Thanks,
   -Steve


On 4/12/2017 2:01 PM, Even Rouault wrote:
> On mercredi 12 avril 2017 13:23:06 CEST Stephen Woodbridge wrote:
> 
>  > Hi all,
> 
>  >
> 
>  > I'm reworking my code dealing with NAIP imagery that has R, G, B, IR
>  > bands, and I generate a mask band when reprojecting it. I also have the
>  > option to generate another computed band based on a sobel operator.
>  >
>  > In the past, I separated them R, G, B, mask into jpeg ycbcr compressed
>  > tiff and had separate files for the IR, and the sobel data and used a
>  > VRT file to pull all these together into a single image for additional
>  > processing.
>  >
>  > Ideally, I would like to have one file, rather than 4 files (RGB, IR,
>  > sobel, and the VRT) because over large areas the management of all these
>  > files is a pain. Also when displaying and working with large areas I
>  > need to mosaic the images into a seemless area using a vrt file or
>  > tileindex.
>  >
>  > I need a way to display the various bands, and mapserver is my tool of
>  > choice, but I probably need to be able to display them via qgis also,
>  > which I have not experience with but reading older posts, I might need
>  > to create a vrt file. In mapserver I can select bands using PROCESSING
>  > options on layers.
>  >
>  > Questions?
>  >
>  > 1. Does it make sense to try and do this with one tiff with 6 bands?
>  > 2. What would be the best workflow for doing this? I'm thinking
>  > something like:
>  >
>  > # remove any collar
>  > nearblack -co TILED=YES -of GTiff -nb 0 -near 0 -setmask -q -o temp1.tif
>  > doqq.tif
>  >
>  > # warp to EPSG:4326 (does -dstalpha convert mask band to an alpha band?)
> 
> Yes
> 
>  > gdalwarp -t_srs EPSG:4326 -dstalpha -co TILED=YES temp1.tif rgba.tif
>  >
>  > # make sobel gray scale single band image
>  > makesobel.py rgba.tif sobel.tif
>  >
>  > # create a temp.vrt file with bands R, G, B, Alpha|mask, IR, sobel
>  >
>  > # and finally build a tif using the temp.vrt
>  > # I'm not sure what is the best way build the final tif given the mask
>  > # and whether I should use gdalwarp or gdal_translate for this step
>  > gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG
>  > --CONFIG GDAL_TIFF_INTERNAL_MASK YES temp.vrt final.tif
> 
> --> This will only work as intended if there's a mask band identified as 
> a mask and not an alpha band in the VRT.
> 
>  >
>  > # and build overviews
>  > gdaladdo -clean -r average final.tif 2 4 8 16 32 64 128
>  >
>  > I'm not clear on how the mask band or alpha channel(band?) interacts
>  > with the various commands at each step in the workflow.
>  >
>  > Thanks,
>  > -Steve

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Wed Apr 12 15:26:28 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 13 Apr 2017 00:26:28 +0200
Subject: [gdal-dev] What is the best strategy for handling multiple
	banded tiffs
In-Reply-To: <bf0caf00-cc4a-af4e-e48f-288777488763@swoodbridge.com>
References: <24db03c3-8021-4c5d-8047-2e774a9caa28@swoodbridge.com>
 <4159255.PfolhmHsHc@even-i700>
 <bf0caf00-cc4a-af4e-e48f-288777488763@swoodbridge.com>
Message-ID: <3456998.W6Ah5gPqO4@even-i700>

On mercredi 12 avril 2017 17:40:56 CEST Stephen Woodbridge wrote:
> I'm working with:
> 
> GDAL 1.10.1, released 2013/08/26 (native)
> GDAL 2.1.0, released 2016/04/25  (in a docker container)
> 
> All these results are from 2.1.
> 
> I don't think I need the nearblack call as the NAIP imagery does not
> appear to have collars. So I'm removing it from the workflow for now.
> 
> The source DOQQ has these bands where band 4 is the IR:
> Band 1 Block=6472x1 Type=Byte, ColorInterp=Red
> Band 2 Block=6472x1 Type=Byte, ColorInterp=Green
> Band 3 Block=6472x1 Type=Byte, ColorInterp=Blue
> Band 4 Block=6472x1 Type=Byte, ColorInterp=Undefined
> 
> gdalwarp -t_srs EPSG:4326 -dstalpha  -co TILED=YES
> m_3311805_ne_11_1_20140513.tif epsg4326.tif
> 
> Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
> Band 2 Block=256x256 Type=Byte, ColorInterp=Undefined
> Band 3 Block=256x256 Type=Byte, ColorInterp=Undefined
> Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
> Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha
> 
> So this is annoying, but probably fixable, band 4 is the IR if I add an
> *.aux.xml file setting the color interupt, at least on 2.1, adding it on
> 1.10.1 does not help. It does not appear that it is possible to create a
> mask band only an alpha band at this point.

You need to use gdal_translate -mask to "convert" an alpha band to a mask band.

> 
> The compressing this:
> 
> gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -b 1
> -b 2 -b 3 -b 4 -mask 5 epsg4326.tif out.tif
> 
> Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
>    Mask Flags: PER_DATASET
> Band 2 Block=256x256 Type=Byte, ColorInterp=Green
>    Mask Flags: PER_DATASET
> Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
>    Mask Flags: PER_DATASET
> Band 4 Block=256x256 Type=Byte, ColorInterp=Alpha
>    Mask Flags: PER_DATASET
> 
> It dropped the source band 4 (IR)

My hypothesis is that band 4 is the IR, but with a wrong color interpretation. Perhaps use a 
VRT as an intermediate to fix color interpretations. I've done various fixes in trunk those last 
months related to color interpretation when writing TIFF.

> 
> gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG
> epsg4326.tif out2.tif
> 
> Input file size is 7232, 7056
> 0...10...20...30...40...50...60...70...80...90...100 - done.
> ERROR 1: JPEGLib:Too many color components: 5, max 4
> ERROR 1: WriteEncodedTile/Strip() failed.
> ERROR 1: JPEGLib:Too many color components: 5, max 4
> ERROR 1: WriteEncodedTile/Strip() failed.
> ERROR 1: JPEGLib:Too many color components: 5, max 4
> ERROR 1: WriteEncodedTile/Strip() failed.
> 
> So is it possible to compress multiple bands using jpeg compression?
> (other than an RGB or RGBA or RGB mask?

Yes, but you need to add -co INTERLEAVE=BAND

> 
> So, if I want to end up with a single tif file with bands (R, G, B,
> Alpha|mask, IR, sobel) that is jpeg compressed is this possible?
> 
> What is the workflow to do that?
> 
> Or is the best I can do is to create separate RGBA file, an IR file and
> a sobel file and bring them together via a VRT file?
> 
> Thanks,
>    -Steve
> 
> On 4/12/2017 2:01 PM, Even Rouault wrote:
> > On mercredi 12 avril 2017 13:23:06 CEST Stephen Woodbridge wrote:
> >  > Hi all,
> >  > 
> >  > 
> >  > 
> >  > I'm reworking my code dealing with NAIP imagery that has R, G, B, IR
> >  > bands, and I generate a mask band when reprojecting it. I also have the
> >  > option to generate another computed band based on a sobel operator.
> >  > 
> >  > In the past, I separated them R, G, B, mask into jpeg ycbcr compressed
> >  > tiff and had separate files for the IR, and the sobel data and used a
> >  > VRT file to pull all these together into a single image for additional
> >  > processing.
> >  > 
> >  > Ideally, I would like to have one file, rather than 4 files (RGB, IR,
> >  > sobel, and the VRT) because over large areas the management of all
> >  > these
> >  > files is a pain. Also when displaying and working with large areas I
> >  > need to mosaic the images into a seemless area using a vrt file or
> >  > tileindex.
> >  > 
> >  > I need a way to display the various bands, and mapserver is my tool of
> >  > choice, but I probably need to be able to display them via qgis also,
> >  > which I have not experience with but reading older posts, I might need
> >  > to create a vrt file. In mapserver I can select bands using PROCESSING
> >  > options on layers.
> >  > 
> >  > Questions?
> >  > 
> >  > 1. Does it make sense to try and do this with one tiff with 6 bands?
> >  > 2. What would be the best workflow for doing this? I'm thinking
> >  > something like:
> >  > 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170413/74c047ed/attachment-0001.html>

From woodbri at swoodbridge.com  Thu Apr 13 07:52:20 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Thu, 13 Apr 2017 10:52:20 -0400
Subject: [gdal-dev] What is the best strategy for handling multiple
 banded tiffs
In-Reply-To: <bf0caf00-cc4a-af4e-e48f-288777488763@swoodbridge.com>
References: <24db03c3-8021-4c5d-8047-2e774a9caa28@swoodbridge.com>
 <4159255.PfolhmHsHc@even-i700>
 <bf0caf00-cc4a-af4e-e48f-288777488763@swoodbridge.com>
Message-ID: <c2918bdd-b77a-a573-80cf-dae6b22a3bf5@swoodbridge.com>

Hi Even,

Thanks that helped a lot.

Here are the results I'm getting now in case they help you with color 
interp fixes. I'm not sure about the *.aux.xml files that get created 
but they do not seem to always represent all the bands that gdalinfo 
reports. In particular the alpha band does not show up in them, but that 
may be by design similar to the fact that Undefined bands also do not 
show up.

Anyway running through all these variations in options I helping me to 
get a better handle on how things work.

Your help is much appreciated and has gotten me over the immediate 
hurdles that were blocking me.

Thank you again,
   -Steve


gdalwarp -t_srs EPSG:4326 -dstalpha  -co TILED=YES 
m_3311805_ne_11_1_20140513.tif epsg4326.tif

 > Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
 > Band 2 Block=256x256 Type=Byte, ColorInterp=Undefined
 > Band 3 Block=256x256 Type=Byte, ColorInterp=Undefined
 > Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
 > Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha

I created epsg4326.tif.aux.xml like:

<PAMDataset>
   <PAMRasterBand band="1">
     <ColorInterp>Red</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="2">
     <ColorInterp>Green</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="3">
     <ColorInterp>Blue</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="4">
     <ColorInterp>Gray</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="5">
     <ColorInterp>Alpha</ColorInterp>
   </PAMRasterBand>
</PAMDataset>

and now get bands defined like as expected (the gray band is the IR):

Band 1 Block=256x256 Type=Byte, ColorInterp=Red
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
Band 4 Block=256x256 Type=Byte, ColorInterp=Gray
Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha

gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -b 1 
-b 2 -b 3 -b 4 -mask 5 epsg4326.tif out.tif

Files: out.tif
        out.tif.msk
        out.tif.aux.xml

Band 1 Block=256x256 Type=Byte, ColorInterp=Red
   Mask Flags: PER_DATASET
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
   Mask Flags: PER_DATASET
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
   Mask Flags: PER_DATASET
Band 4 Block=256x256 Type=Byte, ColorInterp=Gray
   Mask Flags: PER_DATASET

gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -co 
INTERLEAVE=BAND epsg4326.tif out2.tif

Files: out2.tif
        out2.tif.aux.xml

Band 1 Block=256x256 Type=Byte, ColorInterp=Red
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
Band 4 Block=256x256 Type=Byte, ColorInterp=Gray
Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha

with .aux.xml like:

<PAMDataset>
   <PAMRasterBand band="1">
     <ColorInterp>Red</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="2">
     <ColorInterp>Green</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="3">
     <ColorInterp>Blue</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="4">
     <ColorInterp>Gray</ColorInterp>
   </PAMRasterBand>
</PAMDataset>

gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -co 
INTERLEAVE=BAND --config GDAL_TIFF_INTERNAL_MASK YES epsg4326.tif out3.tif

Files: out3.tif
        out3.tif.aux.xml

Band 1 Block=256x256 Type=Byte, ColorInterp=Red
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
Band 4 Block=256x256 Type=Byte, ColorInterp=Gray
Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha

And the .aux.xml is the same as above.

gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -co 
INTERLEAVE=BAND -mask 5 --config GDAL_TIFF_INTERNAL_MASK YES 
epsg4326.tif out4.tif

Files: out4.tif
        out4.tif.aux.xml

Band 1 Block=256x256 Type=Byte, ColorInterp=Red
   Mask Flags: PER_DATASET
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
   Mask Flags: PER_DATASET
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
   Mask Flags: PER_DATASET
Band 4 Block=256x256 Type=Byte, ColorInterp=Gray
   Mask Flags: PER_DATASET
Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha
   Mask Flags: PER_DATASET

And the .aux.xml is the same as above.



On 4/12/2017 5:40 PM, Stephen Woodbridge wrote:
> I'm working with:
> 
> GDAL 1.10.1, released 2013/08/26 (native)
> GDAL 2.1.0, released 2016/04/25  (in a docker container)
> 
> All these results are from 2.1.
> 
> I don't think I need the nearblack call as the NAIP imagery does not 
> appear to have collars. So I'm removing it from the workflow for now.
> 
> The source DOQQ has these bands where band 4 is the IR:
> Band 1 Block=6472x1 Type=Byte, ColorInterp=Red
> Band 2 Block=6472x1 Type=Byte, ColorInterp=Green
> Band 3 Block=6472x1 Type=Byte, ColorInterp=Blue
> Band 4 Block=6472x1 Type=Byte, ColorInterp=Undefined
> 
> gdalwarp -t_srs EPSG:4326 -dstalpha  -co TILED=YES 
> m_3311805_ne_11_1_20140513.tif epsg4326.tif
> 
> Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
> Band 2 Block=256x256 Type=Byte, ColorInterp=Undefined
> Band 3 Block=256x256 Type=Byte, ColorInterp=Undefined
> Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
> Band 5 Block=256x256 Type=Byte, ColorInterp=Alpha
> 
> So this is annoying, but probably fixable, band 4 is the IR if I add an 
> *.aux.xml file setting the color interupt, at least on 2.1, adding it on 
> 1.10.1 does not help. It does not appear that it is possible to create a 
> mask band only an alpha band at this point.
> 
> The compressing this:
> 
> gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -b 1 
> -b 2 -b 3 -b 4 -mask 5 epsg4326.tif out.tif
> 
> Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
>    Mask Flags: PER_DATASET
> Band 2 Block=256x256 Type=Byte, ColorInterp=Green
>    Mask Flags: PER_DATASET
> Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
>    Mask Flags: PER_DATASET
> Band 4 Block=256x256 Type=Byte, ColorInterp=Alpha
>    Mask Flags: PER_DATASET
> 
> It dropped the source band 4 (IR)
> 
> gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG 
> epsg4326.tif out2.tif
> 
> Input file size is 7232, 7056
> 0...10...20...30...40...50...60...70...80...90...100 - done.
> ERROR 1: JPEGLib:Too many color components: 5, max 4
> ERROR 1: WriteEncodedTile/Strip() failed.
> ERROR 1: JPEGLib:Too many color components: 5, max 4
> ERROR 1: WriteEncodedTile/Strip() failed.
> ERROR 1: JPEGLib:Too many color components: 5, max 4
> ERROR 1: WriteEncodedTile/Strip() failed.
> 
> So is it possible to compress multiple bands using jpeg compression? 
> (other than an RGB or RGBA or RGB mask?
> 
> So, if I want to end up with a single tif file with bands (R, G, B, 
> Alpha|mask, IR, sobel) that is jpeg compressed is this possible?
> 
> What is the workflow to do that?
> 
> Or is the best I can do is to create separate RGBA file, an IR file and 
> a sobel file and bring them together via a VRT file?
> 
> Thanks,
>    -Steve
> 
> 
> On 4/12/2017 2:01 PM, Even Rouault wrote:
>> On mercredi 12 avril 2017 13:23:06 CEST Stephen Woodbridge wrote:
>>
>>  > Hi all,
>>
>>  >
>>
>>  > I'm reworking my code dealing with NAIP imagery that has R, G, B, IR
>>  > bands, and I generate a mask band when reprojecting it. I also have 
>> the
>>  > option to generate another computed band based on a sobel operator.
>>  >
>>  > In the past, I separated them R, G, B, mask into jpeg ycbcr compressed
>>  > tiff and had separate files for the IR, and the sobel data and used a
>>  > VRT file to pull all these together into a single image for additional
>>  > processing.
>>  >
>>  > Ideally, I would like to have one file, rather than 4 files (RGB, IR,
>>  > sobel, and the VRT) because over large areas the management of all 
>> these
>>  > files is a pain. Also when displaying and working with large areas I
>>  > need to mosaic the images into a seemless area using a vrt file or
>>  > tileindex.
>>  >
>>  > I need a way to display the various bands, and mapserver is my tool of
>>  > choice, but I probably need to be able to display them via qgis also,
>>  > which I have not experience with but reading older posts, I might need
>>  > to create a vrt file. In mapserver I can select bands using PROCESSING
>>  > options on layers.
>>  >
>>  > Questions?
>>  >
>>  > 1. Does it make sense to try and do this with one tiff with 6 bands?
>>  > 2. What would be the best workflow for doing this? I'm thinking
>>  > something like:
>>  >
>>  > # remove any collar
>>  > nearblack -co TILED=YES -of GTiff -nb 0 -near 0 -setmask -q -o 
>> temp1.tif
>>  > doqq.tif
>>  >
>>  > # warp to EPSG:4326 (does -dstalpha convert mask band to an alpha 
>> band?)
>>
>> Yes
>>
>>  > gdalwarp -t_srs EPSG:4326 -dstalpha -co TILED=YES temp1.tif rgba.tif
>>  >
>>  > # make sobel gray scale single band image
>>  > makesobel.py rgba.tif sobel.tif
>>  >
>>  > # create a temp.vrt file with bands R, G, B, Alpha|mask, IR, sobel
>>  >
>>  > # and finally build a tif using the temp.vrt
>>  > # I'm not sure what is the best way build the final tif given the mask
>>  > # and whether I should use gdalwarp or gdal_translate for this step
>>  > gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG
>>  > --CONFIG GDAL_TIFF_INTERNAL_MASK YES temp.vrt final.tif
>>
>> --> This will only work as intended if there's a mask band identified 
>> as a mask and not an alpha band in the VRT.
>>
>>  >
>>  > # and build overviews
>>  > gdaladdo -clean -r average final.tif 2 4 8 16 32 64 128
>>  >
>>  > I'm not clear on how the mask band or alpha channel(band?) interacts
>>  > with the various commands at each step in the workflow.
>>  >
>>  > Thanks,
>>  > -Steve
> 
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From Andre.Vautour at Teledyne.com  Thu Apr 13 11:52:58 2017
From: Andre.Vautour at Teledyne.com (=?iso-8859-1?Q?Vautour=2C_Andr=E9_=28INT=29?=)
Date: Thu, 13 Apr 2017 18:52:58 +0000
Subject: [gdal-dev] Limiting Oracle layers to the tables of a given schema
Message-ID: <8FD06BD4C598D8419F88B9DC4CD35FB2F94ED7@CA1-VPMSG-MBX02.TDY.Teledyne.com>

Hi all,

I started playing with the Oracle Spatial (OCI) vector driver and was surprised that the default behaviour is to look for all the tables listed in ALL_SDO_GEOM_METADATA.

I would have expected it to use all the tables in the schema (user) that was provided, so, essentially, to query USER_SDO_GEOM_METADATA. I think it would make sense to support only listing the tables in a given schema.

Assuming that the default behaviour is to remain unchanged, I am considering a couple of options:

1.       Add something like a LIST_ONLY_USER_TABLES dataset open option, which would query USER_SDO_GEOM_METADATA instead of ALL_SDO_GEOM_METADATA.

2.       Add a SCHEMA dataset open option which would query ALL_SDO_GEOM_METADATA WHERE OWNER = '<value_of_option>'

3.       Add wildcard support to the tables list, so that a user can specify something like <a_schema>.*,<another_schema>.*

Also, it might be important to note that DeleteLayer and ValidateLayer only currently work off of USER_SDO_GEOM_METADATA.

Thoughts?
André

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170413/15bd7f3a/attachment.html>

From even.rouault at spatialys.com  Thu Apr 13 12:43:01 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 13 Apr 2017 21:43:01 +0200
Subject: [gdal-dev] Limiting Oracle layers to the tables of a given
	schema
In-Reply-To: <8FD06BD4C598D8419F88B9DC4CD35FB2F94ED7@CA1-VPMSG-MBX02.TDY.Teledyne.com>
References: <8FD06BD4C598D8419F88B9DC4CD35FB2F94ED7@CA1-VPMSG-MBX02.TDY.Teledyne.com>
Message-ID: <16768520.CtGAks4tnm@even-i700>

On jeudi 13 avril 2017 18:52:58 CEST Vautour, André (INT) wrote:
> Hi all,
> 
> I started playing with the Oracle Spatial (OCI) vector driver and was
> surprised that the default behaviour is to look for all the tables listed
> in ALL_SDO_GEOM_METADATA.
> 
> I would have expected it to use all the tables in the schema (user) that was
> provided, so, essentially, to query USER_SDO_GEOM_METADATA. I think it
> would make sense to support only listing the tables in a given schema.
> 
> Assuming that the default behaviour is to remain unchanged, I am considering
> a couple of options:
> 
> 1.       Add something like a LIST_ONLY_USER_TABLES dataset open option,
> which would query USER_SDO_GEOM_METADATA instead of ALL_SDO_GEOM_METADATA.
> 
> 2.       Add a SCHEMA dataset open option which would query
> ALL_SDO_GEOM_METADATA WHERE OWNER = '<value_of_option>'
> 
> 3.       Add wildcard support to the tables list, so that a user can specify
> something like <a_schema>.*,<another_schema>.*

André,

In the PostgreSQL driver, we have

  <Option name="SCHEMAS" type="string" description="Restricted sets of schemas to 
explore (comma separated)" />

Sothat would be something close to your 3.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170413/eaecfc4d/attachment.html>

From even.rouault at spatialys.com  Fri Apr 14 01:10:04 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 14 Apr 2017 10:10:04 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
Message-ID: <2453387.3za1Omjnzt@even-i700>

Hi,

I have prepared the GDAL/OGR 2.2.0 Beta 1 release.  It will potentially be followed by a 
second beta, or directly by a RC1 if things go well.  The source is available at:

    http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta1.tar.xz
    http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta1.tar.gz
    http://download.osgeo.org/gdal/2.2.0/gdal220beta1.zip

A snapshot of the Python autotest suite can be downloaded from:

    http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta1.tar.gz
    http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta1.zip

The GRASS plugin is available at

    http://download.osgeo.org/gdal/2.2.0/gdal-grass-2.2.0beta1.tar.gz

The NEWS is available at :
      http://svn.osgeo.org/gdal/branches/2.2/gdal/NEWS

New bugs found should be filed in Trac normally.

    http://trac.osgeo.org/gdal

GDAL developers and users are encouraged to treat the next 2 weeks
as the prime time for bug finding and fixing.

I have created the GDAL 2.2 branch from current trunk, so new developments can occur in 
trunk. Bug fixes that apply to 2.2 should be committed in both trunk and branches/2.2

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170414/28928081/attachment.html>

From lucena_ivan at hotmail.com  Thu Apr 13 12:41:44 2017
From: lucena_ivan at hotmail.com (Ivan Lucena)
Date: Thu, 13 Apr 2017 19:41:44 +0000
Subject: [gdal-dev] Limiting Oracle layers to the tables of a given
	schema
In-Reply-To: <8FD06BD4C598D8419F88B9DC4CD35FB2F94ED7@CA1-VPMSG-MBX02.TDY.Teledyne.com>
References: <8FD06BD4C598D8419F88B9DC4CD35FB2F94ED7@CA1-VPMSG-MBX02.TDY.Teledyne.com>
Message-ID: <MWHPR19MB132853B9E7608DE5D7DA878BF2020@MWHPR19MB1328.namprd19.prod.outlook.com>

According to the doc:
"If the list of tables is not provided, then all tables appearing in ALL_SDO_GEOM_METADATA will be treated by OGR as layers with the table names as the layer names. Non-spatial tables or spatial tables not listed in the ALL_SDO_GEOM_METADATA table are not accessible unless explicitly listed in the datasource name. Even in databases where all desired layers are in the ALL_SDO_GEOM_METADATA table, it may be desirable to list only the tables to be used as this can substantially reduce initialization time in databases with many tables."

You might avoiding that issue by entering an empty table list when loading, like in "OCI:usr/pwd at db:". Please note the ":" at the end.

On Apr 13, 2017, at 2:54 PM, Vautour, André (INT) <Andre.Vautour at Teledyne.com<mailto:Andre.Vautour at Teledyne.com>> wrote:

Hi all,

I started playing with the Oracle Spatial (OCI) vector driver and was surprised that the default behaviour is to look for all the tables listed in ALL_SDO_GEOM_METADATA.

I would have expected it to use all the tables in the schema (user) that was provided, so, essentially, to query USER_SDO_GEOM_METADATA. I think it would make sense to support only listing the tables in a given schema.

Assuming that the default behaviour is to remain unchanged, I am considering a couple of options:

1.       Add something like a LIST_ONLY_USER_TABLES dataset open option, which would query USER_SDO_GEOM_METADATA instead of ALL_SDO_GEOM_METADATA.

2.       Add a SCHEMA dataset open option which would query ALL_SDO_GEOM_METADATA WHERE OWNER = '<value_of_option>'

3.       Add wildcard support to the tables list, so that a user can specify something like <a_schema>.*,<another_schema>.*

Also, it might be important to note that DeleteLayer and ValidateLayer only currently work off of USER_SDO_GEOM_METADATA.

Thoughts?
André

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170413/fa42fd83/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Apr 14 07:04:17 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 14 Apr 2017 07:04:17 -0700 (MST)
Subject: [gdal-dev] Limiting Oracle layers to the tables of a given
 schema
In-Reply-To: <8FD06BD4C598D8419F88B9DC4CD35FB2F94ED7@CA1-VPMSG-MBX02.TDY.Teledyne.com>
References: <8FD06BD4C598D8419F88B9DC4CD35FB2F94ED7@CA1-VPMSG-MBX02.TDY.Teledyne.com>
Message-ID: <1492178657781-5317319.post@n6.nabble.com>

Vautour, André (INT) wrote
> Hi all,
> 
> I started playing with the Oracle Spatial (OCI) vector driver and was
> surprised that the default behaviour is to look for all the tables listed
> in ALL_SDO_GEOM_METADATA.
> 
> I would have expected it to use all the tables in the schema (user) that
> was provided, so, essentially, to query USER_SDO_GEOM_METADATA. I think it
> would make sense to support only listing the tables in a given schema.

Hi,

There are for sure different opinions but I consider that it does make more
sense to use ALL_SDO_GEOM_METADATA. In our environment the database admins
create tables and grant minimal rights for the normal user accounts so
USER_SDO_GEOM_METADATA is usually empty for our GIS users.

A reference about the difference taken from
http://gerardnico.com/wiki/oracle_spatial/metadata

/    USER_SDO_GEOM_METADATA contains metadata information for all spatial
tables owned by the user (schema). This is the only view that you can
update, and it is the one in which Spatial users must insert metadata
related to spatial tables.
    ALL_SDO_GEOM_METADATA contains metadata information for all spatial
tables on which the user has SELECT permission./

If user has select rights for a table then why not to make it visible also
through GDAL? If GDAL sees some table that you think it should not, remove
the SELECT permission from the user and it disappears.

-Jukka Rahkonen-




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Limiting-Oracle-layers-to-the-tables-of-a-given-schema-tp5317259p5317319.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From schwehr at gmail.com  Fri Apr 14 07:59:43 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 14 Apr 2017 07:59:43 -0700
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <2453387.3za1Omjnzt@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
Message-ID: <CACmBxysLMKC7Ji33zOyE_vnNw4UqRXM81aCt01Gf3mwatvLaxg@mail.gmail.com>

Even,

Thanks for your hard work!

I did a quick mac osx fink build and spot checks with autotest - build
looks good.

A quick check of NEWS:

Kakadu v7.9.1 works for me.  The line "add support for Kakadu v7.8" should
probably be something like:

add support for Kakadu v7.9.1.  v7.8 should not be used.  It has a bug
fixed in v7.9.


Should be 9.0:

OGRSpatialReference:
 * Upgrade to EPSG database v8.9  <----- Upgrade to EPSG database v9.0
(#6772)


On Fri, Apr 14, 2017 at 1:10 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
>
>
> I have prepared the GDAL/OGR 2.2.0 Beta 1 release. It will potentially be
> followed by a second beta, or directly by a RC1 if things go well. The
> source is available at:
>
>
>
> http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta1.tar.xz
>
> http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta1.tar.gz
>
> http://download.osgeo.org/gdal/2.2.0/gdal220beta1.zip
>
>
>
> A snapshot of the Python autotest suite can be downloaded from:
>
>
>
> http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta1.tar.gz
>
> http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta1.zip
>
>
>
> The GRASS plugin is available at
>
>
>
> http://download.osgeo.org/gdal/2.2.0/gdal-grass-2.2.0beta1.tar.gz
>
>
>
> The NEWS is available at :
>
> http://svn.osgeo.org/gdal/branches/2.2/gdal/NEWS
>
>
>
> New bugs found should be filed in Trac normally.
>
>
>
> http://trac.osgeo.org/gdal
>
>
>
> GDAL developers and users are encouraged to treat the next 2 weeks
>
> as the prime time for bug finding and fixing.
>
>
>
> I have created the GDAL 2.2 branch from current trunk, so new developments
> can occur in trunk. Bug fixes that apply to 2.2 should be committed in both
> trunk and branches/2.2
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170414/503187a3/attachment.html>

From even.rouault at spatialys.com  Fri Apr 14 08:09:58 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 14 Apr 2017 17:09:58 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <CACmBxysLMKC7Ji33zOyE_vnNw4UqRXM81aCt01Gf3mwatvLaxg@mail.gmail.com>
References: <2453387.3za1Omjnzt@even-i700>
 <CACmBxysLMKC7Ji33zOyE_vnNw4UqRXM81aCt01Gf3mwatvLaxg@mail.gmail.com>
Message-ID: <3868969.Y96mjf89LI@even-i700>

On vendredi 14 avril 2017 07:59:43 CEST Kurt Schwehr wrote:
> Even,
> 
> Thanks for your hard work!
> 
> I did a quick mac osx fink build and spot checks with autotest - build
> looks good.
> 
> A quick check of NEWS:
> 
> Kakadu v7.9.1 works for me.  The line "add support for Kakadu v7.8" should
> probably be something like:
> 
> add support for Kakadu v7.9.1.  v7.8 should not be used.  It has a bug
> fixed in v7.9.
> 
> 
> Should be 9.0:
> 
> OGRSpatialReference:
>  * Upgrade to EPSG database v8.9  <----- Upgrade to EPSG database v9.0
> (#6772)

I let you commit those changes and any other you may find appropriate? It certainly needs 
double checking.

Eve

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170414/022e00c7/attachment.html>

From gupta.sandeep at gmail.com  Fri Apr 14 08:10:34 2017
From: gupta.sandeep at gmail.com (Sandeep Gupta)
Date: Fri, 14 Apr 2017 11:10:34 -0400
Subject: [gdal-dev] compiling gdal and linking with postgis
Message-ID: <CAAywg7vgCrND49kbueFqnwB3XcpPm1RniLRAaJK5t07mVU9=WQ@mail.gmail.com>

Hi,

 I have tried three version of gdal but this problem exists:

 The gdal compiles fine but when I build postgis with the compiled
 gdal then I get following error:

 libtool: link: cannot find the library
`/home/vagrant/pisi/tmp/libjpeg-7.0-3/usr/lib/libjpeg.la'

 This dependency is coming from gdal and most likely from this file:
 gdal-2.1.3/.libs/libgdal.lai

 Which looks like this:
dependency_libs=' -lexpat
/home/vagrant/pisi/tmp/libjpeg-7.0-3/usr/lib/libjpeg.la
/home/vagrant/pisi/tmp/libpng-1.6.12-3/usr/lib/libpng.la
-L/home/vagrant/src/master-env/lib
-L/home/pgxxc/easybuild/software/shad
owfax-westmere/PostgreSQL/9.6.2-foss-2016b-Python-2.7.12/lib -lpq
-lpthread -lrt -L/apps/packages/math/epd/7.6-3/lib -lcurl
/home/vagrant/pisi/tmp/libxml2-2.9.2-2/usr/lib/libxml2.la -lz -ldl
/cm/shared/apps/gcc/
4.8.4/lib/../lib64/libstdc++.la'


 I didn't find anything in configure etc. that can turn off depndency
on vagrant/pisi.

Thanks.
san

From sfkeller at gmail.com  Fri Apr 14 08:19:05 2017
From: sfkeller at gmail.com (Stefan Keller)
Date: Fri, 14 Apr 2017 17:19:05 +0200
Subject: [gdal-dev] Vector Tiles in OGR
In-Reply-To: <661A1F30-F0B6-4514-92A1-B9782D109958@gmail.com>
References: <CAH-RUCSWA55kmEW6=tH0=xb7qUFm9R4oJ6iBSxdeSrnetyRM0g@mail.gmail.com>
 <CAPxHBh_-i1i8_85J517SWUo8N1GB9557Om4CvRwi4iMxTXswOQ@mail.gmail.com>
 <CAH-RUCQwki_Di08JCy2C8E8RkR3X3AdLjRQXo-312EWOVobL3g@mail.gmail.com>
 <CAFcOn2-rF8_=wC6Y5dpmmbLHccN2SG6Qqj_GNsEuzbKF+1ocpA@mail.gmail.com>
 <661A1F30-F0B6-4514-92A1-B9782D109958@gmail.com>
Message-ID: <CAFcOn2_FJ02nGBeBcpkv2BwOPwrafK30hq4zfE_6Jb4rx1K0zQ@mail.gmail.com>

Hi,

@All FYI: We just released an experimental MVT reader for QGIS:
http://plugins.qgis.org/plugins/Vector-Tiles-Reader-QGIS-Plugin/
Pls. test :-)

@Blake:
1. Because QGIS needs to know the CRS we have a problem, since the
TileJSON spec. leaves this open. There are already non-Mercator MVT
products emerging and our plugin needs to know it. Petr already
mentioned to me the he's using the "crs" key and made proposal to the
TileJSON spec. 2.2.0 but I can't see it (no issue there
https://github.com/mapbox/tilejson-spec/issues ).
What do you think?

2. We also encoutered a problem when a TileJSON does not contain the
«bounds» key (or value).
Any ideas?

:Stefan

P.S. @Even: Any news on a GDAL/OGR MVT reader?


2016-01-31 23:22 GMT+01:00 Flippmoke <flippmoke at gmail.com>:
> All,
>
> The first thing that is going to be required likely is a good generic c++ library for encoding and decoding vector tiles IMO.
>
> I have spent a lot of time working on developing the mapnik vector tile library to be a solid implementation, especially around all the work done for 2.0 of Mapbox vector tile specification. I would love to eventually help make this a generalized implementation so that it is portable to a library like GDAL.
>
> We have talked about doing something like this at Mapbox but will require a good deal of time, so it hasn't been pushed forward yet. The other issues that come to mind to me is that some of the libraries that mapnik vector tile depends upon most likely need good custom implementations if we wanted to make it more generic.
>
> The reason for this is that I would prefer for it to be a header only library with no dependencies. Adding more dependencies for GDAL seems like it could be a mess.
>
> Blake Thompson
>
>> On Jan 31, 2016, at 10:10 AM, Stefan Keller <sfkeller at gmail.com> wrote:
>>
>> Hi Petr, Blake, Even and everybody
>>
>> I'm (besides Petr) the other maintainer of OSM2VectorTiles.
>> I'd already asked Even a similar question.
>> I'm advising now an intern to implement such a MVT Vector Tiles reader
>> client in Python if possible as part of a QGIS plugin.
>> And I'm interested not to do redundant implementations.
>> Are there any news on this matter?
>>
>> :Stefan
>> Prof. at HSR and leader of Geometa Lab
>>
>> @Even: Regarding OGR MVT development can you send to me (directly) a
>> contact name of the group which won the bidding?
>>
>>
>> 2016-01-06 15:24 GMT+01:00 Petr Pridal <petr.pridal at klokantech.com>:
>>> Hi everybody,
>>>
>>> thanks for the comments. Regarding the technical details:
>>>
>>>> Each Tile is its own discrete dataset therefore the hardest part would be
>>>> merging of features into the original features across tiles. You could use
>>>> some complicated merging technique, but that could be very expensive.
>>>
>>>
>>> The driver could require "id" parameter, which specifies name of an
>>> attribute with unique identifier on the features shared across the tiles.
>>> Both MapBox vector tiles and OSM2VectorTiles tiles have an unique non-zero
>>> "osm_id" in place. The first version of driver could read only features with
>>> such ID. The identifier does not have to be always filled, but often it is,
>>> especially in deeper zoom levels derived purely from OpenStreetMap - but
>>> yeh, a completely general stitching would be much harder.
>>>
>>> The clipping + merging of shapes itself can be implemented with underlaying
>>> GEOS library functions.
>>>
>>> BTW It is possible to examine vector tiles data in pure JavaScript X-Ray
>>> viewer (no WebGL support on browser required) made in OpenLayers3:
>>> http://klokantech.github.io/ol3-sandbox/vector/xray.html
>>>
>>> or with WebGL-enabled webbrowser with higher performance MapBox GL JS
>>> powered X-Ray:
>>> http://klokantech.github.io/mapbox-gl-js-offline-example/xray.html
>>>
>>> A debug viewer for each vector tile (made in OL3) decoded in pure
>>> JavaScript:
>>> http://klokantech.github.io/ol3-sandbox/vector/tile-inspector.html
>>>
>>> The OGR driver could be also practical for the unsimplified / ungeneralised
>>> MBTiles with OSM data available at: http://osmlab.github.io/osm-qa-tiles/
>>>
>>>>
>>>> If you wanted to simply view vector tile data it could get confusing as
>>>> well since most vector tiles need a buffer when they are used for
>>>> visualization programs. This is important for things like labeling on maps
>>>> etc. Therefore, you could get a large amount of overlapping data on tiles if
>>>> you loaded them all in at once.
>>>
>>>
>>> Clipping on border of each tile must be applied before stitching the vector
>>> features together  - so the buffer is removed. Buffer is there only for
>>> visualisation and labeling.
>>>
>>>>
>>>> As far as writing a simple decoder -- the mapnik-vector-tile decoder isn't
>>>> currently able to decode vector tiles into a form not supported by mapnik.
>>>> Therefore, OGR would not be able to easily use this.
>>>
>>>
>>> Correct. It can't be used directly (GDAL can't link against), but the
>>> relevant code can be extracted and reused directly. For basic decoding
>>> critical is the Protobuf library (which is already in GDAL) and
>>> https://github.com/mapbox/mapnik-vector-tile/blob/master/proto/vector_tile.proto
>>> + the code for converting pixel coordinates in features to relevant geo
>>> coordinates and GEOS-based merging of features.
>>>
>>>> We plan to write a generalized encoder and decoder eventually so that any
>>>> other library can plugin with out the mapnik requirement.
>>>
>>>
>>> This would be amazing.
>>>
>>>> If you have any questions specifically about Mapnik Vector Tile or the
>>>> Mapbox Vector Tile Specification feel free to ask me. I would note that you
>>>> guys will want to update your vector tiles once the V2 specification changes
>>>> are into Mapnik-Vector-Tile.
>>>
>>>
>>> Cool! Thanks. Our world tiles are generated via Docker containers on a
>>> cluster of computers - using Mapnik via Tilelive directly - so upgrades on
>>> Mapnik-Vector-Tile will propagate to the open-source rendering software.
>>> I expect V2 spec will mean also new MapBox Streets V7, right?
>>>
>>>> I see you mention MVT in MBTiles. Is it a recognized practice ? I don't
>>>> see
>>>> mention of that neither in the MVT spec (
>>>> https://github.com/mapbox/vector-
>>>> tile-spec/tree/master/2.0 ) nor the MBTiles one (
>>>> https://github.com/mapbox/mbtiles-spec/blob/master/1.2/spec.md ), although
>>>> I
>>>> guess it is just a matter of storing a MVT blob in the tile_data column.
>>>
>>>
>>> Yes. MapBox Studio Classic generates such MBTiles with Vector Tiles inside -
>>> and Mapnik reads them directly when rasterising. Storing the vector tiles in
>>> SQLite make sense - and it simplifies deployment, and you can then easily
>>> have complete world on each node of a cluster of tileservers. If you don't
>>> want to upgrade your base map too often, this approach is pretty efficient
>>> and removes the centralised database as typical bottleneck.
>>>
>>> I did some tests on vector tiles vs raster in MBTiles and documented these
>>> in README.md at and https://github.com/klokantech/vector-tiles-sample before
>>> we started to work on OSM2VectorTiles project.
>>> There are also sample data and offline MapBox GL JS viewer in that repo.
>>> Vector tiles can be hosted also "unpacked", just as files in folders on a
>>> standard web server - exactly like GDAL2Tiles or MapTiler.com does by
>>> default for raster tiles.
>>>
>>> If OGR driver is implemented, the primary source should be probably reading
>>> from an URL via curl.
>>>
>>> Reading PBFs from an MBTiles (or another SQLite) is just the most practical
>>> portable alternative to it.
>>>
>>> Technically people may store the tiles in different ways - for example
>>> Wikimedia guys (http://maps.wikimedia.org/ and
>>> https://github.com/kartotherian/) use Cassandra for tile storage, I guess
>>> MapBox internally is also on a different storage for production servers ...
>>> for transfers and streaming tilesets there is the  - but tiles are ALWAYS
>>> exposed via HTTP.
>>>
>>> Regards,
>>>
>>> Petr
>>> --
>>> Petr Pridal, Ph.D.
>>> CEO
>>>
>>> Klokan Technologies GmbH
>>> Hofnerstrasse 98, 6314 Unterageri, Switzerland
>>> Tel: +41 (0)41 511 26 12
>>> Email: info at klokantech.com
>>> Web: http://www.klokantech.com/
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> http://lists.osgeo.org/mailman/listinfo/gdal-dev

From mateusz at loskot.net  Fri Apr 14 09:18:15 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 14 Apr 2017 18:18:15 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <2453387.3za1Omjnzt@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
Message-ID: <CABUeae_BKU3i=Ar8ab-tSGOXiKqkLZ4Pf3E7Qvhd_nGwoDEyew@mail.gmail.com>

On 14 April 2017 at 10:10, Even Rouault <even.rouault at spatialys.com> wrote:
>
> I have prepared the GDAL/OGR 2.2.0 Beta 1 release. It will potentially be
> followed by a second beta, or directly by a RC1 if things go well.
> [...]
> GDAL developers and users are encouraged to treat the next 2 weeks
> as the prime time for bug finding and fixing.

I'm still polishing the JPEG XR driver, so it won't make it into 2.2.0,
but trunk and next release.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From woodbri at swoodbridge.com  Fri Apr 14 10:39:12 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Fri, 14 Apr 2017 13:39:12 -0400
Subject: [gdal-dev] A couple of new issues with gdal
Message-ID: <a0a962b6-8dcb-55f9-cf14-b80f31eced7b@swoodbridge.com>

Hi Even,

GDAL 2.1.0, released 2016/04/25

I'm pretty happy with the new workflow so far, but have te following 
minor issues.

The color interp is still problematic with gdalinfo, even though the 
*.aux.xml file looks correct, except it is missing the Alpha band. I 
generated the final tif using a VRT that defined the the color interp.

The second issue is that I'm getting a lot of:
    Warning 1: JPEGLib:Premature end of JPEG file
messages when I run gdaladdo

When I try to display it with imagemagick it complains that it is 
PhotometricInterpretation=4, (ie: a Transparency Mask) which seems to 
make sense since I asked for a mask.

-Steve

I've reduced my processing to the following steps:

1. create a sobel image from the source tif with the same georeferencing
2. gdalwarp it to EPSG:4326 in tempfile2

3. gdalwarp source tif to EPSG:4326 in tempfile1
gdalwarp -t_srs EPSG:4326 -dstalpha -co TILED=YES \
src/33118/m_3311814_nw_11_1_20140513.tif \
tmp/116-1-m_3311814_nw_11_1_20140513.tif

4. generate a vrt with
         # a band = [filename, src_band_no, color_interp]
         bands = [ [tempfile1, 1, 'Red'],
                   [tempfile1, 2, 'Green'],
                   [tempfile1, 3, 'Blue'],
                   [tempfile1, 4, 'Gray'],   # IR band
                   [tempfile2, 1, 'Gray'],   # Sobel band to add
                   [tempfile1, 5, 'Alpha'] ] # Alpha band

and each VRTRasterBand looks like:
'''
           <VRTRasterBand dataType="{0}" band="{1:d}">
             <ColorInterp>{2}</ColorInterp>
             <SimpleSource>
             <SourceFilename relativeToVRT="1">{3}</SourceFilename>
             <SourceBand>{4:d}</SourceBand>
             <SrcRect xOff="0" yOff="0" xSize="{5:d}" ySize="{6:d}"/>
             <DstRect xOff="0" yOff="0" xSize="{5:d}" ySize="{6:d}"/>
             </SimpleSource>
           </VRTRasterBand>'''

5. translate vrt to tiff and compress it
gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -co 
INTERLEAVE=BAND -mask 6 --config GDAL_TIFF_INTERNAL_MASK YES \
tmp/116-2-m_3311814_nw_11_1_20140513.vrt \
dest/m_3311814_nw_11_1_20140513.tif

$ gdalinfo dest/m_3311814_nw_11_1_20140513.tif
Driver: GTiff/GeoTIFF
Files: dest/m_3311805_ne_11_1_20140513.tif
        dest/m_3311805_ne_11_1_20140513.tif.aux.xml
Size is 7232, 7056
Coordinate System is:
GEOGCS["WGS 84",
     DATUM["WGS_1984",
         SPHEROID["WGS 84",6378137,298.257223563,
             AUTHORITY["EPSG","7030"]],
         AUTHORITY["EPSG","6326"]],
     PRIMEM["Greenwich",0],
     UNIT["degree",0.0174532925199433],
     AUTHORITY["EPSG","4326"]]
Origin = (-118.441851318576212,34.003461706049677)
Pixel Size = (0.000009839810447,-0.000009839810447)
Metadata:
   AREA_OR_POINT=Area
Image Structure Metadata:
   COMPRESSION=JPEG
   INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-118.4418513,  34.0034617) (118d26'30.66"W, 34d 0'12.46"N)
Lower Left  (-118.4418513,  33.9340320) (118d26'30.66"W, 33d56' 2.52"N)
Upper Right (-118.3706898,  34.0034617) (118d22'14.48"W, 34d 0'12.46"N)
Lower Right (-118.3706898,  33.9340320) (118d22'14.48"W, 33d56' 2.52"N)
Center      (-118.4062706,  33.9687469) (118d24'22.57"W, 33d58' 7.49"N)
Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
   Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111, 
57x56
   Mask Flags: PER_DATASET
   Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441, 
226x221, 113x111, 57x56
Band 2 Block=256x256 Type=Byte, ColorInterp=Undefined
   Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111, 
57x56
   Mask Flags: PER_DATASET
   Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441, 
226x221, 113x111, 57x56
Band 3 Block=256x256 Type=Byte, ColorInterp=Undefined
   Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111, 
57x56
   Mask Flags: PER_DATASET
   Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441, 
226x221, 113x111, 57x56
Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
   Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111, 
57x56
   Mask Flags: PER_DATASET
   Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441, 
226x221, 113x111, 57x56
Band 5 Block=256x256 Type=Byte, ColorInterp=Undefined
   Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111, 
57x56
   Mask Flags: PER_DATASET
   Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441, 
226x221, 113x111, 57x56
Band 6 Block=256x256 Type=Byte, ColorInterp=Alpha
   Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111, 
57x56
   Mask Flags: PER_DATASET
   Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441, 
226x221, 113x111, 57x56


dest/m_3311805_ne_11_1_20140513.tif.aux.xml
<PAMDataset>
   <PAMRasterBand band="1">
     <ColorInterp>Red</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="2">
     <ColorInterp>Green</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="3">
     <ColorInterp>Blue</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="4">
     <ColorInterp>Gray</ColorInterp>
   </PAMRasterBand>
   <PAMRasterBand band="5">
     <ColorInterp>Gray</ColorInterp>
   </PAMRasterBand>
</PAMDataset>


6. add overviews to tiff
gdaladdo -clean -r average dest/33118/m_3311814_nw_11_1_20140513.tif
  2 4 8 16 32 64 128

I get lots of Warnings:
Warning 1: JPEGLib:Premature end of JPEG file

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Fri Apr 14 11:06:59 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 14 Apr 2017 20:06:59 +0200
Subject: [gdal-dev] A couple of new issues with gdal
In-Reply-To: <a0a962b6-8dcb-55f9-cf14-b80f31eced7b@swoodbridge.com>
References: <a0a962b6-8dcb-55f9-cf14-b80f31eced7b@swoodbridge.com>
Message-ID: <4058083.oD2QGGcJxf@even-i700>

On vendredi 14 avril 2017 13:39:12 CEST Stephen Woodbridge wrote:
> Hi Even,
> 
> GDAL 2.1.0, released 2016/04/25
> 
> I'm pretty happy with the new workflow so far, but have te following
> minor issues.
> 
> The color interp is still problematic with gdalinfo, even though the
> *.aux.xml file looks correct, except it is missing the Alpha band. I
> generated the final tif using a VRT that defined the the color interp.
> 
> The second issue is that I'm getting a lot of:
>     Warning 1: JPEGLib:Premature end of JPEG file
> messages when I run gdaladdo

Can you provide a fully reproducable (ie all input files and scripts) procedure so that others 
can try easily ? Ideally with smallish files, etc

> 
> When I try to display it with imagemagick it complains that it is
> PhotometricInterpretation=4, (ie: a Transparency Mask) which seems to
> make sense since I asked for a mask.
> 
> -Steve
> 
> I've reduced my processing to the following steps:
> 
> 1. create a sobel image from the source tif with the same georeferencing
> 2. gdalwarp it to EPSG:4326 in tempfile2
> 
> 3. gdalwarp source tif to EPSG:4326 in tempfile1
> gdalwarp -t_srs EPSG:4326 -dstalpha -co TILED=YES \
> src/33118/m_3311814_nw_11_1_20140513.tif \
> tmp/116-1-m_3311814_nw_11_1_20140513.tif
> 
> 4. generate a vrt with
>          # a band = [filename, src_band_no, color_interp]
>          bands = [ [tempfile1, 1, 'Red'],
>                    [tempfile1, 2, 'Green'],
>                    [tempfile1, 3, 'Blue'],
>                    [tempfile1, 4, 'Gray'],   # IR band
>                    [tempfile2, 1, 'Gray'],   # Sobel band to add
>                    [tempfile1, 5, 'Alpha'] ] # Alpha band
> 
> and each VRTRasterBand looks like:
> '''
>            <VRTRasterBand dataType="{0}" band="{1:d}">
>              <ColorInterp>{2}</ColorInterp>
>              <SimpleSource>
>              <SourceFilename relativeToVRT="1">{3}</SourceFilename>
>              <SourceBand>{4:d}</SourceBand>
>              <SrcRect xOff="0" yOff="0" xSize="{5:d}" ySize="{6:d}"/>
>              <DstRect xOff="0" yOff="0" xSize="{5:d}" ySize="{6:d}"/>
>              </SimpleSource>
>            </VRTRasterBand>'''
> 
> 5. translate vrt to tiff and compress it
> gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -co
> INTERLEAVE=BAND -mask 6 --config GDAL_TIFF_INTERNAL_MASK YES \
> tmp/116-2-m_3311814_nw_11_1_20140513.vrt \
> dest/m_3311814_nw_11_1_20140513.tif
> 
> $ gdalinfo dest/m_3311814_nw_11_1_20140513.tif
> Driver: GTiff/GeoTIFF
> Files: dest/m_3311805_ne_11_1_20140513.tif
>         dest/m_3311805_ne_11_1_20140513.tif.aux.xml
> Size is 7232, 7056
> Coordinate System is:
> GEOGCS["WGS 84",
>      DATUM["WGS_1984",
>          SPHEROID["WGS 84",6378137,298.257223563,
>              AUTHORITY["EPSG","7030"]],
>          AUTHORITY["EPSG","6326"]],
>      PRIMEM["Greenwich",0],
>      UNIT["degree",0.0174532925199433],
>      AUTHORITY["EPSG","4326"]]
> Origin = (-118.441851318576212,34.003461706049677)
> Pixel Size = (0.000009839810447,-0.000009839810447)
> Metadata:
>    AREA_OR_POINT=Area
> Image Structure Metadata:
>    COMPRESSION=JPEG
>    INTERLEAVE=BAND
> Corner Coordinates:
> Upper Left  (-118.4418513,  34.0034617) (118d26'30.66"W, 34d 0'12.46"N)
> Lower Left  (-118.4418513,  33.9340320) (118d26'30.66"W, 33d56' 2.52"N)
> Upper Right (-118.3706898,  34.0034617) (118d22'14.48"W, 34d 0'12.46"N)
> Lower Right (-118.3706898,  33.9340320) (118d22'14.48"W, 33d56' 2.52"N)
> Center      (-118.4062706,  33.9687469) (118d24'22.57"W, 33d58' 7.49"N)
> Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
>    Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 57x56
>    Mask Flags: PER_DATASET
>    Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 226x221, 113x111, 57x56
> Band 2 Block=256x256 Type=Byte, ColorInterp=Undefined
>    Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 57x56
>    Mask Flags: PER_DATASET
>    Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 226x221, 113x111, 57x56
> Band 3 Block=256x256 Type=Byte, ColorInterp=Undefined
>    Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 57x56
>    Mask Flags: PER_DATASET
>    Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 226x221, 113x111, 57x56
> Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
>    Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 57x56
>    Mask Flags: PER_DATASET
>    Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 226x221, 113x111, 57x56
> Band 5 Block=256x256 Type=Byte, ColorInterp=Undefined
>    Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 57x56
>    Mask Flags: PER_DATASET
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170414/469b2fea/attachment-0001.html>

From woodbri at swoodbridge.com  Fri Apr 14 12:54:50 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Fri, 14 Apr 2017 15:54:50 -0400
Subject: [gdal-dev] A couple of new issues with gdal
In-Reply-To: <4058083.oD2QGGcJxf@even-i700>
References: <a0a962b6-8dcb-55f9-cf14-b80f31eced7b@swoodbridge.com>
 <4058083.oD2QGGcJxf@even-i700>
Message-ID: <4044a64a-b62c-4d3a-2260-75d2e511e19a@swoodbridge.com>

Even,

http://imaptools.com:8080/dl/sew-tmp.tbz

See the README.txt file for an explanation. There is a run.log that 
shows what gdal commands were run and various intermediate tif/vrt 
files. I chopped out a 900x900 image from a full DOQQ, which is also 
included.

For some context, I building a workflow that will be able to fetch 
DOQQs, prep them, segmentize them, and then either train or search for 
objects using scikit machine learning. This particular part of the 
workflow is in the prep stage. A lot of the workflow is being built 
around the ability to manage large datasets of imagery. For example 
California has something like 10-11,000 DOQQs.

Anyway, let me know if you need more info.

Thanks,
   -Steve

On 4/14/2017 2:06 PM, Even Rouault wrote:
> On vendredi 14 avril 2017 13:39:12 CEST Stephen Woodbridge wrote:
> 
>  > Hi Even,
> 
>  >
> 
>  > GDAL 2.1.0, released 2016/04/25
> 
>  >
> 
>  > I'm pretty happy with the new workflow so far, but have te following
> 
>  > minor issues.
> 
>  >
> 
>  > The color interp is still problematic with gdalinfo, even though the
> 
>  > *.aux.xml file looks correct, except it is missing the Alpha band. I
> 
>  > generated the final tif using a VRT that defined the the color interp.
> 
>  >
> 
>  > The second issue is that I'm getting a lot of:
> 
>  > Warning 1: JPEGLib:Premature end of JPEG file
> 
>  > messages when I run gdaladdo
> 
> Can you provide a fully reproducable (ie all input files and scripts) 
> procedure so that others can try easily ? Ideally with smallish files, etc
> 
>  >
> 
>  > When I try to display it with imagemagick it complains that it is
> 
>  > PhotometricInterpretation=4, (ie: a Transparency Mask) which seems to
> 
>  > make sense since I asked for a mask.
> 
>  >
> 
>  > -Steve
> 
>  >
> 
>  > I've reduced my processing to the following steps:
> 
>  >
> 
>  > 1. create a sobel image from the source tif with the same georeferencing
> 
>  > 2. gdalwarp it to EPSG:4326 in tempfile2
> 
>  >
> 
>  > 3. gdalwarp source tif to EPSG:4326 in tempfile1
> 
>  > gdalwarp -t_srs EPSG:4326 -dstalpha -co TILED=YES \
> 
>  > src/33118/m_3311814_nw_11_1_20140513.tif \
> 
>  > tmp/116-1-m_3311814_nw_11_1_20140513.tif
> 
>  >
> 
>  > 4. generate a vrt with
> 
>  > # a band = [filename, src_band_no, color_interp]
> 
>  > bands = [ [tempfile1, 1, 'Red'],
> 
>  > [tempfile1, 2, 'Green'],
> 
>  > [tempfile1, 3, 'Blue'],
> 
>  > [tempfile1, 4, 'Gray'], # IR band
> 
>  > [tempfile2, 1, 'Gray'], # Sobel band to add
> 
>  > [tempfile1, 5, 'Alpha'] ] # Alpha band
> 
>  >
> 
>  > and each VRTRasterBand looks like:
> 
>  > '''
> 
>  > <VRTRasterBand dataType="{0}" band="{1:d}">
> 
>  > <ColorInterp>{2}</ColorInterp>
> 
>  > <SimpleSource>
> 
>  > <SourceFilename relativeToVRT="1">{3}</SourceFilename>
> 
>  > <SourceBand>{4:d}</SourceBand>
> 
>  > <SrcRect xOff="0" yOff="0" xSize="{5:d}" ySize="{6:d}"/>
> 
>  > <DstRect xOff="0" yOff="0" xSize="{5:d}" ySize="{6:d}"/>
> 
>  > </SimpleSource>
> 
>  > </VRTRasterBand>'''
> 
>  >
> 
>  > 5. translate vrt to tiff and compress it
> 
>  > gdal_translate -co TILED=YES -co JPEG_QUALITY=90 -co COMPRESS=JPEG -co
> 
>  > INTERLEAVE=BAND -mask 6 --config GDAL_TIFF_INTERNAL_MASK YES \
> 
>  > tmp/116-2-m_3311814_nw_11_1_20140513.vrt \
> 
>  > dest/m_3311814_nw_11_1_20140513.tif
> 
>  >
> 
>  > $ gdalinfo dest/m_3311814_nw_11_1_20140513.tif
> 
>  > Driver: GTiff/GeoTIFF
> 
>  > Files: dest/m_3311805_ne_11_1_20140513.tif
> 
>  > dest/m_3311805_ne_11_1_20140513.tif.aux.xml
> 
>  > Size is 7232, 7056
> 
>  > Coordinate System is:
> 
>  > GEOGCS["WGS 84",
> 
>  > DATUM["WGS_1984",
> 
>  > SPHEROID["WGS 84",6378137,298.257223563,
> 
>  > AUTHORITY["EPSG","7030"]],
> 
>  > AUTHORITY["EPSG","6326"]],
> 
>  > PRIMEM["Greenwich",0],
> 
>  > UNIT["degree",0.0174532925199433],
> 
>  > AUTHORITY["EPSG","4326"]]
> 
>  > Origin = (-118.441851318576212,34.003461706049677)
> 
>  > Pixel Size = (0.000009839810447,-0.000009839810447)
> 
>  > Metadata:
> 
>  > AREA_OR_POINT=Area
> 
>  > Image Structure Metadata:
> 
>  > COMPRESSION=JPEG
> 
>  > INTERLEAVE=BAND
> 
>  > Corner Coordinates:
> 
>  > Upper Left (-118.4418513, 34.0034617) (118d26'30.66"W, 34d 0'12.46"N)
> 
>  > Lower Left (-118.4418513, 33.9340320) (118d26'30.66"W, 33d56' 2.52"N)
> 
>  > Upper Right (-118.3706898, 34.0034617) (118d22'14.48"W, 34d 0'12.46"N)
> 
>  > Lower Right (-118.3706898, 33.9340320) (118d22'14.48"W, 33d56' 2.52"N)
> 
>  > Center (-118.4062706, 33.9687469) (118d24'22.57"W, 33d58' 7.49"N)
> 
>  > Band 1 Block=256x256 Type=Byte, ColorInterp=Gray
> 
>  > Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 
>  > 57x56
> 
>  > Mask Flags: PER_DATASET
> 
>  > Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 
>  > 226x221, 113x111, 57x56
> 
>  > Band 2 Block=256x256 Type=Byte, ColorInterp=Undefined
> 
>  > Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 
>  > 57x56
> 
>  > Mask Flags: PER_DATASET
> 
>  > Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 
>  > 226x221, 113x111, 57x56
> 
>  > Band 3 Block=256x256 Type=Byte, ColorInterp=Undefined
> 
>  > Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 
>  > 57x56
> 
>  > Mask Flags: PER_DATASET
> 
>  > Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 
>  > 226x221, 113x111, 57x56
> 
>  > Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
> 
>  > Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 
>  > 57x56
> 
>  > Mask Flags: PER_DATASET
> 
>  > Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 
>  > 226x221, 113x111, 57x56
> 
>  > Band 5 Block=256x256 Type=Byte, ColorInterp=Undefined
> 
>  > Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 
>  > 57x56
> 
>  > Mask Flags: PER_DATASET
> 
>  > Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 
>  > 226x221, 113x111, 57x56
> 
>  > Band 6 Block=256x256 Type=Byte, ColorInterp=Alpha
> 
>  > Overviews: 3616x3528, 1808x1764, 904x882, 452x441, 226x221, 113x111,
> 
>  > 57x56
> 
>  > Mask Flags: PER_DATASET
> 
>  > Overviews of mask band: 3616x3528, 1808x1764, 904x882, 452x441,
> 
>  > 226x221, 113x111, 57x56
> 
>  >
> 
>  >
> 
>  > dest/m_3311805_ne_11_1_20140513.tif.aux.xml
> 
>  > <PAMDataset>
> 
>  > <PAMRasterBand band="1">
> 
>  > <ColorInterp>Red</ColorInterp>
> 
>  > </PAMRasterBand>
> 
>  > <PAMRasterBand band="2">
> 
>  > <ColorInterp>Green</ColorInterp>
> 
>  > </PAMRasterBand>
> 
>  > <PAMRasterBand band="3">
> 
>  > <ColorInterp>Blue</ColorInterp>
> 
>  > </PAMRasterBand>
> 
>  > <PAMRasterBand band="4">
> 
>  > <ColorInterp>Gray</ColorInterp>
> 
>  > </PAMRasterBand>
> 
>  > <PAMRasterBand band="5">
> 
>  > <ColorInterp>Gray</ColorInterp>
> 
>  > </PAMRasterBand>
> 
>  > </PAMDataset>
> 
>  >
> 
>  >
> 
>  > 6. add overviews to tiff
> 
>  > gdaladdo -clean -r average dest/33118/m_3311814_nw_11_1_20140513.tif
> 
>  > 2 4 8 16 32 64 128
> 
>  >
> 
>  > I get lots of Warnings:
> 
>  > Warning 1: JPEGLib:Premature end of JPEG file
> 
>  >
> 
>  > ---
> 
>  > This email has been checked for viruses by Avast antivirus software.
> 
>  > https://www.avast.com/antivirus
> 
>  >
> 
>  > _______________________________________________
> 
>  > gdal-dev mailing list
> 
>  > gdal-dev at lists.osgeo.org
> 
>  > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> -- 
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Fri Apr 14 13:27:37 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 14 Apr 2017 22:27:37 +0200
Subject: [gdal-dev] A couple of new issues with gdal
In-Reply-To: <4044a64a-b62c-4d3a-2260-75d2e511e19a@swoodbridge.com>
References: <a0a962b6-8dcb-55f9-cf14-b80f31eced7b@swoodbridge.com>
 <4058083.oD2QGGcJxf@even-i700>
 <4044a64a-b62c-4d3a-2260-75d2e511e19a@swoodbridge.com>
Message-ID: <1555970.trb3vhck6A@even-i700>

On vendredi 14 avril 2017 15:54:50 CEST Stephen Woodbridge wrote:
> http://imaptools.com:8080/dl/sew-tmp.tbz

I just quickly applied the commands from run.log with latest trunk/ 2.2beta and :
- gdal_translate -b 1 -b 2 -b 3 -b 4 -srcwin 0 0 900 900 org-
m_3311814_nw_11_1_20140513.tif src-m_3311814_nw_11_1_20140513.tif
does not change the color interpretation to alpha. This is something I remember having 
fixed in 2.2

- I don't get the "JPEGLib:Premature end of JPEG file" warnings. My GDAL build is with 
internal libjpeg (-6b), in case that makes a difference.

Would probably be a good idea for you to test 2.2beta1 ;-)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170414/aba3e38c/attachment.html>

From schwehr at gmail.com  Fri Apr 14 15:22:27 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 14 Apr 2017 15:22:27 -0700
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <3868969.Y96mjf89LI@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
 <CACmBxysLMKC7Ji33zOyE_vnNw4UqRXM81aCt01Gf3mwatvLaxg@mail.gmail.com>
 <3868969.Y96mjf89LI@even-i700>
Message-ID: <CACmBxyu2LiRvwhSTNx=txQcT3ef0SSeLg0s2PFnnH53p51xYog@mail.gmail.com>

Done.  https://trac.osgeo.org/gdal/changeset/38022

On Fri, Apr 14, 2017 at 8:09 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On vendredi 14 avril 2017 07:59:43 CEST Kurt Schwehr wrote:
>
> > Even,
>
> >
>
> > Thanks for your hard work!
>
> >
>
> > I did a quick mac osx fink build and spot checks with autotest - build
>
> > looks good.
>
> >
>
> > A quick check of NEWS:
>
> >
>
> > Kakadu v7.9.1 works for me. The line "add support for Kakadu v7.8" should
>
> > probably be something like:
>
> >
>
> > add support for Kakadu v7.9.1. v7.8 should not be used. It has a bug
>
> > fixed in v7.9.
>
> >
>
> >
>
> > Should be 9.0:
>
> >
>
> > OGRSpatialReference:
>
> > * Upgrade to EPSG database v8.9 <----- Upgrade to EPSG database v9.0
>
> > (#6772)
>
>
>
> I let you commit those changes and any other you may find appropriate? It
> certainly needs double checking.
>
>
>
> Eve
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170414/ba468167/attachment.html>

From marco.atzeri at gmail.com  Sun Apr 16 02:20:07 2017
From: marco.atzeri at gmail.com (Marco Atzeri)
Date: Sun, 16 Apr 2017 11:20:07 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <2453387.3za1Omjnzt@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
Message-ID: <d67d96d4-9dfb-ce14-26ae-5e582586d5db@gmail.com>

On 14/04/2017 10:10, Even Rouault wrote:
> Hi,
>
>
>
> I have prepared the GDAL/OGR 2.2.0 Beta 1 release. It will potentially
> be followed by a second beta, or directly by a RC1 if things go well.
> The source is available at:
[cut]
> Even
>

On cygwin, I hit a poor choice of variable name.

------------------------------------------
make[2]: Leaving directory 
'/cygdrive/e/cyg_pub/devel/gdal/prova/gdal-2.2.0-0.1.
x86_64/build/frmts/webp'
In file included from 
/usr/lib/gcc/x86_64-pc-cygwin/5.4.0/include/limits.h:168:0
,
                  from 
/usr/lib/gcc/x86_64-pc-cygwin/5.4.0/include/syslimits.h:7,
                  from 
/usr/lib/gcc/x86_64-pc-cygwin/5.4.0/include/limits.h:34,
                  from 
/cygdrive/e/cyg_pub/devel/gdal/prova/gdal-2.2.0-0.1.x86_64
/build/port/cpl_port.h:143,
                  from 
/cygdrive/e/cyg_pub/devel/gdal/prova/gdal-2.2.0-0.1.x86_64
/build/port/cpl_conv.h:35,
                  from ogrosmdatasource.cpp:29:
ogrosmdatasource.cpp:102:18: error: expected unqualified-id before 
numeric const
ant
  static const int PAGE_SIZE = 4096;
---------------------------------------------


as on /usr/include/limits.h we have

/* Size in bytes of a page. */
#undef PAGESIZE
#undef PAGE_SIZE
#define PAGESIZE 65536
#define PAGE_SIZE PAGESIZE


on 2.1.3 there was no isses, as I see

/* Must be a multiple of both BUCKET_BITMAP_SIZE and 
BUCKET_SECTOR_SIZE_ARRAY_SIZE */
#define PAGE_SIZE   4096

that was not causing issues.

Regards
Marco




From even.rouault at spatialys.com  Sun Apr 16 02:45:41 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 16 Apr 2017 11:45:41 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <d67d96d4-9dfb-ce14-26ae-5e582586d5db@gmail.com>
References: <2453387.3za1Omjnzt@even-i700>
 <d67d96d4-9dfb-ce14-26ae-5e582586d5db@gmail.com>
Message-ID: <1878004.t4hVdPYKJB@even-i700>

Hi,

> ogrosmdatasource.cpp:102:18: error: expected unqualified-id before
> numeric const
> ant
>   static const int PAGE_SIZE = 4096;
> ---------------------------------------------
> 
> 
> as on /usr/include/limits.h we have
> 
> /* Size in bytes of a page. */
> #undef PAGESIZE
> #undef PAGE_SIZE
> #define PAGESIZE 65536
> #define PAGE_SIZE PAGESIZE

Thanks for the notice. I've just fixed it in SVN
(you can "svn checkout https://svn.osgeo.org/gdal/branches/2.2/gdal" to check)

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170416/acf4a766/attachment.html>

From marco.atzeri at gmail.com  Sun Apr 16 03:19:02 2017
From: marco.atzeri at gmail.com (Marco Atzeri)
Date: Sun, 16 Apr 2017 12:19:02 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <1878004.t4hVdPYKJB@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
 <d67d96d4-9dfb-ce14-26ae-5e582586d5db@gmail.com>
 <1878004.t4hVdPYKJB@even-i700>
Message-ID: <cc91beee-c7cd-d9db-41c1-9698ad95c433@gmail.com>

On 16/04/2017 11:45, Even Rouault wrote:
> Hi,
>
>> ogrosmdatasource.cpp:102:18: error: expected unqualified-id before
>
>> numeric const
>
>> ant
>
>> static const int PAGE_SIZE = 4096;

>
> Thanks for the notice. I've just fixed it in SVN
>
> (you can "svn checkout https://svn.osgeo.org/gdal/branches/2.2/gdal" to
> check)
>
>
>
> Even
>

Noted.
Compiling with a similar change completed without problem

Regards
Marco


From andrew at aitchison.me.uk  Sun Apr 16 05:21:23 2017
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sun, 16 Apr 2017 13:21:23 +0100 (BST)
Subject: [gdal-dev] GDAL 2.2.0 beta1 compile fails for SQLITE_VERSION_NUMBER
	3006020
Message-ID: <alpine.LRH.2.20.1704161239060.27413@warden.aitchison.me.uk>


GDAL 2.2.0 beta1
Scientific Linux 6 (= CentOS6 =  Red Hat EL 6).
g++ 4.9.2 and g++ 5.3.1

This system has sqlite v 3.6.2:
/usr/include/sqlite3.h has
#define SQLITE_VERSION_NUMBER 3006020

cd /home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr/ogrsf_frmts/gpkg

/bin/sh /home/werdna/gdal2.2.0beta1/gdal-2.2.0/libtool --mode=compile --tag=CXX g++ -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gcore -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/alg -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr/ogrsf_frmts -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gnm -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/apps -DHAVE_AVX_AT_COMPILE_TIME -DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -g -O2  -Wall -Wextra -Winit-self -Wunused-parameter -Wformat -Werror=format-security -Wno-format-nonliteral -Wlogical-op -Wshadow -Werror=vla -Wdate-time -Wfloat-conversion -Wmissing-declarations -Wnon-virtual-dtor -Woverloaded-virtual -fno-operator-names  -I.. -I../sqlite -I../../../frmts/mem -I/usr/include -DGNM_ENABLED -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/usr/include -I/usr/include/cfitsio  -DGDAL_COMPILATION -DSQLITE_HAS_COLUMN_METADATA -c -o ../o/ogrgeopackagetablelayer
 .lo ogrgeopackagetablelayer.cpp
libtool: compile:  g++ -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gcore -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/alg -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr/ogrsf_frmts -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gnm -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/apps -DHAVE_AVX_AT_COMPILE_TIME -DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -g -O2 -Wall -Wextra -Winit-self -Wunused-parameter -Wformat -Werror=format-security -Wno-format-nonliteral -Wlogical-op -Wshadow -Werror=vla -Wdate-time -Wfloat-conversion -Wmissing-declarations -Wnon-virtual-dtor -Woverloaded-virtual -fno-operator-names -I.. -I../sqlite -I../../../frmts/mem -I/usr/include -DGNM_ENABLED -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/usr/include -I/usr/include/cfitsio -DGDAL_COMPILATION -DSQLITE_HAS_COLUMN_METADATA -c ogrgeopackagetablelayer.cpp  -fPIC -DPIC -o ../o/.libs/ogrgeopackagetablelayer.o
ogrgeopackagetablelayer.cpp: In member function 'virtual OGRErr OGRGeoPackageTableLayer::ISetFeature(OGRFeature*)':
ogrgeopackagetablelayer.cpp:1650:75: error: no matching function for call to 'OGRGeoPackageTableLayer::FeatureGenerateInsertSQL(OGRFeature*&, bool)'
              CPLString osCommand = FeatureGenerateInsertSQL(poFeature, true);
                                                                            ^
ogrgeopackagetablelayer.cpp:1650:75: note: candidate is:
ogrgeopackagetablelayer.cpp:417:11: note: CPLString OGRGeoPackageTableLayer::FeatureGenerateInsertSQL(OGRFeature*, bool, bool)
  CPLString OGRGeoPackageTableLayer::FeatureGenerateInsertSQL( OGRFeature *poFeature,
            ^
ogrgeopackagetablelayer.cpp:417:11: note:   candidate expects 3 arguments, 2 provided
ogrgeopackagetablelayer.cpp:1673:82: error: no matching function for call to 'OGRGeoPackageTableLayer::FeatureBindInsertParameters(OGRFeature*&, sqlite3_stmt*&, bool)'
          errOgr = FeatureBindInsertParameters(poFeature, m_poUpdateStatement, true);
                                                                                   ^
ogrgeopackagetablelayer.cpp:1673:82: note: candidate is:
ogrgeopackagetablelayer.cpp:399:8: note: OGRErr OGRGeoPackageTableLayer::FeatureBindInsertParameters(OGRFeature*, sqlite3_stmt*, bool, bool)
  OGRErr OGRGeoPackageTableLayer::FeatureBindInsertParameters( OGRFeature *poFeature,
         ^
ogrgeopackagetablelayer.cpp:399:8: note:   candidate expects 4 arguments, 3 provided
make: *** [../o/ogrgeopackagetablelayer.lo] Error 1

From even.rouault at spatialys.com  Sun Apr 16 05:36:36 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 16 Apr 2017 14:36:36 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta1 compile fails for
	SQLITE_VERSION_NUMBER 3006020
In-Reply-To: <alpine.LRH.2.20.1704161239060.27413@warden.aitchison.me.uk>
References: <alpine.LRH.2.20.1704161239060.27413@warden.aitchison.me.uk>
Message-ID: <7816541.5B0O3VZv2Q@even-i700>

Andew,

> GDAL 2.2.0 beta1
> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6).
> g++ 4.9.2 and g++ 5.3.1
> 
> This system has sqlite v 3.6.2:
> /usr/include/sqlite3.h has
> #define SQLITE_VERSION_NUMBER 3006020

Thanks for the report. Fixed in SVN trunk and branches/2.2 now.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170416/e9bb01aa/attachment.html>

From bernardo at terramagna.com.br  Sun Apr 16 06:51:21 2017
From: bernardo at terramagna.com.br (Bernardo Fabiani)
Date: Sun, 16 Apr 2017 10:51:21 -0300
Subject: [gdal-dev] MBTiles minimum zoom level definition
Message-ID: <CAM+gB8FKWTB+6ezTP7YB7+=cxw7NgtrsyHXGHn3srj5LSkTeGg@mail.gmail.com>

Hi, list

I’m using gdal_translate and gdaladdo to generate MBTiles following the
documentation here <http://www.gdal.org/frmt_mbtiles.html>.

By reading previous threads
<https://lists.osgeo.org/pipermail/gdal-dev/2016-April/044130.html>, I’ve
understood that gdal_translate determines the baseview zoom level based on
the original image resolution - if I’d like a higher level of zoom, I need
to upsample. That enabled the control of the *maximum* zoom level.

However, I when using gdaladdo <http://www.gdal.org/gdaladdo.html> and
inserting the levels option, I was not able to go past a certain ‘out zoom
level’. Also in here <http://www.gdal.org/frmt_mbtiles.html>, it is
explicitly mentioned that

If more overview levels are specified than available, the extra ones are
silently ignored.

*My question is*: how can I (directly or indirectly) specify the *minimum*
zoom level for a given image in MBTiles generation using gdal_translate?
​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170416/53a5a3dc/attachment-0001.html>

From even.rouault at spatialys.com  Sun Apr 16 11:30:00 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 16 Apr 2017 20:30:00 +0200
Subject: [gdal-dev] MBTiles minimum zoom level definition
In-Reply-To: <CAM+gB8FKWTB+6ezTP7YB7+=cxw7NgtrsyHXGHn3srj5LSkTeGg@mail.gmail.com>
References: <CAM+gB8FKWTB+6ezTP7YB7+=cxw7NgtrsyHXGHn3srj5LSkTeGg@mail.gmail.com>
Message-ID: <1880402.sHEu43BvTb@even-i700>

Bernardo,

> 
> I’m using gdal_translate and gdaladdo to generate MBTiles following the
> documentation here <http://www.gdal.org/frmt_mbtiles.html>.
> 
> By reading previous threads
> <https://lists.osgeo.org/pipermail/gdal-dev/2016-April/044130.html>, I’ve
> understood that gdal_translate determines the baseview zoom level based on
> the original image resolution - if I’d like a higher level of zoom, I need
> to upsample. That enabled the control of the *maximum* zoom level.
> 
> However, I when using gdaladdo <http://www.gdal.org/gdaladdo.html> and
> inserting the levels option, I was not able to go past a certain ‘out zoom
> level’. Also in here <http://www.gdal.org/frmt_mbtiles.html>, it is
> explicitly mentioned that
> 
> If more overview levels are specified than available, the extra ones are
> silently ignored.
> 
> *My question is*: how can I (directly or indirectly) specify the *minimum*
> zoom level for a given image in MBTiles generation using gdal_translate?

Well as you saw, when using gdal_translate you implicitely define the maximum zoom level. 
So look at the gdalinfo report on it, and it will mention this zoom level. Let's say N.

If you do "gdaladdo my.mbtiles 2 4 8 16", this will compute levels N-1, N-2, N-3, N-4.

This works until the dimension of the overview is below 128x128 if I remember well

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170416/c8a8f57e/attachment.html>

From andrew at aitchison.me.uk  Sun Apr 16 12:31:09 2017
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sun, 16 Apr 2017 20:31:09 +0100 (BST)
Subject: [gdal-dev] GDAL 2.2.0beta1 and old poppler libraries
In-Reply-To: <2453387.3za1Omjnzt@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
Message-ID: <alpine.LRH.2.20.1704161807470.32536@warden.aitchison.me.uk>


GDAL 2.2.0 beta1
Scientific Linux 6 (= CentOS6 =  Red Hat EL 6).
g++ 4.9.2 and g++ 5.3.1

gdal-2.2.0/frmts/pdf/pdfdataset.cpp does not compile on my
Scientific Linux 6 (= CentOS6 =  Red Hat EL 6) machine.

pdfio.h lines 87-90:
    private:
         /* Added in poppler 0.15.0 */
         virtual GBool hasGetChars() override;
         virtual int getChars(int nChars, Guchar *buffer) override;

Earlier in the same file we have
#ifdef POPPLER_0_23_OR_LATER
         virtual BaseStream* copy() override;
#endif

I guess we need to add a POPPLER_0_15_OR_LATER preprocessor definition
but I don't know whether configure.ac would be only place we need to
define it ?

The full compiler objection is:

./configure --with-ecw=/home/werdna/gdal1.11/ecw3 --prefix=/usr/local/gdal2.2.0beta1 --with-poppler
make
 		...		...
make[2]: Entering directory `/home/werdna/gdal2.2.0beta1/gdal-2.2.0/frmts/pdf'
/bin/sh /home/werdna/gdal2.2.0beta1/gdal-2.2.0/libtool --mode=compile --tag=CXX g++ -std=gnu++11 -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gcore -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/alg -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr/ogrsf_frmts -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gnm -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/apps -DHAVE_AVX_AT_COMPILE_TIME -DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -g -O2  -Wall -Wextra -Winit-self -Wunused-parameter -Wformat -Werror=format-security -Wno-format-nonliteral -Wlogical-op -Wshadow -Werror=vla -Wdate-time -Wfloat-conversion -Wmissing-declarations -Wnon-virtual-dtor -Woverloaded-virtual -fno-operator-names  -I../vrt -I../mem -I../../ogr/ogrsf_frmts/mem -DGNM_ENABLED -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/usr/include -I/usr/include/cfitsio  -DGDAL_COMPILATION -DHAVE_POPPLER -DPOPPLER_HAS_OPTCONTENT -I/usr/include -I
 /usr/include/poppler   -c -o ../o/pdfdataset.lo pdfdataset.cpp
libtool: compile:  g++ -std=gnu++11 -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gcore -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/alg -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/ogr/ogrsf_frmts -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/gnm -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/apps -DHAVE_AVX_AT_COMPILE_TIME -DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -g -O2 -Wall -Wextra -Winit-self -Wunused-parameter -Wformat -Werror=format-security -Wno-format-nonliteral -Wlogical-op -Wshadow -Werror=vla -Wdate-time -Wfloat-conversion -Wmissing-declarations -Wnon-virtual-dtor -Woverloaded-virtual -fno-operator-names -I../vrt -I../mem -I../../ogr/ogrsf_frmts/mem -DGNM_ENABLED -I/home/werdna/gdal2.2.0beta1/gdal-2.2.0/port -I/usr/include -I/usr/include/cfitsio -DGDAL_COMPILATION -DHAVE_POPPLER -DPOPPLER_HAS_OPTCONTENT -I/usr/include -I/usr/include/poppler -c pdfdataset.cpp  -fPIC -DPIC -o ../o/.lib
 s/pdfdataset.o
In file included from pdfdataset.cpp:47:0:
pdfio.h:89:23: error: 'virtual GBool VSIPDFFileStream::hasGetChars()' marked override, but does not override
          virtual GBool hasGetChars() override;
                        ^
pdfio.h:90:21: error: 'virtual int VSIPDFFileStream::getChars(int, Guchar*)' marked override, but does not override
          virtual int getChars(int nChars, Guchar *buffer) override;
                      ^
make[2]: *** [../o/pdfdataset.lo] Error 1
make[2]: Leaving directory `/home/werdna/gdal2.2.0beta1/gdal-2.2.0/frmts/pdf'
make[1]: *** [pdf-install-obj] Error 2
make[1]: Leaving directory `/home/werdna/gdal2.2.0beta1/gdal-2.2.0/frmts'
make: *** [frmts-target] Error 2

From even.rouault at spatialys.com  Sun Apr 16 12:55:05 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 16 Apr 2017 21:55:05 +0200
Subject: [gdal-dev] GDAL 2.2.0beta1 and old poppler libraries
In-Reply-To: <alpine.LRH.2.20.1704161807470.32536@warden.aitchison.me.uk>
References: <2453387.3za1Omjnzt@even-i700>
 <alpine.LRH.2.20.1704161807470.32536@warden.aitchison.me.uk>
Message-ID: <5028034.AqcsH4eHcK@even-i700>

On dimanche 16 avril 2017 20:31:09 CEST Andrew C Aitchison wrote:
> GDAL 2.2.0 beta1
> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6).
> g++ 4.9.2 and g++ 5.3.1
> 
> gdal-2.2.0/frmts/pdf/pdfdataset.cpp does not compile on my
> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6) machine.
> 
> pdfio.h lines 87-90:
>     private:
>          /* Added in poppler 0.15.0 */
>          virtual GBool hasGetChars() override;
>          virtual int getChars(int nChars, Guchar *buffer) override;

You can just remove the override qualifier in the above methods. Supporting properly this old 
version could be done but would be quite tedious. An alternative would be that you disable C
++11 compilation mode with ./configure --without-cpp11 (you will loose the CAD driver then)

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170416/25894e76/attachment.html>

From even.rouault at spatialys.com  Sun Apr 16 13:07:21 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 16 Apr 2017 22:07:21 +0200
Subject: [gdal-dev] GDAL 2.2.0beta1 and old poppler libraries
In-Reply-To: <34ccd62c-baab-4132-95a8-e86c99e79cbb@loskot.net>
References: <2453387.3za1Omjnzt@even-i700> <5028034.AqcsH4eHcK@even-i700>
 <34ccd62c-baab-4132-95a8-e86c99e79cbb@loskot.net>
Message-ID: <9821456.tbW0W40JFJ@even-i700>

On dimanche 16 avril 2017 22:03:11 CEST Mateusz Łoskot wrote:
> GCC 4.9 should be fine
> 
> See C++11/14 status I collected for GEOS

Mateusz, the issue is not so much the compiler version, but the poppler version (or more 
exactly the combination of them). New virtual methods have been added in successive 
poppler versions, and the override qualifier probably only applies to the latest versions. 
Some virtual methods might not exist in earlier version, which compiled fine before we 
added the override qualifier.
Even

> 
> https://trac.osgeo.org/geos/wiki/RFC5
> Mateusz
> 
> On 16 Apr 2017, 21:55, at 21:55, Even Rouault <even.rouault at spatialys.com> wrote:
> >On dimanche 16 avril 2017 20:31:09 CEST Andrew C Aitchison wrote:
> >> GDAL 2.2.0 beta1
> >> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6).
> >> g++ 4.9.2 and g++ 5.3.1
> >> 
> >> gdal-2.2.0/frmts/pdf/pdfdataset.cpp does not compile on my
> >> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6) machine.
> >> 
> >> pdfio.h lines 87-90:
> >>     private:
> >>          /* Added in poppler 0.15.0 */
> >>          virtual GBool hasGetChars() override;
> >>          virtual int getChars(int nChars, Guchar *buffer) override;
> >
> >You can just remove the override qualifier in the above methods.
> >Supporting properly this old
> >version could be done but would be quite tedious. An alternative would
> >be that you disable C
> >++11 compilation mode with ./configure --without-cpp11 (you will loose
> >the CAD driver then)


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170416/70c75ce0/attachment.html>

From mateusz at loskot.net  Sun Apr 16 13:20:41 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Sun, 16 Apr 2017 22:20:41 +0200
Subject: [gdal-dev] GDAL 2.2.0beta1 and old poppler libraries
In-Reply-To: <9821456.tbW0W40JFJ@even-i700>
References: <2453387.3za1Omjnzt@even-i700> <5028034.AqcsH4eHcK@even-i700>
 <34ccd62c-baab-4132-95a8-e86c99e79cbb@loskot.net>
 <9821456.tbW0W40JFJ@even-i700>
Message-ID: <CABUeae-sv4s6MYdaXBxbnLtrB7pO9KgcScD6civ_g8H_c1GiKw@mail.gmail.com>

On 16 April 2017 at 22:07, Even Rouault <even.rouault at spatialys.com> wrote:
> On dimanche 16 avril 2017 22:03:11 CEST Mateusz Łoskot wrote:
>
>> GCC 4.9 should be fine
>>
>> See C++11/14 status I collected for GEOS
>
> Mateusz, the issue is not so much the compiler version, but the poppler
> version (or more exactly the combination of them). New virtual methods have
> been added in successive poppler versions, and the override qualifier
> probably only applies to the latest versions. Some virtual methods might not
> exist in earlier version, which compiled fine before we added the override
> qualifier.

Gotcha. Thanks.
Missed the details, quickly responded from mobile

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From even.rouault at spatialys.com  Mon Apr 17 02:44:38 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 17 Apr 2017 11:44:38 +0200
Subject: [gdal-dev] Vector Tiles in OGR
In-Reply-To: <CAFcOn2_FJ02nGBeBcpkv2BwOPwrafK30hq4zfE_6Jb4rx1K0zQ@mail.gmail.com>
References: <CAH-RUCSWA55kmEW6=tH0=xb7qUFm9R4oJ6iBSxdeSrnetyRM0g@mail.gmail.com>
 <661A1F30-F0B6-4514-92A1-B9782D109958@gmail.com>
 <CAFcOn2_FJ02nGBeBcpkv2BwOPwrafK30hq4zfE_6Jb4rx1K0zQ@mail.gmail.com>
Message-ID: <9389514.AQUJ8t0ZNJ@even-i700>

Hi Stefan,

> P.S. @Even: Any news on a GDAL/OGR MVT reader?

No activity on this front as far as I know. There was a possible funding opportunity recently 
for a project that would have involved integating such a driver with QGIS, but the odds for it 
to come true seems to be very low according to the latest updates I got.
And your plugin might actually solve the needs of this project !

Quick question: from my test of the plugin, I see it converts the whole mbtiles and optionnaly 
merges geometry chunks of the same feature spread over several tiles into a single 
geometry, right ? In the preliminary discussions for the project I mentionned, it was not clear 
if there was a need for doing just a decoding & rendering of tiles that intersect the window of 
interest (could make sense if using very large mbtiles or using remote tiles), instead of a 
whole mbtiles conversion. Partial decoding, with merging of the tiles intersecting the 
window of interest, seems to be a bit at odds with the (implicit ?) assumptions of the QGIS 
vector layers that assume that the geometry of a feature will always be the same when it is 
returned, and not clamped to the window of interest.

Even

> 
> 2016-01-31 23:22 GMT+01:00 Flippmoke <flippmoke at gmail.com>:
> > All,
> > 
> > The first thing that is going to be required likely is a good generic c++
> > library for encoding and decoding vector tiles IMO.
> > 
> > I have spent a lot of time working on developing the mapnik vector tile
> > library to be a solid implementation, especially around all the work done
> > for 2.0 of Mapbox vector tile specification. I would love to eventually
> > help make this a generalized implementation so that it is portable to a
> > library like GDAL.
> > 
> > We have talked about doing something like this at Mapbox but will require
> > a good deal of time, so it hasn't been pushed forward yet. The other
> > issues that come to mind to me is that some of the libraries that mapnik
> > vector tile depends upon most likely need good custom implementations if
> > we wanted to make it more generic.
> > 
> > The reason for this is that I would prefer for it to be a header only
> > library with no dependencies. Adding more dependencies for GDAL seems
> > like it could be a mess.
> > 
> > Blake Thompson
> > 
> >> On Jan 31, 2016, at 10:10 AM, Stefan Keller <sfkeller at gmail.com> wrote:
> >> 
> >> Hi Petr, Blake, Even and everybody
> >> 
> >> I'm (besides Petr) the other maintainer of OSM2VectorTiles.
> >> I'd already asked Even a similar question.
> >> I'm advising now an intern to implement such a MVT Vector Tiles reader
> >> client in Python if possible as part of a QGIS plugin.
> >> And I'm interested not to do redundant implementations.
> >> Are there any news on this matter?
> >> 
> >> :Stefan
> >> 
> >> Prof. at HSR and leader of Geometa Lab
> >> 
> >> @Even: Regarding OGR MVT development can you send to me (directly) a
> >> contact name of the group which won the bidding?
> >> 
> >> 2016-01-06 15:24 GMT+01:00 Petr Pridal <petr.pridal at klokantech.com>:
> >>> Hi everybody,
> >>> 
> >>> thanks for the comments. Regarding the technical details:
> >>>> Each Tile is its own discrete dataset therefore the hardest part would
> >>>> be
> >>>> merging of features into the original features across tiles. You could
> >>>> use
> >>>> some complicated merging technique, but that could be very expensive.
> >>> 
> >>> The driver could require "id" parameter, which specifies name of an
> >>> attribute with unique identifier on the features shared across the
> >>> tiles.
> >>> Both MapBox vector tiles and OSM2VectorTiles tiles have an unique
> >>> non-zero
> >>> "osm_id" in place. The first version of driver could read only features
> >>> with such ID. The identifier does not have to be always filled, but
> >>> often it is, especially in deeper zoom levels derived purely from
> >>> OpenStreetMap - but yeh, a completely general stitching would be much
> >>> harder.
> >>> 
> >>> The clipping + merging of shapes itself can be implemented with
> >>> underlaying
> >>> GEOS library functions.
> >>> 
> >>> BTW It is possible to examine vector tiles data in pure JavaScript X-Ray
> >>> viewer (no WebGL support on browser required) made in OpenLayers3:
> >>> http://klokantech.github.io/ol3-sandbox/vector/xray.html
> >>> 
> >>> or with WebGL-enabled webbrowser with higher performance MapBox GL JS
> >>> powered X-Ray:
> >>> http://klokantech.github.io/mapbox-gl-js-offline-example/xray.html
> >>> 
> >>> A debug viewer for each vector tile (made in OL3) decoded in pure
> >>> JavaScript:
> >>> http://klokantech.github.io/ol3-sandbox/vector/tile-inspector.html
> >>> 
> >>> The OGR driver could be also practical for the unsimplified /
> >>> ungeneralised
> >>> MBTiles with OSM data available at:
> >>> http://osmlab.github.io/osm-qa-tiles/
> >>> 
> >>>> If you wanted to simply view vector tile data it could get confusing as
> >>>> well since most vector tiles need a buffer when they are used for
> >>>> visualization programs. This is important for things like labeling on
> >>>> maps
> >>>> etc. Therefore, you could get a large amount of overlapping data on
> >>>> tiles if you loaded them all in at once.
> >>> 
> >>> Clipping on border of each tile must be applied before stitching the
> >>> vector
> >>> features together  - so the buffer is removed. Buffer is there only for
> >>> visualisation and labeling.
> >>> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170417/3932580a/attachment-0001.html>

From sfkeller at gmail.com  Mon Apr 17 03:39:55 2017
From: sfkeller at gmail.com (Stefan Keller)
Date: Mon, 17 Apr 2017 12:39:55 +0200
Subject: [gdal-dev] Vector Tiles in OGR
In-Reply-To: <9389514.AQUJ8t0ZNJ@even-i700>
References: <CAH-RUCSWA55kmEW6=tH0=xb7qUFm9R4oJ6iBSxdeSrnetyRM0g@mail.gmail.com>
 <661A1F30-F0B6-4514-92A1-B9782D109958@gmail.com>
 <CAFcOn2_FJ02nGBeBcpkv2BwOPwrafK30hq4zfE_6Jb4rx1K0zQ@mail.gmail.com>
 <9389514.AQUJ8t0ZNJ@even-i700>
Message-ID: <CAFcOn2_9WP0BQcaDAGpw4AxC=30GQbrsnUEEBj=YLqJxKOz3Dw@mail.gmail.com>

Hi Even,

We - Martin Boos (new in Cc) and I - are definitely thinking about
implementing an option for spatial bounds.
Youmay know e.g. this WFS option of QGIS?
 „[_] Only request features overlapping the view extent“

What would you prefer: The same behaviour as for the WFS provider, or
taking a fixed bounds which aren't following users pan/zoom actions
(unless the user explicitly resets the bounds)?

:Stefan

@Blake: We are very interested in you opinion regarding handling of
keys "crs" and "bounds" now as well as part of the future TileJSON
spec.


---------- Forwarded message ----------
From: Even Rouault <even.rouault at spatialys.com>
Date: 2017-04-17 11:44 GMT+02:00
Subject: Re: [gdal-dev] Vector Tiles in OGR
To: Stefan Keller <sfkeller at gmail.com>
Cc: Gdal-Dev <gdal-dev at lists.osgeo.org>, Flippmoke
<flippmoke at gmail.com>, Even Rouault <even.rouault at mines-paris.org>,
petr.pridal at klokantech.com


Hi Stefan,


> P.S. @Even: Any news on a GDAL/OGR MVT reader?

No activity on this front as far as I know. There was a possible
funding opportunity recently for a project that would have involved
integating such a driver with QGIS, but the odds for it to come true
seems to be very low according to the latest updates I got.

And your plugin might actually solve the needs of this project !

Quick question: from my test of the plugin, I see it converts the
whole mbtiles and optionally merges geometry chunks of the same
feature spread over several tiles into a single geometry, right ? In
the preliminary discussions for the project I mentionned, it was not
clear if there was a need for doing just a decoding & rendering of
tiles that intersect the window of interest (could make sense if using
very large mbtiles or using remote tiles), instead of a whole mbtiles
conversion. Partial decoding, with merging of the tiles intersecting
the window of interest, seems to be a bit at odds with the (implicit
?) assumptions of the QGIS vector layers that assume that the geometry
of a feature will always be the same when it is returned, and not
clamped to the window of interest.

Even



>

> 2016-01-31 23:22 GMT+01:00 Flippmoke <flippmoke at gmail.com>:

> > All,

> >

> > The first thing that is going to be required likely is a good generic c++

> > library for encoding and decoding vector tiles IMO.

> >

> > I have spent a lot of time working on developing the mapnik vector tile

> > library to be a solid implementation, especially around all the work done

> > for 2.0 of Mapbox vector tile specification. I would love to eventually

> > help make this a generalized implementation so that it is portable to a

> > library like GDAL.

> >

> > We have talked about doing something like this at Mapbox but will require

> > a good deal of time, so it hasn't been pushed forward yet. The other

> > issues that come to mind to me is that some of the libraries that mapnik

> > vector tile depends upon most likely need good custom implementations if

> > we wanted to make it more generic.

> >

> > The reason for this is that I would prefer for it to be a header only

> > library with no dependencies. Adding more dependencies for GDAL seems

> > like it could be a mess.

> >

> > Blake Thompson

> >

> >> On Jan 31, 2016, at 10:10 AM, Stefan Keller <sfkeller at gmail.com> wrote:

> >>

> >> Hi Petr, Blake, Even and everybody

> >>

> >> I'm (besides Petr) the other maintainer of OSM2VectorTiles.

> >> I'd already asked Even a similar question.

> >> I'm advising now an intern to implement such a MVT Vector Tiles reader

> >> client in Python if possible as part of a QGIS plugin.

> >> And I'm interested not to do redundant implementations.

> >> Are there any news on this matter?

> >>

> >> :Stefan

> >>

> >> Prof. at HSR and leader of Geometa Lab

> >>

> >> @Even: Regarding OGR MVT development can you send to me (directly) a

> >> contact name of the group which won the bidding?

> >>

> >> 2016-01-06 15:24 GMT+01:00 Petr Pridal <petr.pridal at klokantech.com>:

> >>> Hi everybody,

> >>>

> >>> thanks for the comments. Regarding the technical details:

> >>>> Each Tile is its own discrete dataset therefore the hardest part would

> >>>> be

> >>>> merging of features into the original features across tiles. You could

> >>>> use

> >>>> some complicated merging technique, but that could be very expensive.

> >>>

> >>> The driver could require "id" parameter, which specifies name of an

> >>> attribute with unique identifier on the features shared across the

> >>> tiles.

> >>> Both MapBox vector tiles and OSM2VectorTiles tiles have an unique

> >>> non-zero

> >>> "osm_id" in place. The first version of driver could read only features

> >>> with such ID. The identifier does not have to be always filled, but

> >>> often it is, especially in deeper zoom levels derived purely from

> >>> OpenStreetMap - but yeh, a completely general stitching would be much

> >>> harder.

> >>>

> >>> The clipping + merging of shapes itself can be implemented with

> >>> underlaying

> >>> GEOS library functions.

> >>>

> >>> BTW It is possible to examine vector tiles data in pure JavaScript X-Ray

> >>> viewer (no WebGL support on browser required) made in OpenLayers3:

> >>> http://klokantech.github.io/ol3-sandbox/vector/xray.html

> >>>

> >>> or with WebGL-enabled webbrowser with higher performance MapBox GL JS

> >>> powered X-Ray:

> >>> http://klokantech.github.io/mapbox-gl-js-offline-example/xray.html

> >>>

> >>> A debug viewer for each vector tile (made in OL3) decoded in pure

> >>> JavaScript:

> >>> http://klokantech.github.io/ol3-sandbox/vector/tile-inspector.html

> >>>

> >>> The OGR driver could be also practical for the unsimplified /

> >>> ungeneralised

> >>> MBTiles with OSM data available at:

> >>> http://osmlab.github.io/osm-qa-tiles/

> >>>

> >>>> If you wanted to simply view vector tile data it could get confusing as

> >>>> well since most vector tiles need a buffer when they are used for

> >>>> visualization programs. This is important for things like labeling on

> >>>> maps

> >>>> etc. Therefore, you could get a large amount of overlapping data on

> >>>> tiles if you loaded them all in at once.

> >>>

> >>> Clipping on border of each tile must be applied before stitching the

> >>> vector

> >>> features together - so the buffer is removed. Buffer is there only for

> >>> visualisation and labeling.

> >>>

> >>>> As far as writing a simple decoder -- the mapnik-vector-tile decoder

> >>>> isn't

> >>>> currently able to decode vector tiles into a form not supported by

> >>>> mapnik.

> >>>> Therefore, OGR would not be able to easily use this.

> >>>

> >>> Correct. It can't be used directly (GDAL can't link against), but the

> >>> relevant code can be extracted and reused directly. For basic decoding

> >>> critical is the Protobuf library (which is already in GDAL) and

> >>> https://github.com/mapbox/mapnik-vector-tile/blob/master/proto/vector_ti

> >>> le.proto + the code for converting pixel coordinates in features to

> >>> relevant geo coordinates and GEOS-based merging of features.

> >>>

> >>>> We plan to write a generalized encoder and decoder eventually so that

> >>>> any

> >>>> other library can plugin with out the mapnik requirement.

> >>>

> >>> This would be amazing.

> >>>

> >>>> If you have any questions specifically about Mapnik Vector Tile or the

> >>>> Mapbox Vector Tile Specification feel free to ask me. I would note that

> >>>> you

> >>>> guys will want to update your vector tiles once the V2 specification

> >>>> changes are into Mapnik-Vector-Tile.

> >>>

> >>> Cool! Thanks. Our world tiles are generated via Docker containers on a

> >>> cluster of computers - using Mapnik via Tilelive directly - so upgrades

> >>> on

> >>> Mapnik-Vector-Tile will propagate to the open-source rendering software.

> >>> I expect V2 spec will mean also new MapBox Streets V7, right?

> >>>

> >>>> I see you mention MVT in MBTiles. Is it a recognized practice ? I don't

> >>>> see

> >>>> mention of that neither in the MVT spec (

> >>>> https://github.com/mapbox/vector-

> >>>> tile-spec/tree/master/2.0 ) nor the MBTiles one (

> >>>> https://github.com/mapbox/mbtiles-spec/blob/master/1.2/spec.md ),

> >>>> although

> >>>> I

> >>>> guess it is just a matter of storing a MVT blob in the tile_data

> >>>> column.

> >>>

> >>> Yes. MapBox Studio Classic generates such MBTiles with Vector Tiles

> >>> inside - and Mapnik reads them directly when rasterising. Storing the

> >>> vector tiles in SQLite make sense - and it simplifies deployment, and

> >>> you can then easily have complete world on each node of a cluster of

> >>> tileservers. If you don't want to upgrade your base map too often, this

> >>> approach is pretty efficient and removes the centralised database as

> >>> typical bottleneck.

> >>>

> >>> I did some tests on vector tiles vs raster in MBTiles and documented

> >>> these

> >>> in README.md at and https://github.com/klokantech/vector-tiles-sample

> >>> before we started to work on OSM2VectorTiles project.

> >>> There are also sample data and offline MapBox GL JS viewer in that repo.

> >>> Vector tiles can be hosted also "unpacked", just as files in folders on

> >>> a

> >>> standard web server - exactly like GDAL2Tiles or MapTiler.com does by

> >>> default for raster tiles.

> >>>

> >>> If OGR driver is implemented, the primary source should be probably

> >>> reading

> >>> from an URL via curl.

> >>>

> >>> Reading PBFs from an MBTiles (or another SQLite) is just the most

> >>> practical

> >>> portable alternative to it.

> >>>

> >>> Technically people may store the tiles in different ways - for example

> >>> Wikimedia guys (http://maps.wikimedia.org/ and

> >>> https://github.com/kartotherian/) use Cassandra for tile storage, I

> >>> guess

> >>> MapBox internally is also on a different storage for production servers

> >>> ...

> >>> for transfers and streaming tilesets there is the - but tiles are

> >>> ALWAYS

> >>> exposed via HTTP.

> >>>

> >>> Regards,

> >>>

> >>> Petr

> >>> --

> >>> Petr Pridal, Ph.D.

> >>> CEO

> >>>

> >>> Klokan Technologies GmbH

> >>> Hofnerstrasse 98, 6314 Unterageri, Switzerland

> >>> Tel: +41 (0)41 511 26 12

> >>> Email: info at klokantech.com

> >>> Web: http://www.klokantech.com/

> >>>

> >>> _______________________________________________

> >>> gdal-dev mailing list

> >>> gdal-dev at lists.osgeo.org

> >>> http://lists.osgeo.org/mailman/listinfo/gdal-dev





--

Spatialys - Geospatial professional services

http://www.spatialys.com

From jorge.conrado at cptec.inpe.br  Mon Apr 17 09:58:48 2017
From: jorge.conrado at cptec.inpe.br (jorge.conrado at cptec.inpe.br)
Date: Mon, 17 Apr 2017 13:58:48 -0300
Subject: [gdal-dev] GDAL .bin for FEDORA 25
Message-ID: <a7649bfb703b8bc8e9bb3fe26ef5dfd6@cptec.inpe.br>


Hi,

I would like know if there is a binnary verison for Fedora 25 and how to 
get and install it.

Thanks,

Conrado

From eh0907-osgeo at 42net.de  Tue Apr 18 02:46:39 2017
From: eh0907-osgeo at 42net.de (Erik Heinz)
Date: Tue, 18 Apr 2017 11:46:39 +0200
Subject: [gdal-dev] RGB2PCT without dithering
Message-ID: <20170418094639.GA19692@morgoth.42net.de>

Hello everyone,

I would like to know if it's possible within GDAL to convert an RGB raster 
image with a small number of colors exactly to an indexed colortable image. 
This would imply to avoid dithering. 

The only function I found is GDALDitherRGB2PCT() which always does dithering.

Thank you, and best regards,
Erik

   

From naoliv at gmail.com  Tue Apr 18 05:24:50 2017
From: naoliv at gmail.com (Nelson A. de Oliveira)
Date: Tue, 18 Apr 2017 09:24:50 -0300
Subject: [gdal-dev] Filtering GeoTIFFs touching/inside an area
Message-ID: <CAARFvTUtx8ttPw2baU9+bBT-UExdGpH_=FFRm2PeMbLqbtJPcg@mail.gmail.com>

Is it possible to filter GeoTIFFs touching/inside a specific area?

For example, https://i.imgur.com/xPA4iqq.png

I have a lot of GeoTIFFs, an area and would like to somehow filter
only the images that are touching or inside that area.
It's not exactly a clipping here, since I need to keep the GeoTIFFs intact.

From jmckenna at gatewaygeomatics.com  Tue Apr 18 09:50:25 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 18 Apr 2017 13:50:25 -0300
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <2453387.3za1Omjnzt@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
Message-ID: <79be06d8-34a2-f973-3377-329170dfa46c@gatewaygeomatics.com>

On 2017-04-14 5:10 AM, Even Rouault wrote:
> I have prepared the GDAL/OGR 2.2.0 Beta 1 release. It will potentially
> be followed by a second beta, or directly by a RC1 if things go well.
> The source is available at:

Tested in the MS4W build environment on Windows, with VS 2015 and 2012. 
No issues compiling or running with VS 2015.  With VS 2012 I get this 
error right away when starting to compile (cpl_vsil_curl.cpp) : 
https://pastebin.com/hBi6sv0c

-jeff



From jmckenna at gatewaygeomatics.com  Tue Apr 18 09:56:13 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 18 Apr 2017 13:56:13 -0300
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <79be06d8-34a2-f973-3377-329170dfa46c@gatewaygeomatics.com>
References: <2453387.3za1Omjnzt@even-i700>
 <79be06d8-34a2-f973-3377-329170dfa46c@gatewaygeomatics.com>
Message-ID: <e7fc8fca-5c56-1b70-ccfd-679512449677@gatewaygeomatics.com>

On 2017-04-18 1:50 PM, Jeff McKenna wrote:
> On 2017-04-14 5:10 AM, Even Rouault wrote:
>> I have prepared the GDAL/OGR 2.2.0 Beta 1 release. It will potentially
>> be followed by a second beta, or directly by a RC1 if things go well.
>> The source is available at:
>
> Tested in the MS4W build environment on Windows, with VS 2015 and 2012.
> No issues compiling or running with VS 2015.  With VS 2012 I get this
> error right away when starting to compile (cpl_vsil_curl.cpp) :
> https://pastebin.com/hBi6sv0c
>
> -jeff
>
>

I just noticed a very recent change (after beta1) to GDAL of "fix 
compilation with VS2015"  <--- this is confusing, as I just tested 
successfully VS2015 for the full MS4W build (includes netcdf-c-4.4.0, 
libkml, poppler, etc etc).  Maybe your recent change was not needed in 
my build environment?  odd.

-jeff






From jmckenna at gatewaygeomatics.com  Tue Apr 18 10:06:13 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 18 Apr 2017 14:06:13 -0300
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <e7fc8fca-5c56-1b70-ccfd-679512449677@gatewaygeomatics.com>
References: <2453387.3za1Omjnzt@even-i700>
 <79be06d8-34a2-f973-3377-329170dfa46c@gatewaygeomatics.com>
 <e7fc8fca-5c56-1b70-ccfd-679512449677@gatewaygeomatics.com>
Message-ID: <5c08d06c-b4d4-82dc-0990-926c5ef3b727@gatewaygeomatics.com>

On 2017-04-18 1:56 PM, Jeff McKenna wrote:
> On 2017-04-18 1:50 PM, Jeff McKenna wrote:
>> On 2017-04-14 5:10 AM, Even Rouault wrote:
>>> I have prepared the GDAL/OGR 2.2.0 Beta 1 release. It will potentially
>>> be followed by a second beta, or directly by a RC1 if things go well.
>>> The source is available at:
>>
>> Tested in the MS4W build environment on Windows, with VS 2015 and 2012.
>> No issues compiling or running with VS 2015.  With VS 2012 I get this
>> error right away when starting to compile (cpl_vsil_curl.cpp) :
>> https://pastebin.com/hBi6sv0c
>>
>> -jeff
>>
>>
>
> I just noticed a very recent change (after beta1) to GDAL of "fix
> compilation with VS2015"  <--- this is confusing, as I just tested
> successfully VS2015 for the full MS4W build (includes netcdf-c-4.4.0,
> libkml, poppler, etc etc).  Maybe your recent change was not needed in
> my build environment?  odd.
>
> -jeff
>
>
>

Also note that I recently (January?) worked with the netcdf-c devs 
regarding compiling issues with VisualStudio with their 4.4.1 release: 
https://github.com/Unidata/netcdf-c/issues/304

anyway, that's now too much feedback from me here, ha!  :)

-jeff






From jmckenna at gatewaygeomatics.com  Tue Apr 18 10:56:38 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 18 Apr 2017 14:56:38 -0300
Subject: [gdal-dev] GDAL 2.2.0 beta 1 available
In-Reply-To: <5c08d06c-b4d4-82dc-0990-926c5ef3b727@gatewaygeomatics.com>
References: <2453387.3za1Omjnzt@even-i700>
 <79be06d8-34a2-f973-3377-329170dfa46c@gatewaygeomatics.com>
 <e7fc8fca-5c56-1b70-ccfd-679512449677@gatewaygeomatics.com>
 <5c08d06c-b4d4-82dc-0990-926c5ef3b727@gatewaygeomatics.com>
Message-ID: <306147fc-2dc2-fe63-6f83-48026b727390@gatewaygeomatics.com>

On 2017-04-18 2:06 PM, Jeff McKenna wrote:
> On 2017-04-18 1:56 PM, Jeff McKenna wrote:
>> On 2017-04-18 1:50 PM, Jeff McKenna wrote:
>>> On 2017-04-14 5:10 AM, Even Rouault wrote:
>>>> I have prepared the GDAL/OGR 2.2.0 Beta 1 release. It will potentially
>>>> be followed by a second beta, or directly by a RC1 if things go well.
>>>> The source is available at:
>>>
>>> Tested in the MS4W build environment on Windows, with VS 2015 and 2012.
>>> No issues compiling or running with VS 2015.  With VS 2012 I get this
>>> error right away when starting to compile (cpl_vsil_curl.cpp) :
>>> https://pastebin.com/hBi6sv0c
>>>
>>> -jeff
>>>
>>>
>>
>> I just noticed a very recent change (after beta1) to GDAL of "fix
>> compilation with VS2015"  <--- this is confusing, as I just tested
>> successfully VS2015 for the full MS4W build (includes netcdf-c-4.4.0,
>> libkml, poppler, etc etc).  Maybe your recent change was not needed in
>> my build environment?  odd.
>>
>> -jeff
>>
>>
>>
>
> Also note that I recently (January?) worked with the netcdf-c devs
> regarding compiling issues with VisualStudio with their 4.4.1 release:
> https://github.com/Unidata/netcdf-c/issues/304
>
> anyway, that's now too much feedback from me here, ha!  :)
>
> -jeff
>
>
>

my 2012 issue was a missing -DNOMINMAX in my nmake.opt Now both 2012 and 
2015 work fine.  great work Even!

-jeff





From jukka.rahkonen at maanmittauslaitos.fi  Tue Apr 18 12:39:39 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 18 Apr 2017 12:39:39 -0700 (MST)
Subject: [gdal-dev] Filtering GeoTIFFs touching/inside an area
In-Reply-To: <CAARFvTUtx8ttPw2baU9+bBT-UExdGpH_=FFRm2PeMbLqbtJPcg@mail.gmail.com>
References: <CAARFvTUtx8ttPw2baU9+bBT-UExdGpH_=FFRm2PeMbLqbtJPcg@mail.gmail.com>
Message-ID: <1492544379372-5317678.post@n6.nabble.com>

Nelson A. de Oliveira wrote
> Is it possible to filter GeoTIFFs touching/inside a specific area?
> 
> For example, https://i.imgur.com/xPA4iqq.png
> 
> I have a lot of GeoTIFFs, an area and would like to somehow filter
> only the images that are touching or inside that area.
> It's not exactly a clipping here, since I need to keep the GeoTIFFs
> intact.

Hi,

A simple method is to utilize gdaltindex http://www.gdal.org/gdaltindex.html
for creating a shapefile that holds the envelopes and file names. Gdaltindex
is a bit inaccurate because it stores the envelopes of the images as
polygons without considering possible no-data areas.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Filtering-GeoTIFFs-touching-inside-an-area-tp5317591p5317678.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From aron.olsen at sweco.dk  Wed Apr 19 11:40:28 2017
From: aron.olsen at sweco.dk (Olsen Aron)
Date: Wed, 19 Apr 2017 18:40:28 +0000
Subject: [gdal-dev] gdal_translate - GeoPdf
Message-ID: <AM2PR07MB05454A98E2BD161936C7D2B0F1180@AM2PR07MB0545.eurprd07.prod.outlook.com>

Hi there,

I have been experimenting with Gdal 2.2-dev as of generating GeoPdf files.
All of what I have been trying out seems to be working just fine:


-       Stacking of multiple raster-layers

-       Stacking of multiple vector-layers (with attribute-info)

Though, I have some comments/objections:

When generating a PDF one would expect that it should be possible to control the actual size (in paper-units) of the actually produced PDF.
This will allow for one to do "Print In Actual Size" from Adobe Acrobat Reader yielding a true-scale print (say 1:500).

It would also be nice, if a preferred paper-unit could be specified up front (inch, cm, mm). This could allow for a more precise mappings to A-formats (which I believe are inherent in PDF).

Currently (as of GDAL 2.2dev) the paper-unit-type is always "inch", and the actual size (internal properties of PDF) can only be controlled by letting the bottom-most raster layer presented to gdal_translate have a pixel-size corresponding exactly to the user-unit size (1/72 inch) of the desired PDF paper-size.

I suggest, that gdal_translate should treat a DPI-setting literally: The DPI setting should apply to the bottom raster-layer. All other raster/vector layers are to be mapped to that "media-box".
As of WRITE_USERUNIT it is only to provide for a mean to "scale" the resolution. It should be a scale value, to be applied to the default USER_UNIT value of PDF (1/72 inch).

Regards,
Aron


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170419/a614b622/attachment.html>

From aron.olsen at sweco.dk  Wed Apr 19 18:57:52 2017
From: aron.olsen at sweco.dk (Olsen Aron)
Date: Thu, 20 Apr 2017 01:57:52 +0000
Subject: [gdal-dev] gdal_translate - GeoPdf
Message-ID: <AM2PR07MB0545481D66442C21EC4FAF97F11B0@AM2PR07MB0545.eurprd07.prod.outlook.com>

Hi again,

Regarding my previous post I'd like to add something more:


1)    A printer has its own "margins" (non-printable portions of a page). This cannot be foreseen. I believe, that a "smart" PDF-application is capable of detecting the bbox of all "printable" elements in a PDF, and thus be able to fit that bbox onto a piece of paper of perfectly chosen/best fitted size.


2)    When trying to produce true-scale PDF-maps (with margins), pre-calculations and pre-processing have to performed up front. This, in order to achieve a desired print quality of all raster and vector layers (DPI).
What I am saying is, that a producer of a true-scale PDF-map needs to be aware of lots of the aspects of the to-be generated PDF.
Thus, in my point of view, the input to gdal_translate need not to be easily understood (but documentation serves well :)).

I hope this will clarify my objectives, somehow.
Thank you very much!

/Aron

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170420/3b8848a2/attachment-0001.html>

From andrew at aitchison.me.uk  Thu Apr 20 04:54:08 2017
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Thu, 20 Apr 2017 12:54:08 +0100 (BST)
Subject: [gdal-dev] GDAL 2.2.0beta1 and old poppler libraries
In-Reply-To: <5028034.AqcsH4eHcK@even-i700>
References: <2453387.3za1Omjnzt@even-i700>
 <alpine.LRH.2.20.1704161807470.32536@warden.aitchison.me.uk>
 <5028034.AqcsH4eHcK@even-i700>
Message-ID: <alpine.LRH.2.20.1704201246440.19695@warden.aitchison.me.uk>

On Sun, 16 Apr 2017, Even Rouault wrote:

> On dimanche 16 avril 2017 20:31:09 CEST Andrew C Aitchison wrote:
>> GDAL 2.2.0 beta1
>> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6).
>> g++ 4.9.2 and g++ 5.3.1
>>
>> gdal-2.2.0/frmts/pdf/pdfdataset.cpp does not compile on my
>> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6) machine.
>>
>> pdfio.h lines 87-90:
>>     private:
>>          /* Added in poppler 0.15.0 */
>>          virtual GBool hasGetChars() override;
>>          virtual int getChars(int nChars, Guchar *buffer) override;
>
> You can just remove the override qualifier in the above methods. Supporting properly this old
> version could be done but would be quite tedious.

I found an existing define which is true for poppler >= 0.16.
And have written a patch which leaves the override qualifier for
newer poppler libraries but disables it for very old ones.
Somewhere around 0.15 or 0.16 it will incorrectly remove the override 
qualifier, but the code will still compile correctly.

-- 
Andrew C Aitchison
-------------- next part --------------
--- frmts/pdf/pdfio.h	2017/04/16 19:18:35
+++ frmts/pdf/pdfio.h	2017/04/19 14:32:02
@@ -85,9 +85,18 @@
         virtual void       close() override;
 
     private:
-        /* Added in poppler 0.15.0 */
+#ifdef POPPLER_BASE_STREAM_HAS_TWO_ARGS
+        /* getChars/hasGetChars added in poppler 0.15.0
+         * POPPLER_BASE_STREAM_HAS_TWO_ARGS true from poppler 0.16,
+         * This test will be wrong for poppler 0.15 or 0.16,
+         * but will still compile correctly.
+         */
         virtual GBool hasGetChars() override;
         virtual int getChars(int nChars, Guchar *buffer) override;
+#else
+        virtual GBool hasGetChars() ;
+        virtual int getChars(int nChars, Guchar *buffer) ;
+#endif
 
         VSIPDFFileStream  *poParent;
         GooString         *poFilename;

From even.rouault at spatialys.com  Thu Apr 20 05:03:12 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 20 Apr 2017 14:03:12 +0200
Subject: [gdal-dev] GDAL 2.2.0beta1 and old poppler libraries
In-Reply-To: <alpine.LRH.2.20.1704201246440.19695@warden.aitchison.me.uk>
References: <2453387.3za1Omjnzt@even-i700> <5028034.AqcsH4eHcK@even-i700>
 <alpine.LRH.2.20.1704201246440.19695@warden.aitchison.me.uk>
Message-ID: <1857484.04CIJPhRvm@even-i700>

On jeudi 20 avril 2017 12:54:08 CEST Andrew C Aitchison wrote:
> On Sun, 16 Apr 2017, Even Rouault wrote:
> > On dimanche 16 avril 2017 20:31:09 CEST Andrew C Aitchison wrote:
> >> GDAL 2.2.0 beta1
> >> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6).
> >> g++ 4.9.2 and g++ 5.3.1
> >> 
> >> gdal-2.2.0/frmts/pdf/pdfdataset.cpp does not compile on my
> >> Scientific Linux 6 (= CentOS6 =  Red Hat EL 6) machine.
> >> 
> >> pdfio.h lines 87-90:
> >>     private:
> >>          /* Added in poppler 0.15.0 */
> >>          virtual GBool hasGetChars() override;
> >>          virtual int getChars(int nChars, Guchar *buffer) override;
> > 
> > You can just remove the override qualifier in the above methods.
> > Supporting properly this old version could be done but would be quite
> > tedious.
> 
> I found an existing define which is true for poppler >= 0.16.
> And have written a patch which leaves the override qualifier for
> newer poppler libraries but disables it for very old ones.
> Somewhere around 0.15 or 0.16 it will incorrectly remove the override
> qualifier, but the code will still compile correctly.

Thanks Andrew. Your patch is reasonable. I've just committed it.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170420/50f5f27d/attachment.html>

From schwehr at gmail.com  Thu Apr 20 17:06:22 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Thu, 20 Apr 2017 17:06:22 -0700
Subject: [gdal-dev] Google OSS Fuzz
Message-ID: <CACmBxyvcZ+AM8z_AXebALDgtPuOD1KNLX=6d1_-QnwYSH0+pzQ@mail.gmail.com>

The Google security team is interested in having GDAL join the OSS-Fuzz -
Continuous Fuzzing for Open Source Software project:

https://github.com/google/oss-fuzz

I've been doing this a bit for GDAL internally at Google, but it's not at
head and the bugs generated are not available until I take action to push
them out.

If folks are interested, I've got a few fuzzers that we can start with that
we can copy from gdal-autotest2.

-kurt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170420/2f7f284a/attachment.html>

From mateusz at loskot.net  Fri Apr 21 00:23:50 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 21 Apr 2017 09:23:50 +0200
Subject: [gdal-dev] Google OSS Fuzz
In-Reply-To: <CACmBxyvcZ+AM8z_AXebALDgtPuOD1KNLX=6d1_-QnwYSH0+pzQ@mail.gmail.com>
References: <CACmBxyvcZ+AM8z_AXebALDgtPuOD1KNLX=6d1_-QnwYSH0+pzQ@mail.gmail.com>
Message-ID: <CABUeae8F0aoO=vF4R3tUPYi7p3S2bDejHwfEAjB1Gkq1__5THg@mail.gmail.com>

On 21 April 2017 at 02:06, Kurt Schwehr <schwehr at gmail.com> wrote:
> The Google security team is interested in having GDAL join the OSS-Fuzz -
> Continuous Fuzzing for Open Source Software project:
>
> https://github.com/google/oss-fuzz
>
> If folks are interested, I've got a few fuzzers that we can start with that
> we can copy from gdal-autotest2.

I think it's an interesting project GDAL should be part of.

I'm interested. What is your plan, where help is needed?

p.s. I see OSS-Fuzz is going to add new fuzing engines in future.
Perhaps Dr Memory/Dr Fuzz, already used by Chromium AFAIK,
will be considered too. AFAIU it comes with built-in fuzzer
and supports Windows.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From Roger.Bivand at nhh.no  Fri Apr 21 01:12:35 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 21 Apr 2017 10:12:35 +0200
Subject: [gdal-dev] 2.2.0beta1 regression NULL values
Message-ID: <alpine.LFD.2.20.1704210958100.2592@reclus.nhh.no>

See https://github.com/edzer/sfr/issues/309 - < 2.2.0 we could write 
"missing values" in vector drivers and read them back. In 2.2.0beta1, we 
see REAL "missing values" written out OK, but read back as numeric zero. 
We've only checked shapefiles and GPKG so far.

Is this RFC 67? Until now, rgdal code (and likely sf) has used:

       case OFTReal:
 	if (poFeature->IsFieldSet(iField))
           REAL(ans)[iRow]=poFeature->GetFieldAsDouble(iField);
 	else REAL(ans)[iRow]=NA_REAL;
 	break;

and the same for other field and list field types. Should we be using:

int    CPL_DLL OGR_F_IsFieldSetAndNotNull( OGRFeatureH, int );

and should we be writing:

void   CPL_DLL OGR_F_SetFieldNull( OGRFeatureH, int );

instead of leaving the field unset with for example:

              if (!ISNA(NUMERIC_POINTER(VECTOR_ELT(ldata, j))[i]))
                  poFeature->SetField( CHAR(STRING_ELT(fld_names, j)),
                      NUMERIC_POINTER(VECTOR_ELT(ldata, j))[i] );

that is jumping over features for which the field value coming from R is 
missing?

We'd need to condition on GDAL version here (too), I guess.

Was this regression intended?

Best wishes,

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From even.rouault at spatialys.com  Fri Apr 21 01:54:26 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 21 Apr 2017 10:54:26 +0200
Subject: [gdal-dev] 2.2.0beta1 regression NULL values
In-Reply-To: <alpine.LFD.2.20.1704210958100.2592@reclus.nhh.no>
References: <alpine.LFD.2.20.1704210958100.2592@reclus.nhh.no>
Message-ID: <2692877.nQM7PTVWXc@even-i700>

Hi Roger,

> See https://github.com/edzer/sfr/issues/309 - < 2.2.0 we could write
> "missing values" in vector drivers and read them back. In 2.2.0beta1, we
> see REAL "missing values" written out OK, but read back as numeric zero.

Did you check the output with ogrinfo/GDAL 2.2 to verify that they are indeed properly 
written as missing ?

> We've only checked shapefiles and GPKG so far.
> 
> Is this RFC 67?

Most likely

> Until now, rgdal code (and likely sf) has used:
> 
>        case OFTReal:
>  	if (poFeature->IsFieldSet(iField))
>            REAL(ans)[iRow]=poFeature->GetFieldAsDouble(iField);
>  	else REAL(ans)[iRow]=NA_REAL;
>  	break;
> 
> and the same for other field and list field types. Should we be using:
> 
> int    CPL_DLL OGR_F_IsFieldSetAndNotNull( OGRFeatureH, int );

Yes

> 
> and should we be writing:
> 
> void   CPL_DLL OGR_F_SetFieldNull( OGRFeatureH, int );
> 
> instead of leaving the field unset with for example:
> 
>               if (!ISNA(NUMERIC_POINTER(VECTOR_ELT(ldata, j))[i]))
>                   poFeature->SetField( CHAR(STRING_ELT(fld_names, j)),
>                       NUMERIC_POINTER(VECTOR_ELT(ldata, j))[i] );
> 
> that is jumping over features for which the field value coming from R is
> missing?

Leaving the field unset or setting it to Null with OGR_F_SetFieldNull() will have the same 
effect for most drivers. For example the shapefile driver uses IsFieldSetAndNotNull() 
internally on the write side, so both should result in the same result. The difference between 
unset and setting to null will only be seen for JSon-based drivers or GML.

> 
> We'd need to condition on GDAL version here (too), I guess.
> 
> Was this regression intended?

There are indeed a few backward incompatible changes (that you've mentionned above) per 
https://trac.osgeo.org/gdal/wiki/rfc67_nullfieldvalues that require user code changes.

Besides those intended changes, it is not impossible of course there's a real regression in 
GDAL itself, but ideally you should try to isolate it from the Rgdal code, possibly through a 
standalone C code or a GDAL Python script, so it can be more easily investigated 
(unfortunately, I couldn't really make sense of the ticket you mentionned due to my 
unfamiliarity with rgdal or sf). I'd also start by making sure where the issue is really: on the 
read side, or the write side. For example by producing a shapefile/GPKG with rgdal/GDAL 
2.1.3 and reading it with rgdal/GDAL 2.2, and the reverse.

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/6d111dce/attachment.html>

From sean at mapbox.com  Fri Apr 21 01:57:16 2017
From: sean at mapbox.com (Sean Gillies)
Date: Fri, 21 Apr 2017 10:57:16 +0200
Subject: [gdal-dev] Clarification about ownership of srs passed to
	GDALDatasetCreateLayer()?
Message-ID: <CADPhZXwsBOrdzi+HM4_JDyJr=FTpYExun_Dtz0aRYVP9uGseoQ@mail.gmail.com>

Hi all,

I've written some C code (in one of Fiona's extension modules) that

1. sets a OGRSpatialReferenceH using OSRSetFromUserInput()
2. passes this OGRSpatialReferenceH to GDALDatasetCreateLayer()
3. frees the OGRSpatialReferenceH using OSRDestroySpatialReference()
4. adds feature definitions and features to the layer
4. calls GDALClose() on the layer's dataset

When using the Shapefile driver, this code always works. When using the
GPKG driver on Mac OS X and Windows (reports at
https://github.com/Toblerity/Fiona/issues/441) sporadic crashes occur in
OGRSpatialReference::Release() as the dataset is closed and the table,
feature definition, and geometry field definition is torn down.

Does a created layer take ownership of the OGRSpatialReferenceH? What's the
difference in the implementation of Shapefile and GPKG layers?

Thanks in advance!

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/69814f8b/attachment-0001.html>

From even.rouault at spatialys.com  Fri Apr 21 02:14:30 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 21 Apr 2017 11:14:30 +0200
Subject: [gdal-dev] Clarification about ownership of srs passed to
	GDALDatasetCreateLayer()?
In-Reply-To: <CADPhZXwsBOrdzi+HM4_JDyJr=FTpYExun_Dtz0aRYVP9uGseoQ@mail.gmail.com>
References: <CADPhZXwsBOrdzi+HM4_JDyJr=FTpYExun_Dtz0aRYVP9uGseoQ@mail.gmail.com>
Message-ID: <1524888.apAkiOpVOG@even-i700>

On vendredi 21 avril 2017 10:57:16 CEST Sean Gillies wrote:
> Hi all,
> 
> I've written some C code (in one of Fiona's extension modules) that
> 
> 1. sets a OGRSpatialReferenceH using OSRSetFromUserInput()
> 2. passes this OGRSpatialReferenceH to GDALDatasetCreateLayer()
> 3. frees the OGRSpatialReferenceH using OSRDestroySpatialReference()

Please use OSRRelease() instead. It is always safe to use in all situations where you would use 
OSRDestroySpatialReference().

> 4. adds feature definitions and features to the layer
> 4. calls GDALClose() on the layer's dataset
> 
> When using the Shapefile driver, this code always works. When using the
> GPKG driver on Mac OS X and Windows (reports at
> https://github.com/Toblerity/Fiona/issues/441) sporadic crashes occur in
> OGRSpatialReference::Release() as the dataset is closed and the table,
> feature definition, and geometry field definition is torn down.
> 
> Does a created layer take ownership of the OGRSpatialReferenceH?
> What's the
> difference in the implementation of Shapefile and GPKG layers?

The shapefile driver clones the passed object, whereas the GPKG only increments the 
reference counter. The ownership contract in the doc was not mentionned. I've just added """ 
The driver might only increase
the reference counter of the object to take ownership, and not make a full copy,
so do not use OSRDestroySpatialReference(), but OSRRelease() instead when you
are done with the object."""

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/88a5acf6/attachment.html>

From Roger.Bivand at nhh.no  Fri Apr 21 02:50:31 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 21 Apr 2017 11:50:31 +0200
Subject: [gdal-dev] 2.2.0beta1 regression NULL values
In-Reply-To: <2692877.nQM7PTVWXc@even-i700>
References: <alpine.LFD.2.20.1704210958100.2592@reclus.nhh.no>
 <2692877.nQM7PTVWXc@even-i700>
Message-ID: <alpine.LFD.2.20.1704211110040.2592@reclus.nhh.no>

Hi Even,

On Fri, 21 Apr 2017, Even Rouault wrote:

> Hi Roger,
>
>> See https://github.com/edzer/sfr/issues/309 - < 2.2.0 we could write
>> "missing values" in vector drivers and read them back. In 2.2.0beta1, we
>> see REAL "missing values" written out OK, but read back as numeric zero.
>
> Did you check the output with ogrinfo/GDAL 2.2 to verify that they are indeed properly
> written as missing ?
>
>> We've only checked shapefiles and GPKG so far.
>>
>> Is this RFC 67?
>
> Most likely
>
>> Until now, rgdal code (and likely sf) has used:
>>
>>        case OFTReal:
>>  	if (poFeature->IsFieldSet(iField))
>>            REAL(ans)[iRow]=poFeature->GetFieldAsDouble(iField);
>>  	else REAL(ans)[iRow]=NA_REAL;
>>  	break;
>>
>> and the same for other field and list field types. Should we be using:
>>
>> int    CPL_DLL OGR_F_IsFieldSetAndNotNull( OGRFeatureH, int );
>
> Yes
>
>>
>> and should we be writing:
>>
>> void   CPL_DLL OGR_F_SetFieldNull( OGRFeatureH, int );
>>
>> instead of leaving the field unset with for example:
>>
>>               if (!ISNA(NUMERIC_POINTER(VECTOR_ELT(ldata, j))[i]))
>>                   poFeature->SetField( CHAR(STRING_ELT(fld_names, j)),
>>                       NUMERIC_POINTER(VECTOR_ELT(ldata, j))[i] );
>>
>> that is jumping over features for which the field value coming from R is
>> missing?
>
> Leaving the field unset or setting it to Null with OGR_F_SetFieldNull() 
> will have the same effect for most drivers. For example the shapefile 
> driver uses IsFieldSetAndNotNull() internally on the write side, so both 
> should result in the same result. The difference between unset and 
> setting to null will only be seen for JSon-based drivers or GML.

Have commited code changes for rgdal which now work the same for 
2.2.0beta1 and 2.1.3 both for files generated by GDAL version, and crossed 
(read 2.2.0beta1-generated files on 2.1.3 and vice-versa). Edzer made the 
changes a week ago in sf.

>
>>
>> We'd need to condition on GDAL version here (too), I guess.
>>
>> Was this regression intended?
>
> There are indeed a few backward incompatible changes (that you've 
> mentionned above) per
> https://trac.osgeo.org/gdal/wiki/rfc67_nullfieldvalues that require user 
> code changes.

Not a regression as far as I can now see, just a consequence of the 
"backward incompatible changes" that will affect many downstream users of 
many drivers, I guess.

Thanks for getting back so quickly,

Roger

>
> Besides those intended changes, it is not impossible of course there's a 
> real regression in GDAL itself, but ideally you should try to isolate it 
> from the Rgdal code, possibly through a standalone C code or a GDAL 
> Python script, so it can be more easily investigated (unfortunately, I 
> couldn't really make sense of the ticket you mentionned due to my 
> unfamiliarity with rgdal or sf). I'd also start by making sure where the 
> issue is really: on the read side, or the write side. For example by 
> producing a shapefile/GPKG with rgdal/GDAL 2.1.3 and reading it with 
> rgdal/GDAL 2.2, and the reverse.
>
> Best regards,
>
> Even
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From sean at mapbox.com  Fri Apr 21 04:09:22 2017
From: sean at mapbox.com (Sean Gillies)
Date: Fri, 21 Apr 2017 13:09:22 +0200
Subject: [gdal-dev] Clarification about ownership of srs passed to
	GDALDatasetCreateLayer()?
In-Reply-To: <1524888.apAkiOpVOG@even-i700>
References: <CADPhZXwsBOrdzi+HM4_JDyJr=FTpYExun_Dtz0aRYVP9uGseoQ@mail.gmail.com>
 <1524888.apAkiOpVOG@even-i700>
Message-ID: <CADPhZXyZFdphffpW9=1hb-Ag_2fcKvd6g2y2+nx0F6J96hzs-g@mail.gmail.com>

Thanks, Even!

On Fri, Apr 21, 2017 at 11:14 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On vendredi 21 avril 2017 10:57:16 CEST Sean Gillies wrote:
>
> > Hi all,
>
> >
>
> > I've written some C code (in one of Fiona's extension modules) that
>
> >
>
> > 1. sets a OGRSpatialReferenceH using OSRSetFromUserInput()
>
> > 2. passes this OGRSpatialReferenceH to GDALDatasetCreateLayer()
>
> > 3. frees the OGRSpatialReferenceH using OSRDestroySpatialReference()
>
>
>
> Please use OSRRelease() instead. It is always safe to use in all
> situations where you would use OSRDestroySpatialReference().
>
>
>
> > 4. adds feature definitions and features to the layer
>
> > 4. calls GDALClose() on the layer's dataset
>
> >
>
> > When using the Shapefile driver, this code always works. When using the
>
> > GPKG driver on Mac OS X and Windows (reports at
>
> > https://github.com/Toblerity/Fiona/issues/441) sporadic crashes occur in
>
> > OGRSpatialReference::Release() as the dataset is closed and the table,
>
> > feature definition, and geometry field definition is torn down.
>
> >
>
> > Does a created layer take ownership of the OGRSpatialReferenceH?
>
> > What's the
>
> > difference in the implementation of Shapefile and GPKG layers?
>
>
>
> The shapefile driver clones the passed object, whereas the GPKG only
> increments the reference counter. The ownership contract in the doc was not
> mentionned. I've just added """ The driver might only increase
>
> the reference counter of the object to take ownership, and not make a full
> copy,
>
> so do not use OSRDestroySpatialReference(), but OSRRelease() instead when
> you
>
> are done with the object."""
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/1770793c/attachment.html>

From even.rouault at spatialys.com  Fri Apr 21 06:11:20 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 21 Apr 2017 15:11:20 +0200
Subject: [gdal-dev] 2.2.0beta1 regression NULL values
In-Reply-To: <alpine.LFD.2.20.1704211110040.2592@reclus.nhh.no>
References: <alpine.LFD.2.20.1704210958100.2592@reclus.nhh.no>
 <2692877.nQM7PTVWXc@even-i700>
 <alpine.LFD.2.20.1704211110040.2592@reclus.nhh.no>
Message-ID: <2006942.h0NVqja97p@even-i700>

> 
> Not a regression as far as I can now see, just a consequence of the
> "backward incompatible changes" that will affect many downstream users of
> many drivers, I guess.

When this was implemented, I didn't foresee a solution that would have kept a clean 
API while maintaining backward compatible behaviour, so yes that's the price to pay 
for new capabilities.

I'll modify the NEWS to mention in the RFC 67 item that there are backward 
incompatible change, and I'll actually fix MIGRATION_GUIDE.TXT since the related 
topic is actually misplaced in the MIGRATION GUIDE FROM GDAL 2.0 to GDAL 2.1 
section, instead of 2.1 to 2.2


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/0ee749f1/attachment-0001.html>

From benjamin.deschamps at canada.ca  Fri Apr 21 08:58:11 2017
From: benjamin.deschamps at canada.ca (Deschamps, Benjamin (AAFC/AAC))
Date: Fri, 21 Apr 2017 15:58:11 +0000
Subject: [gdal-dev] gdalwarp RCP issues between GDAL 2.1.0 and 2.1.3
Message-ID: <mailman.6.1492790987.18830.gdal-dev@lists.osgeo.org>

Hi,

I've run into issues using gdalwarp for an RPC ortho. My input GeoTiff file contains the required information in the RPC metadata domain, and the command runs fine under the GDAL 2.1.0 command line utility (windows 7, 64-bit):

gdalwarp -multi -tap -et 0.0 -r cubic -srcnodata 0 -rpc -overwrite -to "RPC_DEM_INTERPOLATION=CUBIC" -to "RPC_DEM_MISSING_VALUE=0" -to "RPC_DEM=D:\Temp\bug_gdalwarp\DEM.tif" -tr 30 30 -t_srs "+proj=aea +lat_1=44.75 +lat_2=55.75 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs" D:\Temp\bug_gdalwarp\IMG.tif D:\Temp\bug_gdalwarp\IMG_ortho.tif

However, the same command and inputs fail under GDAL 2.1.3, without error messages, after getting to about 20% on the progress bar. It simply pops up the usual window saying "gdalwarp.exe has stopped working. A problem caused the program to stop working correctly"...

Strangely, it only crashes for some images, while some are OK. I haven't been able to pinpoint the cause.

I can make the input files available to specific people via Google Drive, please let me know.

Thanks,

Benjamin Deschamps

Physical Sciences Specialist - Geoinformatics, Science and Technology Branch
Agriculture and Agri-Food Canada / Government of Canada
Benjamin.Deschamps at canada.ca / Tel: 613-715-5130 / TTY: 613-773-2600

Spécialiste des sciences physiques - Géoinformatique, Direction générale des sciences et de la technologie
Agriculture et Agroalimentaire Canada / Gouvernement du Canada
Benjamin.Deschamps at canada.ca / Tél. : 613-715-5130 / ATS : 613-773-2600

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/6dd80a4c/attachment.html>

From benjamin.deschamps at canada.ca  Fri Apr 21 09:50:10 2017
From: benjamin.deschamps at canada.ca (Deschamps, Benjamin (AAFC/AAC))
Date: Fri, 21 Apr 2017 16:50:10 +0000
Subject: [gdal-dev] gdalwarp RCP issues between GDAL 2.1.0 and 2.1.3
In-Reply-To: <1843891.X3l2YcQazW@even-i700>
References: <20170421160947.45BCD61346B1@lists.osgeo.org>
 <1843891.X3l2YcQazW@even-i700>
Message-ID: <mailman.7.1492793414.18830.gdal-dev@lists.osgeo.org>

A bit more information:

PROJ4 is 4.8.0 for GDAL 2.1.0; I think GDAL 2.1.3 might be getting the same version, from the system environment variables.

Machine has 32GB RAM.

Benjamin

From: Even Rouault [mailto:even.rouault at spatialys.com]
Sent: April-21-17 12:29 PM
To: Deschamps, Benjamin (AAFC/AAC)
Cc: Rollin, Patrick (AAFC/AAC)
Subject: Re: [gdal-dev] gdalwarp RCP issues between GDAL 2.1.0 and 2.1.3


> I can make the input files available to specific people via Google Drive,

> please let me know.



That would be useful indeed. Could you also specify the version number of proj.4 ? And the amount of RAM of the machine as well.



Even



>

> Thanks,

>

> Benjamin Deschamps

>

> Physical Sciences Specialist - Geoinformatics, Science and Technology Branch

> Agriculture and Agri-Food Canada / Government of Canada

> Benjamin.Deschamps at canada.ca<mailto:Benjamin.Deschamps at canada.ca> / Tel: 613-715-5130 / TTY: 613-773-2600

>

> Spécialiste des sciences physiques - Géoinformatique, Direction générale des

> sciences et de la technologie Agriculture et Agroalimentaire Canada /

> Gouvernement du Canada

> Benjamin.Deschamps at canada.ca<mailto:Benjamin.Deschamps at canada.ca> / Tél. : 613-715-5130 / ATS : 613-773-2600





--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/e7fec961/attachment.html>

From even.rouault at spatialys.com  Fri Apr 21 14:23:34 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 21 Apr 2017 23:23:34 +0200
Subject: [gdal-dev] gdalwarp RCP issues between GDAL 2.1.0 and 2.1.3
In-Reply-To: <20170421160947.45BCD61346B1@lists.osgeo.org>
References: <20170421160947.45BCD61346B1@lists.osgeo.org>
Message-ID: <1511099.6VWtHKEMhs@even-i700>

On vendredi 21 avril 2017 15:58:11 CEST Deschamps, Benjamin (AAFC/AAC) wrote:
> Hi,
> 
> I've run into issues using gdalwarp for an RPC ortho. My input GeoTiff file
> contains the required information in the RPC metadata domain, and the
> command runs fine under the GDAL 2.1.0 command line utility (windows 7,
> 64-bit):
> 
> gdalwarp -multi -tap -et 0.0 -r cubic -srcnodata 0 -rpc -overwrite -to
> "RPC_DEM_INTERPOLATION=CUBIC" -to "RPC_DEM_MISSING_VALUE=0" -to
> "RPC_DEM=D:\Temp\bug_gdalwarp\DEM.tif" -tr 30 30 -t_srs "+proj=aea
> +lat_1=44.75 +lat_2=55.75 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +ellps=WGS84
> +datum=WGS84 +units=m +no_defs" D:\Temp\bug_gdalwarp\IMG.tif
> D:\Temp\bug_gdalwarp\IMG_ortho.tif
> 
> However, the same command and inputs fail under GDAL 2.1.3, without error
> messages, after getting to about 20% on the progress bar. It simply pops up
> the usual window saying "gdalwarp.exe has stopped working. A problem caused
> the program to stop working correctly"...
> 
> Strangely, it only crashes for some images, while some are OK. I haven't
> been able to pinpoint the cause.

There was a race related to the use of -multi and RPC_DEM that can explain the somewhat 
random behaviour.
I've fixed it per https://trac.osgeo.org/gdal/ticket/6869

An easy workaround is to remove -multi that gives only modest performance improvements 
in most situations (especially here when there's no compression in the input or output).
Using -wo NUM_THREADS=ALL_CPUS (which can be combined with -multi in situations where 
-multi works) should be safe in that case even on 2.1.3, and bring much more performance 
improvement

I believe (haven't checked though) that even in 2.1.0, and probably earlier versions, if you 
don't get crashes, the race condition still exists and can possibly be silently unnoticed but 
probably produce wrong results. In 2.1.3 some sanity checks in that prevented the crash by 
chance in earlier versions had been removed, hence the crash. So even on 2.1.0 I'd advise not 
using -multi with RPC_DEM

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170421/0d64b868/attachment.html>

From even.rouault at spatialys.com  Sat Apr 22 07:58:40 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 22 Apr 2017 16:58:40 +0200
Subject: [gdal-dev] Google OSS Fuzz
In-Reply-To: <CABUeae8F0aoO=vF4R3tUPYi7p3S2bDejHwfEAjB1Gkq1__5THg@mail.gmail.com>
References: <CACmBxyvcZ+AM8z_AXebALDgtPuOD1KNLX=6d1_-QnwYSH0+pzQ@mail.gmail.com>
 <CABUeae8F0aoO=vF4R3tUPYi7p3S2bDejHwfEAjB1Gkq1__5THg@mail.gmail.com>
Message-ID: <7180485.4gcGv2gMJm@even-i700>

On vendredi 21 avril 2017 09:23:50 CEST Mateusz Loskot wrote:
> On 21 April 2017 at 02:06, Kurt Schwehr <schwehr at gmail.com> wrote:
> > The Google security team is interested in having GDAL join the OSS-Fuzz -
> > Continuous Fuzzing for Open Source Software project:
> > 
> > https://github.com/google/oss-fuzz
> > 
> > If folks are interested, I've got a few fuzzers that we can start with
> > that
> > we can copy from gdal-autotest2.
> 
> I think it's an interesting project GDAL should be part of.

+1

> 
> I'm interested. What is your plan, where help is needed?
> 
> p.s. I see OSS-Fuzz is going to add new fuzing engines in future.
> Perhaps Dr Memory/Dr Fuzz, already used by Chromium AFAIK,
> will be considered too. AFAIU it comes with built-in fuzzer
> and supports Windows.
> 
> Best regards,


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170422/4a69643f/attachment.html>

From mswope at gmail.com  Sat Apr 22 08:24:22 2017
From: mswope at gmail.com (Mike)
Date: Sat, 22 Apr 2017 09:24:22 -0600
Subject: [gdal-dev] issue updating shapefile using python bindings
Message-ID: <CAKTSvBipfvFY87mFvNFwScQbtMLdUfPjaqU=6tH5M_8OK0-UpA@mail.gmail.com>

Hi -
I have a script which at one point adds fields to a shapefile, then at
another time updates those fields. This happens a couple times through this
whole process.

#earlier

driver = ogr.GetDriverByName('ESRI Shapefile')

dataSource = driver.Open(inshp, 1)

layer = dataSource.GetLayer()

    idfield = ogr.FieldDefn('INFLD', ogr.OFTInteger)

    layer.CreateField(idfield)

dataSource = None



#later

driver = ogr.GetDriverByName('ESRI Shapefile')

dataSource = driver.Open(inshp, 1)

layer = dataSource.GetLayer()

layerDefinition = layer.GetLayerDefn()

flds = [layerDefinition.GetFieldDefn(i).GetName()

        for i in range(layerDefinition.GetFieldCount())]

for feature in layer:

    for fld in flds:

        ...

        print fld,somevalue,type(somevalue) # --> INFLD -9 <type 'int'>

        feature.SetField(fld,somevalue) # produces error (see below)

    layer.SetFeature(feature)

    feature = None

dataSource = None



This is the error I get. All of this (later part) is inside a function.
However when I run the function in IDLE, it works.


    feature.SetField(fld, somevalue)

  File "C:\PROGRA~1\QGIS2~1.18\apps\Python27\lib\site-packages\osgeo\ogr.py",
line 4273, in SetField

    return _ogr.Feature_SetFieldInteger64(self, fld_index, args[1])

TypeError: in method 'Feature_SetFieldInteger64', argument 2 of type 'int'


This is what ogrinfo reports on that field..

ogrinfo -so INSHP.shp

INFLD: Integer (9.0)


It seems that it won't take the integer of -9 into the field.


So, I am fairly new at using the ogr bindings.

My thoughts are

1) Am I closing the shapefile properly from the earlier step?

2) Looking at ogr.py 4273, it seems that there is a field type
difference 'Feature_SetFieldInteger64'
vs regular int.


Any pointers on how to move past this would be good. I won't be able to
look at the error till Monday, so I might not be able to answer any follow
up questions till then.




Thanks!

-Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170422/9ab12784/attachment-0001.html>

From even.rouault at spatialys.com  Sat Apr 22 09:52:34 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 22 Apr 2017 18:52:34 +0200
Subject: [gdal-dev] issue updating shapefile using python bindings
In-Reply-To: <CAKTSvBipfvFY87mFvNFwScQbtMLdUfPjaqU=6tH5M_8OK0-UpA@mail.gmail.com>
References: <CAKTSvBipfvFY87mFvNFwScQbtMLdUfPjaqU=6tH5M_8OK0-UpA@mail.gmail.com>
Message-ID: <27649136.iPvmpcPtbV@even-i700>

On samedi 22 avril 2017 09:24:22 CEST Mike wrote:
> Hi -
> I have a script which at one point adds fields to a shapefile, then at
> another time updates those fields. This happens a couple times through this
> whole process.
> 
> #earlier
> 
> driver = ogr.GetDriverByName('ESRI Shapefile')
> 
> dataSource = driver.Open(inshp, 1)
> 
> layer = dataSource.GetLayer()
> 
>     idfield = ogr.FieldDefn('INFLD', ogr.OFTInteger)
> 
>     layer.CreateField(idfield)
> 
> dataSource = None
> 
> 
> 
> #later
> 
> driver = ogr.GetDriverByName('ESRI Shapefile')
> 
> dataSource = driver.Open(inshp, 1)
> 
> layer = dataSource.GetLayer()
> 
> layerDefinition = layer.GetLayerDefn()
> 
> flds = [layerDefinition.GetFieldDefn(i).GetName()
> 
>         for i in range(layerDefinition.GetFieldCount())]
> 
> for feature in layer:
> 
>     for fld in flds:
> 
>         ...
> 
>         print fld,somevalue,type(somevalue) # --> INFLD -9 <type 'int'>
> 
>         feature.SetField(fld,somevalue) # produces error (see below)
> 
>     layer.SetFeature(feature)
> 
>     feature = None
> 
> dataSource = None
> 
> 
> 
> This is the error I get. All of this (later part) is inside a function.
> However when I run the function in IDLE, it works.
> 
> 
>     feature.SetField(fld, somevalue)
> 
>   File
> "C:\PROGRA~1\QGIS2~1.18\apps\Python27\lib\site-packages\osgeo\ogr.py", line
> 4273, in SetField
> 
>     return _ogr.Feature_SetFieldInteger64(self, fld_index, args[1])
> 
> TypeError: in method 'Feature_SetFieldInteger64', argument 2 of type 'int'
> 
> 
> This is what ogrinfo reports on that field..
> 
> ogrinfo -so INSHP.shp
> 
> INFLD: Integer (9.0)
> 
> 
> It seems that it won't take the integer of -9 into the field.
> 
> 
> So, I am fairly new at using the ogr bindings.
> 
> My thoughts are
> 
> 1) Am I closing the shapefile properly from the earlier step?
> 
> 2) Looking at ogr.py 4273, it seems that there is a field type
> difference 'Feature_SetFieldInteger64'
> vs regular int.
> 
> 
> Any pointers on how to move past this would be good. I won't be able to
> look at the error till Monday, so I might not be able to answer any follow
> up questions till then.

I'm not sure if it is your issue, but I could reproduce the same exception when the field name 
is a Python2 unicode string.
The workaround is to convert it to a standard string for example with str(x) if it is an ASCII 
string, or if it can have non ASCII characters with x.encode('utf8')
In 2.2, I've just fixed the bindings to accept a unicode string, in addition to a regular string.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170422/53dc1740/attachment.html>

From schwehr at gmail.com  Sat Apr 22 14:55:31 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sat, 22 Apr 2017 14:55:31 -0700
Subject: [gdal-dev] Google OSS Fuzz
In-Reply-To: <7180485.4gcGv2gMJm@even-i700>
References: <CACmBxyvcZ+AM8z_AXebALDgtPuOD1KNLX=6d1_-QnwYSH0+pzQ@mail.gmail.com>
 <CABUeae8F0aoO=vF4R3tUPYi7p3S2bDejHwfEAjB1Gkq1__5THg@mail.gmail.com>
 <7180485.4gcGv2gMJm@even-i700>
Message-ID: <CACmBxytguBEcSeToed3j+RjchFB28tvpyCdXzo-FAu8j6qo8Ow@mail.gmail.com>

> I'm interested. What is your plan, where help is needed?

I don't actually have a plan :)

I've been using an internal to Google interface to drive fuzzing so far and
have yet to look at what it takes to drive OSS-Fuzz.  So someone looking at
what we need to do to trigger the fuzzing would be great.

The actual writing of fuzzers is pretty easy...  e.g.
https://gist.github.com/schwehr/d4d48b60ed99986ce18703262fe98758

We just need to get a local version of WrapUnique
and autotest2::VsiMemTempWrappe, or something equivalent, or be explicit
about the cleanup.

Agreed that more fuzzing engines would be nice, but I think we are still at
the point where we can find bugs faster than we can fix them.  I've got a
stack of HFA issues and I hit my first GeoJSON bug with the first couple
minutes of fuzzing starting with an empty corpus on a single core.  A
comparison data point... kakadu was 43 issues found in approx a week of
fuzzing with 1k cores.

On Sat, Apr 22, 2017 at 7:58 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On vendredi 21 avril 2017 09:23:50 CEST Mateusz Loskot wrote:
>
> > On 21 April 2017 at 02:06, Kurt Schwehr <schwehr at gmail.com> wrote:
>
> > > The Google security team is interested in having GDAL join the
> OSS-Fuzz -
>
> > > Continuous Fuzzing for Open Source Software project:
>
> > >
>
> > > https://github.com/google/oss-fuzz
>
> > >
>
> > > If folks are interested, I've got a few fuzzers that we can start with
>
> > > that
>
> > > we can copy from gdal-autotest2.
>
> >
>
> > I think it's an interesting project GDAL should be part of.
>
>
>
> +1
>
>
>
> >
>
> > I'm interested. What is your plan, where help is needed?
>
> >
>
> > p.s. I see OSS-Fuzz is going to add new fuzing engines in future.
>
> > Perhaps Dr Memory/Dr Fuzz, already used by Chromium AFAIK,
>
> > will be considered too. AFAIU it comes with built-in fuzzer
>
> > and supports Windows.
>
> >
>
> > Best regards,
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170422/cac8ed5f/attachment.html>

From glendening at drjack.net  Sat Apr 22 22:55:23 2017
From: glendening at drjack.net (John W. Glendening)
Date: Sat, 22 Apr 2017 22:55:23 -0700
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png gives
 black background tiles
Message-ID: <1492926923.5300.3.camel@HP-GLENDENI>

I have been creating a tileset from a .vrt based upon .tif files using
gdal2tiles.py.  The .tif files consist of lines overlaid upon a
background map but I now want to eliminate the background map,
i.e. make that area transparent, so the tiles will have only the lines
on a transparent background, so they can be used as an overlay.

I successfully produced the desired .tif files with transparent
background and created a .vrt.  But using gdal2tiles.py gives a black
background (RGBA=0,0,0,255) where a transparent background is
expected. (The expected lines _are_ present, on top of the black
background.)

Thinking that there might be a problem with the gdal2tiles.py
interpretation of the .vrt, I used gdal_translate to convert it to a
(large!) .png file and used that as the gdal2tiles.py argument
instead.  But the background remains black.  As a check of the png
file, I used gdal_translate to crop out and view a section and its
background was indeed transparent (RGBA=0,0,0,0) in the expected
places.

I also tried two other variants of the gdal2tiles.py file that I found
on the web, one from osgeo (with a 2013 copyright) and one from a
geophython site - with identical results.

I'm hoping for some guidance here.

FYI an extract of gdalinfo for the .vrt file is:
 Driver: VRT/Virtual Raster
 Files: 24ksections.vrt
        /home/glendeni/HIKES/TRAILMAP/TILES/BigSurTrailmap-sectionA1-map.tif
        ...
 Size is 37840, 48993
 Coordinate System is:
 PROJCS["unnamed",
     GEOGCS["unnamedellipse",
         DATUM["unknown",
             SPHEROID["unnamed",6378137,0]],
         PRIMEM["Greenwich",0],
         UNIT["degree",0.0174532925199433]],
     PROJECTION["Mercator_1SP"],
     PARAMETER["central_meridian",0],
     PARAMETER["scale_factor",1],
     PARAMETER["false_easting",0],
     PARAMETER["false_northing",0],
     UNIT["metre",1,
         AUTHORITY["EPSG","9001"]]]
 Origin = (-13565727.275918338447809,4356632.541813874617219)
 Pixel Size = (1.836533043499999,-1.836542168400001)
 Corner Coordinates:
 Upper Left  (-13565727.276, 4356632.542) (121d51'46.81"W,
36d24'21.64"N)
 Lower Left  (-13565727.276, 4266654.831) (121d51'46.81"W, 35d45'
9.94"N)
 Upper Right (-13496232.866, 4356632.542) (121d14'19.40"W,
36d24'21.64"N)
 Lower Right (-13496232.866, 4266654.831) (121d14'19.40"W, 35d45'
9.94"N)
 Center      (-13530980.071, 4311643.687) (121d33' 3.10"W, 36d
4'48.23"N)
 Band 1 Block=128x128 Type=UInt16, ColorInterp=Red
 Band 2 Block=128x128 Type=UInt16, ColorInterp=Green
 Band 3 Block=128x128 Type=UInt16, ColorInterp=Blue
 Band 4 Block=128x128 Type=UInt16, ColorInterp=Alpha

The gdalinfo for the .png created by gdal_translate from the .vrt is:
 Driver: PNG/Portable Network Graphics
 Files: 24ksections.png
        24ksections.png.aux.xml
 Size is 37840, 48993
 Coordinate System is:
 PROJCS["unnamed",
     GEOGCS["unnamedellipse",
         DATUM["unknown",
             SPHEROID["unnamed",6378137,0]],
         PRIMEM["Greenwich",0],
         UNIT["degree",0.0174532925199433]],
     PROJECTION["Mercator_1SP"],
     PARAMETER["central_meridian",0],
     PARAMETER["scale_factor",1],
     PARAMETER["false_easting",0],
     PARAMETER["false_northing",0],
     UNIT["metre",1,
         AUTHORITY["EPSG","9001"]]]
 Origin = (-13565727.275918338447809,4356632.541813874617219)
 Pixel Size = (1.836533043499999,-1.836542168400001)
 Image Structure Metadata:
   INTERLEAVE=PIXEL
 Corner Coordinates:
 Upper Left  (-13565727.276, 4356632.542) (121d51'46.81"W,
36d24'21.64"N)
 Lower Left  (-13565727.276, 4266654.831) (121d51'46.81"W, 35d45'
9.94"N)
 Upper Right (-13496232.866, 4356632.542) (121d14'19.40"W,
36d24'21.64"N)
 Lower Right (-13496232.866, 4266654.831) (121d14'19.40"W, 35d45'
9.94"N)
 Center      (-13530980.071, 4311643.687) (121d33' 3.10"W, 36d
4'48.23"N)
 Band 1 Block=37840x1 Type=UInt16, ColorInterp=Red
 Band 2 Block=37840x1 Type=UInt16, ColorInterp=Green
 Band 3 Block=37840x1 Type=UInt16, ColorInterp=Blue
 Band 4 Block=37840x1 Type=UInt16, ColorInterp=Alpha


-- 
John W. (Jack) Glendening


From gregory.bataille at gmail.com  Sun Apr 23 00:35:53 2017
From: gregory.bataille at gmail.com (=?UTF-8?Q?Gr=C3=A9gory_Bataille?=)
Date: Sun, 23 Apr 2017 09:35:53 +0200
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <1492926923.5300.3.camel@HP-GLENDENI>
References: <1492926923.5300.3.camel@HP-GLENDENI>
Message-ID: <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>

Hey John,

Is your TIF transparent background using properly the NODATA special value?
If so you can tell gdal2tiles how to interpret and translate the nodata in
RGBA using the -a option

gdal2tiles.py SOURCE DEST -a 0,0,0,0

I think that should produce the desired effect

Let me know


---
Gregory Bataille

On Sun, Apr 23, 2017 at 7:55 AM, John W. Glendening <glendening at drjack.net>
wrote:

> I have been creating a tileset from a .vrt based upon .tif files using
> gdal2tiles.py.  The .tif files consist of lines overlaid upon a
> background map but I now want to eliminate the background map,
> i.e. make that area transparent, so the tiles will have only the lines
> on a transparent background, so they can be used as an overlay.
>
> I successfully produced the desired .tif files with transparent
> background and created a .vrt.  But using gdal2tiles.py gives a black
> background (RGBA=0,0,0,255) where a transparent background is
> expected. (The expected lines _are_ present, on top of the black
> background.)
>
> Thinking that there might be a problem with the gdal2tiles.py
> interpretation of the .vrt, I used gdal_translate to convert it to a
> (large!) .png file and used that as the gdal2tiles.py argument
> instead.  But the background remains black.  As a check of the png
> file, I used gdal_translate to crop out and view a section and its
> background was indeed transparent (RGBA=0,0,0,0) in the expected
> places.
>
> I also tried two other variants of the gdal2tiles.py file that I found
> on the web, one from osgeo (with a 2013 copyright) and one from a
> geophython site - with identical results.
>
> I'm hoping for some guidance here.
>
> FYI an extract of gdalinfo for the .vrt file is:
>  Driver: VRT/Virtual Raster
>  Files: 24ksections.vrt
>         /home/glendeni/HIKES/TRAILMAP/TILES/BigSurTrailmap-
> sectionA1-map.tif
>         ...
>  Size is 37840, 48993
>  Coordinate System is:
>  PROJCS["unnamed",
>      GEOGCS["unnamedellipse",
>          DATUM["unknown",
>              SPHEROID["unnamed",6378137,0]],
>          PRIMEM["Greenwich",0],
>          UNIT["degree",0.0174532925199433]],
>      PROJECTION["Mercator_1SP"],
>      PARAMETER["central_meridian",0],
>      PARAMETER["scale_factor",1],
>      PARAMETER["false_easting",0],
>      PARAMETER["false_northing",0],
>      UNIT["metre",1,
>          AUTHORITY["EPSG","9001"]]]
>  Origin = (-13565727.275918338447809,4356632.541813874617219)
>  Pixel Size = (1.836533043499999,-1.836542168400001)
>  Corner Coordinates:
>  Upper Left  (-13565727.276, 4356632.542) (121d51'46.81"W,
> 36d24'21.64"N)
>  Lower Left  (-13565727.276, 4266654.831) (121d51'46.81"W, 35d45'
> 9.94"N)
>  Upper Right (-13496232.866, 4356632.542) (121d14'19.40"W,
> 36d24'21.64"N)
>  Lower Right (-13496232.866, 4266654.831) (121d14'19.40"W, 35d45'
> 9.94"N)
>  Center      (-13530980.071, 4311643.687) (121d33' 3.10"W, 36d
> 4'48.23"N)
>  Band 1 Block=128x128 Type=UInt16, ColorInterp=Red
>  Band 2 Block=128x128 Type=UInt16, ColorInterp=Green
>  Band 3 Block=128x128 Type=UInt16, ColorInterp=Blue
>  Band 4 Block=128x128 Type=UInt16, ColorInterp=Alpha
>
> The gdalinfo for the .png created by gdal_translate from the .vrt is:
>  Driver: PNG/Portable Network Graphics
>  Files: 24ksections.png
>         24ksections.png.aux.xml
>  Size is 37840, 48993
>  Coordinate System is:
>  PROJCS["unnamed",
>      GEOGCS["unnamedellipse",
>          DATUM["unknown",
>              SPHEROID["unnamed",6378137,0]],
>          PRIMEM["Greenwich",0],
>          UNIT["degree",0.0174532925199433]],
>      PROJECTION["Mercator_1SP"],
>      PARAMETER["central_meridian",0],
>      PARAMETER["scale_factor",1],
>      PARAMETER["false_easting",0],
>      PARAMETER["false_northing",0],
>      UNIT["metre",1,
>          AUTHORITY["EPSG","9001"]]]
>  Origin = (-13565727.275918338447809,4356632.541813874617219)
>  Pixel Size = (1.836533043499999,-1.836542168400001)
>  Image Structure Metadata:
>    INTERLEAVE=PIXEL
>  Corner Coordinates:
>  Upper Left  (-13565727.276, 4356632.542) (121d51'46.81"W,
> 36d24'21.64"N)
>  Lower Left  (-13565727.276, 4266654.831) (121d51'46.81"W, 35d45'
> 9.94"N)
>  Upper Right (-13496232.866, 4356632.542) (121d14'19.40"W,
> 36d24'21.64"N)
>  Lower Right (-13496232.866, 4266654.831) (121d14'19.40"W, 35d45'
> 9.94"N)
>  Center      (-13530980.071, 4311643.687) (121d33' 3.10"W, 36d
> 4'48.23"N)
>  Band 1 Block=37840x1 Type=UInt16, ColorInterp=Red
>  Band 2 Block=37840x1 Type=UInt16, ColorInterp=Green
>  Band 3 Block=37840x1 Type=UInt16, ColorInterp=Blue
>  Band 4 Block=37840x1 Type=UInt16, ColorInterp=Alpha
>
>
> --
> John W. (Jack) Glendening
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170423/284e8a36/attachment-0001.html>

From even.rouault at spatialys.com  Sun Apr 23 05:58:00 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 23 Apr 2017 14:58:00 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
Message-ID: <2074035.mOHRANHkjt@even-i700>

Hi,

As there have already been a number of changes, I have prepared a Beta 2 for GDAL/OGR 
2.2.0. I think we can still aim for a RC1 at end of the week.

The source is available at:

    http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta2.tar.xz
    http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta2.tar.gz
    http://download.osgeo.org/gdal/2.2.0/gdal220beta2.zip

A snapshot of the Python autotest suite can be downloaded from:

    http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta2.tar.gz
    http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta2.zip

Changes since beta1 :
- GeoJSON: improve/fix field type promotion
- OGRGeometryFactory::organizePolygons(): return POLYGON EMPTY when - nPolygonCount 
== 0
- Remove all direct uses of json_tokener_parse_ex(); use OGRJSonParse() instead
- Set string length for libjson parser in OGRJSonParse.
- GeoJSON: fix crash if NATIVE_MEDIA_TYPE creation option is specified alone
- validate_gpkg: fix validation of req 62
- Python bindings: accept unicode strings as field name argument in Feature (like SetField, 
GetField, etc...) and FeatureDefn methods
- javadoc.java: fix signature for get/set datetime methods
gdalwarp: fix crash when -multi and -to RPC_DEM are used together (fixes #6869)
- NITF: add support for writing JPEG2000 compressed images with JP2OpenJPEG driver; fix 
writing with JP2KAK driver (emit codestream only instead of JP2 format); fix setting of 
NBPR/NBPC/NPPBH/NPPBV fields for JPEG2000 (fixes #4322); in JP2ECW case, make sure 
that the default PROFILE=NPJE implies 1024 block size at the NITF level
- Fix hErrorMutex leak if GDALAllRegister is not called
- OGRParse: fix parsing logic to avoid false positive detection of string as datetime (#6867)
- GMLAS: improve swe:DataArray support and add swe:DataRecord support
- PDF: fix compilation with C++11 compiler and Poppler 0.15 from CentOS/RHEL 6
- Add CPLString(const char*, n) constructor (and some cleanup for ancient unsupported 
MSVC versions)
- GeoRaster driver: support for JP2-F compression, support direct loading of - - JPEG-F when 
blocking=no, default blocking increased from 256x256 to 512x512 (#6861)
- OpenJpeg driver: support direct extracting of GeoRaster JP2-F BLOB (#6861)
- OCI driver: support for long identifiers (up to 128 long) when running of 12.2 or +  (#6866)
- OCILOB VSIL driver: new driver to streams in and out of Oracle BLOB as a GDAL large virtual 
file system (#6861)
- netCDF: fix compilation with VS2015
- GTX: fix behaviour of SHIFT_ORIGIN_IN_MINUS_180_PLUS_180=YES when origin is at -180
- GTiff: map D_North_American_1927 datum citation name to OGC 
North_American_Datum_1927 so that datum is properly recognized (fixes #6863)
- MBTiles: fix setting of minzoom when computing overviews out of order
- Fix runtime of Python VRT derived bands with numpy 1.3 of RHEL 6
- GPKG: fix compilation error with sqlite3 < 3.7.8
- OSM: rename constant variable to knPAGE_SIZE to avoid clash with Cygwin's #define 
PAGE_SIZE in /usr/include/limits.h
- CSV: fix comparison broken in r36979 (fixes #6862)
- MBTiles: do not open .mbtiles that contain vector tiles, which are not supported by the 
driver
- netCDF: add a HONOUR_VALID_RANGE=YES/NO open option to control whether pixel 
values outside of the validity range should be set to the nodata value (#6857)
- DTED: correctly create files at latitudes -80, -75, -70 and -50 (#6859)
- Internal libgeotiff: hide symbols in --with-hide-internal-symbols mode
- configure: propagate -fvisibility=hidden in --with-hide-internal-symbols mode in 
CFLAGS_NOFTRAPV, CXXFLAGS_NOFTRAPV, CXXFLAGS_NO_LTO_IF_AVX_NONDEFAULT and 
CXXFLAGS_NO_LTO_IF_SSSE3_NONDEFAULT
- Shape: do not export Shapelib symbols for builds --with-hide-internal-symbols (#6860)
- GPKG: do not change application_id/user_version when appending a raster to an existing 
database
- GPKG: do not warn on gpkg_schema extension

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170423/7ba7d8d4/attachment.html>

From glendening at drjack.net  Sun Apr 23 10:03:58 2017
From: glendening at drjack.net (John W. Glendening)
Date: Sun, 23 Apr 2017 10:03:58 -0700
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
References: <1492926923.5300.3.camel@HP-GLENDENI>
 <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
Message-ID: <1492967038.5300.6.camel@HP-GLENDENI>

On Sun, 2017-04-23 at 09:35 +0200, Grégory Bataille wrote:
> Is your TIF transparent background using properly the NODATA special value?
> If so you can tell gdal2tiles how to interpret and translate the nodata in
> RGBA using the -a option
> gdal2tiles.py SOURCE DEST -a 0,0,0,0

Thank you, that solved the problem.  I was aware of NODATA when creating
images but had not realized that could also apply in this case. 

-- 
John W. (Jack) Glendening  831-484-6929
25953 Deer Run Lane  Salinas, CA  93908


From even.rouault at spatialys.com  Mon Apr 24 10:20:33 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 24 Apr 2017 19:20:33 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <2074035.mOHRANHkjt@even-i700>
References: <2074035.mOHRANHkjt@even-i700>
Message-ID: <9767620.0JnziLnAxb@even-i700>

Hi,

> - Shape: do not export Shapelib symbols for builds
> --with-hide-internal-symbols (#6860) 

It turns out that the above change breaks QGIS 2.18 build, in particular the DXF2SHP 
converter native plugin, since it does a nasty trick: the QGIS build tree has the shapelib 2.10 
includes files, but relies on linking against shapelib symbols exported by libgdal. The plugin 
apparently no longer exists in QGIS master, which builds fine against GDAL 2.2beta2.

So I'm not sure what to do:
1) revert #6860 and export again shapelib symbols from GDAL. But this apparently breaks 
some other workflows
2) let distributions apply a patch to do this revert, while they use QGIS 2.18 or other code 
that depend on GDAL exporting shapelib symbols
3) Change DXF2SHP plugin to use OGR API instead of shapelib, but I'm not feeling like I 
would do that myself.

My opinion would be to favor 2)

Opinions ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170424/6d6725da/attachment.html>

From schwehr at gmail.com  Mon Apr 24 10:35:08 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 24 Apr 2017 10:35:08 -0700
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <9767620.0JnziLnAxb@even-i700>
References: <2074035.mOHRANHkjt@even-i700> <9767620.0JnziLnAxb@even-i700>
Message-ID: <CACmBxyvhec9y5f9kqn3qf1nVAQzA8tsderK=Lsa9jnVPuJRsiQ@mail.gmail.com>

Ouch.  My take is that caching headers like that should be very strongly
discouraged.  Maintaining code with people doing that really isn't a
reasonable proposition.

+1 going with 2) with filing a bug for someone else to do 3).

On Mon, Apr 24, 2017 at 10:20 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
>
>
> > - Shape: do not export Shapelib symbols for builds
>
> > --with-hide-internal-symbols (#6860)
>
>
>
> It turns out that the above change breaks QGIS 2.18 build, in particular
> the DXF2SHP converter native plugin, since it does a nasty trick: the QGIS
> build tree has the shapelib 2.10 includes files, but relies on linking
> against shapelib symbols exported by libgdal. The plugin apparently no
> longer exists in QGIS master, which builds fine against GDAL 2.2beta2.
>
>
>
> So I'm not sure what to do:
>
> 1) revert #6860 and export again shapelib symbols from GDAL. But this
> apparently breaks some other workflows
>
> 2) let distributions apply a patch to do this revert, while they use QGIS
> 2.18 or other code that depend on GDAL exporting shapelib symbols
>
> 3) Change DXF2SHP plugin to use OGR API instead of shapelib, but I'm not
> feeling like I would do that myself.
>
>
>
> My opinion would be to favor 2)
>
>
>
> Opinions ?
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170424/f1d7c23d/attachment.html>

From even.rouault at spatialys.com  Mon Apr 24 14:01:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 24 Apr 2017 23:01:06 +0200
Subject: [gdal-dev] [Qgis-developer]  GDAL 2.2.0 beta 2 available
In-Reply-To: <c3830462-6382-a00a-eaa2-6e03069dfc76@opengis.ch>
References: <2074035.mOHRANHkjt@even-i700> <9767620.0JnziLnAxb@even-i700>
 <c3830462-6382-a00a-eaa2-6e03069dfc76@opengis.ch>
Message-ID: <1657072.ZSogth11FZ@even-i700>

On lundi 24 avril 2017 22:21:28 CEST Matthias Kuhn wrote:
> Hi Even,
> 
> In the end, isn't solution 2) the same as solution 1) for the user? 

Somehow, except that I'd wish official GDAL no longer export shapelib symbols to avoid the 
issue of #6860

> In
> which case it sounds like it mainly puts additional load on
> distributions for no added value. Am I missing something?

For distributions that would ship both GDAL 2.2 and QGIS 2.18, yes that's an (hopefully small) 
burden to apply the revert patch of
https://trac.osgeo.org/gdal/changeset/37997

> 
> Especially because "some other workflows" is a quite loose definition.

The details are in
https://trac.osgeo.org/gdal/ticket/6860

> 
> In the end it sounds like the proper solutions would be to fix dxf2shp -
> but since that has already been sent to the graveyard it's questionable
> if someone wants to do the effort.

Agreed that investing time in modifying dxf2shp isn't really something appealing.

> 
> More options
> 
> 4) ship shapelib with qgis itself (as part of the dxf2shp plugin)

Well, it is more or less partly shipped in dxf2shp except than the .c files aren't compiled, and 
there are at least the one doing the I/O interface missing.

> 
> 5) require GDAL < 2.2 for building QGIS 2.18

Not really an option for distributions that track latest versions of their components


Hum, there might be an intermediate option: revert the change in GDAL 2.2 branch, and keep 
it in 2.3dev which will probably be released in one year, at a time where QGIS 3 should have 
been released to.


> 
> Matthias
> 
> On 4/24/17 7:20 PM, Even Rouault wrote:
> > Hi,
> > 
> > > - Shape: do not export Shapelib symbols for builds
> > > 
> > > --with-hide-internal-symbols (#6860)
> > 
> > It turns out that the above change breaks QGIS 2.18 build, in
> > particular the DXF2SHP converter native plugin, since it does a nasty
> > trick: the QGIS build tree has the shapelib 2.10 includes files, but
> > relies on linking against shapelib symbols exported by libgdal. The
> > plugin apparently no longer exists in QGIS master, which builds fine
> > against GDAL 2.2beta2.
> > 
> > 
> > 
> > So I'm not sure what to do:
> > 
> > 1) revert #6860 and export again shapelib symbols from GDAL. But this
> > apparently breaks some other workflows
> > 
> > 2) let distributions apply a patch to do this revert, while they use
> > QGIS 2.18 or other code that depend on GDAL exporting shapelib symbols
> > 
> > 3) Change DXF2SHP plugin to use OGR API instead of shapelib, but I'm
> > not feeling like I would do that myself.
> > 
> > 
> > 
> > My opinion would be to favor 2)
> > 
> > 
> > 
> > Opinions ?
> > 
> > 
> > 
> > Even
> > 
> > 
> > 
> > 
> > Spatialys - Geospatial professional services
> > 
> > http://www.spatialys.com
> > 
> > 
> > 
> > _______________________________________________
> > Qgis-developer mailing list
> > Qgis-developer at lists.osgeo.org
> > List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> > Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170424/ca73f036/attachment.html>

From nyall.dawson at gmail.com  Mon Apr 24 14:47:31 2017
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Tue, 25 Apr 2017 07:47:31 +1000
Subject: [gdal-dev] [Qgis-developer] GDAL 2.2.0 beta 2 available
In-Reply-To: <1657072.ZSogth11FZ@even-i700>
References: <2074035.mOHRANHkjt@even-i700> <9767620.0JnziLnAxb@even-i700>
 <c3830462-6382-a00a-eaa2-6e03069dfc76@opengis.ch>
 <1657072.ZSogth11FZ@even-i700>
Message-ID: <CAB28Asi2FSbh=aDcHLZ+LOUbaKcastVyZzXHfn9fydbXdz=btg@mail.gmail.com>

On 25 April 2017 at 07:01, Even Rouault <even.rouault at spatialys.com> wrote:

>
>> 5) require GDAL < 2.2 for building QGIS 2.18

What about

6) #ifdef the offending plugin out in 2.18 for GDAL >= 2.2?

Given that the plugin is removed in QGIS 3.0 anyway, I think early
retirement is a perfectly valid option. It's also the best option for
GDAL, and avoids any wasted effort temporarily fixing code which only
has a short time left to live anyway...

There's been no objections at all to the removal in 3.0 (although
admittedly only a small sample of users would be using the 3.0
development builds). I just suspect that this is almost never used and
most of our users won't notice its loss.

Nyall

From glendening at drjack.net  Mon Apr 24 15:34:27 2017
From: glendening at drjack.net (John W. Glendening)
Date: Mon, 24 Apr 2017 15:34:27 -0700
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
References: <1492926923.5300.3.camel@HP-GLENDENI>
 <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
Message-ID: <1493073267.6162.11.camel@HP-GLENDENI>

BTW, I should have mentioned that using -a 0,0,0 worked for the version
that I obtained from the osgeo site, and with a GDAL 2.1.0 version, but
not for the 
GDAL 1.11 version I had been using.

But I spoke too soon.  Indeed the expected transparent areas are now
transparent,
but all the lines are now black - except for a few places where they
have some small patches of color.  I've been working to figure this out
but with no solution.  

() Since I was now using a different version of gdal2tiles.py, as a
test I re-ran the non-transparent background case using that - it was
successful.

() I have been using a vrt created from separately created TIF file,
so for testing decided to work only with a single TIF file.  I
created a .vrt file from than and ran gdal2tiles.py on that - it gave
"bad" results i.e. black lines except for some blotches of color

() The .TIF is not geo-referenced, hence my use of a .vrt.  But that
was only necessary when I had multiple TIFs, so I used gdal_translate
(with a specified srs) to convert the TIF to a geo-referenced TIF.  But
the result as also "bad"

() The TIF was created using ImageMagick convert to draw lines on a
transparent canvas to create a TIF file.  It appears as expected when
viewed with IM "display".  But to check it I separately extracted and
viewed all 4 channels.  All appeared as expected.

() I re-ran gdal2tiles.py _without_ "-a 0,0,0,0" to now view the
results more critically and noticed that the drawn lines were
_not_ in their expected places - and many more lines were being
displayed
that should be.  Moreover, each line was not solid but was had 1 pixel
horizontal black lines running through them.

() Comparing to the transparent case, I now see that the color patches
occurring on the black lines of the latter occur where they are
crossed by one of the colored lines of the non-transparent case.

() My best interpretation is that the alpha layer is being applied
correctly, since lines do appear where expected.  But for some reason
the RGB layers are not getting interpreted correctly.  It makes me
wonder whether the TIF has some sort of interlacing that is not being
recognized.  But while that might make sense when the IM-produced .TIF
file is used, I would think that the gdal_translate output TIF would
not have that problem.

() I should note that all TIF files mentioned look as expected when
viewed with either IM  or "Eye of Gnome" or Gwenview viewers.

So am at a loss as to why gdal2tiles.py is not correctly treating this
TIF file. Any thoughts would be appreciated!



John W. (Jack) Glendening


From glendening at drjack.net  Mon Apr 24 15:39:55 2017
From: glendening at drjack.net (John W. Glendening)
Date: Mon, 24 Apr 2017 15:39:55 -0700
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
References: <1492926923.5300.3.camel@HP-GLENDENI>
 <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
Message-ID: <1493073595.6162.17.camel@HP-GLENDENI>

PS: just noticed that gdalinfo gives a difference between the TIFs used
for the transparent background vrt differ from those use for the
non-transparent map background vrt in that the former give
 Band 1 Block=5311x1 Type=UInt16, ColorInterp=Red
whereas the latter give
 Band 1 Block=5311x1 Type=Byte, ColorInterp=Red
  Mask Flags: PER_DATASET ALPHA 
(and similarly for the Blue,Green,Alpha bands)

I'm sure that means something to someone, but not to me.

John Glendening




From glendening at drjack.net  Mon Apr 24 16:25:27 2017
From: glendening at drjack.net (John W. Glendening)
Date: Mon, 24 Apr 2017 16:25:27 -0700
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
References: <1492926923.5300.3.camel@HP-GLENDENI>
 <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
Message-ID: <1493076327.6162.29.camel@HP-GLENDENI>

And finally I have kludged myself to a solution by using flags -type
Truecolor -depth 8 in my ImageMagick TIF creation, which produces only 3
bands.  Altering the vrt accordingly, and using -a 0,0,0 in
pdal2tiles.py, I get the expected result.  This has the effect of
removing any pure black in the overlay, but that is not significant for
my case.  

Still, I would hope to find a cleaner solution.  In particular, since in
my pre-kludge case I start from a RGBA TIF and since gdal2tiles.py
produces RGBA PNGs, I would have thought I could get an overlay which
has a partial opacity.  My original case did have one partial opacity
polygon, which I removed after I learned that only a 0/1 opacity
solution was possible.  I can live without that, but it does surprise me
that there appears no way to pass on the TIF opacity to the PNG opacity.


John Glendening


From glendening at drjack.net  Mon Apr 24 18:41:29 2017
From: glendening at drjack.net (John W. Glendening)
Date: Mon, 24 Apr 2017 18:41:29 -0700
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
References: <1492926923.5300.3.camel@HP-GLENDENI>
 <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
Message-ID: <1493084489.6162.30.camel@HP-GLENDENI>

Finally having some success using ImageMagick convert, I backed up by
not using its -Truecolor flag, i.e. using only a -depth 8 flag, which
produced a 4 band RGBA.  Creating a .vrt and running gdal2tiles.py
produced successful results, _without_ needing the -a 0,0,0,0
argument.  I then pushed things further by adding the partial opacity
polygons back in.  That did produce partial opacity polygons in the
tiles, but instead of being magenta they were gray.  Don't know how to
explain that, probably a limitation in gdal2tiles.py - but it is at
least partial success.

Summary: IM convert produced a "UInt16" format TIF when lines are
drawn on its blank transparent canvas, whereas drawing them on a
pre-created background map image produced "Byte" format TIFs.  The
gdalbuildvrt understood that and so indicated in the .vrt file it
produced.  But gdal2tiles.py apparently only understands "Byte" format
files.  The IM convert requires a "-depth 8" flag to produce such
files.

John Glendening


-- 
John W. (Jack) Glendening  831-484-6929
25953 Deer Run Lane  Salinas, CA  93908


From gregory.bataille at gmail.com  Mon Apr 24 21:45:15 2017
From: gregory.bataille at gmail.com (=?UTF-8?Q?Gr=C3=A9gory_Bataille?=)
Date: Tue, 25 Apr 2017 06:45:15 +0200
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <1493084489.6162.30.camel@HP-GLENDENI>
References: <1492926923.5300.3.camel@HP-GLENDENI>
 <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
 <1493084489.6162.30.camel@HP-GLENDENI>
Message-ID: <CACVcCzpTOtKVdnzRJqz253itfhw-Q-OrP_9euKdmR9cd31KuTA@mail.gmail.com>

Hey John,

That's a lot of information to process :)
So your conclusion would be that gdal2tiles does not handle TIF "Byte"
files properly?

Would you be able to submit some samples of working TIF + VRT and
non-working ones so that I might have a look in the future if it's a bug?


---
Gregory Bataille

On Tue, Apr 25, 2017 at 3:41 AM, John W. Glendening <glendening at drjack.net>
wrote:

> Finally having some success using ImageMagick convert, I backed up by
> not using its -Truecolor flag, i.e. using only a -depth 8 flag, which
> produced a 4 band RGBA.  Creating a .vrt and running gdal2tiles.py
> produced successful results, _without_ needing the -a 0,0,0,0
> argument.  I then pushed things further by adding the partial opacity
> polygons back in.  That did produce partial opacity polygons in the
> tiles, but instead of being magenta they were gray.  Don't know how to
> explain that, probably a limitation in gdal2tiles.py - but it is at
> least partial success.
>
> Summary: IM convert produced a "UInt16" format TIF when lines are
> drawn on its blank transparent canvas, whereas drawing them on a
> pre-created background map image produced "Byte" format TIFs.  The
> gdalbuildvrt understood that and so indicated in the .vrt file it
> produced.  But gdal2tiles.py apparently only understands "Byte" format
> files.  The IM convert requires a "-depth 8" flag to produce such
> files.
>
> John Glendening
>
>
> --
> John W. (Jack) Glendening  831-484-6929
> 25953 Deer Run Lane  Salinas, CA  93908
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/20623186/attachment.html>

From glendening at drjack.net  Mon Apr 24 22:51:18 2017
From: glendening at drjack.net (John W. Glendening)
Date: Mon, 24 Apr 2017 22:51:18 -0700
Subject: [gdal-dev] gdal2tiles.py of transparent background vrt/png
 gives black background tiles
In-Reply-To: <CACVcCzpTOtKVdnzRJqz253itfhw-Q-OrP_9euKdmR9cd31KuTA@mail.gmail.com>
References: <1492926923.5300.3.camel@HP-GLENDENI>
 <CACVcCzqEEw-HpyU9V0m59-Zgtjtfy8SMHCReqc==bMif5Lpt6Q@mail.gmail.com>
 <1493084489.6162.30.camel@HP-GLENDENI>
 <CACVcCzpTOtKVdnzRJqz253itfhw-Q-OrP_9euKdmR9cd31KuTA@mail.gmail.com>
Message-ID: <1493099478.6162.42.camel@HP-GLENDENI>

Certainly.  And I again want to thank you for your help. The files
totaled 13MB so I've put them on the web at
http://bigsurtrailmap.net/TEMP/  I will expect to delete them at some
time but not for at least a month.

The "transparent" tif was created by drawing lines on a transparent
canvas of specified size using ImageMagic convert.  The "depth8polygons"
tif was created similarly with "-depth 8" flag added and partial-opacity
polygons also drawn (outlined+filled with magenta, but they display in
gray). 

Both were processed with "gdal2tiles.py -z 14
--resampling=average ...vrt"
The "transparent" file gives bad results, the "depth8polygons" one
displays
as expected (except for the polygons being gray).

Besides the associated .vrt files I've added the .prf & .tfw files used
to create them and the gdal2tiles.py I used.  If I can help further let
me know, but unfortunately my Python coding skills are non-existent.

John Glendening




From even.rouault at spatialys.com  Tue Apr 25 02:04:46 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Apr 2017 11:04:46 +0200
Subject: [gdal-dev] [Qgis-developer]  GDAL 2.2.0 beta 2 available
In-Reply-To: <1657072.ZSogth11FZ@even-i700>
References: <2074035.mOHRANHkjt@even-i700>
 <c3830462-6382-a00a-eaa2-6e03069dfc76@opengis.ch>
 <1657072.ZSogth11FZ@even-i700>
Message-ID: <4088633.oPOaFN5Pce@even-i700>

> 
> Hum, there might be an intermediate option: revert the change in GDAL 2.2
> branch, and keep it in 2.3dev which will probably be released in one year,
> at a time where QGIS 3 should have been released to.

I've taken another road finally. Build the internal copy of shapelib of QGIS with some 
modifications :
* prefix all the SHP* and DBF* symbols of it with qgis_ to avoid symbol name clashes
* and use GDAL VSI Large file I/O instead of standard lib FILE API so that UTF-8 names are 
properly handled on Windows.

>From my (light) tests, seems to work (on Linux).

==> https://github.com/qgis/QGIS/pull/4413

Even

> 
> > Matthias
> > 
> > On 4/24/17 7:20 PM, Even Rouault wrote:
> > > Hi,
> > > 
> > > > - Shape: do not export Shapelib symbols for builds
> > > > 
> > > > --with-hide-internal-symbols (#6860)
> > > 
> > > It turns out that the above change breaks QGIS 2.18 build, in
> > > particular the DXF2SHP converter native plugin, since it does a nasty
> > > trick: the QGIS build tree has the shapelib 2.10 includes files, but
> > > relies on linking against shapelib symbols exported by libgdal. The
> > > plugin apparently no longer exists in QGIS master, which builds fine
> > > against GDAL 2.2beta2.
> > > 
> > > 
> > > 
> > > So I'm not sure what to do:
> > > 
> > > 1) revert #6860 and export again shapelib symbols from GDAL. But this
> > > apparently breaks some other workflows
> > > 
> > > 2) let distributions apply a patch to do this revert, while they use
> > > QGIS 2.18 or other code that depend on GDAL exporting shapelib symbols
> > > 
> > > 3) Change DXF2SHP plugin to use OGR API instead of shapelib, but I'm
> > > not feeling like I would do that myself.
> > > 
> > > 
> > > 
> > > My opinion would be to favor 2)
> > > 
> > > 
> > > 
> > > Opinions ?
> > > 
> > > 
> > > 
> > > Even
> > > 
> > > 
> > > 
> > > 
> > > Spatialys - Geospatial professional services
> > > 
> > > http://www.spatialys.com
> > > 
> > > 
> > > 
> > > _______________________________________________
> > > Qgis-developer mailing list
> > > Qgis-developer at lists.osgeo.org
> > > List info: https://lists.osgeo.org/mailman/listinfo/qgis-developer
> > > Unsubscribe: https://lists.osgeo.org/mailman/listinfo/qgis-developer


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/809e2ebf/attachment-0001.html>

From osahon.gis at gmail.com  Tue Apr 25 04:37:43 2017
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Tue, 25 Apr 2017 12:37:43 +0100
Subject: [gdal-dev] QGIS Loads Black Screen For PostGIS Out-Db Raster Data
Message-ID: <CAGpiUSiXrtgaoZgo-B_0GsjqRvU8sT7E71TVpOTwFurH42CBQw@mail.gmail.com>

Hi All,

I have an out-db raster on PostGIS which I tried to load in QGIS (v
2.14.12-Essen) utilizing the DB Manager to establish a connection. I could
view the raster table, but when I try to "Add to canvas" it displays a
black screen instead of the raster image.

This raster file exist on the filesystem and when it is loaded directly
into QGIS it displays the image (aerial photo). Also, when the same file is
stored in PostGIS as a raster (IN-DB), it can be viewed in QGIS (using the
DB Manager tool). However, when I link the same file as an OUT-DB raster in
PostGIS (in this case only the metadata of the raster and the filepath to
the raster file is stored), an attempt to view it in QGIS (using the DB
Manager tool) results in a black image being displayed instead of the
aerial photo.

I have been told it has to do with QGIS-GDAL support for PostGIS Out-DB
rasters. I would be glad if someone could help me resolve this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/f2874518/attachment.html>

From even.rouault at spatialys.com  Tue Apr 25 04:55:25 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Apr 2017 13:55:25 +0200
Subject: [gdal-dev] QGIS Loads Black Screen For PostGIS Out-Db Raster
	Data
In-Reply-To: <CAGpiUSiXrtgaoZgo-B_0GsjqRvU8sT7E71TVpOTwFurH42CBQw@mail.gmail.com>
References: <CAGpiUSiXrtgaoZgo-B_0GsjqRvU8sT7E71TVpOTwFurH42CBQw@mail.gmail.com>
Message-ID: <3213218.GYCMKrb6i8@even-i700>

On mardi 25 avril 2017 12:37:43 CEST Osahon Oduware wrote:
> Hi All,
> 
> I have an out-db raster on PostGIS which I tried to load in QGIS (v
> 2.14.12-Essen) utilizing the DB Manager to establish a connection. I could
> view the raster table, but when I try to "Add to canvas" it displays a
> black screen instead of the raster image.
> 
> This raster file exist on the filesystem and when it is loaded directly
> into QGIS it displays the image (aerial photo). Also, when the same file is
> stored in PostGIS as a raster (IN-DB), it can be viewed in QGIS (using the
> DB Manager tool). However, when I link the same file as an OUT-DB raster in
> PostGIS (in this case only the metadata of the raster and the filepath to
> the raster file is stored), an attempt to view it in QGIS (using the DB
> Manager tool) results in a black image being displayed instead of the
> aerial photo.
> 
> I have been told it has to do with QGIS-GDAL support for PostGIS Out-DB
> rasters. I would be glad if someone could help me resolve this.

Osahon,

out-db support is not implemented yet in the GDAL PostGISRaster driver.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/ed954c62/attachment.html>

From sean at mapbox.com  Tue Apr 25 05:26:46 2017
From: sean at mapbox.com (Sean Gillies)
Date: Tue, 25 Apr 2017 14:26:46 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <2074035.mOHRANHkjt@even-i700>
References: <2074035.mOHRANHkjt@even-i700>
Message-ID: <CADPhZXwQS_kzyWG+Ha7qGtUt5ajhdurKpX2GwUTE873nCCJ99g@mail.gmail.com>

Hi Even,

2.2.0beta2 fails to build on my macbook. Here is the error:

cpl_conv.cpp:2060:9: error: use of undeclared identifier 'isnan'; did you
mean 'std::isnan'?
    if( CPLIsNan(dfAngle) )
        ^
/Users/sean/code/frs-wheel-builds/parts/gdal__compile__/gdal-2.2.0/port/cpl_port.h:687:23:
note: expanded from macro 'CPLIsNan'
#  define CPLIsNan(x) isnan(x)
                      ^
/usr/include/c++/4.2.1/cmath:551:5: note: 'std::isnan' declared here
    isnan(_Tp __f) { return ::__gnu_cxx::__capture_isnan(__f); }
    ^
1 error generated.


My compiler details:

$ gcc -v
Configured with: --prefix=/Library/Developer/CommandLineTools/usr
--with-gxx-include-dir=/usr/include/c++/4.2.1
Apple LLVM version 8.0.0 (clang-800.0.42.1)
Target: x86_64-apple-darwin16.4.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin

Perhaps related to the changes at
https://github.com/OSGeo/gdal/blame/trunk/gdal/port/cpl_port.h#L656-L667?
2.1.3 builds with no errors, only a few warnings about redefinition of
HAVE_LONG_LONG (in combination with Python).


On Sun, Apr 23, 2017 at 2:58 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
>
>
> As there have already been a number of changes, I have prepared a Beta 2
> for GDAL/OGR 2.2.0. I think we can still aim for a RC1 at end of the week.
>
>
>
> The source is available at:
>
>
>
> http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta2.tar.xz
>
> http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0beta2.tar.gz
>
> http://download.osgeo.org/gdal/2.2.0/gdal220beta2.zip
>
>
>
> A snapshot of the Python autotest suite can be downloaded from:
>
>
>
> http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta2.tar.gz
>
> http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0beta2.zip
>
>
>
> Changes since beta1 :
>
> - GeoJSON: improve/fix field type promotion
>
> - OGRGeometryFactory::organizePolygons(): return POLYGON EMPTY when -
> nPolygonCount == 0
>
> - Remove all direct uses of json_tokener_parse_ex(); use OGRJSonParse()
> instead
>
> - Set string length for libjson parser in OGRJSonParse.
>
> - GeoJSON: fix crash if NATIVE_MEDIA_TYPE creation option is specified
> alone
>
> - validate_gpkg: fix validation of req 62
>
> - Python bindings: accept unicode strings as field name argument in
> Feature (like SetField, GetField, etc...) and FeatureDefn methods
>
> - javadoc.java: fix signature for get/set datetime methods
>
> gdalwarp: fix crash when -multi and -to RPC_DEM are used together (fixes
> #6869)
>
> - NITF: add support for writing JPEG2000 compressed images with
> JP2OpenJPEG driver; fix writing with JP2KAK driver (emit codestream only
> instead of JP2 format); fix setting of NBPR/NBPC/NPPBH/NPPBV fields for
> JPEG2000 (fixes #4322); in JP2ECW case, make sure that the default
> PROFILE=NPJE implies 1024 block size at the NITF level
>
> - Fix hErrorMutex leak if GDALAllRegister is not called
>
> - OGRParse: fix parsing logic to avoid false positive detection of string
> as datetime (#6867)
>
> - GMLAS: improve swe:DataArray support and add swe:DataRecord support
>
> - PDF: fix compilation with C++11 compiler and Poppler 0.15 from
> CentOS/RHEL 6
>
> - Add CPLString(const char*, n) constructor (and some cleanup for ancient
> unsupported MSVC versions)
>
> - GeoRaster driver: support for JP2-F compression, support direct loading
> of - - JPEG-F when blocking=no, default blocking increased from 256x256 to
> 512x512 (#6861)
>
> - OpenJpeg driver: support direct extracting of GeoRaster JP2-F BLOB
> (#6861)
>
> - OCI driver: support for long identifiers (up to 128 long) when running
> of 12.2 or + (#6866)
>
> - OCILOB VSIL driver: new driver to streams in and out of Oracle BLOB as a
> GDAL large virtual file system (#6861)
>
> - netCDF: fix compilation with VS2015
>
> - GTX: fix behaviour of SHIFT_ORIGIN_IN_MINUS_180_PLUS_180=YES when
> origin is at -180
>
> - GTiff: map D_North_American_1927 datum citation name to OGC
> North_American_Datum_1927 so that datum is properly recognized (fixes #6863)
>
> - MBTiles: fix setting of minzoom when computing overviews out of order
>
> - Fix runtime of Python VRT derived bands with numpy 1.3 of RHEL 6
>
> - GPKG: fix compilation error with sqlite3 < 3.7.8
>
> - OSM: rename constant variable to knPAGE_SIZE to avoid clash with
> Cygwin's #define PAGE_SIZE in /usr/include/limits.h
>
> - CSV: fix comparison broken in r36979 (fixes #6862)
>
> - MBTiles: do not open .mbtiles that contain vector tiles, which are not
> supported by the driver
>
> - netCDF: add a HONOUR_VALID_RANGE=YES/NO open option to control whether
> pixel values outside of the validity range should be set to the nodata
> value (#6857)
>
> - DTED: correctly create files at latitudes -80, -75, -70 and -50 (#6859)
>
> - Internal libgeotiff: hide symbols in --with-hide-internal-symbols mode
>
> - configure: propagate -fvisibility=hidden in --with-hide-internal-symbols
> mode in CFLAGS_NOFTRAPV, CXXFLAGS_NOFTRAPV, CXXFLAGS_NO_LTO_IF_AVX_NONDEFAULT
> and CXXFLAGS_NO_LTO_IF_SSSE3_NONDEFAULT
>
> - Shape: do not export Shapelib symbols for builds
> --with-hide-internal-symbols (#6860)
>
> - GPKG: do not change application_id/user_version when appending a raster
> to an existing database
>
> - GPKG: do not warn on gpkg_schema extension
>
>
>
> Even
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/2b4666b9/attachment-0001.html>

From even.rouault at spatialys.com  Tue Apr 25 05:44:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Apr 2017 14:44:06 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <CADPhZXwQS_kzyWG+Ha7qGtUt5ajhdurKpX2GwUTE873nCCJ99g@mail.gmail.com>
References: <2074035.mOHRANHkjt@even-i700>
 <CADPhZXwQS_kzyWG+Ha7qGtUt5ajhdurKpX2GwUTE873nCCJ99g@mail.gmail.com>
Message-ID: <2195221.p9BrHZrpQE@even-i700>

On mardi 25 avril 2017 14:26:46 CEST Sean Gillies wrote:
> Hi Even,
> 
> 2.2.0beta2 fails to build on my macbook. Here is the error:
> 
> cpl_conv.cpp:2060:9: error: use of undeclared identifier 'isnan'; did you
> mean 'std::isnan'?
>     if( CPLIsNan(dfAngle) )
>         ^
> /Users/sean/code/frs-wheel-builds/parts/gdal__compile__/gdal-2.2.0/port/cpl_
> port.h:687:23: note: expanded from macro 'CPLIsNan'
> #  define CPLIsNan(x) isnan(x)
>                       ^
> /usr/include/c++/4.2.1/cmath:551:5: note: 'std::isnan' declared here
>     isnan(_Tp __f) { return ::__gnu_cxx::__capture_isnan(__f); }
>     ^
> 1 error generated.

Hi Sean,

ah damned isnan issues...

Can you try the following patch:

Index: port/cpl_port.h
===================================================================
--- port/cpl_port.h	(revision 38115)
+++ port/cpl_port.h	(working copy)
@@ -653,8 +653,7 @@
 #  define CPLIsNan(x) _isnan(x)
 #  define CPLIsInf(x) (!_isnan(x) && !_finite(x))
 #  define CPLIsFinite(x) _finite(x)
-#elif defined(__cplusplus) && defined(__MINGW32__) &&  __GNUC__ == 4 && __GNUC_MINOR__ == 2
-/* Hack for compatibility with ancient i586-mingw32msvc toolchain */
+#elif defined(__cplusplus) && ((defined(__MINGW32__) &&  __GNUC__ == 4 && __GNUC_MINOR__ == 2) || HAVE_CXX11)
 extern "C++" {
 #include <cmath>
 static inline int CPLIsNan(float f) { return std::isnan(f); }



Even
-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/e3357036/attachment.html>

From sean at mapbox.com  Tue Apr 25 07:05:20 2017
From: sean at mapbox.com (Sean Gillies)
Date: Tue, 25 Apr 2017 16:05:20 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <2195221.p9BrHZrpQE@even-i700>
References: <2074035.mOHRANHkjt@even-i700>
 <CADPhZXwQS_kzyWG+Ha7qGtUt5ajhdurKpX2GwUTE873nCCJ99g@mail.gmail.com>
 <2195221.p9BrHZrpQE@even-i700>
Message-ID: <CADPhZXzSY5R0LrVChPTtDSp9H6aOh5zJ92QNTBXRs7MQj_JkxA@mail.gmail.com>

On Tue, Apr 25, 2017 at 2:44 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 25 avril 2017 14:26:46 CEST Sean Gillies wrote:
>
> > Hi Even,
>
> >
>
> > 2.2.0beta2 fails to build on my macbook. Here is the error:
>
> >
>
> > cpl_conv.cpp:2060:9: error: use of undeclared identifier 'isnan'; did you
>
> > mean 'std::isnan'?
>
> > if( CPLIsNan(dfAngle) )
>
> > ^
>
> > /Users/sean/code/frs-wheel-builds/parts/gdal__compile__/gdal
> -2.2.0/port/cpl_
>
> > port.h:687:23: note: expanded from macro 'CPLIsNan'
>
> > # define CPLIsNan(x) isnan(x)
>
> > ^
>
> > /usr/include/c++/4.2.1/cmath:551:5: note: 'std::isnan' declared here
>
> > isnan(_Tp __f) { return ::__gnu_cxx::__capture_isnan(__f); }
>
> > ^
>
> > 1 error generated.
>
>
>
> Hi Sean,
>
>
>
> ah damned isnan issues...
>
>
>
> Can you try the following patch:
>
>
>
> Index: port/cpl_port.h
>
> ===================================================================
>
> --- port/cpl_port.h (revision 38115)
>
> +++ port/cpl_port.h (working copy)
>
> @@ -653,8 +653,7 @@
>
> # define CPLIsNan(x) _isnan(x)
>
> # define CPLIsInf(x) (!_isnan(x) && !_finite(x))
>
> # define CPLIsFinite(x) _finite(x)
>
> -#elif defined(__cplusplus) && defined(__MINGW32__) && __GNUC__ == 4 &&
> __GNUC_MINOR__ == 2
>
> -/* Hack for compatibility with ancient i586-mingw32msvc toolchain */
>
> +#elif defined(__cplusplus) && ((defined(__MINGW32__) && __GNUC__ == 4 &&
> __GNUC_MINOR__ == 2) || HAVE_CXX11)
>
> extern "C++" {
>
> #include <cmath>
>
> static inline int CPLIsNan(float f) { return std::isnan(f); }
>

That works for cpl_conv.cpp. My next set of failures:

cplstring.cpp:458:26: error: no member named 'back' in 'CPLString'
            if( osNewURL.back() == '&'
                ~~~~~~~~ ^
cplstring.cpp:459:29: error: no member named 'back' in 'CPLString'
                || osNewURL.back() == '?' )
                   ~~~~~~~~ ^
cplstring.cpp:470:23: error: no member named 'back' in 'CPLString'
            if( osURL.back() != '&' && osURL.back() != '?' )
                ~~~~~ ^
cplstring.cpp:470:46: error: no member named 'back' in 'CPLString'
            if( osURL.back() != '&' && osURL.back() != '?' )
                                       ~~~~~ ^
4 errors generated.


This seems to be related to: https://github.com/OSGeo/gdal/commit/
3ed7812f95de1b2d9a6e6bc93717a522df765377. Maybe HAVE_CXX11 isn't
guaranteeing all the expected C++11 features?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/09d0a9a0/attachment.html>

From even.rouault at spatialys.com  Tue Apr 25 07:21:29 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Apr 2017 16:21:29 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <CADPhZXzSY5R0LrVChPTtDSp9H6aOh5zJ92QNTBXRs7MQj_JkxA@mail.gmail.com>
References: <2074035.mOHRANHkjt@even-i700> <2195221.p9BrHZrpQE@even-i700>
 <CADPhZXzSY5R0LrVChPTtDSp9H6aOh5zJ92QNTBXRs7MQj_JkxA@mail.gmail.com>
Message-ID: <2886031.kTamKrfeCA@even-i700>

> 
> This seems to be related to: https://github.com/OSGeo/gdal/commit/
> 3ed7812f95de1b2d9a6e6bc93717a522df765377. Maybe HAVE_CXX11 isn't
> guaranteeing all the expected C++11 features?

Hum it looks like this compiler is indeed not fully C++11 compliant. 

Do the compilation lines include -std=c++11 or something else like -std=c++0x ?
If it is the later, then this might explain the failure if it is an old compiler that was in the 
middle of implementing C++11

In any case, you should likely

./configure --without-cpp11

(I'm not going to apply the above patch regarding CPLIsNan() then)

Or better update your compiler since GDAL 2.3 will probably require C++11.


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170425/76189dda/attachment-0001.html>

From caboe at sdfe.dk  Wed Apr 26 02:16:49 2017
From: caboe at sdfe.dk (=?iso-8859-1?Q?Casper_B=F8rgesen?=)
Date: Wed, 26 Apr 2017 09:16:49 +0000
Subject: [gdal-dev] ERROR when requesting raster data outside coverage of VRT
Message-ID: <800A1C4B99390947B3BAA86C02CBDB26FE0D48@S000014.PROD.SITAD.DK>

Hi,

I am trying to read some floating point data from a VRT file. The VRT file references a set of VRT files which again references a set of GeoTIFF files.

Using Python I call dataset.ReadAsArray(x, y, width, height) to request the data. In my case I end up requesting data which is outside the bounds of the VRT file resulting in the following error:

ERROR 5: my.vrt, band 1: Access window out of range in RasterIO().  Requested
(1129975,637475) of size 2550x2550 on raster of 1132500x885000.

If I was working with a normal GeoTIFF file I could calculate if I was outside the bounds and crop my request accordingly. But since I am working with a VRT file I don't know how to determine if the VRT file has coverage or not. I vaguely remember a similar issue with gdal_translate which was fixed to allow requesting data partially and completely outside the bounds of the VRT file and just return zero (?) on the cells outside.

Shouldn't this also occur in my case described above even though I am using python and not gdal_translate to request data?

I am using python 2.7.6 and GDAL 2.1.3 x64 from OSGeo4W.

Regards, Casper

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/fac51a99/attachment.html>

From even.rouault at spatialys.com  Wed Apr 26 02:27:15 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Apr 2017 11:27:15 +0200
Subject: [gdal-dev] ERROR when requesting raster data outside coverage
	of VRT
In-Reply-To: <800A1C4B99390947B3BAA86C02CBDB26FE0D48@S000014.PROD.SITAD.DK>
References: <800A1C4B99390947B3BAA86C02CBDB26FE0D48@S000014.PROD.SITAD.DK>
Message-ID: <1832292.0Qdh7Uz9MQ@even-i700>

On mercredi 26 avril 2017 09:16:49 CEST Casper Børgesen wrote:
> Hi,
> 
> I am trying to read some floating point data from a VRT file. The VRT file
> references a set of VRT files which again references a set of GeoTIFF
> files.
> 
> Using Python I call dataset.ReadAsArray(x, y, width, height) to request the
> data. In my case I end up requesting data which is outside the bounds of
> the VRT file resulting in the following error:
> 
> ERROR 5: my.vrt, band 1: Access window out of range in RasterIO(). 
> Requested (1129975,637475) of size 2550x2550 on raster of 1132500x885000.
> 
> If I was working with a normal GeoTIFF file I could calculate if I was
> outside the bounds and crop my request accordingly.

Well, a VRT dataset is a GDAL dataset, so there's no difference from API usage when 
requesting a VRT or a GeoTIFF
You can use ds.RasterXSize / ds.RasterYSize to know the VRT dimensions and check if x + 
width > ds.RasterXSize or y + height > ds.RasterYSize

> But since I am working
> with a VRT file I don't know how to determine if the VRT file has coverage
> or not. I vaguely remember a similar issue with gdal_translate which was
> fixed to allow requesting data partially and completely outside the bounds
> of the VRT file and just return zero (?) on the cells outside.

This is indeed a conveniency of gdal_translate itself. Using ReadAsArray() you must stick to 
the dataset dimensions.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/d23382e6/attachment.html>

From sean at mapbox.com  Wed Apr 26 02:55:35 2017
From: sean at mapbox.com (Sean Gillies)
Date: Wed, 26 Apr 2017 11:55:35 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <2886031.kTamKrfeCA@even-i700>
References: <2074035.mOHRANHkjt@even-i700> <2195221.p9BrHZrpQE@even-i700>
 <CADPhZXzSY5R0LrVChPTtDSp9H6aOh5zJ92QNTBXRs7MQj_JkxA@mail.gmail.com>
 <2886031.kTamKrfeCA@even-i700>
Message-ID: <CADPhZXwnX18pyehVZeD=nCQRZBufJWOFpU2d8FM_L7UxB-YgQA@mail.gmail.com>

On Tue, Apr 25, 2017 at 4:21 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

>
>
> >
>
> > This seems to be related to: https://github.com/OSGeo/gdal/commit/
>
> > 3ed7812f95de1b2d9a6e6bc93717a522df765377. Maybe HAVE_CXX11 isn't
>
> > guaranteeing all the expected C++11 features?
>
>
>
> Hum it looks like this compiler is indeed not fully C++11 compliant.
>
>
>
> Do the compilation lines include -std=c++11 or something else like
> -std=c++0x ?
>
> If it is the later, then this might explain the failure if it is an old
> compiler that was in the middle of implementing C++11
>
>
>
> In any case, you should likely
>
>
>
> ./configure --without-cpp11
>
>
>
> (I'm not going to apply the above patch regarding CPLIsNan() then)
>
>
>
> Or better update your compiler since GDAL 2.3 will probably require C++11.
>
>
>
>
>
> Even
>

--without-cpp11 doesn't help me. I still have the following error

cpl_conv.cpp:2060:9: error: use of undeclared identifier 'isnan'; did you
mean 'std::isnan'?
    if( CPLIsNan(dfAngle) )
        ^
/Users/sean/code/frs-wheel-builds/parts/gdal__compile__/gdal-2.2.0/port/cpl_port.h:687:23:
note: expanded from macro 'CPLIsNan'
#  define CPLIsNan(x) isnan(x)
                      ^
/usr/include/c++/4.2.1/cmath:551:5: note: 'std::isnan' declared here
    isnan(_Tp __f) { return ::__gnu_cxx::__capture_isnan(__f); }
    ^
1 error generated.


I'd love to be able to build 2.2.0 on this slightly out of date compiler,
but if 2.2.0 will require C++11, I'll get with the program.

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/008b8653/attachment.html>

From caboe at sdfe.dk  Wed Apr 26 03:43:45 2017
From: caboe at sdfe.dk (=?iso-8859-1?Q?Casper_B=F8rgesen?=)
Date: Wed, 26 Apr 2017 10:43:45 +0000
Subject: [gdal-dev] ERROR when requesting raster data outside coverage
 of VRT
In-Reply-To: <1832292.0Qdh7Uz9MQ@even-i700>
References: <800A1C4B99390947B3BAA86C02CBDB26FE0D48@S000014.PROD.SITAD.DK>
 <1832292.0Qdh7Uz9MQ@even-i700>
Message-ID: <800A1C4B99390947B3BAA86C02CBDB26FE15C2@S000014.PROD.SITAD.DK>

Hi Even,



Thanks for your reply. I think I get it now.



Well, a VRT dataset is a GDAL dataset, so there's no difference from API usage when requesting a VRT or a GeoTIFF

You can use ds.RasterXSize / ds.RasterYSize to know the VRT dimensions and check if x + width > ds.RasterXSize or y + height > ds.RasterYSize



Okay, so as long as I stay within the VRT bbox I can request data. If I request data inside the VRT bbox even though it doesn't have GeoTIFF coverage there, I will still get a result (consisting of zeros)?



This is indeed a conveniency of gdal_translate itself. Using ReadAsArray() you must stick to the dataset dimensions.



And I find it very convenient :)



Regards, Casper
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/c8775c6b/attachment-0001.html>

From andrew at aitchison.me.uk  Wed Apr 26 03:48:29 2017
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 26 Apr 2017 11:48:29 +0100 (BST)
Subject: [gdal-dev] ERROR when requesting raster data outside coverage
 of VRT
In-Reply-To: <800A1C4B99390947B3BAA86C02CBDB26FE0D48@S000014.PROD.SITAD.DK>
References: <800A1C4B99390947B3BAA86C02CBDB26FE0D48@S000014.PROD.SITAD.DK>
Message-ID: <alpine.LRH.2.20.1704261139210.12690@warden.aitchison.me.uk>

On Wed, 26 Apr 2017, Casper BÃžrgesen wrote:

> Hi,
>
> I am trying to read some floating point data from a VRT file. The
> VRT file references a set of VRT files which again references a set
> of GeoTIFF files.
>
> Using Python I call dataset.ReadAsArray(x, y, width, height) to
> request the data. In my case I end up requesting data which is
> outside the bounds of the VRT file resulting in the following error:
>
> ERROR 5: my.vrt, band 1: Access window out of range in RasterIO().
> Requested (1129975,637475) of size 2550x2550 on raster of 1132500x885000.

I am not sure whether you noticed that

   1129975 + 2550 = 1132525 > 1132500

and thus the requested window is partially outside the VRT's bounds.

> If I was working with a normal GeoTIFF file I could calculate if I
> was outside the bounds and crop my request accordingly. But since I
> am working with a VRT file I don't know how to determine if the VRT
> file has coverage or not. I vaguely remember a similar issue with
> gdal_translate which was fixed to allow requesting data partially
> and completely outside the bounds of the VRT file and just return
> zero (?) on the cells outside.

I think cropping the request as you would for a normal GeoTIFF
should be sufficient.

-- 
Andrew C Aitchison

From even.rouault at spatialys.com  Wed Apr 26 04:05:31 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Apr 2017 13:05:31 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <CADPhZXwnX18pyehVZeD=nCQRZBufJWOFpU2d8FM_L7UxB-YgQA@mail.gmail.com>
References: <2074035.mOHRANHkjt@even-i700> <2886031.kTamKrfeCA@even-i700>
 <CADPhZXwnX18pyehVZeD=nCQRZBufJWOFpU2d8FM_L7UxB-YgQA@mail.gmail.com>
Message-ID: <46671742.VKKA0vAf3U@even-i700>

Sean,

> I'd love to be able to build 2.2.0 on this slightly out of date compiler,
> but if 2.2.0 will require C++11, I'll get with the program.

2.2.0 doesn't rquire C++11

It seems that this compiler undefines the C99 isnan() macro in all cases as soon as <cmath> is 
included.

Can you revert all the changes of your tree and apply the attached patch ?

--without-cpp11 will probably still be needed.

If that doesn't work, can you send the output of the following:

gcc -dM -E - < /dev/null

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/44429a52/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: isnan.patch
Type: text/x-patch
Size: 3284 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/44429a52/attachment.bin>

From vladimir.sandoval at yandex.com  Wed Apr 26 06:15:34 2017
From: vladimir.sandoval at yandex.com (Vlad)
Date: Wed, 26 Apr 2017 06:15:34 -0700 (MST)
Subject: [gdal-dev] Initialization "record" causing bad extents/geometries
 in OGR for GPX files
Message-ID: <1493212534326-5318488.post@n6.nabble.com>

I have a collection of GPX files that have something like this...

<trkpt lat="" lon="">
  <ele></ele>
  <time>2016-08-15T10:48:20Z</time>
</trkpt>

as the first element of a <trk><trkseg> section.  It's probably put in there
on device initialization.  When OGR (Ogrinfo and the Dataset/Datasource Java
classes) extract information, this trkpt is interpreted as having a lat/lon
of 0,0.

This is causing bad geometries and extents to be generated...from ogrinfo
-al

Layer name: tracks
Geometry: Multi Line String
Feature Count: 1
Extent: (0.000000, 0.000000) - (49.130867, 14.553272)
.
.
MULTILINESTRING ((0 0,49.122255 14.5532683,...

and

Layer name: track_points
Geometry: Point
Feature Count: 348
Extent: (0.000000, 0.000000) - (49.130867, 14.553272)
.
.
POINT (0 0)

Since this trkpt is "empty", should it not be ignored instead of given a
default 0,0 lat/lon?






--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Initialization-record-causing-bad-extents-geometries-in-OGR-for-GPX-files-tp5318488.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Wed Apr 26 06:34:30 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Apr 2017 15:34:30 +0200
Subject: [gdal-dev] Initialization "record" causing bad
	extents/geometries in OGR for GPX files
In-Reply-To: <1493212534326-5318488.post@n6.nabble.com>
References: <1493212534326-5318488.post@n6.nabble.com>
Message-ID: <1981636.M9vHfqpkVG@even-i700>

On mercredi 26 avril 2017 06:15:34 CEST Vlad wrote:
> I have a collection of GPX files that have something like this...
> 
> <trkpt lat="" lon="">
>   <ele></ele>
>   <time>2016-08-15T10:48:20Z</time>
> </trkpt>
> 
> as the first element of a <trk><trkseg> section.  It's probably put in there
> on device initialization.  When OGR (Ogrinfo and the Dataset/Datasource
> Java classes) extract information, this trkpt is interpreted as having a
> lat/lon of 0,0.

Vlad,

I've just committed a patch to ignore such lat/lon with empty content in trunk and 2.2 branch, 
but note that such a GPX file doesn't validate the GPX XML schema.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/d2fe812d/attachment.html>

From vladimir.sandoval at yandex.com  Wed Apr 26 06:38:42 2017
From: vladimir.sandoval at yandex.com (Vlad)
Date: Wed, 26 Apr 2017 06:38:42 -0700 (MST)
Subject: [gdal-dev] Initialization "record" causing bad
 extents/geometries in OGR for GPX files
In-Reply-To: <1981636.M9vHfqpkVG@even-i700>
References: <1493212534326-5318488.post@n6.nabble.com>
 <1981636.M9vHfqpkVG@even-i700>
Message-ID: <1493213922674-5318492.post@n6.nabble.com>

Thanks Even.
These things are coming from a cell phone app..

http://www.fulcrumapp.com





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Initialization-record-causing-bad-extents-geometries-in-OGR-for-GPX-files-tp5318488p5318492.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Wed Apr 26 11:32:58 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Apr 2017 20:32:58 +0200
Subject: [gdal-dev] OGR drivers written in Python
Message-ID: <6079142.z3hTm2DpqI@even-i700>

Hi,

I've experimented lately with an infrastructure to write drivers in Python :
https://github.com/rouault/gdal2/tree/pythondrivers

This is a further step to the GDAL 2.2 new capability of writing pixel
functions in Python in VRT files.

For now, only read-only vector capabilities are supported.

The Python drivers don't depend on the SWIG Python bindings, so that can potentially be used
like native drivers, in all GDAL valid use cases: integrated in native code (GDAL command line
utilities, QGIS, etc..), GDAL SWIG Python bindings, fiona, etc...

Example: given the dummy driver in
https://github.com/rouault/gdal2/blob/pythondrivers/gdal/pythondrivers/ogr_MYPLUGIN.py

$ GDAL_PYTHON_DRIVER_PATH=pythondrivers ogrinfo -al -ro MYPLUGIN:

INFO: Open of `MYPLUGIN:'
      using driver `MYPLUGIN' successful.
Metadata:
  foo=bar

Layer name: my layer
Geometry: Point
Feature Count: 5
Extent: (2.100000, 49.000000) - (3.000000, 50.000000)
Layer SRS WKT:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.257223563,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0,
        AUTHORITY["EPSG","8901"]],
    UNIT["degree",0.0174532925199433,
        AUTHORITY["EPSG","9122"]],
    AUTHORITY["EPSG","4326"]]
FID Column = my_fid
Geometry Column = geomField
boolField: Integer(Boolean) (0.0)
intField: Integer (0.0)
int64Field: Integer64 (0.0)
realField: Real (0.0)
strField: String (0.0)
strNullField: String (0.0)
strUnsetField: String (0.0)
binaryField: Binary (0.0)
datetimeField: DateTime (0.0)
OGRFeature(my layer):1
  boolField (Integer(Boolean)) = 1
  intField (Integer) = 2
  int64Field (Integer64) = 1234567890123
  realField (Real) = 1.23
  strField (String) = foo
  strNullField (String) = (null)
  binaryField (Binary) = 010002
  datetimeField (DateTime) = 2017/04/26 12:34:56.789+00
  POINT (2 49)

[...]

OGRFeature(my layer):5
  boolField (Integer(Boolean)) = 1
  intField (Integer) = 6
  int64Field (Integer64) = 1234567890123
  realField (Real) = 1.23
  strField (String) = foo
  strNullField (String) = (null)
  binaryField (Binary) = 010002
  datetimeField (DateTime) = 2017/04/26 12:34:56.789+00
  POINT (2 49)

The PYTHONSO env variable can be used to force a given Python shared library
to be used, e.g PYTHONSO=libpython3.5m.so . I've tested with Python 2.6, 2.7,
3.2 and 3.5

Currently there's some copy&paste from the VRT Python derived band code that I'd
like to factor (the logic to dynamically load the Python interpreter and load
needed symbols)

The mechanism could probably be extended to support write operations
and the raster side too. I'm not sure how far I'll go with that, but I'll probably
write a RFC at some point with what exists.

Feedback welcome.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/ad7512d1/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Apr 26 13:08:41 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 26 Apr 2017 13:08:41 -0700 (MST)
Subject: [gdal-dev] Initialization "record" causing bad
 extents/geometries in OGR for GPX files
In-Reply-To: <1493213922674-5318492.post@n6.nabble.com>
References: <1493212534326-5318488.post@n6.nabble.com>
 <1981636.M9vHfqpkVG@even-i700> <1493213922674-5318492.post@n6.nabble.com>
Message-ID: <1493237321812-5318534.post@n6.nabble.com>

Vlad wrote
> Thanks Even.
> These things are coming from a cell phone app..
> 
> http://www.fulcrumapp.com

Hi Vlad,

They have nice web page but obviously not e-mail addresses so I wrote sort
of a bug report into their chat box.

-Jukka Rahkonen-



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Initialization-record-causing-bad-extents-geometries-in-OGR-for-GPX-files-tp5318488p5318534.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From schwehr at gmail.com  Wed Apr 26 14:23:51 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 26 Apr 2017 14:23:51 -0700
Subject: [gdal-dev] kml driver ndepth
Message-ID: <CACmBxyu9U7VAcLssg=20dPPGVTTThL63940iCpVc2Ycfwu0Ziw@mail.gmail.com>

Even,

In the KML driver, https://trac.osgeo.org/gdal/changeset/16908 introduced
some debugging code with nDepth.  Looks like it has never been used since.
I converted the comment out code to be inside DEBUG_VERBOSE, but I missed
the --nDepth.  Are you okay if we just remove that unused debugging code?

https://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/kml/kmlnode.cpp#L218

...

https://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/kml/kmlnode.cpp#L325

//nDepth --;

-kurt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/c8d22f3e/attachment.html>

From even.rouault at spatialys.com  Wed Apr 26 14:31:12 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Apr 2017 23:31:12 +0200
Subject: [gdal-dev] kml driver ndepth
In-Reply-To: <CACmBxyu9U7VAcLssg=20dPPGVTTThL63940iCpVc2Ycfwu0Ziw@mail.gmail.com>
References: <CACmBxyu9U7VAcLssg=20dPPGVTTThL63940iCpVc2Ycfwu0Ziw@mail.gmail.com>
Message-ID: <16787098.xHF34jKEWZ@even-i700>

On mercredi 26 avril 2017 14:23:51 CEST Kurt Schwehr wrote:
> Even,
> 
> In the KML driver, https://trac.osgeo.org/gdal/changeset/16908 introduced
> some debugging code with nDepth.  Looks like it has never been used since.
> I converted the comment out code to be inside DEBUG_VERBOSE, but I missed
> the --nDepth.  Are you okay if we just remove that unused debugging code?
> 
> https://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/kml/kmlnode.c
> pp#L218
> 
> ...
> 
> https://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/kml/kmlnode.c
> pp#L325
> 
> //nDepth --;

Why not just moving it inside the #ifdef DEBUG_VERBOSE ?
> 
> -kurt


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/452af00b/attachment.html>

From schwehr at gmail.com  Wed Apr 26 14:55:58 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 26 Apr 2017 14:55:58 -0700
Subject: [gdal-dev] kml driver ndepth
In-Reply-To: <16787098.xHF34jKEWZ@even-i700>
References: <CACmBxyu9U7VAcLssg=20dPPGVTTThL63940iCpVc2Ycfwu0Ziw@mail.gmail.com>
 <16787098.xHF34jKEWZ@even-i700>
Message-ID: <CACmBxytsRk+_vudU5FBMrZhT0hx8TqQMfeGzV_qz=bOPrU3jtA@mail.gmail.com>

If you want to keep the code, that's what I was going to do, but I'd rather
just remove the code since that code looks like it was useful just during
initial development.

On Wed, Apr 26, 2017 at 2:31 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mercredi 26 avril 2017 14:23:51 CEST Kurt Schwehr wrote:
>
> > Even,
>
> >
>
> > In the KML driver, https://trac.osgeo.org/gdal/changeset/16908
> introduced
>
> > some debugging code with nDepth. Looks like it has never been used since.
>
> > I converted the comment out code to be inside DEBUG_VERBOSE, but I missed
>
> > the --nDepth. Are you okay if we just remove that unused debugging code?
>
> >
>
> > https://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_
> frmts/kml/kmlnode.c
>
> > pp#L218
>
> >
>
> > ...
>
> >
>
> > https://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_
> frmts/kml/kmlnode.c
>
> > pp#L325
>
> >
>
> > //nDepth --;
>
>
>
> Why not just moving it inside the #ifdef DEBUG_VERBOSE ?
>
> >
>
> > -kurt
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170426/6449e858/attachment.html>

From sean at mapbox.com  Thu Apr 27 01:18:13 2017
From: sean at mapbox.com (Sean Gillies)
Date: Thu, 27 Apr 2017 10:18:13 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <46671742.VKKA0vAf3U@even-i700>
References: <2074035.mOHRANHkjt@even-i700> <2886031.kTamKrfeCA@even-i700>
 <CADPhZXwnX18pyehVZeD=nCQRZBufJWOFpU2d8FM_L7UxB-YgQA@mail.gmail.com>
 <46671742.VKKA0vAf3U@even-i700>
Message-ID: <CADPhZXz6g9NTjFmSP2AHCs4aTvN0RzWaGAPUQwmvmM-4t7dCxw@mail.gmail.com>

Even,

I've sorted things out. As described in https://github.com/sgillies
/frs-wheel-builds/issues/15, I only need to change the
MACOSX_DEPLOYMENT_TARGET in my builds from 10.6 to 10.9 to build GDAL 2.2.0
(and distribute Python wheels that include it). Sorry, Mountain Lion
holdouts!

Rasterio is fine with GDAL 2.2.0beta2 except in a couple tests that check
reprojection of a geometry that straddles the antimeridian. Whether to cut
used to be optional, defaulting to false, but after
https://trac.osgeo.org/gdal/changeset/35964 is true and no longer optional.

https://github.com/OSGeo/gdal/blob/trunk/gdal/NEWS#L496


On Wed, Apr 26, 2017 at 1:05 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Sean,
>
>
>
> > I'd love to be able to build 2.2.0 on this slightly out of date compiler,
>
> > but if 2.2.0 will require C++11, I'll get with the program.
>
>
>
> 2.2.0 doesn't rquire C++11
>
>
>
> It seems that this compiler undefines the C99 isnan() macro in all cases
> as soon as <cmath> is included.
>
>
>
> Can you revert all the changes of your tree and apply the attached patch ?
>
>
>
> --without-cpp11 will probably still be needed.
>
>
>
> If that doesn't work, can you send the output of the following:
>
>
>
> gcc -dM -E - < /dev/null
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170427/f98414ea/attachment-0001.html>

From even.rouault at spatialys.com  Thu Apr 27 03:51:26 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 27 Apr 2017 12:51:26 +0200
Subject: [gdal-dev] GDAL 2.2.0 beta 2 available
In-Reply-To: <CADPhZXz6g9NTjFmSP2AHCs4aTvN0RzWaGAPUQwmvmM-4t7dCxw@mail.gmail.com>
References: <2074035.mOHRANHkjt@even-i700> <46671742.VKKA0vAf3U@even-i700>
 <CADPhZXz6g9NTjFmSP2AHCs4aTvN0RzWaGAPUQwmvmM-4t7dCxw@mail.gmail.com>
Message-ID: <1797466.9pSx9gH5VV@even-i700>

On jeudi 27 avril 2017 10:18:13 CEST Sean Gillies wrote:
> Even,
> 
> I've sorted things out. As described in https://github.com/sgillies
> /frs-wheel-builds/issues/15, I only need to change the
> MACOSX_DEPLOYMENT_TARGET in my builds from 10.6 to 10.9 to build GDAL 2.2.0
> (and distribute Python wheels that include it). Sorry, Mountain Lion
> holdouts!
> 
> Rasterio is fine with GDAL 2.2.0beta2 except in a couple tests that check
> reprojection of a geometry that straddles the antimeridian. Whether to cut
> used to be optional, defaulting to false, but after
> https://trac.osgeo.org/gdal/changeset/35964 is true and no longer optional.

Sean,

Are you talking about a case of reprojecting a geometry expressed in a projection like UTM 
60 crossing the antimeridian to long/lat ?
If so, before with WRAPDATELINE=NO, it likely resulted in non sense. And with 
WRAPDATELINE=YES, it might sometimes be corrected after reprojection (but 
WRAPDATELINE=YES is mostly a heuristics to guess if the segment between 2 consecutive 
points was supposed to cross or not the dateline, and it might fail in some cases).

It is true now that in this case (there's also another case for polar projections), the geometry 
is always cut before doing the reprojection operation, before the processing done by 
WRAPDATELINE=YES (which should be a no-op if the cutting has been done before 
reprojection).

Do you think the new before-reprojection-geometry-splitting should be made optional ? If so, 
I'm not entirely sure the option that should condition it should be WRAPDATELINE (given 
that we also deal with polar projections), although adding more options related to that might 
confuse people...
I think the new behaviour is what people want in most, if not all, cases. And 
WRAPDATELINE=YES is now more dedicated to the cases of geometries already in long/lat 
but that for some reasons have points with longitudes < 180 and > 180.

Even

> 
> https://github.com/OSGeo/gdal/blob/trunk/gdal/NEWS#L496
> 
> 
> On Wed, Apr 26, 2017 at 1:05 PM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > Sean,
> > 
> > > I'd love to be able to build 2.2.0 on this slightly out of date
> > > compiler,
> > > 
> > > but if 2.2.0 will require C++11, I'll get with the program.
> > 
> > 2.2.0 doesn't rquire C++11
> > 
> > 
> > 
> > It seems that this compiler undefines the C99 isnan() macro in all cases
> > as soon as <cmath> is included.
> > 
> > 
> > 
> > Can you revert all the changes of your tree and apply the attached patch ?
> > 
> > 
> > 
> > --without-cpp11 will probably still be needed.
> > 
> > 
> > 
> > If that doesn't work, can you send the output of the following:
> > 
> > 
> > 
> > gcc -dM -E - < /dev/null
> > 
> > 
> > 
> > Even
> > 
> > 
> > 
> > --
> > 
> > Spatialys - Geospatial professional services
> > 
> > http://www.spatialys.com


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170427/83255664/attachment.html>

From sean at mapbox.com  Thu Apr 27 04:52:05 2017
From: sean at mapbox.com (Sean Gillies)
Date: Thu, 27 Apr 2017 13:52:05 +0200
Subject: [gdal-dev] OGR drivers written in Python
In-Reply-To: <6079142.z3hTm2DpqI@even-i700>
References: <6079142.z3hTm2DpqI@even-i700>
Message-ID: <CADPhZXyM2618tkWyj5LVFHJ4LXk0SNNC0wv=3BXD2ed6dBfU1A@mail.gmail.com>

Hi Even,

On Wed, Apr 26, 2017 at 8:32 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
>
>
> I've experimented lately with an infrastructure to write drivers in Python
> :
>
> https://github.com/rouault/gdal2/tree/pythondrivers
>
>
>
> This is a further step to the GDAL 2.2 new capability of writing pixel
>
> functions in Python in VRT files.
>
>
>
> For now, only read-only vector capabilities are supported.
>
>
>
> The Python drivers don't depend on the SWIG Python bindings, so that can
> potentially be used
>
> like native drivers, in all GDAL valid use cases: integrated in native
> code (GDAL command line
>
> utilities, QGIS, etc..), GDAL SWIG Python bindings, fiona, etc...
>
>
>
> Example: given the dummy driver in
>
> https://github.com/rouault/gdal2/blob/pythondrivers/gdal/
> pythondrivers/ogr_MYPLUGIN.py
>
>
>
> $ GDAL_PYTHON_DRIVER_PATH=pythondrivers ogrinfo -al -ro MYPLUGIN:
>
>
>
> INFO: Open of `MYPLUGIN:'
>
> using driver `MYPLUGIN' successful.
>
> Metadata:
>
> foo=bar
>
>
>
> Layer name: my layer
>
> Geometry: Point
>
> Feature Count: 5
>
> Extent: (2.100000, 49.000000) - (3.000000, 50.000000)
>
> Layer SRS WKT:
>
> GEOGCS["WGS 84",
>
> DATUM["WGS_1984",
>
> SPHEROID["WGS 84",6378137,298.257223563,
>
> AUTHORITY["EPSG","7030"]],
>
> AUTHORITY["EPSG","6326"]],
>
> PRIMEM["Greenwich",0,
>
> AUTHORITY["EPSG","8901"]],
>
> UNIT["degree",0.0174532925199433,
>
> AUTHORITY["EPSG","9122"]],
>
> AUTHORITY["EPSG","4326"]]
>
> FID Column = my_fid
>
> Geometry Column = geomField
>
> boolField: Integer(Boolean) (0.0)
>
> intField: Integer (0.0)
>
> int64Field: Integer64 (0.0)
>
> realField: Real (0.0)
>
> strField: String (0.0)
>
> strNullField: String (0.0)
>
> strUnsetField: String (0.0)
>
> binaryField: Binary (0.0)
>
> datetimeField: DateTime (0.0)
>
> OGRFeature(my layer):1
>
> boolField (Integer(Boolean)) = 1
>
> intField (Integer) = 2
>
> int64Field (Integer64) = 1234567890123
>
> realField (Real) = 1.23
>
> strField (String) = foo
>
> strNullField (String) = (null)
>
> binaryField (Binary) = 010002
>
> datetimeField (DateTime) = 2017/04/26 12:34:56.789+00
>
> POINT (2 49)
>
>
>
> [...]
>
>
>
> OGRFeature(my layer):5
>
> boolField (Integer(Boolean)) = 1
>
> intField (Integer) = 6
>
> int64Field (Integer64) = 1234567890123
>
> realField (Real) = 1.23
>
> strField (String) = foo
>
> strNullField (String) = (null)
>
> binaryField (Binary) = 010002
>
> datetimeField (DateTime) = 2017/04/26 12:34:56.789+00
>
> POINT (2 49)
>
>
>
> The PYTHONSO env variable can be used to force a given Python shared
> library
>
> to be used, e.g PYTHONSO=libpython3.5m.so . I've tested with Python 2.6,
> 2.7,
>
> 3.2 and 3.5
>
>
>
> Currently there's some copy&paste from the VRT Python derived band code
> that I'd
>
> like to factor (the logic to dynamically load the Python interpreter and
> load
>
> needed symbols)
>
>
>
> The mechanism could probably be extended to support write operations
>
> and the raster side too. I'm not sure how far I'll go with that, but I'll
> probably
>
> write a RFC at some point with what exists.
>
>
>
> Feedback welcome.
>

The sketch of the Python interface for drivers looks fine to me. Some of
the function signatures could be more Pythonic, but these are not going to
be called from Python code (correct?), and that's probably only a aesthetic
issue.

I still don't understand what the problems are that are best solved by
embedding Python in GDAL. To be frank: I'm dreading the day that someone
delivers to me a VRT file with a Python script embedded in it. These
scripts are unlikely to be well tested (what tools would one use?) and very
difficult to debug when they fail.

What good is a VRT that only opens with Python 2? Or only with Python 3? Or
only if Rasterio or ArcPy is installed? How does a VRT with embedded Python
specify what its requirements are? Specifically, how would a VRT specify
that it requires Numpy or scikit-learn, or OpenCV, and how would a user
install the Python or other library other requirements of a VRT? All of the
above are solved (for some value of "solved") for the Python *extension*
use case, but are unsolved when it comes to embedding Python in GDAL.

Respectfully,

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170427/26dc2fad/attachment-0001.html>

From even.rouault at spatialys.com  Thu Apr 27 05:38:40 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 27 Apr 2017 14:38:40 +0200
Subject: [gdal-dev] OGR drivers written in Python
In-Reply-To: <CADPhZXyM2618tkWyj5LVFHJ4LXk0SNNC0wv=3BXD2ed6dBfU1A@mail.gmail.com>
References: <6079142.z3hTm2DpqI@even-i700>
 <CADPhZXyM2618tkWyj5LVFHJ4LXk0SNNC0wv=3BXD2ed6dBfU1A@mail.gmail.com>
Message-ID: <1623177.IJfQmnNvoQ@even-i700>

Sean,

> 
> The sketch of the Python interface for drivers looks fine to me. Some of
> the function signatures could be more Pythonic, but these are not going to
> be called from Python code (correct?), 

Yes, this is driver code that is mostly dedicated to be called from GDAL core itself. That could 
potentially be also called externally for unit testing, who knows, but with some caveats, like 
the gdal_base module containing the base classes being a built-in module inside GDAL. But it 
can be easily mocked up as being essentially a no-op. Currently the only thing it has is the 
OGRLayer.feature_count() method that can be called from the specialized feature_count() 
method to ultimately call the C++ base method OGRLayer::GetFeatureCount() that does the 
slow part of iterating through all features and taking them into account if they match the 
spatial and/or attribute filters.

> and that's probably only a aesthetic
> issue.

Your suggestions are welcome to improve that. Note that I did some effort to apply PEP 8 
naming conventions (well I tried at least :-))

> 
> I still don't understand what the problems are that are best solved by
> embedding Python in GDAL. To be frank: I'm dreading the day that someone
> delivers to me a VRT file with a Python script embedded in it. These
> scripts are unlikely to be well tested (what tools would one use?) and very
> difficult to debug when they fail.
> 
> What good is a VRT that only opens with Python 2? Or only with Python 3? Or
> only if Rasterio or ArcPy is installed? How does a VRT with embedded Python
> specify what its requirements are? Specifically, how would a VRT specify
> that it requires Numpy or scikit-learn, or OpenCV, and how would a user
> install the Python or other library other requirements of a VRT? All of the
> above are solved (for some value of "solved") for the Python *extension*
> use case, but are unsolved when it comes to embedding Python in GDAL.

This is a good point, especially regarding VRT. I see those Python capabilities are mostly a 
way of quickly prototyping stuff for your internal needs. And I know at least one user using 
VRT Python pixel functions for such prototyping work (to display the result of the simulation 
of some physical processus in QGIS)

Regarding drivers themselves, this could be the same use case. You have that custom in-
house format for which you don't really want to write a dedicated converter to a more 
standard format, because you have too much of that data and can't afford the conversion 
stage. Or because you just need to code the reading part and are happy that ogr2ogr handles 
the conversion to shapefile/GPKG/GeoJSON/whatever for you.
Someone could also write a driver in Python for less esoteric formats, because that's the 
language (s)he masters and/or there's an underlying Python lib that does the hard job of 
decyphering the format and you just need to expose it through OGR formalism. In that case, 
you could potentially publish the plugin as a "proper" Python module with adequate 
requirement specification through your favorite Python distribution & packaging system. Like 
"pip install ogr-myoddformatdriver" or "apt-get install python-ogr-myoddformatdriver". In 
the pip use case, that would probably require addition in GDAL core of some logic to know 
where to find those modules since I don't think you can constraint a file to be installed in the 
same directory as files from other packages (can you?). In the apt-get install case, that would 
mostly require to express package dependencies in the .deb formalism and installing one of 
several files in /usr/lib/gdalplugins/2.3

Or perhaps there isn't any valid use case after all. I just tried it for fun and because it could be 
done :-)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170427/f29cfcf4/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Apr 27 10:01:27 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 27 Apr 2017 17:01:27 +0000
Subject: [gdal-dev] Wrong namespaces in GML 3.2 written by GDAL
Message-ID: <fdc609a4401346508aaca5f39c4e9ea8@C119S212VM022.msvyvi.vaha.local>

Hi,

With GML 3.2 output GDAL 2.2-dev writes into the schema

xmlns:gml="http://www.opengis.net/gml/3.2"
xmlns:gmlsf="http://www.opengis.net/gmlsf/2.0"

The first one redirects to http://schemas.opengis.net/gml/3.2.1/gml.xsd.
The latter one gives "Not found". I guess that the schema is nowadays in http://schemas.opengis.net/gmlsfProfile/2.0/

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170427/51e0b5e5/attachment.html>

From even.rouault at spatialys.com  Thu Apr 27 10:06:17 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 27 Apr 2017 19:06:17 +0200
Subject: [gdal-dev] Wrong namespaces in GML 3.2 written by GDAL
In-Reply-To: <fdc609a4401346508aaca5f39c4e9ea8@C119S212VM022.msvyvi.vaha.local>
References: <fdc609a4401346508aaca5f39c4e9ea8@C119S212VM022.msvyvi.vaha.local>
Message-ID: <2132735.TFJr8PW4AH@even-i700>

On jeudi 27 avril 2017 17:01:27 CEST Rahkonen Jukka (MML) wrote:
> Hi,
> 
> With GML 3.2 output GDAL 2.2-dev writes into the schema
> 
> xmlns:gml="http://www.opengis.net/gml/3.2"
> xmlns:gmlsf="http://www.opengis.net/gmlsf/2.0"
> 
> The first one redirects to http://schemas.opengis.net/gml/3.2.1/gml.xsd.
> The latter one gives "Not found". I guess that the schema is nowadays in
> http://schemas.opengis.net/gmlsfProfile/2.0/

Jukka,

I think what GDAL writes currently is correct. There's no requirement for a namespace URI to 
be HTTP resolvable and point to a schema. This is just a conventional name.

Actually if you look at
http://schemas.opengis.net/gmlsfProfile/2.0/gmlsfLevels.xsd , you can see
xmlns:gmlsf="http://www.opengis.net/gmlsf/2.0"

Even


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170427/8cbabfe3/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Apr 27 10:10:39 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 27 Apr 2017 17:10:39 +0000
Subject: [gdal-dev] Wrong namespaces in GML 3.2 written by GDAL
Message-ID: <466e69e335e240408e6350d59d6437b4@C119S212VM022.msvyvi.vaha.local>

Hi Evan,

Oh yeah, a few lines later I can read
<xs:import namespace="http://www.opengis.net/gml/3.2" schemaLocation="http://schemas.opengis.net/gml/3.2.1/gml.xsd"/>
<xs:import namespace="http://www.opengis.net/gmlsf/2.0" schemaLocation="http://schemas.opengis.net/gmlsfProfile/2.0/gmlsfLevels.xsd"/>

Sorry for the noise.

-Jukka-

Even Rouault  wrote:
Re: [gdal-dev] Wrong namespaces in GML 3.2 written by GDAL


On jeudi 27 avril 2017 17:01:27 CEST Rahkonen Jukka (MML) wrote:

> Hi,

>

> With GML 3.2 output GDAL 2.2-dev writes into the schema

>

> xmlns:gml="http://www.opengis.net/gml/3.2"

> xmlns:gmlsf="http://www.opengis.net/gmlsf/2.0"

>

> The first one redirects to http://schemas.opengis.net/gml/3.2.1/gml.xsd.

> The latter one gives "Not found". I guess that the schema is nowadays in

> http://schemas.opengis.net/gmlsfProfile/2.0/



Jukka,



I think what GDAL writes currently is correct. There's no requirement for a namespace URI to be HTTP resolvable and point to a schema. This is just a conventional name.



Actually if you look at

http://schemas.opengis.net/gmlsfProfile/2.0/gmlsfLevels.xsd , you can see

xmlns:gmlsf="http://www.opengis.net/gmlsf/2.0"



Even




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170427/acedb579/attachment-0001.html>

From sfkeller at gmail.com  Thu Apr 27 14:00:38 2017
From: sfkeller at gmail.com (Stefan Keller)
Date: Thu, 27 Apr 2017 23:00:38 +0200
Subject: [gdal-dev] OGR drivers written in Python
In-Reply-To: <1623177.IJfQmnNvoQ@even-i700>
References: <6079142.z3hTm2DpqI@even-i700>
 <CADPhZXyM2618tkWyj5LVFHJ4LXk0SNNC0wv=3BXD2ed6dBfU1A@mail.gmail.com>
 <1623177.IJfQmnNvoQ@even-i700>
Message-ID: <CAFcOn29oepafiiCWH9sRTew8z8pF6HimT=gfGA2Ghewxa9y9XQ@mail.gmail.com>

Hi Even and Sean

Allowing OGR drivers written in Python looks IMHO very promising!

I actually can't follow Seans concerns (except for one, see below): Is
it the fear that Python programmers step in who are less skilled?
There is quite some experience with QGIS plugins and yes, there are
many disfunct and outdated plugins there. But this allowed innovative
QGIS extensions which eventually have been moved to the QGIS core or
converted to a QGS C++ extension.

One important concern remains in fact: Keeping dependencies under
control! But now it's the right time to introduce some kinde of
requirements file mechanism, isn't it?

There ar quite some use cases which come to my mind; here's the most
important one: There is no real data provider support in QGIS for
Python extensions. OGR drivers as Python extensions could be a
solution. As a side effect, these providers are not only available in
QGIS GUI but also at the ogr CLI (I hope).

Just my 2 cents
:Stefan


2017-04-27 14:38 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:
> Sean,
>
>
>
>>
>
>> The sketch of the Python interface for drivers looks fine to me. Some of
>
>> the function signatures could be more Pythonic, but these are not going to
>
>> be called from Python code (correct?),
>
>
>
> Yes, this is driver code that is mostly dedicated to be called from GDAL
> core itself. That could potentially be also called externally for unit
> testing, who knows, but with some caveats, like the gdal_base module
> containing the base classes being a built-in module inside GDAL. But it can
> be easily mocked up as being essentially a no-op. Currently the only thing
> it has is the OGRLayer.feature_count() method that can be called from the
> specialized feature_count() method to ultimately call the C++ base method
> OGRLayer::GetFeatureCount() that does the slow part of iterating through all
> features and taking them into account if they match the spatial and/or
> attribute filters.
>
>
>
>> and that's probably only a aesthetic
>
>> issue.
>
>
>
> Your suggestions are welcome to improve that. Note that I did some effort to
> apply PEP 8 naming conventions (well I tried at least :-))
>
>
>
>>
>
>> I still don't understand what the problems are that are best solved by
>
>> embedding Python in GDAL. To be frank: I'm dreading the day that someone
>
>> delivers to me a VRT file with a Python script embedded in it. These
>
>> scripts are unlikely to be well tested (what tools would one use?) and
>> very
>
>> difficult to debug when they fail.
>
>>
>
>> What good is a VRT that only opens with Python 2? Or only with Python 3?
>> Or
>
>> only if Rasterio or ArcPy is installed? How does a VRT with embedded
>> Python
>
>> specify what its requirements are? Specifically, how would a VRT specify
>
>> that it requires Numpy or scikit-learn, or OpenCV, and how would a user
>
>> install the Python or other library other requirements of a VRT? All of
>> the
>
>> above are solved (for some value of "solved") for the Python *extension*
>
>> use case, but are unsolved when it comes to embedding Python in GDAL.
>
>
>
> This is a good point, especially regarding VRT. I see those Python
> capabilities are mostly a way of quickly prototyping stuff for your internal
> needs. And I know at least one user using VRT Python pixel functions for
> such prototyping work (to display the result of the simulation of some
> physical processus in QGIS)
>
>
>
> Regarding drivers themselves, this could be the same use case. You have that
> custom in-house format for which you don't really want to write a dedicated
> converter to a more standard format, because you have too much of that data
> and can't afford the conversion stage. Or because you just need to code the
> reading part and are happy that ogr2ogr handles the conversion to
> shapefile/GPKG/GeoJSON/whatever for you.
>
> Someone could also write a driver in Python for less esoteric formats,
> because that's the language (s)he masters and/or there's an underlying
> Python lib that does the hard job of decyphering the format and you just
> need to expose it through OGR formalism. In that case, you could potentially
> publish the plugin as a "proper" Python module with adequate requirement
> specification through your favorite Python distribution & packaging system.
> Like "pip install ogr-myoddformatdriver" or "apt-get install
> python-ogr-myoddformatdriver". In the pip use case, that would probably
> require addition in GDAL core of some logic to know where to find those
> modules since I don't think you can constraint a file to be installed in the
> same directory as files from other packages (can you?). In the apt-get
> install case, that would mostly require to express package dependencies in
> the .deb formalism and installing one of several files in
> /usr/lib/gdalplugins/2.3
>
>
>
> Or perhaps there isn't any valid use case after all. I just tried it for fun
> and because it could be done :-)
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From pcorti at gmail.com  Thu Apr 27 15:23:57 2017
From: pcorti at gmail.com (Paolo Corti)
Date: Thu, 27 Apr 2017 18:23:57 -0400
Subject: [gdal-dev] Building java bindings with GDAL 2.1.3
Message-ID: <CAHXrU-JJ_KuauiyefuoZXhLwyxq5dmWBFhBF078LR-gJtT8ELA@mail.gmail.com>

Dear list

I am trying to build the Java bindings for GDAL 2.1.3, for Java
1.7.0_80, using SWIG 3.0.8, in Ubuntu 16.04LTS, following these
instructions [1].

The aim is to use the gdal GeoServer plugin with gdal 2.1.3. The
GeoServer I am using is a very old version (2.3) and I don't have the
possibility to upgrade in the near future.

Following the instructions, Java bindings seem to be correctly built:

/opt/gdal/gdal-2.1.3/swig/java$ make
mkdir -p org/gdal/gdal
mkdir -p org/gdal/gdalconst
mkdir -p org/gdal/ogr
mkdir -p org/gdal/osr
if [ -f ".libs/libgdaljni.so" ] ; then \
cp .libs/*.so . ; \
fi
echo ""
if [ -f ".libs/libgdaljni.dylib" ] ; then \
cp .libs/*.dylib . ; \
fi
ant
Buildfile: /opt/gdal/gdal-2.1.3/swig/java/build.xml

init:
     [echo] version = 2.1.3

compile:
    [javac] Compiling 48 source files to
/opt/gdal/gdal-2.1.3/swig/java/build/classes
    [javac] warning: [options] bootstrap class path not set in
conjunction with -source 1.5
    [javac] Note: Some input files use unchecked or unsafe operations.
    [javac] Note: Recompile with -Xlint:unchecked for details.
    [javac] 1 warning
     [echo] compilation complete

archive:
      [jar] Building jar: /opt/gdal/gdal-2.1.3/swig/java/gdal.jar

compile_tests:
     [echo] compilation of tests complete

all:
BUILD SUCCESSFUL

Total time: 2 seconds


I correctly see the built *.so and *.la files and gdal.jar:

$ ls /opt/gdal/gdal-2.1.3/swig/java
... libgdalconstjni.la ... libgdalconstjni.so ... gdal.jar ...

Though, I do not see any .java files in build/apps (as there should be
according to the documentation) but only .class files. So I cannot run
the java gdalinfo test.

Trying to use the geoserver gdal plugin, I am getting this error (GDAL
was correctly built with ECW support):

27-Apr-2017 19:01:43.176 WARNING [localhost-startStop-1]
it.geosolutions.imageio.gdalframework.GDALUtilities.isDriverAvailable
Failed to get the specified GDAL Driver: ECW
Cause: java.lang.UnsatisfiedLinkError:
org.gdal.gdal.gdalJNI.SWIGDriverUpcast(J)J
This is not a problem unless you need to use the specified GDAL
plugin. It won't be enabled

I am wondering if this could be caused by the SWIG version which I am using?
Any help will be really appreciated

regards
p

[1] https://trac.osgeo.org/gdal/wiki/GdalOgrInJavaBuildInstructionsUnix

-- 
Paolo Corti
Geospatial software developer
web: http://www.paolocorti.net
twitter: @capooti
skype: capooti

From even.rouault at spatialys.com  Fri Apr 28 01:13:21 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 28 Apr 2017 10:13:21 +0200
Subject: [gdal-dev] Building java bindings with GDAL 2.1.3
In-Reply-To: <CAHXrU-JJ_KuauiyefuoZXhLwyxq5dmWBFhBF078LR-gJtT8ELA@mail.gmail.com>
References: <CAHXrU-JJ_KuauiyefuoZXhLwyxq5dmWBFhBF078LR-gJtT8ELA@mail.gmail.com>
Message-ID: <1905567.sDehrEUvOA@even-i700>

Paolo,

> I am wondering if this could be caused by the SWIG version which I am using?

Yes much likely this error is typical of a mismatch between SWIG 1.3 and SWIG 2 or 3. It is 
likely that the gdal.jar in GeoServer was produced with SWIG 1.3, so you'll need to 
generate the native part (libgdalconstjni.so, etc...) with SWIG 1.3 as well (you can build it 
easily from source, ./configure --prefix=$HOME/install-swig-1.3; make; make install and 
then put $HOME/install-swig-1.3/bin in top of your PATH, before building again the GDAL 
Java bindings). Or you may try to replace the gdal.jar located somewhere in the geoserver 
installation with the one you've generated with SWIG 3.
But in both cases I'm not completely sure that things will work due to a few (subtle) 
changes in the GDAL Java API between GDAL 1.x used by this old GeoServer and GDAL 2. 
Depends if GeoServer uses those API.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170428/5a838119/attachment.html>

From osahon.gis at gmail.com  Fri Apr 28 06:53:17 2017
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Fri, 28 Apr 2017 14:53:17 +0100
Subject: [gdal-dev] QGIS-GDAL OUT-DB RASTER SUPPORT
Message-ID: <CAGpiUSgq05qDBbEpEMj-whfq2V1iRZbWMHQK0U8G9b_-KuojyA@mail.gmail.com>

Hi All,

I am getting a black image when I try to display PostGIS out-db rasters. I
discovered that it has to do with GDAL support for out-db rasters as stated
in the link below for a similar issue (over 1 year back):
https://hub.qgis.org/issues/12133

The last comment by Jürgen Fischer states "... only black images. So it's a
dependency issue (GDAL complains ERROR 1: This raster has outdb storage.
This feature isn't still available)."

I would like to know if out-db rasters remain unsupported by GDAL. If yes,
how do one solve this issue of displaying out-db rasters?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170428/5a84b3fb/attachment.html>

From mateusz at loskot.net  Fri Apr 28 06:57:45 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 28 Apr 2017 15:57:45 +0200
Subject: [gdal-dev] QGIS-GDAL OUT-DB RASTER SUPPORT
In-Reply-To: <CAGpiUSgq05qDBbEpEMj-whfq2V1iRZbWMHQK0U8G9b_-KuojyA@mail.gmail.com>
References: <CAGpiUSgq05qDBbEpEMj-whfq2V1iRZbWMHQK0U8G9b_-KuojyA@mail.gmail.com>
Message-ID: <CABUeae9WXXBwBnMCjPPQ1+JoM6Kw5+aXvmgLGfF8sKprjBdBYA@mail.gmail.com>

On 28 April 2017 at 15:53, Osahon Oduware <osahon.gis at gmail.com> wrote:
> I would like to know if out-db rasters remain unsupported by GDAL.

You have already got this answered by Even, see
https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046512.html

> If yes, how do one solve this issue of displaying out-db rasters?

By not accessing out-db rasters via GDAL, since it is not supported anyway.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From osahon.gis at gmail.com  Fri Apr 28 07:01:56 2017
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Fri, 28 Apr 2017 15:01:56 +0100
Subject: [gdal-dev] QGIS-GDAL OUT-DB RASTER SUPPORT
In-Reply-To: <CABUeae9WXXBwBnMCjPPQ1+JoM6Kw5+aXvmgLGfF8sKprjBdBYA@mail.gmail.com>
References: <CAGpiUSgq05qDBbEpEMj-whfq2V1iRZbWMHQK0U8G9b_-KuojyA@mail.gmail.com>
 <CABUeae9WXXBwBnMCjPPQ1+JoM6Kw5+aXvmgLGfF8sKprjBdBYA@mail.gmail.com>
Message-ID: <CAGpiUSgUkbK6tNBADfJwKGAAJHv3J=RfjM9jht4wd=J4YHNv1w@mail.gmail.com>

Hi Mateusz,

Thanks for your response. I would like to know how to display out-db
rasters in QGIS without the use of GDAL.

On Fri, Apr 28, 2017 at 2:57 PM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 28 April 2017 at 15:53, Osahon Oduware <osahon.gis at gmail.com> wrote:
> > I would like to know if out-db rasters remain unsupported by GDAL.
>
> You have already got this answered by Even, see
> https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046512.html
>
> > If yes, how do one solve this issue of displaying out-db rasters?
>
> By not accessing out-db rasters via GDAL, since it is not supported anyway.
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170428/ee05d302/attachment-0001.html>

From pcorti at gmail.com  Fri Apr 28 07:13:41 2017
From: pcorti at gmail.com (Paolo Corti)
Date: Fri, 28 Apr 2017 10:13:41 -0400
Subject: [gdal-dev] Building java bindings with GDAL 2.1.3
In-Reply-To: <1905567.sDehrEUvOA@even-i700>
References: <CAHXrU-JJ_KuauiyefuoZXhLwyxq5dmWBFhBF078LR-gJtT8ELA@mail.gmail.com>
 <1905567.sDehrEUvOA@even-i700>
Message-ID: <CAHXrU-LPOnBkmZTWpuFdP9a7SAJY3TzWr1=s5+rvrFZ+vct3TA@mail.gmail.com>

Hi Even

On Fri, Apr 28, 2017 at 4:13 AM, Even Rouault
<even.rouault at spatialys.com> wrote:
> Yes much likely this error is typical of a mismatch between SWIG 1.3 and
> SWIG 2 or 3. It is likely that the gdal.jar in GeoServer was produced with
> SWIG 1.3, so you'll need to generate the native part (libgdalconstjni.so,
> etc...) with SWIG 1.3 as well (you can build it easily from source,
> ./configure --prefix=$HOME/install-swig-1.3; make; make install and then put
> $HOME/install-swig-1.3/bin in top of your PATH, before building again the
> GDAL Java bindings). Or you may try to replace the gdal.jar located
> somewhere in the geoserver installation with the one you've generated with
> SWIG 3.
>
> But in both cases I'm not completely sure that things will work due to a few
> (subtle) changes in the GDAL Java API between GDAL 1.x used by this old
> GeoServer and GDAL 2. Depends if GeoServer uses those API.
>

Thanks for the great help. Compiling with Swig 1.3 did not help (same error).
I figured out, reading at this [1], that the the GeoServer GDAL plugin
must use gdal 1.9.2, as must use imageio-ext-gdal-bindings-1.9.2.jar
(I don't see that .jar available for other versions that 1.9.2).
Therefore I believe the Swig error was caused by using gdal java
bindings mixed between 1.9.2 and 2.1.3 versions.

Therefore, I am trying to compile on Ubuntu 16.04 gdal 1.9.2, but I am
now getting in this error [2].
Is there a workaround for this? The only alternative for me would be
to install Ubuntu 14.04LTS in the server, where I know that gdal 1.9.2
can be compiled correctly.

Thanks
p

[1] http://docs.geoserver.org/stable/en/user/data/raster/gdal.html
[2] https://gis.stackexchange.com/questions/180573/django-and-osgeo-closed

-- 
Paolo Corti
Geospatial software developer
web: http://www.paolocorti.net
twitter: @capooti
skype: capooti

From even.rouault at spatialys.com  Fri Apr 28 09:28:08 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 28 Apr 2017 18:28:08 +0200
Subject: [gdal-dev] GDAL 2.2.0 RC1 available
Message-ID: <27684975.59omuefnaK@even-i700>

Hi,

I've issued a release candidate for GDAL 2.2.0

The source is available at:

    http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0RC1.tar.xz
    http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0RC1.tar.gz
    http://download.osgeo.org/gdal/2.2.0/gdal220RC1.zip

A snapshot of the Python autotest suite can be downloaded from:

    http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0RC1.tar.gz
    http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0RC1.zip

The GDAL-GRASS plugin hasn't changed since beta1 :

    http://download.osgeo.org/gdal/2.2.0/gdal-grass-2.2.0beta1.tar.gz

A snapshot of the documentation :

    http://download.osgeo.org/gdal/2.2.0/gdal220doc.zip

I'll call for a vote to promote it to final middle of next week if nothing serious is reported 
before.

Changes since beta2 :
- cpl_multiproc.cpp: fix compiler errors in CPL_MULTIPROC_STUB mode, and fix runtime crash 
in that mode
- Idrisi: make Create() zero-initialize the .rst file (#6873)
- Export OGRJSonParse so that amigocloud can be built as a plugin
- GPX: ignore wpt/rtept/trkpt with empty content for lat or lon
- S57: add POSACC and QUAPOS fields for geometric primitive layers (github #205)
- PG: avoid errors with field default expressions like 'foo'::text (#6872)
- netCDF: fix crash on int64/uint64 dimensions and variables, and add support for them 
(#6870)
- ESRIJson: support reading M and ZM geometries
- SQLite dialect: properly quote column names when needed (github #214)

For the record, the issue with compiling QGIS 2.18 against GDAL 2.2 has been solved by a 
change committed in QGIS 2.18 branch. And the issue to build with a OSX xcode version by 
bumping the MACOSX_DEPLOYMENT_TARGET number.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170428/954995aa/attachment.html>

From even.rouault at spatialys.com  Fri Apr 28 10:40:14 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 28 Apr 2017 19:40:14 +0200
Subject: [gdal-dev] Building java bindings with GDAL 2.1.3
In-Reply-To: <CAHXrU-LPOnBkmZTWpuFdP9a7SAJY3TzWr1=s5+rvrFZ+vct3TA@mail.gmail.com>
References: <CAHXrU-JJ_KuauiyefuoZXhLwyxq5dmWBFhBF078LR-gJtT8ELA@mail.gmail.com>
 <1905567.sDehrEUvOA@even-i700>
 <CAHXrU-LPOnBkmZTWpuFdP9a7SAJY3TzWr1=s5+rvrFZ+vct3TA@mail.gmail.com>
Message-ID: <2080853.l6ZzaubSzs@even-i700>

On vendredi 28 avril 2017 10:13:41 CEST Paolo Corti wrote:
> Hi Even
> 
> On Fri, Apr 28, 2017 at 4:13 AM, Even Rouault
> 
> <even.rouault at spatialys.com> wrote:
> > Yes much likely this error is typical of a mismatch between SWIG 1.3 and
> > SWIG 2 or 3. It is likely that the gdal.jar in GeoServer was produced with
> > SWIG 1.3, so you'll need to generate the native part (libgdalconstjni.so,
> > etc...) with SWIG 1.3 as well (you can build it easily from source,
> > ./configure --prefix=$HOME/install-swig-1.3; make; make install and then
> > put $HOME/install-swig-1.3/bin in top of your PATH, before building again
> > the GDAL Java bindings). Or you may try to replace the gdal.jar located
> > somewhere in the geoserver installation with the one you've generated
> > with SWIG 3.
> > 
> > But in both cases I'm not completely sure that things will work due to a
> > few (subtle) changes in the GDAL Java API between GDAL 1.x used by this
> > old GeoServer and GDAL 2. Depends if GeoServer uses those API.
> 
> Thanks for the great help. Compiling with Swig 1.3 did not help (same
> error). I figured out, reading at this [1], that the the GeoServer GDAL
> plugin must use gdal 1.9.2, as must use imageio-ext-gdal-bindings-1.9.2.jar
> (I don't see that .jar available for other versions that 1.9.2).
> Therefore I believe the Swig error was caused by using gdal java
> bindings mixed between 1.9.2 and 2.1.3 versions.

Heck, latest GeoServer still using such an ancient version of GDAL... Or perhaps the doc is not 
up-to-date.

> 
> Therefore, I am trying to compile on Ubuntu 16.04 gdal 1.9.2, but I am
> now getting in this error [2].

I've managed with the attached patch (which removes the internal strndup() declaration and 
defintion). I've not tried if the build is running fine, but at least this compiles.

> Is there a workaround for this? The only alternative for me would be
> to install Ubuntu 14.04LTS in the server, where I know that gdal 1.9.2
> can be compiled correctly.

I guess you could probably upgrade to GDAL 1.11.X since the Java bindings must be 
compatible of GDAL 1.9.
In any case you still need to use SWIG 1.3

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170428/d894174f/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: json.patch
Type: text/x-patch
Size: 1150 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170428/d894174f/attachment-0001.bin>

From pcorti at gmail.com  Fri Apr 28 11:53:26 2017
From: pcorti at gmail.com (Paolo Corti)
Date: Fri, 28 Apr 2017 14:53:26 -0400
Subject: [gdal-dev] Building java bindings with GDAL 2.1.3
In-Reply-To: <2080853.l6ZzaubSzs@even-i700>
References: <CAHXrU-JJ_KuauiyefuoZXhLwyxq5dmWBFhBF078LR-gJtT8ELA@mail.gmail.com>
 <1905567.sDehrEUvOA@even-i700>
 <CAHXrU-LPOnBkmZTWpuFdP9a7SAJY3TzWr1=s5+rvrFZ+vct3TA@mail.gmail.com>
 <2080853.l6ZzaubSzs@even-i700>
Message-ID: <CAHXrU-KQchvzEy+a5pJ8w1=dwTRY44EF3UgBRhdFTmRT6y5V_Q@mail.gmail.com>

Hi Even

On Fri, Apr 28, 2017 at 1:40 PM, Even Rouault
<even.rouault at spatialys.com> wrote:
>
> Heck, latest GeoServer still using such an ancient version of GDAL... Or
> perhaps the doc is not up-to-date.
>

I have this doubt as well, that is why I sent an email to the
geoserver list. Let's see what it comes out.
https://sourceforge.net/p/geoserver/mailman/message/35811992/

>
> I've managed with the attached patch (which removes the internal strndup()
> declaration and defintion). I've not tried if the build is running fine, but
> at least this compiles.
>

The patch worked beautifully. I could compile GDAL, Java bindings, and
now gdalinfo correctly reads .ecw, and so it does GeoServer with the
GDAL plugin.

Thanks so much, really appreciated!
If you will be in Boston for the FOSS4G I owe you a beer at least :)

p

-- 
Paolo Corti
Geospatial software developer
web: http://www.paolocorti.net
twitter: @capooti
skype: capooti

