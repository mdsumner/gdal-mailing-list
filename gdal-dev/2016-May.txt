From aborruso at gmail.com  Sun May  1 01:20:16 2016
From: aborruso at gmail.com (aborruso)
Date: Sun, 1 May 2016 01:20:16 -0700 (PDT)
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
Message-ID: <1462090816113-5263730.post@n6.nabble.com>

Hi,
I have no problem to add a column to a shapefile with:

ogrinfo myfile.shp -sql "ALTER TABLE myfile ADD fieldX integer"

But if I use, the second column is not added to the file.
ogrinfo myfile.shp -sql "ALTER TABLE myfile ADD fieldX integer(3), fieldY
integer(3)"

The shell gives me only
INFO: Open of `myfile.shp'
      using driver `ESRI Shapefile' successful.

What's wrong in my syntax?

Thank you





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jmckenna at gatewaygeomatics.com  Sun May  1 04:51:22 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Sun, 1 May 2016 08:51:22 -0300
Subject: [gdal-dev] How to add more than one column to a shapefile using
 ogrinfo
In-Reply-To: <1462090816113-5263730.post@n6.nabble.com>
References: <1462090816113-5263730.post@n6.nabble.com>
Message-ID: <5725EDBA.4000001@gatewaygeomatics.com>

On 2016-05-01 5:20 AM, aborruso wrote:
> Hi,
> I have no problem to add a column to a shapefile with:
>
> ogrinfo myfile.shp -sql "ALTER TABLE myfile ADD fieldX integer"
>
> But if I use, the second column is not added to the file.
> ogrinfo myfile.shp -sql "ALTER TABLE myfile ADD fieldX integer(3), fieldY
> integer(3)"
>
> The shell gives me only
> INFO: Open of `myfile.shp'
>        using driver `ESRI Shapefile' successful.
>
> What's wrong in my syntax?
>

I think you have to use 2 ogrinfo statements.

-jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/






From aborruso at gmail.com  Sun May  1 06:30:53 2016
From: aborruso at gmail.com (aborruso)
Date: Sun, 1 May 2016 06:30:53 -0700 (PDT)
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <5725EDBA.4000001@gatewaygeomatics.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5725EDBA.4000001@gatewaygeomatics.com>
Message-ID: <1462109453703-5263745.post@n6.nabble.com>

Hi Jeff,
thank you.


jmckenna wrote
> I think you have to use 2 ogrinfo statements.

I know it, it works with 2 statements. Do you know why I cannot use my kind
of SQL command with all in one statement?

And what do you think about to add some note in the documentation, about the
origin of the impossibility of use this kind of command?

Thank you again




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730p5263745.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From cwaigl at alaska.edu  Sun May  1 08:05:08 2016
From: cwaigl at alaska.edu (Christine Waigl)
Date: Sun, 1 May 2016 07:05:08 -0800
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <1462109453703-5263745.post@n6.nabble.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5725EDBA.4000001@gatewaygeomatics.com>
 <1462109453703-5263745.post@n6.nabble.com>
Message-ID: <CAGCc-AD4V6RowST0r2cMXx943+zshisF5hh4hVftEXLtc3FEsw@mail.gmail.com>

On Sun, May 1, 2016 at 5:30 AM, aborruso <aborruso at gmail.com> wrote:
>
>
> jmckenna wrote
> > I think you have to use 2 ogrinfo statements.

As far as I'm aware -- please correct me if I'm wrong --
ogrinfo only lists information about a file and doesn't
alter it.

"ogrinfo -sql" may well be executing the alter table
statement, but not have anything useful to return
to you. It won't write the result back to the
original file. I'd use ogr2ogr for that. (Disclaimer:
I've never used ogr2ogr with an alter table statement.
I typically use it to extract selected records and
attributes from a large file and save them to a smaller fle.)

Chris


--
Christine (Chris) Waigl - cwaigl at alaska.edu -  +1-907-474-5483 - Skype:
cwaigl_work
Geophysical Institute, UAF, 903 Koyukuk Drive, Fairbanks, AK 99775-7320, USA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160501/fa6ad847/attachment.html>

From aborruso at gmail.com  Sun May  1 07:58:43 2016
From: aborruso at gmail.com (aborruso)
Date: Sun, 1 May 2016 07:58:43 -0700 (PDT)
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <CAGCc-AD4V6RowST0r2cMXx943+zshisF5hh4hVftEXLtc3FEsw@mail.gmail.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5725EDBA.4000001@gatewaygeomatics.com>
 <1462109453703-5263745.post@n6.nabble.com>
 <CAGCc-AD4V6RowST0r2cMXx943+zshisF5hh4hVftEXLtc3FEsw@mail.gmail.com>
Message-ID: <1462114723833-5263753.post@n6.nabble.com>

Hi Christine,
thank you.


Christine Waigl wrote
> 
> As far as I'm aware -- please correct me if I'm wrong --
> ogrinfo only lists information about a file and doesn't
> alter it.

As I written in my message I'm able to use ogrinfo to alterate my source
file, but if I want to add 3 fields I must write 3 ogrinfo statements; I
would like to know why a single statemente with a correct SQL command. 

I learned about this use of ogrinfo reading this old thread:
http://osgeo-org.1560.x6.nabble.com/gdal-dev-Updating-shapefile-fields-name-with-ogr2ogr-tp4982783p4982794.html
<http://osgeo-org.1560.x6.nabble.com/gdal-dev-Updating-shapefile-fields-name-with-ogr2ogr-tp4982783p4982794.html>  

Best regards




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730p5263753.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From aborruso at gmail.com  Sun May  1 08:01:19 2016
From: aborruso at gmail.com (aborruso)
Date: Sun, 1 May 2016 08:01:19 -0700 (PDT)
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <1462114723833-5263753.post@n6.nabble.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5725EDBA.4000001@gatewaygeomatics.com>
 <1462109453703-5263745.post@n6.nabble.com>
 <CAGCc-AD4V6RowST0r2cMXx943+zshisF5hh4hVftEXLtc3FEsw@mail.gmail.com>
 <1462114723833-5263753.post@n6.nabble.com>
Message-ID: <1462114879913-5263755.post@n6.nabble.com>

aborruso wrote
> As I written in my message I'm able to use ogrinfo to alterate my source
> file, but if I want to add 3 fields I must write 3 ogrinfo statements; I
> would like to know why a single statemente with a correct SQL command. 

ops, I'm sorry ... why I cannot use a single ogrinfo statement with a
correct SQL command. 





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730p5263755.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From cwaigl at alaska.edu  Sun May  1 08:18:16 2016
From: cwaigl at alaska.edu (Christine Waigl)
Date: Sun, 1 May 2016 07:18:16 -0800
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <1462114723833-5263753.post@n6.nabble.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5725EDBA.4000001@gatewaygeomatics.com>
 <1462109453703-5263745.post@n6.nabble.com>
 <CAGCc-AD4V6RowST0r2cMXx943+zshisF5hh4hVftEXLtc3FEsw@mail.gmail.com>
 <1462114723833-5263753.post@n6.nabble.com>
Message-ID: <CAGCc-ABFiAyDqfVdgR_5tBbHKk3As0uJN+iKf8PkBmM5V7dT=w@mail.gmail.com>

I see. Thanks for the correction.

On Sun, May 1, 2016 at 6:58 AM, aborruso <aborruso at gmail.com> wrote:

> Hi Christine,
> thank you.
>
>
> Christine Waigl wrote
> >
> > As far as I'm aware -- please correct me if I'm wrong --
> > ogrinfo only lists information about a file and doesn't
> > alter it.
>
> As I written in my message I'm able to use ogrinfo to alterate my source
> file, but if I want to add 3 fields I must write 3 ogrinfo statements; I
> would like to know why a single statemente with a correct SQL command.
>
> I learned about this use of ogrinfo reading this old thread:
>
> http://osgeo-org.1560.x6.nabble.com/gdal-dev-Updating-shapefile-fields-name-with-ogr2ogr-tp4982783p4982794.html
> <
> http://osgeo-org.1560.x6.nabble.com/gdal-dev-Updating-shapefile-fields-name-with-ogr2ogr-tp4982783p4982794.html
> >
>
> Best regards
>
>
>
>
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730p5263753.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Christine (Chris) Waigl - cwaigl at alaska.edu -  +1-907-474-5483 - Skype:
cwaigl_work
Geophysical Institute, UAF, 903 Koyukuk Drive, Fairbanks, AK 99775-7320, USA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160501/ae6ab0a9/attachment-0001.html>

From jmckenna at gatewaygeomatics.com  Sun May  1 09:52:46 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Sun, 1 May 2016 13:52:46 -0300
Subject: [gdal-dev] How to add more than one column to a shapefile using
 ogrinfo
In-Reply-To: <1462109453703-5263745.post@n6.nabble.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5725EDBA.4000001@gatewaygeomatics.com>
 <1462109453703-5263745.post@n6.nabble.com>
Message-ID: <5726345E.2090602@gatewaygeomatics.com>

On 2016-05-01 10:30 AM, aborruso wrote:
>
> jmckenna wrote
>> I think you have to use 2 ogrinfo statements.
>
> I know it, it works with 2 statements. Do you know why I cannot use my kind
> of SQL command with all in one statement?
>
> And what do you think about to add some note in the documentation, about the
> origin of the impossibility of use this kind of command?
>

Hi Andrea,

When I responded earlier I was testing and you cannot do this in one 
single ogrinfo command (so that answers your initial question).  What 
would be great, if you could add your working example to the docs: here 
is an existing wiki page for ogrinfo where you can put your example for 
adding a column through sql: 
https://trac.osgeo.org/gdal/wiki/UserDocs/OgrInfo

Thanks, and hello from Canada,

-jeff

-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From aborruso at gmail.com  Sun May  1 10:11:36 2016
From: aborruso at gmail.com (aborruso)
Date: Sun, 1 May 2016 10:11:36 -0700 (PDT)
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <5726345E.2090602@gatewaygeomatics.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5725EDBA.4000001@gatewaygeomatics.com>
 <1462109453703-5263745.post@n6.nabble.com>
 <5726345E.2090602@gatewaygeomatics.com>
Message-ID: <1462122696959-5263771.post@n6.nabble.com>

Hi Jeff,
thank you from Italy!


jmckenna wrote
> 
> When I responded earlier I was testing and you cannot do this in one 
> single ogrinfo command (so that answers your initial question).  What 
> would be great, if you could add your working example to the docs: here 
> is an existing wiki page for ogrinfo where you can put your example for 
> adding a column through sql: 
> https://trac.osgeo.org/gdal/wiki/UserDocs/OgrInfo

I have inserted my example in the wiki page:
https://trac.osgeo.org/gdal/wiki/UserDocs/OgrInfo#AddingacolumnthroughSQL

Probably I'm making a stupid question, and I'm sorry if I repeat myself: why
is not possible to use a sigle SQL statement with the adding of more than
one column?

Best regards



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730p5263771.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jluis at ualg.pt  Sun May  1 11:37:20 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Sun, 1 May 2016 19:37:20 +0100
Subject: [gdal-dev] compile error on windows
In-Reply-To: <5724E81B.8040203@gatewaygeomatics.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <5724E81B.8040203@gatewaygeomatics.com>
Message-ID: <6DF14980-1C9F-4EEB-9F43-1BD09425DB57@ualg.pt>

If you want to protect your hair don't try to build HDF5.8.12 (and probably some other versions around this one) it will crash a couple times under VS14 and will error at the middle of build with a
timezone variable not found (or similar)

5.10.0 builds fine but the HDF page has worry message saying files build with 5.10 may not be read with 5.8

Joaquim

Sent from my iDedo

No dia 30/04/2016, às 18:15, Jeff McKenna <jmckenna at gatewaygeomatics.com> escreveu:

>> On 2016-04-29 5:17 PM, Ryan Grout wrote:
>> Hello,
>> 
>> I'm attempting to build GDAL for windows using Visual Studio 2008.
>> I've included the output of the build failure below.
>> 
>> I don't see anything wrong with the linking command (hdf5 library is
>> there).  I've double checked the exported symbols of hdf5.lib and it
>> definitely exports the symbols that gdal complains it can't find.
>> 
>> I get this failure on Windows 10 with Visual Studio 2008 and gdal 2.0.0
>> through 2.1.0 RC4.  I suspect it might have something to do with HDF
>> 1.8.16 (since the problem only manifested itself since updating HDF5).
>> 
>> 
>> Searching this mailing list, I couldn't find similar failures.  Any help
>> would be appreciated.
> 
> Compiling HDF5, HDF4, and NetCDF and making them work with GDAL on Windows is quite a dance.  Be ready to lose hair and what hair you'll have will turn grey.  Then once you think you're in the clear, you try compiling it all on x64 and well, a whole new ballgame of errors.
> 
> I know I've ran into problems compiling this in years past for the MS4W community (http://ms4w.com); there are just so many items to be aware of.  Over the years I've tried to record my notes at:
> 
>  https://trac.osgeo.org/gdal/wiki/HDF
> 
> It would be great if you too could record your notes and 'gotchyas' there.  Anything is a help.
> 
> I'm working on a new build for the MS4W community with the new 2015 compiler, which seems to work better managing these 4 libraries (huge knock on wood!).
> 
> In terms of building HDF5, one of the important notes is during cmake be sure to set "-DBUILD_SHARED_LIBS:BOOL:ON"  I'm not sure if that helps you case or not.
> 
> All this to say, you're not alone in this battle! :)
> 
> -jeff
> 
> 
> -- 
> Jeff McKenna
> MapServer Consulting and Training Services
> http://www.gatewaygeomatics.com/
> 
> 
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev


From even.rouault at spatialys.com  Sun May  1 13:28:54 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 1 May 2016 22:28:54 +0200
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <1462122696959-5263771.post@n6.nabble.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5726345E.2090602@gatewaygeomatics.com>
 <1462122696959-5263771.post@n6.nabble.com>
Message-ID: <201605012228.54593.even.rouault@spatialys.com>

Le dimanche 01 mai 2016 19:11:36, aborruso a écrit :
> Hi Jeff,
> thank you from Italy!
> 
> 
> jmckenna wrote
> 
> > When I responded earlier I was testing and you cannot do this in one
> > single ogrinfo command (so that answers your initial question).  What
> > would be great, if you could add your working example to the docs: here
> > is an existing wiki page for ogrinfo where you can put your example for
> > adding a column through sql:
> > https://trac.osgeo.org/gdal/wiki/UserDocs/OgrInfo
> 
> I have inserted my example in the wiki page:
> https://trac.osgeo.org/gdal/wiki/UserDocs/OgrInfo#AddingacolumnthroughSQL
> 
> Probably I'm making a stupid question, and I'm sorry if I repeat myself:
> why is not possible to use a sigle SQL statement with the adding of more
> than one column?

Because it is not implemented... OGR SQL has many implementation limitations. 
What is supported is documented here : http://gdal.org/ogr_sql.html

> 
> Best regards
> 
> 
> 
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-s
> hapefile-using-ogrinfo-tp5263730p5263771.html Sent from the GDAL - Dev
> mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From aborruso at gmail.com  Sun May  1 13:37:24 2016
From: aborruso at gmail.com (andy)
Date: Sun, 1 May 2016 22:37:24 +0200
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <201605012228.54593.even.rouault@spatialys.com>
References: <1462090816113-5263730.post@n6.nabble.com>
 <5726345E.2090602@gatewaygeomatics.com>
 <1462122696959-5263771.post@n6.nabble.com>
 <201605012228.54593.even.rouault@spatialys.com>
Message-ID: <CAHEdGZN-NNq=56xumuYyb-rX7ANJp0tf1LRinVj1J0YLYCvDtg@mail.gmail.com>

Hi Even,

On 1 May 2016 at 22:28, Even Rouault <even.rouault at spatialys.com> wrote:

> Because it is not implemented... OGR SQL has many implementation
> limitations.
> What is supported is documented here : http://gdal.org/ogr_sql.html
>

thank you very much. I had read that page, but stupidly I did not think
that "ALTER TABLE tablename ADD [COLUMN] columnname columntype" meant
strictly that I could only use it in this way.
My wrong intepretion was that I could use "alter table add" SQL command
and its variations. But it's only on my my mind.

Thank you again



-- 
 Andrea Borruso
website: http://blog.spaziogis.it
38° 7' 48" N, 13° 21' 9" E, EPSG:4326

--

"cercare e saper riconoscere chi e cosa,
 in mezzo all’inferno, non è inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160501/fe996119/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Sun May  1 14:09:13 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Sun, 1 May 2016 21:09:13 +0000
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
Message-ID: <1759ee4704f6421c8be5fc018c46cdf1@C119S212VM022.msvyvi.vaha.local>

Andrea Borruso wrote:


>thank you very much. I had read that page, but stupidly I did not think
>that "ALTER TABLE tablename ADD [COLUMN] columnname columntype" meant
>strictly that I could only use it in this way.
>My wrong intepretion was that I could use "alter table add" SQL command
>and its variations. But it's only on my my mind.


Hi,

Do you know some database that accepts SQL "ALTER TABLE foo ADD COLUMN bar1, bar2"? At least SQLite and PostgreSQL don't. That kind of usage is not mentioned in a bunch of documents about SQL language which I browsed through, for example http://www.w3schools.com/sql/sql_alter.asp.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160501/6faab9af/attachment.html>

From avyavkumar at gmail.com  Sun May  1 22:18:04 2016
From: avyavkumar at gmail.com (Avyav Kumar)
Date: Mon, 2 May 2016 10:48:04 +0530
Subject: [gdal-dev] GSoC 2016
Message-ID: <CAHOc4-23B1u7xyh0syUAoX8AA0iNbVxS6wXVjPuj4LD-qOMELw@mail.gmail.com>

Hi all,

I am Avyav Kumar, a third year student at BITS Pilani, KK Birla Goa Campus,
India. I am working to build a Triangulated Surface, Polyhedral Surface and
Triangle API for OGRGeometry [http://www.gdal.org/classOGRGeometry.html] as
part of my GSoC 2016 proposal.
If anyone has suggestions they'd like to me to keep in mind, or refer to
some sources about geometry standards, documentation, existing
implementations etc. or any other information, I'd be glad to hear it. In
essence, I am looking for any additional suggestions that other
developers/alike have in mind that I might have overlooked in my proposal.

You can check out an initial API in this Dropbox folder [
https://www.dropbox.com/sh/4imwketk6b6ttmh/AAD_fH9Rbpi-2nBTLPssXkkua?dl=0].

Thanks!

Regards,

Avyav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/23af1e1a/attachment.html>

From aborruso at gmail.com  Sun May  1 23:23:51 2016
From: aborruso at gmail.com (aborruso)
Date: Sun, 1 May 2016 23:23:51 -0700 (PDT)
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <1759ee4704f6421c8be5fc018c46cdf1@C119S212VM022.msvyvi.vaha.local>
References: <1462090816113-5263730.post@n6.nabble.com>
 <1759ee4704f6421c8be5fc018c46cdf1@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1462170231063-5263821.post@n6.nabble.com>

Hi Jukka,


Rahkonen Jukka (MML) wrote
> Do you know some database that accepts SQL "ALTER TABLE foo ADD COLUMN
> bar1, bar2"? At least SQLite and PostgreSQL don't. That kind of usage is
> not mentioned in a bunch of documents about SQL language which I browsed
> through, for example http://www.w3schools.com/sql/sql_alter.asp.

it's certainly a PostgreSQL syntax, and my (wrong) question derives from it.
And it's just like you wrote:
ALTER TABLE public.table ADD COLUMN col1 int, ADD COLUMN col2 int;

And in MySQL should be something like:
ALTER TABLE table
ADD COLUMN colA VARCHAR(10) NOT NULL,
ADD COLUMN colB INT(10) UNSIGNED NOT NULL,
AFTER thiscolumn

I think it works also in Microsoft SQL server and Oracle.

Best regards,

Andrea





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730p5263821.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jukka.rahkonen at maanmittauslaitos.fi  Mon May  2 00:46:45 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 2 May 2016 07:46:45 +0000
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
Message-ID: <51de523d57ce40958779f200b3fc14f8@C119S212VM022.msvyvi.vaha.local>

Andrea wrote:


>Hi Jukka,





>Rahkonen Jukka (MML) wrote

>> Do you know some database that accepts SQL "ALTER TABLE foo ADD COLUMN

>> bar1, bar2"? At least SQLite and PostgreSQL don't. That kind of usage is

>> not mentioned in a bunch of documents about SQL language which I browsed

>> through, for example http://www.w3schools.com/sql/sql_alter.asp.



>it's certainly a PostgreSQL syntax, and my (wrong) question derives from it.

>And it's just like you wrote:

>ALTER TABLE public.table ADD COLUMN col1 int, ADD COLUMN col2 int;



>And in MySQL should be something like:

>ALTER TABLE table

>ADD COLUMN colA VARCHAR(10) NOT NULL,

>ADD COLUMN colB INT(10) UNSIGNED NOT NULL,

>AFTER thiscolumn



>I think it works also in Microsoft SQL server and Oracle.



Hi,



Using the same SQL syntax that works with pgAdmin works also with ogrinfo:



ogrinfo PG:"dbname='mydb' host='localhost' port='5432' user='myself'" -sql "alter table foo add column bar7 text, add column bar8 text"



The syntax with PostgreSQL seems really require two ADD COLUMNs

ALTER TABLE foo ADD COLUMN bar4 text, ADD COLUMNS bar5 text;



In Oracle this is supported with syntax



alter table
   table_name
add
   (
   column1_name column1_datatype column1_constraint,
   column2_name column2_datatype column2_constraint,
   column3_name column3_datatype column3_constraint
   );



That syntax is not accepted by PostgreSQL, tested with



alter table foo add column (bar3 text, bar4 text);



ERROR:  syntax error at or near "("

LINE 1: alter table foo add column (bar3 text, bar4 text)



SQLite accepts only one column or perhaps I did not find the right syntax.



It seems to me that adding a general support for adding multiple columns with a single request into OGR SQL dialect would require to go through every driver: With PostgreSQL, build SQL statement with two ADD COLUMNs, with Oracle use one ADD and list of column definition, with SQLite make as many separate ALTER TABLEs as needed, with file based formats do whatever is needed. That is for sure doable but feels like a big work. Users should also be somehow aware that certain drivers use by default some other SQL dialect than the OGR SQL and adding multiple columns would require different syntax with native dialect and with OGR SQL.



-Jukka Rahkonen-









>Best regards,



Andrea

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/8b06b1a5/attachment-0001.html>

From even.rouault at spatialys.com  Mon May  2 01:34:50 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 10:34:50 +0200
Subject: [gdal-dev] Motion: Promote 2.1.0RC4 for release
In-Reply-To: <201604271018.43194.even.rouault@spatialys.com>
References: <201604271018.43194.even.rouault@spatialys.com>
Message-ID: <201605021034.51128.even.rouault@spatialys.com>

Le mercredi 27 avril 2016 10:18:42, Even Rouault a écrit :
> Motion: GDAL/OGR 2.1.0RC4 is promoted to be the official 2.1.0 final
> release.
> 
> ---

I declare this motion passed with +1 from PSC members JukkaR, HowardB, 
DanielM, TamasS, KurtS and me. As well as support from Jeff McKenna and Sean 
Gillies.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From aborruso at gmail.com  Mon May  2 01:43:02 2016
From: aborruso at gmail.com (aborruso)
Date: Mon, 2 May 2016 01:43:02 -0700 (PDT)
Subject: [gdal-dev] How to add more than one column to a shapefile using
	ogrinfo
In-Reply-To: <51de523d57ce40958779f200b3fc14f8@C119S212VM022.msvyvi.vaha.local>
References: <1462090816113-5263730.post@n6.nabble.com>
 <51de523d57ce40958779f200b3fc14f8@C119S212VM022.msvyvi.vaha.local>
Message-ID: <CAHEdGZPGACg1WzR1fPjOVVdGj=xVVBAxhPyAxyOzDaoYx-H-3Q@mail.gmail.com>

On 2 May 2016 at 09:32, Rahkonen Jukka (MML) [via OSGeo.org] <
ml-node+s1560n5263838h56 at n6.nabble.com> wrote:

> It seems to me that adding a general support for adding multiple columns
> with a single request into OGR SQL dialect would require to go through
> every driver: With PostgreSQL, build SQL statement with two ADD COLUMNs,
> with Oracle use one ADD and list of column definition, with SQLite make as
> many separate ALTER TABLEs as needed, with file based formats do whatever
> is needed. That is for sure doable but feels like a big work. Users should
> also be somehow aware that certain drivers use by default some other SQL
> dialect than the OGR SQL and adding multiple columns would require
> different syntax with native dialect and with OGR SQL.


I agree, it seems big. A solution could be to use a kind of access to the
db, like the one used by ORM system (SQLAlchemy, etc.), but to build this
it's a big job too.

Thanks for this thread with all of you.

Best regard


-- 
 Andrea Borruso
website: http://blog.spaziogis.it
38° 7' 48" N, 13° 21' 9" E, EPSG:4326

--

"cercare e saper riconoscere chi e cosa,
 in mezzo all’inferno, non è inferno,
e farlo durare, e dargli spazio"

Italo Calvino




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-add-more-than-one-column-to-a-shapefile-using-ogrinfo-tp5263730p5263853.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/8ccfb004/attachment.html>

From even.rouault at spatialys.com  Mon May  2 02:19:26 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 11:19:26 +0200
Subject: [gdal-dev] GDAL/OGR 2.1.0 released
Message-ID: <201605021119.27211.even.rouault@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team and community, I am pleased to
announce the release of GDAL/OGR 2.1.0.  GDAL/OGR is a C++ geospatial
data access library for raster and vector file formats, databases and
web services.  It includes bindings for several languages, and a variety
of command line tools.

   http://www.gdal.org/

The 2.1.0 release is a major new feature release with the following 
highlights:

*  RFC 26: Add hash-set band block cache implementation for very larger 
rasters (WMS, WMTS, ...) 
        http://trac.osgeo.org/gdal/wiki/rfc26_blockcache
*  RFC 48: Geographical networks support (GNM) 
        ​https://trac.osgeo.org/gdal/wiki/rfc48_geographical_networks_support
*  RFC 58: Add DeleteNoDataValue?(): 
        ​https://trac.osgeo.org/gdal/wiki/rfc58_removing_dataset_nodata_value
*  RFC 59.1: Make GDAL/OGR utilities available as library functions: 
        ​https://trac.osgeo.org/gdal/wiki/rfc59.1_utilities_as_a_library
    For gdalinfo, gdal_translate, gdalwarp, ogr2ogr, gdaldem, nearblack, 
gdalgrid, gdal_rasterize, gdalbuildvrt Available in C, Python, Perl and Java 
bindings.
*  RFC 60: Improved round-tripping in OGR 
        ​https://trac.osgeo.org/gdal/wiki/rfc60_improved_roundtripping_in_ogr
    Implemented in GeoJSON driver
*  RFC 61: Support for measured geometries. 
    ​https://trac.osgeo.org/gdal/wiki/rfc61_support_for_measured_geometries
    Implemented in Shapefile, PostgreSQL/PostGIS, PGDump, MEM, SQLite, 
GeoPackage, FileGDB, OpenFileGDB, CSV, VRT

*  New GDAL/raster drivers:
    ​CALS: read/write driver for CALS Type I rasters
    ​DB2: read/write support for DB2 database (Windows only)
    ​ISCE: read/write driver (#5991)
    ​MRF: read/write driver for Meta Raster Format (#6342)
    ​SAFE: read driver for ESA SENTINEL-1 SAR products (#6054)
    ​SENTINEL2: read driver for ESA SENTINEL-2 L1B/LC1/L2A products
    ​WMTS: read driver for OGC WMTS services 
*  New OGR/vector drivers:
     ​AmigoCloud: read/write support for AmigoCloud? mapping platform
     ​DB2: read/write support for DB2 database (Windows only)
     ​MongoDB: read/write driver
     ​netCDF: read/write driver
     ​VDV: read/write VDV-451/VDV-452 driver, with specialization for the 
            Austrian official open government street graph format 
* Significantly improved drivers:
     ​CSV: new options, editing capabilities of existing file
     ​ElasticSearch: read support and support writing any geometry type
     ​GeoJSON: editing capabilities of existing file, "native data" (RFC 60) 
support
     ​MBTiles: add raster write support. fixes in open support
     ​PDF: add PDFium library as a possible back-end.
     ​PLScenes: add support for V1 API
     ​VRT: on-the-fly pan-sharpening
     ​GTiff: multi-threaded compression for some compression methods 
* Port library: add ​/vsis3/, ​/vsis3_streaming/, ​/vsicrypt/ virtual file 
systems

* Upgrade to EPSG database v8.8
* General sanitization pass to clean-up code, fix a lot of compiler warnings, 
as well as issues pointed by static code analyzers.
* Fixes in a number of drivers to be more robust against corrupted files (most 
found with American Fuzzy Lop)

More complete information on the new features and fixes in the 2.1.0
release can be found at:

  http://trac.osgeo.org/gdal/wiki/Release/2.1.0-News

The release can be downloaded from:
  * http://download.osgeo.org/gdal/2.1.0/gdal210.zip - source as a zip
  * http://download.osgeo.org/gdal/2.1.0/gdal-2.1.0.tar.gz - source as 
.tar.gz
  * http://download.osgeo.org/gdal/2.1.0/gdal-2.1.0.tar.xz - source as 
.tar.xz
  * http://download.osgeo.org/gdal/2.1.0/gdalautotest-2.1.0.tar.gz - test 
suite
  * http://download.osgeo.org/gdal/2.1.0/gdal210doc.zip - documentation / 
website

The migration guide can be found at  :
      https://svn.osgeo.org/gdal/branches/2.1/gdal/MIGRATION_GUIDE.TXT

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon May  2 02:30:07 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 11:30:07 +0200
Subject: [gdal-dev] Questions about MBTiles write support @ GDAL 2.1 RC4
In-Reply-To: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
References: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
Message-ID: <201605021130.07618.even.rouault@spatialys.com>

Le samedi 30 avril 2016 22:23:19, Gunnar Blom a écrit :
> Hi.
>  
> Awesome work with GDAL 2.1 RC4 and the MBTiles write support. I've ran into
> some questions using this feature with the C/C++ API. 
> 1) When creating a MBTiles file, only one layer is written. Can you use
> GDAL to populate other layers?

I'm not sure what you call "layer". AFAIK MBTiles files do not have a concept 
of storing tiles for different layers. (you could use GeoPackage for that)

> 2) Can you choose to create 512*512px tiles
> instead of the 256*256px default? Would increase quality on retina
> devices. 

It is true that the spec doesn't say anyting about tile size, but are there 
MBTiles files with tiles not 256x256 ? This isn't supported by the driver. On 
writing this shouldn't be a big problem. On reading this might be a bit more 
tricky as you could potentially have a mix of tiles of different sizes !

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon May  2 02:32:56 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 11:32:56 +0200
Subject: [gdal-dev] Possible bug in GDAL 2.1 RC4 with MBTiles creation
In-Reply-To: <trinity-3f71487b-15ed-4628-bfd2-5996f7c6de20-1462049519591@3capp-mailcom-lxa14>
References: <trinity-3f71487b-15ed-4628-bfd2-5996f7c6de20-1462049519591@3capp-mailcom-lxa14>
Message-ID: <201605021132.56602.even.rouault@spatialys.com>

Le samedi 30 avril 2016 22:52:00, Gunnar Blom a écrit :
> Hi,
>  
> I've found a possible bug in GDAL 2.1 RC4 and the MBTiles driver.
>  
> I have the following image that I'm geo
> referencing: http://imgbox.com/tLFn3Auq 
> If I'm using the follwing code to warp the image based on a
> GeoTransform, it works
> well: https://gist.github.com/gunnarblom/9d73aa4358f3dafe2fd6808f7d4e9f41
> ...and it produces the following image which is
> correct: http://imgbox.com/TrzlXk4P 
> (note: as the target coordinate system is Apple's own in MapKit, the y-axis
> is reversed and therefor the negation of the two last parameters in the
> GeoTransform before warping) 
> If I'm using the following code to
> create MBTiles: https://gist.github.com/gunnarblom/76364b6bc8c0ff48dcf9fb8
> 1a5fdc060 ...but for some images/GeoTransforms it produces
> artifacts: http://imgbox.com/Gd15nfaP (three artifacts along the sides) 
> (note: this GeoTransform is based on WGS84-coordinates instead of Apple's
> coordinate system above in the regular image warp) 
> This error can be very strong on other images, it seems stronger the more
> skewed the transform is (example with a dummy-test I did with a random
> image: http://imgbox.com/FAWJj0eC) 
> What do you think can cause this bug?

I'm not sure. Does changing the GDAL_CACHEMAX configuration option changes the 
result (value in megabytes. default value is 5% of the total RAM) ?
Can you reproduce with gdal_translate ?

>  
> Thanks!
>  
> Regards,

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon May  2 02:35:17 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 11:35:17 +0200
Subject: [gdal-dev] Creation of pages on Trac wiki disabled
In-Reply-To: <201604272159.01182.even.rouault@spatialys.com>
References: <201604272159.01182.even.rouault@spatialys.com>
Message-ID: <201605021135.17550.even.rouault@spatialys.com>

Le mercredi 27 avril 2016 21:59:01, Even Rouault a écrit :
> Folks,
> 
> I've removed the right to create new pages on the wiki for the
> 'authenticated' group due to spammers abusting it recently (as well as
> other projects wiki). OSGeo System Administration Committee is looking at
> that, so we might re- enable that if we understand what happens.
> If you need to create pages, ping me and I can give you the permission.

OSGeo id creation has been hardened, so I've re-enabled wiki page creation for 
authenticated users. Please keep an eye if spammers start abusing it again.

> 
> Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon May  2 02:46:19 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 11:46:19 +0200
Subject: [gdal-dev] GDAL/OGR 2.1.0 released
In-Reply-To: <201605021119.27211.even.rouault@spatialys.com>
References: <201605021119.27211.even.rouault@spatialys.com>
Message-ID: <201605021146.19965.even.rouault@spatialys.com>


> The release can be downloaded from:
>   * http://download.osgeo.org/gdal/2.1.0/gdal210.zip - source as a zip
>   * http://download.osgeo.org/gdal/2.1.0/gdal-2.1.0.tar.gz - source as
> .tar.gz
>   * http://download.osgeo.org/gdal/2.1.0/gdal-2.1.0.tar.xz - source as
> .tar.xz
>   * http://download.osgeo.org/gdal/2.1.0/gdalautotest-2.1.0.tar.gz - test
> suite
>   * http://download.osgeo.org/gdal/2.1.0/gdal210doc.zip - documentation /
> website
> 

I forgot to include the link to the GDAL-GRASS plugin :
     http://download.osgeo.org/gdal/2.1.0/gdal-grass-2.1.0.tar.gz

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From gane.prog at gmail.com  Mon May  2 03:24:03 2016
From: gane.prog at gmail.com (Gane R)
Date: Mon, 2 May 2016 15:54:03 +0530
Subject: [gdal-dev] Multi threaded Data access from a Dataset
Message-ID: <CALMrLdAMKHRxdi7cxKWmF1ZORzV6gbpr-bbuMJc6PxkuHFS1eQ@mail.gmail.com>

Is is possible to access a dataset from different threads with
GDALDatasetRasterIO is it thread safe.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/0e519136/attachment.html>

From gane.prog at gmail.com  Mon May  2 03:25:11 2016
From: gane.prog at gmail.com (Gane R)
Date: Mon, 2 May 2016 15:55:11 +0530
Subject: [gdal-dev] Progress and cancel of gdalwarp program
In-Reply-To: <201604261203.52053.even.rouault@spatialys.com>
References: <CALMrLdAXk78XgbBcEpTuVG4C38DbnoRtoNfOAfhgD0PeG-XHdQ@mail.gmail.com>
 <201604261143.58024.even.rouault@spatialys.com>
 <CALMrLdCNK+oVP0G+8GSTU9E1bpqdNj7=ZstaF8Xht0SM2r97Yw@mail.gmail.com>
 <201604261203.52053.even.rouault@spatialys.com>
Message-ID: <CALMrLdAuPNf1hdCB0yuzT+Q9C8kXS4TKMp1id6NurUPeUjybsA@mail.gmail.com>

I got it and saw the progress and cancel working,
thanks

Gane

On Tue, Apr 26, 2016 at 3:33 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le mardi 26 avril 2016 11:58:22, Gane R a écrit :
> > [1] Is is possible to get the progress 10...20... into a variable and [2]
> > is it possible to cancel the warp progress, say cancel the operation.
>
> See how it is done in
> https://svn.osgeo.org/gdal/trunk/gdal/port/cpl_progress.cpp
>
> >
> > I saw the documentation and sample in JPEG CreateCopy, gdal_translate and
> > GDALDummyProgress used in quiet operation.
> >
> >
> > Thanks
> > Gane
> >
> > On Tue, Apr 26, 2016 at 3:13 PM, Even Rouault <
> even.rouault at spatialys.com>
> >
> > wrote:
> > > Le mardi 26 avril 2016 11:36:46, Gane R a écrit :
> > > > Is that any way to get the progress of the gdalwarp and make a cancel
> > > > request of gdalwarp.
> > > >
> > > > in gdal 1.10.1
> > > > In gdalwarp.cpp
> > > >
> > > >  I see psWO->pfnProgress = GDALTermProgress;
> > > >
> > > > This for only progress right ?
> > >
> > > No, if the function returns FALSE, the processing is stopped.
> > >
> > > > I want to have function called with the progress displayed and also
> > >
> > > check,
> > >
> > > > if cancel is requested.
> > > >
> > > > Gane
> > >
> > > --
> > > Spatialys - Geospatial professional services
> > > http://www.spatialys.com
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/ef1d8a5f/attachment-0001.html>

From gunnarblom at mail.com  Mon May  2 04:03:34 2016
From: gunnarblom at mail.com (gunnarblom)
Date: Mon, 2 May 2016 04:03:34 -0700 (PDT)
Subject: [gdal-dev] Questions about MBTiles write support @ GDAL 2.1 RC4
In-Reply-To: <201605021130.07618.even.rouault@spatialys.com>
References: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
 <201605021130.07618.even.rouault@spatialys.com>
Message-ID: <1462187014951-5263887.post@n6.nabble.com>

Even Rouault-2 wrote
>> 1) When creating a MBTiles file, only one layer is written. Can you use
>> GDAL to populate other layers?
> 
> I'm not sure what you call "layer". AFAIK MBTiles files do not have a
> concept 
> of storing tiles for different layers. (you could use GeoPackage for that)

I'm talking about zoom layers. E.g. when using gdal2tiles.py you choose what
zoom layers you want to create. Now with the API when only one layer is
created, many MBTiles readers will not show anything until you zoom in to
the exact zoom layer that was decided to include. So the output MBTiles file
doesn't really function as supposed to in a MBTiles reader/viewer.


Even Rouault-2 wrote
>> 2) Can you choose to create 512*512px tiles
>> instead of the 256*256px default? Would increase quality on retina
>> devices. 
> 
> It is true that the spec doesn't say anyting about tile size, but are
> there 
> MBTiles files with tiles not 256x256 ? This isn't supported by the driver.
> On 
> writing this shouldn't be a big problem. On reading this might be a bit
> more 
> tricky as you could potentially have a mix of tiles of different sizes !

I guess the MBTiles format could have metadata about what resolution the
tiles are in. But also the readers/viewers should just draw the tiles in
their correct place and shouldn't be dependent on what resolution they have?
Isn't that how it works with a regular TMS folder structure anyway?



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Questions-about-MBTiles-write-support-GDAL-2-1-RC4-tp5263684p5263887.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Mon May  2 04:39:29 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 13:39:29 +0200
Subject: [gdal-dev] Questions about MBTiles write support @ GDAL 2.1 RC4
In-Reply-To: <1462187014951-5263887.post@n6.nabble.com>
References: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
 <201605021130.07618.even.rouault@spatialys.com>
 <1462187014951-5263887.post@n6.nabble.com>
Message-ID: <201605021339.29551.even.rouault@spatialys.com>

Le lundi 02 mai 2016 13:03:34, gunnarblom a écrit :
> Even Rouault-2 wrote
> 
> >> 1) When creating a MBTiles file, only one layer is written. Can you use
> >> GDAL to populate other layers?
> > 
> > I'm not sure what you call "layer". AFAIK MBTiles files do not have a
> > concept
> > of storing tiles for different layers. (you could use GeoPackage for
> > that)
> 
> I'm talking about zoom layers. 

Ah ok, you can generate overviews/zoom layers with gdaladdo / 
GDALBuildOverviews().

> >> 2) Can you choose to create 512*512px tiles
> >> instead of the 256*256px default? Would increase quality on retina
> >> devices.
> > 
> > It is true that the spec doesn't say anyting about tile size, but are
> > there
> > MBTiles files with tiles not 256x256 ? This isn't supported by the
> > driver. On
> > writing this shouldn't be a big problem. On reading this might be a bit
> > more
> > tricky as you could potentially have a mix of tiles of different sizes !
> 
> I guess the MBTiles format could have metadata about what resolution the
> tiles are in.

It could, but this isn't standardized

> But also the readers/viewers should just draw the tiles in
> their correct place and shouldn't be dependent on what resolution they
> have? Isn't that how it works with a regular TMS folder structure anyway?

For viewers, yes. For the reader side of the GDAL driver, this is a bit 
difference as it needs to determine a fixed resolution per zoom layer.

> 
> 
> 
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/gdal-dev-Questions-about-MBTiles-write
> -support-GDAL-2-1-RC4-tp5263684p5263887.html Sent from the GDAL - Dev
> mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon May  2 04:56:39 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 13:56:39 +0200
Subject: [gdal-dev] IReadBlock fails on alpha band, GDAL 2
In-Reply-To: <CAG-GLBOHBU2TpNqYPTR4GGx8y0OUyhEN_w6BAQZU+VL36SaS4w@mail.gmail.com>
References: <CAG-GLBPzCmYYM2RUYs3jU-m-kwxWAaK+u0e05QaBvEJ35EfaSA@mail.gmail.com>
 <2140615.y98qbhzUsm@even-n550jk>
 <CAG-GLBOHBU2TpNqYPTR4GGx8y0OUyhEN_w6BAQZU+VL36SaS4w@mail.gmail.com>
Message-ID: <201605021356.39636.even.rouault@spatialys.com>

> 
> Are there any other problems that you anticipate with using this
> configuration? I see RGBA JPEG-in-TIFF quite often...

I'd expect libtiff based software to generally work fine with that (with the 
exception of this bug of course, which is a rather convoluted way of using 
libtiff and the JPEG driver)

I see that support in libtiff to generate such images is relatively "recent" (4 
years ago) : https://trac.osgeo.org/gdal/ticket/4732

> 
> > Fixed per https://trac.osgeo.org/gdal/ticket/6493
> > Use of implicit overviews can be disabled by defining the config option
> > GTIFF_IMPLICIT_JPEG_OVR=NO
> 
> I can confirm that setting GTIFF_IMPLICIT_JPEG_OVR works and this will
> suffice as a workaround until the next GDAL release. Thanks, Even!

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From bradh at frogmouth.net  Mon May  2 04:27:32 2016
From: bradh at frogmouth.net (Brad Hards)
Date: Mon, 2 May 2016 21:27:32 +1000
Subject: [gdal-dev] Questions about MBTiles write support @ GDAL 2.1 RC4
In-Reply-To: <1462187014951-5263887.post@n6.nabble.com>
References: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
 <201605021130.07618.even.rouault@spatialys.com>
 <1462187014951-5263887.post@n6.nabble.com>
Message-ID: <007e01d1a465$9ed89020$dc89b060$@frogmouth.net>

> I'm talking about zoom layers. E.g. when using gdal2tiles.py you choose what
> zoom layers you want to create. Now with the API when only one layer is
> created, many MBTiles readers will not show anything until you zoom in to
> the exact zoom layer that was decided to include. So the output MBTiles file
> doesn't really function as supposed to in a MBTiles reader/viewer.
Perhaps you need to add the overviews.

Brad



From daniele.romagnoli at geo-solutions.it  Mon May  2 05:37:39 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 2 May 2016 14:37:39 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with NaN
Message-ID: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>

Hi List,

I have a reprojectiion tool which creates GeoTIFFs with NoData = NaN.
I'm creating couple of GeoTIFFs with partially overlapping areas where
GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in the same
overlapping region and viceversa (GeoTIFF2 has some NaN area while GeoTIFF1
has valid pixels for same area).
I have built a VRT on top of them and then translated into a single GeoTIFF.
However, the result has NaN in those regions.
I was hoping that the area containing NaNs would have been ignored instead,
in favor of proper values from the other file.
Is there any flag, properties or suggestions to make it working?

If I configure the reprojection tool to write NoData = -9999 and then use
gdalbuildvrt -srcnodata -9999, things are working fine.
So I'm just wondering if the same can be achieved dealing with NaN instead
of custom values.

Please, let me know.
Cheers,
Daniele

-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/fd67735f/attachment.html>

From even.rouault at spatialys.com  Mon May  2 05:49:15 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 14:49:15 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
Message-ID: <201605021449.15812.even.rouault@spatialys.com>

Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> Hi List,
> 
> I have a reprojectiion tool which creates GeoTIFFs with NoData = NaN.
> I'm creating couple of GeoTIFFs with partially overlapping areas where
> GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in the same
> overlapping region and viceversa (GeoTIFF2 has some NaN area while GeoTIFF1
> has valid pixels for same area).
> I have built a VRT on top of them and then translated into a single
> GeoTIFF. However, the result has NaN in those regions.
> I was hoping that the area containing NaNs would have been ignored instead,
> in favor of proper values from the other file.
> Is there any flag, properties or suggestions to make it working?
> 
> If I configure the reprojection tool to write NoData = -9999 and then use
> gdalbuildvrt -srcnodata -9999, things are working fine.
> So I'm just wondering if the same can be achieved dealing with NaN instead
> of custom values.

Daniele,

You didn't mention which GDAL version you use. It is possible that support for 
NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed at some point. 
From a quick test with trunk, it works  (works with 1.11 branch as well):

$ cat in1.asc
ncols        3
nrows        3
xllcorner    440720.000000000000
yllcorner    3750120.000000000000
cellsize     60.000000000000
NODATA_value    nan
 1.0 1.0 1.0
 1.0 nan 1.0
 1.0 1.0 1.0

$ cat in2.asc
ncols        3
nrows        3
xllcorner    440720.000000000000
yllcorner    3750120.000000000000
cellsize     60.000000000000
NODATA_value    nan
 nan nan nan
 nan 2.0 nan
 nan nan nan

$ gdalbuildvrt nan.vrt in1.asc in2.asc

$ gdal_translate nan.vrt /vsistdout/ -of aaigrid
ncols        3
nrows        3
xllcorner    440720.000000000000
yllcorner    3750120.000000000000
cellsize     60.000000000000
NODATA_value    nan
      1      1      1
      1      2      1
      1      1      1


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From daniele.romagnoli at geo-solutions.it  Mon May  2 05:52:41 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 2 May 2016 14:52:41 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <201605021449.15812.even.rouault@spatialys.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <201605021449.15812.even.rouault@spatialys.com>
Message-ID: <CAJaHrDxAmFfPwdK04Dx0N=-BiP-vu-d880MtEm0o8Dv3CWLeqw@mail.gmail.com>

Hi Even.
Thanks for the feedback.

Sorry... I'm using GDAL 1.11.3.
I'm going to double check to make sure I didn't make any mistake.
I'll let you know.

Cheers,
Daniele



On Mon, May 2, 2016 at 2:49 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> > Hi List,
> >
> > I have a reprojectiion tool which creates GeoTIFFs with NoData = NaN.
> > I'm creating couple of GeoTIFFs with partially overlapping areas where
> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in the same
> > overlapping region and viceversa (GeoTIFF2 has some NaN area while
> GeoTIFF1
> > has valid pixels for same area).
> > I have built a VRT on top of them and then translated into a single
> > GeoTIFF. However, the result has NaN in those regions.
> > I was hoping that the area containing NaNs would have been ignored
> instead,
> > in favor of proper values from the other file.
> > Is there any flag, properties or suggestions to make it working?
> >
> > If I configure the reprojection tool to write NoData = -9999 and then use
> > gdalbuildvrt -srcnodata -9999, things are working fine.
> > So I'm just wondering if the same can be achieved dealing with NaN
> instead
> > of custom values.
>
> Daniele,
>
> You didn't mention which GDAL version you use. It is possible that support
> for
> NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed at some
> point.
> From a quick test with trunk, it works  (works with 1.11 branch as well):
>
> $ cat in1.asc
> ncols        3
> nrows        3
> xllcorner    440720.000000000000
> yllcorner    3750120.000000000000
> cellsize     60.000000000000
> NODATA_value    nan
>  1.0 1.0 1.0
>  1.0 nan 1.0
>  1.0 1.0 1.0
>
> $ cat in2.asc
> ncols        3
> nrows        3
> xllcorner    440720.000000000000
> yllcorner    3750120.000000000000
> cellsize     60.000000000000
> NODATA_value    nan
>  nan nan nan
>  nan 2.0 nan
>  nan nan nan
>
> $ gdalbuildvrt nan.vrt in1.asc in2.asc
>
> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
> ncols        3
> nrows        3
> xllcorner    440720.000000000000
> yllcorner    3750120.000000000000
> cellsize     60.000000000000
> NODATA_value    nan
>       1      1      1
>       1      2      1
>       1      1      1
>
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/2d00c846/attachment-0001.html>

From daniele.romagnoli at geo-solutions.it  Mon May  2 06:16:30 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 2 May 2016 15:16:30 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <CAJaHrDxAmFfPwdK04Dx0N=-BiP-vu-d880MtEm0o8Dv3CWLeqw@mail.gmail.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <201605021449.15812.even.rouault@spatialys.com>
 <CAJaHrDxAmFfPwdK04Dx0N=-BiP-vu-d880MtEm0o8Dv3CWLeqw@mail.gmail.com>
Message-ID: <CAJaHrDzHZ1y0GfHa-gEGcctOXFpxvENrL72v9opbJr3rccqVaQ@mail.gmail.com>

Hi Even,
The produced GeoTIFF doesn't contain any nodata metadata/flag/TAG.
It simply has "NaN" pixels. QuantumGIS report those pixels as "nan" and
OpenEV report them as 1.#QNAN so I think they are properly "recognized" as
NaN.

I'm wondering if the GDAL utilities explicitly look for some metadata/flag
(as the "nodata value" in your previous ascii based sample) to do noData
checks or if it's also able to recognize a NaN "binary" value inside the
pixels.

What do you think about it?
Cheers,
Daniele

On Mon, May 2, 2016 at 2:52 PM, Daniele Romagnoli <
daniele.romagnoli at geo-solutions.it> wrote:

> Hi Even.
> Thanks for the feedback.
>
> Sorry... I'm using GDAL 1.11.3.
> I'm going to double check to make sure I didn't make any mistake.
> I'll let you know.
>
> Cheers,
> Daniele
>
>
>
> On Mon, May 2, 2016 at 2:49 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
>> > Hi List,
>> >
>> > I have a reprojectiion tool which creates GeoTIFFs with NoData = NaN.
>> > I'm creating couple of GeoTIFFs with partially overlapping areas where
>> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in the same
>> > overlapping region and viceversa (GeoTIFF2 has some NaN area while
>> GeoTIFF1
>> > has valid pixels for same area).
>> > I have built a VRT on top of them and then translated into a single
>> > GeoTIFF. However, the result has NaN in those regions.
>> > I was hoping that the area containing NaNs would have been ignored
>> instead,
>> > in favor of proper values from the other file.
>> > Is there any flag, properties or suggestions to make it working?
>> >
>> > If I configure the reprojection tool to write NoData = -9999 and then
>> use
>> > gdalbuildvrt -srcnodata -9999, things are working fine.
>> > So I'm just wondering if the same can be achieved dealing with NaN
>> instead
>> > of custom values.
>>
>> Daniele,
>>
>> You didn't mention which GDAL version you use. It is possible that
>> support for
>> NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed at some
>> point.
>> From a quick test with trunk, it works  (works with 1.11 branch as well):
>>
>> $ cat in1.asc
>> ncols        3
>> nrows        3
>> xllcorner    440720.000000000000
>> yllcorner    3750120.000000000000
>> cellsize     60.000000000000
>> NODATA_value    nan
>>  1.0 1.0 1.0
>>  1.0 nan 1.0
>>  1.0 1.0 1.0
>>
>> $ cat in2.asc
>> ncols        3
>> nrows        3
>> xllcorner    440720.000000000000
>> yllcorner    3750120.000000000000
>> cellsize     60.000000000000
>> NODATA_value    nan
>>  nan nan nan
>>  nan 2.0 nan
>>  nan nan nan
>>
>> $ gdalbuildvrt nan.vrt in1.asc in2.asc
>>
>> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
>> ncols        3
>> nrows        3
>> xllcorner    440720.000000000000
>> yllcorner    3750120.000000000000
>> cellsize     60.000000000000
>> NODATA_value    nan
>>       1      1      1
>>       1      2      1
>>       1      1      1
>>
>>
>> Even
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>>
>
>
>
> --
> ==
> GeoServer Professional Services from the experts! Visit
> http://goo.gl/it488V for more information.
> ==
>
> Ing. Daniele Romagnoli
> Senior Software Engineer
>
> GeoSolutions S.A.S.
> Via di Montramito 3/A
> 55054  Massarosa (LU)
> Italy
> phone: +39 0584 962313
> fax:      +39 0584 1660272
>
> http://www.geo-solutions.it
> http://twitter.com/geosolutions_it
>
> -------------------------------------------------------
>
> *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
>
> Le informazioni contenute in questo messaggio di posta elettronica e/o
> nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
> loro utilizzo è consentito esclusivamente al destinatario del messaggio,
> per le finalità indicate nel messaggio stesso. Qualora riceviate questo
> messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
> darcene notizia via e-mail e di procedere alla distruzione del messaggio
> stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
> divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
> utilizzarlo per finalità diverse, costituisce comportamento contrario ai
> principi dettati dal D.Lgs. 196/2003.
>
>
>
> The information in this message and/or attachments, is intended solely for
> the attention and use of the named addressee(s) and may be confidential or
> proprietary in nature or covered by the provisions of privacy act
> (Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
> Code).Any use not in accord with its purpose, any disclosure, reproduction,
> copying, distribution, or either dissemination, either whole or partial, is
> strictly forbidden except previous formal approval of the named
> addressee(s). If you are not the intended recipient, please contact
> immediately the sender by telephone, fax or e-mail and delete the
> information in this message that has been received in error. The sender
> does not give any warranty or accept liability as the content, accuracy or
> completeness of sent messages and accepts no responsibility  for changes
> made after they were sent or for other risks which arise as a result of
> e-mail transmission, viruses, etc.
>
>


-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/9012c82f/attachment.html>

From gunnarblom at mail.com  Mon May  2 06:11:54 2016
From: gunnarblom at mail.com (gunnarblom)
Date: Mon, 2 May 2016 06:11:54 -0700 (PDT)
Subject: [gdal-dev] Questions about MBTiles write support @ GDAL 2.1 RC4
In-Reply-To: <201605021339.29551.even.rouault@spatialys.com>
References: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
 <201605021130.07618.even.rouault@spatialys.com>
 <1462187014951-5263887.post@n6.nabble.com>
 <201605021339.29551.even.rouault@spatialys.com>
Message-ID: <1462194714087-5263915.post@n6.nabble.com>

Even Rouault-2 wrote
> Ah ok, you can generate overviews/zoom layers with gdaladdo / 
> GDALBuildOverviews().

I tried using GDALBuildOverviews() but it generates a separate .ovr file and
does not include it in the MBTiles file, right?

If I'm looking at the code, it seems like it is checking that the database
isn't in read-only mode, but it never writes the actual overview/zoom layers
to the MBTiles database? What is going on there?



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Questions-about-MBTiles-write-support-GDAL-2-1-RC4-tp5263684p5263915.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Mon May  2 06:27:10 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 15:27:10 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <CAJaHrDzHZ1y0GfHa-gEGcctOXFpxvENrL72v9opbJr3rccqVaQ@mail.gmail.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <CAJaHrDxAmFfPwdK04Dx0N=-BiP-vu-d880MtEm0o8Dv3CWLeqw@mail.gmail.com>
 <CAJaHrDzHZ1y0GfHa-gEGcctOXFpxvENrL72v9opbJr3rccqVaQ@mail.gmail.com>
Message-ID: <201605021527.10641.even.rouault@spatialys.com>

Le lundi 02 mai 2016 15:16:30, Daniele Romagnoli a écrit :
> Hi Even,
> The produced GeoTIFF doesn't contain any nodata metadata/flag/TAG.
> It simply has "NaN" pixels. QuantumGIS report those pixels as "nan" and
> OpenEV report them as 1.#QNAN so I think they are properly "recognized" as
> NaN.
> 
> I'm wondering if the GDAL utilities explicitly look for some metadata/flag
> (as the "nodata value" in your previous ascii based sample) to do noData
> checks or if it's also able to recognize a NaN "binary" value inside the
> pixels.

Yes, the NaN value must be explicitly set as the nodata property of the geotiff 
file so that gdalbuildvrt can recognize it as the nodata value (similarly to 
other nodata value)

You can do this with gdal_translate -a_nodata nan (or gdal_edit.py -a_nodata 
nan)

> 
> What do you think about it?
> Cheers,
> Daniele
> 
> On Mon, May 2, 2016 at 2:52 PM, Daniele Romagnoli <
> 
> daniele.romagnoli at geo-solutions.it> wrote:
> > Hi Even.
> > Thanks for the feedback.
> > 
> > Sorry... I'm using GDAL 1.11.3.
> > I'm going to double check to make sure I didn't make any mistake.
> > I'll let you know.
> > 
> > Cheers,
> > Daniele
> > 
> > 
> > 
> > On Mon, May 2, 2016 at 2:49 PM, Even Rouault <even.rouault at spatialys.com>
> > 
> > wrote:
> >> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> >> > Hi List,
> >> > 
> >> > I have a reprojectiion tool which creates GeoTIFFs with NoData = NaN.
> >> > I'm creating couple of GeoTIFFs with partially overlapping areas where
> >> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in the
> >> > same overlapping region and viceversa (GeoTIFF2 has some NaN area
> >> > while
> >> 
> >> GeoTIFF1
> >> 
> >> > has valid pixels for same area).
> >> > I have built a VRT on top of them and then translated into a single
> >> > GeoTIFF. However, the result has NaN in those regions.
> >> > I was hoping that the area containing NaNs would have been ignored
> >> 
> >> instead,
> >> 
> >> > in favor of proper values from the other file.
> >> > Is there any flag, properties or suggestions to make it working?
> >> > 
> >> > If I configure the reprojection tool to write NoData = -9999 and then
> >> 
> >> use
> >> 
> >> > gdalbuildvrt -srcnodata -9999, things are working fine.
> >> > So I'm just wondering if the same can be achieved dealing with NaN
> >> 
> >> instead
> >> 
> >> > of custom values.
> >> 
> >> Daniele,
> >> 
> >> You didn't mention which GDAL version you use. It is possible that
> >> support for
> >> NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed at some
> >> point.
> >> From a quick test with trunk, it works  (works with 1.11 branch as
> >> well):
> >> 
> >> $ cat in1.asc
> >> ncols        3
> >> nrows        3
> >> xllcorner    440720.000000000000
> >> yllcorner    3750120.000000000000
> >> cellsize     60.000000000000
> >> NODATA_value    nan
> >> 
> >>  1.0 1.0 1.0
> >>  1.0 nan 1.0
> >>  1.0 1.0 1.0
> >> 
> >> $ cat in2.asc
> >> ncols        3
> >> nrows        3
> >> xllcorner    440720.000000000000
> >> yllcorner    3750120.000000000000
> >> cellsize     60.000000000000
> >> NODATA_value    nan
> >> 
> >>  nan nan nan
> >>  nan 2.0 nan
> >>  nan nan nan
> >> 
> >> $ gdalbuildvrt nan.vrt in1.asc in2.asc
> >> 
> >> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
> >> ncols        3
> >> nrows        3
> >> xllcorner    440720.000000000000
> >> yllcorner    3750120.000000000000
> >> cellsize     60.000000000000
> >> NODATA_value    nan
> >> 
> >>       1      1      1
> >>       1      2      1
> >>       1      1      1
> >> 
> >> Even
> >> 
> >> --
> >> Spatialys - Geospatial professional services
> >> http://www.spatialys.com
> > 
> > --
> > ==
> > GeoServer Professional Services from the experts! Visit
> > http://goo.gl/it488V for more information.
> > ==
> > 
> > Ing. Daniele Romagnoli
> > Senior Software Engineer
> > 
> > GeoSolutions S.A.S.
> > Via di Montramito 3/A
> > 55054  Massarosa (LU)
> > Italy
> > phone: +39 0584 962313
> > fax:      +39 0584 1660272
> > 
> > http://www.geo-solutions.it
> > http://twitter.com/geosolutions_it
> > 
> > -------------------------------------------------------
> > 
> > *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
> > 
> > Le informazioni contenute in questo messaggio di posta elettronica e/o
> > nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
> > loro utilizzo è consentito esclusivamente al destinatario del messaggio,
> > per le finalità indicate nel messaggio stesso. Qualora riceviate questo
> > messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
> > darcene notizia via e-mail e di procedere alla distruzione del messaggio
> > stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
> > divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
> > utilizzarlo per finalità diverse, costituisce comportamento contrario ai
> > principi dettati dal D.Lgs. 196/2003.
> > 
> > 
> > 
> > The information in this message and/or attachments, is intended solely
> > for the attention and use of the named addressee(s) and may be
> > confidential or proprietary in nature or covered by the provisions of
> > privacy act (Legislative Decree June, 30 2003, no.196 - Italy's New Data
> > Protection Code).Any use not in accord with its purpose, any disclosure,
> > reproduction, copying, distribution, or either dissemination, either
> > whole or partial, is strictly forbidden except previous formal approval
> > of the named
> > addressee(s). If you are not the intended recipient, please contact
> > immediately the sender by telephone, fax or e-mail and delete the
> > information in this message that has been received in error. The sender
> > does not give any warranty or accept liability as the content, accuracy
> > or completeness of sent messages and accepts no responsibility  for
> > changes made after they were sent or for other risks which arise as a
> > result of e-mail transmission, viruses, etc.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon May  2 06:29:25 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 15:29:25 +0200
Subject: [gdal-dev] Questions about MBTiles write support @ GDAL 2.1 RC4
In-Reply-To: <1462194714087-5263915.post@n6.nabble.com>
References: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
 <201605021339.29551.even.rouault@spatialys.com>
 <1462194714087-5263915.post@n6.nabble.com>
Message-ID: <201605021529.25458.even.rouault@spatialys.com>

Le lundi 02 mai 2016 15:11:54, gunnarblom a écrit :
> Even Rouault-2 wrote
> 
> > Ah ok, you can generate overviews/zoom layers with gdaladdo /
> > GDALBuildOverviews().
> 
> I tried using GDALBuildOverviews() but it generates a separate .ovr file
> and does not include it in the MBTiles file, right?

Open the dataset in update mode to get proper internal overviews in lower zoom 
levels.

> 
> If I'm looking at the code, it seems like it is checking that the database
> isn't in read-only mode, but it never writes the actual overview/zoom
> layers to the MBTiles database? What is going on there?

It does, indirectly through GDALRegenerateOverviewsMultiBand() that will 
trigger the IWriteBlock() method.

> 
> 
> 
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/gdal-dev-Questions-about-MBTiles-write
> -support-GDAL-2-1-RC4-tp5263684p5263915.html Sent from the GDAL - Dev
> mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From daniele.romagnoli at geo-solutions.it  Mon May  2 06:37:58 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 2 May 2016 15:37:58 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <201605021527.10641.even.rouault@spatialys.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <CAJaHrDxAmFfPwdK04Dx0N=-BiP-vu-d880MtEm0o8Dv3CWLeqw@mail.gmail.com>
 <CAJaHrDzHZ1y0GfHa-gEGcctOXFpxvENrL72v9opbJr3rccqVaQ@mail.gmail.com>
 <201605021527.10641.even.rouault@spatialys.com>
Message-ID: <CAJaHrDy41Vba=eLpV73PU=4POrwq_-H5U-1QhW8jJhR0Lb2qTQ@mail.gmail.com>

On Mon, May 2, 2016 at 3:27 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le lundi 02 mai 2016 15:16:30, Daniele Romagnoli a écrit :
> > Hi Even,
> > The produced GeoTIFF doesn't contain any nodata metadata/flag/TAG.
> > It simply has "NaN" pixels. QuantumGIS report those pixels as "nan" and
> > OpenEV report them as 1.#QNAN so I think they are properly "recognized"
> as
> > NaN.
> >
> > I'm wondering if the GDAL utilities explicitly look for some
> metadata/flag
> > (as the "nodata value" in your previous ascii based sample) to do noData
> > checks or if it's also able to recognize a NaN "binary" value inside the
> > pixels.
>
> Yes, the NaN value must be explicitly set as the nodata property of the
> geotiff
> file so that gdalbuildvrt can recognize it as the nodata value (similarly
> to
> other nodata value)
>
> You can do this with gdal_translate -a_nodata nan (or gdal_edit.py
> -a_nodata
> nan)
>

Ok. Thanks.
I was trying to add it with "gdalbuildvrt -srcnodata nan" to avoid an
intermediate step between my geotiff and the VRT but I was getting:
ERROR 5: Invalid -srcnodata value

Therefore, I had to edit the VRT by replacing the
<ComplexSource><NODATA>-9999</NODATA></ComplexSource> with "nan" instead of
"-9999".
Do you know if there is any chance to let the -srcnodata parameter accept a
String like "nan"?

Cheers,
Daniele



> >
> > What do you think about it?
> > Cheers,
> > Daniele
> >
> > On Mon, May 2, 2016 at 2:52 PM, Daniele Romagnoli <
> >
> > daniele.romagnoli at geo-solutions.it> wrote:
> > > Hi Even.
> > > Thanks for the feedback.
> > >
> > > Sorry... I'm using GDAL 1.11.3.
> > > I'm going to double check to make sure I didn't make any mistake.
> > > I'll let you know.
> > >
> > > Cheers,
> > > Daniele
> > >
> > >
> > >
> > > On Mon, May 2, 2016 at 2:49 PM, Even Rouault <
> even.rouault at spatialys.com>
> > >
> > > wrote:
> > >> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> > >> > Hi List,
> > >> >
> > >> > I have a reprojectiion tool which creates GeoTIFFs with NoData =
> NaN.
> > >> > I'm creating couple of GeoTIFFs with partially overlapping areas
> where
> > >> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in the
> > >> > same overlapping region and viceversa (GeoTIFF2 has some NaN area
> > >> > while
> > >>
> > >> GeoTIFF1
> > >>
> > >> > has valid pixels for same area).
> > >> > I have built a VRT on top of them and then translated into a single
> > >> > GeoTIFF. However, the result has NaN in those regions.
> > >> > I was hoping that the area containing NaNs would have been ignored
> > >>
> > >> instead,
> > >>
> > >> > in favor of proper values from the other file.
> > >> > Is there any flag, properties or suggestions to make it working?
> > >> >
> > >> > If I configure the reprojection tool to write NoData = -9999 and
> then
> > >>
> > >> use
> > >>
> > >> > gdalbuildvrt -srcnodata -9999, things are working fine.
> > >> > So I'm just wondering if the same can be achieved dealing with NaN
> > >>
> > >> instead
> > >>
> > >> > of custom values.
> > >>
> > >> Daniele,
> > >>
> > >> You didn't mention which GDAL version you use. It is possible that
> > >> support for
> > >> NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed at
> some
> > >> point.
> > >> From a quick test with trunk, it works  (works with 1.11 branch as
> > >> well):
> > >>
> > >> $ cat in1.asc
> > >> ncols        3
> > >> nrows        3
> > >> xllcorner    440720.000000000000
> > >> yllcorner    3750120.000000000000
> > >> cellsize     60.000000000000
> > >> NODATA_value    nan
> > >>
> > >>  1.0 1.0 1.0
> > >>  1.0 nan 1.0
> > >>  1.0 1.0 1.0
> > >>
> > >> $ cat in2.asc
> > >> ncols        3
> > >> nrows        3
> > >> xllcorner    440720.000000000000
> > >> yllcorner    3750120.000000000000
> > >> cellsize     60.000000000000
> > >> NODATA_value    nan
> > >>
> > >>  nan nan nan
> > >>  nan 2.0 nan
> > >>  nan nan nan
> > >>
> > >> $ gdalbuildvrt nan.vrt in1.asc in2.asc
> > >>
> > >> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
> > >> ncols        3
> > >> nrows        3
> > >> xllcorner    440720.000000000000
> > >> yllcorner    3750120.000000000000
> > >> cellsize     60.000000000000
> > >> NODATA_value    nan
> > >>
> > >>       1      1      1
> > >>       1      2      1
> > >>       1      1      1
> > >>
> > >> Even
> > >>
> > >> --
> > >> Spatialys - Geospatial professional services
> > >> http://www.spatialys.com
> > >
> > > --
> > > ==
> > > GeoServer Professional Services from the experts! Visit
> > > http://goo.gl/it488V for more information.
> > > ==
> > >
> > > Ing. Daniele Romagnoli
> > > Senior Software Engineer
> > >
> > > GeoSolutions S.A.S.
> > > Via di Montramito 3/A
> > > 55054  Massarosa (LU)
> > > Italy
> > > phone: +39 0584 962313
> > > fax:      +39 0584 1660272
> > >
> > > http://www.geo-solutions.it
> > > http://twitter.com/geosolutions_it
> > >
> > > -------------------------------------------------------
> > >
> > > *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
> > >
> > > Le informazioni contenute in questo messaggio di posta elettronica e/o
> > > nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
> > > loro utilizzo è consentito esclusivamente al destinatario del
> messaggio,
> > > per le finalità indicate nel messaggio stesso. Qualora riceviate questo
> > > messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
> > > darcene notizia via e-mail e di procedere alla distruzione del
> messaggio
> > > stesso, cancellandolo dal Vostro sistema. Conservare il messaggio
> stesso,
> > > divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
> > > utilizzarlo per finalità diverse, costituisce comportamento contrario
> ai
> > > principi dettati dal D.Lgs. 196/2003.
> > >
> > >
> > >
> > > The information in this message and/or attachments, is intended solely
> > > for the attention and use of the named addressee(s) and may be
> > > confidential or proprietary in nature or covered by the provisions of
> > > privacy act (Legislative Decree June, 30 2003, no.196 - Italy's New
> Data
> > > Protection Code).Any use not in accord with its purpose, any
> disclosure,
> > > reproduction, copying, distribution, or either dissemination, either
> > > whole or partial, is strictly forbidden except previous formal approval
> > > of the named
> > > addressee(s). If you are not the intended recipient, please contact
> > > immediately the sender by telephone, fax or e-mail and delete the
> > > information in this message that has been received in error. The sender
> > > does not give any warranty or accept liability as the content, accuracy
> > > or completeness of sent messages and accepts no responsibility  for
> > > changes made after they were sent or for other risks which arise as a
> > > result of e-mail transmission, viruses, etc.
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/798a71e9/attachment.html>

From even.rouault at spatialys.com  Mon May  2 06:42:24 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 15:42:24 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <CAJaHrDy41Vba=eLpV73PU=4POrwq_-H5U-1QhW8jJhR0Lb2qTQ@mail.gmail.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <201605021527.10641.even.rouault@spatialys.com>
 <CAJaHrDy41Vba=eLpV73PU=4POrwq_-H5U-1QhW8jJhR0Lb2qTQ@mail.gmail.com>
Message-ID: <201605021542.24288.even.rouault@spatialys.com>

Le lundi 02 mai 2016 15:37:58, Daniele Romagnoli a écrit :
> On Mon, May 2, 2016 at 3:27 PM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > Le lundi 02 mai 2016 15:16:30, Daniele Romagnoli a écrit :
> > > Hi Even,
> > > The produced GeoTIFF doesn't contain any nodata metadata/flag/TAG.
> > > It simply has "NaN" pixels. QuantumGIS report those pixels as "nan" and
> > > OpenEV report them as 1.#QNAN so I think they are properly "recognized"
> > 
> > as
> > 
> > > NaN.
> > > 
> > > I'm wondering if the GDAL utilities explicitly look for some
> > 
> > metadata/flag
> > 
> > > (as the "nodata value" in your previous ascii based sample) to do
> > > noData checks or if it's also able to recognize a NaN "binary" value
> > > inside the pixels.
> > 
> > Yes, the NaN value must be explicitly set as the nodata property of the
> > geotiff
> > file so that gdalbuildvrt can recognize it as the nodata value (similarly
> > to
> > other nodata value)
> > 
> > You can do this with gdal_translate -a_nodata nan (or gdal_edit.py
> > -a_nodata
> > nan)
> 
> Ok. Thanks.
> I was trying to add it with "gdalbuildvrt -srcnodata nan" to avoid an
> intermediate step between my geotiff and the VRT but I was getting:
> ERROR 5: Invalid -srcnodata value
> 
> Therefore, I had to edit the VRT by replacing the
> <ComplexSource><NODATA>-9999</NODATA></ComplexSource> with "nan" instead of
> "-9999".
> Do you know if there is any chance to let the -srcnodata parameter accept a
> String like "nan"?

Yes, this is available in the fresh new 2.1.0:
 * gdalbuildvrt: accept nan as value for -srcnodata and -vrtnodata


> 
> Cheers,
> Daniele
> 
> > > What do you think about it?
> > > Cheers,
> > > Daniele
> > > 
> > > On Mon, May 2, 2016 at 2:52 PM, Daniele Romagnoli <
> > > 
> > > daniele.romagnoli at geo-solutions.it> wrote:
> > > > Hi Even.
> > > > Thanks for the feedback.
> > > > 
> > > > Sorry... I'm using GDAL 1.11.3.
> > > > I'm going to double check to make sure I didn't make any mistake.
> > > > I'll let you know.
> > > > 
> > > > Cheers,
> > > > Daniele
> > > > 
> > > > 
> > > > 
> > > > On Mon, May 2, 2016 at 2:49 PM, Even Rouault <
> > 
> > even.rouault at spatialys.com>
> > 
> > > > wrote:
> > > >> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> > > >> > Hi List,
> > > >> > 
> > > >> > I have a reprojectiion tool which creates GeoTIFFs with NoData =
> > 
> > NaN.
> > 
> > > >> > I'm creating couple of GeoTIFFs with partially overlapping areas
> > 
> > where
> > 
> > > >> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in
> > > >> > the same overlapping region and viceversa (GeoTIFF2 has some NaN
> > > >> > area while
> > > >> 
> > > >> GeoTIFF1
> > > >> 
> > > >> > has valid pixels for same area).
> > > >> > I have built a VRT on top of them and then translated into a
> > > >> > single GeoTIFF. However, the result has NaN in those regions.
> > > >> > I was hoping that the area containing NaNs would have been ignored
> > > >> 
> > > >> instead,
> > > >> 
> > > >> > in favor of proper values from the other file.
> > > >> > Is there any flag, properties or suggestions to make it working?
> > > >> > 
> > > >> > If I configure the reprojection tool to write NoData = -9999 and
> > 
> > then
> > 
> > > >> use
> > > >> 
> > > >> > gdalbuildvrt -srcnodata -9999, things are working fine.
> > > >> > So I'm just wondering if the same can be achieved dealing with NaN
> > > >> 
> > > >> instead
> > > >> 
> > > >> > of custom values.
> > > >> 
> > > >> Daniele,
> > > >> 
> > > >> You didn't mention which GDAL version you use. It is possible that
> > > >> support for
> > > >> NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed at
> > 
> > some
> > 
> > > >> point.
> > > >> From a quick test with trunk, it works  (works with 1.11 branch as
> > > >> well):
> > > >> 
> > > >> $ cat in1.asc
> > > >> ncols        3
> > > >> nrows        3
> > > >> xllcorner    440720.000000000000
> > > >> yllcorner    3750120.000000000000
> > > >> cellsize     60.000000000000
> > > >> NODATA_value    nan
> > > >> 
> > > >>  1.0 1.0 1.0
> > > >>  1.0 nan 1.0
> > > >>  1.0 1.0 1.0
> > > >> 
> > > >> $ cat in2.asc
> > > >> ncols        3
> > > >> nrows        3
> > > >> xllcorner    440720.000000000000
> > > >> yllcorner    3750120.000000000000
> > > >> cellsize     60.000000000000
> > > >> NODATA_value    nan
> > > >> 
> > > >>  nan nan nan
> > > >>  nan 2.0 nan
> > > >>  nan nan nan
> > > >> 
> > > >> $ gdalbuildvrt nan.vrt in1.asc in2.asc
> > > >> 
> > > >> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
> > > >> ncols        3
> > > >> nrows        3
> > > >> xllcorner    440720.000000000000
> > > >> yllcorner    3750120.000000000000
> > > >> cellsize     60.000000000000
> > > >> NODATA_value    nan
> > > >> 
> > > >>       1      1      1
> > > >>       1      2      1
> > > >>       1      1      1
> > > >> 
> > > >> Even
> > > >> 
> > > >> --
> > > >> Spatialys - Geospatial professional services
> > > >> http://www.spatialys.com
> > > > 
> > > > --
> > > > ==
> > > > GeoServer Professional Services from the experts! Visit
> > > > http://goo.gl/it488V for more information.
> > > > ==
> > > > 
> > > > Ing. Daniele Romagnoli
> > > > Senior Software Engineer
> > > > 
> > > > GeoSolutions S.A.S.
> > > > Via di Montramito 3/A
> > > > 55054  Massarosa (LU)
> > > > Italy
> > > > phone: +39 0584 962313
> > > > fax:      +39 0584 1660272
> > > > 
> > > > http://www.geo-solutions.it
> > > > http://twitter.com/geosolutions_it
> > > > 
> > > > -------------------------------------------------------
> > > > 
> > > > *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
> > > > 
> > > > Le informazioni contenute in questo messaggio di posta elettronica
> > > > e/o nel/i file/s allegato/i sono da considerarsi strettamente
> > > > riservate. Il loro utilizzo è consentito esclusivamente al
> > > > destinatario del
> > 
> > messaggio,
> > 
> > > > per le finalità indicate nel messaggio stesso. Qualora riceviate
> > > > questo messaggio senza esserne il destinatario, Vi preghiamo
> > > > cortesemente di darcene notizia via e-mail e di procedere alla
> > > > distruzione del
> > 
> > messaggio
> > 
> > > > stesso, cancellandolo dal Vostro sistema. Conservare il messaggio
> > 
> > stesso,
> > 
> > > > divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo,
> > > > od utilizzarlo per finalità diverse, costituisce comportamento
> > > > contrario
> > 
> > ai
> > 
> > > > principi dettati dal D.Lgs. 196/2003.
> > > > 
> > > > 
> > > > 
> > > > The information in this message and/or attachments, is intended
> > > > solely for the attention and use of the named addressee(s) and may
> > > > be confidential or proprietary in nature or covered by the
> > > > provisions of privacy act (Legislative Decree June, 30 2003, no.196
> > > > - Italy's New
> > 
> > Data
> > 
> > > > Protection Code).Any use not in accord with its purpose, any
> > 
> > disclosure,
> > 
> > > > reproduction, copying, distribution, or either dissemination, either
> > > > whole or partial, is strictly forbidden except previous formal
> > > > approval of the named
> > > > addressee(s). If you are not the intended recipient, please contact
> > > > immediately the sender by telephone, fax or e-mail and delete the
> > > > information in this message that has been received in error. The
> > > > sender does not give any warranty or accept liability as the
> > > > content, accuracy or completeness of sent messages and accepts no
> > > > responsibility  for changes made after they were sent or for other
> > > > risks which arise as a result of e-mail transmission, viruses, etc.
> > 
> > --
> > Spatialys - Geospatial professional services
> > http://www.spatialys.com

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From daniele.romagnoli at geo-solutions.it  Mon May  2 06:43:42 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 2 May 2016 15:43:42 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <201605021542.24288.even.rouault@spatialys.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <201605021527.10641.even.rouault@spatialys.com>
 <CAJaHrDy41Vba=eLpV73PU=4POrwq_-H5U-1QhW8jJhR0Lb2qTQ@mail.gmail.com>
 <201605021542.24288.even.rouault@spatialys.com>
Message-ID: <CAJaHrDxX10JuiAp_K8b0NuvLCfU1Dy0sts5B9Djtjge1d4PKzw@mail.gmail.com>

Cool!
Do you think this capability will be backported to 1.11 series too?

Thanks for your assistance.
Cheers,
Daniele

On Mon, May 2, 2016 at 3:42 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le lundi 02 mai 2016 15:37:58, Daniele Romagnoli a écrit :
> > On Mon, May 2, 2016 at 3:27 PM, Even Rouault <even.rouault at spatialys.com
> >
> >
> > wrote:
> > > Le lundi 02 mai 2016 15:16:30, Daniele Romagnoli a écrit :
> > > > Hi Even,
> > > > The produced GeoTIFF doesn't contain any nodata metadata/flag/TAG.
> > > > It simply has "NaN" pixels. QuantumGIS report those pixels as "nan"
> and
> > > > OpenEV report them as 1.#QNAN so I think they are properly
> "recognized"
> > >
> > > as
> > >
> > > > NaN.
> > > >
> > > > I'm wondering if the GDAL utilities explicitly look for some
> > >
> > > metadata/flag
> > >
> > > > (as the "nodata value" in your previous ascii based sample) to do
> > > > noData checks or if it's also able to recognize a NaN "binary" value
> > > > inside the pixels.
> > >
> > > Yes, the NaN value must be explicitly set as the nodata property of the
> > > geotiff
> > > file so that gdalbuildvrt can recognize it as the nodata value
> (similarly
> > > to
> > > other nodata value)
> > >
> > > You can do this with gdal_translate -a_nodata nan (or gdal_edit.py
> > > -a_nodata
> > > nan)
> >
> > Ok. Thanks.
> > I was trying to add it with "gdalbuildvrt -srcnodata nan" to avoid an
> > intermediate step between my geotiff and the VRT but I was getting:
> > ERROR 5: Invalid -srcnodata value
> >
> > Therefore, I had to edit the VRT by replacing the
> > <ComplexSource><NODATA>-9999</NODATA></ComplexSource> with "nan" instead
> of
> > "-9999".
> > Do you know if there is any chance to let the -srcnodata parameter
> accept a
> > String like "nan"?
>
> Yes, this is available in the fresh new 2.1.0:
>  * gdalbuildvrt: accept nan as value for -srcnodata and -vrtnodata
>
>
> >
> > Cheers,
> > Daniele
> >
> > > > What do you think about it?
> > > > Cheers,
> > > > Daniele
> > > >
> > > > On Mon, May 2, 2016 at 2:52 PM, Daniele Romagnoli <
> > > >
> > > > daniele.romagnoli at geo-solutions.it> wrote:
> > > > > Hi Even.
> > > > > Thanks for the feedback.
> > > > >
> > > > > Sorry... I'm using GDAL 1.11.3.
> > > > > I'm going to double check to make sure I didn't make any mistake.
> > > > > I'll let you know.
> > > > >
> > > > > Cheers,
> > > > > Daniele
> > > > >
> > > > >
> > > > >
> > > > > On Mon, May 2, 2016 at 2:49 PM, Even Rouault <
> > >
> > > even.rouault at spatialys.com>
> > >
> > > > > wrote:
> > > > >> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> > > > >> > Hi List,
> > > > >> >
> > > > >> > I have a reprojectiion tool which creates GeoTIFFs with NoData =
> > >
> > > NaN.
> > >
> > > > >> > I'm creating couple of GeoTIFFs with partially overlapping areas
> > >
> > > where
> > >
> > > > >> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values in
> > > > >> > the same overlapping region and viceversa (GeoTIFF2 has some NaN
> > > > >> > area while
> > > > >>
> > > > >> GeoTIFF1
> > > > >>
> > > > >> > has valid pixels for same area).
> > > > >> > I have built a VRT on top of them and then translated into a
> > > > >> > single GeoTIFF. However, the result has NaN in those regions.
> > > > >> > I was hoping that the area containing NaNs would have been
> ignored
> > > > >>
> > > > >> instead,
> > > > >>
> > > > >> > in favor of proper values from the other file.
> > > > >> > Is there any flag, properties or suggestions to make it working?
> > > > >> >
> > > > >> > If I configure the reprojection tool to write NoData = -9999 and
> > >
> > > then
> > >
> > > > >> use
> > > > >>
> > > > >> > gdalbuildvrt -srcnodata -9999, things are working fine.
> > > > >> > So I'm just wondering if the same can be achieved dealing with
> NaN
> > > > >>
> > > > >> instead
> > > > >>
> > > > >> > of custom values.
> > > > >>
> > > > >> Daniele,
> > > > >>
> > > > >> You didn't mention which GDAL version you use. It is possible that
> > > > >> support for
> > > > >> NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed
> at
> > >
> > > some
> > >
> > > > >> point.
> > > > >> From a quick test with trunk, it works  (works with 1.11 branch as
> > > > >> well):
> > > > >>
> > > > >> $ cat in1.asc
> > > > >> ncols        3
> > > > >> nrows        3
> > > > >> xllcorner    440720.000000000000
> > > > >> yllcorner    3750120.000000000000
> > > > >> cellsize     60.000000000000
> > > > >> NODATA_value    nan
> > > > >>
> > > > >>  1.0 1.0 1.0
> > > > >>  1.0 nan 1.0
> > > > >>  1.0 1.0 1.0
> > > > >>
> > > > >> $ cat in2.asc
> > > > >> ncols        3
> > > > >> nrows        3
> > > > >> xllcorner    440720.000000000000
> > > > >> yllcorner    3750120.000000000000
> > > > >> cellsize     60.000000000000
> > > > >> NODATA_value    nan
> > > > >>
> > > > >>  nan nan nan
> > > > >>  nan 2.0 nan
> > > > >>  nan nan nan
> > > > >>
> > > > >> $ gdalbuildvrt nan.vrt in1.asc in2.asc
> > > > >>
> > > > >> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
> > > > >> ncols        3
> > > > >> nrows        3
> > > > >> xllcorner    440720.000000000000
> > > > >> yllcorner    3750120.000000000000
> > > > >> cellsize     60.000000000000
> > > > >> NODATA_value    nan
> > > > >>
> > > > >>       1      1      1
> > > > >>       1      2      1
> > > > >>       1      1      1
> > > > >>
> > > > >> Even
> > > > >>
> > > > >> --
> > > > >> Spatialys - Geospatial professional services
> > > > >> http://www.spatialys.com
> > > > >
> > > > > --
> > > > > ==
> > > > > GeoServer Professional Services from the experts! Visit
> > > > > http://goo.gl/it488V for more information.
> > > > > ==
> > > > >
> > > > > Ing. Daniele Romagnoli
> > > > > Senior Software Engineer
> > > > >
> > > > > GeoSolutions S.A.S.
> > > > > Via di Montramito 3/A
> > > > > 55054  Massarosa (LU)
> > > > > Italy
> > > > > phone: +39 0584 962313
> > > > > fax:      +39 0584 1660272
> > > > >
> > > > > http://www.geo-solutions.it
> > > > > http://twitter.com/geosolutions_it
> > > > >
> > > > > -------------------------------------------------------
> > > > >
> > > > > *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
> > > > >
> > > > > Le informazioni contenute in questo messaggio di posta elettronica
> > > > > e/o nel/i file/s allegato/i sono da considerarsi strettamente
> > > > > riservate. Il loro utilizzo è consentito esclusivamente al
> > > > > destinatario del
> > >
> > > messaggio,
> > >
> > > > > per le finalità indicate nel messaggio stesso. Qualora riceviate
> > > > > questo messaggio senza esserne il destinatario, Vi preghiamo
> > > > > cortesemente di darcene notizia via e-mail e di procedere alla
> > > > > distruzione del
> > >
> > > messaggio
> > >
> > > > > stesso, cancellandolo dal Vostro sistema. Conservare il messaggio
> > >
> > > stesso,
> > >
> > > > > divulgarlo anche in parte, distribuirlo ad altri soggetti,
> copiarlo,
> > > > > od utilizzarlo per finalità diverse, costituisce comportamento
> > > > > contrario
> > >
> > > ai
> > >
> > > > > principi dettati dal D.Lgs. 196/2003.
> > > > >
> > > > >
> > > > >
> > > > > The information in this message and/or attachments, is intended
> > > > > solely for the attention and use of the named addressee(s) and may
> > > > > be confidential or proprietary in nature or covered by the
> > > > > provisions of privacy act (Legislative Decree June, 30 2003, no.196
> > > > > - Italy's New
> > >
> > > Data
> > >
> > > > > Protection Code).Any use not in accord with its purpose, any
> > >
> > > disclosure,
> > >
> > > > > reproduction, copying, distribution, or either dissemination,
> either
> > > > > whole or partial, is strictly forbidden except previous formal
> > > > > approval of the named
> > > > > addressee(s). If you are not the intended recipient, please contact
> > > > > immediately the sender by telephone, fax or e-mail and delete the
> > > > > information in this message that has been received in error. The
> > > > > sender does not give any warranty or accept liability as the
> > > > > content, accuracy or completeness of sent messages and accepts no
> > > > > responsibility  for changes made after they were sent or for other
> > > > > risks which arise as a result of e-mail transmission, viruses, etc.
> > >
> > > --
> > > Spatialys - Geospatial professional services
> > > http://www.spatialys.com
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/95832402/attachment-0001.html>

From even.rouault at spatialys.com  Mon May  2 06:58:45 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 May 2016 15:58:45 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <CAJaHrDxX10JuiAp_K8b0NuvLCfU1Dy0sts5B9Djtjge1d4PKzw@mail.gmail.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <201605021542.24288.even.rouault@spatialys.com>
 <CAJaHrDxX10JuiAp_K8b0NuvLCfU1Dy0sts5B9Djtjge1d4PKzw@mail.gmail.com>
Message-ID: <201605021558.45571.even.rouault@spatialys.com>

Le lundi 02 mai 2016 15:43:42, Daniele Romagnoli a écrit :
> Cool!
> Do you think this capability will be backported to 1.11 series too?

Possibly if you file a ticket about that.

> 
> Thanks for your assistance.
> Cheers,
> Daniele
> 
> On Mon, May 2, 2016 at 3:42 PM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > Le lundi 02 mai 2016 15:37:58, Daniele Romagnoli a écrit :
> > > On Mon, May 2, 2016 at 3:27 PM, Even Rouault
> > > <even.rouault at spatialys.com
> > > 
> > > wrote:
> > > > Le lundi 02 mai 2016 15:16:30, Daniele Romagnoli a écrit :
> > > > > Hi Even,
> > > > > The produced GeoTIFF doesn't contain any nodata metadata/flag/TAG.
> > > > > It simply has "NaN" pixels. QuantumGIS report those pixels as "nan"
> > 
> > and
> > 
> > > > > OpenEV report them as 1.#QNAN so I think they are properly
> > 
> > "recognized"
> > 
> > > > as
> > > > 
> > > > > NaN.
> > > > > 
> > > > > I'm wondering if the GDAL utilities explicitly look for some
> > > > 
> > > > metadata/flag
> > > > 
> > > > > (as the "nodata value" in your previous ascii based sample) to do
> > > > > noData checks or if it's also able to recognize a NaN "binary"
> > > > > value inside the pixels.
> > > > 
> > > > Yes, the NaN value must be explicitly set as the nodata property of
> > > > the geotiff
> > > > file so that gdalbuildvrt can recognize it as the nodata value
> > 
> > (similarly
> > 
> > > > to
> > > > other nodata value)
> > > > 
> > > > You can do this with gdal_translate -a_nodata nan (or gdal_edit.py
> > > > -a_nodata
> > > > nan)
> > > 
> > > Ok. Thanks.
> > > I was trying to add it with "gdalbuildvrt -srcnodata nan" to avoid an
> > > intermediate step between my geotiff and the VRT but I was getting:
> > > ERROR 5: Invalid -srcnodata value
> > > 
> > > Therefore, I had to edit the VRT by replacing the
> > > <ComplexSource><NODATA>-9999</NODATA></ComplexSource> with "nan"
> > > instead
> > 
> > of
> > 
> > > "-9999".
> > > Do you know if there is any chance to let the -srcnodata parameter
> > 
> > accept a
> > 
> > > String like "nan"?
> > 
> > Yes, this is available in the fresh new 2.1.0:
> >  * gdalbuildvrt: accept nan as value for -srcnodata and -vrtnodata
> >  
> > > Cheers,
> > > Daniele
> > > 
> > > > > What do you think about it?
> > > > > Cheers,
> > > > > Daniele
> > > > > 
> > > > > On Mon, May 2, 2016 at 2:52 PM, Daniele Romagnoli <
> > > > > 
> > > > > daniele.romagnoli at geo-solutions.it> wrote:
> > > > > > Hi Even.
> > > > > > Thanks for the feedback.
> > > > > > 
> > > > > > Sorry... I'm using GDAL 1.11.3.
> > > > > > I'm going to double check to make sure I didn't make any mistake.
> > > > > > I'll let you know.
> > > > > > 
> > > > > > Cheers,
> > > > > > Daniele
> > > > > > 
> > > > > > 
> > > > > > 
> > > > > > On Mon, May 2, 2016 at 2:49 PM, Even Rouault <
> > > > 
> > > > even.rouault at spatialys.com>
> > > > 
> > > > > > wrote:
> > > > > >> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> > > > > >> > Hi List,
> > > > > >> > 
> > > > > >> > I have a reprojectiion tool which creates GeoTIFFs with NoData
> > > > > >> > =
> > > > 
> > > > NaN.
> > > > 
> > > > > >> > I'm creating couple of GeoTIFFs with partially overlapping
> > > > > >> > areas
> > > > 
> > > > where
> > > > 
> > > > > >> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values
> > > > > >> > in the same overlapping region and viceversa (GeoTIFF2 has
> > > > > >> > some NaN area while
> > > > > >> 
> > > > > >> GeoTIFF1
> > > > > >> 
> > > > > >> > has valid pixels for same area).
> > > > > >> > I have built a VRT on top of them and then translated into a
> > > > > >> > single GeoTIFF. However, the result has NaN in those regions.
> > > > > >> > I was hoping that the area containing NaNs would have been
> > 
> > ignored
> > 
> > > > > >> instead,
> > > > > >> 
> > > > > >> > in favor of proper values from the other file.
> > > > > >> > Is there any flag, properties or suggestions to make it
> > > > > >> > working?
> > > > > >> > 
> > > > > >> > If I configure the reprojection tool to write NoData = -9999
> > > > > >> > and
> > > > 
> > > > then
> > > > 
> > > > > >> use
> > > > > >> 
> > > > > >> > gdalbuildvrt -srcnodata -9999, things are working fine.
> > > > > >> > So I'm just wondering if the same can be achieved dealing with
> > 
> > NaN
> > 
> > > > > >> instead
> > > > > >> 
> > > > > >> > of custom values.
> > > > > >> 
> > > > > >> Daniele,
> > > > > >> 
> > > > > >> You didn't mention which GDAL version you use. It is possible
> > > > > >> that support for
> > > > > >> NaN as a nodata value in gdalbuildvrt & the VRT driver was fixed
> > 
> > at
> > 
> > > > some
> > > > 
> > > > > >> point.
> > > > > >> From a quick test with trunk, it works  (works with 1.11 branch
> > > > > >> as well):
> > > > > >> 
> > > > > >> $ cat in1.asc
> > > > > >> ncols        3
> > > > > >> nrows        3
> > > > > >> xllcorner    440720.000000000000
> > > > > >> yllcorner    3750120.000000000000
> > > > > >> cellsize     60.000000000000
> > > > > >> NODATA_value    nan
> > > > > >> 
> > > > > >>  1.0 1.0 1.0
> > > > > >>  1.0 nan 1.0
> > > > > >>  1.0 1.0 1.0
> > > > > >> 
> > > > > >> $ cat in2.asc
> > > > > >> ncols        3
> > > > > >> nrows        3
> > > > > >> xllcorner    440720.000000000000
> > > > > >> yllcorner    3750120.000000000000
> > > > > >> cellsize     60.000000000000
> > > > > >> NODATA_value    nan
> > > > > >> 
> > > > > >>  nan nan nan
> > > > > >>  nan 2.0 nan
> > > > > >>  nan nan nan
> > > > > >> 
> > > > > >> $ gdalbuildvrt nan.vrt in1.asc in2.asc
> > > > > >> 
> > > > > >> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
> > > > > >> ncols        3
> > > > > >> nrows        3
> > > > > >> xllcorner    440720.000000000000
> > > > > >> yllcorner    3750120.000000000000
> > > > > >> cellsize     60.000000000000
> > > > > >> NODATA_value    nan
> > > > > >> 
> > > > > >>       1      1      1
> > > > > >>       1      2      1
> > > > > >>       1      1      1
> > > > > >> 
> > > > > >> Even
> > > > > >> 
> > > > > >> --
> > > > > >> Spatialys - Geospatial professional services
> > > > > >> http://www.spatialys.com
> > > > > > 
> > > > > > --
> > > > > > ==
> > > > > > GeoServer Professional Services from the experts! Visit
> > > > > > http://goo.gl/it488V for more information.
> > > > > > ==
> > > > > > 
> > > > > > Ing. Daniele Romagnoli
> > > > > > Senior Software Engineer
> > > > > > 
> > > > > > GeoSolutions S.A.S.
> > > > > > Via di Montramito 3/A
> > > > > > 55054  Massarosa (LU)
> > > > > > Italy
> > > > > > phone: +39 0584 962313
> > > > > > fax:      +39 0584 1660272
> > > > > > 
> > > > > > http://www.geo-solutions.it
> > > > > > http://twitter.com/geosolutions_it
> > > > > > 
> > > > > > -------------------------------------------------------
> > > > > > 
> > > > > > *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
> > > > > > 
> > > > > > Le informazioni contenute in questo messaggio di posta
> > > > > > elettronica e/o nel/i file/s allegato/i sono da considerarsi
> > > > > > strettamente riservate. Il loro utilizzo è consentito
> > > > > > esclusivamente al destinatario del
> > > > 
> > > > messaggio,
> > > > 
> > > > > > per le finalità indicate nel messaggio stesso. Qualora riceviate
> > > > > > questo messaggio senza esserne il destinatario, Vi preghiamo
> > > > > > cortesemente di darcene notizia via e-mail e di procedere alla
> > > > > > distruzione del
> > > > 
> > > > messaggio
> > > > 
> > > > > > stesso, cancellandolo dal Vostro sistema. Conservare il messaggio
> > > > 
> > > > stesso,
> > > > 
> > > > > > divulgarlo anche in parte, distribuirlo ad altri soggetti,
> > 
> > copiarlo,
> > 
> > > > > > od utilizzarlo per finalità diverse, costituisce comportamento
> > > > > > contrario
> > > > 
> > > > ai
> > > > 
> > > > > > principi dettati dal D.Lgs. 196/2003.
> > > > > > 
> > > > > > 
> > > > > > 
> > > > > > The information in this message and/or attachments, is intended
> > > > > > solely for the attention and use of the named addressee(s) and
> > > > > > may be confidential or proprietary in nature or covered by the
> > > > > > provisions of privacy act (Legislative Decree June, 30 2003,
> > > > > > no.196 - Italy's New
> > > > 
> > > > Data
> > > > 
> > > > > > Protection Code).Any use not in accord with its purpose, any
> > > > 
> > > > disclosure,
> > > > 
> > > > > > reproduction, copying, distribution, or either dissemination,
> > 
> > either
> > 
> > > > > > whole or partial, is strictly forbidden except previous formal
> > > > > > approval of the named
> > > > > > addressee(s). If you are not the intended recipient, please
> > > > > > contact immediately the sender by telephone, fax or e-mail and
> > > > > > delete the information in this message that has been received in
> > > > > > error. The sender does not give any warranty or accept liability
> > > > > > as the content, accuracy or completeness of sent messages and
> > > > > > accepts no responsibility  for changes made after they were sent
> > > > > > or for other risks which arise as a result of e-mail
> > > > > > transmission, viruses, etc.
> > > > 
> > > > --
> > > > Spatialys - Geospatial professional services
> > > > http://www.spatialys.com
> > 
> > --
> > Spatialys - Geospatial professional services
> > http://www.spatialys.com

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From daniele.romagnoli at geo-solutions.it  Mon May  2 08:07:47 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 2 May 2016 17:07:47 +0200
Subject: [gdal-dev] gdal_translate a VRT built on top of GeoTIFFs with
	NaN
In-Reply-To: <201605021558.45571.even.rouault@spatialys.com>
References: <CAJaHrDyp++RFyRW0Jg+7G_4UP-mW1ruHwHPXRs=AKSRTMW+v=g@mail.gmail.com>
 <201605021542.24288.even.rouault@spatialys.com>
 <CAJaHrDxX10JuiAp_K8b0NuvLCfU1Dy0sts5B9Djtjge1d4PKzw@mail.gmail.com>
 <201605021558.45571.even.rouault@spatialys.com>
Message-ID: <CAJaHrDyj1vVR71xmR82eAmT7r+BtF_RgKJiWBTdbBzVUxTjSeg@mail.gmail.com>

Thanks.
I have just opened this ticket keeping track of that:
https://trac.osgeo.org/gdal/ticket/6495#ticket

Cheers,
Daniele



On Mon, May 2, 2016 at 3:58 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le lundi 02 mai 2016 15:43:42, Daniele Romagnoli a écrit :
> > Cool!
> > Do you think this capability will be backported to 1.11 series too?
>
> Possibly if you file a ticket about that.
>
> >
> > Thanks for your assistance.
> > Cheers,
> > Daniele
> >
> > On Mon, May 2, 2016 at 3:42 PM, Even Rouault <even.rouault at spatialys.com
> >
> >
> > wrote:
> > > Le lundi 02 mai 2016 15:37:58, Daniele Romagnoli a écrit :
> > > > On Mon, May 2, 2016 at 3:27 PM, Even Rouault
> > > > <even.rouault at spatialys.com
> > > >
> > > > wrote:
> > > > > Le lundi 02 mai 2016 15:16:30, Daniele Romagnoli a écrit :
> > > > > > Hi Even,
> > > > > > The produced GeoTIFF doesn't contain any nodata
> metadata/flag/TAG.
> > > > > > It simply has "NaN" pixels. QuantumGIS report those pixels as
> "nan"
> > >
> > > and
> > >
> > > > > > OpenEV report them as 1.#QNAN so I think they are properly
> > >
> > > "recognized"
> > >
> > > > > as
> > > > >
> > > > > > NaN.
> > > > > >
> > > > > > I'm wondering if the GDAL utilities explicitly look for some
> > > > >
> > > > > metadata/flag
> > > > >
> > > > > > (as the "nodata value" in your previous ascii based sample) to do
> > > > > > noData checks or if it's also able to recognize a NaN "binary"
> > > > > > value inside the pixels.
> > > > >
> > > > > Yes, the NaN value must be explicitly set as the nodata property of
> > > > > the geotiff
> > > > > file so that gdalbuildvrt can recognize it as the nodata value
> > >
> > > (similarly
> > >
> > > > > to
> > > > > other nodata value)
> > > > >
> > > > > You can do this with gdal_translate -a_nodata nan (or gdal_edit.py
> > > > > -a_nodata
> > > > > nan)
> > > >
> > > > Ok. Thanks.
> > > > I was trying to add it with "gdalbuildvrt -srcnodata nan" to avoid an
> > > > intermediate step between my geotiff and the VRT but I was getting:
> > > > ERROR 5: Invalid -srcnodata value
> > > >
> > > > Therefore, I had to edit the VRT by replacing the
> > > > <ComplexSource><NODATA>-9999</NODATA></ComplexSource> with "nan"
> > > > instead
> > >
> > > of
> > >
> > > > "-9999".
> > > > Do you know if there is any chance to let the -srcnodata parameter
> > >
> > > accept a
> > >
> > > > String like "nan"?
> > >
> > > Yes, this is available in the fresh new 2.1.0:
> > >  * gdalbuildvrt: accept nan as value for -srcnodata and -vrtnodata
> > >
> > > > Cheers,
> > > > Daniele
> > > >
> > > > > > What do you think about it?
> > > > > > Cheers,
> > > > > > Daniele
> > > > > >
> > > > > > On Mon, May 2, 2016 at 2:52 PM, Daniele Romagnoli <
> > > > > >
> > > > > > daniele.romagnoli at geo-solutions.it> wrote:
> > > > > > > Hi Even.
> > > > > > > Thanks for the feedback.
> > > > > > >
> > > > > > > Sorry... I'm using GDAL 1.11.3.
> > > > > > > I'm going to double check to make sure I didn't make any
> mistake.
> > > > > > > I'll let you know.
> > > > > > >
> > > > > > > Cheers,
> > > > > > > Daniele
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > On Mon, May 2, 2016 at 2:49 PM, Even Rouault <
> > > > >
> > > > > even.rouault at spatialys.com>
> > > > >
> > > > > > > wrote:
> > > > > > >> Le lundi 02 mai 2016 14:37:39, Daniele Romagnoli a écrit :
> > > > > > >> > Hi List,
> > > > > > >> >
> > > > > > >> > I have a reprojectiion tool which creates GeoTIFFs with
> NoData
> > > > > > >> > =
> > > > >
> > > > > NaN.
> > > > >
> > > > > > >> > I'm creating couple of GeoTIFFs with partially overlapping
> > > > > > >> > areas
> > > > >
> > > > > where
> > > > >
> > > > > > >> > GeoTIFF1 has NaNs in a region and GeoTIFF2 has proper values
> > > > > > >> > in the same overlapping region and viceversa (GeoTIFF2 has
> > > > > > >> > some NaN area while
> > > > > > >>
> > > > > > >> GeoTIFF1
> > > > > > >>
> > > > > > >> > has valid pixels for same area).
> > > > > > >> > I have built a VRT on top of them and then translated into a
> > > > > > >> > single GeoTIFF. However, the result has NaN in those
> regions.
> > > > > > >> > I was hoping that the area containing NaNs would have been
> > >
> > > ignored
> > >
> > > > > > >> instead,
> > > > > > >>
> > > > > > >> > in favor of proper values from the other file.
> > > > > > >> > Is there any flag, properties or suggestions to make it
> > > > > > >> > working?
> > > > > > >> >
> > > > > > >> > If I configure the reprojection tool to write NoData = -9999
> > > > > > >> > and
> > > > >
> > > > > then
> > > > >
> > > > > > >> use
> > > > > > >>
> > > > > > >> > gdalbuildvrt -srcnodata -9999, things are working fine.
> > > > > > >> > So I'm just wondering if the same can be achieved dealing
> with
> > >
> > > NaN
> > >
> > > > > > >> instead
> > > > > > >>
> > > > > > >> > of custom values.
> > > > > > >>
> > > > > > >> Daniele,
> > > > > > >>
> > > > > > >> You didn't mention which GDAL version you use. It is possible
> > > > > > >> that support for
> > > > > > >> NaN as a nodata value in gdalbuildvrt & the VRT driver was
> fixed
> > >
> > > at
> > >
> > > > > some
> > > > >
> > > > > > >> point.
> > > > > > >> From a quick test with trunk, it works  (works with 1.11
> branch
> > > > > > >> as well):
> > > > > > >>
> > > > > > >> $ cat in1.asc
> > > > > > >> ncols        3
> > > > > > >> nrows        3
> > > > > > >> xllcorner    440720.000000000000
> > > > > > >> yllcorner    3750120.000000000000
> > > > > > >> cellsize     60.000000000000
> > > > > > >> NODATA_value    nan
> > > > > > >>
> > > > > > >>  1.0 1.0 1.0
> > > > > > >>  1.0 nan 1.0
> > > > > > >>  1.0 1.0 1.0
> > > > > > >>
> > > > > > >> $ cat in2.asc
> > > > > > >> ncols        3
> > > > > > >> nrows        3
> > > > > > >> xllcorner    440720.000000000000
> > > > > > >> yllcorner    3750120.000000000000
> > > > > > >> cellsize     60.000000000000
> > > > > > >> NODATA_value    nan
> > > > > > >>
> > > > > > >>  nan nan nan
> > > > > > >>  nan 2.0 nan
> > > > > > >>  nan nan nan
> > > > > > >>
> > > > > > >> $ gdalbuildvrt nan.vrt in1.asc in2.asc
> > > > > > >>
> > > > > > >> $ gdal_translate nan.vrt /vsistdout/ -of aaigrid
> > > > > > >> ncols        3
> > > > > > >> nrows        3
> > > > > > >> xllcorner    440720.000000000000
> > > > > > >> yllcorner    3750120.000000000000
> > > > > > >> cellsize     60.000000000000
> > > > > > >> NODATA_value    nan
> > > > > > >>
> > > > > > >>       1      1      1
> > > > > > >>       1      2      1
> > > > > > >>       1      1      1
> > > > > > >>
> > > > > > >> Even
> > > > > > >>
> > > > > > >> --
> > > > > > >> Spatialys - Geospatial professional services
> > > > > > >> http://www.spatialys.com
> > > > > > >
> > > > > > > --
> > > > > > > ==
> > > > > > > GeoServer Professional Services from the experts! Visit
> > > > > > > http://goo.gl/it488V for more information.
> > > > > > > ==
> > > > > > >
> > > > > > > Ing. Daniele Romagnoli
> > > > > > > Senior Software Engineer
> > > > > > >
> > > > > > > GeoSolutions S.A.S.
> > > > > > > Via di Montramito 3/A
> > > > > > > 55054  Massarosa (LU)
> > > > > > > Italy
> > > > > > > phone: +39 0584 962313
> > > > > > > fax:      +39 0584 1660272
> > > > > > >
> > > > > > > http://www.geo-solutions.it
> > > > > > > http://twitter.com/geosolutions_it
> > > > > > >
> > > > > > > -------------------------------------------------------
> > > > > > >
> > > > > > > *AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*
> > > > > > >
> > > > > > > Le informazioni contenute in questo messaggio di posta
> > > > > > > elettronica e/o nel/i file/s allegato/i sono da considerarsi
> > > > > > > strettamente riservate. Il loro utilizzo è consentito
> > > > > > > esclusivamente al destinatario del
> > > > >
> > > > > messaggio,
> > > > >
> > > > > > > per le finalità indicate nel messaggio stesso. Qualora
> riceviate
> > > > > > > questo messaggio senza esserne il destinatario, Vi preghiamo
> > > > > > > cortesemente di darcene notizia via e-mail e di procedere alla
> > > > > > > distruzione del
> > > > >
> > > > > messaggio
> > > > >
> > > > > > > stesso, cancellandolo dal Vostro sistema. Conservare il
> messaggio
> > > > >
> > > > > stesso,
> > > > >
> > > > > > > divulgarlo anche in parte, distribuirlo ad altri soggetti,
> > >
> > > copiarlo,
> > >
> > > > > > > od utilizzarlo per finalità diverse, costituisce comportamento
> > > > > > > contrario
> > > > >
> > > > > ai
> > > > >
> > > > > > > principi dettati dal D.Lgs. 196/2003.
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > The information in this message and/or attachments, is intended
> > > > > > > solely for the attention and use of the named addressee(s) and
> > > > > > > may be confidential or proprietary in nature or covered by the
> > > > > > > provisions of privacy act (Legislative Decree June, 30 2003,
> > > > > > > no.196 - Italy's New
> > > > >
> > > > > Data
> > > > >
> > > > > > > Protection Code).Any use not in accord with its purpose, any
> > > > >
> > > > > disclosure,
> > > > >
> > > > > > > reproduction, copying, distribution, or either dissemination,
> > >
> > > either
> > >
> > > > > > > whole or partial, is strictly forbidden except previous formal
> > > > > > > approval of the named
> > > > > > > addressee(s). If you are not the intended recipient, please
> > > > > > > contact immediately the sender by telephone, fax or e-mail and
> > > > > > > delete the information in this message that has been received
> in
> > > > > > > error. The sender does not give any warranty or accept
> liability
> > > > > > > as the content, accuracy or completeness of sent messages and
> > > > > > > accepts no responsibility  for changes made after they were
> sent
> > > > > > > or for other risks which arise as a result of e-mail
> > > > > > > transmission, viruses, etc.
> > > > >
> > > > > --
> > > > > Spatialys - Geospatial professional services
> > > > > http://www.spatialys.com
> > >
> > > --
> > > Spatialys - Geospatial professional services
> > > http://www.spatialys.com
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev




-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/7bf310f3/attachment-0001.html>

From gane.prog at gmail.com  Mon May  2 09:21:21 2016
From: gane.prog at gmail.com (Gane R)
Date: Mon, 2 May 2016 21:51:21 +0530
Subject: [gdal-dev] GDALDatasetRasterIO
Message-ID: <CALMrLdCy3LxzjHZsp=K4TUnM7thFgG3NBqB8fyC2z658F76rDw@mail.gmail.com>

Looking for function to do fast IO across the two datasets

Is GDALDatasetRasterIO already best or any other available.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/74da97b0/attachment.html>

From astewart at terragotech.com  Mon May  2 12:12:29 2016
From: astewart at terragotech.com (Alan Stewart)
Date: Mon, 2 May 2016 14:12:29 -0500
Subject: [gdal-dev] GDAL 2.0.2 & gpkg woes
In-Reply-To: <3107231.te7koPG9Xa@even-n550jk>
References: <7F98CACF1AAD69408701E6A026294F95334CEDBE61@CLOUDMBX06.cloudopscenter.net>
 <3107231.te7koPG9Xa@even-n550jk>
Message-ID: <7F98CACF1AAD69408701E6A026294F95334CEDC188@CLOUDMBX06.cloudopscenter.net>

Unfortunately, makes no difference, with my application code or ogr2ogr. I also tested the new libspatialite-4.2.0a DLL against my old GDAL build. Works fine.

Alan Stewart
Senior Software Engineer
TerraGo Technologies
3200 Windy Hill Road, Suite 1550W
Atlanta, GA 30339 USA
O.  +1 678.391.9615
 
www.terragotech.com


-----Original Message-----
From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: Saturday, April 30, 2016 11:00 AM
To: gdal-dev at lists.osgeo.org
Cc: Alan Stewart
Subject: Re: [gdal-dev] GDAL 2.0.2 & gpkg woes

On Friday 29 April 2016 14:07:52 Alan Stewart wrote:
> My debug build of ogr2ogr.exe fails in exactly the same way as my 
> application code fails. Apparently there's some difference in how the 
> new GPKG code uses spatialite or expects spatialite to be built? The 
> same libspatialite DLL works with our GDAL 1.11.0 DLL, but fails with 
> the new GDAL 2.0.2 DLL.

Alan,

Never heard of similar issues. But you could probably try to upgrade to the latest version of sqlite in the 3.8.X series. And/or upgrade your spatialite version to the latest stable 4.3.0a.
Might be possible that the changes between GDAL 1.11 and 2.0 have triggered an integration issue with one of the sqlite/spatialite versions you use.

Even
 
> Alan Stewart
> Senior Software Engineer
> TerraGo Technologies
> 3200 Windy Hill Road, Suite 1550W
> Atlanta, GA 30339 USA
> O.  +1 678.391.9615
>  
> www.terragotech.com
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

--
Spatialys - Geospatial professional services http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Mon May  2 12:51:19 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 2 May 2016 19:51:19 +0000
Subject: [gdal-dev] GDAL 2.0.2 & gpkg woes
Message-ID: <72c35a03e4f4443ea515517f13c41a70@C119S212VM022.msvyvi.vaha.local>

Alan Stewart wrote:


>Unfortunately, makes no difference, with my application code or ogr2ogr. I also tested the new libspatialite-4.2.0a DLL >against my old GDAL build. Works fine.

Hi,

Perhaps you should try to GPKG driver with GDAL that is built without Spatialite. As far as I know GPKG driver does not require Spatialite for basic tasks.

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/a86bcc8c/attachment.html>

From rgrout at continuum.io  Mon May  2 14:21:04 2016
From: rgrout at continuum.io (Ryan Grout)
Date: Mon, 2 May 2016 16:21:04 -0500
Subject: [gdal-dev] compile error on windows
In-Reply-To: <ac1603d2-0eea-e940-aaf1-6480896aa6ae@uci.edu>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <ac1603d2-0eea-e940-aaf1-6480896aa6ae@uci.edu>
Message-ID: <CAOm6iLhrsNNve1332vx3TKUb445rO_B3YXPfKAAU5=x1zsaWnA@mail.gmail.com>

Thanks, again Christoph.  You're a lifesaver.

For the benefit of the gdal-dev list.
Applying the below patch to GDAL fixed my build issues with HDF5 1.8.16
-----------------------------------------------------------------------------
diff --git frmts/hdf5/makefile.vc frmts/hdf5/makefile.vc
index e2e695d..02f006f 100644
--- frmts/hdf5/makefile.vc
+++ frmts/hdf5/makefile.vc
@@ -7,7 +7,7 @@ OBJ        =    hdf5dataset.obj  hdf5imagedataset.obj \

 PLUGIN_DLL     =    gdal_HDF5.dll

-EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32 -D_HDF5USEDLL_
+EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32
-DH5_BUILT_AS_DYNAMIC_LIB

 !IF "$(HDF5_PLUGIN)" == "YES"
 EXTRAFLAGS = $(EXTRAFLAGS) -DHDF5_PLUGIN
------------------------------------------------------------------------------


On Fri, Apr 29, 2016 at 4:28 PM, Christoph Gohlke <cgohlke at uci.edu> wrote:

> Check the compile options. To use shared libraries of HDF5-1.8.16 on
> Windows with Visual Studio you must specify the H5_BUILT_AS_DYNAMIC_LIB
> compile definition (see <
> https://www.hdfgroup.org/HDF5/release/obtain5.html>).
>
> Christoph
>
>
>
> On 4/29/2016 1:17 PM, Ryan Grout wrote:
>
>> Hello,
>>
>> I'm attempting to build GDAL for windows using Visual Studio 2008.
>> I've included the output of the build failure below.
>>
>> I don't see anything wrong with the linking command (hdf5 library is
>> there).  I've double checked the exported symbols of hdf5.lib and it
>> definitely exports the symbols that gdal complains it can't find.
>>
>> I get this failure on Windows 10 with Visual Studio 2008 and gdal 2.0.0
>> through 2.1.0 RC4.  I suspect it might have something to do with HDF
>> 1.8.16 (since the problem only manifested itself since updating HDF5).
>>
>>
>> Searching this mailing list, I couldn't find similar failures.  Any help
>> would be appreciated.
>>
>> Thanks,
>> Ryan
>>
>> The compile fails with the following output:
>>         cd ..
>>         if exist gdal.lib del gdal.lib
>>         lib /nologo /out:gdal.lib port\*.obj gcore\*.obj alg\*.obj
>> frmts\o\*.obj ogr\ogrsf_frmts\ogrsf_frmts.lib ogr\ogr.lib gnm\*.obj
>> gnm\gnm_frmts\o\*.obj   apps\commonutils.obj apps\gdalinfo_lib.obj
>> apps\gdal_translate_lib.obj apps\gdalwarp_lib.obj apps\ogr2ogr_lib.obj
>> apps\gdaldem_lib.obj apps\nearblack_lib.obj apps\gdal_grid_lib.obj
>> apps\gdal_rasterize_lib.obj apps\gdalbuildvrt_lib.obj
>> ogrsf_frmts.lib(ogrjmllayer.obj) : warning LNK4221: no public symbols
>> found; archive member will be inaccessible
>> ogr.lib(ograpispy.obj) : warning LNK4221: no public symbols found;
>> archive member will be inaccessible
>> nitf_gcprpc.obj : warning LNK4221: no public symbols found; archive
>> member will be inaccessible
>> cpl_recode_iconv.obj : warning LNK4221: no public symbols found; archive
>> member will be inaccessible
>>         link /nologo /dll /INCLUDE:OSRValidate
>> /INCLUDE:OPTGetProjectionMethods  /INCLUDE:OGR_G_GetPointCount
>> /INCLUDE:OGRRegisterAll /INCLUDE:GDALSimpleImageWarp
>> /INCLUDE:GDALReprojectImage  /INCLUDE:GDALComputeMedianCutPCT
>> /INCLUDE:GDALDitherRGB2PCT  /INCLUDE:OCTNewCoordinateTransformation
>> port\*.obj gcore\*.obj alg\*.obj frmts\o\*.obj
>> ogr\ogrsf_frmts\ogrsf_frmts.lib ogr\ogr.lib gnm\*.obj
>> gnm\gnm_frmts\o\*.obj   apps\commonutils.obj apps\gdalinfo_lib.obj
>> apps\gdal_translate_lib.obj apps\gdalwarp_lib.obj apps\ogr2ogr_lib.obj
>> apps\gdaldem_lib.obj apps\nearblack_lib.obj apps\gdal_grid_lib.obj
>> apps\gdal_rasterize_lib.obj apps\gdalbuildvrt_lib.obj
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\xerces-c_3.lib
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\hdf.lib
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\mfhdf.lib
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\xdr.lib
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\netcdf.lib
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\geos_c.lib
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\hdf5.lib
>> C:\Users\builder\Miniconda2\envs\_build\Library\lib\libkea.lib
>> odbc32.lib odbccp32.lib user32.lib                        ws2_32.lib
>> gcore\Version.res  /out:gdal201.dll /implib:gdal_i.lib
>>    Creating library gdal_i.lib and object gdal_i.exp
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_DOUBLE_g referenced in function "bool __cdecl
>> GH5_FetchAttribute(int,char const *,double &,bool)"
>> (?GH5_FetchAttribute@@YA_NHPEBDAEAN_N at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_DOUBLE_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_FLOAT_g referenced in function "bool __cdecl
>> GH5_FetchAttribute(int,char const *,double &,bool)"
>> (?GH5_FetchAttribute@@YA_NHPEBDAEAN_N at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_FLOAT_g
>> hdf5imagedataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_FLOAT_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_INT_g referenced in function "bool __cdecl
>> GH5_FetchAttribute(int,char const *,double &,bool)"
>> (?GH5_FetchAttribute@@YA_NHPEBDAEAN_N at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_INT_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_ULLONG_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_ULLONG_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_LLONG_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_LLONG_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_ULONG_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_ULONG_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_LONG_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_LONG_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_UINT_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_UINT_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_USHORT_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_USHORT_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_SHORT_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_SHORT_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_UCHAR_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_UCHAR_g
>> gh5_convenience.obj : error LNK2019: unresolved external symbol
>> H5T_NATIVE_SCHAR_g referenced in function "enum GDALDataType __cdecl
>> GH5_GetDataType(int)" (?GH5_GetDataType@@YA?AW4GDALDataType@@H at Z)
>> hdf5dataset.obj : error LNK2001: unresolved external symbol
>> H5T_NATIVE_SCHAR_g
>> gdal201.dll : fatal error LNK1120: 12 unresolved externals
>> NMAKE : fatal error U1077: '"C:\Program Files (x86)\Microsoft Visual
>> Studio 9.0\VC\BIN\amd64\link.EXE"' : return code '0x460'
>> Stop.
>>
>>
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160502/454745ac/attachment-0001.html>

From even.rouault at spatialys.com  Tue May  3 00:54:58 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 May 2016 09:54:58 +0200
Subject: [gdal-dev] compile error on windows
In-Reply-To: <CAOm6iLhrsNNve1332vx3TKUb445rO_B3YXPfKAAU5=x1zsaWnA@mail.gmail.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <ac1603d2-0eea-e940-aaf1-6480896aa6ae@uci.edu>
 <CAOm6iLhrsNNve1332vx3TKUb445rO_B3YXPfKAAU5=x1zsaWnA@mail.gmail.com>
Message-ID: <201605030954.58868.even.rouault@spatialys.com>

Le lundi 02 mai 2016 23:21:04, Ryan Grout a écrit :
> Thanks, again Christoph.  You're a lifesaver.
> 
> For the benefit of the gdal-dev list.
> Applying the below patch to GDAL fixed my build issues with HDF5 1.8.16
> ---------------------------------------------------------------------------
> -- diff --git frmts/hdf5/makefile.vc frmts/hdf5/makefile.vc
> index e2e695d..02f006f 100644
> --- frmts/hdf5/makefile.vc
> +++ frmts/hdf5/makefile.vc
> @@ -7,7 +7,7 @@ OBJ        =    hdf5dataset.obj  hdf5imagedataset.obj \
> 
>  PLUGIN_DLL     =    gdal_HDF5.dll
> 
> -EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32 -D_HDF5USEDLL_
> +EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32
> -DH5_BUILT_AS_DYNAMIC_LIB

Jeff,

does the above match your experience ? We could probably define both 
_HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB to address different versions.

I see in https://www.hdfgroup.org/windows/faq.html that _HDF5USEDLL_ is still 
advised.

Ryan,

could you try with both  -D_HDF5USEDLL_ and  -DH5_BUILT_AS_DYNAMIC_LIB defined 
? (make sure to clean the frmts/hdf5 directory before rebuilding)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From gane.prog at gmail.com  Tue May  3 02:41:29 2016
From: gane.prog at gmail.com (Gane R)
Date: Tue, 3 May 2016 15:11:29 +0530
Subject: [gdal-dev] Question on mbtiles format
Message-ID: <CALMrLdA4B_GLc0ge5hMGQNWi5ucUp88CrfbRfYnQ7JWZgYiavw@mail.gmail.com>

I saw the code on gdal-2.1.0\frmts\mbtiles\mbtilesdataset.cpp I want know
where a blob is written into mbtiles.

I don't see any INSERT SQL statement for inserting a tile blob

Gane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160503/04e0262b/attachment.html>

From gunnarblom at mail.com  Tue May  3 02:36:19 2016
From: gunnarblom at mail.com (gunnarblom)
Date: Tue, 3 May 2016 02:36:19 -0700 (PDT)
Subject: [gdal-dev] Questions about MBTiles write support @ GDAL 2.1 RC4
In-Reply-To: <201605021529.25458.even.rouault@spatialys.com>
References: <trinity-aaddf744-06ff-46b6-a4d4-ac523d2cbb34-1462047799372@3capp-mailcom-lxa14>
 <201605021130.07618.even.rouault@spatialys.com>
 <1462187014951-5263887.post@n6.nabble.com>
 <201605021339.29551.even.rouault@spatialys.com>
 <1462194714087-5263915.post@n6.nabble.com>
 <201605021529.25458.even.rouault@spatialys.com>
Message-ID: <1462268179178-5264135.post@n6.nabble.com>

GDALBuildOverviews() seems to works fine now, my bad. Thanks for the
responses.



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Questions-about-MBTiles-write-support-GDAL-2-1-RC4-tp5263684p5264135.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From bishop.dev at gmail.com  Tue May  3 07:11:22 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Tue, 3 May 2016 17:11:22 +0300
Subject: [gdal-dev] GSoC 2016
Message-ID: <5728B18A.1080209@gmail.com>

Hello GSoC students!

I created the section about GSoC 2016 
(https://trac.osgeo.org/gdal/wiki/SoCProjects) in GDAL wiki.
Please write your project texts as was done previous years and provide 
them to your mentors to publish them at appropriate wiki pages.
Don't afraid some duplication the OSGeo wiki.

-- 
Best regards,
     Dmitry


From jluis at ualg.pt  Tue May  3 08:59:40 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Tue, 03 May 2016 16:59:40 +0100
Subject: [gdal-dev] compile error on windows
In-Reply-To: <6DF14980-1C9F-4EEB-9F43-1BD09425DB57@ualg.pt>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <5724E81B.8040203@gatewaygeomatics.com>
 <6DF14980-1C9F-4EEB-9F43-1BD09425DB57@ualg.pt>
Message-ID: <op.ygv9dqzzdbaoe8@macmarilu>

an see thers)

> I'm working on a new build for the MS4W community with the new 2015  
> compiler, which seems to work better managing these 4 libraries (huge  
> knock on wood!).
>>
>> In terms of building HDF5, one of the important notes is during cmake  
>> be sure to set "-DBUILD_SHARED_LIBS:BOOL:ON"  I'm not sure if that  
>> helps you case or not.
>>
>> All this to say, you're not alone in this battle!
>>
>> -jeff

Jeff

I can contribute to this effort (already built a couple of GDAL  
dependencies: HDFs, netCDF and others) but there is one capcha, and that  
is really an head tearing for me but I insist on it. All my builds have  
renamed DLLs. That is, I don't want version numbers in it (no  
gdal2.0.1.dll) and 32 & 64 bits are encoded in name as well. For example  
gdal will be: gdal_w32.dll & gdal_w64.dll
Don't know if this condition is too restrictive for you.

Joaquim

From jmckenna at gatewaygeomatics.com  Tue May  3 09:23:47 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 3 May 2016 13:23:47 -0300
Subject: [gdal-dev] compile error on windows
In-Reply-To: <201605030954.58868.even.rouault@spatialys.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <ac1603d2-0eea-e940-aaf1-6480896aa6ae@uci.edu>
 <CAOm6iLhrsNNve1332vx3TKUb445rO_B3YXPfKAAU5=x1zsaWnA@mail.gmail.com>
 <201605030954.58868.even.rouault@spatialys.com>
Message-ID: <5728D093.2000400@gatewaygeomatics.com>

On 2016-05-03 4:54 AM, Even Rouault wrote:
>>
>> -EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32 -D_HDF5USEDLL_
>> +EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32
>> -DH5_BUILT_AS_DYNAMIC_LIB
>
> Jeff,
>
> does the above match your experience ? We could probably define both
> _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB to address different versions.
>
> I see in https://www.hdfgroup.org/windows/faq.html that _HDF5USEDLL_ is still
> advised.

Hi Even,

I only set -D_HDF5USEDLL in /frmts/hdf5/makefile.vc and I don't have any 
issues compiling GDAL against HDF5-1.8.16

It likely comes down to how HDf5 is compiled (the cmake settings), which 
again calls for everyone to be sure to make sure these notes are 
recorded on the buildhints page (which by all the discussion here 
lately, that page should be getting lots and lots of edits lately - 
that's a strong nudge from me to everyone). 
https://trac.osgeo.org/gdal/wiki/HDF

-jeff


-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From even.rouault at spatialys.com  Tue May  3 09:36:45 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 May 2016 18:36:45 +0200
Subject: [gdal-dev] compile error on windows
In-Reply-To: <5728D093.2000400@gatewaygeomatics.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <201605030954.58868.even.rouault@spatialys.com>
 <5728D093.2000400@gatewaygeomatics.com>
Message-ID: <201605031836.45574.even.rouault@spatialys.com>

Le mardi 03 mai 2016 18:23:47, Jeff McKenna a écrit :
> On 2016-05-03 4:54 AM, Even Rouault wrote:
> >> -EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32 -D_HDF5USEDLL_
> >> +EXTRAFLAGS     =     -I$(HDF5_DIR)\include -DWIN32
> >> -DH5_BUILT_AS_DYNAMIC_LIB
> > 
> > Jeff,
> > 
> > does the above match your experience ? We could probably define both
> > _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB to address different versions.
> > 
> > I see in https://www.hdfgroup.org/windows/faq.html that _HDF5USEDLL_ is
> > still advised.
> 
> Hi Even,
> 
> I only set -D_HDF5USEDLL in /frmts/hdf5/makefile.vc and I don't have any
> issues compiling GDAL against HDF5-1.8.16

If you have the opportunity, it would be good if you could check if defining 
both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB doesn't affect negatively your 
builds. Ideally, we'd like to have a default set of compilation flags that 
works out of the box for (almost) everybody.

> 
> It likely comes down to how HDf5 is compiled (the cmake settings), which
> again calls for everyone to be sure to make sure these notes are
> recorded on the buildhints page (which by all the discussion here
> lately, that page should be getting lots and lots of edits lately -
> that's a strong nudge from me to everyone).
> https://trac.osgeo.org/gdal/wiki/HDF

> 
> -jeff

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From steven.lander at rgi-corp.com  Tue May  3 09:54:08 2016
From: steven.lander at rgi-corp.com (Lander, Steven)
Date: Tue, 3 May 2016 16:54:08 +0000
Subject: [gdal-dev] Unable to get multi-platform JAR working for GDAL 2.x
Message-ID: <BY2PR07MB153960EB6677267D8C0B16D1CB7A0@BY2PR07MB1539.namprd07.prod.outlook.com>

I have been struggling to get a working gdal.jar for both Windows and Linux for a few days/weeks now.  A previous issue reported to the mailing list outlines the issue: http://lists.osgeo.org/pipermail/gdal-dev/2016-January/043357.html

For windows, I am using Windows 10 64 bit, along with the 64-bit GDAL dev release which reports to be 2.1.0beta1 when I run gdalinfo --version.  This is also confirmed by the information page for the release: http://www.gisinternals.com/packageinfo.php?file=release-1800-x64-gdal-mapserver.zip.  They also state that it was compiled with SWIG 2.0.4 but I have no way to independently verify that.

On Linux, I get the stable release of 2.1.0 and compile it just fine, using SWIG 2.0.4 as stated in the earlier thread.  I make the GDAL java bindings with no issue.

The problem seems to be Windows will NOT use the jar compiled on Linux and vice versa.  Whenever I try to use the Jar from one platform on another platform, I get an UnsatisfiedLink exception pointing to either Dataset_SWIGUpcast or SWIGDatasetUpcast being the problem.

On each platform I have the location of the GDAL JNI files in the PATH (Windows) or LD_LIBRARY_PATH (Linux).  I use Gradle to build and run my software on each platform, and the GDAL jar is being imported in the gradle file from a lib folder.  As mentioned in the thread Even Roualt responded to, I have tried numerous times on Linux to build the bindings for SWIG using version 1.3.40, 2.0.4, and even 3.0.x.  Nothing I do can get this Upcast issue to go away.

* Is this just not possible?  Do I absolutely have to use the same jar compiled for my platform?
* All GISInternals releases seem to use SWIGDatasetUpcast to register GDAL drivers
* Linux builds make Dataset_SWIGUpcast no matter what SWIG version I compile with.  I have verified this by compiling the java swig project, unzipping the Jars, and running the GNU strings command on the gdalJNI.class file to see the method names in that file.
* Are the CPP files for gdalJNI not the same for each platform?  How is it I am getting two different scenarios where Windows will only work if SWIGDatasetUpcast is present and Linux will only work if Dataset_SWIGUpcast is present in gdalJNI.class?
* Ultimately I just want to be able to use 1 gdal.jar in my project so that IntelliJ does not have to worry about which version to load.  IntelliJ names the Jar explicitly in it's module folder structure and those files are supposed to be in source.  If that file is different for Windows and Linux users, then that creates version headaches for my devs.
* I can easily make this issue moot by having gradle detect my platform and load the appropriate jar by unique name at test/compile time, but that will not work for my IntelliJ/source control issue

Any ideas?  I am struggling to think of other ways to troubleshoot this issue..

Steven D. Lander, Software Engineer
Reinventing Geospatial, Inc

Steven.Lander AT rgi-corp DOT com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160503/1fe72b07/attachment-0001.html>

From even.rouault at spatialys.com  Tue May  3 10:19:54 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 May 2016 19:19:54 +0200
Subject: [gdal-dev] Unable to get multi-platform JAR working for GDAL 2.x
In-Reply-To: <BY2PR07MB153960EB6677267D8C0B16D1CB7A0@BY2PR07MB1539.namprd07.prod.outlook.com>
References: <BY2PR07MB153960EB6677267D8C0B16D1CB7A0@BY2PR07MB1539.namprd07.prod.outlook.com>
Message-ID: <201605031919.54618.even.rouault@spatialys.com>

> * Linux builds make
> Dataset_SWIGUpcast no matter what SWIG version I compile with.  I have
> verified this by compiling the java swig project, unzipping the Jars, and
> running the GNU strings command on the gdalJNI.class file to see the
> method names in that file.

Here with SWIG 1.3.40 on Linux, I see :
gdal_wrap.cpp:SWIGEXPORT jlong JNICALL Java_org_gdal_gdal_gdalJNI_SWIGDatasetUpcast(JNIEnv *jenv, jclass jcls, jlong jarg1) {
org/gdal/gdal/gdalJNI.java:  public final static native long SWIGDriverUpcast(long jarg1);

And with SWIG 2.0.12:
gdal_wrap.cpp:SWIGEXPORT jlong JNICALL Java_org_gdal_gdal_gdalJNI_Dataset_1SWIGUpcast(JNIEnv *jenv, jclass jcls, jlong jarg1) {
org/gdal/gdal/gdalJNI.java:  public final static native long Dataset_SWIGUpcast(long jarg1);

Are you sure you generate the bindings with the swig version you think to ?
You can check this by looking at the header of the generated swig/java/gdal_wrap.cpp for example.
If you switch between swig versions, make sure to do a "make veryclean" in swig/java so that bindings get regenerated at the next build attempt.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jmckenna at gatewaygeomatics.com  Tue May  3 10:42:57 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 3 May 2016 14:42:57 -0300
Subject: [gdal-dev] compile error on windows
In-Reply-To: <201605031836.45574.even.rouault@spatialys.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <201605030954.58868.even.rouault@spatialys.com>
 <5728D093.2000400@gatewaygeomatics.com>
 <201605031836.45574.even.rouault@spatialys.com>
Message-ID: <5728E321.9050508@gatewaygeomatics.com>

On 2016-05-03 1:36 PM, Even Rouault wrote:
>
> If you have the opportunity, it would be good if you could check if defining
> both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB doesn't affect negatively your
> builds. Ideally, we'd like to have a default set of compilation flags that
> works out of the box for (almost) everybody.
>

It will depend how HDF5 was compiled (the cmake settings).  For example, 
I build the static lib of HDF5, and therefore in GDAL's nmake.opt I 
point to "libhdf5.lib".  In my case I therefore do not need to set 
H5_BUILT_AS_DYNAMIC_LIB

If I try to set both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB I get 61 
unresolved symbols in the linker.

Now are you understanding my grey hair comment Even? :)

I feel these notes are important to document in the buildhints wiki.

-jeff



-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From astewart at terragotech.com  Tue May  3 10:50:11 2016
From: astewart at terragotech.com (Alan Stewart)
Date: Tue, 3 May 2016 12:50:11 -0500
Subject: [gdal-dev] GDAL 2.0.2 & gpkg woes
In-Reply-To: <3107231.te7koPG9Xa@even-n550jk>
References: <7F98CACF1AAD69408701E6A026294F95334CEDBE61@CLOUDMBX06.cloudopscenter.net>
 <3107231.te7koPG9Xa@even-n550jk>
Message-ID: <7F98CACF1AAD69408701E6A026294F95334CEDC46F@CLOUDMBX06.cloudopscenter.net>

Even,

The libspatialite code where the failure occurs is only executed when spatialite is built with LOADABLE_EXTENSION undefined. Is there any possibility that the new gpkg code depends on this being defined? LOADABLE_EXTENSION does not appear anywhere in the GDAL source.

Alan Stewart
Senior Software Engineer
TerraGo Technologies
3200 Windy Hill Road, Suite 1550W
Atlanta, GA 30339 USA
O.  +1 678.391.9615
 
www.terragotech.com

-----Original Message-----
From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: Saturday, April 30, 2016 11:00 AM
To: gdal-dev at lists.osgeo.org
Cc: Alan Stewart
Subject: Re: [gdal-dev] GDAL 2.0.2 & gpkg woes

On Friday 29 April 2016 14:07:52 Alan Stewart wrote:
> My debug build of ogr2ogr.exe fails in exactly the same way as my 
> application code fails. Apparently there's some difference in how the 
> new GPKG code uses spatialite or expects spatialite to be built? The 
> same libspatialite DLL works with our GDAL 1.11.0 DLL, but fails with 
> the new GDAL 2.0.2 DLL.

Alan,

Never heard of similar issues. But you could probably try to upgrade to the latest version of sqlite in the 3.8.X series. And/or upgrade your spatialite version to the latest stable 4.3.0a.
Might be possible that the changes between GDAL 1.11 and 2.0 have triggered an integration issue with one of the sqlite/spatialite versions you use.

Even
 
> Alan Stewart
> Senior Software Engineer
> TerraGo Technologies
> 3200 Windy Hill Road, Suite 1550W
> Atlanta, GA 30339 USA
> O.  +1 678.391.9615
>  
> www.terragotech.com
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

--
Spatialys - Geospatial professional services http://www.spatialys.com

From jmckenna at gatewaygeomatics.com  Tue May  3 10:57:45 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 3 May 2016 14:57:45 -0300
Subject: [gdal-dev] compile error on windows
In-Reply-To: <5728E321.9050508@gatewaygeomatics.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <201605030954.58868.even.rouault@spatialys.com>
 <5728D093.2000400@gatewaygeomatics.com>
 <201605031836.45574.even.rouault@spatialys.com>
 <5728E321.9050508@gatewaygeomatics.com>
Message-ID: <5728E699.5030600@gatewaygeomatics.com>

I'm also very ok with changing the default to set 
H5_BUILT_AS_DYNAMIC_LIB only - I'll just edit the makefile before 
building.  Not an issue for me.

Since no one is recording these notes from this long discussion in the 
buildhints wiki, I'm +1 to change to this new setting in makefile.vc; 
then I'll make a note on the buildhints wiki and make sure the MS4W 
process is updated.

-jeff


-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/



On 2016-05-03 2:42 PM, Jeff McKenna wrote:
> On 2016-05-03 1:36 PM, Even Rouault wrote:
>>
>> If you have the opportunity, it would be good if you could check if
>> defining
>> both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB doesn't affect
>> negatively your
>> builds. Ideally, we'd like to have a default set of compilation flags
>> that
>> works out of the box for (almost) everybody.
>>
>
> It will depend how HDF5 was compiled (the cmake settings).  For example,
> I build the static lib of HDF5, and therefore in GDAL's nmake.opt I
> point to "libhdf5.lib".  In my case I therefore do not need to set
> H5_BUILT_AS_DYNAMIC_LIB
>
> If I try to set both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB I get 61
> unresolved symbols in the linker.
>
> Now are you understanding my grey hair comment Even? :)
>
> I feel these notes are important to document in the buildhints wiki.
>
> -jeff
>
>
>



From even.rouault at spatialys.com  Tue May  3 11:11:53 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 May 2016 20:11:53 +0200
Subject: [gdal-dev] compile error on windows
In-Reply-To: <5728E699.5030600@gatewaygeomatics.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <5728E321.9050508@gatewaygeomatics.com>
 <5728E699.5030600@gatewaygeomatics.com>
Message-ID: <201605032011.53697.even.rouault@spatialys.com>

Le mardi 03 mai 2016 19:57:45, Jeff McKenna a écrit :
> I'm also very ok with changing the default to set
> H5_BUILT_AS_DYNAMIC_LIB only - I'll just edit the makefile before
> building.  Not an issue for me.

I'm not keen to modify things without a clear understanding of what is 
required in which context.

> 
> Since no one is recording these notes from this long discussion in the
> buildhints wiki, I'm +1 to change to this new setting in makefile.vc;
> then I'll make a note on the buildhints wiki and make sure the MS4W
> process is updated.

I agree. Ideally we would need a table :

HDF5 version | HDF5 cmake build options  | GDAL required compilation flags

> 
> -jeff
> 
> > On 2016-05-03 1:36 PM, Even Rouault wrote:
> >> If you have the opportunity, it would be good if you could check if
> >> defining
> >> both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB doesn't affect
> >> negatively your
> >> builds. Ideally, we'd like to have a default set of compilation flags
> >> that
> >> works out of the box for (almost) everybody.
> > 
> > It will depend how HDF5 was compiled (the cmake settings).  For example,
> > I build the static lib of HDF5, and therefore in GDAL's nmake.opt I
> > point to "libhdf5.lib".  In my case I therefore do not need to set
> > H5_BUILT_AS_DYNAMIC_LIB
> > 
> > If I try to set both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB I get 61
> > unresolved symbols in the linker.
> > 
> > Now are you understanding my grey hair comment Even? :)
> > 
> > I feel these notes are important to document in the buildhints wiki.
> > 
> > -jeff
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jmckenna at gatewaygeomatics.com  Tue May  3 11:21:14 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 3 May 2016 15:21:14 -0300
Subject: [gdal-dev] compile error on windows
In-Reply-To: <201605032011.53697.even.rouault@spatialys.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <5728E321.9050508@gatewaygeomatics.com>
 <5728E699.5030600@gatewaygeomatics.com>
 <201605032011.53697.even.rouault@spatialys.com>
Message-ID: <fdd84fcb-c719-cb79-78c6-92eabd10f458@gatewaygeomatics.com>

On 2016-05-03 3:11 PM, Even Rouault wrote:
> Le mardi 03 mai 2016 19:57:45, Jeff McKenna a écrit :
>> I'm also very ok with changing the default to set
>> H5_BUILT_AS_DYNAMIC_LIB only - I'll just edit the makefile before
>> building.  Not an issue for me.
>
> I'm not keen to modify things without a clear understanding of what is
> required in which context.
>

Well if I go back and build the dynamic HDf5 lib, and then set 
H5_BUILT_AS_DYNAMIC_LIB, then of course my resulting gdal.dll is smaller 
in size, which I could live with.  So making this the default setting 
'going forward' in GDAL makes sense.

-jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From even.rouault at spatialys.com  Tue May  3 11:28:25 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 May 2016 20:28:25 +0200
Subject: [gdal-dev] GDAL 2.0.2 & gpkg woes
In-Reply-To: <7F98CACF1AAD69408701E6A026294F95334CEDC46F@CLOUDMBX06.cloudopscenter.net>
References: <7F98CACF1AAD69408701E6A026294F95334CEDBE61@CLOUDMBX06.cloudopscenter.net>
 <3107231.te7koPG9Xa@even-n550jk>
 <7F98CACF1AAD69408701E6A026294F95334CEDC46F@CLOUDMBX06.cloudopscenter.net>
Message-ID: <201605032028.25736.even.rouault@spatialys.com>

Le mardi 03 mai 2016 19:50:11, Alan Stewart a écrit :
> Even,
> 
> The libspatialite code where the failure occurs is only executed when
> spatialite is built with LOADABLE_EXTENSION undefined. Is there any
> possibility that the new gpkg code depends on this being defined?
> LOADABLE_EXTENSION does not appear anywhere in the GDAL source.

Alan,

From what I see from spatialite code, spatialite_init_ex() is only defined if 
LOADABLE_EXTENSION is undefined (by spatialite own makefiles). 
LOADABLE_EXTENSION is undefined when libspatialite.so/.dll is built, and defined 
when mod_spatialite is built ( https://www.gaia-
gis.it/fossil/libspatialite/wiki?name=mod_spatialite ). And GDAL needs 
spatialite_init_ex() to be defined when linking against new (>= 4.1.2) 
spatialite versions.

I'm not sure what's wrong/particular with your sqlite and/or spatialite build, 
but there are several builds in the wild that work (MS4W, OSGeo4W, 
gisinternals).

If you don't need spatialite, you can disable it when building GDAL. The GPKG 
driver doesn't absolutely require it. Spatialite provides processing 
functions, but for simple read/write scenarios, they are not needed.
You can also dynamically disable spatialite loading by defining 
SPATIALITE_LOAD=NO as environmenet variable.

Even

> 
> Alan Stewart
> Senior Software Engineer
> TerraGo Technologies
> 3200 Windy Hill Road, Suite 1550W
> Atlanta, GA 30339 USA
> O.  +1 678.391.9615
>  
> www.terragotech.com
> 
> -----Original Message-----
> From: Even Rouault [mailto:even.rouault at spatialys.com]
> Sent: Saturday, April 30, 2016 11:00 AM
> To: gdal-dev at lists.osgeo.org
> Cc: Alan Stewart
> Subject: Re: [gdal-dev] GDAL 2.0.2 & gpkg woes
> 
> On Friday 29 April 2016 14:07:52 Alan Stewart wrote:
> > My debug build of ogr2ogr.exe fails in exactly the same way as my
> > application code fails. Apparently there's some difference in how the
> > new GPKG code uses spatialite or expects spatialite to be built? The
> > same libspatialite DLL works with our GDAL 1.11.0 DLL, but fails with
> > the new GDAL 2.0.2 DLL.
> 
> Alan,
> 
> Never heard of similar issues. But you could probably try to upgrade to the
> latest version of sqlite in the 3.8.X series. And/or upgrade your
> spatialite version to the latest stable 4.3.0a. Might be possible that the
> changes between GDAL 1.11 and 2.0 have triggered an integration issue with
> one of the sqlite/spatialite versions you use.
> 
> Even
> 
> > Alan Stewart
> > Senior Software Engineer
> > TerraGo Technologies
> > 3200 Windy Hill Road, Suite 1550W
> > Atlanta, GA 30339 USA
> > O.  +1 678.391.9615
> > 
> > www.terragotech.com
> > 
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > http://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> --
> Spatialys - Geospatial professional services http://www.spatialys.com

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jamessramm at gmail.com  Tue May  3 11:23:49 2016
From: jamessramm at gmail.com (jramm)
Date: Tue, 3 May 2016 11:23:49 -0700 (PDT)
Subject: [gdal-dev] Geotiff FillEmptyTiles with no data value?
Message-ID: <1462299829320-5264310.post@n6.nabble.com>

Hi

When writing geotiffs, if I dont write blocks they will automatically be
filled on close by the FillEmptyTiles.
It appears that this will only fill with zeros - is it possible to make it
fill with the no data value instead?

This is potentially a huge time saver when processing a large, fairly sparse
geotiff using python as relying on gdal to fill in 'null' blocks appears far
quicker than calling the python write method. 




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Geotiff-FillEmptyTiles-with-no-data-value-tp5264310.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Tue May  3 11:59:38 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 May 2016 20:59:38 +0200
Subject: [gdal-dev] Geotiff FillEmptyTiles with no data value?
In-Reply-To: <1462299829320-5264310.post@n6.nabble.com>
References: <1462299829320-5264310.post@n6.nabble.com>
Message-ID: <201605032059.38870.even.rouault@spatialys.com>

Le mardi 03 mai 2016 20:23:49, jramm a écrit :
> Hi
> 
> When writing geotiffs, if I dont write blocks they will automatically be
> filled on close by the FillEmptyTiles.
> It appears that this will only fill with zeros - is it possible to make it
> fill with the no data value instead?

You can also avoid the blocks to be written at all with the SPARSE_OK=TRUE 
creation option. On reading, missing blocks will be returned filled with the 
nodata value. But sparse geotiffs are a bit non-standard.

We'd welcome a patch to modify FillEmptyTiles to use the nodata value

> 
> This is potentially a huge time saver when processing a large, fairly
> sparse geotiff using python as relying on gdal to fill in 'null' blocks
> appears far quicker than calling the python write method.
> 
> 
> 
> 
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/Geotiff-FillEmptyTiles-with-no-data-va
> lue-tp5264310.html Sent from the GDAL - Dev mailing list archive at
> Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Stefan.Blumentrath at nina.no  Tue May  3 12:06:14 2016
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Tue, 3 May 2016 19:06:14 +0000
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
Message-ID: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>

Dear GDAL-devs,

I just tried to open a Norwegian SOSI file with ogrinfo from GDAL 2.1dev but get:
FAILURE:
Unable to open datasource `./ADM_kommune_2018_Masoy.sos' with the following drivers.

'ogrinfo --formats' does not list the SOSI driver either. But I am sure I did compile with '--with-sosi' and gdal-config --dep-libs lists the openfyba libs used for the driver.

So my question is,: were there any changes from 1.11 to 2.x which may affect the driver? Any chance someone will make that working again?
Unfortunately our mapping authority does not seem to be maintaining the OpenFYBA lib any more (SOSI version 4.5 not yet supported), so I can understand if you are not too keen on fixing the issue (if it is not local).

Thanks for any help.

Kind regards,
Stefan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160503/12ac9fc8/attachment.html>

From even.rouault at spatialys.com  Tue May  3 12:32:31 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 May 2016 21:32:31 +0200
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
In-Reply-To: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
References: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
Message-ID: <201605032132.31694.even.rouault@spatialys.com>

Le mardi 03 mai 2016 21:06:14, Blumentrath, Stefan a écrit :
> Dear GDAL-devs,
> 
> I just tried to open a Norwegian SOSI file with ogrinfo from GDAL 2.1dev
> but get: FAILURE:
> Unable to open datasource `./ADM_kommune_2018_Masoy.sos' with the following
> drivers.
> 
> 'ogrinfo --formats' does not list the SOSI driver either. But I am sure I
> did compile with '--with-sosi' and gdal-config --dep-libs lists the
> openfyba libs used for the driver.

Hum, I see this is actually a 2.1.0 regression.
Fix available in https://trac.osgeo.org/gdal/ticket/6500

> 
> So my question is,: were there any changes from 1.11 to 2.x which may
> affect the driver? Any chance someone will make that working again?
> Unfortunately our mapping authority does not seem to be maintaining the
> OpenFYBA lib any more (SOSI version 4.5 not yet supported), so I can
> understand if you are not too keen on fixing the issue (if it is not
> local).
> 
> Thanks for any help.
> 
> Kind regards,
> Stefan

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Stefan.Blumentrath at nina.no  Tue May  3 12:39:46 2016
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Tue, 3 May 2016 19:39:46 +0000
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
In-Reply-To: <201605032132.31694.even.rouault@spatialys.com>
References: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
 <201605032132.31694.even.rouault@spatialys.com>
Message-ID: <1a4e0d7ba5154f30ba1afe320ee60be8@NINSRV23.nina.no>

Hei Even,

Thanks for the incredibly quick fix. I shall test at once.

Cheers
Stefan

-----Original Message-----
From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: 3. mai 2016 21:33
To: gdal-dev at lists.osgeo.org
Cc: Blumentrath, Stefan <Stefan.Blumentrath at nina.no>
Subject: Re: [gdal-dev] GDAL 2.1 and Norwegian SOSI

Le mardi 03 mai 2016 21:06:14, Blumentrath, Stefan a écrit :
> Dear GDAL-devs,
> 
> I just tried to open a Norwegian SOSI file with ogrinfo from GDAL 
> 2.1dev but get: FAILURE:
> Unable to open datasource `./ADM_kommune_2018_Masoy.sos' with the 
> following drivers.
> 
> 'ogrinfo --formats' does not list the SOSI driver either. But I am 
> sure I did compile with '--with-sosi' and gdal-config --dep-libs lists 
> the openfyba libs used for the driver.

Hum, I see this is actually a 2.1.0 regression.
Fix available in https://trac.osgeo.org/gdal/ticket/6500

> 
> So my question is,: were there any changes from 1.11 to 2.x which may 
> affect the driver? Any chance someone will make that working again?
> Unfortunately our mapping authority does not seem to be maintaining 
> the OpenFYBA lib any more (SOSI version 4.5 not yet supported), so I 
> can understand if you are not too keen on fixing the issue (if it is 
> not local).
> 
> Thanks for any help.
> 
> Kind regards,
> Stefan

--
Spatialys - Geospatial professional services http://www.spatialys.com

From steven.lander at rgi-corp.com  Tue May  3 12:44:43 2016
From: steven.lander at rgi-corp.com (Lander, Steven)
Date: Tue, 3 May 2016 19:44:43 +0000
Subject: [gdal-dev] Unable to get multi-platform JAR working for GDAL 2.x
In-Reply-To: <201605031919.54618.even.rouault@spatialys.com>
References: <BY2PR07MB153960EB6677267D8C0B16D1CB7A0@BY2PR07MB1539.namprd07.prod.outlook.com>,
 <201605031919.54618.even.rouault@spatialys.com>
Message-ID: <BY2PR07MB15397B81FA80CE6425CD38AECB7A0@BY2PR07MB1539.namprd07.prod.outlook.com>

Even,

That does seem to be the problem; I had already compiled the bindings using SWIG 3.x and the make clean command wasn't clearing everything out completely.  I verified the new jar made after running the veryclean command now has the appropriate SWIGDatasetUpcast method just like the windows one does.

This should fix the issue. I really appreciate your help!

Steven D. Lander, Software Engineer
Reinventing Geospatial, Inc


________________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Tuesday, May 3, 2016 1:19:54 PM
To: gdal-dev at lists.osgeo.org
Cc: Lander, Steven
Subject: Re: [gdal-dev] Unable to get multi-platform JAR working for GDAL 2.x

> * Linux builds make
> Dataset_SWIGUpcast no matter what SWIG version I compile with.  I have
> verified this by compiling the java swig project, unzipping the Jars, and
> running the GNU strings command on the gdalJNI.class file to see the
> method names in that file.

Here with SWIG 1.3.40 on Linux, I see :
gdal_wrap.cpp:SWIGEXPORT jlong JNICALL Java_org_gdal_gdal_gdalJNI_SWIGDatasetUpcast(JNIEnv *jenv, jclass jcls, jlong jarg1) {
org/gdal/gdal/gdalJNI.java:  public final static native long SWIGDriverUpcast(long jarg1);

And with SWIG 2.0.12:
gdal_wrap.cpp:SWIGEXPORT jlong JNICALL Java_org_gdal_gdal_gdalJNI_Dataset_1SWIGUpcast(JNIEnv *jenv, jclass jcls, jlong jarg1) {
org/gdal/gdal/gdalJNI.java:  public final static native long Dataset_SWIGUpcast(long jarg1);

Are you sure you generate the bindings with the swig version you think to ?
You can check this by looking at the header of the generated swig/java/gdal_wrap.cpp for example.
If you switch between swig versions, make sure to do a "make veryclean" in swig/java so that bindings get regenerated at the next build attempt.

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com

From bradh at frogmouth.net  Tue May  3 15:45:51 2016
From: bradh at frogmouth.net (Brad Hards)
Date: Wed, 4 May 2016 08:45:51 +1000
Subject: [gdal-dev] GDAL 2.0.2 & gpkg woes
In-Reply-To: <7F98CACF1AAD69408701E6A026294F95334CEDC46F@CLOUDMBX06.cloudopscenter.net>
References: <7F98CACF1AAD69408701E6A026294F95334CEDBE61@CLOUDMBX06.cloudopscenter.net>
 <3107231.te7koPG9Xa@even-n550jk>
 <7F98CACF1AAD69408701E6A026294F95334CEDC46F@CLOUDMBX06.cloudopscenter.net>
Message-ID: <031c01d1a58d$98d431b0$ca7c9510$@frogmouth.net>

> The libspatialite code where the failure occurs is only executed when
> spatialite is built with LOADABLE_EXTENSION undefined. Is there any
> possibility that the new gpkg code depends on this being defined?
> LOADABLE_EXTENSION does not appear anywhere in the GDAL source.

Are you trying to link to mod_spatialite or libspatialite ?

Brad



From Stefan.Blumentrath at nina.no  Wed May  4 00:32:13 2016
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Wed, 4 May 2016 07:32:13 +0000
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
In-Reply-To: <201605032132.31694.even.rouault@spatialys.com>
References: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
 <201605032132.31694.even.rouault@spatialys.com>
Message-ID: <197acdd44e52432fa03dc65f6a0ebe0d@NINSRV23.nina.no>

Hei again,

First of all, now the SOSI file opens fine again. So, many thanks for that!

Unfortunately, I now get a new error on ogrinfo ./ADM_kommune_0620_Hol.sos lines

Layer name: lines 
Geometry: Line String 
ERROR 4: Unrecognized geometry of type 5. 
ERROR 1: Feature 82 referenced by 2204, but it was not initialized. 
Aborted (core dumped)

I get it for polygons too. Geometries of type 5 are curved geometries which got introduced in SOSI version 4.5 - if I am not mistaken...

Geometry type 5 (BUEP) is defined in https://github.com/kartverket/fyba/blob/master/src/FYBA/fyba.h (Line 408)... Would it be sufficient to add something like:
        case wkbCompoundCurve: {
            pszSosi = ".BUEP";
            break;
        }
to: ogr/ogrsf_frmts/sosi/ogrsosilayer.cpp (not sure if the translation is 100% correct)

But maybe also trunk/gdal/ogr/ogrsf_frmts/sosi/ogrsosidatasource.cpp needs modification...?
(I am no programmer).

Seems to be an older issue and other GeometryTypes seem to cause trouble too:
http://gis.stackexchange.com/questions/132888/ogr2ogr-problem-converting-sosi-fil-to-kml-or-anything-else

Cheers,
Stefan

-----Original Message-----
From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: 3. mai 2016 21:33
To: gdal-dev at lists.osgeo.org
Cc: Blumentrath, Stefan <Stefan.Blumentrath at nina.no>
Subject: Re: [gdal-dev] GDAL 2.1 and Norwegian SOSI

Le mardi 03 mai 2016 21:06:14, Blumentrath, Stefan a écrit :
> Dear GDAL-devs,
> 
> I just tried to open a Norwegian SOSI file with ogrinfo from GDAL 
> 2.1dev but get: FAILURE:
> Unable to open datasource `./ADM_kommune_2018_Masoy.sos' with the 
> following drivers.
> 
> 'ogrinfo --formats' does not list the SOSI driver either. But I am 
> sure I did compile with '--with-sosi' and gdal-config --dep-libs lists 
> the openfyba libs used for the driver.

Hum, I see this is actually a 2.1.0 regression.
Fix available in https://trac.osgeo.org/gdal/ticket/6500

> 
> So my question is,: were there any changes from 1.11 to 2.x which may 
> affect the driver? Any chance someone will make that working again?
> Unfortunately our mapping authority does not seem to be maintaining 
> the OpenFYBA lib any more (SOSI version 4.5 not yet supported), so I 
> can understand if you are not too keen on fixing the issue (if it is 
> not local).
> 
> Thanks for any help.
> 
> Kind regards,
> Stefan

--
Spatialys - Geospatial professional services http://www.spatialys.com

From even.rouault at spatialys.com  Wed May  4 00:48:35 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 4 May 2016 09:48:35 +0200
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
In-Reply-To: <197acdd44e52432fa03dc65f6a0ebe0d@NINSRV23.nina.no>
References: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
 <201605032132.31694.even.rouault@spatialys.com>
 <197acdd44e52432fa03dc65f6a0ebe0d@NINSRV23.nina.no>
Message-ID: <201605040948.35822.even.rouault@spatialys.com>

Le mercredi 04 mai 2016 09:32:13, Blumentrath, Stefan a écrit :
> Hei again,
> 
> First of all, now the SOSI file opens fine again. So, many thanks for that!
> 
> Unfortunately, I now get a new error on ogrinfo ./ADM_kommune_0620_Hol.sos
> lines
> 
> Layer name: lines
> Geometry: Line String
> ERROR 4: Unrecognized geometry of type 5.
> ERROR 1: Feature 82 referenced by 2204, but it was not initialized.
> Aborted (core dumped)
> 
> I get it for polygons too. Geometries of type 5 are curved geometries which
> got introduced in SOSI version 4.5 - if I am not mistaken...
> 
> Geometry type 5 (BUEP) is defined in
> https://github.com/kartverket/fyba/blob/master/src/FYBA/fyba.h (Line
> 408)... Would it be sufficient to add something like: case
> wkbCompoundCurve: {
>             pszSosi = ".BUEP";
>             break;
>         }
> to: ogr/ogrsf_frmts/sosi/ogrsosilayer.cpp (not sure if the translation is
> 100% correct)

That would be for the write side of the driver. GetNextFeature() should likely 
be modified

> 
> But maybe also trunk/gdal/ogr/ogrsf_frmts/sosi/ogrsosidatasource.cpp needs
> modification...? (I am no programmer).

Yes, the Open() method seems to be where OGR geometries are built from SOSI 
ones. Would need to be extended for curves.

> 
> Seems to be an older issue and other GeometryTypes seem to cause trouble
> too:
> http://gis.stackexchange.com/questions/132888/ogr2ogr-problem-converting-s
> osi-fil-to-kml-or-anything-else
> 
> Cheers,
> Stefan
> 
> -----Original Message-----
> From: Even Rouault [mailto:even.rouault at spatialys.com]
> Sent: 3. mai 2016 21:33
> To: gdal-dev at lists.osgeo.org
> Cc: Blumentrath, Stefan <Stefan.Blumentrath at nina.no>
> Subject: Re: [gdal-dev] GDAL 2.1 and Norwegian SOSI
> 
> Le mardi 03 mai 2016 21:06:14, Blumentrath, Stefan a écrit :
> > Dear GDAL-devs,
> > 
> > I just tried to open a Norwegian SOSI file with ogrinfo from GDAL
> > 2.1dev but get: FAILURE:
> > Unable to open datasource `./ADM_kommune_2018_Masoy.sos' with the
> > following drivers.
> > 
> > 'ogrinfo --formats' does not list the SOSI driver either. But I am
> > sure I did compile with '--with-sosi' and gdal-config --dep-libs lists
> > the openfyba libs used for the driver.
> 
> Hum, I see this is actually a 2.1.0 regression.
> Fix available in https://trac.osgeo.org/gdal/ticket/6500
> 
> > So my question is,: were there any changes from 1.11 to 2.x which may
> > affect the driver? Any chance someone will make that working again?
> > Unfortunately our mapping authority does not seem to be maintaining
> > the OpenFYBA lib any more (SOSI version 4.5 not yet supported), so I
> > can understand if you are not too keen on fixing the issue (if it is
> > not local).
> > 
> > Thanks for any help.
> > 
> > Kind regards,
> > Stefan
> 
> --
> Spatialys - Geospatial professional services http://www.spatialys.com

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed May  4 01:16:32 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 4 May 2016 10:16:32 +0200
Subject: [gdal-dev] Creation of pages on Trac wiki disabled
In-Reply-To: <201605021135.17550.even.rouault@spatialys.com>
References: <201604272159.01182.even.rouault@spatialys.com>
 <201605021135.17550.even.rouault@spatialys.com>
Message-ID: <201605041016.32353.even.rouault@spatialys.com>

Le lundi 02 mai 2016 11:35:17, Even Rouault a écrit :
> Le mercredi 27 avril 2016 21:59:01, Even Rouault a écrit :
> > Folks,
> > 
> > I've removed the right to create new pages on the wiki for the
> > 'authenticated' group due to spammers abusting it recently (as well as
> > other projects wiki). OSGeo System Administration Committee is looking at
> > that, so we might re- enable that if we understand what happens.
> > If you need to create pages, ping me and I can give you the permission.
> 
> OSGeo id creation has been hardened, so I've re-enabled wiki page creation
> for authenticated users. Please keep an eye if spammers start abusing it
> again.

Sigh, I had to disable wiki page creation again as spammers start again. It 
seems they create manually their OSGeo id, so anti-bot measures at that level 
don't help.

> 
> > Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From astewart at terragotech.com  Wed May  4 06:36:02 2016
From: astewart at terragotech.com (Alan Stewart)
Date: Wed, 4 May 2016 08:36:02 -0500
Subject: [gdal-dev] GDAL 2.0.2 & gpkg woes
In-Reply-To: <031c01d1a58d$98d431b0$ca7c9510$@frogmouth.net>
References: <7F98CACF1AAD69408701E6A026294F95334CEDBE61@CLOUDMBX06.cloudopscenter.net>
 <3107231.te7koPG9Xa@even-n550jk>
 <7F98CACF1AAD69408701E6A026294F95334CEDC46F@CLOUDMBX06.cloudopscenter.net>
 <031c01d1a58d$98d431b0$ca7c9510$@frogmouth.net>
Message-ID: <7F98CACF1AAD69408701E6A026294F95334CEDC661@CLOUDMBX06.cloudopscenter.net>

Brad,

Libspatialite. The new GDAL 2.0.2 DLL I've been given fails in spatialite initialization when attempting to create a new vector geopackage, whether from my application code or ogr2ogr. The original question was whether something has changed in GDAL 2.0.2 that requires a change in how libspatialite/sqlite is built or is there something wrong with our GDAL 2.0.2 build. We have a libspatialite 4.2.0 DLL, and on Even's suggestion have built a new 4.3.0a DLL. Both work fine with our GDAL 1.11.0 DLL, but fail in the same way with the GDAL 2.0.2 DLL.

LOADABLE_EXTENSION was something I had to ask about, being unfamiliar with the GDAL source. We've always left LOADABLE_EXTENSION undefined in our libspatialite build and continue to do so.

From what I've learned it seems the issue must be our GDAL 2.0.2 build. It's actually being built by a developer on the other side of the world. I'm building sqlite/libspatialite. We share a repository between us. The other developer ported our GDAL customizations from 1.11.0 to 2.0.2 and built it. For various reasons it's not practical at this time for me to throw this issue back at the other developer. I need to have a  reasonable idea of what to ask him to change first. I'm in the process of comparing the source and build files between the two, looking for a difference that could matter.

Would supplying the /LTCG flag when building ogr.lib make difference? Our GDAL 1.11.0 build does not have this, but for some reason the other developer added this to ogr/makefile.vc. From what I understand of it I would only expect this flag when building an EXE or DLL.

Alan Stewart
Senior Software Engineer
TerraGo Technologies
3200 Windy Hill Road, Suite 1550W
Atlanta, GA 30339 USA
O.  +1 678.391.9615
 
www.terragotech.com


-----Original Message-----
From: Brad Hards [mailto:bradh at frogmouth.net] 
Sent: Tuesday, May 03, 2016 6:46 PM
To: Alan Stewart; 'Even Rouault'; gdal-dev at lists.osgeo.org
Subject: RE: [gdal-dev] GDAL 2.0.2 & gpkg woes

> The libspatialite code where the failure occurs is only executed when 
> spatialite is built with LOADABLE_EXTENSION undefined. Is there any 
> possibility that the new gpkg code depends on this being defined?
> LOADABLE_EXTENSION does not appear anywhere in the GDAL source.

Are you trying to link to mod_spatialite or libspatialite ?

Brad



From even.rouault at spatialys.com  Wed May  4 09:49:28 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 4 May 2016 18:49:28 +0200
Subject: [gdal-dev] Creation of pages on Trac wiki disabled
In-Reply-To: <201605041016.32353.even.rouault@spatialys.com>
References: <201604272159.01182.even.rouault@spatialys.com>
 <201605021135.17550.even.rouault@spatialys.com>
 <201605041016.32353.even.rouault@spatialys.com>
Message-ID: <201605041849.28985.even.rouault@spatialys.com>

Le mercredi 04 mai 2016 10:16:32, Even Rouault a écrit :
> Le lundi 02 mai 2016 11:35:17, Even Rouault a écrit :
> > Le mercredi 27 avril 2016 21:59:01, Even Rouault a écrit :
> > > Folks,
> > > 
> > > I've removed the right to create new pages on the wiki for the
> > > 'authenticated' group due to spammers abusting it recently (as well as
> > > other projects wiki). OSGeo System Administration Committee is looking
> > > at that, so we might re- enable that if we understand what happens. If
> > > you need to create pages, ping me and I can give you the permission.
> > 
> > OSGeo id creation has been hardened, so I've re-enabled wiki page
> > creation for authenticated users. Please keep an eye if spammers start
> > abusing it again.
> 
> Sigh, I had to disable wiki page creation again as spammers start again. It
> seems they create manually their OSGeo id, so anti-bot measures at that
> level don't help.

We just got spam in a ticket. I've enabled the right to delete (not close, 
real delete) tickets to foks with TRAC_ADMIN priviledges (ie PSC members. Just 
added you Jukka). This should only be used to delete spam.

I hope we won't have to use it a lot... Not sure about what we could do if 
tickets got massively spammed.

> 
> > > Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From zegdal at gmail.com  Wed May  4 11:47:35 2016
From: zegdal at gmail.com (Ze Gadalo)
Date: Wed, 4 May 2016 19:47:35 +0100
Subject: [gdal-dev] compile error on windows
In-Reply-To: <201605031836.45574.even.rouault@spatialys.com>
References: <CAOm6iLgG6O_6UL7M+GWv0RFL=Htxv2Q8L2g_c9CY1bq5w2PhaA@mail.gmail.com>
 <201605030954.58868.even.rouault@spatialys.com>
 <5728D093.2000400@gatewaygeomatics.com>
 <201605031836.45574.even.rouault@spatialys.com>
Message-ID: <CAJzaxHMxEgkyio9kgyY3aBp5zhQv7Zai9_MGUSONLO0_O=xHpw@mail.gmail.com>

>
> If you have the opportunity, it would be good if you could check if
> defining
> both _HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB doesn't affect negatively
> your
> builds. Ideally, we'd like to have a default set of compilation flags that
> works out of the box for (almost) everybody.
>
>
Ok, I crossed this issue also while linking against HDF5.10 and tested that
having both

_HDF5USEDLL_ and H5_BUILT_AS_DYNAMIC_LIB

works well for 5.10 and 5.8.12 (with the later _HDF5USEDLL_ was good enough)

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160504/25f6329a/attachment.html>

From even.rouault at spatialys.com  Wed May  4 14:24:59 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 4 May 2016 23:24:59 +0200
Subject: [gdal-dev] Creation of pages on Trac wiki disabled
In-Reply-To: <201605041849.28985.even.rouault@spatialys.com>
References: <201604272159.01182.even.rouault@spatialys.com>
 <201605041016.32353.even.rouault@spatialys.com>
 <201605041849.28985.even.rouault@spatialys.com>
Message-ID: <201605042324.59596.even.rouault@spatialys.com>

Le mercredi 04 mai 2016 18:49:28, Even Rouault a écrit :
> Le mercredi 04 mai 2016 10:16:32, Even Rouault a écrit :
> > Le lundi 02 mai 2016 11:35:17, Even Rouault a écrit :
> > > Le mercredi 27 avril 2016 21:59:01, Even Rouault a écrit :
> > > > Folks,
> > > > 
> > > > I've removed the right to create new pages on the wiki for the
> > > > 'authenticated' group due to spammers abusting it recently (as well
> > > > as other projects wiki). OSGeo System Administration Committee is
> > > > looking at that, so we might re- enable that if we understand what
> > > > happens. If you need to create pages, ping me and I can give you the
> > > > permission.
> > > 
> > > OSGeo id creation has been hardened, so I've re-enabled wiki page
> > > creation for authenticated users. Please keep an eye if spammers start
> > > abusing it again.
> > 
> > Sigh, I had to disable wiki page creation again as spammers start again.
> > It seems they create manually their OSGeo id, so anti-bot measures at
> > that level don't help.
> 
> We just got spam in a ticket. I've enabled the right to delete (not close,
> real delete) tickets to foks with TRAC_ADMIN priviledges (ie PSC members.
> Just added you Jukka). This should only be used to delete spam.
> 
> I hope we won't have to use it a lot... Not sure about what we could do if
> tickets got massively spammed.

Wiki page re-enabled for authenticated users.

Strk has installed the https://trac.edgewall.org/wiki/SpamFilter plugin so we 
have now a number of settings to play with to limit the spam. PSC members 
should see the different "spam filtering" settings in the Administration pannel 
https://trac.osgeo.org/gdal/admin . According to the advices of 
https://trac.edgewall.org/wiki/SpamFilter, we'll have to play in priority with 
the Bayes filter in priority to sort good vs spam content. If someone gets 
legit content rejected, let us know.

> 
> > > > Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From schwehr at gmail.com  Wed May  4 15:30:01 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 4 May 2016 15:30:01 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
Message-ID: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>

Hi all,

If you've been watching the timeline on trac, you have probably seen a
large number of cleanup CLs from me.  It's definitely past time to get some
discussion going on these changes.  If the community likes these, we can
add them to rfc8_devguide <https://trac.osgeo.org/gdal/wiki/rfc8_devguide>.
We also need to consider tools that help committers push code towards what
we want and keep it there once it conforms to those guides (e.g.
clang-format with a custom GDAL specification)  If you haven't see one of
the changes I've committed yet, here is an example to check out... this
change to geotiff.cpp is likely the biggest I will ever do.

https://trac.osgeo.org/gdal/changeset/34130/

I personally think the goals of style / coding guidelines are:

0. Ensure that GDAL is around for a long time to come
1. Make the code easier to read (which particular patterns to use and
consistent formatting)
2. When the code has trouble or data is bad, fail with error messages
rather than crash
3. Make it easier for debuggers to present sensible state
4. Help static (clang static analyzer, Coverity, etc. ) and dynamic (e.g.
fuzzers) analyzers perform better
5. Make it easier for authors to contribute code that plays well with the
rest of system with the least possible effort

To start off the conversation, I wrote up a doc on changing large C arrays
on the stack to std::vectors to get this data off of the stack and to
simplify initialization.  I've attached the doc inline, but it is also
available here:

goo.gl/vuA3D6

The full url is:
https://docs.google.com/document/d/1Y9flzxj3Uz1vTEPCBmlswgi470m8i-oepGutVkbowfc/pub

It would be great to get people to have at commenting on this proposal.  If
you all like this kind of thing, we can more of them and work them into a
form that extends RFC 8.  Please don't be shy in commenting any way you
feel is constructive on this doc.  We can discuss on this list or if people
really want, I can give individuals comment access to the Google doc.

cheers,
-kurt


Use vector<T>(length, initial_value) for local blocks of storage.

Author: Kurt Schwehr schwehr at google.com / schwehr at gmail.com (goatbar)

Date: 2016-May-04

Consider:

  int anVals[256];

  memset(anVals, 0, 256*sizeof(int));

This is less than optimal because:


   -

   It puts 1K or 2K on the stack, some of us (who can have huge numbers of
   threads) try to keep stack usage to 16K per thread
   -

   You have two places that need to know the size
   -

   The variable exists uninitialized between the definition and
   initialization
   -

   memset is a C API, which is able to do fewer sanity checks
   -

   No bounds checking


In GDAL, there are >700 stack allocations of more than 100 items and > 150
of 1000 or more items.  There are 877 calls to memset in the C++ code.

Proposed solution:

 https://trac.osgeo.org/gdal/changeset/34177

 std::vector<int> oVals(256, 0);

Benefits:


   -

   It can pretty much be used like a C array,  e.g., ++anVals[index]; works
   -

   Using vector gets most of the memory off of the stack and into the heap
   helping threaded programs
   -

   The values are all initialized when anVals is created
   -

   If functions need to get a pointer to a C style array, you can call
   Foo(&anVals[0])
   -

   Compilers can optimize the standard containers.
   -

   Bounds checking is possible without having to resort to ASAN (which not
   all compilers have) or Valgrind


Drawbacks:


   -

   It is possible to change the size of the vector later on in the code
   -

   Vector has some storage overhead and bookkeeping that has to be done
   (but often the compiler can probably optimize away most of that). TODO:
   References that explain this?
   -

   Resizing the array could break anything that was using a C style array
   pointer to the vector’s data


Alternatives

Might be better or worse in different ways:


   -

   Use std::fill instead of memset
   -

   Declare and pass around the array size as a constant, e.g., const int
   knValsSize = 256.
   -

   CPL_ARRAY_SIZE to only have one 256 around
   -

   Use CPLCalloc to put it on the heap and initialize
   -

   Use new[] to put it on the heap
   -

   Use std::array <http://www.cplusplus.com/reference/array/>.  Introduced
   in C++ 11, so currently disallowed.  Still puts the payload on the stack.
   -

   Use std::unique_ptr <http://en.cppreference.com/w/cpp/memory/unique_ptr>
   to put it on the heap. Introduced in C++ 11, so currently disallowed
   -

   Add autoptr to GDAL to put it on the heap.  autoptr is very similar to
   unique_ptr, but works with C++03
   -

   Use some other library like boost.  That would require a major change to
   GDALs build requirements.
   -

   int anVals[256] = { 0 };  Only initializes the first element or you must
   specify all 256 elements.
   -

   Make our own simple class that handles allocation on the heap and cleans
   up in the destructor and provides operator[]


Key GDAL facts to keep in mind:

   -

   Only C++03 is currently allowed
   -

   Want to focus on maintainability and readability of code
   -

   A very diverse set of people work on the GDAL code base
   -

   Currently support a wide range of compilers / platforms:
   -

      32 and 64 bit
      -

      Linux, Android, MacOSX, Windows >= Win7, Cigwin
      -

      Big and little endian
      -

      GCC 4.8, GCC 5.2, MingW, VC9, VC12, VC13
      -

      Build with C++03, C++11, C++14
      -

      Build with C89, C99, C11
      -

      Python 2.7 and >= 3.5  (we might actually support 2.6 and 3.4,
      Idonno)
      -

      https://travis-ci.org/rouault/gdal_coverage/builds/
      -

      https://ci.appveyor.com/project/rouault/gdal-coverage/history
      -

   Want to help Coverity, Address Sanitizer, AFL, Clang Static Analyzer
   -

   GDAL uses a form of


What if ...:

GDAL goes with C++11 or 14?  It would probably be best to stick with the
vector solution as it is simpler than unqiue_ptr and std::array still puts
a large amount of data off the stack.   vector is still the simplest with
initialization.

GDAL does not care about stack size and C++14?  You could do a unqiue_ptr
with a CPLCalloc and a deleter of CPLFree.


   -

   std::unique_ptr<std::array<int, 256>> Vals(new std::array<int, 256>());
   -

   std::unique_ptr<int *, std::function<void(char *)>> Vals(CPLCalloc(256,
   0), CPLFree);
   -

   std::unique_ptr<int *, CplFreeDeleter> Vals( CPLCalloc(256, 0), CPLFree);
   -

      // Function object that calls GDAL's CPLFree on its parameter.
      struct CplFreeDeleter
      <https://cs.corp.google.com/piper///depot/google3/third_party/gdal/autotest2/cpp/util/cpl_memory.h?l=10&gs=cpp%253Aautotest2%253A%253Aclass-CplFreeDeleter%2540google3%252Fthird_party%252Fgdal%252Fautotest2%252Fcpp%252Futil%252Fcpl_memory.h%257Cdef&gsn=CplFreeDeleter&ct=xref_usages>
      {
       void operator()
      <https://cs.corp.google.com/piper///depot/google3/third_party/gdal/autotest2/cpp/util/cpl_memory.h?l=11&gs=cpp%253Aautotest2%253A%253Aclass-CplFreeDeleter%253A%253Aoperator()(void%2B*)%2540google3%252Fthird_party%252Fgdal%252Fautotest2%252Fcpp%252Futil%252Fcpl_memory.h%257Cdef&gsn=operator()&ct=xref_usages>
      (void*
      <https://cs.corp.google.com/piper///depot/google3/GENERATED/figments/cpp/PointerTo/void.cc?l=3&ct=xref_jump_to_def&cl=GROK&gsn=*>
      ptr
      <https://cs.corp.google.com/piper///depot/google3/third_party/gdal/autotest2/cpp/util/cpl_memory.h?l=11&gs=cpp%253Aautotest2%253A%253Aclass-CplFreeDeleter%253A%253Aoperator()(void%2B*)%253A%253Aparam-ptr%2540google3%252Fthird_party%252Fgdal%252Fautotest2%252Fcpp%252Futil%252Fcpl_memory.h%257Cdef&gsn=ptr&ct=xref_usages>)
      { CPLFree
      <https://cs.corp.google.com/piper///depot/google3/blaze-out/gcc-4.X.Y-crosstool-v18-hybrid-grtev4-k8-fastbuild/include/third_party/gdal/_/gdal/third_party/gdal/port/cpl_conv.h?l=72&ct=xref_jump_to_def&cl=GROK&gsn=CPLFree>
      (ptr
      <https://cs.corp.google.com/piper///depot/google3/third_party/gdal/autotest2/cpp/util/cpl_memory.h?l=11&ct=xref_jump_to_def&cl=GROK&gsn=ptr>);
      }
      };
      -

   std::unique_ptr<int[]> Vals(new int[256]);


Open questions:

   -

   At what size do we want to make as the initial threshold to recommend
   heap verses stack?  32 bytes seems like no big deal on the stack and 512
   bytes seems like it really needs to be on the heap without a specific
   reason.


See also:

https://trac.osgeo.org/gdal/ticket/5748 Reduce GDAL stack usage

https://google.github.io/styleguide/cppguide.html#Local_Variables

http://stackoverflow.com/questions/22571052/replace-fixed-size-arrays-with-stdarray

http://stackoverflow.com/questions/15294129/overhead-to-using-stdvector

http://www.cplusplus.com/reference/memory/unique_ptr/operator[]/
<about:blank>

http://stackoverflow.com/questions/16711697/is-there-any-use-for-unique-ptr-with-array

Acknowledgements:

Several Google engineers commented on an initial draft of this doc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160504/94ce5c13/attachment-0001.html>

From mateusz at loskot.net  Wed May  4 15:51:28 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed, 4 May 2016 23:51:28 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
Message-ID: <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>

On 4 May 2016 at 23:30, Kurt Schwehr <schwehr at gmail.com> wrote:

>
> To start off the conversation, I wrote up a doc on changing large C arrays
> on the stack to std::vectors to get this data off of the stack and to
> simplify initialization.
>


Since many, if not most, of the ideas rely on availability of the C++11
features,
it might be a good idea to first agree on C++11 as the lowest
required C++ compilation mode.

Let's poll if there are any users who require C++03 at all.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160504/15387474/attachment.html>

From even.rouault at spatialys.com  Wed May  4 16:45:49 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 5 May 2016 01:45:49 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
Message-ID: <201605050145.50442.even.rouault@spatialys.com>

Le jeudi 05 mai 2016 00:51:28, Mateusz Loskot a écrit :
> On 4 May 2016 at 23:30, Kurt Schwehr <schwehr at gmail.com> wrote:
> > To start off the conversation, I wrote up a doc on changing large C
> > arrays on the stack to std::vectors to get this data off of the stack
> > and to simplify initialization.
> 
> Since many, if not most, of the ideas rely on availability of the C++11
> features,
> it might be a good idea to first agree on C++11 as the lowest
> required C++ compilation mode.
> 
> Let's poll if there are any users who require C++03 at all.

I think there are different topics in what Kurt proposes :
- style and other changes that are not bound to a particular compiler version
- changes potentially dependant of the C++ version

Of the potential issues with requiring C++11, I can think of OSGeo4W. It is 
mostly(completely?) built with Visual Studio 2010. And from 
https://msdn.microsoft.com/en-us/library/hh567368.aspx , support of C++11 is 
only partial in VS 2010

Regarding the current use of VS2010 in OSGeo4W, this is discussed here : 
https://lists.osgeo.org/pipermail/discuss/2016-February/015658.html

Potentially we could imagine having GDAL compiled with a later VS version and 
have the rest using VS2010, since most (all?) other software in OSGeo4W use it 
probably through its C API. Hum, actually that must not be true for OTB that 
uses the C++ API I think. Perhaps Jürgen has something to add regarding this 
compiler issue ?

On the other hand regarding dependencies of GDAL, the binary propritary SDKs 
with a C++ API could be a problem, although they will likely move on too. 
- FileGDB SDK 1.4: available for VS2010, VS2012, VS2013
- ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
- MrSID SDK: I didn't check. Perhaps Kirk can tell us ?
But I'm not sure about the compatibility of C++11 build against non-C++11 
builds in the VS realm : can a GDAL C++11 build link against a library built 
without C++11 enabled ? Will not there be ABI problems ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jamessramm at gmail.com  Thu May  5 00:42:26 2016
From: jamessramm at gmail.com (jramm)
Date: Thu, 5 May 2016 00:42:26 -0700 (PDT)
Subject: [gdal-dev] Segfault in GDALWriteBlock
Message-ID: <1462434146978-5264660.post@n6.nabble.com>

Hi I am getting a segfault in a call to GDALWriteBlock with this code:



Stepping through seems to suggest that the segfault is arising from line 171
of "geo_new.c" in libgeotiff:



I cant find previsely what it is I have done wrong to cause this in my
code....any ideas?



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Segfault-in-GDALWriteBlock-tp5264660.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From bishop.dev at gmail.com  Thu May  5 01:14:56 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Thu, 5 May 2016 11:14:56 +0300
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605050145.50442.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
Message-ID: <572B0100.2010209@gmail.com>

Hi,

I think it's time to go forward and shift to C++11 in i.e. GDAL 2.2 and 
drop old staff as it was with Windows mobile support, VB, etc.
Yes, it may be some regression in ABI, but this is less evil than 
support lot of ancient compilers.

During our work on cmake build system for GDAL I faced that some 
dependency library needs VC2013SP2 on Windows - i.e liblzma, as it needs 
C99.
We worked around it by including some logic to cmake, that if VC 
compiler is less than specific version the support of dependent features 
will be disabled.

By the way, the repo with cmake for GDAL is here: 
https://github.com/nextgis-extra/lib_gdal
The ubuntu ppa of libgdal2 build using cmake: 
https://launchpad.net/~nextgis/+archive/ubuntu/ppa/+packages
Windows builds also using cmake: http://nextgis.ru/en/borsch/

Please note, that most but not all drivers are available now (for 
details see readme in repo) and only python bindings.

Best regards,
     Dmitry

05.05.2016 02:45, Even Rouault пишет:
> Le jeudi 05 mai 2016 00:51:28, Mateusz Loskot a écrit :
>> On 4 May 2016 at 23:30, Kurt Schwehr <schwehr at gmail.com> wrote:
>>> To start off the conversation, I wrote up a doc on changing large C
>>> arrays on the stack to std::vectors to get this data off of the stack
>>> and to simplify initialization.
>> Since many, if not most, of the ideas rely on availability of the C++11
>> features,
>> it might be a good idea to first agree on C++11 as the lowest
>> required C++ compilation mode.
>>
>> Let's poll if there are any users who require C++03 at all.
> I think there are different topics in what Kurt proposes :
> - style and other changes that are not bound to a particular compiler version
> - changes potentially dependant of the C++ version
>
> Of the potential issues with requiring C++11, I can think of OSGeo4W. It is
> mostly(completely?) built with Visual Studio 2010. And from
> https://msdn.microsoft.com/en-us/library/hh567368.aspx , support of C++11 is
> only partial in VS 2010
>
> Regarding the current use of VS2010 in OSGeo4W, this is discussed here :
> https://lists.osgeo.org/pipermail/discuss/2016-February/015658.html
>
> Potentially we could imagine having GDAL compiled with a later VS version and
> have the rest using VS2010, since most (all?) other software in OSGeo4W use it
> probably through its C API. Hum, actually that must not be true for OTB that
> uses the C++ API I think. Perhaps Jürgen has something to add regarding this
> compiler issue ?
>
> On the other hand regarding dependencies of GDAL, the binary propritary SDKs
> with a C++ API could be a problem, although they will likely move on too.
> - FileGDB SDK 1.4: available for VS2010, VS2012, VS2013
> - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
> - MrSID SDK: I didn't check. Perhaps Kirk can tell us ?
> But I'm not sure about the compatibility of C++11 build against non-C++11
> builds in the VS realm : can a GDAL C++11 build link against a library built
> without C++11 enabled ? Will not there be ABI problems ?
>
> Even
>


From p.halls at york.ac.uk  Thu May  5 01:17:24 2016
From: p.halls at york.ac.uk (Peter Halls)
Date: Thu, 5 May 2016 09:17:24 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605050145.50442.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
Message-ID: <CADEnnOOWUJux-7j1FpYmRRYqTmbAQp+KkzGbKS9ySe5XwUg9BQ@mail.gmail.com>

I am a humble geologist, rather than a Computer Scientist, and do not
pretend to understand all the ins-and-outs of this type of discussion - and
hence read, in the hopes of learning, but otherwise keep quiet!

I suspect that I am also something of a 'throw-back' in that I continue to
use Simula as my primary programming language.  Today's Simula compilers
are 'cross-compilers', in that they generate code in c, which is then
compiled and linked with an appropriate c compiler (it actually makes
providing software for multiple platforms a lot easier ...).

Having said that, my only concern with the use of (C++) Vector structures,
rather than c Arrays, would be the mappability required between application
language and implementation language.  If the C++ structures are universal,
fine.  If not, then either interface code (needing maintenance) or c
alternatives would be needed.  My example is based on Simula: it would be
interesting to know how Java or Python might interact.

Best wishes,

Peter


On 5 May 2016 at 00:45, Even Rouault <even.rouault at spatialys.com> wrote:

> Le jeudi 05 mai 2016 00:51:28, Mateusz Loskot a écrit :
> > On 4 May 2016 at 23:30, Kurt Schwehr <schwehr at gmail.com> wrote:
> > > To start off the conversation, I wrote up a doc on changing large C
> > > arrays on the stack to std::vectors to get this data off of the stack
> > > and to simplify initialization.
> >
> > Since many, if not most, of the ideas rely on availability of the C++11
> > features,
> > it might be a good idea to first agree on C++11 as the lowest
> > required C++ compilation mode.
> >
> > Let's poll if there are any users who require C++03 at all.
>
> I think there are different topics in what Kurt proposes :
> - style and other changes that are not bound to a particular compiler
> version
> - changes potentially dependant of the C++ version
>
> Of the potential issues with requiring C++11, I can think of OSGeo4W. It is
> mostly(completely?) built with Visual Studio 2010. And from
> https://msdn.microsoft.com/en-us/library/hh567368.aspx , support of C++11
> is
> only partial in VS 2010
>
> Regarding the current use of VS2010 in OSGeo4W, this is discussed here :
> https://lists.osgeo.org/pipermail/discuss/2016-February/015658.html
>
> Potentially we could imagine having GDAL compiled with a later VS version
> and
> have the rest using VS2010, since most (all?) other software in OSGeo4W
> use it
> probably through its C API. Hum, actually that must not be true for OTB
> that
> uses the C++ API I think. Perhaps Jürgen has something to add regarding
> this
> compiler issue ?
>
> On the other hand regarding dependencies of GDAL, the binary propritary
> SDKs
> with a C++ API could be a problem, although they will likely move on too.
> - FileGDB SDK 1.4: available for VS2010, VS2012, VS2013
> - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
> - MrSID SDK: I didn't check. Perhaps Kirk can tell us ?
> But I'm not sure about the compatibility of C++11 build against non-C++11
> builds in the VS realm : can a GDAL C++11 build link against a library
> built
> without C++11 enabled ? Will not there be ABI problems ?
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev




-- 
----------------------------------------------------------------------------------------------------------------
Peter J Halls, PhD Student, Post-war Reconstruction and Development Unit
(PRDU),
                      University of York

Snail mail: PRDU, Derwent College, University of York,
                Heslington, York YO10 5DD
This message has the status of a private and personal communication
----------------------------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/8d0af450/attachment.html>

From mateusz at loskot.net  Thu May  5 02:09:48 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 5 May 2016 11:09:48 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605050145.50442.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
Message-ID: <CABUeae8M8TFcyXGTFd3+gQ4BZ8nk0036bwN1LB3pvOhS1vgpiQ@mail.gmail.com>

On 5 May 2016 at 01:45, Even Rouault <even.rouault at spatialys.com> wrote:
> Of the potential issues with requiring C++11, I can think of OSGeo4W. It is
> mostly(completely?) built with Visual Studio 2010. And from
> https://msdn.microsoft.com/en-us/library/hh567368.aspx , support of C++11 is
> only partial in VS 2010

VS2013 is the lowest version sensible to consider regarding C++11 support.

> On the other hand regarding dependencies of GDAL, the binary propritary SDKs
> with a C++ API could be a problem, although they will likely move on too.
> - FileGDB SDK 1.4: available for VS2010, VS2012, VS2013
> - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013

AFAICT, GDAL built using VS2015 links against the 5.2.1 version fine.

> - MrSID SDK: I didn't check. Perhaps Kirk can tell us ?

Similarly to the ECW above, version 9.1.0 links fine too.

> But I'm not sure about the compatibility of C++11 build against non-C++11
> builds in the VS realm : can a GDAL C++11 build link against a library built
> without C++11 enabled ? Will not there be ABI problems ?

Although mixing C run-time libraries is a bad idea generally,
kosher C APIs should be fine.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From even.rouault at spatialys.com  Thu May  5 02:28:14 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 5 May 2016 11:28:14 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae8M8TFcyXGTFd3+gQ4BZ8nk0036bwN1LB3pvOhS1vgpiQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
 <CABUeae8M8TFcyXGTFd3+gQ4BZ8nk0036bwN1LB3pvOhS1vgpiQ@mail.gmail.com>
Message-ID: <201605051128.14412.even.rouault@spatialys.com>

Le jeudi 05 mai 2016 11:09:48, Mateusz Loskot a écrit :
> On 5 May 2016 at 01:45, Even Rouault <even.rouault at spatialys.com> wrote:
> > Of the potential issues with requiring C++11, I can think of OSGeo4W. It
> > is mostly(completely?) built with Visual Studio 2010. And from
> > https://msdn.microsoft.com/en-us/library/hh567368.aspx , support of C++11
> > is only partial in VS 2010
> 
> VS2013 is the lowest version sensible to consider regarding C++11 support.
> 
> > On the other hand regarding dependencies of GDAL, the binary propritary
> > SDKs with a C++ API could be a problem, although they will likely move
> > on too. - FileGDB SDK 1.4: available for VS2010, VS2012, VS2013
> > - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
> 
> AFAICT, GDAL built using VS2015 links against the 5.2.1 version fine.

Do you link against the VS2013 .lib ?
> 
> > - MrSID SDK: I didn't check. Perhaps Kirk can tell us ?
> 
> Similarly to the ECW above, version 9.1.0 links fine too.
> 
> > But I'm not sure about the compatibility of C++11 build against non-C++11
> > builds in the VS realm : can a GDAL C++11 build link against a library
> > built without C++11 enabled ? Will not there be ABI problems ?
> 
> Although mixing C run-time libraries is a bad idea generally,
> kosher C APIs should be fine.

I'm not too worried about C ABI. My mention of C++03 ABI vs C++11 ABI was for 
the dependencies with those SDK that we use through their C++ API. In GCC 
world, with same compiler but with different -std=... flags, there have been 
troubles ( https://gcc.gnu.org/wiki/Cxx11AbiCompatibility , 
https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_dual_abi.html ), so I 
was wondering how the situation is in the VS world.
Actually since I mention this, the issue does apply to Linux too. Looking at 
the C++11 Linux build ( 
https://github.com/rouault/gdal_coverage/blob/trunk_gcc4.8_stdc11/.travis.yml 
) , I see I couldn't build against FileGDB with -std=c++11. This was a 
compilation issue with its headers, rather than a link/runtime issue.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mateusz at loskot.net  Thu May  5 03:15:14 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 5 May 2016 12:15:14 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605051128.14412.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
 <CABUeae8M8TFcyXGTFd3+gQ4BZ8nk0036bwN1LB3pvOhS1vgpiQ@mail.gmail.com>
 <201605051128.14412.even.rouault@spatialys.com>
Message-ID: <CABUeae_UEP+EMVG4qse-BenP3NfVo_oV-SykFZA=NUtXs0X0Zg@mail.gmail.com>

On 5 May 2016 at 11:28, Even Rouault <even.rouault at spatialys.com> wrote:
> Le jeudi 05 mai 2016 11:09:48, Mateusz Loskot a écrit :
>> On 5 May 2016 at 01:45, Even Rouault <even.rouault at spatialys.com> wrote:
>> > Of the potential issues with requiring C++11, I can think of OSGeo4W. It
>> > is mostly(completely?) built with Visual Studio 2010. And from
>> > https://msdn.microsoft.com/en-us/library/hh567368.aspx , support of C++11
>> > is only partial in VS 2010
>>
>> VS2013 is the lowest version sensible to consider regarding C++11 support.
>>
>> > On the other hand regarding dependencies of GDAL, the binary propritary
>> > SDKs with a C++ API could be a problem, although they will likely move
>> > on too. - FileGDB SDK 1.4: available for VS2010, VS2012, VS2013
>> > - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
>>
>> AFAICT, GDAL built using VS2015 links against the 5.2.1 version fine.
>
> Do you link against the VS2013 .lib ?

Yes, namely these:

ls -1 ERDAS_ECW_JPEG_2000\lib\vc120\Win32
NCSEcw.lib
NCSEcwd.lib
NCSEcwS.lib
NCSEcwSd.lib

>> > - MrSID SDK: I didn't check. Perhaps Kirk can tell us ?
>>
>> Similarly to the ECW above, version 9.1.0 links fine too.
>>
>> > But I'm not sure about the compatibility of C++11 build against non-C++11
>> > builds in the VS realm : can a GDAL C++11 build link against a library
>> > built without C++11 enabled ? Will not there be ABI problems ?
>>
>> Although mixing C run-time libraries is a bad idea generally,
>> kosher C APIs should be fine.
>
> I'm not too worried about C ABI. My mention of C++03 ABI vs C++11 ABI was for
> the dependencies with those SDK that we use through their C++ API

Visual C++ does not promise ABI compatibility for anything but a
"portable type" [1]
- a C built-in type or a struct that contains only C built-in types

Mixing binaries built with different compiler versions or even
compiler/linker settings
is not recommended [2]. It might or might not work :)

[1] https://msdn.microsoft.com/en-us/library/hh438475.aspx
[2] https://msdn.microsoft.com/en-us/library/bb531344.aspx

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From jmckenna at gatewaygeomatics.com  Thu May  5 05:10:55 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 5 May 2016 09:10:55 -0300
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <572B0100.2010209@gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com> <572B0100.2010209@gmail.com>
Message-ID: <a62bb9db-d0a6-e012-dbd4-0e2c2d63a08d@gatewaygeomatics.com>

On 2016-05-05 5:14 AM, Dmitry Baryshnikov wrote:
> Hi,
>
> I think it's time to go forward and shift to C++11 in i.e. GDAL 2.2 and
> drop old staff as it was with Windows mobile support, VB, etc.
> Yes, it may be some regression in ABI, but this is less evil than
> support lot of ancient compilers.
>
> During our work on cmake build system for GDAL I faced that some
> dependency library needs VC2013SP2 on Windows - i.e liblzma, as it needs
> C99.
> We worked around it by including some logic to cmake, that if VC
> compiler is less than specific version the support of dependent features
> will be disabled.
>
> By the way, the repo with cmake for GDAL is here:
> https://github.com/nextgis-extra/lib_gdal
> The ubuntu ppa of libgdal2 build using cmake:
> https://launchpad.net/~nextgis/+archive/ubuntu/ppa/+packages
> Windows builds also using cmake: http://nextgis.ru/en/borsch/

About a month ago I made the hard decision to upgrade my entire MS4W 
build environment from VC 2008 to 2015.  Driving this is that PHP 7 only 
supports 2015.

The only GDAL dependent library not supported for VC 2015 is FileGDB 
(I've seen an Esri developer state that 2015 SDK will be released with 
their next FileGDB API upgrade).

MrSID 9.5.1 SDK works well with 2015.

I didn't try an ECW 5.x SDK, but the old 3.3 SDK works well with 2015.

Short story is I support future GDAL builds requiring a more recent 
Visual Studio compiler (2013+), as other projects are already doing so.

For those packagers cringing in the thought of upgrading their whole 
stack: join the club :)

-jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From jmckenna at gatewaygeomatics.com  Thu May  5 05:22:03 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 5 May 2016 09:22:03 -0300
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <a62bb9db-d0a6-e012-dbd4-0e2c2d63a08d@gatewaygeomatics.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com> <572B0100.2010209@gmail.com>
 <a62bb9db-d0a6-e012-dbd4-0e2c2d63a08d@gatewaygeomatics.com>
Message-ID: <33326579-7a28-b336-0bde-441445e68cb6@gatewaygeomatics.com>

On 2016-05-05 9:10 AM, Jeff McKenna wrote:
> On 2016-05-05 5:14 AM, Dmitry Baryshnikov wrote:
>> Hi,
>>
>> I think it's time to go forward and shift to C++11 in i.e. GDAL 2.2 and
>> drop old staff as it was with Windows mobile support, VB, etc.
>> Yes, it may be some regression in ABI, but this is less evil than
>> support lot of ancient compilers.
>>
>> During our work on cmake build system for GDAL I faced that some
>> dependency library needs VC2013SP2 on Windows - i.e liblzma, as it needs
>> C99.
>> We worked around it by including some logic to cmake, that if VC
>> compiler is less than specific version the support of dependent features
>> will be disabled.
>>
>> By the way, the repo with cmake for GDAL is here:
>> https://github.com/nextgis-extra/lib_gdal
>> The ubuntu ppa of libgdal2 build using cmake:
>> https://launchpad.net/~nextgis/+archive/ubuntu/ppa/+packages
>> Windows builds also using cmake: http://nextgis.ru/en/borsch/
>
> About a month ago I made the hard decision to upgrade my entire MS4W
> build environment from VC 2008 to 2015.  Driving this is that PHP 7 only
> supports 2015.
>
> The only GDAL dependent library not supported for VC 2015 is FileGDB
> (I've seen an Esri developer state that 2015 SDK will be released with
> their next FileGDB API upgrade).
>
> MrSID 9.5.1 SDK works well with 2015.
>
> I didn't try an ECW 5.x SDK, but the old 3.3 SDK works well with 2015.
>
> Short story is I support future GDAL builds requiring a more recent
> Visual Studio compiler (2013+), as other projects are already doing so.
>
> For those packagers cringing in the thought of upgrading their whole
> stack: join the club :)
>

I should also note that for compiling Python 3.5.x VC 2015 is the 
supported environment.  Yet another GDAL dependent library that favors 
an upgraded compiler on Windows.

-jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From jluis at ualg.pt  Thu May  5 05:37:19 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Thu, 05 May 2016 13:37:19 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <a62bb9db-d0a6-e012-dbd4-0e2c2d63a08d@gatewaygeomatics.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com> <572B0100.2010209@gmail.com>
 <a62bb9db-d0a6-e012-dbd4-0e2c2d63a08d@gatewaygeomatics.com>
Message-ID: <op.ygzpchbndbaoe8@macmarilu>

I'm also updating my builds to support 2015 for a future inclusion in GMT.
There is, however, a bit storm ahead. Files created with HDF5.10 break  
compatibility with older versions and can't be read. Put netCDF in this  
bag as well. See GMT's #3495 for a recent case.

http://gmt.soest.hawaii.edu/boards/1/topics/3495


> On 2016-05-05 5:14 AM, Dmitry Baryshnikov wrote:
>> Hi,
>>
>> I think it's time to go forward and shift to C++11 in i.e. GDAL 2.2 and
>> drop old staff as it was with Windows mobile support, VB, etc.
>> Yes, it may be some regression in ABI, but this is less evil than
>> support lot of ancient compilers.
>>
>> During our work on cmake build system for GDAL I faced that some
>> dependency library needs VC2013SP2 on Windows - i.e liblzma, as it needs
>> C99.
>> We worked around it by including some logic to cmake, that if VC
>> compiler is less than specific version the support of dependent features
>> will be disabled.
>>
>> By the way, the repo with cmake for GDAL is here:
>> https://github.com/nextgis-extra/lib_gdal
>> The ubuntu ppa of libgdal2 build using cmake:
>> https://launchpad.net/~nextgis/+archive/ubuntu/ppa/+packages
>> Windows builds also using cmake: http://nextgis.ru/en/borsch/
>
> About a month ago I made the hard decision to upgrade my entire MS4W  
> build environment from VC 2008 to 2015.  Driving this is that PHP 7 only  
> supports 2015.
>
> The only GDAL dependent library not supported for VC 2015 is FileGDB  
> (I've seen an Esri developer state that 2015 SDK will be released with  
> their next FileGDB API upgrade).
>
> MrSID 9.5.1 SDK works well with 2015.
>
> I didn't try an ECW 5.x SDK, but the old 3.3 SDK works well with 2015.
>
> Short story is I support future GDAL builds requiring a more recent  
> Visual Studio compiler (2013+), as other projects are already doing so.
>
> For those packagers cringing in the thought of upgrading their whole  
> stack: join the club :)
>
> -jeff
>
>
>

From even.rouault at spatialys.com  Thu May  5 06:26:33 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 5 May 2016 15:26:33 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <33326579-7a28-b336-0bde-441445e68cb6@gatewaygeomatics.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <a62bb9db-d0a6-e012-dbd4-0e2c2d63a08d@gatewaygeomatics.com>
 <33326579-7a28-b336-0bde-441445e68cb6@gatewaygeomatics.com>
Message-ID: <201605051526.33407.even.rouault@spatialys.com>

Le jeudi 05 mai 2016 14:22:03, Jeff McKenna a écrit :
> On 2016-05-05 9:10 AM, Jeff McKenna wrote:
> > On 2016-05-05 5:14 AM, Dmitry Baryshnikov wrote:
> >> Hi,
> >> 
> >> I think it's time to go forward and shift to C++11 in i.e. GDAL 2.2 and
> >> drop old staff as it was with Windows mobile support, VB, etc.
> >> Yes, it may be some regression in ABI, but this is less evil than
> >> support lot of ancient compilers.
> >> 
> >> During our work on cmake build system for GDAL I faced that some
> >> dependency library needs VC2013SP2 on Windows - i.e liblzma, as it needs
> >> C99.
> >> We worked around it by including some logic to cmake, that if VC
> >> compiler is less than specific version the support of dependent features
> >> will be disabled.
> >> 
> >> By the way, the repo with cmake for GDAL is here:
> >> https://github.com/nextgis-extra/lib_gdal
> >> The ubuntu ppa of libgdal2 build using cmake:
> >> https://launchpad.net/~nextgis/+archive/ubuntu/ppa/+packages
> >> Windows builds also using cmake: http://nextgis.ru/en/borsch/
> > 
> > About a month ago I made the hard decision to upgrade my entire MS4W
> > build environment from VC 2008 to 2015.  Driving this is that PHP 7 only
> > supports 2015.
> > 
> > The only GDAL dependent library not supported for VC 2015 is FileGDB
> > (I've seen an Esri developer state that 2015 SDK will be released with
> > their next FileGDB API upgrade).
> > 
> > MrSID 9.5.1 SDK works well with 2015.
> > 
> > I didn't try an ECW 5.x SDK, but the old 3.3 SDK works well with 2015.
> > 
> > Short story is I support future GDAL builds requiring a more recent
> > Visual Studio compiler (2013+), as other projects are already doing so.
> > 
> > For those packagers cringing in the thought of upgrading their whole
> > stack: join the club :)
> 
> I should also note that for compiling Python 3.5.x VC 2015 is the
> supported environment.  Yet another GDAL dependent library that favors
> an upgraded compiler on Windows.

Thanks for your feedback. Although I'd note that upgrading compiler version is 
one thing, and enabling C++11 mode *might* be another, particularly if there's 
a mix of C++ libs linking against each other. But from what I can read, it 
seems that with Visual Studio you don't have the equivalent of -std=c++?? of 
GCC, so if things are compiled with the same VS version, that should be OK.

Might be a little trickier with GCC, particularly with the new GCC 5 C++11 
*ABI* and the dual ABI thing 
(https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_dual_abi.html), but if 
I understand well, if people use the same GCC version and do not play with 
_GLIBCXX_USE_CXX11_ABI, linking code compiled with different -std=C++?? setting 
should work.

I've confirmed it with the following experiment:

$ cat a.cpp 
#include <string>

std::string foo()
{
  return std::string("foo");
}

With gcc 5.2, both
g++ -std=c++11 -fPIC -shared a.cpp -o liba.so
g++ -std=c++03 -fPIC -shared a.cpp -o liba.so
result in the following symbol to be exported:
_Z3fooB5cxx11v

whereas if you add -D_GLIBCXX_USE_CXX11_ABI=0, the symbol name is _Z3foov, 
which is the same as if you compile with GCC 4.X

So the potential problems would be when linking a GCC 5 compiled GDAL (whether 
it be C++03 or C++11) against a GCC 4.X compiled lib (think of one of the 
SDK), so this might already occur currently. Or reversely, if an 
application/library compiled with GCC 4.X would link against GDAL compiled 
with GCC 5.X

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From schwehr at gmail.com  Thu May  5 06:56:27 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Thu, 5 May 2016 06:56:27 -0700
Subject: [gdal-dev] Segfault in GDALWriteBlock
In-Reply-To: <1462434146978-5264660.post@n6.nabble.com>
References: <1462434146978-5264660.post@n6.nabble.com>
Message-ID: <CACmBxyuJgPmLBJOsFRLy66bg0iTqmKKqo6JJGeacSV7yaHtutA@mail.gmail.com>

What version of GDAL are you using?  Can you provide the command or calling
code that you are using?   Can you use a debugger and give a stack trace?

On Thu, May 5, 2016 at 12:42 AM, jramm <jamessramm at gmail.com> wrote:

> Hi I am getting a segfault in a call to GDALWriteBlock with this code:
>
>
>
> Stepping through seems to suggest that the segfault is arising from line
> 171
> of "geo_new.c" in libgeotiff:
>
>
>
> I cant find previsely what it is I have done wrong to cause this in my
> code....any ideas?
>
>
>
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/Segfault-in-GDALWriteBlock-tp5264660.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev




-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/e3c11bc2/attachment-0001.html>

From gdal at stripfamily.net  Thu May  5 07:14:34 2016
From: gdal at stripfamily.net (David Strip)
Date: Thu, 5 May 2016 08:14:34 -0600
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
Message-ID: <572B554A.1000503@stripfamily.net>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/94961088/attachment.html>

From even.rouault at spatialys.com  Thu May  5 07:31:05 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 5 May 2016 16:31:05 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <572B554A.1000503@stripfamily.net>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <572B554A.1000503@stripfamily.net>
Message-ID: <201605051631.05817.even.rouault@spatialys.com>

Le jeudi 05 mai 2016 16:14:34, David Strip a écrit :
> On 5/4/2016 4:30 PM, Kurt Schwehr wrote:
> 
> 
> <description of approach using std::vector>
> 
> 
> 
> 
> Drawbacks:
> 
> 
> It is possible to change the size of the vector later on in the code
> Vector has some storage overhead and bookkeeping that has to be done (but
> often the compiler can probably optimize away most of that). TODO:
> References that explain this? Resizing the array could break anything that
> was using a C style array pointer to the vector’s data
> 
>  Drawbacks one and three can be eliminated by deriving a class from vector
> that hides resize, so there really is only the single drawback of storage
> overhead and bookkeeping, which are often minor.

I'd not find it very attractive to create our own class just to prevent 
resizing for such a simple thing as an array of integers... "std::vector<int> 
oVals(256, 0)" is very readable. If it must not be resized for some reason, a 
comment should do.

One thing to keep in mind however is the potential impact of heap allocation 
in performance sensitive code paths.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From andrew.bell.ia at gmail.com  Thu May  5 07:49:37 2016
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Thu, 5 May 2016 09:49:37 -0500
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605051526.33407.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <a62bb9db-d0a6-e012-dbd4-0e2c2d63a08d@gatewaygeomatics.com>
 <33326579-7a28-b336-0bde-441445e68cb6@gatewaygeomatics.com>
 <201605051526.33407.even.rouault@spatialys.com>
Message-ID: <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>

On Thu, May 5, 2016 at 8:26 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Might be a little trickier with GCC, particularly with the new GCC 5 C++11
> *ABI* and the dual ABI thing
> (https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_dual_abi.html),
> but if
> I understand well, if people use the same GCC version and do not play with
> _GLIBCXX_USE_CXX11_ABI, linking code compiled with different -std=C++??
> setting
> should work.
>
> I've confirmed it with the following experiment:
>
> $ cat a.cpp
> #include <string>
>
> std::string foo()
> {
>   return std::string("foo");
> }
>
> With gcc 5.2, both
> g++ -std=c++11 -fPIC -shared a.cpp -o liba.so
> g++ -std=c++03 -fPIC -shared a.cpp -o liba.so
> result in the following symbol to be exported:
> _Z3fooB5cxx11v
>
> whereas if you add -D_GLIBCXX_USE_CXX11_ABI=0, the symbol name is _Z3foov,
> which is the same as if you compile with GCC 4.X
>
> So the potential problems would be when linking a GCC 5 compiled GDAL
> (whether
> it be C++03 or C++11) against a GCC 4.X compiled lib (think of one of the
> SDK), so this might already occur currently. Or reversely, if an
> application/library compiled with GCC 4.X would link against GDAL compiled
> with GCC 5.X
>

ABI compatibility is a mess: https://isocpp.org/files/papers/n4028.pdf

With that in mind, what you do inside your own codebase isn't much of an
issue and I'm guessing that even if GDAL wants to be as accommodating as
possible, maintainers of dependent libraries probably won't take such
care.  In the end, if you're doing development and building things
yourself, you need to make sure you use the same compiler and switches for
everything if you're providing a C++ interface.  Is this a pain?  Yes.  Is
it necessary?  Yes.

As for the notion of replacing some allocations with vectors, well, great.
But the GDAL codebase is creaky in lots of places and to get too particular
about the advantage/disadvantage of vectors seems a little silly.  At some
point it's just reasonable to say that you're only going to support
compilers/systems made after some date/version.  People who don't want to
upgrade a system aren't harmed.  They always have access to an older
version of the library.  There is just so much cruft in GDAL that could
benefit from use of the standard library and C++ 11 that I don't know where
to start.

That said, changing code that works just because you like this or that
language feature always presents an opportunity for bugs to creep in.

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/2f5a3d20/attachment.html>

From mateusz at loskot.net  Thu May  5 08:14:01 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 5 May 2016 17:14:01 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605051631.05817.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <572B554A.1000503@stripfamily.net>
 <201605051631.05817.even.rouault@spatialys.com>
Message-ID: <CABUeae96hOjc12Qa4zZx8efXtZ6XYiFixRHT2gxsjuuF7PzuLw@mail.gmail.com>

On 5 May 2016 at 16:31, Even Rouault <even.rouault at spatialys.com> wrote:
> Le jeudi 05 mai 2016 16:14:34, David Strip a écrit :
>> On 5/4/2016 4:30 PM, Kurt Schwehr wrote:
>>
>> Drawbacks:
>>
>>
>> It is possible to change the size of the vector later on in the code
>> Vector has some storage overhead and bookkeeping that has to be done (but
>> often the compiler can probably optimize away most of that). TODO:
>> References that explain this? Resizing the array could break anything that
>> was using a C style array pointer to the vector’s data
>>
>>  Drawbacks one and three can be eliminated by deriving a class from vector
>> that hides resize, so there really is only the single drawback of storage
>> overhead and bookkeeping, which are often minor.
>
> I'd not find it very attractive to create our own class just to prevent
> resizing for such a simple thing as an array of integers... "std::vector<int>
> oVals(256, 0)" is very readable. If it must not be resized for some reason, a
> comment should do.

An assertion, you mean :)

> One thing to keep in mind however is the potential impact of heap allocation
> in performance sensitive code paths.

Indeed.
I would divide Kurt's proposal to several phases, roughly:
1. Switch to C++11
2. Refactor: clean-up, clarify, simplify, make it less error prone
using C++11 idioms and features (i.e. int[256] => std::array<int,
256>)
3. Update coding guidelines
4. Measure and optimise using C++11 features with potential
functional/behavioural changes (yes, switch from stack to heap
allocation drags a behavioural change, e.g. exceptions).

Although it looks like a long and boring process, points 2 and 4 are
optional, IMO.
However, mixing plain refactoring with functional and behaviour
changes is a bad idea.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From even.rouault at spatialys.com  Thu May  5 08:15:38 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 5 May 2016 17:15:38 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605051526.33407.even.rouault@spatialys.com>
 <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>
Message-ID: <201605051715.38075.even.rouault@spatialys.com>

Le jeudi 05 mai 2016 16:49:37, Andrew Bell a écrit :
> On Thu, May 5, 2016 at 8:26 AM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > Might be a little trickier with GCC, particularly with the new GCC 5
> > C++11 *ABI* and the dual ABI thing
> > (https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_dual_abi.html),
> > but if
> > I understand well, if people use the same GCC version and do not play
> > with _GLIBCXX_USE_CXX11_ABI, linking code compiled with different
> > -std=C++?? setting
> > should work.
> > 
> > I've confirmed it with the following experiment:
> > 
> > $ cat a.cpp
> > #include <string>
> > 
> > std::string foo()
> > {
> > 
> >   return std::string("foo");
> > 
> > }
> > 
> > With gcc 5.2, both
> > g++ -std=c++11 -fPIC -shared a.cpp -o liba.so
> > g++ -std=c++03 -fPIC -shared a.cpp -o liba.so
> > result in the following symbol to be exported:
> > _Z3fooB5cxx11v
> > 
> > whereas if you add -D_GLIBCXX_USE_CXX11_ABI=0, the symbol name is
> > _Z3foov, which is the same as if you compile with GCC 4.X
> > 
> > So the potential problems would be when linking a GCC 5 compiled GDAL
> > (whether
> > it be C++03 or C++11) against a GCC 4.X compiled lib (think of one of the
> > SDK), so this might already occur currently. Or reversely, if an
> > application/library compiled with GCC 4.X would link against GDAL
> > compiled with GCC 5.X
> 
> ABI compatibility is a mess: https://isocpp.org/files/papers/n4028.pdf
> 
> With that in mind, what you do inside your own codebase isn't much of an
> issue and I'm guessing that even if GDAL wants to be as accommodating as
> possible, maintainers of dependent libraries probably won't take such
> care.  In the end, if you're doing development and building things
> yourself, you need to make sure you use the same compiler and switches for
> everything if you're providing a C++ interface.  Is this a pain?  Yes.  Is
> it necessary?  Yes.
> 
> As for the notion of replacing some allocations with vectors, well, great.
> But the GDAL codebase is creaky in lots of places and to get too particular
> about the advantage/disadvantage of vectors seems a little silly.  At some
> point it's just reasonable to say that you're only going to support
> compilers/systems made after some date/version.  People who don't want to
> upgrade a system aren't harmed.  They always have access to an older
> version of the library. 

(Sometimes they want the latest version of the lib for a particular feature on a ancient system.)

> There is just so much cruft in GDAL that could
> benefit from use of the standard library and C++ 11 that I don't know where
> to start.

That would be interesting if you (or anyone) could list which C++11 features would be killer features
to justify the upgrade to C++11 vs the potential pains that such a move might cause (especially
as I raised in other emails, given the fact that GDAL uses a number of other libs and is used by a number
of other libs)


> That said, changing code that works just because you like this or that
> language feature always presents an opportunity for bugs to creep in.

I agree completely with that :-) Especially for parts of the code base that are
not or poorly tested :
http://rawgit.com/rouault/gdalautotest-coverage-results/master/coverage_html/index.html 


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From schwehr at gmail.com  Thu May  5 08:19:48 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Thu, 5 May 2016 08:19:48 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605051715.38075.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605051526.33407.even.rouault@spatialys.com>
 <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>
 <201605051715.38075.even.rouault@spatialys.com>
Message-ID: <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>

Thanks all for your comments!  I will try to write up a similar proposal
for C++11 based on what people have written.

I've integrated (and still working on) a number of the points from the
discussion so far on the stack storage issue into the doc and added a
section titled "Impact of the proposed change"

This local stack storage change is for a real need, so it's probably good
that I add a use case that explains why this change is important.  And I
>>believe<< (but am not 100% sure) that using std::vector is the strongest
solution for the majority of instances of large buffers on the stack in
gdal.

Use case:  (note that I can only share generals)

At Google, we have jobs that use GDAL running with thousands of cores and
>20 threads per process that run for days.  The overhead of having to allow
for bumping the stack size adds substantial overhead to all those jobs.
GDAL is the only thing driving the requirement for the larger stack.  For
people using GDAL on a desktop machine, the larger stack is unlikely to be
a real issue.  For anyone running large multithreaded jobs in the cloud,
the large stack is a real cost issue.  The overhead of vector and heap
allocation in all these cases I've looked at in GDAL so far is far smaller
than the cost from the stack size overhead.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/c86dea11/attachment-0001.html>

From andrew.bell.ia at gmail.com  Thu May  5 08:21:04 2016
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Thu, 5 May 2016 10:21:04 -0500
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605051715.38075.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605051526.33407.even.rouault@spatialys.com>
 <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>
 <201605051715.38075.even.rouault@spatialys.com>
Message-ID: <CACJ51z1rPvT=vqkB1frysGMW8wjPMgDuCd16Cy596o-Aw0-X4A@mail.gmail.com>

On Thu, May 5, 2016 at 10:15 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> > As for the notion of replacing some allocations with vectors, well,
> great.
> > But the GDAL codebase is creaky in lots of places and to get too
> particular
> > about the advantage/disadvantage of vectors seems a little silly.  At
> some
> > point it's just reasonable to say that you're only going to support
> > compilers/systems made after some date/version.  People who don't want to
> > upgrade a system aren't harmed.  They always have access to an older
> > version of the library.
>
> (Sometimes they want the latest version of the lib for a particular
> feature on a ancient system.)
>

Yes, but I'm unsympathetic.  This is free software.  To make the system
less maintainable for developers often working for free and more difficult
for many other users for the sake of a few outliers is to me unappealing.
If people want a feature integrated into some old system, they can
certainly hire someone to do just that.

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/76f10e5c/attachment.html>

From damian.dixon at gmail.com  Thu May  5 08:41:13 2016
From: damian.dixon at gmail.com (Damian Dixon)
Date: Thu, 5 May 2016 16:41:13 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
Message-ID: <CAJjdW1zkkJjAOuX9B4OsbJxdPRPxqDY0d7+azzcpxVvL5skg8A@mail.gmail.com>

I'm currently stuck on the following compilers:

   - Visual Studio 2010 SP1
   - GCC 4.7

C++11 is only partially supported with these compilers.

Regards
Damian


On 4 May 2016 at 23:51, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 4 May 2016 at 23:30, Kurt Schwehr <schwehr at gmail.com> wrote:
>
>>
>> To start off the conversation, I wrote up a doc on changing large C
>> arrays on the stack to std::vectors to get this data off of the stack and
>> to simplify initialization.
>>
>
>
> Since many, if not most, of the ideas rely on availability of the C++11
> features,
> it might be a good idea to first agree on C++11 as the lowest
> required C++ compilation mode.
>
> Let's poll if there are any users who require C++03 at all.
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/e0b669bb/attachment.html>

From damian.dixon at gmail.com  Thu May  5 08:48:18 2016
From: damian.dixon at gmail.com (Damian Dixon)
Date: Thu, 5 May 2016 16:48:18 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605051128.14412.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
 <CABUeae8M8TFcyXGTFd3+gQ4BZ8nk0036bwN1LB3pvOhS1vgpiQ@mail.gmail.com>
 <201605051128.14412.even.rouault@spatialys.com>
Message-ID: <CAJjdW1yUrqo8b9L37SJ_P9gsJV-q1--6Ht1NLg1yfkXT20itcA@mail.gmail.com>

In the VS World...

If you delete C/C++ memory/objects in a DLL that has been compiled with the
same VS compiler you are ok.

If you attempt to delete a memory/object in DLL/application compiled with a
different version of the VS compiler all bets are off.

For example:

Allocate an object in VS2010 compiled code delete in VS2015 compiled code,
you will likely crash.


You will have to distribute the runtime distribution DLLs for the versions
of VS that you used or your 3rd party DLLs used.

Regards
Damian


On 5 May 2016 at 10:28, Even Rouault <even.rouault at spatialys.com> wrote:

> Le jeudi 05 mai 2016 11:09:48, Mateusz Loskot a écrit :
> > On 5 May 2016 at 01:45, Even Rouault <even.rouault at spatialys.com> wrote:
> > > Of the potential issues with requiring C++11, I can think of OSGeo4W.
> It
> > > is mostly(completely?) built with Visual Studio 2010. And from
> > > https://msdn.microsoft.com/en-us/library/hh567368.aspx , support of
> C++11
> > > is only partial in VS 2010
> >
> > VS2013 is the lowest version sensible to consider regarding C++11
> support.
> >
> > > On the other hand regarding dependencies of GDAL, the binary propritary
> > > SDKs with a C++ API could be a problem, although they will likely move
> > > on too. - FileGDB SDK 1.4: available for VS2010, VS2012, VS2013
> > > - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
> >
> > AFAICT, GDAL built using VS2015 links against the 5.2.1 version fine.
>
> Do you link against the VS2013 .lib ?
> >
> > > - MrSID SDK: I didn't check. Perhaps Kirk can tell us ?
> >
> > Similarly to the ECW above, version 9.1.0 links fine too.
> >
> > > But I'm not sure about the compatibility of C++11 build against
> non-C++11
> > > builds in the VS realm : can a GDAL C++11 build link against a library
> > > built without C++11 enabled ? Will not there be ABI problems ?
> >
> > Although mixing C run-time libraries is a bad idea generally,
> > kosher C APIs should be fine.
>
> I'm not too worried about C ABI. My mention of C++03 ABI vs C++11 ABI was
> for
> the dependencies with those SDK that we use through their C++ API. In GCC
> world, with same compiler but with different -std=... flags, there have
> been
> troubles ( https://gcc.gnu.org/wiki/Cxx11AbiCompatibility ,
> https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_dual_abi.html ), so
> I
> was wondering how the situation is in the VS world.
> Actually since I mention this, the issue does apply to Linux too. Looking
> at
> the C++11 Linux build (
>
> https://github.com/rouault/gdal_coverage/blob/trunk_gcc4.8_stdc11/.travis.yml
> ) , I see I couldn't build against FileGDB with -std=c++11. This was a
> compilation issue with its headers, rather than a link/runtime issue.
>
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/19c742c2/attachment.html>

From gdal at stripfamily.net  Thu May  5 09:04:15 2016
From: gdal at stripfamily.net (David Strip)
Date: Thu, 5 May 2016 10:04:15 -0600
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxytc68Lj5ApBHswbmZ42nzzhNZLvB-yitzs87JjYPcyi8Q@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <572B554A.1000503@stripfamily.net>
 <CACmBxytc68Lj5ApBHswbmZ42nzzhNZLvB-yitzs87JjYPcyi8Q@mail.gmail.com>
Message-ID: <572B6EFF.6010900@stripfamily.net>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/7ace952b/attachment-0001.html>

From mcoletti at gmail.com  Thu May  5 12:43:34 2016
From: mcoletti at gmail.com (Mark Coletti)
Date: Thu, 5 May 2016 15:43:34 -0400
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605051715.38075.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605051526.33407.even.rouault@spatialys.com>
 <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>
 <201605051715.38075.even.rouault@spatialys.com>
Message-ID: <CAHpqhBPqusidXfbnY8shBpLQgVu-73kUd6dCNAHwVFhYp9+vcQ@mail.gmail.com>

On Thu, May 5, 2016 at 11:15 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> [...]
> That would be interesting if you (or anyone) could list which C++11
> features would be killer features
> to justify the upgrade to C++11 vs the potential pains that such a move
> might cause (especially
> as I raised in other emails, given the fact that GDAL uses a number of
> other libs and is used by a number
> of other libs) [...]


This is an off the cuff list of C++-11 niceties, and by no means exhaustive:

- std::move()
- *lambda expressions*
- auto keyword
- native smart pointer support, such as std::unique_ptr and std::shared_ptr
(though there's always the Boost fallback)
- concurrency API
- nullptr


Also, it's been many, many years since I last looked at GDAL/OGR source.
When I did I noted a lot of C-style I/O calls instead of using C++
equivalents.  Is that still the case?  If so, that's one area ripe for
refactoring.

Cheers,

Mark
-- 
mcoletti at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/54b2fffc/attachment.html>

From 191980 at niuitmo.ru  Thu May  5 12:24:09 2016
From: 191980 at niuitmo.ru (=?utf-8?B?0JHQvtGA0LfRi9GFINCQ0LvQtdC60YHQsNC90LTRgCDQkNC90LTRgNC10LU=?= =?utf-8?B?0LLQuNGH?=)
Date: Thu, 5 May 2016 19:24:09 +0000
Subject: [gdal-dev] OGR DWG Support
Message-ID: <0AD3FDEA-9F91-4682-8B9F-1E6BFB15648D@niuitmo.ru>

Hello devs,

I just have posted my GSoC project info at https://trac.osgeo.org/gdal/wiki/DWG_driver
Now it has a draft of new CAD support library (named libopencad), and detailed timeline.
There are also links where you can see what have already been done in that way.

I will be very pleased with any suggestions and/or ideas for my project.

Best regards,
Alexander Borzykh

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/93e62783/attachment.html>

From rayg at daylongraphics.com  Thu May  5 13:04:16 2016
From: rayg at daylongraphics.com (Ray Gardener)
Date: Thu, 5 May 2016 13:04:16 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CAHpqhBPqusidXfbnY8shBpLQgVu-73kUd6dCNAHwVFhYp9+vcQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605051526.33407.even.rouault@spatialys.com>
 <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>
 <201605051715.38075.even.rouault@spatialys.com>
 <CAHpqhBPqusidXfbnY8shBpLQgVu-73kUd6dCNAHwVFhYp9+vcQ@mail.gmail.com>
Message-ID: <9c496513-3e80-1dd8-ce9a-a904a957f71e@daylongraphics.com>

How about C++11 threads?

Ray


On 5/5/2016, Thursday 12:43 PM, Mark Coletti wrote:
> On Thu, May 5, 2016 at 11:15 AM, Even Rouault 
> <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>> wrote:
>
>     [...]
>     That would be interesting if you (or anyone) could list which
>     C++11 features would be killer features
>     to justify the upgrade to C++11 vs the potential pains that such a
>     move might cause (especially
>     as I raised in other emails, given the fact that GDAL uses a
>     number of other libs and is used by a number
>     of other libs) [...]
>
>
> This is an off the cuff list of C++-11 niceties, and by no means 
> exhaustive:
>
> - std::move()
> - *lambda expressions*
> - auto keyword
> - native smart pointer support, such as std::unique_ptr and 
> std::shared_ptr (though there's always the Boost fallback)
> - concurrency API
> - nullptr
>
> Also, it's been many, many years since I last looked at GDAL/OGR 
> source.  When I did I noted a lot of C-style I/O calls instead of 
> using C++ equivalents.  Is that still the case?  If so, that's one 
> area ripe for refactoring.
>
> Cheers,
>
> Mark
> -- 
> mcoletti at gmail.com <mailto:mcoletti at gmail.com>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/a5aaa011/attachment.html>

From andrew.bell.ia at gmail.com  Thu May  5 13:56:34 2016
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Thu, 5 May 2016 15:56:34 -0500
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <201605051526.33407.even.rouault@spatialys.com>
 <CACJ51z0OS5LhLmnvQ1MDPHvLH0w0AXcCBfVNz6TUWpgYpWxk4g@mail.gmail.com>
 <201605051715.38075.even.rouault@spatialys.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
Message-ID: <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>

On Thu, May 5, 2016 at 10:19 AM, Kurt Schwehr <schwehr at gmail.com> wrote:

> Thanks all for your comments!  I will try to write up a similar proposal
> for C++11 based on what people have written.
>
> This local stack storage change is for a real need, so it's probably good
> that I add a use case that explains why this change is important.  And I
> >>believe<< (but am not 100% sure) that using std::vector is the strongest
> solution for the majority of instances of large buffers on the stack in
> gdal.
>
> Use case:  (note that I can only share generals)
>
> At Google, we have jobs that use GDAL running with thousands of cores and
> >20 threads per process that run for days.  The overhead of having to allow
> for bumping the stack size adds substantial overhead to all those jobs.
> GDAL is the only thing driving the requirement for the larger stack.  For
> people using GDAL on a desktop machine, the larger stack is unlikely to be
> a real issue.  For anyone running large multithreaded jobs in the cloud,
> the large stack is a real cost issue.  The overhead of vector and heap
> allocation in all these cases I've looked at in GDAL so far is far smaller
> than the cost from the stack size overhead.
>

I misinterpreted this thread because of the title.  It seems this isn't
really about code style or C++ 11.  It's really about Google wanting to use
heap over stack because of its particular use of the library.  There is no
need for C++ 11 for that and it would seem that doing a compile-time
policy-based array isn't too hard (proof of concept below).  Perhaps Google
could flush something like this out to its liking and replace current stack
allocations that cause it issues.  C++ 11 and code style seem another
conversation.

======

#include <iostream>

struct Stack
{};

struct Heap
{};

template <typename TYPE, std::size_t SIZE, typename AllocType>
struct Arr
{
};

template <typename TYPE, std::size_t SIZE>
struct Arr<TYPE, SIZE, Heap>
{
    Arr() : m_instance(new TYPE[SIZE ? SIZE : 1])
    {}

    ~Arr()
    {
        delete [] m_instance;
    }

    TYPE *m_instance;

    TYPE& operator[](std::size_t idx)
        { return *(m_instance + idx); }
};

template <typename TYPE, std::size_t SIZE>
struct Arr<TYPE, SIZE, Stack>
{
    TYPE m_instance[SIZE ? SIZE : 1];

    TYPE& operator[](std::size_t idx)
        { return m_instance[idx]; }
};


#ifdef HEAPALLOC
template <typename T, std::size_t SIZE>
struct Array : public Arr<T, SIZE, Heap>
{};
#else
template <typename T, std::size_t SIZE>
struct Array : public Arr<T, SIZE, Stack>
{};
#endif

int main()
{
    Array<int, 25> a;

    a[10] = 15;
    std::cout << "A[10] = " << a[10] << "!\n";

    return 0;
}

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160505/515d92a5/attachment-0001.html>

From even.rouault at spatialys.com  Thu May  5 14:25:11 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 5 May 2016 23:25:11 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
Message-ID: <201605052325.11402.even.rouault@spatialys.com>


> I misinterpreted this thread because of the title.  It seems this isn't
> really about code style or C++ 11.  

I agree this thread mixes different topics, which causes some confusion. The 
word C++11 appearing in a doc has created some passion, whereas it is probably 
not the heart of the subject.

Kurt has contributed to a lot of cleanup in the code base over the last 
months, mostly in applying stricter formatting rules, bool'ifying, 
const'ifying when possible, moving variable declarations close to their 
initialization, etc.. (Kurt, correct me if I'm wrong.), also addressing a 
bunch of Covertiy Scan warnings, etc.

I've actually encouraged him to share his thoughts regarding cleanups with the 
rest of the community so that we can decide which are worth to be rules that 
apply to the project as a whole, and if some tooling is needed to 
automate/enforce them.

> It's really about Google wanting to use
> heap over stack because of its particular use of the library.  There is no
> need for C++ 11 for that and it would seem that doing a compile-time
> policy-based array isn't too hard (proof of concept below).  Perhaps Google
> could flush something like this out to its liking and replace current stack
> allocations that cause it issues. 

This use case is probably shared by other actors that use GDAL for massive 
data processing, and if the solution to reduce stack usage doesn't hurt more 
mundane use cases, we probably don't need the #ifdef complication.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From gane.prog at gmail.com  Thu May  5 23:54:34 2016
From: gane.prog at gmail.com (Gane R)
Date: Fri, 6 May 2016 12:24:34 +0530
Subject: [gdal-dev] prebuilt GDAL 2.0.2 windows binary
Message-ID: <CALMrLdA3ock_QLAJpHRfpHyUAOEFbxrgKMt6n7f2Vcb53dTBXg@mail.gmail.com>

I see a link to download the source

http://download.osgeo.org/gdal/2.0.2/gdal202.zip

when can I find a prebuilt version of GDAL 2.0.2

Thanks
Gane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/0ca59adc/attachment.html>

From mateusz at loskot.net  Fri May  6 00:00:19 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 6 May 2016 09:00:19 +0200
Subject: [gdal-dev] prebuilt GDAL 2.0.2 windows binary
In-Reply-To: <CALMrLdA3ock_QLAJpHRfpHyUAOEFbxrgKMt6n7f2Vcb53dTBXg@mail.gmail.com>
References: <CALMrLdA3ock_QLAJpHRfpHyUAOEFbxrgKMt6n7f2Vcb53dTBXg@mail.gmail.com>
Message-ID: <CABUeae8G=oswgQEbQsC=M4-Y-S0q2Oxb8fbAZ6K4Eptu+y0GAA@mail.gmail.com>

On 6 May 2016 at 08:54, Gane R <gane.prog at gmail.com> wrote:
> I see a link to download the source
>
> http://download.osgeo.org/gdal/2.0.2/gdal202.zip
>
> when can I find a prebuilt version of GDAL 2.0.2

https://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From Stefan.Blumentrath at nina.no  Fri May  6 02:12:45 2016
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Fri, 6 May 2016 09:12:45 +0000
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
In-Reply-To: <201605040948.35822.even.rouault@spatialys.com>
References: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
 <201605032132.31694.even.rouault@spatialys.com>
 <197acdd44e52432fa03dc65f6a0ebe0d@NINSRV23.nina.no>
 <201605040948.35822.even.rouault@spatialys.com>
Message-ID: <cdbbd586a2bd494483cfdc32ff3b5467@NINSRV23.nina.no>

Hei Even,

Now I investigated a bit more and it seems that the development at our mapping authority and gdal diverged a bit.

There is a (partly) newer version of the OGR-SOSI driver at the github repository of our mapping authority:
https://github.com/OSGeo/gdal/compare/trunk...kartverket:trunk

Especially this commit contains changes that might fix the issue with geometry type 5 (and 20), plus provides some improvements on attribute-type mapping:
https://github.com/OSGeo/gdal/commit/321bc979f112e46e05e45a9363d39de5343709fc

Would you mind integrating those changes? That would be really great. However, I understand that you already spend a significant amount of unpaid time (unfortunately I have no resources I could allocate to this) on this rare driver, so I understand if you choose not to. In the latter case I could try to provide a fix myself. Would you prefer a SVN diff in that case?

Since geometry type 5 is a curved geometry, which was not supported by GDAL OGR at that time, the commit above interpolates the curve to a line feature. Maybe better to generate a curved OGR geometry instead of a line?

Anyway, thanks for all your support and work on GDAL/OGR!

Cheers
Stefan

-----Original Message-----
From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: 4. mai 2016 09:49
To: Blumentrath, Stefan <Stefan.Blumentrath at nina.no>
Cc: gdal-dev at lists.osgeo.org; Thomas Hirsch (Thomas.Hirsch at kartverket.no) <Thomas.Hirsch at kartverket.no>
Subject: Re: [gdal-dev] GDAL 2.1 and Norwegian SOSI

Le mercredi 04 mai 2016 09:32:13, Blumentrath, Stefan a écrit :
> Hei again,
> 
> First of all, now the SOSI file opens fine again. So, many thanks for that!
> 
> Unfortunately, I now get a new error on ogrinfo 
> ./ADM_kommune_0620_Hol.sos lines
> 
> Layer name: lines
> Geometry: Line String
> ERROR 4: Unrecognized geometry of type 5.
> ERROR 1: Feature 82 referenced by 2204, but it was not initialized.
> Aborted (core dumped)
> 
> I get it for polygons too. Geometries of type 5 are curved geometries 
> which got introduced in SOSI version 4.5 - if I am not mistaken...
> 
> Geometry type 5 (BUEP) is defined in
> https://github.com/kartverket/fyba/blob/master/src/FYBA/fyba.h (Line 
> 408)... Would it be sufficient to add something like: case
> wkbCompoundCurve: {
>             pszSosi = ".BUEP";
>             break;
>         }
> to: ogr/ogrsf_frmts/sosi/ogrsosilayer.cpp (not sure if the translation 
> is 100% correct)

That would be for the write side of the driver. GetNextFeature() should likely be modified

> 
> But maybe also trunk/gdal/ogr/ogrsf_frmts/sosi/ogrsosidatasource.cpp 
> needs modification...? (I am no programmer).

Yes, the Open() method seems to be where OGR geometries are built from SOSI ones. Would need to be extended for curves.

> 
> Seems to be an older issue and other GeometryTypes seem to cause 
> trouble
> too:
> http://gis.stackexchange.com/questions/132888/ogr2ogr-problem-converti
> ng-s
> osi-fil-to-kml-or-anything-else
> 
> Cheers,
> Stefan
> 
> -----Original Message-----
> From: Even Rouault [mailto:even.rouault at spatialys.com]
> Sent: 3. mai 2016 21:33
> To: gdal-dev at lists.osgeo.org
> Cc: Blumentrath, Stefan <Stefan.Blumentrath at nina.no>
> Subject: Re: [gdal-dev] GDAL 2.1 and Norwegian SOSI
> 
> Le mardi 03 mai 2016 21:06:14, Blumentrath, Stefan a écrit :
> > Dear GDAL-devs,
> > 
> > I just tried to open a Norwegian SOSI file with ogrinfo from GDAL 
> > 2.1dev but get: FAILURE:
> > Unable to open datasource `./ADM_kommune_2018_Masoy.sos' with the 
> > following drivers.
> > 
> > 'ogrinfo --formats' does not list the SOSI driver either. But I am 
> > sure I did compile with '--with-sosi' and gdal-config --dep-libs 
> > lists the openfyba libs used for the driver.
> 
> Hum, I see this is actually a 2.1.0 regression.
> Fix available in https://trac.osgeo.org/gdal/ticket/6500
> 
> > So my question is,: were there any changes from 1.11 to 2.x which 
> > may affect the driver? Any chance someone will make that working again?
> > Unfortunately our mapping authority does not seem to be maintaining 
> > the OpenFYBA lib any more (SOSI version 4.5 not yet supported), so I 
> > can understand if you are not too keen on fixing the issue (if it is 
> > not local).
> > 
> > Thanks for any help.
> > 
> > Kind regards,
> > Stefan
> 
> --
> Spatialys - Geospatial professional services http://www.spatialys.com

--
Spatialys - Geospatial professional services http://www.spatialys.com

From even.rouault at spatialys.com  Fri May  6 03:06:01 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 6 May 2016 12:06:01 +0200
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
In-Reply-To: <cdbbd586a2bd494483cfdc32ff3b5467@NINSRV23.nina.no>
References: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
 <201605040948.35822.even.rouault@spatialys.com>
 <cdbbd586a2bd494483cfdc32ff3b5467@NINSRV23.nina.no>
Message-ID: <201605061206.01828.even.rouault@spatialys.com>

Stefan,

> 
> Now I investigated a bit more and it seems that the development at our
> mapping authority and gdal diverged a bit.
> 
> There is a (partly) newer version of the OGR-SOSI driver at the github
> repository of our mapping authority:
> https://github.com/OSGeo/gdal/compare/trunk...kartverket:trunk
> 
> Especially this commit contains changes that might fix the issue with
> geometry type 5 (and 20), plus provides some improvements on
> attribute-type mapping:
> https://github.com/OSGeo/gdal/commit/321bc979f112e46e05e45a9363d39de534370
> 9fc

(I'm wondering how that commit can appear at https://github.com/OSGeo/gdal 
whereas it is not integrated in GDAL trunk. Something I must miss with 
git/github...)

> 
> Would you mind integrating those changes? 

--> Hint to the 58 other committers also in the position to do so ;-)

> That would be really great.
> However, I understand that you already spend a significant amount of
> unpaid time (unfortunately I have no resources I could allocate to this)
> on this rare driver, so I understand if you choose not to. In the latter
> case I could try to provide a fix myself. Would you prefer a SVN diff in
> that case?

A ticket with the elements and links you provided above, and potentially a svn 
diff (with the new files added), and with only the changes in 
ogr/ogrsf_frmts/sosi/, would be a start. A test file for the new geometry types 
could also be useful.

> 
> Since geometry type 5 is a curved geometry, which was not supported by GDAL
> OGR at that time, the commit above interpolates the curve to a line
> feature. Maybe better to generate a curved OGR geometry instead of a line?

Yeah, that would be a better match, but getting the linearized geometries 
would be already a good start.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Fri May  6 03:06:28 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Fri, 6 May 2016 10:06:28 +0000 (UTC)
Subject: [gdal-dev] More simplification algorithms
Message-ID: <loom.20160506T120051-858@post.gmane.org>

Hi,

I noticed this question in gis.stackexchange
http://gis.stackexchange.com/questions/192547/generalization-algorithms and
the answer lead to this this "psimpl" library
http://psimpl.sourceforge.net/. The library is MPL 1.1 licensed. Is the
license suitable for GDAL and aculd we have any use for the library and
alternative simplification methods in GDAL?

-Jukka Rahkonen-




From mateusz at loskot.net  Fri May  6 03:11:31 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 6 May 2016 12:11:31 +0200
Subject: [gdal-dev] More simplification algorithms
In-Reply-To: <loom.20160506T120051-858@post.gmane.org>
References: <loom.20160506T120051-858@post.gmane.org>
Message-ID: <CABUeae9DqPALXnWSiMP3PLEo-b1m4-p83tfQmTE_swxoHeo99w@mail.gmail.com>

On 6 May 2016 at 12:06, Jukka Rahkonen
<jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> I noticed this question in gis.stackexchange
> http://gis.stackexchange.com/questions/192547/generalization-algorithms and
> the answer lead to this this "psimpl" library
> http://psimpl.sourceforge.net/. The library is MPL 1.1 licensed. Is the
> license suitable for GDAL and aculd we have any use for the library and
> alternative simplification methods in GDAL?

psimpl didn't pick attention a while ago
https://lists.osgeo.org/pipermail/gdal-dev/2013-February/035536.html

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From even.rouault at spatialys.com  Fri May  6 03:45:03 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 6 May 2016 12:45:03 +0200
Subject: [gdal-dev] More simplification algorithms
In-Reply-To: <loom.20160506T120051-858@post.gmane.org>
References: <loom.20160506T120051-858@post.gmane.org>
Message-ID: <201605061245.03516.even.rouault@spatialys.com>

Le vendredi 06 mai 2016 12:06:28, Jukka Rahkonen a écrit :
> Hi,
> 
> I noticed this question in gis.stackexchange
> http://gis.stackexchange.com/questions/192547/generalization-algorithms and
> the answer lead to this this "psimpl" library
> http://psimpl.sourceforge.net/. The library is MPL 1.1 licensed. Is the
> license suitable for GDAL 

From a quick look at https://en.wikipedia.org/wiki/Mozilla_Public_License, it 
is close to LGPL in spirit, so it cannot be a compulsory dependency of GDAL. 
Apparently there would be some incompatibility with the GPL ( 
https://www.gnu.org/licenses/license-list.html#MPL ) which is more annoying.

Looking at the description of the algorithms, there could also probably be re-
implemented with modest effort.
Perhaps GEOS would be a better host for such algorithms as it has already 
Douglas Peucker

> and aculd we have any use for the library and
> alternative simplification methods in GDAL?
> 
> -Jukka Rahkonen-
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jamessramm at gmail.com  Fri May  6 04:08:18 2016
From: jamessramm at gmail.com (jramm)
Date: Fri, 6 May 2016 04:08:18 -0700 (PDT)
Subject: [gdal-dev] Segfault in GDALWriteBlock
In-Reply-To: <CACmBxyuJgPmLBJOsFRLy66bg0iTqmKKqo6JJGeacSV7yaHtutA@mail.gmail.com>
References: <1462434146978-5264660.post@n6.nabble.com>
 <CACmBxyuJgPmLBJOsFRLy66bg0iTqmKKqo6JJGeacSV7yaHtutA@mail.gmail.com>
Message-ID: <1462532898461-5264899.post@n6.nabble.com>

im building off trunk, so Gdal2.1dev

Ill get that stack trace...



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Segfault-in-GDALWriteBlock-tp5264660p5264899.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jamessramm at gmail.com  Fri May  6 04:33:36 2016
From: jamessramm at gmail.com (jramm)
Date: Fri, 6 May 2016 04:33:36 -0700 (PDT)
Subject: [gdal-dev] Geotiff FillEmptyTiles with no data value?
In-Reply-To: <201605032059.38870.even.rouault@spatialys.com>
References: <1462299829320-5264310.post@n6.nabble.com>
 <201605032059.38870.even.rouault@spatialys.com>
Message-ID: <1462534416067-5264905.post@n6.nabble.com>

NoDataValue is set on a band level and FillEmptyTiles operates at a dataset
level. 

I've never heard of a geotiff with different nodata per band - is this even
possible, or would it be reasonable to take the nodatavalue of the 1st band
and use this to initialise the empty tiles block?

Then there is the problem of the block array being initialised as GBYte:

    GByte *pabyData = (GByte *) VSI_CALLOC_VERBOSE(nBlockBytes,1);

NoDataValue is always returned as a double, but actual data type may be
different values...Am I right in thinking TIFFTileSize will return the
number of bytes in a block for the data type of the tiff file (e.g. so block
size = nBlockBytes / sizeof(data_type)?

Would something like this be a reasonable way to initialise pabyData

int typeSize;
switch (eType){
  case GDT_Byte:
      typeSize = sizeof(GByte)
  case GDT_Int16:
      typeSize = sizeof(short)

   ...
}


for (int i =0; i < nBlockBytes; i+=typeSize)
{
    *pabyData = nullValue;
}



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Geotiff-FillEmptyTiles-with-no-data-value-tp5264310p5264905.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Fri May  6 05:14:06 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 6 May 2016 14:14:06 +0200
Subject: [gdal-dev] Geotiff FillEmptyTiles with no data value?
In-Reply-To: <1462534416067-5264905.post@n6.nabble.com>
References: <1462299829320-5264310.post@n6.nabble.com>
 <201605032059.38870.even.rouault@spatialys.com>
 <1462534416067-5264905.post@n6.nabble.com>
Message-ID: <201605061414.06850.even.rouault@spatialys.com>

Le vendredi 06 mai 2016 13:33:36, jramm a écrit :
> NoDataValue is set on a band level and FillEmptyTiles operates at a dataset
> level.
> 
> I've never heard of a geotiff with different nodata per band - is this even
> possible, or would it be reasonable to take the nodatavalue of the 1st band
> and use this to initialise the empty tiles block?

The GDAL_NODATA tag contains a single value, so in GeoTIFF, you can only have 
the same nodata value for all bands. Perhaps this can be overridden in a 
.aux.xml file, but I'm not even sure. So yes using the nodata value of the first 
band is reasonable. Actually I see there's the following variables at the 
GTiffDataset level :

    bool        bNoDataChanged;
    int         bNoDataSet;
    double      dfNoDataValue;

Caution: dfNoDataValue is initialized to -9999 if bNoDataSet is FALSE. But we 
probably want to write zeroes when burning tiles.

> 
> Then there is the problem of the block array being initialised as GBYte:
> 
>     GByte *pabyData = (GByte *) VSI_CALLOC_VERBOSE(nBlockBytes,1);
> 
> NoDataValue is always returned as a double, but actual data type may be
> different values...Am I right in thinking TIFFTileSize will return the
> number of bytes in a block for the data type of the tiff file (e.g. so
> block size = nBlockBytes / sizeof(data_type)?

TIFFTileSize() returns a number of bytes whatever the datatype size is.

> 
> Would something like this be a reasonable way to initialise pabyData
> 
> int typeSize;
> switch (eType){
>   case GDT_Byte:
>       typeSize = sizeof(GByte)
>   case GDT_Int16:
>       typeSize = sizeof(short)
> 
>    ...
> }
> 
> 
> for (int i =0; i < nBlockBytes; i+=typeSize)
> {
>     *pabyData = nullValue;
> }

I'd rather use GDALCopyWords() to do datatype conversion & replication.

GDALCopyWords( &dfNoDataValue, GDT_Float64, 0,
                           pabyData, eDataType,
                           GDALGetDataTypeSizeBytes(eDataType),
                           nBlockBytes / GDALGetDataTypeSizeBytes(eDataType) )


> 
> 
> 
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/Geotiff-FillEmptyTiles-with-no-data-va
> lue-tp5264310p5264905.html Sent from the GDAL - Dev mailing list archive at
> Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri May  6 07:00:07 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 6 May 2016 16:00:07 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605050145.50442.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
Message-ID: <201605061600.07260.even.rouault@spatialys.com>

> - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013

I got information that the next SDK 5.3 should support VS2012, 2013 and 2015 
(so no more 2010) + GCC 5

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jluis at ualg.pt  Fri May  6 07:20:37 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Fri, 06 May 2016 15:20:37 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605061600.07260.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
 <201605061600.07260.even.rouault@spatialys.com>
Message-ID: <op.yg1osnnkdbaoe8@macmarilu>

On Fri, 06 May 2016 15:00:07 +0100, Even Rouault  
<even.rouault at spatialys.com> wrote:

>> - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
>
> I got information that the next SDK 5.3 should support VS2012, 2013 and  
> 2015
> (so no more 2010) + GCC 5

And one can also build SDK 3.3 with all of those compilers (I did).

From mateusz at loskot.net  Fri May  6 07:38:04 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 6 May 2016 16:38:04 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <op.yg1osnnkdbaoe8@macmarilu>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
 <201605061600.07260.even.rouault@spatialys.com>
 <op.yg1osnnkdbaoe8@macmarilu>
Message-ID: <CABUeae8HR8A1Sy7yMGYggj3bYhvTvKmTzZsFhfpuNyA4a+70yQ@mail.gmail.com>

On 6 May 2016 at 16:20, Joaquim Luis <jluis at ualg.pt> wrote:
> On Fri, 06 May 2016 15:00:07 +0100, Even Rouault
> <even.rouault at spatialys.com> wrote:
>
>>> - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
>>
>>
>> I got information that the next SDK 5.3 should support VS2012, 2013 and
>> 2015
>> (so no more 2010) + GCC 5
>
>
> And one can also build SDK 3.3 with all of those compilers (I did).

I do it too, works well indeed.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From jmckenna at gatewaygeomatics.com  Fri May  6 07:55:31 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Fri, 6 May 2016 11:55:31 -0300
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae8HR8A1Sy7yMGYggj3bYhvTvKmTzZsFhfpuNyA4a+70yQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae-52OjN_gqQsoMBEcVZ_VKRZr+csATJp=wcjeLW9fi7sg@mail.gmail.com>
 <201605050145.50442.even.rouault@spatialys.com>
 <201605061600.07260.even.rouault@spatialys.com> <op.yg1osnnkdbaoe8@macmarilu>
 <CABUeae8HR8A1Sy7yMGYggj3bYhvTvKmTzZsFhfpuNyA4a+70yQ@mail.gmail.com>
Message-ID: <d7a32f28-46f9-2f87-ca0c-afacffa3a6e1@gatewaygeomatics.com>

On 2016-05-06 11:38 AM, Mateusz Loskot wrote:
> On 6 May 2016 at 16:20, Joaquim Luis <jluis at ualg.pt> wrote:
>> On Fri, 06 May 2016 15:00:07 +0100, Even Rouault
>> <even.rouault at spatialys.com> wrote:
>>
>>>> - ECW SDK 5.2.1: available for VS2010, VS2012, VS2013
>>>
>>>
>>> I got information that the next SDK 5.3 should support VS2012, 2013 and
>>> 2015
>>> (so no more 2010) + GCC 5
>>
>>
>> And one can also build SDK 3.3 with all of those compilers (I did).
>
> I do it too, works well indeed.
>

same.

-jeff



-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From jmckenna at gatewaygeomatics.com  Fri May  6 08:17:00 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Fri, 6 May 2016 12:17:00 -0300
Subject: [gdal-dev] minor request re: release notes
Message-ID: <2a502d85-df3b-6084-2496-637bceab61c4@gatewaygeomatics.com>

Hi all,

For future release notes, can we include the release date at the top of 
the page?  For example see: 
https://trac.osgeo.org/gdal/wiki/Release/2.1.0-News

I just find it very useful, and a great way to look back at progress. (I 
added the date for 2.1.0)

-jeff



-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/




From jmckenna at gatewaygeomatics.com  Fri May  6 08:25:44 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Fri, 6 May 2016 12:25:44 -0300
Subject: [gdal-dev] minor request re: release notes
In-Reply-To: <2a502d85-df3b-6084-2496-637bceab61c4@gatewaygeomatics.com>
References: <2a502d85-df3b-6084-2496-637bceab61c4@gatewaygeomatics.com>
Message-ID: <4ece0d92-f655-6212-a581-6a49b0c5cca7@gatewaygeomatics.com>

On 2016-05-06 12:17 PM, Jeff McKenna wrote:
> Hi all,
>
> For future release notes, can we include the release date at the top of
> the page?  For example see:
> https://trac.osgeo.org/gdal/wiki/Release/2.1.0-News
>
> I just find it very useful, and a great way to look back at progress. (I
> added the date for 2.1.0)
>

I've also added the wiki macro "[[PageOutline]]" to the page, so a fancy 
table of contents appears magically.

Anyway maybe this is noise and only I care how it looks :)

-jeff


-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From even.rouault at spatialys.com  Fri May  6 08:32:25 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 6 May 2016 17:32:25 +0200
Subject: [gdal-dev] minor request re: release notes
In-Reply-To: <4ece0d92-f655-6212-a581-6a49b0c5cca7@gatewaygeomatics.com>
References: <2a502d85-df3b-6084-2496-637bceab61c4@gatewaygeomatics.com>
 <4ece0d92-f655-6212-a581-6a49b0c5cca7@gatewaygeomatics.com>
Message-ID: <201605061732.25388.even.rouault@spatialys.com>

Le vendredi 06 mai 2016 17:25:44, Jeff McKenna a écrit :
> On 2016-05-06 12:17 PM, Jeff McKenna wrote:
> > Hi all,
> > 
> > For future release notes, can we include the release date at the top of
> > the page? 

Sure.

Not sure if that should be the date returned by gdalinfo --version, or the day 
the annoucement is made (which can be several days later after the voting 
process and finalization/annoucement of the release).
The wiki news page is mostly the result of a copy&paste of the SVN page (+ 
some minor formatting when the release manager has enough energy left to add 
some hyperlinks), so adding/updating the day in the NEWS in SVN could be done 
just before creating the tag, and then the wiki page would inherit from that.

> I've also added the wiki macro "[[PageOutline]]" to the page, so a fancy
> table of contents appears magically.
> 
> Anyway maybe this is noise and only I care how it looks :)

That might indeed help to digest ~ 700 lines of content.

> 
> -jeff

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From lorenzo.pini at geo-solutions.it  Fri May  6 08:55:56 2016
From: lorenzo.pini at geo-solutions.it (Lorenzo Pini)
Date: Fri, 6 May 2016 17:55:56 +0200
Subject: [gdal-dev] Fwd: MBTiles Write support
In-Reply-To: <201604201103.20360.even.rouault@spatialys.com>
References: <CA+XvxWBF2-7TtEVKb2KeSbcJPbjBHwjEk=-MzBvE9J4d-9K-hA@mail.gmail.com>
 <CA+XvxWBtDht=a+oa0-Hehuru_FZRvwBbsHoSAF3k26LjraE-FQ@mail.gmail.com>
 <201604181755.57891.even.rouault@spatialys.com>
 <201604201103.20360.even.rouault@spatialys.com>
Message-ID: <CA+XvxWDx+2TFk9pf+oSM-Vfxi8apZJm5zaC0n5pQ-3CB=Kffhg@mail.gmail.com>

Hi Even,
sorry for the late answer.
The latest version did a good job.
I am now investigating a strange issue after the gdaladdo run but I think
it is caused by my MBTiles reader library.

Thank you for your work so far.

Regards
Lorenzo Pini
Software Engineer

==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:     +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

AVVERTENZE AI SENSI DEL D.Lgs. 196/2003

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.

The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.

On Wed, Apr 20, 2016 at 11:03 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le lundi 18 avril 2016 17:55:57, Even Rouault a écrit :
> > Lorenzo,
> >
> > > The command I used is:
> > >
> > > \>gdal_translate mosaic.tif full_def9.mbtiles -of MBTILES -expand rgb
> -co
> > > TILE_FORMAT=PNG8 -co ZLEVEL=9
> > > Input file size is 645661, 308112
> > > 0...10...20...30...40...50...60...70...80ERROR 1: Failure when
> inserting
> > > partial tile (row=759306,col=1099566) at zoom_level=21 : database or
> disk
> > > is full
> > > ERROR 1: full_def9.mbtiles, band 4: An error occurred while writing a
> > > dirty block
> > > ERROR 1: Failure when inserting partial tile (row=759306,col=1099566)
> at
> > > zoom_level=21 : database disk image is malformed
> > > ERROR 1: Failure when inserting partial tile (row=759306,col=1099566)
> at
> > > zoom_level=21 : database disk image is malformed
> > > ERROR 1: Failure when inserting partial tile (row=759306,col=1099566)
> at
> > > zoom_level=21 : database disk image is malformed
> > > ERROR 1: Failure when inserting partial tile (row=759306,col=1099576)
> at
> > > zoom_level=21 : database disk image is malformed
> > >
> > > NOTE: without the "-expand rgb" option, all the output tiles will be
> > > black, gdal_translate will warn you.
> > >
> > > The process failed due to insufficient disk space (70Gb free was not
> > > enough) but the resulting incomplete file (7Gb) looks good.
> > > Most of the space was used by the "partial_tiles" database, is there
> any
> > > settings I can use to force a more frequent "flush" of the tiles in the
> > > main database?
> >
> > I've pushed a fix for that per https://trac.osgeo.org/gdal/ticket/6462
>
> With the fix, I managed to convert a VRT whose dimensions and spatial
> registration is the same as yours to a MBTiles (which is 333476 x 160000
> large) at level 20. The temporary database didn't grow above 1 GB.
>
> I'm thinking it might probably be possible to improve the conversion
> process
> to not use the temp DB at all (which would be likely result in significant
> speedup as quick profiling showed that the write activity in the temp DB is
> quite intense) by aligning the origin of the destination raster to tiles
> boundaries during the conversion, so that GDAL blocks and MBTiles tiles
> aren't
> shifted. For a later improvement...
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/15b9cac3/attachment.html>

From xenon at alphapixel.com  Fri May  6 12:16:25 2016
From: xenon at alphapixel.com (Chris Hanson)
Date: Fri, 6 May 2016 13:16:25 -0600
Subject: [gdal-dev] OGR DWG Support
In-Reply-To: <0AD3FDEA-9F91-4682-8B9F-1E6BFB15648D@niuitmo.ru>
References: <0AD3FDEA-9F91-4682-8B9F-1E6BFB15648D@niuitmo.ru>
Message-ID: <CAGoufma1X5=eqjPQrALR7fSLAuOUEKGy7NGcQ=vgFwv8kv2_RA@mail.gmail.com>

I have nothing to add other than a well-maintained flexible licensed DWG
reader would be very welcomed by some.

On Thu, May 5, 2016 at 1:24 PM, Борзых Александр Андреевич <
191980 at niuitmo.ru> wrote:

> Hello devs,
>
> I just have posted my GSoC project info at
> https://trac.osgeo.org/gdal/wiki/DWG_driver
> Now it has a draft of new CAD support library (named libopencad), and
> detailed timeline.
> There are also links where you can see what have already been done in that
> way.
>
> I will be very pleased with any suggestions and/or ideas for my project.
>
> Best regards,
> Alexander Borzykh
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Chris 'Xenon' Hanson, omo sanza lettere. Xenon at AlphaPixel.com
http://www.alphapixel.com/
Training • Consulting • Contracting
3D • Scene Graphs (Open Scene Graph/OSG) • OpenGL 2 • OpenGL 3 • OpenGL 4 •
GLSL • OpenGL ES 1 • OpenGL ES 2 • OpenCL
Legal/IP • Code Forensics • Digital Imaging • GIS • GPS •
osgEarth • Terrain • Telemetry • Cryptography • LIDAR • Embedded • Mobile •
iPhone/iPad/iOS • Android
@alphapixel <https://twitter.com/alphapixel> facebook.com/alphapixel (775)
623-PIXL [7495]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/72182a8b/attachment.html>

From schwehr at gmail.com  Fri May  6 13:55:33 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 6 May 2016 13:55:33 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <201605052325.11402.even.rouault@spatialys.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
Message-ID: <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>

I was not intending for C++11 to be a big part of the discussion as it is a
much more complicated topic, but I do appreciate the discussion.  I picked
the stack + memset -> std::vector(nSize, initialValue) to do first because
I thought it was a simpler issue than most and we could use it to figure
out how to go about these sorts of discussions.  It's not a show stoper,
but it is a real need.

At this point, I think it would be good if we could pause the C++11
discussion for a bit and back up to the original question.

I'd like to ask folks a couple of things:

- If you could stack rank (all or some) the options assuming that C++14 was
available
- Is your top pick far better than the rest or just a little better?
- Are there any options that you think should not be used in GDAL?
- Are there any reasons to be for or against any particular alternative
that we need to call out?

My belief is that for this particular proposal, we should not have the
C++11/14 discussion unless the best overall solution requires a newer
version of C++.  The solution I propose to be the best works in C++03 and
newer.


On Thu, May 5, 2016 at 2:25 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> > I misinterpreted this thread because of the title.  It seems this isn't
> > really about code style or C++ 11.
>
> I agree this thread mixes different topics, which causes some confusion.
> The
> word C++11 appearing in a doc has created some passion, whereas it is
> probably
> not the heart of the subject.
>
> Kurt has contributed to a lot of cleanup in the code base over the last
> months, mostly in applying stricter formatting rules, bool'ifying,
> const'ifying when possible, moving variable declarations close to their
> initialization, etc.. (Kurt, correct me if I'm wrong.), also addressing a
> bunch of Covertiy Scan warnings, etc.
>
> I've actually encouraged him to share his thoughts regarding cleanups with
> the
> rest of the community so that we can decide which are worth to be rules
> that
> apply to the project as a whole, and if some tooling is needed to
> automate/enforce them.
>
> > It's really about Google wanting to use
> > heap over stack because of its particular use of the library.  There is
> no
> > need for C++ 11 for that and it would seem that doing a compile-time
> > policy-based array isn't too hard (proof of concept below).  Perhaps
> Google
> > could flush something like this out to its liking and replace current
> stack
> > allocations that cause it issues.
>
> This use case is probably shared by other actors that use GDAL for massive
> data processing, and if the solution to reduce stack usage doesn't hurt
> more
> mundane use cases, we probably don't need the #ifdef complication.
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/571e5fac/attachment.html>

From schwehr at gmail.com  Fri May  6 14:07:26 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 6 May 2016 14:07:26 -0700
Subject: [gdal-dev] Minimum supported C and C++ standards
Message-ID: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>

There has been lively discussion on if/when GDAL moves to require compilers
with newer C and C++ standard versions.  This email is meant to fork the
this discussion away from the local stack + memset -> std::vector
discussion.  I'm trying to draft a proposal based on the discussion, but it
is a lot hardered.

I suggest folks think about starting off with an empty (or nearly empty)
white list of features and give a look at documents like:

https://chromium-cpp.appspot.com/.

GDAL is very different than Chromium, but I think it is great that they
have a place for contributors to get a summary of what is considered okay
and what is blacklisted.

We currently have experiments with override/final and std::mutex/lock_guard
for those compiling with GDAL >= C++11.  I think starting off with nullptr
might be a good and one of the simplest places to start.  Even suggested a
while ago making nullptr be a #define to NULL for C++03 and we current have
#ifdef NULL_AS_NULLPTR #define NULL nullptr in cpl_port.h, so it is already
setup for people to try.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/2c2b0bec/attachment.html>

From tkeitt at utexas.edu  Fri May  6 14:37:28 2016
From: tkeitt at utexas.edu (Tim Keitt)
Date: Fri, 6 May 2016 14:37:28 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
Message-ID: <CANnL8gpEu8SZ1bxezKkcYs1B4zZpPfqj1ac123mNwctkxJ+6KA@mail.gmail.com>

http://www.keittlab.org/

On Fri, May 6, 2016 at 1:55 PM, Kurt Schwehr <schwehr at gmail.com> wrote:

> I was not intending for C++11 to be a big part of the discussion as it is
> a much more complicated topic, but I do appreciate the discussion.  I
> picked the stack + memset -> std::vector(nSize, initialValue) to do first
> because I thought it was a simpler issue than most and we could use it to
> figure out how to go about these sorts of discussions.  It's not a show
> stoper, but it is a real need.
>
> At this point, I think it would be good if we could pause the C++11
> discussion for a bit and back up to the original question.
>
> I'd like to ask folks a couple of things:
>
> - If you could stack rank (all or some) the options assuming that C++14
> was available
>

What are the options and for what purpose? (I have not followed the thread
in detail.) I'd like to see pointer types banished or if necessary wrapped
with std::auto_ptr (or whichever variant makes sense).


> - Is your top pick far better than the rest or just a little better?
> - Are there any options that you think should not be used in GDAL?
> - Are there any reasons to be for or against any particular alternative
> that we need to call out?
>

Always prefer vanilla standard library over others.


>
> My belief is that for this particular proposal, we should not have the
> C++11/14 discussion unless the best overall solution requires a newer
> version of C++.  The solution I propose to be the best works in C++03 and
> newer.
>

I have longed for GDAL to be a modern C++ library that follows the STL, so
any move in that direction would be terrific in my opinion. It would be
nice to have the latest and greatest C++ bits, but I would be very happy
with C++03. I strongly suggest maximizing use of the STL to avoid
reinventing the wheel. If you need custom allocation, use a custom
allocator with an STL data structure. I would also recommend judicious use
of Boost where appropriate.

THK


>
>
> On Thu, May 5, 2016 at 2:25 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>>
>> > I misinterpreted this thread because of the title.  It seems this isn't
>> > really about code style or C++ 11.
>>
>> I agree this thread mixes different topics, which causes some confusion.
>> The
>> word C++11 appearing in a doc has created some passion, whereas it is
>> probably
>> not the heart of the subject.
>>
>> Kurt has contributed to a lot of cleanup in the code base over the last
>> months, mostly in applying stricter formatting rules, bool'ifying,
>> const'ifying when possible, moving variable declarations close to their
>> initialization, etc.. (Kurt, correct me if I'm wrong.), also addressing a
>> bunch of Covertiy Scan warnings, etc.
>>
>> I've actually encouraged him to share his thoughts regarding cleanups
>> with the
>> rest of the community so that we can decide which are worth to be rules
>> that
>> apply to the project as a whole, and if some tooling is needed to
>> automate/enforce them.
>>
>> > It's really about Google wanting to use
>> > heap over stack because of its particular use of the library.  There is
>> no
>> > need for C++ 11 for that and it would seem that doing a compile-time
>> > policy-based array isn't too hard (proof of concept below).  Perhaps
>> Google
>> > could flush something like this out to its liking and replace current
>> stack
>> > allocations that cause it issues.
>>
>> This use case is probably shared by other actors that use GDAL for massive
>> data processing, and if the solution to reduce stack usage doesn't hurt
>> more
>> mundane use cases, we probably don't need the #ifdef complication.
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>>
>
>
>
> --
> --
> http://schwehr.org
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/77221523/attachment-0001.html>

From schwehr at gmail.com  Fri May  6 14:47:01 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 6 May 2016 14:47:01 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CANnL8gpEu8SZ1bxezKkcYs1B4zZpPfqj1ac123mNwctkxJ+6KA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CANnL8gpEu8SZ1bxezKkcYs1B4zZpPfqj1ac123mNwctkxJ+6KA@mail.gmail.com>
Message-ID: <CACmBxyu4SKPc2i359VBkwhziyK4qYUzKKPDvzbxD+SHiqLQ8gA@mail.gmail.com>

For stack ranking, see the "alternatives" section of this (and I did not
include my preferred std::vector solution in the list):

https://docs.google.com/document/d/1Y9flzxj3Uz1vTEPCBmlswgi470m8i-oepGutVkbowfc/pub

BTW, Someone pointed out that I originally listed autoptr (which just won't
work) when I mean to say scoped_ptr.h.  I chatted with the original author
of scoped_ptr last year and have permission to share the latest version
from inside Google should that somehow become the solution of choice for
any particular issue, but I really think we should avoid scoped_ptr when
unique_ptr exists, is a standard and is more robust.  std::vector was not
the first solution I came up with for this issue.

On Fri, May 6, 2016 at 2:37 PM, Tim Keitt <tkeitt at utexas.edu> wrote:

>
>
> http://www.keittlab.org/
>
> On Fri, May 6, 2016 at 1:55 PM, Kurt Schwehr <schwehr at gmail.com> wrote:
>
>> I was not intending for C++11 to be a big part of the discussion as it is
>> a much more complicated topic, but I do appreciate the discussion.  I
>> picked the stack + memset -> std::vector(nSize, initialValue) to do first
>> because I thought it was a simpler issue than most and we could use it to
>> figure out how to go about these sorts of discussions.  It's not a show
>> stoper, but it is a real need.
>>
>> At this point, I think it would be good if we could pause the C++11
>> discussion for a bit and back up to the original question.
>>
>> I'd like to ask folks a couple of things:
>>
>> - If you could stack rank (all or some) the options assuming that C++14
>> was available
>>
>
> What are the options and for what purpose? (I have not followed the thread
> in detail.) I'd like to see pointer types banished or if necessary wrapped
> with std::auto_ptr (or whichever variant makes sense).
>
>
>> - Is your top pick far better than the rest or just a little better?
>> - Are there any options that you think should not be used in GDAL?
>> - Are there any reasons to be for or against any particular alternative
>> that we need to call out?
>>
>
> Always prefer vanilla standard library over others.
>
>
>>
>> My belief is that for this particular proposal, we should not have the
>> C++11/14 discussion unless the best overall solution requires a newer
>> version of C++.  The solution I propose to be the best works in C++03 and
>> newer.
>>
>
> I have longed for GDAL to be a modern C++ library that follows the STL, so
> any move in that direction would be terrific in my opinion. It would be
> nice to have the latest and greatest C++ bits, but I would be very happy
> with C++03. I strongly suggest maximizing use of the STL to avoid
> reinventing the wheel. If you need custom allocation, use a custom
> allocator with an STL data structure. I would also recommend judicious use
> of Boost where appropriate.
>
> THK
>
>
>>
>>
>> On Thu, May 5, 2016 at 2:25 PM, Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>>
>>> > I misinterpreted this thread because of the title.  It seems this isn't
>>> > really about code style or C++ 11.
>>>
>>> I agree this thread mixes different topics, which causes some confusion.
>>> The
>>> word C++11 appearing in a doc has created some passion, whereas it is
>>> probably
>>> not the heart of the subject.
>>>
>>> Kurt has contributed to a lot of cleanup in the code base over the last
>>> months, mostly in applying stricter formatting rules, bool'ifying,
>>> const'ifying when possible, moving variable declarations close to their
>>> initialization, etc.. (Kurt, correct me if I'm wrong.), also addressing a
>>> bunch of Covertiy Scan warnings, etc.
>>>
>>> I've actually encouraged him to share his thoughts regarding cleanups
>>> with the
>>> rest of the community so that we can decide which are worth to be rules
>>> that
>>> apply to the project as a whole, and if some tooling is needed to
>>> automate/enforce them.
>>>
>>> > It's really about Google wanting to use
>>> > heap over stack because of its particular use of the library.  There
>>> is no
>>> > need for C++ 11 for that and it would seem that doing a compile-time
>>> > policy-based array isn't too hard (proof of concept below).  Perhaps
>>> Google
>>> > could flush something like this out to its liking and replace current
>>> stack
>>> > allocations that cause it issues.
>>>
>>> This use case is probably shared by other actors that use GDAL for
>>> massive
>>> data processing, and if the solution to reduce stack usage doesn't hurt
>>> more
>>> mundane use cases, we probably don't need the #ifdef complication.
>>>
>>> --
>>> Spatialys - Geospatial professional services
>>> http://www.spatialys.com
>>>
>>
>>
>>
>> --
>> --
>> http://schwehr.org
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>


-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/50d33aa8/attachment.html>

From andrew.bell.ia at gmail.com  Fri May  6 14:47:19 2016
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Fri, 6 May 2016 16:47:19 -0500
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
Message-ID: <CACJ51z0eiWbc3bedx94BT-boExBHHpdOcNC_cezW2YpMPZoD4A@mail.gmail.com>

On Fri, May 6, 2016 at 3:55 PM, Kurt Schwehr <schwehr at gmail.com> wrote:

> I was not intending for C++11 to be a big part of the discussion as it is
> a much more complicated topic, but I do appreciate the discussion.  I
> picked the stack + memset -> std::vector(nSize, initialValue) to do first
> because I thought it was a simpler issue than most and we could use it to
> figure out how to go about these sorts of discussions.  It's not a show
> stoper, but it is a real need.
>
> At this point, I think it would be good if we could pause the C++11
> discussion for a bit and back up to the original question.
>
> I'd like to ask folks a couple of things:
>
> - If you could stack rank (all or some) the options assuming that C++14
> was available
> - Is your top pick far better than the rest or just a little better?
> - Are there any options that you think should not be used in GDAL?
> - Are there any reasons to be for or against any particular alternative
> that we need to call out?
>

Doing a heap-based array is simple.  You can pretty-much copy the
std::array code from the standard library and introduce the indirection you
require.  It's better than a vector for the reasons you already mentioned.
Something that looks and acts like an array is better than a vector because
it makes the use clear.  If you have C++ 11 you can simply wrap
std::array.  C++03 has value initialization for arrays: new int[10]();, so
that's another alternative.

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160506/04a668fc/attachment.html>

From mateusz at loskot.net  Fri May  6 14:47:18 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 6 May 2016 22:47:18 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
Message-ID: <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>

On 6 May 2016 at 21:55, Kurt Schwehr <schwehr at gmail.com> wrote:
> My belief is that for this particular proposal, we should not have the
> C++11/14 discussion unless the best overall solution requires a newer
> version of C++.  The solution I propose to be the best works in C++03 and
> newer.

Simply, the initial proposal was quite confusing.

The 'title' said indicated it was "mostly focused on C++11/14 & C99/11",
while the content mentioned mostly the std::vector as malloc'ed arrays
replacement.

Considering current codebase, GDAL is written in C and compiled in C++.
The only major C++ feature used in GDAL is classes and polymorphism.

I'm not sure if the facts mentioned in the proposal, namely
"Want to focus on maintainability and readability of code",
is meant to be a fact or a goal.
If you ask any seasoned C programmer for opinion, I bet she will
consider GDAL codebase as clear and readable.
If you ask a C++ programmer, the answer might be different.

IMO, I doubt any C++11/14 feature will increase the current code,
unless it is considered to ditch many of CPL features and replace
them with C++ standard features (string bashing operations, string containers,
containers for other types, threading API, etc.).

Certainly, any new line to be written may benefit from auto,
constexpr, using, nullptr, range loops - but for a "C with classes"
codebase as GDAL, it would be cosmetic improvement, if any.

Surely, the override and final will help compiler to catch potential bugs.
Also, C++11/14 compilation mode is generally stricter, so it might
help to catch bugs.

Simply, the whole proposal is becoming vague.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From jmckenna at gatewaygeomatics.com  Fri May  6 15:41:42 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Fri, 6 May 2016 19:41:42 -0300
Subject: [gdal-dev] GDAL/OGR 2.1.0 released
In-Reply-To: <201605021119.27211.even.rouault@spatialys.com>
References: <201605021119.27211.even.rouault@spatialys.com>
Message-ID: <4d084a24-44cb-a750-a178-1d72275ac01d@gatewaygeomatics.com>

MS4W 3.1.4 is now available containing GDAL 2.1.0 at http://ms4w.com/

-jeff



On 2016-05-02 6:19 AM, Even Rouault wrote:
> Hi,
>
> On behalf of the GDAL/OGR development team and community, I am pleased to
> announce the release of GDAL/OGR 2.1.0.  GDAL/OGR is a C++ geospatial
> data access library for raster and vector file formats, databases and
> web services.  It includes bindings for several languages, and a variety
> of command line tools.

-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From even.rouault at spatialys.com  Sat May  7 08:27:19 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 7 May 2016 17:27:19 +0200
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
Message-ID: <201605071727.19114.even.rouault@spatialys.com>

Le vendredi 06 mai 2016 23:07:26, Kurt Schwehr a écrit :
> There has been lively discussion on if/when GDAL moves to require compilers
> with newer C and C++ standard versions.  This email is meant to fork the
> this discussion away from the local stack + memset -> std::vector
> discussion.  I'm trying to draft a proposal based on the discussion, but it
> is a lot hardered.
> 
> I suggest folks think about starting off with an empty (or nearly empty)
> white list of features and give a look at documents like:
> 
> https://chromium-cpp.appspot.com/.

My personal issue is that most of the stuff mentionned in there is alien to me. 
At best only a rough theoretical understanding with no practical use. Perhaps 
I should find some time to educate myself on C++11/14 but reading pages like 
http://en.cppreference.com/w/cpp/utility/forward doesn't give a strong 
incentive to do so ;-)

> 
> GDAL is very different than Chromium, but I think it is great that they
> have a place for contributors to get a summary of what is considered okay
> and what is blacklisted.

I'll try to give my perspective over those choices of language features.

As Mateusz righly wrote, GDAL is a mix of C (not that much if you exclude the 
external libraries that are internalized), C++ consisting of C with classes 
(and avoiding the over use of classes that is typical in a bunch of Java 
projects), a few uses of templates for methods working on different data types 
in performance sensitive places.

C++03 already offers so many things to master that I can guess  that C++11 and 
C++14 have added again more "interesting" stuff on top of the old ways (since 
hardly nothing prevents you from using a shiny C++ feature next to/together 
with a C72 one. Which is porbably one of the main issue of the evolution of 
C++). Those new features certainly solve problems, but I'm pretty sure they 
also add new potential problems... I recommend having a look at 
http://horstmann.com/cpp/pitfalls.html and looking at the date. Now imagine 
what a later edition ~20 years later could be with all new C++ features. 
Actually look at the snippet in appendix for a good candidate (actually 
derived from a tutorial explaing rvalue reference)

Remembering a number of submitted patches, I'm pretty sure some occasional (or 
not so occasional) contributors to GDAL are not software engineers as their 
first qualification, which is OK since some parts of GDAL are really domain 
specific. And even those who are in the software business are not necessarily 
familiar with all C++ features, or on the contrary are familiar enough to know 
they don't want to use them, or worse, others can believe that they are 
familiar with them, but misuse them in subtle ways (never seen an 
enthusiastic fresh graduate wanting to apply blindly in your project the nice 
stuff seen in books?). IMHO we should try to focus to attract developers that 
are more interested by geospatial stuff than by C++ subtelties. GDAL purpose is 
not to be a showcase for C++ features, but to solve real-world problems. 
Hopefully everybody agrees with that.

If we move to a later C++ standard, or even use features of C++98 we currently 
don't use, I'd advocate for using things that are obviously making the code 
better / more readable. Honestly who finds that 
"std::unique_ptr<int *, std::function<void(char *)>> Vals(CPLCalloc(256, 0), 
CPLFree);" is obviously more readable, efficient and less error prone than
"std::vector Vals(256,0)" ? 

In my opinion the features of the language you use (of course, once you've 
understood and mastered them to the point where they are familiar to you 
without needing to open a programming book) play only a minor role in the 
maintenance and extensibility of the code (at least, they shouldn't !). The 
real challenges are to understand the overall design, the details of  the 
algorithms, the formats, the interactions between different parts of the code, 
what is performance sensitive and what is not, the history ... So definitely 
one of the best investment (and less risky) for maintenance is to add comments 
where they are needed. 

Perhaps rather than thinking to which C++ features we wish, we should 
concentrate on the problems we want to solve. The reasoning should be "We have 
this problem/need, we currently use solution X to address it, but this has the 
following defects and I think that feature Y is the best way to solve it".
And if that's about existing code, we must keep in mind that every change has 
the potential to break working things, so the ratio benefit / risk must be >> 1 
(>> meaning here "significantly greater than", and not the right bitshift 
operator, or the closing of 2 levels of templates, or the input stream 
operator, or an overloaded operator with a semantics left to the good will of 
the programmer)

The scope of changes should be also defined : restricted to internal 
implementation details or impacting the API ?

Tihs is a more trivial consideration, but code churn does make backporting 
harder (patches no longer apply cleanly). Although it's an inconvenience that 
is acceptable if it makes the future (significantly) better.

Cheers,

Even

(*) The following code compiles warning free with -std=c++11 -Wall -Wextra -
pedantic with GCC 5.2.0 but asserts at runtime. Find why. OK, you may find it 
easily since I mentionned this would assert. Now imagine this is a code 
contribution that you review. Would you figure out the error ?
Of course, with C or C with classes, the language already offers room for bugs. 
But the more language features, the more bug opportunities you add.

#include <string>
#include <cassert>

class Base
{
  protected:
    std::string x;
  public:
    Base(const std::string& xin) : x(xin) {}
    Base(Base const & rhs) : x(rhs.x) { }
    Base(Base&& rhs) { x = rhs.x; rhs.x = "moved"; }
};

class Derived: public Base
{
  protected:
    std::string y;
  public:
    Derived(const std::string& xin) : Base(xin), y(xin) { }
    Derived(Derived const & rhs) : Base(rhs), y(rhs.y) { }
    Derived(Derived&& rhs) : Base(rhs) { y = rhs.y; rhs.y = "moved"; }
    ~Derived() { assert(y == x); }
};

Derived foo(Derived d)
{
  return d;
}

int main()
{
  foo(Derived("x"));
  return 0;
}

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From gdal at stripfamily.net  Sat May  7 09:59:15 2016
From: gdal at stripfamily.net (David Strip)
Date: Sat, 7 May 2016 10:59:15 -0600
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <201605071727.19114.even.rouault@spatialys.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605071727.19114.even.rouault@spatialys.com>
Message-ID: <572E1EE3.5000009@stripfamily.net>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/639ca025/attachment.html>

From schwehr at gmail.com  Sat May  7 10:10:23 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sat, 7 May 2016 10:10:23 -0700
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <201605071727.19114.even.rouault@spatialys.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605071727.19114.even.rouault@spatialys.com>
Message-ID: <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>

This is example demonstrates that we are in-general fighting hard against
C++... up-hill both ways in a blizzard.  :)  This is why starting with zero
features and working our way up with a white list gives examples of correct
usage.  It looks like a lot of GDAL development happens by
copy-paste-tweak, so good examples are key.  And for every issue, we have
solutions that are valid C/C++03/C++11/C++14... the best solution is not
necessarily in any particular one.


> If we move to a later C++ standard, or even use features of C++98 we
> currently
> don't use, I'd advocate for using things that are obviously making the code
> better / more readable. Honestly who finds that
> "std::unique_ptr<int *, std::function<void(char *)>> Vals(CPLCalloc(256,
> 0),
> CPLFree);" is obviously more readable, efficient and less error prone than
> "std::vector Vals(256,0)" ?
>
>
This is cart before the horse but... as fast as I can so expect typos.  Now
just think of a ~1K long function or method with tons of instances and lots
of places to bailout successfully or as failures.  We have > 9K
free/CPLFree/CPLdelete/CPLDestroys that could be < ~100.

GDALMyBigObj *poInstance = CPLCalloc(sizeof(GDALMyBigObj);
...
if (oops) {
   CPLDelete(poInstance)
   return;
}
...
return;  // kaboom
...
if (oops) {
   CPLDelete(poInstance)
   return;
}
...
if (oops) {
   CPLDelete(poInstance)
   return;
}

CPLDelete(poInstance)
return;

or worse

GDALMyBigObj *poInstance = CPLCalloc(sizeof(GDALMyBigObj);
...
if (oops) {
   goto END;
}
...
// Careful what you do here because you are crossing gotos.
...
if (oops) {
   goto END;
}
...
if (oops) {
   goto END;
}
...
END:
CPLDelete(poInstance)
return;

when you could have...  And yes, getting to this is not trivial.  There are
multiple things here to discuss:

auto poInstance = std::make_unique<GDALMyBigObj>(arg1, arg2, arg3);

if(oops)
  return;  // Everything cleaned up nice
...

if(oops)
  return;  // Everything cleaned up nice
...

if(oops)
  return;  // Everything cleaned up nice
...

return;  // Woohoo!  Success!

My example of the deleter comes from real code where I don't what a heap
checker barfing at me when ever a test fails.  Makes writing and debugging
tests insane....

// Apache 2.0 license...

{
  // ...
  unique_ptr<OGRFeature> feature(layer->GetNextFeature());
  OGRGeometry *geometry = feature->GetGeometryRef();
  ASSERT_NE(nullptr, geometry);

  char *wkt_tmp = nullptr;
  ASSERT_EQ(OGRERR_NONE, geometry->exportToWkt(&wkt_tmp));
  std::unique_ptr<char, CplFreeDeleter> wkt(wkt_tmp);

  wkt_tmp = nullptr;
  ASSERT_STREQ("POINT (-109.27 10.3)", wkt.get());

}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/a01e0230/attachment.html>

From gdal at stripfamily.net  Sat May  7 12:00:22 2016
From: gdal at stripfamily.net (David Strip)
Date: Sat, 7 May 2016 13:00:22 -0600
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605071727.19114.even.rouault@spatialys.com>
 <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
Message-ID: <572E3B46.7060902@stripfamily.net>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/e53b5158/attachment.html>

From andrew.bell.ia at gmail.com  Sat May  7 13:48:56 2016
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Sat, 7 May 2016 15:48:56 -0500
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <572E3B46.7060902@stripfamily.net>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605071727.19114.even.rouault@spatialys.com>
 <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
 <572E3B46.7060902@stripfamily.net>
Message-ID: <CACJ51z2HSS798Y5nG26zJRJ=7GULaAfLmbeFiFQXnzvkcBoEjQ@mail.gmail.com>

On Sat, May 7, 2016 at 2:00 PM, David Strip <gdal at stripfamily.net> wrote:

> On 5/7/2016 11:10 AM, Kurt Schwehr wrote:
>


> This is cart before the horse but... as fast as I can so expect typos.
> Now just think of a ~1K long function or method with tons of instances and
> lots of places to bailout successfully or as failures.

This is why starting with zero features and working our way up with a white
> list gives examples of correct usage.  It looks like a lot of GDAL
> development happens by copy-paste-tweak, so good examples are key.  And for
> every issue, we have solutions that are valid C/C++03/C++11/C++14... the
> best solution is not necessarily in any particular one.
>
> Amen.
>
>
> auto poInstance = std::make_unique<GDALMyBigObj>(arg1, arg2, arg3);
>
>
I think that some of you may be talking about features of a language that
you really aren't comfortable with.  The notion of disallowing language
features because someone thinks they aren't useful or are confusing isn't
the way to go, IMO.  C++, more than most other languages, goes through
pains before features are introduced.  Nobody has to use all the features,
but all are useful to a subset of users and their proper use either makes
the code more clear, more efficient or less prone to bugs.  (Yes, auto_ptr
was awful, but nobody uses auto_ptr anymore). Regardless of the language or
language feature, code can be clear or unclear and it's not the fault of
the feature for the lack of clarity.  It may be that the reader hasn't seen
the use before or it may be that the writer didn't use feature in the best
way possible, but to make lists because Fred or Sam don't like this or that
isn't productive.

This example is more powerful than just the elimination of the
> opportunities for memory leaks. Kurt has snuck in the use of the
> GDALMyBigObj constructor, which makes the initialization of the object more
> transparent (and in fact assures that it occurs.) And if I correctly
> understand std::make_unique, by making poinstance const, we can go farther
> and guarantee that this pointer isn't assigned to another pointer, so that
> the object will be destroyed at the end of current scope. (If the pointer
> is assigned to another std::make_unique ptr, the scope of that pointer will
> control when the object is destroyed).
>

As someone else said, GDAL code looks like C code, not like well-structured
C++.  That's OK.  But the notion of shoe-horning this or that feature into
the codebase seems fraught.  If you're going to say that C++ 11 is OK, then
fine, use C++ 11 where appropriate in ways that make the code more
readable, more efficient or smaller.  The reason to disallow a feature
shouldn't be about the whims of a developer or two, it should be because
compilers you are targeting don't support them or because you have ABI
issues.  Reviewing code as it's submitted for clarity and efficiency is a
much better way to ensure quality code than is coming up with a
semi-arbitrary list of acceptable language features.  Yes, sometimes even
"goto" is a good thing.

I also don't agree that more features mean more bugs.  More features means
a language that takes more care to learn, but it doesn't mean more bugs.
If you're uncomfortable with move constructors, don't use them.  But they
are useful at certain times for optimization.  The provided example is just
confusing and useless code, not an indictment of move constructors.  There
are plenty of newer language features that make code LESS susceptible to
bugs, when used properly.

P.S. - The above would just normally be written:

std::unique_ptr<GDALMyBigObj> obj(new GDALMyBigObj(arg1, arg2, arg3));

although without context, it's unclear that this is good bad or neither.
If I saw this code without a comment, I'd be tempted to change it to:

GDALMyBigObj obj(arg1, arg2, arg3);

because, hey, why not put it on the stack?  The important bit here is that
someone needs to add a comment that it was put on the heap for a reason --
to keep the stack small.

P.P.S - I used to think lambdas were confusing, useless things.  Having now
seen and written enough code containing lambdas, I'm happy to admit that I
was wrong.

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/4abf641a/attachment.html>

From mapoubelle22 at gmail.com  Sat May  7 14:57:18 2016
From: mapoubelle22 at gmail.com (fred p)
Date: Sat, 7 May 2016 21:57:18 +0000
Subject: [gdal-dev] how to write multi-IFD TIFF files ?
Message-ID: <CADzX+2WtW-gh+-WNL3O_0uNxZdhKjY9zZoqFzyx+ahCJ8DLscA@mail.gmail.com>

Hello,
I am looking for a way to write multi-IFD TIFF files with GDAL (each IFD
being JPEG or LZW compressed), for example with gdal_translate or (better
if possible) the Python API but without any success.
Is it possible anyway ?
Thanks for your help !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/85aad5a2/attachment.html>

From tkeitt at utexas.edu  Sat May  7 14:57:20 2016
From: tkeitt at utexas.edu (Tim Keitt)
Date: Sat, 7 May 2016 14:57:20 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
Message-ID: <CANnL8gork+J7HZPxxe8rUYzg15COtYMtNocor6ErLRLOQqHGxg@mail.gmail.com>

http://www.keittlab.org/

On Fri, May 6, 2016 at 2:47 PM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 6 May 2016 at 21:55, Kurt Schwehr <schwehr at gmail.com> wrote:
> > My belief is that for this particular proposal, we should not have the
> > C++11/14 discussion unless the best overall solution requires a newer
> > version of C++.  The solution I propose to be the best works in C++03 and
> > newer.
>
> Simply, the initial proposal was quite confusing.
>
> The 'title' said indicated it was "mostly focused on C++11/14 & C99/11",
> while the content mentioned mostly the std::vector as malloc'ed arrays
> replacement.
>
> Considering current codebase, GDAL is written in C and compiled in C++.
> The only major C++ feature used in GDAL is classes and polymorphism.
>
> I'm not sure if the facts mentioned in the proposal, namely
> "Want to focus on maintainability and readability of code",
> is meant to be a fact or a goal.
> If you ask any seasoned C programmer for opinion, I bet she will
> consider GDAL codebase as clear and readable.
> If you ask a C++ programmer, the answer might be different.
>
> IMO, I doubt any C++11/14 feature will increase the current code,
> unless it is considered to ditch many of CPL features and replace
> them with C++ standard features (string bashing operations, string
> containers,
> containers for other types, threading API, etc.).
>

That's exactly my preference. For those of us who have to remember too many
things, using the standard library is a godsend because it is exceptionally
well documented online and used in many places.


>
> Certainly, any new line to be written may benefit from auto,
> constexpr, using, nullptr, range loops - but for a "C with classes"
> codebase as GDAL, it would be cosmetic improvement, if any.
>

It is true that unless you refactor along the lines of Boost, then these
features are not used as effectively.


>
> Surely, the override and final will help compiler to catch potential bugs.
> Also, C++11/14 compilation mode is generally stricter, so it might
> help to catch bugs.
>

My experience with C++11 is that it is vastly less error prone and more
readable. But of course there is a big cost to rewriting code, so I
understand the conundrum.

THK


>
> Simply, the whole proposal is becoming vague.
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/1c355594/attachment-0001.html>

From tkeitt at utexas.edu  Sat May  7 15:05:58 2016
From: tkeitt at utexas.edu (Tim Keitt)
Date: Sat, 7 May 2016 15:05:58 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyu4SKPc2i359VBkwhziyK4qYUzKKPDvzbxD+SHiqLQ8gA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CANnL8gpEu8SZ1bxezKkcYs1B4zZpPfqj1ac123mNwctkxJ+6KA@mail.gmail.com>
 <CACmBxyu4SKPc2i359VBkwhziyK4qYUzKKPDvzbxD+SHiqLQ8gA@mail.gmail.com>
Message-ID: <CANnL8gqYh9D5V-5kT-aCYdcpmsxO=op967z+Ken8sEtJH9ARcg@mail.gmail.com>

On Fri, May 6, 2016 at 2:47 PM, Kurt Schwehr <schwehr at gmail.com> wrote:

> For stack ranking, see the "alternatives" section of this (and I did not
> include my preferred std::vector solution in the list):


That seems like a reasonable solution. The function/method call interface
is where I would begin substituting STL for C equivalents if it were up to
me. Once those are set, then you can refactor as needed behind the API.

I was not recommending autoptr, I just did not go look up the replacements.
Also, much of C++11 can be accomplished using Boost as many of the features
originated there as libraries for C++03. A non-trivial dependency to be
sure.

THK

http://www.keittlab.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/03bfbee1/attachment.html>

From even.rouault at spatialys.com  Sat May  7 15:19:51 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 8 May 2016 00:19:51 +0200
Subject: [gdal-dev] how to write multi-IFD TIFF files ?
In-Reply-To: <CADzX+2WtW-gh+-WNL3O_0uNxZdhKjY9zZoqFzyx+ahCJ8DLscA@mail.gmail.com>
References: <CADzX+2WtW-gh+-WNL3O_0uNxZdhKjY9zZoqFzyx+ahCJ8DLscA@mail.gmail.com>
Message-ID: <201605080019.51485.even.rouault@spatialys.com>

Le samedi 07 mai 2016 23:57:18, fred p a écrit :
> Hello,
> I am looking for a way to write multi-IFD TIFF files with GDAL (each IFD
> being JPEG or LZW compressed), for example with gdal_translate or (better
> if possible) the Python API but without any success.
> Is it possible anyway ?

Hi,

No this is not currently possible in the general case (internal overviews are 
implemented as IFD, but flagged as such and not as general purpose IFD). Would 
probably not a huge effort to implement, but in the mean time you may use GDAL 
to create individual IDF and then use tifcp/geotifcp to assemble them.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From schwehr at gmail.com  Sat May  7 23:01:09 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sat, 7 May 2016 23:01:09 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
Message-ID: <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>

Mateusz,

Thanks for calling out the confusion!  Are meaning to say that my proposal
<https://docs.google.com/document/d/1Y9flzxj3Uz1vTEPCBmlswgi470m8i-oepGutVkbowfc/pub>
is
vague?  I rephrased the status to be more clear that the C++11/14 focus is
the GDAL community (AKA the majority of this thread), not the proposal.
Hopefully it is clearer now.  Please read the proposal as just looking at
the possibilities.  Please try not to care about C++ language version when
trying to do a first round review of ideas.

On Fri, May 6, 2016 at 2:47 PM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 6 May 2016 at 21:55, Kurt Schwehr <schwehr at gmail.com> wrote:
> > My belief is that for this particular proposal, we should not have the
> > C++11/14 discussion unless the best overall solution requires a newer
> > version of C++.  The solution I propose to be the best works in C++03 and
> > newer.
>
> Simply, the initial proposal was quite confusing.
>
> The 'title' said indicated it was "mostly focused on C++11/14 & C99/11",
> while the content mentioned mostly the std::vector as malloc'ed arrays
> replacement.
>

That was just a status I added after the fact.  I worded it poorly.


>
> Considering current codebase, GDAL is written in C and compiled in C++.
> The only major C++ feature used in GDAL is classes and polymorphism.
>
>
I agree that GDAL has a strong feel of C compiled with C++ right now.

I disagree about C++ feature use.  I see algorithm, iostream, map, list,
sstream, a few exceptions, std::string (mostly in the form of CPLString),
vector, localization of variables, some templates, #define to static
consts, etc.

I'm not sure if the facts mentioned in the proposal, namely
> "Want to focus on maintainability and readability of code",
> is meant to be a fact or a goal.
>

That would be a goal.  And readability is going somewhat be subjective.


> If you ask any seasoned C programmer for opinion, I bet she will
> consider GDAL codebase as clear and readable.
> If you ask a C++ programmer, the answer might be different.
>
> IMO, I doubt any C++11/14 feature will increase the current code,
> unless it is considered to ditch many of CPL features and replace
> them with C++ standard features (string bashing operations, string
> containers,
> containers for other types, threading API, etc.).
>
>
"increase the current code" <- Did you mean increase the reliability?  Or
size? Or complexity?


> Certainly, any new line to be written may benefit from auto,
> constexpr, using, nullptr, range loops - but for a "C with classes"
> codebase as GDAL, it would be cosmetic improvement, if any.
>
>
I disagree that C++11/14 changes would be cosmetic.  But this is the wrong
thread for this part of the discussion.


> Surely, the override and final will help compiler to catch potential bugs.
> Also, C++11/14 compilation mode is generally stricter, so it might
> help to catch bugs.
>
> Simply, the whole proposal is becoming vague.
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160507/95579084/attachment.html>

From Stefan.Blumentrath at nina.no  Sun May  8 13:31:17 2016
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Sun, 8 May 2016 20:31:17 +0000
Subject: [gdal-dev] GDAL 2.1 and Norwegian SOSI
In-Reply-To: <201605061206.01828.even.rouault@spatialys.com>
References: <10d1f16b1aca4830848a5f362f02cb53@NINSRV23.nina.no>
 <201605040948.35822.even.rouault@spatialys.com>
 <cdbbd586a2bd494483cfdc32ff3b5467@NINSRV23.nina.no>
 <201605061206.01828.even.rouault@spatialys.com>
Message-ID: <30c8bf84b7664cdcb73556d49598af8a@NINSRV23.nina.no>

Dear all,

Yesterday, I uploaded a patch for:
https://trac.osgeo.org/gdal/ticket/6503

Would be nice if someone could review and implement (the patch worked and solved the issue on my system).

An open question is whether the SOSI geometry "BUEP" (which describes a curve) should be translated to a curved OGR geometry or not. A possibly relevant background information: SOSI is a topological format and polygons are made up by the line geometries in a SOSI file. So, I don`t know if line strings and curved geometries would cause trouble if used in one and the same layer as well as for constructing polygons.

Kind regards,
Stefan

From ari.jolma at gmail.com  Mon May  9 00:09:22 2016
From: ari.jolma at gmail.com (Ari Jolma)
Date: Mon, 9 May 2016 10:09:22 +0300
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605071727.19114.even.rouault@spatialys.com>
 <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
Message-ID: <573037A2.3010904@gmail.com>

07.05.2016, 20:10, Kurt Schwehr kirjoitti:
>
> This is cart before the horse but... as fast as I can so expect 
> typos.  Now just think of a ~1K long function or method with tons of 
> instances and lots of places to bailout successfully or as failures.  
> We have > 9K free/CPLFree/CPLdelete/CPLDestroys that could be < ~100.

I am definitely for having support for unique/smart pointers to objects. 
In my experience one of the things making code difficult to understand 
(and thus maintain/enhance) is long subroutines. Smart pointers would 
often help a lot in that respect.

Ari

>
> GDALMyBigObj *poInstance = CPLCalloc(sizeof(GDALMyBigObj);
> ...
> if (oops) {
>    CPLDelete(poInstance)
>    return;
> }
> ...
> return;  // kaboom
> ...
> if (oops) {
>    CPLDelete(poInstance)
>    return;
> }
> ...
> if (oops) {
>    CPLDelete(poInstance)
>    return;
> }
>
> CPLDelete(poInstance)
> return;
>
> or worse
>
> GDALMyBigObj *poInstance = CPLCalloc(sizeof(GDALMyBigObj);
> ...
> if (oops) {
>    goto END;
> }
> ...
> // Careful what you do here because you are crossing gotos.
> ...
> if (oops) {
>    goto END;
> }
> ...
> if (oops) {
>    goto END;
> }
> ...
> END:
> CPLDelete(poInstance)
> return;
>
> when you could have...  And yes, getting to this is not trivial.  
> There are multiple things here to discuss:
>
> auto poInstance = std::make_unique<GDALMyBigObj>(arg1, arg2, arg3);
>
> if(oops)
> return;  // Everything cleaned up nice
> ...
>
> if(oops)
> return;  // Everything cleaned up nice
> ...
>
> if(oops)
> return;  // Everything cleaned up nice
> ...
>
> return;  // Woohoo!  Success!
>
> My example of the deleter comes from real code where I don't what a 
> heap checker barfing at me when ever a test fails.  Makes writing and 
> debugging tests insane....
>
> // Apache 2.0 license...
>
> {
>   // ...
>   unique_ptr<OGRFeature> feature(layer->GetNextFeature());
>   OGRGeometry *geometry = feature->GetGeometryRef();
>   ASSERT_NE(nullptr, geometry);
>
>   char *wkt_tmp = nullptr;
>   ASSERT_EQ(OGRERR_NONE, geometry->exportToWkt(&wkt_tmp));
>   std::unique_ptr<char, CplFreeDeleter> wkt(wkt_tmp);
>
>   wkt_tmp = nullptr;
>   ASSERT_STREQ("POINT (-109.27 10.3)", wkt.get());
>
> }
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/c5ddd438/attachment.html>

From ari.jolma at gmail.com  Mon May  9 01:15:22 2016
From: ari.jolma at gmail.com (Ari Jolma)
Date: Mon, 9 May 2016 11:15:22 +0300
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
Message-ID: <5730471A.1080806@gmail.com>

05.05.2016, 01:30, Kurt Schwehr kirjoitti:
> Hi all,
>
> If you've been watching the timeline on trac, you have probably seen a 
> large number of cleanup CLs from me.  It's definitely past time to get 
> some discussion going on these changes.  If the community likes these, 
> we can add them to rfc8_devguide 
> <https://trac.osgeo.org/gdal/wiki/rfc8_devguide>.

It is very minimal right now. Good style guides tend to be quite large, 
e.g., https://google.github.io/styleguide/cppguide.html or 
http://geosoft.no/development/cppstyle.html

Is there something GDAL could reuse?

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/339fb6c8/attachment-0001.html>

From mateusz at loskot.net  Mon May  9 02:33:38 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 9 May 2016 11:33:38 +0200
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605071727.19114.even.rouault@spatialys.com>
 <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
Message-ID: <CABUeae-u8uNQB90PVmZtH+HRuMAmRKe+=zJhO7Go6bomANW_zA@mail.gmail.com>

On 7 May 2016 at 19:10, Kurt Schwehr <schwehr at gmail.com> wrote:
>>
>> If we move to a later C++ standard, or even use features of C++98 we
>> currently
>> don't use, I'd advocate for using things that are obviously making the
>> code
>> better / more readable. Honestly who finds that
>> "std::unique_ptr<int *, std::function<void(char *)>> Vals(CPLCalloc(256,
>> 0),
>> CPLFree);" is obviously more readable, efficient and less error prone than
>> "std::vector Vals(256,0)" ?
>>
>
> This is cart before the horse but... as fast as I can so expect typos.  Now
> just think of a ~1K long function or method with tons of instances and lots
> of places to bailout successfully or as failures.  We have > 9K
> free/CPLFree/CPLdelete/CPLDestroys that could be < ~100.
> [...]

...the very long story short, your desire is to introduce the RAII idiom
across GDAL codebase. Awesome!
I'm sure 99% of GDAL committers will welcome this idea.
Then, **next** question is how we want to implement it:
using C++11+ features, home-brewed smart pointer class(es), etc.

Upgrading to C++11+ just for the sake of upgrade, makes little sense to me.
Especially if folks are not certain about it, don't use those features daily,
don't feel comfortable...it may cause more harm.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From mateusz at loskot.net  Mon May  9 05:59:47 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 9 May 2016 13:59:47 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
 <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
Message-ID: <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>

On 8 May 2016 at 07:01, Kurt Schwehr <schwehr at gmail.com> wrote:
>
> Are meaning to say that my proposal is vague?

Yes, I called that on the course of the discussion, it has become less and less
clear to me: what is the actual goal?
- make the stack/heap usage more configurable
- use new C++ features to introduce widely recommended idioms
- make the code shorter, hence clearer/more readable/maintainable
- make the code more C++  than C by allowing wide use of C++ standard features
...
So, in order to achive the above, you are proposing switch to newer C++ version?

> Please read the proposal as just looking at the possibilities.
> Please try not to care about C++ language version when
> trying to do a first round review of ideas.

I have and as far as I can see, there are just two objectives:
1. Make GDAL stack-friendly by preferring heap for arrays.
    How? Use standard containers and smart pointers.
2. Introduce RAII across the whole codebase.
    How? Use smart pointers and other related techniques.

That's all I can see from most of the content there.
(The many fine-grained details are not critical to make the actual
'big' decisions, those will come into play later.)

So, as I have already mentioned, great.
Now, let's decide wheter we switch to C++11 to get the necessary tools or
implement our own tools, e.g. as part of CPL.

I believe, much of the discussion would have gained more focus if the problem
was stated like that.

> On Fri, May 6, 2016 at 2:47 PM, Mateusz Loskot <mateusz at loskot.net> wrote:
>>
>> On 6 May 2016 at 21:55, Kurt Schwehr <schwehr at gmail.com> wrote:
>> > My belief is that for this particular proposal, we should not have the
>> > C++11/14 discussion unless the best overall solution requires a newer
>> > version of C++.  The solution I propose to be the best works in C++03
>> > and newer.
>>
>> Considering current codebase, GDAL is written in C and compiled in C++.
>> The only major C++ feature used in GDAL is classes and polymorphism.
>
>
> I agree that GDAL has a strong feel of C compiled with C++ right now.

Since that is a fact, there is nothing to agree about.
Please, notice, I'm not speaking here about my personal preferences,
just the state of the art.

> I disagree about C++ feature use.  I see algorithm, iostream, map, list,
> sstream, a few exceptions, std::string (mostly in the form of CPLString),
> vector, localization of variables, some templates, #define to static consts,
> etc.

In GDAL? e.g. streams are not used or they use is marginal.


>> If you ask any seasoned C programmer for opinion, I bet she will
>> consider GDAL codebase as clear and readable.
>> If you ask a C++ programmer, the answer might be different.
>>
>> IMO, I doubt any C++11/14 feature will increase the current code,
>> unless it is considered to ditch many of CPL features and replace
>> them with C++ standard features (string bashing operations, string
>> containers,
>> containers for other types, threading API, etc.).
>>
>
> "increase the current code" <- Did you mean increase the reliability?  Or
> size? Or complexity?

Sorry, sloppy typing. I meant code clarity, readability.

>> Certainly, any new line to be written may benefit from auto,
>> constexpr, using, nullptr, range loops - but for a "C with classes"
>> codebase as GDAL, it would be cosmetic improvement, if any.
>>
>
> I disagree that C++11/14 changes would be cosmetic.  But this is the wrong
> thread for this part of the discussion.

IMHO, you are missing one important point.
I'm not arguing that shifting from C with classes mode to C++11-17
is not going to increase software quality. Of course it is, if applied
properly and *at all*.

Have you considered current maintainers might not be willing to start using
the latest and the greatest C++11-17 features?
If they are not...changes will be rather cosmectic.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From mateusz at loskot.net  Mon May  9 06:05:10 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 9 May 2016 14:05:10 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <5730471A.1080806@gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <5730471A.1080806@gmail.com>
Message-ID: <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>

On 9 May 2016 at 09:15, Ari Jolma <ari.jolma at gmail.com> wrote:
> 05.05.2016, 01:30, Kurt Schwehr kirjoitti:
>
> Hi all,
>
> If you've been watching the timeline on trac, you have probably seen a large
> number of cleanup CLs from me.  It's definitely past time to get some
> discussion going on these changes.  If the community likes these, we can add
> them to rfc8_devguide.
>
>
> It is very minimal right now. Good style guides tend to be quite large,
> e.g., https://google.github.io/styleguide/cppguide.html or
> http://geosoft.no/development/cppstyle.html

Good C++ guidelines that fit on a single page is all you need
these days, after Bjarne Stroustrup
https://parasol.tamu.edu/people/bs/622-GP/C++11-style.pdf

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From schwehr at gmail.com  Mon May  9 07:47:26 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 9 May 2016 07:47:26 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
 <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
 <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>
Message-ID: <CACmBxyvy6b-QSHd8P09_H9er3ASkiVk5uMyCPWbspO8==UrKfA@mail.gmail.com>

I was trying to give people an overall sense of my goals for GDAL.

I'm sorry I added the context to the proposal that got the discussion off
the track I intended.  I am more interested in mechanics of the discussion
before hitting huge topics.  I love the discussion, but I feel like I
totally failed at trying to test strategy for the GDAL community to have
discussions and get some basics added to the style guide with some why
attached.  I think we have lots to discuss before tooling and newer
versions of C++.  There are lots of implicit style things in GDAL that I
have been trying to bend my coding to, but I find clashing styles in the
same file all the time, so it is hard to get what I do to match.

Just for this proposal... I do let myself get dragged a bit into the C++
version discussion a bit below to try to show that it is off topic of
>>>getting large objects off the stack<<<.

On Mon, May 9, 2016 at 5:59 AM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 8 May 2016 at 07:01, Kurt Schwehr <schwehr at gmail.com> wrote:
> >
> > Are meaning to say that my proposal is vague?
>
> Yes, I called that on the course of the discussion, it has become less and
> less
> clear to me: what is the actual goal?
>


> - make the stack/heap usage more configurable


No.  Not configurable.  I propose to get large objects off the stack unless
a particular case severely impacts performance.


>

- use new C++ features to introduce widely recommended idioms
>

No.  I do not propose using any C++ features new to GDAL.  This is just the
old vector size with initializer constructor.


> - make the code shorter, hence clearer/more readable/maintainable
>

No.  Shorter wasn't a goal for this one.  It's sorter because my proposed
solution combines the definition and the initialization so as to not have
an uninitialized variable after the definition until the memset.

- make the code more C++  than C by allowing wide use of C++ standard
> features
>

No.


> ...
> So, in order to achive the above, you are proposing switch to newer C++
> version?
>

No.  I was trying to be complete in going through all the options available
inside and out of GDAL.  Only if the community really wanted a feature from
C++ >= 11 would I consider the language version a part of this proposal.


>
> > Please read the proposal as just looking at the possibilities.
> > Please try not to care about C++ language version when
> > trying to do a first round review of ideas.
>
> I have and as far as I can see, there are just two objectives:
> 1. Make GDAL stack-friendly by preferring heap for arrays.
>     How? Use standard containers and smart pointers.
>

That is 3 statements:

a) Make GDAL stack-friendly by preferring heap for arrays.

Yes.

b)  How? Use standard containers

Yes.  I propose this

c) and smart pointers

No.  In this case, a smart pointer looks to be less attractive (to me).


> 2. Introduce RAII across the whole codebase.
>     How? Use smart pointers and other related techniques.
>

No!  Out of scope of this proposal.  (For another proposal, then yes).


>
> That's all I can see from most of the content there.
> (The many fine-grained details are not critical to make the actual
> 'big' decisions, those will come into play later.)
>
> So, as I have already mentioned, great.
> Now, let's decide wheter we switch to C++11 to get the necessary tools or
> implement our own tools, e.g. as part of CPL.
>

No.  Please do not do that with my proposal.  That is way way too far out
of scope of what I intended for *this* proposal.   Can we start with just
this simple proposal?


>
> I believe, much of the discussion would have gained more focus if the
> problem
> was stated like that.
>

Yeah, I missed the boat on focus.


>
> > On Fri, May 6, 2016 at 2:47 PM, Mateusz Loskot <mateusz at loskot.net>
> wrote:
> >>
> >> On 6 May 2016 at 21:55, Kurt Schwehr <schwehr at gmail.com> wrote:
> >> > My belief is that for this particular proposal, we should not have the
> >> > C++11/14 discussion unless the best overall solution requires a newer
> >> > version of C++.  The solution I propose to be the best works in C++03
> >> > and newer.
> >>
> >> Considering current codebase, GDAL is written in C and compiled in C++.
> >> The only major C++ feature used in GDAL is classes and polymorphism.
> >
> >
> > I agree that GDAL has a strong feel of C compiled with C++ right now.
>
> Since that is a fact, there is nothing to agree about.
> Please, notice, I'm not speaking here about my personal preferences,
> just the state of the art.
>
> > I disagree about C++ feature use.  I see algorithm, iostream, map, list,
> > sstream, a few exceptions, std::string (mostly in the form of CPLString),
> > vector, localization of variables, some templates, #define to static
> consts,
> > etc.
>
> In GDAL? e.g. streams are not used or they use is marginal.
>

find . -name \*cpp | xargs grep include | grep stream | wc -l
53

find . -name \*cpp | xargs grep -h include | grep stream | sort -u
#include <fstream>
#include <iostream>
#include "mrsidstream.h"
//#include <sstream>
#include <sstream>
#include <strstream>


>
> >> If you ask any seasoned C programmer for opinion, I bet she will
> >> consider GDAL codebase as clear and readable.
> >> If you ask a C++ programmer, the answer might be different.
> >>
> >> IMO, I doubt any C++11/14 feature will increase the current code,
> >> unless it is considered to ditch many of CPL features and replace
> >> them with C++ standard features (string bashing operations, string
> >> containers,
> >> containers for other types, threading API, etc.).
> >>
> >
> > "increase the current code" <- Did you mean increase the reliability?  Or
> > size? Or complexity?
>
> Sorry, sloppy typing. I meant code clarity, readability.
>
> >> Certainly, any new line to be written may benefit from auto,
> >> constexpr, using, nullptr, range loops - but for a "C with classes"
> >> codebase as GDAL, it would be cosmetic improvement, if any.
> >>
> >
> > I disagree that C++11/14 changes would be cosmetic.  But this is the
> wrong
> > thread for this part of the discussion.
>
> IMHO, you are missing one important point.
> I'm not arguing that shifting from C with classes mode to C++11-17
> is not going to increase software quality. Of course it is, if applied
> properly and *at all*.
>
> Have you considered current maintainers might not be willing to start using
> the latest and the greatest C++11-17 features?
> If they are not...changes will be rather cosmectic.
>

Yes, I understand this.  If you look at this proposal, you will find that I
was not proposing >= C++11.  I am working on a proposal for newer
versions.  I am thinking gradually.  There are non-cosmetic things that are
not very different but just work way better in the new standards.  And if
we go through a proposal process, you can have/should demand clean
examples.  And I think we should have a vote on these features.  If
maintainers are not ready for a feature, then vote against it!  Try to
think of baby steps.  If we say yes to C++11 being required, I think my
first proposal would be to switch NULL to nullptr (which is typed).  My
experience is that it does catch a number of strange edge case issues.
They are rare, but I have hit them.  While GDAL isn't huge, GDAL is big
enough that NULL might be be hiding these issues or it might happen in
future commits.  I don't think changing NULL to nullptr shouldn't be too
scary to C coders.

Even just switching the C++ version to C++11 would improve checking w.r.t.
the std lib, reduce the testing load on travis-ci, let us drop a couple
macros, and slightly simplify the build system.

But, all that is out of scope of my first proposal.


>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/550c5458/attachment-0001.html>

From jluis at ualg.pt  Mon May  9 08:14:39 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Mon, 09 May 2016 16:14:39 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <5730471A.1080806@gmail.com>
 <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>
Message-ID: <op.yg7baplldbaoe8@macmarilu>

Hi,

There is one aspect of the coding style that I honestly do not understand.  
Why continuing to recommend the 80 chars line width? I don't by the  
readability argument, well on the contrary, if because of it the result is  
an excess 'verticalization' of the code it becomes much harder to read.

I don't know for you guys but when I'm forced to permanently scroll up and  
down it becomes really much harder to study a code. For me the ideal is  
that a function holds in a single screen size, but ofc without piling up  
everything to reach that goal.

A little example from gdaldem_lib.cpp (line 240)

****************** Current code *********************************

     for ( i = 0; i < 2 && i < nYSize; i++)
     {
         if( GDALRasterIO(   hSrcBand,
                         GF_Read,
                         0, i,
                         nXSize, 1,
                         pafThreeLineWin + i * nXSize,
                         nXSize, 1,
                         GDT_Float32,
                         0, 0) != CE_None )
         {
             eErr = CE_Failure;
             goto end;
         }
     }
******************************************************************************


************ What I think would be reasonable  
********************************

     for (i = 0; i < 2 && i < nYSize; i++) {
         if (GDALRasterIO(hSrcBand, GF_Read, 0, i, nXSize, 1,  
pafThreeLineWin + i * nXSize, nXSize, 1,
                          GDT_Float32, 0, 0) != CE_None ) {
             eErr = CE_Failure;
             goto end;
         }
     }
******************************************************************************

7 lines instead of 15, and is it less readable (in a text editor, not in a  
mail client)?

Joaquim

> On 9 May 2016 at 09:15, Ari Jolma <ari.jolma at gmail.com> wrote:
>> 05.05.2016, 01:30, Kurt Schwehr kirjoitti:
>>
>> Hi all,
>>
>> If you've been watching the timeline on trac, you have probably seen a  
>> large
>> number of cleanup CLs from me.  It's definitely past time to get some
>> discussion going on these changes.  If the community likes these, we  
>> can add
>> them to rfc8_devguide.
>>
>>
>> It is very minimal right now. Good style guides tend to be quite large,
>> e.g., https://google.github.io/styleguide/cppguide.html or
>> http://geosoft.no/development/cppstyle.html
>
> Good C++ guidelines that fit on a single page is all you need
> these days, after Bjarne Stroustrup
> https://parasol.tamu.edu/people/bs/622-GP/C++11-style.pdf
>
> Best regards,

From ari.jolma at gmail.com  Mon May  9 08:44:48 2016
From: ari.jolma at gmail.com (Ari Jolma)
Date: Mon, 9 May 2016 18:44:48 +0300
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <op.yg7baplldbaoe8@macmarilu>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <5730471A.1080806@gmail.com>
 <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>
 <op.yg7baplldbaoe8@macmarilu>
Message-ID: <5730B070.6000407@gmail.com>

I like one statement per line because it helps walking through the code 
with gdb; you can see the whole statement that is going to be executed.

I also share the idea that seeing a whole subroutine or a logical part 
at once helps understanding the code.

Ari

09.05.2016, 18:14, Joaquim Luis kirjoitti:
> Hi,
>
> There is one aspect of the coding style that I honestly do not 
> understand. Why continuing to recommend the 80 chars line width? I 
> don't by the readability argument, well on the contrary, if because of 
> it the result is an excess 'verticalization' of the code it becomes 
> much harder to read.
>
> I don't know for you guys but when I'm forced to permanently scroll up 
> and down it becomes really much harder to study a code. For me the 
> ideal is that a function holds in a single screen size, but ofc 
> without piling up everything to reach that goal.
>
> A little example from gdaldem_lib.cpp (line 240)
>
> ****************** Current code *********************************
>
>     for ( i = 0; i < 2 && i < nYSize; i++)
>     {
>         if( GDALRasterIO(   hSrcBand,
>                         GF_Read,
>                         0, i,
>                         nXSize, 1,
>                         pafThreeLineWin + i * nXSize,
>                         nXSize, 1,
>                         GDT_Float32,
>                         0, 0) != CE_None )
>         {
>             eErr = CE_Failure;
>             goto end;
>         }
>     }
> ****************************************************************************** 
>
>
>
> ************ What I think would be reasonable 
> ********************************
>
>     for (i = 0; i < 2 && i < nYSize; i++) {
>         if (GDALRasterIO(hSrcBand, GF_Read, 0, i, nXSize, 1, 
> pafThreeLineWin + i * nXSize, nXSize, 1,
>                          GDT_Float32, 0, 0) != CE_None ) {
>             eErr = CE_Failure;
>             goto end;
>         }
>     }
> ****************************************************************************** 
>
>
> 7 lines instead of 15, and is it less readable (in a text editor, not 
> in a mail client)?
>
> Joaquim
>
>> On 9 May 2016 at 09:15, Ari Jolma <ari.jolma at gmail.com> wrote:
>>> 05.05.2016, 01:30, Kurt Schwehr kirjoitti:
>>>
>>> Hi all,
>>>
>>> If you've been watching the timeline on trac, you have probably seen 
>>> a large
>>> number of cleanup CLs from me.  It's definitely past time to get some
>>> discussion going on these changes.  If the community likes these, we 
>>> can add
>>> them to rfc8_devguide.
>>>
>>>
>>> It is very minimal right now. Good style guides tend to be quite large,
>>> e.g., https://google.github.io/styleguide/cppguide.html or
>>> http://geosoft.no/development/cppstyle.html
>>
>> Good C++ guidelines that fit on a single page is all you need
>> these days, after Bjarne Stroustrup
>> https://parasol.tamu.edu/people/bs/622-GP/C++11-style.pdf
>>
>> Best regards,
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev


From mateusz at loskot.net  Mon May  9 09:02:06 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 9 May 2016 18:02:06 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <op.yg7baplldbaoe8@macmarilu>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <5730471A.1080806@gmail.com>
 <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>
 <op.yg7baplldbaoe8@macmarilu>
Message-ID: <CABUeae-6v4NHGpFNrNuGK2+tn2z2=wW=eE-=HffN9YZJtfu2JQ@mail.gmail.com>

On 9 May 2016 at 17:14, Joaquim Luis <jluis at ualg.pt> wrote:
> Hi,
>
> There is one aspect of the coding style that I honestly do not understand.
> Why continuing to recommend the 80 chars line width?

Perhaps, paraphrasing Kevlin Henney, because
not everyone falls in love with high-resolution screens
and not everyone can actually now project the whole of the Serengeti :)

[1] https://vimeo.com/97329157

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From andre+joost at nurfuerspam.de  Mon May  9 08:31:53 2016
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Mon, 09 May 2016 17:31:53 +0200
Subject: [gdal-dev] prebuilt GDAL 2.0.2 windows binary
In-Reply-To: <CALMrLdA3ock_QLAJpHRfpHyUAOEFbxrgKMt6n7f2Vcb53dTBXg@mail.gmail.com>
References: <CALMrLdA3ock_QLAJpHRfpHyUAOEFbxrgKMt6n7f2Vcb53dTBXg@mail.gmail.com>
Message-ID: <ngqaho$q78$1@ger.gmane.org>

Am 06.05.2016 um 08:54 schrieb Gane R:
> I see a link to download the source
>
> http://download.osgeo.org/gdal/2.0.2/gdal202.zip
>
> when can I find a prebuilt version of GDAL 2.0.2
>

OSGEO4W offers GDAL 2.0.2, see 
http://download.osgeo.org/osgeo4w/x86_64/versions.html

Gisinternals has GDAL 1.11.3 and 1.11.4 as stable relases, and GDAL 
2.1.0 and GDAL 2.2.0 as development versions. See 
http://www.gisinternals.com/development.php, and follow the information 
link. The MSVC 2008 and 2010 builds have GDAL 2,1,9, and MSVC 2012 and 
2013 has GDAL 2.2.0

HTH,
André Joost



From mateusz at loskot.net  Mon May  9 09:21:02 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 9 May 2016 18:21:02 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyvy6b-QSHd8P09_H9er3ASkiVk5uMyCPWbspO8==UrKfA@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
 <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
 <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>
 <CACmBxyvy6b-QSHd8P09_H9er3ASkiVk5uMyCPWbspO8==UrKfA@mail.gmail.com>
Message-ID: <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>

On 9 May 2016 at 16:47, Kurt Schwehr <schwehr at gmail.com> wrote:
> There are lots of implicit style things in GDAL that I have been
> trying to bend my coding to, but I find clashing styles in the same file all
> the time, so it is hard to get what I do to match.

Just choose the one of the two you like more.

> On Mon, May 9, 2016 at 5:59 AM, Mateusz Loskot <mateusz at loskot.net> wrote:
>> On 8 May 2016 at 07:01, Kurt Schwehr <schwehr at gmail.com> wrote:
>>
>> - make the stack/heap usage more configurable
>
>
> No.  Not configurable.  I propose to get large objects off the stack unless
> a particular case severely impacts performance.

Yes, I got it,
I meant coding/compile-time configurable, if necessary, with
standard container/custom allocator/traits, etc.
There could even be a #define to control that all current T buffer[12345]
become heap-based or stay stack-based buffers.
However, actual realisation does not matter at this point.

>> - use new C++ features to introduce widely recommended idioms
>
> No.  I do not propose using any C++ features new to GDAL.  This is just the
> old vector size with initializer constructor.

As one of your argument, I have seen RAII proposed.

>> > Please read the proposal as just looking at the possibilities.
>> > Please try not to care about C++ language version when
>> > trying to do a first round review of ideas.
>>
>> I have and as far as I can see, there are just two objectives:
>> 1. Make GDAL stack-friendly by preferring heap for arrays.
>>     How? Use standard containers and smart pointers.
>
>
> That is 3 statements:
>
> a) Make GDAL stack-friendly by preferring heap for arrays.
>
> Yes.

OK,

> b)  How? Use standard containers
>
> Yes.  I propose this

OK

> c) and smart pointers
>
> No.  In this case, a smart pointer looks to be less attractive (to me).
>
>> 2. Introduce RAII across the whole codebase.
>>     How? Use smart pointers and other related techniques.
>
>
> No!  Out of scope of this proposal.  (For another proposal, then yes).

Again, I have seen arguments like this
https://lists.osgeo.org/pipermail/gdal-dev/2016-May/044355.html

But, OK, I assume it is no longer part of your proposal.

>> That's all I can see from most of the content there.
>> (The many fine-grained details are not critical to make the actual
>> 'big' decisions, those will come into play later.)
>>
>> So, as I have already mentioned, great.
>> Now, let's decide wheter we switch to C++11 to get the necessary tools or
>> implement our own tools, e.g. as part of CPL.
>
> No.  Please do not do that with my proposal.  That is way way too far out of
> scope of what I intended for *this* proposal.

I'm not doing anything with it.
I'm just asking questions and stating my understanding of your goal,
some I might have got wrong.

>  Can we start with just this simple proposal?

Sure. I have got my issues cleared, thanks.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From mapoubelle22 at gmail.com  Mon May  9 09:26:14 2016
From: mapoubelle22 at gmail.com (fred p)
Date: Mon, 9 May 2016 16:26:14 +0000
Subject: [gdal-dev] gdal-dev Digest, Vol 144, Issue 30
In-Reply-To: <mailman.11.1462734002.4790.gdal-dev@lists.osgeo.org>
References: <mailman.11.1462734002.4790.gdal-dev@lists.osgeo.org>
Message-ID: <CADzX+2UmyFKm_cvggBDvg_F6=m_YA1hLHC=rSrr2KUuuAAWBPA@mail.gmail.com>

Thanks for confirming what I guessed.

What follows is not directly related to GDAL but someone might have a
solution. So... Using geotifcp I cannot assemble a JPEG-compressed TIFF and
a LZW-compressed TIF keeping these compression modes for both IFD. Tiffcp
can do it (but without georeferencing of course !) whereas geotifcp ouputs
"JPEGLib: Bogus input colorspace". Any idea ?


------------------------------

>
> Message: 2
> Date: Sun, 8 May 2016 00:19:51 +0200
> From: Even Rouault <even.rouault at spatialys.com>
> To: gdal-dev at lists.osgeo.org
> Subject: Re: [gdal-dev] how to write multi-IFD TIFF files ?
> Message-ID: <201605080019.51485.even.rouault at spatialys.com>
> Content-Type: Text/Plain;  charset="utf-8"
>
> Le samedi 07 mai 2016 23:57:18, fred p a écrit :
> > Hello,
> > I am looking for a way to write multi-IFD TIFF files with GDAL (each IFD
> > being JPEG or LZW compressed), for example with gdal_translate or (better
> > if possible) the Python API but without any success.
> > Is it possible anyway ?
>
> Hi,
>
> No this is not currently possible in the general case (internal overviews
> are
> implemented as IFD, but flagged as such and not as general purpose IFD).
> Would
> probably not a huge effort to implement, but in the mean time you may use
> GDAL
> to create individual IDF and then use tifcp/geotifcp to assemble them.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/7b14e6a3/attachment-0001.html>

From mapoubelle22 at gmail.com  Mon May  9 09:28:40 2016
From: mapoubelle22 at gmail.com (fred p)
Date: Mon, 9 May 2016 16:28:40 +0000
Subject: [gdal-dev] how to write multi-IFD TIFF files ?
Message-ID: <CADzX+2Xf5=4OEt6P52YefNPHAF07RJ1B0WJOnEx_Dd8N5VgRwA@mail.gmail.com>

Sorry for the previous message with a bad subject...

---------- Forwarded message ----------
From: fred p <mapoubelle22 at gmail.com>
Date: 2016-05-09 16:26 GMT+00:00
Subject: Re: gdal-dev Digest, Vol 144, Issue 30
To: gdal-dev at lists.osgeo.org


Thanks for confirming what I guessed.

What follows is not directly related to GDAL but someone might have a
solution. So... Using geotifcp I cannot assemble a JPEG-compressed TIFF and
a LZW-compressed TIF keeping these compression modes for both IFD. Tiffcp
can do it (but without georeferencing of course !) whereas geotifcp ouputs
"JPEGLib: Bogus input colorspace". Any idea ?


------------------------------

>
> Message: 2
> Date: Sun, 8 May 2016 00:19:51 +0200
> From: Even Rouault <even.rouault at spatialys.com>
> To: gdal-dev at lists.osgeo.org
> Subject: Re: [gdal-dev] how to write multi-IFD TIFF files ?
> Message-ID: <201605080019.51485.even.rouault at spatialys.com>
> Content-Type: Text/Plain;  charset="utf-8"
>
> Le samedi 07 mai 2016 23:57:18, fred p a écrit :
> > Hello,
> > I am looking for a way to write multi-IFD TIFF files with GDAL (each IFD
> > being JPEG or LZW compressed), for example with gdal_translate or (better
> > if possible) the Python API but without any success.
> > Is it possible anyway ?
>
> Hi,
>
> No this is not currently possible in the general case (internal overviews
> are
> implemented as IFD, but flagged as such and not as general purpose IFD).
> Would
> probably not a huge effort to implement, but in the mean time you may use
> GDAL
> to create individual IDF and then use tifcp/geotifcp to assemble them.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/c049dbd4/attachment.html>

From jmckenna at gatewaygeomatics.com  Mon May  9 09:33:25 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Mon, 9 May 2016 13:33:25 -0300
Subject: [gdal-dev] prebuilt GDAL 2.0.2 windows binary
In-Reply-To: <ngqaho$q78$1@ger.gmane.org>
References: <CALMrLdA3ock_QLAJpHRfpHyUAOEFbxrgKMt6n7f2Vcb53dTBXg@mail.gmail.com>
 <ngqaho$q78$1@ger.gmane.org>
Message-ID: <895aa22d-80dd-8277-16ab-b6be797fd67d@gatewaygeomatics.com>

On 2016-05-09 12:31 PM, Andre Joost wrote:
> Am 06.05.2016 um 08:54 schrieb Gane R:
>> I see a link to download the source
>>
>> http://download.osgeo.org/gdal/2.0.2/gdal202.zip
>>
>> when can I find a prebuilt version of GDAL 2.0.2
>>
>
> OSGEO4W offers GDAL 2.0.2, see
> http://download.osgeo.org/osgeo4w/x86_64/versions.html
>
> Gisinternals has GDAL 1.11.3 and 1.11.4 as stable relases, and GDAL
> 2.1.0 and GDAL 2.2.0 as development versions. See
> http://www.gisinternals.com/development.php, and follow the information
> link. The MSVC 2008 and 2010 builds have GDAL 2,1,9, and MSVC 2012 and
> 2013 has GDAL 2.2.0
>

MS4W binaries include GDAL 2.1.0 and also 2.0.2 if you need.  See 
http://ms4w.com (for past releases see http://www.ms4w.com/release/).

-jeff



-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From jluis at ualg.pt  Mon May  9 09:42:13 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Mon, 09 May 2016 17:42:13 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae-6v4NHGpFNrNuGK2+tn2z2=wW=eE-=HffN9YZJtfu2JQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <5730471A.1080806@gmail.com>
 <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>
 <op.yg7baplldbaoe8@macmarilu>
 <CABUeae-6v4NHGpFNrNuGK2+tn2z2=wW=eE-=HffN9YZJtfu2JQ@mail.gmail.com>
Message-ID: <op.yg7fcnx8dbaoe8@macmarilu>

I do all my programing in laptops, and yes I have a 15 inches HiRes screen  
but I also have my eyes, well, weakened (and 54 years old) so I make the  
fonts larger. Having to permanently scroll up and down is far worst than  
any perception purity.


>> There is one aspect of the coding style that I honestly do not  
>> understand.
>> Why continuing to recommend the 80 chars line width?
>
> Perhaps, paraphrasing Kevlin Henney, because
> not everyone falls in love with high-resolution screens
> and not everyone can actually now project the whole of the Serengeti :)
>
> [1] https://vimeo.com/97329157
>
> Best regards,

From jluis at ualg.pt  Mon May  9 09:43:08 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Mon, 09 May 2016 17:43:08 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <5730B070.6000407@gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <5730471A.1080806@gmail.com>
 <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>
 <op.yg7baplldbaoe8@macmarilu> <5730B070.6000407@gmail.com>
Message-ID: <op.yg7fd6b1dbaoe8@macmarilu>



> I like one statement per line because it helps walking through the code  
> with gdb; you can see the whole statement that is going to be executed.

Fully agree, and my example respects that.

> I also share the idea that seeing a whole subroutine or a logical part  
> at once helps understanding the code.
>
> Ari
>
> 09.05.2016, 18:14, Joaquim Luis kirjoitti:
>> Hi,
>>
>> There is one aspect of the coding style that I honestly do not  
>> understand. Why continuing to recommend the 80 chars line width? I  
>> don't by the readability argument, well on the contrary, if because of  
>> it the result is an excess 'verticalization' of the code it becomes  
>> much harder to read.
>>
>> I don't know for you guys but when I'm forced to permanently scroll up  
>> and down it becomes really much harder to study a code. For me the  
>> ideal is that a function holds in a single screen size, but ofc without  
>> piling up everything to reach that goal.
>>
>> A little example from gdaldem_lib.cpp (line 240)
>>
>> ****************** Current code *********************************
>>
>>     for ( i = 0; i < 2 && i < nYSize; i++)
>>     {
>>         if( GDALRasterIO(   hSrcBand,
>>                         GF_Read,
>>                         0, i,
>>                         nXSize, 1,
>>                         pafThreeLineWin + i * nXSize,
>>                         nXSize, 1,
>>                         GDT_Float32,
>>                         0, 0) != CE_None )
>>         {
>>             eErr = CE_Failure;
>>             goto end;
>>         }
>>     }
>> ******************************************************************************  
>>
>> ************ What I think would be reasonable  
>> ********************************
>>
>>     for (i = 0; i < 2 && i < nYSize; i++) {
>>         if (GDALRasterIO(hSrcBand, GF_Read, 0, i, nXSize, 1,  
>> pafThreeLineWin + i * nXSize, nXSize, 1,
>>                          GDT_Float32, 0, 0) != CE_None ) {
>>             eErr = CE_Failure;
>>             goto end;
>>         }
>>     }
>> ******************************************************************************  
>> 7 lines instead of 15, and is it less readable (in a text editor, not  
>> in a mail client)?
>>
>> Joaquim
>>
>>> On 9 May 2016 at 09:15, Ari Jolma <ari.jolma at gmail.com> wrote:
>>>> 05.05.2016, 01:30, Kurt Schwehr kirjoitti:
>>>>
>>>> Hi all,
>>>>
>>>> If you've been watching the timeline on trac, you have probably seen  
>>>> a large
>>>> number of cleanup CLs from me.  It's definitely past time to get some
>>>> discussion going on these changes.  If the community likes these, we  
>>>> can add
>>>> them to rfc8_devguide.
>>>>
>>>>
>>>> It is very minimal right now. Good style guides tend to be quite  
>>>> large,
>>>> e.g., https://google.github.io/styleguide/cppguide.html or
>>>> http://geosoft.no/development/cppstyle.html
>>>
>>> Good C++ guidelines that fit on a single page is all you need
>>> these days, after Bjarne Stroustrup
>>> https://parasol.tamu.edu/people/bs/622-GP/C++11-style.pdf
>>>
>>> Best regards,
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

From schwehr at gmail.com  Mon May  9 10:02:21 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 9 May 2016 10:02:21 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
 <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
 <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>
 <CACmBxyvy6b-QSHd8P09_H9er3ASkiVk5uMyCPWbspO8==UrKfA@mail.gmail.com>
 <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>
Message-ID: <CACmBxyuj4ZrVZXP7H5rm9ZAoSyS_mdKUZd6Toe8Bgon9dpprYw@mail.gmail.com>

All,

Just to be totally obvious and not meant to squash questions, comments,
concerns.  I'm trying to narrow the scope of this discussion.  <y choice of
title for this thread on the mailing list is not good.  Anyone object to me
starting a different subject line to continue the conversation on this
large object on the stack proposal?

Mateusz,

Sounds like we are on the right track now.  Hopefully, the proposal is
clearer after a few more changes just now.

My concern is that you seem to taking the discuss as the proposal and not
ready the proposal as stand alone: http://goo.gl/vuA3D6   (Especially after
I fixed the "Status:"... which I just changed again).  My intent was to
have a super narrow focus to the proposal, but be complete thereby letting
the reader know that I'm aware of alternatives.  I thought that this change
would make the scope crystal clear (obvious I was wrong :)...

https://trac.osgeo.org/gdal/changeset/34177

unique_ptr was in there as an alternative.  The item you refer to was the
>>>side track<<< of C++11 in the mailing list.  It belongs as a separate
proposal dependent on a C++11 proposal.    And on the side track of C++11
support: I think your concerns are very valid.  Let's keep those to the C++
language version thread.

Anything in this thread is a great discussion, but is NOT the proposal.
That document never said that it is a justification in any way for C++11.

I added a note at the top to clarify.  The what if section is just food for
thought / completeness.  I regret having it there in the beginning, but I
might as well leave it now that the confusion already happened.

I'm happy to clarify the text in the proposal or give you comment/suggest
access to the doc.


> > No!  Out of scope of this proposal.  (For another proposal, then yes).
>
> Again, I have seen arguments like this
> https://lists.osgeo.org/pipermail/gdal-dev/2016-May/044355.html
>
> But, OK, I assume it is no longer part of your proposal.
>

Never was part of the proposed solution for "Use vector<T>(length,
initial_value) for local blocks of storage."


>
> >> That's all I can see from most of the content there.
> >> (The many fine-grained details are not critical to make the actual
> >> 'big' decisions, those will come into play later.)
> >>
> >> So, as I have already mentioned, great.
> >> Now, let's decide wheter we switch to C++11 to get the necessary tools
> or
> >> implement our own tools, e.g. as part of CPL.
> >
> > No.  Please do not do that with my proposal.  That is way way too far
> out of
> > scope of what I intended for *this* proposal.
>
> I'm not doing anything with it.
> I'm just asking questions and stating my understanding of your goal,
> some I might have got wrong.
>
>
Please just take the text in the doc as the proposal.  Unless I copy text
from the mailing list to the doc, I don't consider it a part of the
proposal.


> >  Can we start with just this simple proposal?
>
> Sure. I have got my issues cleared, thanks.
>

Great!  Thanks for helping me improve the doc.


>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/d79bbf8b/attachment-0001.html>

From schwehr at gmail.com  Mon May  9 10:09:33 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 9 May 2016 10:09:33 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <op.yg7fd6b1dbaoe8@macmarilu>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <5730471A.1080806@gmail.com>
 <CABUeae9q7Wcd8aq1ZWvtYQ_N5-gZpD0jnj47XqssP5L3k=3dJA@mail.gmail.com>
 <op.yg7baplldbaoe8@macmarilu> <5730B070.6000407@gmail.com>
 <op.yg7fd6b1dbaoe8@macmarilu>
Message-ID: <CACmBxyvBU=-bwNkgZWTS4KNQY40UJgXm0EQW4Nke1YV7B0znTw@mail.gmail.com>

Please fork the 80 col style guide to a new thread.  Yes, there are lots of
issues with the coding style, but can we do one thing at a time?  If you
are really motivated, why not write a proposal like mine and talk through
the issues of different column constraints (there are good reasons for the
many different ways and related issues).  Then start a new thread with it.

On Mon, May 9, 2016 at 9:43 AM, Joaquim Luis <jluis at ualg.pt> wrote:

>
>
> I like one statement per line because it helps walking through the code
>> with gdb; you can see the whole statement that is going to be executed.
>>
>
> Fully agree, and my example respects that.
>
>
> I also share the idea that seeing a whole subroutine or a logical part at
>> once helps understanding the code.
>>
>> Ari
>>
>> 09.05.2016, 18:14, Joaquim Luis kirjoitti:
>>
>>> Hi,
>>>
>>> There is one aspect of the coding style that I honestly do not
>>> understand. Why continuing to recommend the 80 chars line width? I don't by
>>> the readability argument, well on the contrary, if because of it the result
>>> is an excess 'verticalization' of the code it becomes much harder to read.
>>>
>>> I don't know for you guys but when I'm forced to permanently scroll up
>>> and down it becomes really much harder to study a code. For me the ideal is
>>> that a function holds in a single screen size, but ofc without piling up
>>> everything to reach that goal.
>>>
>>> A little example from gdaldem_lib.cpp (line 240)
>>>
>>> ****************** Current code *********************************
>>>
>>>     for ( i = 0; i < 2 && i < nYSize; i++)
>>>     {
>>>         if( GDALRasterIO(   hSrcBand,
>>>                         GF_Read,
>>>                         0, i,
>>>                         nXSize, 1,
>>>                         pafThreeLineWin + i * nXSize,
>>>                         nXSize, 1,
>>>                         GDT_Float32,
>>>                         0, 0) != CE_None )
>>>         {
>>>             eErr = CE_Failure;
>>>             goto end;
>>>         }
>>>     }
>>> ******************************************************************************
>>>
>>> ************ What I think would be reasonable
>>> ********************************
>>>
>>>     for (i = 0; i < 2 && i < nYSize; i++) {
>>>         if (GDALRasterIO(hSrcBand, GF_Read, 0, i, nXSize, 1,
>>> pafThreeLineWin + i * nXSize, nXSize, 1,
>>>                          GDT_Float32, 0, 0) != CE_None ) {
>>>             eErr = CE_Failure;
>>>             goto end;
>>>         }
>>>     }
>>> ******************************************************************************
>>> 7 lines instead of 15, and is it less readable (in a text editor, not in a
>>> mail client)?
>>>
>>> Joaquim
>>>
>>> On 9 May 2016 at 09:15, Ari Jolma <ari.jolma at gmail.com> wrote:
>>>>
>>>>> 05.05.2016, 01:30, Kurt Schwehr kirjoitti:
>>>>>
>>>>> Hi all,
>>>>>
>>>>> If you've been watching the timeline on trac, you have probably seen a
>>>>> large
>>>>> number of cleanup CLs from me.  It's definitely past time to get some
>>>>> discussion going on these changes.  If the community likes these, we
>>>>> can add
>>>>> them to rfc8_devguide.
>>>>>
>>>>>
>>>>> It is very minimal right now. Good style guides tend to be quite large,
>>>>> e.g., https://google.github.io/styleguide/cppguide.html or
>>>>> http://geosoft.no/development/cppstyle.html
>>>>>
>>>>
>>>> Good C++ guidelines that fit on a single page is all you need
>>>> these days, after Bjarne Stroustrup
>>>> https://parasol.tamu.edu/people/bs/622-GP/C++11-style.pdf
>>>>
>>>> Best regards,
>>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/f80a785f/attachment.html>

From schwehr at gmail.com  Mon May  9 10:11:02 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 9 May 2016 10:11:02 -0700
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
 <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
 <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>
 <CACmBxyvy6b-QSHd8P09_H9er3ASkiVk5uMyCPWbspO8==UrKfA@mail.gmail.com>
 <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>
Message-ID: <CACmBxysrZwaY0Qm9fN7prY6P=eAhrx-vQaG8p7TYXr0GMWhgEw@mail.gmail.com>

I intend to argue strongly against the many styles at a later date and in a
separate thread.

On Mon, May 9, 2016 at 9:21 AM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 9 May 2016 at 16:47, Kurt Schwehr <schwehr at gmail.com> wrote:
> > There are lots of implicit style things in GDAL that I have been
> > trying to bend my coding to, but I find clashing styles in the same file
> all
> > the time, so it is hard to get what I do to match.
>
> Just choose the one of the two you like more.
>
> > On Mon, May 9, 2016 at 5:59 AM, Mateusz Loskot <mateusz at loskot.net>
> wrote:
> >> On 8 May 2016 at 07:01, Kurt Schwehr <schwehr at gmail.com> wrote:
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/7593bcae/attachment.html>

From schwehr at gmail.com  Mon May  9 10:28:48 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 9 May 2016 10:28:48 -0700
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <CABUeae-u8uNQB90PVmZtH+HRuMAmRKe+=zJhO7Go6bomANW_zA@mail.gmail.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605071727.19114.even.rouault@spatialys.com>
 <CACmBxyui3pmUV=ADxsr5gqNw+6b5MaMVJsuqKkFSAwAtu2uzNA@mail.gmail.com>
 <CABUeae-u8uNQB90PVmZtH+HRuMAmRKe+=zJhO7Go6bomANW_zA@mail.gmail.com>
Message-ID: <CACmBxysx9U-84DTu1T37a-2gj5fxq_6kLpjpkcby+LZxQZTp6Q@mail.gmail.com>

Here is my current take on language standards

- I am working on a C++11/14 C99/11 proposal.  I despirately want to be
able to use C++11 to make GDAL more robust
- As it stands I will vote >>>against<<< my proposal any time soon - until
with have a bunch of proposals for changes to GDAL that require new
language versions or someone rewrites my proposal to be much more compelling
- We have lots of work that we can do to make GDAL maintenance / debugging
easier that does not require newer language versions
- We have successfully ( at least in my opinion ) stuck a toe in the C++11
world with CPL_FINAL, CPL_DISALLOW_COPY_ASSIGN, NULL_AS_NULLPTR, and
my std::lock_guard<std::mutex> experiments.  We can probably do a bit more
if we are careful.
- I think having an experimental autotest2 C++11/14 only testing tree might
be the way to start.  Those who want to can try it out or look through what
is possible and it won't impact the main tree or the existing C++ tests.


I would be happy to start contributing to
https://trac.osgeo.org/gdal/browser/trunk/autotest2, especially if we call
it experimental and I can get help with adding a build system.  I have
>5000 lines of C++ in 32 test files that mostly cover the port directory
right now.  I got hung up on trying to create a working initial version in
a separate github tree.  Adding it to the existing svn tree would get me
around that issue (it's an internal work thing).  Here is
cpl_string_test.cc... it's super boring.

   https://gist.github.com/schwehr/02128959ee78d56b553defa0a527bdf2

It's written using the Google C++ style guide and is based on gunit, gmock
and glog.

- https://google.github.io/styleguide/cppguide.html
- https://github.com/google/googletest
- https://github.com/google/glog



On Mon, May 9, 2016 at 2:33 AM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 7 May 2016 at 19:10, Kurt Schwehr <schwehr at gmail.com> wrote:
> >>
> >> If we move to a later C++ standard, or even use features of C++98 we
> >> currently
> >> don't use, I'd advocate for using things that are obviously making the
> >> code
> >> better / more readable. Honestly who finds that
> >> "std::unique_ptr<int *, std::function<void(char *)>> Vals(CPLCalloc(256,
> >> 0),
> >> CPLFree);" is obviously more readable, efficient and less error prone
> than
> >> "std::vector Vals(256,0)" ?
> >>
> >
> > This is cart before the horse but... as fast as I can so expect typos.
> Now
> > just think of a ~1K long function or method with tons of instances and
> lots
> > of places to bailout successfully or as failures.  We have > 9K
> > free/CPLFree/CPLdelete/CPLDestroys that could be < ~100.
> > [...]
>
> ...the very long story short, your desire is to introduce the RAII idiom
> across GDAL codebase. Awesome!
> I'm sure 99% of GDAL committers will welcome this idea.
> Then, **next** question is how we want to implement it:
> using C++11+ features, home-brewed smart pointer class(es), etc.
>
> Upgrading to C++11+ just for the sake of upgrade, makes little sense to me.
> Especially if folks are not certain about it, don't use those features
> daily,
> don't feel comfortable...it may cause more harm.
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/d2d5eee1/attachment-0001.html>

From even.rouault at spatialys.com  Mon May  9 10:29:42 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 9 May 2016 19:29:42 +0200
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyuj4ZrVZXP7H5rm9ZAoSyS_mdKUZd6Toe8Bgon9dpprYw@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>
 <CACmBxyuj4ZrVZXP7H5rm9ZAoSyS_mdKUZd6Toe8Bgon9dpprYw@mail.gmail.com>
Message-ID: <201605091929.43143.even.rouault@spatialys.com>


>http://goo.gl/vuA3D6   (Especially after
> I fixed the "Status:"... which I just changed again). 

Looks good to me.

Perhaps 256 bytes as the threshold ? (a LUT of 256 byte elements would fit) By 
the way, is it a threshold per array or for all arrays of a given function ?

I can think of some *potentially* performance sensitive locations like 
RPCTransformPoint() that uses a double [20+1] array where, if it would be 
above the threshold, moving the array to a working structure 
(GDALRPCTransformInfo* in that instance), or to the upper layers if they call 
multiple times the subroutine, could both address the stack size and 
performance. But at that point it is hard to be able to predict that, so let's 
do no premature optimization.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon May  9 11:17:09 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 9 May 2016 20:17:09 +0200
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <CACmBxysx9U-84DTu1T37a-2gj5fxq_6kLpjpkcby+LZxQZTp6Q@mail.gmail.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <CABUeae-u8uNQB90PVmZtH+HRuMAmRKe+=zJhO7Go6bomANW_zA@mail.gmail.com>
 <CACmBxysx9U-84DTu1T37a-2gj5fxq_6kLpjpkcby+LZxQZTp6Q@mail.gmail.com>
Message-ID: <201605092017.10401.even.rouault@spatialys.com>

Le lundi 09 mai 2016 19:28:48, vous avez écrit :
> Here is my current take on language standards
> 
> - I am working on a C++11/14 C99/11 proposal.  I despirately want to be
> able to use C++11 to make GDAL more robust

C++11 is probably OK, but C++14 support is really "new". For Linux distros, we 
should try to make GDAL compilable on the current LTS and probably in the case 
of Ubuntu last-1 LTS with their default compiler.

For example RHEL 7 ships with gcc 4.8.X, Ubuntu 14.04 too.
I've checked that gcc 4.8 refuses -std=c++14. It accepts -std=c++1y though, so 
some features of C++14 might be available.

At least for the sake of our CI environements : Travis has no immediate plans 
for now to ship with with Ubuntu 16.04 ( https://github.com/travis-ci/travis-
ci/issues/5821 )

> - As it stands I will vote >>>against<<< my proposal any time soon - until
> with have a bunch of proposals for changes to GDAL that require new
> language versions or someone rewrites my proposal to be much more
> compelling -
Which proposal exactly ? AFAICS in this thread, it was more about polling 
opinions.

> We have lots of work that we can do to make GDAL maintenance
> / debugging easier that does not require newer language versions
> - We have successfully ( at least in my opinion ) stuck a toe in the C++11
> world with CPL_FINAL, CPL_DISALLOW_COPY_ASSIGN, NULL_AS_NULLPTR, and
> my std::lock_guard<std::mutex> experiments.  We can probably do a bit more
> if we are careful.
> - I think having an experimental autotest2 C++11/14 only testing tree might
> be the way to start.  Those who want to can try it out or look through what
> is possible and it won't impact the main tree or the existing C++ tests.
> 
> 
> I would be happy to start contributing to
> https://trac.osgeo.org/gdal/browser/trunk/autotest2, especially if we call
> it experimental and I can get help with adding a build system.  I have
> 
> >5000 lines of C++ in 32 test files that mostly cover the port directory
> 
> right now.  I got hung up on trying to create a working initial version in
> a separate github tree.  Adding it to the existing svn tree would get me
> around that issue (it's an internal work thing).  Here is
> cpl_string_test.cc... it's super boring.
> 
>    https://gist.github.com/schwehr/02128959ee78d56b553defa0a527bdf2
> 
> It's written using the Google C++ style guide and is based on gunit, gmock
> and glog.
> 
> - https://google.github.io/styleguide/cppguide.html
> - https://github.com/google/googletest
> - https://github.com/google/glog

Are those available as ready to be installable packages ? (thinking about 
integration with CI)

> 
> On Mon, May 9, 2016 at 2:33 AM, Mateusz Loskot <mateusz at loskot.net> wrote:
> > On 7 May 2016 at 19:10, Kurt Schwehr <schwehr at gmail.com> wrote:
> > >> If we move to a later C++ standard, or even use features of C++98 we
> > >> currently
> > >> don't use, I'd advocate for using things that are obviously making the
> > >> code
> > >> better / more readable. Honestly who finds that
> > >> "std::unique_ptr<int *, std::function<void(char *)>>
> > >> Vals(CPLCalloc(256, 0),
> > >> CPLFree);" is obviously more readable, efficient and less error prone
> > 
> > than
> > 
> > >> "std::vector Vals(256,0)" ?
> > > 
> > > This is cart before the horse but... as fast as I can so expect typos.
> > 
> > Now
> > 
> > > just think of a ~1K long function or method with tons of instances and
> > 
> > lots
> > 
> > > of places to bailout successfully or as failures.  We have > 9K
> > > free/CPLFree/CPLdelete/CPLDestroys that could be < ~100.
> > > [...]
> > 
> > ...the very long story short, your desire is to introduce the RAII idiom
> > across GDAL codebase. Awesome!
> > I'm sure 99% of GDAL committers will welcome this idea.
> > Then, **next** question is how we want to implement it:
> > using C++11+ features, home-brewed smart pointer class(es), etc.
> > 
> > Upgrading to C++11+ just for the sake of upgrade, makes little sense to
> > me. Especially if folks are not certain about it, don't use those
> > features daily,
> > don't feel comfortable...it may cause more harm.
> > 
> > Best regards,
> > --
> > Mateusz Loskot, http://mateusz.loskot.net

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From schwehr at gmail.com  Mon May  9 11:38:42 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 9 May 2016 11:38:42 -0700
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <201605092017.10401.even.rouault@spatialys.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <CABUeae-u8uNQB90PVmZtH+HRuMAmRKe+=zJhO7Go6bomANW_zA@mail.gmail.com>
 <CACmBxysx9U-84DTu1T37a-2gj5fxq_6kLpjpkcby+LZxQZTp6Q@mail.gmail.com>
 <201605092017.10401.even.rouault@spatialys.com>
Message-ID: <CACmBxytqgzqDNqRLNirxb6fhvYBOTgCE3VkoWe8NgktT5rc7rQ@mail.gmail.com>

Agreed on the 11 v 14 issues.

On Mon, May 9, 2016 at 11:17 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le lundi 09 mai 2016 19:28:48, vous avez écrit :
> > Here is my current take on language standards
> >
> > - I am working on a C++11/14 C99/11 proposal.  I despirately want to be
> > able to use C++11 to make GDAL more robust
>
> C++11 is probably OK, but C++14 support is really "new". For Linux
> distros, we
> should try to make GDAL compilable on the current LTS and probably in the
> case
> of Ubuntu last-1 LTS with their default compiler.
>
> For example RHEL 7 ships with gcc 4.8.X, Ubuntu 14.04 too.
> I've checked that gcc 4.8 refuses -std=c++14. It accepts -std=c++1y
> though, so
> some features of C++14 might be available.
>
> At least for the sake of our CI environements : Travis has no immediate
> plans
> for now to ship with with Ubuntu 16.04 (
> https://github.com/travis-ci/travis-
> ci/issues/5821 )
>
> > - As it stands I will vote >>>against<<< my proposal any time soon -
> until
> > with have a bunch of proposals for changes to GDAL that require new
> > language versions or someone rewrites my proposal to be much more
> > compelling -

Which proposal exactly ? AFAICS in this thread, it was more about polling
> opinions.
>

I have not sent out the doc yet.



>
> > We have lots of work that we can do to make GDAL maintenance
> > / debugging easier that does not require newer language versions
> > - We have successfully ( at least in my opinion ) stuck a toe in the
> C++11
> > world with CPL_FINAL, CPL_DISALLOW_COPY_ASSIGN, NULL_AS_NULLPTR, and
> > my std::lock_guard<std::mutex> experiments.  We can probably do a bit
> more
> > if we are careful.
> > - I think having an experimental autotest2 C++11/14 only testing tree
> might
> > be the way to start.  Those who want to can try it out or look through
> what
> > is possible and it won't impact the main tree or the existing C++ tests.
> >
> >
> > I would be happy to start contributing to
> > https://trac.osgeo.org/gdal/browser/trunk/autotest2, especially if we
> call
> > it experimental and I can get help with adding a build system.  I have
> >
> > >5000 lines of C++ in 32 test files that mostly cover the port directory
> >
> > right now.  I got hung up on trying to create a working initial version
> in
> > a separate github tree.  Adding it to the existing svn tree would get me
> > around that issue (it's an internal work thing).  Here is
> > cpl_string_test.cc... it's super boring.
> >
> >    https://gist.github.com/schwehr/02128959ee78d56b553defa0a527bdf2
> >
> > It's written using the Google C++ style guide and is based on gunit,
> gmock
> > and glog.
> >
> > - https://google.github.io/styleguide/cppguide.html
> > - https://github.com/google/googletest
> > - https://github.com/google/glog
>
> Are those available as ready to be installable packages ? (thinking about
> integration with CI)
>
>
The people who maintain gunit/gmock prefer that projects package the gunit
code inside their repos.

git clone git at github.com:google/googletest.git
cd googletest
find . -type f | wc -l
     340

du -hs
8.9M .

e.g. for libais, I just made third_party and put them in side that...

https://github.com/schwehr/libais/tree/master/third_party


> >
> > On Mon, May 9, 2016 at 2:33 AM, Mateusz Loskot <mateusz at loskot.net>
> wrote:
> > > On 7 May 2016 at 19:10, Kurt Schwehr <schwehr at gmail.com> wrote:
> > > >> If we move to a later C++ standard, or even use features of C++98 we
> > > >> currently
> > > >> don't use, I'd advocate for using things that are obviously making
> the
> > > >> code
> > > >> better / more readable. Honestly who finds that
> > > >> "std::unique_ptr<int *, std::function<void(char *)>>
> > > >> Vals(CPLCalloc(256, 0),
> > > >> CPLFree);" is obviously more readable, efficient and less error
> prone
> > >
> > > than
> > >
> > > >> "std::vector Vals(256,0)" ?
> > > >
> > > > This is cart before the horse but... as fast as I can so expect
> typos.
> > >
> > > Now
> > >
> > > > just think of a ~1K long function or method with tons of instances
> and
> > >
> > > lots
> > >
> > > > of places to bailout successfully or as failures.  We have > 9K
> > > > free/CPLFree/CPLdelete/CPLDestroys that could be < ~100.
> > > > [...]
> > >
> > > ...the very long story short, your desire is to introduce the RAII
> idiom
> > > across GDAL codebase. Awesome!
> > > I'm sure 99% of GDAL committers will welcome this idea.
> > > Then, **next** question is how we want to implement it:
> > > using C++11+ features, home-brewed smart pointer class(es), etc.
> > >
> > > Upgrading to C++11+ just for the sake of upgrade, makes little sense to
> > > me. Especially if folks are not certain about it, don't use those
> > > features daily,
> > > don't feel comfortable...it may cause more harm.
> > >
> > > Best regards,
> > > --
> > > Mateusz Loskot, http://mateusz.loskot.net
>
> --
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/2b5a0884/attachment.html>

From schwehr at gmail.com  Mon May  9 11:57:23 2016
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 9 May 2016 11:57:23 -0700
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <CACmBxytqgzqDNqRLNirxb6fhvYBOTgCE3VkoWe8NgktT5rc7rQ@mail.gmail.com>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <CABUeae-u8uNQB90PVmZtH+HRuMAmRKe+=zJhO7Go6bomANW_zA@mail.gmail.com>
 <CACmBxysx9U-84DTu1T37a-2gj5fxq_6kLpjpkcby+LZxQZTp6Q@mail.gmail.com>
 <201605092017.10401.even.rouault@spatialys.com>
 <CACmBxytqgzqDNqRLNirxb6fhvYBOTgCE3VkoWe8NgktT5rc7rQ@mail.gmail.com>
Message-ID: <CACmBxyv7AgLJ6VDeDecpNY+7vO4P4jDBUbB-SGjm5BEQ7C-MrA@mail.gmail.com>

See also for googletest on travis-ci:

https://github.com/google/googletest/blob/master/.travis.yml

And there is libgtest-dev on ubuntu, but the project stopped doing point
releases a long time ago (~2005).

https://github.com/easylogging/easyloggingpp/blob/master/.travis.yml
https://amodernstory.com/2015/07/27/upgrading-travisci-build-scripts/

On Mon, May 9, 2016 at 11:38 AM, Kurt Schwehr <schwehr at gmail.com> wrote:

> Agreed on the 11 v 14 issues.
>
> On Mon, May 9, 2016 at 11:17 AM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Le lundi 09 mai 2016 19:28:48, vous avez écrit :
>> > Here is my current take on language standards
>> >
>> > - I am working on a C++11/14 C99/11 proposal.  I despirately want to be
>> > able to use C++11 to make GDAL more robust
>>
>> C++11 is probably OK, but C++14 support is really "new". For Linux
>> distros, we
>> should try to make GDAL compilable on the current LTS and probably in the
>> case
>> of Ubuntu last-1 LTS with their default compiler.
>>
>> For example RHEL 7 ships with gcc 4.8.X, Ubuntu 14.04 too.
>> I've checked that gcc 4.8 refuses -std=c++14. It accepts -std=c++1y
>> though, so
>> some features of C++14 might be available.
>>
>> At least for the sake of our CI environements : Travis has no immediate
>> plans
>> for now to ship with with Ubuntu 16.04 (
>> https://github.com/travis-ci/travis-
>> ci/issues/5821 <https://github.com/travis-ci/travis-ci/issues/5821> )
>>
>> > - As it stands I will vote >>>against<<< my proposal any time soon -
>> until
>> > with have a bunch of proposals for changes to GDAL that require new
>> > language versions or someone rewrites my proposal to be much more
>> > compelling -
>
> Which proposal exactly ? AFAICS in this thread, it was more about polling
>> opinions.
>>
>
> I have not sent out the doc yet.
>
>
>
>>
>> > We have lots of work that we can do to make GDAL maintenance
>> > / debugging easier that does not require newer language versions
>> > - We have successfully ( at least in my opinion ) stuck a toe in the
>> C++11
>> > world with CPL_FINAL, CPL_DISALLOW_COPY_ASSIGN, NULL_AS_NULLPTR, and
>> > my std::lock_guard<std::mutex> experiments.  We can probably do a bit
>> more
>> > if we are careful.
>> > - I think having an experimental autotest2 C++11/14 only testing tree
>> might
>> > be the way to start.  Those who want to can try it out or look through
>> what
>> > is possible and it won't impact the main tree or the existing C++ tests.
>> >
>> >
>> > I would be happy to start contributing to
>> > https://trac.osgeo.org/gdal/browser/trunk/autotest2, especially if we
>> call
>> > it experimental and I can get help with adding a build system.  I have
>> >
>> > >5000 lines of C++ in 32 test files that mostly cover the port directory
>> >
>> > right now.  I got hung up on trying to create a working initial version
>> in
>> > a separate github tree.  Adding it to the existing svn tree would get me
>> > around that issue (it's an internal work thing).  Here is
>> > cpl_string_test.cc... it's super boring.
>> >
>> >    https://gist.github.com/schwehr/02128959ee78d56b553defa0a527bdf2
>> >
>> > It's written using the Google C++ style guide and is based on gunit,
>> gmock
>> > and glog.
>> >
>> > - https://google.github.io/styleguide/cppguide.html
>> > - https://github.com/google/googletest
>> > - https://github.com/google/glog
>>
>> Are those available as ready to be installable packages ? (thinking about
>> integration with CI)
>>
>>
> The people who maintain gunit/gmock prefer that projects package the gunit
> code inside their repos.
>
> git clone git at github.com:google/googletest.git
> cd googletest
> find . -type f | wc -l
>      340
>
> du -hs
> 8.9M .
>
> e.g. for libais, I just made third_party and put them in side that...
>
> https://github.com/schwehr/libais/tree/master/third_party
>
>
>> >
>> > On Mon, May 9, 2016 at 2:33 AM, Mateusz Loskot <mateusz at loskot.net>
>> wrote:
>> > > On 7 May 2016 at 19:10, Kurt Schwehr <schwehr at gmail.com> wrote:
>> > > >> If we move to a later C++ standard, or even use features of C++98
>> we
>> > > >> currently
>> > > >> don't use, I'd advocate for using things that are obviously making
>> the
>> > > >> code
>> > > >> better / more readable. Honestly who finds that
>> > > >> "std::unique_ptr<int *, std::function<void(char *)>>
>> > > >> Vals(CPLCalloc(256, 0),
>> > > >> CPLFree);" is obviously more readable, efficient and less error
>> prone
>> > >
>> > > than
>> > >
>> > > >> "std::vector Vals(256,0)" ?
>> > > >
>> > > > This is cart before the horse but... as fast as I can so expect
>> typos.
>> > >
>> > > Now
>> > >
>> > > > just think of a ~1K long function or method with tons of instances
>> and
>> > >
>> > > lots
>> > >
>> > > > of places to bailout successfully or as failures.  We have > 9K
>> > > > free/CPLFree/CPLdelete/CPLDestroys that could be < ~100.
>> > > > [...]
>> > >
>> > > ...the very long story short, your desire is to introduce the RAII
>> idiom
>> > > across GDAL codebase. Awesome!
>> > > I'm sure 99% of GDAL committers will welcome this idea.
>> > > Then, **next** question is how we want to implement it:
>> > > using C++11+ features, home-brewed smart pointer class(es), etc.
>> > >
>> > > Upgrading to C++11+ just for the sake of upgrade, makes little sense
>> to
>> > > me. Especially if folks are not certain about it, don't use those
>> > > features daily,
>> > > don't feel comfortable...it may cause more harm.
>> > >
>> > > Best regards,
>> > > --
>> > > Mateusz Loskot, http://mateusz.loskot.net
>>
>> --
>>
>


-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/8465749f/attachment-0001.html>

From mapoubelle22 at gmail.com  Mon May  9 12:38:54 2016
From: mapoubelle22 at gmail.com (fred p)
Date: Mon, 9 May 2016 19:38:54 +0000
Subject: [gdal-dev] how to write multi-IFD TIFF files ?
Message-ID: <CADzX+2UwrNtMEi0_sgfL5yBqx2z+qbrvWVUmRVbDB9hfKdXRZg@mail.gmail.com>

I have just replaced geotifcp with tiffcp then applygeo from a recent
version of libgeotiff.
Not really pretty at all but it works...
Thanks

2016-05-09 16:28 GMT+00:00 fred p <mapoubelle22 at gmail.com>:

> Sorry for the previous message with a bad subject...
>
> ---------- Forwarded message ----------
> From: fred p <mapoubelle22 at gmail.com>
> Date: 2016-05-09 16:26 GMT+00:00
> Subject: Re: gdal-dev Digest, Vol 144, Issue 30
> To: gdal-dev at lists.osgeo.org
>
>
> Thanks for confirming what I guessed.
>
> What follows is not directly related to GDAL but someone might have a
> solution. So... Using geotifcp I cannot assemble a JPEG-compressed TIFF and
> a LZW-compressed TIF keeping these compression modes for both IFD. Tiffcp
> can do it (but without georeferencing of course !) whereas geotifcp ouputs
> "JPEGLib: Bogus input colorspace". Any idea ?
>
>
> ------------------------------
>
>>
>> Message: 2
>> Date: Sun, 8 May 2016 00:19:51 +0200
>> From: Even Rouault <even.rouault at spatialys.com>
>> To: gdal-dev at lists.osgeo.org
>> Subject: Re: [gdal-dev] how to write multi-IFD TIFF files ?
>> Message-ID: <201605080019.51485.even.rouault at spatialys.com>
>> Content-Type: Text/Plain;  charset="utf-8"
>>
>> Le samedi 07 mai 2016 23:57:18, fred p a écrit :
>> > Hello,
>> > I am looking for a way to write multi-IFD TIFF files with GDAL (each IFD
>> > being JPEG or LZW compressed), for example with gdal_translate or
>> (better
>> > if possible) the Python API but without any success.
>> > Is it possible anyway ?
>>
>> Hi,
>>
>> No this is not currently possible in the general case (internal overviews
>> are
>> implemented as IFD, but flagged as such and not as general purpose IFD).
>> Would
>> probably not a huge effort to implement, but in the mean time you may use
>> GDAL
>> to create individual IDF and then use tifcp/geotifcp to assemble them.
>>
>> Even
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/a50c5723/attachment.html>

From mateusz at loskot.net  Mon May  9 12:49:52 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 9 May 2016 20:49:52 +0100
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CACmBxyuj4ZrVZXP7H5rm9ZAoSyS_mdKUZd6Toe8Bgon9dpprYw@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
 <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
 <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>
 <CACmBxyvy6b-QSHd8P09_H9er3ASkiVk5uMyCPWbspO8==UrKfA@mail.gmail.com>
 <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>
 <CACmBxyuj4ZrVZXP7H5rm9ZAoSyS_mdKUZd6Toe8Bgon9dpprYw@mail.gmail.com>
Message-ID: <CABUeae8MEXRnTSjHkDahx1JUDThD9d+Dt4_7N7CTrUJ7ftfKHQ@mail.gmail.com>

On 9 May 2016 at 18:02, Kurt Schwehr <schwehr at gmail.com> wrote:
> Sounds like we are on the right track now.  Hopefully, the proposal is
> clearer after a few more changes just now.
>
> My concern is that you seem to taking the discuss as the proposal and not
> ready the proposal as stand alone: http://goo.gl/vuA3D6

Kurt,

Point taken.

Although the proposal looks OK, I'd suggest to check what
assembler code generates your favourite C++ toolkit,
or at least measured times for

int anVals[256];
memset(anVals, 0, 256*sizeof(int));

vs

std::vector<int> oVals(256, 0);

and compare with:

std::vector<char> oVals(256, 0);

It is an interesting experiment.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From andrew.bell.ia at gmail.com  Mon May  9 13:37:20 2016
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Mon, 9 May 2016 15:37:20 -0500
Subject: [gdal-dev] Starting a discussion on style and coding guidelines
In-Reply-To: <CABUeae8MEXRnTSjHkDahx1JUDThD9d+Dt4_7N7CTrUJ7ftfKHQ@mail.gmail.com>
References: <CACmBxyvZVV26DJVRCUKpBcLpJ3oLUTCrCqyPjrM=z0RwnbdmFQ@mail.gmail.com>
 <CACmBxytjMQBXFaidPyk3fpW0LWFrNy=r-ShyGxUnncFy9zJLCQ@mail.gmail.com>
 <CACJ51z2YebaiETNPtWREPJce6h_oA-iRxT+g7sN3gsqfgK+CYw@mail.gmail.com>
 <201605052325.11402.even.rouault@spatialys.com>
 <CACmBxyumiemh-VKcpCPQ7i9_eQK4=FpmdTEYyY8ANT0MLOjGhA@mail.gmail.com>
 <CABUeae9F_OdG71X827UaZ=tfowQfLfb27Ed9QzTYOyVfJMempg@mail.gmail.com>
 <CACmBxysZnqmiycd63yYZYD01NZ1WxKqiqf7JYh_yBpq+Paw2yA@mail.gmail.com>
 <CABUeae8dHWLdQWcqwuuwWN9L-r8zyGEDk8A4djE-CY=0yrFhAw@mail.gmail.com>
 <CACmBxyvy6b-QSHd8P09_H9er3ASkiVk5uMyCPWbspO8==UrKfA@mail.gmail.com>
 <CABUeae97NrrtyL5dJ79WP_9v5h-TSpsRiwUWyu9GZbQWzHEVGw@mail.gmail.com>
 <CACmBxyuj4ZrVZXP7H5rm9ZAoSyS_mdKUZd6Toe8Bgon9dpprYw@mail.gmail.com>
 <CABUeae8MEXRnTSjHkDahx1JUDThD9d+Dt4_7N7CTrUJ7ftfKHQ@mail.gmail.com>
Message-ID: <CACJ51z1YJvCpdAmrFX753DWgGK2Ocx8xFXa1gm4F-brSkNaS8g@mail.gmail.com>

On Mon, May 9, 2016 at 2:49 PM, Mateusz Loskot <mateusz at loskot.net> wrote:

>
> Point taken.
>
> Although the proposal looks OK, I'd suggest to check what
> assembler code generates your favourite C++ toolkit,
> or at least measured times for
>
> int anVals[256];
> memset(anVals, 0, 256*sizeof(int));
>

Are "we" doing memset anymore in these cases?

int anVals[256] = {};

seems preferable


> vs
>
> std::vector<int> oVals(256, 0);
>
> and compare with:
>
> std::vector<char> oVals(256, 0);
>

Think vector is a bad solution for something that's fixed.  Just write
something.  But I already suggested that and wrote something... :)

Do you know why they are wedded to a 16K stack?

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160509/0f63dfc9/attachment.html>

From jamessramm at gmail.com  Tue May 10 00:22:19 2016
From: jamessramm at gmail.com (jramm)
Date: Tue, 10 May 2016 00:22:19 -0700 (PDT)
Subject: [gdal-dev] Geotiff FillEmptyTiles with no data value?
In-Reply-To: <201605061414.06850.even.rouault@spatialys.com>
References: <1462299829320-5264310.post@n6.nabble.com>
 <201605032059.38870.even.rouault@spatialys.com>
 <1462534416067-5264905.post@n6.nabble.com>
 <201605061414.06850.even.rouault@spatialys.com>
Message-ID: <1462864939565-5265514.post@n6.nabble.com>

Hi
I have made changes to FillEmptyTiles so that if nodata is set, then it will
always fill with nodata, otherwise 0. 

I have attached the raw diff...I have no idea how to submit a change
request/review etc?

fillempty_nodata.diff
<http://osgeo-org.1560.x6.nabble.com/file/n5265514/fillempty_nodata.diff>  



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Geotiff-FillEmptyTiles-with-no-data-value-tp5264310p5265514.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Tue May 10 04:12:21 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 May 2016 13:12:21 +0200
Subject: [gdal-dev] Minimum supported C and C++ standards
In-Reply-To: <alpine.LRH.2.20.1605101204560.30537@warden.aitchison.me.uk>
References: <CACmBxysuogNcp6V3injAJvngqJw52CETmXQJuwLmgoYBsGnDtg@mail.gmail.com>
 <201605092017.10401.even.rouault@spatialys.com>
 <alpine.LRH.2.20.1605101204560.30537@warden.aitchison.me.uk>
Message-ID: <201605101312.21713.even.rouault@spatialys.com>


> I'd say that moving GDAL to GCC 5 and C++11 would be possible but tricky
> on RHEL.
> A developer still on RHEL 6 can do it and would be able to
> put up with the effort considering that they are using such an old system
> However a *user* on RHEL 7 has the latest and greatest system available
> and would not appreciate the work required. 

Since RHEL 7 ships with GCC 4.8 which has C++11 support, that shouldn't be a 
problem, would it ? But yes, RHEL 6 would require more work.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Tue May 10 05:38:01 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Tue, 10 May 2016 12:38:01 +0000 (UTC)
Subject: [gdal-dev] VRT and M-dimension - any example?
Message-ID: <loom.20160510T141834-969@post.gmane.org>

Hi,

Release notes https://trac.osgeo.org/gdal/wiki/Release/2.1.0-News announce
that RFC 61: Support for measured geometries is implemented in VRT. However,
this is not mentioned in http://www.gdal.org/drv_vrt.html. I would like to
improve the documentation but before I can do that I need to understand how
it works. Could somebody help a bit with making a valid VRT for

- CSV source
- GeometryType>wkbPointZM</GeometryType>
- GeometryField encoding="PointFromColumns" 

Or are the PointFromColumn attributes simply x="x" y="y" z="z" m="m" ?

-Jukka Rahkonen-


From even.rouault at spatialys.com  Tue May 10 05:43:16 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 May 2016 14:43:16 +0200
Subject: [gdal-dev] VRT and M-dimension - any example?
In-Reply-To: <loom.20160510T141834-969@post.gmane.org>
References: <loom.20160510T141834-969@post.gmane.org>
Message-ID: <201605101443.16257.even.rouault@spatialys.com>

Le mardi 10 mai 2016 14:38:01, Jukka Rahkonen a écrit :
> Hi,
> 
> Release notes https://trac.osgeo.org/gdal/wiki/Release/2.1.0-News announce
> that RFC 61: Support for measured geometries is implemented in VRT.
> However, this is not mentioned in http://www.gdal.org/drv_vrt.html. I
> would like to improve the documentation but before I can do that I need to
> understand how it works. Could somebody help a bit with making a valid VRT
> for
> 
> - CSV source
> - GeometryType>wkbPointZM</GeometryType>
> - GeometryField encoding="PointFromColumns"
> 
> Or are the PointFromColumn attributes simply x="x" y="y" z="z" m="m" ?

Ah good point, PointFromColumn has not been extended to support the m 
attribute. The support for M / ZM is just in passthrough mode :

pointzm.csv:
id,WKT
1,"POINT ZM (1 2 3 4)"

pointzm.vrt:
<OGRVRTDataSource>
  <OGRVRTLayer name="pointzm">
    <SrcDataSource relativeToVRT="1">pointzm.csv</SrcDataSource>
    <SrcLayer>pointzm</SrcLayer>
    <GeometryType>wkbPointZM</GeometryType>
  </OGRVRTLayer>
</OGRVRTDataSource>



> 
> -Jukka Rahkonen-
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Tue May 10 06:29:34 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 May 2016 15:29:34 +0200
Subject: [gdal-dev] Geotiff FillEmptyTiles with no data value?
In-Reply-To: <1462864939565-5265514.post@n6.nabble.com>
References: <1462299829320-5264310.post@n6.nabble.com>
 <201605061414.06850.even.rouault@spatialys.com>
 <1462864939565-5265514.post@n6.nabble.com>
Message-ID: <201605101529.34814.even.rouault@spatialys.com>

Le mardi 10 mai 2016 09:22:19, jramm a écrit :
> Hi
> I have made changes to FillEmptyTiles so that if nodata is set, then it
> will always fill with nodata, otherwise 0.
> 
> I have attached the raw diff...I have no idea how to submit a change
> request/review etc?
> 
> fillempty_nodata.diff
> <http://osgeo-org.1560.x6.nabble.com/file/n5265514/fillempty_nodata.diff>

I've committed in trunk a more complete version of your patch since on 
reflection there was also the case of non power-of-two bit depths to handle.

Patches are better handled as attachments to Trac tickets.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Tue May 10 07:08:35 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 May 2016 16:08:35 +0200
Subject: [gdal-dev] VRT and M-dimension - any example?
In-Reply-To: <201605101443.16257.even.rouault@spatialys.com>
References: <loom.20160510T141834-969@post.gmane.org>
 <201605101443.16257.even.rouault@spatialys.com>
Message-ID: <201605101608.35130.even.rouault@spatialys.com>

Le mardi 10 mai 2016 14:43:16, Even Rouault a écrit :
> Le mardi 10 mai 2016 14:38:01, Jukka Rahkonen a écrit :
> > Hi,
> > 
> > Release notes https://trac.osgeo.org/gdal/wiki/Release/2.1.0-News
> > announce that RFC 61: Support for measured geometries is implemented in
> > VRT. However, this is not mentioned in http://www.gdal.org/drv_vrt.html.
> > I would like to improve the documentation but before I can do that I
> > need to understand how it works. Could somebody help a bit with making a
> > valid VRT for
> > 
> > - CSV source
> > - GeometryType>wkbPointZM</GeometryType>
> > - GeometryField encoding="PointFromColumns"
> > 
> > Or are the PointFromColumn attributes simply x="x" y="y" z="z" m="m" ?
> 
> Ah good point, PointFromColumn has not been extended to support the m
> attribute. 

Just added support for m attribute in PointFromColumn mode in trunk and 2.1 
branch.

$ cat pointzm2.csv 
id,x,y,z,m
1,1,2,3,4

$ cat pointzm2.vrt
<OGRVRTDataSource>
  <OGRVRTLayer name="pointzm2">
    <SrcDataSource relativeToVRT="1">pointzm2.csv</SrcDataSource>
    <SrcLayer>pointzm2</SrcLayer>
    <GeometryField encoding="PointFromColumns" x="x" y="y" z="z" m="m"/>
  </OGRVRTLayer>
</OGRVRTDataSource>


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Brendan.DeTracey at dfo-mpo.gc.ca  Tue May 10 07:31:44 2016
From: Brendan.DeTracey at dfo-mpo.gc.ca (DeTracey, Brendan)
Date: Tue, 10 May 2016 14:31:44 +0000
Subject: [gdal-dev] Python interface to wrapdateline
Message-ID: <22C6A8A4889F0C45B71BF3272671822EB8926B46@SVNSBIOMBX02.ENT.dfo-mpo.ca>

Hi, 

Is there any way to access the wrap dateline capabilities of OGR from the Python interface? For example how to split the following polygon:

from osgeo import ogr, osr
srs = osr.SpatialReference()
srs.ImportFromEPSG(4326)
p = ogr.CreateGeometryFromWkt('POLYGON ((160 1, -160 1, -160 -1, 160 -1, 160 1))')


Looking at the OGRGeometryFactory  source I see :
static void CutGeometryOnDateLineAndAddToMulti(OGRGeometryCollection* poMulti,
                                               const OGRGeometry* poGeom,
                                               double dfDateLineOffset)

but I can't see how to access it from Python. Would it be via an option to the ogr.CreateGeometryFromWkt?

Thanks,
Brendan

From even.rouault at spatialys.com  Tue May 10 07:45:35 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 May 2016 16:45:35 +0200
Subject: [gdal-dev] Python interface to wrapdateline
In-Reply-To: <22C6A8A4889F0C45B71BF3272671822EB8926B46@SVNSBIOMBX02.ENT.dfo-mpo.ca>
References: <22C6A8A4889F0C45B71BF3272671822EB8926B46@SVNSBIOMBX02.ENT.dfo-mpo.ca>
Message-ID: <201605101645.35528.even.rouault@spatialys.com>

Le mardi 10 mai 2016 16:31:44, DeTracey, Brendan a écrit :
> Hi,
> 
> Is there any way to access the wrap dateline capabilities of OGR from the
> Python interface? For example how to split the following polygon:
> 
> from osgeo import ogr, osr
> srs = osr.SpatialReference()
> srs.ImportFromEPSG(4326)
> p = ogr.CreateGeometryFromWkt('POLYGON ((160 1, -160 1, -160 -1, 160 -1,
> 160 1))')
> 
> 
> Looking at the OGRGeometryFactory  source I see :
> static void CutGeometryOnDateLineAndAddToMulti(OGRGeometryCollection*
> poMulti, const OGRGeometry* poGeom, double dfDateLineOffset)
> 
> but I can't see how to access it from Python. Would it be via an option to
> the ogr.CreateGeometryFromWkt?

No, this is unavailable through Python bindings.

With GDAL 2.1, you can use gdal.VectorTranslate() (librarified version of 
ogr2ogr), although it might not be very practical if you just need to do that 
on a single geometry.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sean at mapbox.com  Tue May 10 08:51:20 2016
From: sean at mapbox.com (Sean Gillies)
Date: Tue, 10 May 2016 09:51:20 -0600
Subject: [gdal-dev] Python interface to wrapdateline
In-Reply-To: <201605101645.35528.even.rouault@spatialys.com>
References: <22C6A8A4889F0C45B71BF3272671822EB8926B46@SVNSBIOMBX02.ENT.dfo-mpo.ca>
 <201605101645.35528.even.rouault@spatialys.com>
Message-ID: <CADPhZXx=5V-jfGC0BEjidAZTt3YJ3yCBC3qvDB8rew3vff9MEw@mail.gmail.com>

Hi Brendan,

On Tue, May 10, 2016 at 8:45 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le mardi 10 mai 2016 16:31:44, DeTracey, Brendan a écrit :
> > Hi,
> >
> > Is there any way to access the wrap dateline capabilities of OGR from the
> > Python interface? For example how to split the following polygon:
> >
> > from osgeo import ogr, osr
> > srs = osr.SpatialReference()
> > srs.ImportFromEPSG(4326)
> > p = ogr.CreateGeometryFromWkt('POLYGON ((160 1, -160 1, -160 -1, 160 -1,
> > 160 1))')
> >
> >
> > Looking at the OGRGeometryFactory  source I see :
> > static void CutGeometryOnDateLineAndAddToMulti(OGRGeometryCollection*
> > poMulti, const OGRGeometry* poGeom, double dfDateLineOffset)
> >
> > but I can't see how to access it from Python. Would it be via an option
> to
> > the ogr.CreateGeometryFromWkt?
>
> No, this is unavailable through Python bindings.
>
> With GDAL 2.1, you can use gdal.VectorTranslate() (librarified version of
> ogr2ogr), although it might not be very practical if you just need to do
> that
> on a single geometry.
>

I don't know if using the Python interface to OGR named Fiona is an option
for you (Windows support is not 100%), but antimeridian cutting is readily
available in the Fiona API:
https://github.com/Toblerity/Fiona/blob/master/fiona/transform.py#L62-L64.

>
-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160510/fbb6083b/attachment.html>

From landa.martin at gmail.com  Wed May 11 03:18:22 2016
From: landa.martin at gmail.com (Martin Landa)
Date: Wed, 11 May 2016 12:18:22 +0200
Subject: [gdal-dev] ESRI GeoJSON
Message-ID: <CA+Ei1OeuuD69LFxcx7b23hHOmeYaDRe4tf_oQ1RpkV-XbAVpaw@mail.gmail.com>

Hi,

even the manual page [1] doesn't mention support of ESRI GeoJSON, the
driver seems to support this dialect for reading. Is there any support
for writing into ESRI GeoJSON?

Thanks, Martin

[1] http://gdal.org/drv_geojson.html

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From mateusz at loskot.net  Wed May 11 03:43:20 2016
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed, 11 May 2016 12:43:20 +0200
Subject: [gdal-dev] ESRI GeoJSON
In-Reply-To: <CA+Ei1OeuuD69LFxcx7b23hHOmeYaDRe4tf_oQ1RpkV-XbAVpaw@mail.gmail.com>
References: <CA+Ei1OeuuD69LFxcx7b23hHOmeYaDRe4tf_oQ1RpkV-XbAVpaw@mail.gmail.com>
Message-ID: <CABUeae-fPtYHLJRZz9QxO=v3fLouyvgjPbnxwOcQJqLAg9UY9Q@mail.gmail.com>

On 11 May 2016 at 12:18, Martin Landa <landa.martin at gmail.com> wrote:
>
> even the manual page [1] doesn't mention support of ESRI GeoJSON,

Shouldn't it read ESRI JSON, but not ESRI GeoJSON?

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From deedeebernard at hotmail.com  Wed May 11 08:31:13 2016
From: deedeebernard at hotmail.com (Didier Bernard)
Date: Wed, 11 May 2016 15:31:13 +0000
Subject: [gdal-dev] Why does the difference between two overlapping rasters
 exist after projection in GDAL?
Message-ID: <AM3PR08MB0103EA79B50FF8F9914A7964A3720@AM3PR08MB0103.eurprd08.prod.outlook.com>

Hello to GDAL community.

I have one issue, and I would be very grateful if somebody could give me any kind of help.

I have two rasters of the area around Mount Vesuvius<https://www.google.rs/maps/place/40%C2%B048'45.6%22N+14%C2%B024'51.3%22E/@40.840774,14.2281818,10z/data=!4m5!3m4!1s0x0:0x0!8m2!3d40.81266!4d14.414252>: one spans 20 kilometers, and the other one 50 kilometers (these distances are not so important for the problem). Both rasters are in WGS84 geographic coordinate system, and they overlap between each other. Here is the preview of those two WGS84 rasters<https://www.dropbox.com/s/nza0edj0n4kilfi/vesuvius_radius_20_50KM_overlap.jpg?dl=0> in QGIS.

When I use QGIS Raster calculator<https://docs.qgis.org/2.2/en/docs/user_manual/working_with_raster/raster_calculator.html> to calculate the difference between them, a new raster file is created which is totally black - so it shows that there is absolutely no difference in cell values on the part where they overlap. Here is the preview of difference between the two WGS84 rasters<https://www.dropbox.com/s/c19jj6c3a8if1n2/vesuvius_radius_20-50KM.jpg?dl=0>.

However, when I project both rasters to Azimuthal equidistant projection, and again check for the difference with Raster calculator: the difference between these two reprojected Azimuthal equidistant rasters exists<https://www.dropbox.com/s/c4mnpm4szr1l4cq/vesuvius_radius_20-50KM_cubic_aeqd.jpg?dl=0>!
I used cubic resampling method, but I get similar results with bilienear method.

The reason for this is because once vesuvius_radius_20KM.tif and vesuvius_radius_50KM.tif are reprojected, their grids do not overlap anymore, and their cell sizes slightly differ (79.1578,-79.1578 vs 79.1628,-79.1628).


So if I reproject the initial vesuvius_radius_20KM.tif and vesuvius_radius_50KM.tif rasters, but by fixing the cell size (to 100 meters for example) and by fixing the extents, two rasters would now need to have exactly the same values in their cells on the central part (where they overlap).
But they do not!! There is still a difference between them. Smaller difference but it still exists. Here is a preview of that difference<https://www.dropbox.com/s/gxdbd1l34jo12uk/vesuvius_radius_20-50KM_cubic_aeqd_cellsize100m.jpg?dl=0>.

Why?
That's my question and the point of my email.
Their grids now match each other, and their cellsizes are exactly 100,100 meters. So why does the difference exist at the part where they overlap?

I am only interested in projecting the WGS84 rasters to Azimuthal equidistant, but just for the sake of checking, I tried using Transverse Mercator projection (instead of Azimuthal equidistant), and again the difference exists.

I am using GDAL 2.0 and Raster Calculator from QGIS 2.8.7 (to calculate the difference between rasters).

Is this some sort of bug related with GDAL 2.0?

I would be very grateful if I could get any kind of reply on this issue.
Thank you in advance.

P.S



Additional information:

Here are the initial raster files (in WGS84):
https://www.dropbox.com/s/pudw8vbgil9ti69/vesuvius_radius_20KM.tif?dl=0
https://www.dropbox.com/s/k30x4c5442g8028/vesuvius_radius_50KM.tif?dl=0

Here are the Azimuthal equidistant projected rasters with fixed cell sizes and extents:
https://www.dropbox.com/s/cmw1uk3qe09k2u2/vesuvius_radius_20KM_cubic_aeqd_cellsize100m.tif?dl=0
https://www.dropbox.com/s/9yiwc2r6rfd6bgd/vesuvius_radius_50KM_cubic_aeqd_cellsize100m.tif?dl=0

And the difference between the two upper Azimuthal equidistant projected rasters:
https://www.dropbox.com/s/jprwjpf44rotnva/vesuvius_radius_20-50KM_cubic_aeqd_cellsize100m.tif?dl=0



To project the initial WGS84 raster files to Transverse Mercator projection:

gdalwarp -s_srs EPSG:4326 -t_srs EPSG:32633 -r cubic -of GTiff "C:/vesuvius_radius_20KM.tif" "C:/vesuvius_radius_20KM_cubic_tm.tif"


gdalwarp -s_srs EPSG:4326 -t_srs EPSG:32633 -r cubic -of GTiff "C:/vesuvius_radius_50KM.tif" "C:/vesuvius_radius_50KM_cubic_tm.tif"


To project the initial WGS84 raster files to Azimuthal equidistant projection:

gdalwarp -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252" -r cubic -of GTiff "C:/vesuvius_radius_20KM.tif" "C:/vesuvius_radius_20KM_cubic_aeqd.tif"


gdalwarp -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252" -r cubic -of GTiff "C:/vesuvius_radius_50KM.tif" "C:/vesuvius_radius_50KM_cubic_aeqd.tif"


To project the initial WGS84 raster files to Azimuthal equidistant projection by fixing cell size and extents:

gdalwarp -overwrite -te -25000 -18000 14000 21000 -tr 100 100 -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs" -r cubic -of GTiff "C:/vesuvius_radius_20KM.tif" "C:/vesuvius_radius_20KM_cubic_aeqd_cellsize100m.tif"


gdalwarp -overwrite -te -56000 -48000 44000 51000 -tr 100 100 -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs" -r cubic -of GTiff "C:/vesuvius_radius_50KM.tif" "C:/vesuvius_radius_50KM_cubic_aeqd_cellsize100m.tif"

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160511/6ab83f98/attachment.html>

From gjj12 at aber.ac.uk  Wed May 11 09:53:36 2016
From: gjj12 at aber.ac.uk (Gareth James Jones [gjj12])
Date: Wed, 11 May 2016 16:53:36 +0000
Subject: [gdal-dev] GDALRasterBand::RasterIO c++ vs BandReadAsArray python
	performance
Message-ID: <HE1PR0401MB17871360CE4CB48018B00DC796720@HE1PR0401MB1787.eurprd04.prod.outlook.com>

I'm currently writing optimisations for a raster viewer program which uses gdal as it's base. It's currently written purely in python, and has some major speed issues which cause problems when we are reading many files at a time. After making some optimisations in the python, and getting quite a minimal speed increase, I proceeded to profile the program quite heavily and found that our getImage method was our slowest call. I had already performed some optimisations on this function so decided to write a C-Extension so that we could get some speed increases through a lower level language.

This has worked for the most part, however there is still one issue, we have found a speed increase of ~2s for some of our larger files in the bulk of the code. But this is negated by the GDALRasterIO call, which is actually about 3s slower than the python ReadAsArray.

This doesn't make any sense to me as ReadAsArray is a wrapper around a C++ call to GDALRasterIO, and thus should be slower than having a call straight to GDALRasterIO.

I was hoping someone here might know of a way to read the rasters more efficiently. I have tried to implement a method using ReadBlock rather than RasterIO, but due to the replication that RasterIO does it didn't work at all. (I'm currently trying to figure out a way to do that replication without losing too much speed).

The RasterIO call i'm using is

band->RasterIO(GF_Read, this->ovleft, this->ovtop, this->ovxsize,
               this->ovysize, dataTmp, this->ovxsize, this->ovysize,
               band->GetRasterDataType(), 0, 0);

The old python call was:

dataTmp = band.ReadAsArray(ovleft, ovtop,
    ovxsize, ovysize,
    dspRastXSize, dspRastYSize)


Thanks in advance

Gareth Jones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160511/17bcfe01/attachment-0001.html>

From sean at mapbox.com  Wed May 11 10:41:39 2016
From: sean at mapbox.com (Sean Gillies)
Date: Wed, 11 May 2016 11:41:39 -0600
Subject: [gdal-dev] GDALRasterBand::RasterIO c++ vs BandReadAsArray
	python performance
In-Reply-To: <HE1PR0401MB17871360CE4CB48018B00DC796720@HE1PR0401MB1787.eurprd04.prod.outlook.com>
References: <HE1PR0401MB17871360CE4CB48018B00DC796720@HE1PR0401MB1787.eurprd04.prod.outlook.com>
Message-ID: <CADPhZXzumvceH3Oih-Racj7ES47rheSnhaDxdQJOY5cTjJGGxw@mail.gmail.com>

Hi Gareth,

How are you initializing your dataTmp array? In my Rasterio project, I've
found that numpy.empty() is the fastest array allocator and use it whenever
possible. I also use the GDAL C API and Cython (in case you're interested:
https://github.com/mapbox/rasterio/blob/c80b568903ef7b902ce6254a42c73af9ddcc8362/rasterio/_io.pyx#L58-L69)
and find the performance to be as good as ReadAsArray.

On Wed, May 11, 2016 at 10:53 AM, Gareth James Jones [gjj12] <
gjj12 at aber.ac.uk> wrote:

> I'm currently writing optimisations for a raster viewer program which uses
> gdal as it's base. It's currently written purely in python, and has some
> major speed issues which cause problems when we are reading many files at a
> time. After making some optimisations in the python, and getting quite a
> minimal speed increase, I proceeded to profile the program quite heavily
> and found that our getImage method was our slowest call. I had already
> performed some optimisations on this function so decided to write a
> C-Extension so that we could get some speed increases through a lower level
> language.
>
> This has worked for the most part, however there is still one issue, we
> have found a speed increase of ~2s for some of our larger files in the bulk
> of the code. But this is negated by the GDALRasterIO call, which is
> actually about 3s slower than the python ReadAsArray.
>
> This doesn't make any sense to me as ReadAsArray is a wrapper around a C++
> call to GDALRasterIO, and thus should be slower than having a call straight
> to GDALRasterIO.
>
> I was hoping someone here might know of a way to read the rasters more
> efficiently. I have tried to implement a method using ReadBlock rather than
> RasterIO, but due to the replication that RasterIO does it didn't work at
> all. (I'm currently trying to figure out a way to do that replication
> without losing too much speed).
>
> The RasterIO call i'm using is
>
> band->RasterIO(GF_Read, this->ovleft, this->ovtop, this->ovxsize,
>                this->ovysize, dataTmp, this->ovxsize, this->ovysize,
>                band->GetRasterDataType(), 0, 0);
>
> The old python call was:
>
> dataTmp = band.ReadAsArray(ovleft, ovtop,
>     ovxsize, ovysize,
>     dspRastXSize, dspRastYSize)
>
>
> Thanks in advance
>
> Gareth Jones
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160511/46be7326/attachment.html>

From even.rouault at spatialys.com  Wed May 11 13:39:21 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 11 May 2016 22:39:21 +0200
Subject: [gdal-dev] ESRI GeoJSON
In-Reply-To: <CA+Ei1OeuuD69LFxcx7b23hHOmeYaDRe4tf_oQ1RpkV-XbAVpaw@mail.gmail.com>
References: <CA+Ei1OeuuD69LFxcx7b23hHOmeYaDRe4tf_oQ1RpkV-XbAVpaw@mail.gmail.com>
Message-ID: <201605112239.22060.even.rouault@spatialys.com>

> Is there any support
> for writing into ESRI GeoJSON?
No. Read-only.

> 
> Thanks, Martin
> 
> [1] http://gdal.org/drv_geojson.html

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed May 11 13:42:29 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 11 May 2016 22:42:29 +0200
Subject: [gdal-dev] Why does the difference between two overlapping
	rasters exist after projection in GDAL?
In-Reply-To: <AM3PR08MB0103EA79B50FF8F9914A7964A3720@AM3PR08MB0103.eurprd08.prod.outlook.com>
References: <AM3PR08MB0103EA79B50FF8F9914A7964A3720@AM3PR08MB0103.eurprd08.prod.outlook.com>
Message-ID: <201605112242.30179.even.rouault@spatialys.com>

Didier,
> 
> So if I reproject the initial vesuvius_radius_20KM.tif and
> vesuvius_radius_50KM.tif rasters, but by fixing the cell size (to 100
> meters for example) and by fixing the extents, two rasters would now need
> to have exactly the same values in their cells on the central part (where
> they overlap). But they do not!! There is still a difference between them.
> Smaller difference but it still exists. Here is a preview of that
> difference<https://www.dropbox.com/s/gxdbd1l34jo12uk/vesuvius_radius_20-50
> KM_cubic_aeqd_cellsize100m.jpg?dl=0>.
> 
> Why?

Perhaps try adding -et 0 to your gdalwarp command line so exact reprojection 
is done. By default there's a small tolerance margin of 0.125 pixel that can 
speed up significantly, and might perhaps (I'm not sure) explain the small 
difference you see here.

Also did you try with nerarest neighbour to check ?

> That's my question and the point of my email.
> Their grids now match each other, and their cellsizes are exactly 100,100
> meters. So why does the difference exist at the part where they overlap?
> 
> I am only interested in projecting the WGS84 rasters to Azimuthal
> equidistant, but just for the sake of checking, I tried using Transverse
> Mercator projection (instead of Azimuthal equidistant), and again the
> difference exists.
> 
> I am using GDAL 2.0 and Raster Calculator from QGIS 2.8.7 (to calculate the
> difference between rasters).
> 
> Is this some sort of bug related with GDAL 2.0?
> 
> I would be very grateful if I could get any kind of reply on this issue.
> Thank you in advance.
> 
> P.S
> 
> 
> 
> Additional information:
> 
> Here are the initial raster files (in WGS84):
> https://www.dropbox.com/s/pudw8vbgil9ti69/vesuvius_radius_20KM.tif?dl=0
> https://www.dropbox.com/s/k30x4c5442g8028/vesuvius_radius_50KM.tif?dl=0
> 
> Here are the Azimuthal equidistant projected rasters with fixed cell sizes
> and extents:
> https://www.dropbox.com/s/cmw1uk3qe09k2u2/vesuvius_radius_20KM_cubic_aeqd_
> cellsize100m.tif?dl=0
> https://www.dropbox.com/s/9yiwc2r6rfd6bgd/vesuvius_radius_50KM_cubic_aeqd_
> cellsize100m.tif?dl=0
> 
> And the difference between the two upper Azimuthal equidistant projected
> rasters:
> https://www.dropbox.com/s/jprwjpf44rotnva/vesuvius_radius_20-50KM_cubic_ae
> qd_cellsize100m.tif?dl=0
> 
> 
> 
> To project the initial WGS84 raster files to Transverse Mercator
> projection:
> 
> gdalwarp -s_srs EPSG:4326 -t_srs EPSG:32633 -r cubic -of GTiff
> "C:/vesuvius_radius_20KM.tif" "C:/vesuvius_radius_20KM_cubic_tm.tif"
> 
> 
> gdalwarp -s_srs EPSG:4326 -t_srs EPSG:32633 -r cubic -of GTiff
> "C:/vesuvius_radius_50KM.tif" "C:/vesuvius_radius_50KM_cubic_tm.tif"
> 
> 
> To project the initial WGS84 raster files to Azimuthal equidistant
> projection:
> 
> gdalwarp -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266
> +lon_0=14.414252" -r cubic -of GTiff "C:/vesuvius_radius_20KM.tif"
> "C:/vesuvius_radius_20KM_cubic_aeqd.tif"
> 
> 
> gdalwarp -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266
> +lon_0=14.414252" -r cubic -of GTiff "C:/vesuvius_radius_50KM.tif"
> "C:/vesuvius_radius_50KM_cubic_aeqd.tif"
> 
> 
> To project the initial WGS84 raster files to Azimuthal equidistant
> projection by fixing cell size and extents:
> 
> gdalwarp -overwrite -te -25000 -18000 14000 21000 -tr 100 100 -s_srs
> EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252 +x_0=0
> +y_0=0 +ellps=WGS84 +units=m +no_defs" -r cubic -of GTiff
> "C:/vesuvius_radius_20KM.tif"
> "C:/vesuvius_radius_20KM_cubic_aeqd_cellsize100m.tif"
> 
> 
> gdalwarp -overwrite -te -56000 -48000 44000 51000 -tr 100 100 -s_srs
> EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252 +x_0=0
> +y_0=0 +ellps=WGS84 +units=m +no_defs" -r cubic -of GTiff
> "C:/vesuvius_radius_50KM.tif"
> "C:/vesuvius_radius_50KM_cubic_aeqd_cellsize100m.tif"

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jluis at ualg.pt  Wed May 11 14:56:32 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Wed, 11 May 2016 22:56:32 +0100
Subject: [gdal-dev] Failure to fetch scale_factor and other on a subdataset
 of a L2 SST nc file (from OceanColor)
Message-ID: <op.yhbi8itgdbaoe8@macmarilu>

Hi,

In GMT we have this chunk of code to read Band metadata

if (GDALGetRasterScale(hBand, &bSuccess) != 1 ||  
GDALGetRasterOffset(hBand, &bSuccess) != 0) {
	Ctrl->band_field_names[nBand].ScaleOffset[0] = GDALGetRasterScale (hBand,  
&bSuccess);
	Ctrl->band_field_names[nBand].ScaleOffset[1] = GDALGetRasterOffset(hBand,  
&bSuccess);
}
else {
...

http://gmt.soest.hawaii.edu/projects/gmt/repository/entry/trunk/src/gmt_gdalread.c#L452

and it works fine so far. However, when I use it on a SST L2 file from  
OceanColor (a netCDF4 file) as in

grdinfo   
A2016123140500.L2_LAC_SST.nc=gd?HDF5:"A2016123140500.L2_LAC_SST.nc"://geophysical_data/sst

(GMT syntax to access the subdataset), the calls to

GDALGetRasterScale(hBand, &bSuccess)

and friends return no data (bSuccess == 0 and confirmed in a debugger).  
However, if add a temporary

	char **papszMetadataBand = GDALGetMetadata(hBand, NULL);
	int i, nCounterBand = CSLCount(papszMetadataBand);
	for (i = 0; i < nCounterBand; i++)
		fprintf(stderr, "Meta %d\t%s\n", i, papszMetadataBand[i]);

than the band's metadata is printed correctly (same info as that printed  
with gdalinfo).

Question: is this what it looks, a bug?

Thanks

Joaquim

From even.rouault at spatialys.com  Wed May 11 15:10:04 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 12 May 2016 00:10:04 +0200
Subject: [gdal-dev] Failure to fetch scale_factor and other on a
	subdataset of a L2 SST nc file (from OceanColor)
In-Reply-To: <op.yhbi8itgdbaoe8@macmarilu>
References: <op.yhbi8itgdbaoe8@macmarilu>
Message-ID: <201605120010.05034.even.rouault@spatialys.com>

Le mercredi 11 mai 2016 23:56:32, Joaquim Luis a écrit :
> Hi,
> 
> In GMT we have this chunk of code to read Band metadata
> 
> if (GDALGetRasterScale(hBand, &bSuccess) != 1 ||
> GDALGetRasterOffset(hBand, &bSuccess) != 0) {
> 	Ctrl->band_field_names[nBand].ScaleOffset[0] = GDALGetRasterScale (hBand,
> &bSuccess);
> 	Ctrl->band_field_names[nBand].ScaleOffset[1] = GDALGetRasterOffset(hBand,
> &bSuccess);
> }
> else {
> ...
> 
> http://gmt.soest.hawaii.edu/projects/gmt/repository/entry/trunk/src/gmt_gda
> lread.c#L452
> 
> and it works fine so far. However, when I use it on a SST L2 file from
> OceanColor (a netCDF4 file) as in
> 
> grdinfo
> A2016123140500.L2_LAC_SST.nc=gd?HDF5:"A2016123140500.L2_LAC_SST.nc"://geoph
> ysical_data/sst
> 
> (GMT syntax to access the subdataset), the calls to

In the above you use the HDF5 driver, not the netCDF one. As far as I can see, 
GetScale() is implemented in the netCDF driver, but not in the HDF5 one.

> 
> GDALGetRasterScale(hBand, &bSuccess)
> 
> and friends return no data (bSuccess == 0 and confirmed in a debugger).
> However, if add a temporary
> 
> 	char **papszMetadataBand = GDALGetMetadata(hBand, NULL);
> 	int i, nCounterBand = CSLCount(papszMetadataBand);
> 	for (i = 0; i < nCounterBand; i++)
> 		fprintf(stderr, "Meta %d\t%s\n", i, papszMetadataBand[i]);
> 
> than the band's metadata is printed correctly (same info as that printed
> with gdalinfo).
> 
> Question: is this what it looks, a bug?
> 
> Thanks
> 
> Joaquim
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed May 11 15:31:43 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 12 May 2016 00:31:43 +0200
Subject: [gdal-dev] Creation of pages on Trac wiki disabled
In-Reply-To: <201605042324.59596.even.rouault@spatialys.com>
References: <201604272159.01182.even.rouault@spatialys.com>
 <201605041849.28985.even.rouault@spatialys.com>
 <201605042324.59596.even.rouault@spatialys.com>
Message-ID: <201605120031.44206.even.rouault@spatialys.com>

Wiki page creation disabled again because of another spam storm I don't manage 
to block.

If you look at https://trac.osgeo.org/gdal/timeline , I've left 2 example of 
spam pages. Both contain the 'pogo' word that I've explicitly listed in 
https://trac.osgeo.org/gdal/wiki/BadContent . I don't understand why the regex 
filter doesn't react then.

> 
> > > > > Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From strk at keybit.net  Wed May 11 15:37:37 2016
From: strk at keybit.net (Sandro Santilli)
Date: Thu, 12 May 2016 00:37:37 +0200
Subject: [gdal-dev] [SAC]  Creation of pages on Trac wiki disabled
In-Reply-To: <201605120031.44206.even.rouault@spatialys.com>
References: <201604272159.01182.even.rouault@spatialys.com>
 <201605041849.28985.even.rouault@spatialys.com>
 <201605042324.59596.even.rouault@spatialys.com>
 <201605120031.44206.even.rouault@spatialys.com>
Message-ID: <20160511223737.GA10401@localhost>

On Thu, May 12, 2016 at 12:31:43AM +0200, Even Rouault wrote:
> Wiki page creation disabled again because of another spam storm I don't manage 
> to block.
> 
> If you look at https://trac.osgeo.org/gdal/timeline , I've left 2 example of 
> spam pages. Both contain the 'pogo' word that I've explicitly listed in 
> https://trac.osgeo.org/gdal/wiki/BadContent . I don't understand why the regex 
> filter doesn't react then.

I see that the page _body_ does nto have a "pogo" string,
but it's full of "p.ogo" strings, maybe that's the reason.

In the monitor I see a lot of spam was intercepted though:
https://trac.osgeo.org/gdal/admin/spamfilter/monitor

I guess it just needs some 'ham' training to kick-start the bayes
filter

--strk;

From even.rouault at spatialys.com  Wed May 11 15:53:27 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 12 May 2016 00:53:27 +0200
Subject: [gdal-dev] [SAC]  Creation of pages on Trac wiki disabled
In-Reply-To: <20160511223737.GA10401@localhost>
References: <201604272159.01182.even.rouault@spatialys.com>
 <201605120031.44206.even.rouault@spatialys.com>
 <20160511223737.GA10401@localhost>
Message-ID: <201605120053.27432.even.rouault@spatialys.com>

Le jeudi 12 mai 2016 00:37:37, Sandro Santilli a écrit :
> On Thu, May 12, 2016 at 12:31:43AM +0200, Even Rouault wrote:
> > Wiki page creation disabled again because of another spam storm I don't
> > manage to block.
> > 
> > If you look at https://trac.osgeo.org/gdal/timeline , I've left 2 example
> > of spam pages. Both contain the 'pogo' word that I've explicitly listed
> > in https://trac.osgeo.org/gdal/wiki/BadContent . I don't understand why
> > the regex filter doesn't react then.
> 
> I see that the page _body_ does nto have a "pogo" string,
> but it's full of "p.ogo" strings, maybe that's the reason.

Added p.ogo

> 
> In the monitor I see a lot of spam was intercepted though:
> https://trac.osgeo.org/gdal/admin/spamfilter/monitor
> 
> I guess it just needs some 'ham' training to kick-start the bayes
> filter

Yes probably. I added all 'ham' I could found since the filter is in place, but 
not so oddly, spammers are more productive in creating contents that us legit 
users...

I let wiki page creation disabled for now as I'd hate to see several hundreds 
of spam pages when I wake up... If any GDAL Trac admin is monitoring activity, 
please re-enable.

> 
> --strk;
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From gjj12 at aber.ac.uk  Thu May 12 02:22:45 2016
From: gjj12 at aber.ac.uk (Gareth James Jones [gjj12])
Date: Thu, 12 May 2016 09:22:45 +0000
Subject: [gdal-dev] GDALRasterBand::RasterIO c++ vs BandReadAsArray
 python performance (Gareth Jones)
In-Reply-To: <mailman.17.1462993202.11011.gdal-dev@lists.osgeo.org>
References: <mailman.17.1462993202.11011.gdal-dev@lists.osgeo.org>
Message-ID: <HE1PR0401MB1787CBA853495FB26DF6AAE396730@HE1PR0401MB1787.eurprd04.prod.outlook.com>

Hi Sean,

I initialise datatmp using CPLMalloc in the C++

   T* dataTmp = (T*)CPLMalloc(sizeof(T) *(this->dspRastXSize * this->dspRastYSize));

this is then freed using CPLFree once finished with. I do re-malloc it for each band we want to read in a raster so that does add some slowdown that could probably be avoided.

The python is initialised using ReadAsArray.

I have taken a look at rasterio, and was of a mind to use it, but we are wanting to keep any more dependencies to an absolute minimum, so the C++ is being implemented with a check to see if it's available, if not the program will use the current method.


>Hi Gareth,
>
>How are you initializing your dataTmp array? In my Rasterio project, I've
>found that numpy.empty() is the fastest array allocator and use it whenever
>possible. I also use the GDAL C API and Cython (in case you're interested:
>https://github.com/mapbox/rasterio/blob/c80b568903ef7b902ce6254a42c73af9ddcc8362/rasterio/_io.pyx#L58-L69)
>and find the performance to be as good as ReadAsArray.

On Wed, May 11, 2016 at 10:53 AM, Gareth James Jones [gjj12] <
gjj12 at aber.ac.uk> wrote:

>> I'm currently writing optimisations for a raster viewer program which uses
>> gdal as it's base. It's currently written purely in python, and has some
>> major speed issues which cause problems when we are reading many files at a
>> time. After making some optimisations in the python, and getting quite a
>> minimal speed increase, I proceeded to profile the program quite heavily
>> and found that our getImage method was our slowest call. I had already
>> performed some optimisations on this function so decided to write a
>> C-Extension so that we could get some speed increases through a lower level
>> language.
>>
>> This has worked for the most part, however there is still one issue, we
>> have found a speed increase of ~2s for some of our larger files in the bulk
>> of the code. But this is negated by the GDALRasterIO call, which is
>> actually about 3s slower than the python ReadAsArray.
>>
>> This doesn't make any sense to me as ReadAsArray is a wrapper around a C++
>> call to GDALRasterIO, and thus should be slower than having a call straight
>> to GDALRasterIO.
>>
>> I was hoping someone here might know of a way to read the rasters more
>> efficiently. I have tried to implement a method using ReadBlock rather than
>> RasterIO, but due to the replication that RasterIO does it didn't work at
>> all. (I'm currently trying to figure out a way to do that replication
>> without losing too much speed).
>>
>> The RasterIO call i'm using is
>>
>> band->RasterIO(GF_Read, this->ovleft, this->ovtop, this->ovxsize,
>>                this->ovysize, dataTmp, this->ovxsize, this->ovysize,
>>                band->GetRasterDataType(), 0, 0);
>>
>> The old python call was:
>>
>> dataTmp = band.ReadAsArray(ovleft, ovtop,
>>     ovxsize, ovysize,
>>     dspRastXSize, dspRastYSize)
>>
>>
>> Thanks in advance
>>
>> Gareth Jones
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>>



>--
>Sean Gillies

Gareth Jones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160511/46be7326/attachment-0001.html>

------------------------------

Subject: Digest Footer

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman/listinfo/gdal-dev

------------------------------

End of gdal-dev Digest, Vol 144, Issue 40
*****************************************

From gane.prog at gmail.com  Thu May 12 03:43:46 2016
From: gane.prog at gmail.com (Gane R)
Date: Thu, 12 May 2016 16:13:46 +0530
Subject: [gdal-dev] Using TILE_SCHEME option converting GeoTIFF to GeoPackage
Message-ID: <CALMrLdDW9REcdo6m54oT3m04+w671d8tJfuXVAXA=dr2HacUgw@mail.gmail.com>

Hi all,

Here is a link to Geopackage sample name ERDC Whitehorse GeoPackage.gpkg
at
https://portal.opengeospatial.org/files/63156

I tried like this

gdal_translate.exe -of GPKG "sample.tif" "sample.gpkg" -co *TILING_SCHEME*
=PseudoTMS_GlobalMercator

I got only one zoom level in the output Geopackage, from the input GeoTIFF
here example sample.tif

*Q1:*
*I want to know how do I convert a GeoTIFF to below mention tile Schemes I
tried, correct If I am wrong.*
I have gdal 2.1.0 pre-built binary with to see with the latest version.

TILE_SCHEME

1 CUSTOM
2 GoogleCRS84Quad
3 GoogleMapsCompatible
4 InspireCRS84Quad
5 PseudoTMS_GlobalGeodetic
6 PseudoTMS_GlobalMercator


*I see there are 3 variations*
1. Tile Format: PNG, JPEG, WEBP
2. Tile Scheme:

   - CUSTOM
   - GoogleCRS84Quad
   - GoogleMapsCompatible
   - InspireCRS84Quad
   - PseudoTMS_GlobalGeodetic
   - PseudoTMS_GlobalMercator

3. Projection parameter at gpkg_contents srs_id : epsg code


*Q2:Is that an raster tile may be in other EPSG code other than 3857 and
4326 Not clear when reading the Geopackage specification and is it
implemented in GDAL ?*
Thanks
Gane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160512/72aaea00/attachment.html>

From landa.martin at gmail.com  Thu May 12 03:50:14 2016
From: landa.martin at gmail.com (Martin Landa)
Date: Thu, 12 May 2016 12:50:14 +0200
Subject: [gdal-dev] ESRI GeoJSON
In-Reply-To: <201605112239.22060.even.rouault@spatialys.com>
References: <CA+Ei1OeuuD69LFxcx7b23hHOmeYaDRe4tf_oQ1RpkV-XbAVpaw@mail.gmail.com>
 <201605112239.22060.even.rouault@spatialys.com>
Message-ID: <CA+Ei1OcST_GAcFe36FOJJbSB5Sr0Hx1QGZGmrjTN640OtAfEQA@mail.gmail.com>

2016-05-11 22:39 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:
>> Is there any support
>> for writing into ESRI GeoJSON?
> No. Read-only.

thanks for clarification, Martin

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From bradh at frogmouth.net  Thu May 12 04:16:09 2016
From: bradh at frogmouth.net (Brad Hards)
Date: Thu, 12 May 2016 21:16:09 +1000
Subject: [gdal-dev] Using TILE_SCHEME option converting GeoTIFF to
	GeoPackage
In-Reply-To: <CALMrLdDW9REcdo6m54oT3m04+w671d8tJfuXVAXA=dr2HacUgw@mail.gmail.com>
References: <CALMrLdDW9REcdo6m54oT3m04+w671d8tJfuXVAXA=dr2HacUgw@mail.gmail.com>
Message-ID: <040601d1ac3f$b1e30f60$15a92e20$@frogmouth.net>

> Here is a link to Geopackage sample name ERDC Whitehorse GeoPackage.gpkg
> at
> https://portal.opengeospatial.org/files/63156
I'm not sure I understand what this has to do with your question.  It seems unrelated.

> I tried like this

> gdal_translate.exe -of GPKG "sample.tif" "sample.gpkg" -co TILING_SCHEME=PseudoTMS_GlobalMercator
> I got only one zoom level in the output Geopackage, from the input GeoTIFF here example sample.tif
That is expected. Use gdaladdo if you want overviews (zoom levels).

> Q1:
> I want to know how do I convert a GeoTIFF to below mention tile Schemes I tried, correct If I am wrong.
> I have gdal 2.1.0 pre-built binary with to see with the latest version.
You use the creation option that matches whatever you need. Tile scheme is not really  about creating overviews.

> Q2:
> Is that an raster tile may be in other EPSG code other than 3857 and 4326 Not clear when reading the Geopackage specification and is it implemented in GDAL ?
It can be in any SRS you want. The geopackage spec makes it clear that the tiles can use any SRS defined 
in gpkg_spatial_ref_sys, and gpkg_spatial_ref_sys can contain any EPSG code you want to add. It works
in GDAL,  just use -a_srs option to gdal_translate. Or reproject the source data - whatever works for you.

Brad


From deedeebernard at hotmail.com  Thu May 12 04:36:46 2016
From: deedeebernard at hotmail.com (Didier Bernard)
Date: Thu, 12 May 2016 11:36:46 +0000
Subject: [gdal-dev] Why does the difference between two overlapping
 rasters exist after projection in GDAL?
In-Reply-To: <201605112242.30179.even.rouault@spatialys.com>
References: <AM3PR08MB0103EA79B50FF8F9914A7964A3720@AM3PR08MB0103.eurprd08.prod.outlook.com>,
 <201605112242.30179.even.rouault@spatialys.com>
Message-ID: <AM3PR08MB01033C3030C53330D4FEE253A3720@AM3PR08MB0103.eurprd08.prod.outlook.com>

Dear Even,

Thank you!!
I haven't tried with the nearest neighbor resampling method, but your advice on setting the error threshold to 0 (-et 0) worked perfectly with cubic resampling method!!! Now there is no difference between the two Azimuthal equidistant projected rasters! Thank you again.


Not related to this solved issue: you already told me that you are not a C# GDAL developer, but I was wondering, do you happen to know if defining the cell size (resolution) and extent is possible through C# GDAL bindings? Basically using the "-tr" and "-te" parameters from Gdal command prompt syntax?

Regards,
Didier
________________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Wednesday, May 11, 2016 10:42 PM
To: gdal-dev at lists.osgeo.org
Cc: Didier Bernard
Subject: Re: [gdal-dev] Why does the difference between two overlapping rasters exist after projection in GDAL?

Didier,
>
> So if I reproject the initial vesuvius_radius_20KM.tif and
> vesuvius_radius_50KM.tif rasters, but by fixing the cell size (to 100
> meters for example) and by fixing the extents, two rasters would now need
> to have exactly the same values in their cells on the central part (where
> they overlap). But they do not!! There is still a difference between them.
> Smaller difference but it still exists. Here is a preview of that
> difference<https://www.dropbox.com/s/gxdbd1l34jo12uk/vesuvius_radius_20-50
> KM_cubic_aeqd_cellsize100m.jpg?dl=0>.
>
> Why?

Perhaps try adding -et 0 to your gdalwarp command line so exact reprojection
is done. By default there's a small tolerance margin of 0.125 pixel that can
speed up significantly, and might perhaps (I'm not sure) explain the small
difference you see here.

Also did you try with nerarest neighbour to check ?

> That's my question and the point of my email.
> Their grids now match each other, and their cellsizes are exactly 100,100
> meters. So why does the difference exist at the part where they overlap?
>
> I am only interested in projecting the WGS84 rasters to Azimuthal
> equidistant, but just for the sake of checking, I tried using Transverse
> Mercator projection (instead of Azimuthal equidistant), and again the
> difference exists.
>
> I am using GDAL 2.0 and Raster Calculator from QGIS 2.8.7 (to calculate the
> difference between rasters).
>
> Is this some sort of bug related with GDAL 2.0?
>
> I would be very grateful if I could get any kind of reply on this issue.
> Thank you in advance.
>
> P.S
>
>
>
> Additional information:
>
> Here are the initial raster files (in WGS84):
> https://www.dropbox.com/s/pudw8vbgil9ti69/vesuvius_radius_20KM.tif?dl=0
> https://www.dropbox.com/s/k30x4c5442g8028/vesuvius_radius_50KM.tif?dl=0
>
> Here are the Azimuthal equidistant projected rasters with fixed cell sizes
> and extents:
> https://www.dropbox.com/s/cmw1uk3qe09k2u2/vesuvius_radius_20KM_cubic_aeqd_
> cellsize100m.tif?dl=0
> https://www.dropbox.com/s/9yiwc2r6rfd6bgd/vesuvius_radius_50KM_cubic_aeqd_
> cellsize100m.tif?dl=0
>
> And the difference between the two upper Azimuthal equidistant projected
> rasters:
> https://www.dropbox.com/s/jprwjpf44rotnva/vesuvius_radius_20-50KM_cubic_ae
> qd_cellsize100m.tif?dl=0
>
>
>
> To project the initial WGS84 raster files to Transverse Mercator
> projection:
>
> gdalwarp -s_srs EPSG:4326 -t_srs EPSG:32633 -r cubic -of GTiff
> "C:/vesuvius_radius_20KM.tif" "C:/vesuvius_radius_20KM_cubic_tm.tif"
>
>
> gdalwarp -s_srs EPSG:4326 -t_srs EPSG:32633 -r cubic -of GTiff
> "C:/vesuvius_radius_50KM.tif" "C:/vesuvius_radius_50KM_cubic_tm.tif"
>
>
> To project the initial WGS84 raster files to Azimuthal equidistant
> projection:
>
> gdalwarp -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266
> +lon_0=14.414252" -r cubic -of GTiff "C:/vesuvius_radius_20KM.tif"
> "C:/vesuvius_radius_20KM_cubic_aeqd.tif"
>
>
> gdalwarp -s_srs EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266
> +lon_0=14.414252" -r cubic -of GTiff "C:/vesuvius_radius_50KM.tif"
> "C:/vesuvius_radius_50KM_cubic_aeqd.tif"
>
>
> To project the initial WGS84 raster files to Azimuthal equidistant
> projection by fixing cell size and extents:
>
> gdalwarp -overwrite -te -25000 -18000 14000 21000 -tr 100 100 -s_srs
> EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252 +x_0=0
> +y_0=0 +ellps=WGS84 +units=m +no_defs" -r cubic -of GTiff
> "C:/vesuvius_radius_20KM.tif"
> "C:/vesuvius_radius_20KM_cubic_aeqd_cellsize100m.tif"
>
>
> gdalwarp -overwrite -te -56000 -48000 44000 51000 -tr 100 100 -s_srs
> EPSG:4326 -t_srs "+proj=aeqd +lat_0=40.81266 +lon_0=14.414252 +x_0=0
> +y_0=0 +ellps=WGS84 +units=m +no_defs" -r cubic -of GTiff
> "C:/vesuvius_radius_50KM.tif"
> "C:/vesuvius_radius_50KM_cubic_aeqd_cellsize100m.tif"

--
Spatialys - Geospatial professional services
http://www.spatialys.com

From gane.prog at gmail.com  Fri May 13 05:24:38 2016
From: gane.prog at gmail.com (Gane R)
Date: Fri, 13 May 2016 17:54:38 +0530
Subject: [gdal-dev] Creating multiple zooms in MBTiles generation
Message-ID: <CALMrLdA42a-fr46TwrAoAWy-Tc9rrR9fgYS5f5VA4CaNiA0X5A@mail.gmail.com>

Hi,

I was working with gdal 2.1.0, I was trying to convert a geopackage raster
to mbtiles, I used GDALCreateCopy to convert the dataset to mbtiles.

On http://www.gdal.org/frmt_mbtiles.html

I saw an example to use gdal_translate and then to use gdaladdo to
overviews

Q1: I got only one level of zoom level in the mbtiles. Is there any
creation option to say to generate mbtiles from a to b zooms ? or I have to
do by build overviews ???


Q2: I tried to convert the Geopackage ERDC_Whitehorse_GeoPackage.gpkg size
111 MB in Web Mercator EPSG:3857 from the url

http://www.geopackage.org/#sampledata

(GeoPackage contains a raster tile pyramid that was created with free
imagery obtained from Geomatics Yukon and covers an approximately 30
square-kilometer area centered on the City of Whitehorse. It uses the Web
Mercator (EPSG:3857) coordinate reference system, 256x256 pixel tiles,
contains zoom levels 11-18, and is 110.8MB in size)



*The resulting mbtiles was to 621MB Is this due to default PNG zlevel
settings or any thing can be done on this ?*
Thanks
Gane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160513/24fff9cc/attachment.html>

From even.rouault at spatialys.com  Fri May 13 05:51:23 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 13 May 2016 14:51:23 +0200
Subject: [gdal-dev] Creating multiple zooms in MBTiles generation
In-Reply-To: <CALMrLdA42a-fr46TwrAoAWy-Tc9rrR9fgYS5f5VA4CaNiA0X5A@mail.gmail.com>
References: <CALMrLdA42a-fr46TwrAoAWy-Tc9rrR9fgYS5f5VA4CaNiA0X5A@mail.gmail.com>
Message-ID: <201605131451.23634.even.rouault@spatialys.com>

Le vendredi 13 mai 2016 14:24:38, Gane R a écrit :
> Hi,
> 
> I was working with gdal 2.1.0, I was trying to convert a geopackage raster
> to mbtiles, I used GDALCreateCopy to convert the dataset to mbtiles.
> 
> On http://www.gdal.org/frmt_mbtiles.html
> 
> I saw an example to use gdal_translate and then to use gdaladdo to
> overviews
> 
> Q1: I got only one level of zoom level in the mbtiles. Is there any
> creation option to say to generate mbtiles from a to b zooms ?
No. Creation options for MBTILES are documented there : 
http://gdal.org/frmt_mbtiles.html
> or I have to
> do by build overviews ???
Yes
> 
> 
> Q2: I tried to convert the Geopackage ERDC_Whitehorse_GeoPackage.gpkg size
> 111 MB in Web Mercator EPSG:3857 from the url
> 
> http://www.geopackage.org/#sampledata
> 
> (GeoPackage contains a raster tile pyramid that was created with free
> imagery obtained from Geomatics Yukon and covers an approximately 30
> square-kilometer area centered on the City of Whitehorse. It uses the Web
> Mercator (EPSG:3857) coordinate reference system, 256x256 pixel tiles,
> contains zoom levels 11-18, and is 110.8MB in size)
> 
> 
> 
> *The resulting mbtiles was to 621MB Is this due to default PNG zlevel
> settings or any thing can be done on this ?*

The original GPKG probably uses JPEG compression, so if you use -co 
TILE_FORMAT=JPEG you should get to a similar size.  But this will cause some 
quality loss due to decompression/recompression done in GDAL.

You can in a few commands convert a GPKG to MBTiles, provides that it uses a 
Google Mercator tiling scheme as the sample dataset you use seem to be.
Have a look at the procedure described at the end of 
http://erouault.blogspot.fr/2014/12/gdal-geopackage-raster-support.html

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From julien.michel at cnes.fr  Fri May 13 06:16:29 2016
From: julien.michel at cnes.fr (Julien Michel)
Date: Fri, 13 May 2016 15:16:29 +0200
Subject: [gdal-dev] Potential issue with Sentinel-1 SAFE driver
Message-ID: <5735D3AD.1000309@cnes.fr>

Dear all,

I recently gave a try to the Sentinel-1 SAFE driver and I came accross 
something that to my opinion is conceptually wrong.

A Sentinel 1 product consists in one or several tiff file along with 
their annotation files. Dependening on product level and acquisition 
mode, those tiff files correspond to different polarimetric 
configurations (hh and hv), and/or different swath. All those images are 
referenced in a single entry point, which is the manifest.safe file at 
product root folder.

For instance, in extra-wide swath mode, I have the following:
$ ls -1 measurement/ annotation/
annotation/:
s1a-ew-grd-hh-20160117t204113-20160117t204213-009539-00ddc4-001.xml
s1a-ew-grd-hv-20160117t204113-20160117t204213-009539-00ddc4-002.xml

measurement/:
s1a-ew-grd-hh-20160117t204113-20160117t204213-009539-00ddc4-001.tiff
s1a-ew-grd-hv-20160117t204113-20160117t204213-009539-00ddc4-002.tiff

Which means I have dual polarisation on the same swath.

In this case, if I gdalinfo manifest.safe, I get :

Driver: SAFE/Sentinel-1 SAR SAFE Product
Files: manifest.safe
measurement/s1a-ew-grd-hh-20160117t204113-20160117t204213-009539-00ddc4-001.tiff
measurement/s1a-ew-grd-hv-20160117t204113-20160117t204213-009539-00ddc4-002.tiff
[...]
Band 1 Block=16753x1 Type=UInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=HH
Band 2 Block=16753x1 Type=UInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=HV

So gdal exposes the full dataset as one image of two bands (one for each 
polarization channel), which is fine (but one could argue that 
representing this as 2 subdatasets would be better).

Now, if I consider an IW product :

$ ls -1 measurement/ annotation/

calibration/:
s1a-iw1-slc-vh-20160114t054006-20160114t054031-009486-00dc3c-001.xml
s1a-iw1-slc-vv-20160114t054006-20160114t054031-009486-00dc3c-004.xml
s1a-iw2-slc-vh-20160114t054007-20160114t054032-009486-00dc3c-002.xml
s1a-iw2-slc-vv-20160114t054007-20160114t054032-009486-00dc3c-005.xml
s1a-iw3-slc-vh-20160114t054005-20160114t054030-009486-00dc3c-003.xml
s1a-iw3-slc-vv-20160114t054005-20160114t054030-009486-00dc3c-006.xml

measurement/:
s1a-iw1-slc-vh-20160114t054006-20160114t054031-009486-00dc3c-001.tiff
s1a-iw1-slc-vv-20160114t054006-20160114t054031-009486-00dc3c-004.tiff
s1a-iw2-slc-vh-20160114t054007-20160114t054032-009486-00dc3c-002.tiff
s1a-iw2-slc-vv-20160114t054007-20160114t054032-009486-00dc3c-005.tiff
s1a-iw3-slc-vh-20160114t054005-20160114t054030-009486-00dc3c-003.tiff
s1a-iw3-slc-vv-20160114t054005-20160114t054030-009486-00dc3c-006.tiff


This time we have 3 different swath (corresponding to different ground 
footprints), and 2 polarisations for each swath.

In this case, if I gdalinfo manifest.safe, I get :

Driver: SAFE/Sentinel-1 SAR SAFE Product
Files: manifest.safe
measurement/s1a-iw1-slc-vh-20160114t054006-20160114t054031-009486-00dc3c-001.tiff
measurement/s1a-iw2-slc-vh-20160114t054007-20160114t054032-009486-00dc3c-002.tiff
measurement/s1a-iw3-slc-vh-20160114t054005-20160114t054030-009486-00dc3c-003.tiff
measurement/s1a-iw1-slc-vv-20160114t054006-20160114t054031-009486-00dc3c-004.tiff
measurement/s1a-iw2-slc-vv-20160114t054007-20160114t054032-009486-00dc3c-005.tiff
measurement/s1a-iw3-slc-vv-20160114t054005-20160114t054030-009486-00dc3c-006.tiff
[...]
Band 1 Block=22015x1 Type=CInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=VH
Band 2 Block=25844x1 Type=CInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=VH
Band 3 Block=24889x1 Type=CInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=VH
Band 4 Block=22015x1 Type=CInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=VV
Band 5 Block=25844x1 Type=CInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=VV
Band 6 Block=24889x1 Type=CInt16, ColorInterp=Undefined
   Metadata:
     POLARISATION=VV

This is obviously wrong, since pixels in each swath correspond to 
different observed ground points. In other word, there is no meaning in 
stacking the response of pixel (0,0) of swath one with pixel (0,0) of 
swath two, since they do not observe the same target landscape.

I think the best would be to report at least the different swath as 
subdatasets (as done in S2 driver). For the sake of simplicity, 
polarisations too could be exposed as subdatasets.

What do you think ?

Regards,

Julien

-- 
Julien MICHEL
CNES - DCT/SI/AP


From even.rouault at spatialys.com  Fri May 13 06:54:19 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 13 May 2016 15:54:19 +0200
Subject: [gdal-dev] Potential issue with Sentinel-1 SAFE driver
In-Reply-To: <5735D3AD.1000309@cnes.fr>
References: <5735D3AD.1000309@cnes.fr>
Message-ID: <201605131554.19079.even.rouault@spatialys.com>


> This is obviously wrong, since pixels in each swath correspond to
> different observed ground points. In other word, there is no meaning in
> stacking the response of pixel (0,0) of swath one with pixel (0,0) of
> swath two, since they do not observe the same target landscape.
> 
> I think the best would be to report at least the different swath as
> subdatasets (as done in S2 driver). For the sake of simplicity,
> polarisations too could be exposed as subdatasets.

Julien,

Looking quickly at the driver and with the observations you made, your 
suggestions make sense to me. The swaths should defintely be in separate 
subdatasets, and the GCP fetched from the appropriate annotation file. Whether 
polarisations of the same swath are in different subdatasets is a matter of 
taste (looking quickly in the code base I see the CPG driver also puts the 
polarizations as different bands of the same dataset). Perhaps Delfim has some 
comments?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From a.amici at bopen.eu  Fri May 13 11:53:52 2016
From: a.amici at bopen.eu (Alessandro Amici)
Date: Fri, 13 May 2016 18:53:52 +0000
Subject: [gdal-dev] Potential issue with Sentinel-1 SAFE driver
In-Reply-To: <201605131554.19079.even.rouault@spatialys.com>
References: <5735D3AD.1000309@cnes.fr>
 <201605131554.19079.even.rouault@spatialys.com>
Message-ID: <CAF0=-Teq8PiPHmgozvp3hdj2wihyxvSZkP+52vMRsvTNEDJg_w@mail.gmail.com>

Even,

furthermore subswaths typically have different pixel and line sizes.

But the subswath level is easy bit of Sentinel-1 data, the real fun starts
as you note that every individual tiff file is a collection of actual image
segments (the bursts) interleaved with black stripes. The image segments
actually overlaps by a small amount. As far as I can tell the current
driver doesn't make any effort to recompose the swath image.

As a matter of fact I'm not even sure what strategy can be used to make the
Sentinel-1 data fit into the normal GDAL data model. Maybe treating bursts
as image tiles?

Cheers,
Alessandro


On Fri, 13 May 2016 at 15:54 Even Rouault <even.rouault at spatialys.com>
wrote:

>
> > This is obviously wrong, since pixels in each swath correspond to
> > different observed ground points. In other word, there is no meaning in
> > stacking the response of pixel (0,0) of swath one with pixel (0,0) of
> > swath two, since they do not observe the same target landscape.
> >
> > I think the best would be to report at least the different swath as
> > subdatasets (as done in S2 driver). For the sake of simplicity,
> > polarisations too could be exposed as subdatasets.
>
> Julien,
>
> Looking quickly at the driver and with the observations you made, your
> suggestions make sense to me. The swaths should defintely be in separate
> subdatasets, and the GCP fetched from the appropriate annotation file.
> Whether
> polarisations of the same swath are in different subdatasets is a matter of
> taste (looking quickly in the code base I see the CPG driver also puts the
> polarizations as different bands of the same dataset). Perhaps Delfim has
> some
> comments?
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Alessandro Amici <a.amici at bopen.eu>
CTO at B-Open Solutions - http://www.bopen.eu/
Viale Palmiro Togliatti, 1639 - 00155 Roma - tel: +39 06 8370 8269
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160513/6485483f/attachment.html>

From delfimrego at gmail.com  Sat May 14 02:14:41 2016
From: delfimrego at gmail.com (Delfim Rego)
Date: Sat, 14 May 2016 09:14:41 +0000
Subject: [gdal-dev] Fwd:  Potential issue with Sentinel-1 SAFE driver
In-Reply-To: <CANCQK9MEnU+HegicZjhvVKFGqTXbbPcVkA68VZWdbUwBxiwKGA@mail.gmail.com>
References: <5735D3AD.1000309@cnes.fr>
 <201605131554.19079.even.rouault@spatialys.com>
 <CAF0=-Teq8PiPHmgozvp3hdj2wihyxvSZkP+52vMRsvTNEDJg_w@mail.gmail.com>
 <CANCQK9MEnU+HegicZjhvVKFGqTXbbPcVkA68VZWdbUwBxiwKGA@mail.gmail.com>
Message-ID: <CANCQK9O4AGq-bCUFUE5=wE6VJUcx3LrKMFym8yObceJnLr0yqA@mail.gmail.com>

Julien,

The driver was tested only with GRD products. That's why it behaves so
badly with SLC.

Let's look at the possible solutions and I would like your comments:

Option 1) the driver provides polarizations as bands also on SLC
products. In this case, each band would represent a polarization and
would aggregate and reconstruct all swaths based on the GCPs. The
reconstruction would need some processing, and prevents the user to
use a single swath.

Option 2) the driver provides all measurements as subdatasets. In
Julien example it would create 6 subdatasets, one for each
polarisation and swath. This option would add flexibility to the user,
since it would be possible to select individual swaths.

Option 3) Using both. When no subdatasets are selected, the driver
provides an assembled dataset  (each band representing a
polarization). However, the user could also select each individual
measurement as subdatasets.

Thanks,
Delfim



On Fri, May 13, 2016 at 6:53 PM, Alessandro Amici <a.amici at bopen.eu> wrote:
>
> Even,
>
> furthermore subswaths typically have different pixel and line sizes.
>
> But the subswath level is easy bit of Sentinel-1 data, the real fun starts as you note that every individual tiff file is a collection of actual image segments (the bursts) interleaved with black stripes. The image segments actually overlaps by a small amount. As far as I can tell the current driver doesn't make any effort to recompose the swath image.
>
> As a matter of fact I'm not even sure what strategy can be used to make the Sentinel-1 data fit into the normal GDAL data model. Maybe treating bursts as image tiles?
>
> Cheers,
> Alessandro
>
>
> On Fri, 13 May 2016 at 15:54 Even Rouault <even.rouault at spatialys.com> wrote:
>>
>>
>> > This is obviously wrong, since pixels in each swath correspond to
>> > different observed ground points. In other word, there is no meaning in
>> > stacking the response of pixel (0,0) of swath one with pixel (0,0) of
>> > swath two, since they do not observe the same target landscape.
>> >
>> > I think the best would be to report at least the different swath as
>> > subdatasets (as done in S2 driver). For the sake of simplicity,
>> > polarisations too could be exposed as subdatasets.
>>
>> Julien,
>>
>> Looking quickly at the driver and with the observations you made, your
>> suggestions make sense to me. The swaths should defintely be in separate
>> subdatasets, and the GCP fetched from the appropriate annotation file. Whether
>> polarisations of the same swath are in different subdatasets is a matter of
>> taste (looking quickly in the code base I see the CPG driver also puts the
>> polarizations as different bands of the same dataset). Perhaps Delfim has some
>> comments?
>>
>> Even
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> Alessandro Amici <a.amici at bopen.eu>
> CTO at B-Open Solutions - http://www.bopen.eu/
> Viale Palmiro Togliatti, 1639 - 00155 Roma - tel: +39 06 8370 8269

From a.amici at bopen.eu  Sat May 14 02:28:19 2016
From: a.amici at bopen.eu (Alessandro Amici)
Date: Sat, 14 May 2016 09:28:19 +0000
Subject: [gdal-dev] Potential issue with Sentinel-1 SAFE driver
In-Reply-To: <CANCQK9MEnU+HegicZjhvVKFGqTXbbPcVkA68VZWdbUwBxiwKGA@mail.gmail.com>
References: <5735D3AD.1000309@cnes.fr>
 <201605131554.19079.even.rouault@spatialys.com>
 <CAF0=-Teq8PiPHmgozvp3hdj2wihyxvSZkP+52vMRsvTNEDJg_w@mail.gmail.com>
 <CANCQK9MEnU+HegicZjhvVKFGqTXbbPcVkA68VZWdbUwBxiwKGA@mail.gmail.com>
Message-ID: <CAF0=-Tdu3PSTEcsu3ZstFw-o9zbgb=JeVhVGzo9xuvuh8G9mqw@mail.gmail.com>

Delfim,

as I've been mostly lurking gdal-dev up to now, first a brief intro of
myself: I'm a long time GDAL user, I contribute a bit to it and even had
commit access back in 2003/2004. I've been involved in writing a driver for
Sentinel-1 SLC data for a customer first and then reimplemented a subset of
the functionalities for an internal project, so I have some hands on
experience.

On Sat, 14 May 2016 at 10:40 Delfim Rego <delfimrego at gmail.com> wrote:

> The driver was tested only with GRD products. That's why it behaves so
> badly with SLC.
>

Yep! If you didn't tackle SLC imagery yet, do not underestimate how weird
and badly documented it is!

Points to take into account:

1. a lot of metadata are different for different subswaths, they even have
different sizes typically. Recomposing different subswaths into a single
image will make working with metadata a mess, just think of the GCP! I
strongly suggest treating subswatshs as subdatasets in GDAL.

2. polarizations within a subswath on the other hand share all metadata and
image structure, I don't see why they should not be treated as bands. This
is what we did for our customer, but this could be a matter of taste though.

3. the internal structure of the single SLC subswath is where the real mess
starts. The tiff in the measurement folder are not actual images, but are a
container of tiles with black borders separating them. In the metadata
there are all the information on how to cut the non overlapping tiles and
how to rebuild them into a standard subswath image. Furthermore some
metadata, like the GCP info are given in a weird and barely documented
format. I don't know all the details as a colleague worked on that, but I
think you need to process the GCP line/sample numbers for the recomposed
image.

Let's look at the possible solutions and I would like your comments:
>
> Option 1) the driver provides polarizations as bands also on SLC products.
> In this case, each band would represent a polarization and would aggregate
> and reconstruct all swaths based on the GCPs. The reconstruction would need
> some processing, and prevents the user to use a single swath.
>
>
I'm strongly against that, it is a lot of work and representing the
metadata will be inevitably a mess.


> Option 2) the driver provides all measurements as subdatasets. In Julien
> example it would create 6 subdatasets, one for each polarisation and swath.
> This option would add flexibility to the user, since it would be possible
> to select individual swaths.
>

This would not be my preferred option as a user, but close enough.

Option 3) Using both. When no subdatasets are selected, the driver provides
> an assembled dataset  (each band representing a polarization). However, the
> user could also select each individual measurement as subdatasets.
>

IMO no, same as option 1.

Option 4: subswaths are different subdatasets each with polarizations as
bands.

This is my preferred approach and we have implemented it in practice twice
(outside of GDAL).

Hope this helps,
Alessandro

-- 
Alessandro Amici <a.amici at bopen.eu>
CTO at B-Open Solutions - http://www.bopen.eu/
Viale Palmiro Togliatti, 1639 - 00155 Roma - tel: +39 06 8370 8269
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160514/14b088e6/attachment.html>

From delfimrego at gmail.com  Sun May 15 05:43:21 2016
From: delfimrego at gmail.com (Delfim Rego)
Date: Sun, 15 May 2016 12:43:21 +0000
Subject: [gdal-dev] Potential issue with Sentinel-1 SAFE driver
In-Reply-To: <CAF0=-Tdu3PSTEcsu3ZstFw-o9zbgb=JeVhVGzo9xuvuh8G9mqw@mail.gmail.com>
References: <5735D3AD.1000309@cnes.fr>
 <201605131554.19079.even.rouault@spatialys.com>
 <CAF0=-Teq8PiPHmgozvp3hdj2wihyxvSZkP+52vMRsvTNEDJg_w@mail.gmail.com>
 <CANCQK9MEnU+HegicZjhvVKFGqTXbbPcVkA68VZWdbUwBxiwKGA@mail.gmail.com>
 <CAF0=-Tdu3PSTEcsu3ZstFw-o9zbgb=JeVhVGzo9xuvuh8G9mqw@mail.gmail.com>
Message-ID: <CANCQK9P2k=nwOxCO=fY36XXMiH=0WLCgVmLk10J7NzKeRCFG=A@mail.gmail.com>

Hi Alessandro,

Thank you for your comments.

I also use SLC products for running detection algorithms, but for that
I just access xml metadata and measurement data directly using the
GTiff driver.

Nevertheless, the SAFE driver should open all product types for as
most usecases as possible, either to perform a simple gdalwarp or to
read the data and execute an algorithm.

With that in mind, this is my idea for the subdataset acess:

$ gdalinfo S1A_PROD.SAFE
...
Subdatasets:
  SUBDATASET_1_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW1:VH
  SUBDATASET_2_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW2:VV
  SUBDATASET_3_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW3:VH
  SUBDATASET_4_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW4:VV
  SUBDATASET_5_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW5:VH
  SUBDATASET_6_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW1:VV
  SUBDATASET_7_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW2:VH
  SUBDATASET_8_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW3:VV
  SUBDATASET_9_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW4:VH
  SUBDATASET_10_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW5:VV
Band 1 Block=256x16 Type=CInt16, ColorInterp=Undefined
  Metadata:
    POLARISATION=VH
    SWATH=EW1
Band 2 Block=256x16 Type=CInt16, ColorInterp=Undefined
  Metadata:
    POLARISATION=VV
    SWATH=EW1

$ gdalinfo SENTINEL1_DS:S1A_PROD.SAFE:EW3:VV
...
Band 1 Block=256x16 Type=CInt16, ColorInterp=Undefined
  Metadata:
    POLARISATION=VV
    SWATH=EW3

$ gdalinfo SENTINEL1_DS:S1A_PROD.SAFE:EW3
...
Band 1 Block=256x16 Type=CInt16, ColorInterp=Undefined
  Metadata:
    POLARISATION=VH
    SWATH=EW3
Band 2 Block=256x16 Type=CInt16, ColorInterp=Undefined
  Metadata:
    POLARISATION=VV
    SWATH=EW3


Cheers,
Delfim



On Sat, May 14, 2016 at 9:28 AM, Alessandro Amici <a.amici at bopen.eu> wrote:
> Delfim,
>
> as I've been mostly lurking gdal-dev up to now, first a brief intro of
> myself: I'm a long time GDAL user, I contribute a bit to it and even had
> commit access back in 2003/2004. I've been involved in writing a driver for
> Sentinel-1 SLC data for a customer first and then reimplemented a subset of
> the functionalities for an internal project, so I have some hands on
> experience.
>
> On Sat, 14 May 2016 at 10:40 Delfim Rego <delfimrego at gmail.com> wrote:
>>
>> The driver was tested only with GRD products. That's why it behaves so
>> badly with SLC.
>
>
> Yep! If you didn't tackle SLC imagery yet, do not underestimate how weird
> and badly documented it is!
>
> Points to take into account:
>
> 1. a lot of metadata are different for different subswaths, they even have
> different sizes typically. Recomposing different subswaths into a single
> image will make working with metadata a mess, just think of the GCP! I
> strongly suggest treating subswatshs as subdatasets in GDAL.
>
> 2. polarizations within a subswath on the other hand share all metadata and
> image structure, I don't see why they should not be treated as bands. This
> is what we did for our customer, but this could be a matter of taste though.
>
> 3. the internal structure of the single SLC subswath is where the real mess
> starts. The tiff in the measurement folder are not actual images, but are a
> container of tiles with black borders separating them. In the metadata there
> are all the information on how to cut the non overlapping tiles and how to
> rebuild them into a standard subswath image. Furthermore some metadata, like
> the GCP info are given in a weird and barely documented format. I don't know
> all the details as a colleague worked on that, but I think you need to
> process the GCP line/sample numbers for the recomposed image.
>
>> Let's look at the possible solutions and I would like your comments:
>>
>> Option 1) the driver provides polarizations as bands also on SLC products.
>> In this case, each band would represent a polarization and would aggregate
>> and reconstruct all swaths based on the GCPs. The reconstruction would need
>> some processing, and prevents the user to use a single swath.
>>
>
> I'm strongly against that, it is a lot of work and representing the metadata
> will be inevitably a mess.
>
>>
>> Option 2) the driver provides all measurements as subdatasets. In Julien
>> example it would create 6 subdatasets, one for each polarisation and swath.
>> This option would add flexibility to the user, since it would be possible to
>> select individual swaths.
>
>
> This would not be my preferred option as a user, but close enough.
>
>> Option 3) Using both. When no subdatasets are selected, the driver
>> provides an assembled dataset  (each band representing a polarization).
>> However, the user could also select each individual measurement as
>> subdatasets.
>
>
> IMO no, same as option 1.
>
> Option 4: subswaths are different subdatasets each with polarizations as
> bands.
>
> This is my preferred approach and we have implemented it in practice twice
> (outside of GDAL).
>
> Hope this helps,
> Alessandro
>
> --
> Alessandro Amici <a.amici at bopen.eu>
> CTO at B-Open Solutions - http://www.bopen.eu/
> Viale Palmiro Togliatti, 1639 - 00155 Roma - tel: +39 06 8370 8269

From delfimrego at gmail.com  Sun May 15 05:58:44 2016
From: delfimrego at gmail.com (Delfim Rego)
Date: Sun, 15 May 2016 12:58:44 +0000
Subject: [gdal-dev] Potential issue with Sentinel-1 SAFE driver
In-Reply-To: <CANCQK9P2k=nwOxCO=fY36XXMiH=0WLCgVmLk10J7NzKeRCFG=A@mail.gmail.com>
References: <5735D3AD.1000309@cnes.fr>
 <201605131554.19079.even.rouault@spatialys.com>
 <CAF0=-Teq8PiPHmgozvp3hdj2wihyxvSZkP+52vMRsvTNEDJg_w@mail.gmail.com>
 <CANCQK9MEnU+HegicZjhvVKFGqTXbbPcVkA68VZWdbUwBxiwKGA@mail.gmail.com>
 <CAF0=-Tdu3PSTEcsu3ZstFw-o9zbgb=JeVhVGzo9xuvuh8G9mqw@mail.gmail.com>
 <CANCQK9P2k=nwOxCO=fY36XXMiH=0WLCgVmLk10J7NzKeRCFG=A@mail.gmail.com>
Message-ID: <CANCQK9Omm_hn5KcHR_KBR-3dhAWVG+o4Y=iodLG4C=q0NoPjdw@mail.gmail.com>

https://trac.osgeo.org/gdal/ticket/6514

On Sun, May 15, 2016 at 12:43 PM, Delfim Rego <delfimrego at gmail.com> wrote:
> Hi Alessandro,
>
> Thank you for your comments.
>
> I also use SLC products for running detection algorithms, but for that
> I just access xml metadata and measurement data directly using the
> GTiff driver.
>
> Nevertheless, the SAFE driver should open all product types for as
> most usecases as possible, either to perform a simple gdalwarp or to
> read the data and execute an algorithm.
>
> With that in mind, this is my idea for the subdataset acess:
>
> $ gdalinfo S1A_PROD.SAFE
> ...
> Subdatasets:
>   SUBDATASET_1_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW1:VH
>   SUBDATASET_2_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW2:VV
>   SUBDATASET_3_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW3:VH
>   SUBDATASET_4_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW4:VV
>   SUBDATASET_5_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW5:VH
>   SUBDATASET_6_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW1:VV
>   SUBDATASET_7_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW2:VH
>   SUBDATASET_8_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW3:VV
>   SUBDATASET_9_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW4:VH
>   SUBDATASET_10_NAME=SENTINEL1_DS:S1A_PROD.SAFE:EW5:VV
> Band 1 Block=256x16 Type=CInt16, ColorInterp=Undefined
>   Metadata:
>     POLARISATION=VH
>     SWATH=EW1
> Band 2 Block=256x16 Type=CInt16, ColorInterp=Undefined
>   Metadata:
>     POLARISATION=VV
>     SWATH=EW1
>
> $ gdalinfo SENTINEL1_DS:S1A_PROD.SAFE:EW3:VV
> ...
> Band 1 Block=256x16 Type=CInt16, ColorInterp=Undefined
>   Metadata:
>     POLARISATION=VV
>     SWATH=EW3
>
> $ gdalinfo SENTINEL1_DS:S1A_PROD.SAFE:EW3
> ...
> Band 1 Block=256x16 Type=CInt16, ColorInterp=Undefined
>   Metadata:
>     POLARISATION=VH
>     SWATH=EW3
> Band 2 Block=256x16 Type=CInt16, ColorInterp=Undefined
>   Metadata:
>     POLARISATION=VV
>     SWATH=EW3
>
>
> Cheers,
> Delfim
>
>
>
> On Sat, May 14, 2016 at 9:28 AM, Alessandro Amici <a.amici at bopen.eu> wrote:
>> Delfim,
>>
>> as I've been mostly lurking gdal-dev up to now, first a brief intro of
>> myself: I'm a long time GDAL user, I contribute a bit to it and even had
>> commit access back in 2003/2004. I've been involved in writing a driver for
>> Sentinel-1 SLC data for a customer first and then reimplemented a subset of
>> the functionalities for an internal project, so I have some hands on
>> experience.
>>
>> On Sat, 14 May 2016 at 10:40 Delfim Rego <delfimrego at gmail.com> wrote:
>>>
>>> The driver was tested only with GRD products. That's why it behaves so
>>> badly with SLC.
>>
>>
>> Yep! If you didn't tackle SLC imagery yet, do not underestimate how weird
>> and badly documented it is!
>>
>> Points to take into account:
>>
>> 1. a lot of metadata are different for different subswaths, they even have
>> different sizes typically. Recomposing different subswaths into a single
>> image will make working with metadata a mess, just think of the GCP! I
>> strongly suggest treating subswatshs as subdatasets in GDAL.
>>
>> 2. polarizations within a subswath on the other hand share all metadata and
>> image structure, I don't see why they should not be treated as bands. This
>> is what we did for our customer, but this could be a matter of taste though.
>>
>> 3. the internal structure of the single SLC subswath is where the real mess
>> starts. The tiff in the measurement folder are not actual images, but are a
>> container of tiles with black borders separating them. In the metadata there
>> are all the information on how to cut the non overlapping tiles and how to
>> rebuild them into a standard subswath image. Furthermore some metadata, like
>> the GCP info are given in a weird and barely documented format. I don't know
>> all the details as a colleague worked on that, but I think you need to
>> process the GCP line/sample numbers for the recomposed image.
>>
>>> Let's look at the possible solutions and I would like your comments:
>>>
>>> Option 1) the driver provides polarizations as bands also on SLC products.
>>> In this case, each band would represent a polarization and would aggregate
>>> and reconstruct all swaths based on the GCPs. The reconstruction would need
>>> some processing, and prevents the user to use a single swath.
>>>
>>
>> I'm strongly against that, it is a lot of work and representing the metadata
>> will be inevitably a mess.
>>
>>>
>>> Option 2) the driver provides all measurements as subdatasets. In Julien
>>> example it would create 6 subdatasets, one for each polarisation and swath.
>>> This option would add flexibility to the user, since it would be possible to
>>> select individual swaths.
>>
>>
>> This would not be my preferred option as a user, but close enough.
>>
>>> Option 3) Using both. When no subdatasets are selected, the driver
>>> provides an assembled dataset  (each band representing a polarization).
>>> However, the user could also select each individual measurement as
>>> subdatasets.
>>
>>
>> IMO no, same as option 1.
>>
>> Option 4: subswaths are different subdatasets each with polarizations as
>> bands.
>>
>> This is my preferred approach and we have implemented it in practice twice
>> (outside of GDAL).
>>
>> Hope this helps,
>> Alessandro
>>
>> --
>> Alessandro Amici <a.amici at bopen.eu>
>> CTO at B-Open Solutions - http://www.bopen.eu/
>> Viale Palmiro Togliatti, 1639 - 00155 Roma - tel: +39 06 8370 8269

From daniele.romagnoli at geo-solutions.it  Mon May 16 05:56:12 2016
From: daniele.romagnoli at geo-solutions.it (Daniele Romagnoli)
Date: Mon, 16 May 2016 14:56:12 +0200
Subject: [gdal-dev] Request for clarification on SPARSE_OK=TRUE and empty
	tiles relation
Message-ID: <CAJaHrDzW1VK=muiQrqDmPTDUQ=-fBpj5AnKz8Ok7+=oUS2XZpA@mail.gmail.com>

Hi list,
I have seen a recent email on that list about filling empty tiles and
SPARSE_OK creation option (titled "Geotiff FillEmptyTiles with no data
value")
I would like to understand a little better how it works.

Suppose I have 2 isolated GeoTiff files of the same datatype, let's say one
covering California and the other covering France.
I do a gdalbuildvrt to mosaic them together and then I convert the VRT to
GeoTiff.
At which level the SPARSE_OK flag and void blocks management are taken into
account?
I was "hoping" that using the SPARSE_OK=TRUE create option when translating
VRT to GeoTiff would have resulted into having an output smaller with
respect to an output generated without that creation option since there is
a wide void area in the middle.
Why I get the same size in both cases? Shouldn't it avoid filling void
blocks in the gap?
Is the VRT Driver iterating on all the tiles involved in the final bounding
box so that it forces a write of each block even if there is no source
dataset for that tile?

Please, let me know.
Best Regards,
Daniele


-- 
==
GeoServer Professional Services from the experts! Visit
http://goo.gl/it488V for more information.
==

Ing. Daniele Romagnoli
Senior Software Engineer

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
Italy
phone: +39 0584 962313
fax:      +39 0584 1660272

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

-------------------------------------------------------

*AVVERTENZE AI SENSI DEL D.Lgs. 196/2003*

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.



The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160516/2a3c769f/attachment.html>

From even.rouault at spatialys.com  Mon May 16 12:24:04 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 16 May 2016 21:24:04 +0200
Subject: [gdal-dev] Request for clarification on SPARSE_OK=TRUE and
	empty tiles relation
In-Reply-To: <CAJaHrDzW1VK=muiQrqDmPTDUQ=-fBpj5AnKz8Ok7+=oUS2XZpA@mail.gmail.com>
References: <CAJaHrDzW1VK=muiQrqDmPTDUQ=-fBpj5AnKz8Ok7+=oUS2XZpA@mail.gmail.com>
Message-ID: <201605162124.05471.even.rouault@spatialys.com>

Daniele,

> I have seen a recent email on that list about filling empty tiles and
> SPARSE_OK creation option (titled "Geotiff FillEmptyTiles with no data
> value")
> I would like to understand a little better how it works.
> 
> Suppose I have 2 isolated GeoTiff files of the same datatype, let's say one
> covering California and the other covering France.
> I do a gdalbuildvrt to mosaic them together and then I convert the VRT to
> GeoTiff.
> At which level the SPARSE_OK flag and void blocks management are taken into
> account?
> I was "hoping" that using the SPARSE_OK=TRUE create option when translating
> VRT to GeoTiff would have resulted into having an output smaller with
> respect to an output generated without that creation option since there is
> a wide void area in the middle.
> Why I get the same size in both cases? 

SPARSE_OK=TRUE has only effect when blocks are not written at all. If a block 
is written with pixels set to zero (or the no data value), it will still be 
flushed to disk. It would make sense to avoid that I guess.

> Shouldn't it avoid filling void
> blocks in the gap?
> Is the VRT Driver iterating on all the tiles involved in the final bounding
> box so that it forces a write of each block even if there is no source
> dataset for that tile?

Actually it is the GeoTIFF driver that iterates over the source dataset. It 
has no knowledge of the fact that the dataset dataset is a VRT and it may have 
sparse zones.

One way to workaround this would be to create an empty sparse target GeoTIFF 
of the appropriate size, and then gdalwarp each input dataset into it (with
-wo SKIP_NOSOURCE=YES)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From christopher.beddow at gmail.com  Mon May 16 17:57:50 2016
From: christopher.beddow at gmail.com (Christopher Beddow)
Date: Mon, 16 May 2016 17:57:50 -0700
Subject: [gdal-dev] GDAL error - ImportFromEPSG
Message-ID: <CADzfi1VGcc-7BLUQLWSbjkUTpVmRrJkfakVUpKfCwtEmJ1kjjw@mail.gmail.com>

Hello!

I'm running Python 2.7.8 [MSC v.1500 32 bit (Intel)] on win32. It is the
package that comes with ArcGIS 10.3. I have the correct GDAL core and
Python bindings installed to match.

I'm having an issue testing ImportFromEPSG() with GDAL.


2
down vote
favorite
I'm currently getting an error when testing ImportFromEPSG() on my GDAL.

    import osr
    testSR = osr.SpatialReference()
    testSR.ImportFromEPSG(4326)
    #this returns value of 6
    print testSR.ExportToPrettyWkt()
    #this returns blank/empty string

I have done:

    'GDAL_DATA' in os.evirons
    #returns TRUE

I also set

    os.environs['GDAL_DATA'] = r'C:\Program Files (x86)\GDAL\gdal-data'

which is where gcs.csv is located.

Any suggestions for fixing this? Could ArcGIS be causing the problems?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160516/de0f5595/attachment.html>

From even.rouault at spatialys.com  Tue May 17 00:41:51 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 17 May 2016 09:41:51 +0200
Subject: [gdal-dev] Fwd: Re: Request for clarification on SPARSE_OK=TRUE and
	empty tiles relation
Message-ID: <201605170941.51728.even.rouault@spatialys.com>

(Forwarding to list)

----------  Message transmis  ----------

Sujet : Re: [gdal-dev] Request for clarification on SPARSE_OK=TRUE and empty 
tiles relation
Date : mardi 17 mai 2016, 07:27:24
De : James Ramm <jamessramm at gmail.com>
À : Even Rouault <even.rouault at spatialys.com>

SPARSE_OK only informs the geotiff driver to skip FillEmptyTiles when
flushing the dataset. Most gdal utilities will explicitly write every block.
It may make sense to have an extra option on gdal_translate and other utils
such as --skip_null_blocks or have the explicitly check for the SPARSE_OK
creation option given that it seems intuitive to expect a sparse file to be
created when specifying SPARSE_OK.


On 16 May 2016 at 20:24, Even Rouault <even.rouault at spatialys.com> wrote:

> Daniele,
>
> > I have seen a recent email on that list about filling empty tiles and
> > SPARSE_OK creation option (titled "Geotiff FillEmptyTiles with no data
> > value")
> > I would like to understand a little better how it works.
> >
> > Suppose I have 2 isolated GeoTiff files of the same datatype, let's say
> one
> > covering California and the other covering France.
> > I do a gdalbuildvrt to mosaic them together and then I convert the VRT to
> > GeoTiff.
> > At which level the SPARSE_OK flag and void blocks management are taken
> into
> > account?
> > I was "hoping" that using the SPARSE_OK=TRUE create option when
> translating
> > VRT to GeoTiff would have resulted into having an output smaller with
> > respect to an output generated without that creation option since there
> is
> > a wide void area in the middle.
> > Why I get the same size in both cases?
>
> SPARSE_OK=TRUE has only effect when blocks are not written at all. If a
> block
> is written with pixels set to zero (or the no data value), it will still be
> flushed to disk. It would make sense to avoid that I guess.
>
> > Shouldn't it avoid filling void
> > blocks in the gap?
> > Is the VRT Driver iterating on all the tiles involved in the final
> bounding
> > box so that it forces a write of each block even if there is no source
> > dataset for that tile?
>
> Actually it is the GeoTIFF driver that iterates over the source dataset. It
> has no knowledge of the fact that the dataset dataset is a VRT and it may
> have
> sparse zones.
>
> One way to workaround this would be to create an empty sparse target
> GeoTIFF
> of the appropriate size, and then gdalwarp each input dataset into it (with
> -wo SKIP_NOSOURCE=YES)
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------------------------------------------------
-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From julien.michel at cnes.fr  Tue May 17 00:50:06 2016
From: julien.michel at cnes.fr (Julien Michel)
Date: Tue, 17 May 2016 09:50:06 +0200
Subject: [gdal-dev] Potential issue with Sentinel-1 SAFE driver
In-Reply-To: <CAF0=-Tdu3PSTEcsu3ZstFw-o9zbgb=JeVhVGzo9xuvuh8G9mqw@mail.gmail.com>
References: <5735D3AD.1000309@cnes.fr>
 <201605131554.19079.even.rouault@spatialys.com>
 <CAF0=-Teq8PiPHmgozvp3hdj2wihyxvSZkP+52vMRsvTNEDJg_w@mail.gmail.com>
 <CANCQK9MEnU+HegicZjhvVKFGqTXbbPcVkA68VZWdbUwBxiwKGA@mail.gmail.com>
 <CAF0=-Tdu3PSTEcsu3ZstFw-o9zbgb=JeVhVGzo9xuvuh8G9mqw@mail.gmail.com>
Message-ID: <573ACD2E.5050201@cnes.fr>

Le 14/05/2016 11:28, Alessandro Amici a écrit :
> the internal structure of the single SLC subswath is where the real 
> mess starts. The tiff in the measurement folder are not actual images, 
> but are a container of tiles with black borders separating them. In 
> the metadata there are all the information on how to cut the non 
> overlapping tiles and how to rebuild them into a standard subswath 
> image. Furthermore some metadata, like the GCP info are given in a 
> weird and barely documented format. I don't know all the details as a 
> colleague worked on that, but I think you need to process the GCP 
> line/sample numbers for the recomposed image.

Thanks a lot for all those comments. I just want to give my opinion on 
the SLC products with bursts (not all the acquisition modes produce this 
I think). In such products, you have black separator lines (and it is 
quite funny to note that GCPs from metadata actually fall within those 
lines !) and acquisition time overlap between bursts. IMHO, how to deal 
with those product is the advanced SAR user problem, and gdal should not 
do anything about it. Trying to workaround the problem could even 
prevent users from doing things with those data : for instance, in the 
overlap area you have two independent measurements of the backscatter 
for the corresponding cell, which is surely an interesting information 
to use.

Julien

-- 
Julien MICHEL
CNES - DCT/SI/AP

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160517/ac31a897/attachment.html>

From gane.prog at gmail.com  Tue May 17 08:08:32 2016
From: gane.prog at gmail.com (Gane R)
Date: Tue, 17 May 2016 20:38:32 +0530
Subject: [gdal-dev] Creating a GeoPackage with multiple tile raster source
	in gdal 2.1.0
Message-ID: <CALMrLdDCWoFbNVyfGDsEFfvmWXmQj3mmpt04mNtExcydzRjnFA@mail.gmail.com>

Hi all,

I am using a pre-build version of gdal 2.1.0. I am able to create GeoTIFF
to GeoPackage using gdal_translate.

I see from the Geopackage specification I understand that Geopackage can
have multiple tile sources, If so

Q1: How to I add a tilesource to an exisiting geopackage from a GeoTIFF ?
any command line or any workflow sequence will be of great help.

Q2: If a geopackage has multiple Geopackage tile raster, If I wish to
convert any one to a geotiff how will I do ? Should I used OGR Select layer
or how ??

Thanks
Gane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160517/e8298945/attachment.html>

From even.rouault at spatialys.com  Tue May 17 08:19:12 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 17 May 2016 17:19:12 +0200
Subject: [gdal-dev] Creating a GeoPackage with multiple tile raster
	source in gdal 2.1.0
In-Reply-To: <CALMrLdDCWoFbNVyfGDsEFfvmWXmQj3mmpt04mNtExcydzRjnFA@mail.gmail.com>
References: <CALMrLdDCWoFbNVyfGDsEFfvmWXmQj3mmpt04mNtExcydzRjnFA@mail.gmail.com>
Message-ID: <201605171719.12750.even.rouault@spatialys.com>

Le mardi 17 mai 2016 17:08:32, Gane R a écrit :
> Hi all,
> 
> I am using a pre-build version of gdal 2.1.0. I am able to create GeoTIFF
> to GeoPackage using gdal_translate.
> 
> I see from the Geopackage specification I understand that Geopackage can
> have multiple tile sources, If so
> 
> Q1: How to I add a tilesource to an exisiting geopackage from a GeoTIFF ?
> any command line or any workflow sequence will be of great help.

This is documented at http://gdal.org/drv_geopackage_raster.html . See APPEND_SUBDATASET=YES creation option,
possibly combined with RASTER_TABLE.

$ gdal_translate byte1.tif out.gpkg -of GPKG -co RASTER_TABLE=table1
Input file size is 20, 20
0...10...20...30...40...50...60...70...80...90...100 - done.

$ gdal_translate byte2.tif out.gpkg -of GPKG -co APPEND_SUBDATASET=YES -co RASTER_TABLE=table2
Input file size is 20, 20
0...10...20...30...40...50...60...70...80...90...100 - done.

> 
> Q2: If a geopackage has multiple Geopackage tile raster, If I wish to
> convert any one to a geotiff how will I do ? Should I used OGR Select layer
> or how ??

$ gdalinfo out.gpkg
Driver: GPKG/GeoPackage
Files: out.gpkg
Size is 512, 512
Coordinate System is `'
Subdatasets:
  SUBDATASET_1_NAME=GPKG:out.gpkg:table1
  SUBDATASET_1_DESC=table1 - table1
  SUBDATASET_2_NAME=GPKG:out.gpkg:table2
  SUBDATASET_2_DESC=table2 - table2
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  512.0)
Upper Right (  512.0,    0.0)
Lower Right (  512.0,  512.0)
Center      (  256.0,  256.0)

$ gdal_translate GPKG:out.gpkg:table1 table1.tif
Input file size is 20, 20
0...10...20...30...40...50...60...70...80...90...100 - done.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From William.Kelly.Magee at leidos.com  Tue May 17 14:57:06 2016
From: William.Kelly.Magee at leidos.com (William Kelly Magee)
Date: Tue, 17 May 2016 17:57:06 -0400
Subject: [gdal-dev] Configuring GDAL 1.11.1 to use GEOS
Message-ID: <573B93B2.3020202@leidos.com>

Hello

I am trying to build GDAL with GEOS support on RHEL 6 (64-bit) and am 
getting nowhere fast!

I've been using the OGR api from gdal-1.11.1 for over a year with 
excellent results and now need to use the geometry methods that are only 
available with the inclusion of GEOS (else the message ERROR 6: GEOS 
support not enabled").

I've built geos-3.1.0 and the set the GDAL configure option 
"--with-geos" to point to "geos-config".  Initially this did not work as 
gdal configure was attempting to execute "geos-config" which did not 
have execute permission (doing a chmod 777 on "geos-config" resolved this).

GDAL builds fine and appears to partially recognize GEOS availability 
but cannot confirm "GEOSversion" in geos_c.  The following two lines are 
output from gdal configure;

         checking for GEOS version >= 3.1.0... yes
         checking for GEOSversion in -lgeos_c... no

At this point it looked like a search issue so I've updated the PATH and 
LIBRARY_PATH env vars to point to the geos "capri" directory containing 
"libgeos_c.la".  Still no luck.  Have tried copying libgeos_c.la to the 
gdal folder and /usr/local/lib but still no luck.

Going through the list I see where others have run across similar but 
not the same problem.

Does anyone have any suggestions on how to resolve this?

Thanks,

Kelly
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160517/479e04f7/attachment.html>

From ari.jolma at gmail.com  Tue May 17 23:03:01 2016
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 18 May 2016 09:03:01 +0300
Subject: [gdal-dev] Configuring GDAL 1.11.1 to use GEOS
In-Reply-To: <573B93B2.3020202@leidos.com>
References: <573B93B2.3020202@leidos.com>
Message-ID: <573C0595.4000100@gmail.com>

18.05.2016, 00:57, William Kelly Magee kirjoitti:
> Hello
>
> I am trying to build GDAL with GEOS support on RHEL 6 (64-bit) and am 
> getting nowhere fast!
>
> I've been using the OGR api from gdal-1.11.1 for over a year with 
> excellent results and now need to use the geometry methods that are 
> only available with the inclusion of GEOS (else the message ERROR 6: 
> GEOS support not enabled").
>
> I've built geos-3.1.0 and the set the GDAL configure option 
> "--with-geos" to point to "geos-config".  Initially this did not work 
> as gdal configure was attempting to execute "geos-config" which did 
> not have execute permission (doing a chmod 777 on "geos-config" 
> resolved this).
>
> GDAL builds fine and appears to partially recognize GEOS availability 
> but cannot confirm "GEOSversion" in geos_c.  The following two lines 
> are output from gdal configure;
>
>         checking for GEOS version >= 3.1.0... yes
>         checking for GEOSversion in -lgeos_c... no
>
> At this point it looked like a search issue so I've updated the PATH 
> and LIBRARY_PATH env vars to point to the geos "capri" directory 
> containing "libgeos_c.la".  Still no luck.  Have tried copying 
> libgeos_c.la to the gdal folder and /usr/local/lib but still no luck.
>
> Going through the list I see where others have run across similar but 
> not the same problem.
>
> Does anyone have any suggestions on how to resolve this?

Kelly,

I've never come across problems like this with GEOS and GDAL. If GEOS is 
in usual place (/usr/local/lib for example) GDAL configure picks it up 
by default.

It sounds a bit like you did not install GEOS. Did you issue "make 
install" after building GEOS?

Ari

>
> Thanks,
>
> Kelly
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160518/eb293ee5/attachment.html>

From nicolara at ethz.ch  Wed May 18 05:06:08 2016
From: nicolara at ethz.ch (Raluca)
Date: Wed, 18 May 2016 05:06:08 -0700 (PDT)
Subject: [gdal-dev] ogr geojson columns that start with null converted to
	string
Message-ID: <1463573168233-5266960.post@n6.nabble.com>

Hi,

At the moment the geojson reader automatically converts an attribute where
the first feature is null to string. Is it possible to check values also
from the next features and based on that to set the type of the column?

For example for the following geojson the type of int_prop2 and dbl_prop1
will be string:

{
    "features": [
        {
            "geometry": {
                "coordinates": [ 1.0, 0.0 ],
                "type": "Point"
            },
            "properties": {
                "name": "point2",
                "int_prop1": 2,
                "int_prop2": null,
                "dbl_prop1": 2.1,
                "dbl_prop2": null
            },
            "type": "Feature"
        },
        {
            "geometry": {
                "coordinates": [ 0.0, 0.0 ],
                "type": "Point"
            },
            "properties": {
                "name": "point1",
                "int_prop1": 1,
                "int_prop2": 1,
                "dbl_prop1": 1.1,
                "dbl_prop2": 1.1
            },
            "type": "Feature"
        }
    ],
    "type": "FeatureCollection"
}

Result in the console when using ogrinfo with gdal version 2.1.0, released
2016/04/25: 

name: String (0.0)
int_prop1: Integer (0.0)
int_prop2: String (0.0)
dbl_prop1: Real (0.0)
dbl_prop2: String (0.0)
OGRFeature(OGRGeoJSON):0
  name (String) = point2
  int_prop1 (Integer) = 2
  int_prop2 (String) = (null)
  dbl_prop1 (Real) = 2.1
  dbl_prop2 (String) = (null)
  POINT (1 0)

OGRFeature(OGRGeoJSON):1
  name (String) = point1
  int_prop1 (Integer) = 1
  int_prop2 (String) = 1
  dbl_prop1 (Real) = 1.1
  dbl_prop2 (String) = 1.1000
  POINT (0 0)



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr-geojson-columns-that-start-with-null-converted-to-string-tp5266960.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Wed May 18 06:28:03 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 18 May 2016 15:28:03 +0200
Subject: [gdal-dev] ogr geojson columns that start with null converted
	to string
In-Reply-To: <1463573168233-5266960.post@n6.nabble.com>
References: <1463573168233-5266960.post@n6.nabble.com>
Message-ID: <201605181528.03590.even.rouault@spatialys.com>

Le mercredi 18 mai 2016 14:06:08, Raluca a écrit :
> Hi,
> 
> At the moment the geojson reader automatically converts an attribute where
> the first feature is null to string. Is it possible to check values also
> from the next features and based on that to set the type of the column?
> 
Hi,

I've just fixed it per https://trac.osgeo.org/gdal/ticket/6517

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From nicolara at ethz.ch  Wed May 18 06:19:13 2016
From: nicolara at ethz.ch (Raluca)
Date: Wed, 18 May 2016 06:19:13 -0700 (PDT)
Subject: [gdal-dev] ogr geojson columns that start with null converted
	to string
In-Reply-To: <201605181528.03590.even.rouault@spatialys.com>
References: <1463573168233-5266960.post@n6.nabble.com>
 <201605181528.03590.even.rouault@spatialys.com>
Message-ID: <1463577553421-5266978.post@n6.nabble.com>

wow, great, thank you!



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/ogr-geojson-columns-that-start-with-null-converted-to-string-tp5266960p5266978.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From frank.broniewski at gmail.com  Wed May 18 07:50:03 2016
From: frank.broniewski at gmail.com (Frank Broniewski)
Date: Wed, 18 May 2016 16:50:03 +0200
Subject: [gdal-dev] GeoPDF
Message-ID: <573C811B.8000801@gmail.com>

Hi,

I want to turn my QGIS map composer PDF into a GeoPDF or a geospatial 
PDF. Unfortunately that is not supported, just on a per layer basis from 
within the main program. I could export my map to TIFF with a world file 
and use GDAL on that, but I'd like to maintain the vectors and text in 
the output.
Since GDAL supports the creation of GeoPDF, I'd like to ask if there is 
some kind of documentation on the web where the standard is described of 
if someone knows an OpenSource library which supports the creation of 
GeoPDF.
I thought of writing a, preferable in Python, program which would add 
the necessary tags and data to the PDF in order to turn it into a 
GeoPDF. But I am already stuck at the beginning, because I simply cannot 
find a good standard documentation. What does GDAL do to turn a raster 
file into a GeoPDF? I guess I could read the source, but I have no clue 
on the C-language so I thought I ask here beforehand.

Thanks,

Frank

-- 
Waldhölzbacher Str. 51
66679 Losheim am See

(+49) 0177 30 21 791


From even.rouault at spatialys.com  Wed May 18 08:10:16 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 18 May 2016 17:10:16 +0200
Subject: [gdal-dev] GeoPDF
In-Reply-To: <573C811B.8000801@gmail.com>
References: <573C811B.8000801@gmail.com>
Message-ID: <201605181710.16862.even.rouault@spatialys.com>

Le mercredi 18 mai 2016 16:50:03, Frank Broniewski a écrit :
> Hi,
> 
> I want to turn my QGIS map composer PDF into a GeoPDF or a geospatial
> PDF. Unfortunately that is not supported, just on a per layer basis from
> within the main program. I could export my map to TIFF with a world file
> and use GDAL on that, but I'd like to maintain the vectors and text in
> the output.
> Since GDAL supports the creation of GeoPDF, I'd like to ask if there is
> some kind of documentation on the web where the standard is described

Sure. There are 2 specifications mentionned in http://gdal.org/frmt_pdf.html :
- Adobe Supplement to ISO 32000: 
http://www.adobe.com/devnet/acrobat/pdfs/adobe_supplement_iso32000.pdf
- OGC GeoPDF Encoding Best Practice Version 2.2 (08-139r3) :
http://portal.opengeospatial.org/files/?artifact_id=40537
But I doubt you'll enjoy their reading (especially the ISO 32000 one). In 
practice the support has been developed by dumping existing files.

> of
> if someone knows an OpenSource library which supports the creation of
> GeoPDF.
> I thought of writing a, preferable in Python, program which would add
> the necessary tags and data to the PDF in order to turn it into a
> GeoPDF.

The GDAL PDF driver supports update of an existing PDF to add georeferencing 
to it. You can do that for example with the -a_ullr and -a_srs flags of the 
gdal_edit.py script. You can also look at the pdf_update_gt() test in 
https://svn.osgeo.org/gdal/trunk/autotest/gdrivers/pdf.py

This is also documented in the "Update of existing files" section of 
http://gdal.org/frmt_pdf.html

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From lucadeluge at gmail.com  Wed May 18 08:17:16 2016
From: lucadeluge at gmail.com (Luca Delucchi)
Date: Wed, 18 May 2016 17:17:16 +0200
Subject: [gdal-dev] GeoPDF
In-Reply-To: <573C811B.8000801@gmail.com>
References: <573C811B.8000801@gmail.com>
Message-ID: <CAK4m-3yitnFETi=hO65-pVHGG6TYgLS2Y3JXAMiQfRSe5ksb7w@mail.gmail.com>

On 18 May 2016 at 16:50, Frank Broniewski <frank.broniewski at gmail.com> wrote:
> Hi,
>

Hi,

> I want to turn my QGIS map composer PDF into a GeoPDF or a geospatial PDF.

I developed a plugin for QGIS to export layers (vector and raster) to
geospatial PDF using GDAL library.
I'm waiting the authorization from the customer to publish it in the
plugin repository.

>
> Thanks,
>
> Frank
>

-- 
ciao
Luca

www.lucadelu.org

From frank.broniewski at gmail.com  Wed May 18 09:26:00 2016
From: frank.broniewski at gmail.com (Frank Broniewski)
Date: Wed, 18 May 2016 18:26:00 +0200
Subject: [gdal-dev] GeoPDF
In-Reply-To: <201605181710.16862.even.rouault@spatialys.com>
References: <573C811B.8000801@gmail.com>
 <201605181710.16862.even.rouault@spatialys.com>
Message-ID: <573C9798.9020504@gmail.com>

Hi Even,

Am 18.05.2016 um 17:10 schrieb Even Rouault:
> Sure. There are 2 specifications mentionned in http://gdal.org/frmt_pdf.html :
> - Adobe Supplement to ISO 32000:
> http://www.adobe.com/devnet/acrobat/pdfs/adobe_supplement_iso32000.pdf
> - OGC GeoPDF Encoding Best Practice Version 2.2 (08-139r3) :
> http://portal.opengeospatial.org/files/?artifact_id=40537
> But I doubt you'll enjoy their reading (especially the ISO 32000 one). In
> practice the support has been developed by dumping existing files.

Yeah, I've looked at them before and thought of something more easily 
readable - but I will give them a second look anyway.

> The GDAL PDF driver supports update of an existing PDF to add 
> georeferencing to it. You can do that for example with the -a_ullr and 
> -a_srs flags of the gdal_edit.py script. You can also look at the 
> pdf_update_gt() test in 
> https://svn.osgeo.org/gdal/trunk/autotest/gdrivers/pdf.py This is also 
> documented in the "Update of existing files" section of 
> http://gdal.org/frmt_pdf.html 
Cool, thanks for the links!

Frank

From frank.broniewski at gmail.com  Wed May 18 09:30:42 2016
From: frank.broniewski at gmail.com (Frank Broniewski)
Date: Wed, 18 May 2016 18:30:42 +0200
Subject: [gdal-dev] GeoPDF
In-Reply-To: <CAK4m-3yitnFETi=hO65-pVHGG6TYgLS2Y3JXAMiQfRSe5ksb7w@mail.gmail.com>
References: <573C811B.8000801@gmail.com>
 <CAK4m-3yitnFETi=hO65-pVHGG6TYgLS2Y3JXAMiQfRSe5ksb7w@mail.gmail.com>
Message-ID: <573C98B2.8070206@gmail.com>

Hi Luca,
> I developed a plugin for QGIS to export layers (vector and raster) to
> geospatial PDF using GDAL library.
> I'm waiting the authorization from the customer to publish it in the
> plugin repository.
this sounds interesting. But your plugin cannot save a map composition 
with legend, neatline and all the other "carto things", can it? That's 
what I am after in the end. But if you have some docs or other info to 
share, I will gladly accept any help ;-)

Frank

From even.rouault at spatialys.com  Wed May 18 09:51:13 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 18 May 2016 18:51:13 +0200
Subject: [gdal-dev] Please check your trac settings for email notifications
Message-ID: <201605181851.13952.even.rouault@spatialys.com>

Hi,

It seems there's currently an issue with email notifications. At least I got 
the issue with my account with my email being wiped up from
http://trac.osgeo.org/gdal/prefs

You might want to check yours and update if needed (but from 
https://trac.osgeo.org/osgeo/ticket/1671 it seems it might end up being wiped 
up after a while, so double check with the activity at 
https://trac.osgeo.org/gdal/timeline )

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From William.Kelly.Magee at leidos.com  Wed May 18 14:23:00 2016
From: William.Kelly.Magee at leidos.com (William Kelly Magee)
Date: Wed, 18 May 2016 17:23:00 -0400
Subject: [gdal-dev] Configuring GDAL 1.11.1 to use GEOS
In-Reply-To: <573C0595.4000100@gmail.com>
References: <573B93B2.3020202@leidos.com> <573C0595.4000100@gmail.com>
Message-ID: <573CDD34.5060707@leidos.com>

Ari,

Thank you for the response.

Correct, I had not run "make install" on GEOS.  Since I am building GDAL 
without installing, I wanted to build GEOS the same.  This evidently 
results in GDAL not finding GEOS.  Running "make install" on GEOS, prior 
to building GDAL, correctly identifies GEOS support (confirmed GDAL 
configure output).

I am running into a second issue and not sure if anyone on the list has 
ever attempted this.  I am static linking libgdal.a to my app (no 
problem here) and am having difficulty static linking libgeos_c.a and 
libgeos.a.  I've tried copying the .a files to the working dir and have 
also tried using those in /usr/local/lib (put there by make install).  
Still get unresolved references.

I am assuming it is possible since static libraries for GEOS are 
created.  Do you know of any problems static linking?

Once again thanks!

- Kelly




On 05/18/2016 02:03 AM, Ari Jolma wrote:
> 18.05.2016, 00:57, William Kelly Magee kirjoitti:
>> Hello
>>
>> I am trying to build GDAL with GEOS support on RHEL 6 (64-bit) and am 
>> getting nowhere fast!
>>
>> I've been using the OGR api from gdal-1.11.1 for over a year with 
>> excellent results and now need to use the geometry methods that are 
>> only available with the inclusion of GEOS (else the message ERROR 6: 
>> GEOS support not enabled").
>>
>> I've built geos-3.1.0 and the set the GDAL configure option 
>> "--with-geos" to point to "geos-config".  Initially this did not work 
>> as gdal configure was attempting to execute "geos-config" which did 
>> not have execute permission (doing a chmod 777 on "geos-config" 
>> resolved this).
>>
>> GDAL builds fine and appears to partially recognize GEOS availability 
>> but cannot confirm "GEOSversion" in geos_c.  The following two lines 
>> are output from gdal configure;
>>
>>         checking for GEOS version >= 3.1.0... yes
>>         checking for GEOSversion in -lgeos_c... no
>>
>> At this point it looked like a search issue so I've updated the PATH 
>> and LIBRARY_PATH env vars to point to the geos "capri" directory 
>> containing "libgeos_c.la".  Still no luck.  Have tried copying 
>> libgeos_c.la to the gdal folder and /usr/local/lib but still no luck.
>>
>> Going through the list I see where others have run across similar but 
>> not the same problem.
>>
>> Does anyone have any suggestions on how to resolve this?
>
> Kelly,
>
> I've never come across problems like this with GEOS and GDAL. If GEOS 
> is in usual place (/usr/local/lib for example) GDAL configure picks it 
> up by default.
>
> It sounds a bit like you did not install GEOS. Did you issue "make 
> install" after building GEOS?
>
> Ari
>
>>
>> Thanks,
>>
>> Kelly
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> N�n�r����)em�h�yhiם�w^��


-- 


*William Kelly Magee | Leidos*

*Senior Software Engineer | Maritime Solutions Division*

phone: 401.847.4210
_<mailto:william.kelly.magee at leidos.com>__william.kelly.magee at leidos.com 
<mailto:william.kelly.magee at leidos.com>_ | _leidos.com/natsec 
<http://www.leidos.com/natsec>_


This email and any attachments to it are intended only for the 
identified recipients. It may contain proprietary or otherwise legally 
protect ed information of Leidos. Any unauthorized use or disclosure of 
this communication is strictly prohibited. If you have received this 
communic ation in error, please notify the sender and delete or 
otherwise destroy the email and all attachments immediately.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160518/5feb98c7/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 3947 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160518/5feb98c7/attachment.gif>

From lucadeluge at gmail.com  Wed May 18 23:20:39 2016
From: lucadeluge at gmail.com (Luca Delucchi)
Date: Thu, 19 May 2016 08:20:39 +0200
Subject: [gdal-dev] GeoPDF
In-Reply-To: <573C98B2.8070206@gmail.com>
References: <573C811B.8000801@gmail.com>
 <CAK4m-3yitnFETi=hO65-pVHGG6TYgLS2Y3JXAMiQfRSe5ksb7w@mail.gmail.com>
 <573C98B2.8070206@gmail.com>
Message-ID: <CAK4m-3yHin0UtJTWpn5o0T3PqvYbMQcVs0fg+9hGDmfqR8S5RQ@mail.gmail.com>

On 18 May 2016 at 18:30, Frank Broniewski <frank.broniewski at gmail.com> wrote:
> Hi Luca,

Hi Frank,

>>
>> I developed a plugin for QGIS to export layers (vector and raster) to
>> geospatial PDF using GDAL library.
>> I'm waiting the authorization from the customer to publish it in the
>> plugin repository.
>
> this sounds interesting. But your plugin cannot save a map composition with
> legend, neatline and all the other "carto things", can it? That's what I am
> after in the end. But if you have some docs or other info to share, I will
> gladly accept any help ;-)
>

No, the plugin is not saving the map composition, but you can add
legend and other carto things as extra images.

> Frank

-- 
ciao
Luca

www.lucadelu.org

From gane.prog at gmail.com  Thu May 19 04:24:59 2016
From: gane.prog at gmail.com (Gane R)
Date: Thu, 19 May 2016 16:54:59 +0530
Subject: [gdal-dev] Creating a GeoPackage with multiple tile raster
 source in gdal 2.1.0
In-Reply-To: <201605171719.12750.even.rouault@spatialys.com>
References: <CALMrLdDCWoFbNVyfGDsEFfvmWXmQj3mmpt04mNtExcydzRjnFA@mail.gmail.com>
 <201605171719.12750.even.rouault@spatialys.com>
Message-ID: <CALMrLdB9KW2ruw9Yyq1dWGpGJN6AVKj+uERaWWOXSNhm1NWC2g@mail.gmail.com>

thanks for your reply,

I see the subdatasets name in gdalinfo.

Q1:
However how do I know the name of a tile raster if the GPKG has only one
tile raster source,I want to get the name as in gpkg_contents table.


Gane


On Tue, May 17, 2016 at 8:49 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le mardi 17 mai 2016 17:08:32, Gane R a écrit :
> > Hi all,
> >
> > I am using a pre-build version of gdal 2.1.0. I am able to create GeoTIFF
> > to GeoPackage using gdal_translate.
> >
> > I see from the Geopackage specification I understand that Geopackage can
> > have multiple tile sources, If so
> >
> > Q1: How to I add a tilesource to an exisiting geopackage from a GeoTIFF ?
> > any command line or any workflow sequence will be of great help.
>
> This is documented at http://gdal.org/drv_geopackage_raster.html . See
> APPEND_SUBDATASET=YES creation option,
> possibly combined with RASTER_TABLE.
>
> $ gdal_translate byte1.tif out.gpkg -of GPKG -co RASTER_TABLE=table1
> Input file size is 20, 20
> 0...10...20...30...40...50...60...70...80...90...100 - done.
>
> $ gdal_translate byte2.tif out.gpkg -of GPKG -co APPEND_SUBDATASET=YES -co
> RASTER_TABLE=table2
> Input file size is 20, 20
> 0...10...20...30...40...50...60...70...80...90...100 - done.
>
> >
> > Q2: If a geopackage has multiple Geopackage tile raster, If I wish to
> > convert any one to a geotiff how will I do ? Should I used OGR Select
> layer
> > or how ??
>
> $ gdalinfo out.gpkg
> Driver: GPKG/GeoPackage
> Files: out.gpkg
> Size is 512, 512
> Coordinate System is `'
> Subdatasets:
>   SUBDATASET_1_NAME=GPKG:out.gpkg:table1
>   SUBDATASET_1_DESC=table1 - table1
>   SUBDATASET_2_NAME=GPKG:out.gpkg:table2
>   SUBDATASET_2_DESC=table2 - table2
> Corner Coordinates:
> Upper Left  (    0.0,    0.0)
> Lower Left  (    0.0,  512.0)
> Upper Right (  512.0,    0.0)
> Lower Right (  512.0,  512.0)
> Center      (  256.0,  256.0)
>
> $ gdal_translate GPKG:out.gpkg:table1 table1.tif
> Input file size is 20, 20
> 0...10...20...30...40...50...60...70...80...90...100 - done.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160519/bb7cfe2e/attachment-0001.html>

From nyall.dawson at gmail.com  Thu May 19 05:11:36 2016
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Thu, 19 May 2016 22:11:36 +1000
Subject: [gdal-dev] GeoPDF
In-Reply-To: <201605181710.16862.even.rouault@spatialys.com>
References: <573C811B.8000801@gmail.com>
 <201605181710.16862.even.rouault@spatialys.com>
Message-ID: <CAB28AsirPtMes55E_nONL6SH8C0-FdQweG9h6tOuvR+UsNfhUA@mail.gmail.com>

On 19 May 2016 at 01:10, Even Rouault <even.rouault at spatialys.com> wrote:
> Le mercredi 18 mai 2016 16:50:03, Frank Broniewski a écrit :
>> Hi,
>>
>> I want to turn my QGIS map composer PDF into a GeoPDF or a geospatial
>> PDF. Unfortunately that is not supported, just on a per layer basis from
>> within the main program. I could export my map to TIFF with a world file
>> and use GDAL on that, but I'd like to maintain the vectors and text in
>> the output.
>> Since GDAL supports the creation of GeoPDF, I'd like to ask if there is
>> some kind of documentation on the web where the standard is described

> The GDAL PDF driver supports update of an existing PDF to add georeferencing
> to it. You can do that for example with the -a_ullr and -a_srs flags of the
> gdal_edit.py script. You can also look at the pdf_update_gt() test in
> https://svn.osgeo.org/gdal/trunk/autotest/gdrivers/pdf.py
>
> This is also documented in the "Update of existing files" section of
> http://gdal.org/frmt_pdf.html

Nice - I didn't realise this was possible!... let me see if I've got
time to implement this in QGIS 2.16 during the Girona hackfest next
week.

Nyall

From gane.prog at gmail.com  Thu May 19 07:19:36 2016
From: gane.prog at gmail.com (Gane R)
Date: Thu, 19 May 2016 19:49:36 +0530
Subject: [gdal-dev] Get a List of tiles source name from the gpkg_content
Message-ID: <CALMrLdC2jgvY28BKGz5H7ot=Q_fr7dXFef_G11=Mi-MqDDNryw@mail.gmail.com>

I see the usage of the gdalinfo for the gpkg with multiple tile source as
Subdataset,
I also saw the source code of gdalinfo getting the subdataset





*Q1: Can I get a list of tiles source name (table_name) in gpkg_contents
data_type as tiles?Is there any API call*
*or only by the following code ?*

char **papszSubdatasets = GDALGetMetadata( hDataset, "SUBDATASETS" );
        int nSubdatasets = CSLCount( papszSubdatasets );

char szKeyName[1024];
            char *pszSubdatasetName;

            snprintf( szKeyName, sizeof(szKeyName),
                      "SUBDATASET_%d_NAME", psOptionsForBinary->nSubdataset
);
            szKeyName[sizeof(szKeyName) - 1] = '\0';
            pszSubdatasetName =
                CPLStrdup( CSLFetchNameValue( papszSubdatasets, szKeyName )
);

Thanks
Gane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160519/5ec4d123/attachment.html>

From 191980 at niuitmo.ru  Thu May 19 08:18:01 2016
From: 191980 at niuitmo.ru (=?utf-8?B?0JHQvtGA0LfRi9GFINCQ0LvQtdC60YHQsNC90LTRgCDQkNC90LTRgNC10LU=?= =?utf-8?B?0LLQuNGH?=)
Date: Thu, 19 May 2016 15:18:01 +0000
Subject: [gdal-dev] DWG files request
Message-ID: <15B7BEF1-5785-4FA7-9EEF-9E3C4E9F9E61@niuitmo.ru>

Hello devs,

Current state of DWG driver now supports reading of layers and a variety of geometries, and now I need some .DWG files (version does not matter, I can save it as R2000 myself) with a lot of diferent objects (currently I’ve tested it with 25000+ objects, and everything worked out good).

If you can share some with me – I will be very pleased.

Best regards,
Alexandr Borzykh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160519/3b42bf61/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu May 19 10:20:54 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Thu, 19 May 2016 17:20:54 +0000 (UTC)
Subject: [gdal-dev]
	=?utf-8?q?Get_a_List_of_tiles_source_name_from_the_gpk?=
	=?utf-8?q?g=5Fcontent?=
References: <CALMrLdC2jgvY28BKGz5H7ot=Q_fr7dXFef_G11=Mi-MqDDNryw@mail.gmail.com>
Message-ID: <loom.20160519T190258-206@post.gmane.org>

Gane R <gane.prog <at> gmail.com> writes:

> 
> 
> 
> I see the usage of the gdalinfo for the gpkg with multiple tile source as
Subdataset,
> 
> 
> I also saw the source code of gdalinfo getting the subdataset 
> 
> Q1: Can I get a list of tiles source name (table_name) in gpkg_contents
data_type as tiles?

Hi,

I am not sure if I understood what you mean, but GeoPackage is a database
and you can use SQL and ogrinfo for doing anything that is possible with SQL. 

ogrinfo test.gpkg -sql "select table_name, data_type from gpkg_contents
where data_type='tiles'"
INFO: Open of `test.gpkg'
      using driver `GPKG' successful.

Layer name: SELECT
Geometry: None
Feature Count: 2
Layer SRS WKT:
(unknown)
table_name: String (0.0)
data_type: String (0.0)
OGRFeature(SELECT):0
  table_name (String) = one
  data_type (String) = tiles

OGRFeature(SELECT):1
  table_name (String) = two
  data_type (String) = tiles


-Jukka Rahkonen-


From even.rouault at spatialys.com  Thu May 19 12:52:08 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 19 May 2016 21:52:08 +0200
Subject: [gdal-dev] CommitTicketUpdater Trac plugin
Message-ID: <201605192152.08218.even.rouault@spatialys.com>

Hi,

just to notify you that since the upgrade to Trac 1.0.5 a few months ago, the 
CommitTicketUpdater plugin is enabled, which enables to automatically adds 
comments in tickets from SVN commit messages.

See https://trac.osgeo.org/gdal/ticket/6519 as an example.

Here's the doc of the CommitTicketUpdater plugin :
"""
 This component hooks into changeset notifications and searches commit messages 
for text in the form of:

command #1
command #1, #2
command #1 & #2
command #1 and #2

Instead of the short-hand syntax "#1", "ticket:1" can be used as well, e.g.:

command ticket:1
command ticket:1, ticket:2
command ticket:1 & ticket:2
command ticket:1 and ticket:2

In addition, the ':' character can be omitted and issue or bug can be used 
instead of ticket.

You can have more than one command in a message. The following commands are 
supported. There is more than one spelling for each command, to make this as 
user-friendly as possible.

close, closed, closes, fix, fixed, fixes
    The specified tickets are closed, and the commit message is added to them 
as a comment. 

references, refs, addresses, re, see
    The specified tickets are left in their current status, and the commit 
message is added to them as a comment. 

A fairly complicated example of what you can do is with a commit message of:

    Changed blah and foo to do this or that. Fixes #10 and #12, and refs #12.

This will close #10 and #12, and add a note to #12.
"""

Credit to strk for mentionning this capability

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From tomerlieber at gmail.com  Fri May 20 03:18:41 2016
From: tomerlieber at gmail.com (Tomer)
Date: Fri, 20 May 2016 03:18:41 -0700 (PDT)
Subject: [gdal-dev]  layer and columns names aliases
Message-ID: <1463739521104-5267406.post@n6.nabble.com>

Hi,

I use c# bindings for GDAL/ OGR and I didn't find how can I get the layer
name alias or the column names aliases.
Is there support for reading this information? If so, how?

Thanks,
Tomer



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-layer-and-columns-names-aliases-tp5267406.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From sebastic at xs4all.nl  Fri May 20 04:06:46 2016
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Fri, 20 May 2016 13:06:46 +0200
Subject: [gdal-dev] Sort files in static library to make the build
	reproducible
Message-ID: <573EEFC6.4000407@xs4all.nl>

[I'm sending this to the list because I'm unable to successfully create
a ticket with description in Trac at the moment. As reported in #6520
[0] adding a ticket description causes an internal server errors on
submit, it looks like the spam filter cannot handle the content.]


As part of the effort to support Reproducible Builds [1] Alexis
Bienvenüe submitted two patches in Debian Bug #824808 [2] to sort the
object files in the static library: sort-files-1 [3] & sort-files-2 [4]

These patches resolve the random_order_in_static_libraries issue [5],
which is illustrated by the diffoscope output [6].

The attached patch is modified version of the sort-files-2 patch doing
do wildcard sorting in the `$(LIBGDAL)` target instead of a separate
`$(LIBGDAL).buildit` target. Alexis chose that approach because:

> In some situations some of the target dependencies do not exist
> before the "make target" call. When this arises, as $(wildcard) is
> expanded before building the dependencies, it can miss some files…
> I was not sure of the situation here, so I added a transitional
> target to be safe.

I prefer the single line change in the attached patch, but you may want
to consider the separate target as done in the sort-files-2 patch too.

[0] https://trac.osgeo.org/gdal/ticket/6520
[1] https://wiki.debian.org/ReproducibleBuilds
[2] https://bugs.debian.org/824808
[3]
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=824808;msg=5;att=1;filename=sort-files-1
[4]
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=824808;msg=5;att=2;filename=sort-files-2
[5]
https://tests.reproducible-builds.org/issues/unstable/random_order_in_static_libraries_issue.html
[6]
https://tests.reproducible-builds.org/dbd/unstable/amd64/gdal_2.1.0+dfsg-2.diffoscope.html


Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sort-files-in-static-library.patch
Type: inode/symlink
Size: 653 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160520/860867aa/attachment.bin>

From even.rouault at spatialys.com  Fri May 20 05:05:16 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 20 May 2016 14:05:16 +0200
Subject: [gdal-dev] Sort files in static library to make the build
	reproducible
In-Reply-To: <573EEFC6.4000407@xs4all.nl>
References: <573EEFC6.4000407@xs4all.nl>
Message-ID: <201605201405.16474.even.rouault@spatialys.com>

Hi Bas,

> [I'm sending this to the list because I'm unable to successfully create
> a ticket with description in Trac at the moment. As reported in #6520
> [0] adding a ticket description causes an internal server errors on
> submit, it looks like the spam filter cannot handle the content.]

You got -3 points of karma due to:
ExternalLinks (-3): Maximum number of external links per post exceeded

(so somewhat changing a bit the links so they are no longer valid URL might 
potentially work)

and then :
IPThrottle (-4): Maximum number of posts per hour for this IP exceeded

Unfortunately it doesn't seem there's a way to whitelist users...

I've classified your attempts as 'ham' so hopefully the filter will lean from 
that...

> 
> 
> As part of the effort to support Reproducible Builds [1] Alexis
> Bienvenüe submitted two patches in Debian Bug #824808 [2] to sort the
> object files in the static library: sort-files-1 [3] & sort-files-2 [4]
> 
> These patches resolve the random_order_in_static_libraries issue [5],
> which is illustrated by the diffoscope output [6].
> 
> The attached patch is modified version of the sort-files-2 patch doing
> do wildcard sorting in the `$(LIBGDAL)` target instead of a separate
> 
> `$(LIBGDAL).buildit` target. Alexis chose that approach because:
> > In some situations some of the target dependencies do not exist
> > before the "make target" call. When this arises, as $(wildcard) is
> > expanded before building the dependencies, it can miss some files…
> > I was not sure of the situation here, so I added a transitional
> > target to be safe.
> 
> I prefer the single line change in the attached patch, but you may want
> to consider the separate target as done in the sort-files-2 patch too.

I've not an authoritative opinion on makefile issues. Was just wondering if one 
or another one of the approach might cause issues to "odd" environements, like 
mingw. But I see that we already do the backticks in the gdal.pc target.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sebastic at xs4all.nl  Fri May 20 05:29:16 2016
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Fri, 20 May 2016 14:29:16 +0200
Subject: [gdal-dev] Sort files in static library to make the build
 reproducible
In-Reply-To: <201605201405.16474.even.rouault@spatialys.com>
References: <573EEFC6.4000407@xs4all.nl>
 <201605201405.16474.even.rouault@spatialys.com>
Message-ID: <573F031C.7010703@xs4all.nl>

Hi Even,

On 05/20/2016 02:05 PM, Even Rouault wrote:
>> [I'm sending this to the list because I'm unable to successfully create
>> a ticket with description in Trac at the moment. As reported in #6520
>> [0] adding a ticket description causes an internal server errors on
>> submit, it looks like the spam filter cannot handle the content.]
> 
> You got -3 points of karma due to:
> ExternalLinks (-3): Maximum number of external links per post exceeded
> 
> (so somewhat changing a bit the links so they are no longer valid URL might 
> potentially work)
> 
> and then :
> IPThrottle (-4): Maximum number of posts per hour for this IP exceeded
> 
> Unfortunately it doesn't seem there's a way to whitelist users...
> 
> I've classified your attempts as 'ham' so hopefully the filter will lean from 
> that...

Thanks for troubleshooting. I've reopened the ticket with the links
spread over several comments.

>> As part of the effort to support Reproducible Builds [1] Alexis
>> Bienvenüe submitted two patches in Debian Bug #824808 [2] to sort the
>> object files in the static library: sort-files-1 [3] & sort-files-2 [4]
>>
>> These patches resolve the random_order_in_static_libraries issue [5],
>> which is illustrated by the diffoscope output [6].
>>
>> The attached patch is modified version of the sort-files-2 patch doing
>> do wildcard sorting in the `$(LIBGDAL)` target instead of a separate
>>
>> `$(LIBGDAL).buildit` target. Alexis chose that approach because:
>>> In some situations some of the target dependencies do not exist
>>> before the "make target" call. When this arises, as $(wildcard) is
>>> expanded before building the dependencies, it can miss some files…
>>> I was not sure of the situation here, so I added a transitional
>>> target to be safe.
>>
>> I prefer the single line change in the attached patch, but you may want
>> to consider the separate target as done in the sort-files-2 patch too.
> 
> I've not an authoritative opinion on makefile issues. Was just wondering if one 
> or another one of the approach might cause issues to "odd" environements, like 
> mingw. But I see that we already do the backticks in the gdal.pc target.

Both backticks and the Makefile functions should be supported on Windows
too, but I haven't tested on Windows. I did opt out of the approach from
the sort-files-1 patch because it's unlikely to work on Windows, it uses
ls with the C locale to sort the objects instead of the Makefile functions.

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From cedric.tardella at igo.fr  Wed May 25 01:58:18 2016
From: cedric.tardella at igo.fr (Thugann)
Date: Wed, 25 May 2016 01:58:18 -0700 (PDT)
Subject: [gdal-dev] From WGS84 to cartesian X Y Z
In-Reply-To: <1463738963086-5267404.post@n6.nabble.com>
References: <1463738963086-5267404.post@n6.nabble.com>
Message-ID: <1464166698060-5268109.post@n6.nabble.com>

Hi,

Yes, GDAL has tools to do that.
It could depend on what platform you're using but if you're doing it on
Windows, you need to use a SpatialReference class and the ImportFromProj4
function to set up your coordinates source and destination.

Then use the CoordinateTransformation class with the Transform function to
get your point from your WGS84 reference to the X Y Z system you have set
up.



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/From-WGS84-to-cartesian-X-Y-Z-tp5267404p5268109.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From kristen.moore at gro-intelligence.com  Wed May 25 02:53:54 2016
From: kristen.moore at gro-intelligence.com (Kristen Moore)
Date: Wed, 25 May 2016 19:53:54 +1000
Subject: [gdal-dev] From HDF to Tiff format,
 and reproject from sinusoidal to WGS84 for MODIS LST and ET data
Message-ID: <CA+6YaHMETmTb_Q147w=RUd4wsJdOOpmqKNtf6Obx5mqhHHQ6PA@mail.gmail.com>

Hi,

I'm fairly new to GIS and could use some help converting MODIS LST and ET
data to TIFF format in WGS84 projection.
Example files can be obtained here:
http://e4ftl01.cr.usgs.gov/MOLT/MOD11A1.005/2004.03.31/
<http://e4ftl01.cr.usgs.gov/MOLT/MOD11A1.005/2004.03.31/MOD11A1.A2004091.h34v10.005.2007261231833.hdf>
ftp://ftp.ntsg.umt.edu/pub/MODIS/NTSG_Products/MOD16/MOD16A2.105_MERRAGMAO/Y2000/D193/

I'm haven't been able to figure out how to correctly specify the parameters
in the gdalwarp step.
I've posted a GIS-Stack Exchange question here
<https://gis.stackexchange.com/questions/194533/convert-modis-hdf-file-in-sinusoidal-projection-into-geotiff-with?noredirect=1#comment294925_194533>,
but
haven't gotten any replies yet.

Thanks a lot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160525/a3928994/attachment.html>

From jamessramm at gmail.com  Wed May 25 06:21:14 2016
From: jamessramm at gmail.com (jramm)
Date: Wed, 25 May 2016 06:21:14 -0700 (PDT)
Subject: [gdal-dev] How to consider data types when implementing
	IWriteBlock
In-Reply-To: <201604191205.40233.even.rouault@spatialys.com>
References: <1460473841374-5260901.post@n6.nabble.com>
 <201604122001.13821.even.rouault@spatialys.com>
 <1460969466934-5261675.post@n6.nabble.com>
 <201604182253.22271.even.rouault@spatialys.com>
 <1461057770339-5261827.post@n6.nabble.com>
 <201604191205.40233.even.rouault@spatialys.com>
Message-ID: <1464182474726-5268160.post@n6.nabble.com>

As an update to this; I have finished write support for the GRD driver for
now, with ZMAX/ZMIN exposed as creation options and will be explicitly
calculated in CreateCopy if not passed in - exactly as you suggested Even,
thanks. 

I'm waiting permission to get a osgeo user id so I can raise a ticket and
submit the patch :D



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/How-to-consider-data-types-when-implementing-IWriteBlock-tp5260901p5268160.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From lucadeluge at gmail.com  Wed May 25 07:46:10 2016
From: lucadeluge at gmail.com (Luca Delucchi)
Date: Wed, 25 May 2016 16:46:10 +0200
Subject: [gdal-dev] geospatialPDF DPI and EXTRA_IMAGES
In-Reply-To: <201505191037.50818.even.rouault@spatialys.com>
References: <CAK4m-3ynQUeSse+TwXYknToQjbT4BS5cPQJMMszh=4Yb_UVncA@mail.gmail.com>
 <201505191037.50818.even.rouault@spatialys.com>
Message-ID: <CAK4m-3zMsMuTTHmkyeFocLnQg4cXHVz0SC_bpzbHq+Mqr2mamA@mail.gmail.com>

On 19 May 2015 at 10:37, Even Rouault <even.rouault at spatialys.com> wrote:

>
> Luca,
>

Hi Even,

> According to the doc, "x and y are in user units from the lower left corner of
> the page"
>

I have other two questions:
- is it possible to calculate the maximum x and y in user units? I
tried using the difference between maximum x and y coordinates but
this doesn't work...
- what are the DPI useful for? We tried to change the value but we
cannot see big changes, sometimes the DPI changed the extend of the
resulting PDF

>
> Even
>

-- 
ciao
Luca

www.lucadelu.org

From even.rouault at spatialys.com  Wed May 25 08:12:51 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 25 May 2016 17:12:51 +0200
Subject: [gdal-dev] geospatialPDF DPI and EXTRA_IMAGES
In-Reply-To: <CAK4m-3zMsMuTTHmkyeFocLnQg4cXHVz0SC_bpzbHq+Mqr2mamA@mail.gmail.com>
References: <CAK4m-3ynQUeSse+TwXYknToQjbT4BS5cPQJMMszh=4Yb_UVncA@mail.gmail.com>
 <201505191037.50818.even.rouault@spatialys.com>
 <CAK4m-3zMsMuTTHmkyeFocLnQg4cXHVz0SC_bpzbHq+Mqr2mamA@mail.gmail.com>
Message-ID: <201605251712.51859.even.rouault@spatialys.com>

Le mercredi 25 mai 2016 16:46:10, Luca Delucchi a écrit :
> On 19 May 2015 at 10:37, Even Rouault <even.rouault at spatialys.com> wrote:
> > Luca,
> 
> Hi Even,
> 
> > According to the doc, "x and y are in user units from the lower left
> > corner of the page"
> 
> I have other two questions:
> - is it possible to calculate the maximum x and y in user units? I
> tried using the difference between maximum x and y coordinates but
> this doesn't work...
> - what are the DPI useful for? We tried to change the value but we
> cannot see big changes, sometimes the DPI changed the extend of the
> resulting PDF

The following extract from the driver should hopefully answer your questions :

    double dfUserUnit = dfDPI * USER_UNIT_IN_INCH;
    double dfWidthInUserUnit = nWidth / dfUserUnit + sMargins.nLeft + sMargins.nRight;
    double dfHeightInUserUnit = nHeight / dfUserUnit + sMargins.nBottom + sMargins.nTop;

--> nWidth and nHeight are the dimensions of the source raster in pixel.

    if( dfWidthInUserUnit > MAXIMUM_SIZE_IN_UNITS ||
        dfHeightInUserUnit > MAXIMUM_SIZE_IN_UNITS )
    {
        if( pszDPI == NULL )
        {
            if( sMargins.nLeft + sMargins.nRight >= MAXIMUM_SIZE_IN_UNITS ||
                sMargins.nBottom + sMargins.nTop >= MAXIMUM_SIZE_IN_UNITS )
            {
                CPLError(CE_Warning, CPLE_AppDefined,
                         "Margins too big compared to maximum page dimension (%d) "
                         "in user units allowed by Acrobat",
                         MAXIMUM_SIZE_IN_UNITS);
            }
            else
            {
                if( dfWidthInUserUnit >= dfHeightInUserUnit )
                {
                    dfDPI = (int)(0.5 + (double)nWidth / (MAXIMUM_SIZE_IN_UNITS -
                            (sMargins.nLeft + sMargins.nRight)) / USER_UNIT_IN_INCH);
                }
                else
                {
                    dfDPI = (int)(0.5 + (double)nHeight / (MAXIMUM_SIZE_IN_UNITS -
                            (sMargins.nBottom + sMargins.nTop)) / USER_UNIT_IN_INCH);
                }
                CPLDebug("PDF", "Adjusting DPI to %d so that page dimension in "
                        "user units remain in what is accepted by Acrobat", (int)dfDPI);
            }
        }
        else
        {
            CPLError(CE_Warning, CPLE_AppDefined,
                     "The page dimension in user units is %d x %d whereas the "
                     "maximum allowed by Acrobat is %d x %d",
                     (int)(dfWidthInUserUnit + 0.5),
                     (int)(dfHeightInUserUnit + 0.5),
                     MAXIMUM_SIZE_IN_UNITS, MAXIMUM_SIZE_IN_UNITS);
        }
    }


> 
> > Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jamesnunn123 at gmail.com  Wed May 25 08:13:50 2016
From: jamesnunn123 at gmail.com (James Nunn)
Date: Wed, 25 May 2016 16:13:50 +0100
Subject: [gdal-dev] GDAL python bindings build error (gcc command replaced
	by bash)
Message-ID: <CANXASxMd0RyvruK3oqs9s3G-85cdkYZPBPapApuywa51khyQnw@mail.gmail.com>

Hi

I'm building gdal on linux (64bit ubuntu 16) with python bindings, and I'm
coming across a strange error right at the end of the python build steps
where exactly 4 commands which *should* be run with `x86_64-linux-gnu-gcc`
are instead run as `/bin/bash`.

Here are the last few lines of output before the error is encountered (look
for /bin/bash -pthread ... command after the python header warnings:

make[1]: Entering directory '/home/james/src/gdal/gdal/swig'
for dir in python ; do (cd $dir; make build) || exit; done
make[2]: Entering directory '/home/james/src/gdal/gdal/swig/python'
rm -f setup_vars.ini
echo 'GNM_ENABLED=no' >> setup_vars.ini
python setup.py build
running build
running build_py
creating build
creating build/lib.linux-x86_64-2.7
copying gdal.py -> build/lib.linux-x86_64-2.7
copying ogr.py -> build/lib.linux-x86_64-2.7
copying osr.py -> build/lib.linux-x86_64-2.7
copying gdalconst.py -> build/lib.linux-x86_64-2.7
copying gdalnumeric.py -> build/lib.linux-x86_64-2.7
creating build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gnm.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalnumeric.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal_array.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdalconst.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/osr.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/__init__.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/gdal.py -> build/lib.linux-x86_64-2.7/osgeo
copying osgeo/ogr.py -> build/lib.linux-x86_64-2.7/osgeo
running build_ext
building 'osgeo._gdal' extension
creating build/temp.linux-x86_64-2.7
creating build/temp.linux-x86_64-2.7/extensions
x86_64-linux-gnu-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall
-Wstrict-prototypes -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE=2 -g
-fstack-protector -Wformat -Werror=format-security -fPIC -I../../port
-I../../gcore -I../../alg -I../../ogr/ -I../../ogr/ogrsf_frmts -I../../gnm
-I../../apps -I/usr/include/python2.7
-I/home/james/local/farmenv/local/lib/python2.7/site-packages/numpy/core/include
-I/home/james/src/gdal/gdal/include -c extensions/gdal_wrap.cpp -o
build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o
cc1plus: warning: command line option ‘-Wstrict-prototypes’ is valid for
C/ObjC but not for C++
In file included from /usr/include/python2.7/Python.h:133:0,
                 from extensions/gdal_wrap.cpp:155:
extensions/gdal_wrap.cpp: In function ‘PyObject*
_wrap_MajorObject_SetMetadata__SWIG_0(PyObject*, PyObject*)’:
/usr/include/python2.7/abstract.h:1354:62: warning: deprecated conversion
from string constant to ‘char*’ [-Wwrite-strings]
 #define PyMapping_Items(O) PyObject_CallMethod(O,"items",NULL)
                                                              ^
extensions/gdal_wrap.cpp:9115:31: note: in expansion of macro
‘PyMapping_Items’
         PyObject *item_list = PyMapping_Items( obj1 );
                               ^
/bin/bash -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions
-Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g
-fwrapv -O2 -Wall -Wstrict-prototypes -Wdate-time -D_FORTIFY_SOURCE=2 -g
-fstack-protector -Wformat -Werror=format-security -Wl,-Bsymbolic-functions
-Wl,-z,relro -Wdate-time -D_FORTIFY_SOURCE=2 -g -fstack-protector -Wformat
-Werror=format-security build/temp.linux-x86_64-2.7/extensions/gdal_wrap.o
-L../../.libs -L../../ -L/home/james/src/gdal/gdal/lib -lgdal -o
build/lib.linux-x86_64-2.7/osgeo/_gdal.so
/bin/bash: -d: invalid option
error: command '/bin/bash' failed with exit status 1
GNUmakefile:74: recipe for target 'build' failed
make[2]: *** [build] Error 1
make[2]: Leaving directory '/home/james/src/gdal/gdal/swig/python'
GNUmakefile:30: recipe for target 'build' failed
make[1]: *** [build] Error 2
make[1]: Leaving directory '/home/james/src/gdal/gdal/swig'
GNUmakefile:104: recipe for target 'swig-modules' failed
make: *** [swig-modules] Error 2


If I manually re-run the failing commands replacing `/bin/bash` with
`x86_64-linux-gnu-gcc`, the entire build eventually succeeds.


Can anyone shed light on why the command is being replaced?


Regards

James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160525/a8ca43db/attachment-0001.html>

From jluis at ualg.pt  Wed May 25 16:25:37 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Thu, 26 May 2016 00:25:37 +0100
Subject: [gdal-dev] From HDF to Tiff format,
 and reproject from sinusoidal to WGS84 for MODIS LST and ET data
In-Reply-To: <CA+6YaHMETmTb_Q147w=RUd4wsJdOOpmqKNtf6Obx5mqhHHQ6PA@mail.gmail.com>
References: <CA+6YaHMETmTb_Q147w=RUd4wsJdOOpmqKNtf6Obx5mqhHHQ6PA@mail.gmail.com>
Message-ID: <op.yh1koz1odbaoe8@macmarilu>

I don't know if this is related to an issue that I posted here some weeks  
ago where the HDF's array metadata is not read by the HDF5 driver (but  
this files are not HDF5) but the thing is that I can read it with the GMT  
developing version (maybe it works too with official releases version too  
but can't test it).

grdinfo  
MOD16A2.A2000193.h31v11.105.2013122033833.hdf=gd?HDF4_EOS:EOS_GRID:"MOD16A2.A2000193.h31v11.105.2013122033833.hdf":MOD_Grid_MOD16A2:ET_1km
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
Title: Grid imported via GDAL
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
Command:
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
Remark:
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
Gridline node registration used [Cartesian grid]
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
Grid file format: gd = Import/export through GDAL
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
x_min: 14455820.0684 x_max: 15566843.9626 x_inc: 926.625433055 name: x nx:  
1200
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
y_min: -3335388.24628 y_max: -2224364.35205 y_inc: 926.625433056 name: y  
ny: 1200
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
z_min: 0.2 z_max: 3276.6 name: z
HDF4_EOS:EOS_GRID:MOD16A2.A2000193.h31v11.105.2013122033833.hdf:MOD_Grid_MOD16A2:ET_1km:  
scale_factor: 0.1 add_offset: 0 packed z-range: [2,32766]
+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181 +b=6371007.181 +units=m  
+no_defs

And for example extracting the first array.

grdconvert  
MOD16A2.A2000193.h31v11.105.2013122033833.hdf=gd?HDF4_EOS:EOS_GRID:"MOD16A2.A2000193.h31v11.105.2013122033833.hdf":MOD_Grid_MOD16A2:ET_1km  
lixo.grd



PS. Even, I did try to add the methods to the HDF5 driver but stumped on  
how to get the info out of the HDF5 file (damn complicated API) so fall  
back in GMT to fetch them from the text strings of all metadata. In lack  
of better, perhaps the same can be in the GDAL HDF5 driver.

Joaquim


> Hi,
>
> I'm fairly new to GIS and could use some help converting MODIS LST and  
> ET data to TIFF format in WGS84 projection.
> Example files can be obtained here:
> http://e4ftl01.cr.usgs.gov/MOLT/MOD11A1.005/2004.03.31/
> ftp://ftp.ntsg.umt.edu/pub/MODIS/NTSG_Products/MOD16/MOD16A2.105_MERRAGMAO/Y2000/D193/
>
> I'm haven't been able to figure out how to correctly specify the  
> parameters in the gdalwarp step.
> I've posted a GIS-Stack Exchange question here, but haven't gotten any  
> replies yet.
>
> Thanks a lot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160526/480de77d/attachment.html>

From lucadeluge at gmail.com  Thu May 26 00:38:21 2016
From: lucadeluge at gmail.com (Luca Delucchi)
Date: Thu, 26 May 2016 09:38:21 +0200
Subject: [gdal-dev] geospatialPDF DPI and EXTRA_IMAGES
In-Reply-To: <201605251712.51859.even.rouault@spatialys.com>
References: <CAK4m-3ynQUeSse+TwXYknToQjbT4BS5cPQJMMszh=4Yb_UVncA@mail.gmail.com>
 <201505191037.50818.even.rouault@spatialys.com>
 <CAK4m-3zMsMuTTHmkyeFocLnQg4cXHVz0SC_bpzbHq+Mqr2mamA@mail.gmail.com>
 <201605251712.51859.even.rouault@spatialys.com>
Message-ID: <CAK4m-3z2a_DVzb9SKAUgLKiBPryS_wn_xt5tBYNOJOA70=X+uw@mail.gmail.com>

On 25 May 2016 at 17:12, Even Rouault <even.rouault at spatialys.com> wrote:

> The following extract from the driver should hopefully answer your questions :
>

more or less yes, now I understood a little bit more but..

>     double dfUserUnit = dfDPI * USER_UNIT_IN_INCH;
>     double dfWidthInUserUnit = nWidth / dfUserUnit + sMargins.nLeft + sMargins.nRight;
>     double dfHeightInUserUnit = nHeight / dfUserUnit + sMargins.nBottom + sMargins.nTop;
>
> --> nWidth and nHeight are the dimensions of the source raster in pixel.
>

if I have no raster how can I found this two values?


-- 
ciao
Luca

www.lucadelu.org

From jukka.rahkonen at maanmittauslaitos.fi  Thu May 26 05:40:13 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Thu, 26 May 2016 12:40:13 +0000 (UTC)
Subject: [gdal-dev] Spatial index to raster VRT
Message-ID: <loom.20160526T132644-677@post.gmane.org>

Hi,

Any thoughts about alternatives to implement the feature request from
https://trac.osgeo.org/gdal/ticket/5762? 

What I dream of is to be able to utilize all the nice on-the-fly tweaks that
can be done with VRT at similar speed that Mapserver is reaching with tileindex.

-Jukka Rahkonen-


From dmorissette at mapgears.com  Thu May 26 05:50:47 2016
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Thu, 26 May 2016 08:50:47 -0400
Subject: [gdal-dev] Spatial index to raster VRT
In-Reply-To: <loom.20160526T132644-677@post.gmane.org>
References: <loom.20160526T132644-677@post.gmane.org>
Message-ID: <8ebdf010-cc99-da83-9e28-008d37f8ec2b@mapgears.com>

On 2016-05-26 8:40 AM, Jukka Rahkonen wrote:
> Hi,
>
> Any thoughts about alternatives to implement the feature request from
> https://trac.osgeo.org/gdal/ticket/5762?
>
> What I dream of is to be able to utilize all the nice on-the-fly tweaks that
> can be done with VRT at similar speed that Mapserver is reaching with tileindex.
>

That would be a nice enhancement. As usual I guess we need a champion 
and/or some funding to make this happen.

I came across a similar use case not long ago and realized that to get 
top performance at all zoom levels we'd also need the ability to 
associate overviews with the VRT. I didn't check if creating external 
overviews with gdaladdo would work for a VRT already. Maybe it does?


-- 
Daniel Morissette
http://www.mapgears.com/
T: +1 418-696-5056 #201

http://evouala.com/ - Location Intelligence Made Easy

From jukka.rahkonen at maanmittauslaitos.fi  Thu May 26 06:26:38 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Thu, 26 May 2016 13:26:38 +0000 (UTC)
Subject: [gdal-dev] Spatial index to raster VRT
References: <loom.20160526T132644-677@post.gmane.org>
 <8ebdf010-cc99-da83-9e28-008d37f8ec2b@mapgears.com>
Message-ID: <loom.20160526T151638-10@post.gmane.org>

Daniel Morissette <dmorissette <at> mapgears.com> writes:

> 
> On 2016-05-26 8:40 AM, Jukka Rahkonen wrote:
> > Hi,
> >
> > Any thoughts about alternatives to implement the feature request from
> > https://trac.osgeo.org/gdal/ticket/5762?
> >
> > What I dream of is to be able to utilize all the nice on-the-fly tweaks that
> > can be done with VRT at similar speed that Mapserver is reaching with
tileindex.
> >
> 
> That would be a nice enhancement. As usual I guess we need a champion 
> and/or some funding to make this happen.
> 
> I came across a similar use case not long ago and realized that to get 
> top performance at all zoom levels we'd also need the ability to 
> associate overviews with the VRT. I didn't check if creating external 
> overviews with gdaladdo would work for a VRT already. Maybe it does?

It does and is even documented in
http://www.gdal.org/gdal_vrttut.html#gdal_vrttut_overviews.

VRT supports one overview, but that can itself be a VRT, which in turn can
point to next VRT overview and so on. Easier than to explain is to give a
link to this old experiment
http://latuviitta.org/documents/GDAL_Scale_dependent_VRT_test.zip

Unzip and open the best resolution VRT t0320.vrt with QGIS, zoom in, and you
should see how 5 different tiff files with different pixel size and
rendering styles behave.

-Jukka Rahkonen-



 





From shawn at rmrf.us  Thu May 26 06:52:08 2016
From: shawn at rmrf.us (Shawn L)
Date: Thu, 26 May 2016 09:52:08 -0400
Subject: [gdal-dev] Importing KML to Mysql with extended data fields
Message-ID: <CAMOTM_Ss3Him0=NBZC8z1io6PUDJB8kqfxqARQpa2JtubEukHA@mail.gmail.com>

Hello

I'm trying to import a KML file that has a bunch of SimpleData fields
inside of  ExtendedData into mysql.

I've gotten the basic syntax down for importing the file, but I can't seem
to get the simpledata fileds to transfer over.

Here's an example.  I don't really need all the fields -- I'm only really
interested in storing the polygon and the GEOID10 field, but I can
manipulate the database to remove them later easily enough.

<Placemark>
<styleUrl>#falseColor0</styleUrl>
<ExtendedData>
<SchemaData schemaUrl="#S_tl_2015_26_tabblock10_SSSSSSSS
SSSDDSS">
<SimpleData name="STATEFP10">13</SimpleData>
<SimpleData name="COUNTYFP10">131</SimpleData>
<SimpleData name="TRACTCE10">970100</SimpleData>
<SimpleData name="BLOCKCE10">1125</SimpleData>
<SimpleData name="GEOID10">131319701001125</Simp
leData>
<SimpleData name="NAME10">Block 1125</SimpleData
>
<SimpleData name="MTFCC10">G5040</SimpleData>
<SimpleData name="UR10">R</SimpleData>
<SimpleData name="UACE10"></SimpleData>
<SimpleData name="UATYPE"></SimpleData>
<SimpleData name="FUNCSTAT10">S</SimpleData>
<SimpleData name="ALAND10">9.67522e+06</SimpleDa
ta>
<SimpleData name="AWATER10">4866</SimpleData>
<SimpleData name="INTPTLAT10">+46.7776681</Simpl
eData>
<SimpleData name="INTPTLON10">-088.9520440</Simp
leData>
</SchemaData>
</ExtendedData>
<Polygon>
<outerBoundaryIs>
<LinearRing>
<coordinates>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160526/999a318c/attachment.html>

From even.rouault at spatialys.com  Thu May 26 08:23:05 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 26 May 2016 17:23:05 +0200
Subject: [gdal-dev] geospatialPDF DPI and EXTRA_IMAGES
In-Reply-To: <CAK4m-3z2a_DVzb9SKAUgLKiBPryS_wn_xt5tBYNOJOA70=X+uw@mail.gmail.com>
References: <CAK4m-3ynQUeSse+TwXYknToQjbT4BS5cPQJMMszh=4Yb_UVncA@mail.gmail.com>
 <201605251712.51859.even.rouault@spatialys.com>
 <CAK4m-3z2a_DVzb9SKAUgLKiBPryS_wn_xt5tBYNOJOA70=X+uw@mail.gmail.com>
Message-ID: <2344761.atvNhdjgl4@even-n550jk>

On Thursday 26 May 2016 09:38:21 Luca Delucchi wrote:
> On 25 May 2016 at 17:12, Even Rouault <even.rouault at spatialys.com> wrote:
> > The following extract from the driver should hopefully answer your 
questions :
> more or less yes, now I understood a little bit more but..
> 
> >     double dfUserUnit = dfDPI * USER_UNIT_IN_INCH;
> >     double dfWidthInUserUnit = nWidth / dfUserUnit + sMargins.nLeft +
> >     sMargins.nRight; double dfHeightInUserUnit = nHeight / dfUserUnit +
> >     sMargins.nBottom + sMargins.nTop;> 
> > --> nWidth and nHeight are the dimensions of the source raster in pixel.
> 
> if I have no raster how can I found this two values?

Ah ok, so you create a vector dataset then ?

Here's the relevant code in pdfwritabledataset.cpp:

    double dfRatio = (sGlobalExtent.MaxY - sGlobalExtent.MinY) / 
(sGlobalExtent.MaxX - sGlobalExtent.MinX);

    int nWidth, nHeight;

    if (dfRatio < 1)
    {
        nWidth = 1024;
        nHeight = static_cast<int>(nWidth * dfRatio);
    }
    else
    {
        nHeight = 1024;
        nWidth = static_cast<int>(nHeight / dfRatio);
    }

where sGlobalExtent is the georeferenced extent of the vectors added in the 
PDF vector layer.

Even



-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Thu May 26 08:27:29 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 26 May 2016 17:27:29 +0200
Subject: [gdal-dev] Importing KML to Mysql with extended data fields
In-Reply-To: <CAMOTM_Ss3Him0=NBZC8z1io6PUDJB8kqfxqARQpa2JtubEukHA@mail.gmail.com>
References: <CAMOTM_Ss3Him0=NBZC8z1io6PUDJB8kqfxqARQpa2JtubEukHA@mail.gmail.com>
Message-ID: <19815388.fTltdCQhEA@even-n550jk>

Shawn

I suppose that your GDAL build has only the KML driver built in. It doesn't 
support reading SimpleData. For that, you need to build GDAL against libkml to 
have the LIBKML driver : http://gdal.org/drv_libkml.html

Even

> 
> I'm trying to import a KML file that has a bunch of SimpleData fields
> inside of  ExtendedData into mysql.
> 
> I've gotten the basic syntax down for importing the file, but I can't seem
> to get the simpledata fileds to transfer over.
> 
> Here's an example.  I don't really need all the fields -- I'm only really
> interested in storing the polygon and the GEOID10 field, but I can
> manipulate the database to remove them later easily enough.
> 
> <Placemark>
> <styleUrl>#falseColor0</styleUrl>
> <ExtendedData>
> <SchemaData schemaUrl="#S_tl_2015_26_tabblock10_SSSSSSSS
> SSSDDSS">
> <SimpleData name="STATEFP10">13</SimpleData>
> <SimpleData name="COUNTYFP10">131</SimpleData>
> <SimpleData name="TRACTCE10">970100</SimpleData>
> <SimpleData name="BLOCKCE10">1125</SimpleData>
> <SimpleData name="GEOID10">131319701001125</Simp
> leData>
> <SimpleData name="NAME10">Block 1125</SimpleData
> 
> <SimpleData name="MTFCC10">G5040</SimpleData>
> <SimpleData name="UR10">R</SimpleData>
> <SimpleData name="UACE10"></SimpleData>
> <SimpleData name="UATYPE"></SimpleData>
> <SimpleData name="FUNCSTAT10">S</SimpleData>
> <SimpleData name="ALAND10">9.67522e+06</SimpleDa
> ta>
> <SimpleData name="AWATER10">4866</SimpleData>
> <SimpleData name="INTPTLAT10">+46.7776681</Simpl
> eData>
> <SimpleData name="INTPTLON10">-088.9520440</Simp
> leData>
> </SchemaData>
> </ExtendedData>
> <Polygon>
> <outerBoundaryIs>
> <LinearRing>
> <coordinates>

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Thu May 26 08:32:46 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 26 May 2016 17:32:46 +0200
Subject: [gdal-dev] Spatial index to raster VRT
In-Reply-To: <loom.20160526T151638-10@post.gmane.org>
References: <loom.20160526T132644-677@post.gmane.org>
 <8ebdf010-cc99-da83-9e28-008d37f8ec2b@mapgears.com>
 <loom.20160526T151638-10@post.gmane.org>
Message-ID: <3441101.AxUre5Oe9t@even-n550jk>

On Thursday 26 May 2016 13:26:38 Jukka Rahkonen wrote:
> Daniel Morissette <dmorissette <at> mapgears.com> writes:
> > On 2016-05-26 8:40 AM, Jukka Rahkonen wrote:
> > > Hi,
> > > 
> > > Any thoughts about alternatives to implement the feature request from
> > > https://trac.osgeo.org/gdal/ticket/5762?
> > > 
> > > What I dream of is to be able to utilize all the nice on-the-fly tweaks
> > > that can be done with VRT at similar speed that Mapserver is reaching
> > > with
> tileindex.
> 
> > That would be a nice enhancement. As usual I guess we need a champion
> > and/or some funding to make this happen.
> > 
> > I came across a similar use case not long ago and realized that to get
> > top performance at all zoom levels we'd also need the ability to
> > associate overviews with the VRT. I didn't check if creating external
> > overviews with gdaladdo would work for a VRT already. Maybe it does?
> 
> It does and is even documented in
> http://www.gdal.org/gdal_vrttut.html#gdal_vrttut_overviews.
> 
> VRT supports one overview, but that can itself be a VRT, which in turn can
> point to next VRT overview and so on.

Actually, this is not true (although I might have in the past say so). The doc 
currently states :
"""
Overview: This optional element describes one overview level for the band. It 
should have a child SourceFilename and SourceBand element. The SourceFilename 
may have a relativeToVRT boolean attribute. Multiple elements may be used to 
describe multiple overviews. 
"""

and I've verified it works (at least they are reported by gdalinfo)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From shawn at rmrf.us  Thu May 26 09:44:51 2016
From: shawn at rmrf.us (Shawn L)
Date: Thu, 26 May 2016 12:44:51 -0400
Subject: [gdal-dev] Importing KML to Mysql with extended data fields
In-Reply-To: <19815388.fTltdCQhEA@even-n550jk>
References: <CAMOTM_Ss3Him0=NBZC8z1io6PUDJB8kqfxqARQpa2JtubEukHA@mail.gmail.com>
 <19815388.fTltdCQhEA@even-n550jk>
Message-ID: <CAMOTM_QvCc7o2sAXUHuKTEDy4L8uQsiT8szatvbEj-mrvw4toA@mail.gmail.com>

That did the trick. What would the syntax be to create new KML based on the
output of a SQL query be then?

thanks

On Thu, May 26, 2016 at 11:27 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Shawn
>
> I suppose that your GDAL build has only the KML driver built in. It doesn't
> support reading SimpleData. For that, you need to build GDAL against
> libkml to
> have the LIBKML driver : http://gdal.org/drv_libkml.html
>
> Even
>
> >
> > I'm trying to import a KML file that has a bunch of SimpleData fields
> > inside of  ExtendedData into mysql.
> >
> > I've gotten the basic syntax down for importing the file, but I can't
> seem
> > to get the simpledata fileds to transfer over.
> >
> > Here's an example.  I don't really need all the fields -- I'm only really
> > interested in storing the polygon and the GEOID10 field, but I can
> > manipulate the database to remove them later easily enough.
> >
> > <Placemark>
> > <styleUrl>#falseColor0</styleUrl>
> > <ExtendedData>
> > <SchemaData schemaUrl="#S_tl_2015_26_tabblock10_SSSSSSSS
> > SSSDDSS">
> > <SimpleData name="STATEFP10">13</SimpleData>
> > <SimpleData name="COUNTYFP10">131</SimpleData>
> > <SimpleData name="TRACTCE10">970100</SimpleData>
> > <SimpleData name="BLOCKCE10">1125</SimpleData>
> > <SimpleData name="GEOID10">131319701001125</Simp
> > leData>
> > <SimpleData name="NAME10">Block 1125</SimpleData
> >
> > <SimpleData name="MTFCC10">G5040</SimpleData>
> > <SimpleData name="UR10">R</SimpleData>
> > <SimpleData name="UACE10"></SimpleData>
> > <SimpleData name="UATYPE"></SimpleData>
> > <SimpleData name="FUNCSTAT10">S</SimpleData>
> > <SimpleData name="ALAND10">9.67522e+06</SimpleDa
> > ta>
> > <SimpleData name="AWATER10">4866</SimpleData>
> > <SimpleData name="INTPTLAT10">+46.7776681</Simpl
> > eData>
> > <SimpleData name="INTPTLON10">-088.9520440</Simp
> > leData>
> > </SchemaData>
> > </ExtendedData>
> > <Polygon>
> > <outerBoundaryIs>
> > <LinearRing>
> > <coordinates>
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160526/8aee4997/attachment.html>

From alexhighviz at hotmail.com  Fri May 27 01:55:22 2016
From: alexhighviz at hotmail.com (alex)
Date: Fri, 27 May 2016 09:55:22 +0100
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
Message-ID: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>

Hi,

Is there a convention about where to place and how to name the win32 and x64
libraries and include directories when building for both platforms on
Windows? 

Especially, I would like CMake's FindGDAL
(https://cmake.org/cmake/help/v3.0/module/FindGDAL.html) to be able to find
the correct paths automatically. 

Thanks, Alex


From bishop.dev at gmail.com  Fri May 27 02:09:50 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Fri, 27 May 2016 12:09:50 +0300
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
Message-ID: <57480EDE.9030908@gmail.com>

Hi,
It seems to me there is no standard install path on Windows, so search 
GDAL is tricky.
CMake can register package in registry and so find GDAL, but GDAL have 
to be CMaked too.

You may try our CMake GDAL (https://github.com/nextgis-borsch/lib_gdal). 
In your project only need to add find_anyproject(GDAL), see - 
https://github.com/nextgis-borsch/borsch.
GDAL will be downloaded, build and linked with your project.

Best regards,
     Dmitry

27.05.2016 11:55, alex пишет:
> Hi,
>
> Is there a convention about where to place and how to name the win32 and x64
> libraries and include directories when building for both platforms on
> Windows?
>
> Especially, I would like CMake's FindGDAL
> (https://cmake.org/cmake/help/v3.0/module/FindGDAL.html) to be able to find
> the correct paths automatically.
>
> Thanks, Alex
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev


From Stefan.Blumentrath at nina.no  Fri May 27 02:59:05 2016
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Fri, 27 May 2016 09:59:05 +0000
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
Message-ID: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>

Hei,

We are facing issues with GeoTiffs that were written by GDAL, after importing them to GeoServer or opening in Desktop GIS.
On file was produced in GRASS and exported using r.out.gdal (GDAL 2.1dev), the other file in R, using rgdal (GDAL2.0.x) with EPSG code 25832.
The rasters seem to miss the AUTHORITY parameter...

QGIS for example detects EPSG 3044 (which is technically identical), and GeoServer considers the CRS as invalid (because of this: http://docs.geonode.org/en/master/tutorials/advanced/geonode_production/adv_gsconfig/crs_handling.html).

Did anyone else experience the same?

Kind regards,
Stefan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160527/9a0dd6f6/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 27 04:46:14 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Fri, 27 May 2016 11:46:14 +0000 (UTC)
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
References: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>
Message-ID: <loom.20160527T134418-452@post.gmane.org>

Blumentrath, Stefan <Stefan.Blumentrath <at> nina.no> writes:

> Hei,
>  
> We are facing issues with GeoTiffs that were written by GDAL, after
importing them to GeoServer or opening in Desktop GIS.
> On file was produced in GRASS and exported using r.out.gdal (GDAL 2.1dev),
the other file in R, using rgdal (GDAL2.0.x) with EPSG code 25832.
> The rasters seem to miss the AUTHORITY parameter...
>  
> QGIS for example detects EPSG 3044 (which is technically identical), and
GeoServer considers the CRS as invalid (because of this:
>
http://docs.geonode.org/en/master/tutorials/advanced/geonode_production/adv_gsconfig/crs_handling.html).
>  
> Did anyone else experience the same?

Hi,

From my GDAL 2.1-dev

gdalsrsinfo epsg:25832

PROJ.4 : '+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_de
fs '

OGC WKT :
PROJCS["ETRS89 / UTM zone 32N",
    GEOGCS["ETRS89",
        DATUM["European_Terrestrial_Reference_System_1989",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6258"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4258"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",9],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["Easting",EAST],
    AXIS["Northing",NORTH],
    AUTHORITY["EPSG","25832"]]


Do you get the same result? If you do I wonder why AUTHORITY is not written
into GeoTIFF.

-Jukka Rahkonen-


>  
> Kind regards,
> Stefan 

From alexhighviz at hotmail.com  Fri May 27 04:56:54 2016
From: alexhighviz at hotmail.com (alex)
Date: Fri, 27 May 2016 12:56:54 +0100
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <57480EDE.9030908@gmail.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com>
Message-ID: <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>

>> [Alex]
>> Is there a convention about where to place and how to name the win32 and
>x64
>> libraries and include directories when building for both platforms on
>> Windows?
>>
>> Especially, I would like CMake's FindGDAL
>> (https://cmake.org/cmake/help/v3.0/module/FindGDAL.html) to be able to
>find
>> the correct paths automatically.
>>

> [Dmitry Baryshnikov] 
>
>Hi,
>It seems to me there is no standard install path on Windows, so search
>GDAL is tricky.
>CMake can register package in registry and so find GDAL, but GDAL have
>to be CMaked too.
>
>You may try our CMake GDAL (https://github.com/nextgis-borsch/lib_gdal).
>In your project only need to add find_anyproject(GDAL), see -
>https://github.com/nextgis-borsch/borsch.
>GDAL will be downloaded, build and linked with your project.
>

Hi Dmitry,

Thanks, that looks very useful and addresses a major headache. I am a bit reluctant to include further dependencies and straying from the 'official' GDAL repository and processes. 

Is there any chance that your efforts will make it to a future GDAL release?


From jukka.rahkonen at maanmittauslaitos.fi  Fri May 27 05:09:42 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Fri, 27 May 2016 12:09:42 +0000 (UTC)
Subject: [gdal-dev] How to recognize FDO style SQLite db?
Message-ID: <loom.20160527T135143-226@post.gmane.org>

Hi,

User in gis.stackoverflow tried to use SQL "select ST_Union(geometry)" for
the Natural Earth SQLite db file from
http://naciscdn.org/naturalearth/packages/natural_earth_vector.sqlite.zip.

The query yields an empty geometry because the NE database is written with
FDO geometries instead of SpatiaLite geometries. What I wonder is that does
GDAL user have any simple mean for getting informed if SQLite db is FDO or
Spatialite. If SpatiaLite is present a clever enough user can use ogrinfo
and check from
https://www.gaia-gis.it/gaia-sins/spatialite-sql-latest.html#p16fdo that
value 2 is returned in case when "both tables exist, and their layout is the
one used by FDO/OGR"

ogrinfo -sql "select CheckSpatialMetaData()"  
natural_earth_vector.sqlite
INFO: Open of `natural_earth_vector.sqlite'
      using driver `SQLite' successful.

Layer name: SELECT
Geometry: None
Feature Count: 1
Layer SRS WKT:
(unknown)
CheckSpatialMetaData(): Integer (0.0)
OGRFeature(SELECT):0
  CheckSpatialMetaData() (Integer) = 2


However, the one who knows to do that must be somewhat advanced GDAL and
Spatialite user.

-Jukka Rahkonen-


From even.rouault at spatialys.com  Fri May 27 05:27:59 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 27 May 2016 14:27:59 +0200
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
In-Reply-To: <loom.20160527T134418-452@post.gmane.org>
References: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>
 <loom.20160527T134418-452@post.gmane.org>
Message-ID: <34893394.f5pI0ipINX@even-n550jk>

On Friday 27 May 2016 11:46:14 Jukka Rahkonen wrote:
> Blumentrath, Stefan <Stefan.Blumentrath <at> nina.no> writes:
> > Hei,
> >  
> > We are facing issues with GeoTiffs that were written by GDAL, after
> 
> importing them to GeoServer or opening in Desktop GIS.
> 
> > On file was produced in GRASS and exported using r.out.gdal (GDAL 2.1dev),
> 
> the other file in R, using rgdal (GDAL2.0.x) with EPSG code 25832.
> 
> > The rasters seem to miss the AUTHORITY parameter...
> >  
> > QGIS for example detects EPSG 3044 (which is technically identical), and
> 
> GeoServer considers the CRS as invalid (because of this:
> 
> http://docs.geonode.org/en/master/tutorials/advanced/geonode_production/adv_
> gsconfig/crs_handling.html).
> >  
> > Did anyone else experience the same?
> 
> Hi,
> 
> From my GDAL 2.1-dev
> 
> gdalsrsinfo epsg:25832
> 
> PROJ.4 : '+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m
> +no_de fs '
> 
> OGC WKT :
> PROJCS["ETRS89 / UTM zone 32N",
>     GEOGCS["ETRS89",
>         DATUM["European_Terrestrial_Reference_System_1989",
>             SPHEROID["GRS 1980",6378137,298.257222101,
>                 AUTHORITY["EPSG","7019"]],
>             TOWGS84[0,0,0,0,0,0,0],
>             AUTHORITY["EPSG","6258"]],
>         PRIMEM["Greenwich",0,
>             AUTHORITY["EPSG","8901"]],
>         UNIT["degree",0.0174532925199433,
>             AUTHORITY["EPSG","9122"]],
>         AUTHORITY["EPSG","4258"]],
>     PROJECTION["Transverse_Mercator"],
>     PARAMETER["latitude_of_origin",0],
>     PARAMETER["central_meridian",9],
>     PARAMETER["scale_factor",0.9996],
>     PARAMETER["false_easting",500000],
>     PARAMETER["false_northing",0],
>     UNIT["metre",1,
>         AUTHORITY["EPSG","9001"]],
>     AXIS["Easting",EAST],
>     AXIS["Northing",NORTH],
>     AUTHORITY["EPSG","25832"]]
> 
> 
> Do you get the same result? If you do I wonder why AUTHORITY is not written
> into GeoTIFF.


For diagnosing, what is interesting is the output of the listgeo utility that 
comes with libgeotiff.
Theoretically the EPSG code should be preserved in the geotiff keys if it is 
available in the source raster (gdal_translate use case), or if set with the 
SetProjection() API. I'm not sure about GRASS or R but perhaps they build the 
GDAL SRS object from a proj.4 string, in which case the EPSG code will be 
missing.


> 
> -Jukka Rahkonen-
> 
> >  
> > Kind regards,
> > Stefan
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri May 27 05:40:28 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 27 May 2016 14:40:28 +0200
Subject: [gdal-dev] How to recognize FDO style SQLite db?
In-Reply-To: <loom.20160527T135143-226@post.gmane.org>
References: <loom.20160527T135143-226@post.gmane.org>
Message-ID: <3225145.FlH7seWenf@even-n550jk>

On Friday 27 May 2016 12:09:42 Jukka Rahkonen wrote:
> Hi,
> 
> User in gis.stackoverflow tried to use SQL "select ST_Union(geometry)" for
> the Natural Earth SQLite db file from
> http://naciscdn.org/naturalearth/packages/natural_earth_vector.sqlite.zip.
> 
> The query yields an empty geometry because the NE database is written with
> FDO geometries instead of SpatiaLite geometries. What I wonder is that does
> GDAL user have any simple mean for getting informed if SQLite db is FDO or
> Spatialite.

This probably doesn't completely fullfil the requirement of "simple mean" ;-), 
but if you enable the debug messages from GDAL with "--debug on", you should 
see :
"OGR style SQLite DB found !"

whereas a Spatialite one will trigger :
"SpatiaLite v4 DB found !" (or "Spatialite DB found" for spatialite 2 or 3)

> If SpatiaLite is present a clever enough user can use ogrinfo
> and check from
> https://www.gaia-gis.it/gaia-sins/spatialite-sql-latest.html#p16fdo that
> value 2 is returned in case when "both tables exist, and their layout is the
> one used by FDO/OGR"
> 
> ogrinfo -sql "select CheckSpatialMetaData()"
> natural_earth_vector.sqlite
> INFO: Open of `natural_earth_vector.sqlite'
>       using driver `SQLite' successful.
> 
> Layer name: SELECT
> Geometry: None
> Feature Count: 1
> Layer SRS WKT:
> (unknown)
> CheckSpatialMetaData(): Integer (0.0)
> OGRFeature(SELECT):0
>   CheckSpatialMetaData() (Integer) = 2
> 
> 
> However, the one who knows to do that must be somewhat advanced GDAL and
> Spatialite user.
> 
> -Jukka Rahkonen-
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 27 05:51:24 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Fri, 27 May 2016 12:51:24 +0000 (UTC)
Subject: [gdal-dev] How to recognize FDO style SQLite db?
References: <loom.20160527T135143-226@post.gmane.org>
 <3225145.FlH7seWenf@even-n550jk>
Message-ID: <loom.20160527T144658-652@post.gmane.org>

Even Rouault <even.rouault <at> spatialys.com> writes:


> This probably doesn't completely fullfil the requirement of "simple mean" , 
> but if you enable the debug messages from GDAL with "--debug on", you should 
> see :
> "OGR style SQLite DB found !"
> 
> whereas a Spatialite one will trigger :
> "SpatiaLite v4 DB found !" (or "Spatialite DB found" for spatialite 2 or 3)


Simple enough, I'll try to find some place to document that in
http://www.gdal.org/drv_sqlite.html.

-Jukka-





From jukka.rahkonen at maanmittauslaitos.fi  Fri May 27 07:31:00 2016
From: jukka.rahkonen at maanmittauslaitos.fi (Jukka Rahkonen)
Date: Fri, 27 May 2016 14:31:00 +0000 (UTC)
Subject: [gdal-dev] Spatial index to raster VRT
References: <loom.20160526T132644-677@post.gmane.org>
 <8ebdf010-cc99-da83-9e28-008d37f8ec2b@mapgears.com>
 <loom.20160526T151638-10@post.gmane.org> <3441101.AxUre5Oe9t@even-n550jk>
Message-ID: <loom.20160527T161939-725@post.gmane.org>

Even Rouault <even.rouault <at> spatialys.com> writes:

> 
> On Thursday 26 May 2016 13:26:38 Jukka Rahkonen wrote:

> > 
> > VRT supports one overview, but that can itself be a VRT, which in turn can
> > point to next VRT overview and so on.
 
> Actually, this is not true (although I might have in the past say so). The
doc 
> currently states :
> """
> Overview: This optional element describes one overview level for the band. It 
> should have a child SourceFilename and SourceBand element. The SourceFilename 
> may have a relativeToVRT boolean attribute. Multiple elements may be used to 
> describe multiple overviews. 
> """
> 
> and I've verified it works (at least they are reported by gdalinfo)

Confirmed by adding several tiff files with increasing pixel size as
Overview elements into the same VRT. Works fine. Still missing the main
thing - spatial index for making access to small region fast with thousands
or images in VRT.

-Jukka-

> 
> Even
> 





From bishop.dev at gmail.com  Fri May 27 08:03:10 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Fri, 27 May 2016 18:03:10 +0300
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
Message-ID: <574861AE.8070000@gmail.com>

Hi Alex,

The work is done taking into considerations this link: 
https://trac.osgeo.org/gdal/wiki/CMake
Also, there were some ideas about gdal source code reorganisation in 
dev-list.
This is second turn of cmakefication of GDAL.
The lib_gdal repository synced with gdal trunk periodically (there is a 
python script in etc folder 
(https://github.com/nextgis-borsch/lib_gdal/blob/master/etc/cmake-build-helpers/gdal_restructure.py) 
to do it). Now the sources are 2.1 release version. The different GDAL 
version support will be added in future.

I think current lib_gdal is not ready to switch trunk (not all drivers 
ready, not all bindings ready, etc.), but very close (see 
https://github.com/nextgis-borsch/lib_gdal/blob/master/README.md about 
work status).

Best regards,
     Dmitry

27.05.2016 14:56, alex пишет:
>>> [Alex]
>>> Is there a convention about where to place and how to name the win32 and
>> x64
>>> libraries and include directories when building for both platforms on
>>> Windows?
>>>
>>> Especially, I would like CMake's FindGDAL
>>> (https://cmake.org/cmake/help/v3.0/module/FindGDAL.html) to be able to
>> find
>>> the correct paths automatically.
>>>
>> [Dmitry Baryshnikov]
>>
>> Hi,
>> It seems to me there is no standard install path on Windows, so search
>> GDAL is tricky.
>> CMake can register package in registry and so find GDAL, but GDAL have
>> to be CMaked too.
>>
>> You may try our CMake GDAL (https://github.com/nextgis-borsch/lib_gdal).
>> In your project only need to add find_anyproject(GDAL), see -
>> https://github.com/nextgis-borsch/borsch.
>> GDAL will be downloaded, build and linked with your project.
>>
> Hi Dmitry,
>
> Thanks, that looks very useful and addresses a major headache. I am a bit reluctant to include further dependencies and straying from the 'official' GDAL repository and processes.
>
> Is there any chance that your efforts will make it to a future GDAL release?
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev


From Stefan.Blumentrath at nina.no  Fri May 27 15:20:29 2016
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Fri, 27 May 2016 22:20:29 +0000
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
In-Reply-To: <34893394.f5pI0ipINX@even-n550jk>
References: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>
 <loom.20160527T134418-452@post.gmane.org> <34893394.f5pI0ipINX@even-n550jk>
Message-ID: <e6e0adc459b04c7caf7a1652d0c1ec4d@NINSRV23.nina.no>

Hi,

And thanks Even and Jukka for your answers!

Based on the info you provided I investigated a bit more and it seems to be an issue "downstreams" indeed.

gdalsrsinfo epsg:25832 gave the same result for me than for Jukka (the result from listgeo further down, just for the record).

In GRASS GIS 7.0.4 and 7.1.svn, g.proj -w gave me the projection information as in the GeoTIFF, though without any AUTHORITY parameters (as it is supposed to according to the manual). The AUTHORITY tags seem to be added by r.out.gdal, except for the authority parameter for the entire projection... Even if g.proj -g returns epsg=25832...

gdal_translate -a_srs EPSG:25832 in.tif out.tif adds the AUTHORITY parameter to the GeoTIFF, while gdal_edit -a_srs EPSG:25832 does not.

Kind regards,
Stefan 

P.S.: This is the output from listgeo LC81980182015183LGN00_LST_const_LC.tif
TIFFReadDirectory: Warning, Unknown field with tag 42112 (0xa480) encountered.
TIFFReadDirectory: Warning, Unknown field with tag 42113 (0xa481) encountered.
Geotiff_Information:
   Version: 1
   Key_Revision: 1.0
   Tagged_Information:
      ModelTiepointTag (2,3):
         0                 0                 0
         417585            6784515           0
      ModelPixelScaleTag (1,3):
         30                30                0
      End_Of_Tags.
   Keyed_Information:
      GTModelTypeGeoKey (Short,1): ModelTypeProjected
      GTRasterTypeGeoKey (Short,1): RasterPixelIsArea
      GTCitationGeoKey (Ascii,30): "Universal Transverse Mercator"
      GeographicTypeGeoKey (Short,1): User-Defined
      GeogCitationGeoKey (Ascii,80): "GCS Name = grs80|Ellipsoid = Geodetic_Refe
rence_System_1980|Primem = Greenwich|"
      GeogGeodeticDatumGeoKey (Short,1): Datum_European_Reference_System_1989
      GeogAngularUnitsGeoKey (Short,1): Angular_Degree
      GeogSemiMajorAxisGeoKey (Double,1): 6378137
      GeogInvFlatteningGeoKey (Double,1): 298.257222101
      GeogPrimeMeridianLongGeoKey (Double,1): 0
      ProjectedCSTypeGeoKey (Short,1): User-Defined
      ProjectionGeoKey (Short,1): Proj_UTM_zone_32N
      ProjLinearUnitsGeoKey (Short,1): Linear_Meter
      End_Of_Keys.
   End_Of_Geotiff.

Projection = 16032 (UTM zone 32N)
Projection Method: CT_TransverseMercator
   ProjNatOriginLatGeoKey: 0.000000 (  0d 0' 0.00"N)
   ProjNatOriginLongGeoKey: 9.000000 (  9d 0' 0.00"E)
   ProjScaleAtNatOriginGeoKey: 0.999600
   ProjFalseEastingGeoKey: 500000.000000 m
   ProjFalseNorthingGeoKey: 0.000000 m
Datum: 6258/European Terrestrial Reference System 1989
Ellipsoid: 7019/GRS 1980 (6378137.00,6356752.31)
Projection Linear Units: 9001/metre (1.000000m)

Corner Coordinates:
Upper Left    (  417585.000, 6784515.000)  (  7d28' 1.67"E, 61d11'11.02"N)
Lower Left    (  417585.000, 6538485.000)  (  7d33'58.86"E, 58d58'40.77"N)
Upper Right   (  660915.000, 6784515.000)  ( 11d59'28.13"E, 61d 9'43.28"N)
Lower Right   (  660915.000, 6538485.000)  ( 11d47'51.98"E, 58d57'20.48"N)
Center        (  539250.000, 6661500.000)  (  9d42'20.11"E, 60d 5'19.35"N)



-----Original Message-----
From: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] On Behalf Of Even Rouault
Sent: 27. mai 2016 14:28
To: gdal-dev at lists.osgeo.org
Cc: Jukka Rahkonen <jukka.rahkonen at maanmittauslaitos.fi>
Subject: Re: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL

On Friday 27 May 2016 11:46:14 Jukka Rahkonen wrote:
> Blumentrath, Stefan <Stefan.Blumentrath <at> nina.no> writes:
> > Hei,
> >  
> > We are facing issues with GeoTiffs that were written by GDAL, after
> 
> importing them to GeoServer or opening in Desktop GIS.
> 
> > On file was produced in GRASS and exported using r.out.gdal (GDAL 
> > 2.1dev),
> 
> the other file in R, using rgdal (GDAL2.0.x) with EPSG code 25832.
> 
> > The rasters seem to miss the AUTHORITY parameter...
> >  
> > QGIS for example detects EPSG 3044 (which is technically identical), 
> > and
> 
> GeoServer considers the CRS as invalid (because of this:
> 
> http://docs.geonode.org/en/master/tutorials/advanced/geonode_productio
> n/adv_
> gsconfig/crs_handling.html).
> >  
> > Did anyone else experience the same?
> 
> Hi,
> 
> From my GDAL 2.1-dev
> 
> gdalsrsinfo epsg:25832
> 
> PROJ.4 : '+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 
> +units=m
> +no_de fs '
> 
> OGC WKT :
> PROJCS["ETRS89 / UTM zone 32N",
>     GEOGCS["ETRS89",
>         DATUM["European_Terrestrial_Reference_System_1989",
>             SPHEROID["GRS 1980",6378137,298.257222101,
>                 AUTHORITY["EPSG","7019"]],
>             TOWGS84[0,0,0,0,0,0,0],
>             AUTHORITY["EPSG","6258"]],
>         PRIMEM["Greenwich",0,
>             AUTHORITY["EPSG","8901"]],
>         UNIT["degree",0.0174532925199433,
>             AUTHORITY["EPSG","9122"]],
>         AUTHORITY["EPSG","4258"]],
>     PROJECTION["Transverse_Mercator"],
>     PARAMETER["latitude_of_origin",0],
>     PARAMETER["central_meridian",9],
>     PARAMETER["scale_factor",0.9996],
>     PARAMETER["false_easting",500000],
>     PARAMETER["false_northing",0],
>     UNIT["metre",1,
>         AUTHORITY["EPSG","9001"]],
>     AXIS["Easting",EAST],
>     AXIS["Northing",NORTH],
>     AUTHORITY["EPSG","25832"]]
> 
> 
> Do you get the same result? If you do I wonder why AUTHORITY is not 
> written into GeoTIFF.


For diagnosing, what is interesting is the output of the listgeo utility that comes with libgeotiff.
Theoretically the EPSG code should be preserved in the geotiff keys if it is available in the source raster (gdal_translate use case), or if set with the
SetProjection() API. I'm not sure about GRASS or R but perhaps they build the GDAL SRS object from a proj.4 string, in which case the EPSG code will be missing.


> 
> -Jukka Rahkonen-
> 
> >  
> > Kind regards,
> > Stefan
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

--
Spatialys - Geospatial professional services http://www.spatialys.com _______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
http://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Fri May 27 15:48:11 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 28 May 2016 00:48:11 +0200
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
In-Reply-To: <e6e0adc459b04c7caf7a1652d0c1ec4d@NINSRV23.nina.no>
References: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>
 <34893394.f5pI0ipINX@even-n550jk>
 <e6e0adc459b04c7caf7a1652d0c1ec4d@NINSRV23.nina.no>
Message-ID: <1888592.r4ObQaKcrY@even-n550jk>

 
> gdal_translate -a_srs EPSG:25832 in.tif out.tif adds the AUTHORITY parameter
> to the GeoTIFF, while gdal_edit -a_srs EPSG:25832 does not.

That's weird that gdal_edit does'nt set it correctly. I just tested it and it 
works for me.


$ cp autotest/gcore/data/byte.tif tmp.tif; python 
gdal/swig/python/scripts/gdal_edit.py -a_srs EPSG:25832 tmp.tif

$ gdalinfo tmp.tif
Driver: GTiff/GeoTIFF
Files: tmp.tif
Size is 20, 20
Coordinate System is:
PROJCS["ETRS89 / UTM zone 32N",
    GEOGCS["ETRS89",
        DATUM["European_Terrestrial_Reference_System_1989",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6258"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4258"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",9],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["Easting",EAST],
    AXIS["Northing",NORTH],
    AUTHORITY["EPSG","25832"]]

 
> Kind regards,
> Stefan 
> 
> P.S.: This is the output from listgeo
> LC81980182015183LGN00_LST_const_LC.tif
 TIFFReadDirectory: Warning, Unknown
> field with tag 42112 (0xa480) encountered. TIFFReadDirectory: Warning,
> Unknown field with tag 42113 (0xa481) encountered. Geotiff_Information:
>    Version: 1
>    Key_Revision: 1.0
>    Tagged_Information:
>       ModelTiepointTag (2,3):
>          0                 0                 0
>          417585            6784515           0
>       ModelPixelScaleTag (1,3):
>          30                30                0
>       End_Of_Tags.
>    Keyed_Information:
>       GTModelTypeGeoKey (Short,1): ModelTypeProjected
>       GTRasterTypeGeoKey (Short,1): RasterPixelIsArea
>       GTCitationGeoKey (Ascii,30): "Universal Transverse Mercator"
>       GeographicTypeGeoKey (Short,1): User-Defined
>       GeogCitationGeoKey (Ascii,80): "GCS Name = grs80|Ellipsoid =
> Geodetic_Refe
 rence_System_1980|Primem = Greenwich|"
>       GeogGeodeticDatumGeoKey (Short,1):
> Datum_European_Reference_System_1989
 GeogAngularUnitsGeoKey (Short,1):
> Angular_Degree
>       GeogSemiMajorAxisGeoKey (Double,1): 6378137
>       GeogInvFlatteningGeoKey (Double,1): 298.257222101
>       GeogPrimeMeridianLongGeoKey (Double,1): 0
>       ProjectedCSTypeGeoKey (Short,1): User-Defined
>       ProjectionGeoKey (Short,1): Proj_UTM_zone_32N
>       ProjLinearUnitsGeoKey (Short,1): Linear_Meter
>       End_Of_Keys.
>    End_Of_Geotiff.
> 
> Projection = 16032 (UTM zone 32N)
> Projection Method: CT_TransverseMercator
>    ProjNatOriginLatGeoKey: 0.000000 (  0d 0' 0.00"N)
>    ProjNatOriginLongGeoKey: 9.000000 (  9d 0' 0.00"E)
>    ProjScaleAtNatOriginGeoKey: 0.999600
>    ProjFalseEastingGeoKey: 500000.000000 m
>    ProjFalseNorthingGeoKey: 0.000000 m
> Datum: 6258/European Terrestrial Reference System 1989
> Ellipsoid: 7019/GRS 1980 (6378137.00,6356752.31)
> Projection Linear Units: 9001/metre (1.000000m)
> 
> Corner Coordinates:
> Upper Left    (  417585.000, 6784515.000)  (  7d28' 1.67"E, 61d11'11.02"N)
> Lower Left    (  417585.000, 6538485.000)  (  7d33'58.86"E, 58d58'40.77"N)
> Upper Right   (  660915.000, 6784515.000)  ( 11d59'28.13"E, 61d 9'43.28"N)
> Lower Right   (  660915.000, 6538485.000)  ( 11d47'51.98"E, 58d57'20.48"N)
> Center        (  539250.000, 6661500.000)  (  9d42'20.11"E, 60d 5'19.35"N)
> 
> 
> 
> -----Original Message-----
> From: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] On Behalf Of Even
> Rouault
 Sent: 27. mai 2016 14:28
> To: gdal-dev at lists.osgeo.org
> Cc: Jukka Rahkonen <jukka.rahkonen at maanmittauslaitos.fi>
> Subject: Re: [gdal-dev] EPSG code not recognized from GeoTiff written by
> GDAL
 
> On Friday 27 May 2016 11:46:14 Jukka Rahkonen wrote:
> 
> > Blumentrath, Stefan <Stefan.Blumentrath <at> nina.no> writes:
> > 
> > > Hei,
> > > 
> > >  
> > > 
> > > We are facing issues with GeoTiffs that were written by GDAL, after
> > 
> > 
> > importing them to GeoServer or opening in Desktop GIS.
> > 
> > 
> > > On file was produced in GRASS and exported using r.out.gdal (GDAL 
> > > 2.1dev),
> > 
> > 
> > the other file in R, using rgdal (GDAL2.0.x) with EPSG code 25832.
> > 
> > 
> > > The rasters seem to miss the AUTHORITY parameter...
> > > 
> > >  
> > > 
> > > QGIS for example detects EPSG 3044 (which is technically identical), 
> > > and
> > 
> > 
> > GeoServer considers the CRS as invalid (because of this:
> > 
> > http://docs.geonode.org/en/master/tutorials/advanced/geonode_productio
> > n/adv_
> > gsconfig/crs_handling.html).
> > 
> > >  
> > > 
> > > Did anyone else experience the same?
> > 
> > 
> > Hi,
> > 
> > From my GDAL 2.1-dev
> > 
> > gdalsrsinfo epsg:25832
> > 
> > PROJ.4 : '+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 
> > +units=m
> > +no_de fs '
> > 
> > OGC WKT :
> > PROJCS["ETRS89 / UTM zone 32N",
> > 
> >     GEOGCS["ETRS89",
> >     
> >         DATUM["European_Terrestrial_Reference_System_1989",
> >         
> >             SPHEROID["GRS 1980",6378137,298.257222101,
> >             
> >                 AUTHORITY["EPSG","7019"]],
> >             
> >             TOWGS84[0,0,0,0,0,0,0],
> >             AUTHORITY["EPSG","6258"]],
> >         
> >         PRIMEM["Greenwich",0,
> >         
> >             AUTHORITY["EPSG","8901"]],
> >         
> >         UNIT["degree",0.0174532925199433,
> >         
> >             AUTHORITY["EPSG","9122"]],
> >         
> >         AUTHORITY["EPSG","4258"]],
> >     
> >     PROJECTION["Transverse_Mercator"],
> >     PARAMETER["latitude_of_origin",0],
> >     PARAMETER["central_meridian",9],
> >     PARAMETER["scale_factor",0.9996],
> >     PARAMETER["false_easting",500000],
> >     PARAMETER["false_northing",0],
> >     UNIT["metre",1,
> >     
> >         AUTHORITY["EPSG","9001"]],
> >     
> >     AXIS["Easting",EAST],
> >     AXIS["Northing",NORTH],
> >     AUTHORITY["EPSG","25832"]]
> > 
> > 
> > 
> > Do you get the same result? If you do I wonder why AUTHORITY is not 
> > written into GeoTIFF.
> 
> 
> 
> For diagnosing, what is interesting is the output of the listgeo utility
> that comes with libgeotiff.
 Theoretically the EPSG code should be
> preserved in the geotiff keys if it is available in the source raster
> (gdal_translate use case), or if set with the SetProjection() API. I'm not
> sure about GRASS or R but perhaps they build the GDAL SRS object from a
> proj.4 string, in which case the EPSG code will be missing. 
> 
> 
> > 
> > -Jukka Rahkonen-
> > 
> > 
> > >  
> > > 
> > > Kind regards,
> > > Stefan
> > 
> > 
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > http://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> --
> Spatialys - Geospatial professional services http://www.spatialys.com
> _______________________________________________
 gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From roger.bivand at nhh.no  Sat May 28 02:02:49 2016
From: roger.bivand at nhh.no (Roger Bivand)
Date: Sat, 28 May 2016 09:02:49 +0000 (UTC)
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
References: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>
 <loom.20160527T134418-452@post.gmane.org> <34893394.f5pI0ipINX@even-n550jk>
 <e6e0adc459b04c7caf7a1652d0c1ec4d@NINSRV23.nina.no>
Message-ID: <loom.20160528T105730-384@post.gmane.org>

Blumentrath, Stefan <Stefan.Blumentrath <at> nina.no> writes:

> 
> Hi,
> 
> And thanks Even and Jukka for your answers!
> 
> Based on the info you provided I investigated a bit more and it seems to
be an issue "downstreams" indeed.
> 
> gdalsrsinfo epsg:25832 gave the same result for me than for Jukka (the
result from listgeo further down,
> just for the record).
> 
> In GRASS GIS 7.0.4 and 7.1.svn, g.proj -w gave me the projection
information as in the GeoTIFF, though
> without any AUTHORITY parameters (as it is supposed to according to the
manual). The AUTHORITY tags seem
> to be added by r.out.gdal, except for the authority parameter for the
entire projection... Even if g.proj
> -g returns epsg=25832...
> 
> gdal_translate -a_srs EPSG:25832 in.tif out.tif adds the AUTHORITY
parameter to the GeoTIFF, while
> gdal_edit -a_srs EPSG:25832 does not.
> 

One route to writing from R (from a SpatialGridDataFrame or another object
coerced to that class) is:

SEXP
RGDAL_SetProject(SEXP sxpDataset, SEXP proj4string) {

  OGRSpatialReference oSRS;
  char *pszSRS_WKT = NULL;

  GDALDataset *pDataset = getGDALDatasetPtr(sxpDataset);

  installErrorHandler();
  oSRS.importFromProj4(CHAR(STRING_ELT(proj4string, 0)));
  oSRS.exportToWkt( &pszSRS_WKT );
  uninstallErrorHandlerAndTriggerError();

  installErrorHandler();
  OGRErr err = pDataset->SetProjection(pszSRS_WKT);
  CPLFree( pszSRS_WKT );

  if (err == CE_Failure) 
	warning("Failed to set projection\n");
  uninstallErrorHandlerAndTriggerError();

  return(sxpDataset);
}

It is as you see going from a proj4 string (used in Spatial objects to hold
the CRS/SRS) to WKT. Could this be re-written to provide the Authority, or
is Authority unrepresented in proj4?

Best wishes

Roger


> Kind regards,
> Stefan 
> 




From even.rouault at spatialys.com  Sat May 28 02:13:55 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 28 May 2016 11:13:55 +0200
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
In-Reply-To: <loom.20160528T105730-384@post.gmane.org>
References: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>
 <e6e0adc459b04c7caf7a1652d0c1ec4d@NINSRV23.nina.no>
 <loom.20160528T105730-384@post.gmane.org>
Message-ID: <1907608.2aUuHniAKA@even-n550jk>

On Saturday 28 May 2016 09:02:49 Roger Bivand wrote:
> Blumentrath, Stefan <Stefan.Blumentrath <at> nina.no> writes:
> > Hi,
> > 
> > And thanks Even and Jukka for your answers!
> > 
> > Based on the info you provided I investigated a bit more and it seems to
> 
> be an issue "downstreams" indeed.
> 
> > gdalsrsinfo epsg:25832 gave the same result for me than for Jukka (the
> 
> result from listgeo further down,
> 
> > just for the record).
> > 
> > In GRASS GIS 7.0.4 and 7.1.svn, g.proj -w gave me the projection
> 
> information as in the GeoTIFF, though
> 
> > without any AUTHORITY parameters (as it is supposed to according to the
> 
> manual). The AUTHORITY tags seem
> 
> > to be added by r.out.gdal, except for the authority parameter for the
> 
> entire projection... Even if g.proj
> 
> > -g returns epsg=25832...
> > 
> > gdal_translate -a_srs EPSG:25832 in.tif out.tif adds the AUTHORITY
> 
> parameter to the GeoTIFF, while
> 
> > gdal_edit -a_srs EPSG:25832 does not.
> 
> One route to writing from R (from a SpatialGridDataFrame or another object
> coerced to that class) is:
> 
> SEXP
> RGDAL_SetProject(SEXP sxpDataset, SEXP proj4string) {
> 
>   OGRSpatialReference oSRS;
>   char *pszSRS_WKT = NULL;
> 
>   GDALDataset *pDataset = getGDALDatasetPtr(sxpDataset);
> 
>   installErrorHandler();
>   oSRS.importFromProj4(CHAR(STRING_ELT(proj4string, 0)));
>   oSRS.exportToWkt( &pszSRS_WKT );
>   uninstallErrorHandlerAndTriggerError();
> 
>   installErrorHandler();
>   OGRErr err = pDataset->SetProjection(pszSRS_WKT);
>   CPLFree( pszSRS_WKT );
> 
>   if (err == CE_Failure)
> 	warning("Failed to set projection\n");
>   uninstallErrorHandlerAndTriggerError();
> 
>   return(sxpDataset);
> }
> 
> It is as you see going from a proj4 string (used in Spatial objects to hold
> the CRS/SRS) to WKT. Could this be re-written to provide the Authority, or
> is Authority unrepresented in proj4?

If you've an expanded proj.4 string definition like "+proj=tmerc +lat_0=0 
+lon_0=93 +k=1 +x_0=500000 +y_0=0 +ellps=krass 
+towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs", then the link with the 
authority is lost. It would be nice to have some logic in GDAL to try to 
retrieve it by comparing with the EPSG database, but this isn't implemented 
yet (and there could be some ambiguities as you can find some EPSG codes that 
resolve to the same proj.4 string)

Well, strings like "+init=epsg:21456" are also valid proj.4 strings and 
importFromProj4() will then be able to set the authority node. But that 
requires storing this un-expanded proj.4 string instead of its resolved 
definition.

Actually proj.4 is also happy if the string contains both +init and +proj :
"+init=epsg:21456 +proj=tmerc +lat_0=0 +lon_0=93 +k=1 +x_0=500000 +y_0=0 
+ellps=krass +towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs". But you 
have to be careful that the +init and the rest of the definition are 
consistant, since I'd say it is pretty much undefined which part will win over 
this other one.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From 191980 at niuitmo.ru  Sat May 28 04:31:24 2016
From: 191980 at niuitmo.ru (=?utf-8?B?0JHQvtGA0LfRi9GFINCQ0LvQtdC60YHQsNC90LTRgCDQkNC90LTRgNC10LU=?= =?utf-8?B?0LLQuNGH?=)
Date: Sat, 28 May 2016 11:31:24 +0000
Subject: [gdal-dev] GSoC GDAL DWG Support [Week 1]
Message-ID: <4A560B3C-13A1-4B09-B9FE-1A2C739AD71C@niuitmo.ru>

Hello devs,

Full report is posted in my blog<http://gsoc2016gdaldwg.blogspot.ru/2016/05/week-1-report.html>.

1. This week I've done:
1. Added support to geometries: Ray, MText, MLine, Raster, XLine, 3DFace, Polyline Pface, and added reading of Dimensions (7 types) on internal level (libopencad cad read it, but doesnot provide 'access' to it by its API).
2. Tested reading of Raster Images.
3. Code refactoring.

2. Plan on doing next week:

  *   Write google tests for correct opening of large files with big amount of geometries and layers.

  *
Start implementing reading of LineTypes and by-block reading.

  *   Extend supported geometries list with new ones.

3. Blocking:
I am not really stucked on anything, except I recently tried to add CRC calculation to the library, and did not get a correctly working feature.
I am getting stucked from time-to-time because of mistakes/mistypes in ODA DWG Specification, because some of them can be found only by bruteforcing possible variants what they have wanted to say.

Best regards,
Alexandr Borzykh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160528/253b67de/attachment.html>

From Roger.Bivand at nhh.no  Sun May 29 01:52:04 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 29 May 2016 10:52:04 +0200
Subject: [gdal-dev] EPSG code not recognized from GeoTiff written by GDAL
In-Reply-To: <1907608.2aUuHniAKA@even-n550jk>
References: <4e7c69a42cea48e48b600c54914675de@NINSRV23.nina.no>
 <e6e0adc459b04c7caf7a1652d0c1ec4d@NINSRV23.nina.no>
 <loom.20160528T105730-384@post.gmane.org> <1907608.2aUuHniAKA@even-n550jk>
Message-ID: <alpine.LFD.2.20.1605291047460.12125@reclus.nhh.no>

On Sat, 28 May 2016, Even Rouault wrote:

> On Saturday 28 May 2016 09:02:49 Roger Bivand wrote:
>> Blumentrath, Stefan <Stefan.Blumentrath <at> nina.no> writes:
>>> Hi,
>>>
>>> And thanks Even and Jukka for your answers!
>>>
>>> Based on the info you provided I investigated a bit more and it seems to
>>
>> be an issue "downstreams" indeed.
>>
>>> gdalsrsinfo epsg:25832 gave the same result for me than for Jukka (the
>>
>> result from listgeo further down,
>>
>>> just for the record).
>>>
>>> In GRASS GIS 7.0.4 and 7.1.svn, g.proj -w gave me the projection
>>
>> information as in the GeoTIFF, though
>>
>>> without any AUTHORITY parameters (as it is supposed to according to the
>>
>> manual). The AUTHORITY tags seem
>>
>>> to be added by r.out.gdal, except for the authority parameter for the
>>
>> entire projection... Even if g.proj
>>
>>> -g returns epsg=25832...
>>>
>>> gdal_translate -a_srs EPSG:25832 in.tif out.tif adds the AUTHORITY
>>
>> parameter to the GeoTIFF, while
>>
>>> gdal_edit -a_srs EPSG:25832 does not.
>>
>> One route to writing from R (from a SpatialGridDataFrame or another object
>> coerced to that class) is:
>>
>> SEXP
>> RGDAL_SetProject(SEXP sxpDataset, SEXP proj4string) {
>>
>>   OGRSpatialReference oSRS;
>>   char *pszSRS_WKT = NULL;
>>
>>   GDALDataset *pDataset = getGDALDatasetPtr(sxpDataset);
>>
>>   installErrorHandler();
>>   oSRS.importFromProj4(CHAR(STRING_ELT(proj4string, 0)));
>>   oSRS.exportToWkt( &pszSRS_WKT );
>>   uninstallErrorHandlerAndTriggerError();
>>
>>   installErrorHandler();
>>   OGRErr err = pDataset->SetProjection(pszSRS_WKT);
>>   CPLFree( pszSRS_WKT );
>>
>>   if (err == CE_Failure)
>> 	warning("Failed to set projection\n");
>>   uninstallErrorHandlerAndTriggerError();
>>
>>   return(sxpDataset);
>> }
>>
>> It is as you see going from a proj4 string (used in Spatial objects to hold
>> the CRS/SRS) to WKT. Could this be re-written to provide the Authority, or
>> is Authority unrepresented in proj4?
>
> If you've an expanded proj.4 string definition like "+proj=tmerc +lat_0=0
> +lon_0=93 +k=1 +x_0=500000 +y_0=0 +ellps=krass
> +towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs", then the link with the
> authority is lost. It would be nice to have some logic in GDAL to try to
> retrieve it by comparing with the EPSG database, but this isn't implemented
> yet (and there could be some ambiguities as you can find some EPSG codes that
> resolve to the same proj.4 string)
>
> Well, strings like "+init=epsg:21456" are also valid proj.4 strings and
> importFromProj4() will then be able to set the authority node. But that
> requires storing this un-expanded proj.4 string instead of its resolved
> definition.

Even, thanks!

This may be the resolution, where we change the definition of the R CRS 
class to add a slot to hold the un-expanded +init=epsg:* if available. I 
agree that guessing EPSG codes from proj4 strings is often unreliable, 
I've tried it. @Edzer - could you consider adding this to:

https://github.com/edzer/sfr

I've put this thread as an issue.

Best wishes,

Roger

>
> Actually proj.4 is also happy if the string contains both +init and +proj :
> "+init=epsg:21456 +proj=tmerc +lat_0=0 +lon_0=93 +k=1 +x_0=500000 +y_0=0
> +ellps=krass +towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs". But you
> have to be careful that the +init and the rest of the definition are
> consistant, since I'd say it is pretty much undefined which part will win over
> this other one.
>
> Even
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From sfkeller at gmail.com  Mon May 30 06:01:49 2016
From: sfkeller at gmail.com (Stefan Keller)
Date: Mon, 30 May 2016 15:01:49 +0200
Subject: [gdal-dev] gdal_translate issues downloading GeoTIFF with
	TMS/WMTS/AGS
Message-ID: <CAFcOn2-Hyp2hG=HuOKpAr-sh1SaWVJV06RgBEd2-o-=NLc4rAQ@mail.gmail.com>

My goal is to download a GeoTIFF with highest resolution over a
small(!) region [see 1] out of a raster tile server/service.

I have two issues with this command which uses AGS (see [2]; could be
any other WMTS or TMS):

gdal_translate -of GTiff gdal_tiles_openstreetmap.xml osm_mapnik3.tif
-projwin 8.810788393 47.2283918446 8.8263881207 47.221163925
-projwin_srs epsg:4326 -co TILED=yes -co COMPRESS=JPEG -tr 0.1 0.1

1. What I get, is a result made of tiles from zoom level 17 or so. But
I'd like to get the highest resolution i.e. from zoom level 19 (and
"-tr 0.1 0.1" does not help with that): How can I do that?

2. Is there an option to slow down http requests (like 10 per sec.) in
order to save resources of the service? (Should I write an issue?)

(Finally I will reproject the GeoTIFF to a local SRS using gdalwarp.)

:Stefan


[1] http://tools.geofabrik.de/calc/#type=geofabrik_standard&bbox=8.810788393,47.221163925,8.8263881207,47.2283918446&tab=1&proj=EPSG:4326&places=2

[2] --- ::: File gdal_tiles_openstreetmap.xml ::: --
<GDAL_WMS>
    <Service name="AGS">
        <ServerUrl>https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer</ServerUrl>
        <ImageFormat>png32</ImageFormat>
        <Transparent>true</Transparent>
        <ImageSR>102100</ImageSR>
        <Layers></Layers>
        <BBoxOrder>xyXY</BBoxOrder>
    </Service>
    <DataWindow>
        <UpperLeftX>-20037508.34278700</UpperLeftX>
        <UpperLeftY>20037508.34278700</UpperLeftY>
        <LowerRightX>20037508.34278103</LowerRightX>
        <LowerRightY>-20037508.34278103</LowerRightY>
        <SizeX>40075016</SizeX>
        <SizeY>40075016</SizeY>
    </DataWindow>
    <BlockSizeX>512</BlockSizeX>
    <BlockSizeY>512</BlockSizeY>
    <Projection>EPSG:3857</Projection>
    <BandsCount>4</BandsCount>
    <ClampRequests>true</ClampRequests>
    <UserAgent>Mozilla/5.0</UserAgent>
    <ZeroBlockHttpCodes>499,204,404</ZeroBlockHttpCodes>
    <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
</GDAL_WMS>

From even.rouault at spatialys.com  Mon May 30 08:20:23 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 30 May 2016 17:20:23 +0200
Subject: [gdal-dev] gdal_translate issues downloading GeoTIFF with
	TMS/WMTS/AGS
In-Reply-To: <CAFcOn2-Hyp2hG=HuOKpAr-sh1SaWVJV06RgBEd2-o-=NLc4rAQ@mail.gmail.com>
References: <CAFcOn2-Hyp2hG=HuOKpAr-sh1SaWVJV06RgBEd2-o-=NLc4rAQ@mail.gmail.com>
Message-ID: <201605301720.23749.even.rouault@spatialys.com>

Stefan,

> 1. What I get, is a result made of tiles from zoom level 17 or so. But
> I'd like to get the highest resolution i.e. from zoom level 19 (and
> "-tr 0.1 0.1" does not help with that): How can I do that?

See below comments in the XML

> 
> 2. Is there an option to slow down http requests (like 10 per sec.) in
> order to save resources of the service? (Should I write an issue?)

AFAIK there's no option for limitation of the number of requests in this 
driver.

Even

> 
> (Finally I will reproject the GeoTIFF to a local SRS using gdalwarp.)
> 
> :Stefan
> 
> [1]
> http://tools.geofabrik.de/calc/#type=geofabrik_standard&bbox=8.810788393,4
> 7.221163925,8.8263881207,47.2283918446&tab=1&proj=EPSG:4326&places=2
> 
> [2] --- ::: File gdal_tiles_openstreetmap.xml ::: --
> <GDAL_WMS>
>     <Service name="AGS">
>        
> <ServerUrl>https://server.arcgisonline.com/ArcGIS/rest/services/World_Imag
> ery/MapServer</ServerUrl> <ImageFormat>png32</ImageFormat>
>         <Transparent>true</Transparent>
>         <ImageSR>102100</ImageSR>
>         <Layers></Layers>
>         <BBoxOrder>xyXY</BBoxOrder>
>     </Service>
>     <DataWindow>
>         <UpperLeftX>-20037508.34278700</UpperLeftX>
>         <UpperLeftY>20037508.34278700</UpperLeftY>
>         <LowerRightX>20037508.34278103</LowerRightX>
>         <LowerRightY>-20037508.34278103</LowerRightY>
>         <SizeX>40075016</SizeX>
>         <SizeY>40075016</SizeY>

--> This is a unusual size for a X/Y/Z tiling system. For zoom level 19 and 
tiles of size 256, that should be 134217728 ( 256 * 2^19)

>     </DataWindow>

>     <BlockSizeX>512</BlockSizeX>
>     <BlockSizeY>512</BlockSizeY>

--> should be 256

>     <Projection>EPSG:3857</Projection>
>     <BandsCount>4</BandsCount>
>     <ClampRequests>true</ClampRequests>
>     <UserAgent>Mozilla/5.0</UserAgent>
>     <ZeroBlockHttpCodes>499,204,404</ZeroBlockHttpCodes>
>     <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
> </GDAL_WMS>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sfkeller at gmail.com  Tue May 31 03:11:18 2016
From: sfkeller at gmail.com (Stefan Keller)
Date: Tue, 31 May 2016 12:11:18 +0200
Subject: [gdal-dev] gdal_translate issues downloading GeoTIFF with
	TMS/WMTS/AGS
In-Reply-To: <201605301720.23749.even.rouault@spatialys.com>
References: <CAFcOn2-Hyp2hG=HuOKpAr-sh1SaWVJV06RgBEd2-o-=NLc4rAQ@mail.gmail.com>
 <201605301720.23749.even.rouault@spatialys.com>
Message-ID: <CAFcOn292ZkfPsOm+0wPy74gavMsKOTLreKpbu6WiicGLX0fP1w@mail.gmail.com>

Hi Even

Merci beaucoups! That calculation of SizeX/SizeY (zoom level 19 and
tiles of size 256 => 134217728 ( 256 * 2^19)) helped.

Two small issues remained using the AGS and "arcgisonline
World_Imagery" (I'm working with GDAL 2.0.2, released 2016/01/26):

1. That ImageSR=102100 causes an error ("ERROR 6: EPSG PCS/GCS code
102100 not found in EPSG support files...") so I had to add "-a_srs
epsg:3857"

2. When adding "-co TILED=YES" the resulting image got grey and
unsuable. This tiling worked e.g. using openstreetmap TMS.

:Stefan

2016-05-30 17:20 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:
> Stefan,
>
>> 1. What I get, is a result made of tiles from zoom level 17 or so. But
>> I'd like to get the highest resolution i.e. from zoom level 19 (and
>> "-tr 0.1 0.1" does not help with that): How can I do that?
>
> See below comments in the XML
>
>>
>> 2. Is there an option to slow down http requests (like 10 per sec.) in
>> order to save resources of the service? (Should I write an issue?)
>
> AFAIK there's no option for limitation of the number of requests in this
> driver.
>
> Even
>
>>
>> (Finally I will reproject the GeoTIFF to a local SRS using gdalwarp.)
>>
>> :Stefan
>>
>> [1]
>> http://tools.geofabrik.de/calc/#type=geofabrik_standard&bbox=8.810788393,4
>> 7.221163925,8.8263881207,47.2283918446&tab=1&proj=EPSG:4326&places=2
>>
>> [2] --- ::: File gdal_tiles_openstreetmap.xml ::: --
>> <GDAL_WMS>
>>     <Service name="AGS">
>>
>> <ServerUrl>https://server.arcgisonline.com/ArcGIS/rest/services/World_Imag
>> ery/MapServer</ServerUrl> <ImageFormat>png32</ImageFormat>
>>         <Transparent>true</Transparent>
>>         <ImageSR>102100</ImageSR>
>>         <Layers></Layers>
>>         <BBoxOrder>xyXY</BBoxOrder>
>>     </Service>
>>     <DataWindow>
>>         <UpperLeftX>-20037508.34278700</UpperLeftX>
>>         <UpperLeftY>20037508.34278700</UpperLeftY>
>>         <LowerRightX>20037508.34278103</LowerRightX>
>>         <LowerRightY>-20037508.34278103</LowerRightY>
>>         <SizeX>40075016</SizeX>
>>         <SizeY>40075016</SizeY>
>
> --> This is a unusual size for a X/Y/Z tiling system. For zoom level 19 and
> tiles of size 256, that should be 134217728 ( 256 * 2^19)
>
>>     </DataWindow>
>
>>     <BlockSizeX>512</BlockSizeX>
>>     <BlockSizeY>512</BlockSizeY>
>
> --> should be 256
>
>>     <Projection>EPSG:3857</Projection>
>>     <BandsCount>4</BandsCount>
>>     <ClampRequests>true</ClampRequests>
>>     <UserAgent>Mozilla/5.0</UserAgent>
>>     <ZeroBlockHttpCodes>499,204,404</ZeroBlockHttpCodes>
>>     <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
>> </GDAL_WMS>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com

From alexhighviz at hotmail.com  Tue May 31 04:46:23 2016
From: alexhighviz at hotmail.com (alex)
Date: Tue, 31 May 2016 12:46:23 +0100
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <574861AE.8070000@gmail.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
 <574861AE.8070000@gmail.com>
Message-ID: <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>

>[Dmitry Baryshnikov]
>
>The work is done taking into considerations this link:
>https://trac.osgeo.org/gdal/wiki/CMake
>Also, there were some ideas about gdal source code reorganisation in
>dev-list.
>This is second turn of cmakefication of GDAL.
>The lib_gdal repository synced with gdal trunk periodically (there is a
>python script in etc folder
>(https://github.com/nextgis-borsch/lib_gdal/blob/master/etc/cmake-build-
>helpers/gdal_restructure.py)
>to do it). Now the sources are 2.1 release version. The different GDAL
>version support will be added in future.
>
>I think current lib_gdal is not ready to switch trunk (not all drivers
>ready, not all bindings ready, etc.), but very close (see
>https://github.com/nextgis-borsch/lib_gdal/blob/master/README.md about
>work status).
>

Hi Dmitry and others,

I can see that you are making a great effort, and as far as I can tell with great progress too. 

Do you know why the rest of the list is silent on this? Are the GDAL developers not interested in cmakeification or are they in silent agreement with your approach? 

Is nobody else building both 32 and 64 bit versions of GDAL?

Am I the only one who had great trouble getting GDAL (plus PROJ and GEOS) to compile when I was new to it?

With kind regards, Alex



From jmckenna at gatewaygeomatics.com  Tue May 31 05:00:16 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 31 May 2016 09:00:16 -0300
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
 <574861AE.8070000@gmail.com> <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
Message-ID: <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>

On 2016-05-31 8:46 AM, alex wrote:
>
> Hi Dmitry and others,
>
> I can see that you are making a great effort, and as far as I can tell with great progress too.
>
> Do you know why the rest of the list is silent on this? Are the GDAL developers not interested in cmakeification or are they in silent agreement with your approach?

I for one am not interested in 'cmakeification' of GDAL.  For the MS4W 
community, I build 32 and 64 bit versions, for the full stack of Apache, 
PHP, MapServer, GDAL (I counted recently and it is now over 200 
libraries) - and the few projects that use cmake are the troublesome 
ones.  (for example, MapServer switched to cmake but no one is 
maintaining the mapscript parts of cmake, which means I have kept my own 
makefiles alive, in order to build all of MapServer).

I am very against cmake, I have had terrible experiences.  I am all for 
sharing our makefiles and making life easier, than using a fancy cmake 
system that is not maintained.

-jeff

-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/




From damian.dixon at gmail.com  Tue May 31 05:24:15 2016
From: damian.dixon at gmail.com (Damian Dixon)
Date: Tue, 31 May 2016 13:24:15 +0100
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com>
 <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl> <574861AE.8070000@gmail.com>
 <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
Message-ID: <CAJjdW1ws-hwYhii4K=4EMOu==Jm4cNM12cMdpRxeOyxOJWy-tA@mail.gmail.com>

I'm going to take the slightly opposing view...

I would prefer CMake to be supported particularly for generating WIndows
builds as the nmake build is painful to configure and maintain. I spent
ages getting our original build working with the configurations I needed,
way more time than I expected.

For general Linux/Solaris I don't particularly care if 3rd party libraries
such as GDAL are CMake or make/autoconf as these tend to just work as long
as they have been crafted correctly for cross compilation.

Our internal build system on non-Windows is built around CMake and we have
CMake functions to build 3rd party libraries using many different build
approaches.

I've found that there are some very bad configurations for autoconf and for
CMake out there. Some so bad that I've had to craft my own CMake or
makefile.

In general I prefer CMake as it allows me to build a library on Windows or
Linux without worrying about nmake, visual studio version or makefile
platform/configuration.


Regards Damian


On 31 May 2016 at 13:00, Jeff McKenna <jmckenna at gatewaygeomatics.com> wrote:

> On 2016-05-31 8:46 AM, alex wrote:
>
>>
>> Hi Dmitry and others,
>>
>> I can see that you are making a great effort, and as far as I can tell
>> with great progress too.
>>
>> Do you know why the rest of the list is silent on this? Are the GDAL
>> developers not interested in cmakeification or are they in silent agreement
>> with your approach?
>>
>
> I for one am not interested in 'cmakeification' of GDAL.  For the
> ​​
> MS4W community, I build 32 and 64 bit versions, for the full stack of
> Apache, PHP, MapServer, GDAL (I counted recently and it is now over 200
> libraries) - and the few projects that use cmake are the troublesome ones.
> (for example, MapServer switched to cmake but no one is maintaining the
> mapscript parts of cmake, which means I have kept my own makefiles alive,
> in order to build all of MapServer).
>
> I am very against cmake, I have had terrible experiences.  I am all for
> sharing our makefiles and making life easier, than using a fancy cmake
> system that is not maintained.
>
> -jeff
>
> --
> Jeff McKenna
> MapServer Consulting and Training Services
> http://www.gatewaygeomatics.com/
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160531/b9929c4d/attachment.html>

From jmckenna at gatewaygeomatics.com  Tue May 31 05:42:50 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 31 May 2016 09:42:50 -0300
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <CAJjdW1ws-hwYhii4K=4EMOu==Jm4cNM12cMdpRxeOyxOJWy-tA@mail.gmail.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
 <574861AE.8070000@gmail.com> <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
 <CAJjdW1ws-hwYhii4K=4EMOu==Jm4cNM12cMdpRxeOyxOJWy-tA@mail.gmail.com>
Message-ID: <fc00c897-ee30-4072-f8f6-587bb3a19967@gatewaygeomatics.com>

On 2016-05-31 9:24 AM, Damian Dixon wrote:
> I'm going to take the slightly opposing view...
>
> I would prefer CMake to be supported particularly for generating WIndows
> builds as the nmake build is painful to configure and maintain. I spent
> ages getting our original build working with the configurations I
> needed, way more time than I expected.
>
> For general Linux/Solaris I don't particularly care if 3rd party
> libraries such as GDAL are CMake or make/autoconf as these tend to just
> work as long as they have been crafted correctly for cross compilation.
>
> Our internal build system on non-Windows is built around CMake and we
> have CMake functions to build 3rd party libraries using many different
> build approaches.
>
> I've found that there are some very bad configurations for autoconf and
> for CMake out there. Some so bad that I've had to craft my own CMake or
> makefile.
>
> In general I prefer CMake as it allows me to build a library on Windows
> or Linux without worrying about nmake, visual studio version or makefile
> platform/configuration.
>

Yes you touched on why cmake is popular - with non-Windows environments 
and supporting many platforms. However if the question is for building 
GDAL on Windows (and this is what we are talking about), then there is 
no question that makefiles are the easiest.  To please code maintainers 
cmake is used because it is easier to maintain for so many platforms; 
I've seen several projects make this switch, and not a single person is 
maintaining the Windows part of cmake in their code.  It's like the 
cmake switch means to many that "oh ok Windows is supported by cmake I 
assume", which is not the case.

Again, I can only speak from experience.  I wish that magically I am 
wrong for GDAL, and cmake on Windows is maintained for each and every 
GDAL driver :)  (whoa that is a big wish)

-jeff

-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From jluis at ualg.pt  Tue May 31 05:44:44 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Tue, 31 May 2016 13:44:44 +0100
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
 <574861AE.8070000@gmail.com> <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
Message-ID: <op.yibu0ue7dbaoe8@macmarilu>

I build 32 & 64 Windows versions for quite some time now and would be  
interested in Cmake if I were to start now but since the nmake works so  
well for me (plus dependencies) I don't really care about a replacement.

Joaquim

>> [Dmitry Baryshnikov]
>>
>> The work is done taking into considerations this link:
>> https://trac.osgeo.org/gdal/wiki/CMake
>> Also, there were some ideas about gdal source code reorganisation in
>> dev-list.
>> This is second turn of cmakefication of GDAL.
>> The lib_gdal repository synced with gdal trunk periodically (there is a
>> python script in etc folder
>> (https://github.com/nextgis-borsch/lib_gdal/blob/master/etc/cmake-build-
>> helpers/gdal_restructure.py)
>> to do it). Now the sources are 2.1 release version. The different GDAL
>> version support will be added in future.
>>
>> I think current lib_gdal is not ready to switch trunk (not all drivers
>> ready, not all bindings ready, etc.), but very close (see
>> https://github.com/nextgis-borsch/lib_gdal/blob/master/README.md about
>> work status).
>>
>
> Hi Dmitry and others,
>
> I can see that you are making a great effort, and as far as I can tell  
> with great progress too.
>
> Do you know why the rest of the list is silent on this? Are the GDAL  
> developers not interested in cmakeification or are they in silent  
> agreement with your approach?
>
> Is nobody else building both 32 and 64 bit versions of GDAL?
>
> Am I the only one who had great trouble getting GDAL (plus PROJ and  
> GEOS) to compile when I was new to it?
>
> With kind regards, Alex
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev

From bishop.dev at gmail.com  Tue May 31 05:52:28 2016
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Tue, 31 May 2016 15:52:28 +0300
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
 <574861AE.8070000@gmail.com> <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
Message-ID: <574D890C.9060807@gmail.com>

2Jeff

This is the only one example of building GDAL and other libraries and 
this is not CMake problem of MapScript support, but MapServer's team 
priorities.

Building libraries for MS4W is only one activity. But there are lot of 
others which developer may need:

- configure GDAL and dependencies via GUI in crossplatform manner
- configure GDAL and dependencies in make scripts of developer's 
application in crossplatform manner (for example I build my library with 
GDAL and it dependencies for Android/iOS with needed set of drivers and 
options and toolsets, and use the same cmake as for desktop/server)
- build software and dependency with one set of compiler/linker
- generate projects for supported RAD utilities
- etc.

2Alex

The list is silent as we already discussed CMake in GDAL so many times.
There is no problem that two versions of build system exists - original 
and cmake.
All contribution goes to GDAL trunk. Periodically I sync trunk with 
nextgis-borsch/lib_gdal

The borsch cmake scripts are not stable yet and we are still fixing them.
Now I don't see any topic to discuss here.

2All
By the way I'll have a talk about this new build system on FOSS4G Bonn, 
this will be good place to discuss this.

Best regards,
     Dmitry

31.05.2016 15:00, Jeff McKenna пишет:
> On 2016-05-31 8:46 AM, alex wrote:
>>
>> Hi Dmitry and others,
>>
>> I can see that you are making a great effort, and as far as I can 
>> tell with great progress too.
>>
>> Do you know why the rest of the list is silent on this? Are the GDAL 
>> developers not interested in cmakeification or are they in silent 
>> agreement with your approach?
>
> I for one am not interested in 'cmakeification' of GDAL.  For the MS4W 
> community, I build 32 and 64 bit versions, for the full stack of 
> Apache, PHP, MapServer, GDAL (I counted recently and it is now over 
> 200 libraries) - and the few projects that use cmake are the 
> troublesome ones.  (for example, MapServer switched to cmake but no 
> one is maintaining the mapscript parts of cmake, which means I have 
> kept my own makefiles alive, in order to build all of MapServer).
>
> I am very against cmake, I have had terrible experiences.  I am all 
> for sharing our makefiles and making life easier, than using a fancy 
> cmake system that is not maintained.
>
> -jeff
>


From jluis at ualg.pt  Tue May 31 06:03:51 2016
From: jluis at ualg.pt (Joaquim Luis)
Date: Tue, 31 May 2016 14:03:51 +0100
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <fc00c897-ee30-4072-f8f6-587bb3a19967@gatewaygeomatics.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
 <574861AE.8070000@gmail.com> <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
 <CAJjdW1ws-hwYhii4K=4EMOu==Jm4cNM12cMdpRxeOyxOJWy-tA@mail.gmail.com>
 <fc00c897-ee30-4072-f8f6-587bb3a19967@gatewaygeomatics.com>
Message-ID: <op.yibvwpu3dbaoe8@macmarilu>


> Again, I can only speak from experience.  I wish that magically I am  
> wrong for GDAL, and cmake on Windows is maintained for each and every  
> GDAL driver :)  (whoa that is a big wish)
>
> -jeff
>

Jeff,

Life doesn't have to be so painful with Cmake on Windows. For example in  
GMT we use a optionally include ConfigUser.cmake where one can define  
dependencies that are built in non-cmake ways.
For example to add the GDAL dependency I define this in ConfigUser.cmake  
file. Here the the ${VC} and ${BITAGE} are just variables used to select  
different VS versions and "bitages".
So not all the dependencies need to be build with Cmake too.

   # set location of gdal (can be root directory, path to header file or  
path to gdal-config):
   set(GDAL_DIR "C:/programs/GDALtrunk/gdal/compileds/${VC}_${BITAGE}")
   set(GDAL_LIBRARY  
"C:/programs/GDALtrunk/gdal/compileds/${VC}_${BITAGE}/lib/gdal_i.lib")

Joaquim

From alexhighviz at hotmail.com  Tue May 31 06:39:07 2016
From: alexhighviz at hotmail.com (alex)
Date: Tue, 31 May 2016 14:39:07 +0100
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <574D890C.9060807@gmail.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <57480EDE.9030908@gmail.com> <DUB117-DS74747B8AE1555097078BAB4420@phx.gbl>
 <574861AE.8070000@gmail.com> <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
 <574D890C.9060807@gmail.com>
Message-ID: <DUB117-DS40A5ED01226230A6FF106FB4460@phx.gbl>

>2Alex
>
>The list is silent as we already discussed CMake in GDAL so many times.
>There is no problem that two versions of build system exists - original
>and cmake.
>All contribution goes to GDAL trunk. Periodically I sync trunk with
>nextgis-borsch/lib_gdal
>
>The borsch cmake scripts are not stable yet and we are still fixing them.
>Now I don't see any topic to discuss here.
>

OK, I did not mean for the list to rehearse stale arguments. From my outside perspective it appeared as if you were making brave progress on cmake, but somehow it was not picked up by GDAL itself.



From even.rouault at spatialys.com  Tue May 31 07:06:51 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 31 May 2016 16:06:51 +0200
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
Message-ID: <201605311606.51380.even.rouault@spatialys.com>

> On 2016-05-31 8:46 AM, alex wrote:
> > Hi Dmitry and others,
> > 
> > I can see that you are making a great effort, and as far as I can tell
> > with great progress too.
> > 
> > Do you know why the rest of the list is silent on this? Are the GDAL
> > developers not interested in cmakeification or are they in silent
> > agreement with your approach?

As far as I'm concerned, it is more I don't have much experience with setting 
up cmake build system, so I can't really help.
One issue I see with the approach that has been taken is that it mixes both a 
new build system + a tree re-organization. So it means there cannot be a 
transitionning phase where cmake would be a in-tree alternative experimental 
build system that would grow over time until being feature complete (drivers 
and OS support), with the others one still being the "official" ones. The out-
of-tree approach probably makes the potential for external contributions a bit 
less likely.

I haven't looked deeply enough at Dmitry's work but what I'd enjoy to see from 
a new build system is a more modular way of building drivers. Currently our 
build scripts do not allow to easily select if a driver must be built in the 
core lib or as a plugin in a separate shared object, so the former (all built 
in) is what is done generally. Which can cause packaging headaches since the 
packager has to make choice of which external library GDAL should depend on, 
which has consequences on the effective licensing of the lib (for ex, seeing 
https://packages.debian.org/sid/libgdal20 linking against poppler make GDAL 
use effectively bound to GPL)
I can in fact imagine 2 uses cases:
- you are a packager, download all the dependencies and build GDAL core, 
built-in drivers and plugin drivers all at once, but generating separated 
packages gdal-lib, gdal-bin, gdal-pdf, ...
- the case of proprietary drivers where some distributions cannot distribute 
the resulting non-free binary, hence requiring the user to build it from GDAL 
sources + SDK. So you have those gdal-ecw-build scripts currently that are 
managed out of tree. Would be cool if the main build system would allow to 
build those plugins as a separate target from building the core lib (possibly 
rebuilding only the driver you're interested in, while using the system core 
lib)

> 
> I for one am not interested in 'cmakeification' of GDAL.  For the MS4W
> community, I build 32 and 64 bit versions, for the full stack of Apache,
> PHP, MapServer, GDAL (I counted recently and it is now over 200
> libraries) - and the few projects that use cmake are the troublesome
> ones.  (for example, MapServer switched to cmake but no one is
> maintaining the mapscript parts of cmake, which means I have kept my own
> makefiles alive, in order to build all of MapServer).
> 
> I am very against cmake, I have had terrible experiences. 

Jeff,
It sounds your issue with cmake is more mapscript not receiving attention, 
rather than a defect from cmake itself, right ? I've used cmake to build QGIS 
on Linux & Windows and can't recall any particular issue I can really 
attribute to cmake (besides Windows being a pain for me in general :-))

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jmckenna at gatewaygeomatics.com  Tue May 31 07:20:17 2016
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 31 May 2016 11:20:17 -0300
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <201605311606.51380.even.rouault@spatialys.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
 <201605311606.51380.even.rouault@spatialys.com>
Message-ID: <ae7d84f1-0220-e1f2-efea-dacc0e31b247@gatewaygeomatics.com>

On 2016-05-31 11:06 AM, Even Rouault wrote:
>
> Jeff,
> It sounds your issue with cmake is more mapscript not receiving attention,
> rather than a defect from cmake itself, right ? I've used cmake to build QGIS
> on Linux & Windows and can't recall any particular issue I can really
> attribute to cmake (besides Windows being a pain for me in general :-))
>
> Even
>

I used MapServer as one example.  I have other project examples as well. 
  For most of the projects that use cmake in the MS4W stack I maintain 
makefiles - these projects switched to cmake but did not care to test on 
Windows.  So, I live on Windows and must maintain makefiles.  See what I 
am saying? :)

This is very common.  I speak from experience.  I agree, on paper this 
seems like an excellent idea :)

-jeff




-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From mohammedrashadkm at gmail.com  Tue May 31 08:31:06 2016
From: mohammedrashadkm at gmail.com (Rashad Kanavath)
Date: Tue, 31 May 2016 17:31:06 +0200
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <201605311606.51380.even.rouault@spatialys.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
 <201605311606.51380.even.rouault@spatialys.com>
Message-ID: <CANNqv9ccGxo++KWZLt-C0VUvz+V_vcHJLz0LEN7xwM2-7pqroQ@mail.gmail.com>

On Tue, May 31, 2016 at 4:06 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> > On 2016-05-31 8:46 AM, alex wrote:
> > > Hi Dmitry and others,
> > >
> > > I can see that you are making a great effort, and as far as I can tell
> > > with great progress too.
> > >
> > > Do you know why the rest of the list is silent on this? Are the GDAL
> > > developers not interested in cmakeification or are they in silent
> > > agreement with your approach?
>
> As far as I'm concerned, it is more I don't have much experience with
> setting
> up cmake build system, so I can't really help.
> One issue I see with the approach that has been taken is that it mixes
> both a
> new build system + a tree re-organization. So it means there cannot be a
> transitionning phase where cmake would be a in-tree alternative
> experimental
> build system that would grow over time until being feature complete
> (drivers
> and OS support), with the others one still being the "official" ones. The
> out-
> of-tree approach probably makes the potential for external contributions a
> bit
> less likely.
>
> I haven't looked deeply enough at Dmitry's work but what I'd enjoy to see
> from
> a new build system is a more modular way of building drivers. Currently our
> build scripts do not allow to easily select if a driver must be built in
> the
> core lib or as a plugin in a separate shared object, so the former (all
> built
> in) is what is done generally. Which can cause packaging headaches since
> the
> packager has to make choice of which external library GDAL should depend
> on,
> which has consequences on the effective licensing of the lib (for ex,
> seeing
> https://packages.debian.org/sid/libgdal20 linking against poppler make
> GDAL
> use effectively bound to GPL)
> I can in fact imagine 2 uses cases:
> - you are a packager, download all the dependencies and build GDAL core,
> built-in drivers and plugin drivers all at once, but generating separated
> packages gdal-lib, gdal-bin, gdal-pdf, ...
> - the case of proprietary drivers where some distributions cannot
> distribute
> the resulting non-free binary, hence requiring the user to build it from
> GDAL
> sources + SDK. So you have those gdal-ecw-build scripts currently that are
> managed out of tree. Would be cool if the main build system would allow to
> build those plugins as a separate target from building the core lib
> (possibly
> rebuilding only the driver you're interested in, while using the system
> core
> lib)
>

Hello Even,

You mean libgdal.so or whatever contains only gdal core libraries and all
others are plugins ?

Or you mean to go one more level and split gdal-core.so, gdal-port.so... +
the above plugins.


>
> > I for one am not interested in 'cmakeification' of GDAL.  For the MS4W
> > community, I build 32 and 64 bit versions, for the full stack of Apache,
> > PHP, MapServer, GDAL (I counted recently and it is now over 200
> > libraries) - and the few projects that use cmake are the troublesome
> > ones.  (for example, MapServer switched to cmake but no one is
> > maintaining the mapscript parts of cmake, which means I have kept my own
> > makefiles alive, in order to build all of MapServer).
> >
> > I am very against cmake, I have had terrible experiences.
>
> Jeff,
> It sounds your issue with cmake is more mapscript not receiving attention,
> rather than a defect from cmake itself, right ? I've used cmake to build
> QGIS
> on Linux & Windows and can't recall any particular issue I can really
> attribute to cmake (besides Windows being a pain for me in general :-))
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Regards,
   Rashad
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160531/8fdcfbad/attachment-0001.html>

From mohammedrashadkm at gmail.com  Tue May 31 08:35:16 2016
From: mohammedrashadkm at gmail.com (Rashad Kanavath)
Date: Tue, 31 May 2016 17:35:16 +0200
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <ae7d84f1-0220-e1f2-efea-dacc0e31b247@gatewaygeomatics.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <DUB117-DS37F763AC7CA66AE2D3EE07B4460@phx.gbl>
 <fcdfff59-2734-dc2a-c887-7d678e9da5ad@gatewaygeomatics.com>
 <201605311606.51380.even.rouault@spatialys.com>
 <ae7d84f1-0220-e1f2-efea-dacc0e31b247@gatewaygeomatics.com>
Message-ID: <CANNqv9cY0K1ws_roY7N2p-JkfDgmJr60peVEHdM6jY=BKJcvCg@mail.gmail.com>

Hello Jeff,

On Tue, May 31, 2016 at 4:20 PM, Jeff McKenna <jmckenna at gatewaygeomatics.com
> wrote:

> On 2016-05-31 11:06 AM, Even Rouault wrote:
>
>>
>> Jeff,
>> It sounds your issue with cmake is more mapscript not receiving attention,
>> rather than a defect from cmake itself, right ? I've used cmake to build
>> QGIS
>> on Linux & Windows and can't recall any particular issue I can really
>> attribute to cmake (besides Windows being a pain for me in general :-))
>>
>> Even
>>
>>
> I used MapServer as one example.  I have other project examples as well.
> For most of the projects that use cmake in the MS4W stack I maintain
> makefiles - these projects switched to cmake but did not care to test on
> Windows.  So, I live on Windows and must maintain makefiles.  See what I am
> saying? :)
>
> This is very common.  I speak from experience.  I agree, on paper this
> seems like an excellent idea :)
>

I see (saw) what you are saying from my own experience. And it terrible
that it get untested on windows. But as you mentioned about working on
windows a lot, you can test and propose/ask for a fix. right?

Does all these projects you mentioned explicitly said they won't support
cmake build on windows? I had a similar one with libjpeg-turbo, they
support cmake build only on windows, even if someone provided a free patch
for any found problem on a *nix build. I mean that is crazy..

>
> -jeff
>
>
>
>
> --
> Jeff McKenna
> MapServer Consulting and Training Services
> http://www.gatewaygeomatics.com/
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> http://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Regards,
   Rashad
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160531/d8ef0d4e/attachment.html>

From even.rouault at spatialys.com  Tue May 31 09:23:14 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 31 May 2016 18:23:14 +0200
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <CANNqv9ccGxo++KWZLt-C0VUvz+V_vcHJLz0LEN7xwM2-7pqroQ@mail.gmail.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <201605311606.51380.even.rouault@spatialys.com>
 <CANNqv9ccGxo++KWZLt-C0VUvz+V_vcHJLz0LEN7xwM2-7pqroQ@mail.gmail.com>
Message-ID: <201605311823.14762.even.rouault@spatialys.com>

Le mardi 31 mai 2016 17:31:06, Rashad Kanavath a écrit :
> On Tue, May 31, 2016 at 4:06 PM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > > On 2016-05-31 8:46 AM, alex wrote:
> > > > Hi Dmitry and others,
> > > > 
> > > > I can see that you are making a great effort, and as far as I can
> > > > tell with great progress too.
> > > > 
> > > > Do you know why the rest of the list is silent on this? Are the GDAL
> > > > developers not interested in cmakeification or are they in silent
> > > > agreement with your approach?
> > 
> > As far as I'm concerned, it is more I don't have much experience with
> > setting
> > up cmake build system, so I can't really help.
> > One issue I see with the approach that has been taken is that it mixes
> > both a
> > new build system + a tree re-organization. So it means there cannot be a
> > transitionning phase where cmake would be a in-tree alternative
> > experimental
> > build system that would grow over time until being feature complete
> > (drivers
> > and OS support), with the others one still being the "official" ones. The
> > out-
> > of-tree approach probably makes the potential for external contributions
> > a bit
> > less likely.
> > 
> > I haven't looked deeply enough at Dmitry's work but what I'd enjoy to see
> > from
> > a new build system is a more modular way of building drivers. Currently
> > our build scripts do not allow to easily select if a driver must be
> > built in the
> > core lib or as a plugin in a separate shared object, so the former (all
> > built
> > in) is what is done generally. Which can cause packaging headaches since
> > the
> > packager has to make choice of which external library GDAL should depend
> > on,
> > which has consequences on the effective licensing of the lib (for ex,
> > seeing
> > https://packages.debian.org/sid/libgdal20 linking against poppler make
> > GDAL
> > use effectively bound to GPL)
> > I can in fact imagine 2 uses cases:
> > - you are a packager, download all the dependencies and build GDAL core,
> > built-in drivers and plugin drivers all at once, but generating separated
> > packages gdal-lib, gdal-bin, gdal-pdf, ...
> > - the case of proprietary drivers where some distributions cannot
> > distribute
> > the resulting non-free binary, hence requiring the user to build it from
> > GDAL
> > sources + SDK. So you have those gdal-ecw-build scripts currently that
> > are managed out of tree. Would be cool if the main build system would
> > allow to build those plugins as a separate target from building the core
> > lib (possibly
> > rebuilding only the driver you're interested in, while using the system
> > core
> > lib)
> 
> Hello Even,
> 
> You mean libgdal.so or whatever contains only gdal core libraries and all
> others are plugins ?

I mean having a choice per-driver, especially for those that depend on 
external libs., to decide if they are included in libgdal.so or if they must 
be standalone plugin (or potentially not compiled at all). 


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mohammedrashadkm at gmail.com  Tue May 31 10:30:16 2016
From: mohammedrashadkm at gmail.com (Rashad Kanavath)
Date: Tue, 31 May 2016 19:30:16 +0200
Subject: [gdal-dev] Building GDAL on Windows 32 and 64 bit
In-Reply-To: <201605311823.14762.even.rouault@spatialys.com>
References: <DUB117-DS46EBE2504FF58C469CFE58B4420@phx.gbl>
 <201605311606.51380.even.rouault@spatialys.com>
 <CANNqv9ccGxo++KWZLt-C0VUvz+V_vcHJLz0LEN7xwM2-7pqroQ@mail.gmail.com>
 <201605311823.14762.even.rouault@spatialys.com>
Message-ID: <CANNqv9emth96njbiePjz8vQTszE-jjZuDbQcXDK2nfmjT2VGFg@mail.gmail.com>

On Tue, May 31, 2016 at 6:23 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Le mardi 31 mai 2016 17:31:06, Rashad Kanavath a écrit :
> > On Tue, May 31, 2016 at 4:06 PM, Even Rouault <
> even.rouault at spatialys.com>
> >
> > wrote:
> > > > On 2016-05-31 8:46 AM, alex wrote:
> > > > > Hi Dmitry and others,
> > > > >
> > > > > I can see that you are making a great effort, and as far as I can
> > > > > tell with great progress too.
> > > > >
> > > > > Do you know why the rest of the list is silent on this? Are the
> GDAL
> > > > > developers not interested in cmakeification or are they in silent
> > > > > agreement with your approach?
> > >
> > > As far as I'm concerned, it is more I don't have much experience with
> > > setting
> > > up cmake build system, so I can't really help.
> > > One issue I see with the approach that has been taken is that it mixes
> > > both a
> > > new build system + a tree re-organization. So it means there cannot be
> a
> > > transitionning phase where cmake would be a in-tree alternative
> > > experimental
> > > build system that would grow over time until being feature complete
> > > (drivers
> > > and OS support), with the others one still being the "official" ones.
> The
> > > out-
> > > of-tree approach probably makes the potential for external
> contributions
> > > a bit
> > > less likely.
> > >
> > > I haven't looked deeply enough at Dmitry's work but what I'd enjoy to
> see
> > > from
> > > a new build system is a more modular way of building drivers. Currently
> > > our build scripts do not allow to easily select if a driver must be
> > > built in the
> > > core lib or as a plugin in a separate shared object, so the former (all
> > > built
> > > in) is what is done generally. Which can cause packaging headaches
> since
> > > the
> > > packager has to make choice of which external library GDAL should
> depend
> > > on,
> > > which has consequences on the effective licensing of the lib (for ex,
> > > seeing
> > > https://packages.debian.org/sid/libgdal20 linking against poppler make
> > > GDAL
> > > use effectively bound to GPL)
> > > I can in fact imagine 2 uses cases:
> > > - you are a packager, download all the dependencies and build GDAL
> core,
> > > built-in drivers and plugin drivers all at once, but generating
> separated
> > > packages gdal-lib, gdal-bin, gdal-pdf, ...
> > > - the case of proprietary drivers where some distributions cannot
> > > distribute
> > > the resulting non-free binary, hence requiring the user to build it
> from
> > > GDAL
> > > sources + SDK. So you have those gdal-ecw-build scripts currently that
> > > are managed out of tree. Would be cool if the main build system would
> > > allow to build those plugins as a separate target from building the
> core
> > > lib (possibly
> > > rebuilding only the driver you're interested in, while using the system
> > > core
> > > lib)
> >
> > Hello Even,
> >
> > You mean libgdal.so or whatever contains only gdal core libraries and all
> > others are plugins ?
>
> I mean having a choice per-driver, especially for those that depend on
> external libs., to decide if they are included in libgdal.so or if they
> must
> be standalone plugin (or potentially not compiled at all).
>
> Yes. cmake can help in that direction.

>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>



-- 
Regards,
   Rashad
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20160531/04ed7390/attachment.html>

From even.rouault at spatialys.com  Tue May 31 13:20:56 2016
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 31 May 2016 22:20:56 +0200
Subject: [gdal-dev] Next maintenance releases
Message-ID: <201605312220.56652.even.rouault@spatialys.com>

Hi,

Looking at https://trac.osgeo.org/gdal/roadmap, I thought we could issue RCs 
for 1.11.5, 2.0.4 and 2.1.1 for end of June.
As the transition to 2.X is well engaged in depending apps/libs, 1.11.5 will 
probably be the last one in the 1.11 series.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

