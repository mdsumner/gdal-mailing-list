From pi_ml at sourcepole.com  Fri Jun  1 00:26:51 2018
From: pi_ml at sourcepole.com (Pirmin Kalberer)
Date: Fri, 01 Jun 2018 09:26:51 +0200
Subject: [gdal-dev] Using GeoPackage as vector tile container?
In-Reply-To: <1595125.cq4xAoSzd1@even-i700>
References: <24dbcdf0ab9b4a00aa2cda8b9f1060e2@C119S212VM042.msvyvi.vaha.local>
 <1595125.cq4xAoSzd1@even-i700>
Message-ID: <1814692.lfWtWK8EKx@polarwind3>

Hi Jukka,

Am Donnerstag, 31. Mai 2018, 16:21:51 CEST schrieb Even Rouault:
> On jeudi 31 mai 2018 14:02:32 CEST Rahkonen Jukka (MML) wrote:
> > Hi,
> > 
> > I wonder what would it need to store vector tiles into GeoPackage instead
> > of MBTiles. Officially probably a new extension like the Tiled Gridded
> > Coverage Data extension, but wouln't it technically be rather simple to
> > write vector tiles as BLOBs into the tile_data column instead of png or
> > jpeg BLOBs?
> 
> "Rather simple", well that's arguable from an implementation point of view,
> since the architecture of the MVT and GeoPackage drivers isn't naturally
> compatible to make them work together currently.
> 
> But conceptually yes, the vector tiles as BLOBS of a tile pyramid user table
> would be a good fit You would also need to write metadata to describe the
> layers and attributes, to avoid having to scan all the tiles to retrieve it
> (at least for OGR point of view that has a fixed schema constraint to
> expose vector features)

What speaks against declaring a Gpkg-Extension "MBTiles" which lets GDAL know 
that MVT's are stored in MBTile layout? MVT's are quite special geometries, 
since they are stored in screen coordinates.

Regards
Pirmin




From Jason.Sandall at cheshireeast.gov.uk  Fri Jun  1 03:51:52 2018
From: Jason.Sandall at cheshireeast.gov.uk (SANDALL, Jason)
Date: Fri, 1 Jun 2018 10:51:52 +0000
Subject: [gdal-dev] [OFFICIAL] MSSQL GDAL bulk insert with append to
	varchar(max) column
Message-ID: <LO1P123MB13140E2C6EB18151C9AF85B4BC620@LO1P123MB1314.GBRP123.PROD.OUTLOOK.COM>

Hi,

After upgrading GDAL to a version that supports MSSQL bulk inserts (v2.2.3) I have found an issue with data append operations using ogr2ogr between MSSQL spatial tables. If the destination table has a column of type varchar(max) then it is only populated with the first character from the source record. No such issue for nvarchar(max) types or varchar with a restricted length.
The GDAL command I am using is simply:
ogr2ogr -append -f MSSQLSpatial "MSSQL:server=SQLSERVER;database=DATABASE;trusted_connection=yes" "MSSQL:server=SQLSERVER;database=DATABASE;trusted_connection=yes;tables=SOURCETABLE" -nln DESTTABLE

The only work around for this is to disable bulk inserts first with:
SET MSSQLSPATIAL_USE_BCP=NO

We are using MSSQL Server 2014.  Has anyone else come across this?

Thanks
Jason

************************************************************************
Confidentiality: This email and its contents and any attachments are intended only for the above named. As the email may contain confidential or legally privileged information, if you are not the above named person or responsible for delivery to the above named, or suspect that you are not an intended recipient please delete or destroy the email and any attachments immediately.

Security and Viruses: This note confirms that this email message has been swept for the presence of computer viruses. We cannot accept any responsibility for any damage or loss caused by software viruses.

Monitoring: The Council undertakes monitoring of both incoming and outgoing emails. You should therefore be aware that if you send an email to a person within the Council it may be subject to any monitoring deemed necessary by the organisation from time to time. The views of the author may not necessarily reflect those of the Council.

Access as a public body: The Council may be required to disclose this email (or any response to it) under the Freedom of Information Act, 2000, unless the information in it is covered by one of the exemptions in the Act.

Legal documents: The Council does not accept service of legal documents by email.
************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180601/b7a38f3a/attachment.html>

From even.rouault at spatialys.com  Fri Jun  1 08:21:01 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 01 Jun 2018 17:21:01 +0200
Subject: [gdal-dev] Migration from travis-ci.org to travis-ci.com
Message-ID: <2999508.QGZ0W74Rr0@even-i700>

Hi,

Thanks to OSGeo financial support, repositories under the OSGeo github 
organizations have now a maximum 13 concurrent jobs available on travis-ci.com

Note that the builds are now on the .com domain, and no longer on the .org. 
This is related to their on-going migration from the .org to the .com. The 
logs of the builds on .org are still available, but no new builds won't be 
triggered on the .org now.

So head to:

	https://travis-ci.com/OSGeo/gdal/
	https://travis-ci.com/OSGeo/proj.4/

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sean at mapbox.com  Fri Jun  1 17:25:27 2018
From: sean at mapbox.com (Sean Gillies)
Date: Fri, 1 Jun 2018 18:25:27 -0600
Subject: [gdal-dev] GDALCreateWarpedVRT and .msk files
In-Reply-To: <8054366.I7sMKQn0ta@even-i700>
References: <CADPhZXwGi7+yzmvGOGzJUVhuhMa0Pa7kk0gNPSmH7wi_R3EvDQ@mail.gmail.com>
 <36184371.QqbEObbW2N@even-i700>
 <CADPhZXxr1ggpuzCVhVo6AjM2fEFTcPSSF+cTjvfGP70SRjmzdA@mail.gmail.com>
 <8054366.I7sMKQn0ta@even-i700>
Message-ID: <CADPhZXxZQEpK0=Ecsyd43SPvvFgA09eP2ZdLJsuMmZuQ0ZEAZA@mail.gmail.com>

Hi Even,

I got waylaid in following up, but am finally doing so now. Yes, I can also
confirm that the .msk file is being read over the internet. I'm grateful
for the CURL logging in GDAL, it's very handy.

However, I'm perplexed by not being able to get the mask I expect from the
warped VRT I'm creating using GDALAutoCreateWarpedVRT. The source file has
a mask, but no mask materializes in the warped VRT. I have a WarpedVRT
class in Rasterio that calls GDALAutoCreateWarpedVRT and is equivalent to
the Python GDAL code you showed. It has a method that calls
GDALGetMaskFlags and here's what that reports.

with rasterio.open('https://oin-hotosm.s3.amazonaws.com/
5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif') as
src, WarpedVRT(src, dst_crs=src.crs) as vrt:
    print(vrt.mask_flag_enums)

# Output:
# ([<MaskFlags.all_valid: 1>], [<MaskFlags.all_valid: 1>],
[<MaskFlags.all_valid: 1>])

The source has a per-dataset mask, but this doesn't surface in the VRT. It
reports that all the pixels are valid.

Is this the intended behavior for VRTs? Are we required to materialize the
VRT and create an alpha band to contain the derived mask?

Thanks,

On Tue, Feb 20, 2018 at 4:57 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Sean,
>
>
>
> I've just tested with GDAL trunk and latest state of 2.2 branch (but I
> think that 2.2.2 should behave the same), and when using
> gdal.AutoCreateWarpedVRT() on your below mentionned dataset, the .msk file
> is read.
>
>
>
> $ CPL_CURL_VERBOSE=YES CPL_VSIL_CURL_ALLOWED_EXTENSIONS=tif,msk
> FILE=/vsicurl/http://oin-hotosm.s3.amazonaws.com/5a324a62255
> 3e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif python
>
> [...]
>
> >>> from osgeo import gdal
>
> >> import os
>
> >>> file = os.getenv('FILE')
>
> >>> src_ds = gdal.Open(file)
>
> [...]
>
> >>> ds = gdal.AutoCreateWarpedVRT(src_ds)
>
> [...]
>
> * Connected to oin-hotosm.s3.amazonaws.com (52.216.130.219) port 80 (#2)
>
> > GET /5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif.msk
> HTTP/1.1
>
> Host: oin-hotosm.s3.amazonaws.com
>
> Range: bytes=49152-114687
>
> Accept: */*
>
>
>
> < HTTP/1.1 206 Partial Content
>
> < x-amz-id-2: oXRmqP1A9HzNTn9soSOh9vQJzGUa+lA0GbsAKa0m51H8wvZCgS31y85NAXu6
> 0r3MMjRTz1TssYk=
>
> < x-amz-request-id: BC46544B595F1D30
>
> < Date: Tue, 20 Feb 2018 11:52:54 GMT
>
> < Last-Modified: Thu, 14 Dec 2017 09:58:29 GMT
>
> < ETag: "97b96b954a22be9d7bae0bfd1f33922b"
>
> < Accept-Ranges: bytes
>
> < Content-Range: bytes 49152-114687/1730078
>
> < Content-Type: binary/octet-stream
>
> < Content-Length: 65536
>
> < Server: AmazonS3
>
>
>
> [...]
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180601/66c6d39e/attachment.html>

From even.rouault at spatialys.com  Fri Jun  1 18:14:55 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 02 Jun 2018 03:14:55 +0200
Subject: [gdal-dev] GDALCreateWarpedVRT and .msk files
In-Reply-To: <CADPhZXxZQEpK0=Ecsyd43SPvvFgA09eP2ZdLJsuMmZuQ0ZEAZA@mail.gmail.com>
References: <CADPhZXwGi7+yzmvGOGzJUVhuhMa0Pa7kk0gNPSmH7wi_R3EvDQ@mail.gmail.com>
 <8054366.I7sMKQn0ta@even-i700>
 <CADPhZXxZQEpK0=Ecsyd43SPvvFgA09eP2ZdLJsuMmZuQ0ZEAZA@mail.gmail.com>
Message-ID: <1960032.xJWMATXAyy@even-i700>

On vendredi 1 juin 2018 18:25:27 CEST Sean Gillies wrote:
> Hi Even,
> 
> I got waylaid in following up, but am finally doing so now. Yes, I can also
> confirm that the .msk file is being read over the internet. I'm grateful
> for the CURL logging in GDAL, it's very handy.
> 
> However, I'm perplexed by not being able to get the mask I expect from the
> warped VRT I'm creating using GDALAutoCreateWarpedVRT. The source file has
> a mask, but no mask materializes in the warped VRT. I have a WarpedVRT
> class in Rasterio that calls GDALAutoCreateWarpedVRT and is equivalent to
> the Python GDAL code you showed. It has a method that calls
> GDALGetMaskFlags and here's what that reports.
> 
> with rasterio.open('https://oin-hotosm.s3.amazonaws.com/
> 5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif') as
> src, WarpedVRT(src, dst_crs=src.crs) as vrt:
>     print(vrt.mask_flag_enums)
> 
> # Output:
> # ([<MaskFlags.all_valid: 1>], [<MaskFlags.all_valid: 1>],
> [<MaskFlags.all_valid: 1>])
> 
> The source has a per-dataset mask, but this doesn't surface in the VRT. It
> reports that all the pixels are valid.

Hi Sean,

OK I now understand what you meant. The warper in general in GDAL (so not 
specific to the VRT warping) can use the mask of the input dataset, but 
doesn't generate one in output. However it should be able to generate an alpha 
band if you call GDALCreateWarpedVRT() with psOptions->nDstAlphaBand = 4 
(couldn't test easily, but hopefully should work)

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sean at mapbox.com  Sat Jun  2 11:00:19 2018
From: sean at mapbox.com (sean)
Date: Sat, 2 Jun 2018 12:00:19 -0600
Subject: [gdal-dev] GDALCreateWarpedVRT and .msk files
In-Reply-To: <1960032.xJWMATXAyy@even-i700>
References: <CADPhZXwGi7+yzmvGOGzJUVhuhMa0Pa7kk0gNPSmH7wi_R3EvDQ@mail.gmail.com>
 <8054366.I7sMKQn0ta@even-i700>
 <CADPhZXxZQEpK0=Ecsyd43SPvvFgA09eP2ZdLJsuMmZuQ0ZEAZA@mail.gmail.com>
 <1960032.xJWMATXAyy@even-i700>
Message-ID: <CADPhZXxGpdv1dRONfRvOegzi9U1a6crjgCqOvgktY+Dp_f4cCA@mail.gmail.com>

On Fri, Jun 1, 2018 at 7:14 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On vendredi 1 juin 2018 18:25:27 CEST Sean Gillies wrote:
> > Hi Even,
> >
> > I got waylaid in following up, but am finally doing so now. Yes, I can
> also
> > confirm that the .msk file is being read over the internet. I'm grateful
> > for the CURL logging in GDAL, it's very handy.
> >
> > However, I'm perplexed by not being able to get the mask I expect from
> the
> > warped VRT I'm creating using GDALAutoCreateWarpedVRT. The source file
> has
> > a mask, but no mask materializes in the warped VRT. I have a WarpedVRT
> > class in Rasterio that calls GDALAutoCreateWarpedVRT and is equivalent to
> > the Python GDAL code you showed. It has a method that calls
> > GDALGetMaskFlags and here's what that reports.
> >
> > with rasterio.open('https://oin-hotosm.s3.amazonaws.com/
> > 5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif') as
> > src, WarpedVRT(src, dst_crs=src.crs) as vrt:
> >     print(vrt.mask_flag_enums)
> >
> > # Output:
> > # ([<MaskFlags.all_valid: 1>], [<MaskFlags.all_valid: 1>],
> > [<MaskFlags.all_valid: 1>])
> >
> > The source has a per-dataset mask, but this doesn't surface in the VRT.
> It
> > reports that all the pixels are valid.
>
> Hi Sean,
>
> OK I now understand what you meant. The warper in general in GDAL (so not
> specific to the VRT warping) can use the mask of the input dataset, but
> doesn't generate one in output. However it should be able to generate an
> alpha
> band if you call GDALCreateWarpedVRT() with psOptions->nDstAlphaBand = 4
> (couldn't test easily, but hopefully should work)
>
> Even
>

After setting that warp option and setting the color interpretation of the
resulting band to GCI_AlphaBand, I'm in business!

Thanks, Even!

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180602/2d74e1e4/attachment.html>

From even.rouault at spatialys.com  Sat Jun  2 14:07:41 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 02 Jun 2018 23:07:41 +0200
Subject: [gdal-dev] GDALCreateWarpedVRT and .msk files
In-Reply-To: <CADPhZXxGpdv1dRONfRvOegzi9U1a6crjgCqOvgktY+Dp_f4cCA@mail.gmail.com>
References: <CADPhZXwGi7+yzmvGOGzJUVhuhMa0Pa7kk0gNPSmH7wi_R3EvDQ@mail.gmail.com>
 <1960032.xJWMATXAyy@even-i700>
 <CADPhZXxGpdv1dRONfRvOegzi9U1a6crjgCqOvgktY+Dp_f4cCA@mail.gmail.com>
Message-ID: <7839454.j3MNSXE6N5@even-i700>

> After setting that warp option and setting the color interpretation of the
> resulting band to GCI_AlphaBand, I'm in business!

Cool, I've pushed a small change to automatically set the GCI_AlphaBand color 
interpretation, and added a hint how to create the alpha band in the doc of 
the function.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From bradh at frogmouth.net  Sun Jun  3 00:34:02 2018
From: bradh at frogmouth.net (bradh at frogmouth.net)
Date: Sun, 3 Jun 2018 17:34:02 +1000
Subject: [gdal-dev] RasterIO support for zlib / deflate compression?
Message-ID: <00b201d3fb0d$3ee41d00$bcac5700$@frogmouth.net>

I've been looking at how much work it might take to implement a new NITF
compression value (IC=CC and IC=MC) which is basically just ZLIB DEFLATE
encoded blocks.

 

I'm mostly following the pattern used for JPEG, and its down to the part
where I just need to do the compression:

int

NITFWriteZLIBBlock( GDALDataset *poSrcDS, VSILFILE *fp,

                    int nBlockXOff, int nBlockYOff,

                    int nBlockXSize, int nBlockYSize,

                    GDALProgressFunc pfnProgress, void * pProgressData )

{

    CPLDebug("NITF", "nBlockXOff=%d/%d, nBlockYOff=%d/%d",

                     nBlockXOff, nBlockXSize, nBlockYOff, nBlockYSize);

    return true;

}

 

Before I start to dig around in zlib, is there any support in the RasterIO
level to do this? Anything else I could copy before reimplementing it
poorly?

 

Brad

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180603/6e2df1c9/attachment.html>

From even.rouault at spatialys.com  Sun Jun  3 03:41:07 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 03 Jun 2018 12:41:07 +0200
Subject: [gdal-dev] RasterIO support for zlib / deflate compression?
In-Reply-To: <00b201d3fb0d$3ee41d00$bcac5700$@frogmouth.net>
References: <00b201d3fb0d$3ee41d00$bcac5700$@frogmouth.net>
Message-ID: <8088466.a2UGf4Qcmh@even-i700>

Brad,

> I've been looking at how much work it might take to implement a new NITF
> compression value (IC=CC and IC=MC) which is basically just ZLIB DEFLATE
> encoded blocks.

Is it your own codec or something already standardized in NITF ?
If the former, I'd suggest that you consider ZStandard [1] compression 
instead. It performs much better than ZLIB Deflate. I've integrated it 
recently as a TIFF codec

> 
> Before I start to dig around in zlib, is there any support in the RasterIO
> level to do this? Anything else I could copy before reimplementing it
> poorly?

Nothing at the RasterIO() level that exposes compressed datastream.
For ZLib(), there's a tiny helper, CPLZLibDeflate(), that can help you a bit.

Even

[1] https://github.com/facebook/zstd

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From bradh at frogmouth.net  Sun Jun  3 15:55:34 2018
From: bradh at frogmouth.net (bradh at frogmouth.net)
Date: Mon, 4 Jun 2018 08:55:34 +1000
Subject: [gdal-dev] RasterIO support for zlib / deflate compression?
In-Reply-To: <8088466.a2UGf4Qcmh@even-i700>
References: <00b201d3fb0d$3ee41d00$bcac5700$@frogmouth.net>
 <8088466.a2UGf4Qcmh@even-i700>
Message-ID: <009301d3fb8d$fcf03ec0$f6d0bc40$@frogmouth.net>

Even,

It is not my compression, and although it isn't formalised yet, I think its
probably too late to change. I'll take it back to the NTB in any case. 
The specific case is for "good enough" compression of floating point data
without (further) loss.

Thanks for the CPLZLibDeflate() helper recommendation - appreciated.

Brad
 



From landa.martin at gmail.com  Mon Jun  4 23:12:59 2018
From: landa.martin at gmail.com (Martin Landa)
Date: Tue, 5 Jun 2018 08:12:59 +0200
Subject: [gdal-dev] numeric values in VFK driver
Message-ID: <CA+Ei1OcrnEy-gC71h48Bkbv5vfHogE1ajmwsq3q45z=atZRBFw@mail.gmail.com>

Hi,

there is an issue with VFK driver when interpreting numeric values.
Attribute type in VFK data is defined by string like

&BVLA;PODIL_CITATEL N30;PODIL_JMENOVATEL N30;

where VLA is layer name, N -> numeric; 30 -> width

Currently such data types are interpreted as bigint by the driver. But
the value can be apparently (tested almost on full Czech cadastre
dataset) larger that bigint in reality, eg.

&DVLA;...109690709117941111470877379;221486618060854273218000000;...

Such values are nonsense, but VFK driver has to read them. Currently
overflowed values are returned.

I can see only one option: switch to strings. So N30 will be treated
as string(30) by GDAL. Unfortunately it will influences (due to few
non-sense values mentioned above) important attributes like ID which
will be converted from bigint to text attributes.

By chance, anyone with better approach? Thanks a lot for pointers in advance! Ma

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From even.rouault at spatialys.com  Tue Jun  5 02:16:55 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 05 Jun 2018 11:16:55 +0200
Subject: [gdal-dev] numeric values in VFK driver
In-Reply-To: <CA+Ei1OcrnEy-gC71h48Bkbv5vfHogE1ajmwsq3q45z=atZRBFw@mail.gmail.com>
References: <CA+Ei1OcrnEy-gC71h48Bkbv5vfHogE1ajmwsq3q45z=atZRBFw@mail.gmail.com>
Message-ID: <1793141.J0LlOzPeyz@even-i700>

On mardi 5 juin 2018 08:12:59 CEST Martin Landa wrote:
> Hi,
> 
> there is an issue with VFK driver when interpreting numeric values.
> Attribute type in VFK data is defined by string like
> 
> &BVLA;PODIL_CITATEL N30;PODIL_JMENOVATEL N30;
> 
> where VLA is layer name, N -> numeric; 30 -> width
> 
> Currently such data types are interpreted as bigint by the driver. But
> the value can be apparently (tested almost on full Czech cadastre
> dataset) larger that bigint in reality, eg.
> 
> &DVLA;...109690709117941111470877379;221486618060854273218000000;...
> 
> Such values are nonsense, but VFK driver has to read them. Currently
> overflowed values are returned.
> 
> I can see only one option: switch to strings. So N30 will be treated
> as string(30) by GDAL. Unfortunately it will influences (due to few
> non-sense values mentioned above) important attributes like ID which
> will be converted from bigint to text attributes.

For >= 19 characters, bigint cannot be used indeed. There isn't much other 
choice than storing as a string.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From gane.prog at gmail.com  Wed Jun  6 01:40:46 2018
From: gane.prog at gmail.com (Gane R)
Date: Wed, 6 Jun 2018 14:10:46 +0530
Subject: [gdal-dev] OGR SYMBOL style format
Message-ID: <CALMrLdAzf1BQ=0A0hu3=cv_V-DfCn+JP3Rx6fXnZJZUh7PU2yg@mail.gmail.com>

Hi,

I am trying to draw OGR features with style in a defined by a vrt file.
I want point features to be placed with my custom icon with the OGR Feature
style.
So I tried,
The following line works when I change the size parameter s:n
SYMBOL(c:#000000FF,s:50px,id:ogr-sym-3);

The following line doesn't show any change in output image drawn size when
I change the size parameter s:n
SYMBOL(c:#000000FF,s:50px,id:bus_stop.png);

The above line doesn't seem to have any change in the image resize on the
point locations. But, then I use the default "ogr-sym-3" I see a change in
the output,

Did I miss any style parameters or is there any way to have the image
resized before placing at the location of the point features?

Thanks
Gane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180606/ae744ea4/attachment.html>

From even.rouault at spatialys.com  Wed Jun  6 02:18:41 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 06 Jun 2018 11:18:41 +0200
Subject: [gdal-dev] OGR SYMBOL style format
In-Reply-To: <CALMrLdAzf1BQ=0A0hu3=cv_V-DfCn+JP3Rx6fXnZJZUh7PU2yg@mail.gmail.com>
References: <CALMrLdAzf1BQ=0A0hu3=cv_V-DfCn+JP3Rx6fXnZJZUh7PU2yg@mail.gmail.com>
Message-ID: <2445028.JXSkDpsxgb@even-i700>

Gane,

I assume this is with the PDF driver. Yes, size is currently ignored for 
raster symbols. Could you file a ticket about that in
https://github.com/OSGeo/gdal/issues/new ?

Your workaround for now is to work with priorly resized images

Even

> Hi,
> 
> I am trying to draw OGR features with style in a defined by a vrt file.
> I want point features to be placed with my custom icon with the OGR Feature
> style.
> So I tried,
> The following line works when I change the size parameter s:n
> SYMBOL(c:#000000FF,s:50px,id:ogr-sym-3);
> 
> The following line doesn't show any change in output image drawn size when
> I change the size parameter s:n
> SYMBOL(c:#000000FF,s:50px,id:bus_stop.png);
> 
> The above line doesn't seem to have any change in the image resize on the
> point locations. But, then I use the default "ogr-sym-3" I see a change in
> the output,
> 
> Did I miss any style parameters or is there any way to have the image
> resized before placing at the location of the point features?
> 
> Thanks
> Gane


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From landa.martin at gmail.com  Wed Jun  6 10:27:50 2018
From: landa.martin at gmail.com (Martin Landa)
Date: Wed, 6 Jun 2018 19:27:50 +0200
Subject: [gdal-dev] numeric values in VFK driver
In-Reply-To: <1793141.J0LlOzPeyz@even-i700>
References: <CA+Ei1OcrnEy-gC71h48Bkbv5vfHogE1ajmwsq3q45z=atZRBFw@mail.gmail.com>
 <1793141.J0LlOzPeyz@even-i700>
Message-ID: <CA+Ei1OfqCW0bwHpO5mfBe5Zn0R7JSdsdNEAc2r9xHGV1t8asFg@mail.gmail.com>

Hi,

2018-06-05 11:16 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:
> For >= 19 characters, bigint cannot be used indeed. There isn't much other
> choice than storing as a string.

right. In [1] I switched at least to CPLAtoGIntBigEx(). BTW I would
expect that a warning will be printed also on invalid character. But

* 7423849274x is silently parsed as 7423849274
* x7423849274 is silently parsed as 0

Is it expected behaviour of CPLAtoGIntBigEx()?

Martin

[1] https://github.com/OSGeo/gdal/issues/672#issuecomment-395148503

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From even.rouault at spatialys.com  Wed Jun  6 11:58:00 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 06 Jun 2018 20:58:00 +0200
Subject: [gdal-dev] numeric values in VFK driver
In-Reply-To: <CA+Ei1OfqCW0bwHpO5mfBe5Zn0R7JSdsdNEAc2r9xHGV1t8asFg@mail.gmail.com>
References: <CA+Ei1OcrnEy-gC71h48Bkbv5vfHogE1ajmwsq3q45z=atZRBFw@mail.gmail.com>
 <1793141.J0LlOzPeyz@even-i700>
 <CA+Ei1OfqCW0bwHpO5mfBe5Zn0R7JSdsdNEAc2r9xHGV1t8asFg@mail.gmail.com>
Message-ID: <2082799.LK8nFOTt02@even-i700>

On mercredi 6 juin 2018 19:27:50 CEST Martin Landa wrote:
> Hi,
> 
> 2018-06-05 11:16 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:
> > For >= 19 characters, bigint cannot be used indeed. There isn't much other
> > choice than storing as a string.
> 
> right. In [1] I switched at least to CPLAtoGIntBigEx(). BTW I would
> expect that a warning will be printed also on invalid character. But
> 
> * 7423849274x is silently parsed as 7423849274
> * x7423849274 is silently parsed as 0
> 
> Is it expected behaviour of CPLAtoGIntBigEx()?

Good question. The doc of the function only mentions under/overflows, so the 
cases you mention above do not technically match that.

You can use CPLGetValueType(str) == CPL_VALUE_INTEGER as an additional test to 
check if it is an integer (of arbitrary length)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From landa.martin at gmail.com  Thu Jun  7 01:38:32 2018
From: landa.martin at gmail.com (Martin Landa)
Date: Thu, 7 Jun 2018 10:38:32 +0200
Subject: [gdal-dev] numeric values in VFK driver
In-Reply-To: <2082799.LK8nFOTt02@even-i700>
References: <CA+Ei1OcrnEy-gC71h48Bkbv5vfHogE1ajmwsq3q45z=atZRBFw@mail.gmail.com>
 <1793141.J0LlOzPeyz@even-i700>
 <CA+Ei1OfqCW0bwHpO5mfBe5Zn0R7JSdsdNEAc2r9xHGV1t8asFg@mail.gmail.com>
 <2082799.LK8nFOTt02@even-i700>
Message-ID: <CA+Ei1OeKo2xHh_G6jZr_5zgrn1mL2crz3mkTVfuYdzWtOg+DyA@mail.gmail.com>

Hi,

2018-06-06 20:58 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:
> You can use CPLGetValueType(str) == CPL_VALUE_INTEGER as an additional test to
> check if it is an integer (of arbitrary length)

great, I have improved error handling in VFK accordingly [1]. Ma

[1] https://github.com/OSGeo/gdal/issues/672#issuecomment-395340050

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From mario.nunez at atos.net  Thu Jun  7 03:48:06 2018
From: mario.nunez at atos.net (Nunez, Mario)
Date: Thu, 7 Jun 2018 10:48:06 +0000
Subject: [gdal-dev] gdal_rasterize failing when trying multiband
Message-ID: <DB3PR02MB03788972363E92D4684B447D9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>

Hello,

I was doing some point rasterization of vector data from postgis database by using gdal_rasterize from a bash script, the command looks like this:


gdal_rasterize -a value -b $COUNT -tr $RESOLUTION -te $BBOX -a_nodata $NODATA -a_srs $EPSG PG:'host=localhost dbname=databio user=postgres password=postgres' -sql "SELECT ST_Centroid(g.geom), AVG($COLUMN) as value FROM $GRID g, $OBSERVACION o WHERE utc_date='$DATE' AND vessel_cfr='$VESSEL' AND ST_Intersects(o.geom,g.geom) IS TRUE GROUP BY g.gid" ./bands/$DATE2"_"$COLUMN".tif"


The problem is that I want to generate a geotif file with multiple bands, so if I remove the -b $COUNT parameter and value it works and I get a .tif file with the -a value printed on it for band1, but the idea is to reuse that command in a for loop to add further bands and I am gettin this error:


-b option cannot be used when creating a GDAL dataset.

I tried to run the comand once to create the tif file without the -b option and then run it additional times with the -b option when the tif is already created but it makes no difference.


I am stucked with this and I am starting to think that -b option can only be used with -burn parmeter and as far as I know -burn is only for constant values...


thank you in advance for any help.

cheers,

Mario


This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it.
As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.

Este mensaje y los ficheros adjuntos pueden contener información confidencial destinada solamente a la(s) persona(s) mencionadas anteriormente y pueden estar protegidos por secreto profesional.
Si usted recibe este correo electrónico por error, gracias por informar inmediatamente al remitente y destruir el mensaje.
Al no estar asegurada la integridad de este mensaje sobre la red, Atos no se hace responsable por su contenido. Su contenido no constituye ningún compromiso para el grupo Atos, salvo ratificación escrita por ambas partes.
Aunque se esfuerza al máximo por mantener su red libre de virus, el emisor no puede garantizar nada al respecto y no será responsable de cualesquiera daños que puedan resultar de una transmisión de virus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180607/4135fdb7/attachment.html>

From even.rouault at spatialys.com  Thu Jun  7 04:05:03 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 07 Jun 2018 13:05:03 +0200
Subject: [gdal-dev] gdal_rasterize failing when trying multiband
In-Reply-To: <DB3PR02MB03788972363E92D4684B447D9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>
References: <DB3PR02MB03788972363E92D4684B447D9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>
Message-ID: <5301614.oHB4GrM7uU@even-i700>

Mario,

I suggest you use gdal_rasterize to produce as many GeoTIFF files as you have 
'burning sessions'
And then use gdal_merge.py -separate to make a single GeoTIFF from all the 
above ones.

Even

> Hello,
> 
> I was doing some point rasterization of vector data from postgis database by
> using gdal_rasterize from a bash script, the command looks like this:
> 
> 
> gdal_rasterize -a value -b $COUNT -tr $RESOLUTION -te $BBOX -a_nodata
> $NODATA -a_srs $EPSG PG:'host=localhost dbname=databio user=postgres
> password=postgres' -sql "SELECT ST_Centroid(g.geom), AVG($COLUMN) as value
> FROM $GRID g, $OBSERVACION o WHERE utc_date='$DATE' AND
> vessel_cfr='$VESSEL' AND ST_Intersects(o.geom,g.geom) IS TRUE GROUP BY
> g.gid" ./bands/$DATE2"_"$COLUMN".tif"
> 
> 
> The problem is that I want to generate a geotif file with multiple bands, so
> if I remove the -b $COUNT parameter and value it works and I get a .tif
> file with the -a value printed on it for band1, but the idea is to reuse
> that command in a for loop to add further bands and I am gettin this error:
> 
> 
> -b option cannot be used when creating a GDAL dataset.
> 
> I tried to run the comand once to create the tif file without the -b option
> and then run it additional times with the -b option when the tif is already
> created but it makes no difference.
> 
> 
> I am stucked with this and I am starting to think that -b option can only be
> used with -burn parmeter and as far as I know -burn is only for constant
> values...
> 
> 
> thank you in advance for any help.
> 
> cheers,
> 
> Mario
> 
> 
> This e-mail and the documents attached are confidential and intended solely
> for the addressee; it may also be privileged. If you receive this e-mail in
> error, please notify the sender immediately and destroy it. As its
> integrity cannot be secured on the Internet, the Atos group liability
> cannot be triggered for the message content. Although the sender endeavors
> to maintain a computer virus-free network, the sender does not warrant that
> this transmission is virus-free and will not be liable for any damages
> resulting from any virus transmitted.
> 
> Este mensaje y los ficheros adjuntos pueden contener información
> confidencial destinada solamente a la(s) persona(s) mencionadas
> anteriormente y pueden estar protegidos por secreto profesional. Si usted
> recibe este correo electrónico por error, gracias por informar
> inmediatamente al remitente y destruir el mensaje. Al no estar asegurada la
> integridad de este mensaje sobre la red, Atos no se hace responsable por su
> contenido. Su contenido no constituye ningún compromiso para el grupo Atos,
> salvo ratificación escrita por ambas partes. Aunque se esfuerza al máximo
> por mantener su red libre de virus, el emisor no puede garantizar nada al
> respecto y no será responsable de cualesquiera daños que puedan resultar de
> una transmisión de virus.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mario.nunez at atos.net  Thu Jun  7 04:31:51 2018
From: mario.nunez at atos.net (Nunez, Mario)
Date: Thu, 7 Jun 2018 11:31:51 +0000
Subject: [gdal-dev] gdal_rasterize failing when trying multiband
In-Reply-To: <5301614.oHB4GrM7uU@even-i700>
References: <DB3PR02MB03788972363E92D4684B447D9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>,
 <5301614.oHB4GrM7uU@even-i700>
Message-ID: <DB3PR02MB0378A846F1ECB22CF0CCE41B9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>

Thank you for your help,

I know that is a possibility but this is to process big amounts of data and I would like to avoid the merge processing time if possible by rasterizing over the same tif...


I would like to know if it is possible...


cheers,

Mario

________________________________
De: Even Rouault <even.rouault at spatialys.com>
Enviado: jueves, 7 de junio de 2018 13:05:03
Para: gdal-dev at lists.osgeo.org
Cc: Nunez, Mario
Asunto: Re: [gdal-dev] gdal_rasterize failing when trying multiband

Mario,

I suggest you use gdal_rasterize to produce as many GeoTIFF files as you have
'burning sessions'
And then use gdal_merge.py -separate to make a single GeoTIFF from all the
above ones.

Even

> Hello,
>
> I was doing some point rasterization of vector data from postgis database by
> using gdal_rasterize from a bash script, the command looks like this:
>
>
> gdal_rasterize -a value -b $COUNT -tr $RESOLUTION -te $BBOX -a_nodata
> $NODATA -a_srs $EPSG PG:'host=localhost dbname=databio user=postgres
> password=postgres' -sql "SELECT ST_Centroid(g.geom), AVG($COLUMN) as value
> FROM $GRID g, $OBSERVACION o WHERE utc_date='$DATE' AND
> vessel_cfr='$VESSEL' AND ST_Intersects(o.geom,g.geom) IS TRUE GROUP BY
> g.gid" ./bands/$DATE2"_"$COLUMN".tif"
>
>
> The problem is that I want to generate a geotif file with multiple bands, so
> if I remove the -b $COUNT parameter and value it works and I get a .tif
> file with the -a value printed on it for band1, but the idea is to reuse
> that command in a for loop to add further bands and I am gettin this error:
>
>
> -b option cannot be used when creating a GDAL dataset.
>
> I tried to run the comand once to create the tif file without the -b option
> and then run it additional times with the -b option when the tif is already
> created but it makes no difference.
>
>
> I am stucked with this and I am starting to think that -b option can only be
> used with -burn parmeter and as far as I know -burn is only for constant
> values...
>
>
> thank you in advance for any help.
>
> cheers,
>
> Mario
>
>
> This e-mail and the documents attached are confidential and intended solely
> for the addressee; it may also be privileged. If you receive this e-mail in
> error, please notify the sender immediately and destroy it. As its
> integrity cannot be secured on the Internet, the Atos group liability
> cannot be triggered for the message content. Although the sender endeavors
> to maintain a computer virus-free network, the sender does not warrant that
> this transmission is virus-free and will not be liable for any damages
> resulting from any virus transmitted.
>
> Este mensaje y los ficheros adjuntos pueden contener información
> confidencial destinada solamente a la(s) persona(s) mencionadas
> anteriormente y pueden estar protegidos por secreto profesional. Si usted
> recibe este correo electrónico por error, gracias por informar
> inmediatamente al remitente y destruir el mensaje. Al no estar asegurada la
> integridad de este mensaje sobre la red, Atos no se hace responsable por su
> contenido. Su contenido no constituye ningún compromiso para el grupo Atos,
> salvo ratificación escrita por ambas partes. Aunque se esfuerza al máximo
> por mantener su red libre de virus, el emisor no puede garantizar nada al
> respecto y no será responsable de cualesquiera daños que puedan resultar de
> una transmisión de virus.


--
Spatialys - Geospatial professional services
http://www.spatialys.com
This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it.
As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.

Este mensaje y los ficheros adjuntos pueden contener información confidencial destinada solamente a la(s) persona(s) mencionadas anteriormente y pueden estar protegidos por secreto profesional.
Si usted recibe este correo electrónico por error, gracias por informar inmediatamente al remitente y destruir el mensaje.
Al no estar asegurada la integridad de este mensaje sobre la red, Atos no se hace responsable por su contenido. Su contenido no constituye ningún compromiso para el grupo Atos, salvo ratificación escrita por ambas partes.
Aunque se esfuerza al máximo por mantener su red libre de virus, el emisor no puede garantizar nada al respecto y no será responsable de cualesquiera daños que puedan resultar de una transmisión de virus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180607/4e107db0/attachment-0001.html>

From Maria.Ibarra at ign.fr  Fri Jun  8 05:26:06 2018
From: Maria.Ibarra at ign.fr (Maria Ibarra)
Date: Fri, 8 Jun 2018 12:26:06 +0000
Subject: [gdal-dev] driver MVT, no tiles generated
Message-ID: <E7F574920EECF34CBCB30D379B14BEC59B8BE2C0@mailex1.ign.fr>

Hello,


I tried to use the recently released MVT (Mapbox Vector Tiles) driver of GDAL 2.3 to write vector tiles in pbf format, but I get an output folder with nothing but a metadata.json file. No tile is generated. I tried different source formats, and different creation options, but I cannot manage to make it work.


I tried exactly the same command shown as an example in the driver documentation (http://www.gdal.org/drv_mvt.html) with a valid non empty .gpkg file :


ogr2ogr -f MVT ./batiment source.gpkg -dsco MAXZOOM=10


But I get the same result: no error message, and an empty folder with a metadata.json


This is the content of the metadata.json file created :


{
  "name":"batiment",
  "description":"",
  "version":2,
  "minzoom":0,
  "maxzoom":5,
  "center":"2.4607491,48.7742768,0",
  "bounds":"2.3087879,48.6877737,2.6127104,48.8607799",
  "type":"overlay",
  "format":"pbf",
  "json":"{\n  \"vector_layers\":[\n  ],\n  \"tilestats\":{\n    \"layerCount\":0,\n    \"layers\":[\n    ]\n  }\n}"
}


What am I missing ? The driver seems to be enabled since I get no error message and a folder with a metadata file is created. Do I need some extra configurations ?


Thanks,


María
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180608/3054fad2/attachment.html>

From Nick.Ward at landmark.co.uk  Fri Jun  8 05:53:52 2018
From: Nick.Ward at landmark.co.uk (Nick Ward)
Date: Fri, 8 Jun 2018 12:53:52 +0000
Subject: [gdal-dev] parallel running gdal_retile
Message-ID: <HE1PR05MB4699ABA44D2EB5CD35C438F6DB7B0@HE1PR05MB4699.eurprd05.prod.outlook.com>

Hello,

Firstly, thank you to all of you who work on the briliiant GDAL.

I am using gdal_retile to create a pyramid layer for geoserver.
There are over 10000 images of 5000 by 5000 pixels.
So a single list will take a while to process.

I was wondering if anyone has any tips on parallelising this in some way.
I was thinking that it would be nice if you could create multiple pyramids then merge them somehow.

Is this possible?
Would you use gdaltindex?

Regards
Nick
Registered Office: 7 Abbey Court, Eagle Way, Sowton, Exeter, Devon, EX2 7HY. Registered Number 2892803 Registered in England and Wales. The information contained in this e-mail is confidential and may be subject to legal privilege. If you are not the intended recipient, you must not use, copy, distribute or disclose the e-mail or any part of its contents or take any action in reliance on it. If you have received this e-mail in error, please e-mail the sender by replying to this message. All reasonable precautions have been taken to ensure no viruses are present in this e-mail. Landmark Information Group Limited cannot accept responsibility for loss or damage arising from the use of this e-mail or attachments and recommend that you subject these to your virus checking procedures prior to use.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180608/c729293a/attachment.html>

From even.rouault at spatialys.com  Fri Jun  8 06:01:16 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 08 Jun 2018 15:01:16 +0200
Subject: [gdal-dev] driver MVT, no tiles generated
In-Reply-To: <E7F574920EECF34CBCB30D379B14BEC59B8BE2C0@mailex1.ign.fr>
References: <E7F574920EECF34CBCB30D379B14BEC59B8BE2C0@mailex1.ign.fr>
Message-ID: <2617606.zOOm3mmjlt@even-i700>

On vendredi 8 juin 2018 12:26:06 CEST Maria Ibarra wrote:
> Hello,
> 
> 
> I tried to use the recently released MVT (Mapbox Vector Tiles) driver of
> GDAL 2.3 to write vector tiles in pbf format, but I get an output folder
> with nothing but a metadata.json file. No tile is generated. I tried
> different source formats, and different creation options, but I cannot
> manage to make it work.

How did you build GDAL / where did you get it from ?
I assume your buid has PROJ support, otherwise you would get a warning 
message.

Can you retry by adding "--debug on" (double dash before debug) at the end of 
your ogr2ogr command line, and include the output of this ?

Can you also include the output of "ogrinfo -al -so source.gpkg" ?

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Maria.Ibarra at ign.fr  Fri Jun  8 07:17:25 2018
From: Maria.Ibarra at ign.fr (Maria Ibarra)
Date: Fri, 8 Jun 2018 14:17:25 +0000
Subject: [gdal-dev] driver MVT, no tiles generated
In-Reply-To: <2617606.zOOm3mmjlt@even-i700>
References: <E7F574920EECF34CBCB30D379B14BEC59B8BE2C0@mailex1.ign.fr>,
 <2617606.zOOm3mmjlt@even-i700>
Message-ID: <E7F574920EECF34CBCB30D379B14BEC59B8BE2F2@mailex1.ign.fr>

I downloaded GDAL from this package http://download.osgeo.org/gdal/2.3.0/gdal-2.3.0.tar.gz
Built with this command :
./configure --with-geos=yes with-pg=/usr/bin/pg_config
sudo make install

* This is the result of the command with the "--debug on"

ogr2ogr -f MVT ./batiment source.gpkg -dsco MAXZOOM=10 --debug on
GNM: GNMRegisterAllInternal
GNM: RegisterGNMFile
GNM: RegisterGNMdatabase
GPKG: GeoPackage v1.2.0
GDAL: GDALOpen(source.gpkg, this=0xe33f90) succeeds as GPKG.
GDAL: GDALDriver::Create(MVT,./batiment,0,0,0,Unknown,0xe3a8e0)
GPKG: ResetStatement(SELECT m."fid", m."geom", m."altitude_s", m."hauteur", m."nature", m."nom" FROM "batiment" m)
MVT: Creating temporary database...
GPKG: finalize 0xe7dc38
GDALVectorTranslate: 450768 features written in layer 'batiment'
GDAL: GDALClose(source.gpkg, this=0xe33f90)
MVT: Building output file from temporary database...
GDAL: GDALClose(./batiment, this=0xe3b470)


* This is the result of the command "ogrinfo -al -so source.gpkg"
INFO: Open of `source.gpkg'
      using driver `GPKG' successful.

Layer name: batiment
Geometry: Polygon
Feature Count: 450768
Extent: (257013.000000, 6222050.000000) - (290846.000000, 6251270.000000)
Layer SRS WKT:
PROJCS["WGS 84 / Pseudo-Mercator",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Mercator_1SP"],
    PARAMETER["central_meridian",0],
    PARAMETER["scale_factor",1],
    PARAMETER["false_easting",0],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["X",EAST],
    AXIS["Y",NORTH],
    EXTENSION["PROJ4","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"],
    AUTHORITY["EPSG","3857"]]
FID Column = fid
Geometry Column = geom
altitude_s: Real (0.0)
hauteur: Real (0.0)
nature: String (0.0)
nom: String (0.0)


* I am not sure how to check if my build has PROJ support, I dont get a warning message with my previous command, but I do have an error message if I try to specify a TILING_SCHEME:

ogr2ogr -f MVT ./batiment source.gpkg -dsco MAXZOOM=10 -dsco TILING_SCHEME="EPSG:3857,-20037508.343,20037508.343,40075016.686"
ERROR 6: Unable to load PROJ.4 library (libproj.so), creation of OGRCoordinateTransformation failed.


Maria
________________________________________
De : Even Rouault [even.rouault at spatialys.com]
Date d'envoi : vendredi 8 juin 2018 15:01
À : gdal-dev at lists.osgeo.org
Cc : Maria Ibarra
Objet : Re: [gdal-dev] driver MVT, no tiles generated

On vendredi 8 juin 2018 12:26:06 CEST Maria Ibarra wrote:
> Hello,
>
>
> I tried to use the recently released MVT (Mapbox Vector Tiles) driver of
> GDAL 2.3 to write vector tiles in pbf format, but I get an output folder
> with nothing but a metadata.json file. No tile is generated. I tried
> different source formats, and different creation options, but I cannot
> manage to make it work.

How did you build GDAL / where did you get it from ?
I assume your buid has PROJ support, otherwise you would get a warning
message.

Can you retry by adding "--debug on" (double dash before debug) at the end of
your ogr2ogr command line, and include the output of this ?

Can you also include the output of "ogrinfo -al -so source.gpkg" ?

Even


--
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Jun  8 07:26:18 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 08 Jun 2018 16:26:18 +0200
Subject: [gdal-dev] driver MVT, no tiles generated
In-Reply-To: <E7F574920EECF34CBCB30D379B14BEC59B8BE2F2@mailex1.ign.fr>
References: <E7F574920EECF34CBCB30D379B14BEC59B8BE2C0@mailex1.ign.fr>
 <2617606.zOOm3mmjlt@even-i700>
 <E7F574920EECF34CBCB30D379B14BEC59B8BE2F2@mailex1.ign.fr>
Message-ID: <5075823.Hsm3PHojrZ@even-i700>

On vendredi 8 juin 2018 14:17:25 CEST Maria Ibarra wrote:
> I downloaded GDAL from this package
> http://download.osgeo.org/gdal/2.3.0/gdal-2.3.0.tar.gz Built with this
> command :
> ./configure --with-geos=yes with-pg=/usr/bin/pg_config
> sudo make install

OK, the error message shows that GDAL doesn't find PROJ. In your particular 
case where your input dataset is already in WebMercator, no reprojection 
should normally occur, so that shouldn't matter.
But it would be saner to build GDAL with PROJ support by adding --with-proj to 
configure, make clean and re-make

So as that won't likely solve the issue, do you mind sharing your input 
dataset, or anyone that would show the issue ? (you can email it privately to 
me if you wish)

Even 

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Jun  8 07:58:31 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 08 Jun 2018 16:58:31 +0200
Subject: [gdal-dev] driver MVT, no tiles generated
In-Reply-To: <E7F574920EECF34CBCB30D379B14BEC59B8BE2F2@mailex1.ign.fr>
References: <E7F574920EECF34CBCB30D379B14BEC59B8BE2C0@mailex1.ign.fr>
 <2617606.zOOm3mmjlt@even-i700>
 <E7F574920EECF34CBCB30D379B14BEC59B8BE2F2@mailex1.ign.fr>
Message-ID: <2026766.EaSWIlPOFv@even-i700>

Okay, I've reproduced the problem. It is due to your input geometries being 
POLYGON Z, and the driver currently only expects XY geometries. I've just 
pushed a fix so it is more tolerant.
You can workaround the issue by adding -dim 2 to your ogr2ogr command line.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Jun  8 15:32:41 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 09 Jun 2018 00:32:41 +0200
Subject: [gdal-dev] GDAL 2.3.1 schedule
Message-ID: <2430899.5ppf0ChA9J@even-i700>

Hi,

I volunteer to prepare a GDAL 2.3.1RC1 on Friday June 22nd. We already have 72 
commits since 2.3.0

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From andreaerdna at libero.it  Sat Jun  9 03:19:30 2018
From: andreaerdna at libero.it (andreaerdna)
Date: Sat, 9 Jun 2018 03:19:30 -0700 (MST)
Subject: [gdal-dev] About deprecated CRS and the different behavior of
 EPSGGetPCSInfo and EPSGGetGCSInfo
In-Reply-To: <13630986.bbIz37vLbb@even-i700>
References: <1525529352451-0.post@n6.nabble.com>
 <13630986.bbIz37vLbb@even-i700>
Message-ID: <1528539570305-0.post@n6.nabble.com>

Do you think it would be appropriate and safe to back port in 2.3 brach the
commits [0] about the name of deprecated GeoGCSs and GeoCCSs, now that 2.3.1
version is scheduled?


[0]
- "importFromEPSG(): append ' (deprecated)' at end of deprecated GeoCCS
(#646)"
8cd283e19208fe6e0276adc4e3a7f54fcc30ed54
<https://github.com/OSGeo/gdal/commit/8cd283e19208fe6e0276adc4e3a7f54fcc30ed54>  
- "Merge pull request #575 from rouault/deprecated_gcs"
01369046d8780d34f722c7011789cda409fe07df
<https://github.com/OSGeo/gdal/commit/01369046d8780d34f722c7011789cda409fe07df>  
- "importFromEPSG(): append ' (deprecated)' at end of deprecated GCS"
2db4413faeeecb81c3c9951a9c8b750d8a9a679e
<https://github.com/OSGeo/gdal/commit/2db4413faeeecb81c3c9951a9c8b750d8a9a679e>  



-----
Andrea Giudiceandrea
--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Sat Jun  9 03:33:12 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 09 Jun 2018 12:33:12 +0200
Subject: [gdal-dev] About deprecated CRS and the different behavior of
	EPSGGetPCSInfo and EPSGGetGCSInfo
In-Reply-To: <1528539570305-0.post@n6.nabble.com>
References: <1525529352451-0.post@n6.nabble.com>
 <13630986.bbIz37vLbb@even-i700> <1528539570305-0.post@n6.nabble.com>
Message-ID: <2430967.fO1lnpvZPf@even-i700>

On samedi 9 juin 2018 03:19:30 CEST andreaerdna wrote:
> Do you think it would be appropriate and safe to back port in 2.3 brach the
> commits [0] about the name of deprecated GeoGCSs and GeoCCSs, now that 2.3.1
> version is scheduled?

Andrea,

Those are functional changes that could potentially break code that would rely 
on the CRS name without the " (deprecated)" suffix.

Even

> 
> 
> [0]
> - "importFromEPSG(): append ' (deprecated)' at end of deprecated GeoCCS
> (#646)"
> 8cd283e19208fe6e0276adc4e3a7f54fcc30ed54
> <https://github.com/OSGeo/gdal/commit/8cd283e19208fe6e0276adc4e3a7f54fcc30ed
> 54> - "Merge pull request #575 from rouault/deprecated_gcs"
> 01369046d8780d34f722c7011789cda409fe07df
> <https://github.com/OSGeo/gdal/commit/01369046d8780d34f722c7011789cda409fe07
> df> - "importFromEPSG(): append ' (deprecated)' at end of deprecated GCS"
> 2db4413faeeecb81c3c9951a9c8b750d8a9a679e
> <https://github.com/OSGeo/gdal/commit/2db4413faeeecb81c3c9951a9c8b750d8a9a67
> 9e>
> 
> 
> 
> -----
> Andrea Giudiceandrea
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From andreaerdna at libero.it  Sat Jun  9 03:55:13 2018
From: andreaerdna at libero.it (andreaerdna)
Date: Sat, 9 Jun 2018 03:55:13 -0700 (MST)
Subject: [gdal-dev] About deprecated CRS and the different behavior of
 EPSGGetPCSInfo and EPSGGetGCSInfo
In-Reply-To: <2430967.fO1lnpvZPf@even-i700>
References: <1525529352451-0.post@n6.nabble.com>
 <13630986.bbIz37vLbb@even-i700> <1528539570305-0.post@n6.nabble.com>
 <2430967.fO1lnpvZPf@even-i700>
Message-ID: <1528541713329-0.post@n6.nabble.com>

Even Rouault-2 wrote
> Those are functional changes that could potentially break code that would
> rely 
> on the CRS name without the " (deprecated)" suffix.

Even, thanks for the clarification.

Best reguards.



-----
Andrea Giudiceandrea
--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From nickargirop at gmail.com  Sun Jun 10 12:30:29 2018
From: nickargirop at gmail.com (Nikos Argiropoulos)
Date: Sun, 10 Jun 2018 20:30:29 +0100
Subject: [gdal-dev] [Gdal-dev] python - reproject a shapefile
Message-ID: <CAHHjop0Q55bLCXONX0SP8ikNxXyReM2=g1Uts5iHt0_fdr3fKA@mail.gmail.com>

As you can see in this
<https://gis.stackexchange.com/questions/285771/gdal-ogr-returning-wrong-reprojected-shapefile>
post,
I try to reproject a shapefile based on the projection info that I get from
a raster, but the output shapefile is completely wrong. I cannot seem to
find a solution to this problem as the code seems to work without errors.
Could you please help?

Thank you in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180610/e64b3d5f/attachment.html>

From kassies at gmail.com  Mon Jun 11 00:31:18 2018
From: kassies at gmail.com (Rutger)
Date: Mon, 11 Jun 2018 00:31:18 -0700 (MST)
Subject: [gdal-dev] [Gdal-dev] python - reproject a shapefile
In-Reply-To: <CAHHjop0Q55bLCXONX0SP8ikNxXyReM2=g1Uts5iHt0_fdr3fKA@mail.gmail.com>
References: <CAHHjop0Q55bLCXONX0SP8ikNxXyReM2=g1Uts5iHt0_fdr3fKA@mail.gmail.com>
Message-ID: <1528702278369-0.post@n6.nabble.com>

Hey,

As you already mention in your post, you didn't specify a SRSfor the input,
that's probably the main issue. Inputs need to be georeferenced correctly. 

If you 'only' want to do a reprojection, you could consider using the
bindings to the command line utilities. This would simplify you code a lot,
reducing the possibility of bugs. Something like:

/dsvec = gdal.VectorTranslate('output.shp', 'input.shp' srcSRS=input_srs,
dstSRS="EPSG:32633")
dsvec = None /

Usually you don't have to specify the input SRS, but since yours is missing,
you can assign (overrule!) it like this.



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From andrew at aitchison.me.uk  Mon Jun 11 07:49:26 2018
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 11 Jun 2018 15:49:26 +0100 (BST)
Subject: [gdal-dev] Overviews with a factor of 4
Message-ID: <alpine.LRH.2.21.1806111529170.12911@warden.aitchison.me.uk>


I am writing a driver that reads files that have overviews with linear 
scale factors 4, 16, 64 rather than the 2, 4, 8, 16, 32, 64, ...
supported by GDALRasterBand::GetOverview().

Is there a way to let the library know that some overviews are not available,
or code I could use to scale (shrink) the data read rather than reimplementing
the wheel ?

-- 
Andrew C. Aitchison					Cambridge, UK
 			andrew at aitchison.me.uk

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 11 08:15:25 2018
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 11 Jun 2018 08:15:25 -0700 (MST)
Subject: [gdal-dev] Overviews with a factor of 4
In-Reply-To: <alpine.LRH.2.21.1806111529170.12911@warden.aitchison.me.uk>
References: <alpine.LRH.2.21.1806111529170.12911@warden.aitchison.me.uk>
Message-ID: <1528730125786-0.post@n6.nabble.com>

Hi,

GetOverview is by no means limited to handle power of two overview scales.
Take for example a tiff file with "Size is 3000, 1500"

gdaladdo -ro test.tif 4 16 64

Now try gdalinfo

Overviews: 750x375, 188x94, 47x24

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From luc.vanlinden at gmail.com  Mon Jun 11 23:27:18 2018
From: luc.vanlinden at gmail.com (luc.vanlinden)
Date: Tue, 12 Jun 2018 08:27:18 +0200
Subject: [gdal-dev] OGR Spatialite to geopackage
Message-ID: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>


    
Hi
We are using ogr 2.2.0 and were trying to turn a spatialite (non fdo) into a geopacke file.
The spatialite file has all the metadata tables and view in it.
Should we explicitly pass the layername list (tablenames) for a clean transform?
We are getting errors on records no being able to get transformed referring to tablenames that are those from the source metadata?


GrLuc Van Linden
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180612/b133c34a/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 11 23:59:34 2018
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 11 Jun 2018 23:59:34 -0700 (MST)
Subject: [gdal-dev] OGR Spatialite to geopackage
In-Reply-To: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
References: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
Message-ID: <1528786774521-0.post@n6.nabble.com>

lucvanlinden wrote
> Hi
> We are using ogr 2.2.0 and were trying to turn a spatialite (non fdo) into
> a geopacke file.
> The spatialite file has all the metadata tables and view in it.
> Should we explicitly pass the layername list (tablenames) for a clean
> transform?
> We are getting errors on records no being able to get transformed
> referring to tablenames that are those from the source metadata?

Hi,

Normally all you need to do for converting all data table from SpatiaLite
into corresponding geopackage is

ogr2ogr -f gpkg output.gpkg input.sqlite 

What errors do you get? You may see more details by adding --debug on into
your command.


-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From luc.vanlinden at gmail.com  Tue Jun 12 02:57:56 2018
From: luc.vanlinden at gmail.com (lucvanlinden)
Date: Tue, 12 Jun 2018 02:57:56 -0700 (MST)
Subject: [gdal-dev] OGR Spatialite to geopackage
In-Reply-To: <1528786774521-0.post@n6.nabble.com>
References: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
 <1528786774521-0.post@n6.nabble.com>
Message-ID: <1528797476239-0.post@n6.nabble.com>

Hi Jukka

Error 1: failed to execute insert : unique constraint failed :
geom_cols_ref_sys._rowid_

Error 1 : Unable to write feature 0 from layer geom_cols_ref_sys.

Terminating....

Seems to me that the metadata tables, in this case it is even a view is
treated as a normal layer.

Tx

Luc





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From bradh at frogmouth.net  Tue Jun 12 03:01:10 2018
From: bradh at frogmouth.net (bradh at frogmouth.net)
Date: Tue, 12 Jun 2018 20:01:10 +1000
Subject: [gdal-dev] OGR Spatialite to geopackage
In-Reply-To: <1528797476239-0.post@n6.nabble.com>
References: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
 <1528786774521-0.post@n6.nabble.com> <1528797476239-0.post@n6.nabble.com>
Message-ID: <006201d40234$4af6f300$e0e4d900$@frogmouth.net>

Can you please show the exact command you are using, and tell us whether the geopackage you are using already exists (i.e. this is an append, not a create)?

Brad



From luc.vanlinden at gmail.com  Tue Jun 12 03:21:40 2018
From: luc.vanlinden at gmail.com (luc.vanlinden)
Date: Tue, 12 Jun 2018 12:21:40 +0200
Subject: [gdal-dev] OGR Spatialite to geopackage
Message-ID: <8cq27g7rs902qihn9xfnt520.1528798900100@email.android.com>


    
ogr2ogr -f gpkg output.gpkg input.sqlite


GrLuc Van Linden

-------- Original message --------
From: bradh at frogmouth.net 
Date: 12/06/2018  12:01  (GMT+01:00) 
To: 'lucvanlinden' <luc.vanlinden at gmail.com>, gdal-dev at lists.osgeo.org 
Subject: RE: [gdal-dev] OGR Spatialite to geopackage 

Can you please show the exact command you are using, and tell us whether the geopackage you are using already exists (i.e. this is an append, not a create)?

Brad


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180612/700cbdb2/attachment.html>

From luc.vanlinden at gmail.com  Tue Jun 12 03:22:23 2018
From: luc.vanlinden at gmail.com (luc.vanlinden)
Date: Tue, 12 Jun 2018 12:22:23 +0200
Subject: [gdal-dev] OGR Spatialite to geopackage
Message-ID: <pgia48crg2g539vv8292h391.1528798943422@email.android.com>


    
Sorry forgot to mention. This gpkg does not exist.


GrLuc Van Linden

-------- Original message --------
From: bradh at frogmouth.net 
Date: 12/06/2018  12:01  (GMT+01:00) 
To: 'lucvanlinden' <luc.vanlinden at gmail.com>, gdal-dev at lists.osgeo.org 
Subject: RE: [gdal-dev] OGR Spatialite to geopackage 

Can you please show the exact command you are using, and tell us whether the geopackage you are using already exists (i.e. this is an append, not a create)?

Brad


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180612/8bf3808c/attachment.html>

From even.rouault at spatialys.com  Tue Jun 12 03:25:00 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 12 Jun 2018 12:25:00 +0200
Subject: [gdal-dev] OGR Spatialite to geopackage
In-Reply-To: <1528797476239-0.post@n6.nabble.com>
References: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
 <1528786774521-0.post@n6.nabble.com> <1528797476239-0.post@n6.nabble.com>
Message-ID: <4033466.021n7pbepQ@even-i700>

On mardi 12 juin 2018 02:57:56 CEST lucvanlinden wrote:
> Hi Jukka
> 
> Error 1: failed to execute insert : unique constraint failed :
> geom_cols_ref_sys._rowid_
> 
> Error 1 : Unable to write feature 0 from layer geom_cols_ref_sys.
> 
> Terminating....
> 
> Seems to me that the metadata tables, in this case it is even a view is
> treated as a normal layer.

There isn't a concept of view in the OGR model, so they are presented as 
tables and converted as such. In that case this is a technical Spatialite 
table that makes no sense in GPKG, so you should exclude it from the 
conversion by explicitly listing the tables/views you want to convert.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Tue Jun 12 15:47:23 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Jun 2018 00:47:23 +0200
Subject: [gdal-dev] gdalwarp automatically setting -wo SKIP_NOSOURCE=YES
Message-ID: <2671864.0qeYLQu62I@even-i700>

Hi,

I've just implemented an improvement in gdalwarp to automatically set the 
existing SKIP_NOSOURCE=YES warping option when it is safe to do so. This 
option helps improving performance when a source dataset doesn't cover the 
full size of the output dataset. This is particularly interesting when warping 
into a fixed tiling scheme and/or when use gdalwarp in mosaicing situations. 
On a test scenario where the output tile is much larger than the extent of the 
source datasets, this for example cut down the time from 14 seconds to 2 
seconds

The logic to determine when SKIP_NOSOURCE=YES can be automatically set isn't 
trivial, so please test and report if there are situations where this would 
result in unexpected results.

Note that this will result in files potentially binary different than before 
(blocks not being written in the same order), but the pixel values as read by 
GDAL should be the same as without the optimization.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From ben.elliston at anu.edu.au  Tue Jun 12 16:02:00 2018
From: ben.elliston at anu.edu.au (Ben Elliston)
Date: Wed, 13 Jun 2018 09:02:00 +1000
Subject: [gdal-dev] checksums for source releases
Message-ID: <f2434521-bf20-5728-6ac9-3d2a3cb5998b@anu.edu.au>

The source download page:
https://trac.osgeo.org/gdal/wiki/DownloadSource

.. gives MD5 checksums for the source releases. Starting with 2.3.1, can 
I suggest we start using SHA256 instead of the long-broken MD5?

Ben

From even.rouault at spatialys.com  Tue Jun 12 16:18:34 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Jun 2018 01:18:34 +0200
Subject: [gdal-dev] checksums for source releases
In-Reply-To: <f2434521-bf20-5728-6ac9-3d2a3cb5998b@anu.edu.au>
References: <f2434521-bf20-5728-6ac9-3d2a3cb5998b@anu.edu.au>
Message-ID: <1707740.1dmty7nzK3@even-i700>

On mercredi 13 juin 2018 09:02:00 CEST Ben Elliston wrote:
> The source download page:
> https://trac.osgeo.org/gdal/wiki/DownloadSource
> 
> .. gives MD5 checksums for the source releases. Starting with 2.3.1, can
> I suggest we start using SHA256 instead of the long-broken MD5?

The checksum is more intended to check that there wasn't an accidental 
corruption in the transportation of the archive (MD5 will remain safe forever 
for detecting that), rather than an attempt to forge an hostile archive. In 
which case, we should also sign the checksum...

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From ben.elliston at anu.edu.au  Tue Jun 12 16:20:24 2018
From: ben.elliston at anu.edu.au (Ben Elliston)
Date: Wed, 13 Jun 2018 09:20:24 +1000
Subject: [gdal-dev] checksums for source releases
In-Reply-To: <1707740.1dmty7nzK3@even-i700>
References: <f2434521-bf20-5728-6ac9-3d2a3cb5998b@anu.edu.au>
 <1707740.1dmty7nzK3@even-i700>
Message-ID: <2d6f11b1-3a51-71a0-0918-f942a0a7582d@anu.edu.au>

On 13/06/18 09:18, Even Rouault wrote:

> The checksum is more intended to check that there wasn't an accidental
> corruption in the transportation of the archive (MD5 will remain safe forever
> for detecting that), rather than an attempt to forge an hostile archive. In
> which case, we should also sign the checksum...

Or just sign the tarballs. :-)

Ben

From even.rouault at spatialys.com  Tue Jun 12 16:46:45 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Jun 2018 01:46:45 +0200
Subject: [gdal-dev] checksums for source releases
In-Reply-To: <2d6f11b1-3a51-71a0-0918-f942a0a7582d@anu.edu.au>
References: <f2434521-bf20-5728-6ac9-3d2a3cb5998b@anu.edu.au>
 <1707740.1dmty7nzK3@even-i700>
 <2d6f11b1-3a51-71a0-0918-f942a0a7582d@anu.edu.au>
Message-ID: <2521354.ZaT8SavzeQ@even-i700>

On mercredi 13 juin 2018 09:20:24 CEST Ben Elliston wrote:
> On 13/06/18 09:18, Even Rouault wrote:
> > The checksum is more intended to check that there wasn't an accidental
> > corruption in the transportation of the archive (MD5 will remain safe
> > forever for detecting that), rather than an attempt to forge an hostile
> > archive. In which case, we should also sign the checksum...
> 
> Or just sign the tarballs. :-)

Things get messy when signing is involved and you need to consider all the 
chain from a security point of view (*), otherwise there's little point in 
doing it.

Currently I generate the archives on a OSGeo server. More to follow the 
tradition rather than a real reason I believe. If signing was involved, which 
key should be used, and where would such signing occur ? I could use my 
personal GPG key, but on my own PC (since I wouldn't trust the servers enough) 
but then my pubkey should be made public somewhere in a trusted location (you 
wouldn't put it next to the archive, in case someone would manage to forge the 
archive, they would also be able to replace it with their own key). And that 
would be annoying if someone else wanted to do a release. So lots of 
complications for little benefit...

If people are worried about the archive authenticity, then can also checkout 
the corresponding git tag, and diff it with the archive.

Even

(*) you'd better not use any CPU with speculative execution while you are it.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Wed Jun 13 01:36:18 2018
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 13 Jun 2018 01:36:18 -0700 (MST)
Subject: [gdal-dev] OGR Spatialite to geopackage
In-Reply-To: <4033466.021n7pbepQ@even-i700>
References: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
 <1528786774521-0.post@n6.nabble.com> <1528797476239-0.post@n6.nabble.com>
 <4033466.021n7pbepQ@even-i700>
Message-ID: <1528878978220-0.post@n6.nabble.com>

Even Rouault-2 wrote
> There isn't a concept of view in the OGR model, so they are presented as 
> tables and converted as such. In that case this is a technical Spatialite 
> table that makes no sense in GPKG, so you should exclude it from the 
> conversion by explicitly listing the tables/views you want to convert.

Hi,

Sorry, but this time your answer does not make sense. I can convert with
success a full featured SpatiaLite database (created by GDAL) with two
tables and a spatial view (that gets converted into a normal spatial table)
into GPKG with a simple command

ogr2ogr -f gpkg output.gpkg input.sqlite.

My source SpatiaLite db does include the "geom_cols_ref_sys" view, with this
DLL

CREATE VIEW geom_cols_ref_sys AS
SELECT f_table_name, f_geometry_column, geometry_type,
coord_dimension, spatial_ref_sys.srid AS srid,
auth_name, auth_srid, ref_sys_name, proj4text, srtext
FROM geometry_columns, spatial_ref_sys
WHERE geometry_columns.srid = spatial_ref_sys.srid

So my GDAL can handle the system view  "geom_cols_ref_sys" while the GDAL
that Luc has obviously can't. I suppose we have somehow different builds,
mine comes from the gisinternals developer builds.

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Wed Jun 13 01:49:46 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Jun 2018 10:49:46 +0200
Subject: [gdal-dev] OGR Spatialite to geopackage
In-Reply-To: <1528878978220-0.post@n6.nabble.com>
References: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
 <4033466.021n7pbepQ@even-i700> <1528878978220-0.post@n6.nabble.com>
Message-ID: <4568110.VIX9ZUuHHx@even-i700>

On mercredi 13 juin 2018 01:36:18 CEST jratike80 wrote:
> Even Rouault-2 wrote
> 
> > There isn't a concept of view in the OGR model, so they are presented as
> > tables and converted as such. In that case this is a technical Spatialite
> > table that makes no sense in GPKG, so you should exclude it from the
> > conversion by explicitly listing the tables/views you want to convert.
> 
> Hi,
> 
> Sorry, but this time your answer does not make sense. I can convert with
> success a full featured SpatiaLite database (created by GDAL) with two
> tables and a spatial view (that gets converted into a normal spatial table)
> into GPKG with a simple command

What I meant is that in OGR, on the read side, views and tables are presented 
as OGR layers, and on the write side, they are written as tables. So the 
concept of view is lost in the translation. And anyway in the GPKG case, the 
concept of spatial view isn't really well supported by the standard currently.
> 
> ogr2ogr -f gpkg output.gpkg input.sqlite.
> 
> My source SpatiaLite db does include the "geom_cols_ref_sys" view, with this
> DLL
> 
> CREATE VIEW geom_cols_ref_sys AS
> SELECT f_table_name, f_geometry_column, geometry_type,
> coord_dimension, spatial_ref_sys.srid AS srid,
> auth_name, auth_srid, ref_sys_name, proj4text, srtext
> FROM geometry_columns, spatial_ref_sys
> WHERE geometry_columns.srid = spatial_ref_sys.srid
> 
> So my GDAL can handle the system view  "geom_cols_ref_sys" while the GDAL
> that Luc has obviously can't. I suppose we have somehow different builds,
> mine comes from the gisinternals developer builds.

I presumed that Luc had specified -oo LIST_ALL_TABLES=YES (which actually list 
views as well), but apprently he didn't, so yes that's a bit mysterious


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Donato.AIRAGHI at ext.ec.europa.eu  Wed Jun 13 08:59:24 2018
From: Donato.AIRAGHI at ext.ec.europa.eu (Donato.AIRAGHI at ext.ec.europa.eu)
Date: Wed, 13 Jun 2018 15:59:24 +0000
Subject: [gdal-dev] gdal 2.3.0 with openjpeg 2.3 support
Message-ID: <298B386164AE8F4A96FD656145FD37731FA92267@S-DC-ESTE01-J.net1.cec.eu.int>

Hi,

I'm trying to compile
Gdal 2.3.0  on Centos 6.9 where compiled openjpeg 2.3.0

I get :
....
Kakadu support:            no
JasPer support:            no
OpenJPEG support:          no
ECW support:               no
MrSID support:             yes
......

On the same system with gdal 2.2.2 and openjpeg 2.3.0  I get
.....
Kakadu support:            no
JasPer support:            no
OpenJPEG support:          yes
ECW support:               no
MrSID support:             yes
...


This the configure line :

./configure --with-python=yes  --with-pg=/usr/pgsql-9.3/bin/pg_config --with-geos=yes --with-curl=/usr/bin/curl-config --with-mrsid=/opt/MrSID/Raster_DSDK/ --with-jp2mrsid=no --with-mrsid_lidar=/opt/MrSID/Lidar_DSDK/ --with-sqlite3 --with-podofo=yes --with-hdf4=/opt/HDF/hdf-4.2.13 --with-hdf5=/opt/HDF/hdf-5.1.8.21 --with-openjpeg=/usr/local --with-jasper=no --with-ecw=no --with-threads --with-spatialite=yes


Could you please help me finding an explanation to this behaviour ?
Thanks,





Donato Airaghi

System Administrator
Serco s.p.a
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180613/2bb4650c/attachment.html>

From even.rouault at spatialys.com  Wed Jun 13 09:16:23 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Jun 2018 18:16:23 +0200
Subject: [gdal-dev] gdal 2.3.0 with openjpeg 2.3 support
In-Reply-To: <298B386164AE8F4A96FD656145FD37731FA92267@S-DC-ESTE01-J.net1.cec.eu.int>
References: <298B386164AE8F4A96FD656145FD37731FA92267@S-DC-ESTE01-J.net1.cec.eu.int>
Message-ID: <3107645.iHJHJJvoxk@even-i700>

On mercredi 13 juin 2018 15:59:24 CEST Donato.AIRAGHI at ext.ec.europa.eu wrote:
> Hi,
> 
> I'm trying to compile
> Gdal 2.3.0  on Centos 6.9 where compiled openjpeg 2.3.0
> 
> I get :
> ....
> Kakadu support:            no
> JasPer support:            no
> OpenJPEG support:          no
> ECW support:               no
> MrSID support:             yes
> ......
> 
> On the same system with gdal 2.2.2 and openjpeg 2.3.0  I get
> .....
> Kakadu support:            no
> JasPer support:            no
> OpenJPEG support:          yes
> ECW support:               no
> MrSID support:             yes
> ...
> 
> 
> This the configure line :
> 
> ./configure --with-python=yes  --with-pg=/usr/pgsql-9.3/bin/pg_config
> --with-geos=yes --with-curl=/usr/bin/curl-config
> --with-mrsid=/opt/MrSID/Raster_DSDK/ --with-jp2mrsid=no
> --with-mrsid_lidar=/opt/MrSID/Lidar_DSDK/ --with-sqlite3 --with-podofo=yes
> --with-hdf4=/opt/HDF/hdf-4.2.13 --with-hdf5=/opt/HDF/hdf-5.1.8.21
> --with-openjpeg=/usr/local --with-jasper=no --with-ecw=no --with-threads
> --with-spatialite=yes
> 
> 
> Could you please help me finding an explanation to this behaviour ?

Donato,

You probably need to install pkg-config since it is required now in GDAL 2.3 
to detect openjpeg. Previous GDAL versions had a painful manual way of 
detecting openjpeg that has been simpilfied in GDAL 2.3 configure code.

If I look for openjp2 in the config.log file generated by configure, here are 
the relevant lines:

configure:27477: $PKG_CONFIG --exists --print-errors "libopenjp2 >= 2.1.0"
configure:27480: $? = 0
configure:27495: $PKG_CONFIG --exists --print-errors "libopenjp2 >= 2.1.0"
configure:27498: $? = 0
configure:27534: result: yes
configure:27544: checking for opj_setup_decoder in -lopenjp2
configure:27569: gcc -o conftest -DHAVE_AVX_AT_COMPILE_TIME -
DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -fPIC  -g -DDEBUG -
ftrapv -fvisibility=hidden   conftest.c -lopenjp2  -lopenjp2 >&5
configure:27569: $? = 0
configure:27578: result: yes

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From luc.vanlinden at gmail.com  Wed Jun 13 12:31:50 2018
From: luc.vanlinden at gmail.com (lucvanlinden)
Date: Wed, 13 Jun 2018 12:31:50 -0700 (MST)
Subject: [gdal-dev] OGR Spatialite to geopackage
In-Reply-To: <4568110.VIX9ZUuHHx@even-i700>
References: <3j5qoj66ug8o37ml1fp956lr.1528784306406@email.android.com>
 <1528786774521-0.post@n6.nabble.com> <1528797476239-0.post@n6.nabble.com>
 <4033466.021n7pbepQ@even-i700> <1528878978220-0.post@n6.nabble.com>
 <4568110.VIX9ZUuHHx@even-i700>
Message-ID: <1528918310765-0.post@n6.nabble.com>

Hi

Even, we had indead a similar question before on the all tables etc with
views.

This howevere is a straight spatialite to geopackge transform equally as
Jukka explained.

I must say we are on a 2.2.0 still.

The listing with tables works (layernames), the straight as in 

 ogr2ogr -f gpkg output.gpkg input.sqlite

is causing the errors for the view "geom_cols_ref_sys".

(we have not made the transition yet to 2.3.X given the issues we read on
the new srs transform stuff we have to look into thecorrect EPSG 31370, but
this will be another topic once we had time to confiim or not )

Should however the current issues comming from the 2.2.0 version we can
obviously use that in the mean while for this exercise.

thanks once more.

Luc



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From markus.metz.giswork at gmail.com  Wed Jun 13 13:14:07 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Wed, 13 Jun 2018 22:14:07 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells that
	are not nodata)
Message-ID: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>

Many raster bands contain nodata, therefore it would be helpful if the
number of non-nodata grid cells could be reported by gdalinfo in some way.

The number of non-nodata grid cells is not available through
GDALGetRasterStatistics() / GDALRasterBand::GetStatistics(), probably
because approximations can be stored as raster band statistics, and the
number of non-nodata grid cells is unknown in case of approximations.

Therefore I suggest to report the number of non-nodata grid cells only if
all grid cells are evaluated, i.e. with

*gdalinfo -mm* Force computation of the actual min/max values for each band
in the dataset.

The number of non-nodata grid cells would be a small piece of quite useful
information to quickly evaluate the usefulness of a raster band.

Asking for the possibility to enhance a bit the output of gdalinfo,

Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180613/5217eb4d/attachment.html>

From even.rouault at spatialys.com  Wed Jun 13 14:03:44 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Jun 2018 23:03:44 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
	that are not nodata)
In-Reply-To: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
Message-ID: <3223282.c4yXVfkOzm@even-i700>

On mercredi 13 juin 2018 22:14:07 CEST Markus Metz wrote:
> Many raster bands contain nodata, therefore it would be helpful if the
> number of non-nodata grid cells could be reported by gdalinfo in some way.
> 
> The number of non-nodata grid cells is not available through
> GDALGetRasterStatistics() / GDALRasterBand::GetStatistics(), probably
> because approximations can be stored as raster band statistics, and the
> number of non-nodata grid cells is unknown in case of approximations.
> 
> Therefore I suggest to report the number of non-nodata grid cells only if
> all grid cells are evaluated, i.e. with
> 
> *gdalinfo -mm* Force computation of the actual min/max values for each band
> in the dataset.
> 
> The number of non-nodata grid cells would be a small piece of quite useful
> information to quickly evaluate the usefulness of a raster band.
> 
> Asking for the possibility to enhance a bit the output of gdalinfo,

Markus,

That would be more something triggered by -stats since this number of non-
nondata cells is an intermediate result of GDALRasterBand::ComputeStatistics() 
in gcore/gdalrasterband.cpp. To make it sensical even in the case of 
approximate statistics, why not computing a percentage instead ? That would 
need to be saved in a metadata item, let's say STATISTICS_VALID_RATIO (between 
0 and 1) ? Wanna take a crack at implementing this ?Otherwise file an 
enhancement ticket about that.
By the way, since GDAL 2.3.0, there's a STATISTICS_APPROXIMATE=YES metadata 
item so as to know if the stats have been computed in an approx way or not

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mario.nunez at atos.net  Thu Jun 14 03:53:21 2018
From: mario.nunez at atos.net (Nunez, Mario)
Date: Thu, 14 Jun 2018 10:53:21 +0000
Subject: [gdal-dev] gdal_rasterize failing when trying multiband
In-Reply-To: <DB3PR02MB0378A846F1ECB22CF0CCE41B9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>
References: <DB3PR02MB03788972363E92D4684B447D9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>,
 <5301614.oHB4GrM7uU@even-i700>
 <DB3PR02MB0378A846F1ECB22CF0CCE41B9E640@DB3PR02MB0378.eurprd02.prod.outlook.com>
Message-ID: <DB3PR02MB0378C8373C701477B3FCBF2F9E7D0@DB3PR02MB0378.eurprd02.prod.outlook.com>

Anybody knows if this is possible?

gdal_rasterize -a value -b $COUNT -tr $RESOLUTION -te $BBOX -a_nodata $NODATA -a_srs $EPSG PG:'host=localhost dbname=databio user=postgres password=postgres' -sql "SELECT ST_Centroid(g.geom), AVG($COLUMN) as value FROM $GRID g, $OBSERVACION o WHERE utc_date='$DATE' AND vessel_cfr='$VESSEL' AND ST_Intersects(o.geom,g.geom) IS TRUE GROUP BY g.gid" ./bands/$DATE2"_"$COLUMN".tif"

I mean using -b parameter to directly create a geotiff with different bands from a postgis database query.

I would like to avoid doing single rasterizations and then a merge.
Thank you in advance.


From: Nunez, Mario
Sent: Thursday, June 07, 2018 1:32 PM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] gdal_rasterize failing when trying multiband


Thank you for your help,

I know that is a possibility but this is to process big amounts of data and I would like to avoid the merge processing time if possible by rasterizing over the same tif...



I would like to know if it is possible...



cheers,

Mario

________________________________
De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado: jueves, 7 de junio de 2018 13:05:03
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Cc: Nunez, Mario
Asunto: Re: [gdal-dev] gdal_rasterize failing when trying multiband

Mario,

I suggest you use gdal_rasterize to produce as many GeoTIFF files as you have
'burning sessions'
And then use gdal_merge.py -separate to make a single GeoTIFF from all the
above ones.

Even

> Hello,
>
> I was doing some point rasterization of vector data from postgis database by
> using gdal_rasterize from a bash script, the command looks like this:
>
>
> gdal_rasterize -a value -b $COUNT -tr $RESOLUTION -te $BBOX -a_nodata
> $NODATA -a_srs $EPSG PG:'host=localhost dbname=databio user=postgres
> password=postgres' -sql "SELECT ST_Centroid(g.geom), AVG($COLUMN) as value
> FROM $GRID g, $OBSERVACION o WHERE utc_date='$DATE' AND
> vessel_cfr='$VESSEL' AND ST_Intersects(o.geom,g.geom) IS TRUE GROUP BY
> g.gid" ./bands/$DATE2"_"$COLUMN".tif"
>
>
> The problem is that I want to generate a geotif file with multiple bands, so
> if I remove the -b $COUNT parameter and value it works and I get a .tif
> file with the -a value printed on it for band1, but the idea is to reuse
> that command in a for loop to add further bands and I am gettin this error:
>
>
> -b option cannot be used when creating a GDAL dataset.
>
> I tried to run the comand once to create the tif file without the -b option
> and then run it additional times with the -b option when the tif is already
> created but it makes no difference.
>
>
> I am stucked with this and I am starting to think that -b option can only be
> used with -burn parmeter and as far as I know -burn is only for constant
> values...
>
>
> thank you in advance for any help.
>
> cheers,
>
> Mario
>
>
> This e-mail and the documents attached are confidential and intended solely
> for the addressee; it may also be privileged. If you receive this e-mail in
> error, please notify the sender immediately and destroy it. As its
> integrity cannot be secured on the Internet, the Atos group liability
> cannot be triggered for the message content. Although the sender endeavors
> to maintain a computer virus-free network, the sender does not warrant that
> this transmission is virus-free and will not be liable for any damages
> resulting from any virus transmitted.
>
> Este mensaje y los ficheros adjuntos pueden contener información
> confidencial destinada solamente a la(s) persona(s) mencionadas
> anteriormente y pueden estar protegidos por secreto profesional. Si usted
> recibe este correo electrónico por error, gracias por informar
> inmediatamente al remitente y destruir el mensaje. Al no estar asegurada la
> integridad de este mensaje sobre la red, Atos no se hace responsable por su
> contenido. Su contenido no constituye ningún compromiso para el grupo Atos,
> salvo ratificación escrita por ambas partes. Aunque se esfuerza al máximo
> por mantener su red libre de virus, el emisor no puede garantizar nada al
> respecto y no será responsable de cualesquiera daños que puedan resultar de
> una transmisión de virus.


--
Spatialys - Geospatial professional services
http://www.spatialys.com
This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it.
As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.

Este mensaje y los ficheros adjuntos pueden contener información confidencial destinada solamente a la(s) persona(s) mencionadas anteriormente y pueden estar protegidos por secreto profesional.
Si usted recibe este correo electrónico por error, gracias por informar inmediatamente al remitente y destruir el mensaje.
Al no estar asegurada la integridad de este mensaje sobre la red, Atos no se hace responsable por su contenido. Su contenido no constituye ningún compromiso para el grupo Atos, salvo ratificación escrita por ambas partes.
Aunque se esfuerza al máximo por mantener su red libre de virus, el emisor no puede garantizar nada al respecto y no será responsable de cualesquiera daños que puedan resultar de una transmisión de virus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180614/7379e84b/attachment-0001.html>

From alexhighviz at hotmail.com  Thu Jun 14 05:17:40 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Thu, 14 Jun 2018 12:17:40 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
Message-ID: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>

Dear all,

I few times I have posted to the list trying to promote the idea of providing iterators over pixels in a raster band , and more generally to make raster data accessible using (future) standard conforming ranges. It would make implementing algorithms on raster data a lot more intuitive.  These ideas are implemented in Pronto Raster which is an OSGeo Community C++ library. Feedback in this list has been that such a solution would incur costly computational overheads.

I now have some preliminary benchmark results, where I compare Pronto Raster solutions for a simple raster overlay operation (OUT = 3 * A + B * C) to a direct and idiomatic GDAL implementation. The results seem to indicate that overheads can be negligible, depending on which Pronto Raster functions are used. I would very much appreciate it if some more experienced GDAL C++ users could look at my "idiomatic GDAL implementation" to see if it really is what it claims to be and I am not overstating the results. I can use your help.

I'd also be interested to hear any opinion about these results and the costs / benefits associated with providing pixel ranges for raster bands.

For details on the benchmark see here:    https://github.com/ahhz/raster/blob/master/docs/_posts/2018-06-14-Preliminary-benchmark-results-are-promising.md
or here: http://ahhz.github.io/raster/Preliminary-benchmark-results-are-promising/

Many thanks,  Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180614/2c6d0e5c/attachment.html>

From Martin.Franzke at telekom.de  Thu Jun 14 07:26:01 2018
From: Martin.Franzke at telekom.de (Martin.Franzke at telekom.de)
Date: Thu, 14 Jun 2018 14:26:01 +0000
Subject: [gdal-dev] approximation quality of gcp transformation
Message-ID: <6f47fb4899a4452e8a858b7a4f0c0587@HE105658.emea1.cds.t-internal.com>

Hi,

motivated by the simple transformation to improve the quality of the TPS transformation I had a look at the polynomial counterpart. It turned out that the quality of the approximation not always improves with increasing order of the polynomial as it should be case. So I tried the same trick with the polynomial warping functions. As a benchmark I implemented a solution which uses armadillo and solves the problem ||Ax - b|| ->min directly without using the normal equations ATAx=ATb, which is more stable.

To benchmark the results the mean quadratic deviation of the warped GCPs is computed. This are the results using 1681 GCPs with Gauss Krueger coordinates (UTM coordinates should show almost the same results). 

Order         1     2    3     4     5
-------------------------------------------
original  17.19 21.94 25.8    -     -
precond.  17.19 13.98 10.22   -     -
armadillo 17.19 13.98 10.22 9.24 2729195.82

Using spherical coordinates yields

Order         1     2    3     4     5
-------------------------------------------
original  17.18 15.4  15.19	-	-
precond.  17.18 13.97 10.22	-	-
armadillo 17.18 13.97 10.22 9.24  7.26

This shows, that a scaling of the coordinates can improve the stability even more.

The effect even shows up using less GCPs. With 20 GCPs and Gauss Kruger coordinates the result is as follows:

Order         1       2      3     4     5
-------------------------------------------
Original  0.3674  0.3672 0.3685   -     -
precond.  0.3674  0.3359 0.2572   -     -
armadillo 0.3674	0.3359 0.2572 0.1216 5.793
 
I attach a patch file with the modifications and the script to compute the mean deviations. Analyzing he code I presumably found two small bugs which I have corrected. 

Martin

----Ursprüngliche Nachricht-----
Von: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] Im Auftrag von Franzke, Martin
Gesendet: Freitag, 18. Mai 2018 17:20
An: gdal-dev at lists.osgeo.org
Betreff: [gdal-dev] Interesting issue with ogr2ogr and -tps

>
>On mardi 27 juin 2017 07:34:59 CEST Rahkonen Jukka (MML) wrote:
>> Hi,
>>
>> There is a well written question in gis.stackexchange about how the 
>> -tps option in ogr2ogr behaves 
>> https://gis.stackexchange.com/questions/245391/ogr2org-tps-spline-met
>> hod-cr
>> eates-progressive-error
>>
>> Does anybody have a clue about what happens?
>
>TPS is supposed to be exact at GCP, and interpolate between them. That 
>said, it looks from this report like there might be a numerical 
>stability issue. There are 2 solvers for the TPS
>transformer: a built-in that does matrix inversion "at hand" using 
>Gauss- Jordan elimination method (the one that is taught at school if I 
>remember well -:) ), and another one that uses the armadillo library 
>that is faster and relates underneath on well proven numerical 
>computation libraries (blas/lapack). I don't think osgeo4w builds use armadillo (actually I don't see anything in the nmake.opt related to armadillo).
>That said, I see that the Gauss-Jordan implementation usd uses the "partial pivonting"
>mentionned in
>https://en.wikipedia.org/wiki/Pivot_element#Partial_and_complete_pivoti
>ng so this should normally account for most numerical stabilities issues.
>So either the user is rather unlikely and has encountered a case where 
>numerical instability occur, either his test/GCPs are wrong.
>And I wouldn't have anticipated that numerical stabilities issues have 
>such a north-to-south pattern, but perhaps...
>
>Even
>
>
>--
>Spatialys - Geospatial professional services http://www.spatialys.com
>
>
Hi,

I had a similar problem when not using armadillo, but a simple transformation does the trick. 
The problem is that usually the distance of different gcps compared their absolute value is very small.

This leads to a bad conditioned linear equation system (see https://en.wikipedia.org/wiki/Condition_number):
The first column consists of 1s and the second and third of the x, y values of the gcps respectively.
Now if the difference of the gcps is relatively small the second and third row are nearly colinear to the first one, hence the matrix is nearly singular.

The solution is to shift the coordinate system by the mean value of all gcps and solving the modified linear equations. 
Since the basis function of the TPS only depends on the difference of coordinates the resulting transformation is the same.
 
For the implementation details see the attached patch file.

Martin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: gdal_crs.diff
Type: application/octet-stream
Size: 10695 bytes
Desc: gdal_crs.diff
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180614/fd71eb5d/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: calc_gauss_mean_dev.py
Type: application/octet-stream
Size: 1718 bytes
Desc: calc_gauss_mean_dev.py
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180614/fd71eb5d/attachment-0003.obj>

From even.rouault at spatialys.com  Thu Jun 14 07:49:15 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 14 Jun 2018 16:49:15 +0200
Subject: [gdal-dev] approximation quality of gcp transformation
In-Reply-To: <6f47fb4899a4452e8a858b7a4f0c0587@HE105658.emea1.cds.t-internal.com>
References: <6f47fb4899a4452e8a858b7a4f0c0587@HE105658.emea1.cds.t-internal.com>
Message-ID: <2390924.zRnQ883bNC@even-i700>

Martin,

would you mind submitting your patch as a pull request against
https://github.com/OSGeo/gdal so that regression tests and other quality 
checks are automatically passed ?

Ideall you would do two commits: the first one with the bugfixes, and a second 
one with your improvements (would be fine as part as the same PR, as I see 
there would be conflicts otherwise)

I'd note that the polynomial order 3 implementation (or maybe it is a 
fundamental problem) is suspected to have instabilities that make it not fit 
for practical uses (despite the issue you have identified with the outlier 
elimination, that was a later addition)

Even

> Hi,
> 
> motivated by the simple transformation to improve the quality of the TPS
> transformation I had a look at the polynomial counterpart. It turned out
> that the quality of the approximation not always improves with increasing
> order of the polynomial as it should be case. So I tried the same trick
> with the polynomial warping functions. As a benchmark I implemented a
> solution which uses armadillo and solves the problem ||Ax - b|| ->min
> directly without using the normal equations ATAx=ATb, which is more stable.
> 
> To benchmark the results the mean quadratic deviation of the warped GCPs is
> computed. This are the results using 1681 GCPs with Gauss Krueger
> coordinates (UTM coordinates should show almost the same results).
> 
> Order         1     2    3     4     5
> -------------------------------------------
> original  17.19 21.94 25.8    -     -
> precond.  17.19 13.98 10.22   -     -
> armadillo 17.19 13.98 10.22 9.24 2729195.82
> 
> Using spherical coordinates yields
> 
> Order         1     2    3     4     5
> -------------------------------------------
> original  17.18 15.4  15.19	-	-
> precond.  17.18 13.97 10.22	-	-
> armadillo 17.18 13.97 10.22 9.24  7.26
> 
> This shows, that a scaling of the coordinates can improve the stability even
> more.
> 
> The effect even shows up using less GCPs. With 20 GCPs and Gauss Kruger
> coordinates the result is as follows:
> 
> Order         1       2      3     4     5
> -------------------------------------------
> Original  0.3674  0.3672 0.3685   -     -
> precond.  0.3674  0.3359 0.2572   -     -
> armadillo 0.3674	0.3359 0.2572 0.1216 5.793
> 
> I attach a patch file with the modifications and the script to compute the
> mean deviations. Analyzing he code I presumably found two small bugs which
> I have corrected.
> 
> Martin
> 
> ----Ursprüngliche Nachricht-----
> Von: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] Im Auftrag von
> Franzke, Martin Gesendet: Freitag, 18. Mai 2018 17:20
> An: gdal-dev at lists.osgeo.org
> Betreff: [gdal-dev] Interesting issue with ogr2ogr and -tps
> 
> >On mardi 27 juin 2017 07:34:59 CEST Rahkonen Jukka (MML) wrote:
> >> Hi,
> >> 
> >> There is a well written question in gis.stackexchange about how the
> >> -tps option in ogr2ogr behaves
> >> https://gis.stackexchange.com/questions/245391/ogr2org-tps-spline-met
> >> hod-cr
> >> eates-progressive-error
> >> 
> >> Does anybody have a clue about what happens?
> >
> >TPS is supposed to be exact at GCP, and interpolate between them. That
> >said, it looks from this report like there might be a numerical
> >stability issue. There are 2 solvers for the TPS
> >transformer: a built-in that does matrix inversion "at hand" using
> >Gauss- Jordan elimination method (the one that is taught at school if I
> >remember well -:) ), and another one that uses the armadillo library
> >that is faster and relates underneath on well proven numerical
> >computation libraries (blas/lapack). I don't think osgeo4w builds use
> >armadillo (actually I don't see anything in the nmake.opt related to
> >armadillo). That said, I see that the Gauss-Jordan implementation usd uses
> >the "partial pivonting" mentionned in
> >https://en.wikipedia.org/wiki/Pivot_element#Partial_and_complete_pivoti
> >ng so this should normally account for most numerical stabilities issues.
> >So either the user is rather unlikely and has encountered a case where
> >numerical instability occur, either his test/GCPs are wrong.
> >And I wouldn't have anticipated that numerical stabilities issues have
> >such a north-to-south pattern, but perhaps...
> >
> >Even
> >
> >
> >--
> >Spatialys - Geospatial professional services http://www.spatialys.com
> 
> Hi,
> 
> I had a similar problem when not using armadillo, but a simple
> transformation does the trick. The problem is that usually the distance of
> different gcps compared their absolute value is very small.
> 
> This leads to a bad conditioned linear equation system (see
> https://en.wikipedia.org/wiki/Condition_number): The first column consists
> of 1s and the second and third of the x, y values of the gcps respectively.
> Now if the difference of the gcps is relatively small the second and third
> row are nearly colinear to the first one, hence the matrix is nearly
> singular.
> 
> The solution is to shift the coordinate system by the mean value of all gcps
> and solving the modified linear equations. Since the basis function of the
> TPS only depends on the difference of coordinates the resulting
> transformation is the same.
> 
> For the implementation details see the attached patch file.
> 
> Martin


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mateusz at loskot.net  Thu Jun 14 08:33:46 2018
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 14 Jun 2018 17:33:46 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <CABUeae_hy=h85oaGw7RwUbkJZRm2Yvv4zPVPEhQnTWg+a2OT+w@mail.gmail.com>

On 14 June 2018 at 14:17, Alex HighViz <alexhighviz at hotmail.com> wrote:
>
> I few times I have posted to the list trying to promote the idea of
> providing iterators over pixels in a raster band , and more generally to
> make raster data accessible using (future) standard conforming ranges.

In case you are not aware, Boost.GIL provides such abstractions [1]
It's not yet pure C++20 ranges, there will be at some point.
Although Boost.GIL design is a complex one, it's IMHO not trivial to beat
its feature-completness, flexibility, extensibility and performance it
can generate.

FYI, I have half-baked IO extension for GDAL.
I'm going to continue/finish it as soon as next Boost version is released
which should include completely new version of IO layer.
Then, it can become another one to compare in your benchmark.

[1] http://boostorg.github.io/gil/develop/doc/html/design_guide.html
[2] https://lists.boost.org/boost-announce/2011/01/0281.php

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From alexhighviz at hotmail.com  Thu Jun 14 09:47:58 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Thu, 14 Jun 2018 16:47:58 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
 benchmark
In-Reply-To: <CABUeae_hy=h85oaGw7RwUbkJZRm2Yvv4zPVPEhQnTWg+a2OT+w@mail.gmail.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae_hy=h85oaGw7RwUbkJZRm2Yvv4zPVPEhQnTWg+a2OT+w@mail.gmail.com>
Message-ID: <HE1PR0501MB2698976D148EE9F927E38C04B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>

Hi Mateusz,

Yes, I am aware of Boost.GIL, but perhaps didn't study it well enough when it became part of Boost. The section on usage on image views (http://boostorg.github.io/gil/develop/doc/html/design_guide.html#image-view) illustrates exactly the kind of flexibility I would like to have when working with geographical raster data, and is what motivates me in Pronto Raster. The image view concept in GIL  serves exactly the same function as the raster concept in Pronto, but seems a bit more robust in adherence to standards.

I remember when looking at it at the time that I felt that using Boost.GIL would give me more difficulty than reward. I would have to make a lot of effort to wrap GDALRasterband's up to conform to GIL concepts and then would still need to implement the functionality that I was after then (generalized moving windows, i.e. convolutions, with a custom function, https://www.sciencedirect.com/science/article/pii/S0303243415300337  ). Now with hindsight, it is perhaps not that much *extra* work to allign Pronto's Raster View with GIL's Image View; it would put existing GIL features in scope and allow for the best of both worlds.

Have you looked at Pronto's gdal_raster_view class? It seems to meet most of the Image View requirement and might be of help when finishing the IO extension for GDAL. 

Would you by any chance be able (and willing) to conjure up a simple example of "OUT = 3 * A + B * C" using Boost.GIL?

Thank you for your input.

Alex


p.s. I do remember a blog post or message on the boost mailing list by you saying how great it would be to have Boost.GIL compatible with GDAL.



-----Original Message-----
From: Mateusz Loskot [mailto:mateusz at loskot.net] 
Sent: 14 June 2018 16:34
To: Alex HighViz <alexhighviz at hotmail.com>
Cc: gdal-dev at lists.osgeo.org; Hagen-Zanker AH Dr (Civil & Env. Eng.) <a.hagen-zanker at surrey.ac.uk>
Subject: Re: [gdal-dev] Help with idiomatic GDAL solution for raster algebra benchmark

On 14 June 2018 at 14:17, Alex HighViz <alexhighviz at hotmail.com> wrote:
>
> I few times I have posted to the list trying to promote the idea of 
> providing iterators over pixels in a raster band , and more generally 
> to make raster data accessible using (future) standard conforming ranges.

In case you are not aware, Boost.GIL provides such abstractions [1] It's not yet pure C++20 ranges, there will be at some point.
Although Boost.GIL design is a complex one, it's IMHO not trivial to beat its feature-completness, flexibility, extensibility and performance it can generate.

FYI, I have half-baked IO extension for GDAL.
I'm going to continue/finish it as soon as next Boost version is released which should include completely new version of IO layer.
Then, it can become another one to compare in your benchmark.

[1] http://boostorg.github.io/gil/develop/doc/html/design_guide.html
[2] https://lists.boost.org/boost-announce/2011/01/0281.php

Best regards,
--
Mateusz Loskot, http://mateusz.loskot.net

From even.rouault at spatialys.com  Thu Jun 14 13:22:36 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 14 Jun 2018 22:22:36 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <1907458.9mazDPShZq@even-i700>

Hi,

Interesting work.

A few thoughts:

- the benchmark_3_rasters_reference() could receive a few comments for non-
advanced users to mention that it is correct only if all the rasters use Byte 
datatype, and all have the same block size.

- It would be interesting to see a variant of this reference benchmark that 
does no computation at all, that is to say remove the for (int iY = 0; iY < 
nYValid; iY++) loop . That would show how much CPU computation time is really 
involved

- 1000x1000 is somewhat small. Perhaps benchmark on larger rasters

- with some tricks, it should probably be possible to have a compiler generate 
SSE2/AVX2 instructions for the computation loop of the reference benchmark, 
since it looks like an excellent candidate for vectorization. Or that could be 
done at hand with a few _mm_ intrinsincs. Do you think that Pronto could use 
that ?

- it would be interested if you could also benchmark a VRT with Python numpy-
based pixel function, and enable Numba. See
http://www.gdal.org/gdal_vrttut.html#gdal_vrttut_derived_python (or just pure 
numpy based computation + Numba)

- the benchmark only involve integer computations. What if you do linear 
combination of bands with floating-point coefficients for example ?

Even

> Dear all,
> 
> I few times I have posted to the list trying to promote the idea of
> providing iterators over pixels in a raster band , and more generally to
> make raster data accessible using (future) standard conforming ranges. It
> would make implementing algorithms on raster data a lot more intuitive. 
> These ideas are implemented in Pronto Raster which is an OSGeo Community
> C++ library. Feedback in this list has been that such a solution would
> incur costly computational overheads.
> 
> I now have some preliminary benchmark results, where I compare Pronto Raster
> solutions for a simple raster overlay operation (OUT = 3 * A + B * C) to a
> direct and idiomatic GDAL implementation. The results seem to indicate that
> overheads can be negligible, depending on which Pronto Raster functions are
> used. I would very much appreciate it if some more experienced GDAL C++
> users could look at my "idiomatic GDAL implementation" to see if it really
> is what it claims to be and I am not overstating the results. I can use
> your help.
> 
> I'd also be interested to hear any opinion about these results and the costs
> / benefits associated with providing pixel ranges for raster bands.
> 
> For details on the benchmark see here:   
> https://github.com/ahhz/raster/blob/master/docs/_posts/2018-06-14-Prelimina
> ry-benchmark-results-are-promising.md or here:
> http://ahhz.github.io/raster/Preliminary-benchmark-results-are-promising/
> 
> Many thanks,  Alex


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From markus.metz.giswork at gmail.com  Thu Jun 14 13:48:23 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Thu, 14 Jun 2018 22:48:23 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
 that are not nodata)
In-Reply-To: <3223282.c4yXVfkOzm@even-i700>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <3223282.c4yXVfkOzm@even-i700>
Message-ID: <CAG+h=FH0yB=_k93xFv=6eXvef3yQt+mQucHyzG2JbZ9Ovrtk=A@mail.gmail.com>

On Wed, Jun 13, 2018 at 11:03 PM, Even Rouault <even.rouault at spatialys.com>
wrote:
>
> On mercredi 13 juin 2018 22:14:07 CEST Markus Metz wrote:
> > Many raster bands contain nodata, therefore it would be helpful if the
> > number of non-nodata grid cells could be reported by gdalinfo in some
way.
> >
> > The number of non-nodata grid cells is not available through
> > GDALGetRasterStatistics() / GDALRasterBand::GetStatistics(), probably
> > because approximations can be stored as raster band statistics, and the
> > number of non-nodata grid cells is unknown in case of approximations.
> >
> > Therefore I suggest to report the number of non-nodata grid cells only
if
> > all grid cells are evaluated, i.e. with
> >
> > *gdalinfo -mm* Force computation of the actual min/max values for each
band
> > in the dataset.
> >
> > The number of non-nodata grid cells would be a small piece of quite
useful
> > information to quickly evaluate the usefulness of a raster band.
> >
> > Asking for the possibility to enhance a bit the output of gdalinfo,
>
> Markus,
>
> That would be more something triggered by -stats since this number of non-
> nondata cells is an intermediate result of
GDALRasterBand::ComputeStatistics()
> in gcore/gdalrasterband.cpp. To make it sensical even in the case of
> approximate statistics, why not computing a percentage instead ? That
would
> need to be saved in a metadata item, let's say STATISTICS_VALID_RATIO
(between
> 0 and 1) ?

Considering approximate statistics, something like STATISTICS_VALID_RATIO
would make sense.

However, I am not interested in approximate statistics, therefore my
suggestion to tie it to -mm.

> Wanna take a crack at implementing this ?

Too many API changes required, starting with GDALGetRasterStatistics(),
GDALComputeRasterStatistics() and all else following. There must be an
easier solution. But thanks for your offer:-)

My workaround is to use GRASS r.external to get correct raster band
statistics.

> Otherwise file an
> enhancement ticket about that.
> By the way, since GDAL 2.3.0, there's a STATISTICS_APPROXIMATE=YES
metadata
> item so as to know if the stats have been computed in an approx way or not

Enhancement request: set STATISTICS_APPROXIMATE=UNKNOWN if it is unknown. I
checked with some externally provided sample data and GDAL 2.3.0 does not
report STATISTICS_APPROXIMATE.

I understand that GDAL has to cater for approximate statistics and should
not override metadata provided with raster bands created by other software.
It would help if STATISTICS_APPROXIMATE is always set to NO|YES|UNKNOWN.

Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180614/551539ce/attachment.html>

From even.rouault at spatialys.com  Thu Jun 14 13:55:39 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 14 Jun 2018 22:55:39 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
	that are not nodata)
In-Reply-To: <CAG+h=FH0yB=_k93xFv=6eXvef3yQt+mQucHyzG2JbZ9Ovrtk=A@mail.gmail.com>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <3223282.c4yXVfkOzm@even-i700>
 <CAG+h=FH0yB=_k93xFv=6eXvef3yQt+mQucHyzG2JbZ9Ovrtk=A@mail.gmail.com>
Message-ID: <7792845.RlAcMUH6Dv@even-i700>

> > Wanna take a crack at implementing this ?
> 
> Too many API changes required, starting with GDALGetRasterStatistics(),
> GDALComputeRasterStatistics() and all else following. There must be an
> easier solution. But thanks for your offer:-)

We don't necessary need to change the API. The function could just set the 
metadata item, and the client would read it with GDALGetMetadataItem()

> Enhancement request: set STATISTICS_APPROXIMATE=UNKNOWN if it is unknown. I
> checked with some externally provided sample data and GDAL 2.3.0 does not
> report STATISTICS_APPROXIMATE.

I didn't want to pollute statistics with STATISTICS_APPROXIMATE=NO when exact 
computation has been done. So basically you have STATISTICS_APPROXIMATE=YES or 
no STATISTICS_APPROXIMATE at all when exact computation has been done (which 
is the normal assumption)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mateusz at loskot.net  Thu Jun 14 14:41:56 2018
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 14 Jun 2018 23:41:56 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB2698976D148EE9F927E38C04B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae_hy=h85oaGw7RwUbkJZRm2Yvv4zPVPEhQnTWg+a2OT+w@mail.gmail.com>
 <HE1PR0501MB2698976D148EE9F927E38C04B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <CABUeae-r+LNYmLcTbFG=9dMPF2y-2ZR=wrsZr=S7trQQqw9cQg@mail.gmail.com>

On 14 June 2018 at 18:47, Alex HighViz <alexhighviz at hotmail.com> wrote:
> I remember when looking at it at the time that I felt that using Boost.GIL would give me more difficulty than reward.

It is not easy indeed. Things had not been improved for long time,
esp. documenation. It's changing and improving though.

> I would have to make a lot of effort to wrap GDALRasterband's up to conform to GIL concepts and then would still need to implement the functionality that I was after then (generalized moving windows, i.e. convolutions, with a custom function, https://www.sciencedirect.com/science/article/pii/S0303243415300337  ).

This is an interesting topic, I may review Boost.GIL features in this context.

> Now with hindsight, it is perhaps not that much *extra* work to allign Pronto's Raster View with GIL's Image View; it would put existing GIL features in scope and allow for the best of both worlds.

An interoperability certainly is possible with some adaptation in one
or both directions.

> Have you looked at Pronto's gdal_raster_view class? It seems to meet most of the Image View requirement and might be of help when finishing the IO extension for GDAL.

Yes, briefly. It looks like gdal_raster_view  offers one mode of iterations.

Boost.GIL allows operations on views which are:
- no iteartion (eg. single memmove)
- 1D iteration, usually fastest
- 2D iteration
Algorithms auto-choose depending on traversable mode available for
particular view(s).
This should not be an issue for adaptation though.

By the way, for example, a raw array of bytes is also easily adaptable
as a view, two arrays (colour table and image bytes) can also be
adapted as an indexed view/image.

> Would you by any chance be able (and willing) to conjure up a simple example of "OUT = 3 * A + B * C" using Boost.GIL?

I may give it a go, perhaps after new Boost.GIL is out.

BTW, if you have any GIL-specific questions, there is
https://lists.boost.org/mailman/listinfo.cgi/boost-gil  (low traffic).

> p.s. I do remember a blog post or message on the boost mailing list by you saying how great it would be to have Boost.GIL compatible with GDAL.

I don't remember exactly, but might got excited about this idea :-)

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From mateusz at loskot.net  Thu Jun 14 16:13:26 2018
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 15 Jun 2018 01:13:26 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB2698976D148EE9F927E38C04B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae_hy=h85oaGw7RwUbkJZRm2Yvv4zPVPEhQnTWg+a2OT+w@mail.gmail.com>
 <HE1PR0501MB2698976D148EE9F927E38C04B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <CABUeae_i6YW7KRgSb3si8D+qQON7HziZ2omyVCGOnKo=WOPdaA@mail.gmail.com>

On 14 June 2018 at 18:47, Alex HighViz <alexhighviz at hotmail.com> wrote:
> Would you by any chance be able (and willing) to conjure up a simple example of "OUT = 3 * A + B * C" using Boost.GIL?

Quick update: out of the box, GIL provides related algorithm that
accepts one or two sources: transform_pixels
Here is example on channel-wise pixel addition:

How to combine images with boost gil?
https://stackoverflow.com/a/47623314/151641

The transform_pixels could be extended, using the binary
channel_multiply internally, etc.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From alexhighviz at hotmail.com  Thu Jun 14 16:22:09 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Thu, 14 Jun 2018 23:22:09 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
 benchmark
In-Reply-To: <1907458.9mazDPShZq@even-i700>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>,
 <1907458.9mazDPShZq@even-i700>
Message-ID: <HE1PR0501MB26984296FED49DF96B3959FDB47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>

Thanks for the suggestions. These extra benchmarks should be feasible in the next week. Especially if I manage to get started properly with Google benchmark. I need to look into sse2/ave2. My feeling is that will be easier and more effective for the reference case than for Pronto, because pronto is geared to express all operations at the pixel level.
________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: 14 June 2018 21:22:36
To: gdal-dev at lists.osgeo.org
Cc: Alex HighViz; Hagen-Zanker AH Dr (Civil & Env. Eng.)
Subject: Re: [gdal-dev] Help with idiomatic GDAL solution for raster algebra benchmark

Hi,

Interesting work.

A few thoughts:

- the benchmark_3_rasters_reference() could receive a few comments for non-
advanced users to mention that it is correct only if all the rasters use Byte
datatype, and all have the same block size.

- It would be interesting to see a variant of this reference benchmark that
does no computation at all, that is to say remove the for (int iY = 0; iY <
nYValid; iY++) loop . That would show how much CPU computation time is really
involved

- 1000x1000 is somewhat small. Perhaps benchmark on larger rasters

- with some tricks, it should probably be possible to have a compiler generate
SSE2/AVX2 instructions for the computation loop of the reference benchmark,
since it looks like an excellent candidate for vectorization. Or that could be
done at hand with a few _mm_ intrinsincs. Do you think that Pronto could use
that ?

- it would be interested if you could also benchmark a VRT with Python numpy-
based pixel function, and enable Numba. See
http://www.gdal.org/gdal_vrttut.html#gdal_vrttut_derived_python (or just pure
numpy based computation + Numba)

- the benchmark only involve integer computations. What if you do linear
combination of bands with floating-point coefficients for example ?

Even

> Dear all,
>
> I few times I have posted to the list trying to promote the idea of
> providing iterators over pixels in a raster band , and more generally to
> make raster data accessible using (future) standard conforming ranges. It
> would make implementing algorithms on raster data a lot more intuitive.
> These ideas are implemented in Pronto Raster which is an OSGeo Community
> C++ library. Feedback in this list has been that such a solution would
> incur costly computational overheads.
>
> I now have some preliminary benchmark results, where I compare Pronto Raster
> solutions for a simple raster overlay operation (OUT = 3 * A + B * C) to a
> direct and idiomatic GDAL implementation. The results seem to indicate that
> overheads can be negligible, depending on which Pronto Raster functions are
> used. I would very much appreciate it if some more experienced GDAL C++
> users could look at my "idiomatic GDAL implementation" to see if it really
> is what it claims to be and I am not overstating the results. I can use
> your help.
>
> I'd also be interested to hear any opinion about these results and the costs
> / benefits associated with providing pixel ranges for raster bands.
>
> For details on the benchmark see here:
> https://github.com/ahhz/raster/blob/master/docs/_posts/2018-06-14-Prelimina
> ry-benchmark-results-are-promising.md or here:
> http://ahhz.github.io/raster/Preliminary-benchmark-results-are-promising/
>
> Many thanks,  Alex


--
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180614/75d56778/attachment-0001.html>

From mateusz at loskot.net  Thu Jun 14 16:27:34 2018
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 15 Jun 2018 01:27:34 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB26984296FED49DF96B3959FDB47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>
 <HE1PR0501MB26984296FED49DF96B3959FDB47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <CABUeae97sTjOErPYputznsz2WvJOyjAY8iHCDXpsZR=CumYGQQ@mail.gmail.com>

On 15 June 2018 at 01:22, Alex HighViz <alexhighviz at hotmail.com> wrote:
> I need to look into sse2/ave2. My feeling is that will be easier
> and more effective for the reference case than for Pronto, because pronto is
> geared to express all operations at the pixel level.

You may try with auto vectorization first (could be interesting to
compare auto vectorized benchmark).
It's fairly easy to enable for MSVC, and GCC too, with a bunch of
compilation flags.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From ireese at linz.govt.nz  Thu Jun 14 17:15:22 2018
From: ireese at linz.govt.nz (Ian Reese)
Date: Fri, 15 Jun 2018 00:15:22 +0000
Subject: [gdal-dev] GDAL_GRID Linear: Segmentation Fault
Message-ID: <CE106C36F836424AB340432214B378BA2F33273A@prdassexch01.ad.linz.govt.nz>

Hi Gdal,

I am trying to do a linear interpolation using gdal_grid and I am getting a segmentation fault with output grid cell sizes smaller than 8m.

gdal_grid -zfield "depth" -a linear:nodata=-32768 -outsize 526 754 -of GTiff -l inshape inshape.shp outtif.tif --config GDAL_NUM_THREADS ALL_CPUS
Grid data type is "Float64"
Grid size = (526 754).
Corner coordinates = (1671133.229795 5329097.839821)-(1675355.467899 5323053.902837).
Grid cell size = (8.011837 8.005215).
Source point count = 8363817.
Algorithm name: "linear".
Options are "radius=-1.000000:nodata=-32768.000000"

0...10...20...30...40...50...60...70...80..Segmentation fault (core dumped)

If I change the number of input points (use a much smaller area) things seem to work out OK.

Grid cell size = (6.282705 6.842535).
Source point count = 749329

So, I suspect there is a limitation to the number of points I can use for gdal_grid linear interpolation.  Is there a way I can increase the number of input points?  Or should I break up the region, interpolate smaller areas, and merge them back together in the end.  I have a large area with a large number of dense points (8 million points at 1m resolution).  I am trying to avoid breaking it into as few smaller regions as possible to avoid artifacts at the edges when stitching it back together.

I'd really like to use the linear interpolation if possible since it has nice smooth results and is much faster than IDW with smoothing.

Cheers,

Ian

________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180615/96e0ca4c/attachment.html>

From alexhighviz at hotmail.com  Thu Jun 14 23:45:49 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Fri, 15 Jun 2018 06:45:49 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
 benchmark
In-Reply-To: <CABUeae97sTjOErPYputznsz2WvJOyjAY8iHCDXpsZR=CumYGQQ@mail.gmail.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>
 <HE1PR0501MB26984296FED49DF96B3959FDB47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>,
 <CABUeae97sTjOErPYputznsz2WvJOyjAY8iHCDXpsZR=CumYGQQ@mail.gmail.com>
Message-ID: <HE1PR0501MB269877EF6E8AD66C4D0DE5ACB47C0@HE1PR0501MB2698.eurprd05.prod.outlook.com>

Great, will try and let you know.
________________________________
From: Mateusz Loskot <mateusz at loskot.net>
Sent: 15 June 2018 00:27:34
To: Alex HighViz
Cc: Even Rouault; gdal-dev at lists.osgeo.org; Hagen-Zanker AH Dr (Civil & Env. Eng.)
Subject: Re: [gdal-dev] Help with idiomatic GDAL solution for raster algebra benchmark

On 15 June 2018 at 01:22, Alex HighViz <alexhighviz at hotmail.com> wrote:
> I need to look into sse2/ave2. My feeling is that will be easier
> and more effective for the reference case than for Pronto, because pronto is
> geared to express all operations at the pixel level.

You may try with auto vectorization first (could be interesting to
compare auto vectorized benchmark).
It's fairly easy to enable for MSVC, and GCC too, with a bunch of
compilation flags.

Best regards,
--
Mateusz Loskot, http://mateusz.loskot.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180615/aace68d1/attachment.html>

From even.rouault at spatialys.com  Fri Jun 15 02:55:42 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 15 Jun 2018 11:55:42 +0200
Subject: [gdal-dev] GDAL_GRID Linear: Segmentation Fault
In-Reply-To: <CE106C36F836424AB340432214B378BA2F33273A@prdassexch01.ad.linz.govt.nz>
References: <CE106C36F836424AB340432214B378BA2F33273A@prdassexch01.ad.linz.govt.nz>
Message-ID: <2310147.cK4z6kg2OL@even-i700>

Ian,

which GDAL version is it ? There has been a bug fix in that area in 2.2.3  :
https://trac.osgeo.org/gdal/ticket/7101

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sean at mapbox.com  Fri Jun 15 07:37:10 2018
From: sean at mapbox.com (Sean Gillies)
Date: Fri, 15 Jun 2018 14:37:10 +0000
Subject: [gdal-dev] In-memory VRT performance
Message-ID: <CADPhZXye6s8_LycGC4g44LKY+0S+OioLLHSt4XtnuvAChbDfWQ@mail.gmail.com>

Hi all,

I have a GeoTIFF in S3 and am trying to access it via a VRT. I'm
constructing the VRT in Python and then passing the string directly to GDAL
like

    GDALOpenEx("<VRTDataset>...</VRTDataset>", ...)

I'm getting the results I expect, but very slowly. In my logs, it seems
that GDAL is fetching the entire GeoTIFF and copying it to /vsimem/ before
reading any data.

DEBUG:rasterio._base:Entering Dataset <open DatasetBase name='<VRTDataset
rasterXSize="48949" rasterYSize="15633"><SRS>PROJCS["WGS 84 / UTM zone
46N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS
84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",93],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32646"]]</SRS><GeoTransform>242785.74302396187,0.018557199999999992,0.0,2634995.766347841,0.0,-0.018557199999991995</GeoTransform><VRTRasterBand
band="1"
dataType="Byte"><ColorInterp>Red</ColorInterp><ComplexSource><SourceFilename
relativeToVRT="0">
http://oin-hotosm.s3.amazonaws.com/5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif</SourceFilename><SourceBand>1</SourceBand><SourceProperties
BlockXSize="512" BlockYSize="512" RasterXSize="48949" RasterYSize="15633"
dataType="Byte" /><SrcRect xOff="0" xSize="48948" yOff="0" ySize="15632"
/><DstRect xOff="0.0" xSize="48948" yOff="-0.0" ySize="15632"
/></ComplexSource></VRTRasterBand><VRTRasterBand band="2"
dataType="Byte"><ColorInterp>Green</ColorInterp><ComplexSource><SourceFilename
relativeToVRT="0">
http://oin-hotosm.s3.amazonaws.com/5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif</SourceFilename><SourceBand>2</SourceBand><SourceProperties
BlockXSize="512" BlockYSize="512" RasterXSize="48949" RasterYSize="15633"
dataType="Byte" /><SrcRect xOff="0" xSize="48948" yOff="0" ySize="15632"
/><DstRect xOff="0.0" xSize="48948" yOff="-0.0" ySize="15632"
/></ComplexSource></VRTRasterBand><VRTRasterBand band="3"
dataType="Byte"><ColorInterp>Blue</ColorInterp><ComplexSource><SourceFilename
relativeToVRT="0">
http://oin-hotosm.s3.amazonaws.com/5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif</SourceFilename><SourceBand>3</SourceBand><SourceProperties
BlockXSize="512" BlockYSize="512" RasterXSize="48949" RasterYSize="15633"
dataType="Byte" /><SrcRect xOff="0" xSize="48948" yOff="0" ySize="15632"
/><DstRect xOff="0.0" xSize="48948" yOff="-0.0" ySize="15632"
/></ComplexSource></VRTRasterBand><MaskBand><VRTRasterBand
dataType="Byte"><SimpleSource><SourceFilename relativeToVRT="0">
http://oin-hotosm.s3.amazonaws.com/5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif</SourceFilename><OpenOptions><OOI
key="OVERVIEW_LEVEL">AUTO</OOI></OpenOptions><SourceBand>mask,1</SourceBand><SourceProperties
BlockXSize="512" BlockYSize="512" RasterXSize="48949" RasterYSize="15633"
dataType="Byte" /><SrcRect xOff="0" xSize="48948" yOff="0" ySize="15632"
/><DstRect xOff="0.0" xSize="48948" yOff="-0.0" ySize="15632"
/></SimpleSource></VRTRasterBand></MaskBand></VRTDataset>' mode='r'>
context.
DEBUG:rasterio._io:IO window xoff=0.0 yoff=0.0 width=48948.0 height=15632.0
DEBUG:rasterio._gdal:CPLE_None in HTTP: Fetch(
http://oin-hotosm.s3.amazonaws.com/5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif
)
GDAL: GDALOpen(/vsimem/http_1/3fa181a1-425c-4e53-b49f-ea72884da097.tif,
this=0x101e9f4c0) succeeds as GTiff.
DEBUG:rasterio._gdal:CPLE_None in GDAL: GDALOpen(
http://oin-hotosm.s3.amazonaws.com/5a324a622553e6000ce5aaf5/0/3fa181a1-425c-4e53-b49f-ea72884da097.tif,
this=0x101e9f4c0) succeeds as HTTP.
DEBUG:rasterio._gdal:CPLE_None in GTiff: ScanDirectories()
DEBUG:rasterio._gdal:CPLE_None in GTiff: Opened 24474x7816 overview.
DEBUG:rasterio._gdal:CPLE_None in GTiff: Opened 12237x3908 overview.
DEBUG:rasterio._gdal:CPLE_None in GTiff: Opened 6119x1954 overview.
DEBUG:rasterio._gdal:CPLE_None in GTiff: Opened 3060x977 overview.
DEBUG:rasterio._gdal:CPLE_None in GTiff: Opened 1530x489 overview.
DEBUG:rasterio._gdal:CPLE_None in GTiff: Opened 765x245 overview.
DEBUG:rasterio._gdal:CPLE_None in GTiff: Opened 383x123 overview.

Once the entire GeoTIFF has been download, the overviews are accessed as
I'd expect, but too late to be useful.

Is there a way to bypass creation of the /vsimem/ copy of the source
dataset when passing a VRT XML doc like this to GDALOpenEx?

Thanks in advance,

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180615/683d68a8/attachment-0001.html>

From even.rouault at spatialys.com  Fri Jun 15 07:48:20 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 15 Jun 2018 16:48:20 +0200
Subject: [gdal-dev] In-memory VRT performance
In-Reply-To: <CADPhZXye6s8_LycGC4g44LKY+0S+OioLLHSt4XtnuvAChbDfWQ@mail.gmail.com>
References: <CADPhZXye6s8_LycGC4g44LKY+0S+OioLLHSt4XtnuvAChbDfWQ@mail.gmail.com>
Message-ID: <2108921.R9M1nqlLDZ@even-i700>

Hi Sean,

> 
> I have a GeoTIFF in S3 and am trying to access it via a VRT. I'm
> constructing the VRT in Python and then passing the string directly to GDAL
> like
> 
>     GDALOpenEx("<VRTDataset>...</VRTDataset>", ...)
> 
> I'm getting the results I expect, but very slowly. In my logs, it seems
> that GDAL is fetching the entire GeoTIFF and copying it to /vsimem/ before
> reading any data.

In your VRT, you use a filename starting by "http://", and this will be 
handled by the historic HTTP "driver", that downloads the whole file, before 
passing it to the final driver that can handle it.

You just need to prefix the filename with /vsicurl/

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sean at mapbox.com  Fri Jun 15 08:06:09 2018
From: sean at mapbox.com (Sean Gillies)
Date: Fri, 15 Jun 2018 15:06:09 +0000
Subject: [gdal-dev] In-memory VRT performance
In-Reply-To: <2108921.R9M1nqlLDZ@even-i700>
References: <CADPhZXye6s8_LycGC4g44LKY+0S+OioLLHSt4XtnuvAChbDfWQ@mail.gmail.com>
 <2108921.R9M1nqlLDZ@even-i700>
Message-ID: <CADPhZXyFZE4O4N0sQKxG_w+F2mzgdL++xi7BkQR_Kn7qejRq+Q@mail.gmail.com>

Hi Even,

On Fri, Jun 15, 2018 at 2:48 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi Sean,
>
> >
> > I have a GeoTIFF in S3 and am trying to access it via a VRT. I'm
> > constructing the VRT in Python and then passing the string directly to
> GDAL
> > like
> >
> >     GDALOpenEx("<VRTDataset>...</VRTDataset>", ...)
> >
> > I'm getting the results I expect, but very slowly. In my logs, it seems
> > that GDAL is fetching the entire GeoTIFF and copying it to /vsimem/
> before
> > reading any data.
>
> In your VRT, you use a filename starting by "http://", and this will be
> handled by the historic HTTP "driver", that downloads the whole file,
> before
> passing it to the final driver that can handle it.
>
> You just need to prefix the filename with /vsicurl/
>
> Even
>

Indeed, that was it! Thank you.

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180615/28476b11/attachment.html>

From markus.metz.giswork at gmail.com  Fri Jun 15 13:21:23 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Fri, 15 Jun 2018 22:21:23 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
 that are not nodata)
In-Reply-To: <7792845.RlAcMUH6Dv@even-i700>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <3223282.c4yXVfkOzm@even-i700>
 <CAG+h=FH0yB=_k93xFv=6eXvef3yQt+mQucHyzG2JbZ9Ovrtk=A@mail.gmail.com>
 <7792845.RlAcMUH6Dv@even-i700>
Message-ID: <CAG+h=FH5-1eU7o-a6CRFxFUcW_EBasuc7uHpfHp4p8O1+a_Mig@mail.gmail.com>

On Thu, Jun 14, 2018 at 10:55 PM, Even Rouault <even.rouault at spatialys.com>
wrote:
>
> > > Wanna take a crack at implementing this ?
> >
> > Too many API changes required, starting with GDALGetRasterStatistics(),
> > GDALComputeRasterStatistics() and all else following. There must be an
> > easier solution. But thanks for your offer:-)
>
> We don't necessary need to change the API. The function could just set the
> metadata item, and the client would read it with GDALGetMetadataItem()

Thinking about it, I do not want to support approximate statistics,
therefore something like STATISTICS_VALID_RATIO does not work for me, only
something like STATISTICS_N_VALID which requires exact statistics.
Approximate statistics are confusing for users, unless it is made clear
that these statistics are approximations. E.g. a user calculates exact
statistics with some software other than GDAL and then wonders why results
are different between gdalinfo and that some software known to calculate
exact statistics.
>
> > Enhancement request: set STATISTICS_APPROXIMATE=UNKNOWN if it is
unknown. I
> > checked with some externally provided sample data and GDAL 2.3.0 does
not
> > report STATISTICS_APPROXIMATE.
>
> I didn't want to pollute statistics with STATISTICS_APPROXIMATE=NO when
exact
> computation has been done. So basically you have
STATISTICS_APPROXIMATE=YES or
> no STATISTICS_APPROXIMATE at all when exact computation has been done
(which
> is the normal assumption)

Looking at random samples, the normal assumption must be
STATISTICS_APPROXIMATE=YES if STATISTICS_APPROXIMATE is not set. IMHO, GDAL
should set STATISTICS_APPROXIMATE=YES unless GDAL itself has computed exact
statistics. If in doubt set STATISTICS_APPROXIMATE=YES.

I am aware it's a conflict between providing results quickly to users and
providing exact results to users which might take longer to get. I am for
exact results.

Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180615/392d75de/attachment.html>

From even.rouault at spatialys.com  Fri Jun 15 13:43:47 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 15 Jun 2018 22:43:47 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
	that are not nodata)
In-Reply-To: <CAG+h=FH5-1eU7o-a6CRFxFUcW_EBasuc7uHpfHp4p8O1+a_Mig@mail.gmail.com>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <7792845.RlAcMUH6Dv@even-i700>
 <CAG+h=FH5-1eU7o-a6CRFxFUcW_EBasuc7uHpfHp4p8O1+a_Mig@mail.gmail.com>
Message-ID: <19374838.bOCIYbO0Au@even-i700>

> Thinking about it, I do not want to support approximate statistics,
> therefore something like STATISTICS_VALID_RATIO does not work for me, only
> something like STATISTICS_N_VALID which requires exact statistics.

STATISTICS_VALID_RATIO makes more sense to me that absolute number of pixels. 
I assume you want to know if you have only 10% or 99.5% valid pixels to decide 
if you want to process the image, rather than knowning if it is 10 or 1 
million (similarly to cloudiness value that is usually given as a percentage). 
For exact statistics, both relative or absolute number are strictly 
equivalent.

The advantage of using the ratio is that it still makes sense for approximate 
statistics.

For your use case, you check if STATISTICS_APPROXIMATE=YES is present or not 
to decide if you can trust STATISTICS_VALID_RATIO

> Approximate statistics are confusing for users, unless it is made clear
> that these statistics are approximations.

It is know, since STATISTICS_APPROXIMATE=YES is now set if you compute 
approximate statistics.

> Looking at random samples, the normal assumption must be
> STATISTICS_APPROXIMATE=YES if STATISTICS_APPROXIMATE is not set. IMHO, GDAL
> should set STATISTICS_APPROXIMATE=YES unless GDAL itself has computed exact
> statistics.

That's what GDAL 2.3.0 now does. Check the output of gdalinfo -stats vs 
gdalinfo -approx_stats.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From ireese at linz.govt.nz  Fri Jun 15 14:07:27 2018
From: ireese at linz.govt.nz (Ian Reese)
Date: Fri, 15 Jun 2018 21:07:27 +0000
Subject: [gdal-dev] GDAL_GRID Linear: Segmentation Fault
In-Reply-To: <2310147.cK4z6kg2OL@even-i700>
References: <CE106C36F836424AB340432214B378BA2F33273A@prdassexch01.ad.linz.govt.nz>,
 <2310147.cK4z6kg2OL@even-i700>
Message-ID: <CE106C36F836424AB340432214B378BA2F3327AC@prdassexch01.ad.linz.govt.nz>

Hi Evan,

Thanks for the heads up. I am running GDAL 2.2.2.  I'll upgrade and let you know how it works out.

Cheers,

Ian
________________________________________
From: Even Rouault [even.rouault at spatialys.com]
Sent: Friday, 15 June 2018 9:55 p.m.
To: gdal-dev at lists.osgeo.org
Cc: Ian Reese; Jeremy Palmer
Subject: Re: [gdal-dev] GDAL_GRID Linear: Segmentation Fault

Ian,

which GDAL version is it ? There has been a bug fix in that area in 2.2.3  :
https://trac.osgeo.org/gdal/ticket/7101

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com

________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.

From jukka.rahkonen at maanmittauslaitos.fi  Sat Jun 16 09:38:58 2018
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Sat, 16 Jun 2018 09:38:58 -0700 (MST)
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
 that are not nodata)
In-Reply-To: <CAG+h=FH0yB=_k93xFv=6eXvef3yQt+mQucHyzG2JbZ9Ovrtk=A@mail.gmail.com>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <3223282.c4yXVfkOzm@even-i700>
 <CAG+h=FH0yB=_k93xFv=6eXvef3yQt+mQucHyzG2JbZ9Ovrtk=A@mail.gmail.com>
Message-ID: <1529167138100-0.post@n6.nabble.com>

Markus Metz-3 wrote
> My workaround is to use GRASS r.external to get correct raster band
> statistics.

Hi,

Wouldn't it be good to have an option in GDAL to force it to re-compute
statistics? After all, statistics is just metadata and they can be all wrong
if you have touched the image with a third-party software.

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From markus.metz.giswork at gmail.com  Sat Jun 16 11:05:22 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Sat, 16 Jun 2018 20:05:22 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
 that are not nodata)
In-Reply-To: <1529167138100-0.post@n6.nabble.com>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <3223282.c4yXVfkOzm@even-i700>
 <CAG+h=FH0yB=_k93xFv=6eXvef3yQt+mQucHyzG2JbZ9Ovrtk=A@mail.gmail.com>
 <1529167138100-0.post@n6.nabble.com>
Message-ID: <CAG+h=FE_O8iDnFxr6uKyhtNvV8ZYbhjCL5GiDOvfT3pOdV6Hhg@mail.gmail.com>

On Sat, Jun 16, 2018 at 6:38 PM, jratike80 <
jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Markus Metz-3 wrote
> > My workaround is to use GRASS r.external to get correct raster band
> > statistics.
>
> Hi,
>
> Wouldn't it be good to have an option in GDAL to force it to re-compute
> statistics? After all, statistics is just metadata and they can be all
wrong
> if you have touched the image with a third-party software.

That would be helpful.

Regarding gdalinfo,
 - gdalinfo would report what it does right now (includes any STATISTICS_*
metadata items)
 - gdalinfo -stats would compute raster band stats using all grid cells,
ignoring any STATISTICS_* metadata items
 - gdalinfo -approx-stats would compute raster band stats using a sample of
all grid cells, ignoring any STATISTICS_* metadata items

Markus
>
> -Jukka Rahkonen-
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180616/9fbab58a/attachment.html>

From markus.metz.giswork at gmail.com  Sat Jun 16 11:52:39 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Sat, 16 Jun 2018 20:52:39 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
 that are not nodata)
In-Reply-To: <19374838.bOCIYbO0Au@even-i700>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <7792845.RlAcMUH6Dv@even-i700>
 <CAG+h=FH5-1eU7o-a6CRFxFUcW_EBasuc7uHpfHp4p8O1+a_Mig@mail.gmail.com>
 <19374838.bOCIYbO0Au@even-i700>
Message-ID: <CAG+h=FFkRKtqTBjUuSRw0vsKnf-xAgYaQ_ewm23_9m2XeACiFQ@mail.gmail.com>

On Fri, Jun 15, 2018 at 10:43 PM, Even Rouault <even.rouault at spatialys.com>
wrote:
>
> > Thinking about it, I do not want to support approximate statistics,
> > therefore something like STATISTICS_VALID_RATIO does not work for me,
only
> > something like STATISTICS_N_VALID which requires exact statistics.
>
> STATISTICS_VALID_RATIO makes more sense to me that absolute number of
pixels.

OK, considering that approximate statistics need to be supported, something
like STATISTICS_VALID_RATIO is the only option.

Setting such a metadata item would be relatively easy to implement.

>
> > Approximate statistics are confusing for users, unless it is made clear
> > that these statistics are approximations.
>
> It is know, since STATISTICS_APPROXIMATE=YES is now set if you compute
> approximate statistics.
>
> > Looking at random samples, the normal assumption must be
> > STATISTICS_APPROXIMATE=YES if STATISTICS_APPROXIMATE is not set. IMHO,
GDAL
> > should set STATISTICS_APPROXIMATE=YES unless GDAL itself has computed
exact
> > statistics.
>
> That's what GDAL 2.3.0 now does. Check the output of gdalinfo -stats vs
> gdalinfo -approx_stats.

I checked, results with gdalinfo -stats are wrong because existing
STATISTICS_* metadata are reported even if approximate statistics are not
allowed. The problem is, STATISTICS_APPROXIMATE is not set. Other software
using GDAL to create raster datasets may use
GDALRasterBand::SetStatistics() which does not indicate if stats are
approximations., i.e. stats are approximations but there is no
STATISTICS_APPROXIMATE=YES.

GDAL assumes that STATISTICS_* metadata represent stats on all pixels, this
is IMHO wrong. You can only hope that STATISTICS_* metadata represent stats
on all pixels if a respective metadata item has been set to boolean true,
something like STATISTICS_ALL_PIXELS=YES. Even in this case, an option to
force recomputing raster band stats would be very nice to have (verifying
metadata).

STATISTICS_EXACT is not an option because there are different ways to
calculate mean and stddev using a fixed set of values. The different
methods are all correct (exact) in their own way, but results may be
different.

Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180616/ab0fbb5d/attachment-0001.html>

From even.rouault at spatialys.com  Sat Jun 16 13:00:22 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 16 Jun 2018 22:00:22 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
	that are not nodata)
In-Reply-To: <CAG+h=FFkRKtqTBjUuSRw0vsKnf-xAgYaQ_ewm23_9m2XeACiFQ@mail.gmail.com>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <19374838.bOCIYbO0Au@even-i700>
 <CAG+h=FFkRKtqTBjUuSRw0vsKnf-xAgYaQ_ewm23_9m2XeACiFQ@mail.gmail.com>
Message-ID: <1576408.Kv6HhcKDGi@even-i700>

> 
> I checked, results with gdalinfo -stats are wrong because existing
> STATISTICS_* metadata are reported even if approximate statistics are not
> allowed.

No, if STATISTICS_APPROXIMATE=YES and is set in .aux.xml (because initial 
computation was done with -approx_stats) and you do gdalinfo -stats after, 
then statistics will be recomputed on all samples and 
STATISTICS_APPROXIMATE=YES  will be cleared

Demo:
$ gdalinfo -approx_stats test.tif
[...]
  Metadata:
    STATISTICS_APPROXIMATE=YES
    STATISTICS_MAXIMUM=206
    STATISTICS_MEAN=126.17083333333
    STATISTICS_MINIMUM=74
    STATISTICS_STDDEV=21.548781465291

$ gdalinfo -stats  test.tif
[...]
  Metadata:
    STATISTICS_MAXIMUM=255
    STATISTICS_MEAN=126.765
    STATISTICS_MINIMUM=74
    STATISTICS_STDDEV=22.928470838676



> The problem is, STATISTICS_APPROXIMATE is not set. Other software
> using GDAL to create raster datasets may use
> GDALRasterBand::SetStatistics() which does not indicate if stats are
> approximations., i.e. stats are approximations but there is no
> STATISTICS_APPROXIMATE=YES.

The idea is that if you use GDALRasterBand::SetStatistics()  then you are 
assumed to provide exact statistics. If they are only approximate, then you 
should also set STATISTICS_APPROXIMATE=YES with GDALSetMetadataItem()

> 
> GDAL assumes that STATISTICS_* metadata represent stats on all pixels, this
> is IMHO wrong. You can only hope that STATISTICS_* metadata represent stats
> on all pixels if a respective metadata item has been set to boolean true,
> something like STATISTICS_ALL_PIXELS=YES.

I'm really confused. Why introducing yet another item whereas 
STATISTICS_APPROXIMATE=YES is there for that purpose ?

> Even in this case, an option to
> force recomputing raster band stats would be very nice to have (verifying
> metadata).

ComputeStatistics() will recompute statistics. It is true that with gdalinfo -
stats, they are not recomputed if they already exist and were not approximate 
since it calls GetStatistics() and not ComputeStatistics(). An easy workaround 
is to delete the .aux.xml to force recomputation.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From guyd at satellogic.com  Sun Jun 17 00:19:34 2018
From: guyd at satellogic.com (Guy Doulberg)
Date: Sun, 17 Jun 2018 10:19:34 +0300
Subject: [gdal-dev] Tiled GeoTiff that reduce the amount of reads in XYZ maps
Message-ID: <CAJ18MZoKqSB0FQEnbdJ+hSk5hTU9JETSe9yA+jEUNqbYBGVWfg@mail.gmail.com>

Hi all,

I am trying to use cloud optimized geotiff(cog) to reduce the block fetched
when accessing a raster.

The use case I am trying to build, is a TileServer that serves tile in
openlayer map.
The rasters are to be stored on a remote location, in my case azure blob
storage.

We were able to do that, and you can see the code here:
https://github.com/satellogic/telluric/blob/master/telluric/
georaster.py#L1497

The problem is, when running in verbose mode I can see that there are many
requests to the blob storage,

I am responsible of creating the raster, is there a way in your opinion I
can create the raster aligned to the XYZ tiling system so when I try to
fetch a tile from the raster I will be able to do that with a single or
close to that call?

In the current raster preparation code that I have, get_tile can reach even
10 requests.


Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180617/6a904040/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Sun Jun 17 02:00:09 2018
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Sun, 17 Jun 2018 02:00:09 -0700 (MST)
Subject: [gdal-dev] Tiled GeoTiff that reduce the amount of reads in XYZ
 maps
In-Reply-To: <CAJ18MZoKqSB0FQEnbdJ+hSk5hTU9JETSe9yA+jEUNqbYBGVWfg@mail.gmail.com>
References: <CAJ18MZoKqSB0FQEnbdJ+hSk5hTU9JETSe9yA+jEUNqbYBGVWfg@mail.gmail.com>
Message-ID: <1529226009938-0.post@n6.nabble.com>

Guy Doulberg wrote
> Hi all,
> 
> I am trying to use cloud optimized geotiff(cog) to reduce the block
> fetched
> when accessing a raster.
> 
> The use case I am trying to build, is a TileServer that serves tile in
> openlayer map.
> The rasters are to be stored on a remote location, in my case azure blob
> storage.
> 
> We were able to do that, and you can see the code here:
> https://github.com/satellogic/telluric/blob/master/telluric/
> georaster.py#L1497
> 
> The problem is, when running in verbose mode I can see that there are many
> requests to the blob storage,
> 
> I am responsible of creating the raster, is there a way in your opinion I
> can create the raster aligned to the XYZ tiling system so when I try to
> fetch a tile from the raster I will be able to do that with a single or
> close to that call?
> 
> In the current raster preparation code that I have, get_tile can reach
> even
> 10 requests.

Hi,

I wonder if something re-usable is implemented in the GeoTIFF cache type of
MapCache http://mapserver.org/mapcache/caches.html.

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Sun Jun 17 02:00:08 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 17 Jun 2018 11:00:08 +0200
Subject: [gdal-dev] Tiled GeoTiff that reduce the amount of reads in XYZ
	maps
In-Reply-To: <CAJ18MZoKqSB0FQEnbdJ+hSk5hTU9JETSe9yA+jEUNqbYBGVWfg@mail.gmail.com>
References: <CAJ18MZoKqSB0FQEnbdJ+hSk5hTU9JETSe9yA+jEUNqbYBGVWfg@mail.gmail.com>
Message-ID: <4584053.NxyQt6sEcZ@even-i700>

On dimanche 17 juin 2018 10:19:34 CEST Guy Doulberg wrote:
> Hi all,
> 
> I am trying to use cloud optimized geotiff(cog) to reduce the block fetched
> when accessing a raster.
> 
> The use case I am trying to build, is a TileServer that serves tile in
> openlayer map.
> The rasters are to be stored on a remote location, in my case azure blob
> storage.
> 
> We were able to do that, and you can see the code here:
> https://github.com/satellogic/telluric/blob/master/telluric/
> georaster.py#L1497
> 
> The problem is, when running in verbose mode I can see that there are many
> requests to the blob storage,
> 
> I am responsible of creating the raster, is there a way in your opinion I
> can create the raster aligned to the XYZ tiling system so when I try to
> fetch a tile from the raster I will be able to do that with a single or
> close to that call?

If your raster source is not already in WebMercator projection, you could use 
gdalwarp with the appropriate -te and -tr to align on the boundaries of XYZ 
tiling scheme at a given zoom level.

If your raster is already in WebMercator, gdal_translate -projwin -tr would do

If you don't want to compute the bounds, you could use gdal_translate to 
MBTiles that will use gdalwarp internally to reproject and align on XYZ tiling 
scheme automatically, followed by gdal_translate to TIFF with -oo 
USE_BOUNDS=NO so that the extent used aligns on tile boundaries.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From guyd at satellogic.com  Sun Jun 17 06:51:00 2018
From: guyd at satellogic.com (Guy Doulberg)
Date: Sun, 17 Jun 2018 16:51:00 +0300
Subject: [gdal-dev] Tiled GeoTiff that reduce the amount of reads in XYZ
	maps
In-Reply-To: <4584053.NxyQt6sEcZ@even-i700>
References: <CAJ18MZoKqSB0FQEnbdJ+hSk5hTU9JETSe9yA+jEUNqbYBGVWfg@mail.gmail.com>
 <4584053.NxyQt6sEcZ@even-i700>
Message-ID: <CAJ18MZoPD+1sfqtf+CXmPK6V6zkeinZS1T7i1Df5yRiCm5sTfA@mail.gmail.com>

Thanks Even

I tried both ways and in both I am still getting a lot of requests, I am
exepcting only few, one for the headers and one for the tile:


The resolution I used is driven from
https://wiki.openstreetmap.org/wiki/Zoom_levels

and the bounds I calculated using mercantile

so an example of what I ran is:

gdal_translate source.tif target.tif -co TILED=YES -co
COPY_SRC_OVERVIEWS=YES -co COMPRESS=LZW -tr 0.596 0.596   -projwin
675091.8338146766 4706074.957461731 684875.7734351791 4696291.017841227

One more thing, the raster I got is 1/3 of the size of the original raster

On Sun, Jun 17, 2018 at 12:00 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On dimanche 17 juin 2018 10:19:34 CEST Guy Doulberg wrote:
> > Hi all,
> >
> > I am trying to use cloud optimized geotiff(cog) to reduce the block
> fetched
> > when accessing a raster.
> >
> > The use case I am trying to build, is a TileServer that serves tile in
> > openlayer map.
> > The rasters are to be stored on a remote location, in my case azure blob
> > storage.
> >
> > We were able to do that, and you can see the code here:
> > https://github.com/satellogic/telluric/blob/master/telluric/
> > georaster.py#L1497
> >
> > The problem is, when running in verbose mode I can see that there are
> many
> > requests to the blob storage,
> >
> > I am responsible of creating the raster, is there a way in your opinion I
> > can create the raster aligned to the XYZ tiling system so when I try to
> > fetch a tile from the raster I will be able to do that with a single or
> > close to that call?
>
> If your raster source is not already in WebMercator projection, you could
> use
> gdalwarp with the appropriate -te and -tr to align on the boundaries of
> XYZ
> tiling scheme at a given zoom level.
>
> If your raster is already in WebMercator, gdal_translate -projwin -tr
> would do
>
> If you don't want to compute the bounds, you could use gdal_translate to
> MBTiles that will use gdalwarp internally to reproject and align on XYZ
> tiling
> scheme automatically, followed by gdal_translate to TIFF with -oo
> USE_BOUNDS=NO so that the extent used aligns on tile boundaries.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180617/eaf747db/attachment.html>

From guyd at satellogic.com  Sun Jun 17 07:25:01 2018
From: guyd at satellogic.com (Guy Doulberg)
Date: Sun, 17 Jun 2018 17:25:01 +0300
Subject: [gdal-dev] Tiled GeoTiff that reduce the amount of reads in XYZ
	maps
In-Reply-To: <CAJ18MZoPD+1sfqtf+CXmPK6V6zkeinZS1T7i1Df5yRiCm5sTfA@mail.gmail.com>
References: <CAJ18MZoKqSB0FQEnbdJ+hSk5hTU9JETSe9yA+jEUNqbYBGVWfg@mail.gmail.com>
 <4584053.NxyQt6sEcZ@even-i700>
 <CAJ18MZoPD+1sfqtf+CXmPK6V6zkeinZS1T7i1Df5yRiCm5sTfA@mail.gmail.com>
Message-ID: <CAJ18MZpZUt4bctqBHLe8KwV6_mcRwaLjWewbmAojr5eVEWre_w@mail.gmail.com>

it is 1/3 because the original was not compressed,

anyhow I am still getting too many requests when fetching a tile, maybe my
read code is not doing what I think it is doing



On Sun, Jun 17, 2018 at 4:51 PM, Guy Doulberg <guyd at satellogic.com> wrote:

> Thanks Even
>
> I tried both ways and in both I am still getting a lot of requests, I am
> exepcting only few, one for the headers and one for the tile:
>
>
> The resolution I used is driven from https://wiki.openstreetmap.
> org/wiki/Zoom_levels
>
> and the bounds I calculated using mercantile
>
> so an example of what I ran is:
>
> gdal_translate source.tif target.tif -co TILED=YES -co
> COPY_SRC_OVERVIEWS=YES -co COMPRESS=LZW -tr 0.596 0.596   -projwin
> 675091.8338146766 4706074.957461731 684875.7734351791 4696291.017841227
>
> One more thing, the raster I got is 1/3 of the size of the original raster
>
> On Sun, Jun 17, 2018 at 12:00 PM, Even Rouault <even.rouault at spatialys.com
> > wrote:
>
>> On dimanche 17 juin 2018 10:19:34 CEST Guy Doulberg wrote:
>> > Hi all,
>> >
>> > I am trying to use cloud optimized geotiff(cog) to reduce the block
>> fetched
>> > when accessing a raster.
>> >
>> > The use case I am trying to build, is a TileServer that serves tile in
>> > openlayer map.
>> > The rasters are to be stored on a remote location, in my case azure blob
>> > storage.
>> >
>> > We were able to do that, and you can see the code here:
>> > https://github.com/satellogic/telluric/blob/master/telluric/
>> > georaster.py#L1497
>> >
>> > The problem is, when running in verbose mode I can see that there are
>> many
>> > requests to the blob storage,
>> >
>> > I am responsible of creating the raster, is there a way in your opinion
>> I
>> > can create the raster aligned to the XYZ tiling system so when I try to
>> > fetch a tile from the raster I will be able to do that with a single or
>> > close to that call?
>>
>> If your raster source is not already in WebMercator projection, you could
>> use
>> gdalwarp with the appropriate -te and -tr to align on the boundaries of
>> XYZ
>> tiling scheme at a given zoom level.
>>
>> If your raster is already in WebMercator, gdal_translate -projwin -tr
>> would do
>>
>> If you don't want to compute the bounds, you could use gdal_translate to
>> MBTiles that will use gdalwarp internally to reproject and align on XYZ
>> tiling
>> scheme automatically, followed by gdal_translate to TIFF with -oo
>> USE_BOUNDS=NO so that the extent used aligns on tile boundaries.
>>
>> Even
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180617/f3cee8c0/attachment-0001.html>

From markus.metz.giswork at gmail.com  Sun Jun 17 10:22:10 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Sun, 17 Jun 2018 19:22:10 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
 that are not nodata)
In-Reply-To: <1576408.Kv6HhcKDGi@even-i700>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <19374838.bOCIYbO0Au@even-i700>
 <CAG+h=FFkRKtqTBjUuSRw0vsKnf-xAgYaQ_ewm23_9m2XeACiFQ@mail.gmail.com>
 <1576408.Kv6HhcKDGi@even-i700>
Message-ID: <CAG+h=FGn83SLxja=rqB=Utk-UsL1fsx2E_mrPcZ8YWu_4PrMtw@mail.gmail.com>

On Sat, Jun 16, 2018 at 10:00 PM, Even Rouault <even.rouault at spatialys.com>
wrote:
>
> >
> > I checked, results with gdalinfo -stats are wrong because existing
> > STATISTICS_* metadata are reported even if approximate statistics are
not
> > allowed.
>
> No, if STATISTICS_APPROXIMATE=YES and is set in .aux.xml (because initial
> computation was done with -approx_stats) and you do gdalinfo -stats after,
> then statistics will be recomputed on all samples and
> STATISTICS_APPROXIMATE=YES  will be cleared

IMHO, metadata can not be trusted because it is (often) not known which
software generated these metadata with which method. The only safe
assumption is that statistics in metadata can be approximations. Therefore
statistics from metadata should only be reported if approximations are ok,
no matter if STATISTICS_APPROXIMATE=YES exists or not.

>
> > The problem is, STATISTICS_APPROXIMATE is not set. Other software
> > using GDAL to create raster datasets may use
> > GDALRasterBand::SetStatistics() which does not indicate if stats are
> > approximations., i.e. stats are approximations but there is no
> > STATISTICS_APPROXIMATE=YES.
>
> The idea is that if you use GDALRasterBand::SetStatistics()  then you are
> assumed to provide exact statistics. If they are only approximate, then
you
> should also set STATISTICS_APPROXIMATE=YES with GDALSetMetadataItem()

What about 1) all the datasets that have already been created, 2) all the
third-party software packages providing some sort of statistics in metadata?

IMHO, the STATISTICS_APPROXIMATE=YES mechanism does not work because of 1)
and 2).
>
> >
> > GDAL assumes that STATISTICS_* metadata represent stats on all pixels,
this
> > is IMHO wrong. You can only hope that STATISTICS_* metadata represent
stats
> > on all pixels if a respective metadata item has been set to boolean
true,
> > something like STATISTICS_ALL_PIXELS=YES.
>
> I'm really confused. Why introducing yet another item whereas
> STATISTICS_APPROXIMATE=YES is there for that purpose ?

Simpler: statistics in metadata can be approximations, also if
STATISTICS_APPROXIMATE=YES is not set. If exact statistics are requested,
scan all pixels. A new metadata item like STATISTICS_APPROXIMATE or
STATISTICS_ALL_PIXELS is not needed.

>
> > Even in this case, an option to
> > force recomputing raster band stats would be very nice to have
(verifying
> > metadata).
>
> ComputeStatistics() will recompute statistics. It is true that with
gdalinfo -
> stats, they are not recomputed if they already exist and were not
approximate
> since it calls GetStatistics() and not ComputeStatistics(). An easy
workaround
> is to delete the .aux.xml to force recomputation.

At least recomputation of min/max can already be forced with gdalinfo -mm.

It would be nice if gdalinfo -stats would also trigger forced recomputation
of exact statistics. Currently there is no difference between gdalinfo with
and without -stats if statistics already exist in metadata and
STATISTICS_APPROXIMATE=YES is absent (standard case for existing data):
-stats has no effect here. Forced recomputation would be a change in the
behaviour of gdalinfo -stats.

The purpose of gdalinfo -approx-stats would be (already is?) to quickly get
stats for a raster band, either from metadata or by approximation.

Trying to avoid another option like gdalinfo -exact-stats.

Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180617/45a950b2/attachment.html>

From even.rouault at spatialys.com  Sun Jun 17 10:51:00 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 17 Jun 2018 19:51:00 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
	that are not nodata)
In-Reply-To: <CAG+h=FGn83SLxja=rqB=Utk-UsL1fsx2E_mrPcZ8YWu_4PrMtw@mail.gmail.com>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <1576408.Kv6HhcKDGi@even-i700>
 <CAG+h=FGn83SLxja=rqB=Utk-UsL1fsx2E_mrPcZ8YWu_4PrMtw@mail.gmail.com>
Message-ID: <4681571.kxd9PtmZWc@even-i700>

> It would be nice if gdalinfo -stats would also trigger forced recomputation
> of exact statistics. Currently there is no difference between gdalinfo with
> and without -stats if statistics already exist in metadata and
> STATISTICS_APPROXIMATE=YES is absent (standard case for existing data):
> -stats has no effect here. Forced recomputation would be a change in the
> behaviour of gdalinfo -stats.

gdalinfo already reports existing statistics, so indeed gdalinfo -stats could 
call GDALComputeRasterStatistics() to force regeneration.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From markus.metz.giswork at gmail.com  Sun Jun 17 12:34:17 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Sun, 17 Jun 2018 21:34:17 +0200
Subject: [gdal-dev] gdalinfo -mm also report n (number of grid cells
 that are not nodata)
In-Reply-To: <4681571.kxd9PtmZWc@even-i700>
References: <CAG+h=FE-wybH0VUVXy3RKJCtque1eEsdX=cc4T6Mw0qK6RpD4A@mail.gmail.com>
 <1576408.Kv6HhcKDGi@even-i700>
 <CAG+h=FGn83SLxja=rqB=Utk-UsL1fsx2E_mrPcZ8YWu_4PrMtw@mail.gmail.com>
 <4681571.kxd9PtmZWc@even-i700>
Message-ID: <CAG+h=FEQj+1N3BS0Yu8mbRZiudhH6nMWCL8mhVVCsqfVHnAYVg@mail.gmail.com>

On Sun, Jun 17, 2018 at 7:51 PM, Even Rouault <even.rouault at spatialys.com>
wrote:
>
> > It would be nice if gdalinfo -stats would also trigger forced
recomputation
> > of exact statistics. Currently there is no difference between gdalinfo
with
> > and without -stats if statistics already exist in metadata and
> > STATISTICS_APPROXIMATE=YES is absent (standard case for existing data):
> > -stats has no effect here. Forced recomputation would be a change in the
> > behaviour of gdalinfo -stats.
>
> gdalinfo already reports existing statistics, so indeed gdalinfo -stats
could
> call GDALComputeRasterStatistics() to force regeneration.

:-)

I will take a crack at implementing STATISTICS_VALID_RATIO (no API change,
but some mechanism to compute statistics also if the standard STATISTICS_*
metadata items exist is needed)

Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180617/c3b78b61/attachment.html>

From alexhighviz at hotmail.com  Tue Jun 19 02:22:15 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Tue, 19 Jun 2018 09:22:15 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
 benchmark
In-Reply-To: <1907458.9mazDPShZq@even-i700>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>
Message-ID: <HE1PR0501MB2698604915E80154B980BFA3B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>

> Even Rouault wrote
> A few thoughts:

[ ]

> 1000x1000 is somewhat small. Perhaps benchmark on larger rasters

I am still working on your other suggestions, but thought it would be fair to report on my progress.

Regrettably I overstated the performance in my previous post, due to a bug that is now solved. With the solved bug, Pronto is about 50% slower than GDAL directly. I believe this is still good considering the benefits, but not as glamorous as I first thought. I have also applied it on a set of 100000 x 1000 rasters and the results are consistent. 

The related post has been updated (and I still consider it "promising"): https://github.com/ahhz/raster/blob/master/docs/_posts/2018-06-14-Preliminary-benchmark-results-are-promising.md 

From mateusz at loskot.net  Tue Jun 19 02:28:40 2018
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 19 Jun 2018 11:28:40 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB2698604915E80154B980BFA3B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>
 <HE1PR0501MB2698604915E80154B980BFA3B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <CABUeae8xYr_uaudE-OcVxG3DKr4sVzueGJg0L=AAZwbEcTfbXw@mail.gmail.com>

On 19 June 2018 at 11:22, Alex HighViz <alexhighviz at hotmail.com> wrote:
>
> Regrettably I overstated the performance in my previous post, due to a bug that is now solved. With the solved bug, Pronto is about 50% slower than GDAL directly. I believe this is still good considering the benefits, but not as glamorous as I first thought. I have also applied it on a set of 100000 x 1000 rasters and the results are consistent.
>
> The related post has been updated (and I still consider it "promising"): https://github.com/ahhz/raster/blob/master/docs/_posts/2018-06-14-Preliminary-benchmark-results-are-promising.md

I might have missed that, but there seem to be no information about used
- compiler(s) and their versions
- compilation flags

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From alexhighviz at hotmail.com  Tue Jun 19 02:50:45 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Tue, 19 Jun 2018 09:50:45 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
 benchmark
In-Reply-To: <CABUeae8xYr_uaudE-OcVxG3DKr4sVzueGJg0L=AAZwbEcTfbXw@mail.gmail.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>
 <HE1PR0501MB2698604915E80154B980BFA3B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae8xYr_uaudE-OcVxG3DKr4sVzueGJg0L=AAZwbEcTfbXw@mail.gmail.com>
Message-ID: <HE1PR0501MB2698B33BB709C0961AFD3822B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>



On 19/06/2018 10:28, Mateusz Loskot wrote:
> On 19 June 2018 at 11:22, Alex HighViz <alexhighviz at hotmail.com> wrote:
>> Regrettably I overstated the performance in my previous post, due to a bug that is now solved. With the solved bug, Pronto is about 50% slower than GDAL directly. I believe this is still good considering the benefits, but not as glamorous as I first thought. I have also applied it on a set of 100000 x 1000 rasters and the results are consistent.
>>
>> The related post has been updated (and I still consider it "promising"): https://github.com/ahhz/raster/blob/master/docs/_posts/2018-06-14-Preliminary-benchmark-results-are-promising.md
> I might have missed that, but there seem to be no information about used
> - compiler(s) and their versions
> - compilation flags
>
> Best regards,

No you're right, that information is missing. I was using Visual Studio 15.2

/GS /GL /analyze- /W3 /Gy /Zc:wchar_t /Zi /Gm- /O2 /sdl 
/Fd"Release\vc141.pdb" /Zc:inline /fp:precise /D "_MBCS" 
/errorReport:prompt /WX- /Zc:forScope /Gd /Oy- /Oi /MD /std:c++latest 
/Fa"Release\" /EHsc /nologo /Fo"Release\" /Fp"Release\raster.pch" 
/diagnostics:classic

From erik.sorngard at gl-instrumenter.no  Tue Jun 19 08:23:16 2018
From: erik.sorngard at gl-instrumenter.no (=?iso-8859-1?Q?Erik_S=F8rng=E5rd?=)
Date: Tue, 19 Jun 2018 15:23:16 +0000
Subject: [gdal-dev] CTable2 documentation
Message-ID: <b3e4b9a56a7649cea493c603b1630eec@I2V-EX13-001.i04.local>

Dear Sirs,

I have been looking at PROJ's support for grid files, and notice that they refer to "GDAL documentation" for format details about CTable2.

While browsing the GDAL site I have so far not been able to locate this information, except for being part of the list of supported file formats: http://www.gdal.org/formats_list.html

Where can we find the CTable2 documentation?

Regards,

Erik Sørngård
R&D Manager
Gundersen & Løken AS

E: erik.sorngard at gl-instrumenter.no<mailto:erik.sorngard at gl-instrumenter.no>
P: +47 22 81 39 94

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180619/07c8d185/attachment.html>

From even.rouault at spatialys.com  Tue Jun 19 09:14:16 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 19 Jun 2018 18:14:16 +0200
Subject: [gdal-dev] CTable2 documentation
In-Reply-To: <b3e4b9a56a7649cea493c603b1630eec@I2V-EX13-001.i04.local>
References: <b3e4b9a56a7649cea493c603b1630eec@I2V-EX13-001.i04.local>
Message-ID: <2450718.auaydJMbva@even-i700>

Erik,

> 
> I have been looking at PROJ's support for grid files, and notice that they
> refer to "GDAL documentation" for format details about CTable2.
> 
> While browsing the GDAL site I have so far not been able to locate this
> information, except for being part of the list of supported file formats:
> http://www.gdal.org/formats_list.html
> 
> Where can we find the CTable2 documentation?

That must be some developper sense of humour. To the best of my knowledge, the 
best documentation of the CTable2 format is the driver source code:

https://github.com/OSGeo/gdal/blob/master/gdal/frmts/raw/ctable2dataset.cpp

Basically there is a 160-byte header, followed by the longitude and latitude 
offsets, interleaved, and with south-to-north line ordering.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mateusz at loskot.net  Tue Jun 19 10:41:04 2018
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 19 Jun 2018 19:41:04 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB2698B33BB709C0961AFD3822B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>
 <HE1PR0501MB2698604915E80154B980BFA3B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae8xYr_uaudE-OcVxG3DKr4sVzueGJg0L=AAZwbEcTfbXw@mail.gmail.com>
 <HE1PR0501MB2698B33BB709C0961AFD3822B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <CABUeae9qL5_i4H+W-8EkCugnFti1eBDTRm5LWy=n=EzbXe1-cw@mail.gmail.com>

On 19 June 2018 at 11:50, Alex HighViz <alexhighviz at hotmail.com> wrote:
> On 19/06/2018 10:28, Mateusz Loskot wrote:
>> On 19 June 2018 at 11:22, Alex HighViz <alexhighviz at hotmail.com> wrote:
>>> Regrettably I overstated the performance in my previous post, due to a bug that is now solved. With the solved bug, Pronto is about 50% slower than GDAL directly. I believe this is still good considering the benefits, but not as glamorous as I first thought. I have also applied it on a set of 100000 x 1000 rasters and the results are consistent.
>>>
>>> The related post has been updated (and I still consider it "promising"): https://github.com/ahhz/raster/blob/master/docs/_posts/2018-06-14-Preliminary-benchmark-results-are-promising.md
>> I might have missed that, but there seem to be no information about used
>> - compiler(s) and their versions
>> - compilation flags
>>
>> Best regards,
>
> No you're right, that information is missing. I was using Visual Studio 15.2
>
> /GS /GL /analyze- /W3 /Gy /Zc:wchar_t /Zi /Gm- /O2 /sdl
> /Fd"Release\vc141.pdb" /Zc:inline /fp:precise /D "_MBCS"
> /errorReport:prompt /WX- /Zc:forScope /Gd /Oy- /Oi /MD /std:c++latest
> /Fa"Release\" /EHsc /nologo /Fo"Release\" /Fp"Release\raster.pch"
> /diagnostics:classic

Looks OK, close to or same as the defaults for VS optimised builds.

I was wondering if the slow performance may be due to the standard iterators
debugging enabled.


Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From erik.sorngard at gl-instrumenter.no  Tue Jun 19 12:05:40 2018
From: erik.sorngard at gl-instrumenter.no (=?iso-8859-1?Q?Erik_S=F8rng=E5rd?=)
Date: Tue, 19 Jun 2018 19:05:40 +0000
Subject: [gdal-dev] CTable2 documentation
In-Reply-To: <2450718.auaydJMbva@even-i700>
References: <b3e4b9a56a7649cea493c603b1630eec@I2V-EX13-001.i04.local>
 <2450718.auaydJMbva@even-i700>
Message-ID: <d5097632edbf4d80a2b601db7f46336f@I2V-EX13-001.i04.local>

Hello Even,

Thank you clarifying that PROJ documentation is not accurate. I had seen the source code before, but was hoping for a supporting document as well.

Based on your input and looking at the source code again today, I expect the data to be stored as longitude and latitude offset pairs, each value being a 32 bit floating point number in radians, with east to west lines, from south to north.

Regards,
 
Erik Sørngård
R&D Manager
Gundersen & Løken AS
 
E: erik.sorngard at gl-instrumenter.no
P: +47 22 81 39 94

-----Original Message-----
From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: Tuesday, June 19, 2018 6:14 PM
To: gdal-dev at lists.osgeo.org
Cc: Erik Sørngård <erik.sorngard at gl-instrumenter.no>
Subject: Re: [gdal-dev] CTable2 documentation

Erik,

> 
> I have been looking at PROJ's support for grid files, and notice that 
> they refer to "GDAL documentation" for format details about CTable2.
> 
> While browsing the GDAL site I have so far not been able to locate 
> this information, except for being part of the list of supported file formats:
> http://www.gdal.org/formats_list.html
> 
> Where can we find the CTable2 documentation?

That must be some developper sense of humour. To the best of my knowledge, the best documentation of the CTable2 format is the driver source code:

https://github.com/OSGeo/gdal/blob/master/gdal/frmts/raw/ctable2dataset.cpp

Basically there is a 160-byte header, followed by the longitude and latitude offsets, interleaved, and with south-to-north line ordering.

Even

--
Spatialys - Geospatial professional services http://www.spatialys.com

From stephenwoodbridge37 at gmail.com  Tue Jun 19 13:57:30 2018
From: stephenwoodbridge37 at gmail.com (Stephen Woodbridge)
Date: Tue, 19 Jun 2018 16:57:30 -0400
Subject: [gdal-dev] Having trouble working with jp2 files
Message-ID: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>

Hi all,

I'm having a problem readding jp2 files. My goal is to be able to 
display them through mapserver, but I'm have problems with gdalinfo and 
gdal_translate. I set up a docker image with the latest gdal2 in it like 
the following.  I have 1074 jp2 files and all that I have tried are 
throwing the same errors as below. Any ideas on what is going on?

-Steve

$ docker pull geographica/gdal2:latest
# cd to where 850011.* exists
# this runs the container and mounts pwd on /data in the container
$ docker run -t -i -v $(pwd):/data geographica/gdal2 /bin/bash

root at 2730a320bc09:/usr/local# gdalinfo /data/850011.jp2
Driver: JP2OpenJPEG/JPEG-2000 driver based on OpenJPEG library
Files: /data/850011.jp2
Size is 29364, 25856
Coordinate System is:
GEOGCS["WGS 84",
     DATUM["WGS_1984",
         SPHEROID["WGS 84",6378137,298.257223563,
             AUTHORITY["EPSG","7030"]],
         AUTHORITY["EPSG","6326"]],
     PRIMEM["Greenwich",0],
     UNIT["degree",0.0174532925199433],
     AUTHORITY["EPSG","4326"]]
Origin = (50.811767578125000,18.406654712112974)
Pixel Size = (0.000020390753690,-0.000020390753690)
Image Structure Metadata:
   INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (  50.8117676,  18.4066547) ( 50d48'42.36"E, 18d24'23.96"N)
Lower Left  (  50.8117676,  17.8794314) ( 50d48'42.36"E, 17d52'45.95"N)
Upper Right (  51.4105217,  18.4066547) ( 51d24'37.88"E, 18d24'23.96"N)
Lower Right (  51.4105217,  17.8794314) ( 51d24'37.88"E, 17d52'45.95"N)
Center      (  51.1111446,  18.1430430) ( 51d 6'40.12"E, 18d 8'34.95"N)
Band 1 Block=1024x1024 Type=Byte, ColorInterp=Red
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Image Structure Metadata:
     COMPRESSION=JPEG2000
Band 2 Block=1024x1024 Type=Byte, ColorInterp=Green
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Image Structure Metadata:
     COMPRESSION=JPEG2000
Band 3 Block=1024x1024 Type=Byte, ColorInterp=Blue
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Image Structure Metadata:
     COMPRESSION=JPEG2000

root at 2730a320bc09:/usr/local# gdalinfo -stats /data/850011.jp2
Driver: JP2OpenJPEG/JPEG-2000 driver based on OpenJPEG library
Files: /data/850011.jp2
Size is 29364, 25856
Coordinate System is:
GEOGCS["WGS 84",
     DATUM["WGS_1984",
         SPHEROID["WGS 84",6378137,298.257223563,
             AUTHORITY["EPSG","7030"]],
         AUTHORITY["EPSG","6326"]],
     PRIMEM["Greenwich",0],
     UNIT["degree",0.0174532925199433],
     AUTHORITY["EPSG","4326"]]
Origin = (50.811767578125000,18.406654712112974)
Pixel Size = (0.000020390753690,-0.000020390753690)
Image Structure Metadata:
   INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (  50.8117676,  18.4066547) ( 50d48'42.36"E, 18d24'23.96"N)
Lower Left  (  50.8117676,  17.8794314) ( 50d48'42.36"E, 17d52'45.95"N)
Upper Right (  51.4105217,  18.4066547) ( 51d24'37.88"E, 18d24'23.96"N)
Lower Right (  51.4105217,  17.8794314) ( 51d24'37.88"E, 17d52'45.95"N)
Center      (  51.1111446,  18.1430430) ( 51d 6'40.12"E, 18d 8'34.95"N)
Band 1 Block=1024x1024 Type=Byte, ColorInterp=Red
ERROR 1: psImage->comps[0].data == nullptr
ERROR 1: /data/850011.jp2, band 1: IReadBlock failed at X offset 0, Y 
offset 0: psImage->comps[0].data == nullptr
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Image Structure Metadata:
     COMPRESSION=JPEG2000
Band 2 Block=1024x1024 Type=Byte, ColorInterp=Green
ERROR 1: psImage->comps[0].data == nullptr
ERROR 1: /data/850011.jp2, band 2: IReadBlock failed at X offset 0, Y 
offset 0: psImage->comps[0].data == nullptr
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Image Structure Metadata:
     COMPRESSION=JPEG2000
Band 3 Block=1024x1024 Type=Byte, ColorInterp=Blue
ERROR 1: psImage->comps[0].data == nullptr
ERROR 1: /data/850011.jp2, band 3: IReadBlock failed at X offset 0, Y 
offset 0: psImage->comps[0].data == nullptr
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Image Structure Metadata:
     COMPRESSION=JPEG2000

root at 2730a320bc09:/usr/local# gdal_translate -of GTiff /data/850011.jp2 
/data/850011.tif
Input file size is 29364, 25856
0ERROR 1: psImage->comps[0].data == nullptr
ERROR 1: /data/850011.jp2, band 1: IReadBlock failed at X offset 0, Y 
offset 0: psImage->comps[0].data == nullptr

root at 2730a320bc09:/usr/local#


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Tue Jun 19 14:11:27 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 19 Jun 2018 23:11:27 +0200
Subject: [gdal-dev] Having trouble working with jp2 files
In-Reply-To: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>
References: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>
Message-ID: <1562532.iRlEzJ7lcJ@even-i700>

On mardi 19 juin 2018 16:57:30 CEST Stephen Woodbridge wrote:
> Hi all,
> 
> I'm having a problem readding jp2 files. My goal is to be able to
> display them through mapserver, but I'm have problems with gdalinfo and
> gdal_translate. I set up a docker image with the latest gdal2 in it like
> the following.  I have 1074 jp2 files and all that I have tried are
> throwing the same errors as below. Any ideas on what is going on?

Stephen,

I see that 
https://github.com/GeographicaGS/Docker-GDAL2/blob/master/2.3.0/Dockerfile
uses openjpeg 2.2.0, and not the latest openjpeg 2.3.0
As your images are large, in case they are single-tiled, it might be a failed 
allocation in openjpeg 2.2. Upgrading to openjpeg 2.3.0 might help

Any link to one of those images ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From kreve at sdfe.dk  Tue Jun 19 14:07:11 2018
From: kreve at sdfe.dk (Kristian Evers)
Date: Tue, 19 Jun 2018 21:07:11 +0000
Subject: [gdal-dev] CTable2 documentation
In-Reply-To: <d5097632edbf4d80a2b601db7f46336f@I2V-EX13-001.i04.local>
References: <b3e4b9a56a7649cea493c603b1630eec@I2V-EX13-001.i04.local>
 <2450718.auaydJMbva@even-i700>
 <d5097632edbf4d80a2b601db7f46336f@I2V-EX13-001.i04.local>
Message-ID: <DB43638C-56A0-4042-B654-01B8C9BDB45F@sdfe.dk>

> That must be some developper sense of humour.

Consider that my attempt at nudging the GDAL community to improve their documentation :-)

/Kristian

> On 19 Jun 2018, at 21:05, Erik Sørngård <erik.sorngard at gl-instrumenter.no> wrote:
> 
> Hello Even,
> 
> Thank you clarifying that PROJ documentation is not accurate. I had seen the source code before, but was hoping for a supporting document as well.
> 
> Based on your input and looking at the source code again today, I expect the data to be stored as longitude and latitude offset pairs, each value being a 32 bit floating point number in radians, with east to west lines, from south to north.
> 
> Regards,
>  
> Erik Sørngård
> R&D Manager
> Gundersen & Løken AS
>  
> E: erik.sorngard at gl-instrumenter.no
> P: +47 22 81 39 94
> 
> -----Original Message-----
> From: Even Rouault [mailto:even.rouault at spatialys.com] 
> Sent: Tuesday, June 19, 2018 6:14 PM
> To: gdal-dev at lists.osgeo.org
> Cc: Erik Sørngård <erik.sorngard at gl-instrumenter.no>
> Subject: Re: [gdal-dev] CTable2 documentation
> 
> Erik,
> 
>> 
>> I have been looking at PROJ's support for grid files, and notice that 
>> they refer to "GDAL documentation" for format details about CTable2.
>> 
>> While browsing the GDAL site I have so far not been able to locate 
>> this information, except for being part of the list of supported file formats:
>> http://www.gdal.org/formats_list.html
>> 
>> Where can we find the CTable2 documentation?
> 
> That must be some developper sense of humour. To the best of my knowledge, the best documentation of the CTable2 format is the driver source code:
> 
> https://github.com/OSGeo/gdal/blob/master/gdal/frmts/raw/ctable2dataset.cpp
> 
> Basically there is a 160-byte header, followed by the longitude and latitude offsets, interleaved, and with south-to-north line ordering.
> 
> Even
> 
> --
> Spatialys - Geospatial professional services http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From stephenwoodbridge37 at gmail.com  Tue Jun 19 20:07:24 2018
From: stephenwoodbridge37 at gmail.com (Stephen Woodbridge)
Date: Tue, 19 Jun 2018 23:07:24 -0400
Subject: [gdal-dev] Having trouble working with jp2 files
In-Reply-To: <1562532.iRlEzJ7lcJ@even-i700>
References: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>
 <1562532.iRlEzJ7lcJ@even-i700>
Message-ID: <6015a675-ba9e-5159-0756-97d3e1e3adfa@gmail.com>

I tried the following:

git clone https://github.com/GeographicaGS/Docker-GDAL2.git
cd Docker-GDAL2/2.2.4
#Edit Dockerfile and set 'ENV OPENJPEG_VERSION 2.3.0'
docker build -t gdal2:local ./
cd /path/to/jp2
docker run -t -i gdal2:local -v $(pwd):/data /bin/bash
gdalinfo -stats /data/850011.jp2

And got the same errors.

Even, I sent you a link to download the file from my dropbox.

-Steve

On 6/19/2018 5:11 PM, Even Rouault wrote:
> On mardi 19 juin 2018 16:57:30 CEST Stephen Woodbridge wrote:
>> Hi all,
>>
>> I'm having a problem readding jp2 files. My goal is to be able to
>> display them through mapserver, but I'm have problems with gdalinfo and
>> gdal_translate. I set up a docker image with the latest gdal2 in it like
>> the following.  I have 1074 jp2 files and all that I have tried are
>> throwing the same errors as below. Any ideas on what is going on?
> Stephen,
>
> I see that
> https://github.com/GeographicaGS/Docker-GDAL2/blob/master/2.3.0/Dockerfile
> uses openjpeg 2.2.0, and not the latest openjpeg 2.3.0
> As your images are large, in case they are single-tiled, it might be a failed
> allocation in openjpeg 2.2. Upgrading to openjpeg 2.3.0 might help
>
> Any link to one of those images ?
>
> Even
>


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From demonbusov1 at yandex.ru  Tue Jun 19 20:25:32 2018
From: demonbusov1 at yandex.ru (Dmitriy T.)
Date: Tue, 19 Jun 2018 20:25:32 -0700 (MST)
Subject: [gdal-dev] GDALTranslateOptions: how to send "--config
 GDAL_TIFF_INTERNAL_MASK YES"
Message-ID: <1529465132291-0.post@n6.nabble.com>

How to send the parameter "--config GDAL_TIFF_INTERNAL_MASK YES" as option to
the method Gdal.wrapper_GDALTranslate.

There is an exception if I split it as follows:

"--config GDAL_TIFF_INTERNAL_MASK YES"
or
"--config", "GDAL_TIFF_INTERNAL_MASK YES"
or
"--config", "GDAL_TIFF_INTERNAL_MASK", "YES"



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From demonbusov1 at yandex.ru  Tue Jun 19 20:26:31 2018
From: demonbusov1 at yandex.ru (Dmitriy T.)
Date: Tue, 19 Jun 2018 20:26:31 -0700 (MST)
Subject: [gdal-dev] GDALTranslateOptions: how to send "--config
 GDAL_TIFF_INTERNAL_MASK YES"
Message-ID: <1529465191950-0.post@n6.nabble.com>

How to send the parameter "--config GDAL_TIFF_INTERNAL_MASK YES" as option to
the method Gdal.wrapper_GDALTranslate.

There is an exception if I split it as follows:

"--config GDAL_TIFF_INTERNAL_MASK YES"
or
"--config", "GDAL_TIFF_INTERNAL_MASK YES"
or
"--config", "GDAL_TIFF_INTERNAL_MASK", "YES"



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From demonbusov1 at yandex.ru  Tue Jun 19 20:51:38 2018
From: demonbusov1 at yandex.ru (Dmitriy T.)
Date: Tue, 19 Jun 2018 20:51:38 -0700 (MST)
Subject: [gdal-dev] GDALTranslateOptions: how to send "--config
 GDAL_TIFF_INTERNAL_MASK YES"
In-Reply-To: <1529465132291-0.post@n6.nabble.com>
References: <1529465132291-0.post@n6.nabble.com>
Message-ID: <1529466698077-0.post@n6.nabble.com>

Maybe it is configurable as Gdal.SetConfigOption("GDAL_TIFF_INTERNAL_MASK",
"YES"); before Gdal.wrapper_GDALTranslate calling?



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From Piyush.Agram at jpl.nasa.gov  Tue Jun 19 21:05:18 2018
From: Piyush.Agram at jpl.nasa.gov (Agram, Piyush S (334D))
Date: Wed, 20 Jun 2018 04:05:18 +0000
Subject: [gdal-dev] spatial_ref and GeoTransform attributes for HDF5 datasets
Message-ID: <6E8C4198-53CA-41CD-8738-3E4EBF0663FA@jpl.nasa.gov>

Hi,
    I’m looking for a simple convention to represent SRS and Geotransform information for HDF5 arrays. A fairly thorough reading of available HDF5 geospatial data representation specs hasn’t resulted in a satisfactory solution. I know that HDF-EOS5 is a published spec but the unintuitive naming of swaths and grids is not a satisfactory solution for what we are trying to accomplish. We would like a spec that allows us to


  1.  Support complex datasets (possible since GDAL 2.3). HDF-EOS5 does not support this.
  2.  Generate HDF5 files with different grids in the same file – one can think of some grids as low resolution support grids which can be interpolated on the fly to match the primary high resolution grids. This might be an issue for CF-compliant representation? We might want support to include different grids for different layers depending on support needed by interpolators.

I’ve also been looking through the netcdf driver in GDAL since this is closely related to HDF5 and noticed that there is a non-CF compliant representation that is still supported. I’m happy to work on implementing a similar solution for HDF5 – namely each dataset gets its own spatial_ref (str) and GeoTransform (array of floats/doubles) attributes.

I’m reaching out to see if similar/ alternate solutions have been proposed in the past or if something similar is in the works. If not, would a PR for a feature like this be of interest?

Thanks
Piyush
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180620/a42752d8/attachment.html>

From even.rouault at spatialys.com  Wed Jun 20 02:24:11 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 20 Jun 2018 11:24:11 +0200
Subject: [gdal-dev] GDALTranslateOptions: how to send "--config
	GDAL_TIFF_INTERNAL_MASK YES"
In-Reply-To: <1529465132291-0.post@n6.nabble.com>
References: <1529465132291-0.post@n6.nabble.com>
Message-ID: <1632582.GSZFfuOo05@even-i700>

> "--config", "GDAL_TIFF_INTERNAL_MASK", "YES"

This is the correct one.

You didn't specify which language you use. Normally you shouldn't use
Gdal.wrapper_GDALTranslate directly. But if it is C#, perhaps some more work 
is needed in the bindings.

If that specific option causes issues, you can also use equivalently 
gdal.SetConfigOption("GDAL_TIFF_INTERNAL_MASK", "YES")

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Donato.AIRAGHI at ext.ec.europa.eu  Wed Jun 20 02:48:13 2018
From: Donato.AIRAGHI at ext.ec.europa.eu (Donato.AIRAGHI at ext.ec.europa.eu)
Date: Wed, 20 Jun 2018 09:48:13 +0000
Subject: [gdal-dev] gdal 2.3.0 with openjpeg 2.3 support
In-Reply-To: <3107645.iHJHJJvoxk@even-i700>
References: <298B386164AE8F4A96FD656145FD37731FA92267@S-DC-ESTE01-J.net1.cec.eu.int>,
 <3107645.iHJHJJvoxk@even-i700>
Message-ID: <298B386164AE8F4A96FD656145FD37731FA956BA@S-DC-ESTE01-J.net1.cec.eu.int>


Hi Even,Vincent,

is true, the problem is pkg-config
On my Centos 6 is  already installed  version 0.23  that is the official release in Cento 6 repository.
With this release (0.23) the var PKG_CONFIG_PATH=/usr/local/lib/pkgconfig/ does not work

If I compile pkgconfig 0.29.1 i can get
.....
 OpenJPEG support:          yes
...

but with  make command  I get there errors on libcurl:
......
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_multi_info_read'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_slist_append'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_multi_add_handle'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_easy_perform'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_multi_perform'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_multi_cleanup'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_easy_init'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_easy_cleanup'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_multi_remove_handle'
/home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to `curl_easy_setopt'
............


I'm compiling pkgconfig with:
./configure --prefix=/usr --with-internal-glib --disable-host-tool


Do you know an option or solution for compile pkgconfig avoiding these errors on curl?
There are notes for compile GDAL 2.3.0 on Centos 6 with openjpeg support?

Thanks a lot, guys







Donato Airaghi

System Administrator
Serco s.p.a - JRC Ispra

________________________________________
From: Even Rouault [even.rouault at spatialys.com]
Sent: 13 June 2018 18:16
To: gdal-dev at lists.osgeo.org
Cc: AIRAGHI Donato (JRC-ISPRA-EXT)
Subject: Re: [gdal-dev] gdal 2.3.0 with openjpeg 2.3 support

On mercredi 13 juin 2018 15:59:24 CEST Donato.AIRAGHI at ext.ec.europa.eu wrote:
> Hi,
>
> I'm trying to compile
> Gdal 2.3.0  on Centos 6.9 where compiled openjpeg 2.3.0
>
> I get :
> ....
> Kakadu support:            no
> JasPer support:            no
> OpenJPEG support:          no
> ECW support:               no
> MrSID support:             yes
> ......
>
> On the same system with gdal 2.2.2 and openjpeg 2.3.0  I get
> .....
> Kakadu support:            no
> JasPer support:            no
> OpenJPEG support:          yes
> ECW support:               no
> MrSID support:             yes
> ...
>
>
> This the configure line :
>
> ./configure --with-python=yes  --with-pg=/usr/pgsql-9.3/bin/pg_config
> --with-geos=yes --with-curl=/usr/bin/curl-config
> --with-mrsid=/opt/MrSID/Raster_DSDK/ --with-jp2mrsid=no
> --with-mrsid_lidar=/opt/MrSID/Lidar_DSDK/ --with-sqlite3 --with-podofo=yes
> --with-hdf4=/opt/HDF/hdf-4.2.13 --with-hdf5=/opt/HDF/hdf-5.1.8.21
> --with-openjpeg=/usr/local --with-jasper=no --with-ecw=no --with-threads
> --with-spatialite=yes
>
>
> Could you please help me finding an explanation to this behaviour ?

Donato,

You probably need to install pkg-config since it is required now in GDAL 2.3
to detect openjpeg. Previous GDAL versions had a painful manual way of
detecting openjpeg that has been simpilfied in GDAL 2.3 configure code.

If I look for openjp2 in the config.log file generated by configure, here are
the relevant lines:

configure:27477: $PKG_CONFIG --exists --print-errors "libopenjp2 >= 2.1.0"
configure:27480: $? = 0
configure:27495: $PKG_CONFIG --exists --print-errors "libopenjp2 >= 2.1.0"
configure:27498: $? = 0
configure:27534: result: yes
configure:27544: checking for opj_setup_decoder in -lopenjp2
configure:27569: gcc -o conftest -DHAVE_AVX_AT_COMPILE_TIME -
DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -fPIC  -g -DDEBUG -
ftrapv -fvisibility=hidden   conftest.c -lopenjp2  -lopenjp2 >&5
configure:27569: $? = 0
configure:27578: result: yes

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed Jun 20 03:00:14 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 20 Jun 2018 12:00:14 +0200
Subject: [gdal-dev] gdal 2.3.0 with openjpeg 2.3 support
In-Reply-To: <298B386164AE8F4A96FD656145FD37731FA956BA@S-DC-ESTE01-J.net1.cec.eu.int>
References: <298B386164AE8F4A96FD656145FD37731FA92267@S-DC-ESTE01-J.net1.cec.eu.int>
 <3107645.iHJHJJvoxk@even-i700>
 <298B386164AE8F4A96FD656145FD37731FA956BA@S-DC-ESTE01-J.net1.cec.eu.int>
Message-ID: <69541418.YxhslGtqZZ@even-i700>

On mercredi 20 juin 2018 09:48:13 CEST Donato.AIRAGHI at ext.ec.europa.eu wrote:
> Hi Even,Vincent,
> 
> is true, the problem is pkg-config
> On my Centos 6 is  already installed  version 0.23  that is the official
> release in Cento 6 repository. With this release (0.23) the var
> PKG_CONFIG_PATH=/usr/local/lib/pkgconfig/ does not work
> 
> If I compile pkgconfig 0.29.1 i can get
> .....
>  OpenJPEG support:          yes
> ...
> 
> but with  make command  I get there errors on libcurl:
> ......
> /home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to
> `curl_multi_info_read' /home/software/gdal-2.3.0/.libs/libgdal.so:
> undefined reference to `curl_slist_append'
> /home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to
> `curl_multi_add_handle' /home/software/gdal-2.3.0/.libs/libgdal.so:
> undefined reference to `curl_easy_perform'
> /home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to
> `curl_multi_perform' /home/software/gdal-2.3.0/.libs/libgdal.so: undefined
> reference to `curl_multi_cleanup'
> /home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to
> `curl_easy_init' /home/software/gdal-2.3.0/.libs/libgdal.so: undefined
> reference to `curl_easy_cleanup'
> /home/software/gdal-2.3.0/.libs/libgdal.so: undefined reference to
> `curl_multi_remove_handle' /home/software/gdal-2.3.0/.libs/libgdal.so:
> undefined reference to `curl_easy_setopt' ............
> 

Is CURL still found by GDAL ./configure ? It looks like no. There shouldn't be 
normally any interference between openjpeg / pkgconfig and curl, since 
openjpeg doesn't use curl, and curl detection is unrelated to pkgconfig

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed Jun 20 07:27:10 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 20 Jun 2018 16:27:10 +0200
Subject: [gdal-dev] Having trouble working with jp2 files
In-Reply-To: <6015a675-ba9e-5159-0756-97d3e1e3adfa@gmail.com>
References: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>
 <1562532.iRlEzJ7lcJ@even-i700>
 <6015a675-ba9e-5159-0756-97d3e1e3adfa@gmail.com>
Message-ID: <13783213.XQuMEnxdls@even-i700>

On mardi 19 juin 2018 23:07:24 CEST Stephen Woodbridge wrote:
> I tried the following:
> 
> git clone https://github.com/GeographicaGS/Docker-GDAL2.git
> cd Docker-GDAL2/2.2.4
> #Edit Dockerfile and set 'ENV OPENJPEG_VERSION 2.3.0'
> docker build -t gdal2:local ./
> cd /path/to/jp2
> docker run -t -i gdal2:local -v $(pwd):/data /bin/bash
> gdalinfo -stats /data/850011.jp2
> 
> And got the same errors.
> 
> Even, I sent you a link to download the file from my dropbox.

Steve,

I've investigated and those JPEG2000 files have a particular characteristic 
that triggered a regression dating back to openjpeg 2.2.0

I've just fixed it in openjpeg master per
https://github.com/uclouvain/openjpeg/pull/1121

So I'd suggest you to track openjpeg master (or revert back to 2.1.2, but 
you'll loose performance optimizations)

Note: the sample file you provided to me has also a non-conformity (declaring 
codestream "Profile 0" but with tile dimensions of 1024x1024 instead of 
128x128 as expected) in the codestream header, as pointed by Kakadu, but that  
is not critical

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From alexhighviz at hotmail.com  Wed Jun 20 09:16:58 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Wed, 20 Jun 2018 16:16:58 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
 benchmark
In-Reply-To: <CABUeae9qL5_i4H+W-8EkCugnFti1eBDTRm5LWy=n=EzbXe1-cw@mail.gmail.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>
 <HE1PR0501MB2698604915E80154B980BFA3B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae8xYr_uaudE-OcVxG3DKr4sVzueGJg0L=AAZwbEcTfbXw@mail.gmail.com>
 <HE1PR0501MB2698B33BB709C0961AFD3822B4700@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae9qL5_i4H+W-8EkCugnFti1eBDTRm5LWy=n=EzbXe1-cw@mail.gmail.com>
Message-ID: <HE1PR0501MB269870AD5C826136B8B405BEB4770@HE1PR0501MB2698.eurprd05.prod.outlook.com>

On 19/06/2018 18:41, Mateusz Loskot wrote:
> On 19 June 2018 at 11:50, Alex HighViz <alexhighviz at hotmail.com> wrote:
>> On 19/06/2018 10:28, Mateusz Loskot wrote:
>>> On 19 June 2018 at 11:22, Alex HighViz <alexhighviz at hotmail.com> wrote:
>>>> Regrettably I overstated the performance in my previous post, due to a bug that is now solved. With the solved bug, Pronto is about 50% slower than GDAL directly. I believe this is still good considering the benefits, but not as glamorous as I first thought. I have also applied it on a set of 100000 x 1000 rasters and the results are consistent.
>>>>
>>>>
>>>>
>>>> I was wondering if the slow performance may be due to the standard iterators
>>>> debugging enabled.
>>>>
>>>>
>>>> Best regards,

I have looked at the benchmark a bit further, and considered that it 
might have to do with the way in which the different solutions access 
the data.

The Pronto Raster code uses band->GetLockedBlockRef(...), whereas my the 
GDAL-only reference uses band->ReadBlock(...).

This means that Pronto uses the cache and the GDAL-only reference 
doesn't.  My next thought was to use band->RasterIO(...) as the 
reference because that is more appropriate, considering that it also 
uses the cache. And finally, I used band->GetLockedBlockRef() in a GDAL 
only solution.

I ended up with the following timings:

GDAL-Only using ReadBlock(...)                         :   7.7 seconds
GDAL-Only using RasterIO(...)                            : 30.1 seconds
GDAL-Only using GetLockedBlockRef(...)         :   8.9 seconds
Pronto Raster using GetLockedBlockRef(...)     : 10.6 seconds

I suppose the relatively poor performance of RasterIO is known 
(https://lists.osgeo.org/pipermail/gdal-dev/2008-March/016357.html and 
https://trac.osgeo.org/gdal/ticket/2266), although I don't understand 
the reason for it.







From stephenwoodbridge37 at gmail.com  Wed Jun 20 09:33:40 2018
From: stephenwoodbridge37 at gmail.com (Stephen Woodbridge)
Date: Wed, 20 Jun 2018 12:33:40 -0400
Subject: [gdal-dev] Having trouble working with jp2 files
In-Reply-To: <13783213.XQuMEnxdls@even-i700>
References: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>
 <1562532.iRlEzJ7lcJ@even-i700>
 <6015a675-ba9e-5159-0756-97d3e1e3adfa@gmail.com>
 <13783213.XQuMEnxdls@even-i700>
Message-ID: <2ebb9ac9-5f61-0a7a-9e4b-8d34afb59baf@gmail.com>

Even,

Thanks!

I did built gdal 2.2.4 with openjpeg 2.1.2 on a docker container and 
that solves the simple case of:

gdalinfo -stats /data/850011.jp2

but it still fails with:

root at 436a09289084:/usr/local# gdal_translate -of GTiff -co TILED=YES 
/data/850011.jp2 /data/850011.tif
Input file size is 29364, 25856
0ERROR 1: psImage->comps[0].data == NULL
ERROR 1: /data/850011.jp2, band 1: IReadBlock failed at X offset 0, Y 
offset 0
ERROR 1: GetBlockRef failed at X block offset 0, Y block offset 0

In my Dockerfile, I have:

# Compile and install OpenJPEG
RUN cd src && tar -xvf openjpeg-${OPENJPEG_VERSION}.tar.gz && cd 
openjpeg-${OPENJPEG_VERSION}/ \
     && mkdir build && cd build \
     && cmake .. -DCMAKE_BUILD_TYPE=Release 
-DCMAKE_INSTALL_PREFIX=$ROOTDIR \
     && make && make install && make clean \
     && cd $ROOTDIR && rm -Rf src/openjpeg*

Any idea how that should change to apply your pull request so I can test 
that?

-Steve

$ docker run -v $(pwd):/data -t -i gdal2:local  /bin/bash
root at 436a09289084:/usr/local# gdalinfo -stats /data/850011.jp2
Driver: JP2OpenJPEG/JPEG-2000 driver based on OpenJPEG library
Files: /data/850011.jp2
        /data/850011.jp2.aux.xml
Size is 29364, 25856
Coordinate System is:
GEOGCS["WGS 84",
     DATUM["WGS_1984",
         SPHEROID["WGS 84",6378137,298.257223563,
             AUTHORITY["EPSG","7030"]],
         AUTHORITY["EPSG","6326"]],
     PRIMEM["Greenwich",0],
     UNIT["degree",0.0174532925199433],
     AUTHORITY["EPSG","4326"]]
Origin = (50.811767578125000,18.406654712112974)
Pixel Size = (0.000020390753690,-0.000020390753690)
Image Structure Metadata:
   INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (  50.8117676,  18.4066547) ( 50d48'42.36"E, 18d24'23.96"N)
Lower Left  (  50.8117676,  17.8794314) ( 50d48'42.36"E, 17d52'45.95"N)
Upper Right (  51.4105217,  18.4066547) ( 51d24'37.88"E, 18d24'23.96"N)
Lower Right (  51.4105217,  17.8794314) ( 51d24'37.88"E, 17d52'45.95"N)
Center      (  51.1111446,  18.1430430) ( 51d 6'40.12"E, 18d 8'34.95"N)
Band 1 Block=1024x1024 Type=Byte, ColorInterp=Red
   Min=122.000 Max=254.000
   Minimum=122.000, Maximum=254.000, Mean=204.487, StdDev=9.596
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Metadata:
     STATISTICS_MAXIMUM=254
     STATISTICS_MEAN=204.48710711705
     STATISTICS_MINIMUM=122
     STATISTICS_STDDEV=9.596017845156
   Image Structure Metadata:
     COMPRESSION=JPEG2000
Band 2 Block=1024x1024 Type=Byte, ColorInterp=Green
   Min=98.000 Max=239.000
   Minimum=98.000, Maximum=239.000, Mean=178.492, StdDev=10.197
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Metadata:
     STATISTICS_MAXIMUM=239
     STATISTICS_MEAN=178.49220443461
     STATISTICS_MINIMUM=98
     STATISTICS_STDDEV=10.197171404633
   Image Structure Metadata:
     COMPRESSION=JPEG2000
Band 3 Block=1024x1024 Type=Byte, ColorInterp=Blue
   Min=63.000 Max=215.000
   Minimum=63.000, Maximum=215.000, Mean=145.743, StdDev=14.060
   Overviews: 14682x12928, 7341x6464, 3670x3232, 1835x1616, 917x808
   Overviews: arbitrary
   Metadata:
     STATISTICS_MAXIMUM=215
     STATISTICS_MEAN=145.74315841763
     STATISTICS_MINIMUM=63
     STATISTICS_STDDEV=14.060045889747
   Image Structure Metadata:
     COMPRESSION=JPEG2000
root at 436a09289084:/usr/local# gdal_translate -of GTiff /data/850011.jp2 
/data/850011.tif
Input file size is 29364, 25856
0ERROR 1: psImage->comps[0].data == NULL
ERROR 1: /data/850011.jp2, band 1: IReadBlock failed at X offset 0, Y 
offset 0
ERROR 1: GetBlockRef failed at X block offset 0, Y block offset 0

root at 436a09289084:/usr/local# gdal_translate -of GTiff -co TILED=YES 
/data/850011.jp2 /data/850011.tif
Input file size is 29364, 25856
0ERROR 1: psImage->comps[0].data == NULL
ERROR 1: /data/850011.jp2, band 1: IReadBlock failed at X offset 0, Y 
offset 0
ERROR 1: GetBlockRef failed at X block offset 0, Y block offset 0

On 6/20/2018 10:27 AM, Even Rouault wrote:
> On mardi 19 juin 2018 23:07:24 CEST Stephen Woodbridge wrote:
>> I tried the following:
>>
>> git clone https://github.com/GeographicaGS/Docker-GDAL2.git
>> cd Docker-GDAL2/2.2.4
>> #Edit Dockerfile and set 'ENV OPENJPEG_VERSION 2.3.0'
>> docker build -t gdal2:local ./
>> cd /path/to/jp2
>> docker run -t -i gdal2:local -v $(pwd):/data /bin/bash
>> gdalinfo -stats /data/850011.jp2
>>
>> And got the same errors.
>>
>> Even, I sent you a link to download the file from my dropbox.
> Steve,
>
> I've investigated and those JPEG2000 files have a particular characteristic
> that triggered a regression dating back to openjpeg 2.2.0
>
> I've just fixed it in openjpeg master per
> https://github.com/uclouvain/openjpeg/pull/1121
>
> So I'd suggest you to track openjpeg master (or revert back to 2.1.2, but
> you'll loose performance optimizations)
>
> Note: the sample file you provided to me has also a non-conformity (declaring
> codestream "Profile 0" but with tile dimensions of 1024x1024 instead of
> 128x128 as expected) in the codestream header, as pointed by Kakadu, but that
> is not critical
>
> Even
>


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Wed Jun 20 09:34:56 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 20 Jun 2018 18:34:56 +0200
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
	benchmark
In-Reply-To: <HE1PR0501MB269870AD5C826136B8B405BEB4770@HE1PR0501MB2698.eurprd05.prod.outlook.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <CABUeae9qL5_i4H+W-8EkCugnFti1eBDTRm5LWy=n=EzbXe1-cw@mail.gmail.com>
 <HE1PR0501MB269870AD5C826136B8B405BEB4770@HE1PR0501MB2698.eurprd05.prod.outlook.com>
Message-ID: <1671843.jeN9lSIIJa@even-i700>

> I ended up with the following timings:
> 
> GDAL-Only using ReadBlock(...)                         :   7.7 seconds
> GDAL-Only using RasterIO(...)                            : 30.1 seconds
> GDAL-Only using GetLockedBlockRef(...)         :   8.9 seconds
> Pronto Raster using GetLockedBlockRef(...)     : 10.6 seconds
> 
> I suppose the relatively poor performance of RasterIO is known 
> (https://lists.osgeo.org/pipermail/gdal-dev/2008-March/016357.html and 
> https://trac.osgeo.org/gdal/ticket/2266), although I don't understand 
> the reason for it.

The main reason is that RasterIO() involves an extra memcpy() from the block 
cache buffer to the user provided buffer.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed Jun 20 09:42:24 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 20 Jun 2018 18:42:24 +0200
Subject: [gdal-dev] Having trouble working with jp2 files
In-Reply-To: <2ebb9ac9-5f61-0a7a-9e4b-8d34afb59baf@gmail.com>
References: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>
 <13783213.XQuMEnxdls@even-i700>
 <2ebb9ac9-5f61-0a7a-9e4b-8d34afb59baf@gmail.com>
Message-ID: <2164220.B33sMMbWzP@even-i700>

On mercredi 20 juin 2018 12:33:40 CEST Stephen Woodbridge wrote:
> Even,
> 
> Thanks!
> 
> I did built gdal 2.2.4 with openjpeg 2.1.2 on a docker container and
> that solves the simple case of:
> 
> gdalinfo -stats /data/850011.jp2
> 
> but it still fails with:
> 
> root at 436a09289084:/usr/local# gdal_translate -of GTiff -co TILED=YES
> /data/850011.jp2 /data/850011.tif

A bit strange, but I didn't actually test with 2.1.2

You can download a zip of openjpeg master sources at:
https://codeload.github.com/uclouvain/openjpeg/zip/master

And you'd better use GDAL 2.3.0 with it.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From stephenwoodbridge37 at gmail.com  Wed Jun 20 13:08:25 2018
From: stephenwoodbridge37 at gmail.com (Stephen Woodbridge)
Date: Wed, 20 Jun 2018 16:08:25 -0400
Subject: [gdal-dev] Having trouble working with jp2 files
In-Reply-To: <2164220.B33sMMbWzP@even-i700>
References: <bc06e138-440f-87ac-01e7-7a1bae0aaf0b@gmail.com>
 <13783213.XQuMEnxdls@even-i700>
 <2ebb9ac9-5f61-0a7a-9e4b-8d34afb59baf@gmail.com>
 <2164220.B33sMMbWzP@even-i700>
Message-ID: <88844657-0436-5524-ebad-00c9d210bcff@gmail.com>

Even,

My bad, I ran the wrong container. Just reran the test and it works with 
gdal 2.2.4 and openjpeg 2.1.2. And this also worked:

root at ab86ce382ef0:/usr/local# gdal_translate -of GTiff -co TILED=YES -co 
PHOTOMETRIC=YCBCR -co COMPRESS=JPEG /data/850011.jp2 /data/850011.tif
Input file size is 29364, 25856
0...10...20...30...40...50...60...70...80...90...100 - done.

I also built openjpeg-master.zip and gdal 2.3.0 in the docker and that 
works also and is much much faster.

Thanks so much for your help!

Best regards,
   -Steve

On 6/20/2018 12:42 PM, Even Rouault wrote:
> On mercredi 20 juin 2018 12:33:40 CEST Stephen Woodbridge wrote:
>> Even,
>>
>> Thanks!
>>
>> I did built gdal 2.2.4 with openjpeg 2.1.2 on a docker container and
>> that solves the simple case of:
>>
>> gdalinfo -stats /data/850011.jp2
>>
>> but it still fails with:
>>
>> root at 436a09289084:/usr/local# gdal_translate -of GTiff -co TILED=YES
>> /data/850011.jp2 /data/850011.tif
> A bit strange, but I didn't actually test with 2.1.2
>
> You can download a zip of openjpeg master sources at:
> https://codeload.github.com/uclouvain/openjpeg/zip/master
>
> And you'd better use GDAL 2.3.0 with it.
>
> Even
>


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From markus.metz.giswork at gmail.com  Wed Jun 20 14:57:49 2018
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Wed, 20 Jun 2018 23:57:49 +0200
Subject: [gdal-dev] scripts/setdevenv.sh
In-Reply-To: <8510558.Wn7OvSxcaU@even-i700>
References: <8510558.Wn7OvSxcaU@even-i700>
Message-ID: <CAG+h=FHN7OqnToe7Tv1Jsm6rbB_G8_E9sw3r+U=CYoQRX5BiFA@mail.gmail.com>

On Thu, Apr 5, 2018 at 11:44 AM, Even Rouault <even.rouault at spatialys.com>
wrote:
>
> Hi,
>
> This is something most people doing GDAL development, and not wanting to
install each time they
> build, have probably reinvented by themselves, so now master has a
scripts/setdevenv.sh that
> you can source to define PATH, LD_LIBRARY_PATH, GDAL_DATA and PYTHONPATH
to point to the
> non-installed directories.

very useful, it makes testing local changes really easy, particularly for
non-GDAL developers trying to contribute to GDAL.

Thanks, Even!

>
> Referenced in https://github.com/OSGeo/gdal/blob/master/CONTRIBUTING.md
>
> Only tested on Linux
>
> $ . scripts/setdevenv.sh
> Setting
PATH=/home/even/gdal/git/gdal/gdal/apps:/home/even/gdal/git/gdal/gdal/apps/.libs:/home/even/bin:/home/even/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
> Setting
LD_LIBRARY_PATH=/home/even/gdal/git/gdal/gdal:/home/even/gdal/git/gdal/gdal/.libs:
> Setting GDAL_DATA=/home/even/gdal/git/gdal/gdal/data
> Setting
PYTHONPATH=/home/even/gdal/git/gdal/gdal/swig/python/build/lib.linux-x86_64-2.7:
>
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180620/f1a6da19/attachment.html>

From demonbusov1 at yandex.ru  Wed Jun 20 20:50:57 2018
From: demonbusov1 at yandex.ru (Dmitriy T.)
Date: Wed, 20 Jun 2018 20:50:57 -0700 (MST)
Subject: [gdal-dev] GDALTranslateOptions: how to send "--config
 GDAL_TIFF_INTERNAL_MASK YES"
In-Reply-To: <1632582.GSZFfuOo05@even-i700>
References: <1529465132291-0.post@n6.nabble.com> <1632582.GSZFfuOo05@even-i700>
Message-ID: <1529553057378-0.post@n6.nabble.com>

Thank you!



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From kalev.julge at reach-u.com  Thu Jun 21 07:00:03 2018
From: kalev.julge at reach-u.com (kalevj)
Date: Thu, 21 Jun 2018 07:00:03 -0700 (MST)
Subject: [gdal-dev] Convert VRT+JPEG with gdalwarp
Message-ID: <1529589603275-0.post@n6.nabble.com>

Hello,

I used gdalwarp to transform a VRT+JPEG pair from one EPSG projection to
another. Everything worked well. This conversion changed the VRT file so
that reprojection takes place when the images are loaded. However, I would
need to reproject the JPEG so that there would not be a need to reproject
every time the images are loaded. Is it possible somehow?

I used the command:
"gdalwarp -s_srs EPSG:2006 -t_srs EPSG:3857 -of VRT -r near old.vrt new.vrt"

Thanks!

Kalev



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From doug_newcomb at fws.gov  Thu Jun 21 07:24:09 2018
From: doug_newcomb at fws.gov (Doug Newcomb)
Date: Thu, 21 Jun 2018 10:24:09 -0400
Subject: [gdal-dev] [EXTERNAL]  Convert VRT+JPEG with gdalwarp
In-Reply-To: <1529589603275-0.post@n6.nabble.com>
References: <1529589603275-0.post@n6.nabble.com>
Message-ID: <CALQGVr15naoJ8grAdAKS6c8-zO4WZFpLgfhsXHDriLdStXFf9w@mail.gmail.com>

Kalev,
Just set the output file format to -f  JPEG format   ( .jpg) or  -f
JP2OpenJPEG (.jp2)

The JPEG format will be lossey by default.  Is that what you want?
See:

https://medium.com/planet-stories/a-gentle-introduction-to-gdal-part-1-a3253eb96082

https://medium.com/planet-stories/a-gentle-introduction-to-gdal-part-2-map-projections-gdalwarp-e05173bd710a

Doug

On Thu, Jun 21, 2018 at 10:00 AM kalevj <kalev.julge at reach-u.com> wrote:

> Hello,
>
> I used gdalwarp to transform a VRT+JPEG pair from one EPSG projection to
> another. Everything worked well. This conversion changed the VRT file so
> that reprojection takes place when the images are loaded. However, I would
> need to reproject the JPEG so that there would not be a need to reproject
> every time the images are loaded. Is it possible somehow?
>
> I used the command:
> "gdalwarp -s_srs EPSG:2006 -t_srs EPSG:3857 -of VRT -r near old.vrt
> new.vrt"
>
> Thanks!
>
> Kalev
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Doug Newcomb
USFWS
551F Pylon Dr
Raleigh, NC
919-856-4520 ext. 14 doug_newcomb at fws.gov
---------------------------------------------------------------------------------------------------------

*NOTE: This email correspondence and any attachments to and from this
sender is subject to the Freedom of Information Act (FOIA) and may be
disclosed to third parties.*​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180621/606eac75/attachment.html>

From Piyush.Agram at jpl.nasa.gov  Thu Jun 21 15:59:22 2018
From: Piyush.Agram at jpl.nasa.gov (Agram, Piyush S (334D))
Date: Thu, 21 Jun 2018 22:59:22 +0000
Subject: [gdal-dev] spatial_ref and GeoTransform attributes for HDF5
	datasets
Message-ID: <F724BDA9-D543-4EEA-980A-83299CA48A35@jpl.nasa.gov>

Any opinions on this topic are welcome.  Would anyone have any objections to a PR that adds the feature for using spatial_ref and GeoTransform attributes to HDF5 datasets just like GDAL's non-CF netCDF driver? 

Thanks
Piyush



From even.rouault at spatialys.com  Fri Jun 22 00:27:37 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 22 Jun 2018 09:27:37 +0200
Subject: [gdal-dev] spatial_ref and GeoTransform attributes for HDF5
	datasets
In-Reply-To: <6E8C4198-53CA-41CD-8738-3E4EBF0663FA@jpl.nasa.gov>
References: <6E8C4198-53CA-41CD-8738-3E4EBF0663FA@jpl.nasa.gov>
Message-ID: <20697448.Dzse7e8u6K@even-i700>

On mercredi 20 juin 2018 04:05:18 CEST Agram, Piyush S (334D) wrote:
> Hi,
>     I’m looking for a simple convention to represent SRS and Geotransform
> information for HDF5 arrays. A fairly thorough reading of available HDF5
> geospatial data representation specs hasn’t resulted in a satisfactory
> solution. I know that HDF-EOS5 is a published spec but the unintuitive
> naming of swaths and grids is not a satisfactory solution for what we are
> trying to accomplish. We would like a spec that allows us to
 
> 
>   1.  Support complex datasets (possible since GDAL 2.3). HDF-EOS5 does not
> support this.
 2.  Generate HDF5 files with different grids in the same
> file – one can think of some grids as low resolution support grids which
> can be interpolated on the fly to match the primary high resolution grids.
> This might be an issue for CF-compliant representation? We might want
> support to include different grids for different layers depending on
> support needed by interpolators. 
> I’ve also been looking through the netcdf driver in GDAL since this is
> closely related to HDF5 and noticed that there is a non-CF compliant
> representation that is still supported. I’m happy to work on implementing a
> similar solution for HDF5 – namely each dataset gets its own spatial_ref
> (str) and GeoTransform (array of floats/doubles) attributes.

Piyush,

I don't know whih the best forums to discuss HDF5 related specifications are, 
and how much data producers care about standardization in HDF5 world, but 
ideally we would want this to be largely adopted to avoid having yet-another-
way-of-encoding-georeferencing in HDF related products.
So a potential idea could be to have some website / github page with a 
proposed spec, make some noise about it to try to get feedback and come to 
some concensus around it. Perhaps the scope could also encompass geolocation 
arrays / GCPs which seem to be quite common in HDF productions.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Jun 22 02:07:10 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 22 Jun 2018 11:07:10 +0200
Subject: [gdal-dev] GDAL 2.3.1 rc1 available
Message-ID: <1987569.bcpfSN7i8j@even-i700>

Hi,

I've issued a release candidate for GDAL 2.3.1. This adds 75 bug fixes on top 
of 2.3.0. The C and C++ API and ABI are unchanged.

The source is available at:

    http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc1.tar.xz
    http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc1.tar.gz
    http://download.osgeo.org/gdal/2.3.1/gdal231rc1.zip

A snapshot of the Python autotest suite can be downloaded from:

    http://download.osgeo.org/gdal/2.3.1/gdalautotest-2.3.1rc1.tar.gz
    http://download.osgeo.org/gdal/2.3.1/gdalautotest-2.3.1rc1.zip

GDAL-GRASS plugin:

    http://download.osgeo.org/gdal/2.3.1/gdal-grass-2.3.1.tar.gz

NEWS page:

   https://trac.osgeo.org/gdal/wiki/Release/2.3.1-News

I'll call for a vote to promote it to final at the beginning of next week if 
nothing serious is reported before.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From laasunde at hotmail.com  Fri Jun 22 02:41:02 2018
From: laasunde at hotmail.com (Lars)
Date: Fri, 22 Jun 2018 09:41:02 +0000
Subject: [gdal-dev] ogr2ogr adding metadata
Message-ID: <HE1PR03MB1338AB823DC751EBA41D8F14CA750@HE1PR03MB1338.eurprd03.prod.outlook.com>

Hello folks,

Using ogr2ogr (version 2.2.3) to import s57 into PostgreSQL which works great.

What is the recommended approach for adding metadata to all inserted data?

Say I wanted to add current date to all inserted data. Does ogr2ogr support such operation? Tried using the "-mo" argument but it did not make any inpact (same result with argument as without). Ideally I do not want the client to be adding this information as a post insert operation (if even possible).

Appreciate any insight.

kind regards, Lars
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180622/062d9d99/attachment.html>

From alexhighviz at hotmail.com  Fri Jun 22 10:53:55 2018
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Fri, 22 Jun 2018 17:53:55 +0000
Subject: [gdal-dev] Help with idiomatic GDAL solution for raster algebra
 benchmark
In-Reply-To: <d2626d95-5cff-b0d6-ede7-676fb8b19f9e@hotmail.com>
References: <HE1PR0501MB269878D5728B8FC5E22135F5B47D0@HE1PR0501MB2698.eurprd05.prod.outlook.com>
 <1907458.9mazDPShZq@even-i700>,
 <d2626d95-5cff-b0d6-ede7-676fb8b19f9e@hotmail.com>
Message-ID: <HE1PR0501MB2698ADB3016BBE0CACBB87DEB4750@HE1PR0501MB2698.eurprd05.prod.outlook.com>

________________________________
From: Alex Highviz <alexhighviz at hotmail.com>
Sent: 22 June 2018 18:27:14
To: even.rouault at spatialys.com
Subject: Re: [gdal-dev] Help with idiomatic GDAL solution for raster algebra benchmark



On 14/06/2018 21:22, Even Rouault wrote:
>
> [ ]
> - 1000x1000 is somewhat small. Perhaps benchmark on larger rasters
>
> [ ]
> - it would be interested if you could also benchmark a VRT with Python numpy-
> based pixel function, and enable Numba. See
> http://www.gdal.org/gdal_vrttut.html#gdal_vrttut_derived_python (or just pure
> numpy based computation + Numba)
>
> [ ]
> Even
>
Hi Even,

I tried a few of your suggestions and am pleasantly surprised. These
results are for 10000  x 10000 matrices

VRT with C++ function : 10.1 seconds

VRT with NUMPY function (no Numba): 9.2 seconds

GDAL Direct using GetLockedBlockRef: 8.7 seconds

GDAL Direct using RasterIO: 30.7 seconds

Pronto Raster: 10.8 seconds

Just FYI
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180622/7371aaae/attachment.html>

From gisplaybox at gmail.com  Fri Jun 22 12:21:38 2018
From: gisplaybox at gmail.com (Ian)
Date: Sat, 23 Jun 2018 04:21:38 +0900
Subject: [gdal-dev] Tests if the geometry is within the other geometry
Message-ID: <CAHCcKHFMgQdEHYjykDy2xQSAjnLyynj_2xRpcEq=Q9x5=VX6QA@mail.gmail.com>

I have a shape file consisting of thousands of features/polygons.
I have to extract only those polygons which are within the reference
polygon.

I tried as follows:

refpoly = feat.GetGeometryRef()

fi =  'data.shp'
ids = ogr.Open(fi,0)
inlay = ids.GetLayer(0)
for feat in inlay:
    ctype = feat.GetField('Name')
    geomi = feat.GetGeometryRef()
       if geomi.Within(refpoly):
           write ods....

But it is running for weeks and not yet finished.
How to do it faster?

thanks
Ian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180623/0cb6f697/attachment.html>

From klassen.js at gmail.com  Fri Jun 22 12:38:15 2018
From: klassen.js at gmail.com (James Klassen)
Date: Fri, 22 Jun 2018 14:38:15 -0500
Subject: [gdal-dev] Esri JSON Curves
In-Reply-To: <CAHqX795pjO7gMucUG2vHNAanvQ2DdFA+re9HN9aMgc=jsw8fsw@mail.gmail.com>
References: <CAHqX796fb24M9yV9_PQ3A4C9BhJwyiB2wFs+KJ-9Sk+daY8ipQ@mail.gmail.com>
 <1644688.RXc6CkTpVx@even-i700>
 <CAHqX795pjO7gMucUG2vHNAanvQ2DdFA+re9HN9aMgc=jsw8fsw@mail.gmail.com>
Message-ID: <CAHqX796U46N+S9o0GWtK=0hPAoS7gJ5_HjWYMn4owbQuNcn7oQ@mail.gmail.com>

I finally got around to doing a rough implementation of parsing ESRIJSON
with curved geometries.  The code is very rough yet, but works enough to
import a polygon layer from an ESRI FeatureService into PostGIS with the
curves intact.  Code is available at [1].

Main issues:

I don't know how to detect if there will be curves in the source file
without first parsing the whole file, so currently I just assume a curved
geometry type.  This might be a candidate for an open option.

My focus has been on polygon layers (because that's the dataset I need to
read).  I doubt it works outside of polygon layers at the moment.

I had to enable the "Curve Geometries" capability in the top level GeoJSON
driver (which may break some things for the GeoJSON/TopoJSON drivers).

Memory management and error handling need to be improved.

I only implemented circular curves ("c").  There are other curve types
supported by the spec, (e.g. Bézier), but I don't have any examples of
these other types in the datasets I have on hand.

[1] https://github.com/klassenjs/gdal/tree/esrijson-curves



On Thu, Oct 19, 2017 at 4:55 PM, James Klassen <klassen.js at gmail.com> wrote:

> On Thu, Oct 19, 2017 at 2:04 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> On jeudi 19 octobre 2017 13:38:38 CEST James Klassen wrote:
>> > Has anyone looked at reading curved geometries from an Esri rest service
>> > queried with "returnTrueCurves=true"?
>> >
>> > My end goal is to import the data into PostGIS. We were successful using
>> > ogr2ogr to translate the curved features from a geodatabase download in
>> the
>> > past, but that download is being replaced with a rest service.  OGR
>> reads
>> > the rest service correctly without "returnTrueCurves=true", but we would
>> > like to preserve the integrity of the curves in the source data if
>> possible.
>> >
>> > It doesn't look like there is any code in GDAL 2.2 to deal with this
>> > situation.  `ogresrijsonreader.cpp:OGRESRIJSONReadPolygon()` looks
>> like it
>> > is only looking for a "rings" member, not "curveRings", etc.
>>
>> This is indeed not supported at the moment.
>> It appears to be documented in
>> http://resources.arcgis.com/en/help/arcgis-rest-api/index.ht
>> ml#//02r3000000n1000000#CURVE
>>
>> The data model is, non suprisingly, super close to what exists in
>> Personnal Geodatabase
>> or FileGeodatabase. Arc/CircularArc could be translated to
>> CIRCULARSTRING/COMPOUNDCURVE/
>> CURVEPOLYGON. Bezier curves would have to be linearized since there's no
>> equivalent in
>> OGC SF / ISO SQL-MM Part 3 standards.
>> So this is "just" a matter of coding it.
>>
>>
> Interesting.  So, some new JSON parsing code feeding into similar code to
> what already exists in other drivers to create the right OGR objects.  It
> just comes down to time and/or money to actually implement it.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180622/8c49a890/attachment.html>

From mikeucfl at gmail.com  Fri Jun 22 12:49:41 2018
From: mikeucfl at gmail.com (mikeucfl)
Date: Fri, 22 Jun 2018 12:49:41 -0700 (MST)
Subject: [gdal-dev] Tests if the geometry is within the other geometry
In-Reply-To: <CAHCcKHFMgQdEHYjykDy2xQSAjnLyynj_2xRpcEq=Q9x5=VX6QA@mail.gmail.com>
References: <CAHCcKHFMgQdEHYjykDy2xQSAjnLyynj_2xRpcEq=Q9x5=VX6QA@mail.gmail.com>
Message-ID: <1529696981754-0.post@n6.nabble.com>

Use a spatial filter using your refpoly before iterating the features:
http://gdal.org/python/osgeo.ogr.Layer-class.html#SetSpatialFilter



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Fri Jun 22 12:51:59 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 22 Jun 2018 21:51:59 +0200
Subject: [gdal-dev] Esri JSON Curves
In-Reply-To: <CAHqX796U46N+S9o0GWtK=0hPAoS7gJ5_HjWYMn4owbQuNcn7oQ@mail.gmail.com>
References: <CAHqX796fb24M9yV9_PQ3A4C9BhJwyiB2wFs+KJ-9Sk+daY8ipQ@mail.gmail.com>
 <CAHqX795pjO7gMucUG2vHNAanvQ2DdFA+re9HN9aMgc=jsw8fsw@mail.gmail.com>
 <CAHqX796U46N+S9o0GWtK=0hPAoS7gJ5_HjWYMn4owbQuNcn7oQ@mail.gmail.com>
Message-ID: <1987619.y9MCUktVRS@even-i700>

On vendredi 22 juin 2018 14:38:15 CEST James Klassen wrote:
> I finally got around to doing a rough implementation of parsing ESRIJSON
> with curved geometries.  The code is very rough yet, but works enough to
> import a polygon layer from an ESRI FeatureService into PostGIS with the
> curves intact.  Code is available at [1].
> 
> Main issues:
> 
> I don't know how to detect if there will be curves in the source file
> without first parsing the whole file, so currently I just assume a curved
> geometry type.  This might be a candidate for an open option.

The ESRI Json reader ingests everything in memory and builds the JSon tree 
structure, so doing an initial pass by default shouldn't be a big deal.

> 
> My focus has been on polygon layers (because that's the dataset I need to
> read).  I doubt it works outside of polygon layers at the moment.
> 
> I had to enable the "Curve Geometries" capability in the top level GeoJSON
> driver (which may break some things for the GeoJSON/TopoJSON drivers).

If my memories are right, you only need to set it for write support. So 
shouldn't be needed there.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Jun 22 14:15:36 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 22 Jun 2018 23:15:36 +0200
Subject: [gdal-dev] ogr2ogr adding metadata
In-Reply-To: <HE1PR03MB1338AB823DC751EBA41D8F14CA750@HE1PR03MB1338.eurprd03.prod.outlook.com>
References: <HE1PR03MB1338AB823DC751EBA41D8F14CA750@HE1PR03MB1338.eurprd03.prod.outlook.com>
Message-ID: <2558914.Q1IQ8xsQXi@even-i700>

On vendredi 22 juin 2018 09:41:02 CEST Lars wrote:
> Hello folks,
> 
> Using ogr2ogr (version 2.2.3) to import s57 into PostgreSQL which works
> great.
> 
> What is the recommended approach for adding metadata to all inserted data?
> 
> Say I wanted to add current date to all inserted data. Does ogr2ogr support
> such operation? Tried using the "-mo" argument but it did not make any
> inpact (same result with argument as without). Ideally I do not want the
> client to be adding this information as a post insert operation (if even
> possible).

Lars,

-mo will work only with very few target drivers (I can only think to 
GeoPackage actually). This is per-layer/per-table metadata. There's perhaps 
the equivalent in PostgreSQL but this isn't implemented by GDAL

But you can add a column with the current timestamp for example with

ogr2ogr -update PG:xxxxxx poly.shp \
       -sql "SELECT *, CURRENT_TIMESTAMP FROM poly" -dialect SQLITE

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From gisplaybox at gmail.com  Fri Jun 22 23:01:43 2018
From: gisplaybox at gmail.com (Ian)
Date: Sat, 23 Jun 2018 15:01:43 +0900
Subject: [gdal-dev] Tests if the geometry is within the other geometry
In-Reply-To: <CAHCcKHEdjnx1arPry+Z_aQ-FQ6B0PsLCOr7D+ycP4gyEKkcYrw@mail.gmail.com>
References: <CAHCcKHFMgQdEHYjykDy2xQSAjnLyynj_2xRpcEq=Q9x5=VX6QA@mail.gmail.com>
 <1529696981754-0.post@n6.nabble.com>
 <CAHCcKHEdjnx1arPry+Z_aQ-FQ6B0PsLCOr7D+ycP4gyEKkcYrw@mail.gmail.com>
Message-ID: <CAHCcKHHaQ_3RYa9saTY5Tsh-c2WyQcyXAUnz_ZDoRaaKfW0xNQ@mail.gmail.com>

inlay.SetSpatialFilter(refpoy) did not meet my requirement of  "if
geomi.Within(refpoly)".

if I use both  inlay.SetSpatialFilter(refpoy) and  geomi.Within(refpoly),
speed is same as before.
.SetSpatialFilter tested intersect of the envelopes, which i do not need.
any idea is appreciated

On Sat, Jun 23, 2018 at 2:01 PM, Ian <gisplaybox at gmail.com> wrote:

> after spatial filter, should i use  if geomi.Within(refpoly)?
>
> On Sat, Jun 23, 2018 at 4:49 AM, mikeucfl <mikeucfl at gmail.com> wrote:
>
>> Use a spatial filter using your refpoly before iterating the features:
>> http://gdal.org/python/osgeo.ogr.Layer-class.html#SetSpatialFilter
>>
>>
>>
>> --
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180623/846697f5/attachment.html>

From even.rouault at spatialys.com  Sat Jun 23 01:20:33 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 23 Jun 2018 10:20:33 +0200
Subject: [gdal-dev] Tests if the geometry is within the other geometry
In-Reply-To: <CAHCcKHFMgQdEHYjykDy2xQSAjnLyynj_2xRpcEq=Q9x5=VX6QA@mail.gmail.com>
References: <CAHCcKHFMgQdEHYjykDy2xQSAjnLyynj_2xRpcEq=Q9x5=VX6QA@mail.gmail.com>
Message-ID: <2292608.ELAchxx6xU@even-i700>

On samedi 23 juin 2018 04:21:38 CEST Ian wrote:
> I have a shape file consisting of thousands of features/polygons.
> I have to extract only those polygons which are within the reference
> polygon.
> 
> I tried as follows:
> 
> refpoly = feat.GetGeometryRef()
> 
> fi =  'data.shp'
> ids = ogr.Open(fi,0)
> inlay = ids.GetLayer(0)
> for feat in inlay:
>     ctype = feat.GetField('Name')
>     geomi = feat.GetGeometryRef()
>        if geomi.Within(refpoly):
>            write ods....
> 
> But it is running for weeks and not yet finished.
> How to do it faster?

geomi.Within(refpoly) is equivalent to refpoly.Contains(geomi)

If you use Shapely and prepared geometry, and that refpoly is a rather complex 
geometry, then making it a prepared geometry could speed up the contains test.

http://toblerity.org/shapely/manual.html#prepared-geometry-operations

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From andrew at aitchison.me.uk  Sat Jun 23 02:51:11 2018
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sat, 23 Jun 2018 10:51:11 +0100 (BST)
Subject: [gdal-dev] GDAL 2.3.1 rc1 available
In-Reply-To: <1987569.bcpfSN7i8j@even-i700>
References: <1987569.bcpfSN7i8j@even-i700>
Message-ID: <alpine.LRH.2.21.1806231044420.482@warden.aitchison.me.uk>

On Fri, 22 Jun 2018, Even Rouault wrote:

> I've issued a release candidate for GDAL 2.3.1. This adds 75 bug fixes on top 
> of 2.3.0. The C and C++ API and ABI are unchanged.
>
> The source is available at:
>
>    http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc1.tar.xz
>    http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc1.tar.gz
>    http://download.osgeo.org/gdal/2.3.1/gdal231rc1.zip

When building this on Scientific Linux 6.9 I found *one* warning,

/bin/sh /home/werdna/gdal2.3.1rc1/gdal-2.3.1/libtool --mode=compile
   --silent --tag=CXX g++ -DHAVE_AVX_AT_COMPILE_TIME
   -DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -g -O2  -Wall
   -Wextra -Winit-self -Wunused-parameter -Wformat -Werror=format-security
   -Wno-format-nonliteral -Wlogical-op -Wshadow -Werror=vla -Wdate-time
   -Wnull-dereference -Wduplicated-cond -Wfloat-conversion
   -Wmissing-declarations -Wnon-virtual-dtor -Woverloaded-virtual
   -fno-operator-names -Wzero-as-null-pointer-constant -Wsuggest-override
   -Wimplicit-fallthrough  -I.. -I../sqlite -I../../../frmts/mem
   -I/usr/include -DGNM_ENABLED -I/home/werdna/gdal2.3.1rc1/gdal-2.3.1/port
   -I/usr/include -I/usr/include/cfitsio  -DGDAL_COMPILATION
   -DSQLITE_HAS_COLUMN_METADATA  -c -o ogrgeopackagetablelayer.o
   ogrgeopackagetablelayer.cpp
ogrgeopackagetablelayer.cpp: In member function 'virtual OGRErr 
OGRGeoPackageTableLayer::ISetFeature(OGRFeature*)':
ogrgeopackagetablelayer.cpp:1856:100: warning: zero as null pointer constant [-Wzero-as-null-pointer-constant]
              int err = sqlite3_prepare_v2(m_poDS->GetDB(), osCommand, -1, 
&m_poUpdateStatement, NULL);

so I attach a patch.

-- 
Andrew C. Aitchison					Cambridge, UK
 			andrew at aitchison.me.uk
-------------- next part --------------
--- gdal-2.3.1/ogr/ogrsf_frmts/gpkg/ogrgeopackagetablelayer.cpp.orig	2018-06-22 09:40:17.000000000 +0100
+++ gdal-2.3.1/ogr/ogrsf_frmts/gpkg/ogrgeopackagetablelayer.cpp	2018-06-23 10:43:09.675549558 +0100
@@ -1853,7 +1853,7 @@ OGRErr OGRGeoPackageTableLayer::ISetFeat
             CPLString osCommand = FeatureGenerateInsertSQL(poFeature, true, true);
 
             /* Prepare the SQL into a statement */
-            int err = sqlite3_prepare_v2(m_poDS->GetDB(), osCommand, -1, &m_poUpdateStatement, NULL);
+            int err = sqlite3_prepare_v2(m_poDS->GetDB(), osCommand, -1, &m_poUpdateStatement, nullptr);
             if ( err != SQLITE_OK )
             {
                 CPLError( CE_Failure, CPLE_AppDefined,

From even.rouault at spatialys.com  Sat Jun 23 03:32:33 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 23 Jun 2018 12:32:33 +0200
Subject: [gdal-dev] GDAL 2.3.1 rc1 available
In-Reply-To: <alpine.LRH.2.21.1806231044420.482@warden.aitchison.me.uk>
References: <1987569.bcpfSN7i8j@even-i700>
 <alpine.LRH.2.21.1806231044420.482@warden.aitchison.me.uk>
Message-ID: <3929709.rIXvoCmUra@even-i700>

> so I attach a patch.

Thanks, applied.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Sat Jun 23 08:36:41 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 23 Jun 2018 17:36:41 +0200
Subject: [gdal-dev] GDAL 2.3.1 rc2 available
Message-ID: <1796678.9QHdFH4I8q@even-i700>

Hi,

I've issued a rc2 to fix a parallel make issue on Unix with the install target 
(#707)

The changes since rc1 are:
*  Fix mkgdaldist.sh and shellcheck issues
* GPKG: fix -Wzero-as-null-pointer-constant warning with sqlite < 3.7.8
* GNUmakefile: fix dependency of install target (fixes #707)

The source is available at:
 
     http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc2.tar.xz
     http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc2.tar.gz
     http://download.osgeo.org/gdal/2.3.1/gdal231rc2.zip

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Sat Jun 23 08:21:07 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 23 Jun 2018 17:21:07 +0200
Subject: [gdal-dev] GDAL 2.3.1 rc2 available
In-Reply-To: <1987569.bcpfSN7i8j@even-i700>
References: <1987569.bcpfSN7i8j@even-i700>
Message-ID: <39252087.RKRb0tv0GB@even-i700>

Hi,

I've issued a rc2 to fix a parallel make issue on Unix with the install target 
(#707)

The changes since rc1 are:
*  Fix mkgdaldist.sh and shellcheck issues
* GPKG: fix -Wzero-as-null-pointer-constant warning with sqlite < 3.7.8
* GNUmakefile: fix dependency of install target (fixes #707)

The source is available at:
 
     http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc2.tar.xz
     http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1rc2.tar.gz
     http://download.osgeo.org/gdal/2.3.1/gdal231rc2.zip

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From refriguy68 at yahoo.com  Sun Jun 24 08:45:18 2018
From: refriguy68 at yahoo.com (Robert Zermeno)
Date: Sun, 24 Jun 2018 06:45:18 -0900
Subject: [gdal-dev] =?utf-8?q?=28no_subject=29?=
Message-ID: <1529855124.X7Cef98x7Jf6oX7Cef1bDT@mf-smf-ucb024c3>

http://see.marquesmaben.com

Robert Zermeno

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180624/3813a34a/attachment.html>

From ireese at linz.govt.nz  Sun Jun 24 20:19:17 2018
From: ireese at linz.govt.nz (Ian Reese)
Date: Mon, 25 Jun 2018 03:19:17 +0000
Subject: [gdal-dev] Kriging Interpolation
Message-ID: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>

Hi Gdal,

I'd like to know if it is possible to make Kriging Interpolation part of gdal_grid.  We work with a good deal of scattered point elevation data and neither IDW or Linear interpolations(smooth or not smooth)  produce the desired visual results.  Nor are they fast enough for the density of data we commonly work with. Linear interpolation is a reliable and fast method, however the triangulated results are difficult to work with visually.

For some visual comparisons and reference, here is a link to a folder of sample points(shp) for a test area, two examples of kriged data for that test region, and a BASH script to reproduce IDW and Linear interpolations of the same region.

https://drive.google.com/open?id=1HKbK4wMmVN6JZSvhxBQDub1WXBLE710H

Here is an example of the Kriging method used by ArcGIS:
http://desktop.arcgis.com/en/arcmap/latest/extensions/geostatistical-analyst/kriging-in-geostatistical-analyst.htm

Few graphs explaining best interpolation methods to use with given data.  Gridded vs. scattered.
https://www.neonscience.org/spatial-interpolation-basics

If it is possible, we are curious to know what type of funding would be needed.

Cheers,

Ian

________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180625/7f972ccb/attachment.html>

From chris.marsh at usask.ca  Sun Jun 24 20:29:14 2018
From: chris.marsh at usask.ca (Chris Marsh)
Date: Sun, 24 Jun 2018 21:29:14 -0600
Subject: [gdal-dev] Kriging Interpolation
In-Reply-To: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
References: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
Message-ID: <CAFgDerGZ1fM9pTUtAWSDuU7JqrDHAeQw-28x8_P07-Lz+epP9Q@mail.gmail.com>

 For what is worth, as an end-user of GDAL, I would be very interested in
having such capacity in GDAL.
Cheers
Chris


On 24 June 2018 at 21:19, Ian Reese <ireese at linz.govt.nz> wrote:

> Hi Gdal,
>
> I'd like to know if it is possible to make Kriging Interpolation part of
> gdal_grid.  We work with a good deal of scattered point elevation data and
> neither IDW or Linear interpolations(smooth or not smooth)  produce the
> desired visual results.  Nor are they fast enough for the density of data
> we commonly work with. Linear interpolation is a reliable and fast method,
> however the triangulated results are difficult to work with visually.
>
> For some visual comparisons and reference, here is a link to a folder of
> sample points(shp) for a test area, two examples of kriged data for that
> test region, and a BASH script to reproduce IDW and Linear interpolations
> of the same region.
>
> https://drive.google.com/open?id=1HKbK4wMmVN6JZSvhxBQDub1WXBLE710H
>
> Here is an example of the Kriging method used by ArcGIS:
> http://desktop.arcgis.com/en/arcmap/latest/extensions/
> geostatistical-analyst/kriging-in-geostatistical-analyst.htm
>
> Few graphs explaining best interpolation methods to use with given data.
> Gridded vs. scattered.
> https://www.neonscience.org/spatial-interpolation-basics
>
> If it is possible, we are curious to know what type of funding would be
> needed.
>
> Cheers,
>
> Ian
>
> ------------------------------
>
> This message contains information, which may be in confidence and may be
> subject to legal privilege. If you are not the intended recipient, you must
> not peruse, use, disseminate, distribute or copy this message. If you have
> received this message in error, please notify us immediately (Phone 0800
> 665 463 or info at linz.govt.nz) and destroy the original message. LINZ
> accepts no responsibility for changes to this email, or for any
> attachments, after its transmission from LINZ. Thank You.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180624/e6b09058/attachment.html>

From knudsen.thomas at gmail.com  Mon Jun 25 01:59:43 2018
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Mon, 25 Jun 2018 10:59:43 +0200
Subject: [gdal-dev] Kriging Interpolation
In-Reply-To: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
References: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
Message-ID: <CAH0YoENBxSfUhhAOe3WxsQzEHB6jtebYrP-sR6Hv1z91c0nwtQ@mail.gmail.com>

Hi Ian,

If you find IDW on N points slow, you will find Kriging on the same number
of points unbearably slow, since for Kriging you will have to solve a
system of N linear equations (essentially inverting an NxN matrix) to
compute the Kriging weights. To set up the matrix you will even need to
compute the same distance elements you need for IDW. So Kriging will never
become faster than IDW.

Hence, the only realistic way to use Kriging on large data sets is to base
each estimate on local subsets - typically by working in a TIN model, just
like in the linear interpolation case. And if your data set is dense, the
difference between Kriging and linear interpolation will be miniscule.
Kriging will, however, provide a variance estimate for the prediction,
which may be realistic assuming you provide a realistic covariance function
for the phenomenon under investigation.

So to make any difference wrt the linear interpolation, you will need to
include a larger number of data, e.g. by including neighbouring triangles
of the TIN, or using another data structure to subset your observations.

Some years ago I wrote an informal note about this subject. The title is
“Data Assimilation for Updates of Digital Terrain Models” and it is
available over at http://sdfe.dk/media/2916626/kms_technical_report_14.pdf

/Thomas




2018-06-25 5:19 GMT+02:00 Ian Reese <ireese at linz.govt.nz>:

> Hi Gdal,
>
> I'd like to know if it is possible to make Kriging Interpolation part of
> gdal_grid.  We work with a good deal of scattered point elevation data and
> neither IDW or Linear interpolations(smooth or not smooth)  produce the
> desired visual results.  Nor are they fast enough for the density of data
> we commonly work with. Linear interpolation is a reliable and fast method,
> however the triangulated results are difficult to work with visually.
>
> For some visual comparisons and reference, here is a link to a folder of
> sample points(shp) for a test area, two examples of kriged data for that
> test region, and a BASH script to reproduce IDW and Linear interpolations
> of the same region.
>
> https://drive.google.com/open?id=1HKbK4wMmVN6JZSvhxBQDub1WXBLE710H
>
> Here is an example of the Kriging method used by ArcGIS:
> http://desktop.arcgis.com/en/arcmap/latest/extensions/
> geostatistical-analyst/kriging-in-geostatistical-analyst.htm
>
> Few graphs explaining best interpolation methods to use with given data.
> Gridded vs. scattered.
> https://www.neonscience.org/spatial-interpolation-basics
>
> If it is possible, we are curious to know what type of funding would be
> needed.
>
> Cheers,
>
> Ian
>
> ------------------------------
>
> This message contains information, which may be in confidence and may be
> subject to legal privilege. If you are not the intended recipient, you must
> not peruse, use, disseminate, distribute or copy this message. If you have
> received this message in error, please notify us immediately (Phone 0800
> 665 463 or info at linz.govt.nz) and destroy the original message. LINZ
> accepts no responsibility for changes to this email, or for any
> attachments, after its transmission from LINZ. Thank You.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180625/453b176f/attachment-0001.html>

From osahon.gis at gmail.com  Mon Jun 25 02:18:22 2018
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Mon, 25 Jun 2018 10:18:22 +0100
Subject: [gdal-dev] [gdal-announce] GDAL Support For PostGIS Out-DB
	Raster
In-Reply-To: <8130283.T08iD0Capr@even-i700>
References: <CAGpiUSiyAhwxvp=H0GDh6hiPtThJBgiR8btG1_LuG63UvTFcYQ@mail.gmail.com>
 <3590062.V6rRWWEyfA@even-i700>
 <CAGpiUSgmXYLHf03grF-Qr8wKzt5QanrGBvrzGqpAEe6n0QAehg@mail.gmail.com>
 <8130283.T08iD0Capr@even-i700>
Message-ID: <CAGpiUShnhLxyCGQjt=Ne_JY9Ob9Uw4Y=KS4UfwSyNWfEjHGojA@mail.gmail.com>

Hi Even,

I want to find out if this GDAL fix will be release by the end of June. I
use PostGIS version 2.3.2 at present and I will be building from source.

On Thu, May 31, 2018 at 9:39 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On jeudi 31 mai 2018 21:35:30 CEST Osahon Oduware wrote:
> > Hi Even,
> >
> > Thanks for the prompt response. Please, I want to know what is the
> minimum
> > version of GDAL,
> no released version yet. Will be in 2.3.1 (end of June probably) and 2.4.0
> (next year)
> > PostgreSQL
> irrelevant. Any PostgreSQL version supported by the PostGIS version you
> use is
> fine
> > and Postgis
> will be in Postgis 2.5.0. But not strictly needed. Existing versions will
> work
> too
>
> > that this outdb raster
> > functionality is currently implemented.
> >
> > Best Regards
> >
> > On May 31, 2018 20:13, "Even Rouault" <even.rouault at spatialys.com>
> wrote:
> > > On jeudi 31 mai 2018 20:04:58 CEST Osahon Oduware wrote:
> > > > Hi Even,
> > > >
> > > > Any update on this? I have been away for a while.
> > >
> > > Yep, support for out-db raster has been added in GDAL master, and
> > > backported
> > > to 2.3 branch as well
> > >
> > > See outdb_resolution option in http://gdal.org/frmt_postgisraster.html
> > >
> > > 2 new functions added to PostGIS 2.5dev as well to help reading the
> out-db
> > > raster directly from client-side if client and server see the same
> raster.
> > >
> > > --
> > > Spatialys - Geospatial professional services
> > > http://www.spatialys.com
>
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180625/d0a955eb/attachment.html>

From even.rouault at spatialys.com  Mon Jun 25 02:26:56 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Jun 2018 11:26:56 +0200
Subject: [gdal-dev] [gdal-announce] GDAL Support For PostGIS Out-DB
	Raster
In-Reply-To: <CAGpiUShnhLxyCGQjt=Ne_JY9Ob9Uw4Y=KS4UfwSyNWfEjHGojA@mail.gmail.com>
References: <CAGpiUSiyAhwxvp=H0GDh6hiPtThJBgiR8btG1_LuG63UvTFcYQ@mail.gmail.com>
 <8130283.T08iD0Capr@even-i700>
 <CAGpiUShnhLxyCGQjt=Ne_JY9Ob9Uw4Y=KS4UfwSyNWfEjHGojA@mail.gmail.com>
Message-ID: <1855723.gNRdBu3k1j@even-i700>

On lundi 25 juin 2018 10:18:22 CEST Osahon Oduware wrote:
> Hi Even,
> 
> I want to find out if this GDAL fix will be release by the end of June. I
> use PostGIS version 2.3.2 at present and I will be building from source.

Yes, this is in the release notes of the release candidate of GDAL 2.3.1 that 
was published last Friday:
https://trac.osgeo.org/gdal/wiki/Release/2.3.1-News

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From osahon.gis at gmail.com  Mon Jun 25 04:43:27 2018
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Mon, 25 Jun 2018 12:43:27 +0100
Subject: [gdal-dev] [gdal-announce] GDAL Support For PostGIS Out-DB
	Raster
In-Reply-To: <1855723.gNRdBu3k1j@even-i700>
References: <CAGpiUSiyAhwxvp=H0GDh6hiPtThJBgiR8btG1_LuG63UvTFcYQ@mail.gmail.com>
 <8130283.T08iD0Capr@even-i700>
 <CAGpiUShnhLxyCGQjt=Ne_JY9Ob9Uw4Y=KS4UfwSyNWfEjHGojA@mail.gmail.com>
 <1855723.gNRdBu3k1j@even-i700>
Message-ID: <CAGpiUSgkHbu5fwabpnQDq8qwgFMqra-gmu=N9jski42L8VW9fg@mail.gmail.com>

Hi Even,

Thanks a lot. This is great news! I will start investigating the fix for
Out-DB rasters. I will keep you posted. Great work!

On Mon, Jun 25, 2018 at 10:26 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On lundi 25 juin 2018 10:18:22 CEST Osahon Oduware wrote:
> > Hi Even,
> >
> > I want to find out if this GDAL fix will be release by the end of June. I
> > use PostGIS version 2.3.2 at present and I will be building from source.
>
> Yes, this is in the release notes of the release candidate of GDAL 2.3.1
> that
> was published last Friday:
> https://trac.osgeo.org/gdal/wiki/Release/2.3.1-News
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180625/cc6d23f3/attachment.html>

From even.rouault at spatialys.com  Mon Jun 25 05:20:58 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Jun 2018 14:20:58 +0200
Subject: [gdal-dev] Kriging Interpolation
In-Reply-To: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
References: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
Message-ID: <3242517.1dcHupMW18@even-i700>

Ian,

Looking at your script, for the IDW, I see you don't use the max_points, nor 
the radius1 and radius2 to limit the neighbourhoud into which the points are 
searched.

For the linear search, I've profiled the run and found that an enormous amout 
of time was spent processing the points outside of the triangulation. 
Investigating, I found there was a missed optimization that I've added per
https://github.com/OSGeo/gdal/commit/134b9c4e437e347aac48c459a18a933ed526be5b

With that optimization, the runtime with 8 threads is 16 sec, vs 48 sec before 
(on a non-optimized debug build)
And if you don't want the nearest neighbour search for points outside of the 
triangulation, you can also add :radius=0.0, and this will speed up things 
again. Down to 2 sec.

Regarding Kriging, I guess you specified some neighbourood value in ArcGIS ? 
Otherwise as mentionned by Thomas, Knudsen, the computation time and memory 
requirements would be enormous (between O(n^2) and O(n^3) where n is the 
number of points).
I gave a try to https://github.com/bsmurphy/PyKrige and used Ordinary Kriging. 
For the above reasons, it blows up with a MemoryError on the full layer. I 
also found that the extent of the output grid had also a strong influence on 
the memory requirements. Which is less expected, perhaps a side effect of that 
particular implementation.
Anyway, if arbitrarily restricting to the first 1000 points of your layer 
(which is roughly a strip in the middle of the dataset) and to their extent 
(producing a 1321x45 raster with 1m resolution), it gives a result (2 minutes 
single-threaded, 1.8 GB RAM), which looks consistent with the one from ArcGIS. 
This is not exactly the same due to a non-moving neighbouroud having been used 
due to my simplified methodology, but for the 'inner' of the computed raster, 
this is quite similar.
So for Kriging, a moving window approach limiting the number of input points 
would be absolutely needed for "large" point datasets, and the processing time 
would still be significantly slower than linear interpolation.

Even


> Hi Gdal,
> 
> I'd like to know if it is possible to make Kriging Interpolation part of
> gdal_grid.  We work with a good deal of scattered point elevation data and
> neither IDW or Linear interpolations(smooth or not smooth)  produce the
> desired visual results.  Nor are they fast enough for the density of data
> we commonly work with. Linear interpolation is a reliable and fast method,
> however the triangulated results are difficult to work with visually.
> 
> For some visual comparisons and reference, here is a link to a folder of
> sample points(shp) for a test area, two examples of kriged data for that
> test region, and a BASH script to reproduce IDW and Linear interpolations
> of the same region.
> 
> https://drive.google.com/open?id=1HKbK4wMmVN6JZSvhxBQDub1WXBLE710H
> 
> Here is an example of the Kriging method used by ArcGIS:
> http://desktop.arcgis.com/en/arcmap/latest/extensions/geostatistical-analyst
> /kriging-in-geostatistical-analyst.htm
> 
> Few graphs explaining best interpolation methods to use with given data. 
> Gridded vs. scattered.
> https://www.neonscience.org/spatial-interpolation-basics
> 
> If it is possible, we are curious to know what type of funding would be
> needed.
> 
> Cheers,
> 
> Ian
> 
> ________________________________
> 
> This message contains information, which may be in confidence and may be
> subject to legal privilege. If you are not the intended recipient, you must
> not peruse, use, disseminate, distribute or copy this message. If you have
> received this message in error, please notify us immediately (Phone 0800
> 665 463 or info at linz.govt.nz) and destroy the original message. LINZ
> accepts no responsibility for changes to this email, or for any
> attachments, after its transmission from LINZ. Thank You.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From kalev.julge at reach-u.com  Mon Jun 25 06:10:16 2018
From: kalev.julge at reach-u.com (Kalev Julge)
Date: Mon, 25 Jun 2018 13:10:16 +0000
Subject: [gdal-dev] [EXTERNAL]  Convert VRT+JPEG with gdalwarp
In-Reply-To: <CALQGVr15naoJ8grAdAKS6c8-zO4WZFpLgfhsXHDriLdStXFf9w@mail.gmail.com>
References: <1529589603275-0.post@n6.nabble.com>
 <CALQGVr15naoJ8grAdAKS6c8-zO4WZFpLgfhsXHDriLdStXFf9w@mail.gmail.com>
Message-ID: <VI1PR08MB31993C629C11B440C24D7785BA4A0@VI1PR08MB3199.eurprd08.prod.outlook.com>

Hi Doug,

Thanks for the info. I know that JPEG is lossy but our datasets are very large. That’s why we use JPEG, which is good enough for our needs and the file sizes are smaller.

It seems that GDAL doesn’t create new JPEG files without having pre-existing JPEG-s to modify. If I try to modify old JPEG, I get a message “Output dataset exists, but cannot be opened in update mode.

I also tried using “CreateCopy” but that produced syntax error. Used command on GDAL CMD:
“GDALDriver::CreateCopy ("new.jpg","old.jpg", FALSE, NULL, NULL, NULL)”

Kalev

From: Doug Newcomb <doug_newcomb at fws.gov>
Sent: Thursday, June 21, 2018 5:24 PM
To: Kalev Julge <kalev.julge at reach-u.com>
Cc: gdal dev <gdal-dev at lists.osgeo.org>
Subject: Re: [EXTERNAL] [gdal-dev] Convert VRT+JPEG with gdalwarp

Kalev,
Just set the output file format to -f  JPEG format   ( .jpg) or  -f JP2OpenJPEG (.jp2)

The JPEG format will be lossey by default.  Is that what you want?
See:
 https://medium.com/planet-stories/a-gentle-introduction-to-gdal-part-1-a3253eb96082

https://medium.com/planet-stories/a-gentle-introduction-to-gdal-part-2-map-projections-gdalwarp-e05173bd710a

Doug

On Thu, Jun 21, 2018 at 10:00 AM kalevj <kalev.julge at reach-u.com<mailto:kalev.julge at reach-u.com>> wrote:
Hello,

I used gdalwarp to transform a VRT+JPEG pair from one EPSG projection to
another. Everything worked well. This conversion changed the VRT file so
that reprojection takes place when the images are loaded. However, I would
need to reproject the JPEG so that there would not be a need to reproject
every time the images are loaded. Is it possible somehow?

I used the command:
"gdalwarp -s_srs EPSG:2006 -t_srs EPSG:3857 -of VRT -r near old.vrt new.vrt"

Thanks!

Kalev



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
Doug Newcomb
USFWS
551F Pylon Dr
Raleigh, NC
919-856-4520 ext. 14 doug_newcomb at fws.gov<mailto:doug_newcomb at fws.gov>
---------------------------------------------------------------------------------------------------------

NOTE: This email correspondence and any attachments to and from this sender is subject to the Freedom of Information Act (FOIA) and may be disclosed to third parties.​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180625/bf85ad81/attachment-0001.html>

From even.rouault at spatialys.com  Mon Jun 25 06:18:38 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Jun 2018 15:18:38 +0200
Subject: [gdal-dev] Motion: Promote GDAL 2.3.1 rc2 for release
Message-ID: <1989773.0pK2AJ4sWq@even-i700>

Hi,

Motion: GDAL/OGR 2.3.1 rc2 is promoted to be the official 2.3.1 final release.

-------

My vote: +1

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Mon Jun 25 06:29:50 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Jun 2018 15:29:50 +0200
Subject: [gdal-dev] [EXTERNAL]  Convert VRT+JPEG with gdalwarp
In-Reply-To: <VI1PR08MB31993C629C11B440C24D7785BA4A0@VI1PR08MB3199.eurprd08.prod.outlook.com>
References: <1529589603275-0.post@n6.nabble.com>
 <CALQGVr15naoJ8grAdAKS6c8-zO4WZFpLgfhsXHDriLdStXFf9w@mail.gmail.com>
 <VI1PR08MB31993C629C11B440C24D7785BA4A0@VI1PR08MB3199.eurprd08.prod.outlook.com>
Message-ID: <4494603.IyRUZ1V78Z@even-i700>

On lundi 25 juin 2018 13:10:16 CEST Kalev Julge wrote:
> Hi Doug,
> 
> Thanks for the info. I know that JPEG is lossy but our datasets are very
> large. That’s why we use JPEG, which is good enough for our needs and the
> file sizes are smaller.

After your gdalwarp to VRT, do:
gdal_translate new.vrt new.jpg -of JPEG

You cannot directly wrap to JPEG, because of the driver limitation
See https://trac.osgeo.org/gdal/wiki/FAQRaster#Whywontgdalwarporgdal_mergewritetomostformats
 
> It seems that GDAL doesn’t create new JPEG files without having pre-existing
> JPEG-s to modify. 

Actually, that's right the opposite :-)

> If I try to modify old JPEG, I get a message “Output
> dataset exists, but cannot be opened in update mode.

That means you cannot modify an existing JPEG. You have to recreate a completely new file.
 
> I also tried using “CreateCopy” but that produced syntax error. Used command
> on GDAL CMD:
 “GDALDriver::CreateCopy ("new.jpg","old.jpg", FALSE, NULL,
> NULL, NULL)” 

The second argument must be a GDALDataset* object, not a string, so do something like

GDALDataset* srcDS = reinterpret_cast<GDALDataset*>(
   GDALOpen("old.jpg", GA_ReadOnly));
GDALDataset* outDS = jpegDriver->CreateCopy(
    "new.jpg", srcDS, FALSE, NULL, NULL, NULL);
GDALClose(outDS);
GDALClose(srcDS);

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From szekerest at gmail.com  Mon Jun 25 13:10:33 2018
From: szekerest at gmail.com (Tamas Szekeres)
Date: Mon, 25 Jun 2018 22:10:33 +0200
Subject: [gdal-dev] Motion: Promote GDAL 2.3.1 rc2 for release
In-Reply-To: <1989773.0pK2AJ4sWq@even-i700>
References: <1989773.0pK2AJ4sWq@even-i700>
Message-ID: <CACALY+SUYN=LYKGXE1-SdbXb-Q2kz_bFvi00ewZVtzrqZn4qYg@mail.gmail.com>

+1

Tamas


2018-06-25 15:18 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:

> Hi,
>
> Motion: GDAL/OGR 2.3.1 rc2 is promoted to be the official 2.3.1 final
> release.
>
> -------
>
> My vote: +1
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180625/ad7292e3/attachment.html>

From klassen.js at gmail.com  Mon Jun 25 13:45:55 2018
From: klassen.js at gmail.com (Jim Klassen)
Date: Mon, 25 Jun 2018 15:45:55 -0500
Subject: [gdal-dev] Esri JSON Curves
In-Reply-To: <1987619.y9MCUktVRS@even-i700>
References: <CAHqX796fb24M9yV9_PQ3A4C9BhJwyiB2wFs+KJ-9Sk+daY8ipQ@mail.gmail.com>
 <CAHqX795pjO7gMucUG2vHNAanvQ2DdFA+re9HN9aMgc=jsw8fsw@mail.gmail.com>
 <CAHqX796U46N+S9o0GWtK=0hPAoS7gJ5_HjWYMn4owbQuNcn7oQ@mail.gmail.com>
 <1987619.y9MCUktVRS@even-i700>
Message-ID: <e4e7e572-5de8-1f8b-f301-c809fdd4ff38@gmail.com>



On 06/22/2018 02:51 PM, Even Rouault wrote:
> On vendredi 22 juin 2018 14:38:15 CEST James Klassen wrote:
>> I finally got around to doing a rough implementation of parsing ESRIJSON
>> with curved geometries.  The code is very rough yet, but works enough to
>> import a polygon layer from an ESRI FeatureService into PostGIS with the
>> curves intact.  Code is available at [1].
>>
>> Main issues:
>>
>> I don't know how to detect if there will be curves in the source file
>> without first parsing the whole file, so currently I just assume a curved
>> geometry type.  This might be a candidate for an open option.
> The ESRI Json reader ingests everything in memory and builds the JSon tree 
> structure, so doing an initial pass by default shouldn't be a big deal.

This would still be an issue with paging.  Most of the actual datasets
of interest (to me) involve multiple HTTP requests to fetch many pages
of JSON data (usually 1000 - 10000 features at a time depending on
server setup).  The curves may easily not be on the first page and
re-running the whole request is expensive.

>> My focus has been on polygon layers (because that's the dataset I need to
>> read).  I doubt it works outside of polygon layers at the moment.
>>
>> I had to enable the "Curve Geometries" capability in the top level GeoJSON
>> driver (which may break some things for the GeoJSON/TopoJSON drivers).
> If my memories are right, you only need to set it for write support. So 
> shouldn't be needed there.
>

All I know is that without it set, the curved geometries were linearized
somewhere in OGR before they were passed to the PostGIS driver.


From even.rouault at spatialys.com  Mon Jun 25 14:14:17 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Jun 2018 23:14:17 +0200
Subject: [gdal-dev] Esri JSON Curves
In-Reply-To: <e4e7e572-5de8-1f8b-f301-c809fdd4ff38@gmail.com>
References: <CAHqX796fb24M9yV9_PQ3A4C9BhJwyiB2wFs+KJ-9Sk+daY8ipQ@mail.gmail.com>
 <1987619.y9MCUktVRS@even-i700>
 <e4e7e572-5de8-1f8b-f301-c809fdd4ff38@gmail.com>
Message-ID: <3910957.a1sd9sZLSe@even-i700>

> This would still be an issue with paging.  Most of the actual datasets
> of interest (to me) involve multiple HTTP requests to fetch many pages
> of JSON data (usually 1000 - 10000 features at a time depending on
> server setup).  The curves may easily not be on the first page and
> re-running the whole request is expensive.

Fair enough

> > If my memories are right, you only need to set it for write support. So
> > shouldn't be needed there.
> 
> All I know is that without it set, the curved geometries were linearized
> somewhere in OGR before they were passed to the PostGIS driver.

You should double check and spot where this comes from.
You can set a breakpoint on OGRGeometryFactory::curveToLineString which should 
be taken when linearization occurs.

As an experience, I've disabled OLCCurveGeometries and ODsCCurveGeometries 
capability declaration in the CSV driver, and no linearization occurs when 
converting to PostGIS

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From ireese at linz.govt.nz  Mon Jun 25 15:06:38 2018
From: ireese at linz.govt.nz (Ian Reese)
Date: Mon, 25 Jun 2018 22:06:38 +0000
Subject: [gdal-dev] Kriging Interpolation
In-Reply-To: <3242517.1dcHupMW18@even-i700>
References: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
 <3242517.1dcHupMW18@even-i700>
Message-ID: <CE106C36F836424AB340432214B378BA2F3333E9@prdassexch01.ad.linz.govt.nz>

Hi All,

Thank you so much everyone for your replies.  I should be clear, speed is important to our processes, but most important in my work is the visual outcome.  Kriging by far produces the best results for this. No amount of tweaking IDW or any other method in GDAL produces the same results. Kriging works best with scattered data and produces the nicest results across nodata locations.  I have plenty of methods for working around speed issues and have worked with any number of interpolations methods in GRASS, SAGA and Python. What I don't have is a Kriging interpolation in gdal_grid. I love using gdal for its ease, speed, and efficiency. I am merely asking if it is possible incorporate kriging interpolation into gdal_grid, is there interest in the wider community to do so, and what would it take to help make that happen.

It is my fault that I was not clear about the examples I provided.  I offered the most stripped down examples, but was not interested in the speed of the returns. I am more interested in the comparisons between the visual outcomes of the outputs.

Thanks again for all the responses.

Cheers,

Ian

-----Original Message-----
From: Even Rouault [mailto:even.rouault at spatialys.com]
Sent: Tuesday, 26 June 2018 12:21 a.m.
To: gdal-dev at lists.osgeo.org
Cc: Ian Reese; Jeremy Palmer
Subject: Re: [gdal-dev] Kriging Interpolation

Ian,

Looking at your script, for the IDW, I see you don't use the max_points, nor
the radius1 and radius2 to limit the neighbourhoud into which the points are
searched.

For the linear search, I've profiled the run and found that an enormous amout
of time was spent processing the points outside of the triangulation.
Investigating, I found there was a missed optimization that I've added per
https://github.com/OSGeo/gdal/commit/134b9c4e437e347aac48c459a18a933ed526be5b

With that optimization, the runtime with 8 threads is 16 sec, vs 48 sec before
(on a non-optimized debug build)
And if you don't want the nearest neighbour search for points outside of the
triangulation, you can also add :radius=0.0, and this will speed up things
again. Down to 2 sec.

Regarding Kriging, I guess you specified some neighbourood value in ArcGIS ?
Otherwise as mentionned by Thomas, Knudsen, the computation time and memory
requirements would be enormous (between O(n^2) and O(n^3) where n is the
number of points).
I gave a try to https://github.com/bsmurphy/PyKrige and used Ordinary Kriging.
For the above reasons, it blows up with a MemoryError on the full layer. I
also found that the extent of the output grid had also a strong influence on
the memory requirements. Which is less expected, perhaps a side effect of that
particular implementation.
Anyway, if arbitrarily restricting to the first 1000 points of your layer
(which is roughly a strip in the middle of the dataset) and to their extent
(producing a 1321x45 raster with 1m resolution), it gives a result (2 minutes
single-threaded, 1.8 GB RAM), which looks consistent with the one from ArcGIS.
This is not exactly the same due to a non-moving neighbouroud having been used
due to my simplified methodology, but for the 'inner' of the computed raster,
this is quite similar.
So for Kriging, a moving window approach limiting the number of input points
would be absolutely needed for "large" point datasets, and the processing time
would still be significantly slower than linear interpolation.

Even


> Hi Gdal,
>
> I'd like to know if it is possible to make Kriging Interpolation part of
> gdal_grid.  We work with a good deal of scattered point elevation data and
> neither IDW or Linear interpolations(smooth or not smooth)  produce the
> desired visual results.  Nor are they fast enough for the density of data
> we commonly work with. Linear interpolation is a reliable and fast method,
> however the triangulated results are difficult to work with visually.
>
> For some visual comparisons and reference, here is a link to a folder of
> sample points(shp) for a test area, two examples of kriged data for that
> test region, and a BASH script to reproduce IDW and Linear interpolations
> of the same region.
>
> https://drive.google.com/open?id=1HKbK4wMmVN6JZSvhxBQDub1WXBLE710H
>
> Here is an example of the Kriging method used by ArcGIS:
> http://desktop.arcgis.com/en/arcmap/latest/extensions/geostatistical-analyst
> /kriging-in-geostatistical-analyst.htm
>
> Few graphs explaining best interpolation methods to use with given data.
> Gridded vs. scattered.
> https://www.neonscience.org/spatial-interpolation-basics
>
> If it is possible, we are curious to know what type of funding would be
> needed.
>
> Cheers,
>
> Ian
>
> ________________________________
>
> This message contains information, which may be in confidence and may be
> subject to legal privilege. If you are not the intended recipient, you must
> not peruse, use, disseminate, distribute or copy this message. If you have
> received this message in error, please notify us immediately (Phone 0800
> 665 463 or info at linz.govt.nz) and destroy the original message. LINZ
> accepts no responsibility for changes to this email, or for any
> attachments, after its transmission from LINZ. Thank You.


--
Spatialys - Geospatial professional services
http://www.spatialys.com

________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.

From jluis at ualg.pt  Mon Jun 25 15:58:37 2018
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Mon, 25 Jun 2018 22:58:37 +0000
Subject: [gdal-dev] Kriging Interpolation
In-Reply-To: <CE106C36F836424AB340432214B378BA2F3333E9@prdassexch01.ad.linz.govt.nz>
References: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
 <3242517.1dcHupMW18@even-i700>
 <CE106C36F836424AB340432214B378BA2F3333E9@prdassexch01.ad.linz.govt.nz>
Message-ID: <DB5PR0401MB18004EAB47EC77EB923B8B24A64A0@DB5PR0401MB1800.eurprd04.prod.outlook.com>



I have plenty of methods for working around speed issues and have
|>worked with any number of interpolations methods in GRASS, SAGA and
|>Python.


You have also the minimum curvature in GMT. Not lightning fast but quicker than krigging and normally better looking, specially on the extrapolation zones.

Joaquim

 

From ireese at linz.govt.nz  Mon Jun 25 16:16:17 2018
From: ireese at linz.govt.nz (Ian Reese)
Date: Mon, 25 Jun 2018 23:16:17 +0000
Subject: [gdal-dev] Kriging Interpolation
In-Reply-To: <DB5PR0401MB18004EAB47EC77EB923B8B24A64A0@DB5PR0401MB1800.eurprd04.prod.outlook.com>
References: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>
 <3242517.1dcHupMW18@even-i700>
 <CE106C36F836424AB340432214B378BA2F3333E9@prdassexch01.ad.linz.govt.nz>,
 <DB5PR0401MB18004EAB47EC77EB923B8B24A64A0@DB5PR0401MB1800.eurprd04.prod.outlook.com>
Message-ID: <CE106C36F836424AB340432214B378BA2F33347A@prdassexch01.ad.linz.govt.nz>

Cheer Joakim!  That I am not familiar with and will have a look
________________________________________
From: Joaquim Manuel Freire Luís [jluis at ualg.pt]
Sent: Tuesday, 26 June 2018 10:58 a.m.
To: Ian Reese; Even Rouault; gdal-dev at lists.osgeo.org
Cc: Jeremy Palmer
Subject: RE: [gdal-dev] Kriging Interpolation

I have plenty of methods for working around speed issues and have
|>worked with any number of interpolations methods in GRASS, SAGA and
|>Python.


You have also the minimum curvature in GMT. Not lightning fast but quicker than krigging and normally better looking, specially on the extrapolation zones.

Joaquim



________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.

From ireese at linz.govt.nz  Mon Jun 25 17:26:51 2018
From: ireese at linz.govt.nz (Ian Reese)
Date: Tue, 26 Jun 2018 00:26:51 +0000
Subject: [gdal-dev] Kriging Interpolation
In-Reply-To: <3242517.1dcHupMW18@even-i700>
References: <CE106C36F836424AB340432214B378BA2F3332FA@prdassexch01.ad.linz.govt.nz>,
 <3242517.1dcHupMW18@even-i700>
Message-ID: <CE106C36F836424AB340432214B378BA2F3334DB@prdassexch01.ad.linz.govt.nz>

Hi Evan,

I probably wasn't clear in my response to you.  I did try optimizing IDW  using max points and various radii.  The results were mixed, but overall by using radius and max points, the process is slowed considerably.  If it is helpful, I can give you some time differences when I get back to testing.  Usually I can work around speed issues by reducing the area I am interpolating, but there does reach a point where the area is too small for interpolating and artifacts near the edges become an issue for visualization.

As far as kriging goes, for testing and using the exact same dataset, I used the default settings in Arc.  So:

Kriging Method: Ordinary
SemiVariogram: Spherical
Search Radius: Variable
Number of Points: 12

For test examples, I tired to keep things as simple as possible since the more complex solutions were providing similar visual result as the basic examples.

I really appreciate you looking into the processes I provided.  I plan to upgrade my Gdal in few days too.  You suggested in a previous thread that doing so should solve some of the speed issues.  I let you know how it turned out.

Thanks again,

Ian
________________________________________
From: Even Rouault [even.rouault at spatialys.com]
Sent: Tuesday, 26 June 2018 12:21 a.m.
To: gdal-dev at lists.osgeo.org
Cc: Ian Reese; Jeremy Palmer
Subject: Re: [gdal-dev] Kriging Interpolation

Ian,

Looking at your script, for the IDW, I see you don't use the max_points, nor
the radius1 and radius2 to limit the neighbourhoud into which the points are
searched.

For the linear search, I've profiled the run and found that an enormous amout
of time was spent processing the points outside of the triangulation.
Investigating, I found there was a missed optimization that I've added per
https://github.com/OSGeo/gdal/commit/134b9c4e437e347aac48c459a18a933ed526be5b

With that optimization, the runtime with 8 threads is 16 sec, vs 48 sec before
(on a non-optimized debug build)
And if you don't want the nearest neighbour search for points outside of the
triangulation, you can also add :radius=0.0, and this will speed up things
again. Down to 2 sec.

Regarding Kriging, I guess you specified some neighbourood value in ArcGIS ?
Otherwise as mentionned by Thomas, Knudsen, the computation time and memory
requirements would be enormous (between O(n^2) and O(n^3) where n is the
number of points).
I gave a try to https://github.com/bsmurphy/PyKrige and used Ordinary Kriging.
For the above reasons, it blows up with a MemoryError on the full layer. I
also found that the extent of the output grid had also a strong influence on
the memory requirements. Which is less expected, perhaps a side effect of that
particular implementation.
Anyway, if arbitrarily restricting to the first 1000 points of your layer
(which is roughly a strip in the middle of the dataset) and to their extent
(producing a 1321x45 raster with 1m resolution), it gives a result (2 minutes
single-threaded, 1.8 GB RAM), which looks consistent with the one from ArcGIS.
This is not exactly the same due to a non-moving neighbouroud having been used
due to my simplified methodology, but for the 'inner' of the computed raster,
this is quite similar.
So for Kriging, a moving window approach limiting the number of input points
would be absolutely needed for "large" point datasets, and the processing time
would still be significantly slower than linear interpolation.

Even


> Hi Gdal,
>
> I'd like to know if it is possible to make Kriging Interpolation part of
> gdal_grid.  We work with a good deal of scattered point elevation data and
> neither IDW or Linear interpolations(smooth or not smooth)  produce the
> desired visual results.  Nor are they fast enough for the density of data
> we commonly work with. Linear interpolation is a reliable and fast method,
> however the triangulated results are difficult to work with visually.
>
> For some visual comparisons and reference, here is a link to a folder of
> sample points(shp) for a test area, two examples of kriged data for that
> test region, and a BASH script to reproduce IDW and Linear interpolations
> of the same region.
>
> https://drive.google.com/open?id=1HKbK4wMmVN6JZSvhxBQDub1WXBLE710H
>
> Here is an example of the Kriging method used by ArcGIS:
> http://desktop.arcgis.com/en/arcmap/latest/extensions/geostatistical-analyst
> /kriging-in-geostatistical-analyst.htm
>
> Few graphs explaining best interpolation methods to use with given data.
> Gridded vs. scattered.
> https://www.neonscience.org/spatial-interpolation-basics
>
> If it is possible, we are curious to know what type of funding would be
> needed.
>
> Cheers,
>
> Ian
>
> ________________________________
>
> This message contains information, which may be in confidence and may be
> subject to legal privilege. If you are not the intended recipient, you must
> not peruse, use, disseminate, distribute or copy this message. If you have
> received this message in error, please notify us immediately (Phone 0800
> 665 463 or info at linz.govt.nz) and destroy the original message. LINZ
> accepts no responsibility for changes to this email, or for any
> attachments, after its transmission from LINZ. Thank You.


--
Spatialys - Geospatial professional services
http://www.spatialys.com

________________________________

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.

From laasunde at hotmail.com  Mon Jun 25 23:52:41 2018
From: laasunde at hotmail.com (Lars)
Date: Tue, 26 Jun 2018 06:52:41 +0000
Subject: [gdal-dev] ogr2ogr adding metadata
In-Reply-To: <2558914.Q1IQ8xsQXi@even-i700>
References: <HE1PR03MB1338AB823DC751EBA41D8F14CA750@HE1PR03MB1338.eurprd03.prod.outlook.com>,
 <2558914.Q1IQ8xsQXi@even-i700>
Message-ID: <HE1PR03MB133855B909319FC33419F094CA490@HE1PR03MB1338.eurprd03.prod.outlook.com>

Even,

Appreciate the response.

Your example is interesting but there are a couple of issues. Importing a random .000 file using ogr2ogr yields 6 tables in the database. Which tables are created depend on the data and are unknown to me prior to import, so it is difficult to generate the SQL in advance. This approach does not scale very well if data yields a number of tables.

Another issue was when adding the SQL statement for one specific table caused the import to ignore the other 5 tables. Is this the expect result or should all 6 table be imported?

Regards, Lars

________________________________
Fra: Even Rouault <even.rouault at spatialys.com>
Sendt: fredag 22. juni 2018 23.15
Til: gdal-dev at lists.osgeo.org
Kopi: Lars
Emne: Re: [gdal-dev] ogr2ogr adding metadata

On vendredi 22 juin 2018 09:41:02 CEST Lars wrote:
> Hello folks,
>
> Using ogr2ogr (version 2.2.3) to import s57 into PostgreSQL which works
> great.
>
> What is the recommended approach for adding metadata to all inserted data?
>
> Say I wanted to add current date to all inserted data. Does ogr2ogr support
> such operation? Tried using the "-mo" argument but it did not make any
> inpact (same result with argument as without). Ideally I do not want the
> client to be adding this information as a post insert operation (if even
> possible).

Lars,

-mo will work only with very few target drivers (I can only think to
GeoPackage actually). This is per-layer/per-table metadata. There's perhaps
the equivalent in PostgreSQL but this isn't implemented by GDAL

But you can add a column with the current timestamp for example with

ogr2ogr -update PG:xxxxxx poly.shp \
       -sql "SELECT *, CURRENT_TIMESTAMP FROM poly" -dialect SQLITE

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180626/a24cd9dd/attachment.html>

From kalev.julge at reach-u.com  Tue Jun 26 03:53:26 2018
From: kalev.julge at reach-u.com (Kalev Julge)
Date: Tue, 26 Jun 2018 10:53:26 +0000
Subject: [gdal-dev] [EXTERNAL]  Convert VRT+JPEG with gdalwarp
In-Reply-To: <4494603.IyRUZ1V78Z@even-i700>
References: <1529589603275-0.post@n6.nabble.com>
 <CALQGVr15naoJ8grAdAKS6c8-zO4WZFpLgfhsXHDriLdStXFf9w@mail.gmail.com>
 <VI1PR08MB31993C629C11B440C24D7785BA4A0@VI1PR08MB3199.eurprd08.prod.outlook.com>
 <4494603.IyRUZ1V78Z@even-i700>
Message-ID: <VI1PR08MB31990F4E69538D396414DB86BA490@VI1PR08MB3199.eurprd08.prod.outlook.com>

Hi Even,

"After your gdalwarp to VRT, do: gdal_translate new.vrt new.jpg -of JPEG"
This suggestion worked well. Thanks!

I have one more issue. I would like to mask off (or make transparent) areas with no data. Originally, I had PNG files that I used as a mask. However, with gdalwarp the dimensions of the image changed slightly, so these PNG masks cannot be used anymore.

So far I've used the following commands:
" //Add reprojection info to VRT
for %N in (C:\....\*.vrt) DO gdalwarp -s_srs "EPSG:2006" -t_srs "EPSG:3857" -of "VRT" -r "bilinear" %N C:\....\out\reprojected_%~nN.vrt
//Reproject JPEG
for %N in (C:\....\out\*.vrt) DO gdal_translate -of "JPEG" %N C:\....\out\%~nN.jpg
//Make new VRT
for %N in (C:\....\out\*.jpg) DO gdal_translate -of "VRT" %N C:\....\out\%~nN.vrt"

I've uploaded an example of the original VRT+JPEG+PNG mask and reprojected VRT+JPEG here:
https://drive.google.com/file/d/1g_Iw6HkY3NSUk7LjzDSPzPjBhtGjbiAW/view?usp=sharing

Any help on how to mask off the areas?
Thanks!

Kalev


-----Original Message-----
From: Even Rouault <even.rouault at spatialys.com> 
Sent: Monday, June 25, 2018 4:30 PM
To: gdal-dev at lists.osgeo.org
Cc: Kalev Julge <kalev.julge at reach-u.com>; Doug Newcomb <doug_newcomb at fws.gov>
Subject: Re: [gdal-dev] [EXTERNAL] Convert VRT+JPEG with gdalwarp

On lundi 25 juin 2018 13:10:16 CEST Kalev Julge wrote:
> Hi Doug,
> 
> Thanks for the info. I know that JPEG is lossy but our datasets are 
> very large. That’s why we use JPEG, which is good enough for our needs 
> and the file sizes are smaller.

After your gdalwarp to VRT, do:
gdal_translate new.vrt new.jpg -of JPEG

You cannot directly wrap to JPEG, because of the driver limitation See https://trac.osgeo.org/gdal/wiki/FAQRaster#Whywontgdalwarporgdal_mergewritetomostformats
 
> It seems that GDAL doesn’t create new JPEG files without having 
> pre-existing JPEG-s to modify.

Actually, that's right the opposite :-)

> If I try to modify old JPEG, I get a message “Output dataset exists, 
> but cannot be opened in update mode.

That means you cannot modify an existing JPEG. You have to recreate a completely new file.
 
> I also tried using “CreateCopy” but that produced syntax error. Used 
> command on GDAL CMD:
 “GDALDriver::CreateCopy ("new.jpg","old.jpg", FALSE, NULL,
> NULL, NULL)” 

The second argument must be a GDALDataset* object, not a string, so do something like

GDALDataset* srcDS = reinterpret_cast<GDALDataset*>(
   GDALOpen("old.jpg", GA_ReadOnly));
GDALDataset* outDS = jpegDriver->CreateCopy(
    "new.jpg", srcDS, FALSE, NULL, NULL, NULL); GDALClose(outDS); GDALClose(srcDS);

Even

--
Spatialys - Geospatial professional services http://www.spatialys.com

From osahon.gis at gmail.com  Tue Jun 26 04:39:05 2018
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Tue, 26 Jun 2018 12:39:05 +0100
Subject: [gdal-dev] [gdal-announce] GDAL Support For PostGIS Out-DB
	Raster
In-Reply-To: <CAGpiUSgkHbu5fwabpnQDq8qwgFMqra-gmu=N9jski42L8VW9fg@mail.gmail.com>
References: <CAGpiUSiyAhwxvp=H0GDh6hiPtThJBgiR8btG1_LuG63UvTFcYQ@mail.gmail.com>
 <8130283.T08iD0Capr@even-i700>
 <CAGpiUShnhLxyCGQjt=Ne_JY9Ob9Uw4Y=KS4UfwSyNWfEjHGojA@mail.gmail.com>
 <1855723.gNRdBu3k1j@even-i700>
 <CAGpiUSgkHbu5fwabpnQDq8qwgFMqra-gmu=N9jski42L8VW9fg@mail.gmail.com>
Message-ID: <CAGpiUShcBR+yhLO74mk3mcYjzwzxOs+ynSwo9WH3OVccTxagvQ@mail.gmail.com>

Hi Even,

I was trying to build GDAL 2.3.1 from source into PostgreSQL 9.6.9 that was
built successfully from source, but I am getting an error when running
"make -j8" (see attachment)

I ran "./configure" successfully with this statement:
./configure --prefix=/home/nagispg/local/gdal213
--with-pg=/home/nagispg/local/pgsql/bin/pg_config
--with-mrsid=/home/nagispg/local/src/MrSID_DSDK-9.5.4.4703-rhel6.x86-64.gcc531/Raster_DSDK

Then I try to run "Make -j8" and I get an error extracted below (see
attachment for more detailed error):
/bin/ld: warning: libpq.so.5, needed by
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so, not found (try using
-rpath or -rpath-link)
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`lo_open'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQputCopyEnd'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQresultErrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQstatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQsetNoticeProcessor'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQnfields'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQgetvalue'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQclear'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQgetlength'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQfmod'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQftablecol'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQconnectdb'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQcmdStatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQftable'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQntuples'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQexecParams'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQfname'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQfinish'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`lo_close'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQerrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`lo_read'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQputCopyData'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`lo_write'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQgetResult'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQgetisnull'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQescapeStringConn'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQexec'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`lo_creat'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQsetClientEncoding'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQftype'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to
`PQresultStatus'
collect2: error: ld returned 1 exit status
make[1]: *** [gdalserver] Error 1

Please, could you point me to the likely cause of this error. I look
forward to hearing from you.


On Mon, Jun 25, 2018 at 12:43 PM, Osahon Oduware <osahon.gis at gmail.com>
wrote:

> Hi Even,
>
> Thanks a lot. This is great news! I will start investigating the fix for
> Out-DB rasters. I will keep you posted. Great work!
>
> On Mon, Jun 25, 2018 at 10:26 AM, Even Rouault <even.rouault at spatialys.com
> > wrote:
>
>> On lundi 25 juin 2018 10:18:22 CEST Osahon Oduware wrote:
>> > Hi Even,
>> >
>> > I want to find out if this GDAL fix will be release by the end of June.
>> I
>> > use PostGIS version 2.3.2 at present and I will be building from source.
>>
>> Yes, this is in the release notes of the release candidate of GDAL 2.3.1
>> that
>> was published last Friday:
>> https://trac.osgeo.org/gdal/wiki/Release/2.3.1-News
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180626/6e5dbe91/attachment-0001.html>
-------------- next part --------------

/bin/ld: warning: libpq.so.5, needed by /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so, not found (try using -rpath or -rpath-link)
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_open'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQputCopyEnd'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQresultErrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQstatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQsetNoticeProcessor'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQnfields'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetvalue'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQclear'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetlength'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfmod'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftablecol'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQconnectdb'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQcmdStatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftable'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQntuples'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQexecParams'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfname'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfinish'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_close'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQerrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_read'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQputCopyData'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_write'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetResult'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetisnull'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQescapeStringConn'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQexec'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_creat'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQsetClientEncoding'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftype'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQresultStatus'
collect2: error: ld returned 1 exit status
make[1]: *** [gdalserver] Error 1
/bin/ld: warning: libpq.so.5, needed by /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so, not found (try using -rpath or -rpath-link)
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_open'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQputCopyEnd'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQresultErrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQstatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQsetNoticeProcessor'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQnfields'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetvalue'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQclear'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetlength'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfmod'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftablecol'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQconnectdb'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQcmdStatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftable'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQntuples'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQexecParams'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfname'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfinish'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_close'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQerrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_read'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQputCopyData'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_write'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetResult'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetisnull'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQescapeStringConn'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQexec'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_creat'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQsetClientEncoding'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftype'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQresultStatus'
collect2: error: ld returned 1 exit status
make[1]: *** [gdal_translate] Error 1
/bin/ld: warning: libpq.so.5, needed by /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so, not found (try using -rpath or -rpath-link)
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_open'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQputCopyEnd'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQresultErrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQstatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQsetNoticeProcessor'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQnfields'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetvalue'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQclear'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetlength'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfmod'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftablecol'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQconnectdb'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQcmdStatus'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftable'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQntuples'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQexecParams'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfname'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQfinish'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_close'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQerrorMessage'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_read'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQputCopyData'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_write'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetResult'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQgetisnull'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQescapeStringConn'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQexec'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `lo_creat'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQsetClientEncoding'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQftype'
/home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference to `PQresultStatus'
collect2: error: ld returned 1 exit status
make[1]: *** [gdaladdo] Error 1
make[1]: Leaving directory `/home/nagispg/local/src/gdal-2.3.1/apps'
make: *** [apps-target] Error 2


From idan at miara.com  Tue Jun 26 06:52:15 2018
From: idan at miara.com (Idan Miara)
Date: Tue, 26 Jun 2018 16:52:15 +0300
Subject: [gdal-dev] "fixing" CRS for a read-only raster
Message-ID: <CAEDrt3_XR9TnEQZcg_iJDNHHJD7-HqPZnLLiLMPePVCD4xj1hw@mail.gmail.com>

Hi,

I have an ECW raster with a wrong CRS (which I believe can't change because
I don't have the ECW writer license).
Is there an option to add an aux/prj file next to it so that GDAL will read
the correct CRS from the aux file instead of from the ECW file ( i.e. from
GeoServer/QGIS) ?
I know I can workaround it with a VRT file but I think it might degrade the
performance.

Kind Regards,
Idan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180626/c76ac60e/attachment.html>

From even.rouault at spatialys.com  Tue Jun 26 06:58:28 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 26 Jun 2018 15:58:28 +0200
Subject: [gdal-dev] "fixing" CRS for a read-only raster
In-Reply-To: <CAEDrt3_XR9TnEQZcg_iJDNHHJD7-HqPZnLLiLMPePVCD4xj1hw@mail.gmail.com>
References: <CAEDrt3_XR9TnEQZcg_iJDNHHJD7-HqPZnLLiLMPePVCD4xj1hw@mail.gmail.com>
Message-ID: <510015164.jBSC8cr35B@even-i700>

Idan,

> 
> I have an ECW raster with a wrong CRS (which I believe can't change because
> I don't have the ECW writer license).

Changes in the header don't require a write license

So gdal_edit.py -a_srs EPSG:xxxx your.ecw

should work and modify in place the ECW

Otherwise you can add the -ro flag to the above, and it will generate a 
.ecw.aux.xml file with the overriden projection info.

> Is there an option to add an aux/prj file next to it so that GDAL will read
> the correct CRS from the aux file instead of from the ECW file ( i.e. from
> GeoServer/QGIS) ?
> I know I can workaround it with a VRT file but I think it might degrade the
> performance.

For "simple VRT" generated with "gdal_translate your.ecw your.vrt -a_srs 
EPSG:xxxx -of VRT", the VRT driver has optimizations to directly forward pixel 
requests to the underlying driver with minimal overhead.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From dmorissette at mapgears.com  Tue Jun 26 11:41:49 2018
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Tue, 26 Jun 2018 14:41:49 -0400
Subject: [gdal-dev] Motion: Promote GDAL 2.3.1 rc2 for release
In-Reply-To: <1989773.0pK2AJ4sWq@even-i700>
References: <1989773.0pK2AJ4sWq@even-i700>
Message-ID: <2aaf44db-f0ab-f92a-dd90-f4194f0fe7a3@mapgears.com>

+1

Daniel

On 2018-06-25 9:18 AM, Even Rouault wrote:
> Hi,
> 
> Motion: GDAL/OGR 2.3.1 rc2 is promoted to be the official 2.3.1 final release.
> 
> -------
> 
> My vote: +1
> 
> Even
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From osahon.gis at gmail.com  Tue Jun 26 14:06:38 2018
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Tue, 26 Jun 2018 22:06:38 +0100
Subject: [gdal-dev] [gdal-announce] GDAL Support For PostGIS Out-DB
	Raster
In-Reply-To: <CAGpiUShcBR+yhLO74mk3mcYjzwzxOs+ynSwo9WH3OVccTxagvQ@mail.gmail.com>
References: <CAGpiUSiyAhwxvp=H0GDh6hiPtThJBgiR8btG1_LuG63UvTFcYQ@mail.gmail.com>
 <8130283.T08iD0Capr@even-i700>
 <CAGpiUShnhLxyCGQjt=Ne_JY9Ob9Uw4Y=KS4UfwSyNWfEjHGojA@mail.gmail.com>
 <1855723.gNRdBu3k1j@even-i700>
 <CAGpiUSgkHbu5fwabpnQDq8qwgFMqra-gmu=N9jski42L8VW9fg@mail.gmail.com>
 <CAGpiUShcBR+yhLO74mk3mcYjzwzxOs+ynSwo9WH3OVccTxagvQ@mail.gmail.com>
Message-ID: <CAGpiUSj5ihKX4VxC2GaHPKskkRMKy5BFWhF4LpPM5T3zBCaCYQ@mail.gmail.com>

Hi All,

Can anyone help with the error in my previous mail?

On Jun 26, 2018 12:39 PM, "Osahon Oduware" <osahon.gis at gmail.com> wrote:

> Hi Even,
>
> I was trying to build GDAL 2.3.1 from source into PostgreSQL 9.6.9 that
> was built successfully from source, but I am getting an error when running
> "make -j8" (see attachment)
>
> I ran "./configure" successfully with this statement:
> ./configure --prefix=/home/nagispg/local/gdal213
> --with-pg=/home/nagispg/local/pgsql/bin/pg_config
> --with-mrsid=/home/nagispg/local/src/MrSID_DSDK-9.5.4.
> 4703-rhel6.x86-64.gcc531/Raster_DSDK
>
> Then I try to run "Make -j8" and I get an error extracted below (see
> attachment for more detailed error):
> /bin/ld: warning: libpq.so.5, needed by /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so,
> not found (try using -rpath or -rpath-link)
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `lo_open'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQputCopyEnd'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQresultErrorMessage'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQstatus'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQsetNoticeProcessor'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQnfields'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQgetvalue'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQclear'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQgetlength'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQfmod'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQftablecol'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQconnectdb'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQcmdStatus'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQftable'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQntuples'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQexecParams'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQfname'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQfinish'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `lo_close'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQerrorMessage'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `lo_read'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQputCopyData'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `lo_write'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQgetResult'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQgetisnull'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQescapeStringConn'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQexec'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `lo_creat'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQsetClientEncoding'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQftype'
> /home/nagispg/local/src/gdal-2.3.1/.libs/libgdal.so: undefined reference
> to `PQresultStatus'
> collect2: error: ld returned 1 exit status
> make[1]: *** [gdalserver] Error 1
>
> Please, could you point me to the likely cause of this error. I look
> forward to hearing from you.
>
>
> On Mon, Jun 25, 2018 at 12:43 PM, Osahon Oduware <osahon.gis at gmail.com>
> wrote:
>
>> Hi Even,
>>
>> Thanks a lot. This is great news! I will start investigating the fix for
>> Out-DB rasters. I will keep you posted. Great work!
>>
>> On Mon, Jun 25, 2018 at 10:26 AM, Even Rouault <
>> even.rouault at spatialys.com> wrote:
>>
>>> On lundi 25 juin 2018 10:18:22 CEST Osahon Oduware wrote:
>>> > Hi Even,
>>> >
>>> > I want to find out if this GDAL fix will be release by the end of
>>> June. I
>>> > use PostGIS version 2.3.2 at present and I will be building from
>>> source.
>>>
>>> Yes, this is in the release notes of the release candidate of GDAL 2.3.1
>>> that
>>> was published last Friday:
>>> https://trac.osgeo.org/gdal/wiki/Release/2.3.1-News
>>>
>>> --
>>> Spatialys - Geospatial professional services
>>> http://www.spatialys.com
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180626/b206669f/attachment.html>

From ao at t-kartor.se  Wed Jun 27 00:16:44 2018
From: ao at t-kartor.se (Andreas Oxenstierna)
Date: Wed, 27 Jun 2018 09:16:44 +0200
Subject: [gdal-dev] ogr2ogr adding metadata
In-Reply-To: <HE1PR03MB133855B909319FC33419F094CA490@HE1PR03MB1338.eurprd03.prod.outlook.com>
References: <HE1PR03MB1338AB823DC751EBA41D8F14CA750@HE1PR03MB1338.eurprd03.prod.outlook.com>
 <2558914.Q1IQ8xsQXi@even-i700>
 <HE1PR03MB133855B909319FC33419F094CA490@HE1PR03MB1338.eurprd03.prod.outlook.com>
Message-ID: <5B3339DC.6080807@t-kartor.se>

A S57 file with only 6 feature object classes? Normally there should be 
many more.

I would add triggers to each table in the database for timestamps.
Potential workflow:
1 ogr for initial import into own schema
2 Postgre script, reading all tables in the schema using the 
information_schema info, to truncate and add triggers
3 ogr for final import


> Even,
>
> Appreciate the response.
>
> Your example is interesting but there are a couple of issues. 
> Importing a random .000 file using ogr2ogr yields 6 tables in the 
> database. Which tables are created depend on the data and are unknown 
> to me prior to import, so it is difficult to generate the SQL in 
> advance. This approach does not scale very well if data yields a 
> number of tables.
>
> Another issue was when adding the SQL statement for one specific table 
> caused the import to ignore the other 5 tables. Is this the expect 
> result or should all 6 table be imported?
>
> Regards, Lars
>
> ------------------------------------------------------------------------
> *Fra:* Even Rouault <even.rouault at spatialys.com>
> *Sendt:* fredag 22. juni 2018 23.15
> *Til:* gdal-dev at lists.osgeo.org
> *Kopi:* Lars
> *Emne:* Re: [gdal-dev] ogr2ogr adding metadata
> On vendredi 22 juin 2018 09:41:02 CEST Lars wrote:
> > Hello folks,
> >
> > Using ogr2ogr (version 2.2.3) to import s57 into PostgreSQL which works
> > great.
> >
> > What is the recommended approach for adding metadata to all inserted 
> data?
> >
> > Say I wanted to add current date to all inserted data. Does ogr2ogr 
> support
> > such operation? Tried using the "-mo" argument but it did not make any
> > inpact (same result with argument as without). Ideally I do not want the
> > client to be adding this information as a post insert operation (if even
> > possible).
>
> Lars,
>
> -mo will work only with very few target drivers (I can only think to
> GeoPackage actually). This is per-layer/per-table metadata. There's 
> perhaps
> the equivalent in PostgreSQL but this isn't implemented by GDAL
>
> But you can add a column with the current timestamp for example with
>
> ogr2ogr -update PG:xxxxxx poly.shp \
>        -sql "SELECT *, CURRENT_TIMESTAMP FROM poly" -dialect SQLITE
>
> Even
>
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Hälsningar

Andreas Oxenstierna
T-Kartor Geospatial AB
mobile: +46 733 206831
mailto: ao at t-kartor.se
http://www.t-kartor.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180627/0b725aea/attachment.html>

From howard at hobu.co  Wed Jun 27 05:41:22 2018
From: howard at hobu.co (Howard Butler)
Date: Wed, 27 Jun 2018 07:41:22 -0500
Subject: [gdal-dev] Motion: Promote GDAL 2.3.1 rc2 for release
In-Reply-To: <2aaf44db-f0ab-f92a-dd90-f4194f0fe7a3@mapgears.com>
References: <1989773.0pK2AJ4sWq@even-i700>
 <2aaf44db-f0ab-f92a-dd90-f4194f0fe7a3@mapgears.com>
Message-ID: <F7C693CF-D921-4A87-B667-C728657F76C8@hobu.co>

+1

Howard

> On Jun 26, 2018, at 1:41 PM, Daniel Morissette <dmorissette at mapgears.com> wrote:
> 
> +1
> 
> Daniel
> 
>> On 2018-06-25 9:18 AM, Even Rouault wrote:
>> Hi,
>> Motion: GDAL/OGR 2.3.1 rc2 is promoted to be the official 2.3.1 final release.
>> -------
>> My vote: +1
>> Even
> 
> 
> -- 
> Daniel Morissette
> Mapgears Inc
> T: +1 418-696-5056 #201
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From homme at fatmap.com  Wed Jun 27 05:55:33 2018
From: homme at fatmap.com (Homme Zwaagstra)
Date: Wed, 27 Jun 2018 12:55:33 +0000
Subject: [gdal-dev] Specifying NODATA values for the TMS (mini)driver
Message-ID: <CWLP265MB14607C7F18CE7BAC35B9AB96D8480@CWLP265MB1460.GBRP265.PROD.OUTLOOK.COM>

Hello,


I'm currently running a TMS tile server generating geotiff tiles from DEM data which I'm consuming with the GDAL TMS driver using an XML file along the following lines:


<GDAL_WMS>
    <Service name="TMS">
        <ServerUrl>http://localhost:8080/terrain/${z}/${x}/${y}.tif</ServerUrl>
    </Service>
    <DataWindow>
        <UpperLeftX>-20037508.34</UpperLeftX>
        <UpperLeftY>20037508.34</UpperLeftY>
        <LowerRightX>20037508.34</LowerRightX>
        <LowerRightY>-20037508.34</LowerRightY>
        <TileLevel>20</TileLevel>
        <TileCountX>1</TileCountX>
        <TileCountY>1</TileCountY>
        <YOrigin>top</YOrigin>
    </DataWindow>
    <Projection>EPSG:3857</Projection>
    <BlockSizeX>256</BlockSizeX>
    <BlockSizeY>256</BlockSizeY>
    <DataType>Float32</DataType>
    <BandsCount>1</BandsCount>
    <MaxConnections>50</MaxConnections>
    <ZeroBlockHttpCodes>204,404,500</ZeroBlockHttpCodes>
</GDAL_WMS>

This all works perfectly except for the fact that the responses interpreted as <ZeroBlockHttpCodes> are filled with a default value of 0. This obviously isn't great for elevation data :) Ideally I'd like to be able to specify a fill or NODATA value somewhere in the XML, something like:


<GDAL_WMS>

...

    <NoData>-9999</NoData>

or

    <FillValues>-9999</FillValues>

...

</GDAL_WMS>


The contents of a <NoData> tag might be a comma separated list for multiband rasters.


Would an enhancement request to support this be acceptable? Otherwise can anyone suggest any workarounds for the issue?


My current thoughts are that I could generate zero filled tiffs and return those instead of 404 responses, and wrap the TMS XML with a VRT that assigns an appropriate NODATA value. This is far from ideal however, as there are a lot of potential 404s and generating data for this is wasteful in terms of processing and bandwidth.


Best regards,


Homme

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180627/0f8797e1/attachment-0001.html>

From even.rouault at spatialys.com  Wed Jun 27 06:10:00 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 27 Jun 2018 15:10:00 +0200
Subject: [gdal-dev] Specifying NODATA values for the TMS (mini)driver
In-Reply-To: <CWLP265MB14607C7F18CE7BAC35B9AB96D8480@CWLP265MB1460.GBRP265.PROD.OUTLOOK.COM>
References: <CWLP265MB14607C7F18CE7BAC35B9AB96D8480@CWLP265MB1460.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <6244964.roPi2uBkMc@even-i700>

Homme,

> 
> The contents of a <NoData> tag might be a comma separated list for multiband
> rasters.
> 
> 
> Would an enhancement request to support this be acceptable? 

Sounds reasonable to me. Do you intend to propose a PR for this ? Ideally you 
would do the similar adaptation to the WMTS driver.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From benjamin.deschamps at canada.ca  Wed Jun 27 07:51:23 2018
From: benjamin.deschamps at canada.ca (Deschamps, Benjamin (EC))
Date: Wed, 27 Jun 2018 14:51:23 +0000
Subject: [gdal-dev] Rasterize command works from utility but not Python
	binding
Message-ID: <mailman.0.1530111696.22911.gdal-dev@lists.osgeo.org>

Hi everyone,

I am burning values from a KMZ into an existing GeoTiff. When I do it on the command line using gdal_rasterize (2.1.3), it works correctly:

gdal_rasterize -burn 0 -dialect SQLITE -sql "SELECT * FROM MyLayer WHERE (Name IS NOT '01') AND (Name IS NOT '02')" myfile.kmz existingfile.tif

But when I try the same, from the Python bindings it fails:

query = "SELECT * FROM IceLayer WHERE (Name IS NOT '01') AND (Name IS NOT '02')"
myoptions = gdal.RasterizeOptions(burnValues=0, SQLStatement=query, SQLDialect="SQLITE")
gdal.Rasterize(tif, kmz, options=myoptions)

With:

Traceback (most recent call last):
  File "my_script.py", line 65, in <module>
    create_ids_mask(lcc, working_dir, buffered_coastline)
  File "my_script.py", line 54, in my_function
    gdal.Rasterize(tif, kmz, options=myoptions)
  File "c:\Python36\lib\site-packages\osgeo\gdal.py", line 1085, in Rasterize
    return wrapper_GDALRasterizeDestName(destNameOrDestDS, srcDS, opts, callback, callback_data)
  File "c:\Python36\lib\site-packages\osgeo\gdal.py", line 3050, in wrapper_GDALRasterizeDestName
   return _gdal.wrapper_GDALRasterizeDestName(*args)
RuntimeError: Cannot create X:\localpath\existingfile.tif

I checked that the paths are correctly passed. What else could be the issue?

Thanks,

Benjamin Deschamps

Physical Sciences Specialist
Canadian Ice Service, Meteorological Service of Canada
Environment and Climate Change Canada / Government of Canada
Benjamin.Deschamps at canada.ca<mailto:Benjamin.Deschamps at canada.ca> / Tel: 613-943-4293

Spécialiste des sciences physiques
Service Canadien des Glaces, Service Météorologique du Canada,
Environnement et Changement climatique Canada / Gouvernement du Canada
Benjamin.Deschamps at canada.ca<mailto:Benjamin.Deschamps at canada.ca> / Tél. : 613-943-4293

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180627/8fe30fb7/attachment.html>

From even.rouault at spatialys.com  Wed Jun 27 08:58:26 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 27 Jun 2018 17:58:26 +0200
Subject: [gdal-dev] Rasterize command works from utility but not Python
	binding
In-Reply-To: <20180627150135.7992560F6172@lists.osgeo.org>
References: <20180627150135.7992560F6172@lists.osgeo.org>
Message-ID: <5713185.5Hq7WHupOk@even-i700>

On mercredi 27 juin 2018 14:51:23 CEST Deschamps, Benjamin (EC) wrote:
> Hi everyone,
> 
> I am burning values from a KMZ into an existing GeoTiff. When I do it on the
> command line using gdal_rasterize (2.1.3), it works correctly:
> 
> gdal_rasterize -burn 0 -dialect SQLITE -sql "SELECT * FROM MyLayer WHERE
> (Name IS NOT '01') AND (Name IS NOT '02')" myfile.kmz existingfile.tif
> 
> But when I try the same, from the Python bindings it fails:
> 
> query = "SELECT * FROM IceLayer WHERE (Name IS NOT '01') AND (Name IS NOT
> '02')" myoptions = gdal.RasterizeOptions(burnValues=0, SQLStatement=query,
> SQLDialect="SQLITE") gdal.Rasterize(tif, kmz, options=myoptions)
> 
> With:
> 
> Traceback (most recent call last):
>   File "my_script.py", line 65, in <module>
>     create_ids_mask(lcc, working_dir, buffered_coastline)
>   File "my_script.py", line 54, in my_function
>     gdal.Rasterize(tif, kmz, options=myoptions)
>   File "c:\Python36\lib\site-packages\osgeo\gdal.py", line 1085, in
> Rasterize return wrapper_GDALRasterizeDestName(destNameOrDestDS, srcDS,
> opts, callback, callback_data) File
> "c:\Python36\lib\site-packages\osgeo\gdal.py", line 3050, in
> wrapper_GDALRasterizeDestName return
> _gdal.wrapper_GDALRasterizeDestName(*args)
> RuntimeError: Cannot create X:\localpath\existingfile.tif
> 
> I checked that the paths are correctly passed. What else could be the issue?

That error message comes from the code path where it tries to create a new 
output file, not update an existing one.

What is 'tif' here ? A string or a GDAL dataset handle (in update mode) ?

I presume it is a filename, and that there's still a file descriptor opened on 
it, which prevents it to be deleted. When you pass a filename, GDAL will not 
try to update the file, but will recreate a new one. That said, I'm surprised 
you didn't get a prior error about missing resolution or size.


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Wed Jun 27 12:55:01 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 27 Jun 2018 21:55:01 +0200
Subject: [gdal-dev] Using GeoPackage as vector tile container?
In-Reply-To: <24dbcdf0ab9b4a00aa2cda8b9f1060e2@C119S212VM042.msvyvi.vaha.local>
References: <24dbcdf0ab9b4a00aa2cda8b9f1060e2@C119S212VM042.msvyvi.vaha.local>
Message-ID: <3301533.0mJ0zn3iAX@even-i700>

On jeudi 31 mai 2018 14:02:32 CEST Rahkonen Jukka (MML) wrote:
> Hi,
> 
> I wonder what would it need to store vector tiles into GeoPackage instead of
> MBTiles. Officially probably a new extension like the Tiled Gridded
> Coverage Data extension, but wouln't it technically be rather simple to
> write vector tiles as BLOBs into the tile_data column instead of png or
> jpeg BLOBs?

FYI, the editor of the Geopackage spec is considering creating a community 
extension for this:

http://lists.opengeospatial.org/pipermail/geopackage/2018-June/000298.html

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Thu Jun 28 01:31:43 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 28 Jun 2018 10:31:43 +0200
Subject: [gdal-dev] Motion: Promote GDAL 2.3.1 rc2 for release
In-Reply-To: <1989773.0pK2AJ4sWq@even-i700>
References: <1989773.0pK2AJ4sWq@even-i700>
Message-ID: <34028907.VO4u7hdPjK@even-i700>

On lundi 25 juin 2018 15:18:38 CEST Even Rouault wrote:
> Hi,
> 
> Motion: GDAL/OGR 2.3.1 rc2 is promoted to be the official 2.3.1 final
> release.
> 
> -------

I declare this motion passed with +1 from PSC members: EvenR, TamasS, DanielM, 
HowardB.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Thu Jun 28 01:42:20 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 28 Jun 2018 10:42:20 +0200
Subject: [gdal-dev] GDAL/OGR 2.3.1 is released
Message-ID: <6917706.DkEtz09SSW@even-i700>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the 
release of the GDAL/OGR 2.3.1 bug fix version. This adds 75 bug fixes on top 
of 2.3.0. The C and C++ API and ABI are unchanged.

Consult the release notes for the list of issues addressed :
  https://trac.osgeo.org/gdal/wiki/Release/2.3.1-News

The sources are available at:

    http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1.tar.xz
    http://download.osgeo.org/gdal/2.3.1/gdal-2.3.1.tar.gz
    http://download.osgeo.org/gdal/2.3.1/gdal231.zip
    http://download.osgeo.org/gdal/2.3.1/gdal-grass-2.3.1.tar.gz

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From bontepaarden at gmail.com  Thu Jun 28 03:53:27 2018
From: bontepaarden at gmail.com (Paul Meems)
Date: Thu, 28 Jun 2018 12:53:27 +0200
Subject: [gdal-dev] Dissolve large amount of geometries
Message-ID: <CAHNf2YQ4K3uJ-aHEvVWPyLTKRQUe9wY8C8-4TnYqaR3CMkfOgg@mail.gmail.com>

Hi list,

I've been working on this for months (off and on) and still no satisfying
outcome.
Either the process takes too long (multiple hours) or the result has
invalid geometries.

I want to try a different angle now. Instead of asking technical questions
I want to explain what I try to do. Hopefully, somebody has a
suggestion/hint which gives me some new insights.

I have a high-resolution geotiff (drone image). And I need to create a
taskmap in shapefile format.
This taskmap is used in the tractor (precision farming) for variable
spraying crop protection agents or variable fertilization using GPS, etc.

The user starts by giving the precision (width and height) of the taskmap.
I then create a fishnet over the tiff using the given width and height.
Typical values can 1 by 1 meter or less. This results in a dataset with a
lot of square/rectangles (1.5 - 2 million). Next step is to rotate the
fishnet to align with the tractor path and clip with the field border. Then
for each geometry, I get the pixel values from the tiff inside the
geometry. I calculate the average and add this value as 'Rating' to the
geometry.
This process is fast enough, about 20-30 seconds.

Next step is the slow part.
I need to merge the adjacent geometries with the same rating. Multipolygons
are not needed. If created I will break them apart later.

Of course, I tried using GDAL+GEOS and the result seems OK, but it takes
hours to finish.

Reading my long description, how would you handle this challenge?
I'm open to any suggestion.

Thanks.

Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180628/511041c6/attachment.html>

From even.rouault at spatialys.com  Thu Jun 28 04:25:14 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 28 Jun 2018 13:25:14 +0200
Subject: [gdal-dev] Dissolve large amount of geometries
In-Reply-To: <CAHNf2YQ4K3uJ-aHEvVWPyLTKRQUe9wY8C8-4TnYqaR3CMkfOgg@mail.gmail.com>
References: <CAHNf2YQ4K3uJ-aHEvVWPyLTKRQUe9wY8C8-4TnYqaR3CMkfOgg@mail.gmail.com>
Message-ID: <1581772.x2kfsGyav9@even-i700>

On jeudi 28 juin 2018 12:53:27 CEST Paul Meems wrote:
> Hi list,
> 
> I've been working on this for months (off and on) and still no satisfying
> outcome.
> Either the process takes too long (multiple hours) or the result has
> invalid geometries.
> 
> I want to try a different angle now. Instead of asking technical questions
> I want to explain what I try to do. Hopefully, somebody has a
> suggestion/hint which gives me some new insights.
> 
> I have a high-resolution geotiff (drone image). And I need to create a
> taskmap in shapefile format.
> This taskmap is used in the tractor (precision farming) for variable
> spraying crop protection agents or variable fertilization using GPS, etc.
> 
> The user starts by giving the precision (width and height) of the taskmap.
> I then create a fishnet over the tiff using the given width and height.
> Typical values can 1 by 1 meter or less. This results in a dataset with a
> lot of square/rectangles (1.5 - 2 million). Next step is to rotate the
> fishnet to align with the tractor path and clip with the field border. Then
> for each geometry, I get the pixel values from the tiff inside the
> geometry. I calculate the average and add this value as 'Rating' to the
> geometry.
> This process is fast enough, about 20-30 seconds.
> 
> Next step is the slow part.
> I need to merge the adjacent geometries with the same rating. Multipolygons
> are not needed. If created I will break them apart later.
> 
> Of course, I tried using GDAL+GEOS and the result seems OK, but it takes
> hours to finish.
> 
> Reading my long description, how would you handle this challenge?
> I'm open to any suggestion.

What about rotating your raster so that the fishnet is horizontal/vertical 
lines in that rotated raster ? Then you could clip, resample it to desired 
resolution. And you would use gdal_polygonize, which would merge the cells of 
same value quickly


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From SGONG at mdacorporation.com  Thu Jun 28 07:54:43 2018
From: SGONG at mdacorporation.com (Gong, Shawn)
Date: Thu, 28 Jun 2018 14:54:43 +0000
Subject: [gdal-dev] latest gdal2tiles.py
Message-ID: <7DCBC135929FF74E8A5488B1814AC6BC53878283@exbermd02.ds.mda.ca>

Hi list,

Where can I download the latest gdal2tiles.py that includes this patch?
https://trac.osgeo.org/gdal/attachment/ticket/5005/gdal2tiles.patch

is this SVN the latest version?https://svn.osgeo.org/gdal/trunk/gdal/swig/python/scripts/gdal2tiles.py

Thanks,
Shawn

This electronic correspondence, including any attachments, is intended solely for the use of the intended recipient(s) and may contain legally privileged, proprietary and/or confidential information. If you are not the intended recipient, please immediately notify the sender by reply e-mail and permanently delete all copies of this electronic correspondence and associated attachments. Any use, disclosure, dissemination, distribution or copying of this electronic correspondence and any attachments for any purposes that have not been specifically authorized by the sender is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180628/22b57c03/attachment.html>

From even.rouault at spatialys.com  Thu Jun 28 08:10:48 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 28 Jun 2018 17:10:48 +0200
Subject: [gdal-dev] latest gdal2tiles.py
In-Reply-To: <7DCBC135929FF74E8A5488B1814AC6BC53878283@exbermd02.ds.mda.ca>
References: <7DCBC135929FF74E8A5488B1814AC6BC53878283@exbermd02.ds.mda.ca>
Message-ID: <1927526.3DO3F3HBBo@even-i700>

On jeudi 28 juin 2018 14:54:43 CEST Gong, Shawn wrote:
> Hi list,
> 
> Where can I download the latest gdal2tiles.py that includes this patch?
> https://trac.osgeo.org/gdal/attachment/ticket/5005/gdal2tiles.patch

This patch has never been integrated, as least as such. Presumably something 
else fixed it.

> 
> is this SVN the latest
> version?https://svn.osgeo.org/gdal/trunk/gdal/swig/python/scripts/gdal2tile
> s.py
> 

Heh, we have migrated away from SVN to git a few months ago already :-)
https://github.com/OSGeo/gdal

The latest stable version has been released today:
https://download.osgeo.org/gdal/2.3.1/

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From lucianpls at yahoo.com  Thu Jun 28 12:42:53 2018
From: lucianpls at yahoo.com (Lucian Plesea)
Date: Thu, 28 Jun 2018 19:42:53 +0000 (UTC)
Subject: [gdal-dev] Specifying NODATA values for the TMS (mini)driver
References: <2072163843.3900664.1530214973895.ref@mail.yahoo.com>
Message-ID: <2072163843.3900664.1530214973895@mail.yahoo.com>

>> 
>> The contents of a <NoData> tag might be a comma separated list for multiband
>> rasters.
>> 
>> 
>> Would an enhancement request to support this be acceptable? 
>
>Sounds reasonable to me. Do you intend to propose a PR for this ? Ideally you 
>would do the similar adaptation to the WMTS driver.
>
>Even
It is supported, for all WMS driver flavors.  The syntax is:<DataValue NoData="10"/>  or <DataValues NoData="10 20 30"/> for multiple band, with one value for each band.In addition to the NoData attribute, "min" and "max" are also handled the same way.
Lucian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180628/e23cd605/attachment.html>

From even.rouault at spatialys.com  Thu Jun 28 12:57:51 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 28 Jun 2018 21:57:51 +0200
Subject: [gdal-dev] Specifying NODATA values for the TMS (mini)driver
In-Reply-To: <2072163843.3900664.1530214973895@mail.yahoo.com>
References: <2072163843.3900664.1530214973895.ref@mail.yahoo.com>
 <2072163843.3900664.1530214973895@mail.yahoo.com>
Message-ID: <2806416.gO18UuEdOI@even-i700>

On jeudi 28 juin 2018 19:42:53 CEST Lucian Plesea wrote:
> >> The contents of a <NoData> tag might be a comma separated list for
> >> multiband rasters.
> >> 
> >> 
> >> Would an enhancement request to support this be acceptable?
> >
> >Sounds reasonable to me. Do you intend to propose a PR for this ? Ideally
> >you would do the similar adaptation to the WMTS driver.
> >
> >Even
> 
> It is supported, for all WMS driver flavors.  The syntax is:<DataValue
> NoData="10"/>  or <DataValues NoData="10 20 30"/> for multiple band, with
> one value for each band.In addition to the NoData attribute, "min" and
> "max" are also handled the same way. 

Ah, thanks. This wasn't documented. Just added it.

Except it seems that ZeroBlock() just zeroes blocks, and doesn't use the 
nodata value.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From lucianpls at yahoo.com  Thu Jun 28 13:13:49 2018
From: lucianpls at yahoo.com (Lucian Plesea)
Date: Thu, 28 Jun 2018 20:13:49 +0000 (UTC)
Subject: [gdal-dev] Specifying NODATA values for the TMS (mini)driver
In-Reply-To: <2806416.gO18UuEdOI@even-i700>
References: <2072163843.3900664.1530214973895.ref@mail.yahoo.com>
 <2072163843.3900664.1530214973895@mail.yahoo.com>
 <2806416.gO18UuEdOI@even-i700>
Message-ID: <546380174.3914286.1530216829156@mail.yahoo.com>

 Yeah, I had that on my list of things to do, I just bumped into it.And before someone notices, the correct tag is "DataValues", never "DataValue".  I used both in the first message.

Lucian

    On Thursday, June 28, 2018, 12:57:55 PM PDT, Even Rouault <even.rouault at spatialys.com> wrote:  
 
 On jeudi 28 juin 2018 19:42:53 CEST Lucian Plesea wrote:
> >> The contents of a <NoData> tag might be a comma separated list for
> >> multiband rasters.
> >> 
> >> 
> >> Would an enhancement request to support this be acceptable?
> >
> >Sounds reasonable to me. Do you intend to propose a PR for this ? Ideally
> >you would do the similar adaptation to the WMTS driver.
> >
> >Even
> 
> It is supported, for all WMS driver flavors.  The syntax is:<DataValue
> NoData="10"/>  or <DataValues NoData="10 20 30"/> for multiple band, with
> one value for each band.In addition to the NoData attribute, "min" and
> "max" are also handled the same way. 

Ah, thanks. This wasn't documented. Just added it.

Except it seems that ZeroBlock() just zeroes blocks, and doesn't use the 
nodata value.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180628/7cb14e2f/attachment.html>

From max at maxogden.com  Fri Jun 29 01:02:47 2018
From: max at maxogden.com (Max Ogden)
Date: Fri, 29 Jun 2018 01:02:47 -0700
Subject: [gdal-dev] Missing layers with GeoPDF to MVT conversion with
	ogr2ogr/gdal 2.3.0
Message-ID: <CAONf+LTZxVuMktPR1JgpsPcdLtohLvnnteUR5j5m7GO+nJeSzQ@mail.gmail.com>

Hi, I am trying to convert USFS FSTopo GeoPDFs into Mapbox Vector Tiles
like this:

$ wget
https://data.fs.usda.gov/geodata/rastergateway/data/34117/fstopo/340711752_Azusa_FSTopo.pdf
$ ogr2ogr -f MBTILES test.mbtiles 340711752_Azusa_FSTopo.pdf

I'm using gdal git master (GDAL 2.4.0dev-1f6d597, released 2018/06/28) with
poppler 0.64.0.

My issue is that when I view the mbtiles in a webgl map (using $
tileserver-gl-light test.mbtiles) I only see 13 layers, not the 59 I was
expecting. Is it possible to include the vector information in all the
GeoPDF metadata layers when converting to MVT? I tried adding `--config
OGR_PDF_READ_NON_STRUCTURED YES` to the end of my ogr2ogr command but it
had no effect.

ogrinfo shows 59 metadata layers and 13 top level named layers:

```

$ ogrinfo -mdd layers 340711752_Azusa_FSTopo.pdf

INFO: Open of `340711752_Azusa_FSTopo.pdf'

      using driver `PDF' successful.

Metadata:

  CREATION_DATE=D:20171221174439Z

  CREATOR=Esri ArcSOC 10.3.1.4959

  NEATLINE=POLYGON ((407183.394216688 3775784.59268212,407183.480495386
3790905.61434883,420034.534067471 3790905.80204647,420034.842839467
3775784.26947838,407183.394216688 3775784.59268212))

Metadata (layers):

  LAYER_00_NAME=Other_5

  LAYER_01_NAME=Quadrangle_Extent

  LAYER_02_NAME=Quadrangle_Extent.Labels

  LAYER_03_NAME=Quadrangle_Extent.Labels.State_Outline_-_Default

  LAYER_04_NAME=Quadrangle_Extent.Other_4

  LAYER_05_NAME=Quadrangle_Extent.State_Outline

  LAYER_06_NAME=Adjacent_Quadrangle_Diagram

  LAYER_07_NAME=Adjacent_Quadrangle_Diagram.Other_3

  LAYER_08_NAME=Adjacent_Quadrangle_Diagram.Labels

  LAYER_09_NAME=Adjacent_Quadrangle_Diagram.Labels.Quad_Outlines_-_Default

  LAYER_10_NAME=Adjacent_Quadrangle_Diagram.Quadrangle_Extent

  LAYER_11_NAME=Adjacent_Quadrangle_Diagram.Quad_Outlines

  LAYER_12_NAME=Other_2

  LAYER_13_NAME=Quadrangle

  LAYER_14_NAME=Quadrangle.Other

  LAYER_15_NAME=Quadrangle.Labels

  LAYER_16_NAME=Quadrangle.Labels.Unplaced_Labels

  LAYER_17_NAME=Quadrangle.Labels.Unplaced_Labels.Road_Shields_-_Vertical

  LAYER_18_NAME=Quadrangle.Labels.Road_Shields_-_Horizontal

  LAYER_19_NAME=Quadrangle.Labels.Road_Shields_-_Vertical

  LAYER_20_NAME=Quadrangle.Labels.Road_Shields_-_Default

  LAYER_21_NAME=Quadrangle.Neatline/Mask

  LAYER_22_NAME=Quadrangle.Neatline/Mask.Grid_Labels

  LAYER_23_NAME=Quadrangle.Neatline/Mask.Neatline

  LAYER_24_NAME=Quadrangle.Neatline/Mask.Mask

  LAYER_25_NAME=Quadrangle.Text

  LAYER_26_NAME=Quadrangle.Road_Shields

  LAYER_27_NAME=Quadrangle.Buildings

  LAYER_28_NAME=Quadrangle.Culture_Features

  LAYER_29_NAME=Quadrangle.Drainage_Features

  LAYER_30_NAME=Quadrangle.Large_Tanks

  LAYER_31_NAME=Quadrangle.Survey_Points

  LAYER_32_NAME=Quadrangle.Geodetic_Control

  LAYER_33_NAME=Quadrangle.Recreation/Facility_Features

  LAYER_34_NAME=Quadrangle.Transportation_Features

  LAYER_35_NAME=Quadrangle.Linear_Transportation_Features

  LAYER_36_NAME=Quadrangle.Railroads_

  LAYER_37_NAME=Quadrangle.Linear_Culture_Features

  LAYER_38_NAME=Quadrangle.Linear_Landform_Features

  LAYER_39_NAME=Quadrangle.Boundaries

  LAYER_40_NAME=Quadrangle.Boundaries

  LAYER_41_NAME=Quadrangle.PLSS

  LAYER_42_NAME=Quadrangle.Survey_Lines

  LAYER_43_NAME=Quadrangle.Linear_Drainage_Features

  LAYER_44_NAME=Quadrangle.Contour_Labels

  LAYER_45_NAME=Quadrangle.Contours

  LAYER_46_NAME=Quadrangle.2_5`_Tics

  LAYER_47_NAME=Quadrangle.2_5`_Tics.Interior_Grid_Intersections

  LAYER_48_NAME=Quadrangle.2_5`_Tics.Grid_Tics_along_Neatline

  LAYER_49_NAME=Quadrangle.UTM_Grid

  LAYER_50_NAME=Quadrangle.UTM_Grid.Interior_Grid_Intersections

  LAYER_51_NAME=Quadrangle.UTM_Grid.Grid_Tics_along_Neatline

  LAYER_52_NAME=Quadrangle.UTM_Grid.UTM_Grid_Lines

  LAYER_53_NAME=Quadrangle.Large_Buildings

  LAYER_54_NAME=Quadrangle.Culture_Features

  LAYER_55_NAME=Quadrangle.Landforms

  LAYER_56_NAME=Quadrangle.Drainage_Polygons

  LAYER_57_NAME=Quadrangle.Ownership

  LAYER_58_NAME=Quadrangle.Builtup_Areas

  LAYER_59_NAME=Quadrangle.WoodlandUSGS_P

1: Quadrangle_Culture_Features

2: Quadrangle_Contour_Labels

3: Quadrangle_Contours

4: Quadrangle_2_5`_Tics_Interior_Grid_Intersections

5: Quadrangle_2_5`_Tics_Grid_Tics_along_Neatline

6: Quadrangle_UTM_Grid_Interior_Grid_Intersections

7: Quadrangle_UTM_Grid_Grid_Tics_along_Neatline

8: Quadrangle_UTM_Grid_UTM_Grid_Lines

9: Quadrangle_Large_Buildings

10: Quadrangle_Drainage_Polygons

11: Quadrangle_Ownership

12: Quadrangle_Builtup_Areas

13: Quadrangle_WoodlandUSGS_P
```

Thank you,
Max
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180629/d7fb6e89/attachment-0001.html>

From bontepaarden at gmail.com  Fri Jun 29 01:50:44 2018
From: bontepaarden at gmail.com (Paul Meems)
Date: Fri, 29 Jun 2018 10:50:44 +0200
Subject: [gdal-dev] Dissolve large amount of geometries
In-Reply-To: <1581772.x2kfsGyav9@even-i700>
References: <CAHNf2YQ4K3uJ-aHEvVWPyLTKRQUe9wY8C8-4TnYqaR3CMkfOgg@mail.gmail.com>
 <1581772.x2kfsGyav9@even-i700>
Message-ID: <CAHNf2YTbTo4NzWGWOX+9e7__f-tcO+CsZFU6drCNgoMKTM2fPg@mail.gmail.com>

Thanks Even for the suggestion.

We already thought about polygonizing the raster. But then I would have
less control about where the vector geometry is created.
The squares/rectangle need to align with the tractor tracks/path.

The scenario I described is the first version: creating a fishnet. The next
version will be more complicated because it will really create the
square/rectangle along the tracks.
Making them less regular in the field.
I've attached an image I manually created with Inkscape for some
clarification.

[image: tracks.png]
Of course, the whole field will have the green rectangles.
I have not yet created the algorithm to create these non-fishnet
rectangles, but that is the end goal.
That's why I can't use polygonize (at least I think I can't) but need to
create the geometries first, then fill them with the pixel values and next
merge/dissolve the geometries with the same values.

Regards,

Paul

Op do 28 jun. 2018 om 13:25 schreef Even Rouault <even.rouault at spatialys.com
>:

> On jeudi 28 juin 2018 12:53:27 CEST Paul Meems wrote:
> > Hi list,
> >
> > I've been working on this for months (off and on) and still no satisfying
> > outcome.
> > Either the process takes too long (multiple hours) or the result has
> > invalid geometries.
> >
> > I want to try a different angle now. Instead of asking technical
> questions
> > I want to explain what I try to do. Hopefully, somebody has a
> > suggestion/hint which gives me some new insights.
> >
> > I have a high-resolution geotiff (drone image). And I need to create a
> > taskmap in shapefile format.
> > This taskmap is used in the tractor (precision farming) for variable
> > spraying crop protection agents or variable fertilization using GPS, etc.
> >
> > The user starts by giving the precision (width and height) of the
> taskmap.
> > I then create a fishnet over the tiff using the given width and height.
> > Typical values can 1 by 1 meter or less. This results in a dataset with a
> > lot of square/rectangles (1.5 - 2 million). Next step is to rotate the
> > fishnet to align with the tractor path and clip with the field border.
> Then
> > for each geometry, I get the pixel values from the tiff inside the
> > geometry. I calculate the average and add this value as 'Rating' to the
> > geometry.
> > This process is fast enough, about 20-30 seconds.
> >
> > Next step is the slow part.
> > I need to merge the adjacent geometries with the same rating.
> Multipolygons
> > are not needed. If created I will break them apart later.
> >
> > Of course, I tried using GDAL+GEOS and the result seems OK, but it takes
> > hours to finish.
> >
> > Reading my long description, how would you handle this challenge?
> > I'm open to any suggestion.
>
> What about rotating your raster so that the fishnet is horizontal/vertical
> lines in that rotated raster ? Then you could clip, resample it to desired
> resolution. And you would use gdal_polygonize, which would merge the cells
> of
> same value quickly
>
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180629/391f4e1a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tracks.png
Type: image/png
Size: 37221 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180629/391f4e1a/attachment-0001.png>

From Jon.Morris at jbarisk.com  Fri Jun 29 03:01:54 2018
From: Jon.Morris at jbarisk.com (Jon Morris)
Date: Fri, 29 Jun 2018 10:01:54 +0000
Subject: [gdal-dev] Dissolve large amount of geometries
In-Reply-To: <CAHNf2YTbTo4NzWGWOX+9e7__f-tcO+CsZFU6drCNgoMKTM2fPg@mail.gmail.com>
References: <CAHNf2YQ4K3uJ-aHEvVWPyLTKRQUe9wY8C8-4TnYqaR3CMkfOgg@mail.gmail.com>
 <1581772.x2kfsGyav9@even-i700>
 <CAHNf2YTbTo4NzWGWOX+9e7__f-tcO+CsZFU6drCNgoMKTM2fPg@mail.gmail.com>
Message-ID: <LOXP12301MB165651907BC0D9AA46123AAF824E0@LOXP12301MB1656.GBRP123.PROD.OUTLOOK.COM>

We recently had a requirement to dissolve a large amount of geometries (using python) - it's not quite the same as your situation, but involved taking one postcode layer and one building layer covering the whole UK and dissolving to have one building multipolygon per postcode.

Unfortunately OGRLayer does not have a Dissolve method, unlike Intersect, Erase, Clip, etc., which are really fast. We tried iterating through features and dissolving each one, but it was taking a long time.

In the end (and I'm sorry to say this here ;-)), we used geopandas - the dissolve method is very fast, but you have to convert the OGRLayer to a geodataframe, calling ExportToJSON on each feature. This step is slow, but the whole UK can be processed in about 2h. Not sure how long calling dissolve on each feature would have taken, because I killed it after about a day.

Are there any plans for a Dissolve method on OGRLayer?

Jon

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Paul Meems
Sent: 29 June 2018 09:51
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Dissolve large amount of geometries


Thanks Even for the suggestion.

We already thought about polygonizing the raster. But then I would have less control about where the vector geometry is created.
The squares/rectangle need to align with the tractor tracks/path.

The scenario I described is the first version: creating a fishnet. The next version will be more complicated because it will really create the square/rectangle along the tracks.
Making them less regular in the field.
I've attached an image I manually created with Inkscape for some clarification.

[tracks.png]
Of course, the whole field will have the green rectangles.
I have not yet created the algorithm to create these non-fishnet rectangles, but that is the end goal.
That's why I can't use polygonize (at least I think I can't) but need to create the geometries first, then fill them with the pixel values and next merge/dissolve the geometries with the same values.

Regards,

Paul

Op do 28 jun. 2018 om 13:25 schreef Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>:
On jeudi 28 juin 2018 12:53:27 CEST Paul Meems wrote:
> Hi list,
>
> I've been working on this for months (off and on) and still no satisfying
> outcome.
> Either the process takes too long (multiple hours) or the result has
> invalid geometries.
>
> I want to try a different angle now. Instead of asking technical questions
> I want to explain what I try to do. Hopefully, somebody has a
> suggestion/hint which gives me some new insights.
>
> I have a high-resolution geotiff (drone image). And I need to create a
> taskmap in shapefile format.
> This taskmap is used in the tractor (precision farming) for variable
> spraying crop protection agents or variable fertilization using GPS, etc.
>
> The user starts by giving the precision (width and height) of the taskmap.
> I then create a fishnet over the tiff using the given width and height.
> Typical values can 1 by 1 meter or less. This results in a dataset with a
> lot of square/rectangles (1.5 - 2 million). Next step is to rotate the
> fishnet to align with the tractor path and clip with the field border. Then
> for each geometry, I get the pixel values from the tiff inside the
> geometry. I calculate the average and add this value as 'Rating' to the
> geometry.
> This process is fast enough, about 20-30 seconds.
>
> Next step is the slow part.
> I need to merge the adjacent geometries with the same rating. Multipolygons
> are not needed. If created I will break them apart later.
>
> Of course, I tried using GDAL+GEOS and the result seems OK, but it takes
> hours to finish.
>
> Reading my long description, how would you handle this challenge?
> I'm open to any suggestion.

What about rotating your raster so that the fishnet is horizontal/vertical
lines in that rotated raster ? Then you could clip, resample it to desired
resolution. And you would use gdal_polygonize, which would merge the cells of
same value quickly


--
Spatialys - Geospatial professional services
http://www.spatialys.com

T +44 (0) 1756 799919
www.jbarisk.com<http://www.jbarisk.com>

[Visit our website]<http://www.jbarisk.com> [http://www.jbagroup.co.uk/imgstore/JBA-Email-Sig-Icons-LINKEDIN.png] <https://www.linkedin.com/in/jon-morris-a2897b4/>  [Follow us on Twitter] <https://twitter.com/jbarisk>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180629/a3917062/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 55474 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180629/a3917062/attachment-0001.png>

From even.rouault at spatialys.com  Fri Jun 29 03:14:58 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 29 Jun 2018 12:14:58 +0200
Subject: [gdal-dev] Missing layers with GeoPDF to MVT conversion with
	ogr2ogr/gdal 2.3.0
In-Reply-To: <CAONf+LTZxVuMktPR1JgpsPcdLtohLvnnteUR5j5m7GO+nJeSzQ@mail.gmail.com>
References: <CAONf+LTZxVuMktPR1JgpsPcdLtohLvnnteUR5j5m7GO+nJeSzQ@mail.gmail.com>
Message-ID: <10071371.ltytBvWkAT@even-i700>

Max,

I've pushed a fix (in master and release/2.3 branches) in the drawing 
instruction parser of the PDF driver that enables to read that file

$ ogrinfo ~/gdal/data/pdf/340711752_Azusa_FSTopo.pdf
[...]
1: Other_5
2: Quadrangle_Extent_Other_4
3: Quadrangle_Extent_State_Outline
4: Adjacent_Quadrangle_Diagram_Other_3
5: Adjacent_Quadrangle_Diagram_Quadrangle_Extent
6: Adjacent_Quadrangle_Diagram_Quad_Outlines
7: Quadrangle_Other
8: Quadrangle_Labels_Unplaced_Labels_Road_Shields_-_Vertical
9: Quadrangle_Labels_Road_Shields_-_Horizontal
10: Quadrangle_Labels_Road_Shields_-_Vertical
11: Quadrangle_Neatline/Mask_Neatline
12: Quadrangle_Neatline/Mask_Mask
13: Quadrangle_Culture_Features
14: Quadrangle_Large_Tanks
15: Quadrangle_Linear_Transportation_Features
16: Quadrangle_Railroads_
17: Quadrangle_Linear_Culture_Features
18: Quadrangle_Linear_Landform_Features
19: Quadrangle_Boundaries
20: Quadrangle_PLSS
21: Quadrangle_Survey_Lines
22: Quadrangle_Linear_Drainage_Features
23: Quadrangle_Contour_Labels
24: Quadrangle_Contours
25: Quadrangle_2_5`_Tics_Interior_Grid_Intersections
26: Quadrangle_2_5`_Tics_Grid_Tics_along_Neatline
27: Quadrangle_UTM_Grid_Interior_Grid_Intersections
28: Quadrangle_UTM_Grid_Grid_Tics_along_Neatline
29: Quadrangle_UTM_Grid_UTM_Grid_Lines
30: Quadrangle_Large_Buildings
31: Quadrangle_Drainage_Polygons
32: Quadrangle_Ownership
33: Quadrangle_Builtup_Areas
34: Quadrangle_WoodlandUSGS_P

Some of the layers are missing, but either they are not terminal, or contain 
only objects that OGR cannot handle (labels e.g.)

Even


> Hi, I am trying to convert USFS FSTopo GeoPDFs into Mapbox Vector Tiles
> like this:
> 
> $ wget
> https://data.fs.usda.gov/geodata/rastergateway/data/34117/fstopo/340711752_A
> zusa_FSTopo.pdf $ ogr2ogr -f MBTILES test.mbtiles 340711752_Azusa_FSTopo.pdf
> 
> I'm using gdal git master (GDAL 2.4.0dev-1f6d597, released 2018/06/28) with
> poppler 0.64.0.
> 
> My issue is that when I view the mbtiles in a webgl map (using $
> tileserver-gl-light test.mbtiles) I only see 13 layers, not the 59 I was
> expecting. Is it possible to include the vector information in all the
> GeoPDF metadata layers when converting to MVT? I tried adding `--config
> OGR_PDF_READ_NON_STRUCTURED YES` to the end of my ogr2ogr command but it
> had no effect.
> 
> ogrinfo shows 59 metadata layers and 13 top level named layers:
> 
> ```
> 
> $ ogrinfo -mdd layers 340711752_Azusa_FSTopo.pdf
> 
> INFO: Open of `340711752_Azusa_FSTopo.pdf'
> 
>       using driver `PDF' successful.
> 
> Metadata:
> 
>   CREATION_DATE=D:20171221174439Z
> 
>   CREATOR=Esri ArcSOC 10.3.1.4959
> 
>   NEATLINE=POLYGON ((407183.394216688 3775784.59268212,407183.480495386
> 3790905.61434883,420034.534067471 3790905.80204647,420034.842839467
> 3775784.26947838,407183.394216688 3775784.59268212))
> 
> Metadata (layers):
> 
>   LAYER_00_NAME=Other_5
> 
>   LAYER_01_NAME=Quadrangle_Extent
> 
>   LAYER_02_NAME=Quadrangle_Extent.Labels
> 
>   LAYER_03_NAME=Quadrangle_Extent.Labels.State_Outline_-_Default
> 
>   LAYER_04_NAME=Quadrangle_Extent.Other_4
> 
>   LAYER_05_NAME=Quadrangle_Extent.State_Outline
> 
>   LAYER_06_NAME=Adjacent_Quadrangle_Diagram
> 
>   LAYER_07_NAME=Adjacent_Quadrangle_Diagram.Other_3
> 
>   LAYER_08_NAME=Adjacent_Quadrangle_Diagram.Labels
> 
>   LAYER_09_NAME=Adjacent_Quadrangle_Diagram.Labels.Quad_Outlines_-_Default
> 
>   LAYER_10_NAME=Adjacent_Quadrangle_Diagram.Quadrangle_Extent
> 
>   LAYER_11_NAME=Adjacent_Quadrangle_Diagram.Quad_Outlines
> 
>   LAYER_12_NAME=Other_2
> 
>   LAYER_13_NAME=Quadrangle
> 
>   LAYER_14_NAME=Quadrangle.Other
> 
>   LAYER_15_NAME=Quadrangle.Labels
> 
>   LAYER_16_NAME=Quadrangle.Labels.Unplaced_Labels
> 
>   LAYER_17_NAME=Quadrangle.Labels.Unplaced_Labels.Road_Shields_-_Vertical
> 
>   LAYER_18_NAME=Quadrangle.Labels.Road_Shields_-_Horizontal
> 
>   LAYER_19_NAME=Quadrangle.Labels.Road_Shields_-_Vertical
> 
>   LAYER_20_NAME=Quadrangle.Labels.Road_Shields_-_Default
> 
>   LAYER_21_NAME=Quadrangle.Neatline/Mask
> 
>   LAYER_22_NAME=Quadrangle.Neatline/Mask.Grid_Labels
> 
>   LAYER_23_NAME=Quadrangle.Neatline/Mask.Neatline
> 
>   LAYER_24_NAME=Quadrangle.Neatline/Mask.Mask
> 
>   LAYER_25_NAME=Quadrangle.Text
> 
>   LAYER_26_NAME=Quadrangle.Road_Shields
> 
>   LAYER_27_NAME=Quadrangle.Buildings
> 
>   LAYER_28_NAME=Quadrangle.Culture_Features
> 
>   LAYER_29_NAME=Quadrangle.Drainage_Features
> 
>   LAYER_30_NAME=Quadrangle.Large_Tanks
> 
>   LAYER_31_NAME=Quadrangle.Survey_Points
> 
>   LAYER_32_NAME=Quadrangle.Geodetic_Control
> 
>   LAYER_33_NAME=Quadrangle.Recreation/Facility_Features
> 
>   LAYER_34_NAME=Quadrangle.Transportation_Features
> 
>   LAYER_35_NAME=Quadrangle.Linear_Transportation_Features
> 
>   LAYER_36_NAME=Quadrangle.Railroads_
> 
>   LAYER_37_NAME=Quadrangle.Linear_Culture_Features
> 
>   LAYER_38_NAME=Quadrangle.Linear_Landform_Features
> 
>   LAYER_39_NAME=Quadrangle.Boundaries
> 
>   LAYER_40_NAME=Quadrangle.Boundaries
> 
>   LAYER_41_NAME=Quadrangle.PLSS
> 
>   LAYER_42_NAME=Quadrangle.Survey_Lines
> 
>   LAYER_43_NAME=Quadrangle.Linear_Drainage_Features
> 
>   LAYER_44_NAME=Quadrangle.Contour_Labels
> 
>   LAYER_45_NAME=Quadrangle.Contours
> 
>   LAYER_46_NAME=Quadrangle.2_5`_Tics
> 
>   LAYER_47_NAME=Quadrangle.2_5`_Tics.Interior_Grid_Intersections
> 
>   LAYER_48_NAME=Quadrangle.2_5`_Tics.Grid_Tics_along_Neatline
> 
>   LAYER_49_NAME=Quadrangle.UTM_Grid
> 
>   LAYER_50_NAME=Quadrangle.UTM_Grid.Interior_Grid_Intersections
> 
>   LAYER_51_NAME=Quadrangle.UTM_Grid.Grid_Tics_along_Neatline
> 
>   LAYER_52_NAME=Quadrangle.UTM_Grid.UTM_Grid_Lines
> 
>   LAYER_53_NAME=Quadrangle.Large_Buildings
> 
>   LAYER_54_NAME=Quadrangle.Culture_Features
> 
>   LAYER_55_NAME=Quadrangle.Landforms
> 
>   LAYER_56_NAME=Quadrangle.Drainage_Polygons
> 
>   LAYER_57_NAME=Quadrangle.Ownership
> 
>   LAYER_58_NAME=Quadrangle.Builtup_Areas
> 
>   LAYER_59_NAME=Quadrangle.WoodlandUSGS_P
> 
> 1: Quadrangle_Culture_Features
> 
> 2: Quadrangle_Contour_Labels
> 
> 3: Quadrangle_Contours
> 
> 4: Quadrangle_2_5`_Tics_Interior_Grid_Intersections
> 
> 5: Quadrangle_2_5`_Tics_Grid_Tics_along_Neatline
> 
> 6: Quadrangle_UTM_Grid_Interior_Grid_Intersections
> 
> 7: Quadrangle_UTM_Grid_Grid_Tics_along_Neatline
> 
> 8: Quadrangle_UTM_Grid_UTM_Grid_Lines
> 
> 9: Quadrangle_Large_Buildings
> 
> 10: Quadrangle_Drainage_Polygons
> 
> 11: Quadrangle_Ownership
> 
> 12: Quadrangle_Builtup_Areas
> 
> 13: Quadrangle_WoodlandUSGS_P
> ```
> 
> Thank you,
> Max


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From louis-philippe.rousseaulambert2 at canada.ca  Fri Jun 29 05:12:06 2018
From: louis-philippe.rousseaulambert2 at canada.ca (Rousseau Lambert2, Louis-Philippe (EC))
Date: Fri, 29 Jun 2018 12:12:06 +0000
Subject: [gdal-dev] ogr2ogr SQL command
Message-ID: <1530274326470.4511@canada.ca>

Hi,


I was trying to dissolve some buffers based on a attribute in a shapefile and faced something weird.


I do the dissolve with ogr2ogr command line:

ogr2ogr coverage_dissolve.shp coverage.shp -dialect sqlite -sql "SELECT ST_Union(geometry), type FROM coverage GROUP BY type"


This works fine with GDAL 1.10.0, but when I try to do the same thing with GDAL 2.2.2, nothing happens...


Is there a another way of doing SQL commands in gdal 2.2.2 or am I missing something else?


Thanks


LP
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180629/4e929763/attachment.html>

From even.rouault at spatialys.com  Fri Jun 29 05:34:09 2018
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 29 Jun 2018 14:34:09 +0200
Subject: [gdal-dev] ogr2ogr SQL command
In-Reply-To: <1530274326470.4511@canada.ca>
References: <1530274326470.4511@canada.ca>
Message-ID: <2057884.tzOrXXjMxx@even-i700>

On vendredi 29 juin 2018 12:12:06 CEST Rousseau Lambert2, Louis-Philippe (EC) 
wrote:
> Hi,
> 
> 
> I was trying to dissolve some buffers based on a attribute in a shapefile
> and faced something weird.
> 
> 
> I do the dissolve with ogr2ogr command line:
> 
> ogr2ogr coverage_dissolve.shp coverage.shp -dialect sqlite -sql "SELECT
> ST_Union(geometry), type FROM coverage GROUP BY type"
> 
> 
> This works fine with GDAL 1.10.0, but when I try to do the same thing with
> GDAL 2.2.2, nothing happens...
> 
> 
> Is there a another way of doing SQL commands in gdal 2.2.2 or am I missing
> something else?

Works fine for me with 2.2.4 and later with the following trivial dataset:

Given test.csv:
id,type,WKT
1,"x","POLYGON((0 0,0 1,1 1,1 0))"
2,"x","POLYGON((0 0,1 0,1 1,1 0))"

$ ogr2ogr coverage.shp test.csv
$ ogr2ogr coverage_dissolve.shp coverage.shp -dialect sqlite \
  -sql "SELECT ST_Union(geometry), type FROM coverage GROUP BY type"
$ ogrinfo coverage_dissolve.shp -al -q
[...]
OGRFeature(coverage_dissolve):0
  type (String) = x
  POLYGON ((0 0,0 1,1 1,1 0,0 0))

Perhaps there was also a change in Spatialite and GEOS versions when upgrading 
from GDAL 1.10 to 2.2.2 ? Are all your geometries valid ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From louis-philippe.rousseaulambert2 at canada.ca  Fri Jun 29 05:48:39 2018
From: louis-philippe.rousseaulambert2 at canada.ca (Rousseau Lambert2, Louis-Philippe (EC))
Date: Fri, 29 Jun 2018 12:48:39 +0000
Subject: [gdal-dev] ogr2ogr SQL command
In-Reply-To: <2057884.tzOrXXjMxx@even-i700>
References: <1530274326470.4511@canada.ca>,<2057884.tzOrXXjMxx@even-i700>
Message-ID: <mailman.4.1530276527.22911.gdal-dev@lists.osgeo.org>

Hi Even, 

Thanks for the quick answer.

I tried with your example test.csv, and for me it really doesn't work with 2.2.2... There is simply nothing as output. 

I tried with the older version 1.10 and it works fine. 

I'll simply have to upgrade to 2.2.4 I guess.

Thanks

LP
________________________________________
De : Even Rouault <even.rouault at spatialys.com>
Envoyé : 29 juin 2018 08:34
À : gdal-dev at lists.osgeo.org
Cc : Rousseau Lambert2, Louis-Philippe (EC)
Objet : Re: [gdal-dev] ogr2ogr SQL command

On vendredi 29 juin 2018 12:12:06 CEST Rousseau Lambert2, Louis-Philippe (EC)
wrote:
> Hi,
>
>
> I was trying to dissolve some buffers based on a attribute in a shapefile
> and faced something weird.
>
>
> I do the dissolve with ogr2ogr command line:
>
> ogr2ogr coverage_dissolve.shp coverage.shp -dialect sqlite -sql "SELECT
> ST_Union(geometry), type FROM coverage GROUP BY type"
>
>
> This works fine with GDAL 1.10.0, but when I try to do the same thing with
> GDAL 2.2.2, nothing happens...
>
>
> Is there a another way of doing SQL commands in gdal 2.2.2 or am I missing
> something else?

Works fine for me with 2.2.4 and later with the following trivial dataset:

Given test.csv:
id,type,WKT
1,"x","POLYGON((0 0,0 1,1 1,1 0))"
2,"x","POLYGON((0 0,1 0,1 1,1 0))"

$ ogr2ogr coverage.shp test.csv
$ ogr2ogr coverage_dissolve.shp coverage.shp -dialect sqlite \
  -sql "SELECT ST_Union(geometry), type FROM coverage GROUP BY type"
$ ogrinfo coverage_dissolve.shp -al -q
[...]
OGRFeature(coverage_dissolve):0
  type (String) = x
  POLYGON ((0 0,0 1,1 1,1 0,0 0))

Perhaps there was also a change in Spatialite and GEOS versions when upgrading
from GDAL 1.10 to 2.2.2 ? Are all your geometries valid ?

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com

From Donato.AIRAGHI at ext.ec.europa.eu  Fri Jun 29 08:22:59 2018
From: Donato.AIRAGHI at ext.ec.europa.eu (Donato.AIRAGHI at ext.ec.europa.eu)
Date: Fri, 29 Jun 2018 15:22:59 +0000
Subject: [gdal-dev] compile gdal 2.3.0 on centos 6.9
Message-ID: <298B386164AE8F4A96FD656145FD37731FA991A5@S-DC-ESTE01-J.net1.cec.eu.int>

Hi,

on Centos 6.9  compiling gdal 2.3.0 with 


./configure --with-python=yes  --with-pg=/usr/pgsql-9.3/bin/pg_config --with-geos=yes --with-curl=/usr/bin/curl-config --with-mrsid=/opt/MrSID/Raster_DSDK/ --with-jp2mrsid=no --with-mrsid_lidar=/opt/MrSID/Lidar_DSDK/ --with-sqlite3 --with-podofo=yes --with-hdf4=/opt/HDF/hdf-4.2.13 --with-hdf5=/opt/HDF/hdf-5.1.8.21 --with-openjpeg=/usr/local --with-jasper=no --with-ecw=no --with-threads --with-spatialite=yes

env:

export OPENJPEG_LIBS=/usr/local/lib/libopenjp2.so
export PKG_CONFIG=/usr/local/bin/pkg-config
export PKG_CONFIG_PATH=PKG_CONFIG_PATH:/usr/lib64/pkgconfig/:/usr/local/lib/pkgconfig/:/usr/pgsql-9.3/lib/pkgconfig/:/usr/share/pkgconfig/
scl enable devtoolset-3 bash


make output :
I get

..../.libs/libgdal.so: undefined reference to `opj_create_compress'
..../.libs/libgdal.so: undefined reference to `opj_stream_create'
..../.libs/libgdal.so: undefined reference to `opj_setup_decoder'
..../.libs/libgdal.so: undefined reference to `opj_image_tile_create'
..../.libs/libgdal.so: undefined reference to `opj_end_decompress'
..../.libs/libgdal.so: undefined reference to `opj_destroy_codec'
..../.libs/libgdal.so: undefined reference to `opj_read_header'
..../.libs/libgdal.so: undefined reference to `opj_image_destroy'
..../.libs/libgdal.so: undefined reference to `opj_end_compress'
.......
.......


any suggestion?

many thanks in advance


Donato Airaghi

System Administrator
Serco s.p.a - JRC Ispra


From andrew at aitchison.me.uk  Fri Jun 29 09:27:18 2018
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Fri, 29 Jun 2018 17:27:18 +0100 (BST)
Subject: [gdal-dev] compile gdal 2.3.0 on centos 6.9
In-Reply-To: <298B386164AE8F4A96FD656145FD37731FA991A5@S-DC-ESTE01-J.net1.cec.eu.int>
References: <298B386164AE8F4A96FD656145FD37731FA991A5@S-DC-ESTE01-J.net1.cec.eu.int>
Message-ID: <alpine.LRH.2.21.1806291718420.19325@warden.aitchison.me.uk>

On Fri, 29 Jun 2018, Donato.AIRAGHI at ext.ec.europa.eu wrote:

> Hi,
>
> on Centos 6.9  compiling gdal 2.3.0 with 
>
>
> ./configure --with-python=yes  --with-pg=/usr/pgsql-9.3/bin/pg_config --with-geos=yes --with-curl=/usr/bin/curl-config --with-mrsid=/opt/MrSID/Raster_DSDK/ --with-jp2mrsid=no --with-mrsid_lidar=/opt/MrSID/Lidar_DSDK/ --with-sqlite3 --with-podofo=yes --with-hdf4=/opt/HDF/hdf-4.2.13 --with-hdf5=/opt/HDF/hdf-5.1.8.21 --with-openjpeg=/usr/local --with-jasper=no --with-ecw=no --with-threads --with-spatialite=yes
>
> env:
>
> export OPENJPEG_LIBS=/usr/local/lib/libopenjp2.so

Should that be
 	 export OPENJPEG_LIBS=/usr/local/lib
?

> export PKG_CONFIG=/usr/local/bin/pkg-config
> export PKG_CONFIG_PATH=PKG_CONFIG_PATH:/usr/lib64/pkgconfig/:/usr/local/lib/pkgconfig/:/usr/pgsql-9.3/lib/pkgconfig/:/usr/share/pkgconfig/
> scl enable devtoolset-3 bash

Is there a reason why you use a local openjpeg library ?
I have openjpeg-devel-1.3-16.el6_8.x86_64.rpm installed on my
Scientific Linux 6.9 machine (which should be the same as CentOS 6.9)
and use whatever openjpeg library the default configure gives me
without any problems.

I see that openjpeg2{,-devel,-tools} packages are available from epel
( https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch )
_ I haven't tried them, but if you need v2...


> make output :
> I get
>
> ..../.libs/libgdal.so: undefined reference to `opj_create_compress'
> ..../.libs/libgdal.so: undefined reference to `opj_stream_create'
> ..../.libs/libgdal.so: undefined reference to `opj_setup_decoder'
> ..../.libs/libgdal.so: undefined reference to `opj_image_tile_create'
> ..../.libs/libgdal.so: undefined reference to `opj_end_decompress'
> ..../.libs/libgdal.so: undefined reference to `opj_destroy_codec'
> ..../.libs/libgdal.so: undefined reference to `opj_read_header'
> ..../.libs/libgdal.so: undefined reference to `opj_image_destroy'
> ..../.libs/libgdal.so: undefined reference to `opj_end_compress'
> .......

-- 
Andrew C. Aitchison					Cambridge, UK
 			andrew at aitchison.me.uk

From max at maxogden.com  Fri Jun 29 15:46:04 2018
From: max at maxogden.com (Max Ogden)
Date: Fri, 29 Jun 2018 15:46:04 -0700
Subject: [gdal-dev] Missing layers with GeoPDF to MVT conversion with
 ogr2ogr/gdal 2.3.0
In-Reply-To: <10071371.ltytBvWkAT@even-i700>
References: <CAONf+LTZxVuMktPR1JgpsPcdLtohLvnnteUR5j5m7GO+nJeSzQ@mail.gmail.com>
 <10071371.ltytBvWkAT@even-i700>
Message-ID: <CAONf+LTaPd5Qcjwv0kmhkQ3eL-9SfucNWb8=X3ZV-uxVd_-1RQ@mail.gmail.com>

Thank you, Even! Your fix works as described. The MVT MBTiles version of
the Azusa GeoPDF rendered in WebGL looks like this now, much more complete:
https://i.imgur.com/Nnq6Brp.jpg

I took the layers that got skipped and did a raster render of them for
reference: https://i.imgur.com/9MjQ9hk.jpg

Any ideas on how to extract the rest of the information? I suppose as a
transparent png overlay tile layer the text labels would be much smaller
than the full topo tiles... so rendering the raster labels on top of the
vector terrain might work OK. But I would love to render everything in
WebGL :D

Max
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20180629/61002399/attachment.html>

