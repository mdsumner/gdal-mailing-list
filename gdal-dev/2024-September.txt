From even.rouault at spatialys.com  Sun Sep  1 06:08:03 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 1 Sep 2024 15:08:03 +0200
Subject: [gdal-dev] AutoCreateWarpedVRT changes Int16 raster to Int32
In-Reply-To: <CAJbvKNrm9+hAcBhmqJ_V9DTM4gA_=7YsYh+CBjndenhpFqdpmQ@mail.gmail.com>
References: <CAJbvKNoYMxa_JXK7BMwN=Zu1HHU2GE7hrjxegOmVxQfO4=Ab7g@mail.gmail.com>
 <7f711e81-0dfd-40e4-b768-a5176145fbd3@spatialys.com>
 <CAJbvKNrm9+hAcBhmqJ_V9DTM4gA_=7YsYh+CBjndenhpFqdpmQ@mail.gmail.com>
Message-ID: <93fb4909-94c3-4540-921b-14d056f4a982@spatialys.com>

Fixed per https://github.com/OSGeo/gdal/pull/10709 in 3.9 branch, and 
more extensive fix in master in https://github.com/OSGeo/gdal/pull/10708

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From rykovd at gmail.com  Sun Sep  1 07:09:02 2024
From: rykovd at gmail.com (Denis Rykov)
Date: Sun, 1 Sep 2024 16:09:02 +0200
Subject: [gdal-dev] AutoCreateWarpedVRT changes Int16 raster to Int32
In-Reply-To: <93fb4909-94c3-4540-921b-14d056f4a982@spatialys.com>
References: <CAJbvKNoYMxa_JXK7BMwN=Zu1HHU2GE7hrjxegOmVxQfO4=Ab7g@mail.gmail.com>
 <7f711e81-0dfd-40e4-b768-a5176145fbd3@spatialys.com>
 <CAJbvKNrm9+hAcBhmqJ_V9DTM4gA_=7YsYh+CBjndenhpFqdpmQ@mail.gmail.com>
 <93fb4909-94c3-4540-921b-14d056f4a982@spatialys.com>
Message-ID: <CAJbvKNq-D2-XRLdoPe5d+AF6FVzQhrjo6YSWuiFuYr=FY+nAzQ@mail.gmail.com>

That's fantastic! Thank you Even!

On Sun, Sep 1, 2024 at 3:08?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Fixed per https://github.com/OSGeo/gdal/pull/10709 in 3.9 branch, and
> more extensive fix in master in https://github.com/OSGeo/gdal/pull/10708
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240901/939038cd/attachment.htm>

From j1 at jimenezshaw.com  Mon Sep  2 08:38:08 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 2 Sep 2024 17:38:08 +0200
Subject: [gdal-dev] Extending GDAL Color Interpretation enumeration for
 infra-red bands (+ band wavelength) ?
In-Reply-To: <043bce04-fa2a-417d-b03b-72f9e5333ba1@spatialys.com>
References: <043bce04-fa2a-417d-b03b-72f9e5333ba1@spatialys.com>
Message-ID: <CADRrdKtBAQ6R4oY4Kr-19RfH3ksfJB2+zvtTF0QQi0zki0k7Cw@mail.gmail.com>

Hi Even,

My bias is towards agriculture drone images, that I was processing in my
current employer. To compute vegetation indices the "Central Wavelength"
and "FWHM" are the best definition. Different sensors have different
"types" of Red, Blue, NIR or LWIR. So I see these two numbers the best
option.
Regarding the units, micro vs nano meters, I do not have a strong opinion.
(nano looks nicer in visible range, micro in thermal range).

About the names (in addition to the wavelength and fwhm), I would not go
into the details like "green05". That is very specific to a certain
satellite, and will be obsolete immediately. I agree with more generic
names like pan, blue, green, red, rededge, nir, lwir, ...
(for agriculture I would say that if I have to choose 3 bands, "red,
rededge, nir" would give a lot of information. But of course, other bands
are also used)

In Pix4D, for the radiometric correction needed in the images, we defined
this XMP namespace years ago:
http://pix4d.com/camera/1.0/
There are "Xmp.Camera.CentralWavelength", "Xmp.Camera.WavelengthFWHM" and
"Xmp.Camera.BandName". I do not mean that we should do the same, but just
an example of how that information was important.

One question. The IMAGERY metadata is available only on TIF, or also in
other file formats like JPG? I mean without any sidecar.

Cheers,
Javier.

On Sat, 31 Aug 2024 at 16:22, Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> The GDAL Color Interpretation enumeration is a good start, but is quite
> limited regarding band spectral properties with just Red, Green, Bland,
> and nothing for other band wavelengths, particularly for infra-red.
>
> I was looking a bit at the classifications at
> https://en.wikipedia.org/wiki/Infrared#Regions , and there are several
> ones, like the "commonly used subdivision scheme" (NIR, SWIR, MWIR,
> LWIR, FIR) or "CIE division scheme" (IR-A, IR-B, IR-C) or "ISO 20743
> scheme" (NIR, MIR, FIR).
>
> My inclination would rather to re-use the STAC EO classification at
> https://github.com/stac-extensions/eo?tab=readme-ov-file#common-band-names,
>
> which shows a lot of similarities with
>
> https://github.com/awesome-spectral-indices/awesome-spectral-indices#expressions
> , and has a nice mapping with a few popular instruments.
>
> While we are it, should we standardize central wavelength and full width
> half max (FWHM), has special properties of a bands rather than generic
> text-based metadata, like:
>
> double GDALRasterBand::GetCentralWaveLengthMicrometer() -> NaN if unknown
> double GDALRasterBand::GetFWHMMicrometer() -> NaN if unknown
> void GDALRasterBand::SetCentralWaveLengthMicrometer(double)
> void GDALRasterBand::SetFWHMMicrometer(double)
>
> Or maybe just standardize a "CENTRAL_WAVELENGTH" and "FWHM" metadata
> items in the "IMAGERY" metadata domain:
>
> https://gdal.org/en/latest/user/raster_data_model.html#imagery-domain-remote-sensing
> ?
>
> Thoughts?
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240902/6d0e2437/attachment.htm>

From even.rouault at spatialys.com  Mon Sep  2 09:24:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 2 Sep 2024 18:24:48 +0200
Subject: [gdal-dev] Extending GDAL Color Interpretation enumeration for
 infra-red bands (+ band wavelength) ?
In-Reply-To: <CADRrdKtBAQ6R4oY4Kr-19RfH3ksfJB2+zvtTF0QQi0zki0k7Cw@mail.gmail.com>
References: <043bce04-fa2a-417d-b03b-72f9e5333ba1@spatialys.com>
 <CADRrdKtBAQ6R4oY4Kr-19RfH3ksfJB2+zvtTF0QQi0zki0k7Cw@mail.gmail.com>
Message-ID: <c69ef7ef-b150-44ca-8f61-557af1e565f3@spatialys.com>

ok, so based on all feedback, I guess we could add GCI_PanBand, 
GCI_CoastalBand, GCI_RedEdgeBand, GCI_NIRBand, GCI_SWIRBand, 
GCI_MWIRBand, GCI_LWIRBand, + maybe GCIThermalRBand (that one with 
overlap with?MWIR and LWIR), without loosing too much generality + maybe 
GCI_OtherIRBand for whatever other uses ?? I realize we already have a 
GCI_YellowBand, although it is thought for the CMYK color space. Do we 
need a GCI_YellowSpectralBand enumeration value... ?

The documented associated wavelengths range for those constants could be 
the ones of 
https://github.com/stac-extensions/eo?tab=readme-ov-file#common-band-names 
but with a warning that they are indicative only, and some sensors could 
partially intersect the range, and that the wavelength metadata when 
present has precedence.

>
> In Pix4D, for the radiometric correction needed in the images, we 
> defined this XMP namespace years ago:
> http://pix4d.com/camera/1.0/
> There are "Xmp.Camera.CentralWavelength", "Xmp.Camera.WavelengthFWHM" 
> and "Xmp.Camera.BandName". I do not mean that we should do the same, 
> but just an example of how that information was important.
>
> One question. The IMAGERY metadata is available only on TIF, or also 
> in other file formats like JPG? I mean without any sidecar.

This is per-se generic, but in practice, only the TIFF driver currently 
fills it from the sidecar files of various metadata producers 
(DigitalGlobe, Pleiades, etc.). It could also be stored in the GDAL 
.aux.xml side car file for any PAM capable driver (the STACIT driver 
could use the STAC eo metadata to also set the new GCI_ constant and the 
wavelength metadata items, when present). The Sentinel2 driver also 
could fill that. As well as the ENVI one when the metadata items are 
present.


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From j1 at jimenezshaw.com  Mon Sep  2 10:07:16 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 2 Sep 2024 19:07:16 +0200
Subject: [gdal-dev] Extending GDAL Color Interpretation enumeration for
 infra-red bands (+ band wavelength) ?
In-Reply-To: <c69ef7ef-b150-44ca-8f61-557af1e565f3@spatialys.com>
References: <043bce04-fa2a-417d-b03b-72f9e5333ba1@spatialys.com>
 <CADRrdKtBAQ6R4oY4Kr-19RfH3ksfJB2+zvtTF0QQi0zki0k7Cw@mail.gmail.com>
 <c69ef7ef-b150-44ca-8f61-557af1e565f3@spatialys.com>
Message-ID: <CADRrdKvnddsA+PEMzkHX7o2Gyz+Er0hcL7N5xrS51ERULzSM0w@mail.gmail.com>

Based on the last email I am not sure if you want to include the
CentralWavelenght and FWHM or not.

On Mon, 2 Sept 2024 at 18:24, Even Rouault <even.rouault at spatialys.com>
wrote:

> ok, so based on all feedback, I guess we could add GCI_PanBand,
> GCI_CoastalBand, GCI_RedEdgeBand, GCI_NIRBand, GCI_SWIRBand,
> GCI_MWIRBand, GCI_LWIRBand, + maybe GCIThermalRBand (that one with
> overlap with MWIR and LWIR), without loosing too much generality + maybe
> GCI_OtherIRBand for whatever other uses ?  I realize we already have a
> GCI_YellowBand, although it is thought for the CMYK color space. Do we
> need a GCI_YellowSpectralBand enumeration value... ?
>
> The documented associated wavelengths range for those constants could be
> the ones of
> https://github.com/stac-extensions/eo?tab=readme-ov-file#common-band-names
> but with a warning that they are indicative only, and some sensors could
> partially intersect the range, and that the wavelength metadata when
> present has precedence.
>
> >
> > In Pix4D, for the radiometric correction needed in the images, we
> > defined this XMP namespace years ago:
> > http://pix4d.com/camera/1.0/
> > There are "Xmp.Camera.CentralWavelength", "Xmp.Camera.WavelengthFWHM"
> > and "Xmp.Camera.BandName". I do not mean that we should do the same,
> > but just an example of how that information was important.
> >
> > One question. The IMAGERY metadata is available only on TIF, or also
> > in other file formats like JPG? I mean without any sidecar.
>
> This is per-se generic, but in practice, only the TIFF driver currently
> fills it from the sidecar files of various metadata producers
> (DigitalGlobe, Pleiades, etc.). It could also be stored in the GDAL
> .aux.xml side car file for any PAM capable driver (the STACIT driver
> could use the STAC eo metadata to also set the new GCI_ constant and the
> wavelength metadata items, when present). The Sentinel2 driver also
> could fill that. As well as the ENVI one when the metadata items are
> present.
>
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240902/ae7e4384/attachment.htm>

From michkowalczuk at gmail.com  Tue Sep  3 02:08:19 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 3 Sep 2024 11:08:19 +0200
Subject: [gdal-dev] WMTS request error
Message-ID: <CAP+FqQDLR53HMs8Bi4xkWNyGgpcM+tVYCPE3GQab1EfNN9EmjA@mail.gmail.com>

Dear GDAL colleagues,

Does GDAL has any http request failure detection, and mechanism for dealing
with it different than raising CPL Error.
Look at the following GDAL log. (Problem explanation after the log)
----------------------------------------------------------------------------------------------------









































*[Tue Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [1/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1>[Tue
Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [2/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2>[Tue
Sep  3 10:54:49 2024].3630, 1228.9130: HTTP: Requesting [3/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3>[Tue
Sep  3 10:54:50 2024].3630, 1229.9130: HTTP: Requesting [4/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4>[Tue
Sep  3 10:54:50 2024].9300, 1230.4800: HTTP: Requesting [5/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5>[Tue
Sep  3 10:54:52 2024].5640, 1232.1140: HTTP: Requesting [6/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6>[Tue
Sep  3 10:54:52 2024].7680, 1232.3180: HTTP: Requesting [7/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7>[Tue
Sep  3 10:54:53 2024].1190, 1232.6690: HTTP: Requesting [8/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8>[Tue
Sep  3 10:54:53 2024].6050, 1233.1550: HTTP: Requesting [9/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9>[Tue
Sep  3 10:54:53 2024].9630, 1233.5130: HTTP: Requesting [10/10]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10>[Tue
Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [0]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1>
: status = 0, type = (null), error = (null)[Tue Sep  3 10:54:54 2024].3000,
1233.8500: HTTP: Request [1]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [2]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [3]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [4]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [5]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [6]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [7]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [8]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3000, 1233.8500: HTTP: Request [9]
https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10
<https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10>
: status = 200, type = image/jpeg, error = (null)[Tue Sep  3 10:54:54
2024].3030, 1233.8530: WMS: ReadBlockFromCache[Tue Sep  3 10:54:54
2024].3040, 1233.8540: CPLError:
C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4:
No such file or directoryERROR 4:
C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4:
No such file or directory[Tue Sep  3 10:54:54 2024].3040, 1233.8540:
CPLError: GDALWMS: Unable to open downloaded block.ERROR 1: GDALWMS: Unable
to open downloaded block.[Tue Sep  3 10:54:54 2024].3040, 1233.8540: WMS:
After ReadBlockFromCache[Tue Sep  3 10:54:54 2024].3040, 1233.8540:
CPLError: GDALWMS: Unable to download block 1, 4.URL:   HTTP status code:
0, error: (null).Add the HTTP status code to <ZeroBlockHttpCodes> to ignore
this error (see http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDALWMS: Unable to download
block 1, 4.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).[Tue
Sep  3 10:54:54 2024].3050, 1233.8550: CPLError: GDAL_WMS>, band 3:
IReadBlock failed at X offset 1, Y offset 4: GDALWMS: Unable to download
block 1, 4.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDAL_WMS>, band 3: IReadBlock
failed at X offset 1, Y offset 4: GDALWMS: Unable to download block 1,
4.URL:   HTTP status code: 0, error: (null).Add the HTTP status code to
<ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).*
----------------------------------------------------------------------------------------------------

I use GDALRasterIO from C API and as we can see GDAL makes 10 requests. One
of these request (*bolded*) ends with error, which generates the "Unable to
open downloaded block." error later.
Is there any method to force a *re-request* in such situations?
This server error occurs randomly and temporarily, and the next attempt
completes without problem.

Regards,
Micha?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240903/65e6f07e/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Sep  3 02:31:41 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 3 Sep 2024 09:31:41 +0000
Subject: [gdal-dev] WMTS request error
In-Reply-To: <CAP+FqQDLR53HMs8Bi4xkWNyGgpcM+tVYCPE3GQab1EfNN9EmjA@mail.gmail.com>
References: <CAP+FqQDLR53HMs8Bi4xkWNyGgpcM+tVYCPE3GQab1EfNN9EmjA@mail.gmail.com>
Message-ID: <DB9PR09MB688797B90AF8A2489C752266FD932@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

I would read https://gdal.org/en/latest/user/configoptions.html and try there 3:

GDAL_HTTP_MAX_RETRY=value: Defaults to 0. Set the number of HTTP attempts, when a retry is allowed. (cf GDAL_HTTP_RETRY_CODES for conditions where a retry is attempted.) The default value is 0, meaning no retry.
GDAL_HTTP_RETRY_DELAY=<seconds>: Defaults to 30. Set the delay between HTTP attempts.
GDAL_HTTP_RETRY_CODES=ALL or comma-separated list of codes: (GDAL >= 3.10) Specify which HTTP error codes should trigger a retry attempt. Valid values are ALL or a comma-separated list of HTTP codes. By default, 429, 500, 502, 503 or 504 HTTP errors are considered, as well as other situations with a particular HTTP or Curl error message.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: tiistai 3. syyskuuta 2024 12.08
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] WMTS request error

Dear GDAL colleagues,

Does GDAL has any http request failure detection, and mechanism for dealing with it different than raising CPL Error.
Look at the following GDAL log. (Problem explanation after the log)
----------------------------------------------------------------------------------------------------
[Tue Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [1/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1
[Tue Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [2/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2
[Tue Sep  3 10:54:49 2024].3630, 1228.9130: HTTP: Requesting [3/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3
[Tue Sep  3 10:54:50 2024].3630, 1229.9130: HTTP: Requesting [4/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4
[Tue Sep  3 10:54:50 2024].9300, 1230.4800: HTTP: Requesting [5/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5
[Tue Sep  3 10:54:52 2024].5640, 1232.1140: HTTP: Requesting [6/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6
[Tue Sep  3 10:54:52 2024].7680, 1232.3180: HTTP: Requesting [7/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7
[Tue Sep  3 10:54:53 2024].1190, 1232.6690: HTTP: Requesting [8/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8
[Tue Sep  3 10:54:53 2024].6050, 1233.1550: HTTP: Requesting [9/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9
[Tue Sep  3 10:54:53 2024].9630, 1233.5130: HTTP: Requesting [10/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [0] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1 : status = 0, type = (null), error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [1] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [2] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [3] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [4] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [5] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [6] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [7] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [8] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [9] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3030, 1233.8530: WMS: ReadBlockFromCache
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: CPLError: C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4: No such file or directory
ERROR 4: C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4: No such file or directory
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: CPLError: GDALWMS: Unable to open downloaded block.
ERROR 1: GDALWMS: Unable to open downloaded block.
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: WMS: After ReadBlockFromCache
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: CPLError: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
ERROR 1: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
[Tue Sep  3 10:54:54 2024].3050, 1233.8550: CPLError: GDAL_WMS>, band 3: IReadBlock failed at X offset 1, Y offset 4: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
ERROR 1: GDAL_WMS>, band 3: IReadBlock failed at X offset 1, Y offset 4: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
----------------------------------------------------------------------------------------------------

I use GDALRasterIO from C API and as we can see GDAL makes 10 requests. One of these request (bolded) ends with error, which generates the "Unable to open downloaded block." error later.
Is there any method to force a re-request in such situations?
This server error occurs randomly and temporarily, and the next attempt completes without problem.

Regards,
Micha?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240903/037e259a/attachment-0001.htm>

From michkowalczuk at gmail.com  Tue Sep  3 05:15:47 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 3 Sep 2024 14:15:47 +0200
Subject: [gdal-dev] WMTS request error
In-Reply-To: <DB9PR09MB688797B90AF8A2489C752266FD932@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQDLR53HMs8Bi4xkWNyGgpcM+tVYCPE3GQab1EfNN9EmjA@mail.gmail.com>
 <DB9PR09MB688797B90AF8A2489C752266FD932@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQAhJpeWF0cxpHp8UuPUe7Ntk6r6pGEsoXK6nYQT_AJU1g@mail.gmail.com>

Thank you, I will test it.
It's a pity that the WMTS documentation doesn't mention it.
The WMTS docs indicates that only 3 options are available for WMTS:
GDAL_MAX_CONNECTIONS, GDAL_ENABLE_WMS_CACHE, GDAL_DEFAULT_WMS_CACHE_PATH (
https://gdal.org/en/latest/drivers/raster/wmts.html#configuration-options).
I guess I still don't have enough experience in navigating the
documentation and using GDAL;-)

Micha? Kowalczuk

wt., 3 wrz 2024 o 11:31 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
napisa?(a):

> Hi,
>
>
>
> I would read https://gdal.org/en/latest/user/configoptions.html and try
> there 3:
>
>
> GDAL_HTTP_MAX_RETRY=value: Defaults to 0. Set the number of HTTP attempts,
> when a retry is allowed. (cf GDAL_HTTP_RETRY_CODES for conditions where a
> retry is attempted.) The default value is 0, meaning no retry.
>
> GDAL_HTTP_RETRY_DELAY=<seconds>: Defaults to 30. Set the delay between
> HTTP attempts.
>
> GDAL_HTTP_RETRY_CODES=ALL or comma-separated list of codes: (GDAL >= 3.10)
> Specify which HTTP error codes should trigger a retry attempt. Valid values
> are ALL or a comma-separated list of HTTP codes. By default, 429, 500, 502,
> 503 or 504 HTTP errors are considered, as well as other situations with a
> particular HTTP or Curl error message.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* tiistai 3. syyskuuta 2024 12.08
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] WMTS request error
>
>
>
> Dear GDAL colleagues,
>
>
>
> Does GDAL has any http request failure detection, and mechanism for
> dealing with it different than raising CPL Error.
>
> Look at the following GDAL log. (Problem explanation after the log)
>
>
> ----------------------------------------------------------------------------------------------------
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *[Tue Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [1/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1>
> [Tue Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [2/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2>
> [Tue Sep  3 10:54:49 2024].3630, 1228.9130: HTTP: Requesting [3/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3>
> [Tue Sep  3 10:54:50 2024].3630, 1229.9130: HTTP: Requesting [4/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4>
> [Tue Sep  3 10:54:50 2024].9300, 1230.4800: HTTP: Requesting [5/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5>
> [Tue Sep  3 10:54:52 2024].5640, 1232.1140: HTTP: Requesting [6/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6>
> [Tue Sep  3 10:54:52 2024].7680, 1232.3180: HTTP: Requesting [7/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7>
> [Tue Sep  3 10:54:53 2024].1190, 1232.6690: HTTP: Requesting [8/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8>
> [Tue Sep  3 10:54:53 2024].6050, 1233.1550: HTTP: Requesting [9/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9>
> [Tue Sep  3 10:54:53 2024].9630, 1233.5130: HTTP: Requesting [10/10]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10>
> [Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [0]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1>
> : status = 0, type = (null), error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [1]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [2]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [3]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [4]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [5]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [6]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [7]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [8]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3000, 1233.8500: HTTP: Request [9]
> https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10
> <https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10>
> : status = 200, type = image/jpeg, error = (null) [Tue Sep  3 10:54:54
> 2024].3030, 1233.8530: WMS: ReadBlockFromCache [Tue Sep  3 10:54:54
> 2024].3040, 1233.8540: CPLError:
> C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4:
> No such file or directory ERROR 4:
> C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4:
> No such file or directory [Tue Sep  3 10:54:54 2024].3040, 1233.8540:
> CPLError: GDALWMS: Unable to open downloaded block. ERROR 1: GDALWMS:
> Unable to open downloaded block. [Tue Sep  3 10:54:54 2024].3040,
> 1233.8540: WMS: After ReadBlockFromCache [Tue Sep  3 10:54:54 2024].3040,
> 1233.8540: CPLError: GDALWMS: Unable to download block 1, 4. URL:   HTTP
> status code: 0, error: (null). Add the HTTP status code to
> <ZeroBlockHttpCodes> to ignore this error (see
> http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).
> ERROR 1: GDALWMS: Unable to download block 1, 4. URL:   HTTP status code:
> 0, error: (null). Add the HTTP status code to <ZeroBlockHttpCodes> to
> ignore this error (see http://www.gdal.org/frmt_wms.html
> <http://www.gdal.org/frmt_wms.html>). [Tue Sep  3 10:54:54 2024].3050,
> 1233.8550: CPLError: GDAL_WMS>, band 3: IReadBlock failed at X offset 1, Y
> offset 4: GDALWMS: Unable to download block 1, 4. URL:   HTTP status code:
> 0, error: (null). Add the HTTP status code to <ZeroBlockHttpCodes> to
> ignore this error (see http://www.gdal.org/frmt_wms.html
> <http://www.gdal.org/frmt_wms.html>). ERROR 1: GDAL_WMS>, band 3:
> IReadBlock failed at X offset 1, Y offset 4: GDALWMS: Unable to download
> block 1, 4. URL:   HTTP status code: 0, error: (null). Add the HTTP status
> code to <ZeroBlockHttpCodes> to ignore this error (see
> http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).*
>
>
> ----------------------------------------------------------------------------------------------------
>
>
>
> I use GDALRasterIO from C API and as we can see GDAL makes 10 requests.
> One of these request (*bolded*) ends with error, which generates the
> "Unable to open downloaded block." error later.
>
> Is there any method to force a *re-request* in such situations?
>
> This server error occurs randomly and temporarily, and the next attempt
> completes without problem.
>
>
>
> Regards,
>
> Micha?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240903/531a0442/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Sep  3 06:27:53 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 3 Sep 2024 13:27:53 +0000
Subject: [gdal-dev] WMTS request error
In-Reply-To: <CAP+FqQAhJpeWF0cxpHp8UuPUe7Ntk6r6pGEsoXK6nYQT_AJU1g@mail.gmail.com>
References: <CAP+FqQDLR53HMs8Bi4xkWNyGgpcM+tVYCPE3GQab1EfNN9EmjA@mail.gmail.com>
 <DB9PR09MB688797B90AF8A2489C752266FD932@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQAhJpeWF0cxpHp8UuPUe7Ntk6r6pGEsoXK6nYQT_AJU1g@mail.gmail.com>
Message-ID: <DB9PR09MB688744E4F85FC22418B6DCD5FD932@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

About navigating the documentation, configuration options are needed very often. Now they are somewhat hidden in the front page https://gdal.org/en/latest/index.html. Maybe Configuration options should appear as a title directly in the table of contents, and not under the title "User", that does not feel so important.

-Jukka Rahkonen-

L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com>
L?hetetty: tiistai 3. syyskuuta 2024 15.16
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] WMTS request error

Thank you, I will test it.
It's a pity that the WMTS documentation doesn't mention it.
The WMTS docs indicates that only 3 options are available for WMTS: GDAL_MAX_CONNECTIONS, GDAL_ENABLE_WMS_CACHE, GDAL_DEFAULT_WMS_CACHE_PATH (https://gdal.org/en/latest/drivers/raster/wmts.html#configuration-options).
I guess I still don't have enough experience in navigating the documentation and using GDAL;-)

Micha? Kowalczuk

wt., 3 wrz 2024 o 11:31 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

I would read https://gdal.org/en/latest/user/configoptions.html and try there 3:

GDAL_HTTP_MAX_RETRY=value: Defaults to 0. Set the number of HTTP attempts, when a retry is allowed. (cf GDAL_HTTP_RETRY_CODES for conditions where a retry is attempted.) The default value is 0, meaning no retry.
GDAL_HTTP_RETRY_DELAY=<seconds>: Defaults to 30. Set the delay between HTTP attempts.
GDAL_HTTP_RETRY_CODES=ALL or comma-separated list of codes: (GDAL >= 3.10) Specify which HTTP error codes should trigger a retry attempt. Valid values are ALL or a comma-separated list of HTTP codes. By default, 429, 500, 502, 503 or 504 HTTP errors are considered, as well as other situations with a particular HTTP or Curl error message.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: tiistai 3. syyskuuta 2024 12.08
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] WMTS request error

Dear GDAL colleagues,

Does GDAL has any http request failure detection, and mechanism for dealing with it different than raising CPL Error.
Look at the following GDAL log. (Problem explanation after the log)
----------------------------------------------------------------------------------------------------
[Tue Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [1/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1
[Tue Sep  3 10:54:47 2024].7930, 1227.3430: HTTP: Requesting [2/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2
[Tue Sep  3 10:54:49 2024].3630, 1228.9130: HTTP: Requesting [3/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3
[Tue Sep  3 10:54:50 2024].3630, 1229.9130: HTTP: Requesting [4/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4
[Tue Sep  3 10:54:50 2024].9300, 1230.4800: HTTP: Requesting [5/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5
[Tue Sep  3 10:54:52 2024].5640, 1232.1140: HTTP: Requesting [6/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6
[Tue Sep  3 10:54:52 2024].7680, 1232.3180: HTTP: Requesting [7/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7
[Tue Sep  3 10:54:53 2024].1190, 1232.6690: HTTP: Requesting [8/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8
[Tue Sep  3 10:54:53 2024].6050, 1233.1550: HTTP: Requesting [9/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9
[Tue Sep  3 10:54:53 2024].9630, 1233.5130: HTTP: Requesting [10/10] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [0] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=1 : status = 0, type = (null), error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [1] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=2 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [2] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=3 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [3] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=4 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [4] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=5 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [5] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=6 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [6] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=7 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [7] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=8 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [8] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=9 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3000, 1233.8500: HTTP: Request [9] https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMTS/StandardResolution?service=WMTS&request=GetTile&version=1.0.0&layer=ORTOFOTOMAPA&style=default&format=image/jpeg&TileMatrixSet=EPSG:4326&TileMatrix=EPSG:4326:5&TileRow=4&TileCol=10 : status = 200, type = image/jpeg, error = (null)
[Tue Sep  3 10:54:54 2024].3030, 1233.8530: WMS: ReadBlockFromCache
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: CPLError: C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4: No such file or directory
ERROR 4: C:\Users\Michal\.cache\gdalwmscache\d03651177815877cffe0faf894690352/0/6/069e88521499910bd8763ede3e0cc2c4: No such file or directory
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: CPLError: GDALWMS: Unable to open downloaded block.
ERROR 1: GDALWMS: Unable to open downloaded block.
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: WMS: After ReadBlockFromCache
[Tue Sep  3 10:54:54 2024].3040, 1233.8540: CPLError: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
ERROR 1: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
[Tue Sep  3 10:54:54 2024].3050, 1233.8550: CPLError: GDAL_WMS>, band 3: IReadBlock failed at X offset 1, Y offset 4: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
ERROR 1: GDAL_WMS>, band 3: IReadBlock failed at X offset 1, Y offset 4: GDALWMS: Unable to download block 1, 4.
URL:
  HTTP status code: 0, error: (null).
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
----------------------------------------------------------------------------------------------------

I use GDALRasterIO from C API and as we can see GDAL makes 10 requests. One of these request (bolded) ends with error, which generates the "Unable to open downloaded block." error later.
Is there any method to force a re-request in such situations?
This server error occurs randomly and temporarily, and the next attempt completes without problem.

Regards,
Micha?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240903/a8d3df65/attachment-0001.htm>

From even.rouault at spatialys.com  Tue Sep  3 10:02:57 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 3 Sep 2024 19:02:57 +0200
Subject: [gdal-dev] Extending GDAL Color Interpretation enumeration for
 infra-red bands (+ band wavelength) ?
In-Reply-To: <CADRrdKvnddsA+PEMzkHX7o2Gyz+Er0hcL7N5xrS51ERULzSM0w@mail.gmail.com>
References: <043bce04-fa2a-417d-b03b-72f9e5333ba1@spatialys.com>
 <CADRrdKtBAQ6R4oY4Kr-19RfH3ksfJB2+zvtTF0QQi0zki0k7Cw@mail.gmail.com>
 <c69ef7ef-b150-44ca-8f61-557af1e565f3@spatialys.com>
 <CADRrdKvnddsA+PEMzkHX7o2Gyz+Er0hcL7N5xrS51ERULzSM0w@mail.gmail.com>
Message-ID: <7e3b9144-5241-44ea-8910-08f92d8918f2@spatialys.com>


Le 02/09/2024 ? 19:07, Javier Jimenez Shaw a ?crit?:
> Based on the last email I am not sure if you want to include the 
> CentralWavelenght and FWHM or not.

yes, candidate implementation in https://github.com/OSGeo/gdal/pull/10721

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From bertelli at chartasrl.eu  Tue Sep  3 14:23:07 2024
From: bertelli at chartasrl.eu (Carlo A. Bertelli (Charta s.r.l.))
Date: Tue, 3 Sep 2024 23:23:07 +0200
Subject: [gdal-dev] IIP: unable to translate if handled by openseadragon
Message-ID: <CALc8-VJ+D6esuSTzSRg4MeKT5uEVDLYDo3KihNAcibxMCPwYTg@mail.gmail.com>

Hello,
I tried to use GDAL to translate an iIIF image:
https://ianua.arianna4.cloud/patrimonio/1ec6a87e-c5ff-4156-a495-9e08f399a6ba/16-carta-topografica-del-territorio-di-serravalle-%5B1804-set-22%5D

OpenSeaDragon disables the direct link to the tiles, substituting it with
an indirect connection to the image server:
https://asge.jarvis.memooria.org/images/iiif/db/d4eca4e9-d5e9-4db7-9586-9ec0ff49d8c4/0,0,2048,2048/256,256/0/default.jpg

I couldn't manage to get something out of it with the IIP WMS micro-driver.

A hint, suggested by the documentation of OpenSeaDragon, led me to:
https://asge.jarvis.memooria.org/images/iiif/db/d4eca4e9-d5e9-4db7-9586-9ec0ff49d8c4/info.json
which is informative:

{
  "@context" : "http://iiif.io/api/image/3/context.json",
  "protocol" : "http://iiif.io/api/image",
  "width" : 8721,
  "height" : 13120,
  "sizes" : [
     { "width" : 136, "height" : 205 },
     { "width" : 272, "height" : 410 },
     { "width" : 545, "height" : 820 },
     { "width" : 1090, "height" : 1640 },
     { "width" : 2180, "height" : 3280 },
     { "width" : 4360, "height" : 6560 }
  ],
  "tiles" : [
     { "width" : 256, "height" : 256, "scaleFactors" : [ 1, 2, 4, 8,
16, 32, 64 ] }
  ],
  "id" : "https://asge.jarvis.memooria.org/images/iiif/db/d4eca4e9-d5e9-4db7-9586-9ec0ff49d8c4",
  "type": "ImageService3",
  "profile" : "level1",
  "maxWidth" : 8000,
  "maxHeight" : 8000,
  "extraQualities": ["color","gray","bitonal"],
  "extraFeatures":
["regionByPct","sizeByForcedWh","sizeByWh","sizeAboveFull","sizeUpscaling","rotationBy90s","mirroring"],
  "service": [
    {
      "@context": "http://iiif.io/api/annex/services/physdim/1/context.json",
      "profile": "http://iiif.io/api/annex/services/physdim",
      "physicalScale": 0.1,
      "physicalUnits": "cm"
    }
  ]

}

But I couldn't go further.

TIA for any help
c

-- 
--------------------------------------------------------------------------
Carlo A. Bertelli
   Charta servizi e sistemi per il territorio e la storia ambientale srl
          Dipendenze del palazzo Doria,
          vc. alla Chiesa della Maddalena 9/2 16124      Genova (Italy)
          tel./fax +39(0)10 2475439  +39 0108566195  mobile:+39 393 1590711
   e-mail: bertelli at chartasrl.eu      http://www.chartasrl.eu
--------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240903/49cb7d65/attachment.htm>

From schwehr at gmail.com  Thu Sep  5 13:10:14 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Thu, 5 Sep 2024 13:10:14 -0700
Subject: [gdal-dev] Driver order for HDF5 versus netCDF
Message-ID: <CACmBxysEtSq2q-MhksyTjXmAucxjd0DGYpfyozbUKT8x12p8vw@mail.gmail.com>

Hi Even,

I'm trying to enable NETCDF_HAS_NC4 in my distribution's copy of GDAL. This
is causing files metadata.h5 to show up as opened with netcdf rather than
hdf5.  I'm way back at 103fdca10 on 2022-Nov-16.

e.g. these

blaze-bin/third_party/gdal/gdalinfo
third_party/gdal/autotest2/python/gdrivers/testdata/hdf5/metadata.h5 | head
-5
Driver: netCDF/Network Common Data Format
Files: third_party/gdal/autotest2/python/gdrivers/testdata/hdf5/metadata.h5
Size is 512, 512
Metadata:
  /G1/NC_GLOBAL#attribute=value


and

blaze-bin/third_party/gdal/gdalinfo
third_party/gdal/autotest2/python/gdrivers/testdata/hdf5/u8be.h5 | head -5
Driver: netCDF/Network Common Data Format
Files: third_party/gdal/autotest2/python/gdrivers/testdata/hdf5/u8be.h5
Size is 5, 6
Corner Coordinates:
Upper Left  (    0.0,    0.0)


Any ideas what could be causing this?

Looking at the expected behavior at GDAL's head, I see this. I think it's
probably fine, but figured I'd ask...

Is there a reason for the order to be different for the drivers in the
DEFERRED section compared to the normal driver registration? Does the order
not matter for DEFERRED?

egrep -i 'netcdf|hdf5' gdalallregister.cpp | egrep -i 'defined|ifdef'
#if defined(DEFERRED_HDF5_DRIVER)
#if defined(DEFERRED_NETCDF_DRIVER)
#ifdef FRMT_netcdf
#ifdef FRMT_hdf5

https://github.com/OSGeo/gdal/blob/ac213a38e748e22c055d3187fd076bcedbe5892a/frmts/gdalallregister.cpp

Thanks,
-Kurt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240905/34aed7e8/attachment.htm>

From even.rouault at spatialys.com  Thu Sep  5 13:22:39 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 5 Sep 2024 22:22:39 +0200
Subject: [gdal-dev] Driver order for HDF5 versus netCDF
In-Reply-To: <CACmBxysEtSq2q-MhksyTjXmAucxjd0DGYpfyozbUKT8x12p8vw@mail.gmail.com>
References: <CACmBxysEtSq2q-MhksyTjXmAucxjd0DGYpfyozbUKT8x12p8vw@mail.gmail.com>
Message-ID: <b66a828d-0f4a-4e12-a784-0a3b7b6e13e1@spatialys.com>

Kurt,


> Looking at the expected behavior at GDAL's head, I see this. I think 
> it's probably fine, but figured I'd ask...

I don't reproduce with master:

$ gdalinfo autotest/gdrivers/data/hdf5/metadata.h5
Driver: HDF5/Hierarchical Data Format Release 5
[...]

$ gdalinfo autotest/gdrivers/data/hdf5/u8be.h5
Driver: HDF5Image/HDF5 Dataset
[...]


>
> Is there a reason for the order?to be different for the drivers in the 
> DEFERRED section compared to the normal driver registration? Does the 
> order not matter for DEFERRED?
>
>
No, that doesn't matter since drivers are re-ordered using the order 
defined in frmts/drivers.ini

But in the netCDF vs HDF5 case, this doesn't matter much since the logic 
in netCDFIdentifyFormat() will skip a HDF5 file if "#ifdef HAVE_HDF5" is 
true and GDALGetDriverByName("HDF5") != nullptr

My guess would be that your build of the netCDF driver lacks -DHAVE_HDF5 
. By the way I'm thinking this check might be incorrect. This HAVE_HDF5 
is if libnetcdf has HDF5 support, but in the context of the check if 
GDALGetDriverByName("HDF5") != nullptr, we don't actually care about the 
capabilities of libnetcdf. It is just that if the HDF5 driver is there, 
we should just use it.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240905/d4512aff/attachment.htm>

From schwehr at gmail.com  Thu Sep  5 14:35:27 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Thu, 5 Sep 2024 14:35:27 -0700
Subject: [gdal-dev] Driver order for HDF5 versus netCDF
In-Reply-To: <b66a828d-0f4a-4e12-a784-0a3b7b6e13e1@spatialys.com>
References: <CACmBxysEtSq2q-MhksyTjXmAucxjd0DGYpfyozbUKT8x12p8vw@mail.gmail.com>
 <b66a828d-0f4a-4e12-a784-0a3b7b6e13e1@spatialys.com>
Message-ID: <CACmBxyujL2Zj0msqg2Ja8mPN7CLdt-ykZbA1SjGdSHOvgh4fXA@mail.gmail.com>

Thanks!!! I'm missing HAVE_HDF5. And it looks like I should set HAVE_HDF4
too as I have that in my build too.

The joys of having to maintain a separate build system...

On Thu, Sep 5, 2024 at 1:22?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Kurt,
>
> Looking at the expected behavior at GDAL's head, I see this. I think it's
> probably fine, but figured I'd ask...
>
> I don't reproduce with master:
>
> $ gdalinfo autotest/gdrivers/data/hdf5/metadata.h5
> Driver: HDF5/Hierarchical Data Format Release 5
> [...]
>
> $ gdalinfo autotest/gdrivers/data/hdf5/u8be.h5
> Driver: HDF5Image/HDF5 Dataset
> [...]
>
>
>
> Is there a reason for the order to be different for the drivers in the
> DEFERRED section compared to the normal driver registration? Does the order
> not matter for DEFERRED?
>
>
> No, that doesn't matter since drivers are re-ordered using the order
> defined in frmts/drivers.ini
>
> But in the netCDF vs HDF5 case, this doesn't matter much since the logic
> in netCDFIdentifyFormat() will skip a HDF5 file if "#ifdef HAVE_HDF5" is
> true and GDALGetDriverByName("HDF5") != nullptr
>
> My guess would be that your build of the netCDF driver lacks -DHAVE_HDF5 .
> By the way I'm thinking this check might be incorrect. This HAVE_HDF5 is if
> libnetcdf has HDF5 support, but in the context of the check if
> GDALGetDriverByName("HDF5") != nullptr, we don't actually care about the
> capabilities of libnetcdf. It is just that if the HDF5 driver is there, we
> should just use it.
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240905/6ccdc5bc/attachment.htm>

From even.rouault at spatialys.com  Fri Sep  6 06:51:51 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 6 Sep 2024 15:51:51 +0200
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
Message-ID: <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>

Hi,

No other reactions? In particular w.r.t. the open question whether it is 
worth to offer a "force" mode in the situations where a dataset cannot 
be re-opened (or for a band whose belonging to a dataset cannot be 
determined) where the thread-safe wrapper would just put a mutex around 
the calls to that dataset/band (so obviously this wouldn't scale with 
the number of threads). I'm probably leaning on not offering this option 
for now, if there's no obvious need it is useful. It can always been 
added afterwards.

Even

Le 29/08/2024 ? 14:26, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I've worked on a new RFC 101: Raster dataset read-only thread-safety: 
> https://github.com/OSGeo/gdal/pull/10676
>
> Summary: This RFC enables users to get instances of GDALDataset (and 
> their related objects such as GDALRasterBand) that are thread-safe for 
> read-only raster operations, that is such instances can be safely used 
> from multiple threads without locking.
>
> It is backed by a preliminary implementation (fairly complete, apart 
> from writing new tests...). There's at least one open question raised 
> in the RFC.
>
> PS: you can see one of the benefits of the migration of the doc to 
> ReadTheDocs hosting, with the preview of the updated documentation in 
> pull requests. So this is a way to mention that the move to RtD 
> hosting has now been completed, with the default version ("latest") 
> reflecting the state of the master branch, as well as the version for 
> the release/3.9 branch. Thanks to Dan Baston (and other people 
> involved) for this work! There might be a few adjustments needed, so 
> if you notice something unusual w.r.t. to the previous state, please 
> file a ticket.
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From schwehr at gmail.com  Fri Sep  6 09:44:43 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 6 Sep 2024 09:44:43 -0700
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
Message-ID: <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>

My take would be to not offer the force option unless there is someone who
states they really need it.

On Fri, Sep 6, 2024 at 6:52?AM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> No other reactions? In particular w.r.t. the open question whether it is
> worth to offer a "force" mode in the situations where a dataset cannot
> be re-opened (or for a band whose belonging to a dataset cannot be
> determined) where the thread-safe wrapper would just put a mutex around
> the calls to that dataset/band (so obviously this wouldn't scale with
> the number of threads). I'm probably leaning on not offering this option
> for now, if there's no obvious need it is useful. It can always been
> added afterwards.
>
> Even
>
> Le 29/08/2024 ? 14:26, Even Rouault via gdal-dev a ?crit :
> > Hi,
> >
> > I've worked on a new RFC 101: Raster dataset read-only thread-safety:
> > https://github.com/OSGeo/gdal/pull/10676
> >
> > Summary: This RFC enables users to get instances of GDALDataset (and
> > their related objects such as GDALRasterBand) that are thread-safe for
> > read-only raster operations, that is such instances can be safely used
> > from multiple threads without locking.
> >
> > It is backed by a preliminary implementation (fairly complete, apart
> > from writing new tests...). There's at least one open question raised
> > in the RFC.
> >
> > PS: you can see one of the benefits of the migration of the doc to
> > ReadTheDocs hosting, with the preview of the updated documentation in
> > pull requests. So this is a way to mention that the move to RtD
> > hosting has now been completed, with the default version ("latest")
> > reflecting the state of the master branch, as well as the version for
> > the release/3.9 branch. Thanks to Dan Baston (and other people
> > involved) for this work! There might be a few adjustments needed, so
> > if you notice something unusual w.r.t. to the previous state, please
> > file a ticket.
> >
> > Even
> >
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240906/82283b72/attachment-0001.htm>

From warmerdam at pobox.com  Fri Sep  6 12:57:15 2024
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Fri, 6 Sep 2024 15:57:15 -0400
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
 <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
Message-ID: <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>

Even,

I'm actually surprised that it is considered impractical to make some/most
drivers thread safe (read-only) natively and I thought key ones already
were mostly there in the past though I'm not so confident in my memory.
 Looking through the GTiff code I find myself not able to work out where
locking is done and how we are managing the directory loading/switching as
block reads are done.

I would certainly like to work towards read-only thread safety for some
drivers with:
 - a shared block cache for all threads reading from a dataset
 - no duplication of file handles per-thread
 - a way of checking that a dataset is considered to be thread safe.

I'm curious if you can talk a bit more about the challenges of
accomplishing the above.   I had been hoping to take advantage of my
(assumption) that this already mostly existed in GDAL for our new high
performance environment at Planet so it is of more than academic interest
to me.  Also, doesn't gdalwarp's multithreading support already depend on
read-only thread safety for source files?

The above said, I can also see some utility in RFC 101 and have no
objection to it.

Best regards,
Frank

On Fri, Sep 6, 2024 at 12:45?PM Kurt Schwehr via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> My take would be to not offer the force option unless there is someone who
> states they really need it.
>
> On Fri, Sep 6, 2024 at 6:52?AM Even Rouault via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi,
>>
>> No other reactions? In particular w.r.t. the open question whether it is
>> worth to offer a "force" mode in the situations where a dataset cannot
>> be re-opened (or for a band whose belonging to a dataset cannot be
>> determined) where the thread-safe wrapper would just put a mutex around
>> the calls to that dataset/band (so obviously this wouldn't scale with
>> the number of threads). I'm probably leaning on not offering this option
>> for now, if there's no obvious need it is useful. It can always been
>> added afterwards.
>>
>> Even
>>
>> Le 29/08/2024 ? 14:26, Even Rouault via gdal-dev a ?crit :
>> > Hi,
>> >
>> > I've worked on a new RFC 101: Raster dataset read-only thread-safety:
>> > https://github.com/OSGeo/gdal/pull/10676
>> >
>> > Summary: This RFC enables users to get instances of GDALDataset (and
>> > their related objects such as GDALRasterBand) that are thread-safe for
>> > read-only raster operations, that is such instances can be safely used
>> > from multiple threads without locking.
>> >
>> > It is backed by a preliminary implementation (fairly complete, apart
>> > from writing new tests...). There's at least one open question raised
>> > in the RFC.
>> >
>> > PS: you can see one of the benefits of the migration of the doc to
>> > ReadTheDocs hosting, with the preview of the updated documentation in
>> > pull requests. So this is a way to mention that the move to RtD
>> > hosting has now been completed, with the default version ("latest")
>> > reflecting the state of the master branch, as well as the version for
>> > the release/3.9 branch. Thanks to Dan Baston (and other people
>> > involved) for this work! There might be a few adjustments needed, so
>> > if you notice something unusual w.r.t. to the previous state, please
>> > file a ticket.
>> >
>> > Even
>> >
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam at pobox.com
light and sound - activate the windows | USA: +1 650-701-7823
<http://voice.google.com/calls?a=nc,%2B16507017823>
<http://voice.google.com/calls?a=nc,%2B16507017823>
and watch the world go round - Rush    | CAN: +1 343-550-9984
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240906/b466db77/attachment.htm>

From even.rouault at spatialys.com  Fri Sep  6 15:34:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 7 Sep 2024 00:34:59 +0200
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
 <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
 <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
Message-ID: <37fbcf09-4bd9-46ce-b543-8d34961e2b0d@spatialys.com>

Frank,

> I'm actually surprised that it is considered impractical to make 
> some/most drivers thread safe (read-only) natively and I thought key 
> ones already were mostly there in the past though I'm not so confident 
> in my memory.
Things have got more sophisticated over time with more deferred loading 
strategies, but I don't think any driver has been close to be 
thread-safe even in read-only scenarios. Except maybe the RasterIO part 
of the RawDataset, which has pretty much no mutable state (if you 
exclude file operations, and anything involving the block cache)
> ?Looking through the GTiff code I find myself not able to work out 
> where locking is done and how we are managing the directory 
> loading/switching as block reads are done.
No locking is done. To be noted that the logic of TIFF directory 
loading/switching changed "a few" years ago. In the previous situation, 
the main dataset and its overview datasets were sharing the same TIFF* 
handle. But that strategy of switching from TIFF directory when 
switching between overview datasets had also a major performance 
drawback of invalidating TIFF bytecount[] and offset[] arrays, which was 
particularly annoying when computing overviews, where that back&forth is 
done consistently. And that inconvenience increased with the size of 
datasets and those arrays. But even if there are now several TIFF* 
handles, they do share the same VSILFILE* underneath, and there's a 
layer between the driver and libtiff to ensure that the file pointer 
position is properly set when activating one TIFF* handle at the 
position it expected, that flushes are done propertly so that one TIFF* 
handle does see a consistent state on disk (for read/write scenarios), etc.
>
> I would certainly like to work towards read-only thread safety for 
> some drivers with:
> ?- a shared block cache for all threads reading from a dataset
That easiest way of doing that would be to put a per-dataset mutex in 
classes GDALHashSetBandBlockCache and GDALArrayBandBlockCache, but that 
would hurt scalability even when several threads try to access different 
blocks at the same time (unless smart things are done to drop the mutex 
as soon as possible)
> ?- no duplication of file handles per-thread

I just don't see how to do that. Even a mutex around file operations 
would not be sufficient since we'd want both Seek()+Read() to be atomic 
per thread. PRead() would solve that, but very few drivers or underlying 
libraries use PRead() (and there's no implementation of it for all file 
systems, like Windows file API which lacks it). Or one would need a 
VSIThreadSafeHandle that would maintain a per-thread position, but that 
would still involves locking around access to the underneath handle.

libtiff itself has a lot of state variables, in its core or in its 
codecs (e.g. the deflate codec has to maintain a zlib handle as a state 
variable if doing partial reads of a tile/strip).? Even getting the 
location of a TIFF tile is not thread-safe when defered 
byteount[]/offset[] array loading is enabled (which is necessary when 
dealing with extremely large remote COGs) since it involves file accesses.

You could raise the point that the GTiff driver does have multi-threaded 
read optimizations, but it takes a lot of precautions to make that 
happening safely, and it has the chance of fully controlling the 
conditions where that happens. So basically it starts by fetching the 
location and size of the needed blocks, then each thread will read the 
needed blocks (either using PRead() if available, or taking a mutex 
around file accesses), create per-thread TIFF* handle, replicating the 
strategic TIFF tags from the main TIFF handle so that the codecs are 
initialized with the appropriate state and using a new 
TIFFReadFromUserBuffer() call that was added in libtiff to decode an 
in-memory encoded buffer (without doing file accesses). And even with 
that, I remember having fixed last year or so a case that I totally 
missed initially, where the block cache accidentally triggered in one of 
those worker thread. So yes, multi-threading is hard to get right.

> ?- a way of checking that a dataset is considered to be thread safe.
Not totally sure to understand what you mean here. The RFC introduces a 
IsThreadSafe() virtual method that a driver can potentially implement 
(only set to true currently by instances of GDALThreadSafeDataset). But 
finding if a driver is thread-safe seems to be a non-solvable/provable 
problem to me, apart from staring at the code for a sufficient long time 
to convince oneself it is actually + adding some torture tests and hope 
they catch most issues. But things can get very complicated if you need 
to test all combinations of virtual methods that can be called...
>
> I'm curious if you can talk a bit more about the challenges of 
> accomplishing the above.? ?I had been hoping to take advantage of my 
> (assumption) that this already mostly existed in GDAL for our new high 
> performance environment at Planet so it is of more than academic 
> interest to me.

Probably that implementing a restricted read-only thread-safe TIFF 
driver, only addressing the common cases of TIFF without all the edge 
cases GDAL and libtiff try to address, for a controlled set of codecs, 
assuming pread() is always available, assuming you always read full 
tiles & strips, re-implementing a very simplified libtiff, and doing it 
"at hand" would be workable. Perhaps also excluding raster queries not 
at a resolution that exactly matches one of the overview level to 
completely by-pass the block cache. But that would be a separate driver, 
with a more restricted set of functionality than our current GDAL 
GeoTIFF driver that handles all the possible cases.

> ? Also, doesn't gdalwarp's multithreading support already depend on 
> read-only thread safety for source files?

Definitely not. The initial -multi mode works with 2 threads: one for 
I/O, one for compute. The later was further extended to also 
multi-thread the compute part. But I/O is still done by a single thread, 
hence no requirement on the thread-safety of drivers.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240907/7e9e17af/attachment-0001.htm>

From warmerdam at pobox.com  Fri Sep  6 20:33:28 2024
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Fri, 6 Sep 2024 23:33:28 -0400
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <37fbcf09-4bd9-46ce-b543-8d34961e2b0d@spatialys.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
 <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
 <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
 <37fbcf09-4bd9-46ce-b543-8d34961e2b0d@spatialys.com>
Message-ID: <CA+YzLBeoC4qx8dSxe8s_TV5if8+AJf_do3qs8Du_LLkRLVSLGg@mail.gmail.com>

On Fri, Sep 6, 2024 at 6:35?PM Even Rouault <even.rouault at spatialys.com>
wrote:

>  Looking through the GTiff code I find myself not able to work out where
> locking is done and how we are managing the directory loading/switching as
> block reads are done.
>
> No locking is done. To be noted that the logic of TIFF directory
> loading/switching changed "a few" years ago. In the previous situation, the
> main dataset and its overview datasets were sharing the same TIFF* handle.
> But that strategy of switching from TIFF directory when switching between
> overview datasets had also a major performance drawback of invalidating
> TIFF bytecount[] and offset[] arrays, which was particularly annoying when
> computing overviews, where that back&forth is done consistently.
>

Even,

Ah, good!

...

> I would certainly like to work towards read-only thread safety for some
> drivers with:
>  - a shared block cache for all threads reading from a dataset
>
> That easiest way of doing that would be to put a per-dataset mutex in
> classes GDALHashSetBandBlockCache and GDALArrayBandBlockCache, but that
> would hurt scalability even when several threads try to access different
> blocks at the same time (unless smart things are done to drop the mutex as
> soon as possible)
>

For read-only purposes I would have thought we only had to briefly seize a
mutex when introducing new blocks into the cache, and I thought there was
already some sort of lock around that.

 - no duplication of file handles per-thread
>
> I just don't see how to do that. Even a mutex around file operations would
> not be sufficient since we'd want both Seek()+Read() to be atomic per
> thread.
>
I do agree that we would need a mutex containing both the seek and read for
a block read.  Also, on reflection I can see that this could add a lot of
condition as the mutex would be held for very long periods of time and it
would intefere with the ability to do parallel reads on filesystems where
that is possible (I have to get out of a "file system is a single spinning
disk" mindset).  So perhaps I'm not so attached to the avoiding per-thread
file descriptors though I'm not sure per thread file descriptors would
always be the right answer.

...

libtiff itself has a lot of state variables, in its core or in its codecs
> (e.g. the deflate codec has to maintain a zlib handle as a state variable
> if doing partial reads of a tile/strip).  Even getting the location of a
> TIFF tile is not thread-safe when defered byteount[]/offset[] array loading
> is enabled (which is necessary when dealing with extremely large remote
> COGs) since it involves file accesses.
>
I can see the point though it is not clear this can't be addressed, and
that it wouldn't be a useful thing in libtiff.

 - a way of checking that a dataset is considered to be thread safe.
>
> Not totally sure to understand what you mean here. The RFC introduces a
> IsThreadSafe() virtual method that a driver can potentially implement (only
> set to true currently by instances of GDALThreadSafeDataset).
>

Yes, this is what I meant, and it would be the driver implementor
indicating they believe the driver to be threadsafe (or at least that
dataset).



> But finding if a driver is thread-safe seems to be a non-solvable/provable
> problem to me, apart from staring at the code for a sufficient long time to
> convince oneself it is actually + adding some torture tests and hope they
> catch most issues. But things can get very complicated if you need to test
> all combinations of virtual methods that can be called.
>

...

>   Also, doesn't gdalwarp's multithreading support already depend on
> read-only thread safety for source files?
>
> Definitely not. The initial -multi mode works with 2 threads: one for I/O,
> one for compute. The later was further extended to also multi-thread the
> compute part. But I/O is still done by a single thread, hence no
> requirement on the thread-safety of drivers.
>

Yes, this occurred to me thinking about it a bit later in the day.

Thanks for your extended answer.   I'll need to spend some more time
digesting.  In any event, I am supportive of the proposed RFC and
implementation.

Best regards,
Frank

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam at pobox.com
light and sound - activate the windows | USA: +1 650-701-7823
<http://voice.google.com/calls?a=nc,%2B16507017823>
<http://voice.google.com/calls?a=nc,%2B16507017823>
and watch the world go round - Rush    | CAN: +1 343-550-9984
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240906/02778877/attachment.htm>

From lnicola at dend.ro  Fri Sep  6 23:11:17 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Sat, 07 Sep 2024 09:11:17 +0300
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <37fbcf09-4bd9-46ce-b543-8d34961e2b0d@spatialys.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
 <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
 <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
 <37fbcf09-4bd9-46ce-b543-8d34961e2b0d@spatialys.com>
Message-ID: <b09d8f8f-88e3-42b2-b13e-8a63d27cd862@betaapp.fastmail.com>

Hi,

On Sat, Sep 7, 2024, at 01:34, Even Rouault via gdal-dev wrote:
> I just don't see how to do that. Even a mutex around file operations would not be sufficient since we'd want both Seek()+Read() to be atomic per thread. PRead() would solve that, but very few drivers or underlying libraries use PRead() (and there's no implementation of it for all file systems, like Windows file API which lacks it). Or one would need a VSIThreadSafeHandle that would maintain a per-thread position, but that would still involves locking around access to the underneath handle.
> 
Coming back to this, there are two ways to get something similar to pread() on Windows:

 - passing an OVERLAPPED struct to ReadFile without setting FILE_FLAG_OVERLAPPED. This is still synchronous [1], but reads from the offset you've specified. Unlike pread(), it updates the file pointer position on return, so it doesn't mix well with concurrent reads that don't pass in an offset.
 - mapping the file in memory and implementing it with memcpy(). It does incur an extra copy vs. pure mmap, but I don't think it's too bad [2]. Unfortunately, it's not great on 32-bit systems [3].

Laurentiu

[1] I don't want to be the one to open that can of worms
[2] I haven't used Windows in a while, but on Linux memcpy() uses SIMD, but copying memory between the kernel and the user doesn't
[3] Windows 11 dropped 32-bit CPU support, but 32-bit apps will still run
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240907/10d6fd5a/attachment.htm>

From even.rouault at spatialys.com  Sat Sep  7 07:49:16 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 7 Sep 2024 16:49:16 +0200
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <CA+YzLBeoC4qx8dSxe8s_TV5if8+AJf_do3qs8Du_LLkRLVSLGg@mail.gmail.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
 <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
 <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
 <37fbcf09-4bd9-46ce-b543-8d34961e2b0d@spatialys.com>
 <CA+YzLBeoC4qx8dSxe8s_TV5if8+AJf_do3qs8Du_LLkRLVSLGg@mail.gmail.com>
Message-ID: <739d28c8-b3df-479a-b1ff-cbfd99fc9ca8@spatialys.com>


>
> For read-only purposes I would have thought we only had to briefly 
> seize a mutex when introducing new blocks into the cache, and I 
> thought there was already some sort of lock around that.

When talking about the block cache, one needs to distinguish:

- the global least-recently-used (LRU) list of GDALRasterBlock* 
pointers, used by all datasets, that has indeed a lock since it is used 
already in a multi-threaded context

- GDALRasterBlock which have an atomic counter aimed at coordinating 
this LRU list with the below mentionned per-band data structures, to 
avoid in particular eviction from the LRU due to the max size of the 
block cache being reached and dataset closing to badly interfere

- per-band data structures ( either as an array of array, or a hash-set 
(for very large datasets)) that own GDALRasterBlock* instances, Those 
don't do any locking around access to those structures. Well, actually, 
careful observers would object that I'm lying here. There is a "secret" 
mutex per GDALDataset* instance, used currently only for datasets opened 
in update mode and taken in the non-virtual RasterIO() method, that 
addresses complex cases where the LRU logic would try to evict from a 
thread T2 a "dirty" block, causing IWriteBlock() to be called, while a 
thread T1 would IReadBlock() on the same dataset. That mutex actually 
leads to "interesting" issues with deadlocks with the mutex of the 
global LRU, which lead to some subtelties in the GetLockedBlockRef() 
implementation (cf lines 1960-1983 of gdalrasterband.cpp) Which would 
lead to another interesting discussion on the fact that for scenarios 
where multi-threaded writing of *different dataset* the current 
architecture of a global LRU is inefficient and would need to probably 
be replaced by a per-dataset LRU.

I agree that the per-band data structures could be made thread-safe with 
careful use of a mutex. One tricky point would remain if 2 threads try 
to access at the same time a block that hasn't been loaded yet in the 
cache (although an algorithm fully optimized for threading should really 
try to avoid accessing the same block from multiple threads)

2 possible strategies:

- each thread actually IReadBlock() (assuming that its implementation is 
thread-safe) the block and at the time they call AdoptBlock(), insertion 
in the data structure is locked, and only the first "version" 
of?GDALRasterBlock is kept, and the one that arrives later is deleted. 
But one should make sure there's no risk of use-after-free.

- a more complex mechanism is used so that it is "noted somewhere" that 
block (xoff, yoff) is in loading and that the thread that arrives second 
is paused upon completion of the loading. That solution is more 
respectful of total CPU power consumption, but maybe less efficient in 
term of throughput.


>
>>     ?- no duplication of file handles per-thread
>
>     I just don't see how to do that. Even a mutex around file
>     operations would not be sufficient since we'd want both
>     Seek()+Read() to be atomic per thread.
>
> I do agree that we would need a mutex containing both the seek and 
> read for a block read.? Also, on reflection I can see that this could 
> add a lot of condition as the mutex would be held for very long 
> periods of time and it would intefere?with the ability to do parallel 
> reads on filesystems where that is possible (I have to get out of a 
> "file system is a single spinning disk" mindset).? So perhaps I'm not 
> so attached to the avoiding per-thread file descriptors though I'm not 
> sure per thread file descriptors would always be the right answer.

One indeed needs to have in mind also the case of /vsicurl/ and friends 
where read operations are very slow, so locking isn't acceptable. That 
said /vsicurl/ in recent GDAL versions has a PRead() implementation 
(which must be used with care, because currently it doesn't do any 
caching, and if you ask to read 1 byte, it will issue a HTTP GET Range 
request for 1 byte, contrary to standard Read() that reads by chunks of 
16 kB and cache them)


> ...
>
>     libtiff itself has a lot of state variables, in its core or in its
>     codecs (e.g. the deflate codec has to maintain a zlib handle as a
>     state variable if doing partial reads of a tile/strip).? Even
>     getting the location of a TIFF tile is not thread-safe when
>     defered byteount[]/offset[] array loading is enabled (which is
>     necessary when dealing with extremely large remote COGs) since it
>     involves file accesses.
>
> I can see the point though it is not clear this can't be addressed, 
> and that it wouldn't be a useful thing in libtiff.

Taking a step back, I can't think of any popular image library which 
fills a similar role to libtiff (that is a libpng, libjpeg, openjpeg, 
libwebp, libjxl, etc etc.) that is thread-safe. For most of them 
(libpng, libjpeg, libwebp), partly because they implement scanline based 
streamed reading logic, where the PNG/JPEG/etc. handle holds obviously a 
mutable state, by API design. libjxl returns a fully decoded image, but 
has somehow an incremental decoding API. openjpeg could be the one that 
is the closest to libtiff situation, where one - in theory - could 
decode different regions in parallel, but there's mutable state involved 
underneath (including a state machine).

I would expect great (and, for once, justified) resistance & scepticism 
from libtiff community members to add thread-safety into it. A 
thread-safe TIFF reader would be more a separate library, or at least a 
clearly identified separate component within libtiff with a specific 
namespace. (*)

Even

(*) It could be argued that coding it in C wouldn't be the best idea. 
I've spotted a TIFF Rust library 
(https://github.com/image-rs/image-tiff) but it is functionally limited 
(at least in terms of supported codecs. didn't check thourougly) and 
also associates the TIFF "object" with a file reader with read+seek 
capabilities, and thus methods like read_chunk() 
(https://github.com/image-rs/image-tiff/blob/6dc7a266d30291db1e706c8133357931f9e2a053/src/decoder/mod.rs#L1012) 
take a mutable self reference, making it incompatible of thread-safety. 
So probably a C (or C++) library written and designed with thread-safety 
in mind from the start would probably the most reasonable option for a 
GDAL use case.

-- 

http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240907/6cba0655/attachment-0001.htm>

From michkowalczuk at gmail.com  Sat Sep  7 13:08:13 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Sat, 7 Sep 2024 22:08:13 +0200
Subject: [gdal-dev] WMTS improve performance
Message-ID: <CAP+FqQAiXReR_md2beuqyR2pAOTEhv34foEXNPJ+p=jr52D-rw@mail.gmail.com>

Dear GDAL friends,
I'm looking for tips & tricks for improving performance when working with
WMTS services.
As I mentioned in previous mails, I work with GDAL C API.
My main task is to generate image for a given extent and defined output
image size (WxH).
I convert this extent to appropriate offset and source window size.
Using GDALDatasetRasterIO and pBuffer I create bitmap in required format.
This method is different from what I see in, for example, QGIS, where each
tile is paint individually when it is ready (downloaded).
My first idea is to create N connections with the WMTS server and divide
the desired extent into smaller parts and run process in N threads, but it
stink of problems for gdalwmscache manager if independent connections
download the same tile and try to save it on a disk.

Is my idea a good direction?
I would like to ask more experienced users for some advice on this topic :-)

Regards,
Micha?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240907/acfd2b55/attachment.htm>

From lnicola at dend.ro  Sat Sep  7 23:15:55 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Sun, 08 Sep 2024 09:15:55 +0300
Subject: [gdal-dev] Call for review on RFC 101: Raster dataset read-only
 thread-safety
In-Reply-To: <739d28c8-b3df-479a-b1ff-cbfd99fc9ca8@spatialys.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
 <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
 <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
 <37fbcf09-4bd9-46ce-b543-8d34961e2b0d@spatialys.com>
 <CA+YzLBeoC4qx8dSxe8s_TV5if8+AJf_do3qs8Du_LLkRLVSLGg@mail.gmail.com>
 <739d28c8-b3df-479a-b1ff-cbfd99fc9ca8@spatialys.com>
Message-ID: <90d67845-dca4-43f9-8d62-e80be55ea7ba@betaapp.fastmail.com>


On Sat, Sep 7, 2024, at 17:49, Even Rouault via gdal-dev wrote:
> It could be argued that coding it in C wouldn't be the best idea. I've spotted a TIFF Rust library (https://github.com/image-rs/image-tiff) but it is functionally limited (at least in terms of supported codecs. didn't check thourougly) and also associates the TIFF "object" with a file reader with read+seek capabilities, and thus methods like read_chunk() (https://github.com/image-rs/image-tiff/blob/6dc7a266d30291db1e706c8133357931f9e2a053/src/decoder/mod.rs#L1012) take a mutable self reference, making it incompatible of thread-safety.
I think there are two aspects to this:

 - few image Rust libraries are going to be as battle-hardened as libtiff. People just started working on competing implementations because they had a need or they wanted to, but didn't implement any advanced features, or they moved on to other projects. I think tiff, for example, doesn't support writing tiled images [1]. The API is just what happened to be required, but it can still change, more easily than that of libtiff [2]
 - however, the decoder is generic over the input stream, so it can be used even today with a pread/mmap wrapper over a reference-counted file handle (you could point multiple decoders to the same file)

Laurentiu

[1] https://github.com/image-rs/image-tiff/issues/205
[2] the Rust community is more tolerant of breaking changes because the tooling makes them less of a problem
[3] https://docs.rs/tiff/latest/tiff/decoder/struct.Decoder.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240908/8f40d039/attachment.htm>

From sean.turner at koboldmetals.com  Mon Sep  9 07:06:33 2024
From: sean.turner at koboldmetals.com (Sean Turner)
Date: Mon, 9 Sep 2024 10:06:33 -0400
Subject: [gdal-dev] RANGE Requests on large Rasters with CDN (AWS Cloudfront)
Message-ID: <CAFbUFDttOd_MRpa4xYL7FC+rsJopECvwGa-8q8YmjSnERFkf3w@mail.gmail.com>

Hi all,

Curious if anyone is doing something similar.

We've got our data in an S3 Bucket that is fronted by Cloudfront. From
there we can use the GDAL `GDAL_HTTP_HEADER_FILE` environment variable to
point to a file containing Cloudfront signed cookies (which control access
to files within Cloudfront).

Cloudfront supports a maximum file size of 50gb. Trying to add a raster
layer that is greater than 50gb immediately results in an error.

Is anyone doing something similar and have a work around? AWS Documentation
mentions RANGE requests where a range of incremental 50gb are requested
from Cloudfront and downloaded simultaneously. Is this supported by GDAL
(QGIS)?

Otherwise also considering using a VRT?
https://gdal.org/en/latest/drivers/raster/vrt.html

Open to any and all suggestions!

Cheers. Also, sorry I haven't done one of these mailing lists before,
apologies if this submission is in the wrong place.

All the best,
Sean
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240909/8778524f/attachment.htm>

From michkowalczuk at gmail.com  Mon Sep  9 07:17:50 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Mon, 9 Sep 2024 16:17:50 +0200
Subject: [gdal-dev] WMS supported SRS
Message-ID: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>

Hi,
Does GDAL provides a method to get supported spatial reference systems by
WMS service?
*GDALGetMetadata(SUBDATASETS) *generate links only for the first (default)
SRS from GetCapabilities, so this won't be helpful.
Working with WFS I can get supported SRS using OGR
*OGR_L_GetSupportedSRSList *function.
Does GDAL offers something similar for WMS, or should I get this
information from GetCapabilities XML by myself?

Regards,
Michal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240909/1d4fd11d/attachment.htm>

From even.rouault at spatialys.com  Mon Sep  9 07:24:30 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 9 Sep 2024 16:24:30 +0200
Subject: [gdal-dev] RANGE Requests on large Rasters with CDN (AWS
 Cloudfront)
In-Reply-To: <CAFbUFDttOd_MRpa4xYL7FC+rsJopECvwGa-8q8YmjSnERFkf3w@mail.gmail.com>
References: <CAFbUFDttOd_MRpa4xYL7FC+rsJopECvwGa-8q8YmjSnERFkf3w@mail.gmail.com>
Message-ID: <3cc75889-cf8a-407a-bc0f-7f1736937a43@spatialys.com>

Sean

I'm not familiar with Cloudfront specifics, but reading 
https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/RangeGETs.html, 
my understanding is that while Cloudfront will not attempt at caching 
files larger than 50 GB, it is able to forward HTTP Get Range requests 
smaller than 50 GB to the origin. And you would have to design a 
particularly unfriendly file for GDAL to have to download chunks of > 50 
GB !

Otherwise yes the strategy of using a VRT mosaicing tiles < 50 GB each 
should work fine if you want to benefit from Cloudfront caching. The 
easiest to tile your raster is to use gdal_retile, but be careful to 
make sure each tile fit into RAM (as gdal_retile reads & writes each 
tiles in a single time). To create large tiles, you'll rather have to 
use gdal_translate -srcwin in a loop iterating over raster coordinates.

Even

Le 09/09/2024 ? 16:06, Sean Turner via gdal-dev a ?crit?:
> Hi all,
>
> Curious if anyone is doing something similar.
>
> We've got our data in an S3 Bucket that is fronted by Cloudfront. From 
> there we can use the GDAL `GDAL_HTTP_HEADER_FILE` environment?variable 
> to point to a file containing Cloudfront signed cookies (which 
> control?access to files within Cloudfront).
>
> Cloudfront supports a maximum file size of 50gb. Trying to add a 
> raster layer that is greater than 50gb immediately results in an error.
>
> Is anyone doing something similar and have a work around? AWS 
> Documentation mentions RANGE requests where a range of incremental 
> 50gb are requested from Cloudfront and downloaded simultaneously. Is 
> this supported by GDAL (QGIS)?
>
> Otherwise also considering using a VRT? 
> https://gdal.org/en/latest/drivers/raster/vrt.html
>
> Open to any and all suggestions!
>
> Cheers. Also, sorry?I haven't done one of these mailing lists before, 
> apologies if this submission?is in the wrong place.
>
> All the best,
> Sean
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From Ethan.Payne at parrylabs.com  Mon Sep  9 09:23:10 2024
From: Ethan.Payne at parrylabs.com (Ethan Payne)
Date: Mon, 9 Sep 2024 16:23:10 +0000
Subject: [gdal-dev] Is there a FACE Conformant version of GDAL and its DTED
 drivers?
Message-ID: <SA1P110MB14396E87010FC757B7C332D5FA99A@SA1P110MB1439.NAMP110.PROD.OUTLOOK.COM>

Hi,

I'm currently assisting with a project that involves using DTED files to analyze terrain and elevation. As this project adheres to the FACE Technical Standard and must meet FACE Conformance requirements, I wanted to inquire whether there is a version of GDAL configured to comply with the FACE Technical Standard.

Any guidance or recommendations you can provide would be greatly appreciated. Thank you for your time.

Best Regards,
---
Ethan Payne

________________________________
The information contained in this e-mail and any attachments from Parry Labs may contain confidential and/or proprietary information, and is intended only for the named recipient to whom it was originally addressed. If you are not the intended recipient, any disclosure, distribution, or copying of this e-mail or its attachments is strictly prohibited.   If you have received this e-mail in error, please notify the sender immediately by return e-mail and permanently delete the e-mail and any attachments.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240909/c7f7d02c/attachment.htm>

From matt.luck at noaa.gov  Mon Sep  9 10:29:25 2024
From: matt.luck at noaa.gov (Matt Luck - NOAA Affiliate)
Date: Mon, 9 Sep 2024 17:29:25 +0000
Subject: [gdal-dev] Upgrade or remove Java JDK 17 in GDAL Docker image
Message-ID: <CO1PR10MB457818D07657F4627A20DD06FE992@CO1PR10MB4578.namprd10.prod.outlook.com>

Hi, our IT department has detected a security vulnerability in the Java JDK version 17 that's installed in the ubuntu-full docker image (see message below). I am able to remove the Java files from the Docker image via the Dockerfile and I've tried changing the `JAVA_VERSION` in the Dockerfile, but there always seems to be a reference remaining in the Docker diff files that I can't seem to get rid of.

To reproduce:
A `docker system prune -a -f`, then `sudo find /var/lib/docker/overlay2 -type d -name java-17-openjdk-amd64` finds nothing, but then `docker pull ghcr.io/osgeo/gdal:ubuntu-full-3.9.1` followed by `sudo find /var/lib/docker/overlay2 -type d -name java-17-openjdk-amd64` finds:
/var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/lib/jvm/java-17-openjdk-amd64
/var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/lib/debug/usr/lib/jvm/java-17-openjdk-amd64
/var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/share/gdb/auto-load/usr/lib/jvm/java-17-openjdk-amd64

Because they're diff files, those files exist whether or not they're actually in the container and thus the vulnerability is always triggered. Is there a solution and/or a way to either upgrade the Java version or remove Java entirely if it's not needed so that we can deal with this issue in the future?

On Mon, Jul 8, 2024 at 10:21?AM X wrote:
All,

Please see the vulns below and remediate as soon as possible. These are in containers.

Path              : /var/lib/docker/overlay2/48c2e3da9fc2282822d4522e28ca46788f5357a14a8a38f687e2cadbf9de68d7/diff/usr/lib/jvm/java-17-openjdk-amd64/
  Installed version : 17.0.8
  Fixed version     : Upgrade to a version greater than 17.0.10

Path              : /var/lib/docker/overlay2/4aed72b0f0433c615afe67854c8c79bb7acca2fb01216bf6be25774180266f4d/diff/usr/lib/jvm/java-17-openjdk-amd64/
  Installed version : 17.0.8
  Fixed version     : Upgrade to a version greater than 17.0.10

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240909/5bc7f3cd/attachment-0001.htm>

From gdt at lexort.com  Mon Sep  9 10:49:49 2024
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 09 Sep 2024 13:49:49 -0400
Subject: [gdal-dev] Is there a FACE Conformant version of GDAL and its
 DTED drivers?
In-Reply-To: <SA1P110MB14396E87010FC757B7C332D5FA99A@SA1P110MB1439.NAMP110.PROD.OUTLOOK.COM>
 (Ethan Payne via gdal-dev's message of "Mon, 9 Sep 2024 16:23:10
 +0000")
References: <SA1P110MB14396E87010FC757B7C332D5FA99A@SA1P110MB1439.NAMP110.PROD.OUTLOOK.COM>
Message-ID: <rmih6aolnsy.fsf@s1.lexort.com>

Ethan Payne via gdal-dev <gdal-dev at lists.osgeo.org> writes:

> I'm currently assisting with a project that involves using DTED files
> to analyze terrain and elevation. As this project adheres to the FACE
> Technical Standard and must meet FACE Conformance requirements, I
> wanted to inquire whether there is a version of GDAL configured to
> comply with the FACE Technical Standard.

I have been on the gdal list for many years and also have considerable
familiarity with US government software development and procurement
practices.  I had never heard of the FACE Technical Standard before your
message.  Having looked it up, my guess is that no one contributing to
gdal has heard of it either.  I was also not aware of TOG working in
this area.

It seems that even looking at this document requires registering, and
that usually does not go over well in the Free Software world.

Free Software projects are essentially never willing to perform
evaluations against standards like this and to claim conformance.

> Any guidance or recommendations you can provide would be greatly
> appreciated. Thank you for your time.

I am guessing that you are breaking new ground with this requirement,
and I suspect you need a consultant skilled in writing documents about
how particular open-source source software versions meet the
requirements in standards defined by the military-industrial complex,
essentially providing a conformance certification service.

My other advice is to avoid requests for help, that, if help were
provided by someone not in the US, would constitute providing a defense
service under the laws of their jurisdiction.  I realize you are almost
certainly well trained in ITAR compliance; my point is to think about
when the shoe is on the other foot.

Greg

From even.rouault at spatialys.com  Mon Sep  9 10:56:12 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 9 Sep 2024 19:56:12 +0200
Subject: [gdal-dev] Upgrade or remove Java JDK 17 in GDAL Docker image
In-Reply-To: <CO1PR10MB457818D07657F4627A20DD06FE992@CO1PR10MB4578.namprd10.prod.outlook.com>
References: <CO1PR10MB457818D07657F4627A20DD06FE992@CO1PR10MB4578.namprd10.prod.outlook.com>
Message-ID: <5e73612d-0235-4436-a27b-eb302019e6b7@spatialys.com>

Matt,


Several potential solutions:


1) Regenerate the Docker image from sources:


git clone https://github.com/OSGeo/gdal

cd gdal

./docker/ubuntu-full/build.sh


2) Same as 1), but before edit ./docker/ubuntu-full/Dockerfile to remove 
all traces of java/jdk from it


3) Use the existing image, remove the openjdk package, and "flatten" the 
Docker layers with docker export / docker import (cf 
https://forums.docker.com/t/how-to-flatten-an-image-with-127-parents/1600/2), 
so that the layer where it was installed disappears


4) Wait a couple hours while I'm regenerating it to be updated to 
17.0.12+7-1ubuntu2~24.04


Even


Le 09/09/2024 ? 19:29, Matt Luck - NOAA Affiliate via gdal-dev a ?crit?:
> Hi, our IT department has detected a security vulnerability in the 
> Java JDK version 17 that's installed in the ubuntu-full docker image 
> (see message below). I am able to remove the Java files from the 
> Docker image via the Dockerfile and I've tried changing the 
> `JAVA_VERSION` in the Dockerfile, but there always seems to be a 
> reference remaining in the Docker diff files that I can't seem to get 
> rid of.
>
> To reproduce:
> A `docker system prune -a -f`, then `sudo find 
> /var/lib/docker/overlay2 -type d -name java-17-openjdk-amd64` finds 
> nothing, but then `docker pull ghcr.io/osgeo/gdal:ubuntu-full-3.9.1` 
> followed by?`sudo find /var/lib/docker/overlay2 -type d -name 
> java-17-openjdk-amd64`?finds:
> /var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/lib/jvm/java-17-openjdk-amd64
> /var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/lib/debug/usr/lib/jvm/java-17-openjdk-amd64
> /var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/share/gdb/auto-load/usr/lib/jvm/java-17-openjdk-amd64
>
> Because they're diff files, those files exist whether or not they're 
> actually in the container and thus the vulnerability is always 
> triggered. Is there a solution and/or a way to either upgrade the Java 
> version or remove Java entirely if it's not needed so that we can deal 
> with this issue in the future?
>
> On Mon, Jul 8, 2024 at 10:21?AM X wrote:
>
>     All,
>
>     Please see the vulns below and remediate as soon as possible.
>     These are in containers.
>
>     Path ? ? ? ? ? ? ?:
>     /var/lib/docker/overlay2/48c2e3da9fc2282822d4522e28ca46788f5357a14a8a38f687e2cadbf9de68d7/diff/usr/lib/jvm/java-17-openjdk-amd64/
>     ? Installed version : 17.0.8
>     ? Fixed version ? ? : Upgrade to a version greater than 17.0.10
>
>     Path ? ? ? ? ? ? ?:
>     /var/lib/docker/overlay2/4aed72b0f0433c615afe67854c8c79bb7acca2fb01216bf6be25774180266f4d/diff/usr/lib/jvm/java-17-openjdk-amd64/
>     ? Installed version : 17.0.8
>     ? Fixed version ? ? : Upgrade to a version greater than 17.0.10
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240909/007682b2/attachment.htm>

From j1 at jimenezshaw.com  Mon Sep  9 13:55:29 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 9 Sep 2024 22:55:29 +0200
Subject: [gdal-dev] s3 request example
Message-ID: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>

Hi

I am experiencing a much slower load of a remote COG using vsis3 with the
QGIS from conda than the QGIS in my Ubuntu (that uses GDAL 3.4.1).

Because both are QGIS 3.38, I think the problem is in the version of GDAL.
I would like to research it more.

Is there any example of a (big) COG file in Amazon S3 I can use to compare
them? Unfortunately the credentials for the files I am using expire after a
few hours, so they are useless to report anything.

Best regards,
Javier
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240909/9fc8411b/attachment.htm>

From dpmayer at usgs.gov  Mon Sep  9 14:49:17 2024
From: dpmayer at usgs.gov (Mayer, David P)
Date: Mon, 9 Sep 2024 21:49:17 +0000
Subject: [gdal-dev] [EXTERNAL]  s3 request example
In-Reply-To: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
Message-ID: <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>

Would ~200 GB be large enough?

Here is a mosaic of a section of Mars at 6 meters/pixel in a public S3 bucket:
s3://asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif

Cheers,
David

-----------
David Mayer
Geographer
Astrogeology Science Center
US Geological Survey
dpmayer at usgs.gov
________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Javier Jimenez Shaw via gdal-dev <gdal-dev at lists.osgeo.org>
Sent: Monday, September 9, 2024 13:55
To: gdal dev <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] [gdal-dev] s3 request example




 This email has been received from outside of DOI - Use caution before clicking on links, opening attachments, or responding.



Hi

I am experiencing a much slower load of a remote COG using vsis3 with the QGIS from conda than the QGIS in my Ubuntu (that uses GDAL 3.4.1).

Because both are QGIS 3.38, I think the problem is in the version of GDAL.
I would like to research it more.

Is there any example of a (big) COG file in Amazon S3 I can use to compare them? Unfortunately the credentials for the files I am using expire after a few hours, so they are useless to report anything.

Best regards,
Javier
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240909/aa86e3fd/attachment.htm>

From shawn.fox at baesystems.us  Mon Sep  9 17:55:32 2024
From: shawn.fox at baesystems.us (Fox, Shawn D (US))
Date: Tue, 10 Sep 2024 00:55:32 +0000
Subject: [gdal-dev] Upgrading to GDAL 3.4.2 from 1.10.0 shows different
 outputs from gdaltransform and corresponding C++ API
In-Reply-To: <mailman.215132.1724689610.32175.gdal-dev@lists.osgeo.org>
Message-ID: <mailman.7.1725929801.32172.gdal-dev@lists.osgeo.org>

Evan,

Thanks for putting some time into that response and showing some examples.  Perhaps I should clarify exactly how our software is using GDAL.  I thought that it was easier to show the problem using gdaltransform rather than source code, but that does lack some context.  Here is crude, but simple example of how the C Apis are being used.

--- source code begin ---
OGRSpatialReferenceH sourceSRS = OSRNewSpatialReference(NULL);
OGRSpatialReferenceH targetSRS = OSRNewSpatialReference(NULL);

errorSource = OSRSetWellKnownGeogCS( sourceSRS, "NAD27");
errorTarget = OSRSetWellKnownGeogCS( targetSRS, "WGS84");

OGRCoordinateTransformationH ptrCT = OCTNewCoordinateTransformation( sourceSRS, targetSRS );
status = OCTTransform( ptrCT, 1, x_lon, y_lat, NULL );
--- source code end ---

I had to search the web for some of the strings such as " NAD27 to WGS 84 (41)" to understand what that meant.  Evidently there are EPSG codes for the various sets of steps for transformations which I did not know.  
https://epsg.io/8594 (NAD27 to WGS 84 (41))

More importantly, I still don't understand why the behavior of GDAL would have changed for the exact same inputs, regardless of the advertised precision.  I suppose that perhaps the transformation chosen by GDAL for that operation changed at some point.  I have read in the tutorial at https://gdal.org/en/latest/tutorials/osr_api_tut.html  that GDAL picks the most appropriate steps based on the coordinates, but that one can specify a proj pipeline to make it pick a specific set of steps.  Do you know how to print the proj steps that GDAL will use when transforming?  I did not see an obvious way to do that within the class API declarations of OGRCoordinateTransformationH.

Given the limits of this type of transformation, perhaps the differences I am seeing are a non-issue but I still need to be able to explain this to others why are regression tests fail.  At a minimum, I am trying to understand why the results are different.  For now I will try to use the proj pipelies to test the C++ Apis with various inputs to see if I can reproduce the results observed with previous versions of GDAL.  I've also tested this on multiple platforms, windows 10 and Red Hat 8 so I don't believe that this is due to floating point limitations of CPUs because I observe the exact same results with GDAL 3.1.0 on windows 10 as I observe with GDAL 3.4.2 on Red Hat 8.  Therefore, I don't believe I can simply blame calculations with floating point for the differences.

Thanks,
Shawn Fox

-------------------------------------------------------------------

Date: Mon, 26 Aug 2024 18:26:47 +0200
From: Even Rouault <even.rouault at spatialys.com>
To: "Fox, Shawn D (US)" <shawn.fox at baesystems.us>,
	"'gdal-dev at lists.osgeo.org'" <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Upgrading to GDAL 3.4.2 from 1.10.0 shows
	different outputs from gdaltransform and corresponding C++ API
Message-ID: <e2bbdd85-c464-4fb6-bfb8-19bcc3676b51 at spatialys.com>
Content-Type: text/plain; charset="utf-8"; Format="flowed"

Shawn,

The results depends on which PROJ grids are available on your system (or if you allowed network access).

1) The result you get with GDAL 1.10 can be reproduced with modern PROJ versions by allowing (and restricting) to using the CONUS / us_noaa_conus.tif grid which corresponds to the "NAD27 to WGS 84 (79)" 
EPSG transformation, with an advertized accuracy of 5.0 m:

$ echo 32.804191 -117.258911 0 | PROJ_NETWORK=ON cct -d 8 +proj=pipeline 
+step +proj=axisswap +order=2,1 +step +proj=unitconvert +xy_in=deg 
+xy_out=rad +step +proj=hgridshift +grids=us_noaa_conus.tif +step 
+proj=unitconvert +xy_in=rad +xy_out=deg +step +proj=axisswap +order=2,1
32.80423938?? -117.25978145??? 0.00000000?????????? inf

2) The result you get with GDAL 3.4.2 / PROJ 8.1.1 can be actually reproduced by using only the "NAD27 to WGS 84 (6)" EPSG Helmert transformation,?with an advertized accuracy of 7.0 m, which is the most precise one in the absence of any grid:

$ echo 32.804191 -117.258911 | cs2cs -d 8 NAD27 WGS84 32.80423884??? -117.25976448 0.00000000

or explicitly with the pipeline show by "projinfo NAD27 WGS84 --bbox
-118,32,-117,33 --spatial-test intersects --single-line":

$ echo 32.804191 -117.258911 0 |? cct -d 8 +proj=pipeline +step 
+proj=axisswap +order=2,1 +step +proj=unitconvert +xy_in=deg +xy_out=rad 
+step +proj=push +v_3 +step +proj=cart +ellps=clrk66 +step +proj=helmert
+x=-8 +y=159 +z=175 +step +inv +proj=cart +ellps=WGS84 +step +proj=pop
+v_3 +step +proj=unitconvert +xy_in=rad +xy_out=deg +step +proj=axisswap
+order=2,1
32.80423884?? -117.25976448??? 0.00000000?????????? inf

3) You would get the """"most precise result"""" (with lots of quotes, because this is highly subjective, and assumes that NAD83(HARN) is equivalent to WGS 84, according to the comment in the EPSG database) with the "NAD27 to WGS 84 (41)" EPSG transformation, with an advertized accuracy of 1.5m, which combines the CONUS grid and us_noaa_cshpgn:

$ echo 32.804191 -117.258911 | PROJ_NETWORK=ON cs2cs -d 8 NAD27 WGS84 32.80424065??? -117.25978105 0.00000000

or explicitly with the pipeline show by "projinfo NAD27 WGS84 --bbox
-118,32,-117,33 --spatial-test intersects --single-line":

$ echo 32.804191 -117.258911 0 | PROJ_NETWORK=ON cct -d 8 +proj=pipeline 
+step +proj=axisswap +order=2,1 +step +proj=unitconvert +xy_in=deg 
+xy_out=rad +step +proj=hgridshift +grids=us_noaa_conus.tif +step 
+proj=hgridshift +grids=us_noaa_cshpgn.tif +step +proj=unitconvert 
+xy_in=rad +xy_out=deg +step +proj=axisswap +order=2,1
32.80424065?? -117.25978105??? 0.00000000?????????? inf

==> All those results are valid. Some are more precise than others, under certain assumptions... But basically speaking about WGS 84 introduces an intrinsic inaccuracy of about 2 meters (cf https://www.youtube.com/watch?v=M2ck3cAGvhg). I don't think there are any published time-dependent transformations for NAD27 to WGS84 or any of its realization.

Even

Le 24/08/2024 ? 03:14, Fox, Shawn D (US) via gdal-dev a ?crit?:
>
> Hello GDAL users.
>
> I have noticed that from GDAL 1.10 ? GDAL 3.1.0 that gdaltransform is 
> producing different results for NAD27 GCS to WGS84 GCS 
> transformations.? The differences in longitude in the output is more 
> significant.? Having tested the differences in feet between the points 
> output from each version I can see a difference of ~5 feet primarily 
> due to the change in the longitude value.
>
> Would anyone look at the following results and share your thoughts 
> about why the result of this transformation is different in a newer 
> version?? Could this be related to the concept of WGS 84 realization 
> being different in newer versions of GDAL?? I am also linking GDAL 
> 3.4.2 with PROJ 8.1.1 at this time.? These results were produced with 
> GDAL 3.4.2, but the same results occur with GDAL 3.1.0 as well.? GDAL 
> 3.4.2 is what I am currently trying to upgrade to.? The results from 
> the C++ programming API are similar in difference.? I just used 
> gdaltransform for the purposes of this message because it was a more 
> convenient way of producing something that others might be able to 
> reproduce.
>
> *GDAL 1.10.0 results*
>
> ./gdaltransform -s_srs NAD27 -t_srs WGS84
>
> -117.258911 32.804191
>
> -117.25978144845 32.8042393819884 1.32247805595398e-07
>
> *GDAL 3.4.2 results*
>
> ./gdaltransform -s_srs NAD27 -t_srs WGS84
>
> -117.258911 32.804191
>
> -117.259764476223 32.8042388409449 0
>
> I have read that the support for specifying epochs related to 
> realizations is not available until GDAL 3.8.0.
>
> Here are some references I?ve read so far.
>
> Transforming between WGS84 Realizations | Journal of Surveying 
> Engineering | Vol 148, No 2 (ascelibrary.org) 
> <https://ascelibrary.org/doi/10.1061/%28ASCE%29SU.1943-5428.0000389>
>
> RFC 81: Support for coordinate epochs in geospatial formats ? GDAL 
> documentation 
> <https://gdal.org/development/rfc/rfc81_coordinate_epoch.html>
>
> Thanks,
>
> Shawn Fox
>
> San Diego, CA
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240826/6677cc17/attachment.htm>

------------------------------

Subject: Digest Footer

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev


------------------------------

End of gdal-dev Digest, Vol 243, Issue 20
*****************************************

From even.rouault at spatialys.com  Mon Sep  9 18:12:32 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 Sep 2024 03:12:32 +0200
Subject: [gdal-dev] Upgrading to GDAL 3.4.2 from 1.10.0 shows different
 outputs from gdaltransform and corresponding C++ API
In-Reply-To: <20240910005641.D5B94614250A@lists.osgeo.org>
References: <20240910005641.D5B94614250A@lists.osgeo.org>
Message-ID: <c0142d4f-95ae-41c7-b9fa-35f55531b6b7@spatialys.com>


Le 10/09/2024 ? 02:55, Fox, Shawn D (US) via gdal-dev a ?crit?:
> Evan,
>
> Thanks for putting some time into that response and showing some examples.  Perhaps I should clarify exactly how our software is using GDAL.  I thought that it was easier to show the problem using gdaltransform rather than source code, but that does lack some context.  Here is crude, but simple example of how the C Apis are being used.
> --- source code begin ---
> OGRSpatialReferenceH sourceSRS = OSRNewSpatialReference(NULL);
> OGRSpatialReferenceH targetSRS = OSRNewSpatialReference(NULL);
>
> errorSource = OSRSetWellKnownGeogCS( sourceSRS, "NAD27");
> errorTarget = OSRSetWellKnownGeogCS( targetSRS, "WGS84");
>
> OGRCoordinateTransformationH ptrCT = OCTNewCoordinateTransformation( sourceSRS, targetSRS );
> status = OCTTransform( ptrCT, 1, x_lon, y_lat, NULL );

Source code speaks for itself :-) This is a CRS axis order issue. Cf 
https://gdal.org/en/latest/tutorials/osr_api_tut.html#crs-and-axis-order 
for the whole discussion

With your current code and GDAL >= 3, the input axis order should be 
(lat, lon) since NAD27 in EPSG is declared as (lat, lon) ordered and 
GDAL 3 honours that by default

If you want to keep long, lat axis order, add 
OSRSetAxisMappingStrategy(errorSource, OAMS_TRADITIONAL_GIS_ORDER); and 
OSRSetAxisMappingStrategy(errorTarget, OAMS_TRADITIONAL_GIS_ORDER); 
before creating the coordinate transformation

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/eb7d2bba/attachment.htm>

From michkowalczuk at gmail.com  Tue Sep 10 05:14:46 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 10 Sep 2024 14:14:46 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
Message-ID: <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>

I found that there was a similar issue in 2021 without any specific answer:
https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html

I wonder if getting SUBDATASETS shouldn't return the result in a similar
way as it does for WMTS service,
where GDAL generates paths to all layer/tilematrix/tilematrixset
combination.
For example if layer is available in 3 SRS, GDAL produces 3 subdatasets, so
using only SUBDATASE_NAME property user has access to all map services
shared by WMTS server.
In my opinion, GDAL should use the same approach for WMS.

Does anyone object?
I will then submit a new feature request/bug report.

Best regards and have a nice day
Micha? Kowalczuk

pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
napisa?(a):

> Hi,
> Does GDAL provides a method to get supported spatial reference systems by
> WMS service?
> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
> (default) SRS from GetCapabilities, so this won't be helpful.
> Working with WFS I can get supported SRS using OGR
> *OGR_L_GetSupportedSRSList *function.
> Does GDAL offers something similar for WMS, or should I get this
> information from GetCapabilities XML by myself?
>
> Regards,
> Michal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/40150880/attachment.htm>

From even.rouault at spatialys.com  Tue Sep 10 06:00:23 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 Sep 2024 15:00:23 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
Message-ID: <97fe1919-af49-4e28-abd1-39017f160fa7@spatialys.com>

Micha?,

Le 10/09/2024 ? 14:14, Micha? Kowalczuk via gdal-dev a ?crit?:
> I found that there was a similar issue in 2021 without any specific 
> answer:
> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>
> I wonder if getting SUBDATASETS shouldn't return the result in a 
> similar way as it does for WMTS service,
> where GDAL generates paths to all layer/tilematrix/tilematrixset 
> combination.
> For example if layer is available in 3 SRS, GDAL produces 3 
> subdatasets, so using only SUBDATASE_NAME property user has access to 
> all map services shared by WMTS server.
> In my opinion, GDAL should use the same approach for WMS.
>
> Does anyone object?
> I will then submit a new feature request/bug report.

That sounds useful. However I'm wondering if users won't be overwhelmed 
by a tons of possible SRS. WMS GetCapabilities tend sometimes to list 
tons of possible SRS. With WMTS, as you need to provide TileMatrixSet 
definitions, that's less likely to happen. So perhaps add a 
LIST_ALL_SRS=YES/NO open option, possibly defaulting to NO.

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/02c1985f/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Sep 10 06:03:40 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 10 Sep 2024 13:03:40 +0000
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
Message-ID: <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

WMTS typically supports a rather small number of tilematrices and tiles are usually cached, so it makes a lot of sense to advertise the available matrices and utilize them. On the other hand WMS maps are created on-the-fly and there is very low technical cost on the server side to support however many projections. WMS standard also does not define any default CRS and the first one on the list in GetCapabilities does not need to be the best.

I guess that Geoserver is the most common WMS server in the world and amazingly many Geoservers run with the default settings. It means that there are tens of thousands WMS services which support 6782 different projections for each layer (checked from Geoserver version 2.25.3). I would not like them all to be reported as subdatasets.

I can see that ogrinfo and the OGC API Features driver report the list of supported projections. Test with ogrinfo OAPIF:https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows "Supported SRS: OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395, EPSG:3857, EPSG:3034, EPSG:3035"
Something similar might be an option for gdalinfo, but still about 6782 EPSG codes per layer is too much to be viewed by default. Maybe the CRS list could be reported under some metadata domain that user could read on demand?

-Jukka Rahkonen-









L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: tiistai 10. syyskuuta 2024 15.15
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] WMS supported SRS

I found that there was a similar issue in 2021 without any specific answer:
https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html

I wonder if getting SUBDATASETS shouldn't return the result in a similar way as it does for WMTS service,
where GDAL generates paths to all layer/tilematrix/tilematrixset combination.
For example if layer is available in 3 SRS, GDAL produces 3 subdatasets, so using only SUBDATASE_NAME property user has access to all map services shared by WMTS server.
In my opinion, GDAL should use the same approach for WMS.

Does anyone object?
I will then submit a new feature request/bug report.

Best regards and have a nice day
Micha? Kowalczuk

pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
Hi,
Does GDAL provides a method to get supported spatial reference systems by WMS service?
GDALGetMetadata(SUBDATASETS) generate links only for the first (default) SRS from GetCapabilities, so this won't be helpful.
Working with WFS I can get supported SRS using OGR OGR_L_GetSupportedSRSList function.
Does GDAL offers something similar for WMS, or should I get this information from GetCapabilities XML by myself?

Regards,
Michal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/c2ba48ed/attachment-0001.htm>

From michkowalczuk at gmail.com  Tue Sep 10 06:31:43 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 10 Sep 2024 15:31:43 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>

Thank you for your feedback. My comments are below:


*It means that there are tens of thousands WMS services which support 6782
different projections for each layer (checked from Geoserver version
2.25.3). I would not like them all to be reported as subdatasets.*

I meant to use CRSs only reported by GetCapabilities. I haven't seen that
GetCapabilities returns so many (6782) possible projections...

*WMS standard also does not define any default CRS and the first one on the
list in GetCapabilities does not need to be the best.*

Therefore, the current form of the generating subdatasets names method for
WMS driver is even more useless, if we have a non-default (not the best)
projection for the data.

And the only good way to work with it is to parse XML and generate paths
manually...

That's why I favor Even's option to introduce open option
LIST_ALL_SRS=YES/NO.

Any more thoughts?

Micha? Kowalczuk

wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
napisa?(a):

> Hi,
>
>
>
> WMTS typically supports a rather small number of tilematrices and tiles
> are usually cached, so it makes a lot of sense to advertise the available
> matrices and utilize them. On the other hand WMS maps are created
> on-the-fly and there is very low technical cost on the server side to
> support however many projections. WMS standard also does not define any
> default CRS and the first one on the list in GetCapabilities does not need
> to be the best.
>
>
>
> I guess that Geoserver is the most common WMS server in the world and
> amazingly many Geoservers run with the default settings. It means that
> there are tens of thousands WMS services which support 6782 different
> projections for each layer (checked from Geoserver version 2.25.3). I would
> not like them all to be reported as subdatasets.
>
>
>
> I can see that ogrinfo and the OGC API Features driver report the list of
> supported projections. Test with ogrinfo OAPIF:
> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported SRS:
> OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395,
> EPSG:3857, EPSG:3034, EPSG:3035?
>
> Something similar might be an option for gdalinfo, but still about 6782
> EPSG codes per layer is too much to be viewed by default. Maybe the CRS
> list could be reported under some metadata domain that user could read on
> demand?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> I found that there was a similar issue in 2021 without any specific answer:
>
> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>
>
>
> I wonder if getting SUBDATASETS shouldn't return the result in a similar
> way as it does for WMTS service,
>
> where GDAL generates paths to all layer/tilematrix/tilematrixset
> combination.
>
> For example if layer is available in 3 SRS, GDAL produces 3 subdatasets,
> so using only SUBDATASE_NAME property user has access to all map services
> shared by WMTS server.
>
> In my opinion, GDAL should use the same approach for WMS.
>
>
>
> Does anyone object?
>
> I will then submit a new feature request/bug report.
>
>
>
> Best regards and have a nice day
>
> Micha? Kowalczuk
>
>
>
> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Hi,
>
> Does GDAL provides a method to get supported spatial reference systems by
> WMS service?
>
> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
> (default) SRS from GetCapabilities, so this won't be helpful.
>
> Working with WFS I can get supported SRS using OGR
> *OGR_L_GetSupportedSRSList *function.
>
> Does GDAL offers something similar for WMS, or should I get this
> information from GetCapabilities XML by myself?
>
>
>
> Regards,
>
> Michal
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/67ac75a8/attachment.htm>

From michkowalczuk at gmail.com  Tue Sep 10 06:37:31 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 10 Sep 2024 15:37:31 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
Message-ID: <CAP+FqQAK=GqofcSShJg5QZOWKPxAYQHOpfrJVtzRpkS4wH4ovw@mail.gmail.com>

That's why I favor Even's option to introduce open option
LIST_ALL_SRS=YES/NO.


Or any other solution that simplify the process of choosing layer in the
specified SRS, e.g. dedicated function that returns list of supported SRS
like in WFS...?


wt., 10 wrz 2024 o 15:31 Micha? Kowalczuk <michkowalczuk at gmail.com>
napisa?(a):

> Thank you for your feedback. My comments are below:
>
>
> *It means that there are tens of thousands WMS services which support 6782
> different projections for each layer (checked from Geoserver version
> 2.25.3). I would not like them all to be reported as subdatasets.*
>
> I meant to use CRSs only reported by GetCapabilities. I haven't seen that
> GetCapabilities returns so many (6782) possible projections...
>
> *WMS standard also does not define any default CRS and the first one on
> the list in GetCapabilities does not need to be the best.*
>
> Therefore, the current form of the generating subdatasets names method for
> WMS driver is even more useless, if we have a non-default (not the best)
> projection for the data.
>
> And the only good way to work with it is to parse XML and generate paths
> manually...
>
> That's why I favor Even's option to introduce open option
> LIST_ALL_SRS=YES/NO.
>
> Any more thoughts?
>
> Micha? Kowalczuk
>
> wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
>> Hi,
>>
>>
>>
>> WMTS typically supports a rather small number of tilematrices and tiles
>> are usually cached, so it makes a lot of sense to advertise the available
>> matrices and utilize them. On the other hand WMS maps are created
>> on-the-fly and there is very low technical cost on the server side to
>> support however many projections. WMS standard also does not define any
>> default CRS and the first one on the list in GetCapabilities does not need
>> to be the best.
>>
>>
>>
>> I guess that Geoserver is the most common WMS server in the world and
>> amazingly many Geoservers run with the default settings. It means that
>> there are tens of thousands WMS services which support 6782 different
>> projections for each layer (checked from Geoserver version 2.25.3). I would
>> not like them all to be reported as subdatasets.
>>
>>
>>
>> I can see that ogrinfo and the OGC API Features driver report the list of
>> supported projections. Test with ogrinfo OAPIF:
>> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported
>> SRS: OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395,
>> EPSG:3857, EPSG:3034, EPSG:3035?
>>
>> Something similar might be an option for gdalinfo, but still about 6782
>> EPSG codes per layer is too much to be viewed by default. Maybe the CRS
>> list could be reported under some metadata domain that user could read on
>> demand?
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
>> Kowalczuk via gdal-dev
>> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] WMS supported SRS
>>
>>
>>
>> I found that there was a similar issue in 2021 without any specific
>> answer:
>>
>> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>>
>>
>>
>> I wonder if getting SUBDATASETS shouldn't return the result in a similar
>> way as it does for WMTS service,
>>
>> where GDAL generates paths to all layer/tilematrix/tilematrixset
>> combination.
>>
>> For example if layer is available in 3 SRS, GDAL produces 3 subdatasets,
>> so using only SUBDATASE_NAME property user has access to all map services
>> shared by WMTS server.
>>
>> In my opinion, GDAL should use the same approach for WMS.
>>
>>
>>
>> Does anyone object?
>>
>> I will then submit a new feature request/bug report.
>>
>>
>>
>> Best regards and have a nice day
>>
>> Micha? Kowalczuk
>>
>>
>>
>> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
>> napisa?(a):
>>
>> Hi,
>>
>> Does GDAL provides a method to get supported spatial reference systems by
>> WMS service?
>>
>> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
>> (default) SRS from GetCapabilities, so this won't be helpful.
>>
>> Working with WFS I can get supported SRS using OGR
>> *OGR_L_GetSupportedSRSList *function.
>>
>> Does GDAL offers something similar for WMS, or should I get this
>> information from GetCapabilities XML by myself?
>>
>>
>>
>> Regards,
>>
>> Michal
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/dd8f0666/attachment-0001.htm>

From daniel.fred.evans at gmail.com  Tue Sep 10 06:57:10 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Tue, 10 Sep 2024 14:57:10 +0100
Subject: [gdal-dev] Ignore content-length in vsicurl?
Message-ID: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>

Hi all,

I am attempting to read a dataset via /vsicurl/ where I believe the server
is incorrectly returning `content-length: 0` in response to HEAD requests.
This causes GDAL to believe it's a zero-length file, and it therefore can't
be read.

If I download the file via HTTP GET, it's valid, and GDAL can read it
locally. I've also confirmed I can use /vsicurl/ on some test datasets in
the GDAL repo.

Is it possible to force GDAL to work around the faulty content-length
header, or is it too fundamental a problem to ignore?

I've separately got in touch with the data provider to see if they are able
to fix the issue at their end.

Cheers,
Daniel


URL of the troublesome dataset:
https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif


Example HTTP header responses I'm seeing:

GET

HTTP/2 200
date: Tue, 10 Sep 2024 13:47:54 GMT
content-type: binary/octet-stream
content-length: 278198294
vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
etag: "a79f3f685281d6681e4d362536c5b3eb-34"
last-modified: Thu, 25 Jul 2024 13:16:08 GMT
x-version: 0.0.16
access-control-allow-credentials: true

HEAD

HTTP/2 200
date: Tue, 10 Sep 2024 13:48:08 GMT
content-type: binary/octet-stream
content-length: 0
x-version: 0.0.16
access-control-allow-credentials: true
etag: "a79f3f685281d6681e4d362536c5b3eb-34"
last-modified: Thu, 25 Jul 2024 13:16:08 GMT
vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/db9f9701/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Sep 10 07:07:25 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 10 Sep 2024 14:07:25 +0000
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
Message-ID: <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi


  *   I meant to use CRSs only reported by GetCapabilities. I haven't seen that GetCapabilities returns so many (6782) possible projections...

I was meaning the same, CRSs reported in GetCapabilities. I used a search engine with phrase "service=WMS&version=1.3.0" and found in three minutes many examples, including this one kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities<https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities>. If you want to see more, install Geoserver on your computer and have a look at the default GetCapabilities.

Finding the best CRS from WMS GetCapabilities is guesswork. The server above is a Finnish one so probably EPSG:3067 is the most native CRS because that is what we tend to use in Finland. However, there is also one and only one additional BBOX for EPSG:3879 in GetCapabilities, but that would be somewhat odd selection for a country-wide CRS. It is also possible that for example some CRS of New Zealand does not really work in GetMap of the Finnish data even GetCapabilities says it will. But when WMS is configured to show a short CRS list then I would trust that they are all good to use. Just be aware that the list can also be very long.

If you start implementing the LIST_ALL_SRS option, it should be noted that the service level CRS list applies to all layers, and each layer can add more CRSs to the list. Maybe in theory there could be even "crs-list-of-service-root + crs-list-of-group-layer + crs-list-of-child-layer".

"7.2.4.6.7 CRS
Every Layer is available in one or more layer coordinate reference systems. 6.7.3 discusses the Layer CRS. In
order to indicate which Layer CRSs are available, every named Layer shall have at least one <CRS> element that
is either stated explicitly or inherited from a parent Layer. The root <Layer> element shall include a sequence of
zero or more CRS elements listing all CRSs that are common to all subsidiary layers. A child layer may optionally
add to the list inherited from a parent layer. Any duplication shall be ignored by clients.
When a Layer is available in several coordinate reference systems, the list of available CRS values shall be
represented as a sequence of <CRS> elements, each of which contains only a single CRS name."

-Jukka Rahkonen-




L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com>
L?hetetty: tiistai 10. syyskuuta 2024 16.32
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] WMS supported SRS

Thank you for your feedback. My comments are below:

It means that there are tens of thousands WMS services which support 6782 different projections for each layer (checked from Geoserver version 2.25.3). I would not like them all to be reported as subdatasets.
I meant to use CRSs only reported by GetCapabilities. I haven't seen that GetCapabilities returns so many (6782) possible projections...

WMS standard also does not define any default CRS and the first one on the list in GetCapabilities does not need to be the best.
Therefore, the current form of the generating subdatasets names method for WMS driver is even more useless, if we have a non-default (not the best) projection for the data.

And the only good way to work with it is to parse XML and generate paths manually...

That's why I favor Even's option to introduce open option LIST_ALL_SRS=YES/NO.

Any more thoughts?

Micha? Kowalczuk

wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

WMTS typically supports a rather small number of tilematrices and tiles are usually cached, so it makes a lot of sense to advertise the available matrices and utilize them. On the other hand WMS maps are created on-the-fly and there is very low technical cost on the server side to support however many projections. WMS standard also does not define any default CRS and the first one on the list in GetCapabilities does not need to be the best.

I guess that Geoserver is the most common WMS server in the world and amazingly many Geoservers run with the default settings. It means that there are tens of thousands WMS services which support 6782 different projections for each layer (checked from Geoserver version 2.25.3). I would not like them all to be reported as subdatasets.

I can see that ogrinfo and the OGC API Features driver report the list of supported projections. Test with ogrinfo OAPIF:https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows "Supported SRS: OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395, EPSG:3857, EPSG:3034, EPSG:3035"
Something similar might be an option for gdalinfo, but still about 6782 EPSG codes per layer is too much to be viewed by default. Maybe the CRS list could be reported under some metadata domain that user could read on demand?

-Jukka Rahkonen-









L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: tiistai 10. syyskuuta 2024 15.15
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] WMS supported SRS

I found that there was a similar issue in 2021 without any specific answer:
https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html

I wonder if getting SUBDATASETS shouldn't return the result in a similar way as it does for WMTS service,
where GDAL generates paths to all layer/tilematrix/tilematrixset combination.
For example if layer is available in 3 SRS, GDAL produces 3 subdatasets, so using only SUBDATASE_NAME property user has access to all map services shared by WMTS server.
In my opinion, GDAL should use the same approach for WMS.

Does anyone object?
I will then submit a new feature request/bug report.

Best regards and have a nice day
Micha? Kowalczuk

pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
Hi,
Does GDAL provides a method to get supported spatial reference systems by WMS service?
GDALGetMetadata(SUBDATASETS) generate links only for the first (default) SRS from GetCapabilities, so this won't be helpful.
Working with WFS I can get supported SRS using OGR OGR_L_GetSupportedSRSList function.
Does GDAL offers something similar for WMS, or should I get this information from GetCapabilities XML by myself?

Regards,
Michal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/918536be/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Sep 10 07:10:51 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 10 Sep 2024 14:10:51 +0000
Subject: [gdal-dev] Ignore content-length in vsicurl?
In-Reply-To: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>
References: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>
Message-ID: <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

Have you tried with configuration option "CPL_VSIL_CURL_USE_HEAD=[YES/NO]: Defaults to YES. Controls whether to use a HEAD request when opening a remote URL."

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Daniel Evans via gdal-dev
L?hetetty: tiistai 10. syyskuuta 2024 16.57
Vastaanottaja: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Ignore content-length in vsicurl?

Hi all,

I am attempting to read a dataset via /vsicurl/ where I believe the server is incorrectly returning `content-length: 0` in response to HEAD requests. This causes GDAL to believe it's a zero-length file, and it therefore can't be read.

If I download the file via HTTP GET, it's valid, and GDAL can read it locally. I've also confirmed I can use /vsicurl/ on some test datasets in the GDAL repo.

Is it possible to force GDAL to work around the faulty content-length header, or is it too fundamental a problem to ignore?

I've separately got in touch with the data provider to see if they are able to fix the issue at their end.

Cheers,
Daniel


URL of the troublesome dataset:
https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif


Example HTTP header responses I'm seeing:

GET

HTTP/2 200
date: Tue, 10 Sep 2024 13:47:54 GMT
content-type: binary/octet-stream
content-length: 278198294
vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
etag: "a79f3f685281d6681e4d362536c5b3eb-34"
last-modified: Thu, 25 Jul 2024 13:16:08 GMT
x-version: 0.0.16
access-control-allow-credentials: true

HEAD

HTTP/2 200
date: Tue, 10 Sep 2024 13:48:08 GMT
content-type: binary/octet-stream
content-length: 0
x-version: 0.0.16
access-control-allow-credentials: true
etag: "a79f3f685281d6681e4d362536c5b3eb-34"
last-modified: Thu, 25 Jul 2024 13:16:08 GMT
vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/bcf7a925/attachment.htm>

From daniel.fred.evans at gmail.com  Tue Sep 10 07:30:42 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Tue, 10 Sep 2024 15:30:42 +0100
Subject: [gdal-dev] Ignore content-length in vsicurl?
In-Reply-To: <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>
 <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CANnaQaZbX529T6QSLOvw+wF+nE2U=TQnv41Y7vUyAJz2TNYtkA@mail.gmail.com>

Hi Jukka,

It seems your documentation search skills are better than mine! That does
the trick.

Cheers,
Daniel

On Tue, 10 Sept 2024 at 15:10, Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Have you tried with configuration option ?CPL_VSIL_CURL_USE_HEAD=[YES/NO]:
> Defaults to YES. Controls whether to use a HEAD request when opening a
> remote URL.?
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Daniel
> Evans via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 16.57
> *Vastaanottaja:* 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <
> gdal-dev at lists.osgeo.org>
> *Aihe:* [gdal-dev] Ignore content-length in vsicurl?
>
>
>
> Hi all,
>
>
>
> I am attempting to read a dataset via /vsicurl/ where I believe the server
> is incorrectly returning `content-length: 0` in response to HEAD requests.
> This causes GDAL to believe it's a zero-length file, and it therefore can't
> be read.
>
>
>
> If I download the file via HTTP GET, it's valid, and GDAL can read it
> locally. I've also confirmed I can use /vsicurl/ on some test datasets in
> the GDAL repo.
>
>
>
> Is it possible to force GDAL to work around the faulty content-length
> header, or is it too fundamental a problem to ignore?
>
>
>
> I've separately got in touch with the data provider to see if they are
> able to fix the issue at their end.
>
>
>
> Cheers,
>
> Daniel
>
>
>
>
>
> URL of the troublesome dataset:
>
>
> https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif
>
>
>
>
>
> Example HTTP header responses I'm seeing:
>
>
>
> GET
>
>
>
> HTTP/2 200
> date: Tue, 10 Sep 2024 13:47:54 GMT
> content-type: binary/octet-stream
> content-length: 278198294
> vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
> x-version: 0.0.16
> access-control-allow-credentials: true
>
>
>
> HEAD
>
>
>
> HTTP/2 200
> date: Tue, 10 Sep 2024 13:48:08 GMT
> content-type: binary/octet-stream
> content-length: 0
> x-version: 0.0.16
> access-control-allow-credentials: true
> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
> vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/8e863583/attachment.htm>

From even.rouault at spatialys.com  Tue Sep 10 08:05:11 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 10 Sep 2024 17:05:11 +0200
Subject: [gdal-dev] Ignore content-length in vsicurl?
In-Reply-To: <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>
 <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <8ca84522-08cc-4a10-b596-3b842a76149a@spatialys.com>


Le 10/09/2024 ? 16:10, Rahkonen Jukka via gdal-dev a ?crit?:
>
> Hi,
>
> Have you tried with configuration option 
> ?CPL_VSIL_CURL_USE_HEAD=[YES/NO]: Defaults to YES. Controls whether to 
> use a HEAD request when opening a remote URL.?
>
I was just going to suggest that too. It "works", but not really. It 
just postpones the core issue: the server doesn't support GET Range 
requests, so can't be used with /vsicurl/

As it has a COG organization with overview data first in the file, If 
you want to read the smallest overview(s), you can use 
/vsicurl_streaming/ instead, but that won't be efficient to read the 
bottom-right most tile of the full resoultion late, which will require 
reading the whole file...

Nothing GDAL can do about that.

Actually... digging further... it somehow supports Range requests, but 
in what I believe a non-compliant way. It does return the expected 
content, but returns HTTP 200 and not HTTP 206 (Partial content). And it 
never returns the Content-Length header.

Well, I've implemented a workaround in 
https://github.com/OSGeo/gdal/pull/10760 that might be useful in other 
similar cases too.

With that, the following works:

|gdal_translate 
"/vsicurl?file_size=unlimited&url=https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif" 
--config GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR out.tif -srcwin 5000 
5000 50 50|

file_size=unlimited works here since the GTiff driver doesn't really 
need to have the right file size, it will just check we don't try to 
read beyond at some points, so unlimited is OK. In other 
situations/drivers, the exact value could be needed.

But they should really fix their servers

Even

> -Jukka Rahkonen-
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Daniel Evans via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 16.57
> *Vastaanottaja:* 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) 
> <gdal-dev at lists.osgeo.org>
> *Aihe:* [gdal-dev] Ignore content-length in vsicurl?
>
> Hi all,
>
> I am attempting to read a dataset via /vsicurl/ where I believe the 
> server is incorrectly returning `content-length: 0` in response to 
> HEAD requests. This causes GDAL to believe it's a zero-length file, 
> and it therefore can't be read.
>
> If I download the file via HTTP GET, it's valid, and GDAL can read it 
> locally. I've also confirmed I can use /vsicurl/ on some test datasets 
> in the GDAL repo.
>
> Is it possible to force GDAL to work around the faulty content-length 
> header, or is it too fundamental a problem to ignore?
>
> I've separately got in touch with the data provider to see if they are 
> able to fix the issue at their end.
>
> Cheers,
>
> Daniel
>
> URL of the troublesome dataset:
>
> https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif
>
> Example HTTP header responses I'm seeing:
>
> GET
>
> HTTP/2 200
> date: Tue, 10 Sep 2024 13:47:54 GMT
> content-type: binary/octet-stream
> content-length: 278198294
> vary: Origin, Access-Control-Request-Method, 
> Access-Control-Request-Headers
> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
> x-version: 0.0.16
> access-control-allow-credentials: true
>
> HEAD
>
> HTTP/2 200
> date: Tue, 10 Sep 2024 13:48:08 GMT
> content-type: binary/octet-stream
> content-length: 0
> x-version: 0.0.16
> access-control-allow-credentials: true
> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
> vary: Origin, Access-Control-Request-Method, 
> Access-Control-Request-Headers
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/dc525d2d/attachment-0001.htm>

From michkowalczuk at gmail.com  Tue Sep 10 08:05:11 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 10 Sep 2024 17:05:11 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>

Ok, now I see the problem. Thank you Jukka for the explanation with a
sample.
So maybe we can use information from *BoundingBox*?
and generate SUBDATASETS for each combination of Layer and BoundingBox
definition that is usually defined for "best"/dedicated projections for a
layer.

*(7.2.4.6.8 )*

*A Layer may have multiple BoundingBox elements, but each one shall state a
different CRS (...)*
*A Layer shall not provide a BoundingBox for a CRS it does not support.
Conversely, a Layer may support CRSs*
*for which it does not provide a BoundingBox: a server that has the ability
to transform data to different CRSs may*
*choose not to provide an explicit BoundingBox for every possible CRS
available for each Layer. The server*
*should provide BoundingBox information for at least the native CRS of the
Layer (that is, the CRS in which the*
*Layer is stored in the server?s database).*

Best,
Micha?

W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):

> Hi
>
>
>
>    - I meant to use CRSs only reported by GetCapabilities. I haven't seen
>    that GetCapabilities returns so many (6782) possible projections...
>
>
>
> I was meaning the same, CRSs reported in GetCapabilities. I used a search
> engine with phrase ?service=WMS&version=1.3.0? and found in three minutes
> many examples, including this one
> kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities.
> If you want to see more, install Geoserver on your computer and have a look
> at the default GetCapabilities.
>
>
>
> Finding the best CRS from WMS GetCapabilities is guesswork. The server
> above is a Finnish one so probably EPSG:3067 is the most native CRS because
> that is what we tend to use in Finland. However, there is also one and only
> one additional BBOX for EPSG:3879 in GetCapabilities, but that would be
> somewhat odd selection for a country-wide CRS. It is also possible that for
> example some CRS of New Zealand does not really work in GetMap of the
> Finnish data even GetCapabilities says it will. But when WMS is configured
> to show a short CRS list then I would trust that they are all good to use.
> Just be aware that the list can also be very long.
>
>
>
> If you start implementing the LIST_ALL_SRS option, it should be noted that
> the service level CRS list applies to all layers, and each layer can add
> more CRSs to the list. Maybe in theory there could be even
> ?crs-list-of-service-root + crs-list-of-group-layer +
> crs-list-of-child-layer?.
>
>
>
> ?7.2.4.6.7 CRS
>
> Every Layer is available in one or more layer coordinate reference
> systems. 6.7.3 discusses the Layer CRS. In
>
> order to indicate which Layer CRSs are available, every named Layer shall
> have at least one <CRS> element that
>
> is either stated explicitly or inherited from a parent Layer. The root
> <Layer> element shall include a sequence of
>
> zero or more CRS elements listing all CRSs that are common to all
> subsidiary layers. A child layer may optionally
>
> add to the list inherited from a parent layer. Any duplication shall be
> ignored by clients.
>
> When a Layer is available in several coordinate reference systems, the
> list of available CRS values shall be
>
> represented as a sequence of <CRS> elements, each of which contains only a
> single CRS name.?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* tiistai 10. syyskuuta 2024 16.32
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
>
>
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> Thank you for your feedback. My comments are below:
>
>
>
> *It means that there are tens of thousands WMS services which support 6782
> different projections for each layer (checked from Geoserver version
> 2.25.3). I would not like them all to be reported as subdatasets.*
>
> I meant to use CRSs only reported by GetCapabilities. I haven't seen that
> GetCapabilities returns so many (6782) possible projections...
>
>
>
> *WMS standard also does not define any default CRS and the first one on
> the list in GetCapabilities does not need to be the best.*
>
> Therefore, the current form of the generating subdatasets names method for
> WMS driver is even more useless, if we have a non-default (not the best)
> projection for the data.
>
>
>
> And the only good way to work with it is to parse XML and generate paths
> manually...
>
>
>
> That's why I favor Even's option to introduce open option
> LIST_ALL_SRS=YES/NO.
>
>
>
> Any more thoughts?
>
>
>
> Micha? Kowalczuk
>
>
>
> wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> WMTS typically supports a rather small number of tilematrices and tiles
> are usually cached, so it makes a lot of sense to advertise the available
> matrices and utilize them. On the other hand WMS maps are created
> on-the-fly and there is very low technical cost on the server side to
> support however many projections. WMS standard also does not define any
> default CRS and the first one on the list in GetCapabilities does not need
> to be the best.
>
>
>
> I guess that Geoserver is the most common WMS server in the world and
> amazingly many Geoservers run with the default settings. It means that
> there are tens of thousands WMS services which support 6782 different
> projections for each layer (checked from Geoserver version 2.25.3). I would
> not like them all to be reported as subdatasets.
>
>
>
> I can see that ogrinfo and the OGC API Features driver report the list of
> supported projections. Test with ogrinfo OAPIF:
> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported SRS:
> OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395,
> EPSG:3857, EPSG:3034, EPSG:3035?
>
> Something similar might be an option for gdalinfo, but still about 6782
> EPSG codes per layer is too much to be viewed by default. Maybe the CRS
> list could be reported under some metadata domain that user could read on
> demand?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> I found that there was a similar issue in 2021 without any specific answer:
>
> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>
>
>
> I wonder if getting SUBDATASETS shouldn't return the result in a similar
> way as it does for WMTS service,
>
> where GDAL generates paths to all layer/tilematrix/tilematrixset
> combination.
>
> For example if layer is available in 3 SRS, GDAL produces 3 subdatasets,
> so using only SUBDATASE_NAME property user has access to all map services
> shared by WMTS server.
>
> In my opinion, GDAL should use the same approach for WMS.
>
>
>
> Does anyone object?
>
> I will then submit a new feature request/bug report.
>
>
>
> Best regards and have a nice day
>
> Micha? Kowalczuk
>
>
>
> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Hi,
>
> Does GDAL provides a method to get supported spatial reference systems by
> WMS service?
>
> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
> (default) SRS from GetCapabilities, so this won't be helpful.
>
> Working with WFS I can get supported SRS using OGR
> *OGR_L_GetSupportedSRSList *function.
>
> Does GDAL offers something similar for WMS, or should I get this
> information from GetCapabilities XML by myself?
>
>
>
> Regards,
>
> Michal
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/d877e8af/attachment.htm>

From michkowalczuk at gmail.com  Tue Sep 10 08:06:50 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 10 Sep 2024 17:06:50 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
Message-ID: <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>

A sample from your link:




























*<Layer queryable="1"
opaque="0"><Name>Rakennustietoruudukko_2017</Name><Title>Rakennustietoruudukko
2017</Title><Abstract>Tietoa rakennuksista 250 x 250m ruudukoissa
p??kaupunkiseudulla</Abstract><KeywordList><Keyword>features</Keyword><Keyword>Rakennustietoruudukko_2017</Keyword></KeywordList><CRS>EPSG:3879</CRS><CRS>CRS:84</CRS><EX_GeographicBoundingBox><westBoundLongitude>24.50112802448554</westBoundLongitude><eastBoundLongitude>25.25849178466466</eastBoundLongitude><southBoundLatitude>60.052265324029165</southBoundLatitude><northBoundLatitude>60.39874702231777</northBoundLatitude></EX_GeographicBoundingBox><BoundingBox
CRS="CRS:84" minx="24.50112802448554" miny="60.052265324029165"
maxx="25.25849178466466" maxy="60.39874702231777"/><BoundingBox
CRS="EPSG:3879" minx="6659998.5" miny="2.5472498E7" maxx="6698499.5"
maxy="2.551425E7"/><Style><Name>polygon</Name><Title>Default polygon
style</Title><Abstract>A sample style that just draws out a solid gray
interior with a black 1px outline</Abstract><LegendURL width="20"
height="20"><Format>image/png</Format><OnlineResource
xmlns:xlink="http://www.w3.org/1999/xlink <http://www.w3.org/1999/xlink>"
xlink:type="simple"
xlink:href="https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017
<https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017>"/></LegendURL></Style></Layer>*


wt., 10 wrz 2024 o 17:05 Micha? Kowalczuk <michkowalczuk at gmail.com>
napisa?(a):

> Ok, now I see the problem. Thank you Jukka for the explanation with a
> sample.
> So maybe we can use information from *BoundingBox*?
> and generate SUBDATASETS for each combination of Layer and BoundingBox
> definition that is usually defined for "best"/dedicated projections for a
> layer.
>
> *(7.2.4.6.8 )*
>
> *A Layer may have multiple BoundingBox elements, but each one shall state
> a different CRS (...)*
> *A Layer shall not provide a BoundingBox for a CRS it does not support.
> Conversely, a Layer may support CRSs*
> *for which it does not provide a BoundingBox: a server that has the
> ability to transform data to different CRSs may*
> *choose not to provide an explicit BoundingBox for every possible CRS
> available for each Layer. The server*
> *should provide BoundingBox information for at least the native CRS of the
> Layer (that is, the CRS in which the*
> *Layer is stored in the server?s database).*
>
> Best,
> Micha?
>
> W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
>> Hi
>>
>>
>>
>>    - I meant to use CRSs only reported by GetCapabilities. I haven't
>>    seen that GetCapabilities returns so many (6782) possible projections...
>>
>>
>>
>> I was meaning the same, CRSs reported in GetCapabilities. I used a search
>> engine with phrase ?service=WMS&version=1.3.0? and found in three minutes
>> many examples, including this one
>> kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities.
>> If you want to see more, install Geoserver on your computer and have a look
>> at the default GetCapabilities.
>>
>>
>>
>> Finding the best CRS from WMS GetCapabilities is guesswork. The server
>> above is a Finnish one so probably EPSG:3067 is the most native CRS because
>> that is what we tend to use in Finland. However, there is also one and only
>> one additional BBOX for EPSG:3879 in GetCapabilities, but that would be
>> somewhat odd selection for a country-wide CRS. It is also possible that for
>> example some CRS of New Zealand does not really work in GetMap of the
>> Finnish data even GetCapabilities says it will. But when WMS is configured
>> to show a short CRS list then I would trust that they are all good to use.
>> Just be aware that the list can also be very long.
>>
>>
>>
>> If you start implementing the LIST_ALL_SRS option, it should be noted
>> that the service level CRS list applies to all layers, and each layer can
>> add more CRSs to the list. Maybe in theory there could be even
>> ?crs-list-of-service-root + crs-list-of-group-layer +
>> crs-list-of-child-layer?.
>>
>>
>>
>> ?7.2.4.6.7 CRS
>>
>> Every Layer is available in one or more layer coordinate reference
>> systems. 6.7.3 discusses the Layer CRS. In
>>
>> order to indicate which Layer CRSs are available, every named Layer shall
>> have at least one <CRS> element that
>>
>> is either stated explicitly or inherited from a parent Layer. The root
>> <Layer> element shall include a sequence of
>>
>> zero or more CRS elements listing all CRSs that are common to all
>> subsidiary layers. A child layer may optionally
>>
>> add to the list inherited from a parent layer. Any duplication shall be
>> ignored by clients.
>>
>> When a Layer is available in several coordinate reference systems, the
>> list of available CRS values shall be
>>
>> represented as a sequence of <CRS> elements, each of which contains only
>> a single CRS name.?
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
>> *L?hetetty:* tiistai 10. syyskuuta 2024 16.32
>> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>> *Kopio:* gdal-dev at lists.osgeo.org
>>
>>
>> *Aihe:* Re: [gdal-dev] WMS supported SRS
>>
>>
>>
>> Thank you for your feedback. My comments are below:
>>
>>
>>
>> *It means that there are tens of thousands WMS services which support
>> 6782 different projections for each layer (checked from Geoserver version
>> 2.25.3). I would not like them all to be reported as subdatasets.*
>>
>> I meant to use CRSs only reported by GetCapabilities. I haven't seen that
>> GetCapabilities returns so many (6782) possible projections...
>>
>>
>>
>> *WMS standard also does not define any default CRS and the first one on
>> the list in GetCapabilities does not need to be the best.*
>>
>> Therefore, the current form of the generating subdatasets names method
>> for WMS driver is even more useless, if we have a non-default (not the
>> best) projection for the data.
>>
>>
>>
>> And the only good way to work with it is to parse XML and generate paths
>> manually...
>>
>>
>>
>> That's why I favor Even's option to introduce open option
>> LIST_ALL_SRS=YES/NO.
>>
>>
>>
>> Any more thoughts?
>>
>>
>>
>> Micha? Kowalczuk
>>
>>
>>
>> wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <
>> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>>
>> Hi,
>>
>>
>>
>> WMTS typically supports a rather small number of tilematrices and tiles
>> are usually cached, so it makes a lot of sense to advertise the available
>> matrices and utilize them. On the other hand WMS maps are created
>> on-the-fly and there is very low technical cost on the server side to
>> support however many projections. WMS standard also does not define any
>> default CRS and the first one on the list in GetCapabilities does not need
>> to be the best.
>>
>>
>>
>> I guess that Geoserver is the most common WMS server in the world and
>> amazingly many Geoservers run with the default settings. It means that
>> there are tens of thousands WMS services which support 6782 different
>> projections for each layer (checked from Geoserver version 2.25.3). I would
>> not like them all to be reported as subdatasets.
>>
>>
>>
>> I can see that ogrinfo and the OGC API Features driver report the list of
>> supported projections. Test with ogrinfo OAPIF:
>> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported
>> SRS: OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395,
>> EPSG:3857, EPSG:3034, EPSG:3035?
>>
>> Something similar might be an option for gdalinfo, but still about 6782
>> EPSG codes per layer is too much to be viewed by default. Maybe the CRS
>> list could be reported under some metadata domain that user could read on
>> demand?
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
>> Kowalczuk via gdal-dev
>> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] WMS supported SRS
>>
>>
>>
>> I found that there was a similar issue in 2021 without any specific
>> answer:
>>
>> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>>
>>
>>
>> I wonder if getting SUBDATASETS shouldn't return the result in a similar
>> way as it does for WMTS service,
>>
>> where GDAL generates paths to all layer/tilematrix/tilematrixset
>> combination.
>>
>> For example if layer is available in 3 SRS, GDAL produces 3 subdatasets,
>> so using only SUBDATASE_NAME property user has access to all map services
>> shared by WMTS server.
>>
>> In my opinion, GDAL should use the same approach for WMS.
>>
>>
>>
>> Does anyone object?
>>
>> I will then submit a new feature request/bug report.
>>
>>
>>
>> Best regards and have a nice day
>>
>> Micha? Kowalczuk
>>
>>
>>
>> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
>> napisa?(a):
>>
>> Hi,
>>
>> Does GDAL provides a method to get supported spatial reference systems by
>> WMS service?
>>
>> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
>> (default) SRS from GetCapabilities, so this won't be helpful.
>>
>> Working with WFS I can get supported SRS using OGR
>> *OGR_L_GetSupportedSRSList *function.
>>
>> Does GDAL offers something similar for WMS, or should I get this
>> information from GetCapabilities XML by myself?
>>
>>
>>
>> Regards,
>>
>> Michal
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/014e530d/attachment-0001.htm>

From thomas.bonfort at gmail.com  Tue Sep 10 08:11:21 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Tue, 10 Sep 2024 17:11:21 +0200
Subject: [gdal-dev] Ignore content-length in vsicurl?
In-Reply-To: <8ca84522-08cc-4a10-b596-3b842a76149a@spatialys.com>
References: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>
 <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <8ca84522-08cc-4a10-b596-3b842a76149a@spatialys.com>
Message-ID: <CAOM3y2jcv=+_xsTDWoh9DfCMn6=aD4ppoPL3Epn2rdwGb6pxLw@mail.gmail.com>

I'm not sure that providing a fix to work around this very broken behavior
is the best way of action to make them fix their server...

On Tue, Sep 10, 2024 at 5:07?PM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

>
> Le 10/09/2024 ? 16:10, Rahkonen Jukka via gdal-dev a ?crit :
>
> Hi,
>
>
>
> Have you tried with configuration option ?CPL_VSIL_CURL_USE_HEAD=[YES/NO]:
> Defaults to YES. Controls whether to use a HEAD request when opening a
> remote URL.?
>
> I was just going to suggest that too. It "works", but not really. It just
> postpones the core issue: the server doesn't support GET Range requests, so
> can't be used with /vsicurl/
>
> As it has a COG organization with overview data first in the file, If you
> want to read the smallest overview(s), you can use /vsicurl_streaming/
> instead, but that won't be efficient to read the bottom-right most tile of
> the full resoultion late, which will require reading the whole file...
>
> Nothing GDAL can do about that.
>
> Actually... digging further... it somehow supports Range requests, but in
> what I believe a non-compliant way. It does return the expected content,
> but returns HTTP 200 and not HTTP 206 (Partial content). And it never
> returns the Content-Length header.
>
> Well, I've implemented a workaround in
> https://github.com/OSGeo/gdal/pull/10760 that might be useful in other
> similar cases too.
>
> With that, the following works:
>
> gdal_translate "/vsicurl?file_size=unlimited&url=https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif" --config GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR out.tif -srcwin 5000 5000 50 50
>
> file_size=unlimited works here since the GTiff driver doesn't really need
> to have the right file size, it will just check we don't try to read beyond
> at some points, so unlimited is OK. In other situations/drivers, the exact
> value could be needed.
>
> But they should really fix their servers
>
> Even
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
> <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Daniel Evans via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 16.57
> *Vastaanottaja:* 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org)
> <gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org>
> *Aihe:* [gdal-dev] Ignore content-length in vsicurl?
>
>
>
> Hi all,
>
>
>
> I am attempting to read a dataset via /vsicurl/ where I believe the server
> is incorrectly returning `content-length: 0` in response to HEAD requests.
> This causes GDAL to believe it's a zero-length file, and it therefore can't
> be read.
>
>
>
> If I download the file via HTTP GET, it's valid, and GDAL can read it
> locally. I've also confirmed I can use /vsicurl/ on some test datasets in
> the GDAL repo.
>
>
>
> Is it possible to force GDAL to work around the faulty content-length
> header, or is it too fundamental a problem to ignore?
>
>
>
> I've separately got in touch with the data provider to see if they are
> able to fix the issue at their end.
>
>
>
> Cheers,
>
> Daniel
>
>
>
>
>
> URL of the troublesome dataset:
>
>
> https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif
>
>
>
>
>
> Example HTTP header responses I'm seeing:
>
>
>
> GET
>
>
>
> HTTP/2 200
> date: Tue, 10 Sep 2024 13:47:54 GMT
> content-type: binary/octet-stream
> content-length: 278198294
> vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
> x-version: 0.0.16
> access-control-allow-credentials: true
>
>
>
> HEAD
>
>
>
> HTTP/2 200
> date: Tue, 10 Sep 2024 13:48:08 GMT
> content-type: binary/octet-stream
> content-length: 0
> x-version: 0.0.16
> access-control-allow-credentials: true
> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
> vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/012acd86/attachment.htm>

From daniel.fred.evans at gmail.com  Tue Sep 10 08:34:20 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Tue, 10 Sep 2024 16:34:20 +0100
Subject: [gdal-dev] Ignore content-length in vsicurl?
In-Reply-To: <CAOM3y2jcv=+_xsTDWoh9DfCMn6=aD4ppoPL3Epn2rdwGb6pxLw@mail.gmail.com>
References: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>
 <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <8ca84522-08cc-4a10-b596-3b842a76149a@spatialys.com>
 <CAOM3y2jcv=+_xsTDWoh9DfCMn6=aD4ppoPL3Epn2rdwGb6pxLw@mail.gmail.com>
Message-ID: <CANnaQaa+vzXvKSwv8AX4tV2uLk+qk3CMgRkvaZ=NZtb0w9hWfQ@mail.gmail.com>

To partially appease the crowd, the data provider has since acknowledged
the issue on their end and are working on a fix - thankfully not one of
those providers that take a month to respond with a shrug.

Cheers,
Daniel



On Tue, 10 Sept 2024 at 16:11, thomas bonfort <thomas.bonfort at gmail.com>
wrote:

> I'm not sure that providing a fix to work around this very broken behavior
> is the best way of action to make them fix their server...
>
> On Tue, Sep 10, 2024 at 5:07?PM Even Rouault via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>>
>> Le 10/09/2024 ? 16:10, Rahkonen Jukka via gdal-dev a ?crit :
>>
>> Hi,
>>
>>
>>
>> Have you tried with configuration option
>> ?CPL_VSIL_CURL_USE_HEAD=[YES/NO]: Defaults to YES. Controls whether to use
>> a HEAD request when opening a remote URL.?
>>
>> I was just going to suggest that too. It "works", but not really. It just
>> postpones the core issue: the server doesn't support GET Range requests, so
>> can't be used with /vsicurl/
>>
>> As it has a COG organization with overview data first in the file, If you
>> want to read the smallest overview(s), you can use /vsicurl_streaming/
>> instead, but that won't be efficient to read the bottom-right most tile of
>> the full resoultion late, which will require reading the whole file...
>>
>> Nothing GDAL can do about that.
>>
>> Actually... digging further... it somehow supports Range requests, but in
>> what I believe a non-compliant way. It does return the expected content,
>> but returns HTTP 200 and not HTTP 206 (Partial content). And it never
>> returns the Content-Length header.
>>
>> Well, I've implemented a workaround in
>> https://github.com/OSGeo/gdal/pull/10760 that might be useful in other
>> similar cases too.
>>
>> With that, the following works:
>>
>> gdal_translate "/vsicurl?file_size=unlimited&url=https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif" --config GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR out.tif -srcwin 5000 5000 50 50
>>
>> file_size=unlimited works here since the GTiff driver doesn't really need
>> to have the right file size, it will just check we don't try to read beyond
>> at some points, so unlimited is OK. In other situations/drivers, the exact
>> value could be needed.
>>
>> But they should really fix their servers
>>
>> Even
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
>> <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Daniel Evans via gdal-dev
>> *L?hetetty:* tiistai 10. syyskuuta 2024 16.57
>> *Vastaanottaja:* 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org)
>> <gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org>
>> *Aihe:* [gdal-dev] Ignore content-length in vsicurl?
>>
>>
>>
>> Hi all,
>>
>>
>>
>> I am attempting to read a dataset via /vsicurl/ where I believe the
>> server is incorrectly returning `content-length: 0` in response to HEAD
>> requests. This causes GDAL to believe it's a zero-length file, and it
>> therefore can't be read.
>>
>>
>>
>> If I download the file via HTTP GET, it's valid, and GDAL can read it
>> locally. I've also confirmed I can use /vsicurl/ on some test datasets in
>> the GDAL repo.
>>
>>
>>
>> Is it possible to force GDAL to work around the faulty content-length
>> header, or is it too fundamental a problem to ignore?
>>
>>
>>
>> I've separately got in touch with the data provider to see if they are
>> able to fix the issue at their end.
>>
>>
>>
>> Cheers,
>>
>> Daniel
>>
>>
>>
>>
>>
>> URL of the troublesome dataset:
>>
>>
>> https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif
>>
>>
>>
>>
>>
>> Example HTTP header responses I'm seeing:
>>
>>
>>
>> GET
>>
>>
>>
>> HTTP/2 200
>> date: Tue, 10 Sep 2024 13:47:54 GMT
>> content-type: binary/octet-stream
>> content-length: 278198294
>> vary: Origin, Access-Control-Request-Method,
>> Access-Control-Request-Headers
>> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
>> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
>> x-version: 0.0.16
>> access-control-allow-credentials: true
>>
>>
>>
>> HEAD
>>
>>
>>
>> HTTP/2 200
>> date: Tue, 10 Sep 2024 13:48:08 GMT
>> content-type: binary/octet-stream
>> content-length: 0
>> x-version: 0.0.16
>> access-control-allow-credentials: true
>> etag: "a79f3f685281d6681e4d362536c5b3eb-34"
>> last-modified: Thu, 25 Jul 2024 13:16:08 GMT
>> vary: Origin, Access-Control-Request-Method,
>> Access-Control-Request-Headers
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240910/59e4b9b1/attachment-0001.htm>

From shawn.fox at baesystems.us  Tue Sep 10 17:41:31 2024
From: shawn.fox at baesystems.us (Fox, Shawn D (US))
Date: Wed, 11 Sep 2024 00:41:31 +0000
Subject: [gdal-dev] Upgrading to GDAL 3.4.2 from 1.10.0 shows different
 outputs from gdaltransform and corresponding C++ API
In-Reply-To: <c0142d4f-95ae-41c7-b9fa-35f55531b6b7@spatialys.com>
Message-ID: <mailman.8.1726015362.32172.gdal-dev@lists.osgeo.org>

We?ve already set it back to the traditional axis order but that code snip wasn?t included.  I had forgotten about that change we had to make to keep our existing code as is.  I think the differences would be drastically different otherwise, but we are seeing differences that are mostly in the 5-7 foot range.  I have seen only one example of a difference greater than 7 feet.  Based on the fact that the NAD27 to WGS84 transforms indicate a precision of only 1.5 meters even with the most precise method, I could probably make a case that the differences I?m seeing are within that margin but I just want to find a way to prove what method GDAL is selecting under the covers.  I need to be able to explain the differences after the upgrade of GDAL and PROJ.

Going back to some of your earlier suggestions I did have some follow up questions. Here is a reference to some of your earlier comments with my questions initialed.

1) The result you get with GDAL 1.10 can be reproduced with modern PROJ versions by allowing (and restricting) to using the CONUS / us_noaa_conus.tif grid which corresponds to the "NAD27 to WGS 84 (79)"
EPSG transformation, with an advertized accuracy of 5.0 m:

$ echo 32.804191 -117.258911 0 | PROJ_NETWORK=ON cct -d 8 +proj=pipeline
+step +proj=axisswap +order=2,1 +step +proj=unitconvert +xy_in=deg
+xy_out=rad +step +proj=hgridshift +grids=us_noaa_conus.tif +step
+proj=unitconvert +xy_in=rad +xy_out=deg +step +proj=axisswap +order=2,1
32.80423938?? -117.25978145??? 0.00000000?????????? inf

sfox ? I am already obtaining that result with GDAL 1.10 and Proj 4.4.9 by specifying only the source and target CRS and the coordinates as shown in the sample code I showed.  This is the result I?d like to get with GDAL 3.4.2, but I cannot figure out how to get that.

sfox ? the other two methods require this step, ?+grids=us_noaa_conus.tif? and I try to run any of those pipelines through the cct program that is part of proj I get a file not found error so that is perplexing.  I see the following output, and I assume that setting PROJ_NETWORK=ON is supposed to allow the correct grids or files to be found.  Why would a file not found or invalid error be presented?

PROJ_NETWORK=ON
echo  $PROJ_NETWORK
ON

echo 32.804191 -117.258911 0 | cct -d 8 +proj=pipeline +step +proj=axisswap +order=2,1 +step +proj=unitconvert +xy_in=deg +xy_out=rad +step +proj=hgridshift +grids=us_noaa_conus.tif +step +proj=hgridshift +grids=us_noaa_cshpgn.tif +step +proj=unitconvert +xy_in=rad +xy_out=deg +step +proj=axisswap +order=2,1

proj_create: Error 1029 (File not found or invalid): pipeline: Pipeline: Bad step definition: proj=hgridshift (File not found or invalid)
cct: Bad transformation arguments - (File not found or invalid)
    'cct -h' for help

2) The result you get with GDAL 3.4.2 / PROJ 8.1.1 can be actually reproduced by using only the "NAD27 to WGS 84 (6)" EPSG Helmert transformation,?with an advertized accuracy of 7.0 m, which is the most precise one in the absence of any grid:

$ echo 32.804191 -117.258911 | cs2cs -d 8 NAD27 WGS84 32.80423884??? -117.25976448 0.00000000

or explicitly with the pipeline show by
projinfo -s NAD27 -t WGS84 --bbox -118,32,-117,33 --spatial-test intersects --single-line

$ echo 32.804191 -117.258911 0 |? cct -d 8 +proj=pipeline +step
+proj=axisswap +order=2,1 +step +proj=unitconvert +xy_in=deg +xy_out=rad
+step +proj=push +v_3 +step +proj=cart +ellps=clrk66 +step +proj=helmert
+x=-8 +y=159 +z=175 +step +inv +proj=cart +ellps=WGS84 +step +proj=pop
+v_3 +step +proj=unitconvert +xy_in=rad +xy_out=deg +step +proj=axisswap
+order=2,1
32.80423884?? -117.25976448??? 0.00000000?????????? inf

sfox - This is the result that I get with GDAL 3.4.2 by specifying only the source and target CRS and the coordinates.   Am I missing something or is the default behavior in the newer version of GDAL 3.4.2 with Proj 8.1.1 giving me a result that is based on a less precise method?  What am I missing?

Shawn Fox
Sr Principal SW Engineer
BAE Systems, Inc.
Geospatial eXploitation Products
T: 858-592-5310 office phone number | M: 858-337-2380 | E: shawn.fox at baesystems.com
10920 Technology Pl, San Diego, CA

From: Even Rouault <even.rouault at spatialys.com>
Sent: Monday, September 9, 2024 6:13 PM
To: Fox, Shawn D (US) <shawn.fox at baesystems.us>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Upgrading to GDAL 3.4.2 from 1.10.0 shows different outputs from gdaltransform and corresponding C++ API

External Email Alert
This email has been sent from an account outside of the BAE Systems network.
Please treat the email with caution, especially if you are requested to click on a link, decrypt/open an attachment, or enable macros.  For further information on how to spot phishing, access ?Cybersecurity OneSpace Page? and report phishing by clicking the button ?Report Phishing? on the Outlook toolbar.



Le 10/09/2024 ? 02:55, Fox, Shawn D (US) via gdal-dev a ?crit :

Evan,



Thanks for putting some time into that response and showing some examples.  Perhaps I should clarify exactly how our software is using GDAL.  I thought that it was easier to show the problem using gdaltransform rather than source code, but that does lack some context.  Here is crude, but simple example of how the C Apis are being used.



--- source code begin ---

OGRSpatialReferenceH sourceSRS = OSRNewSpatialReference(NULL);

OGRSpatialReferenceH targetSRS = OSRNewSpatialReference(NULL);



errorSource = OSRSetWellKnownGeogCS( sourceSRS, "NAD27");

errorTarget = OSRSetWellKnownGeogCS( targetSRS, "WGS84");



OGRCoordinateTransformationH ptrCT = OCTNewCoordinateTransformation( sourceSRS, targetSRS );

status = OCTTransform( ptrCT, 1, x_lon, y_lat, NULL );

Source code speaks for itself :-) This is a CRS axis order issue. Cf https://gdal.org/en/latest/tutorials/osr_api_tut.html#crs-and-axis-order for the whole discussion

With your current code and GDAL >= 3, the input axis order should be (lat, lon) since NAD27 in EPSG is declared as (lat, lon) ordered and GDAL 3 honours that by default

If you want to keep long, lat axis order, add OSRSetAxisMappingStrategy(errorSource, OAMS_TRADITIONAL_GIS_ORDER); and OSRSetAxisMappingStrategy(errorTarget, OAMS_TRADITIONAL_GIS_ORDER); before creating the coordinate transformation

Even

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/672066cb/attachment.htm>

From michael.smith.erdc at gmail.com  Wed Sep 11 06:59:20 2024
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Wed, 11 Sep 2024 08:59:20 -0500
Subject: [gdal-dev] STACIT driver and iten collections and origin / pixel
 size
Message-ID: <2680A3CD-831F-48CF-89FF-9C7C5D688CFE@gmail.com>

Using gdal 3.9.2:

 

I?m using pystac to create stac json item collections. I?m setting the srs of using the projection extension and gdalinfo returns the correct srs that I am setting.

 

gdalinfo STACIT:13459.json

Driver: VRT/Virtual Raster

Files: /vsicurl/https://noaa-nos-coastal-lidar-pds.s3.us-east-1.amazonaws.com/dem/WA_King_DEM_2016_8589/./kingcounty_delivery4_block2_be.tif

?????? /vsicurl/https://noaa-nos-coastal-lidar-pds.s3.us-east-1.amazonaws.com/dem/WA_King_DEM_2016_8589/./kingcounty_delivery4_block1_be.tif

Size is 74182, 79467

Coordinate System is:

COMPOUNDCRS["NAD83(HARN) / Washington North (ftUS) + NAVD88 height (ftUS)",

??? PROJCRS["NAD83(HARN) / Washington North (ftUS)",

 

 

But when I look at the origin / pixel size / bounding box, its in geodetic coordinates. Is this how it should be reported? I was also doing some conversions from stac to vrt to support arcpro users and the vrt then inherits the bbox/pixel size/origin of the geodetic values from stac. Trying to see how I can get these values in actual projected coordinates.

 

Mike

 

 

-- 

Michael Smith

Remote Sensing/GIS Center

US Army Corps of Engineers

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/8af75f19/attachment.htm>

From even.rouault at spatialys.com  Wed Sep 11 07:11:33 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 11 Sep 2024 16:11:33 +0200
Subject: [gdal-dev] STACIT driver and iten collections and origin /
 pixel size
In-Reply-To: <2680A3CD-831F-48CF-89FF-9C7C5D688CFE@gmail.com>
References: <2680A3CD-831F-48CF-89FF-9C7C5D688CFE@gmail.com>
Message-ID: <02cea214-87e5-4832-81ec-81ee06af5867@spatialys.com>

Michael,

can you paste the definition of such STAC Json item ?? Guess: 
"proj:epsg" is present, but "proj:bbox" or "proj:transform" are using 
WGS84 coordinates ?

Even

Le 11/09/2024 ? 15:59, Michael Smith via gdal-dev a ?crit?:
>
> Using gdal 3.9.2:
>
> I?m using pystac to create stac json item collections. I?m setting the 
> srs of using the projection extension and gdalinfo returns the correct 
> srs that I am setting.
>
> gdalinfo STACIT:13459.json
>
> Driver: VRT/Virtual Raster
>
> Files: 
> /vsicurl/https://noaa-nos-coastal-lidar-pds.s3.us-east-1.amazonaws.com/dem/WA_King_DEM_2016_8589/./kingcounty_delivery4_block2_be.tif
>
> /vsicurl/https://noaa-nos-coastal-lidar-pds.s3.us-east-1.amazonaws.com/dem/WA_King_DEM_2016_8589/./kingcounty_delivery4_block1_be.tif
>
> Size is 74182, 79467
>
> Coordinate System is:
>
> COMPOUNDCRS["NAD83(HARN) / Washington North (ftUS) + NAVD88 height 
> (ftUS)",
>
> ??? PROJCRS["NAD83(HARN) / Washington North (ftUS)",
>
> But when I look at the origin / pixel size / bounding box, its in 
> geodetic coordinates. Is this how it should be reported? I was also 
> doing some conversions from stac to vrt to support arcpro users and 
> the vrt then inherits the bbox/pixel size/origin of the geodetic 
> values from stac. Trying to see how I can get these values in actual 
> projected coordinates.
>
> Mike
>
> -- 
>
> Michael Smith
>
> Remote Sensing/GIS Center
>
> US Army Corps of Engineers
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/b145e478/attachment.htm>

From michael.smith.erdc at gmail.com  Wed Sep 11 07:17:04 2024
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Wed, 11 Sep 2024 09:17:04 -0500
Subject: [gdal-dev] STACIT driver and iten collections and origin /
 pixel size
In-Reply-To: <02cea214-87e5-4832-81ec-81ee06af5867@spatialys.com>
References: <2680A3CD-831F-48CF-89FF-9C7C5D688CFE@gmail.com>
 <02cea214-87e5-4832-81ec-81ee06af5867@spatialys.com>
Message-ID: <713B7D90-730B-4572-8BFE-B60873904221@gmail.com>

The proj:bbox is in geodetic. Is that the issue, the bbox needs to be in the projected coords? I have proj:projjson and proj:wkt2 defined but the bbox is geodetic. 

 

Mike

 

 

 

From: Even Rouault <even.rouault at spatialys.com>
Date: Wednesday, September 11, 2024 at 9:11?AM
To: Michael Smith <michael.smith.erdc at gmail.com>, <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] STACIT driver and iten collections and origin / pixel size

 

Michael,

can you paste the definition of such STAC Json item ?  Guess: "proj:epsg" is present, but "proj:bbox" or "proj:transform" are using WGS84 coordinates ?

Even

Le 11/09/2024 ? 15:59, Michael Smith via gdal-dev a ?crit :

Using gdal 3.9.2:

 

I?m using pystac to create stac json item collections. I?m setting the srs of using the projection extension and gdalinfo returns the correct srs that I am setting.

 

gdalinfo STACIT:13459.json

Driver: VRT/Virtual Raster

Files: /vsicurl/https://noaa-nos-coastal-lidar-pds.s3.us-east-1.amazonaws.com/dem/WA_King_DEM_2016_8589/./kingcounty_delivery4_block2_be.tif

       /vsicurl/https://noaa-nos-coastal-lidar-pds.s3.us-east-1.amazonaws.com/dem/WA_King_DEM_2016_8589/./kingcounty_delivery4_block1_be.tif

Size is 74182, 79467

Coordinate System is:

COMPOUNDCRS["NAD83(HARN) / Washington North (ftUS) + NAVD88 height (ftUS)",

    PROJCRS["NAD83(HARN) / Washington North (ftUS)",

 

 

But when I look at the origin / pixel size / bounding box, its in geodetic coordinates. Is this how it should be reported? I was also doing some conversions from stac to vrt to support arcpro users and the vrt then inherits the bbox/pixel size/origin of the geodetic values from stac. Trying to see how I can get these values in actual projected coordinates.

 

Mike

 

 

-- 

Michael Smith

Remote Sensing/GIS Center

US Army Corps of Engineers

 



_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/9b4eef6d/attachment.htm>

From even.rouault at spatialys.com  Wed Sep 11 07:19:03 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 11 Sep 2024 16:19:03 +0200
Subject: [gdal-dev] STACIT driver and iten collections and origin /
 pixel size
In-Reply-To: <713B7D90-730B-4572-8BFE-B60873904221@gmail.com>
References: <2680A3CD-831F-48CF-89FF-9C7C5D688CFE@gmail.com>
 <02cea214-87e5-4832-81ec-81ee06af5867@spatialys.com>
 <713B7D90-730B-4572-8BFE-B60873904221@gmail.com>
Message-ID: <0bf9a646-62a6-4eb2-a00b-03a07ffacb35@spatialys.com>


Le 11/09/2024 ? 16:17, Michael Smith a ?crit?:
>
> The proj:bbox is in geodetic. Is that the issue, the bbox needs to be 
> in the projected coords? I have proj:projjson and proj:wkt2 defined 
> but the bbox is geodetic.
>
Per the spec, yes, this is wrong.

Cf 
https://github.com/stac-extensions/projection/?tab=readme-ov-file#projbbox: 
"Bounding box of the assets represented by this Item in the asset data 
CRS. Specified as 4 or 6 coordinates based on the CRS defined in the 
|proj:code|, |proj:projjson| or |proj:wkt2| fields. [...]"


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/8bfd995f/attachment-0001.htm>

From michael.smith.erdc at gmail.com  Wed Sep 11 07:21:19 2024
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Wed, 11 Sep 2024 09:21:19 -0500
Subject: [gdal-dev] STACIT driver and iten collections and origin /
 pixel size
In-Reply-To: <0bf9a646-62a6-4eb2-a00b-03a07ffacb35@spatialys.com>
References: <2680A3CD-831F-48CF-89FF-9C7C5D688CFE@gmail.com>
 <02cea214-87e5-4832-81ec-81ee06af5867@spatialys.com>
 <713B7D90-730B-4572-8BFE-B60873904221@gmail.com>
 <0bf9a646-62a6-4eb2-a00b-03a07ffacb35@spatialys.com>
Message-ID: <26C709DC-45BA-432E-A406-728B48A2F179@gmail.com>

Thanks for the clarification!

 

Mike

 

 

-- 

Michael Smith

Remote Sensing/GIS Center

US Army Corps of Engineers

 

 

From: Even Rouault <even.rouault at spatialys.com>
Date: Wednesday, September 11, 2024 at 9:19?AM
To: Michael Smith <michael.smith.erdc at gmail.com>, <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] STACIT driver and iten collections and origin / pixel size

 

 

Le 11/09/2024 ? 16:17, Michael Smith a ?crit :

The proj:bbox is in geodetic. Is that the issue, the bbox needs to be in the projected coords? I have proj:projjson and proj:wkt2 defined but the bbox is geodetic. 

Per the spec, yes, this is wrong.

Cf https://github.com/stac-extensions/projection/?tab=readme-ov-file#projbbox: "Bounding box of the assets represented by this Item in the asset data CRS. Specified as 4 or 6 coordinates based on the CRS defined in the proj:code, proj:projjson or proj:wkt2 fields. [...]"



-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/f48a3637/attachment.htm>

From daniel.fred.evans at gmail.com  Wed Sep 11 07:33:27 2024
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Wed, 11 Sep 2024 15:33:27 +0100
Subject: [gdal-dev] STACIT driver and iten collections and origin /
 pixel size
In-Reply-To: <26C709DC-45BA-432E-A406-728B48A2F179@gmail.com>
References: <2680A3CD-831F-48CF-89FF-9C7C5D688CFE@gmail.com>
 <02cea214-87e5-4832-81ec-81ee06af5867@spatialys.com>
 <713B7D90-730B-4572-8BFE-B60873904221@gmail.com>
 <0bf9a646-62a6-4eb2-a00b-03a07ffacb35@spatialys.com>
 <26C709DC-45BA-432E-A406-728B48A2F179@gmail.com>
Message-ID: <CANnaQabzaUwu6AoQwgW+5Qxu_8GX3tLanmAP9u0h+GJnS4Yoow@mail.gmail.com>

And I'll highlight that the separate `geometry` and `bbox` fields in the
STAC item do explicitly have to be projected in WGS84 (as required by the
GeoJSON spec):
https://github.com/radiantearth/stac-spec/blob/master/item-spec/item-spec.md#geometry

(Although I suspect the original mistake was taking the values for those
and dropping them into the `proj:...` fields, which I've done before)

Cheers,
Daniel


On Wed, 11 Sept 2024 at 15:21, Michael Smith via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Thanks for the clarification!
>
>
>
> Mike
>
>
>
>
>
> --
>
> Michael Smith
>
> Remote Sensing/GIS Center
>
> US Army Corps of Engineers
>
>
>
>
>
> *From: *Even Rouault <even.rouault at spatialys.com>
> *Date: *Wednesday, September 11, 2024 at 9:19?AM
> *To: *Michael Smith <michael.smith.erdc at gmail.com>, <
> gdal-dev at lists.osgeo.org>
> *Subject: *Re: [gdal-dev] STACIT driver and iten collections and origin /
> pixel size
>
>
>
>
>
> Le 11/09/2024 ? 16:17, Michael Smith a ?crit :
>
> The proj:bbox is in geodetic. Is that the issue, the bbox needs to be in
> the projected coords? I have proj:projjson and proj:wkt2 defined but the
> bbox is geodetic.
>
> Per the spec, yes, this is wrong.
>
> Cf
> https://github.com/stac-extensions/projection/?tab=readme-ov-file#projbbox:
> "Bounding box of the assets represented by this Item in the asset data CRS.
> Specified as 4 or 6 coordinates based on the CRS defined in the proj:code,
> proj:projjson or proj:wkt2 fields. [...]"
>
>
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/7bda3c42/attachment.htm>

From even.rouault at spatialys.com  Wed Sep 11 12:26:41 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 11 Sep 2024 21:26:41 +0200
Subject: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
 thread-safety"
Message-ID: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>

Hi,

I move to approve RFC 101 "Raster dataset read-only thread-safety": 
https://github.com/OSGeo/gdal/pull/10676

Starting with my +1,

The candidate implementation is available in 
https://github.com/OSGeo/gdal/pull/10746. While fine tuning it, I 
realized there were subtleties, related to the fact we use thread-local 
datasets under the hood, for methods returning a non-"primitive" type, 
such as a "const char*" whose lifetime is tied to a dataset/band. If 
we'd get it from a thread-local dataset, and that one would be later 
evicted from the cache (not very common, but could happen if one would 
open tons of thread-safe datasets at the same time), then you could have 
use-after-free issues. For such methods (GetMetadata(), 
GetMetadataItem(), GetProjectionRef(), etc. as well as GetColorTable() 
which returns a GDALColorTable pointer, or GetSpatialRef() which returns 
a OGRSpatialReference*), I've preferred to protect their access with a 
mutex around the "prototype" dataset passed when constructing 
GDALMultiThreadedDataset, whose lifetime is at least as long as 
GDALMultiThreadedDataset (cf commit 
https://github.com/OSGeo/gdal/pull/10746/commits/849e9cea711efd30c47fd90a7a6b71a75611c1a5#diff-687008dd6e3d5ac8ad05568272746ed75b84de50bde508f78f2d79a6842825c7L428) 
. Normally such methods aren't called in user code repeatedly, so there 
should be any noticeable lock contention in practice. The main objective 
of the RFC which is to be able to issue RasterIO() requests in parallel 
isn't affected by that. Ah, and one thing I realized is that 
OGRSpatialReference isn't thread-safe, so I've also added an optional 
SetThreadSafe() on it, to also use a per-instance mutex in 
multi-threaded scenarios (cf commit 
https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd). 
Multi-threading is hard...

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Sep 11 12:30:57 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 11 Sep 2024 21:30:57 +0200
Subject: [gdal-dev] Extending GDAL Color Interpretation enumeration for
 infra-red bands (+ band wavelength) ?
In-Reply-To: <7e3b9144-5241-44ea-8910-08f92d8918f2@spatialys.com>
References: <043bce04-fa2a-417d-b03b-72f9e5333ba1@spatialys.com>
 <CADRrdKtBAQ6R4oY4Kr-19RfH3ksfJB2+zvtTF0QQi0zki0k7Cw@mail.gmail.com>
 <c69ef7ef-b150-44ca-8f61-557af1e565f3@spatialys.com>
 <CADRrdKvnddsA+PEMzkHX7o2Gyz+Er0hcL7N5xrS51ERULzSM0w@mail.gmail.com>
 <7e3b9144-5241-44ea-8910-08f92d8918f2@spatialys.com>
Message-ID: <a7704bac-0a17-4882-94e6-02b201b09b14@spatialys.com>


Le 03/09/2024 ? 19:02, Even Rouault via gdal-dev a ?crit?:
>
> Le 02/09/2024 ? 19:07, Javier Jimenez Shaw a ?crit?:
>> Based on the last email I am not sure if you want to include the 
>> CentralWavelenght and FWHM or not.
>
> yes, candidate implementation in https://github.com/OSGeo/gdal/pull/10721 

While we're at it, the enumeration has also been extended with constants 
for SAR (Synthetic-aperture radar) bands.

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From schwehr at gmail.com  Wed Sep 11 12:35:22 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 11 Sep 2024 12:35:22 -0700
Subject: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
 thread-safety"
In-Reply-To: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
References: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
Message-ID: <CACmBxytbESks0fLi6wQZ6rjRH7G88AY2rEu=9XAXrtir+WCH9A@mail.gmail.com>

+1 KurtS

On Wed, Sep 11, 2024 at 12:27?PM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I move to approve RFC 101 "Raster dataset read-only thread-safety":
> https://github.com/OSGeo/gdal/pull/10676
>
> Starting with my +1,
>
> The candidate implementation is available in
> https://github.com/OSGeo/gdal/pull/10746. While fine tuning it, I
> realized there were subtleties, related to the fact we use thread-local
> datasets under the hood, for methods returning a non-"primitive" type,
> such as a "const char*" whose lifetime is tied to a dataset/band. If
> we'd get it from a thread-local dataset, and that one would be later
> evicted from the cache (not very common, but could happen if one would
> open tons of thread-safe datasets at the same time), then you could have
> use-after-free issues. For such methods (GetMetadata(),
> GetMetadataItem(), GetProjectionRef(), etc. as well as GetColorTable()
> which returns a GDALColorTable pointer, or GetSpatialRef() which returns
> a OGRSpatialReference*), I've preferred to protect their access with a
> mutex around the "prototype" dataset passed when constructing
> GDALMultiThreadedDataset, whose lifetime is at least as long as
> GDALMultiThreadedDataset (cf commit
>
> https://github.com/OSGeo/gdal/pull/10746/commits/849e9cea711efd30c47fd90a7a6b71a75611c1a5#diff-687008dd6e3d5ac8ad05568272746ed75b84de50bde508f78f2d79a6842825c7L428)
>
> . Normally such methods aren't called in user code repeatedly, so there
> should be any noticeable lock contention in practice. The main objective
> of the RFC which is to be able to issue RasterIO() requests in parallel
> isn't affected by that. Ah, and one thing I realized is that
> OGRSpatialReference isn't thread-safe, so I've also added an optional
> SetThreadSafe() on it, to also use a per-instance mutex in
> multi-threaded scenarios (cf commit
>
> https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd).
>
> Multi-threading is hard...
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/ee8d2d1c/attachment.htm>

From even.rouault at spatialys.com  Wed Sep 11 13:47:55 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 11 Sep 2024 22:47:55 +0200
Subject: [gdal-dev] Ignore content-length in vsicurl?
In-Reply-To: <CAOM3y2jcv=+_xsTDWoh9DfCMn6=aD4ppoPL3Epn2rdwGb6pxLw@mail.gmail.com>
References: <CANnaQaYcDG5nTfQMj=vwH+n4aj2WaN6=1_19mS0-OvdOsqMF9w@mail.gmail.com>
 <DB9PR09MB6887A6E392A9DDB7EB558AB3FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <8ca84522-08cc-4a10-b596-3b842a76149a@spatialys.com>
 <CAOM3y2jcv=+_xsTDWoh9DfCMn6=aD4ppoPL3Epn2rdwGb6pxLw@mail.gmail.com>
Message-ID: <5ce6f85b-eac7-479d-bd83-d933f9261689@spatialys.com>

The server seems to have been fixed, but on reflection, I won't merge 
the workaround PR as this is (thanksfully) quite an unusual case. At 
least the PR is there if someone badly needed to patch their build with 
such a workaround.

Le 10/09/2024 ? 17:11, thomas bonfort a ?crit?:
> I'm not sure that providing a fix to work around this very broken 
> behavior is the best way of action to make them fix their server...
>
> On Tue, Sep 10, 2024 at 5:07?PM Even Rouault via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>
>     Le 10/09/2024 ? 16:10, Rahkonen Jukka via gdal-dev a ?crit?:
>>
>>     Hi,
>>
>>     Have you tried with configuration option
>>     ?CPL_VSIL_CURL_USE_HEAD=[YES/NO]: Defaults to YES. Controls
>>     whether to use a HEAD request when opening a remote URL.?
>>
>     I was just going to suggest that too. It "works", but not really.
>     It just postpones the core issue: the server doesn't support GET
>     Range requests, so can't be used with /vsicurl/
>
>     As it has a COG organization with overview data first in the file,
>     If you want to read the smallest overview(s), you can use
>     /vsicurl_streaming/ instead, but that won't be efficient to read
>     the bottom-right most tile of the full resoultion late, which will
>     require reading the whole file...
>
>     Nothing GDAL can do about that.
>
>     Actually... digging further... it somehow supports Range requests,
>     but in what I believe a non-compliant way. It does return the
>     expected content, but returns HTTP 200 and not HTTP 206 (Partial
>     content). And it never returns the Content-Length header.
>
>     Well, I've implemented a workaround in
>     https://github.com/OSGeo/gdal/pull/10760 that might be useful in
>     other similar cases too.
>
>     With that, the following works:
>
>     |gdal_translate
>     "/vsicurl?file_size=unlimited&url=https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif"
>     --config GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR out.tif -srcwin
>     5000 5000 50 50|
>
>     file_size=unlimited works here since the GTiff driver doesn't
>     really need to have the right file size, it will just check we
>     don't try to read beyond at some points, so unlimited is OK. In
>     other situations/drivers, the exact value could be needed.
>
>     But they should really fix their servers
>
>     Even
>
>>     -Jukka Rahkonen-
>>
>>     *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
>>     <mailto:gdal-dev-bounces at lists.osgeo.org> *Puolesta *Daniel Evans
>>     via gdal-dev
>>     *L?hetetty:* tiistai 10. syyskuuta 2024 16.57
>>     *Vastaanottaja:* 'gdal-dev at lists.osgeo.org'
>>     (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
>>     <mailto:gdal-dev at lists.osgeo.org>
>>     *Aihe:* [gdal-dev] Ignore content-length in vsicurl?
>>
>>     Hi all,
>>
>>     I am attempting to read a dataset via /vsicurl/ where I believe
>>     the server is incorrectly returning `content-length: 0` in
>>     response to HEAD requests. This causes GDAL to believe it's a
>>     zero-length file, and it therefore can't be read.
>>
>>     If I download the file via HTTP GET, it's valid, and GDAL can
>>     read it locally. I've also confirmed I can use /vsicurl/ on some
>>     test datasets in the GDAL repo.
>>
>>     Is it possible to force GDAL to work around the faulty
>>     content-length header, or is it too fundamental a problem to ignore?
>>
>>     I've separately got in touch with the data provider to see if
>>     they are able to fix the issue at their end.
>>
>>     Cheers,
>>
>>     Daniel
>>
>>     URL of the troublesome dataset:
>>
>>     https://data.source.coop/earthgenome/sentinel2-temporal-mosaics/20NMH_2024-04-01_2024-08-01/B08.tif
>>
>>     Example HTTP header responses I'm seeing:
>>
>>     GET
>>
>>     HTTP/2 200
>>     date: Tue, 10 Sep 2024 13:47:54 GMT
>>     content-type: binary/octet-stream
>>     content-length: 278198294
>>     vary: Origin, Access-Control-Request-Method,
>>     Access-Control-Request-Headers
>>     etag: "a79f3f685281d6681e4d362536c5b3eb-34"
>>     last-modified: Thu, 25 Jul 2024 13:16:08 GMT
>>     x-version: 0.0.16
>>     access-control-allow-credentials: true
>>
>>     HEAD
>>
>>     HTTP/2 200
>>     date: Tue, 10 Sep 2024 13:48:08 GMT
>>     content-type: binary/octet-stream
>>     content-length: 0
>>     x-version: 0.0.16
>>     access-control-allow-credentials: true
>>     etag: "a79f3f685281d6681e4d362536c5b3eb-34"
>>     last-modified: Thu, 25 Jul 2024 13:16:08 GMT
>>     vary: Origin, Access-Control-Request-Method,
>>     Access-Control-Request-Headers
>>
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/262f4227/attachment-0001.htm>

From howard at hobu.co  Wed Sep 11 19:23:31 2024
From: howard at hobu.co (Howard Butler)
Date: Wed, 11 Sep 2024 21:23:31 -0500
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
Message-ID: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>

PSC,

I am motioning to renew Even's maintainer contract through the GDAL Sponsorship Program that is hosted by NumFOCUS for another year.

/me starts with a +1

Howard

From dmorissette at mapgears.com  Wed Sep 11 19:28:11 2024
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Wed, 11 Sep 2024 22:28:11 -0400
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
Message-ID: <03fb4c66-c757-4db2-9acf-b4777d9847a2@mapgears.com>

+1!

Daniel

On 2024-09-11 22:23, Howard Butler via gdal-dev wrote:
> PSC,
>
> I am motioning to renew Even's maintainer contract through the GDAL Sponsorship Program that is hosted by NumFOCUS for another year.
>
> /me starts with a +1
>
> Howard
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/9cb9da89/attachment.htm>

From public at postholer.com  Wed Sep 11 20:50:18 2024
From: public at postholer.com (Scott)
Date: Wed, 11 Sep 2024 20:50:18 -0700
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
Message-ID: <9b6b8f10-702e-4d7d-9e94-c0bcfd247234@postholer.com>

Only a year? Someone chain him to his desk already. You can't be too 
cautious. ;)

Scott

On 9/11/24 19:23, Howard Butler via gdal-dev wrote:
> PSC,
> 
> I am motioning to renew Even's maintainer contract through the GDAL Sponsorship Program that is hosted by NumFOCUS for another year.
> 
> /me starts with a +1
> 
> Howard
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From schwehr at gmail.com  Wed Sep 11 21:31:16 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 11 Sep 2024 21:31:16 -0700
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
Message-ID: <CACmBxyuP=YH6Tqvz3VKaNWaUef1GhTKLX9dR+m7OA-pncuEbRA@mail.gmail.com>

+1 KurtS

On Wed, Sep 11, 2024 at 7:24?PM Howard Butler via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> PSC,
>
> I am motioning to renew Even's maintainer contract through the GDAL
> Sponsorship Program that is hosted by NumFOCUS for another year.
>
> /me starts with a +1
>
> Howard
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240911/6f97d0af/attachment.htm>

From j1 at jimenezshaw.com  Wed Sep 11 22:31:19 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 12 Sep 2024 07:31:19 +0200
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <CACmBxyuP=YH6Tqvz3VKaNWaUef1GhTKLX9dR+m7OA-pncuEbRA@mail.gmail.com>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
 <CACmBxyuP=YH6Tqvz3VKaNWaUef1GhTKLX9dR+m7OA-pncuEbRA@mail.gmail.com>
Message-ID: <CADRrdKuUitb-4cZfoDkAy1FF1tfETzEinAzYAjZYZw8ieP2v8w@mail.gmail.com>

+1 Javier

On Thu, 12 Sept 2024, 06:31 Kurt Schwehr via gdal-dev, <
gdal-dev at lists.osgeo.org> wrote:

> +1 KurtS
>
> On Wed, Sep 11, 2024 at 7:24?PM Howard Butler via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> PSC,
>>
>> I am motioning to renew Even's maintainer contract through the GDAL
>> Sponsorship Program that is hosted by NumFOCUS for another year.
>>
>> /me starts with a +1
>>
>> Howard
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/44aa2422/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Sep 11 23:07:16 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 12 Sep 2024 06:07:16 +0000
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
Message-ID: <DB9PR09MB6887A657B7F40DAD2E459CC6FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Howard Butler via gdal-dev
L?hetetty: torstai 12. syyskuuta 2024 5.24
Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract

PSC,

I am motioning to renew Even's maintainer contract through the GDAL Sponsorship Program that is hosted by NumFOCUS for another year.

/me starts with a +1

Howard
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org

From jukka.rahkonen at maanmittauslaitos.fi  Wed Sep 11 23:27:35 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 12 Sep 2024 06:27:35 +0000
Subject: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
 thread-safety"
In-Reply-To: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
References: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
Message-ID: <DB9PR09MB6887DB76C109D3ED5573646BFD642@DB9PR09MB6887.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
L?hetetty: keskiviikko 11. syyskuuta 2024 22.27
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only thread-safety"

Hi,

I move to approve RFC 101 "Raster dataset read-only thread-safety":
https://github.com/OSGeo/gdal/pull/10676

Starting with my +1,

The candidate implementation is available in https://github.com/OSGeo/gdal/pull/10746. While fine tuning it, I realized there were subtleties, related to the fact we use thread-local datasets under the hood, for methods returning a non-"primitive" type, such as a "const char*" whose lifetime is tied to a dataset/band. If we'd get it from a thread-local dataset, and that one would be later evicted from the cache (not very common, but could happen if one would open tons of thread-safe datasets at the same time), then you could have use-after-free issues. For such methods (GetMetadata(), GetMetadataItem(), GetProjectionRef(), etc. as well as GetColorTable() which returns a GDALColorTable pointer, or GetSpatialRef() which returns a OGRSpatialReference*), I've preferred to protect their access with a mutex around the "prototype" dataset passed when constructing GDALMultiThreadedDataset, whose lifetime is at least as long as GDALMultiThreadedDataset (cf commit
https://github.com/OSGeo/gdal/pull/10746/commits/849e9cea711efd30c47fd90a7a6b71a75611c1a5#diff-687008dd6e3d5ac8ad05568272746ed75b84de50bde508f78f2d79a6842825c7L428)
. Normally such methods aren't called in user code repeatedly, so there should be any noticeable lock contention in practice. The main objective of the RFC which is to be able to issue RasterIO() requests in parallel isn't affected by that. Ah, and one thing I realized is that OGRSpatialReference isn't thread-safe, so I've also added an optional
SetThreadSafe() on it, to also use a per-instance mutex in multi-threaded scenarios (cf commit https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd).
Multi-threading is hard...

Even

--
http://www.spatialys.com/
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From Mika.Heiskanen at fmi.fi  Thu Sep 12 00:22:06 2024
From: Mika.Heiskanen at fmi.fi (Heiskanen Mika (FMI))
Date: Thu, 12 Sep 2024 07:22:06 +0000
Subject: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
 thread-safety"
In-Reply-To: <DB9PR09MB6887DB76C109D3ED5573646BFD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
 <DB9PR09MB6887DB76C109D3ED5573646BFD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <AS2PR09MB6367C0561A3BECB76875155CE1642@AS2PR09MB6367.eurprd09.prod.outlook.com>

  *
Ah, and one thing I realized is that OGRSpatialReference isn't thread-safe, so I've also added an optional SetThreadSafe() on it, to also use a per-instance mutex in multi-threaded scenarios (cf commit https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd).

Perhaps I am missing something, but why not use read locks for const methods and write locks for non-const methods so that readers would not block each other so much?

-Mika Heiskanen-

________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Rahkonen Jukka via gdal-dev <gdal-dev at lists.osgeo.org>
Sent: Thursday, September 12, 2024 09:27
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only thread-safety"

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
L?hetetty: keskiviikko 11. syyskuuta 2024 22.27
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only thread-safety"

Hi,

I move to approve RFC 101 "Raster dataset read-only thread-safety":
https://github.com/OSGeo/gdal/pull/10676

Starting with my +1,

The candidate implementation is available in https://github.com/OSGeo/gdal/pull/10746. While fine tuning it, I realized there were subtleties, related to the fact we use thread-local datasets under the hood, for methods returning a non-"primitive" type, such as a "const char*" whose lifetime is tied to a dataset/band. If we'd get it from a thread-local dataset, and that one would be later evicted from the cache (not very common, but could happen if one would open tons of thread-safe datasets at the same time), then you could have use-after-free issues. For such methods (GetMetadata(), GetMetadataItem(), GetProjectionRef(), etc. as well as GetColorTable() which returns a GDALColorTable pointer, or GetSpatialRef() which returns a OGRSpatialReference*), I've preferred to protect their access with a mutex around the "prototype" dataset passed when constructing GDALMultiThreadedDataset, whose lifetime is at least as long as GDALMultiThreadedDataset (cf commit
https://github.com/OSGeo/gdal/pull/10746/commits/849e9cea711efd30c47fd90a7a6b71a75611c1a5#diff-687008dd6e3d5ac8ad05568272746ed75b84de50bde508f78f2d79a6842825c7L428)
. Normally such methods aren't called in user code repeatedly, so there should be any noticeable lock contention in practice. The main objective of the RFC which is to be able to issue RasterIO() requests in parallel isn't affected by that. Ah, and one thing I realized is that OGRSpatialReference isn't thread-safe, so I've also added an optional
SetThreadSafe() on it, to also use a per-instance mutex in multi-threaded scenarios (cf commit https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd).
Multi-threading is hard...

Even

--
http://www.spatialys.com/
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/07ded8fb/attachment.htm>

From michkowalczuk at gmail.com  Thu Sep 12 04:34:38 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Thu, 12 Sep 2024 13:34:38 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
 <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
Message-ID: <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>

So we remain at the point that there is no good method that, using only
GDAL, will allow to fully use the WMS service without additional work
related to XML parsing...?

Best,
Micha? Kowalczuk

wt., 10 wrz 2024 o 17:06 Micha? Kowalczuk <michkowalczuk at gmail.com>
napisa?(a):

> A sample from your link:
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *<Layer queryable="1"
> opaque="0"><Name>Rakennustietoruudukko_2017</Name><Title>Rakennustietoruudukko
> 2017</Title><Abstract>Tietoa rakennuksista 250 x 250m ruudukoissa
> p??kaupunkiseudulla</Abstract><KeywordList><Keyword>features</Keyword><Keyword>Rakennustietoruudukko_2017</Keyword></KeywordList><CRS>EPSG:3879</CRS><CRS>CRS:84</CRS><EX_GeographicBoundingBox><westBoundLongitude>24.50112802448554</westBoundLongitude><eastBoundLongitude>25.25849178466466</eastBoundLongitude><southBoundLatitude>60.052265324029165</southBoundLatitude><northBoundLatitude>60.39874702231777</northBoundLatitude></EX_GeographicBoundingBox><BoundingBox
> CRS="CRS:84" minx="24.50112802448554" miny="60.052265324029165"
> maxx="25.25849178466466" maxy="60.39874702231777"/><BoundingBox
> CRS="EPSG:3879" minx="6659998.5" miny="2.5472498E7" maxx="6698499.5"
> maxy="2.551425E7"/><Style><Name>polygon</Name><Title>Default polygon
> style</Title><Abstract>A sample style that just draws out a solid gray
> interior with a black 1px outline</Abstract><LegendURL width="20"
> height="20"><Format>image/png</Format><OnlineResource
> xmlns:xlink="http://www.w3.org/1999/xlink <http://www.w3.org/1999/xlink>"
> xlink:type="simple"
> xlink:href="https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017
> <https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017>"/></LegendURL></Style></Layer>*
>
>
> wt., 10 wrz 2024 o 17:05 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
>> Ok, now I see the problem. Thank you Jukka for the explanation with a
>> sample.
>> So maybe we can use information from *BoundingBox*?
>> and generate SUBDATASETS for each combination of Layer and BoundingBox
>> definition that is usually defined for "best"/dedicated projections for a
>> layer.
>>
>> *(7.2.4.6.8 )*
>>
>> *A Layer may have multiple BoundingBox elements, but each one shall state
>> a different CRS (...)*
>> *A Layer shall not provide a BoundingBox for a CRS it does not support.
>> Conversely, a Layer may support CRSs*
>> *for which it does not provide a BoundingBox: a server that has the
>> ability to transform data to different CRSs may*
>> *choose not to provide an explicit BoundingBox for every possible CRS
>> available for each Layer. The server*
>> *should provide BoundingBox information for at least the native CRS of
>> the Layer (that is, the CRS in which the*
>> *Layer is stored in the server?s database).*
>>
>> Best,
>> Micha?
>>
>> W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka <
>> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>>
>>> Hi
>>>
>>>
>>>
>>>    - I meant to use CRSs only reported by GetCapabilities. I haven't
>>>    seen that GetCapabilities returns so many (6782) possible projections...
>>>
>>>
>>>
>>> I was meaning the same, CRSs reported in GetCapabilities. I used a
>>> search engine with phrase ?service=WMS&version=1.3.0? and found in three
>>> minutes many examples, including this one
>>> kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities.
>>> If you want to see more, install Geoserver on your computer and have a look
>>> at the default GetCapabilities.
>>>
>>>
>>>
>>> Finding the best CRS from WMS GetCapabilities is guesswork. The server
>>> above is a Finnish one so probably EPSG:3067 is the most native CRS because
>>> that is what we tend to use in Finland. However, there is also one and only
>>> one additional BBOX for EPSG:3879 in GetCapabilities, but that would be
>>> somewhat odd selection for a country-wide CRS. It is also possible that for
>>> example some CRS of New Zealand does not really work in GetMap of the
>>> Finnish data even GetCapabilities says it will. But when WMS is configured
>>> to show a short CRS list then I would trust that they are all good to use.
>>> Just be aware that the list can also be very long.
>>>
>>>
>>>
>>> If you start implementing the LIST_ALL_SRS option, it should be noted
>>> that the service level CRS list applies to all layers, and each layer can
>>> add more CRSs to the list. Maybe in theory there could be even
>>> ?crs-list-of-service-root + crs-list-of-group-layer +
>>> crs-list-of-child-layer?.
>>>
>>>
>>>
>>> ?7.2.4.6.7 CRS
>>>
>>> Every Layer is available in one or more layer coordinate reference
>>> systems. 6.7.3 discusses the Layer CRS. In
>>>
>>> order to indicate which Layer CRSs are available, every named Layer
>>> shall have at least one <CRS> element that
>>>
>>> is either stated explicitly or inherited from a parent Layer. The root
>>> <Layer> element shall include a sequence of
>>>
>>> zero or more CRS elements listing all CRSs that are common to all
>>> subsidiary layers. A child layer may optionally
>>>
>>> add to the list inherited from a parent layer. Any duplication shall be
>>> ignored by clients.
>>>
>>> When a Layer is available in several coordinate reference systems, the
>>> list of available CRS values shall be
>>>
>>> represented as a sequence of <CRS> elements, each of which contains only
>>> a single CRS name.?
>>>
>>>
>>>
>>> -Jukka Rahkonen-
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
>>> *L?hetetty:* tiistai 10. syyskuuta 2024 16.32
>>> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>>> *Kopio:* gdal-dev at lists.osgeo.org
>>>
>>>
>>> *Aihe:* Re: [gdal-dev] WMS supported SRS
>>>
>>>
>>>
>>> Thank you for your feedback. My comments are below:
>>>
>>>
>>>
>>> *It means that there are tens of thousands WMS services which support
>>> 6782 different projections for each layer (checked from Geoserver version
>>> 2.25.3). I would not like them all to be reported as subdatasets.*
>>>
>>> I meant to use CRSs only reported by GetCapabilities. I haven't seen
>>> that GetCapabilities returns so many (6782) possible projections...
>>>
>>>
>>>
>>> *WMS standard also does not define any default CRS and the first one on
>>> the list in GetCapabilities does not need to be the best.*
>>>
>>> Therefore, the current form of the generating subdatasets names method
>>> for WMS driver is even more useless, if we have a non-default (not the
>>> best) projection for the data.
>>>
>>>
>>>
>>> And the only good way to work with it is to parse XML and generate paths
>>> manually...
>>>
>>>
>>>
>>> That's why I favor Even's option to introduce open option
>>> LIST_ALL_SRS=YES/NO.
>>>
>>>
>>>
>>> Any more thoughts?
>>>
>>>
>>>
>>> Micha? Kowalczuk
>>>
>>>
>>>
>>> wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <
>>> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>>>
>>> Hi,
>>>
>>>
>>>
>>> WMTS typically supports a rather small number of tilematrices and tiles
>>> are usually cached, so it makes a lot of sense to advertise the available
>>> matrices and utilize them. On the other hand WMS maps are created
>>> on-the-fly and there is very low technical cost on the server side to
>>> support however many projections. WMS standard also does not define any
>>> default CRS and the first one on the list in GetCapabilities does not need
>>> to be the best.
>>>
>>>
>>>
>>> I guess that Geoserver is the most common WMS server in the world and
>>> amazingly many Geoservers run with the default settings. It means that
>>> there are tens of thousands WMS services which support 6782 different
>>> projections for each layer (checked from Geoserver version 2.25.3). I would
>>> not like them all to be reported as subdatasets.
>>>
>>>
>>>
>>> I can see that ogrinfo and the OGC API Features driver report the list
>>> of supported projections. Test with ogrinfo OAPIF:
>>> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported
>>> SRS: OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395,
>>> EPSG:3857, EPSG:3034, EPSG:3035?
>>>
>>> Something similar might be an option for gdalinfo, but still about 6782
>>> EPSG codes per layer is too much to be viewed by default. Maybe the CRS
>>> list could be reported under some metadata domain that user could read on
>>> demand?
>>>
>>>
>>>
>>> -Jukka Rahkonen-
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
>>> Kowalczuk via gdal-dev
>>> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
>>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>>> *Aihe:* Re: [gdal-dev] WMS supported SRS
>>>
>>>
>>>
>>> I found that there was a similar issue in 2021 without any specific
>>> answer:
>>>
>>> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>>>
>>>
>>>
>>> I wonder if getting SUBDATASETS shouldn't return the result in a similar
>>> way as it does for WMTS service,
>>>
>>> where GDAL generates paths to all layer/tilematrix/tilematrixset
>>> combination.
>>>
>>> For example if layer is available in 3 SRS, GDAL produces 3 subdatasets,
>>> so using only SUBDATASE_NAME property user has access to all map services
>>> shared by WMTS server.
>>>
>>> In my opinion, GDAL should use the same approach for WMS.
>>>
>>>
>>>
>>> Does anyone object?
>>>
>>> I will then submit a new feature request/bug report.
>>>
>>>
>>>
>>> Best regards and have a nice day
>>>
>>> Micha? Kowalczuk
>>>
>>>
>>>
>>> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
>>> napisa?(a):
>>>
>>> Hi,
>>>
>>> Does GDAL provides a method to get supported spatial reference systems
>>> by WMS service?
>>>
>>> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
>>> (default) SRS from GetCapabilities, so this won't be helpful.
>>>
>>> Working with WFS I can get supported SRS using OGR
>>> *OGR_L_GetSupportedSRSList *function.
>>>
>>> Does GDAL offers something similar for WMS, or should I get this
>>> information from GetCapabilities XML by myself?
>>>
>>>
>>>
>>> Regards,
>>>
>>> Michal
>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/e6027baa/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Sep 12 04:57:25 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 12 Sep 2024 11:57:25 +0000
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
 <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
 <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>
Message-ID: <DB9PR09MB68870C1815445C6C49E40779FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

Your suggestion to utilize the additional layer BBOXes if they exist feels good to me, and better than to use the first advertised SRS from the root level. Beyond that what can be done with parsing the GetCapabilities is limited in my mind, because all projections which are supported may not be useful in real life.

-Jukka Rahkonen-

L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com>
L?hetetty: torstai 12. syyskuuta 2024 14.35
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] WMS supported SRS

So we remain at the point that there is no good method that, using only GDAL, will allow to fully use the WMS service without additional work related to XML parsing...?

Best,
Micha? Kowalczuk

wt., 10 wrz 2024 o 17:06 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
A sample from your link:
<Layer queryable="1" opaque="0">
<Name>Rakennustietoruudukko_2017</Name>
<Title>Rakennustietoruudukko 2017</Title>
<Abstract>Tietoa rakennuksista 250 x 250m ruudukoissa p??kaupunkiseudulla</Abstract>
<KeywordList>
<Keyword>features</Keyword>
<Keyword>Rakennustietoruudukko_2017</Keyword>
</KeywordList>
<CRS>EPSG:3879</CRS>
<CRS>CRS:84</CRS>
<EX_GeographicBoundingBox>
<westBoundLongitude>24.50112802448554</westBoundLongitude>
<eastBoundLongitude>25.25849178466466</eastBoundLongitude>
<southBoundLatitude>60.052265324029165</southBoundLatitude>
<northBoundLatitude>60.39874702231777</northBoundLatitude>
</EX_GeographicBoundingBox>
<BoundingBox CRS="CRS:84" minx="24.50112802448554" miny="60.052265324029165" maxx="25.25849178466466" maxy="60.39874702231777"/>
<BoundingBox CRS="EPSG:3879" minx="6659998.5" miny="2.5472498E7" maxx="6698499.5" maxy="2.551425E7"/>
<Style>
<Name>polygon</Name>
<Title>Default polygon style</Title>
<Abstract>A sample style that just draws out a solid gray interior with a black 1px outline</Abstract>
<LegendURL width="20" height="20">
<Format>image/png</Format>
<OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017"/>
</LegendURL>
</Style>
</Layer>

wt., 10 wrz 2024 o 17:05 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
Ok, now I see the problem. Thank you Jukka for the explanation with a sample.
So maybe we can use information from BoundingBox?
and generate SUBDATASETS for each combination of Layer and BoundingBox definition that is usually defined for "best"/dedicated projections for a layer.

(7.2.4.6.8 )
A Layer may have multiple BoundingBox elements, but each one shall state a different CRS (...)
A Layer shall not provide a BoundingBox for a CRS it does not support. Conversely, a Layer may support CRSs
for which it does not provide a BoundingBox: a server that has the ability to transform data to different CRSs may
choose not to provide an explicit BoundingBox for every possible CRS available for each Layer. The server
should provide BoundingBox information for at least the native CRS of the Layer (that is, the CRS in which the
Layer is stored in the server's database).

Best,
Micha?

W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi


  *   I meant to use CRSs only reported by GetCapabilities. I haven't seen that GetCapabilities returns so many (6782) possible projections...

I was meaning the same, CRSs reported in GetCapabilities. I used a search engine with phrase "service=WMS&version=1.3.0" and found in three minutes many examples, including this one kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities<https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities>. If you want to see more, install Geoserver on your computer and have a look at the default GetCapabilities.

Finding the best CRS from WMS GetCapabilities is guesswork. The server above is a Finnish one so probably EPSG:3067 is the most native CRS because that is what we tend to use in Finland. However, there is also one and only one additional BBOX for EPSG:3879 in GetCapabilities, but that would be somewhat odd selection for a country-wide CRS. It is also possible that for example some CRS of New Zealand does not really work in GetMap of the Finnish data even GetCapabilities says it will. But when WMS is configured to show a short CRS list then I would trust that they are all good to use. Just be aware that the list can also be very long.

If you start implementing the LIST_ALL_SRS option, it should be noted that the service level CRS list applies to all layers, and each layer can add more CRSs to the list. Maybe in theory there could be even "crs-list-of-service-root + crs-list-of-group-layer + crs-list-of-child-layer".

"7.2.4.6.7 CRS
Every Layer is available in one or more layer coordinate reference systems. 6.7.3 discusses the Layer CRS. In
order to indicate which Layer CRSs are available, every named Layer shall have at least one <CRS> element that
is either stated explicitly or inherited from a parent Layer. The root <Layer> element shall include a sequence of
zero or more CRS elements listing all CRSs that are common to all subsidiary layers. A child layer may optionally
add to the list inherited from a parent layer. Any duplication shall be ignored by clients.
When a Layer is available in several coordinate reference systems, the list of available CRS values shall be
represented as a sequence of <CRS> elements, each of which contains only a single CRS name."

-Jukka Rahkonen-




L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>>
L?hetetty: tiistai 10. syyskuuta 2024 16.32
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

Aihe: Re: [gdal-dev] WMS supported SRS

Thank you for your feedback. My comments are below:

It means that there are tens of thousands WMS services which support 6782 different projections for each layer (checked from Geoserver version 2.25.3). I would not like them all to be reported as subdatasets.
I meant to use CRSs only reported by GetCapabilities. I haven't seen that GetCapabilities returns so many (6782) possible projections...

WMS standard also does not define any default CRS and the first one on the list in GetCapabilities does not need to be the best.
Therefore, the current form of the generating subdatasets names method for WMS driver is even more useless, if we have a non-default (not the best) projection for the data.

And the only good way to work with it is to parse XML and generate paths manually...

That's why I favor Even's option to introduce open option LIST_ALL_SRS=YES/NO.

Any more thoughts?

Micha? Kowalczuk

wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

WMTS typically supports a rather small number of tilematrices and tiles are usually cached, so it makes a lot of sense to advertise the available matrices and utilize them. On the other hand WMS maps are created on-the-fly and there is very low technical cost on the server side to support however many projections. WMS standard also does not define any default CRS and the first one on the list in GetCapabilities does not need to be the best.

I guess that Geoserver is the most common WMS server in the world and amazingly many Geoservers run with the default settings. It means that there are tens of thousands WMS services which support 6782 different projections for each layer (checked from Geoserver version 2.25.3). I would not like them all to be reported as subdatasets.

I can see that ogrinfo and the OGC API Features driver report the list of supported projections. Test with ogrinfo OAPIF:https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows "Supported SRS: OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395, EPSG:3857, EPSG:3034, EPSG:3035"
Something similar might be an option for gdalinfo, but still about 6782 EPSG codes per layer is too much to be viewed by default. Maybe the CRS list could be reported under some metadata domain that user could read on demand?

-Jukka Rahkonen-









L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: tiistai 10. syyskuuta 2024 15.15
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] WMS supported SRS

I found that there was a similar issue in 2021 without any specific answer:
https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html

I wonder if getting SUBDATASETS shouldn't return the result in a similar way as it does for WMTS service,
where GDAL generates paths to all layer/tilematrix/tilematrixset combination.
For example if layer is available in 3 SRS, GDAL produces 3 subdatasets, so using only SUBDATASE_NAME property user has access to all map services shared by WMTS server.
In my opinion, GDAL should use the same approach for WMS.

Does anyone object?
I will then submit a new feature request/bug report.

Best regards and have a nice day
Micha? Kowalczuk

pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
Hi,
Does GDAL provides a method to get supported spatial reference systems by WMS service?
GDALGetMetadata(SUBDATASETS) generate links only for the first (default) SRS from GetCapabilities, so this won't be helpful.
Working with WFS I can get supported SRS using OGR OGR_L_GetSupportedSRSList function.
Does GDAL offers something similar for WMS, or should I get this information from GetCapabilities XML by myself?

Regards,
Michal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/a8217510/attachment-0001.htm>

From sean.gillies at gmail.com  Thu Sep 12 06:14:41 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Thu, 12 Sep 2024 07:14:41 -0600
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
Message-ID: <CAOodmJoYEY+TqK1QkZ8rDsb0UbBO-+2Fn+bxXdy1BhG7bq0Luw@mail.gmail.com>

Absolutely yes +1

On Wed, Sep 11, 2024, 8:24?PM Howard Butler via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> PSC,
>
> I am motioning to renew Even's maintainer contract through the GDAL
> Sponsorship Program that is hosted by NumFOCUS for another year.
>
> /me starts with a +1
>
> Howard
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/c725047b/attachment.htm>

From even.rouault at spatialys.com  Thu Sep 12 06:39:27 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 12 Sep 2024 15:39:27 +0200
Subject: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
 thread-safety"
In-Reply-To: <AS2PR09MB6367C0561A3BECB76875155CE1642@AS2PR09MB6367.eurprd09.prod.outlook.com>
References: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
 <DB9PR09MB6887DB76C109D3ED5573646BFD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <AS2PR09MB6367C0561A3BECB76875155CE1642@AS2PR09MB6367.eurprd09.prod.outlook.com>
Message-ID: <92ccba6c-ac7a-4daa-82d9-472cf62fa9c1@spatialys.com>

Mika,


Le 12/09/2024 ? 09:22, Heiskanen Mika (FMI) via gdal-dev a ?crit?:
>
>  *
>     Ah, and one thing I realized is that OGRSpatialReference isn't
>     thread-safe, so I've also added an optional SetThreadSafe() on it,
>     to also use a per-instance mutex in multi-threaded scenarios (cf
>     commit
>     https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd
>     <https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd>).
>
>
> Perhaps I am missing something, but why not use read locks for const 
> methods and write locks for non-const methods so that readers would 
> not block each other so much?

Read locks might not be sufficient for getters to run safely, because 
there's often mutable state behind. For example if someone uses WKT node 
manipulation functions like SetNode(), this modifies the 
OGRSpatialRefernce internal WKT tree, and a flag is set to track that. 
The next time a getter is called, and that getter needs to call a PROJ 
method to get the information, it first reconstruct a WKT string from 
the WKT tree, makes PROJ re-ingest it to update its PJ* internal model, 
and then call the PROJ getter.? Some PROJ getters also use internal 
mutable state.

At this stage, using a full mutex is definitely a much safer option. I 
don't also expect calls to OGRSpatialReference methods to be bottlenecks 
in typical multi-threaded usages.


Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/e260ba40/attachment.htm>

From j1 at jimenezshaw.com  Thu Sep 12 07:27:39 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 12 Sep 2024 16:27:39 +0200
Subject: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
 thread-safety"
In-Reply-To: <DB9PR09MB6887DB76C109D3ED5573646BFD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
 <DB9PR09MB6887DB76C109D3ED5573646BFD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CADRrdKs2ZYvjVvu=+FCn-ZZZrYGTJX3qX=Fb5a027oHb+xVqwQ@mail.gmail.com>

+1 Javier

On Thu, 12 Sept 2024 at 08:27, Rahkonen Jukka via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> +1
>
> -Jukka Rahkonen-
>
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even
> Rouault via gdal-dev
> L?hetetty: keskiviikko 11. syyskuuta 2024 22.27
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
> thread-safety"
>
> Hi,
>
> I move to approve RFC 101 "Raster dataset read-only thread-safety":
> https://github.com/OSGeo/gdal/pull/10676
>
> Starting with my +1,
>
> The candidate implementation is available in
> https://github.com/OSGeo/gdal/pull/10746. While fine tuning it, I
> realized there were subtleties, related to the fact we use thread-local
> datasets under the hood, for methods returning a non-"primitive" type, such
> as a "const char*" whose lifetime is tied to a dataset/band. If we'd get it
> from a thread-local dataset, and that one would be later evicted from the
> cache (not very common, but could happen if one would open tons of
> thread-safe datasets at the same time), then you could have use-after-free
> issues. For such methods (GetMetadata(), GetMetadataItem(),
> GetProjectionRef(), etc. as well as GetColorTable() which returns a
> GDALColorTable pointer, or GetSpatialRef() which returns a
> OGRSpatialReference*), I've preferred to protect their access with a mutex
> around the "prototype" dataset passed when constructing
> GDALMultiThreadedDataset, whose lifetime is at least as long as
> GDALMultiThreadedDataset (cf commit
>
> https://github.com/OSGeo/gdal/pull/10746/commits/849e9cea711efd30c47fd90a7a6b71a75611c1a5#diff-687008dd6e3d5ac8ad05568272746ed75b84de50bde508f78f2d79a6842825c7L428
> )
> . Normally such methods aren't called in user code repeatedly, so there
> should be any noticeable lock contention in practice. The main objective of
> the RFC which is to be able to issue RasterIO() requests in parallel isn't
> affected by that. Ah, and one thing I realized is that OGRSpatialReference
> isn't thread-safe, so I've also added an optional
> SetThreadSafe() on it, to also use a per-instance mutex in multi-threaded
> scenarios (cf commit
> https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd
> ).
> Multi-threading is hard...
>
> Even
>
> --
> http://www.spatialys.com/
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/0c04d012/attachment.htm>

From simon.eves at heavy.ai  Thu Sep 12 09:03:24 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Thu, 12 Sep 2024 09:03:24 -0700
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <CAOodmJoYEY+TqK1QkZ8rDsb0UbBO-+2Fn+bxXdy1BhG7bq0Luw@mail.gmail.com>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
 <CAOodmJoYEY+TqK1QkZ8rDsb0UbBO-+2Fn+bxXdy1BhG7bq0Luw@mail.gmail.com>
Message-ID: <CAJf0KTRykdBgsSSh7Ntd_863cTgn1FfaNbxG3SQEUM8wnNZyuw@mail.gmail.com>

+100

On Thu, Sep 12, 2024 at 6:15?AM Sean Gillies via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Absolutely yes +1
>
> On Wed, Sep 11, 2024, 8:24?PM Howard Butler via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> PSC,
>>
>> I am motioning to renew Even's maintainer contract through the GDAL
>> Sponsorship Program that is hosted by NumFOCUS for another year.
>>
>> /me starts with a +1
>>
>> Howard
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/65dc380c/attachment.htm>

From public at postholer.com  Thu Sep 12 11:41:01 2024
From: public at postholer.com (Scott)
Date: Thu, 12 Sep 2024 11:41:01 -0700
Subject: [gdal-dev] gdal_edit.py question
Message-ID: <6f1621b5-a322-45a8-b402-c99194c41950@postholer.com>

Greetings,

I need some help with gdal_edit. If I add meta data each time I add a 
band to a raster, only the last meta edit is present. Here's the 
scenario GDAL 3.9.1, gdal_edit.py is 3.6.2, Debian 12:

# create empty 2-band raster with existing prototype:
gdal_create -if src1.tif -bands 2 result.tif

# add tif to band 1 and add meta data for it:
gdalwarp -q -srcband 1 -dstband 1 -t_srs EPSG:4326 src1.tif result.tif
gdal_edit.py -mo "BAND1=meta1" result.tif

# add another tif to band 2 and add meta data for it:
gdalwarp -q -srcband 1 -dstband 2 -t_srs EPSG:4326 src2.tif result.tif
gdal_edit.py -mo "BAND2=meta2" result.tif

# Now, the interesting part. Only BAND2 meta data is present. BAND1 is 
missing.
gdalinfo result.tif

# if I add all the meta data at once, it works fine
gdal_edit.py -mo "BAND1=meta1" -mo "BAND2=meta2" result.tif

Another unrelated thing, if I try to add a second band to an existing 
single band raster using gdalwarp, it throws an error saying the second 
band doesn't exist. That's understandable, hence gdal_create. The 
downside is, if you're working with an unknown number of bands, you 
can't just add it. This would be an extremely useful feature when 
working with NETCDF, HDF, etc.

Thanks!
Scott

-- 
www.postholer.com

From even.rouault at spatialys.com  Thu Sep 12 12:21:25 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 12 Sep 2024 21:21:25 +0200
Subject: [gdal-dev] gdal_edit.py question
In-Reply-To: <6f1621b5-a322-45a8-b402-c99194c41950@postholer.com>
References: <6f1621b5-a322-45a8-b402-c99194c41950@postholer.com>
Message-ID: <c4780489-41e5-4131-9052-5ed14bd701eb@spatialys.com>

Scott,
>
> # add another tif to band 2 and add meta data for it:
> gdalwarp -q -srcband 1 -dstband 2 -t_srs EPSG:4326 src2.tif result.tif

BAND1 is lost at that stage. gdalwarp must override the metadata of the 
output dataset with the one of src2.tif.

Presumably it should instead merge them, using the same logic as what it 
does if you provide several input files in a single gdalwarp operation, 
but this is also questionable if it is always desirable... The hardest 
part would to? name a switch to control that behavior.

A few line GDAL Python script would allow you to automate the merging of 
metadata.


> Another unrelated thing, if I try to add a second band to an existing 
> single band raster using gdalwarp, it throws an error saying the 
> second band doesn't exist. That's understandable, hence gdal_create. 
> The downside is, if you're working with an unknown number of bands, 
> you can't just add it. This would be an extremely useful feature when 
> working with NETCDF, HDF, etc.

A difficult one to implement. That would involve using the AddBand() 
method, but very few drivers support it (GeoTIFF doesn't in particular), 
mostly because of format limitations.

Another way of proceeding is to:

- use warped-vrt for the source 1-band datasets,

- use gdalbuildvrt -separate to create a multi-band VRT from those 
warped VRTs,

- and gdal_translate to convert that to GeoTIFF.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From public at postholer.com  Thu Sep 12 12:41:24 2024
From: public at postholer.com (Scott)
Date: Thu, 12 Sep 2024 12:41:24 -0700
Subject: [gdal-dev] gdal_edit.py question
In-Reply-To: <c4780489-41e5-4131-9052-5ed14bd701eb@spatialys.com>
References: <6f1621b5-a322-45a8-b402-c99194c41950@postholer.com>
 <c4780489-41e5-4131-9052-5ed14bd701eb@spatialys.com>
Message-ID: <8a7ea278-21ad-46d2-a003-c66adb324c15@postholer.com>

Thanks Even!

The NETCDF file(s) I'm working with have hundreds of sub data sets. 
Initially, I was breaking out all of them to .vrt's as you suggested, 
but it got a bit messy. Counting the sub-datasets with gdalinfo 
iteratively then using gdal_create -bands N was a lot cleaner.

Passing dozens of -mo switches to gdal_edit results in a too long 
command line. I'll have to figure something out for that.

On 9/12/24 12:21, Even Rouault wrote:
> Scott,
>>
>> # add another tif to band 2 and add meta data for it:
>> gdalwarp -q -srcband 1 -dstband 2 -t_srs EPSG:4326 src2.tif result.tif
> 
> BAND1 is lost at that stage. gdalwarp must override the metadata of the 
> output dataset with the one of src2.tif.
> 
> Presumably it should instead merge them, using the same logic as what it 
> does if you provide several input files in a single gdalwarp operation, 
> but this is also questionable if it is always desirable... The hardest 
> part would to? name a switch to control that behavior.
> 
> A few line GDAL Python script would allow you to automate the merging of 
> metadata.
> 
> 
>> Another unrelated thing, if I try to add a second band to an existing 
>> single band raster using gdalwarp, it throws an error saying the 
>> second band doesn't exist. That's understandable, hence gdal_create. 
>> The downside is, if you're working with an unknown number of bands, 
>> you can't just add it. This would be an extremely useful feature when 
>> working with NETCDF, HDF, etc.
> 
> A difficult one to implement. That would involve using the AddBand() 
> method, but very few drivers support it (GeoTIFF doesn't in particular), 
> mostly because of format limitations.
> 
> Another way of proceeding is to:
> 
> - use warped-vrt for the source 1-band datasets,
> 
> - use gdalbuildvrt -separate to create a multi-band VRT from those 
> warped VRTs,
> 
> - and gdal_translate to convert that to GeoTIFF.
> 
> Even
> 

From howard at hobu.co  Thu Sep 12 18:18:58 2024
From: howard at hobu.co (Howard Butler)
Date: Thu, 12 Sep 2024 20:18:58 -0500
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <9b6b8f10-702e-4d7d-9e94-c0bcfd247234@postholer.com>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
 <9b6b8f10-702e-4d7d-9e94-c0bcfd247234@postholer.com>
Message-ID: <E26ED439-6930-4171-9C1C-EAAA790A3316@hobu.co>

Declaring this motion passed with +1s from Sean, Jukka, Daniel, Javier, Kurt, and Howard. We technically needed the contract active to pay Even's previous invoice so I am fast-tracking the vote as it appears non-controversial ;)


> On Sep 11, 2024, at 10:50?PM, Scott via gdal-dev <gdal-dev at lists.osgeo.org> wrote:
> 
> Only a year? Someone chain him to his desk already. You can't be too cautious. ;)

A key feature that led to the creation of the GDAL Sponsorship Program is to have resources specifically for the situation for when/if Even decides it is time to step back from his current role. He shouldn't have to feel chained to any desk or the project ? that leads to burn out. Even though Even is our hero, we don't want him to feel trapped here.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240912/fc893c96/attachment.htm>

From warmerdam at pobox.com  Thu Sep 12 21:14:19 2024
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Fri, 13 Sep 2024 00:14:19 -0400
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <E26ED439-6930-4171-9C1C-EAAA790A3316@hobu.co>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
 <9b6b8f10-702e-4d7d-9e94-c0bcfd247234@postholer.com>
 <E26ED439-6930-4171-9C1C-EAAA790A3316@hobu.co>
Message-ID: <CA+YzLBegz+o_qmDCp9srHeaB1ipBfTQ5iWqqUrj5Kyvx=J7ttQ@mail.gmail.com>

A belated +1!


On Thu, Sep 12, 2024 at 9:19?PM Howard Butler via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Declaring this motion passed with +1s from Sean, Jukka, Daniel, Javier,
> Kurt, and Howard. We technically needed the contract active to pay Even's
> previous invoice so I am fast-tracking the vote as it appears
> non-controversial ;)
>
>
> On Sep 11, 2024, at 10:50?PM, Scott via gdal-dev <gdal-dev at lists.osgeo.org>
> wrote:
>
> Only a year? Someone chain him to his desk already. You can't be too
> cautious. ;)
>
>
> A key feature that led to the creation of the GDAL Sponsorship Program is
> to have resources specifically for the situation for when/if Even decides
> it is time to step back from his current role. He shouldn't have to feel
> chained to any desk or the project ? that leads to burn out. Even though
> Even is our hero, we don't want him to feel trapped here.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam at pobox.com
light and sound - activate the windows | USA: +1 650-701-7823
<http://voice.google.com/calls?a=nc,%2B16507017823>
and watch the world go round - Rush    | CAN: +1 343-550-9984
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/b5b5be7e/attachment.htm>

From michkowalczuk at gmail.com  Fri Sep 13 05:11:38 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Fri, 13 Sep 2024 14:11:38 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <DB9PR09MB68870C1815445C6C49E40779FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
 <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
 <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>
 <DB9PR09MB68870C1815445C6C49E40779FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQB9FAtA7jRFTvjWZ=U459szAE_BWh2_HN6t9pdB4rzfhQ@mail.gmail.com>

So, can I open a feature request?

Best,
Michal Kowalczuk

W dniu czw., 12.09.2024 o 13:57 Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):

> Hi,
>
>
>
> Your suggestion to utilize the additional layer BBOXes if they exist feels
> good to me, and better than to use the first advertised SRS from the root
> level. Beyond that what can be done with parsing the GetCapabilities is
> limited in my mind, because all projections which are supported may not be
> useful in real life.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* torstai 12. syyskuuta 2024 14.35
>
>
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> So we remain at the point that there is no good method that, using only
> GDAL, will allow to fully use the WMS service without additional work
> related to XML parsing...?
>
>
>
> Best,
>
> Micha? Kowalczuk
>
>
>
> wt., 10 wrz 2024 o 17:06 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> A sample from your link:
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *<Layer queryable="1" opaque="0"> <Name>Rakennustietoruudukko_2017</Name>
> <Title>Rakennustietoruudukko 2017</Title> <Abstract>Tietoa rakennuksista
> 250 x 250m ruudukoissa p??kaupunkiseudulla</Abstract> <KeywordList>
> <Keyword>features</Keyword> <Keyword>Rakennustietoruudukko_2017</Keyword>
> </KeywordList> <CRS>EPSG:3879</CRS> <CRS>CRS:84</CRS>
> <EX_GeographicBoundingBox>
> <westBoundLongitude>24.50112802448554</westBoundLongitude>
> <eastBoundLongitude>25.25849178466466</eastBoundLongitude>
> <southBoundLatitude>60.052265324029165</southBoundLatitude>
> <northBoundLatitude>60.39874702231777</northBoundLatitude>
> </EX_GeographicBoundingBox> <BoundingBox CRS="CRS:84"
> minx="24.50112802448554" miny="60.052265324029165" maxx="25.25849178466466"
> maxy="60.39874702231777"/> <BoundingBox CRS="EPSG:3879" minx="6659998.5"
> miny="2.5472498E7" maxx="6698499.5" maxy="2.551425E7"/> <Style>
> <Name>polygon</Name> <Title>Default polygon style</Title> <Abstract>A
> sample style that just draws out a solid gray interior with a black 1px
> outline</Abstract> <LegendURL width="20" height="20">
> <Format>image/png</Format> <OnlineResource
> xmlns:xlink="http://www.w3.org/1999/xlink <http://www.w3.org/1999/xlink>"
> xlink:type="simple"
> xlink:href="https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017
> <https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017>"/>
> </LegendURL> </Style> </Layer>*
>
>
>
> wt., 10 wrz 2024 o 17:05 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Ok, now I see the problem. Thank you Jukka for the explanation with a
> sample.
>
> So maybe we can use information from *BoundingBox*?
>
> and generate SUBDATASETS for each combination of Layer and BoundingBox
> definition that is usually defined for "best"/dedicated projections for a
> layer.
>
>
>
> *(7.2.4.6.8 )*
>
> *A Layer may have multiple BoundingBox elements, but each one shall state
> a different CRS (...)*
>
> *A Layer shall not provide a BoundingBox for a CRS it does not support.
> Conversely, a Layer may support CRSs*
>
> *for which it does not provide a BoundingBox: a server that has the
> ability to transform data to different CRSs may*
>
> *choose not to provide an explicit BoundingBox for every possible CRS
> available for each Layer. The server*
>
> *should provide BoundingBox information for at least the native CRS of the
> Layer (that is, the CRS in which the*
>
> *Layer is stored in the server?s database).*
>
>
>
> Best,
>
> Micha?
>
>
>
> W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi
>
>
>
>    - I meant to use CRSs only reported by GetCapabilities. I haven't seen
>    that GetCapabilities returns so many (6782) possible projections...
>
>
>
> I was meaning the same, CRSs reported in GetCapabilities. I used a search
> engine with phrase ?service=WMS&version=1.3.0? and found in three minutes
> many examples, including this one
> kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities.
> If you want to see more, install Geoserver on your computer and have a look
> at the default GetCapabilities.
>
>
>
> Finding the best CRS from WMS GetCapabilities is guesswork. The server
> above is a Finnish one so probably EPSG:3067 is the most native CRS because
> that is what we tend to use in Finland. However, there is also one and only
> one additional BBOX for EPSG:3879 in GetCapabilities, but that would be
> somewhat odd selection for a country-wide CRS. It is also possible that for
> example some CRS of New Zealand does not really work in GetMap of the
> Finnish data even GetCapabilities says it will. But when WMS is configured
> to show a short CRS list then I would trust that they are all good to use.
> Just be aware that the list can also be very long.
>
>
>
> If you start implementing the LIST_ALL_SRS option, it should be noted that
> the service level CRS list applies to all layers, and each layer can add
> more CRSs to the list. Maybe in theory there could be even
> ?crs-list-of-service-root + crs-list-of-group-layer +
> crs-list-of-child-layer?.
>
>
>
> ?7.2.4.6.7 CRS
>
> Every Layer is available in one or more layer coordinate reference
> systems. 6.7.3 discusses the Layer CRS. In
>
> order to indicate which Layer CRSs are available, every named Layer shall
> have at least one <CRS> element that
>
> is either stated explicitly or inherited from a parent Layer. The root
> <Layer> element shall include a sequence of
>
> zero or more CRS elements listing all CRSs that are common to all
> subsidiary layers. A child layer may optionally
>
> add to the list inherited from a parent layer. Any duplication shall be
> ignored by clients.
>
> When a Layer is available in several coordinate reference systems, the
> list of available CRS values shall be
>
> represented as a sequence of <CRS> elements, each of which contains only a
> single CRS name.?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* tiistai 10. syyskuuta 2024 16.32
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
>
>
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> Thank you for your feedback. My comments are below:
>
>
>
> *It means that there are tens of thousands WMS services which support 6782
> different projections for each layer (checked from Geoserver version
> 2.25.3). I would not like them all to be reported as subdatasets.*
>
> I meant to use CRSs only reported by GetCapabilities. I haven't seen that
> GetCapabilities returns so many (6782) possible projections...
>
>
>
> *WMS standard also does not define any default CRS and the first one on
> the list in GetCapabilities does not need to be the best.*
>
> Therefore, the current form of the generating subdatasets names method for
> WMS driver is even more useless, if we have a non-default (not the best)
> projection for the data.
>
>
>
> And the only good way to work with it is to parse XML and generate paths
> manually...
>
>
>
> That's why I favor Even's option to introduce open option
> LIST_ALL_SRS=YES/NO.
>
>
>
> Any more thoughts?
>
>
>
> Micha? Kowalczuk
>
>
>
> wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> WMTS typically supports a rather small number of tilematrices and tiles
> are usually cached, so it makes a lot of sense to advertise the available
> matrices and utilize them. On the other hand WMS maps are created
> on-the-fly and there is very low technical cost on the server side to
> support however many projections. WMS standard also does not define any
> default CRS and the first one on the list in GetCapabilities does not need
> to be the best.
>
>
>
> I guess that Geoserver is the most common WMS server in the world and
> amazingly many Geoservers run with the default settings. It means that
> there are tens of thousands WMS services which support 6782 different
> projections for each layer (checked from Geoserver version 2.25.3). I would
> not like them all to be reported as subdatasets.
>
>
>
> I can see that ogrinfo and the OGC API Features driver report the list of
> supported projections. Test with ogrinfo OAPIF:
> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported SRS:
> OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395,
> EPSG:3857, EPSG:3034, EPSG:3035?
>
> Something similar might be an option for gdalinfo, but still about 6782
> EPSG codes per layer is too much to be viewed by default. Maybe the CRS
> list could be reported under some metadata domain that user could read on
> demand?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> I found that there was a similar issue in 2021 without any specific answer:
>
> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>
>
>
> I wonder if getting SUBDATASETS shouldn't return the result in a similar
> way as it does for WMTS service,
>
> where GDAL generates paths to all layer/tilematrix/tilematrixset
> combination.
>
> For example if layer is available in 3 SRS, GDAL produces 3 subdatasets,
> so using only SUBDATASE_NAME property user has access to all map services
> shared by WMTS server.
>
> In my opinion, GDAL should use the same approach for WMS.
>
>
>
> Does anyone object?
>
> I will then submit a new feature request/bug report.
>
>
>
> Best regards and have a nice day
>
> Micha? Kowalczuk
>
>
>
> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Hi,
>
> Does GDAL provides a method to get supported spatial reference systems by
> WMS service?
>
> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
> (default) SRS from GetCapabilities, so this won't be helpful.
>
> Working with WFS I can get supported SRS using OGR
> *OGR_L_GetSupportedSRSList *function.
>
> Does GDAL offers something similar for WMS, or should I get this
> information from GetCapabilities XML by myself?
>
>
>
> Regards,
>
> Michal
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/a710fdc9/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Sep 13 05:42:43 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 13 Sep 2024 14:42:43 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQB9FAtA7jRFTvjWZ=U459szAE_BWh2_HN6t9pdB4rzfhQ@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
 <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
 <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>
 <DB9PR09MB68870C1815445C6C49E40779FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQB9FAtA7jRFTvjWZ=U459szAE_BWh2_HN6t9pdB4rzfhQ@mail.gmail.com>
Message-ID: <604e9ce2-264e-4c95-9165-f616fa1ab885@spatialys.com>


Le 13/09/2024 ? 14:11, Micha? Kowalczuk via gdal-dev a ?crit?:
> So, can I open a feature request?

sounds good to me, even better if accompanied with a pull request & 
test. For tests, see test_wms_force_opening_url() at the end of 
autotest/gdrivers/wms.py where we simulate locally a WMS server (since 
relying on live services is extremely unreliable on the long term, with 
services getting shut down or moving quite quickly compared to the 
lifetime of the GDAL project!)

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Fri Sep 13 06:15:40 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 13 Sep 2024 13:15:40 +0000
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQB9FAtA7jRFTvjWZ=U459szAE_BWh2_HN6t9pdB4rzfhQ@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
 <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
 <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>
 <DB9PR09MB68870C1815445C6C49E40779FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQB9FAtA7jRFTvjWZ=U459szAE_BWh2_HN6t9pdB4rzfhQ@mail.gmail.com>
Message-ID: <DB9PR09MB68871A9EE1EA9C1CEF2355D0FD652@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

GDAL is open source, of course you can open a feature request. It will then be implemented, closed, of left open eternally.

What do you plan to write into the feature request? I think that using the CRS of the additional BoundingBox is a good default and best for the users when they want to get data in that CRS. But if they want to use data in some other CRS and their favorite CRS appears in some CRS list in the GetCapabilities, even without additional BoundingBox, then they should use that for communicating with the WMS server. That's because the WMS server usually sends much better quality maps when it re-projects the source data for rendering, compared to the result that is achieved when GDAL warps the rasters that it if fetching with GetMaps in another CRS.

So, after re-thinking your original idea about creating a subdataset from each supported CRS is good, but because of potentially thousands of subdatasets it may lead to some usability problems. I am not sure if there can be some problems in implementation as well. I see that GDAL shows the subdatasets with BBOX:

SUBDATASET_26_NAME=WMS:http://localhost:8080/geoserver/ows?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&LAYERS=topp%3Atasmania_state_boundaries&CRS=CRS:84&BBOX=143.83482400000003,-43.648056,148.47914100000003,-39.573891

However, usually there are additional BoundingBoxes only for some of the supported CRSs, and for the rest GDAL should probably warp the <EX_GeographicBoundingBox>.

-Jukka Rahkonen-


L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com>
L?hetetty: perjantai 13. syyskuuta 2024 15.12
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] WMS supported SRS

So, can I open a feature request?

Best,
Michal Kowalczuk

W dniu czw., 12.09.2024 o 13:57 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

Your suggestion to utilize the additional layer BBOXes if they exist feels good to me, and better than to use the first advertised SRS from the root level. Beyond that what can be done with parsing the GetCapabilities is limited in my mind, because all projections which are supported may not be useful in real life.

-Jukka Rahkonen-

L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>>
L?hetetty: torstai 12. syyskuuta 2024 14.35

Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] WMS supported SRS

So we remain at the point that there is no good method that, using only GDAL, will allow to fully use the WMS service without additional work related to XML parsing...?

Best,
Micha? Kowalczuk

wt., 10 wrz 2024 o 17:06 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
A sample from your link:
<Layer queryable="1" opaque="0">
<Name>Rakennustietoruudukko_2017</Name>
<Title>Rakennustietoruudukko 2017</Title>
<Abstract>Tietoa rakennuksista 250 x 250m ruudukoissa p??kaupunkiseudulla</Abstract>
<KeywordList>
<Keyword>features</Keyword>
<Keyword>Rakennustietoruudukko_2017</Keyword>
</KeywordList>
<CRS>EPSG:3879</CRS>
<CRS>CRS:84</CRS>
<EX_GeographicBoundingBox>
<westBoundLongitude>24.50112802448554</westBoundLongitude>
<eastBoundLongitude>25.25849178466466</eastBoundLongitude>
<southBoundLatitude>60.052265324029165</southBoundLatitude>
<northBoundLatitude>60.39874702231777</northBoundLatitude>
</EX_GeographicBoundingBox>
<BoundingBox CRS="CRS:84" minx="24.50112802448554" miny="60.052265324029165" maxx="25.25849178466466" maxy="60.39874702231777"/>
<BoundingBox CRS="EPSG:3879" minx="6659998.5" miny="2.5472498E7" maxx="6698499.5" maxy="2.551425E7"/>
<Style>
<Name>polygon</Name>
<Title>Default polygon style</Title>
<Abstract>A sample style that just draws out a solid gray interior with a black 1px outline</Abstract>
<LegendURL width="20" height="20">
<Format>image/png</Format>
<OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017"/>
</LegendURL>
</Style>
</Layer>

wt., 10 wrz 2024 o 17:05 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
Ok, now I see the problem. Thank you Jukka for the explanation with a sample.
So maybe we can use information from BoundingBox?
and generate SUBDATASETS for each combination of Layer and BoundingBox definition that is usually defined for "best"/dedicated projections for a layer.

(7.2.4.6.8 )
A Layer may have multiple BoundingBox elements, but each one shall state a different CRS (...)
A Layer shall not provide a BoundingBox for a CRS it does not support. Conversely, a Layer may support CRSs
for which it does not provide a BoundingBox: a server that has the ability to transform data to different CRSs may
choose not to provide an explicit BoundingBox for every possible CRS available for each Layer. The server
should provide BoundingBox information for at least the native CRS of the Layer (that is, the CRS in which the
Layer is stored in the server's database).

Best,
Micha?

W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi


  *   I meant to use CRSs only reported by GetCapabilities. I haven't seen that GetCapabilities returns so many (6782) possible projections...

I was meaning the same, CRSs reported in GetCapabilities. I used a search engine with phrase "service=WMS&version=1.3.0" and found in three minutes many examples, including this one kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities<https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities>. If you want to see more, install Geoserver on your computer and have a look at the default GetCapabilities.

Finding the best CRS from WMS GetCapabilities is guesswork. The server above is a Finnish one so probably EPSG:3067 is the most native CRS because that is what we tend to use in Finland. However, there is also one and only one additional BBOX for EPSG:3879 in GetCapabilities, but that would be somewhat odd selection for a country-wide CRS. It is also possible that for example some CRS of New Zealand does not really work in GetMap of the Finnish data even GetCapabilities says it will. But when WMS is configured to show a short CRS list then I would trust that they are all good to use. Just be aware that the list can also be very long.

If you start implementing the LIST_ALL_SRS option, it should be noted that the service level CRS list applies to all layers, and each layer can add more CRSs to the list. Maybe in theory there could be even "crs-list-of-service-root + crs-list-of-group-layer + crs-list-of-child-layer".

"7.2.4.6.7 CRS
Every Layer is available in one or more layer coordinate reference systems. 6.7.3 discusses the Layer CRS. In
order to indicate which Layer CRSs are available, every named Layer shall have at least one <CRS> element that
is either stated explicitly or inherited from a parent Layer. The root <Layer> element shall include a sequence of
zero or more CRS elements listing all CRSs that are common to all subsidiary layers. A child layer may optionally
add to the list inherited from a parent layer. Any duplication shall be ignored by clients.
When a Layer is available in several coordinate reference systems, the list of available CRS values shall be
represented as a sequence of <CRS> elements, each of which contains only a single CRS name."

-Jukka Rahkonen-




L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>>
L?hetetty: tiistai 10. syyskuuta 2024 16.32
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

Aihe: Re: [gdal-dev] WMS supported SRS

Thank you for your feedback. My comments are below:

It means that there are tens of thousands WMS services which support 6782 different projections for each layer (checked from Geoserver version 2.25.3). I would not like them all to be reported as subdatasets.
I meant to use CRSs only reported by GetCapabilities. I haven't seen that GetCapabilities returns so many (6782) possible projections...

WMS standard also does not define any default CRS and the first one on the list in GetCapabilities does not need to be the best.
Therefore, the current form of the generating subdatasets names method for WMS driver is even more useless, if we have a non-default (not the best) projection for the data.

And the only good way to work with it is to parse XML and generate paths manually...

That's why I favor Even's option to introduce open option LIST_ALL_SRS=YES/NO.

Any more thoughts?

Micha? Kowalczuk

wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

WMTS typically supports a rather small number of tilematrices and tiles are usually cached, so it makes a lot of sense to advertise the available matrices and utilize them. On the other hand WMS maps are created on-the-fly and there is very low technical cost on the server side to support however many projections. WMS standard also does not define any default CRS and the first one on the list in GetCapabilities does not need to be the best.

I guess that Geoserver is the most common WMS server in the world and amazingly many Geoservers run with the default settings. It means that there are tens of thousands WMS services which support 6782 different projections for each layer (checked from Geoserver version 2.25.3). I would not like them all to be reported as subdatasets.

I can see that ogrinfo and the OGC API Features driver report the list of supported projections. Test with ogrinfo OAPIF:https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows "Supported SRS: OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395, EPSG:3857, EPSG:3034, EPSG:3035"
Something similar might be an option for gdalinfo, but still about 6782 EPSG codes per layer is too much to be viewed by default. Maybe the CRS list could be reported under some metadata domain that user could read on demand?

-Jukka Rahkonen-









L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: tiistai 10. syyskuuta 2024 15.15
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] WMS supported SRS

I found that there was a similar issue in 2021 without any specific answer:
https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html

I wonder if getting SUBDATASETS shouldn't return the result in a similar way as it does for WMTS service,
where GDAL generates paths to all layer/tilematrix/tilematrixset combination.
For example if layer is available in 3 SRS, GDAL produces 3 subdatasets, so using only SUBDATASE_NAME property user has access to all map services shared by WMTS server.
In my opinion, GDAL should use the same approach for WMS.

Does anyone object?
I will then submit a new feature request/bug report.

Best regards and have a nice day
Micha? Kowalczuk

pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>> napisa?(a):
Hi,
Does GDAL provides a method to get supported spatial reference systems by WMS service?
GDALGetMetadata(SUBDATASETS) generate links only for the first (default) SRS from GetCapabilities, so this won't be helpful.
Working with WFS I can get supported SRS using OGR OGR_L_GetSupportedSRSList function.
Does GDAL offers something similar for WMS, or should I get this information from GetCapabilities XML by myself?

Regards,
Michal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/dc6c3b10/attachment-0001.htm>

From matt.luck at noaa.gov  Fri Sep 13 06:55:48 2024
From: matt.luck at noaa.gov (Matt Luck - NOAA Affiliate)
Date: Fri, 13 Sep 2024 09:55:48 -0400
Subject: [gdal-dev] Upgrade or remove Java JDK 17 in GDAL Docker image
In-Reply-To: <5e73612d-0235-4436-a27b-eb302019e6b7@spatialys.com>
References: <CO1PR10MB457818D07657F4627A20DD06FE992@CO1PR10MB4578.namprd10.prod.outlook.com>
 <5e73612d-0235-4436-a27b-eb302019e6b7@spatialys.com>
Message-ID: <CADorzfppByWPnVT7gUVa_KNGVFO-GhQGPCKi60g7Ua50oFG6hw@mail.gmail.com>

 Thank you Even, these are very helpful suggestions.

I tried removing jdk and flattening the image but jdk was still there in
the diff folder.

Because of other dependencies, we are trying to stay with v3.8. I tried to
regenerate using v3.8.5 (git hash1d418c1). I updated ARG
ARROW_VERSION=15.0.2-1 after getting the error

The following packages have unmet dependencies:
>  libarrow-dev : Depends: libarrow1500 (= 15.0.1-1) but 15.0.2-1 is to be
> installed


This time I get to:

Step 46/46 : RUN . /buildscripts/bh-set-envvars.sh     &&
> /buildscripts/bh-gdal.sh
> ...
> -- Configuring done
> -- Generating done
> -- Build files have been written to: /gdal/build
> [  1%] Building CXX object
> port/CMakeFiles/cpl_iconv.dir/cpl_recode_iconv.cpp.o
> ...
> [ 51%] Built target gdal_MRF
> make: *** [Makefile:136: all] Error 2
> The command '/bin/sh -c . /buildscripts/bh-set-envvars.sh     &&
> /buildscripts/bh-gdal.sh' returned a non-zero code: 2


How can I resolve this error?

Alternatively, we have considered a different solution that uses
ubuntu:22.04 as our base image and then installing GDAL but also having
problems with installing GDAL (I can't seem to get past dependency
conflicts for v3.8.5 in pipenv so trying v3.8.3), getting an error:

Collecting gdal==3.8.3 (from -r
> /tmp/pipenv-gde160cj-requirements/pipenv-ndnw2zi0-hashed-reqs.txt (line 62))
>   Downloading GDAL-3.8.3.tar.gz (802 kB)
>      ????????????????????????????????????? 802.5/802.5 kB 104.5 MB/s eta
> 0:00:00
>   Preparing metadata (setup.py): started
>   Preparing metadata (setup.py): finished with status 'error'
> error: subprocess-exited-with-error
>
>   ? python setup.py egg_info did not run successfully.
>   ? exit code: 1



> Exception: Python bindings of GDAL 3.8.3 require at least libgdal 3.8.3,
> but 3.4.1 was found


How can we upgrade libgdal (in our Dockerfile)?

Many thanks!
Matt





------------------------------
*From:* Even Rouault <even.rouault at spatialys.com>
*Sent:* Monday, September 9, 2024 1:56 PM
*To:* Matt Luck - NOAA Affiliate <matt.luck at noaa.gov>;
gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
*Subject:* Re: [gdal-dev] Upgrade or remove Java JDK 17 in GDAL Docker image


Matt,


Several potential solutions:


1) Regenerate the Docker image from sources:


git clone https://github.com/OSGeo/gdal

cd gdal

./docker/ubuntu-full/build.sh


2) Same as 1), but before edit ./docker/ubuntu-full/Dockerfile to remove
all traces of java/jdk from it


3) Use the existing image, remove the openjdk package, and "flatten" the
Docker layers with docker export / docker import (cf
https://forums.docker.com/t/how-to-flatten-an-image-with-127-parents/1600/2),
so that the layer where it was installed disappears


4) Wait a couple hours while I'm regenerating it to be updated to
17.0.12+7-1ubuntu2~24.04


Even


Le 09/09/2024 ? 19:29, Matt Luck - NOAA Affiliate via gdal-dev a ?crit :

Hi, our IT department has detected a security vulnerability in the Java JDK
version 17 that's installed in the ubuntu-full docker image (see message
below). I am able to remove the Java files from the Docker image via the
Dockerfile and I've tried changing the `JAVA_VERSION` in the Dockerfile,
but there always seems to be a reference remaining in the Docker diff files
that I can't seem to get rid of.

To reproduce:
A `docker system prune -a -f`, then `sudo find /var/lib/docker/overlay2
-type d -name java-17-openjdk-amd64` finds nothing, but then `docker pull
ghcr.io/osgeo/gdal:ubuntu-full-3.9.1`
<http://ghcr.io/osgeo/gdal:ubuntu-full-3.9.1> followed by `sudo find
/var/lib/docker/overlay2 -type d -name java-17-openjdk-amd64` finds:
/var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/lib/jvm/java-17-openjdk-amd64
/var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/lib/debug/usr/lib/jvm/java-17-openjdk-amd64
/var/lib/docker/overlay2/1d5a9f2712fb9b28bfa857509a45fb334005cda0ea58fea8a259af8eb3fcb2db/diff/usr/share/gdb/auto-load/usr/lib/jvm/java-17-openjdk-amd64

Because they're diff files, those files exist whether or not they're
actually in the container and thus the vulnerability is always triggered.
Is there a solution and/or a way to either upgrade the Java version or
remove Java entirely if it's not needed so that we can deal with this issue
in the future?

On Mon, Jul 8, 2024 at 10:21?AM X wrote:

All,

Please see the vulns below and remediate as soon as possible. These are in
containers.

Path              :
/var/lib/docker/overlay2/48c2e3da9fc2282822d4522e28ca46788f5357a14a8a38f687e2cadbf9de68d7/diff/usr/lib/jvm/java-17-openjdk-amd64/
  Installed version : 17.0.8
  Fixed version     : Upgrade to a version greater than 17.0.10

Path              :
/var/lib/docker/overlay2/4aed72b0f0433c615afe67854c8c79bb7acca2fb01216bf6be25774180266f4d/diff/usr/lib/jvm/java-17-openjdk-amd64/
  Installed version : 17.0.8
  Fixed version     : Upgrade to a version greater than 17.0.10



_______________________________________________
gdal-dev mailing
listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev

-- http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/c5369590/attachment.htm>

From even.rouault at spatialys.com  Fri Sep 13 07:08:34 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 13 Sep 2024 16:08:34 +0200
Subject: [gdal-dev] Upgrade or remove Java JDK 17 in GDAL Docker image
In-Reply-To: <CADorzfppByWPnVT7gUVa_KNGVFO-GhQGPCKi60g7Ua50oFG6hw@mail.gmail.com>
References: <CO1PR10MB457818D07657F4627A20DD06FE992@CO1PR10MB4578.namprd10.prod.outlook.com>
 <5e73612d-0235-4436-a27b-eb302019e6b7@spatialys.com>
 <CADorzfppByWPnVT7gUVa_KNGVFO-GhQGPCKi60g7Ua50oFG6hw@mail.gmail.com>
Message-ID: <c4fa501e-e9c1-46f4-9ebe-4468b3c7dcf0@spatialys.com>


> How can I resolve this error?
You have stripped too much of the logs. There must be some "error: " 
compilation line before that points to the actual error.
>
> Alternatively, we have considered a different solution that uses 
> ubuntu:22.04 as our base image and then installing GDAL but also 
> having problems with installing GDAL (I can't seem to get past 
> dependency conflicts for v3.8.5 in pipenv so trying v3.8.3), getting 
> an error:
>
>     Collecting gdal==3.8.3 (from -r
>     /tmp/pipenv-gde160cj-requirements/pipenv-ndnw2zi0-hashed-reqs.txt
>     (line 62))
>     ? Downloading GDAL-3.8.3.tar.gz (802 kB)
>     ? ? ?????????????????????????????????????? 802.5/802.5 kB 104.5
>     MB/s eta 0:00:00
>     ? Preparing metadata (setup.py): started
>     ? Preparing metadata (setup.py): finished with status 'error'
>     error: subprocess-exited-with-error
>
>     ? ? python setup.py egg_info did not run successfully.
>     ? exit code: 1
>
>     Exception: Python bindings of GDAL 3.8.3 require at least libgdal
>     3.8.3, but 3.4.1 was found
>
> How can we upgrade libgdal (in our Dockerfile)?

- Use another Docker image, like alpine-normal or ubuntu-small, that 
doesn't have the Java dependency

- Use Conda to install GDAL

- Use plain ubuntu:24.04 that ships with GDAL 3.8.4 as a proper .deb 
package (https://launchpad.net/ubuntu/noble/+source/gdal)

- ...


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/faf19f29/attachment.htm>

From j1 at jimenezshaw.com  Fri Sep 13 09:14:36 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Fri, 13 Sep 2024 18:14:36 +0200
Subject: [gdal-dev] [EXTERNAL]  s3 request example
In-Reply-To: <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
Message-ID: <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>

Thanks David for the suggestion. Very interesting data.

Unfortunately the issue I have is not reproduced with that file. So it may
be due to the authentication (your suggestion does not need authentication).

Some context: I am opening a COG file from S3 in QGIS, setting the url in
the command line. Something like
qgis /vsis3/blahblabla

(more on that later)

If I run it in my Ubuntu 22.04 (that has GDAL 3.4.1), with QGIS 3.38, no
problem
If I run with conda with QGIS 3.38 (that has GDAL 3.9.1), it is noticeable
slower.

So I think it is due to the version of GDAL. If you think that I am wrong
and I should ask directly to QGIS, it is ok.

This is a bit problematic to reproduce because the authorization expires in
12 hours. So I post here the command I produced with a python script. If it
is needed, I can share the python script that is  getting the
authentication. It is about 100 lines of code.

Enabling the logs I see there a gap of 6 seconds during the opening with
conda, that is not there with the QGIS from Ubuntu that uses GDAL 3.4.1

This is the log from conda
The gap is between
Fri Sep 13 17:56:26 2024].9370
and
[Fri Sep 13 17:56:33 2024].4445

CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py --project-id 1969386
--share-token 09c3eada-1b3b-46eb-b5de-8bd51635a5b9
Session expires at 2024-09-14T03:56:22Z
AWS_ACCESS_KEY_ID=ASIATOCJLBKS2RHGCAHB
AWS_SECRET_ACCESS_KEY=nNT8fTH/cGiyn4NVubp5/1LroyZ69johhXYxkCK1
AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDI1G/49ov88aGibrOCLXAilDbBuFQ/ydJF4AZ50/lYmWYmNDjM9H7XbbioyXiLQzwTqVRN1TLG6T29Anklkw47MKxdKHDF/O85r9gWJmCAqYTKalA38VM1qbixsjSXAzR7W5p1v1pgRUKtN4J03NrZOH2S6gbo4OKv+UUkPe/Xq4s8w0vEVNJLhvVx6dvpJMv7Jp9UxvLA5a+nrBKUqJujujqJnRXAKKfnpJbTDvhCuIeTxaFFt50e5UpLjSwqXS/a/AaEMJXRSsSLbKFTW/ALSCHfPv3HCStnue5CFpzVk4OhQbQ+dZyXUQp5wxQTtpr0hIh0IyB20gsoZNa0lGvFuXnzqDCH2X2mXwzDcyZk2IOX34nq+Wtnk8qYdjJxEAG0tnlYsMjmmXECnbOxl6gtNJ5hoehgak6cSfs7/rMi4jOI838tzsWWyDJeACj9qfQyfGtpk23x8Zt6KuqUjNZ1/z+/T8LwoopsGRtwYyKQbJS8pn8IGKPLtHDVxRx09yBRuqgYVFzSqpnr3T1vwWYHXiEF0sVJBx
GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR
/home/jshaw/anaconda3/envs/qgis_stable/bin/qgis
/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
[Fri Sep 13 17:56:26 2024].3948, 0.0000: HTTP: libcurl/8.9.0 OpenSSL/3.3.1
zlib/1.3.1 zstd/1.5.6 libssh2/1.11.0 nghttp2/1.58.0
[Fri Sep 13 17:56:26 2024].7731, 0.3783: S3: Switching to endpoint
s3.eu-central-1.amazonaws.com
[Fri Sep 13 17:56:26 2024].8415, 0.4467: S3: Switching to region
eu-central-1
[Fri Sep 13 17:56:26 2024].9230, 0.5282: S3: GetFileSize(
https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
 response_code=206
[Fri Sep 13 17:56:26 2024].9235, 0.5288: GDAL:
GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x556e6bb915a0) succeeds as GTiff.
[Fri Sep 13 17:56:26 2024].9240, 0.5292: GTiff: ScanDirectories()
[Fri Sep 13 17:56:26 2024].9243, 0.5296: GTiff: Opened band mask.
[Fri Sep 13 17:56:26 2024].9246, 0.5298: GTiff: Opened 8929x7207 overview.
[Fri Sep 13 17:56:26 2024].9249, 0.5301: GTiff: Opened 4464x3603 overview.
[Fri Sep 13 17:56:26 2024].9251, 0.5304: GTiff: Opened 2232x1801 overview.
[Fri Sep 13 17:56:26 2024].9254, 0.5306: GTiff: Opened 1116x900 overview.
[Fri Sep 13 17:56:26 2024].9257, 0.5309: GTiff: Opened 558x450 overview.
[Fri Sep 13 17:56:26 2024].9259, 0.5311: GTiff: Opened 279x225 overview.
[Fri Sep 13 17:56:26 2024].9262, 0.5314: GTiff: Opened band mask for
8929x7207 overview.
[Fri Sep 13 17:56:26 2024].9264, 0.5316: GTiff: Opened band mask for
4464x3603 overview.
[Fri Sep 13 17:56:26 2024].9267, 0.5319: GTiff: Opened band mask for
2232x1801 overview.
[Fri Sep 13 17:56:26 2024].9269, 0.5321: GTiff: Opened band mask for
1116x900 overview.
[Fri Sep 13 17:56:26 2024].9272, 0.5324: GTiff: Opened band mask for
558x450 overview.
[Fri Sep 13 17:56:26 2024].9274, 0.5326: GTiff: Opened band mask for
279x225 overview.
[Fri Sep 13 17:56:26 2024].9277, 0.5329: GDAL:
GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x556e6bb915a0)
ERROR: Status 2: File
/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
could not be found
[Fri Sep 13 17:56:26 2024].9370, 0.5422: GDAL: On-demand registering
/home/jshaw/anaconda3/envs/qgis_stable/lib/gdalplugins/gdal_TileDB.so using
GDALRegister_TileDB.
[Fri Sep 13 17:56:33 2024].4445, 7.0498: S3: GetFileSize(
https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
 response_code=206
[Fri Sep 13 17:56:33 2024].4449, 7.0501: GDAL:
GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x556e6b807d00) succeeds as GTiff.
GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4666, 7.0718: OGRCT: Using
WebMercator to WGS84 optimization
GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4667, 7.0719: GDAL: Computing area
of interest: 6.62976, 46.6391, 6.63534, 46.6422
[Fri Sep 13 17:56:33 2024].4667, 7.0719: GTiff: ScanDirectories()
[Fri Sep 13 17:56:33 2024].4669, 7.0721: GTiff: Opened band mask.
[Fri Sep 13 17:56:33 2024].4670, 7.0722: GTiff: Opened 8929x7207 overview.
[Fri Sep 13 17:56:33 2024].4671, 7.0723: GTiff: Opened 4464x3603 overview.
[Fri Sep 13 17:56:33 2024].4672, 7.0724: GTiff: Opened 2232x1801 overview.
[Fri Sep 13 17:56:33 2024].4673, 7.0725: GTiff: Opened 1116x900 overview.
[Fri Sep 13 17:56:33 2024].4674, 7.0726: GTiff: Opened 558x450 overview.
[Fri Sep 13 17:56:33 2024].4675, 7.0727: GTiff: Opened 279x225 overview.
[Fri Sep 13 17:56:33 2024].4676, 7.0728: GTiff: Opened band mask for
8929x7207 overview.
[Fri Sep 13 17:56:33 2024].4677, 7.0729: GTiff: Opened band mask for
4464x3603 overview.
[Fri Sep 13 17:56:33 2024].4677, 7.0730: GTiff: Opened band mask for
2232x1801 overview.
[Fri Sep 13 17:56:33 2024].4678, 7.0731: GTiff: Opened band mask for
1116x900 overview.
[Fri Sep 13 17:56:33 2024].4679, 7.0732: GTiff: Opened band mask for
558x450 overview.
[Fri Sep 13 17:56:33 2024].4680, 7.0733: GTiff: Opened band mask for
279x225 overview.
[Fri Sep 13 17:56:33 2024].5178, 7.1230: GDAL:
GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x7f830c08d490) succeeds as GTiff.
[Fri Sep 13 17:56:33 2024].5180, 7.1232: S3: Downloading 59179008-59244543 (
https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].5244, 7.1296: GDAL: Computing area
of interest: 6.62976, 46.6391, 6.63534, 46.6422
[Fri Sep 13 17:56:33 2024].5245, 7.1297: GTiff: ScanDirectories()
[Fri Sep 13 17:56:33 2024].5246, 7.1298: GTiff: Opened band mask.
[Fri Sep 13 17:56:33 2024].5247, 7.1299: GTiff: Opened 8929x7207 overview.
[Fri Sep 13 17:56:33 2024].5247, 7.1300: GTiff: Opened 4464x3603 overview.
[Fri Sep 13 17:56:33 2024].5248, 7.1300: GTiff: Opened 2232x1801 overview.
[Fri Sep 13 17:56:33 2024].5249, 7.1301: GTiff: Opened 1116x900 overview.
[Fri Sep 13 17:56:33 2024].5249, 7.1302: GTiff: Opened 558x450 overview.
[Fri Sep 13 17:56:33 2024].5250, 7.1302: GTiff: Opened 279x225 overview.
[Fri Sep 13 17:56:33 2024].5251, 7.1303: GTiff: Opened band mask for
8929x7207 overview.
[Fri Sep 13 17:56:33 2024].5251, 7.1304: GTiff: Opened band mask for
4464x3603 overview.
[Fri Sep 13 17:56:33 2024].5252, 7.1304: GTiff: Opened band mask for
2232x1801 overview.
[Fri Sep 13 17:56:33 2024].5253, 7.1305: GTiff: Opened band mask for
1116x900 overview.
[Fri Sep 13 17:56:33 2024].5253, 7.1306: GTiff: Opened band mask for
558x450 overview.
[Fri Sep 13 17:56:33 2024].5254, 7.1306: GTiff: Opened band mask for
279x225 overview.
[Fri Sep 13 17:56:33 2024].5255, 7.1307: GDAL: Selecting overview 1116 x 900
[Fri Sep 13 17:56:33 2024].5255, 7.1307: S3: Downloading 16384-32767 (
https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
[Fri Sep 13 17:56:33 2024].6116, 7.2168: S3: Got response_code=206
[Fri Sep 13 17:56:33 2024].6118, 7.2171: S3: Downloading 180224-589823 (
https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
[Fri Sep 13 17:56:33 2024].6955, 7.3008: S3: Got response_code=206
[Fri Sep 13 17:56:33 2024].6960, 7.3012: GDAL: GDAL_CACHEMAX = 1591 MB
[Fri Sep 13 17:56:33 2024].6977, 7.3029: S3: Got response_code=206


This is the equivalent code with QGIS 3.38 in Ubuntu and GDAL 3.4.1

CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py --project-id 1969386
--share-token 09c3eada-1b3b-46eb-b5de-8bd51635a5b9
Session expires at 2024-09-14T04:00:10Z
AWS_ACCESS_KEY_ID=ASIATOCJLBKSRCEUBKE6
AWS_SECRET_ACCESS_KEY=h6NhBf9VwBZoVj5Zd/8H2BnzXQu0l6bFUUv2D8E7
AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDF1xO50XL6GBe/358CLXAn3JR/uteJtarwJ/ryn6i4+lcMFEQZ/KV0FZQdKsD1PwAcqoYFY+0GKYSV+FTk81ZszsVzy8N7d2GwByvP9S/L1XOo1FrqJfDpGw3a5eQR7AoeU68EPlD/WTYnM7XBzXimHywDCyue3SOi8oZaSdbMgjBQ1N6j+qQ+EDN7RjD/Zu2CGMTzN9g/Z0FhZsuyt2HRhnOYpsvpUMZ+WQr7pbjdVdwt3PdFHsJ95fhueapJspgQ7OSgmj5VtSR8NTecohLsd2eeGkSpiqVWuBwuAu2cW6LcqmAZGnF0DZIjPWiMIDf/OLczMRCw5MJGeYpsSkkiuM+t9Miv8aN4iCo8vjl6wumOCgPqTgBBWlQdAs2mLxwpF1Bb1UjJ6eiccp17+yJF3ffn8tvxx/+1V3Q++E5Xk+jiB1keJnFcizr7qD6EY+EdDES5sQrWAhM2uR78JjNc0f+hVZEmAoisORtwYyKb0po07ytiiBv+X3j+Y6BsCHR0Es3C3xVvsgkfn1zb1Z2flFWUzwqJUD
GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR /usr/bin/qgis
/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
[Fri Sep 13 18:00:14 2024].7665, 0.0000: HTTP: libcurl/7.81.0 OpenSSL/3.0.2
zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 libidn2/2.3.2 libpsl/0.21.0
(+libidn2/2.3.2) libssh/0.9.6/openssl/zlib nghttp2/1.43.0 librtmp/2.3
OpenLDAP/2.5.18
[Fri Sep 13 18:00:14 2024].7666, 0.0001: S3: Downloading 0-16383 (
https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
[Fri Sep 13 18:00:14 2024].8897, 0.1231: S3: Got response_code=400
[Fri Sep 13 18:00:14 2024].8898, 0.1232: S3: Switching to region
eu-central-1
[Fri Sep 13 18:00:14 2024].8899, 0.1234: S3: Downloading 0-16383 (
https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
[Fri Sep 13 18:00:15 2024].0287, 0.2621: S3: Got response_code=206
[Fri Sep 13 18:00:15 2024].0288, 0.2622: S3: GetFileSize(
https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
 response_code=206
[Fri Sep 13 18:00:15 2024].0292, 0.2627: GDAL:
GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x560e4cd84920) succeeds as GTiff.
[Fri Sep 13 18:00:15 2024].0298, 0.2632: GTiff: ScanDirectories()
[Fri Sep 13 18:00:15 2024].0301, 0.2635: GTiff: Opened band mask.
[Fri Sep 13 18:00:15 2024].0304, 0.2638: GTiff: Opened 8929x7207 overview.
[Fri Sep 13 18:00:15 2024].0306, 0.2641: GTiff: Opened 4464x3603 overview.
[Fri Sep 13 18:00:15 2024].0309, 0.2643: GTiff: Opened 2232x1801 overview.
[Fri Sep 13 18:00:15 2024].0311, 0.2646: GTiff: Opened 1116x900 overview.
[Fri Sep 13 18:00:15 2024].0314, 0.2648: GTiff: Opened 558x450 overview.
[Fri Sep 13 18:00:15 2024].0316, 0.2651: GTiff: Opened 279x225 overview.
[Fri Sep 13 18:00:15 2024].0319, 0.2654: GTiff: Opened band mask for
8929x7207 overview.
[Fri Sep 13 18:00:15 2024].0322, 0.2656: GTiff: Opened band mask for
4464x3603 overview.
[Fri Sep 13 18:00:15 2024].0324, 0.2658: GTiff: Opened band mask for
2232x1801 overview.
[Fri Sep 13 18:00:15 2024].0326, 0.2661: GTiff: Opened band mask for
1116x900 overview.
[Fri Sep 13 18:00:15 2024].0329, 0.2663: GTiff: Opened band mask for
558x450 overview.
[Fri Sep 13 18:00:15 2024].0331, 0.2665: GTiff: Opened band mask for
279x225 overview.
[Fri Sep 13 18:00:15 2024].0334, 0.2669: GDAL:
GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x560e4cd84920)
ERROR: Status 2: File
/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
could not be found
[Fri Sep 13 18:00:15 2024].0357, 0.2691: S3: Downloading 0-16383 (
https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
[Fri Sep 13 18:00:15 2024].0762, 0.3096: S3: Got response_code=206
[Fri Sep 13 18:00:15 2024].0762, 0.3097: S3: GetFileSize(
https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
 response_code=206
[Fri Sep 13 18:00:15 2024].0765, 0.3099: GDAL:
GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x560e4d0afb70) succeeds as GTiff.
GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].0956, 0.3291: GDAL: Computing area
of interest: 6.62976, 46.6391, 6.63534, 46.6422
[Fri Sep 13 18:00:15 2024].0958, 0.3293: GTiff: ScanDirectories()
[Fri Sep 13 18:00:15 2024].0959, 0.3294: GTiff: Opened band mask.
[Fri Sep 13 18:00:15 2024].0961, 0.3295: GTiff: Opened 8929x7207 overview.
[Fri Sep 13 18:00:15 2024].0962, 0.3296: GTiff: Opened 4464x3603 overview.
[Fri Sep 13 18:00:15 2024].0962, 0.3297: GTiff: Opened 2232x1801 overview.
[Fri Sep 13 18:00:15 2024].0963, 0.3298: GTiff: Opened 1116x900 overview.
[Fri Sep 13 18:00:15 2024].0964, 0.3299: GTiff: Opened 558x450 overview.
[Fri Sep 13 18:00:15 2024].0965, 0.3300: GTiff: Opened 279x225 overview.
[Fri Sep 13 18:00:15 2024].0966, 0.3301: GTiff: Opened band mask for
8929x7207 overview.
[Fri Sep 13 18:00:15 2024].0967, 0.3302: GTiff: Opened band mask for
4464x3603 overview.
[Fri Sep 13 18:00:15 2024].0968, 0.3303: GTiff: Opened band mask for
2232x1801 overview.
[Fri Sep 13 18:00:15 2024].0969, 0.3303: GTiff: Opened band mask for
1116x900 overview.
[Fri Sep 13 18:00:15 2024].0970, 0.3304: GTiff: Opened band mask for
558x450 overview.
[Fri Sep 13 18:00:15 2024].0971, 0.3305: GTiff: Opened band mask for
279x225 overview.
[Fri Sep 13 18:00:15 2024].2011, 0.4346: GDAL:
GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x7f0dfc08dfd0) succeeds as GTiff.
GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].2120, 0.4454: GDAL: Computing area
of interest: 6.62976, 46.6391, 6.63534, 46.6422
[Fri Sep 13 18:00:15 2024].2121, 0.4456: GTiff: ScanDirectories()
[Fri Sep 13 18:00:15 2024].2122, 0.4457: GTiff: Opened band mask.
[Fri Sep 13 18:00:15 2024].2123, 0.4457: GTiff: Opened 8929x7207 overview.
[Fri Sep 13 18:00:15 2024].2123, 0.4458: GTiff: Opened 4464x3603 overview.
[Fri Sep 13 18:00:15 2024].2124, 0.4459: GTiff: Opened 2232x1801 overview.
[Fri Sep 13 18:00:15 2024].2125, 0.4459: GTiff: Opened 1116x900 overview.
[Fri Sep 13 18:00:15 2024].2125, 0.4460: GTiff: Opened 558x450 overview.
[Fri Sep 13 18:00:15 2024].2126, 0.4460: GTiff: Opened 279x225 overview.
[Fri Sep 13 18:00:15 2024].2126, 0.4461: GTiff: Opened band mask for
8929x7207 overview.
[Fri Sep 13 18:00:15 2024].2127, 0.4462: GTiff: Opened band mask for
4464x3603 overview.
[Fri Sep 13 18:00:15 2024].2128, 0.4462: GTiff: Opened band mask for
2232x1801 overview.
[Fri Sep 13 18:00:15 2024].2128, 0.4463: GTiff: Opened band mask for
1116x900 overview.
[Fri Sep 13 18:00:15 2024].2129, 0.4463: GTiff: Opened band mask for
558x450 overview.
[Fri Sep 13 18:00:15 2024].2129, 0.4464: GTiff: Opened band mask for
279x225 overview.
[Fri Sep 13 18:00:15 2024].2130, 0.4465: S3: Downloading 16384-32767 (
https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
[Fri Sep 13 18:00:15 2024].3454, 0.5789: S3: Got response_code=206
[Fri Sep 13 18:00:15 2024].3456, 0.5791: S3: Downloading 180224-589823 (
https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
..
[Fri Sep 13 18:00:15 2024].4272, 0.6606: S3: Got response_code=206
[Fri Sep 13 18:00:15 2024].4276, 0.6610: GDAL: GDAL_CACHEMAX = 1591 MB

What can it be?

BTW, in both cases it says
ERROR: Status 2: File
/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
could not be found
And later it opens it. I don't know why.

Thank you very much
Javier.

On Mon, 9 Sept 2024 at 23:49, Mayer, David P <dpmayer at usgs.gov> wrote:

> Would ~200 GB be large enough?
>
> Here is a mosaic of a section of Mars at 6 meters/pixel in a public S3
> bucket:
>
> s3://asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif
>
> Cheers,
> David
>
> -----------
> David Mayer
> Geographer
> Astrogeology Science Center
> US Geological Survey
> dpmayer at usgs.gov
> ------------------------------
> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Javier
> Jimenez Shaw via gdal-dev <gdal-dev at lists.osgeo.org>
> *Sent:* Monday, September 9, 2024 13:55
> *To:* gdal dev <gdal-dev at lists.osgeo.org>
> *Subject:* [EXTERNAL] [gdal-dev] s3 request example
>
>
>
>
> * This email has been received from outside of DOI - Use caution before
> clicking on links, opening attachments, or responding.  *
>
>
>
> Hi
>
> I am experiencing a much slower load of a remote COG using vsis3 with the
> QGIS from conda than the QGIS in my Ubuntu (that uses GDAL 3.4.1).
>
> Because both are QGIS 3.38, I think the problem is in the version of GDAL.
> I would like to research it more.
>
> Is there any example of a (big) COG file in Amazon S3 I can use to compare
> them? Unfortunately the credentials for the files I am using expire after a
> few hours, so they are useless to report anything.
>
> Best regards,
> Javier
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/f3423b48/attachment-0001.htm>

From thomas.bonfort at gmail.com  Fri Sep 13 09:22:10 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Fri, 13 Sep 2024 18:22:10 +0200
Subject: [gdal-dev] [EXTERNAL] s3 request example
In-Reply-To: <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
Message-ID: <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>

Javier,
3.9 is probably doing parallel reads, which will cause a noticeable lag in
requests on a slow connection (the overall processing time should not be
slower anyhow). There's a gtiff open option documented that can disable
this behavior, that you can try to use to see if it changes your timings.
If that is the effective cause, that would mean there is an issue with this
parallel implementation.
TB

Le ven. 13 sept. 2024, 18:15, Javier Jimenez Shaw via gdal-dev <
gdal-dev at lists.osgeo.org> a ?crit :

> Thanks David for the suggestion. Very interesting data.
>
> Unfortunately the issue I have is not reproduced with that file. So it may
> be due to the authentication (your suggestion does not need authentication).
>
> Some context: I am opening a COG file from S3 in QGIS, setting the url in
> the command line. Something like
> qgis /vsis3/blahblabla
>
> (more on that later)
>
> If I run it in my Ubuntu 22.04 (that has GDAL 3.4.1), with QGIS 3.38, no
> problem
> If I run with conda with QGIS 3.38 (that has GDAL 3.9.1), it is noticeable
> slower.
>
> So I think it is due to the version of GDAL. If you think that I am wrong
> and I should ask directly to QGIS, it is ok.
>
> This is a bit problematic to reproduce because the authorization expires
> in 12 hours. So I post here the command I produced with a python script. If
> it is needed, I can share the python script that is  getting the
> authentication. It is about 100 lines of code.
>
> Enabling the logs I see there a gap of 6 seconds during the opening with
> conda, that is not there with the QGIS from Ubuntu that uses GDAL 3.4.1
>
> This is the log from conda
> The gap is between
> Fri Sep 13 17:56:26 2024].9370
> and
> [Fri Sep 13 17:56:33 2024].4445
>
> CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py --project-id 1969386
> --share-token 09c3eada-1b3b-46eb-b5de-8bd51635a5b9
> Session expires at 2024-09-14T03:56:22Z
> AWS_ACCESS_KEY_ID=ASIATOCJLBKS2RHGCAHB
> AWS_SECRET_ACCESS_KEY=nNT8fTH/cGiyn4NVubp5/1LroyZ69johhXYxkCK1
> AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDI1G/49ov88aGibrOCLXAilDbBuFQ/ydJF4AZ50/lYmWYmNDjM9H7XbbioyXiLQzwTqVRN1TLG6T29Anklkw47MKxdKHDF/O85r9gWJmCAqYTKalA38VM1qbixsjSXAzR7W5p1v1pgRUKtN4J03NrZOH2S6gbo4OKv+UUkPe/Xq4s8w0vEVNJLhvVx6dvpJMv7Jp9UxvLA5a+nrBKUqJujujqJnRXAKKfnpJbTDvhCuIeTxaFFt50e5UpLjSwqXS/a/AaEMJXRSsSLbKFTW/ALSCHfPv3HCStnue5CFpzVk4OhQbQ+dZyXUQp5wxQTtpr0hIh0IyB20gsoZNa0lGvFuXnzqDCH2X2mXwzDcyZk2IOX34nq+Wtnk8qYdjJxEAG0tnlYsMjmmXECnbOxl6gtNJ5hoehgak6cSfs7/rMi4jOI838tzsWWyDJeACj9qfQyfGtpk23x8Zt6KuqUjNZ1/z+/T8LwoopsGRtwYyKQbJS8pn8IGKPLtHDVxRx09yBRuqgYVFzSqpnr3T1vwWYHXiEF0sVJBx
> GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR
> /home/jshaw/anaconda3/envs/qgis_stable/bin/qgis
> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
> [Fri Sep 13 17:56:26 2024].3948, 0.0000: HTTP: libcurl/8.9.0 OpenSSL/3.3.1
> zlib/1.3.1 zstd/1.5.6 libssh2/1.11.0 nghttp2/1.58.0
> [Fri Sep 13 17:56:26 2024].7731, 0.3783: S3: Switching to endpoint
> s3.eu-central-1.amazonaws.com
> [Fri Sep 13 17:56:26 2024].8415, 0.4467: S3: Switching to region
> eu-central-1
> [Fri Sep 13 17:56:26 2024].9230, 0.5282: S3: GetFileSize(
> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>  response_code=206
> [Fri Sep 13 17:56:26 2024].9235, 0.5288: GDAL:
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x556e6bb915a0) succeeds as GTiff.
> [Fri Sep 13 17:56:26 2024].9240, 0.5292: GTiff: ScanDirectories()
> [Fri Sep 13 17:56:26 2024].9243, 0.5296: GTiff: Opened band mask.
> [Fri Sep 13 17:56:26 2024].9246, 0.5298: GTiff: Opened 8929x7207 overview.
> [Fri Sep 13 17:56:26 2024].9249, 0.5301: GTiff: Opened 4464x3603 overview.
> [Fri Sep 13 17:56:26 2024].9251, 0.5304: GTiff: Opened 2232x1801 overview.
> [Fri Sep 13 17:56:26 2024].9254, 0.5306: GTiff: Opened 1116x900 overview.
> [Fri Sep 13 17:56:26 2024].9257, 0.5309: GTiff: Opened 558x450 overview.
> [Fri Sep 13 17:56:26 2024].9259, 0.5311: GTiff: Opened 279x225 overview.
> [Fri Sep 13 17:56:26 2024].9262, 0.5314: GTiff: Opened band mask for
> 8929x7207 overview.
> [Fri Sep 13 17:56:26 2024].9264, 0.5316: GTiff: Opened band mask for
> 4464x3603 overview.
> [Fri Sep 13 17:56:26 2024].9267, 0.5319: GTiff: Opened band mask for
> 2232x1801 overview.
> [Fri Sep 13 17:56:26 2024].9269, 0.5321: GTiff: Opened band mask for
> 1116x900 overview.
> [Fri Sep 13 17:56:26 2024].9272, 0.5324: GTiff: Opened band mask for
> 558x450 overview.
> [Fri Sep 13 17:56:26 2024].9274, 0.5326: GTiff: Opened band mask for
> 279x225 overview.
> [Fri Sep 13 17:56:26 2024].9277, 0.5329: GDAL:
> GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x556e6bb915a0)
> ERROR: Status 2: File
> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
> could not be found
> [Fri Sep 13 17:56:26 2024].9370, 0.5422: GDAL: On-demand registering
> /home/jshaw/anaconda3/envs/qgis_stable/lib/gdalplugins/gdal_TileDB.so using
> GDALRegister_TileDB.
> [Fri Sep 13 17:56:33 2024].4445, 7.0498: S3: GetFileSize(
> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>  response_code=206
> [Fri Sep 13 17:56:33 2024].4449, 7.0501: GDAL:
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x556e6b807d00) succeeds as GTiff.
> GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4666, 7.0718: OGRCT: Using
> WebMercator to WGS84 optimization
> GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4667, 7.0719: GDAL: Computing
> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
> [Fri Sep 13 17:56:33 2024].4667, 7.0719: GTiff: ScanDirectories()
> [Fri Sep 13 17:56:33 2024].4669, 7.0721: GTiff: Opened band mask.
> [Fri Sep 13 17:56:33 2024].4670, 7.0722: GTiff: Opened 8929x7207 overview.
> [Fri Sep 13 17:56:33 2024].4671, 7.0723: GTiff: Opened 4464x3603 overview.
> [Fri Sep 13 17:56:33 2024].4672, 7.0724: GTiff: Opened 2232x1801 overview.
> [Fri Sep 13 17:56:33 2024].4673, 7.0725: GTiff: Opened 1116x900 overview.
> [Fri Sep 13 17:56:33 2024].4674, 7.0726: GTiff: Opened 558x450 overview.
> [Fri Sep 13 17:56:33 2024].4675, 7.0727: GTiff: Opened 279x225 overview.
> [Fri Sep 13 17:56:33 2024].4676, 7.0728: GTiff: Opened band mask for
> 8929x7207 overview.
> [Fri Sep 13 17:56:33 2024].4677, 7.0729: GTiff: Opened band mask for
> 4464x3603 overview.
> [Fri Sep 13 17:56:33 2024].4677, 7.0730: GTiff: Opened band mask for
> 2232x1801 overview.
> [Fri Sep 13 17:56:33 2024].4678, 7.0731: GTiff: Opened band mask for
> 1116x900 overview.
> [Fri Sep 13 17:56:33 2024].4679, 7.0732: GTiff: Opened band mask for
> 558x450 overview.
> [Fri Sep 13 17:56:33 2024].4680, 7.0733: GTiff: Opened band mask for
> 279x225 overview.
> [Fri Sep 13 17:56:33 2024].5178, 7.1230: GDAL:
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x7f830c08d490) succeeds as GTiff.
> [Fri Sep 13 17:56:33 2024].5180, 7.1232: S3: Downloading 59179008-59244543
> (
> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].5244, 7.1296: GDAL: Computing
> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
> [Fri Sep 13 17:56:33 2024].5245, 7.1297: GTiff: ScanDirectories()
> [Fri Sep 13 17:56:33 2024].5246, 7.1298: GTiff: Opened band mask.
> [Fri Sep 13 17:56:33 2024].5247, 7.1299: GTiff: Opened 8929x7207 overview.
> [Fri Sep 13 17:56:33 2024].5247, 7.1300: GTiff: Opened 4464x3603 overview.
> [Fri Sep 13 17:56:33 2024].5248, 7.1300: GTiff: Opened 2232x1801 overview.
> [Fri Sep 13 17:56:33 2024].5249, 7.1301: GTiff: Opened 1116x900 overview.
> [Fri Sep 13 17:56:33 2024].5249, 7.1302: GTiff: Opened 558x450 overview.
> [Fri Sep 13 17:56:33 2024].5250, 7.1302: GTiff: Opened 279x225 overview.
> [Fri Sep 13 17:56:33 2024].5251, 7.1303: GTiff: Opened band mask for
> 8929x7207 overview.
> [Fri Sep 13 17:56:33 2024].5251, 7.1304: GTiff: Opened band mask for
> 4464x3603 overview.
> [Fri Sep 13 17:56:33 2024].5252, 7.1304: GTiff: Opened band mask for
> 2232x1801 overview.
> [Fri Sep 13 17:56:33 2024].5253, 7.1305: GTiff: Opened band mask for
> 1116x900 overview.
> [Fri Sep 13 17:56:33 2024].5253, 7.1306: GTiff: Opened band mask for
> 558x450 overview.
> [Fri Sep 13 17:56:33 2024].5254, 7.1306: GTiff: Opened band mask for
> 279x225 overview.
> [Fri Sep 13 17:56:33 2024].5255, 7.1307: GDAL: Selecting overview 1116 x
> 900
> [Fri Sep 13 17:56:33 2024].5255, 7.1307: S3: Downloading 16384-32767 (
> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> [Fri Sep 13 17:56:33 2024].6116, 7.2168: S3: Got response_code=206
> [Fri Sep 13 17:56:33 2024].6118, 7.2171: S3: Downloading 180224-589823 (
> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> [Fri Sep 13 17:56:33 2024].6955, 7.3008: S3: Got response_code=206
> [Fri Sep 13 17:56:33 2024].6960, 7.3012: GDAL: GDAL_CACHEMAX = 1591 MB
> [Fri Sep 13 17:56:33 2024].6977, 7.3029: S3: Got response_code=206
>
>
> This is the equivalent code with QGIS 3.38 in Ubuntu and GDAL 3.4.1
>
> CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py --project-id 1969386
> --share-token 09c3eada-1b3b-46eb-b5de-8bd51635a5b9
> Session expires at 2024-09-14T04:00:10Z
> AWS_ACCESS_KEY_ID=ASIATOCJLBKSRCEUBKE6
> AWS_SECRET_ACCESS_KEY=h6NhBf9VwBZoVj5Zd/8H2BnzXQu0l6bFUUv2D8E7
> AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDF1xO50XL6GBe/358CLXAn3JR/uteJtarwJ/ryn6i4+lcMFEQZ/KV0FZQdKsD1PwAcqoYFY+0GKYSV+FTk81ZszsVzy8N7d2GwByvP9S/L1XOo1FrqJfDpGw3a5eQR7AoeU68EPlD/WTYnM7XBzXimHywDCyue3SOi8oZaSdbMgjBQ1N6j+qQ+EDN7RjD/Zu2CGMTzN9g/Z0FhZsuyt2HRhnOYpsvpUMZ+WQr7pbjdVdwt3PdFHsJ95fhueapJspgQ7OSgmj5VtSR8NTecohLsd2eeGkSpiqVWuBwuAu2cW6LcqmAZGnF0DZIjPWiMIDf/OLczMRCw5MJGeYpsSkkiuM+t9Miv8aN4iCo8vjl6wumOCgPqTgBBWlQdAs2mLxwpF1Bb1UjJ6eiccp17+yJF3ffn8tvxx/+1V3Q++E5Xk+jiB1keJnFcizr7qD6EY+EdDES5sQrWAhM2uR78JjNc0f+hVZEmAoisORtwYyKb0po07ytiiBv+X3j+Y6BsCHR0Es3C3xVvsgkfn1zb1Z2flFWUzwqJUD
> GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR /usr/bin/qgis
> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
> [Fri Sep 13 18:00:14 2024].7665, 0.0000: HTTP: libcurl/7.81.0
> OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 libidn2/2.3.2
> libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib nghttp2/1.43.0
> librtmp/2.3 OpenLDAP/2.5.18
> [Fri Sep 13 18:00:14 2024].7666, 0.0001: S3: Downloading 0-16383 (
> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> [Fri Sep 13 18:00:14 2024].8897, 0.1231: S3: Got response_code=400
> [Fri Sep 13 18:00:14 2024].8898, 0.1232: S3: Switching to region
> eu-central-1
> [Fri Sep 13 18:00:14 2024].8899, 0.1234: S3: Downloading 0-16383 (
> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> [Fri Sep 13 18:00:15 2024].0287, 0.2621: S3: Got response_code=206
> [Fri Sep 13 18:00:15 2024].0288, 0.2622: S3: GetFileSize(
> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>  response_code=206
> [Fri Sep 13 18:00:15 2024].0292, 0.2627: GDAL:
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x560e4cd84920) succeeds as GTiff.
> [Fri Sep 13 18:00:15 2024].0298, 0.2632: GTiff: ScanDirectories()
> [Fri Sep 13 18:00:15 2024].0301, 0.2635: GTiff: Opened band mask.
> [Fri Sep 13 18:00:15 2024].0304, 0.2638: GTiff: Opened 8929x7207 overview.
> [Fri Sep 13 18:00:15 2024].0306, 0.2641: GTiff: Opened 4464x3603 overview.
> [Fri Sep 13 18:00:15 2024].0309, 0.2643: GTiff: Opened 2232x1801 overview.
> [Fri Sep 13 18:00:15 2024].0311, 0.2646: GTiff: Opened 1116x900 overview.
> [Fri Sep 13 18:00:15 2024].0314, 0.2648: GTiff: Opened 558x450 overview.
> [Fri Sep 13 18:00:15 2024].0316, 0.2651: GTiff: Opened 279x225 overview.
> [Fri Sep 13 18:00:15 2024].0319, 0.2654: GTiff: Opened band mask for
> 8929x7207 overview.
> [Fri Sep 13 18:00:15 2024].0322, 0.2656: GTiff: Opened band mask for
> 4464x3603 overview.
> [Fri Sep 13 18:00:15 2024].0324, 0.2658: GTiff: Opened band mask for
> 2232x1801 overview.
> [Fri Sep 13 18:00:15 2024].0326, 0.2661: GTiff: Opened band mask for
> 1116x900 overview.
> [Fri Sep 13 18:00:15 2024].0329, 0.2663: GTiff: Opened band mask for
> 558x450 overview.
> [Fri Sep 13 18:00:15 2024].0331, 0.2665: GTiff: Opened band mask for
> 279x225 overview.
> [Fri Sep 13 18:00:15 2024].0334, 0.2669: GDAL:
> GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x560e4cd84920)
> ERROR: Status 2: File
> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
> could not be found
> [Fri Sep 13 18:00:15 2024].0357, 0.2691: S3: Downloading 0-16383 (
> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> [Fri Sep 13 18:00:15 2024].0762, 0.3096: S3: Got response_code=206
> [Fri Sep 13 18:00:15 2024].0762, 0.3097: S3: GetFileSize(
> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>  response_code=206
> [Fri Sep 13 18:00:15 2024].0765, 0.3099: GDAL:
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x560e4d0afb70) succeeds as GTiff.
> GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].0956, 0.3291: GDAL: Computing
> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
> [Fri Sep 13 18:00:15 2024].0958, 0.3293: GTiff: ScanDirectories()
> [Fri Sep 13 18:00:15 2024].0959, 0.3294: GTiff: Opened band mask.
> [Fri Sep 13 18:00:15 2024].0961, 0.3295: GTiff: Opened 8929x7207 overview.
> [Fri Sep 13 18:00:15 2024].0962, 0.3296: GTiff: Opened 4464x3603 overview.
> [Fri Sep 13 18:00:15 2024].0962, 0.3297: GTiff: Opened 2232x1801 overview.
> [Fri Sep 13 18:00:15 2024].0963, 0.3298: GTiff: Opened 1116x900 overview.
> [Fri Sep 13 18:00:15 2024].0964, 0.3299: GTiff: Opened 558x450 overview.
> [Fri Sep 13 18:00:15 2024].0965, 0.3300: GTiff: Opened 279x225 overview.
> [Fri Sep 13 18:00:15 2024].0966, 0.3301: GTiff: Opened band mask for
> 8929x7207 overview.
> [Fri Sep 13 18:00:15 2024].0967, 0.3302: GTiff: Opened band mask for
> 4464x3603 overview.
> [Fri Sep 13 18:00:15 2024].0968, 0.3303: GTiff: Opened band mask for
> 2232x1801 overview.
> [Fri Sep 13 18:00:15 2024].0969, 0.3303: GTiff: Opened band mask for
> 1116x900 overview.
> [Fri Sep 13 18:00:15 2024].0970, 0.3304: GTiff: Opened band mask for
> 558x450 overview.
> [Fri Sep 13 18:00:15 2024].0971, 0.3305: GTiff: Opened band mask for
> 279x225 overview.
> [Fri Sep 13 18:00:15 2024].2011, 0.4346: GDAL:
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x7f0dfc08dfd0) succeeds as GTiff.
> GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].2120, 0.4454: GDAL: Computing
> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
> [Fri Sep 13 18:00:15 2024].2121, 0.4456: GTiff: ScanDirectories()
> [Fri Sep 13 18:00:15 2024].2122, 0.4457: GTiff: Opened band mask.
> [Fri Sep 13 18:00:15 2024].2123, 0.4457: GTiff: Opened 8929x7207 overview.
> [Fri Sep 13 18:00:15 2024].2123, 0.4458: GTiff: Opened 4464x3603 overview.
> [Fri Sep 13 18:00:15 2024].2124, 0.4459: GTiff: Opened 2232x1801 overview.
> [Fri Sep 13 18:00:15 2024].2125, 0.4459: GTiff: Opened 1116x900 overview.
> [Fri Sep 13 18:00:15 2024].2125, 0.4460: GTiff: Opened 558x450 overview.
> [Fri Sep 13 18:00:15 2024].2126, 0.4460: GTiff: Opened 279x225 overview.
> [Fri Sep 13 18:00:15 2024].2126, 0.4461: GTiff: Opened band mask for
> 8929x7207 overview.
> [Fri Sep 13 18:00:15 2024].2127, 0.4462: GTiff: Opened band mask for
> 4464x3603 overview.
> [Fri Sep 13 18:00:15 2024].2128, 0.4462: GTiff: Opened band mask for
> 2232x1801 overview.
> [Fri Sep 13 18:00:15 2024].2128, 0.4463: GTiff: Opened band mask for
> 1116x900 overview.
> [Fri Sep 13 18:00:15 2024].2129, 0.4463: GTiff: Opened band mask for
> 558x450 overview.
> [Fri Sep 13 18:00:15 2024].2129, 0.4464: GTiff: Opened band mask for
> 279x225 overview.
> [Fri Sep 13 18:00:15 2024].2130, 0.4465: S3: Downloading 16384-32767 (
> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> [Fri Sep 13 18:00:15 2024].3454, 0.5789: S3: Got response_code=206
> [Fri Sep 13 18:00:15 2024].3456, 0.5791: S3: Downloading 180224-589823 (
> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
> ..
> [Fri Sep 13 18:00:15 2024].4272, 0.6606: S3: Got response_code=206
> [Fri Sep 13 18:00:15 2024].4276, 0.6610: GDAL: GDAL_CACHEMAX = 1591 MB
>
> What can it be?
>
> BTW, in both cases it says
> ERROR: Status 2: File
> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
> could not be found
> And later it opens it. I don't know why.
>
> Thank you very much
> Javier.
>
> On Mon, 9 Sept 2024 at 23:49, Mayer, David P <dpmayer at usgs.gov> wrote:
>
>> Would ~200 GB be large enough?
>>
>> Here is a mosaic of a section of Mars at 6 meters/pixel in a public S3
>> bucket:
>>
>> s3://asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif
>>
>> Cheers,
>> David
>>
>> -----------
>> David Mayer
>> Geographer
>> Astrogeology Science Center
>> US Geological Survey
>> dpmayer at usgs.gov
>> ------------------------------
>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Javier
>> Jimenez Shaw via gdal-dev <gdal-dev at lists.osgeo.org>
>> *Sent:* Monday, September 9, 2024 13:55
>> *To:* gdal dev <gdal-dev at lists.osgeo.org>
>> *Subject:* [EXTERNAL] [gdal-dev] s3 request example
>>
>>
>>
>>
>> * This email has been received from outside of DOI - Use caution before
>> clicking on links, opening attachments, or responding.  *
>>
>>
>>
>> Hi
>>
>> I am experiencing a much slower load of a remote COG using vsis3 with the
>> QGIS from conda than the QGIS in my Ubuntu (that uses GDAL 3.4.1).
>>
>> Because both are QGIS 3.38, I think the problem is in the version of GDAL.
>> I would like to research it more.
>>
>> Is there any example of a (big) COG file in Amazon S3 I can use to
>> compare them? Unfortunately the credentials for the files I am using expire
>> after a few hours, so they are useless to report anything.
>>
>> Best regards,
>> Javier
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/8c956119/attachment-0001.htm>

From thomas.bonfort at gmail.com  Fri Sep 13 09:30:31 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Fri, 13 Sep 2024 18:30:31 +0200
Subject: [gdal-dev] [EXTERNAL] s3 request example
In-Reply-To: <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
 <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
Message-ID: <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>

I also see that you have a tiledb driver registration happening only on
your conda version, exactly at the time of your lag. you should also try to
remove/rename your gdal_tiledb.so plugin file to check the issue isn't
coming from there.

Le ven. 13 sept. 2024, 18:22, thomas bonfort <thomas.bonfort at gmail.com> a
?crit :

> Javier,
> 3.9 is probably doing parallel reads, which will cause a noticeable lag in
> requests on a slow connection (the overall processing time should not be
> slower anyhow). There's a gtiff open option documented that can disable
> this behavior, that you can try to use to see if it changes your timings.
> If that is the effective cause, that would mean there is an issue with this
> parallel implementation.
> TB
>
> Le ven. 13 sept. 2024, 18:15, Javier Jimenez Shaw via gdal-dev <
> gdal-dev at lists.osgeo.org> a ?crit :
>
>> Thanks David for the suggestion. Very interesting data.
>>
>> Unfortunately the issue I have is not reproduced with that file. So it
>> may be due to the authentication (your suggestion does not need
>> authentication).
>>
>> Some context: I am opening a COG file from S3 in QGIS, setting the url in
>> the command line. Something like
>> qgis /vsis3/blahblabla
>>
>> (more on that later)
>>
>> If I run it in my Ubuntu 22.04 (that has GDAL 3.4.1), with QGIS 3.38, no
>> problem
>> If I run with conda with QGIS 3.38 (that has GDAL 3.9.1), it is
>> noticeable slower.
>>
>> So I think it is due to the version of GDAL. If you think that I am wrong
>> and I should ask directly to QGIS, it is ok.
>>
>> This is a bit problematic to reproduce because the authorization expires
>> in 12 hours. So I post here the command I produced with a python script. If
>> it is needed, I can share the python script that is  getting the
>> authentication. It is about 100 lines of code.
>>
>> Enabling the logs I see there a gap of 6 seconds during the opening with
>> conda, that is not there with the QGIS from Ubuntu that uses GDAL 3.4.1
>>
>> This is the log from conda
>> The gap is between
>> Fri Sep 13 17:56:26 2024].9370
>> and
>> [Fri Sep 13 17:56:33 2024].4445
>>
>> CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py --project-id 1969386
>> --share-token 09c3eada-1b3b-46eb-b5de-8bd51635a5b9
>> Session expires at 2024-09-14T03:56:22Z
>> AWS_ACCESS_KEY_ID=ASIATOCJLBKS2RHGCAHB
>> AWS_SECRET_ACCESS_KEY=nNT8fTH/cGiyn4NVubp5/1LroyZ69johhXYxkCK1
>> AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDI1G/49ov88aGibrOCLXAilDbBuFQ/ydJF4AZ50/lYmWYmNDjM9H7XbbioyXiLQzwTqVRN1TLG6T29Anklkw47MKxdKHDF/O85r9gWJmCAqYTKalA38VM1qbixsjSXAzR7W5p1v1pgRUKtN4J03NrZOH2S6gbo4OKv+UUkPe/Xq4s8w0vEVNJLhvVx6dvpJMv7Jp9UxvLA5a+nrBKUqJujujqJnRXAKKfnpJbTDvhCuIeTxaFFt50e5UpLjSwqXS/a/AaEMJXRSsSLbKFTW/ALSCHfPv3HCStnue5CFpzVk4OhQbQ+dZyXUQp5wxQTtpr0hIh0IyB20gsoZNa0lGvFuXnzqDCH2X2mXwzDcyZk2IOX34nq+Wtnk8qYdjJxEAG0tnlYsMjmmXECnbOxl6gtNJ5hoehgak6cSfs7/rMi4jOI838tzsWWyDJeACj9qfQyfGtpk23x8Zt6KuqUjNZ1/z+/T8LwoopsGRtwYyKQbJS8pn8IGKPLtHDVxRx09yBRuqgYVFzSqpnr3T1vwWYHXiEF0sVJBx
>> GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR
>> /home/jshaw/anaconda3/envs/qgis_stable/bin/qgis
>> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>> [Fri Sep 13 17:56:26 2024].3948, 0.0000: HTTP: libcurl/8.9.0
>> OpenSSL/3.3.1 zlib/1.3.1 zstd/1.5.6 libssh2/1.11.0 nghttp2/1.58.0
>> [Fri Sep 13 17:56:26 2024].7731, 0.3783: S3: Switching to endpoint
>> s3.eu-central-1.amazonaws.com
>> [Fri Sep 13 17:56:26 2024].8415, 0.4467: S3: Switching to region
>> eu-central-1
>> [Fri Sep 13 17:56:26 2024].9230, 0.5282: S3: GetFileSize(
>> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>>  response_code=206
>> [Fri Sep 13 17:56:26 2024].9235, 0.5288: GDAL:
>> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x556e6bb915a0) succeeds as GTiff.
>> [Fri Sep 13 17:56:26 2024].9240, 0.5292: GTiff: ScanDirectories()
>> [Fri Sep 13 17:56:26 2024].9243, 0.5296: GTiff: Opened band mask.
>> [Fri Sep 13 17:56:26 2024].9246, 0.5298: GTiff: Opened 8929x7207 overview.
>> [Fri Sep 13 17:56:26 2024].9249, 0.5301: GTiff: Opened 4464x3603 overview.
>> [Fri Sep 13 17:56:26 2024].9251, 0.5304: GTiff: Opened 2232x1801 overview.
>> [Fri Sep 13 17:56:26 2024].9254, 0.5306: GTiff: Opened 1116x900 overview.
>> [Fri Sep 13 17:56:26 2024].9257, 0.5309: GTiff: Opened 558x450 overview.
>> [Fri Sep 13 17:56:26 2024].9259, 0.5311: GTiff: Opened 279x225 overview.
>> [Fri Sep 13 17:56:26 2024].9262, 0.5314: GTiff: Opened band mask for
>> 8929x7207 overview.
>> [Fri Sep 13 17:56:26 2024].9264, 0.5316: GTiff: Opened band mask for
>> 4464x3603 overview.
>> [Fri Sep 13 17:56:26 2024].9267, 0.5319: GTiff: Opened band mask for
>> 2232x1801 overview.
>> [Fri Sep 13 17:56:26 2024].9269, 0.5321: GTiff: Opened band mask for
>> 1116x900 overview.
>> [Fri Sep 13 17:56:26 2024].9272, 0.5324: GTiff: Opened band mask for
>> 558x450 overview.
>> [Fri Sep 13 17:56:26 2024].9274, 0.5326: GTiff: Opened band mask for
>> 279x225 overview.
>> [Fri Sep 13 17:56:26 2024].9277, 0.5329: GDAL:
>> GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x556e6bb915a0)
>> ERROR: Status 2: File
>> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>> could not be found
>> [Fri Sep 13 17:56:26 2024].9370, 0.5422: GDAL: On-demand registering
>> /home/jshaw/anaconda3/envs/qgis_stable/lib/gdalplugins/gdal_TileDB.so using
>> GDALRegister_TileDB.
>> [Fri Sep 13 17:56:33 2024].4445, 7.0498: S3: GetFileSize(
>> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>>  response_code=206
>> [Fri Sep 13 17:56:33 2024].4449, 7.0501: GDAL:
>> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x556e6b807d00) succeeds as GTiff.
>> GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4666, 7.0718: OGRCT: Using
>> WebMercator to WGS84 optimization
>> GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4667, 7.0719: GDAL: Computing
>> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>> [Fri Sep 13 17:56:33 2024].4667, 7.0719: GTiff: ScanDirectories()
>> [Fri Sep 13 17:56:33 2024].4669, 7.0721: GTiff: Opened band mask.
>> [Fri Sep 13 17:56:33 2024].4670, 7.0722: GTiff: Opened 8929x7207 overview.
>> [Fri Sep 13 17:56:33 2024].4671, 7.0723: GTiff: Opened 4464x3603 overview.
>> [Fri Sep 13 17:56:33 2024].4672, 7.0724: GTiff: Opened 2232x1801 overview.
>> [Fri Sep 13 17:56:33 2024].4673, 7.0725: GTiff: Opened 1116x900 overview.
>> [Fri Sep 13 17:56:33 2024].4674, 7.0726: GTiff: Opened 558x450 overview.
>> [Fri Sep 13 17:56:33 2024].4675, 7.0727: GTiff: Opened 279x225 overview.
>> [Fri Sep 13 17:56:33 2024].4676, 7.0728: GTiff: Opened band mask for
>> 8929x7207 overview.
>> [Fri Sep 13 17:56:33 2024].4677, 7.0729: GTiff: Opened band mask for
>> 4464x3603 overview.
>> [Fri Sep 13 17:56:33 2024].4677, 7.0730: GTiff: Opened band mask for
>> 2232x1801 overview.
>> [Fri Sep 13 17:56:33 2024].4678, 7.0731: GTiff: Opened band mask for
>> 1116x900 overview.
>> [Fri Sep 13 17:56:33 2024].4679, 7.0732: GTiff: Opened band mask for
>> 558x450 overview.
>> [Fri Sep 13 17:56:33 2024].4680, 7.0733: GTiff: Opened band mask for
>> 279x225 overview.
>> [Fri Sep 13 17:56:33 2024].5178, 7.1230: GDAL:
>> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x7f830c08d490) succeeds as GTiff.
>> [Fri Sep 13 17:56:33 2024].5180, 7.1232: S3: Downloading
>> 59179008-59244543 (
>> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].5244, 7.1296: GDAL: Computing
>> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>> [Fri Sep 13 17:56:33 2024].5245, 7.1297: GTiff: ScanDirectories()
>> [Fri Sep 13 17:56:33 2024].5246, 7.1298: GTiff: Opened band mask.
>> [Fri Sep 13 17:56:33 2024].5247, 7.1299: GTiff: Opened 8929x7207 overview.
>> [Fri Sep 13 17:56:33 2024].5247, 7.1300: GTiff: Opened 4464x3603 overview.
>> [Fri Sep 13 17:56:33 2024].5248, 7.1300: GTiff: Opened 2232x1801 overview.
>> [Fri Sep 13 17:56:33 2024].5249, 7.1301: GTiff: Opened 1116x900 overview.
>> [Fri Sep 13 17:56:33 2024].5249, 7.1302: GTiff: Opened 558x450 overview.
>> [Fri Sep 13 17:56:33 2024].5250, 7.1302: GTiff: Opened 279x225 overview.
>> [Fri Sep 13 17:56:33 2024].5251, 7.1303: GTiff: Opened band mask for
>> 8929x7207 overview.
>> [Fri Sep 13 17:56:33 2024].5251, 7.1304: GTiff: Opened band mask for
>> 4464x3603 overview.
>> [Fri Sep 13 17:56:33 2024].5252, 7.1304: GTiff: Opened band mask for
>> 2232x1801 overview.
>> [Fri Sep 13 17:56:33 2024].5253, 7.1305: GTiff: Opened band mask for
>> 1116x900 overview.
>> [Fri Sep 13 17:56:33 2024].5253, 7.1306: GTiff: Opened band mask for
>> 558x450 overview.
>> [Fri Sep 13 17:56:33 2024].5254, 7.1306: GTiff: Opened band mask for
>> 279x225 overview.
>> [Fri Sep 13 17:56:33 2024].5255, 7.1307: GDAL: Selecting overview 1116 x
>> 900
>> [Fri Sep 13 17:56:33 2024].5255, 7.1307: S3: Downloading 16384-32767 (
>> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> [Fri Sep 13 17:56:33 2024].6116, 7.2168: S3: Got response_code=206
>> [Fri Sep 13 17:56:33 2024].6118, 7.2171: S3: Downloading 180224-589823 (
>> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> [Fri Sep 13 17:56:33 2024].6955, 7.3008: S3: Got response_code=206
>> [Fri Sep 13 17:56:33 2024].6960, 7.3012: GDAL: GDAL_CACHEMAX = 1591 MB
>> [Fri Sep 13 17:56:33 2024].6977, 7.3029: S3: Got response_code=206
>>
>>
>> This is the equivalent code with QGIS 3.38 in Ubuntu and GDAL 3.4.1
>>
>> CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py --project-id 1969386
>> --share-token 09c3eada-1b3b-46eb-b5de-8bd51635a5b9
>> Session expires at 2024-09-14T04:00:10Z
>> AWS_ACCESS_KEY_ID=ASIATOCJLBKSRCEUBKE6
>> AWS_SECRET_ACCESS_KEY=h6NhBf9VwBZoVj5Zd/8H2BnzXQu0l6bFUUv2D8E7
>> AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDF1xO50XL6GBe/358CLXAn3JR/uteJtarwJ/ryn6i4+lcMFEQZ/KV0FZQdKsD1PwAcqoYFY+0GKYSV+FTk81ZszsVzy8N7d2GwByvP9S/L1XOo1FrqJfDpGw3a5eQR7AoeU68EPlD/WTYnM7XBzXimHywDCyue3SOi8oZaSdbMgjBQ1N6j+qQ+EDN7RjD/Zu2CGMTzN9g/Z0FhZsuyt2HRhnOYpsvpUMZ+WQr7pbjdVdwt3PdFHsJ95fhueapJspgQ7OSgmj5VtSR8NTecohLsd2eeGkSpiqVWuBwuAu2cW6LcqmAZGnF0DZIjPWiMIDf/OLczMRCw5MJGeYpsSkkiuM+t9Miv8aN4iCo8vjl6wumOCgPqTgBBWlQdAs2mLxwpF1Bb1UjJ6eiccp17+yJF3ffn8tvxx/+1V3Q++E5Xk+jiB1keJnFcizr7qD6EY+EdDES5sQrWAhM2uR78JjNc0f+hVZEmAoisORtwYyKb0po07ytiiBv+X3j+Y6BsCHR0Es3C3xVvsgkfn1zb1Z2flFWUzwqJUD
>> GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR /usr/bin/qgis
>> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>> [Fri Sep 13 18:00:14 2024].7665, 0.0000: HTTP: libcurl/7.81.0
>> OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 libidn2/2.3.2
>> libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib nghttp2/1.43.0
>> librtmp/2.3 OpenLDAP/2.5.18
>> [Fri Sep 13 18:00:14 2024].7666, 0.0001: S3: Downloading 0-16383 (
>> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> [Fri Sep 13 18:00:14 2024].8897, 0.1231: S3: Got response_code=400
>> [Fri Sep 13 18:00:14 2024].8898, 0.1232: S3: Switching to region
>> eu-central-1
>> [Fri Sep 13 18:00:14 2024].8899, 0.1234: S3: Downloading 0-16383 (
>> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> [Fri Sep 13 18:00:15 2024].0287, 0.2621: S3: Got response_code=206
>> [Fri Sep 13 18:00:15 2024].0288, 0.2622: S3: GetFileSize(
>> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>>  response_code=206
>> [Fri Sep 13 18:00:15 2024].0292, 0.2627: GDAL:
>> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x560e4cd84920) succeeds as GTiff.
>> [Fri Sep 13 18:00:15 2024].0298, 0.2632: GTiff: ScanDirectories()
>> [Fri Sep 13 18:00:15 2024].0301, 0.2635: GTiff: Opened band mask.
>> [Fri Sep 13 18:00:15 2024].0304, 0.2638: GTiff: Opened 8929x7207 overview.
>> [Fri Sep 13 18:00:15 2024].0306, 0.2641: GTiff: Opened 4464x3603 overview.
>> [Fri Sep 13 18:00:15 2024].0309, 0.2643: GTiff: Opened 2232x1801 overview.
>> [Fri Sep 13 18:00:15 2024].0311, 0.2646: GTiff: Opened 1116x900 overview.
>> [Fri Sep 13 18:00:15 2024].0314, 0.2648: GTiff: Opened 558x450 overview.
>> [Fri Sep 13 18:00:15 2024].0316, 0.2651: GTiff: Opened 279x225 overview.
>> [Fri Sep 13 18:00:15 2024].0319, 0.2654: GTiff: Opened band mask for
>> 8929x7207 overview.
>> [Fri Sep 13 18:00:15 2024].0322, 0.2656: GTiff: Opened band mask for
>> 4464x3603 overview.
>> [Fri Sep 13 18:00:15 2024].0324, 0.2658: GTiff: Opened band mask for
>> 2232x1801 overview.
>> [Fri Sep 13 18:00:15 2024].0326, 0.2661: GTiff: Opened band mask for
>> 1116x900 overview.
>> [Fri Sep 13 18:00:15 2024].0329, 0.2663: GTiff: Opened band mask for
>> 558x450 overview.
>> [Fri Sep 13 18:00:15 2024].0331, 0.2665: GTiff: Opened band mask for
>> 279x225 overview.
>> [Fri Sep 13 18:00:15 2024].0334, 0.2669: GDAL:
>> GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x560e4cd84920)
>> ERROR: Status 2: File
>> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>> could not be found
>> [Fri Sep 13 18:00:15 2024].0357, 0.2691: S3: Downloading 0-16383 (
>> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> [Fri Sep 13 18:00:15 2024].0762, 0.3096: S3: Got response_code=206
>> [Fri Sep 13 18:00:15 2024].0762, 0.3097: S3: GetFileSize(
>> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>>  response_code=206
>> [Fri Sep 13 18:00:15 2024].0765, 0.3099: GDAL:
>> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x560e4d0afb70) succeeds as GTiff.
>> GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].0956, 0.3291: GDAL: Computing
>> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>> [Fri Sep 13 18:00:15 2024].0958, 0.3293: GTiff: ScanDirectories()
>> [Fri Sep 13 18:00:15 2024].0959, 0.3294: GTiff: Opened band mask.
>> [Fri Sep 13 18:00:15 2024].0961, 0.3295: GTiff: Opened 8929x7207 overview.
>> [Fri Sep 13 18:00:15 2024].0962, 0.3296: GTiff: Opened 4464x3603 overview.
>> [Fri Sep 13 18:00:15 2024].0962, 0.3297: GTiff: Opened 2232x1801 overview.
>> [Fri Sep 13 18:00:15 2024].0963, 0.3298: GTiff: Opened 1116x900 overview.
>> [Fri Sep 13 18:00:15 2024].0964, 0.3299: GTiff: Opened 558x450 overview.
>> [Fri Sep 13 18:00:15 2024].0965, 0.3300: GTiff: Opened 279x225 overview.
>> [Fri Sep 13 18:00:15 2024].0966, 0.3301: GTiff: Opened band mask for
>> 8929x7207 overview.
>> [Fri Sep 13 18:00:15 2024].0967, 0.3302: GTiff: Opened band mask for
>> 4464x3603 overview.
>> [Fri Sep 13 18:00:15 2024].0968, 0.3303: GTiff: Opened band mask for
>> 2232x1801 overview.
>> [Fri Sep 13 18:00:15 2024].0969, 0.3303: GTiff: Opened band mask for
>> 1116x900 overview.
>> [Fri Sep 13 18:00:15 2024].0970, 0.3304: GTiff: Opened band mask for
>> 558x450 overview.
>> [Fri Sep 13 18:00:15 2024].0971, 0.3305: GTiff: Opened band mask for
>> 279x225 overview.
>> [Fri Sep 13 18:00:15 2024].2011, 0.4346: GDAL:
>> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>> this=0x7f0dfc08dfd0) succeeds as GTiff.
>> GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].2120, 0.4454: GDAL: Computing
>> area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>> [Fri Sep 13 18:00:15 2024].2121, 0.4456: GTiff: ScanDirectories()
>> [Fri Sep 13 18:00:15 2024].2122, 0.4457: GTiff: Opened band mask.
>> [Fri Sep 13 18:00:15 2024].2123, 0.4457: GTiff: Opened 8929x7207 overview.
>> [Fri Sep 13 18:00:15 2024].2123, 0.4458: GTiff: Opened 4464x3603 overview.
>> [Fri Sep 13 18:00:15 2024].2124, 0.4459: GTiff: Opened 2232x1801 overview.
>> [Fri Sep 13 18:00:15 2024].2125, 0.4459: GTiff: Opened 1116x900 overview.
>> [Fri Sep 13 18:00:15 2024].2125, 0.4460: GTiff: Opened 558x450 overview.
>> [Fri Sep 13 18:00:15 2024].2126, 0.4460: GTiff: Opened 279x225 overview.
>> [Fri Sep 13 18:00:15 2024].2126, 0.4461: GTiff: Opened band mask for
>> 8929x7207 overview.
>> [Fri Sep 13 18:00:15 2024].2127, 0.4462: GTiff: Opened band mask for
>> 4464x3603 overview.
>> [Fri Sep 13 18:00:15 2024].2128, 0.4462: GTiff: Opened band mask for
>> 2232x1801 overview.
>> [Fri Sep 13 18:00:15 2024].2128, 0.4463: GTiff: Opened band mask for
>> 1116x900 overview.
>> [Fri Sep 13 18:00:15 2024].2129, 0.4463: GTiff: Opened band mask for
>> 558x450 overview.
>> [Fri Sep 13 18:00:15 2024].2129, 0.4464: GTiff: Opened band mask for
>> 279x225 overview.
>> [Fri Sep 13 18:00:15 2024].2130, 0.4465: S3: Downloading 16384-32767 (
>> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> [Fri Sep 13 18:00:15 2024].3454, 0.5789: S3: Got response_code=206
>> [Fri Sep 13 18:00:15 2024].3456, 0.5791: S3: Downloading 180224-589823 (
>> https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff).
>> ..
>> [Fri Sep 13 18:00:15 2024].4272, 0.6606: S3: Got response_code=206
>> [Fri Sep 13 18:00:15 2024].4276, 0.6610: GDAL: GDAL_CACHEMAX = 1591 MB
>>
>> What can it be?
>>
>> BTW, in both cases it says
>> ERROR: Status 2: File
>> /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>> could not be found
>> And later it opens it. I don't know why.
>>
>> Thank you very much
>> Javier.
>>
>> On Mon, 9 Sept 2024 at 23:49, Mayer, David P <dpmayer at usgs.gov> wrote:
>>
>>> Would ~200 GB be large enough?
>>>
>>> Here is a mosaic of a section of Mars at 6 meters/pixel in a public S3
>>> bucket:
>>>
>>> s3://asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif
>>>
>>> Cheers,
>>> David
>>>
>>> -----------
>>> David Mayer
>>> Geographer
>>> Astrogeology Science Center
>>> US Geological Survey
>>> dpmayer at usgs.gov
>>> ------------------------------
>>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Javier
>>> Jimenez Shaw via gdal-dev <gdal-dev at lists.osgeo.org>
>>> *Sent:* Monday, September 9, 2024 13:55
>>> *To:* gdal dev <gdal-dev at lists.osgeo.org>
>>> *Subject:* [EXTERNAL] [gdal-dev] s3 request example
>>>
>>>
>>>
>>>
>>> * This email has been received from outside of DOI - Use caution before
>>> clicking on links, opening attachments, or responding.  *
>>>
>>>
>>>
>>> Hi
>>>
>>> I am experiencing a much slower load of a remote COG using vsis3 with
>>> the QGIS from conda than the QGIS in my Ubuntu (that uses GDAL 3.4.1).
>>>
>>> Because both are QGIS 3.38, I think the problem is in the version of
>>> GDAL.
>>> I would like to research it more.
>>>
>>> Is there any example of a (big) COG file in Amazon S3 I can use to
>>> compare them? Unfortunately the credentials for the files I am using expire
>>> after a few hours, so they are useless to report anything.
>>>
>>> Best regards,
>>> Javier
>>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/1692395a/attachment-0001.htm>

From j1 at jimenezshaw.com  Fri Sep 13 10:16:54 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Fri, 13 Sep 2024 19:16:54 +0200
Subject: [gdal-dev] [EXTERNAL] s3 request example
In-Reply-To: <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
 <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
 <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
Message-ID: <CADRrdKty7QzuJRays6juPtvXiALK_iM3MFc4ojd1RRCLcJ=EhA@mail.gmail.com>

This is getting even weirder. I tried removing gdal_TileDB.so before my
first email, and it didn't work.
However, now it works... but only if I opened the file before. If I wait a
couple of minutes, then it still waits 5 or 6 seconds. Is there any cache
somewhere? (I am closing QGIS, so it should not be in the memory of QGIS)

[Fri Sep 13 18:44:11 2024].3102, 0.0000: GDAL: Proxy driver TileDB *not*
registered due to gdal_TileDB.so not being found
[Fri Sep 13 18:44:12 2024].3429, 1.0326: GDAL: Proxy driver TileDB *not*
registered due to gdal_TileDB.so not being found
[Fri Sep 13 18:44:12 2024].8555, 1.5452: GDAL: Proxy driver TileDB *not*
registered due to gdal_TileDB.so not being found
[Fri Sep 13 18:44:13 2024].9017, 2.5915: HTTP: libcurl/8.9.0 OpenSSL/3.3.1
zlib/1.3.1 zstd/1.5.6 libssh2/1.11.0 nghttp2/1.58.0
[Fri Sep 13 18:44:14 2024].2537, 2.9434: S3: Switching to endpoint
s3.eu-central-1.amazonaws.com
[Fri Sep 13 18:44:19 2024].3471, 8.0369: S3: Switching to region
eu-central-1
[Fri Sep 13 18:44:19 2024].4582, 8.1480: S3: GetFileSize(
https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
 response_code=206
[Fri Sep 13 18:44:19 2024].4587, 8.1485: GDAL:
GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
this=0x56258e57eef0) succeeds as GTiff.
[Fri Sep 13 18:44:19 2024].4593, 8.1490: GTiff: ScanDirectories()
[Fri Sep 13 18:44:19 2024].4596, 8.1494: GTiff: Opened band mask.

Another question that pops up is... why is it loading TileDB there? it is
not doing it if I just open QGIS. Is it needed for the COG?

If I open the file David suggested
AWS_NO_SIGN_REQUEST=YES CPL_DEBUG=ON CPL_TIMESTAMP=ON qgis
/vsis3/asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif
It does not mention TileDB in the logs. Neither if I load the same COG file
from the hard drive.

If TileDB is loaded dynamically and it is the reason of the delay (that I
am not sure), is there a way to disable that load? Kind of a config
environment variable. I do not want to move the library every time (and it
checks for the library 3 times, that is a delay of 3 seconds every time, as
you can see in the logs above)

PS My connection is 250 Mbps. I don't think it is a "slow" connection


On Fri, 13 Sept 2024 at 18:30, thomas bonfort <thomas.bonfort at gmail.com>
wrote:

> I also see that you have a tiledb driver registration happening only on
> your conda version, exactly at the time of your lag. you should also try to
> remove/rename your gdal_tiledb.so plugin file to check the issue isn't
> coming from there.
>
> Le ven. 13 sept. 2024, 18:22, thomas bonfort <thomas.bonfort at gmail.com> a
> ?crit :
>
>> Javier,
>> 3.9 is probably doing parallel reads, which will cause a noticeable lag
>> in requests on a slow connection (the overall processing time should not be
>> slower anyhow). There's a gtiff open option documented that can disable
>> this behavior, that you can try to use to see if it changes your timings.
>> If that is the effective cause, that would mean there is an issue with this
>> parallel implementation.
>> TB
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/97f35e8c/attachment.htm>

From even.rouault at spatialys.com  Fri Sep 13 10:22:54 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 13 Sep 2024 19:22:54 +0200
Subject: [gdal-dev] (TileDB related question for you Norman/Sean) Re:
 [EXTERNAL] s3 request example
In-Reply-To: <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
 <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
 <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
Message-ID: <28efa708-78d7-45d9-bf8c-52a70947b3f4@spatialys.com>

I've given this a try with my QGIS dev env and I can also reproduce, and 
specifically with the TileDB driver available

The stacktrace is as following:

Thread 1 "qgis" received signal SIGINT, Interrupt.
0x00007f81cc566bcf in __GI___poll (fds=0x7fffc613b040, nfds=2, 
timeout=800) at ../sysdeps/unix/sysv/linux/poll.c:29
29??? ../sysdeps/unix/sysv/linux/poll.c: No such file or directory.
(gdb) bt
#0? 0x00007f81cc566bcf in __GI___poll (fds=0x7fffc613b040, nfds=2, 
timeout=800) at ../sysdeps/unix/sysv/linux/poll.c:29
#1? 0x00007f809b5fa76a in Curl_poll () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#2? 0x00007f809b5f3684 in Curl_multi_wait.part.0 () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#3? 0x00007f809b5f3c06 in curl_multi_poll () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#4? 0x00007f809b5dfbb0 in curl_easy_perform () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#5? 0x00007f809b3d822f in 
Aws::Http::CurlHttpClient::MakeRequest(std::shared_ptr<Aws::Http::HttpRequest> 
const&, Aws::Utils::RateLimits::RateLimiterInterface*, 
Aws::Utils::RateLimits::RateLimiterInterface*) const () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#6? 0x00007f809b3b0788 in 
Aws::Internal::AWSHttpResourceClient::GetResourceWithAWSWebServiceResult(std::shared_ptr<Aws::Http::HttpRequest> 
const&) const ()
 ??? at /home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#7? 0x00007f809b39c627 in 
Aws::Internal::EC2MetadataClient::GetCurrentRegion() const () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#8? 0x00007f809b3a2b8b in 
Aws::Client::ClientConfiguration::ClientConfiguration() () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#9? 0x00007f809aae98dd in Aws::Client::ClientConfiguration* 
tiledb::common::tiledb_new<Aws::Client::ClientConfiguration>(std::string 
const&) () at /home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#10 0x00007f809aace812 in tiledb::sm::S3::init_client() const () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#11 0x00007f809aad3d98 in tiledb::sm::S3::is_dir(tiledb::sm::URI const&, 
bool*) const () at /home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#12 0x00007f809aaf745d in tiledb::sm::VFS::is_dir(tiledb::sm::URI 
const&, bool*) const () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#13 0x00007f809b14cf86 in 
tiledb::sm::StorageManagerCanonical::is_array(tiledb::sm::URI const&) 
const () at /home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#14 0x00007f809b14d1c7 in 
tiledb::sm::StorageManagerCanonical::object_type(tiledb::sm::URI const&, 
tiledb::sm::ObjectType*) const () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#15 0x00007f809a9eb479 in tiledb_object_type () at 
/home/even/tiledb/tiledb-2.15.2/lib/libtiledb.so.2.15
#16 0x00007f80a1a16882 in tiledb::Object::object(tiledb::Context const&, 
std::__cxx11::basic_string<char, std::char_traits<char>, 
std::allocator<char> > const&)
 ??? (ctx=..., 
uri="s3://prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff") 
at /home/even/tiledb/tiledb-2.15.2/include/tiledb/object.h:175
#17 0x00007f80a1a1368b in TileDBDataset::Identify(GDALOpenInfo*) 
(poOpenInfo=0x7fffc613ca20) at 
/home/even/gdal/gdal/frmts/tiledb/tiledbcommon.cpp:157
#18 0x00007f80a1a13977 in TileDBDataset::Open(GDALOpenInfo*) 
(poOpenInfo=0x7fffc613ca20) at 
/home/even/gdal/gdal/frmts/tiledb/tiledbcommon.cpp:208
#19 0x00007f81d0430525 in GDALDriver::Open(GDALOpenInfo*, bool) 
(this=0x562cf5138f90, poOpenInfo=0x7fffc613ca20, bSetOpenOptions=false) 
at /home/even/gdal/gdal/gcore/gdaldriver.cpp:117
#20 0x00007f81d044a450 in GDALOpenEx(char const*, unsigned int, char 
const* const*, char const* const*, char const* const*)
 ??? (pszFilename=0x562cf8e7e378 
"/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff", 
nOpenFlags=4, papszAllowedDrivers=0x0, papszOpenOptions=0x562cfb256920, 
papszSiblingFiles=0x0) at /home/even/gdal/gdal/gcore/gdaldataset.cpp:3774
#21 0x00007f81d6b48489 in QgsOgrProviderUtils::GDALOpenWrapper(char 
const*, bool, char**, void**)
 ??? (pszPath=0x562cf8e7e378 
"/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff", 
bUpdate=false, papszOpenOptionsIn=0x562cfb2533f0, phDriver=0x0) at 
/home/even/qgis/qgis/src/core/providers/ogr/qgsogrproviderutils.cpp:1067
#22 0x00007f81d6b4ab7c in OpenHelper(QString const&, bool, QStringList 
const&) (dsName=..., updateMode=false, options=...) at 
/home/even/qgis/qgis/src/core/providers/ogr/qgsogrproviderutils.cpp:1460
#23 0x00007f81d6b4b861 in QgsOgrProviderUtils::getLayer(QString const&, 
bool, QStringList const&, int, QString&, bool)
 ??? (dsName=..., updateMode=false, options=..., layerIndex=0, 
errCause=..., checkModificationDateAgainstCache=true) at 
/home/even/qgis/qgis/src/core/providers/ogr/qgsogrproviderutils.cpp:1603
#24 0x00007f81d6b31f80 in QgsOgrProviderMetadata::querySublayers(QString 
const&, QFlags<Qgis::SublayerQueryFlag>, QgsFeedback*) const 
(this=0x562cf50d8150, u=..., flags=..., feedback=0x0)
 ??? at 
/home/even/qgis/qgis/src/core/providers/ogr/qgsogrprovidermetadata.cpp:970
#25 0x00007f81d6a471d7 in QgsProviderRegistry::querySublayers(QString 
const&, QFlags<Qgis::SublayerQueryFlag>, QgsFeedback*) const 
(this=0x562cf50d31e0, uri=..., flags=..., feedback=0x0)
 ??? at /home/even/qgis/qgis/src/core/providers/qgsproviderregistry.cpp:1114
#26 0x00007f81de8ebeed in QgsAppLayerHandling::openLayer(QString const&, 
bool&, bool, bool, bool)
 ??? (fileName=..., ok=@0x7fffc613d760: false, allowInteractive=false, 
suppressBulkLayerPostProcessing=false, addToLegend=true) at 
/home/even/qgis/qgis/src/app/layers/qgsapplayerhandling.cpp:960
#27 0x0000562cf401167e in main(int, char**) (argc=2, 
argv=0x7fffc613e1c8) at /home/even/qgis/qgis/src/app/main.cpp:1596

So, to make it short, this is when QGIS tries to open the file as a 
vector one (it must tries to open both as raster and vector). And the 
TileDB driver isn't currently smart enough to immediately reject that a 
".tiff" file is not a vector TileDB dataset.? This is not a problem when 
opening as raster dataset because the GeoTIFF driver would already have 
identified the file.

@Norman: only libtiledb can effectively guess if a *directory* contains 
a TileDB dataset or not. But is a *file* a valid URI for a TileDB 
dataset? Because at the time the Identify() method of the TileDB driver 
is hit, GDAL knows already if /vsis3/something is a file or a directory, 
and thus we could immediately bail out if it is a file and a file can't 
be a TileDB dataset.

Even


Le 13/09/2024 ? 18:30, thomas bonfort via gdal-dev a ?crit?:
> I also see that you have a tiledb driver registration happening only 
> on your conda version, exactly at the time of your lag. you should 
> also try to remove/rename your gdal_tiledb.so plugin file to check the 
> issue isn't coming from there.
>
> Le ven. 13 sept. 2024, 18:22, thomas bonfort 
> <thomas.bonfort at gmail.com> a ?crit?:
>
>     Javier,
>     3.9 is probably doing parallel reads, which will cause a
>     noticeable lag in requests on a slow connection (the overall
>     processing time should not be slower anyhow). There's a gtiff open
>     option documented that can disable this behavior, that you can try
>     to use to see if it changes your timings. If that is the effective
>     cause, that would mean there is an issue with this parallel
>     implementation.
>     TB
>
>     Le ven. 13 sept. 2024, 18:15, Javier Jimenez Shaw via gdal-dev
>     <gdal-dev at lists.osgeo.org> a ?crit?:
>
>         Thanks David for the suggestion. Very interesting data.
>
>         Unfortunately the issue I have is not reproduced with that
>         file. So it may be due to the authentication (your suggestion
>         does not need authentication).
>
>         Some context: I am opening a COG file from S3 in QGIS, setting
>         the url in the command line. Something like
>         qgis /vsis3/blahblabla
>
>         (more on that later)
>
>         If I run it in my Ubuntu 22.04 (that has GDAL 3.4.1), with
>         QGIS 3.38, no problem
>         If I run with conda with QGIS 3.38 (that has GDAL 3.9.1), it
>         is noticeable slower.
>
>         So I think it is due to the version of GDAL. If you think that
>         I am wrong and I should ask directly to QGIS, it is ok.
>
>         This is a bit problematic to reproduce because the
>         authorization expires in 12 hours. So I post here the command
>         I produced with a python script. If it is needed, I can share
>         the python script that is? getting the authentication. It is
>         about 100 lines of code.
>
>         Enabling the logs I see there a gap of 6 seconds during the
>         opening with conda, that is not there with the QGIS from
>         Ubuntu that uses GDAL 3.4.1
>
>         This is the log from conda
>         The gap is between
>         Fri Sep 13 17:56:26 2024].9370
>         and
>         [Fri Sep 13 17:56:33 2024].4445
>
>         CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py
>         --project-id 1969386 --share-token
>         09c3eada-1b3b-46eb-b5de-8bd51635a5b9
>         Session expires at 2024-09-14T03:56:22Z
>         AWS_ACCESS_KEY_ID=ASIATOCJLBKS2RHGCAHB
>         AWS_SECRET_ACCESS_KEY=nNT8fTH/cGiyn4NVubp5/1LroyZ69johhXYxkCK1
>         AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDI1G/49ov88aGibrOCLXAilDbBuFQ/ydJF4AZ50/lYmWYmNDjM9H7XbbioyXiLQzwTqVRN1TLG6T29Anklkw47MKxdKHDF/O85r9gWJmCAqYTKalA38VM1qbixsjSXAzR7W5p1v1pgRUKtN4J03NrZOH2S6gbo4OKv+UUkPe/Xq4s8w0vEVNJLhvVx6dvpJMv7Jp9UxvLA5a+nrBKUqJujujqJnRXAKKfnpJbTDvhCuIeTxaFFt50e5UpLjSwqXS/a/AaEMJXRSsSLbKFTW/ALSCHfPv3HCStnue5CFpzVk4OhQbQ+dZyXUQp5wxQTtpr0hIh0IyB20gsoZNa0lGvFuXnzqDCH2X2mXwzDcyZk2IOX34nq+Wtnk8qYdjJxEAG0tnlYsMjmmXECnbOxl6gtNJ5hoehgak6cSfs7/rMi4jOI838tzsWWyDJeACj9qfQyfGtpk23x8Zt6KuqUjNZ1/z+/T8LwoopsGRtwYyKQbJS8pn8IGKPLtHDVxRx09yBRuqgYVFzSqpnr3T1vwWYHXiEF0sVJBx
>         GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR
>         /home/jshaw/anaconda3/envs/qgis_stable/bin/qgis
>         /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>         [Fri Sep 13 17:56:26 2024].3948, 0.0000: HTTP: libcurl/8.9.0
>         OpenSSL/3.3.1 zlib/1.3.1 zstd/1.5.6 libssh2/1.11.0 nghttp2/1.58.0
>         [Fri Sep 13 17:56:26 2024].7731, 0.3783: S3: Switching to
>         endpoint s3.eu-central-1.amazonaws.com
>         <http://s3.eu-central-1.amazonaws.com>
>         [Fri Sep 13 17:56:26 2024].8415, 0.4467: S3: Switching to
>         region eu-central-1
>         [Fri Sep 13 17:56:26 2024].9230, 0.5282: S3:
>         GetFileSize(https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>         ?response_code=206
>         [Fri Sep 13 17:56:26 2024].9235, 0.5288: GDAL:
>         GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x556e6bb915a0) succeeds as GTiff.
>         [Fri Sep 13 17:56:26 2024].9240, 0.5292: GTiff: ScanDirectories()
>         [Fri Sep 13 17:56:26 2024].9243, 0.5296: GTiff: Opened band mask.
>         [Fri Sep 13 17:56:26 2024].9246, 0.5298: GTiff: Opened
>         8929x7207 overview.
>         [Fri Sep 13 17:56:26 2024].9249, 0.5301: GTiff: Opened
>         4464x3603 overview.
>         [Fri Sep 13 17:56:26 2024].9251, 0.5304: GTiff: Opened
>         2232x1801 overview.
>         [Fri Sep 13 17:56:26 2024].9254, 0.5306: GTiff: Opened
>         1116x900 overview.
>         [Fri Sep 13 17:56:26 2024].9257, 0.5309: GTiff: Opened 558x450
>         overview.
>         [Fri Sep 13 17:56:26 2024].9259, 0.5311: GTiff: Opened 279x225
>         overview.
>         [Fri Sep 13 17:56:26 2024].9262, 0.5314: GTiff: Opened band
>         mask for 8929x7207 overview.
>         [Fri Sep 13 17:56:26 2024].9264, 0.5316: GTiff: Opened band
>         mask for 4464x3603 overview.
>         [Fri Sep 13 17:56:26 2024].9267, 0.5319: GTiff: Opened band
>         mask for 2232x1801 overview.
>         [Fri Sep 13 17:56:26 2024].9269, 0.5321: GTiff: Opened band
>         mask for 1116x900 overview.
>         [Fri Sep 13 17:56:26 2024].9272, 0.5324: GTiff: Opened band
>         mask for 558x450 overview.
>         [Fri Sep 13 17:56:26 2024].9274, 0.5326: GTiff: Opened band
>         mask for 279x225 overview.
>         [Fri Sep 13 17:56:26 2024].9277, 0.5329: GDAL:
>         GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x556e6bb915a0)
>         ERROR: Status 2: File
>         /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>         could not be found
>         [Fri Sep 13 17:56:26 2024].9370, 0.5422: GDAL: On-demand
>         registering
>         /home/jshaw/anaconda3/envs/qgis_stable/lib/gdalplugins/gdal_TileDB.so
>         using GDALRegister_TileDB.
>         [Fri Sep 13 17:56:33 2024].4445, 7.0498: S3:
>         GetFileSize(https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>         ?response_code=206
>         [Fri Sep 13 17:56:33 2024].4449, 7.0501: GDAL:
>         GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x556e6b807d00) succeeds as GTiff.
>         GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4666, 7.0718: OGRCT:
>         Using WebMercator to WGS84 optimization
>         GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].4667, 7.0719: GDAL:
>         Computing area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>         [Fri Sep 13 17:56:33 2024].4667, 7.0719: GTiff: ScanDirectories()
>         [Fri Sep 13 17:56:33 2024].4669, 7.0721: GTiff: Opened band mask.
>         [Fri Sep 13 17:56:33 2024].4670, 7.0722: GTiff: Opened
>         8929x7207 overview.
>         [Fri Sep 13 17:56:33 2024].4671, 7.0723: GTiff: Opened
>         4464x3603 overview.
>         [Fri Sep 13 17:56:33 2024].4672, 7.0724: GTiff: Opened
>         2232x1801 overview.
>         [Fri Sep 13 17:56:33 2024].4673, 7.0725: GTiff: Opened
>         1116x900 overview.
>         [Fri Sep 13 17:56:33 2024].4674, 7.0726: GTiff: Opened 558x450
>         overview.
>         [Fri Sep 13 17:56:33 2024].4675, 7.0727: GTiff: Opened 279x225
>         overview.
>         [Fri Sep 13 17:56:33 2024].4676, 7.0728: GTiff: Opened band
>         mask for 8929x7207 overview.
>         [Fri Sep 13 17:56:33 2024].4677, 7.0729: GTiff: Opened band
>         mask for 4464x3603 overview.
>         [Fri Sep 13 17:56:33 2024].4677, 7.0730: GTiff: Opened band
>         mask for 2232x1801 overview.
>         [Fri Sep 13 17:56:33 2024].4678, 7.0731: GTiff: Opened band
>         mask for 1116x900 overview.
>         [Fri Sep 13 17:56:33 2024].4679, 7.0732: GTiff: Opened band
>         mask for 558x450 overview.
>         [Fri Sep 13 17:56:33 2024].4680, 7.0733: GTiff: Opened band
>         mask for 279x225 overview.
>         [Fri Sep 13 17:56:33 2024].5178, 7.1230: GDAL:
>         GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x7f830c08d490) succeeds as GTiff.
>         [Fri Sep 13 17:56:33 2024].5180, 7.1232: S3: Downloading
>         59179008-59244543
>         (https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         GDAL ERROR 0: [Fri Sep 13 17:56:33 2024].5244, 7.1296: GDAL:
>         Computing area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>         [Fri Sep 13 17:56:33 2024].5245, 7.1297: GTiff: ScanDirectories()
>         [Fri Sep 13 17:56:33 2024].5246, 7.1298: GTiff: Opened band mask.
>         [Fri Sep 13 17:56:33 2024].5247, 7.1299: GTiff: Opened
>         8929x7207 overview.
>         [Fri Sep 13 17:56:33 2024].5247, 7.1300: GTiff: Opened
>         4464x3603 overview.
>         [Fri Sep 13 17:56:33 2024].5248, 7.1300: GTiff: Opened
>         2232x1801 overview.
>         [Fri Sep 13 17:56:33 2024].5249, 7.1301: GTiff: Opened
>         1116x900 overview.
>         [Fri Sep 13 17:56:33 2024].5249, 7.1302: GTiff: Opened 558x450
>         overview.
>         [Fri Sep 13 17:56:33 2024].5250, 7.1302: GTiff: Opened 279x225
>         overview.
>         [Fri Sep 13 17:56:33 2024].5251, 7.1303: GTiff: Opened band
>         mask for 8929x7207 overview.
>         [Fri Sep 13 17:56:33 2024].5251, 7.1304: GTiff: Opened band
>         mask for 4464x3603 overview.
>         [Fri Sep 13 17:56:33 2024].5252, 7.1304: GTiff: Opened band
>         mask for 2232x1801 overview.
>         [Fri Sep 13 17:56:33 2024].5253, 7.1305: GTiff: Opened band
>         mask for 1116x900 overview.
>         [Fri Sep 13 17:56:33 2024].5253, 7.1306: GTiff: Opened band
>         mask for 558x450 overview.
>         [Fri Sep 13 17:56:33 2024].5254, 7.1306: GTiff: Opened band
>         mask for 279x225 overview.
>         [Fri Sep 13 17:56:33 2024].5255, 7.1307: GDAL: Selecting
>         overview 1116 x 900
>         [Fri Sep 13 17:56:33 2024].5255, 7.1307: S3: Downloading
>         16384-32767
>         (https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         [Fri Sep 13 17:56:33 2024].6116, 7.2168: S3: Got response_code=206
>         [Fri Sep 13 17:56:33 2024].6118, 7.2171: S3: Downloading
>         180224-589823
>         (https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         [Fri Sep 13 17:56:33 2024].6955, 7.3008: S3: Got response_code=206
>         [Fri Sep 13 17:56:33 2024].6960, 7.3012: GDAL: GDAL_CACHEMAX =
>         1591 MB
>         [Fri Sep 13 17:56:33 2024].6977, 7.3029: S3: Got response_code=206
>
>
>         This is the equivalent code with QGIS 3.38 in Ubuntu and GDAL
>         3.4.1
>
>         CPL_DEBUG=ON CPL_TIMESTAMP=ON python3 pix4d_qgis.py
>         --project-id 1969386 --share-token
>         09c3eada-1b3b-46eb-b5de-8bd51635a5b9
>         Session expires at 2024-09-14T04:00:10Z
>         AWS_ACCESS_KEY_ID=ASIATOCJLBKSRCEUBKE6
>         AWS_SECRET_ACCESS_KEY=h6NhBf9VwBZoVj5Zd/8H2BnzXQu0l6bFUUv2D8E7
>         AWS_SESSION_TOKEN=FwoGZXIvYXdzEKn//////////wEaDF1xO50XL6GBe/358CLXAn3JR/uteJtarwJ/ryn6i4+lcMFEQZ/KV0FZQdKsD1PwAcqoYFY+0GKYSV+FTk81ZszsVzy8N7d2GwByvP9S/L1XOo1FrqJfDpGw3a5eQR7AoeU68EPlD/WTYnM7XBzXimHywDCyue3SOi8oZaSdbMgjBQ1N6j+qQ+EDN7RjD/Zu2CGMTzN9g/Z0FhZsuyt2HRhnOYpsvpUMZ+WQr7pbjdVdwt3PdFHsJ95fhueapJspgQ7OSgmj5VtSR8NTecohLsd2eeGkSpiqVWuBwuAu2cW6LcqmAZGnF0DZIjPWiMIDf/OLczMRCw5MJGeYpsSkkiuM+t9Miv8aN4iCo8vjl6wumOCgPqTgBBWlQdAs2mLxwpF1Bb1UjJ6eiccp17+yJF3ffn8tvxx/+1V3Q++E5Xk+jiB1keJnFcizr7qD6EY+EdDES5sQrWAhM2uR78JjNc0f+hVZEmAoisORtwYyKb0po07ytiiBv+X3j+Y6BsCHR0Es3C3xVvsgkfn1zb1Z2flFWUzwqJUD
>         GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR /usr/bin/qgis
>         /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>         [Fri Sep 13 18:00:14 2024].7665, 0.0000: HTTP: libcurl/7.81.0
>         OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8
>         libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2)
>         libssh/0.9.6/openssl/zlib nghttp2/1.43.0 librtmp/2.3
>         OpenLDAP/2.5.18
>         [Fri Sep 13 18:00:14 2024].7666, 0.0001: S3: Downloading
>         0-16383
>         (https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         [Fri Sep 13 18:00:14 2024].8897, 0.1231: S3: Got response_code=400
>         [Fri Sep 13 18:00:14 2024].8898, 0.1232: S3: Switching to
>         region eu-central-1
>         [Fri Sep 13 18:00:14 2024].8899, 0.1234: S3: Downloading
>         0-16383
>         (https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         [Fri Sep 13 18:00:15 2024].0287, 0.2621: S3: Got response_code=206
>         [Fri Sep 13 18:00:15 2024].0288, 0.2622: S3:
>         GetFileSize(https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>         ?response_code=206
>         [Fri Sep 13 18:00:15 2024].0292, 0.2627: GDAL:
>         GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x560e4cd84920) succeeds as GTiff.
>         [Fri Sep 13 18:00:15 2024].0298, 0.2632: GTiff: ScanDirectories()
>         [Fri Sep 13 18:00:15 2024].0301, 0.2635: GTiff: Opened band mask.
>         [Fri Sep 13 18:00:15 2024].0304, 0.2638: GTiff: Opened
>         8929x7207 overview.
>         [Fri Sep 13 18:00:15 2024].0306, 0.2641: GTiff: Opened
>         4464x3603 overview.
>         [Fri Sep 13 18:00:15 2024].0309, 0.2643: GTiff: Opened
>         2232x1801 overview.
>         [Fri Sep 13 18:00:15 2024].0311, 0.2646: GTiff: Opened
>         1116x900 overview.
>         [Fri Sep 13 18:00:15 2024].0314, 0.2648: GTiff: Opened 558x450
>         overview.
>         [Fri Sep 13 18:00:15 2024].0316, 0.2651: GTiff: Opened 279x225
>         overview.
>         [Fri Sep 13 18:00:15 2024].0319, 0.2654: GTiff: Opened band
>         mask for 8929x7207 overview.
>         [Fri Sep 13 18:00:15 2024].0322, 0.2656: GTiff: Opened band
>         mask for 4464x3603 overview.
>         [Fri Sep 13 18:00:15 2024].0324, 0.2658: GTiff: Opened band
>         mask for 2232x1801 overview.
>         [Fri Sep 13 18:00:15 2024].0326, 0.2661: GTiff: Opened band
>         mask for 1116x900 overview.
>         [Fri Sep 13 18:00:15 2024].0329, 0.2663: GTiff: Opened band
>         mask for 558x450 overview.
>         [Fri Sep 13 18:00:15 2024].0331, 0.2665: GTiff: Opened band
>         mask for 279x225 overview.
>         [Fri Sep 13 18:00:15 2024].0334, 0.2669: GDAL:
>         GDALClose(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x560e4cd84920)
>         ERROR: Status 2: File
>         /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>         could not be found
>         [Fri Sep 13 18:00:15 2024].0357, 0.2691: S3: Downloading
>         0-16383
>         (https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         [Fri Sep 13 18:00:15 2024].0762, 0.3096: S3: Got response_code=206
>         [Fri Sep 13 18:00:15 2024].0762, 0.3097: S3:
>         GetFileSize(https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>         ?response_code=206
>         [Fri Sep 13 18:00:15 2024].0765, 0.3099: GDAL:
>         GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x560e4d0afb70) succeeds as GTiff.
>         GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].0956, 0.3291: GDAL:
>         Computing area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>         [Fri Sep 13 18:00:15 2024].0958, 0.3293: GTiff: ScanDirectories()
>         [Fri Sep 13 18:00:15 2024].0959, 0.3294: GTiff: Opened band mask.
>         [Fri Sep 13 18:00:15 2024].0961, 0.3295: GTiff: Opened
>         8929x7207 overview.
>         [Fri Sep 13 18:00:15 2024].0962, 0.3296: GTiff: Opened
>         4464x3603 overview.
>         [Fri Sep 13 18:00:15 2024].0962, 0.3297: GTiff: Opened
>         2232x1801 overview.
>         [Fri Sep 13 18:00:15 2024].0963, 0.3298: GTiff: Opened
>         1116x900 overview.
>         [Fri Sep 13 18:00:15 2024].0964, 0.3299: GTiff: Opened 558x450
>         overview.
>         [Fri Sep 13 18:00:15 2024].0965, 0.3300: GTiff: Opened 279x225
>         overview.
>         [Fri Sep 13 18:00:15 2024].0966, 0.3301: GTiff: Opened band
>         mask for 8929x7207 overview.
>         [Fri Sep 13 18:00:15 2024].0967, 0.3302: GTiff: Opened band
>         mask for 4464x3603 overview.
>         [Fri Sep 13 18:00:15 2024].0968, 0.3303: GTiff: Opened band
>         mask for 2232x1801 overview.
>         [Fri Sep 13 18:00:15 2024].0969, 0.3303: GTiff: Opened band
>         mask for 1116x900 overview.
>         [Fri Sep 13 18:00:15 2024].0970, 0.3304: GTiff: Opened band
>         mask for 558x450 overview.
>         [Fri Sep 13 18:00:15 2024].0971, 0.3305: GTiff: Opened band
>         mask for 279x225 overview.
>         [Fri Sep 13 18:00:15 2024].2011, 0.4346: GDAL:
>         GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
>         this=0x7f0dfc08dfd0) succeeds as GTiff.
>         GDAL ERROR 0: [Fri Sep 13 18:00:15 2024].2120, 0.4454: GDAL:
>         Computing area of interest: 6.62976, 46.6391, 6.63534, 46.6422
>         [Fri Sep 13 18:00:15 2024].2121, 0.4456: GTiff: ScanDirectories()
>         [Fri Sep 13 18:00:15 2024].2122, 0.4457: GTiff: Opened band mask.
>         [Fri Sep 13 18:00:15 2024].2123, 0.4457: GTiff: Opened
>         8929x7207 overview.
>         [Fri Sep 13 18:00:15 2024].2123, 0.4458: GTiff: Opened
>         4464x3603 overview.
>         [Fri Sep 13 18:00:15 2024].2124, 0.4459: GTiff: Opened
>         2232x1801 overview.
>         [Fri Sep 13 18:00:15 2024].2125, 0.4459: GTiff: Opened
>         1116x900 overview.
>         [Fri Sep 13 18:00:15 2024].2125, 0.4460: GTiff: Opened 558x450
>         overview.
>         [Fri Sep 13 18:00:15 2024].2126, 0.4460: GTiff: Opened 279x225
>         overview.
>         [Fri Sep 13 18:00:15 2024].2126, 0.4461: GTiff: Opened band
>         mask for 8929x7207 overview.
>         [Fri Sep 13 18:00:15 2024].2127, 0.4462: GTiff: Opened band
>         mask for 4464x3603 overview.
>         [Fri Sep 13 18:00:15 2024].2128, 0.4462: GTiff: Opened band
>         mask for 2232x1801 overview.
>         [Fri Sep 13 18:00:15 2024].2128, 0.4463: GTiff: Opened band
>         mask for 1116x900 overview.
>         [Fri Sep 13 18:00:15 2024].2129, 0.4463: GTiff: Opened band
>         mask for 558x450 overview.
>         [Fri Sep 13 18:00:15 2024].2129, 0.4464: GTiff: Opened band
>         mask for 279x225 overview.
>         [Fri Sep 13 18:00:15 2024].2130, 0.4465: S3: Downloading
>         16384-32767
>         (https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         [Fri Sep 13 18:00:15 2024].3454, 0.5789: S3: Got response_code=206
>         [Fri Sep 13 18:00:15 2024].3456, 0.5791: S3: Downloading
>         180224-589823
>         (https://prod-pix4d-cloud-eu-central-1.s3.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)...
>         [Fri Sep 13 18:00:15 2024].4272, 0.6606: S3: Got response_code=206
>         [Fri Sep 13 18:00:15 2024].4276, 0.6610: GDAL: GDAL_CACHEMAX =
>         1591 MB
>
>         What can it be?
>
>         BTW, in both cases it says
>         ERROR: Status 2: File
>         /vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff
>         could not be found
>         And later it opens it. I don't know why.
>
>         Thank you very much
>         Javier.
>
>         On Mon, 9 Sept 2024 at 23:49, Mayer, David P
>         <dpmayer at usgs.gov> wrote:
>
>             Would ~200 GB be large enough?
>
>             Here is a mosaic of a section of Mars at 6 meters/pixel in
>             a public S3 bucket:
>             s3://asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif
>
>             Cheers,
>             David
>
>             -----------
>             David Mayer
>             Geographer
>             Astrogeology Science Center
>             US Geological Survey
>             dpmayer at usgs.gov
>             ------------------------------------------------------------------------
>             *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> on
>             behalf of Javier Jimenez Shaw via gdal-dev
>             <gdal-dev at lists.osgeo.org>
>             *Sent:* Monday, September 9, 2024 13:55
>             *To:* gdal dev <gdal-dev at lists.osgeo.org>
>             *Subject:* [EXTERNAL] [gdal-dev] s3 request example
>
>             *?This email has been received from outside of DOI -?Use
>             caution before clicking on links, opening attachments, or
>             responding. *
>
>
>
>             Hi
>
>             I am experiencing a much slower load of a remote COG using
>             vsis3 with the QGIS from conda than the QGIS in my Ubuntu
>             (that uses GDAL 3.4.1).
>
>             Because both are QGIS 3.38, I think the problem is in the
>             version of GDAL.
>             I would like to research it more.
>
>             Is there any example of a (big) COG file in Amazon S3 I
>             can use to compare them? Unfortunately the credentials for
>             the files I am using expire after a few hours, so they are
>             useless to report anything.
>
>             Best regards,
>             Javier
>
>         _______________________________________________
>         gdal-dev mailing list
>         gdal-dev at lists.osgeo.org
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/6d382677/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Sep 13 10:27:36 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 13 Sep 2024 19:27:36 +0200
Subject: [gdal-dev] [EXTERNAL] s3 request example
In-Reply-To: <CADRrdKty7QzuJRays6juPtvXiALK_iM3MFc4ojd1RRCLcJ=EhA@mail.gmail.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
 <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
 <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
 <CADRrdKty7QzuJRays6juPtvXiALK_iM3MFc4ojd1RRCLcJ=EhA@mail.gmail.com>
Message-ID: <8b620c53-b582-42c3-9e1f-725f55de741c@spatialys.com>


Le 13/09/2024 ? 19:16, Javier Jimenez Shaw via gdal-dev a ?crit?:
> This is getting even weirder. I tried removing gdal_TileDB.so before 
> my first email, and it didn't work.
> However, now it works... but only if I opened the file before. If I 
> wait a couple of minutes, then it still waits 5 or 6 seconds. Is there 
> any cache somewhere? (I am closing QGIS, so it should not be in the 
> memory of QGIS)
No explanation for that...
>
> [Fri Sep 13 18:44:11 2024].3102, 0.0000: GDAL: Proxy driver TileDB 
> *not* registered due to gdal_TileDB.so not being found
> [Fri Sep 13 18:44:12 2024].3429, 1.0326: GDAL: Proxy driver TileDB 
> *not* registered due to gdal_TileDB.so not being found
> [Fri Sep 13 18:44:12 2024].8555, 1.5452: GDAL: Proxy driver TileDB 
> *not* registered due to gdal_TileDB.so not being found
> [Fri Sep 13 18:44:13 2024].9017, 2.5915: HTTP: libcurl/8.9.0 
> OpenSSL/3.3.1 zlib/1.3.1 zstd/1.5.6 libssh2/1.11.0 nghttp2/1.58.0
> [Fri Sep 13 18:44:14 2024].2537, 2.9434: S3: Switching to endpoint 
> s3.eu-central-1.amazonaws.com <http://s3.eu-central-1.amazonaws.com>
> [Fri Sep 13 18:44:19 2024].3471, 8.0369: S3: Switching to region 
> eu-central-1
> [Fri Sep 13 18:44:19 2024].4582, 8.1480: S3: 
> GetFileSize(https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291 
> ?response_code=206
> [Fri Sep 13 18:44:19 2024].4587, 8.1485: GDAL: 
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff, 
> this=0x56258e57eef0) succeeds as GTiff.
> [Fri Sep 13 18:44:19 2024].4593, 8.1490: GTiff: ScanDirectories()
> [Fri Sep 13 18:44:19 2024].4596, 8.1494: GTiff: Opened band mask.
>
> Another question that pops up is... why is it loading TileDB there? it 
> is not doing it if I just open QGIS. Is it needed for the COG?
Cf my previous email
>
> If I open the file David suggested
> AWS_NO_SIGN_REQUEST=YES CPL_DEBUG=ON CPL_TIMESTAMP=ON qgis 
> /vsis3/asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif
> It does not mention TileDB in the logs. Neither if I load the same COG 
> file from the hard drive.
There's actually a specific case in the TileDB driver for the "tif" 
extension, but not "tiff". We need obviously a better solution...
>
> If TileDB is loaded dynamically and it is the reason of the delay 
> (that I am not sure), is there a way to disable that load? Kind of a 
> config environment variable.

There's (almost) always an environment variable to solve issues ;-) 
GDAL_SKIP=TileDB

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/20554dc5/attachment.htm>

From j1 at jimenezshaw.com  Fri Sep 13 10:40:39 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Fri, 13 Sep 2024 19:40:39 +0200
Subject: [gdal-dev] [EXTERNAL] s3 request example
In-Reply-To: <8b620c53-b582-42c3-9e1f-725f55de741c@spatialys.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
 <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
 <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
 <CADRrdKty7QzuJRays6juPtvXiALK_iM3MFc4ojd1RRCLcJ=EhA@mail.gmail.com>
 <8b620c53-b582-42c3-9e1f-725f55de741c@spatialys.com>
Message-ID: <CADRrdKtf9bA2x3KgOmBZ_w7wb+NhU-i0XcoMH7bungn0RRNawg@mail.gmail.com>

Thanks Even

regarding GDAL_SKIP=TileDB as environment variable, it still shows the
message
[Fri Sep 13 19:37:03 2024].8370, 10.5869: GDAL: On-demand registering
/home/jshaw/anaconda3/envs/qgis_stable/lib/gdalplugins/gdal_TileDB.so using
GDALRegister_TileDB.


On Fri, 13 Sept 2024 at 19:27, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 13/09/2024 ? 19:16, Javier Jimenez Shaw via gdal-dev a ?crit :
>
> This is getting even weirder. I tried removing gdal_TileDB.so before my
> first email, and it didn't work.
> However, now it works... but only if I opened the file before. If I wait a
> couple of minutes, then it still waits 5 or 6 seconds. Is there any cache
> somewhere? (I am closing QGIS, so it should not be in the memory of QGIS)
>
> No explanation for that...
>
>
> [Fri Sep 13 18:44:11 2024].3102, 0.0000: GDAL: Proxy driver TileDB *not*
> registered due to gdal_TileDB.so not being found
> [Fri Sep 13 18:44:12 2024].3429, 1.0326: GDAL: Proxy driver TileDB *not*
> registered due to gdal_TileDB.so not being found
> [Fri Sep 13 18:44:12 2024].8555, 1.5452: GDAL: Proxy driver TileDB *not*
> registered due to gdal_TileDB.so not being found
> [Fri Sep 13 18:44:13 2024].9017, 2.5915: HTTP: libcurl/8.9.0 OpenSSL/3.3.1
> zlib/1.3.1 zstd/1.5.6 libssh2/1.11.0 nghttp2/1.58.0
> [Fri Sep 13 18:44:14 2024].2537, 2.9434: S3: Switching to endpoint
> s3.eu-central-1.amazonaws.com
> [Fri Sep 13 18:44:19 2024].3471, 8.0369: S3: Switching to region
> eu-central-1
> [Fri Sep 13 18:44:19 2024].4582, 8.1480: S3: GetFileSize(
> https://prod-pix4d-cloud-eu-central-1.s3.eu-central-1.amazonaws.com/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff)=66132291
>  response_code=206
> [Fri Sep 13 18:44:19 2024].4587, 8.1485: GDAL:
> GDALOpen(/vsis3/prod-pix4d-cloud-eu-central-1/user-5b21721a-90d0-49c9-9d1c-d2a0c5929be5/project-1969386/ortho_display.tiff,
> this=0x56258e57eef0) succeeds as GTiff.
> [Fri Sep 13 18:44:19 2024].4593, 8.1490: GTiff: ScanDirectories()
> [Fri Sep 13 18:44:19 2024].4596, 8.1494: GTiff: Opened band mask.
>
> Another question that pops up is... why is it loading TileDB there? it is
> not doing it if I just open QGIS. Is it needed for the COG?
>
> Cf my previous email
>
>
> If I open the file David suggested
> AWS_NO_SIGN_REQUEST=YES CPL_DEBUG=ON CPL_TIMESTAMP=ON qgis
> /vsis3/asc-pds-services/mosaic/Mars/Mars_MRO_CTX_Equi_Mosaics_Robbins/6mpp/MC16_6mpp.16bit.tif
> It does not mention TileDB in the logs. Neither if I load the same COG
> file from the hard drive.
>
> There's actually a specific case in the TileDB driver for the "tif"
> extension, but not "tiff". We need obviously a better solution...
>
>
> If TileDB is loaded dynamically and it is the reason of the delay (that I
> am not sure), is there a way to disable that load? Kind of a config
> environment variable.
>
> There's (almost) always an environment variable to solve issues ;-)
> GDAL_SKIP=TileDB
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/25b3e7bf/attachment.htm>

From even.rouault at spatialys.com  Fri Sep 13 10:49:53 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 13 Sep 2024 19:49:53 +0200
Subject: [gdal-dev] [EXTERNAL] s3 request example
In-Reply-To: <CADRrdKtf9bA2x3KgOmBZ_w7wb+NhU-i0XcoMH7bungn0RRNawg@mail.gmail.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
 <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
 <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
 <CADRrdKty7QzuJRays6juPtvXiALK_iM3MFc4ojd1RRCLcJ=EhA@mail.gmail.com>
 <8b620c53-b582-42c3-9e1f-725f55de741c@spatialys.com>
 <CADRrdKtf9bA2x3KgOmBZ_w7wb+NhU-i0XcoMH7bungn0RRNawg@mail.gmail.com>
Message-ID: <8f0d880f-a501-4f62-a946-7a3684746322@spatialys.com>


Le 13/09/2024 ? 19:40, Javier Jimenez Shaw a ?crit?:
> Thanks Even
>
> regarding?GDAL_SKIP=TileDB as environment variable, it still shows the 
> message
> [Fri Sep 13 19:37:03 2024].8370, 10.5869: GDAL: On-demand registering 
> /home/jshaw/anaconda3/envs/qgis_stable/lib/gdalplugins/gdal_TileDB.so 
> using GDALRegister_TileDB.

Ah... I forgot that QGIS overrides it. In QGIS, go to Settings / Option 
/ Data Sources / GDAL and uncheck TileDB in the driver list (you may 
need to uncheck it in both the Raster and Vector tab)


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/8326bae4/attachment.htm>

From matt.luck at noaa.gov  Fri Sep 13 12:31:13 2024
From: matt.luck at noaa.gov (Matt Luck - NOAA Affiliate)
Date: Fri, 13 Sep 2024 15:31:13 -0400
Subject: [gdal-dev] Upgrade or remove Java JDK 17 in GDAL Docker image
In-Reply-To: <c4fa501e-e9c1-46f4-9ebe-4468b3c7dcf0@spatialys.com>
References: <CO1PR10MB457818D07657F4627A20DD06FE992@CO1PR10MB4578.namprd10.prod.outlook.com>
 <5e73612d-0235-4436-a27b-eb302019e6b7@spatialys.com>
 <CADorzfppByWPnVT7gUVa_KNGVFO-GhQGPCKi60g7Ua50oFG6hw@mail.gmail.com>
 <c4fa501e-e9c1-46f4-9ebe-4468b3c7dcf0@spatialys.com>
Message-ID: <CADorzfq7XTZUK_5op8QYkygK+dcw5EQ1TOJWC-7MFnGsc-VvSw@mail.gmail.com>

Hi Even,

I was able to use ubuntu-small-3.8.4 and that solved our JDK issue for now.
Thanks for the suggestion!

In addition, I tried a few things to use ubuntu-small-3.8.5 but ran into
problems.

> docker pull ghcr.io/osgeo/gdal:ubuntu-small-3.8.5
> ubuntu-small-3.8.5: Pulling from osgeo/gdal
> bccd10f490ab: Already exists
> 4f4fb700ef54: Already exists
> 149687fd87fe: Extracting
> [==================================================>]   6.78MB/6.78MB
> ea1e59f6ea30: Download complete
> 24d68adca93e: Download complete
> 501367299254: Download complete
> 254b87986c38: Download complete
> b4ae7f543abd: Download complete
> aa6a3265ff93: Download complete
> 9d59aec5a302: Download complete
> de7007069201: Download complete
> ea0e30b0513c: Download complete
> 7dd0e32f956a: Download complete
> 7ecb828005cd: Download complete
> eaea81e1f83b: Download complete
> 06c4e634e6ab: Download complete
> failed to register layer: open
> /var/lib/docker/overlay2/2d4142f840d37924c2699f68fbcc56b2b028212fe23c4d43135dd26f7838bc45/.tmp-committed1091585065:
> no such file or directory


I tried to build v3.8.5 with ./docker/ubuntu-small/build.sh

> Step 44/44 : RUN ldconfig
>  ---> Running in e33c148d809c
>  ---> Removed intermediate container e33c148d809c
>  ---> 6d9a08c0c2c5
> [Warning] One or more build-args [WITH_DEBUG_SYMBOLS] were not consumed
> Successfully built 6d9a08c0c2c5
> Successfully tagged ghcr.io/osgeo/gdal:ubuntu-small-latest-amd64
> GDAL 3.10.0dev-acca3c2709e96bce8d208a1d26efe12ce299b252, released
> 2024/09/13
> PROJ.4 string:
> +proj=longlat +datum=WGS84 +no_defs +type=crs


> WKT2:2019 string:
> GEOGCRS["WGS 84",
>     ENSEMBLE["World Geodetic System 1984 ensemble",
>         MEMBER["World Geodetic System 1984 (Transit)"],
>         MEMBER["World Geodetic System 1984 (G730)"],
>         MEMBER["World Geodetic System 1984 (G873)"],
>         MEMBER["World Geodetic System 1984 (G1150)"],
>         MEMBER["World Geodetic System 1984 (G1674)"],
>         MEMBER["World Geodetic System 1984 (G1762)"],
>         MEMBER["World Geodetic System 1984 (G2139)"],
>         MEMBER["World Geodetic System 1984 (G2296)"],
>         ELLIPSOID["WGS 84",6378137,298.257223563,
>             LENGTHUNIT["metre",1]],
>         ENSEMBLEACCURACY[2.0]],
>     PRIMEM["Greenwich",0,
>         ANGLEUNIT["degree",0.0174532925199433]],
>     CS[ellipsoidal,2],
>         AXIS["geodetic latitude (Lat)",north,
>             ORDER[1],
>             ANGLEUNIT["degree",0.0174532925199433]],
>         AXIS["geodetic longitude (Lon)",east,
>             ORDER[2],
>             ANGLEUNIT["degree",0.0174532925199433]],
>     USAGE[
>         SCOPE["Horizontal component of 3D system."],
>         AREA["World."],
>         BBOX[-90,-180,90,180]],
>     ID["EPSG",4326]]
> GDAL 3.10.0dev-acca3c2709e96bce8d208a1d26efe12ce299b252, released
> 2024/09/13
> Using PROJ_DATUMGRID_LATEST_LAST_MODIFIED=Last-Modified: Sat, 15 Sep 2018
> 13:57:12 GMT
> Using PROJ_VERSION=0a407325fbb5bf42407a7dc5d4f948be9707e302
> Using GDAL_VERSION=acca3c2709e96bce8d208a1d26efe12ce299b252
> Using GDAL_REPOSITORY=OSGeo/gdal
> Using GDAL_RELEASE_DATE=20240913
> 05d7e24ca35f   osgeo/gdal:gdal_rsync_daemon   "/bin/sh -c 'rsync -?"   2
> hours ago   Up 2 hours   23985/tcp   gdal_rsync_daemon
> Fetching digest for ubuntu:22.04 linux/arm64...
> 22.04: Pulling from arm64v8/ubuntu
> e63ce922f022: Pull complete
> Digest:
> sha256:d174844cad059080ac551111ccd311d18f0a97ec562c28b3a3189f99e0ff1256
> Status: Downloaded newer image for arm64v8/ubuntu:22.04
> docker.io/arm64v8/ubuntu:22.04
> /home/rdp-user/git/gdal/./docker/ubuntu-small/../util.sh: line 416: jq:
> command not found


Matt

On Fri, Sep 13, 2024 at 10:08?AM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> How can I resolve this error?
>
> You have stripped too much of the logs. There must be some "error: "
> compilation line before that points to the actual error.
>
>
> Alternatively, we have considered a different solution that uses
> ubuntu:22.04 as our base image and then installing GDAL but also having
> problems with installing GDAL (I can't seem to get past dependency
> conflicts for v3.8.5 in pipenv so trying v3.8.3), getting an error:
>
> Collecting gdal==3.8.3 (from -r
>> /tmp/pipenv-gde160cj-requirements/pipenv-ndnw2zi0-hashed-reqs.txt (line 62))
>>   Downloading GDAL-3.8.3.tar.gz (802 kB)
>>      ????????????????????????????????????? 802.5/802.5 kB 104.5 MB/s eta
>> 0:00:00
>>   Preparing metadata (setup.py): started
>>   Preparing metadata (setup.py): finished with status 'error'
>> error: subprocess-exited-with-error
>>
>>   ? python setup.py egg_info did not run successfully.
>>   ? exit code: 1
>
>
>
>> Exception: Python bindings of GDAL 3.8.3 require at least libgdal 3.8.3,
>> but 3.4.1 was found
>
>
> How can we upgrade libgdal (in our Dockerfile)?
>
> - Use another Docker image, like alpine-normal or ubuntu-small, that
> doesn't have the Java dependency
>
> - Use Conda to install GDAL
>
> - Use plain ubuntu:24.04 that ships with GDAL 3.8.4 as a proper .deb
> package (https://launchpad.net/ubuntu/noble/+source/gdal)
>
> - ...
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/1217d784/attachment.htm>

From norman.barker at gmail.com  Fri Sep 13 13:28:36 2024
From: norman.barker at gmail.com (Norman Barker)
Date: Fri, 13 Sep 2024 15:28:36 -0500
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <CA+YzLBegz+o_qmDCp9srHeaB1ipBfTQ5iWqqUrj5Kyvx=J7ttQ@mail.gmail.com>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
 <9b6b8f10-702e-4d7d-9e94-c0bcfd247234@postholer.com>
 <E26ED439-6930-4171-9C1C-EAAA790A3316@hobu.co>
 <CA+YzLBegz+o_qmDCp9srHeaB1ipBfTQ5iWqqUrj5Kyvx=J7ttQ@mail.gmail.com>
Message-ID: <CAN_Dn-GN1kUZxikvPQ7qZvA7Q1QvH00+37E29OTxG3tQQe4oMw@mail.gmail.com>

+1

On Fri, Sep 13, 2024 at 12:29?AM Frank Warmerdam via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> A belated +1!
>
>
> On Thu, Sep 12, 2024 at 9:19?PM Howard Butler via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Declaring this motion passed with +1s from Sean, Jukka, Daniel, Javier,
>> Kurt, and Howard. We technically needed the contract active to pay Even's
>> previous invoice so I am fast-tracking the vote as it appears
>> non-controversial ;)
>>
>>
>> On Sep 11, 2024, at 10:50?PM, Scott via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>> Only a year? Someone chain him to his desk already. You can't be too
>> cautious. ;)
>>
>>
>> A key feature that led to the creation of the GDAL Sponsorship Program is
>> to have resources specifically for the situation for when/if Even decides
>> it is time to step back from his current role. He shouldn't have to feel
>> chained to any desk or the project ? that leads to burn out. Even though
>> Even is our hero, we don't want him to feel trapped here.
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
>
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up   | Frank Warmerdam,
> warmerdam at pobox.com
> light and sound - activate the windows | USA: +1 650-701-7823
> <http://voice.google.com/calls?a=nc,%2B16507017823>
> and watch the world go round - Rush    | CAN: +1 343-550-9984
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240913/5f15f5f8/attachment.htm>

From even.rouault at spatialys.com  Fri Sep 13 15:44:31 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 14 Sep 2024 00:44:31 +0200
Subject: [gdal-dev] (TileDB related question for you Norman/Sean) Re:
 [EXTERNAL] s3 request example
In-Reply-To: <28efa708-78d7-45d9-bf8c-52a70947b3f4@spatialys.com>
References: <CADRrdKuscCD3TUg0mvbLYzsW9Pvhbzk18Obxz95sDCU=z0Pggg@mail.gmail.com>
 <BY3PR09MB8418C67B7E9AB102B44081E9CE992@BY3PR09MB8418.namprd09.prod.outlook.com>
 <CADRrdKutBEvoPbMu7ec2xNhTjOgPbxh4tMf_03Z7Kr2OgL6FQw@mail.gmail.com>
 <CAOM3y2hyCix+-RjarnQ42b1O9uL0QffEEzecvr7Ng=vBTV43bg@mail.gmail.com>
 <CAOM3y2jTGvj29N9-9dfvj-K+DRcWHzOj9OOWwJUzi5Btei-BmA@mail.gmail.com>
 <28efa708-78d7-45d9-bf8c-52a70947b3f4@spatialys.com>
Message-ID: <ce644cd7-9269-4804-8819-f9c99dce4e00@spatialys.com>

Norman confirmed that a URI to a TileDB dataset can only be a directory, 
so we can tighten the identification check: 
https://github.com/OSGeo/gdal/pull/10798

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240914/7a603c21/attachment-0001.htm>

From sean.gillies at gmail.com  Sat Sep 14 12:41:03 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Sat, 14 Sep 2024 13:41:03 -0600
Subject: [gdal-dev] Is OpenJPEG JP2 in a zipfile with /vsizip/ supported?
Message-ID: <CAOodmJpzcekQfSibWvn3V8VKzaX0CzidZEf1-GPdo2EXedVaeg@mail.gmail.com>

Hi all,

In theory, we can read anything from a zip archive without extracting it to
the filesystem, but sometimes drivers have special requirements and
limitations. Is JP2 from a zipfile supported by OpenJPEG?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240914/f7f4d2e5/attachment.htm>

From even.rouault at spatialys.com  Sat Sep 14 13:42:25 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 14 Sep 2024 22:42:25 +0200
Subject: [gdal-dev] Is OpenJPEG JP2 in a zipfile with /vsizip/ supported?
In-Reply-To: <CAOodmJpzcekQfSibWvn3V8VKzaX0CzidZEf1-GPdo2EXedVaeg@mail.gmail.com>
References: <CAOodmJpzcekQfSibWvn3V8VKzaX0CzidZEf1-GPdo2EXedVaeg@mail.gmail.com>
Message-ID: <f6c15458-9dd9-44f8-a73e-2d75b9fc91c9@spatialys.com>

Sean,

Yes, GDAL has an adapter between its VSI file system abstraction and 
OpenJPEG own pluggable I/O layer, so you can use any VSI virtual file 
system that has read & seek capabilities (so you can potentially do 
/vsizip//vsicurl/ of a JP2). But the efficiency might not be that great. 
Typically if it is a huge JPEG2000 file and you just need to extract a 
subset of it, even if it is tiled, locating the tile of interest might 
involve browsing through all the file, and thus decompressing most of 
it. For 2 reasons:

- first, support for exploiting the TLM marker, which is the equivalent 
of the TIFF TileOffset index, has been added only recently in OpenJPEG 
master, so not released yet. And not all tiled JPEG2000 files include 
TLM markers. The minimum JPEG2000 formulation is that each tile has just 
a header with its size, and so you have to go from one header to the 
next one to locate all tiles.

- and even if your file has TLM markers and you use openpjeg master, if 
your ZIP is a regular ZIP and not a SOZip (shameless ad for 
https://github.com/sozip/sozip-spec), seeking through at an arbitrary 
within a compressed file within a ZIP is a slow operation. But if 
someone really needs to include a JPEG2000 file they would better 
included it as a non-compressed file, because there's absolutely no file 
size gain to expect from applying deflate to a JPEG2000 file, and 
including it as non-compressed naturally enables fast random seeking.

Even

Le 14/09/2024 ? 21:41, Sean Gillies via gdal-dev a ?crit?:
> Hi all,
>
> In theory, we can read anything from a zip archive without extracting 
> it to the filesystem, but sometimes drivers have special requirements 
> and limitations. Is JP2 from a zipfile supported by OpenJPEG?
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240914/8339359a/attachment.htm>

From szekerest at gmail.com  Mon Sep 16 06:16:15 2024
From: szekerest at gmail.com (Tamas Szekeres)
Date: Mon, 16 Sep 2024 15:16:15 +0200
Subject: [gdal-dev] Motion: Renew Even Rouault GDAL Maintainer Contract
In-Reply-To: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
References: <AD502936-66BE-48C5-B895-47D688F115BA@hobu.co>
Message-ID: <CACALY+T-0-hbf6Hyaw2EhEUOB6UHhz3biY+mzXG-1A=GnnJfMw@mail.gmail.com>

+1

Tamas

Howard Butler via gdal-dev <gdal-dev at lists.osgeo.org> ezt ?rta (id?pont:
2024. szept. 12., Cs, 4:24):

> PSC,
>
> I am motioning to renew Even's maintainer contract through the GDAL
> Sponsorship Program that is hosted by NumFOCUS for another year.
>
> /me starts with a +1
>
> Howard
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240916/606f86c6/attachment.htm>

From mentaljam119 at gmail.com  Tue Sep 17 04:36:16 2024
From: mentaljam119 at gmail.com (Petr Tsymbarovich)
Date: Tue, 17 Sep 2024 14:36:16 +0300
Subject: [gdal-dev] GDAL Windows Wheels
Message-ID: <b2b196d1-9126-4c5b-bc23-a6b5fd42b976@gmail.com>

Hi,

Long story short: I've configured a GitLab pipeline for building and 
publishing
GDAL wheels for Python on Windows 
(https://gitlab.com/mentaljam/gdal-windows-wheels).
The approach uses cibuildwheel and delvewheel to include DLLs in the 
wheels and
it is partly borrowed from Rasterio GitHub Actions. The wheels are 
available at
GitLab Python package registry 
(https://gitlab.com/mentaljam/gdal-windows-wheels/-/packages).
More information and usage examples can be found in the README.md.

I hope someone would find this useful!

Best regards, Petr

From idan at miara.com  Tue Sep 17 05:52:58 2024
From: idan at miara.com (Idan Miara)
Date: Tue, 17 Sep 2024 15:52:58 +0300
Subject: [gdal-dev] GDAL Windows Wheels
In-Reply-To: <b2b196d1-9126-4c5b-bc23-a6b5fd42b976@gmail.com>
References: <b2b196d1-9126-4c5b-bc23-a6b5fd42b976@gmail.com>
Message-ID: <CADmqiFXVVMcRTBrqN0xyrhgE7uw3JchcqcL5xaPvm5QC+7MV1w@mail.gmail.com>

Thanks for sharing!
Would you like to post it also in this issue?
https://github.com/OSGeo/gdal/issues/4352

On Tue, 17 Sept 2024 at 14:36, Petr Tsymbarovich via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> Long story short: I've configured a GitLab pipeline for building and
> publishing
> GDAL wheels for Python on Windows
> (https://gitlab.com/mentaljam/gdal-windows-wheels).
> The approach uses cibuildwheel and delvewheel to include DLLs in the
> wheels and
> it is partly borrowed from Rasterio GitHub Actions. The wheels are
> available at
> GitLab Python package registry
> (https://gitlab.com/mentaljam/gdal-windows-wheels/-/packages).
> More information and usage examples can be found in the README.md.
>
> I hope someone would find this useful!
>
> Best regards, Petr
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240917/ffa13e60/attachment.htm>

From bphamhuu at constructor.university  Tue Sep 17 07:18:19 2024
From: bphamhuu at constructor.university (Huu Bang Pham)
Date: Tue, 17 Sep 2024 16:18:19 +0200
Subject: [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp after
 minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?
In-Reply-To: <bd4e958a-828d-4fb1-a3ac-0b550c5da795@constructor.university>
References: <bd4e958a-828d-4fb1-a3ac-0b550c5da795@constructor.university>
Message-ID: <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>

Hello,

I'm testing *GDAL 3.8.4, released 2024/02/08 on Ubuntu 24.04* and it has 
a strange issue.

I have a VRT file which *can be projected by gdalwarp on Ubuntu 22.04 
(GDAL 3.4.1, released 2021/12/27) in less than one second*, but *on 
Ubuntu 24.04, gdalwarp is stuck even after minutes *for no reason.

The VRT file and the dummy PNG file for it are attached in the 
attachment files.

gdalwarp command which I used is:

> gdalwarp test.vrt -t_srs EPSG:32631 -tap -tr 1000 1000 -of VRT 
> output.vrt -overwrite


gdalinfo of *test.vrt *is:

> Driver: VRT/Virtual Raster
> Files: test.vrt
> ?????? /tmp/dummy_file_for_gdal.vrt.png
> Size is 1, 1
> Coordinate System is:
> GEOGCRS["WGS 84",
> ??? DATUM["World Geodetic System 1984",
> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
> ??????????? LENGTHUNIT["metre",1]]],
> ??? PRIMEM["Greenwich",0,
> ??????? ANGLEUNIT["degree",0.0174532925199433]],
> ??? CS[ellipsoidal,2],
> ??????? AXIS["geodetic latitude (Lat)",north,
> ??????????? ORDER[1],
> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
> ??????? AXIS["geodetic longitude (Lon)",east,
> ??????????? ORDER[2],
> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
> ??? ID["EPSG",4326]]
> Data axis to CRS axis mapping: 2,1
> Origin = (6.868800000000000,51.374699999999997)
> Pixel Size = (0.000900000000000,-0.000900000000000)
> Corner Coordinates:
> Upper Left? (?? 6.8688000,? 51.3747000) (? 6d52' 7.68"E, 51d22'28.92"N)
> Lower Left? (?? 6.8688000,? 51.3738000) (? 6d52' 7.68"E, 51d22'25.68"N)
> Upper Right (?? 6.8697000,? 51.3747000) (? 6d52'10.92"E, 51d22'28.92"N)
> Lower Right (?? 6.8697000,? 51.3738000) (? 6d52'10.92"E, 51d22'25.68"N)
> Center????? (?? 6.8692500,? 51.3742500) (? 6d52' 9.30"E, 51d22'27.30"N)
> Band 1 Block=1x1 Type=Byte, ColorInterp=Red

gdalinfo of*/tmp/dummy_file_for_gdal.vrt.png* is:

> Driver: PNG/Portable Network Graphics
> Files: /tmp/dummy_file_for_gdal.vrt.png
> Size is 1, 1
> Image Structure Metadata:
> ? INTERLEAVE=PIXEL
> Corner Coordinates:
> Upper Left? (??? 0.0,??? 0.0)
> Lower Left? (??? 0.0,??? 1.0)
> Upper Right (??? 1.0,??? 0.0)
> Lower Right (??? 1.0,??? 1.0)
> Center????? (??? 0.5,??? 0.5)
> Band 1 Block=1x1 Type=Byte, ColorInterp=Red
> Band 2 Block=1x1 Type=Byte, ColorInterp=Green
> Band 3 Block=1x1 Type=Byte, ColorInterp=Blue


Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240917/5a542933/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dummy_file_for_gdal.vrt.png
Type: image/png
Size: 69 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240917/5a542933/attachment.png>
-------------- next part --------------
<VRTDataset rasterXSize="1" rasterYSize="1">
  <SRS>GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AXIS["Latitude",NORTH],AXIS["Longitude",EAST],AUTHORITY["EPSG","4326"]]</SRS>
  <GeoTransform> 6.8688, 0.0009, 0, 51.374699999999994, 0, -0.0009 </GeoTransform>
  <VRTRasterBand dataType="Byte" band="1">
    <ColorInterp>Red</ColorInterp>
    <SimpleSource>
      <SourceFilename relativeToVRT="1">/tmp/dummy_file_for_gdal.vrt.png</SourceFilename>
      <SourceProperties RasterXSize="1" RasterYSize="1" DataType="Byte" BlockXSize="1" BlockYSize="1" />

    </SimpleSource>
  </VRTRasterBand>
</VRTDataset>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Sep 17 07:27:03 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 17 Sep 2024 14:27:03 +0000
Subject: [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp
 after minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?
In-Reply-To: <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>
References: <bd4e958a-828d-4fb1-a3ac-0b550c5da795@constructor.university>
 <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>
Message-ID: <DB9PR09MB6887F7BE7ABB5F73BEBB8A0EFD612@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

Out of curiosity, the source file contains one single pixel. Is there a real use case, or are you just experimenting?

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Huu Bang Pham via gdal-dev
L?hetetty: tiistai 17. syyskuuta 2024 17.18
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp after minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?

Hello,

I'm testing GDAL 3.8.4, released 2024/02/08 on Ubuntu 24.04 and it has a strange issue.

I have a VRT file which can be projected by gdalwarp on Ubuntu 22.04 (GDAL 3.4.1, released 2021/12/27) in less than one second, but on Ubuntu 24.04, gdalwarp is stuck even after minutes for no reason.

The VRT file and the dummy PNG file for it are attached in the attachment files.

gdalwarp command which I used is:


gdalwarp test.vrt -t_srs EPSG:32631 -tap -tr 1000 1000 -of VRT output.vrt -overwrite



gdalinfo of test.vrt is:
Driver: VRT/Virtual Raster
Files: test.vrt
       /tmp/dummy_file_for_gdal.vrt.png
Size is 1, 1
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (6.868800000000000,51.374699999999997)
Pixel Size = (0.000900000000000,-0.000900000000000)
Corner Coordinates:
Upper Left  (   6.8688000,  51.3747000) (  6d52' 7.68"E, 51d22'28.92"N)
Lower Left  (   6.8688000,  51.3738000) (  6d52' 7.68"E, 51d22'25.68"N)
Upper Right (   6.8697000,  51.3747000) (  6d52'10.92"E, 51d22'28.92"N)
Lower Right (   6.8697000,  51.3738000) (  6d52'10.92"E, 51d22'25.68"N)
Center      (   6.8692500,  51.3742500) (  6d52' 9.30"E, 51d22'27.30"N)
Band 1 Block=1x1 Type=Byte, ColorInterp=Red

gdalinfo of /tmp/dummy_file_for_gdal.vrt.png is:
Driver: PNG/Portable Network Graphics
Files: /tmp/dummy_file_for_gdal.vrt.png
Size is 1, 1
Image Structure Metadata:
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,    1.0)
Upper Right (    1.0,    0.0)
Lower Right (    1.0,    1.0)
Center      (    0.5,    0.5)
Band 1 Block=1x1 Type=Byte, ColorInterp=Red
Band 2 Block=1x1 Type=Byte, ColorInterp=Green
Band 3 Block=1x1 Type=Byte, ColorInterp=Blue

Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240917/49e5f7ab/attachment-0001.htm>

From bphamhuu at constructor.university  Tue Sep 17 07:37:16 2024
From: bphamhuu at constructor.university (Huu Bang Pham)
Date: Tue, 17 Sep 2024 16:37:16 +0200
Subject: [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp
 after minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?
In-Reply-To: <DB9PR09MB6887F7BE7ABB5F73BEBB8A0EFD612@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <bd4e958a-828d-4fb1-a3ac-0b550c5da795@constructor.university>
 <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>
 <DB9PR09MB6887F7BE7ABB5F73BEBB8A0EFD612@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <f8385dee-fe53-40da-be83-30fc571ca98b@constructor.university>

Hi,

This is a test case and it works fine on Ubuntu 22.04. I'm not sure why 
in Ubuntu 24.04 it stops working and hangs up.

On 17.09.24 4:27 PM, Rahkonen Jukka wrote:
>
> 	
> You don't often get email from jukka.rahkonen at maanmittauslaitos.fi. 
> Learn why this is important 
> <https://aka.ms/LearnAboutSenderIdentification>
> 	
>
> Hi,
>
> Out of curiosity, the source file contains one single pixel. Is there 
> a real use case, or are you just experimenting?
>
> -Jukka Rahkonen-
>
> *L?hett?j?:*gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Huu 
> Bang Pham via gdal-dev
> *L?hetetty:* tiistai 17. syyskuuta 2024 17.18
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp 
> after minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?
>
> Hello,
>
> I'm testing *GDAL 3.8.4, released 2024/02/08 on Ubuntu 24.04* and it 
> has a strange issue.
>
> I have a VRT file which *can be projected by gdalwarp on Ubuntu 22.04 
> (GDAL 3.4.1, released 2021/12/27) in less than one second*, but *on 
> Ubuntu 24.04, gdalwarp is stuck even after minutes *for no reason.
>
> The VRT file and the dummy PNG file for it are attached in the 
> attachment files.
>
> gdalwarp command which I used is:
>
>
>     gdalwarp test.vrt -t_srs EPSG:32631 -tap -tr 1000 1000 -of VRT
>     output.vrt -overwrite
>
> gdalinfo of *test.vrt *is:
>
>     Driver: VRT/Virtual Raster
>     Files: test.vrt
>     ?????? /tmp/dummy_file_for_gdal.vrt.png
>     Size is 1, 1
>     Coordinate System is:
>     GEOGCRS["WGS 84",
>     ??? DATUM["World Geodetic System 1984",
>     ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
>     ??????????? LENGTHUNIT["metre",1]]],
>     ??? PRIMEM["Greenwich",0,
>     ??????? ANGLEUNIT["degree",0.0174532925199433]],
>     ??? CS[ellipsoidal,2],
>     ??????? AXIS["geodetic latitude (Lat)",north,
>     ??????????? ORDER[1],
>     ??????????? ANGLEUNIT["degree",0.0174532925199433]],
>     ??????? AXIS["geodetic longitude (Lon)",east,
>     ??????????? ORDER[2],
>     ??????????? ANGLEUNIT["degree",0.0174532925199433]],
>     ??? ID["EPSG",4326]]
>     Data axis to CRS axis mapping: 2,1
>     Origin = (6.868800000000000,51.374699999999997)
>     Pixel Size = (0.000900000000000,-0.000900000000000)
>     Corner Coordinates:
>     Upper Left? (?? 6.8688000,? 51.3747000) (? 6d52' 7.68"E,
>     51d22'28.92"N)
>     Lower Left? (?? 6.8688000,? 51.3738000) (? 6d52' 7.68"E,
>     51d22'25.68"N)
>     Upper Right (?? 6.8697000,? 51.3747000) (? 6d52'10.92"E,
>     51d22'28.92"N)
>     Lower Right (?? 6.8697000,? 51.3738000) (? 6d52'10.92"E,
>     51d22'25.68"N)
>     Center????? (?? 6.8692500,? 51.3742500) (? 6d52' 9.30"E,
>     51d22'27.30"N)
>     Band 1 Block=1x1 Type=Byte, ColorInterp=Red
>
> gdalinfo of*/tmp/dummy_file_for_gdal.vrt.png* is:
>
>     Driver: PNG/Portable Network Graphics
>     Files: /tmp/dummy_file_for_gdal.vrt.png
>     Size is 1, 1
>     Image Structure Metadata:
>     ? INTERLEAVE=PIXEL
>     Corner Coordinates:
>     Upper Left? (??? 0.0,??? 0.0)
>     Lower Left? (??? 0.0,??? 1.0)
>     Upper Right (??? 1.0,??? 0.0)
>     Lower Right (??? 1.0,??? 1.0)
>     Center????? (??? 0.5,??? 0.5)
>     Band 1 Block=1x1 Type=Byte, ColorInterp=Red
>     Band 2 Block=1x1 Type=Byte, ColorInterp=Green
>     Band 3 Block=1x1 Type=Byte, ColorInterp=Blue
>
>
> Thanks,
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240917/5be51589/attachment-0001.htm>

From even.rouault at spatialys.com  Tue Sep 17 08:03:19 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 17 Sep 2024 17:03:19 +0200
Subject: [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp
 after minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?
In-Reply-To: <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>
References: <bd4e958a-828d-4fb1-a3ac-0b550c5da795@constructor.university>
 <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>
Message-ID: <2e16e9b1-798a-4d20-b5d5-4d7df511c4e0@spatialys.com>

Hi,

bug confirmed. Fix in https://github.com/OSGeo/gdal/pull/10822

Even

Le 17/09/2024 ? 16:18, Huu Bang Pham via gdal-dev a ?crit?:
> Hello,
>
> I'm testing *GDAL 3.8.4, released 2024/02/08 on Ubuntu 24.04* and it 
> has a strange issue.
>
> I have a VRT file which *can be projected by gdalwarp on Ubuntu 22.04 
> (GDAL 3.4.1, released 2021/12/27) in less than one second*, but *on 
> Ubuntu 24.04, gdalwarp is stuck even after minutes *for no reason.
>
> The VRT file and the dummy PNG file for it are attached in the 
> attachment files.
>
> gdalwarp command which I used is:
>
>> gdalwarp test.vrt -t_srs EPSG:32631 -tap -tr 1000 1000 -of VRT 
>> output.vrt -overwrite
>
>
> gdalinfo of *test.vrt *is:
>
>> Driver: VRT/Virtual Raster
>> Files: test.vrt
>> ?????? /tmp/dummy_file_for_gdal.vrt.png
>> Size is 1, 1
>> Coordinate System is:
>> GEOGCRS["WGS 84",
>> ??? DATUM["World Geodetic System 1984",
>> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
>> ??????????? LENGTHUNIT["metre",1]]],
>> ??? PRIMEM["Greenwich",0,
>> ??????? ANGLEUNIT["degree",0.0174532925199433]],
>> ??? CS[ellipsoidal,2],
>> ??????? AXIS["geodetic latitude (Lat)",north,
>> ??????????? ORDER[1],
>> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
>> ??????? AXIS["geodetic longitude (Lon)",east,
>> ??????????? ORDER[2],
>> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
>> ??? ID["EPSG",4326]]
>> Data axis to CRS axis mapping: 2,1
>> Origin = (6.868800000000000,51.374699999999997)
>> Pixel Size = (0.000900000000000,-0.000900000000000)
>> Corner Coordinates:
>> Upper Left? (?? 6.8688000,? 51.3747000) (? 6d52' 7.68"E, 51d22'28.92"N)
>> Lower Left? (?? 6.8688000,? 51.3738000) (? 6d52' 7.68"E, 51d22'25.68"N)
>> Upper Right (?? 6.8697000,? 51.3747000) (? 6d52'10.92"E, 51d22'28.92"N)
>> Lower Right (?? 6.8697000,? 51.3738000) (? 6d52'10.92"E, 51d22'25.68"N)
>> Center????? (?? 6.8692500,? 51.3742500) (? 6d52' 9.30"E, 51d22'27.30"N)
>> Band 1 Block=1x1 Type=Byte, ColorInterp=Red
>
> gdalinfo of*/tmp/dummy_file_for_gdal.vrt.png* is:
>
>> Driver: PNG/Portable Network Graphics
>> Files: /tmp/dummy_file_for_gdal.vrt.png
>> Size is 1, 1
>> Image Structure Metadata:
>> ? INTERLEAVE=PIXEL
>> Corner Coordinates:
>> Upper Left? (??? 0.0,??? 0.0)
>> Lower Left? (??? 0.0,??? 1.0)
>> Upper Right (??? 1.0,??? 0.0)
>> Lower Right (??? 1.0,??? 1.0)
>> Center????? (??? 0.5,??? 0.5)
>> Band 1 Block=1x1 Type=Byte, ColorInterp=Red
>> Band 2 Block=1x1 Type=Byte, ColorInterp=Green
>> Band 3 Block=1x1 Type=Byte, ColorInterp=Blue
>
> Thanks,
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240917/4f3aad46/attachment.htm>

From bphamhuu at constructor.university  Tue Sep 17 08:08:20 2024
From: bphamhuu at constructor.university (Huu Bang Pham)
Date: Tue, 17 Sep 2024 17:08:20 +0200
Subject: [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp
 after minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?
In-Reply-To: <2e16e9b1-798a-4d20-b5d5-4d7df511c4e0@spatialys.com>
References: <bd4e958a-828d-4fb1-a3ac-0b550c5da795@constructor.university>
 <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>
 <2e16e9b1-798a-4d20-b5d5-4d7df511c4e0@spatialys.com>
Message-ID: <31c376af-960b-415d-be3e-7f9714b1f244@constructor.university>

Hi Rouault,

Thanks for your quick reply. However, I'm stuck with GDAL 3.8.4 on 
Ubuntu 24.04.

Do you have any suggestion / workaround for this issue, in stead of 
building latest gdal with your fix manually?

Thanks,

On 17.09.24 5:03 PM, Even Rouault wrote:
>
> Hi,
>
> bug confirmed. Fix in https://github.com/OSGeo/gdal/pull/10822
>
> Even
>
> Le 17/09/2024 ? 16:18, Huu Bang Pham via gdal-dev a ?crit?:
>> Hello,
>>
>> I'm testing *GDAL 3.8.4, released 2024/02/08 on Ubuntu 24.04* and it 
>> has a strange issue.
>>
>> I have a VRT file which *can be projected by gdalwarp on Ubuntu 22.04 
>> (GDAL 3.4.1, released 2021/12/27) in less than one second*, but *on 
>> Ubuntu 24.04, gdalwarp is stuck even after minutes *for no reason.
>>
>> The VRT file and the dummy PNG file for it are attached in the 
>> attachment files.
>>
>> gdalwarp command which I used is:
>>
>>> gdalwarp test.vrt -t_srs EPSG:32631 -tap -tr 1000 1000 -of VRT 
>>> output.vrt -overwrite
>>
>>
>> gdalinfo of *test.vrt *is:
>>
>>> Driver: VRT/Virtual Raster
>>> Files: test.vrt
>>> ?????? /tmp/dummy_file_for_gdal.vrt.png
>>> Size is 1, 1
>>> Coordinate System is:
>>> GEOGCRS["WGS 84",
>>> ??? DATUM["World Geodetic System 1984",
>>> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
>>> ??????????? LENGTHUNIT["metre",1]]],
>>> ??? PRIMEM["Greenwich",0,
>>> ??????? ANGLEUNIT["degree",0.0174532925199433]],
>>> ??? CS[ellipsoidal,2],
>>> ??????? AXIS["geodetic latitude (Lat)",north,
>>> ??????????? ORDER[1],
>>> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
>>> ??????? AXIS["geodetic longitude (Lon)",east,
>>> ??????????? ORDER[2],
>>> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
>>> ??? ID["EPSG",4326]]
>>> Data axis to CRS axis mapping: 2,1
>>> Origin = (6.868800000000000,51.374699999999997)
>>> Pixel Size = (0.000900000000000,-0.000900000000000)
>>> Corner Coordinates:
>>> Upper Left? (?? 6.8688000,? 51.3747000) (? 6d52' 7.68"E, 51d22'28.92"N)
>>> Lower Left? (?? 6.8688000,? 51.3738000) (? 6d52' 7.68"E, 51d22'25.68"N)
>>> Upper Right (?? 6.8697000,? 51.3747000) (? 6d52'10.92"E, 51d22'28.92"N)
>>> Lower Right (?? 6.8697000,? 51.3738000) (? 6d52'10.92"E, 51d22'25.68"N)
>>> Center????? (?? 6.8692500,? 51.3742500) (? 6d52' 9.30"E, 51d22'27.30"N)
>>> Band 1 Block=1x1 Type=Byte, ColorInterp=Red
>>
>> gdalinfo of*/tmp/dummy_file_for_gdal.vrt.png* is:
>>
>>> Driver: PNG/Portable Network Graphics
>>> Files: /tmp/dummy_file_for_gdal.vrt.png
>>> Size is 1, 1
>>> Image Structure Metadata:
>>> ? INTERLEAVE=PIXEL
>>> Corner Coordinates:
>>> Upper Left? (??? 0.0,??? 0.0)
>>> Lower Left? (??? 0.0,??? 1.0)
>>> Upper Right (??? 1.0,??? 0.0)
>>> Lower Right (??? 1.0,??? 1.0)
>>> Center????? (??? 0.5,??? 0.5)
>>> Band 1 Block=1x1 Type=Byte, ColorInterp=Red
>>> Band 2 Block=1x1 Type=Byte, ColorInterp=Green
>>> Band 3 Block=1x1 Type=Byte, ColorInterp=Blue
>>
>> Thanks,
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> -- 
> http://www.spatialys.com/
> My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240917/010d1c63/attachment.htm>

From even.rouault at spatialys.com  Tue Sep 17 08:16:50 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 17 Sep 2024 17:16:50 +0200
Subject: [gdal-dev] [ERROR]GDAL 3.8.4 on Ubuntu 24.04 could not warp
 after minutes, but GDAL 3.4.1 on Ubuntu 22.04 can?
In-Reply-To: <31c376af-960b-415d-be3e-7f9714b1f244@constructor.university>
References: <bd4e958a-828d-4fb1-a3ac-0b550c5da795@constructor.university>
 <ecad8126-9754-4d1e-83ce-98cd08ed5719@constructor.university>
 <2e16e9b1-798a-4d20-b5d5-4d7df511c4e0@spatialys.com>
 <31c376af-960b-415d-be3e-7f9714b1f244@constructor.university>
Message-ID: <4097abb4-bfad-4ee2-ac20-8aba622479f2@spatialys.com>


Le 17/09/2024 ? 17:08, Huu Bang Pham a ?crit?:
>
> Hi Rouault,
>
> Thanks for your quick reply. However, I'm stuck with GDAL 3.8.4 on 
> Ubuntu 24.04.
>
> Do you have any suggestion / workaround for this issue, in stead of 
> building latest gdal with your fix manually?
>
Increase the VRT size to 10x10 pixels or add "-te 769000 5698000 770000 
5699000" to your gdalwarp invokation


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From shawn.fox at baesystems.us  Wed Sep 18 09:27:06 2024
From: shawn.fox at baesystems.us (Fox, Shawn D (US))
Date: Wed, 18 Sep 2024 16:27:06 +0000
Subject: [gdal-dev] Call to GDALDestroy results in occasional core dump,
 GDAL 3.4.2
Message-ID: <mailman.9.1726676831.32172.gdal-dev@lists.osgeo.org>

Could someone help me understand this sentence from the documentation at gdal.h: Raster C API - GDAL documentation<https://gdal.org/en/latest/api/raster_c_api.html> for the GDALDestroy function?

"Since GDAL 2.4.0, this function may be called by application code, since it is no longer called automatically, on non-MSVC builds, due to ordering problems with respect to automatic destruction of global C++ objects."

What are the ordering problems and why might it be called due to ordering problems?  The statement does state some kind of difference between MSVC and non-MSVC builds. The sentence doesn't clearly state to me whether I should or shouldn't call that function to cleanup. The language in the documentation is ambiguous, and it is not clear to me how important it is to call this method.  Cleaning up seems like a good idea but I could simply free the memory via delete for any object that is returned instead of calling GDALDestroy.

On a RHEL8 build, which is non-MSVC, I am observing segmentation faults.  The errors vary from one execution of the program to another.

Sometimes I observe this error.
corrupted size vs. prev_size in fastbins
Aborted (core dumped)

Other times I observe this one
corrupted double-linked list
Aborted (core dumped)

Our code is not very complex.  It calls GDALRegister in the main thread at the beginning, we perform some CRS transformations during the lifetime of the program, and GDALDestroy from the main thread before exiting.  I do not observe problems with an MSVC build using Visual Studio 2019. If others using GDAL 2.4.x or later on Linux systems could share with me how you handle shutdown and cleanup, I'd appreciate it.

Thanks,
Shawn Fox
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240918/26fffe4e/attachment.htm>

From even.rouault at spatialys.com  Wed Sep 18 09:35:52 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 18 Sep 2024 18:35:52 +0200
Subject: [gdal-dev] Call to GDALDestroy results in occasional core dump,
 GDAL 3.4.2
In-Reply-To: <20240918162712.013BC6144EAD@lists.osgeo.org>
References: <20240918162712.013BC6144EAD@lists.osgeo.org>
Message-ID: <22bd932a-7536-4312-ac04-2f562aaf8b48@spatialys.com>


Le 18/09/2024 ? 18:27, Fox, Shawn D (US) via gdal-dev a ?crit?:
>
> Could someone help me understand this sentence from the documentation 
> at gdal.h: Raster C API ? GDAL documentation 
> <https://gdal.org/en/latest/api/raster_c_api.html> for the GDALDestroy 
> function?
>
> ?Since GDAL 2.4.0, this function may be called by application code, 
> since it is no longer called automatically, on non-MSVC builds, due to 
> ordering problems with respect to automatic destruction of global C++ 
> objects.?
>
> What are the ordering problems and why might it be called due to 
> ordering problems?? The statement does state some kind of difference 
> between MSVC and non-MSVC builds. The sentence doesn?t clearly state 
> to me whether I should or shouldn?t call that function to cleanup. The 
> language in the documentation is ambiguous, and it is not clear to me 
> how important it is to call this method.? Cleaning up seems like a 
> good idea but I could simply free the memory via delete for any object 
> that is returned instead of calling GDALDestroy.
>
You don't necessarily have to call GDALDestroy(). It reclaims various 
static objects allocated by GDAL. Basically it helps for "valgrind 
--leak-check=full" use cases.

The issue that caused it to no longer be registered as a GCC destructor 
function is that if you have for example a static GDALDataset object, it 
was found that GDALDestroy() was called before the destruction of the 
GDALDataset object, which lead to double-free. Cf commit comment of 
https://github.com/OSGeo/gdal/commit/e8c9bea5dbe8e90d01d575f94a040fcaee27c24f

> On a RHEL8 build, which is non-MSVC, I am observing segmentation 
> faults.? The errors vary from one execution of the program to another.
>
Hard to tell the reason. Show the code, use Valgrind.

Check also with ldd that your executable isn't linked to 2 different 
versions of libproj. The error message you mention is typical of that 
situation

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240918/7c9aa5aa/attachment.htm>

From andrew.bell.ia at gmail.com  Wed Sep 18 17:00:30 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Wed, 18 Sep 2024 20:00:30 -0400
Subject: [gdal-dev] Call to GDALDestroy results in occasional core dump,
 GDAL 3.4.2
In-Reply-To: <20240918162712.438236144EBE@lists.osgeo.org>
References: <20240918162712.438236144EBE@lists.osgeo.org>
Message-ID: <CACJ51z3dR1GcH0+QX6U9tYcjSpHjUU=1nogpYVrfks+K05NVRQ@mail.gmail.com>

There are many potential causes. Providing code and a backtrace would allow
someone else to look.

On Wed, Sep 18, 2024, 7:28?PM Fox, Shawn D (US) via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Could someone help me understand this sentence from the documentation at gdal.h:
> Raster C API ? GDAL documentation
> <https://gdal.org/en/latest/api/raster_c_api.html> for the GDALDestroy
> function?
>
>
>
> ?Since GDAL 2.4.0, this function may be called by application code, since
> it is no longer called automatically, on non-MSVC builds, due to ordering
> problems with respect to automatic destruction of global C++ objects.?
>
>
>
> What are the ordering problems and why might it be called due to ordering
> problems?  The statement does state some kind of difference between MSVC
> and non-MSVC builds. The sentence doesn?t clearly state to me whether I
> should or shouldn?t call that function to cleanup. The language in the
> documentation is ambiguous, and it is not clear to me how important it is
> to call this method.  Cleaning up seems like a good idea but I could simply
> free the memory via delete for any object that is returned instead of
> calling GDALDestroy.
>
>
>
> On a RHEL8 build, which is non-MSVC, I am observing segmentation faults.
> The errors vary from one execution of the program to another.
>
>
>
> Sometimes I observe this error.
>
> corrupted size vs. prev_size in fastbins
>
> Aborted (core dumped)
>
>
>
> Other times I observe this one
>
> corrupted double-linked list
>
> Aborted (core dumped)
>
>
>
> Our code is not very complex.  It calls GDALRegister in the main thread at
> the beginning, we perform some CRS transformations during the lifetime of
> the program, and GDALDestroy from the main thread before exiting.  I do not
> observe problems with an MSVC build using Visual Studio 2019. If others
> using GDAL 2.4.x or later on Linux systems could share with me how you
> handle shutdown and cleanup, I?d appreciate it.
>
>
>
> Thanks,
>
> Shawn Fox
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240918/56e3d1d4/attachment.htm>

From shawn.fox at baesystems.us  Wed Sep 18 17:32:10 2024
From: shawn.fox at baesystems.us (Fox, Shawn D (US))
Date: Thu, 19 Sep 2024 00:32:10 +0000
Subject: [gdal-dev] Call to GDALDestroy results in occasional core dump,
 GDAL 3.4.2
In-Reply-To: <CACJ51z3dR1GcH0+QX6U9tYcjSpHjUU=1nogpYVrfks+K05NVRQ@mail.gmail.com>
Message-ID: <mailman.10.1726705940.32172.gdal-dev@lists.osgeo.org>

In our case we have a singleton class that acts as a fa?ade and all of our calls to GDAL Apis are done by the methods of this class.  The rest of our code base only interacts with the singleton so that we only have one project that actually depends directly on the GDAL library.  Since the _instance member is a static smart pointer the destructor of our class and the GDALDestroy function is being called after the main function exits.  So it seems like a similar problem that led to this commit, GDALDestroy(): no longer call it automatically on GCC/CLang (non-MSVC? ? OSGeo/gdal at e8c9bea ? GitHub<https://github.com/OSGeo/gdal/commit/e8c9bea5dbe8e90d01d575f94a040fcaee27c24f>.  However I?m not really sure why this is a problem because I am not quite clear about what GDAL destroy does.

I?m really looking for more of a clarification of intent.  How is it supposed to be used?  We have numerous programs that use a singleton class in the same way but not all exhibit this problem.  I?m guessing that the only way to be sure that the core dump does not occur is to find a way to explicitly destroy the object before the return statement of the main function so that we can control when GDALDestroy is called.

Shawn Fox

From: Andrew Bell <andrew.bell.ia at gmail.com>
Sent: Wednesday, September 18, 2024 5:01 PM
To: Fox, Shawn D (US) <shawn.fox at baesystems.us>
Cc: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Call to GDALDestroy results in occasional core dump, GDAL 3.4.2

External Email Alert
This email has been sent from an account outside of the BAE Systems network.
Please treat the email with caution, especially if you are requested to click on a link, decrypt/open an attachment, or enable macros.  For further information on how to spot phishing, access ?Cybersecurity OneSpace Page? and report phishing by clicking the button ?Report Phishing? on the Outlook toolbar.


There are many potential causes. Providing code and a backtrace would allow someone else to look.

On Wed, Sep 18, 2024, 7:28?PM Fox, Shawn D (US) via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Could someone help me understand this sentence from the documentation at gdal.h: Raster C API ? GDAL documentation<https://gdal.org/en/latest/api/raster_c_api.html> for the GDALDestroy function?

?Since GDAL 2.4.0, this function may be called by application code, since it is no longer called automatically, on non-MSVC builds, due to ordering problems with respect to automatic destruction of global C++ objects.?

What are the ordering problems and why might it be called due to ordering problems?  The statement does state some kind of difference between MSVC and non-MSVC builds. The sentence doesn?t clearly state to me whether I should or shouldn?t call that function to cleanup. The language in the documentation is ambiguous, and it is not clear to me how important it is to call this method.  Cleaning up seems like a good idea but I could simply free the memory via delete for any object that is returned instead of calling GDALDestroy.

On a RHEL8 build, which is non-MSVC, I am observing segmentation faults.  The errors vary from one execution of the program to another.

Sometimes I observe this error.
corrupted size vs. prev_size in fastbins
Aborted (core dumped)

Other times I observe this one
corrupted double-linked list
Aborted (core dumped)

Our code is not very complex.  It calls GDALRegister in the main thread at the beginning, we perform some CRS transformations during the lifetime of the program, and GDALDestroy from the main thread before exiting.  I do not observe problems with an MSVC build using Visual Studio 2019. If others using GDAL 2.4.x or later on Linux systems could share with me how you handle shutdown and cleanup, I?d appreciate it.

Thanks,
Shawn Fox
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/5fbca350/attachment.htm>

From andrew.bell.ia at gmail.com  Wed Sep 18 17:50:28 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Wed, 18 Sep 2024 20:50:28 -0400
Subject: [gdal-dev] Call to GDALDestroy results in occasional core dump,
 GDAL 3.4.2
In-Reply-To: <20240919003220.786266142C89@lists.osgeo.org>
References: <CACJ51z3dR1GcH0+QX6U9tYcjSpHjUU=1nogpYVrfks+K05NVRQ@mail.gmail.com>
 <20240919003220.786266142C89@lists.osgeo.org>
Message-ID: <CACJ51z2+eA02NhranejffyjxZ5qQmqYkJKXNA1rgLkhTe3Kb_w@mail.gmail.com>

On Wed, Sep 18, 2024 at 8:32?PM Fox, Shawn D (US) via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> In our case we have a singleton class that acts as a fa?ade and all of our
> calls to GDAL Apis are done by the methods of this class.  The rest of our
> code base only interacts with the singleton so that we only have one
> project that actually depends directly on the GDAL library.  Since the
> _instance member is a static smart pointer the destructor of our class and
> the GDALDestroy function is being called after the main function exits.
>

This is not a great plan unless you understand exactly the order of things
being destroyed, which is not well-defined between compilation units unless
you have done things to guarantee it. It seems likely that GDALDestroy() is
attempting to free things already destroyed during program tear-down. Since
your program is exiting, I can't imagine you need to call GDALDestroy() at
all.  You could also eliminate this issue by instantiating your GDAL
class-thingee as the first line of your program rather than as a static.

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240918/452881b0/attachment.htm>

From shawn.fox at baesystems.us  Wed Sep 18 18:51:48 2024
From: shawn.fox at baesystems.us (Fox, Shawn D (US))
Date: Thu, 19 Sep 2024 01:51:48 +0000
Subject: [gdal-dev] Call to GDALDestroy results in occasional core dump,
 GDAL 3.4.2
In-Reply-To: <CACJ51z2+eA02NhranejffyjxZ5qQmqYkJKXNA1rgLkhTe3Kb_w@mail.gmail.com>
Message-ID: <mailman.11.1726710789.32172.gdal-dev@lists.osgeo.org>

Just for fun, I changed by code back to cause the crash again.  Now it?s difficult to reproduce but here is the part of the callstack showing where the issue occurs.  The CPLCleanupTLSList function is the function of interest as it loops over some type of list.  Within a conditional it is adding two numbers together in an array offset and testing a pointer to determine whether to free some memory.  This is far down into the weeds of GDAL so I?ve no idea what this function is doing but it?s above my level of understanding of GDAL internals.  We don?t attempt to use any networking capabilities within GDAL as far as I know.  When I get it to crash again I?ll step into it some more to see if something jumps out at me.

#0  0x00007fc79b81e241 in unlink_chunk.isra () from /lib64/libc.so.6
#1  0x00007fc79b81e465 in malloc_consolidate () from /lib64/libc.so.6
#2  0x00007fc79b81fae0 in _int_free () from /lib64/libc.so.6
#3  0x00007fc792ab9708 in VSIFree (pData=0x9bfd40) at cpl_vsisimple.cpp:873
#4  0x00007fc792a78820 in CPLCleanupTLSList (papTLSList=0x7ab950) at cpl_multiproc.cpp:467
#5  0x00007fc792a799ec in CPLCleanupTLS () at cpl_multiproc.cpp:2247
#6  0x00007fc79252667c in GDALDriverManager::~GDALDriverManager (this=0x848ae0, __in_chrg=<optimized out>) at gdaldrivermanager.cpp:274
#7  0x00007fc792526746 in GDALDriverManager::~GDALDriverManager (this=0x848ae0, __in_chrg=<optimized out>) at gdaldrivermanager.cpp:335
#8  0x00007fc792527989 in GDALDestroyDriverManager () at gdaldrivermanager.cpp:915
#9  0x00007fc792520fce in GDALDestroy () at gdaldllmain.cpp:86

Shawn Fox
From: Andrew Bell <andrew.bell.ia at gmail.com>
Sent: Wednesday, September 18, 2024 5:50 PM
To: Fox, Shawn D (US) <shawn.fox at baesystems.us>
Cc: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Call to GDALDestroy results in occasional core dump, GDAL 3.4.2

External Email Alert
This email has been sent from an account outside of the BAE Systems network.
Please treat the email with caution, especially if you are requested to click on a link, decrypt/open an attachment, or enable macros.  For further information on how to spot phishing, access ?Cybersecurity OneSpace Page? and report phishing by clicking the button ?Report Phishing? on the Outlook toolbar.



On Wed, Sep 18, 2024 at 8:32?PM Fox, Shawn D (US) via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
In our case we have a singleton class that acts as a fa?ade and all of our calls to GDAL Apis are done by the methods of this class.  The rest of our code base only interacts with the singleton so that we only have one project that actually depends directly on the GDAL library.  Since the _instance member is a static smart pointer the destructor of our class and the GDALDestroy function is being called after the main function exits.

This is not a great plan unless you understand exactly the order of things being destroyed, which is not well-defined between compilation units unless you have done things to guarantee it. It seems likely that GDALDestroy() is attempting to free things already destroyed during program tear-down. Since your program is exiting, I can't imagine you need to call GDALDestroy() at all.  You could also eliminate this issue by instantiating your GDAL class-thingee as the first line of your program rather than as a static.

--
Andrew Bell
andrew.bell.ia at gmail.com<mailto:andrew.bell.ia at gmail.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/be88a767/attachment.htm>

From even.rouault at spatialys.com  Thu Sep 19 05:53:31 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 19 Sep 2024 14:53:31 +0200
Subject: [gdal-dev] Call to GDALDestroy results in occasional core dump,
 GDAL 3.4.2
In-Reply-To: <20240919015309.BF3036142175@lists.osgeo.org>
References: <20240919015309.BF3036142175@lists.osgeo.org>
Message-ID: <2dbda9fa-6f34-4bd9-b491-cb51e1fbf5e8@spatialys.com>

If your program uses threads, and you don't make sure to wait for their 
termination before calling GDALDestroy, this could explain memory 
corruption if they use GDAL TLS, while GDALDestroy() is cleaning the TLS 
structures. I'll stop random guessing here.

And you can just get rid of the GDALDestroy() call if it is an 
annoyance. It just frees memory, which process termination does anyway. 
It is just there so that no still-reachable memory is reported when 
running under Valgrind or other similar analyzers.

Le 19/09/2024 ? 03:51, Fox, Shawn D (US) via gdal-dev a ?crit?:
>
> Just for fun, I changed by code back to cause the crash again.? Now 
> it?s difficult to reproduce but here is the part of the callstack 
> showing where the issue occurs.? The CPLCleanupTLSList function is the 
> function of interest as it loops over some type of list.? Within a 
> conditional it is adding two numbers together in an array offset and 
> testing a pointer to determine whether to free some memory.? This is 
> far down into the weeds of GDAL so I?ve no idea what this function is 
> doing but it?s above my level of understanding of GDAL internals.? We 
> don?t attempt to use any networking capabilities within GDAL as far as 
> I know.? When I get it to crash again I?ll step into it some more to 
> see if something jumps out at me.
>
> #0? 0x00007fc79b81e241 in unlink_chunk.isra () from /lib64/libc.so.6
>
> #1? 0x00007fc79b81e465 in malloc_consolidate () from /lib64/libc.so.6
>
> #2? 0x00007fc79b81fae0 in _int_free () from /lib64/libc.so.6
>
> #3? 0x00007fc792ab9708 in VSIFree (pData=0x9bfd40) at 
> cpl_vsisimple.cpp:873
>
> #4? 0x00007fc792a78820 in CPLCleanupTLSList (papTLSList=0x7ab950) at 
> cpl_multiproc.cpp:467
>
> #5? 0x00007fc792a799ec in CPLCleanupTLS () at cpl_multiproc.cpp:2247
>
> #6? 0x00007fc79252667c in GDALDriverManager::~GDALDriverManager 
> (this=0x848ae0, __in_chrg=<optimized out>) at gdaldrivermanager.cpp:274
>
> #7? 0x00007fc792526746 in GDALDriverManager::~GDALDriverManager 
> (this=0x848ae0, __in_chrg=<optimized out>) at gdaldrivermanager.cpp:335
>
> #8? 0x00007fc792527989 in GDALDestroyDriverManager () at 
> gdaldrivermanager.cpp:915
>
> #9? 0x00007fc792520fce in GDALDestroy () at gdaldllmain.cpp:86
>
> Shawn Fox
>
> *From:* Andrew Bell <andrew.bell.ia at gmail.com>
> *Sent:* Wednesday, September 18, 2024 5:50 PM
> *To:* Fox, Shawn D (US) <shawn.fox at baesystems.us>
> *Cc:* gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] Call to GDALDestroy results in occasional 
> core dump, GDAL 3.4.2
>
> *_External Email Alert_*
>
> *This email has been sent from an account outside of the BAE Systems 
> network.*
>
> Please treat the email with caution, especially if you are requested 
> to click on a link, decrypt/open an attachment, or enable macros.? For 
> further information on how to spot phishing, access ?Cybersecurity 
> OneSpace Page? and report phishing by clicking the button ?Report 
> Phishing? on the Outlook toolbar.
>
> On Wed, Sep 18, 2024 at 8:32?PM Fox, Shawn D (US) via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>     In our case we have a singleton class that acts as a fa?ade and
>     all of our calls to GDAL Apis are done by the methods of this
>     class.? The rest of our code base only interacts with the
>     singleton so that we only have one project that actually depends
>     directly on the GDAL library.? Since the _instance member is a
>     static smart pointer the destructor of our class and the
>     GDALDestroy function is being called after the main function exits.
>
> This is not a great plan unless you understand exactly the order of 
> things being destroyed, which is not well-defined between compilation 
> units unless you have done things to?guarantee it. It seems likely 
> that GDALDestroy() is attempting to free things already destroyed 
> during program tear-down. Since your program is exiting, I can't 
> imagine you need to call GDALDestroy() at all. You could also 
> eliminate this issue by instantiating your GDAL class-thingee as the 
> first line of your program rather than as a static.
>
> -- 
>
> Andrew Bell
> andrew.bell.ia at gmail.com
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/728d20e8/attachment.htm>

From michkowalczuk at gmail.com  Thu Sep 19 06:59:56 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Thu, 19 Sep 2024 15:59:56 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <DB9PR09MB68871A9EE1EA9C1CEF2355D0FD652@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
 <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
 <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>
 <DB9PR09MB68870C1815445C6C49E40779FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQB9FAtA7jRFTvjWZ=U459szAE_BWh2_HN6t9pdB4rzfhQ@mail.gmail.com>
 <DB9PR09MB68871A9EE1EA9C1CEF2355D0FD652@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQCv6GzepM3fYkgPd-oRcmQRoiiFj5NL_OvJ7=ZhuRfuSQ@mail.gmail.com>

Hi,
After re-thinking this topic, I also came to conclusion that using
BoundingBox tags will not be a satisfactory solution for GDAL users. Maybe
it will better than current, but still poor...
In my opinion the most flexible solution is to provide a list of supported
SRSs by a server, just like in *OGR_L_GetSupportedSRSList for WFS.*
Then add a helper function to generate a valid path for chosen layer
(subdataset), SRS from the list, and providing reprojection of bounding box
if needed (as Jukka suggested in last message in last sentence).
This ensures users to use the full capabilities of the server.

Best,
Micha? Kowalczuk

pt., 13 wrz 2024 o 15:15 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
napisa?(a):

> Hi,
>
>
>
> GDAL is open source, of course you can open a feature request. It will
> then be implemented, closed, of left open eternally.
>
>
>
> What do you plan to write into the feature request? I think that using the
> CRS of the additional BoundingBox is a good default and best for the users
> when they want to get data in that CRS. But if they want to use data in
> some other CRS and their favorite CRS appears in some CRS list in the
> GetCapabilities, even without additional BoundingBox, then they should use
> that for communicating with the WMS server. That?s because the WMS server
> usually sends much better quality maps when it re-projects the source data
> for rendering, compared to the result that is achieved when GDAL warps the
> rasters that it if fetching with GetMaps in another CRS.
>
>
>
> So, after re-thinking your original idea about creating a subdataset from
> each supported CRS is good, but because of potentially thousands of
> subdatasets it may lead to some usability problems. I am not sure if there
> can be some problems in implementation as well. I see that GDAL shows the
> subdatasets with BBOX:
>
>
>
> SUBDATASET_26_NAME=WMS:
> http://localhost:8080/geoserver/ows?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&LAYERS=topp%3Atasmania_state_boundaries&CRS=CRS:84&BBOX=143.83482400000003,-43.648056,148.47914100000003,-39.573891
>
> However, usually there are additional BoundingBoxes only for some of the
> supported CRSs, and for the rest GDAL should probably warp the
> <EX_GeographicBoundingBox>.
>
>
> -Jukka Rahkonen-
>
>
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* perjantai 13. syyskuuta 2024 15.12
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> So, can I open a feature request?
>
>
>
> Best,
>
> Michal Kowalczuk
>
>
>
> W dniu czw., 12.09.2024 o 13:57 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> Your suggestion to utilize the additional layer BBOXes if they exist feels
> good to me, and better than to use the first advertised SRS from the root
> level. Beyond that what can be done with parsing the GetCapabilities is
> limited in my mind, because all projections which are supported may not be
> useful in real life.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* torstai 12. syyskuuta 2024 14.35
>
>
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> So we remain at the point that there is no good method that, using only
> GDAL, will allow to fully use the WMS service without additional work
> related to XML parsing...?
>
>
>
> Best,
>
> Micha? Kowalczuk
>
>
>
> wt., 10 wrz 2024 o 17:06 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> A sample from your link:
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *<Layer queryable="1" opaque="0"> <Name>Rakennustietoruudukko_2017</Name>
> <Title>Rakennustietoruudukko 2017</Title> <Abstract>Tietoa rakennuksista
> 250 x 250m ruudukoissa p??kaupunkiseudulla</Abstract> <KeywordList>
> <Keyword>features</Keyword> <Keyword>Rakennustietoruudukko_2017</Keyword>
> </KeywordList> <CRS>EPSG:3879</CRS> <CRS>CRS:84</CRS>
> <EX_GeographicBoundingBox>
> <westBoundLongitude>24.50112802448554</westBoundLongitude>
> <eastBoundLongitude>25.25849178466466</eastBoundLongitude>
> <southBoundLatitude>60.052265324029165</southBoundLatitude>
> <northBoundLatitude>60.39874702231777</northBoundLatitude>
> </EX_GeographicBoundingBox> <BoundingBox CRS="CRS:84"
> minx="24.50112802448554" miny="60.052265324029165" maxx="25.25849178466466"
> maxy="60.39874702231777"/> <BoundingBox CRS="EPSG:3879" minx="6659998.5"
> miny="2.5472498E7" maxx="6698499.5" maxy="2.551425E7"/> <Style>
> <Name>polygon</Name> <Title>Default polygon style</Title> <Abstract>A
> sample style that just draws out a solid gray interior with a black 1px
> outline</Abstract> <LegendURL width="20" height="20">
> <Format>image/png</Format> <OnlineResource xmlns:xlink="*
> *http://www.w3.org/1999/xlink* <http://www.w3.org/1999/xlink>*"
> xlink:type="simple" xlink:href="*
> *https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017*
> <https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Rakennustietoruudukko_2017>
>
>
> *"/> </LegendURL> </Style> </Layer>*
>
>
>
> wt., 10 wrz 2024 o 17:05 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Ok, now I see the problem. Thank you Jukka for the explanation with a
> sample.
>
> So maybe we can use information from *BoundingBox*?
>
> and generate SUBDATASETS for each combination of Layer and BoundingBox
> definition that is usually defined for "best"/dedicated projections for a
> layer.
>
>
>
> *(7.2.4.6.8 )*
>
> *A Layer may have multiple BoundingBox elements, but each one shall state
> a different CRS (...)*
>
> *A Layer shall not provide a BoundingBox for a CRS it does not support.
> Conversely, a Layer may support CRSs*
>
> *for which it does not provide a BoundingBox: a server that has the
> ability to transform data to different CRSs may*
>
> *choose not to provide an explicit BoundingBox for every possible CRS
> available for each Layer. The server*
>
> *should provide BoundingBox information for at least the native CRS of the
> Layer (that is, the CRS in which the*
>
> *Layer is stored in the server?s database).*
>
>
>
> Best,
>
> Micha?
>
>
>
> W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi
>
>
>
>    - I meant to use CRSs only reported by GetCapabilities. I haven't seen
>    that GetCapabilities returns so many (6782) possible projections...
>
>
>
> I was meaning the same, CRSs reported in GetCapabilities. I used a search
> engine with phrase ?service=WMS&version=1.3.0? and found in three minutes
> many examples, including this one
> kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities.
> If you want to see more, install Geoserver on your computer and have a look
> at the default GetCapabilities.
>
>
>
> Finding the best CRS from WMS GetCapabilities is guesswork. The server
> above is a Finnish one so probably EPSG:3067 is the most native CRS because
> that is what we tend to use in Finland. However, there is also one and only
> one additional BBOX for EPSG:3879 in GetCapabilities, but that would be
> somewhat odd selection for a country-wide CRS. It is also possible that for
> example some CRS of New Zealand does not really work in GetMap of the
> Finnish data even GetCapabilities says it will. But when WMS is configured
> to show a short CRS list then I would trust that they are all good to use.
> Just be aware that the list can also be very long.
>
>
>
> If you start implementing the LIST_ALL_SRS option, it should be noted that
> the service level CRS list applies to all layers, and each layer can add
> more CRSs to the list. Maybe in theory there could be even
> ?crs-list-of-service-root + crs-list-of-group-layer +
> crs-list-of-child-layer?.
>
>
>
> ?7.2.4.6.7 CRS
>
> Every Layer is available in one or more layer coordinate reference
> systems. 6.7.3 discusses the Layer CRS. In
>
> order to indicate which Layer CRSs are available, every named Layer shall
> have at least one <CRS> element that
>
> is either stated explicitly or inherited from a parent Layer. The root
> <Layer> element shall include a sequence of
>
> zero or more CRS elements listing all CRSs that are common to all
> subsidiary layers. A child layer may optionally
>
> add to the list inherited from a parent layer. Any duplication shall be
> ignored by clients.
>
> When a Layer is available in several coordinate reference systems, the
> list of available CRS values shall be
>
> represented as a sequence of <CRS> elements, each of which contains only a
> single CRS name.?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* tiistai 10. syyskuuta 2024 16.32
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
>
>
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> Thank you for your feedback. My comments are below:
>
>
>
> *It means that there are tens of thousands WMS services which support 6782
> different projections for each layer (checked from Geoserver version
> 2.25.3). I would not like them all to be reported as subdatasets.*
>
> I meant to use CRSs only reported by GetCapabilities. I haven't seen that
> GetCapabilities returns so many (6782) possible projections...
>
>
>
> *WMS standard also does not define any default CRS and the first one on
> the list in GetCapabilities does not need to be the best.*
>
> Therefore, the current form of the generating subdatasets names method for
> WMS driver is even more useless, if we have a non-default (not the best)
> projection for the data.
>
>
>
> And the only good way to work with it is to parse XML and generate paths
> manually...
>
>
>
> That's why I favor Even's option to introduce open option
> LIST_ALL_SRS=YES/NO.
>
>
>
> Any more thoughts?
>
>
>
> Micha? Kowalczuk
>
>
>
> wt., 10 wrz 2024 o 15:03 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> WMTS typically supports a rather small number of tilematrices and tiles
> are usually cached, so it makes a lot of sense to advertise the available
> matrices and utilize them. On the other hand WMS maps are created
> on-the-fly and there is very low technical cost on the server side to
> support however many projections. WMS standard also does not define any
> default CRS and the first one on the list in GetCapabilities does not need
> to be the best.
>
>
>
> I guess that Geoserver is the most common WMS server in the world and
> amazingly many Geoservers run with the default settings. It means that
> there are tens of thousands WMS services which support 6782 different
> projections for each layer (checked from Geoserver version 2.25.3). I would
> not like them all to be reported as subdatasets.
>
>
>
> I can see that ogrinfo and the OGC API Features driver report the list of
> supported projections. Test with ogrinfo OAPIF:
> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported SRS:
> OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395,
> EPSG:3857, EPSG:3034, EPSG:3035?
>
> Something similar might be an option for gdalinfo, but still about 6782
> EPSG codes per layer is too much to be viewed by default. Maybe the CRS
> list could be reported under some metadata domain that user could read on
> demand?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> I found that there was a similar issue in 2021 without any specific answer:
>
> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>
>
>
> I wonder if getting SUBDATASETS shouldn't return the result in a similar
> way as it does for WMTS service,
>
> where GDAL generates paths to all layer/tilematrix/tilematrixset
> combination.
>
> For example if layer is available in 3 SRS, GDAL produces 3 subdatasets,
> so using only SUBDATASE_NAME property user has access to all map services
> shared by WMTS server.
>
> In my opinion, GDAL should use the same approach for WMS.
>
>
>
> Does anyone object?
>
> I will then submit a new feature request/bug report.
>
>
>
> Best regards and have a nice day
>
> Micha? Kowalczuk
>
>
>
> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Hi,
>
> Does GDAL provides a method to get supported spatial reference systems by
> WMS service?
>
> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
> (default) SRS from GetCapabilities, so this won't be helpful.
>
> Working with WFS I can get supported SRS using OGR
> *OGR_L_GetSupportedSRSList *function.
>
> Does GDAL offers something similar for WMS, or should I get this
> information from GetCapabilities XML by myself?
>
>
>
> Regards,
>
> Michal
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/cac61615/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Sep 19 07:30:51 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 19 Sep 2024 16:30:51 +0200
Subject: [gdal-dev] WMS supported SRS
In-Reply-To: <CAP+FqQCv6GzepM3fYkgPd-oRcmQRoiiFj5NL_OvJ7=ZhuRfuSQ@mail.gmail.com>
References: <CAP+FqQCp60KHfHyYvBC=ACz7f8hMFGCCy=R=3gk=_LCUr7BeRQ@mail.gmail.com>
 <CAP+FqQB5fi8BkYspGqkJ_FXph_6PEqD-PgRXg5HydXDSEiPtZQ@mail.gmail.com>
 <DB9PR09MB6887E30EA16BE67404241667FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBrUWp_cN0dVh8umro0fgZ+VicTLzrfgJGd=gpfqNbaXA@mail.gmail.com>
 <DB9PR09MB688755B41E661A374C01DDA5FD9A2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQBkdo5p8a6NMqGe+yXg9T_9CSbkePmoy+ZYfocpA4sQVg@mail.gmail.com>
 <CAP+FqQC0-YH6K86g7pB5rBMetanhKyQW7iiuayzGJGJn7ACaiQ@mail.gmail.com>
 <CAP+FqQDYHwALYuD4J6K+GyLP3Rvdgh8dQ7EXVLEL=LLG_QZzYg@mail.gmail.com>
 <DB9PR09MB68870C1815445C6C49E40779FD642@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQB9FAtA7jRFTvjWZ=U459szAE_BWh2_HN6t9pdB4rzfhQ@mail.gmail.com>
 <DB9PR09MB68871A9EE1EA9C1CEF2355D0FD652@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQCv6GzepM3fYkgPd-oRcmQRoiiFj5NL_OvJ7=ZhuRfuSQ@mail.gmail.com>
Message-ID: <2df05e4e-671b-4809-a965-c49ed1911035@spatialys.com>


Le 19/09/2024 ? 15:59, Micha? Kowalczuk via gdal-dev a ?crit?:
> Hi,
> After re-thinking this topic, I also came to conclusion that using 
> BoundingBox tags will not be a satisfactory solution for GDAL users. 
> Maybe it will better than current, but still poor...
> In my opinion the most flexible solution is to provide a list of 
> supported SRSs by a server, just like in *OGR_L_GetSupportedSRSList 
> for?WFS.*
> Then add a helper function to generate a valid path for chosen layer 
> (subdataset), SRS from the list, and providing reprojection of 
> bounding box if needed (as Jukka suggested in last message in last 
> sentence).
> This ensures users to use the full capabilities of the server.

I would suggest adding 2 new virtual methods, something like:

- const GetSupportedSRSListRetType& 
GetSupportedSRSListRetTypeGDALDaset::GetSupportedSRSList()

- std::unique_ptr<GDALDataset> GDALDataset::OpenWithActiveSRS(const 
OGRSpatialReference* poSRS)

The later acts in a different way than OGRLayer::SetActiveSRS(), which 
modifies the active object. For rasters, changing the active SRS changes 
a lot of other proprerties (width, height, geotransform, etc. etc.) 
which are assumed for some of them to be immutable during the life-time 
of an object. So it is probably better to return a new dataset, and I 
suspect would make implementations in most candidate drivers easier.

Cf https://github.com/OSGeo/gdal/pull/6872 where 
OGRLayer::GetSupportedSRSList() was implemented, as a potential source 
of inspiration

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/86502eaf/attachment.htm>

From even.rouault at spatialys.com  Thu Sep 19 11:34:53 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 19 Sep 2024 20:34:53 +0200
Subject: [gdal-dev] Removing Trac wiki content
Message-ID: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>

Hi,

I suggest we complete remove the content from 
https://trac.osgeo.org/gdal/wiki. At this point, it is totally outdated 
compared to gdal.org and useless for most people, and potentially 
causing confusion if someone reaches it. People who would need to access 
those outdated docs for their outdated GDAL builds can still use the 
wayback machine (I've verified it did a decent job at crawling it).

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From j1 at jimenezshaw.com  Thu Sep 19 12:22:45 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 19 Sep 2024 21:22:45 +0200
Subject: [gdal-dev] Removing Trac wiki content
In-Reply-To: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
References: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
Message-ID: <CADRrdKsm_mJ9J28oUue=vR6WopPQQsCv+PtYLeSwnPu5FDw0uw@mail.gmail.com>

I agree

On Thu, 19 Sept 2024, 20:35 Even Rouault via gdal-dev, <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I suggest we complete remove the content from
> https://trac.osgeo.org/gdal/wiki. At this point, it is totally outdated
> compared to gdal.org and useless for most people, and potentially
> causing confusion if someone reaches it. People who would need to access
> those outdated docs for their outdated GDAL builds can still use the
> wayback machine (I've verified it did a decent job at crawling it).
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/0c971d33/attachment.htm>

From even.rouault at spatialys.com  Thu Sep 19 13:53:07 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 19 Sep 2024 22:53:07 +0200
Subject: [gdal-dev] Motion: approve RFC 101 "Raster dataset read-only
 thread-safety"
In-Reply-To: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
References: <39c4a896-b7d1-41b6-8899-f13b552ada26@spatialys.com>
Message-ID: <80bbc736-50a0-49cc-a8e4-00a2107ebd91@spatialys.com>

Motion passed with +1 from PSC members KurtS, JukkaR, JavierJS and me.

Le 11/09/2024 ? 21:26, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I move to approve RFC 101 "Raster dataset read-only thread-safety": 
> https://github.com/OSGeo/gdal/pull/10676
>
> Starting with my +1,
>
> The candidate implementation is available in 
> https://github.com/OSGeo/gdal/pull/10746. While fine tuning it, I 
> realized there were subtleties, related to the fact we use 
> thread-local datasets under the hood, for methods returning a 
> non-"primitive" type, such as a "const char*" whose lifetime is tied 
> to a dataset/band. If we'd get it from a thread-local dataset, and 
> that one would be later evicted from the cache (not very common, but 
> could happen if one would open tons of thread-safe datasets at the 
> same time), then you could have use-after-free issues. For such 
> methods (GetMetadata(), GetMetadataItem(), GetProjectionRef(), etc. as 
> well as GetColorTable() which returns a GDALColorTable pointer, or 
> GetSpatialRef() which returns a OGRSpatialReference*), I've preferred 
> to protect their access with a mutex around the "prototype" dataset 
> passed when constructing GDALMultiThreadedDataset, whose lifetime is 
> at least as long as GDALMultiThreadedDataset (cf commit 
> https://github.com/OSGeo/gdal/pull/10746/commits/849e9cea711efd30c47fd90a7a6b71a75611c1a5#diff-687008dd6e3d5ac8ad05568272746ed75b84de50bde508f78f2d79a6842825c7L428) 
> . Normally such methods aren't called in user code repeatedly, so 
> there should be any noticeable lock contention in practice. The main 
> objective of the RFC which is to be able to issue RasterIO() requests 
> in parallel isn't affected by that. Ah, and one thing I realized is 
> that OGRSpatialReference isn't thread-safe, so I've also added an 
> optional SetThreadSafe() on it, to also use a per-instance mutex in 
> multi-threaded scenarios (cf commit 
> https://github.com/OSGeo/gdal/pull/10746/commits/c7e1862273dd018e58a01f25b21fdff6dbfdd1cd). 
> Multi-threading is hard...
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From dbaston at gmail.com  Thu Sep 19 14:35:00 2024
From: dbaston at gmail.com (Daniel Baston)
Date: Thu, 19 Sep 2024 17:35:00 -0400
Subject: [gdal-dev] Removing Trac wiki content
In-Reply-To: <CADRrdKsm_mJ9J28oUue=vR6WopPQQsCv+PtYLeSwnPu5FDw0uw@mail.gmail.com>
References: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
 <CADRrdKsm_mJ9J28oUue=vR6WopPQQsCv+PtYLeSwnPu5FDw0uw@mail.gmail.com>
Message-ID: <CA+K_q_ocH16FyZkBRQhAmr0JwQYuY359GdJhWnsD51r5EeCRXQ@mail.gmail.com>

+1

Dan

On Thu, Sep 19, 2024 at 3:34?PM Javier Jimenez Shaw via gdal-dev
<gdal-dev at lists.osgeo.org> wrote:
>
> I agree
>
> On Thu, 19 Sept 2024, 20:35 Even Rouault via gdal-dev, <gdal-dev at lists.osgeo.org> wrote:
>>
>> Hi,
>>
>> I suggest we complete remove the content from
>> https://trac.osgeo.org/gdal/wiki. At this point, it is totally outdated
>> compared to gdal.org and useless for most people, and potentially
>> causing confusion if someone reaches it. People who would need to access
>> those outdated docs for their outdated GDAL builds can still use the
>> wayback machine (I've verified it did a decent job at crawling it).
>>
>> Even
>>
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From norman.barker at gmail.com  Thu Sep 19 15:25:03 2024
From: norman.barker at gmail.com (Norman Barker)
Date: Thu, 19 Sep 2024 17:25:03 -0500
Subject: [gdal-dev] Removing Trac wiki content
In-Reply-To: <CA+K_q_ocH16FyZkBRQhAmr0JwQYuY359GdJhWnsD51r5EeCRXQ@mail.gmail.com>
References: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
 <CADRrdKsm_mJ9J28oUue=vR6WopPQQsCv+PtYLeSwnPu5FDw0uw@mail.gmail.com>
 <CA+K_q_ocH16FyZkBRQhAmr0JwQYuY359GdJhWnsD51r5EeCRXQ@mail.gmail.com>
Message-ID: <CAN_Dn-EznCvzC0eQHnRtzVJOOQeDph8hqXP5qact4dbQ1-tv3A@mail.gmail.com>

+1 The old RFCs were useful but as you can get them from the wayback
machine that is fine.

On Thu, Sep 19, 2024 at 4:35?PM Daniel Baston via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> +1
>
> Dan
>
> On Thu, Sep 19, 2024 at 3:34?PM Javier Jimenez Shaw via gdal-dev
> <gdal-dev at lists.osgeo.org> wrote:
> >
> > I agree
> >
> > On Thu, 19 Sept 2024, 20:35 Even Rouault via gdal-dev, <
> gdal-dev at lists.osgeo.org> wrote:
> >>
> >> Hi,
> >>
> >> I suggest we complete remove the content from
> >> https://trac.osgeo.org/gdal/wiki. At this point, it is totally outdated
> >> compared to gdal.org and useless for most people, and potentially
> >> causing confusion if someone reaches it. People who would need to access
> >> those outdated docs for their outdated GDAL builds can still use the
> >> wayback machine (I've verified it did a decent job at crawling it).
> >>
> >> Even
> >>
> >> --
> >> http://www.spatialys.com
> >> My software is free, but my time generally not.
> >>
> >> _______________________________________________
> >> gdal-dev mailing list
> >> gdal-dev at lists.osgeo.org
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/eb59ccaf/attachment.htm>

From even.rouault at spatialys.com  Thu Sep 19 15:26:46 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 20 Sep 2024 00:26:46 +0200
Subject: [gdal-dev] Removing Trac wiki content
In-Reply-To: <CAN_Dn-EznCvzC0eQHnRtzVJOOQeDph8hqXP5qact4dbQ1-tv3A@mail.gmail.com>
References: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
 <CADRrdKsm_mJ9J28oUue=vR6WopPQQsCv+PtYLeSwnPu5FDw0uw@mail.gmail.com>
 <CA+K_q_ocH16FyZkBRQhAmr0JwQYuY359GdJhWnsD51r5EeCRXQ@mail.gmail.com>
 <CAN_Dn-EznCvzC0eQHnRtzVJOOQeDph8hqXP5qact4dbQ1-tv3A@mail.gmail.com>
Message-ID: <c18862c6-2c78-4565-9417-757f3d30cb92@spatialys.com>


Le 20/09/2024 ? 00:25, Norman Barker via gdal-dev a ?crit?:
> +1 The old RFCs were useful but as you can get them from the wayback 
> machine that is fine.

They are all at https://gdal.org/en/latest/development/rfc/index.html 
too, aren't they?

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240920/1c3abc81/attachment.htm>

From norman.barker at gmail.com  Thu Sep 19 15:28:51 2024
From: norman.barker at gmail.com (Norman Barker)
Date: Thu, 19 Sep 2024 17:28:51 -0500
Subject: [gdal-dev] Removing Trac wiki content
In-Reply-To: <c18862c6-2c78-4565-9417-757f3d30cb92@spatialys.com>
References: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
 <CADRrdKsm_mJ9J28oUue=vR6WopPQQsCv+PtYLeSwnPu5FDw0uw@mail.gmail.com>
 <CA+K_q_ocH16FyZkBRQhAmr0JwQYuY359GdJhWnsD51r5EeCRXQ@mail.gmail.com>
 <CAN_Dn-EznCvzC0eQHnRtzVJOOQeDph8hqXP5qact4dbQ1-tv3A@mail.gmail.com>
 <c18862c6-2c78-4565-9417-757f3d30cb92@spatialys.com>
Message-ID: <CAN_Dn-HDYf6D+ke_3a3=6gzHb6F8Wq4YggVUtGU+s2d3rroKMQ@mail.gmail.com>

Thanks Even, I didn't realize that.


On Thu, Sep 19, 2024 at 5:26?PM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 20/09/2024 ? 00:25, Norman Barker via gdal-dev a ?crit :
>
> +1 The old RFCs were useful but as you can get them from the wayback
> machine that is fine.
>
> They are all at https://gdal.org/en/latest/development/rfc/index.html
> too, aren't they?
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/5211a98a/attachment.htm>

From shawn.fox at baesystems.us  Fri Sep 20 08:05:32 2024
From: shawn.fox at baesystems.us (Fox, Shawn D (US))
Date: Fri, 20 Sep 2024 15:05:32 +0000
Subject: [gdal-dev] gdal-dev Digest, Vol 244, Issue 46
In-Reply-To: <mailman.219075.1726754411.32175.gdal-dev@lists.osgeo.org>
Message-ID: <mailman.12.1726844783.32172.gdal-dev@lists.osgeo.org>

I believe I have fixed it by creating a simple struct that can be created in automatic scope of the main function and when it is destructed at the end of the function block it seems to work fine. The problem occurs when we have a static pointer that prevents the destruction of the resources until well after our main function exits. That's one of the downsides of having singleton classes with static instance pointers.  

I think there is a typo in the GDALDestroy documentation.  This statement, "Prior to GDAL 2.4.0, this function should normally be explicitly called by application code if GDAL is dynamically linked (but that does not hurt), since it was automatically called through the unregistration mechanisms of dynamic library loading." Should probably read that "this function should NOT normally be explicitly called.", otherwise the phrase but that does not hurt in parens doesn't make sense.  

I was thinking that something related to TLS must have been destroyed and something called within GDALDestroy might be trying to double free a resource.  There is an occasional error about a linked list being corrupted which is a potential bug.  Regardless of the issues that can happen during static destruction I am not sure how a linked list could be corrupted.   The body of that function where the crash occurs looks straightforward enough.

I just wanted to thank the community for responses and let you know that I have a solution that works for us.  A struct with a  constructor and destructor allowing me to creating something in a block scope to manage cleanup seems to fix the issue.

Shawn Fox 

-----Original Message-----
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of gdal-dev-request at lists.osgeo.org
Sent: Thursday, September 19, 2024 7:00 AM
To: gdal-dev at lists.osgeo.org
Subject: gdal-dev Digest, Vol 244, Issue 46

External Email Alert

This email has been sent from an account outside of the BAE Systems network.

Please treat the email with caution, especially if you are requested to click on a link, decrypt/open an attachment, or enable macros.  For further information on how to spot phishing, access ?Cybersecurity OneSpace Page? and report phishing by clicking the button ?Report Phishing? on the Outlook toolbar.


Send gdal-dev mailing list submissions to
	gdal-dev at lists.osgeo.org

To subscribe or unsubscribe via the World Wide Web, visit
	https://lists.osgeo.org/mailman/listinfo/gdal-dev
or, via email, send a message with subject or body 'help' to
	gdal-dev-request at lists.osgeo.org

You can reach the person managing the list at
	gdal-dev-owner at lists.osgeo.org

When replying, please edit your Subject line so it is more specific than "Re: Contents of gdal-dev digest..."


Today's Topics:

   1. Re: Call to GDALDestroy results in occasional core dump, GDAL
      3.4.2 (Even Rouault)
   2. Re: WMS supported SRS (Micha? Kowalczuk)


----------------------------------------------------------------------

Message: 1
Date: Thu, 19 Sep 2024 14:53:31 +0200
From: Even Rouault <even.rouault at spatialys.com>
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Call to GDALDestroy results in occasional core
	dump, GDAL 3.4.2
Message-ID: <2dbda9fa-6f34-4bd9-b491-cb51e1fbf5e8 at spatialys.com>
Content-Type: text/plain; charset="utf-8"; Format="flowed"

If your program uses threads, and you don't make sure to wait for their termination before calling GDALDestroy, this could explain memory corruption if they use GDAL TLS, while GDALDestroy() is cleaning the TLS structures. I'll stop random guessing here.

And you can just get rid of the GDALDestroy() call if it is an annoyance. It just frees memory, which process termination does anyway. 
It is just there so that no still-reachable memory is reported when running under Valgrind or other similar analyzers.

Le 19/09/2024 ? 03:51, Fox, Shawn D (US) via gdal-dev a ?crit?:
>
> Just for fun, I changed by code back to cause the crash again.? Now 
> it?s difficult to reproduce but here is the part of the callstack 
> showing where the issue occurs.? The CPLCleanupTLSList function is the 
> function of interest as it loops over some type of list.? Within a 
> conditional it is adding two numbers together in an array offset and 
> testing a pointer to determine whether to free some memory.? This is 
> far down into the weeds of GDAL so I?ve no idea what this function is 
> doing but it?s above my level of understanding of GDAL internals.? We 
> don?t attempt to use any networking capabilities within GDAL as far as 
> I know.? When I get it to crash again I?ll step into it some more to 
> see if something jumps out at me.
>
> #0? 0x00007fc79b81e241 in unlink_chunk.isra () from /lib64/libc.so.6
>
> #1? 0x00007fc79b81e465 in malloc_consolidate () from /lib64/libc.so.6
>
> #2? 0x00007fc79b81fae0 in _int_free () from /lib64/libc.so.6
>
> #3? 0x00007fc792ab9708 in VSIFree (pData=0x9bfd40) at
> cpl_vsisimple.cpp:873
>
> #4? 0x00007fc792a78820 in CPLCleanupTLSList (papTLSList=0x7ab950) at
> cpl_multiproc.cpp:467
>
> #5? 0x00007fc792a799ec in CPLCleanupTLS () at cpl_multiproc.cpp:2247
>
> #6? 0x00007fc79252667c in GDALDriverManager::~GDALDriverManager
> (this=0x848ae0, __in_chrg=<optimized out>) at 
> gdaldrivermanager.cpp:274
>
> #7? 0x00007fc792526746 in GDALDriverManager::~GDALDriverManager
> (this=0x848ae0, __in_chrg=<optimized out>) at 
> gdaldrivermanager.cpp:335
>
> #8? 0x00007fc792527989 in GDALDestroyDriverManager () at
> gdaldrivermanager.cpp:915
>
> #9? 0x00007fc792520fce in GDALDestroy () at gdaldllmain.cpp:86
>
> Shawn Fox
>
> *From:* Andrew Bell <andrew.bell.ia at gmail.com>
> *Sent:* Wednesday, September 18, 2024 5:50 PM
> *To:* Fox, Shawn D (US) <shawn.fox at baesystems.us>
> *Cc:* gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] Call to GDALDestroy results in occasional 
> core dump, GDAL 3.4.2
>
> *_External Email Alert_*
>
> *This email has been sent from an account outside of the BAE Systems
> network.*
>
> Please treat the email with caution, especially if you are requested 
> to click on a link, decrypt/open an attachment, or enable macros.? For 
> further information on how to spot phishing, access ?Cybersecurity 
> OneSpace Page? and report phishing by clicking the button ?Report 
> Phishing? on the Outlook toolbar.
>
> On Wed, Sep 18, 2024 at 8:32?PM Fox, Shawn D (US) via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>     In our case we have a singleton class that acts as a fa?ade and
>     all of our calls to GDAL Apis are done by the methods of this
>     class.? The rest of our code base only interacts with the
>     singleton so that we only have one project that actually depends
>     directly on the GDAL library.? Since the _instance member is a
>     static smart pointer the destructor of our class and the
>     GDALDestroy function is being called after the main function exits.
>
> This is not a great plan unless you understand exactly the order of 
> things being destroyed, which is not well-defined between compilation 
> units unless you have done things to?guarantee it. It seems likely 
> that GDALDestroy() is attempting to free things already destroyed 
> during program tear-down. Since your program is exiting, I can't 
> imagine you need to call GDALDestroy() at all. You could also 
> eliminate this issue by instantiating your GDAL class-thingee as the 
> first line of your program rather than as a static.
>
> --
>
> Andrew Bell
> andrew.bell.ia at gmail.com
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

--
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/728d20e8/attachment-0001.htm>

------------------------------

Message: 2
Date: Thu, 19 Sep 2024 15:59:56 +0200
From: Micha? Kowalczuk <michkowalczuk at gmail.com>
To: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Cc: "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] WMS supported SRS
Message-ID:
	<CAP+FqQCv6GzepM3fYkgPd-oRcmQRoiiFj5NL_OvJ7=ZhuRfuSQ at mail.gmail.com>
Content-Type: text/plain; charset="utf-8"

Hi,
After re-thinking this topic, I also came to conclusion that using BoundingBox tags will not be a satisfactory solution for GDAL users. Maybe it will better than current, but still poor...
In my opinion the most flexible solution is to provide a list of supported SRSs by a server, just like in *OGR_L_GetSupportedSRSList for WFS.* Then add a helper function to generate a valid path for chosen layer (subdataset), SRS from the list, and providing reprojection of bounding box if needed (as Jukka suggested in last message in last sentence).
This ensures users to use the full capabilities of the server.

Best,
Micha? Kowalczuk

pt., 13 wrz 2024 o 15:15 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
napisa?(a):

> Hi,
>
>
>
> GDAL is open source, of course you can open a feature request. It will 
> then be implemented, closed, of left open eternally.
>
>
>
> What do you plan to write into the feature request? I think that using 
> the CRS of the additional BoundingBox is a good default and best for 
> the users when they want to get data in that CRS. But if they want to 
> use data in some other CRS and their favorite CRS appears in some CRS 
> list in the GetCapabilities, even without additional BoundingBox, then 
> they should use that for communicating with the WMS server. That?s 
> because the WMS server usually sends much better quality maps when it 
> re-projects the source data for rendering, compared to the result that 
> is achieved when GDAL warps the rasters that it if fetching with GetMaps in another CRS.
>
>
>
> So, after re-thinking your original idea about creating a subdataset 
> from each supported CRS is good, but because of potentially thousands 
> of subdatasets it may lead to some usability problems. I am not sure 
> if there can be some problems in implementation as well. I see that 
> GDAL shows the subdatasets with BBOX:
>
>
>
> SUBDATASET_26_NAME=WMS:
> http://localhost:8080/geoserver/ows?SERVICE=WMS&VERSION=1.3.0&REQUEST=
> GetMap&LAYERS=topp%3Atasmania_state_boundaries&CRS=CRS:84&BBOX=143.834
> 82400000003,-43.648056,148.47914100000003,-39.573891
>
> However, usually there are additional BoundingBoxes only for some of 
> the supported CRSs, and for the rest GDAL should probably warp the 
> <EX_GeographicBoundingBox>.
>
>
> -Jukka Rahkonen-
>
>
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* perjantai 13. syyskuuta 2024 15.12
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> So, can I open a feature request?
>
>
>
> Best,
>
> Michal Kowalczuk
>
>
>
> W dniu czw., 12.09.2024 o 13:57 Rahkonen Jukka < 
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> Your suggestion to utilize the additional layer BBOXes if they exist 
> feels good to me, and better than to use the first advertised SRS from 
> the root level. Beyond that what can be done with parsing the 
> GetCapabilities is limited in my mind, because all projections which 
> are supported may not be useful in real life.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* torstai 12. syyskuuta 2024 14.35
>
>
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> So we remain at the point that there is no good method that, using 
> only GDAL, will allow to fully use the WMS service without additional 
> work related to XML parsing...?
>
>
>
> Best,
>
> Micha? Kowalczuk
>
>
>
> wt., 10 wrz 2024 o 17:06 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> A sample from your link:
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *<Layer queryable="1" opaque="0"> 
> <Name>Rakennustietoruudukko_2017</Name>
> <Title>Rakennustietoruudukko 2017</Title> <Abstract>Tietoa 
> rakennuksista
> 250 x 250m ruudukoissa p??kaupunkiseudulla</Abstract> <KeywordList> 
> <Keyword>features</Keyword> 
> <Keyword>Rakennustietoruudukko_2017</Keyword>
> </KeywordList> <CRS>EPSG:3879</CRS> <CRS>CRS:84</CRS> 
> <EX_GeographicBoundingBox> 
> <westBoundLongitude>24.50112802448554</westBoundLongitude>
> <eastBoundLongitude>25.25849178466466</eastBoundLongitude>
> <southBoundLatitude>60.052265324029165</southBoundLatitude>
> <northBoundLatitude>60.39874702231777</northBoundLatitude>
> </EX_GeographicBoundingBox> <BoundingBox CRS="CRS:84"
> minx="24.50112802448554" miny="60.052265324029165" maxx="25.25849178466466"
> maxy="60.39874702231777"/> <BoundingBox CRS="EPSG:3879" minx="6659998.5"
> miny="2.5472498E7" maxx="6698499.5" maxy="2.551425E7"/> <Style> 
> <Name>polygon</Name> <Title>Default polygon style</Title> <Abstract>A 
> sample style that just draws out a solid gray interior with a black 
> 1px outline</Abstract> <LegendURL width="20" height="20"> 
> <Format>image/png</Format> <OnlineResource xmlns:xlink="*
> *http://www.w3.org/1999/xlink* <http://www.w3.org/1999/xlink>*"
> xlink:type="simple" xlink:href="*
> *https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WM
> S&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&h
> eight=20&layer=Rakennustietoruudukko_2017*
> <https://kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WM
> S&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&h
> eight=20&layer=Rakennustietoruudukko_2017>
>
>
> *"/> </LegendURL> </Style> </Layer>*
>
>
>
> wt., 10 wrz 2024 o 17:05 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Ok, now I see the problem. Thank you Jukka for the explanation with a 
> sample.
>
> So maybe we can use information from *BoundingBox*?
>
> and generate SUBDATASETS for each combination of Layer and BoundingBox 
> definition that is usually defined for "best"/dedicated projections 
> for a layer.
>
>
>
> *(7.2.4.6.8 )*
>
> *A Layer may have multiple BoundingBox elements, but each one shall 
> state a different CRS (...)*
>
> *A Layer shall not provide a BoundingBox for a CRS it does not support.
> Conversely, a Layer may support CRSs*
>
> *for which it does not provide a BoundingBox: a server that has the 
> ability to transform data to different CRSs may*
>
> *choose not to provide an explicit BoundingBox for every possible CRS 
> available for each Layer. The server*
>
> *should provide BoundingBox information for at least the native CRS of 
> the Layer (that is, the CRS in which the*
>
> *Layer is stored in the server?s database).*
>
>
>
> Best,
>
> Micha?
>
>
>
> W dniu wt., 10.09.2024 o 16:07 Rahkonen Jukka < 
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi
>
>
>
>    - I meant to use CRSs only reported by GetCapabilities. I haven't seen
>    that GetCapabilities returns so many (6782) possible projections...
>
>
>
> I was meaning the same, CRSs reported in GetCapabilities. I used a 
> search engine with phrase ?service=WMS&version=1.3.0? and found in 
> three minutes many examples, including this one 
> kartta.hsy.fi/geoserver/asuminen_ja_maankaytto/ows?service=WMS&version=1.3.0&request=GetCapabilities.
> If you want to see more, install Geoserver on your computer and have a 
> look at the default GetCapabilities.
>
>
>
> Finding the best CRS from WMS GetCapabilities is guesswork. The server 
> above is a Finnish one so probably EPSG:3067 is the most native CRS 
> because that is what we tend to use in Finland. However, there is also 
> one and only one additional BBOX for EPSG:3879 in GetCapabilities, but 
> that would be somewhat odd selection for a country-wide CRS. It is 
> also possible that for example some CRS of New Zealand does not really 
> work in GetMap of the Finnish data even GetCapabilities says it will. 
> But when WMS is configured to show a short CRS list then I would trust that they are all good to use.
> Just be aware that the list can also be very long.
>
>
>
> If you start implementing the LIST_ALL_SRS option, it should be noted 
> that the service level CRS list applies to all layers, and each layer 
> can add more CRSs to the list. Maybe in theory there could be even 
> ?crs-list-of-service-root + crs-list-of-group-layer + 
> crs-list-of-child-layer?.
>
>
>
> ?7.2.4.6.7 CRS
>
> Every Layer is available in one or more layer coordinate reference 
> systems. 6.7.3 discusses the Layer CRS. In
>
> order to indicate which Layer CRSs are available, every named Layer 
> shall have at least one <CRS> element that
>
> is either stated explicitly or inherited from a parent Layer. The root 
> <Layer> element shall include a sequence of
>
> zero or more CRS elements listing all CRSs that are common to all 
> subsidiary layers. A child layer may optionally
>
> add to the list inherited from a parent layer. Any duplication shall 
> be ignored by clients.
>
> When a Layer is available in several coordinate reference systems, the 
> list of available CRS values shall be
>
> represented as a sequence of <CRS> elements, each of which contains 
> only a single CRS name.?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* tiistai 10. syyskuuta 2024 16.32
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
>
>
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> Thank you for your feedback. My comments are below:
>
>
>
> *It means that there are tens of thousands WMS services which support 
> 6782 different projections for each layer (checked from Geoserver 
> version 2.25.3). I would not like them all to be reported as 
> subdatasets.*
>
> I meant to use CRSs only reported by GetCapabilities. I haven't seen 
> that GetCapabilities returns so many (6782) possible projections...
>
>
>
> *WMS standard also does not define any default CRS and the first one 
> on the list in GetCapabilities does not need to be the best.*
>
> Therefore, the current form of the generating subdatasets names method 
> for WMS driver is even more useless, if we have a non-default (not the 
> best) projection for the data.
>
>
>
> And the only good way to work with it is to parse XML and generate 
> paths manually...
>
>
>
> That's why I favor Even's option to introduce open option 
> LIST_ALL_SRS=YES/NO.
>
>
>
> Any more thoughts?
>
>
>
> Micha? Kowalczuk
>
>
>
> wt., 10 wrz 2024 o 15:03 Rahkonen Jukka < 
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> WMTS typically supports a rather small number of tilematrices and 
> tiles are usually cached, so it makes a lot of sense to advertise the 
> available matrices and utilize them. On the other hand WMS maps are 
> created on-the-fly and there is very low technical cost on the server 
> side to support however many projections. WMS standard also does not 
> define any default CRS and the first one on the list in 
> GetCapabilities does not need to be the best.
>
>
>
> I guess that Geoserver is the most common WMS server in the world and 
> amazingly many Geoservers run with the default settings. It means that 
> there are tens of thousands WMS services which support 6782 different 
> projections for each layer (checked from Geoserver version 2.25.3). I 
> would not like them all to be reported as subdatasets.
>
>
>
> I can see that ogrinfo and the OGC API Features driver report the list 
> of supported projections. Test with ogrinfo OAPIF:
> https://ogc-api.nrw.de/inspire-us-feuerwehr -al -so shows ?Supported SRS:
> OGC:CRS84, EPSG:25832, EPSG:25833, EPSG:4258, EPSG:4326, EPSG:3395, 
> EPSG:3857, EPSG:3034, EPSG:3035?
>
> Something similar might be an option for gdalinfo, but still about 
> 6782 EPSG codes per layer is too much to be viewed by default. Maybe 
> the CRS list could be reported under some metadata domain that user 
> could read on demand?
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Michal Kowalczuk via gdal-dev
> *L?hetetty:* tiistai 10. syyskuuta 2024 15.15
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] WMS supported SRS
>
>
>
> I found that there was a similar issue in 2021 without any specific answer:
>
> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35549.html
>
>
>
> I wonder if getting SUBDATASETS shouldn't return the result in a 
> similar way as it does for WMTS service,
>
> where GDAL generates paths to all layer/tilematrix/tilematrixset 
> combination.
>
> For example if layer is available in 3 SRS, GDAL produces 3 
> subdatasets, so using only SUBDATASE_NAME property user has access to 
> all map services shared by WMTS server.
>
> In my opinion, GDAL should use the same approach for WMS.
>
>
>
> Does anyone object?
>
> I will then submit a new feature request/bug report.
>
>
>
> Best regards and have a nice day
>
> Micha? Kowalczuk
>
>
>
> pon., 9 wrz 2024 o 16:17 Micha? Kowalczuk <michkowalczuk at gmail.com>
> napisa?(a):
>
> Hi,
>
> Does GDAL provides a method to get supported spatial reference systems 
> by WMS service?
>
> *GDALGetMetadata(SUBDATASETS) *generate links only for the first
> (default) SRS from GetCapabilities, so this won't be helpful.
>
> Working with WFS I can get supported SRS using OGR 
> *OGR_L_GetSupportedSRSList *function.
>
> Does GDAL offers something similar for WMS, or should I get this 
> information from GetCapabilities XML by myself?
>
>
>
> Regards,
>
> Michal
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240919/cac61615/attachment.htm>

------------------------------

Subject: Digest Footer

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev


------------------------------

End of gdal-dev Digest, Vol 244, Issue 46
*****************************************

From e.chs at outlook.com  Fri Sep 20 08:09:56 2024
From: e.chs at outlook.com (=?utf-8?B?RWRvdWFyZCBDaG9pbmnDqHJl?=)
Date: Fri, 20 Sep 2024 15:09:56 +0000
Subject: [gdal-dev] Removing Trac wiki content
In-Reply-To: <CAN_Dn-HDYf6D+ke_3a3=6gzHb6F8Wq4YggVUtGU+s2d3rroKMQ@mail.gmail.com>
References: <CAN_Dn-HDYf6D+ke_3a3=6gzHb6F8Wq4YggVUtGU+s2d3rroKMQ@mail.gmail.com>
Message-ID: <CH2PR18MB3368186F32964110040B97BCEF6C2@CH2PR18MB3368.namprd18.prod.outlook.com>

If you think some things are valuable enough to be kept in the internet archive, you can give them a heads up before removing the site completely. Otherwise, there?s also a way to have a Google sheets with all links to save and have them all saved again one last time to help out.


Edouard Choini?re

Le 19 sept. 2024 ? 18:28, Norman Barker <norman.barker at gmail.com> a ?crit :

?
Thanks Even, I didn't realize that.


On Thu, Sep 19, 2024 at 5:26?PM Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:


Le 20/09/2024 ? 00:25, Norman Barker via gdal-dev a ?crit :
+1 The old RFCs were useful but as you can get them from the wayback machine that is fine.

They are all at https://gdal.org/en/latest/development/rfc/index.html too, aren't they?

--
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240920/03c6b6f2/attachment.htm>

From parthivpradeep at gmail.com  Sat Sep 21 22:37:07 2024
From: parthivpradeep at gmail.com (Pradeep kumar)
Date: Sat, 21 Sep 2024 22:37:07 -0700
Subject: [gdal-dev] Issue with GDAL VSICURL Passing Authorization Header to
 Redirected Pre-signed S3 URLs
Message-ID: <CAL9U1Wt_B4pnZ3ZhaK8RKUW=mgEr83a3HrSHZqm3e9Ktf53WFA@mail.gmail.com>

Dear GDAL Developers,


I hope this message finds you well.


I am experiencing an issue with GDAL?s VSICURL virtual file system where
the Authorization header is being passed to redirected pre-signed S3 URLs,
leading to errors when accessing AWS S3.


*Background:*


In my use case, I have a proxy URL that, when called with an Authorization
header, validates the token, verifies authorization, and then generates a
pre-signed URL to an S3 object. The proxy then redirects the client to this
pre-signed URL. When using GDAL with this reverse proxy server and setting
the configuration option --config CPL_VSIL_CURL_USE_S3_REDIRECT NO,
everything works correctly. However, the issue is that GDAL makes too many
round trips, and each time I end up generating a new pre-signed URL.
Ideally, I would like GDAL to send the initial request and then reuse the
pre-signed URLs for subsequent requests.


This desired behavior is achieved with --config
CPL_VSIL_CURL_USE_S3_REDIRECT YES. However, the problem now is that GDAL,
on subsequent requests to the pre-signed URL, is also passing the
Authorization header. I am using the configuration --config
GDAL_HTTP_HEADERS "Authorization: Bearer xxxx" to set the initial header,
so the Authorization header is being sent with every request.


When the Authorization header is sent to AWS S3 along with the pre-signed
URL, AWS returns the following error:


```Only one auth mechanism allowed; only the X-Amz-Algorithm query
parameter, Signature query string parameter or the Authorization header
should be specified.```


*Observed Behavior:*


? *First Request (302 OK):* GDAL sends a request to the proxy URL with the
Authorization header. The proxy validates the token and redirects to the
pre-signed S3 URL. GDAL follows the redirect, and since the pre-signed URL
is accessed without the Authorization header, AWS S3 responds with a *200
OK*. This behavior is as expected.

? *Subsequent Requests (400 Bad Request):* GDAL reuses the pre-signed URL
but includes the Authorization header in the request. AWS S3, seeing both
the pre-signed URL?s query parameters and the Authorization header, returns
a *400 Bad Request* error, stating that only one authentication mechanism
is allowed.


*Expected Behavior:*


I expect that GDAL?s VSICURL should send the initial request with the
Authorization header to the proxy URL. Upon receiving the redirect to the
pre-signed URL, it should not include the Authorization header in
subsequent requests to AWS S3. This would allow AWS S3 to accept the
pre-signed URL without conflicts.


*Questions:*


? Is there a way to configure GDAL so that it does not pass the
Authorization header to the redirected pre-signed URLs while retaining it
for the initial request?

? If this feature is not currently available, would it be feasible to
implement such functionality?

? Are there any plans to address the handling of HTTP redirect response
codes 301 and 307 in future GDAL releases to better support this use case?



*GDAL CLI Command:*


*``` *gdalinfo --debug on --config CPL_CURL_VERBOSE YES --config
GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config
CPL_VSIL_CURL_USE_S3_REDIRECT YES --config
GDAL_HTTP_HEADERS="Authorization: Bearer xxxx" /vsicurl/
https://example.com/stac/collections/items/assets?path=s3://your-bucket/red.tif
 ```


*Example GDAL Logs:*


Below are the GDAL logs illustrating the issue (sensitive information has
been redacted):


*First Request (200 OK):*

*```*

HTTP: libcurl/8.7.1 (SecureTransport) LibreSSL/3.3.6 zlib/1.2.12
nghttp2/1.61.0
HTTP: GDAL was built against curl 8.4.0, but is running against 8.7.1.
CURL_INFO_TEXT: [HTTP/2] [1] OPENED stream for
https://example.com/stac/collections/items/assets?path=s3://your-bucket/red.tif
CURL_INFO_TEXT: [HTTP/2] [1] [:method: HEAD]
CURL_INFO_TEXT: [HTTP/2] [1] [:scheme: https]
CURL_INFO_TEXT: [HTTP/2] [1] [:authority: example.com]
CURL_INFO_TEXT: [HTTP/2] [1] [:path:
/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif]
CURL_INFO_TEXT: [HTTP/2] [1] [user-agent: GDAL/3.9.2]
CURL_INFO_TEXT: [HTTP/2] [1] [accept: */*]
CURL_INFO_TEXT: [HTTP/2] [1] [authorization: Bearer [REDACTED]]
CURL_INFO_HEADER_OUT: HEAD
/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif HTTP/2
Host: example.com
User-Agent: GDAL/3.9.2
Accept: */*
Authorization: Bearer [REDACTED]

CURL_INFO_TEXT: Request completely sent off
CURL_INFO_HEADER_IN: HTTP/2 301
CURL_INFO_HEADER_IN: date: Sun, 22 Sep 2024 04:44:28 GMT
CURL_INFO_HEADER_IN: content-type: text/plain; charset=utf-8
CURL_INFO_HEADER_IN: content-length: 43
CURL_INFO_HEADER_IN: location:
https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
CURL_INFO_HEADER_IN: x-content-length: 176995703
CURL_INFO_HEADER_IN: apigw-requestid: [REDACTED]
CURL_INFO_HEADER_IN:
CURL_INFO_TEXT: Ignoring the response-body
CURL_INFO_TEXT: Connection #0 to host example.com left intact
CURL_INFO_TEXT: Issue another request to this URL: '
https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
'
CURL_INFO_TEXT: Couldn't find host s3-bucket-placeholder in the .netrc
file; using defaults
CURL_INFO_TEXT: Host s3-bucket-placeholder:443 was resolved.
CURL_INFO_TEXT:   Trying [REDACTED]...
CURL_INFO_TEXT: Connected to s3-bucket-placeholder ([REDACTED]) port 443
CURL_INFO_TEXT: SSL connection using TLSv1.3 / [REDACTED]
CURL_INFO_TEXT: Server certificate:
CURL_INFO_TEXT:  subject: CN=*.s3.amazonaws.com
CURL_INFO_TEXT:  start date: Apr 22 00:00:00 2024 GMT
CURL_INFO_TEXT:  expire date: Apr  7 23:59:59 2025 GMT
CURL_INFO_TEXT:  issuer: C=US; O=Amazon; CN=Amazon RSA 2048 M01
CURL_INFO_TEXT:  SSL certificate verify ok.
CURL_INFO_HEADER_OUT: HEAD
/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
HTTP/1.1
Host: s3-bucket-placeholder
User-Agent: GDAL/3.9.2
Accept: */*

CURL_INFO_TEXT: Request completely sent off
CURL_INFO_HEADER_IN: HTTP/1.1 200 OK
CURL_INFO_HEADER_IN: x-amz-id-2: [REDACTED]
CURL_INFO_HEADER_IN: x-amz-request-id: [REDACTED]
CURL_INFO_HEADER_IN: Date: Sun, 22 Sep 2024 04:44:29 GMT
CURL_INFO_HEADER_IN: Last-Modified: Tue, 17 Sep 2024 17:44:40 GMT
CURL_INFO_HEADER_IN: ETag: "[REDACTED]"
CURL_INFO_HEADER_IN: x-amz-server-side-encryption: AES256
CURL_INFO_HEADER_IN: Accept-Ranges: bytes
CURL_INFO_HEADER_IN: Content-Type: image/tiff
CURL_INFO_HEADER_IN: Server: AmazonS3
CURL_INFO_HEADER_IN: Content-Length: 176995703
CURL_INFO_HEADER_IN:
CURL_INFO_TEXT: Connection #1 to host s3-bucket-placeholder left intact
VSICURL: Effective URL:
https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
VSICURL: Will use redirect URL for the next 3599 seconds
VSICURL: GetFileSize(
https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif)=176995703
 response_code=200

```


*Subsequent Request (400 Bad Request):*

*```*

VSICURL: Using redirect URL as it looks to be still valid (3599 seconds
left)
VSICURL: Downloading 0-16383 (
https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868).
..
CURL_INFO_TEXT: Couldn't find host s3-bucket-placeholder in the .netrc
file; using defaults
CURL_INFO_TEXT: Found bundle for host: 0x600001aa8270 [serially]
CURL_INFO_TEXT: Can not multiplex, even if we wanted to
CURL_INFO_TEXT: Re-using existing connection with host s3-bucket-placeholder
CURL_INFO_HEADER_OUT: GET
/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
HTTP/1.1
Host: s3-bucket-placeholder
User-Agent: GDAL/3.9.2
Accept: */*
Authorization: Bearer [REDACTED]
Range: bytes=0-16383

CURL_INFO_TEXT: Request completely sent off
CURL_INFO_HEADER_IN: HTTP/1.1 400 Bad Request
CURL_INFO_HEADER_IN: x-amz-request-id: [REDACTED]
CURL_INFO_HEADER_IN: x-amz-id-2: [REDACTED]
CURL_INFO_HEADER_IN: Content-Type: application/xml
CURL_INFO_HEADER_IN: Transfer-Encoding: chunked
CURL_INFO_HEADER_IN: Date: Sun, 22 Sep 2024 04:44:28 GMT
CURL_INFO_HEADER_IN: Server: AmazonS3
CURL_INFO_HEADER_IN: Connection: close
CURL_INFO_HEADER_IN:
CURL_INFO_TEXT: Closing connection
VSICURL: Got response_code=400
ERROR 4: `/vsicurl/
https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif'
not recognized as being in a supported file format.
gdalinfo failed - unable to open '/vsicurl/
https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif
'.

```

*Additional Information:*


If you require any further details or clarification, please let me know. I
would be happy to provide more information. Additionally, if necessary, I
can create an issue on the GDAL GitHub repository to track this problem.


Thank you very much for your time and assistance. I appreciate any guidance
or suggestions you can provide to help resolve this issue.


Best Regards,
Pradeep Gulla
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240921/e6711ffb/attachment-0001.htm>

From even.rouault at spatialys.com  Sun Sep 22 05:07:38 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 22 Sep 2024 14:07:38 +0200
Subject: [gdal-dev] Issue with GDAL VSICURL Passing Authorization Header
 to Redirected Pre-signed S3 URLs
In-Reply-To: <CAL9U1Wt_B4pnZ3ZhaK8RKUW=mgEr83a3HrSHZqm3e9Ktf53WFA@mail.gmail.com>
References: <CAL9U1Wt_B4pnZ3ZhaK8RKUW=mgEr83a3HrSHZqm3e9Ktf53WFA@mail.gmail.com>
Message-ID: <32ae25ed-cb4a-4d8d-b007-570e2adc1f14@spatialys.com>

Hi Pradeep

Can you give a try to https://github.com/OSGeo/gdal/pull/10857 ?

Even

Le 22/09/2024 ? 07:37, Pradeep kumar via gdal-dev a ?crit?:
>
> Dear GDAL Developers,
>
>
> I hope this message finds you well.
>
>
> I am experiencing an issue with GDAL?s VSICURL virtual file system 
> where the Authorization header is being passed to redirected 
> pre-signed S3 URLs, leading to errors when accessing AWS S3.
>
>
> *Background:*
>
>
> In my use case, I have a proxy URL that, when called with an 
> Authorization header, validates the token, verifies authorization, and 
> then generates a pre-signed URL to an S3 object. The proxy then 
> redirects the client to this pre-signed URL. When using GDAL with this 
> reverse proxy server and setting the configuration option --config 
> CPL_VSIL_CURL_USE_S3_REDIRECT NO, everything works correctly. However, 
> the issue is that GDAL makes too many round trips, and each time I end 
> up generating a new pre-signed URL. Ideally, I would like GDAL to send 
> the initial request and then reuse the pre-signed URLs for subsequent 
> requests.
>
>
> This desired behavior is achieved with --config 
> CPL_VSIL_CURL_USE_S3_REDIRECT YES. However, the problem now is that 
> GDAL, on subsequent requests to the pre-signed URL, is also passing 
> the Authorization header. I am using the configuration --config 
> GDAL_HTTP_HEADERS "Authorization: Bearer xxxx" to set the initial 
> header, so the Authorization header is being sent with every request.
>
>
> When the Authorization header is sent to AWS S3 along with the 
> pre-signed URL, AWS returns the following error:
>
>
> ```Only one auth mechanism allowed; only the X-Amz-Algorithm query 
> parameter, Signature query string parameter or the Authorization 
> header should be specified.```
>
>
> *Observed Behavior:*
>
>
> ?*First Request (302 OK):* GDAL sends a request to the proxy URL with 
> the Authorization header. The proxy validates the token and redirects 
> to the pre-signed S3 URL. GDAL follows the redirect, and since the 
> pre-signed URL is accessed without the Authorization header, AWS S3 
> responds with a *200 OK*. This behavior is as expected.
>
> ?*Subsequent Requests (400 Bad Request):* GDAL reuses the pre-signed 
> URL but includes the Authorization header in the request. AWS S3, 
> seeing both the pre-signed URL?s query parameters and the 
> Authorization header, returns a *400 Bad Request* error, stating that 
> only one authentication mechanism is allowed.
>
>
> *Expected Behavior:*
>
>
> I expect that GDAL?s VSICURL should send the initial request with the 
> Authorization header to the proxy URL. Upon receiving the redirect to 
> the pre-signed URL, it should not include the Authorization header in 
> subsequent requests to AWS S3. This would allow AWS S3 to accept the 
> pre-signed URL without conflicts.
>
>
> *Questions:*
>
>
> ?Is there a way to configure GDAL so that it does not pass the 
> Authorization header to the redirected pre-signed URLs while retaining 
> it for the initial request?
>
> ?If this feature is not currently available, would it be feasible to 
> implement such functionality?
>
> ?Are there any plans to address the handling of HTTP redirect response 
> codes 301 and 307 in future GDAL releases to better support this use case?
>
>
>
> *GDAL CLI Command:*
>
> *
> *
>
> *``` *gdalinfo --debug on --config CPL_CURL_VERBOSE YES --config 
> GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config 
> CPL_VSIL_CURL_USE_S3_REDIRECT YES --config 
> GDAL_HTTP_HEADERS="Authorization: Bearer xxxx" 
> /vsicurl/https://example.com/stac/collections/items/assets?path=s3://your-bucket/red.tif?```
>
>
> *Example GDAL Logs:*
>
>
> Below are the GDAL logs illustrating the issue (sensitive information 
> has been redacted):
>
>
> *First Request (200 OK):*
>
> *```*
>
> HTTP: libcurl/8.7.1 (SecureTransport) LibreSSL/3.3.6 zlib/1.2.12 
> nghttp2/1.61.0
> HTTP: GDAL was built against curl 8.4.0, but is running against 8.7.1.
> CURL_INFO_TEXT: [HTTP/2] [1] OPENED stream for 
> https://example.com/stac/collections/items/assets?path=s3://your-bucket/red.tif
> CURL_INFO_TEXT: [HTTP/2] [1] [:method: HEAD]
> CURL_INFO_TEXT: [HTTP/2] [1] [:scheme: https]
> CURL_INFO_TEXT: [HTTP/2] [1] [:authority: example.com 
> <http://example.com>]
> CURL_INFO_TEXT: [HTTP/2] [1] [:path: 
> /stac/collections/items/assets/foo?path=s3://your-bucket/red.tif]
> CURL_INFO_TEXT: [HTTP/2] [1] [user-agent: GDAL/3.9.2]
> CURL_INFO_TEXT: [HTTP/2] [1] [accept: */*]
> CURL_INFO_TEXT: [HTTP/2] [1] [authorization: Bearer [REDACTED]]
> CURL_INFO_HEADER_OUT: HEAD 
> /stac/collections/items/assets/foo?path=s3://your-bucket/red.tif HTTP/2
> Host: example.com <http://example.com>
> User-Agent: GDAL/3.9.2
> Accept: */*
> Authorization: Bearer [REDACTED]
>
> CURL_INFO_TEXT: Request completely sent off
> CURL_INFO_HEADER_IN: HTTP/2 301
> CURL_INFO_HEADER_IN: date: Sun, 22 Sep 2024 04:44:28 GMT
> CURL_INFO_HEADER_IN: content-type: text/plain; charset=utf-8
> CURL_INFO_HEADER_IN: content-length: 43
> CURL_INFO_HEADER_IN: location: 
> https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868 
> <https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868>
> CURL_INFO_HEADER_IN: x-content-length: 176995703
> CURL_INFO_HEADER_IN: apigw-requestid: [REDACTED]
> CURL_INFO_HEADER_IN:
> CURL_INFO_TEXT: Ignoring the response-body
> CURL_INFO_TEXT: Connection #0 to host example.com <http://example.com> 
> left intact
> CURL_INFO_TEXT: Issue another request to this URL: 
> 'https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868 
> <https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868>'
> CURL_INFO_TEXT: Couldn't find host s3-bucket-placeholder in the .netrc 
> file; using defaults
> CURL_INFO_TEXT: Host s3-bucket-placeholder:443 was resolved.
> CURL_INFO_TEXT: ? Trying [REDACTED]...
> CURL_INFO_TEXT: Connected to s3-bucket-placeholder ([REDACTED]) port 443
> CURL_INFO_TEXT: SSL connection using TLSv1.3 / [REDACTED]
> CURL_INFO_TEXT: Server certificate:
> CURL_INFO_TEXT: ?subject: CN=*.s3.amazonaws.com <http://s3.amazonaws.com>
> CURL_INFO_TEXT: ?start date: Apr 22 00:00:00 2024 GMT
> CURL_INFO_TEXT: ?expire date: Apr ?7 23:59:59 2025 GMT
> CURL_INFO_TEXT: ?issuer: C=US; O=Amazon; CN=Amazon RSA 2048 M01
> CURL_INFO_TEXT: ?SSL certificate verify ok.
> CURL_INFO_HEADER_OUT: HEAD 
> /red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868 
> HTTP/1.1
> Host: s3-bucket-placeholder
> User-Agent: GDAL/3.9.2
> Accept: */*
>
> CURL_INFO_TEXT: Request completely sent off
> CURL_INFO_HEADER_IN: HTTP/1.1 200 OK
> CURL_INFO_HEADER_IN: x-amz-id-2: [REDACTED]
> CURL_INFO_HEADER_IN: x-amz-request-id: [REDACTED]
> CURL_INFO_HEADER_IN: Date: Sun, 22 Sep 2024 04:44:29 GMT
> CURL_INFO_HEADER_IN: Last-Modified: Tue, 17 Sep 2024 17:44:40 GMT
> CURL_INFO_HEADER_IN: ETag: "[REDACTED]"
> CURL_INFO_HEADER_IN: x-amz-server-side-encryption: AES256
> CURL_INFO_HEADER_IN: Accept-Ranges: bytes
> CURL_INFO_HEADER_IN: Content-Type: image/tiff
> CURL_INFO_HEADER_IN: Server: AmazonS3
> CURL_INFO_HEADER_IN: Content-Length: 176995703
> CURL_INFO_HEADER_IN:
> CURL_INFO_TEXT: Connection #1 to host s3-bucket-placeholder left intact
> VSICURL: Effective URL: 
> https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868 
> <https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868>
> VSICURL: Will use redirect URL for the next 3599 seconds
> VSICURL: 
> GetFileSize(https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif)=176995703 
> ?response_code=200*
> *
>
> ```
>
>
> *Subsequent Request (400 Bad Request):*
>
> *```*
>
> VSICURL: Using redirect URL as it looks to be still valid (3599 
> seconds left)
> VSICURL: Downloading 0-16383 
> (https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868). 
> <https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868).>..
> CURL_INFO_TEXT: Couldn't find host s3-bucket-placeholder in the .netrc 
> file; using defaults
> CURL_INFO_TEXT: Found bundle for host: 0x600001aa8270 [serially]
> CURL_INFO_TEXT: Can not multiplex, even if we wanted to
> CURL_INFO_TEXT: Re-using existing connection with host 
> s3-bucket-placeholder
> CURL_INFO_HEADER_OUT: GET 
> /red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868 
> HTTP/1.1
> Host: s3-bucket-placeholder
> User-Agent: GDAL/3.9.2
> Accept: */*
> Authorization: Bearer [REDACTED]
> Range: bytes=0-16383
>
> CURL_INFO_TEXT: Request completely sent off
> CURL_INFO_HEADER_IN: HTTP/1.1 400 Bad Request
> CURL_INFO_HEADER_IN: x-amz-request-id: [REDACTED]
> CURL_INFO_HEADER_IN: x-amz-id-2: [REDACTED]
> CURL_INFO_HEADER_IN: Content-Type: application/xml
> CURL_INFO_HEADER_IN: Transfer-Encoding: chunked
> CURL_INFO_HEADER_IN: Date: Sun, 22 Sep 2024 04:44:28 GMT
> CURL_INFO_HEADER_IN: Server: AmazonS3
> CURL_INFO_HEADER_IN: Connection: close
> CURL_INFO_HEADER_IN:
> CURL_INFO_TEXT: Closing connection
> VSICURL: Got response_code=400
> ERROR 4: 
> `/vsicurl/https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif' 
> not recognized as being in a supported file format.
> gdalinfo failed - unable to open 
> '/vsicurl/https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif'.*
> *
>
> ```
>
> *Additional Information:*
>
>
> If you require any further details or clarification, please let me 
> know. I would be happy to provide more information. Additionally, if 
> necessary, I can create an issue on the GDAL GitHub repository to 
> track this problem.
>
>
> Thank you very much for your time and assistance. I appreciate any 
> guidance or suggestions you can provide to help resolve this issue.
>
>
> Best Regards,
> Pradeep Gulla
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240922/88689968/attachment-0001.htm>

From even.rouault at spatialys.com  Sun Sep 22 06:43:03 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 22 Sep 2024 15:43:03 +0200
Subject: [gdal-dev] Removing Trac wiki content
In-Reply-To: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
References: <e62855be-8517-4f86-a8ec-b2a619be5b88@spatialys.com>
Message-ID: <502cac4c-cc91-40d7-9d41-9016cd03ffde@spatialys.com>

Hi,

wiki now gone (I've deleted pages I could navigate through, and removed 
permissions to unauthenticated users to display the wiki)

I've noted a few URLs of potential interset in 
https://github.com/OSGeo/gdal/commit/1bd433312e51c4a47d004bfea08116e458a3fa87 
in case we would need them...

Even

Le 19/09/2024 ? 20:34, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I suggest we complete remove the content from 
> https://trac.osgeo.org/gdal/wiki. At this point, it is totally 
> outdated compared to gdal.org and useless for most people, and 
> potentially causing confusion if someone reaches it. People who would 
> need to access those outdated docs for their outdated GDAL builds can 
> still use the wayback machine (I've verified it did a decent job at 
> crawling it).
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From parthivpradeep at gmail.com  Sun Sep 22 17:18:24 2024
From: parthivpradeep at gmail.com (Pradeep kumar)
Date: Sun, 22 Sep 2024 17:18:24 -0700
Subject: [gdal-dev] Issue with GDAL VSICURL Passing Authorization Header
 to Redirected Pre-signed S3 URLs
In-Reply-To: <32ae25ed-cb4a-4d8d-b007-570e2adc1f14@spatialys.com>
References: <CAL9U1Wt_B4pnZ3ZhaK8RKUW=mgEr83a3HrSHZqm3e9Ktf53WFA@mail.gmail.com>
 <32ae25ed-cb4a-4d8d-b007-570e2adc1f14@spatialys.com>
Message-ID: <CAL9U1WtdV7Ldg5WuhUQV2BLcPKOTsJewcnpxX-+C7TaK9azezg@mail.gmail.com>

Hi Even,


Thank you very much for quickly looking into this issue and providing a
fix. I appreciate your prompt response and assistance.


I?ve tested the with `GDAL 3.10.0dev-58cc577359, released 2024/09/22 (debug
build)`, and the following command is now working without any issues:


```

gdalinfo --debug on \
         --config CPL_CURL_VERBOSE YES \
         --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR \
         --config CPL_VSIL_CURL_USE_HEAD NO \
         --config GDAL_HTTP_HEADERS="Authorization: Bearer xxxx" \
         /vsicurl/
https://example.com/stac/collections/items/assets?path=s3://your-bucket/red.tif

```

This has resolved the problem I was encountering with the Authorization
header being passed to the redirected pre-signed S3 URLs.


Thank you again for your help and for the excellent support. Your work is
greatly appreciated.


Best regards,


Pradeep Gulla




On Sun, Sep 22, 2024 at 5:07?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi Pradeep
>
> Can you give a try to https://github.com/OSGeo/gdal/pull/10857 ?
>
> Even
> Le 22/09/2024 ? 07:37, Pradeep kumar via gdal-dev a ?crit :
>
> Dear GDAL Developers,
>
>
> I hope this message finds you well.
>
>
> I am experiencing an issue with GDAL?s VSICURL virtual file system where
> the Authorization header is being passed to redirected pre-signed S3
> URLs, leading to errors when accessing AWS S3.
>
>
> *Background:*
>
>
> In my use case, I have a proxy URL that, when called with an Authorization
> header, validates the token, verifies authorization, and then generates a
> pre-signed URL to an S3 object. The proxy then redirects the client to this
> pre-signed URL. When using GDAL with this reverse proxy server and setting
> the configuration option --config CPL_VSIL_CURL_USE_S3_REDIRECT NO,
> everything works correctly. However, the issue is that GDAL makes too many
> round trips, and each time I end up generating a new pre-signed URL.
> Ideally, I would like GDAL to send the initial request and then reuse the
> pre-signed URLs for subsequent requests.
>
>
> This desired behavior is achieved with --config
> CPL_VSIL_CURL_USE_S3_REDIRECT YES. However, the problem now is that GDAL,
> on subsequent requests to the pre-signed URL, is also passing the
> Authorization header. I am using the configuration --config
> GDAL_HTTP_HEADERS "Authorization: Bearer xxxx" to set the initial header,
> so the Authorization header is being sent with every request.
>
>
> When the Authorization header is sent to AWS S3 along with the pre-signed
> URL, AWS returns the following error:
>
>
> ```Only one auth mechanism allowed; only the X-Amz-Algorithm query
> parameter, Signature query string parameter or the Authorization header
> should be specified.```
>
>
> *Observed Behavior:*
>
>
> ? *First Request (302 OK):* GDAL sends a request to the proxy URL with
> the Authorization header. The proxy validates the token and redirects to
> the pre-signed S3 URL. GDAL follows the redirect, and since the pre-signed
> URL is accessed without the Authorization header, AWS S3 responds with a *200
> OK*. This behavior is as expected.
>
> ? *Subsequent Requests (400 Bad Request):* GDAL reuses the pre-signed URL
> but includes the Authorization header in the request. AWS S3, seeing both
> the pre-signed URL?s query parameters and the Authorization header,
> returns a *400 Bad Request* error, stating that only one authentication
> mechanism is allowed.
>
>
> *Expected Behavior:*
>
>
> I expect that GDAL?s VSICURL should send the initial request with the
> Authorization header to the proxy URL. Upon receiving the redirect to the
> pre-signed URL, it should not include the Authorization header in
> subsequent requests to AWS S3. This would allow AWS S3 to accept the
> pre-signed URL without conflicts.
>
>
> *Questions:*
>
>
> ? Is there a way to configure GDAL so that it does not pass the
> Authorization header to the redirected pre-signed URLs while retaining it
> for the initial request?
>
> ? If this feature is not currently available, would it be feasible to
> implement such functionality?
>
> ? Are there any plans to address the handling of HTTP redirect response
> codes 301 and 307 in future GDAL releases to better support this use case?
>
>
>
> *GDAL CLI Command:*
>
>
> *``` *gdalinfo --debug on --config CPL_CURL_VERBOSE YES --config
> GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config
> CPL_VSIL_CURL_USE_S3_REDIRECT YES --config
> GDAL_HTTP_HEADERS="Authorization: Bearer xxxx" /vsicurl/
> https://example.com/stac/collections/items/assets?path=s3://your-bucket/red.tif
>  ```
>
>
> *Example GDAL Logs:*
>
>
> Below are the GDAL logs illustrating the issue (sensitive information has
> been redacted):
>
>
> *First Request (200 OK):*
>
> *```*
>
> HTTP: libcurl/8.7.1 (SecureTransport) LibreSSL/3.3.6 zlib/1.2.12
> nghttp2/1.61.0
> HTTP: GDAL was built against curl 8.4.0, but is running against 8.7.1.
> CURL_INFO_TEXT: [HTTP/2] [1] OPENED stream for
> https://example.com/stac/collections/items/assets?path=s3://your-bucket/red.tif
> CURL_INFO_TEXT: [HTTP/2] [1] [:method: HEAD]
> CURL_INFO_TEXT: [HTTP/2] [1] [:scheme: https]
> CURL_INFO_TEXT: [HTTP/2] [1] [:authority: example.com]
> CURL_INFO_TEXT: [HTTP/2] [1] [:path:
> /stac/collections/items/assets/foo?path=s3://your-bucket/red.tif]
> CURL_INFO_TEXT: [HTTP/2] [1] [user-agent: GDAL/3.9.2]
> CURL_INFO_TEXT: [HTTP/2] [1] [accept: */*]
> CURL_INFO_TEXT: [HTTP/2] [1] [authorization: Bearer [REDACTED]]
> CURL_INFO_HEADER_OUT: HEAD
> /stac/collections/items/assets/foo?path=s3://your-bucket/red.tif HTTP/2
> Host: example.com
> User-Agent: GDAL/3.9.2
> Accept: */*
> Authorization: Bearer [REDACTED]
>
> CURL_INFO_TEXT: Request completely sent off
> CURL_INFO_HEADER_IN: HTTP/2 301
> CURL_INFO_HEADER_IN: date: Sun, 22 Sep 2024 04:44:28 GMT
> CURL_INFO_HEADER_IN: content-type: text/plain; charset=utf-8
> CURL_INFO_HEADER_IN: content-length: 43
> CURL_INFO_HEADER_IN: location:
> https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
> CURL_INFO_HEADER_IN: x-content-length: 176995703
> CURL_INFO_HEADER_IN: apigw-requestid: [REDACTED]
> CURL_INFO_HEADER_IN:
> CURL_INFO_TEXT: Ignoring the response-body
> CURL_INFO_TEXT: Connection #0 to host example.com left intact
> CURL_INFO_TEXT: Issue another request to this URL: '
> https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
> '
> CURL_INFO_TEXT: Couldn't find host s3-bucket-placeholder in the .netrc
> file; using defaults
> CURL_INFO_TEXT: Host s3-bucket-placeholder:443 was resolved.
> CURL_INFO_TEXT:   Trying [REDACTED]...
> CURL_INFO_TEXT: Connected to s3-bucket-placeholder ([REDACTED]) port 443
> CURL_INFO_TEXT: SSL connection using TLSv1.3 / [REDACTED]
> CURL_INFO_TEXT: Server certificate:
> CURL_INFO_TEXT:  subject: CN=*.s3.amazonaws.com
> CURL_INFO_TEXT:  start date: Apr 22 00:00:00 2024 GMT
> CURL_INFO_TEXT:  expire date: Apr  7 23:59:59 2025 GMT
> CURL_INFO_TEXT:  issuer: C=US; O=Amazon; CN=Amazon RSA 2048 M01
> CURL_INFO_TEXT:  SSL certificate verify ok.
> CURL_INFO_HEADER_OUT: HEAD
> /red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
> HTTP/1.1
> Host: s3-bucket-placeholder
> User-Agent: GDAL/3.9.2
> Accept: */*
>
> CURL_INFO_TEXT: Request completely sent off
> CURL_INFO_HEADER_IN: HTTP/1.1 200 OK
> CURL_INFO_HEADER_IN: x-amz-id-2: [REDACTED]
> CURL_INFO_HEADER_IN: x-amz-request-id: [REDACTED]
> CURL_INFO_HEADER_IN: Date: Sun, 22 Sep 2024 04:44:29 GMT
> CURL_INFO_HEADER_IN: Last-Modified: Tue, 17 Sep 2024 17:44:40 GMT
> CURL_INFO_HEADER_IN: ETag: "[REDACTED]"
> CURL_INFO_HEADER_IN: x-amz-server-side-encryption: AES256
> CURL_INFO_HEADER_IN: Accept-Ranges: bytes
> CURL_INFO_HEADER_IN: Content-Type: image/tiff
> CURL_INFO_HEADER_IN: Server: AmazonS3
> CURL_INFO_HEADER_IN: Content-Length: 176995703
> CURL_INFO_HEADER_IN:
> CURL_INFO_TEXT: Connection #1 to host s3-bucket-placeholder left intact
> VSICURL: Effective URL:
> https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
> VSICURL: Will use redirect URL for the next 3599 seconds
> VSICURL: GetFileSize(
> https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif)=176995703
>  response_code=200
>
> ```
>
>
> *Subsequent Request (400 Bad Request):*
>
> *```*
>
> VSICURL: Using redirect URL as it looks to be still valid (3599 seconds
> left)
> VSICURL: Downloading 0-16383 (
> https://s3-bucket-placeholder/red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868).
> ..
> CURL_INFO_TEXT: Couldn't find host s3-bucket-placeholder in the .netrc
> file; using defaults
> CURL_INFO_TEXT: Found bundle for host: 0x600001aa8270 [serially]
> CURL_INFO_TEXT: Can not multiplex, even if we wanted to
> CURL_INFO_TEXT: Re-using existing connection with host
> s3-bucket-placeholder
> CURL_INFO_HEADER_OUT: GET
> /red.tif?response-content-type=image%2Ftiff&AWSAccessKeyId=[REDACTED]&Signature=[REDACTED]&x-amz-security-token=[REDACTED]&Expires=1726983868
> HTTP/1.1
> Host: s3-bucket-placeholder
> User-Agent: GDAL/3.9.2
> Accept: */*
> Authorization: Bearer [REDACTED]
> Range: bytes=0-16383
>
> CURL_INFO_TEXT: Request completely sent off
> CURL_INFO_HEADER_IN: HTTP/1.1 400 Bad Request
> CURL_INFO_HEADER_IN: x-amz-request-id: [REDACTED]
> CURL_INFO_HEADER_IN: x-amz-id-2: [REDACTED]
> CURL_INFO_HEADER_IN: Content-Type: application/xml
> CURL_INFO_HEADER_IN: Transfer-Encoding: chunked
> CURL_INFO_HEADER_IN: Date: Sun, 22 Sep 2024 04:44:28 GMT
> CURL_INFO_HEADER_IN: Server: AmazonS3
> CURL_INFO_HEADER_IN: Connection: close
> CURL_INFO_HEADER_IN:
> CURL_INFO_TEXT: Closing connection
> VSICURL: Got response_code=400
> ERROR 4: `/vsicurl/
> https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif'
> not recognized as being in a supported file format.
> gdalinfo failed - unable to open '/vsicurl/
> https://example.com/stac/collections/items/assets/foo?path=s3://your-bucket/red.tif
> '.
>
> ```
>
> *Additional Information:*
>
>
> If you require any further details or clarification, please let me know. I
> would be happy to provide more information. Additionally, if necessary, I
> can create an issue on the GDAL GitHub repository to track this problem.
>
>
> Thank you very much for your time and assistance. I appreciate any
> guidance or suggestions you can provide to help resolve this issue.
>
>
> Best Regards,
> Pradeep Gulla
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Best Regards,
Pradeep Gulla
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240922/c158aa6f/attachment-0001.htm>

From sean.gillies at gmail.com  Mon Sep 23 09:17:03 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Mon, 23 Sep 2024 10:17:03 -0600
Subject: [gdal-dev] Field type detection by GeoJSON driver in the case of
 untidy data
Message-ID: <CAOodmJoANL0PdS91SY82HverbJ2okd_hHcbb_9hGfmZCzXbGsw@mail.gmail.com>

Hi all,

The good thing about GeoJSON is that you don't need specialized GIS
software to create it. The bad thing about GeoJSON is that people create it
using software with none of the familiar GIS constraints.

I've been looking at a collection of features that have the same set of
properties (good), but one of the properties has a mix of strings (strings
of digits, specifically) and unquoted numbers (0, specifically). In
versions <= 3.5, GDAL detects this field's type to be "String". In versions
>= 3.6, the field type is "String(JSON)". Is this intended behavior? Will
all such fields be found to be "String(JSON)", or does it depend on their
content?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240923/be7246a2/attachment.htm>

From even.rouault at spatialys.com  Mon Sep 23 09:35:21 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 23 Sep 2024 18:35:21 +0200
Subject: [gdal-dev] Field type detection by GeoJSON driver in the case
 of untidy data
In-Reply-To: <CAOodmJoANL0PdS91SY82HverbJ2okd_hHcbb_9hGfmZCzXbGsw@mail.gmail.com>
References: <CAOodmJoANL0PdS91SY82HverbJ2okd_hHcbb_9hGfmZCzXbGsw@mail.gmail.com>
Message-ID: <3d3d6165-476a-46bf-aa16-93f42bdd5c20@spatialys.com>

Sean,

yes if there's a mix of data types, a String(JSON) field is reported to 
mean that.

The only annoying thing is that for backward compatibility with past 
behaviour where we silently homogenized to a string, we didn't go to the 
point to actually quoting strings, so this isn't fully JSON compliant 
unfortunately

I mean if we have out.json with:

{
"type": "FeatureCollection",
"features": [
{ "type": "Feature", "properties": { "foo": "str" }, "geometry": null },
{ "type": "Feature", "properties": { "foo": 0 }, "geometry": null },
{ "type": "Feature", "properties": { "foo": ["a", "b"] }, "geometry": null }
]
}

$ ogrinfo -al out.geojson -q

Layer name: out
OGRFeature(out):0
 ? foo (String(JSON)) = str

OGRFeature(out):1
 ? foo (String(JSON)) = 0

OGRFeature(out):2
 ? foo (String(JSON)) = [ "a", "b" ]

In theory, we should report "str", not just str. A GDAL 4.0 topic... ? 
Just recorded it in 
https://github.com/OSGeo/gdal/issues/8440#issuecomment-2368801316

To actually answer your last question, this is a bit more subtle than 
the above. For example, if there's a mix of strings and array of 
strings, we report a StringList field. If there's a mix of integer and 
floating-point numbers, we report a Real field (which is OK since JSON 
has just a "numeric" type)

Even

Le 23/09/2024 ? 18:17, Sean Gillies via gdal-dev a ?crit?:
> Hi all,
>
> The good thing about GeoJSON is that you don't need specialized GIS 
> software to create it. The bad thing about GeoJSON is that people 
> create it using software with none of the familiar GIS constraints.
>
> I've been looking at a collection of features that have the same set 
> of properties (good), but one of the properties has a mix of strings 
> (strings of digits, specifically) and unquoted numbers (0, 
> specifically). In versions <= 3.5, GDAL detects this field's type to 
> be "String". In versions >= 3.6, the field type is "String(JSON)". Is 
> this intended behavior? Will all such fields be found to be 
> "String(JSON)", or does it depend on their content?
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240923/0d604548/attachment.htm>

From sean.gillies at gmail.com  Mon Sep 23 10:59:58 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Mon, 23 Sep 2024 11:59:58 -0600
Subject: [gdal-dev] Field type detection by GeoJSON driver in the case
 of untidy data
In-Reply-To: <3d3d6165-476a-46bf-aa16-93f42bdd5c20@spatialys.com>
References: <CAOodmJoANL0PdS91SY82HverbJ2okd_hHcbb_9hGfmZCzXbGsw@mail.gmail.com>
 <3d3d6165-476a-46bf-aa16-93f42bdd5c20@spatialys.com>
Message-ID: <CAOodmJr_1MqdkrLwLPE5aFPK0M8zsAkFnPc0sLTv3=yh1V80WQ@mail.gmail.com>

Thanks for the explanation, Even. Makes sense to me.

On Mon, Sep 23, 2024 at 10:35?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Sean,
>
> yes if there's a mix of data types, a String(JSON) field is reported to
> mean that.
>
> The only annoying thing is that for backward compatibility with past
> behaviour where we silently homogenized to a string, we didn't go to the
> point to actually quoting strings, so this isn't fully JSON compliant
> unfortunately
>
> I mean if we have out.json with:
>
> {
> "type": "FeatureCollection",
> "features": [
> { "type": "Feature", "properties": { "foo": "str" }, "geometry": null },
> { "type": "Feature", "properties": { "foo": 0 }, "geometry": null },
> { "type": "Feature", "properties": { "foo": ["a", "b"] }, "geometry": null
> }
> ]
> }
>
> $ ogrinfo -al out.geojson -q
>
> Layer name: out
> OGRFeature(out):0
>   foo (String(JSON)) = str
>
> OGRFeature(out):1
>   foo (String(JSON)) = 0
>
> OGRFeature(out):2
>   foo (String(JSON)) = [ "a", "b" ]
>
> In theory, we should report "str", not just str. A GDAL 4.0 topic... ?
> Just recorded it in
> https://github.com/OSGeo/gdal/issues/8440#issuecomment-2368801316
>
> To actually answer your last question, this is a bit more subtle than the
> above. For example, if there's a mix of strings and array of strings, we
> report a StringList field. If there's a mix of integer and floating-point
> numbers, we report a Real field (which is OK since JSON has just a
> "numeric" type)
>
> Even
> Le 23/09/2024 ? 18:17, Sean Gillies via gdal-dev a ?crit :
>
> Hi all,
>
> The good thing about GeoJSON is that you don't need specialized GIS
> software to create it. The bad thing about GeoJSON is that people create it
> using software with none of the familiar GIS constraints.
>
> I've been looking at a collection of features that have the same set of
> properties (good), but one of the properties has a mix of strings (strings
> of digits, specifically) and unquoted numbers (0, specifically). In
> versions <= 3.5, GDAL detects this field's type to be "String". In versions
> >= 3.6, the field type is "String(JSON)". Is this intended behavior? Will
> all such fields be found to be "String(JSON)", or does it depend on their
> content?
>
> --
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240923/a6a26f28/attachment.htm>

From pujithau at medha.com  Tue Sep 24 03:24:46 2024
From: pujithau at medha.com (Pujitha Uttharkar)
Date: Tue, 24 Sep 2024 15:54:46 +0530
Subject: [gdal-dev] Assistance Required for Downloading GDAL Libraries and
 Dependencies for aarch64 and Static Compilation on LS1046 ARM64 Processor
Message-ID: <1b70312e-19bf-43aa-97cd-34fd54ffb370@medha.com>

Hi,

I hope this message finds you well.

I am reaching out to seek assistance regarding the download and 
compilation of GDAL libraries and their dependencies for the aarch64 
architecture. Specifically, I am working on a project that requires 
static compilation, and I need compatible GDAL libraries and their 
static dependencies for cross-compilation on an LS1046 ARM64-based 
processor, manufactured by NXP.

Despite setting the appropriate environment variables and paths, I 
encountered issues during the cross-compilation process. The error I am 
facing is as follows:

medha at L1429:~/Desktop/data/taws_algorithm/codes/QSI/sep24$ export 
LD_LIBRARY_PATH=/usr/aarch64-linux-gnu/lib:$LD_LIBRARY_PATH
medha at L1429:~/Desktop/data/taws_algorithm/codes/QSI/sep24$ make
aarch64-linux-gnu-g++ findplacefile.o wrapper.o -lgdal 
-L/usr/lib/aarch64-linux-gnu -o my_program
/usr/lib/gcc-cross/aarch64-linux-gnu/9/../../../../aarch64-linux-gnu/bin/ld: 
cannot find /usr/lib/libm.so.6: No such file or directory
/usr/lib/gcc-cross/aarch64-linux-gnu/9/../../../../aarch64-linux-gnu/bin/ld: 
cannot find /usr/lib/libmvec.so.1: No such file or directory
collect2: error: ld returned 1 exit status
make: *** [Makefile:18: my_program] Error 1

It appears that the linker is unable to locate certain standard 
libraries such as libm.so.6 and libmvec.so.1, which are critical for the 
build process.

I would greatly appreciate your guidance on the following:

How to download aarch64-compatible GDAL libraries, along with their 
dependencies.
The process for acquiring static library files for GDAL to facilitate 
static compilation.
Any suggestions or solutions to address the cross-compilation issue 
mentioned above.
The target board I am using is based on the LS1046 processor (ARM64 
architecture) from NXP.

Thank you for your time and assistance. I look forward to your prompt 
response.

-- 
Regards,
Pujitha.U
Medha Servo Drives Pvt. Ltd.
Mobile: +91 6302796207
Email:pujithau at medha.com
web:www.medha.com <https://www.medha.com/>
*******************************************************************************************
Disclaimer:The information contained in this e-mail and/or attachments to it may contain confidential data (or) privileged information of Medha. If you are not the intended recipient, any dissemination, use in any manner, review, distribution, printing, copying of the information contained in this e-mail and/or attachments to it are strictly prohibited. If you have received this communication in error, please notify the sender and immediately delete the message and attachments (if any) permanently.
"Please consider the environment before printing this message."
*******************************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240924/1971a952/attachment.htm>

From gdt at lexort.com  Tue Sep 24 06:04:31 2024
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 24 Sep 2024 09:04:31 -0400
Subject: [gdal-dev] Assistance Required for Downloading GDAL Libraries
 and Dependencies for aarch64 and Static Compilation on LS1046 ARM64
 Processor
In-Reply-To: <1b70312e-19bf-43aa-97cd-34fd54ffb370@medha.com> (Pujitha
 Uttharkar via gdal-dev's message of "Tue, 24 Sep 2024 15:54:46 +0530")
References: <1b70312e-19bf-43aa-97cd-34fd54ffb370@medha.com>
Message-ID: <rmio74dnqxs.fsf@s1.lexort.com>

Cross compilation requires a destdir for the target architecture,
already populated with ilbs and includes.  It looks to me like your
cross environment is not set up correctly - and that's in my view out of
scope for gdal-dev.

I would suggest that you first be able to cross compile a number of
programs other than gdal, and then if you can do that and think there's
a cross bug in gdal, report that.

From even.rouault at spatialys.com  Tue Sep 24 09:22:37 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 24 Sep 2024 18:22:37 +0200
Subject: [gdal-dev] "libertiff" (was Re: Call for review on RFC 101: Raster
 dataset read-only thread-safety)
In-Reply-To: <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
References: <60268c3f-1edd-42fa-9081-6d296aa765a7@spatialys.com>
 <200d8bf3-756c-421b-a036-e87733c2a87a@spatialys.com>
 <CACmBxyto6s=bW2AuMRLTVL_6-u6og_O_bZVj1VfJe6=fZyZXbA@mail.gmail.com>
 <CA+YzLBfUPuFEjs3Bjck6fgPQn3uGvn9-KFh_ihOk8Giz8CzkaQ@mail.gmail.com>
Message-ID: <24d5ad62-50c2-4525-8802-627aa98c6642@spatialys.com>

Hi,

Somewhat related to some of the discussions in that thread, to be able 
to read "uncommon" (to remain polite) GeoTIFF products generated by the 
Sentinel Application Toolbox (https://github.com/OSGeo/gdal/pull/10867), 
I found that using libtiff, libgeotiff or the GDAL GTiff driver wasn't 
going to be practical, so I wrote my own TIFF library, dubbed 
"libertiff": https://github.com/libertiff/libertiff

C++11, no variable argument brain damage like in libtiff, header only, 
read-only, no codec support for now (no actual pixel reading capability 
in fact, just telling you the offset&size of tiles&strips. yes, that's a 
big limitation :-)), thread-safe by design.

Fits in 1,500 lines of code or so: 
https://github.com/libertiff/libertiff/blob/master/libertiff.hpp. Could 
maybe serve as a foundation for a potential future thread-safe read-only 
GDAL GeoTIFF driver.

Even

Le 06/09/2024 ? 21:57, Frank Warmerdam a ?crit?:
> Even,
>
> I'm actually surprised that it is considered impractical to make 
> some/most drivers thread safe (read-only) natively and I thought key 
> ones already were mostly there in the past though I'm not so confident 
> in my memory.? ?Looking through the GTiff code I find myself not able 
> to work out where locking is done and how we are managing the 
> directory loading/switching as block reads are done.
>
> I would certainly like to work towards read-only thread safety for 
> some drivers with:
> ?- a shared block cache for all threads reading from a dataset
> ?- no duplication of file handles per-thread
> ?- a way of checking that a dataset is considered to be thread safe.
>
> I'm curious if you can talk a bit more about the challenges of 
> accomplishing the above.? ?I had been hoping to take advantage of my 
> (assumption) that this already mostly existed in GDAL for our new high 
> performance environment at Planet so it is of more than academic 
> interest to me.? Also, doesn't gdalwarp's multithreading support 
> already depend on read-only thread safety for source files?
>
> The above said, I can also see some utility in RFC 101 and have no 
> objection to it.
>
> Best regards,
> Frank
>
> On Fri, Sep 6, 2024 at 12:45?PM Kurt Schwehr via gdal-dev 
> <gdal-dev at lists.osgeo.org> wrote:
>
>     My take would be to not offer the force option unless there is
>     someone who states they really need it.
>
>     On Fri, Sep 6, 2024 at 6:52?AM Even Rouault via gdal-dev
>     <gdal-dev at lists.osgeo.org> wrote:
>
>         Hi,
>
>         No other reactions? In particular w.r.t. the open question
>         whether it is
>         worth to offer a "force" mode in the situations where a
>         dataset cannot
>         be re-opened (or for a band whose belonging to a dataset
>         cannot be
>         determined) where the thread-safe wrapper would just put a
>         mutex around
>         the calls to that dataset/band (so obviously this wouldn't
>         scale with
>         the number of threads). I'm probably leaning on not offering
>         this option
>         for now, if there's no obvious need it is useful. It can
>         always been
>         added afterwards.
>
>         Even
>
>         Le 29/08/2024 ? 14:26, Even Rouault via gdal-dev a ?crit?:
>         > Hi,
>         >
>         > I've worked on a new RFC 101: Raster dataset read-only
>         thread-safety:
>         > https://github.com/OSGeo/gdal/pull/10676
>         >
>         > Summary: This RFC enables users to get instances of
>         GDALDataset (and
>         > their related objects such as GDALRasterBand) that are
>         thread-safe for
>         > read-only raster operations, that is such instances can be
>         safely used
>         > from multiple threads without locking.
>         >
>         > It is backed by a preliminary implementation (fairly
>         complete, apart
>         > from writing new tests...). There's at least one open
>         question raised
>         > in the RFC.
>         >
>         > PS: you can see one of the benefits of the migration of the
>         doc to
>         > ReadTheDocs hosting, with the preview of the updated
>         documentation in
>         > pull requests. So this is a way to mention that the move to RtD
>         > hosting has now been completed, with the default version
>         ("latest")
>         > reflecting the state of the master branch, as well as the
>         version for
>         > the release/3.9 branch. Thanks to Dan Baston (and other people
>         > involved) for this work! There might be a few adjustments
>         needed, so
>         > if you notice something unusual w.r.t. to the previous
>         state, please
>         > file a ticket.
>         >
>         > Even
>         >
>         -- 
>         http://www.spatialys.com
>         My software is free, but my time generally not.
>
>         _______________________________________________
>         gdal-dev mailing list
>         gdal-dev at lists.osgeo.org
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> -- 
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up ? | Frank Warmerdam, 
> warmerdam at pobox.com
> light and sound - activate the windows | USA: +1 650-701-7823
> and watch the world go round - Rush ? ?| CAN: +1 343-550-9984

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240924/842d9a62/attachment-0001.htm>

