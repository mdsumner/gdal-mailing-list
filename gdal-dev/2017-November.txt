From ari.jolma at gmail.com  Wed Nov  1 02:04:14 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 1 Nov 2017 11:04:14 +0200
Subject: [gdal-dev] WCS 1.1 in GDAL
Message-ID: <08437c2d-f827-aead-351c-5180708616ca@gmail.com>

It seems to me that WCS 1.1 has been dormant and perhaps nobody has 
really used it ever(?).

I just found the gdalgmlcoverage.cpp file in gcore, which is only used 
by the WCS driver and only in its 1.1 part and it hasn't really been 
changed since Frank wrote it ten years ago. I basically rewrote the same 
thing since WCS 2.0 uses GML coverages too.

There are some things in the code that make it look such that it's just 
been there. Also the things I encountered when trying the 1.1.

Interesting.

Ari



From even.rouault at spatialys.com  Wed Nov  1 02:31:07 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 01 Nov 2017 10:31:07 +0100
Subject: [gdal-dev] virtualmem py
In-Reply-To: <CADCcPvvTfSymVaJ-wSOVf6jvtWBZ4FaTx7Su6+JPk2T2FmuneQ@mail.gmail.com>
References: <CADCcPvvTfSymVaJ-wSOVf6jvtWBZ4FaTx7Su6+JPk2T2FmuneQ@mail.gmail.com>
Message-ID: <1547511.Ikpk8Tu6r8@even-i700>

On mercredi 1 novembre 2017 01:00:10 CET Nikolaos Ves wrote:
> Hi All,
> 
> I was experimenting with the GetVirtualMemArray python bindings and I am
> receiving a 'Received a NULL pointer.' error (windows)
> 
> Also, the  tests virtualmem_{1..4} in appveyor are being skipped (and
> they're rigged to skip if the platform is not equal to linux)
> 
> Are the VirtualMemArrays not working in windows?

Yes, there is only Linux implementation currently:
http://gdal.org/cpl__virtualmem_8h.html#details

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/b0420fd6/attachment.html>

From even.rouault at spatialys.com  Wed Nov  1 02:48:15 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 01 Nov 2017 10:48:15 +0100
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
Message-ID: <6093989.p8PumcTCPI@even-i700>

Hi PSC,

Alan has done in the last months a lot of great work (fixes and improvements) in the DXF 
driver, including adding new test cases and updating documentation when needed:
https://trac.osgeo.org/gdal/ticket/7111
https://trac.osgeo.org/gdal/ticket/7106
https://trac.osgeo.org/gdal/ticket/7098
https://trac.osgeo.org/gdal/ticket/7105
https://trac.osgeo.org/gdal/ticket/7099
https://trac.osgeo.org/gdal/ticket/7089
https://trac.osgeo.org/gdal/ticket/7038
https://trac.osgeo.org/gdal/ticket/7006
https://trac.osgeo.org/gdal/ticket/6971

And there are more to come:
https://trac.osgeo.org/gdal/ticket/7120
https://trac.osgeo.org/gdal/ticket/7121
https://trac.osgeo.org/gdal/ticket/7122

So it would be more convenient to grant him direct commit rights.

~~~~

Motion: grant commit rights to Alan Thomas

+1 Even

~~~~~

Alan, could you reply to the list confirming that you agree on
https://trac.osgeo.org/gdal/wiki/rfc3_commiters

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/a225b853/attachment.html>

From robert.coup at koordinates.com  Wed Nov  1 03:17:55 2017
From: robert.coup at koordinates.com (Robert Coup)
Date: Wed, 1 Nov 2017 10:17:55 +0000
Subject: [gdal-dev] OGC announces a new standard that improves the way
 information is referenced to the earth
In-Reply-To: <8FC8B81D-6446-4E90-8580-4EA92379F083@heidelberg-mobil.com>
References: <1509228992087-0.post@n6.nabble.com>
 <b3e9bfcc-8f7b-128b-617f-93ca90864ce8@gmail.com>
 <CANTZQ+ySEW02Bxw0rb2870jur1DveYrBmFh49tgpOsk-9+1kMA@mail.gmail.com>
 <8FC8B81D-6446-4E90-8580-4EA92379F083@heidelberg-mobil.com>
Message-ID: <CAFLLRpJuLk1+xPWNqrOhYWTB296+KhxBQU4DOc2y897hv9tpkw@mail.gmail.com>

On 31 October 2017 at 15:09, Stadin, Benjamin <
Benjamin.Stadin at heidelberg-mobil.com> wrote:

>
> I think there is a real need for such concept, but in my opinion there
> needs to be a default model and algorithms in order to be relevant.
>

I know Pyxis has a pile of patents in this area:
https://www.google.co.uk/search?safe=off&tbm=pts&source=hp&q=Pyxis+innovation

And while OGC members are (AFAIK) required to license/not enforce patents
*directly* relating to specs <http://www.opengeospatial.org/about/ipr>,
this spec specifically isn't an implementation...


> *As with any spatial reference, and especially an approach that is early
> in adoption, intellectual property rights pertaining to various methods of
> creating and using DGGS should be expected. For example, there exist
> multiple patents for indexing DGGS, and the implementers of this Abstract
> Specification should make themselves aware of these patents.Attention is
> drawn to the possibility that some of the elements of this document may be
> the subject of patent rights. *


<cynic> Maybe that's one reason why? </cynic>

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/755832ec/attachment.html>

From even.rouault at spatialys.com  Wed Nov  1 03:32:37 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 01 Nov 2017 11:32:37 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
Message-ID: <1680715.4lzt5iEthT@even-i700>

Hi,

I've add an exchange with Sebastiaan Couwenberg about a schedule that would 
give GDAL 2.2.3 a chance to enter the next Ubuntu LTS 18.04. While the date 
for the import freeze from Debian to Ubuntu is not know yet, based on the last 
release cycle, it seems that a GDAL 2.2.3 released this month would have a 
chance to make it (given other delays in Debian transitionning from 
experimental to unstable)
So I intend cutting a GDAL 2.2.3 release candidate for Nov 20th.
Please raise tickets if there are bug fixes that need to be backported and 
haven't yet been.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/28ba3240/attachment.html>

From even.rouault at spatialys.com  Wed Nov  1 04:02:42 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 01 Nov 2017 12:02:42 +0100
Subject: [gdal-dev] Proposed changed to solve inconsistant spatial filtering
	for null or empty geometries
Message-ID: <1667829.xa35DArXaz@even-i700>

Hi,

Nyall Dawson pointed to me in 
https://github.com/qgis/QGIS/pull/5501#issuecomment-340934947 about a weird behaviour 
of OGR spatial filtering regarding null and empty geometries.

To make it concrete, consider the following CSV file

id,WKT
1,"POLYGON EMPTY"
2,
3,"POLYGON ((0 0,0 1,1 1,0 0))"


$ ogrinfo test.csv -al -spat 0 0 1 1 -q

Layer name: test
OGRFeature(test):1
  id (String) = 1
  WKT (String) = POLYGON EMPTY
  POLYGON EMPTY

OGRFeature(test):2
  id (String) = 2
  WKT (String) = 

OGRFeature(test):3
  id (String) = 3
  WKT (String) = POLYGON ((0 0,0 1,1 1,0 0))
  POLYGON ((0 0,0 1,1 1,0 0))

$ ogrinfo test.csv -al -spat 1 1 2 2 -q

Layer name: test
OGRFeature(test):2
  id (String) = 2
  WKT (String) = 

OGRFeature(test):3
  id (String) = 3
  WKT (String) = POLYGON ((0 0,0 1,1 1,0 0))
  POLYGON ((0 0,0 1,1 1,0 0))

So features with null geometries (FID 2) are always selected. And for a feature with an empty 
geometry (FID 1), it is selected by the -spat 0 0 1 1 filter since internally the envelope of 
POLYGON EMPTY is computed as xmin=xmax=ymin=ymax=0, but not by -spat 1 1 2 2

If ingesting this file into PostGIS and doing the same test, we get:

$ ogrinfo pg:dbname=autotest test -spat 0 0 1 1 -q

Layer name: test
OGRFeature(test):3
  id (String) = 3
  wkt (String) = POLYGON ((0 0,0 1,1 1,0 0))
  POLYGON ((0 0,0 1,1 1,0 0))

$ ogrinfo pg:dbname=autotest test -spat 1 1 2 2 -q

Layer name: test
OGRFeature(test):3
  id (String) = 3
  wkt (String) = POLYGON ((0 0,0 1,1 1,0 0))
  POLYGON ((0 0,0 1,1 1,0 0))

So null or empty geometries are never selected when a spatial filter is set. This last behaviour 
seems to be the most logical for me, and I'd propose we adopt it for non-SQL based drivers 
as well.
(note: the current behaviour dates back to the initial introduction of spatial filtering in OGR 
per https://trac.osgeo.org/gdal/changeset/7191 , 13 years ago )

Any thought ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/31458354/attachment-0001.html>

From ari.jolma at gmail.com  Wed Nov  1 04:05:09 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 1 Nov 2017 13:05:09 +0200
Subject: [gdal-dev] WCS 1.1 in GDAL
In-Reply-To: <08437c2d-f827-aead-351c-5180708616ca@gmail.com>
References: <08437c2d-f827-aead-351c-5180708616ca@gmail.com>
Message-ID: <8c91c9d5-329b-8ba5-c512-bf6f15b873bb@gmail.com>

Ari Jolma kirjoitti 01.11.2017 klo 11:04:
> It seems to me that WCS 1.1 has been dormant and perhaps nobody has 
> really used it ever(?).
>
> I just found the gdalgmlcoverage.cpp file in gcore, which is only used 
> by the WCS driver and only in its 1.1 part 

Actually, in 1.0, since 1.1 does not seem to use the gml:RectifiedGrid, 
however, 2.0 uses it again.

Anyway, the question is, should gdalgmlcoverage.cpp be in the gcore? The 
GDAL sources are sometimes confusing. For example there is gmlutils.cpp 
- which is used in WCS because of GML_IsSRSLatLongOrder, but that is 
ogr/ogrsf_frmts/gml.

> and it hasn't really been changed since Frank wrote it ten years ago. 
> I basically rewrote the same thing since WCS 2.0 uses GML coverages too.
>
> There are some things in the code that make it look such that it's 
> just been there. Also the things I encountered when trying the 1.1.
>
> Interesting.
>
> Ari
>
>


From ari.jolma at gmail.com  Wed Nov  1 04:15:56 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 1 Nov 2017 13:15:56 +0200
Subject: [gdal-dev] Proposed changed to solve inconsistant spatial
 filtering for null or empty geometries
In-Reply-To: <1667829.xa35DArXaz@even-i700>
References: <1667829.xa35DArXaz@even-i700>
Message-ID: <fd7fc33e-785e-f17e-4a92-2e2890a62d74@gmail.com>

Even Rouault kirjoitti 01.11.2017 klo 13:02:
>
> Hi,
>
> Nyall Dawson pointed to me in
>
> https://github.com/qgis/QGIS/pull/5501#issuecomment-340934947 about a 
> weird behaviour of OGR spatial filtering regarding null and empty 
> geometries.
>
...
>
> Any thought ?
>

Yes. Deep ones. If something is 'empty', is it 'a thing'? Can 'nothing' 
exist? Weird things should be expected to behave weirdly.

I would say such things should disappear, i.e., the PostGIS behavior is 
logical.

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/5d292aa2/attachment.html>

From even.rouault at spatialys.com  Wed Nov  1 04:20:52 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 01 Nov 2017 12:20:52 +0100
Subject: [gdal-dev] WCS 1.1 in GDAL
In-Reply-To: <8c91c9d5-329b-8ba5-c512-bf6f15b873bb@gmail.com>
References: <08437c2d-f827-aead-351c-5180708616ca@gmail.com>
 <8c91c9d5-329b-8ba5-c512-bf6f15b873bb@gmail.com>
Message-ID: <2151402.RHCuToJjIP@even-i700>

On mercredi 1 novembre 2017 13:05:09 CET Ari Jolma wrote:
> Ari Jolma kirjoitti 01.11.2017 klo 11:04:
> > It seems to me that WCS 1.1 has been dormant and perhaps nobody has
> > really used it ever(?).
> > 
> > I just found the gdalgmlcoverage.cpp file in gcore, which is only used
> > by the WCS driver and only in its 1.1 part
> 
> Actually, in 1.0, since 1.1 does not seem to use the gml:RectifiedGrid,
> however, 2.0 uses it again.
> 
> Anyway, the question is, should gdalgmlcoverage.cpp be in the gcore? 

Feel free to move it to frmts/wcs as it only used by it. You'd probably want to remove the 
declaration of it from gcore/gdal_priv.h as well.
Looking at GDALParseGMLCoverage() code, I see a "GDALJP2Metadata" remaining 
CPLDebug message, but it is no longer used by the GMLJP2 code which has a specialized 
version of it now. You may have a look at GDALJP2Metadata::ParseGMLCoverageDesc() in 
gcore/gdaljp2metadata.cpp by the way, in particular the logic for axis inversion around lines 
1055-1089. Note: there are also stuff specific of GMLJP2 issues at the end of the function, so 
I would *not* recommend blindly porting all this.

> The
> GDAL sources are sometimes confusing. For example there is gmlutils.cpp
> - which is used in WCS

In your in-progress work I suppose. Can't see that in trunk.
Could probably make sense to move it in ogr/  then  (we have already ogr/
gml2ogrgeometry.cpp and ogr2gmlgeometry.cpp there)

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/2dcd7b96/attachment.html>

From edzer.pebesma at uni-muenster.de  Wed Nov  1 04:54:52 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 1 Nov 2017 12:54:52 +0100
Subject: [gdal-dev] Proposed changed to solve inconsistant spatial
 filtering for null or empty geometries
In-Reply-To: <fd7fc33e-785e-f17e-4a92-2e2890a62d74@gmail.com>
References: <1667829.xa35DArXaz@even-i700>
 <fd7fc33e-785e-f17e-4a92-2e2890a62d74@gmail.com>
Message-ID: <d637d8b6-4bf0-ece2-2726-37e67649c683@uni-muenster.de>



On 11/01/2017 12:15 PM, Ari Jolma wrote:
> Even Rouault kirjoitti 01.11.2017 klo 13:02:
>>
>> Hi,
>>
>>  
>>
>> Nyall Dawson pointed to me in
>>
>> https://github.com/qgis/QGIS/pull/5501#issuecomment-340934947 about a
>> weird behaviour of OGR spatial filtering regarding null and empty
>> geometries.
>>
> ...
>>
>>  
>>
>>  
>>
>> Any thought ?
>>
> 
> Yes. Deep ones. If something is 'empty', is it 'a thing'? Can 'nothing'
> exist? Weird things should be expected to behave weirdly.

I think of it as the "there is no such thing for which ..." answer to
the question "is there a thing for which ...", e.g. if you'd do a left
join with a spatial predicate and there is no match.

And I agree, "no such thing" should never come out of a spatial filter.

I never understood the value of having all these typed EMPTYs in SFA,
and whether/how they'd differ from NULL geometries in OGR.

> 
> I would say such things should disappear, i.e., the PostGIS behavior is
> logical.
> 
> Ari
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From edzer.pebesma at uni-muenster.de  Wed Nov  1 05:12:24 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 1 Nov 2017 13:12:24 +0100
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <3223231.5ieHiColEd@even-i700>
References: <2435502.MieFYiu8dg@even-i700>
 <56b8d5e3-91e0-a0e8-14e7-3aa59c0121f3@gmail.com>
 <231b3eab-5c7c-747f-1406-50259d80be16@uni-muenster.de>
 <3223231.5ieHiColEd@even-i700>
Message-ID: <b999913f-7651-5db9-77fc-f2964e7aacbb@uni-muenster.de>



On 10/26/2017 07:25 PM, Even Rouault wrote:
>> More in general, we have multidimensional arrays where horizontal space
> 
>> is not an x y image (GDAL raster band) but for instance a sequence of
> 
>> feature geometries (e.g., in situ sensor data, or demographic data by
> 
>> administrative region, time, and age class).
> 
>  
> 
> I didn't grasp what you meant there. This doesn't sound like gridded
> data, does it ? Can you point to such datasets ?

Not gridded in space, but gridded in spacetime. Examples would be, for
point geometries the EEA air quality database [1], where static station
properties come in one file, and measured air quality measurements (time
series) come in other files, for many parameters; an example where
geometries are regions would be any socio-economic data; concrete
example [2] for each county you'd have a time series of population
counts by age class (2-dimensional array for each county).

[1]
https://www.eea.europa.eu/data-and-maps/data/airbase-the-european-air-quality-database-7
[2] https://www.census.gov/data/tables/2016/demo/popest/counties-total.html

Also look for OLAP cube; the concept is quite old, and not restricted to
spatially gridded data. But I'm happy to restrict the discussion here
(first) to spatially gridded data.

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov  1 05:57:35 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 1 Nov 2017 12:57:35 +0000
Subject: [gdal-dev] Question about GeoPackage and views
Message-ID: <3b9648af5eb84e6da6cc3869654ff279@C119S212VM042.msvyvi.vaha.local>

Hi,

I was reading the GeoPackage standard and only now read carefully the requirement 29

"A GeoPackage MAY contain tables or updateable views containing vector features. Every such
feature table or view in a GeoPackage SHALL have a column with column type INTEGER and
'PRIMARY KEY AUTOINCREMENT' column constraints"

Should I really read this so that GeoPackage MUST NOT contain non-updateable views, or at least they cannot be included in the standard  gpkg_contents and gpkg_geometry_columns tables but used only through some extension?

Writable views in SQLite are not too simple to create, see for example https://www.gaia-gis.it/fossil/libspatialite/wiki?name=writable-view
However, even read-only views could be very handy from the users and data providers point of view :).

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/856f6d77/attachment-0001.html>

From even.rouault at spatialys.com  Wed Nov  1 06:05:43 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 01 Nov 2017 14:05:43 +0100
Subject: [gdal-dev] Question about GeoPackage and views
In-Reply-To: <3b9648af5eb84e6da6cc3869654ff279@C119S212VM042.msvyvi.vaha.local>
References: <3b9648af5eb84e6da6cc3869654ff279@C119S212VM042.msvyvi.vaha.local>
Message-ID: <4295646.F9N5Ttn5sF@even-i700>

On mercredi 1 novembre 2017 12:57:35 CET Rahkonen Jukka (MML) wrote:
> Hi,
> 
> I was reading the GeoPackage standard and only now read carefully the
> requirement 29
> 
> "A GeoPackage MAY contain tables or updateable views containing vector
> features. Every such feature table or view in a GeoPackage SHALL have a
> column with column type INTEGER and 'PRIMARY KEY AUTOINCREMENT' column
> constraints"
> 
> Should I really read this so that GeoPackage MUST NOT contain non-updateable
> views, or at least they cannot be included in the standard  gpkg_contents
> and gpkg_geometry_columns tables but used only through some extension?

Hi Jukka,

Good question. There's a related ticket in
https://github.com/opengeospatial/geopackage/issues/207

Anyway it is difficult currently to support updatable or non-updatable views since there's no 
reliable way to figure out the FID column for a view, as there's no equivalent of Spatialite's 
views_geometry_columns

GDAL's implementation:
"""Starting with GDAL 2.2, in the case of the columns in the SELECT clause of the view acts a 
integer primary key, then it can be recognized by OGR as the FID column of the view, 
provided it is renamed as OGC_FID. Selecting a feature id from a source table without 
renaming will not be sufficient, since due to joins this feature id could appear several times. 
Thus the user must explicitly acknowledge that the column is really a primary key."""

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/6f20d878/attachment.html>

From athomas at thinkspatial.com.au  Wed Nov  1 06:24:49 2017
From: athomas at thinkspatial.com.au (Alan Thomas)
Date: Thu, 2 Nov 2017 00:24:49 +1100
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <6093989.p8PumcTCPI@even-i700>
References: <6093989.p8PumcTCPI@even-i700>
Message-ID: <CALhO07y-ZWFqFg0u4Pdcn7vdvrmrsOoJ-T_eoDSdYAkGXEzw2Q@mail.gmail.com>

Thanks, Even, for moving the motion.

Yes, I agree with https://trac.osgeo.org/gdal/wiki/rfc3_commiters.

Alan

On 1 November 2017 at 20:48, Even Rouault <even.rouault at spatialys.com> wrote:
> Hi PSC,
>
>
>
> Alan has done in the last months a lot of great work (fixes and
> improvements) in the DXF driver, including adding new test cases and
> updating documentation when needed:
>
> https://trac.osgeo.org/gdal/ticket/7111
>
> https://trac.osgeo.org/gdal/ticket/7106
>
> https://trac.osgeo.org/gdal/ticket/7098
>
> https://trac.osgeo.org/gdal/ticket/7105
>
> https://trac.osgeo.org/gdal/ticket/7099
>
> https://trac.osgeo.org/gdal/ticket/7089
>
> https://trac.osgeo.org/gdal/ticket/7038
>
> https://trac.osgeo.org/gdal/ticket/7006
>
> https://trac.osgeo.org/gdal/ticket/6971
>
>
>
> And there are more to come:
>
> https://trac.osgeo.org/gdal/ticket/7120
>
> https://trac.osgeo.org/gdal/ticket/7121
>
> https://trac.osgeo.org/gdal/ticket/7122
>
>
>
> So it would be more convenient to grant him direct commit rights.
>
>
>
> ~~~~
>
>
>
> Motion: grant commit rights to Alan Thomas
>
>
>
> +1 Even
>
>
>
> ~~~~~
>
>
>
> Alan, could you reply to the list confirming that you agree on
>
> https://trac.osgeo.org/gdal/wiki/rfc3_commiters
>
>
>
> Best regards,
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com



-- 
Alan Thomas
Software Developer
ThinkSpatial
http://www.thinkspatial.com.au

From nfarah at hotmail.com  Wed Nov  1 06:44:53 2017
From: nfarah at hotmail.com (N. Farah)
Date: Wed, 1 Nov 2017 13:44:53 +0000
Subject: [gdal-dev] Open Jpeg 2.3.0 and OPJ_NUM_THREADS
In-Reply-To: <BLUPR11MB0449C6B5AEF4673D9D418FBCDD5E0@BLUPR11MB0449.namprd11.prod.outlook.com>
References: <BLUPR11MB0449FDC9BAC24D90C9B7B50EDD5E0@BLUPR11MB0449.namprd11.prod.outlook.com>,
 <1857027.MWOT6xa53n@even-i700>,
 <BLUPR11MB0449C6B5AEF4673D9D418FBCDD5E0@BLUPR11MB0449.namprd11.prod.outlook.com>
Message-ID: <BLUPR11MB0449176A0C3896936525B785DD5F0@BLUPR11MB0449.namprd11.prod.outlook.com>

Looking at https://trac.osgeo.org/gdal/browser/trunk/gdal/frmts/openjpeg/openjpegdataset.cpp?rev=40418


I now see the GDAL made changes to enable multi-threading.


Thanks

Noureddine Farah

________________________________
From: N. Farah <nfarah at hotmail.com>
Sent: Tuesday, October 31, 2017 3:50:15 PM
To: Even Rouault; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Open Jpeg 2.3.0 and OPJ_NUM_THREADS


Thanks for the quick response. I'm not using latest GDAL and was curious where that multi-threading enabling was made ? Was it some where in GDAL code or through an option in the openjpeg 2.3.0 API ?


Thanks

Noureddine Farah

________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Tuesday, October 31, 2017 3:47:01 PM
To: gdal-dev at lists.osgeo.org
Cc: N. Farah
Subject: Re: [gdal-dev] Open Jpeg 2.3.0 and OPJ_NUM_THREADS


On mardi 31 octobre 2017 19:39:23 CET N. Farah wrote:

> Hi,

>

>

> In http://gdal.org/frmt_jp2openjpeg.html under 'Thread Support' section

> there is the following:

>

> "Starting with GDAL 2.3, this multi-threading at code-block level is

> automatically enabled by GDAL".

>

>

> Was meant "Starting with OpenJpeg 2.3, ..." ?



No, was meant starting with GDAL 2.3 (the current dev version). And that requires openjpeg >= 2.2 as well.



>

> If yes, was that enabling made in the 'OpenJpeg 2.3' library or was made in

> GDAL ?



openjpeg >= 2.2 (actually 2.1.2, but I restricted to 2.2 or later) brings multithreading decoding at codeblock level, and GDAL trunk automatically enables it.



So the doc is correct I think, but I know that those similar version numbers between GDAL and openjpeg can be confusing.



Bottom line: use the latest and greatest of both to get the better performance.



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/adff7e5a/attachment.html>

From dmorissette at mapgears.com  Wed Nov  1 07:09:16 2017
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Wed, 1 Nov 2017 10:09:16 -0400
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <6093989.p8PumcTCPI@even-i700>
References: <6093989.p8PumcTCPI@even-i700>
Message-ID: <734b71b8-3ab2-1319-e1ab-804d4beb3d4f@mapgears.com>

+1.   Great to have someone around to look after DXF stuff.

Daniel


On 2017-11-01 5:48 AM, Even Rouault wrote:
> Hi PSC,
> 
> Alan has done in the last months a lot of great work (fixes and 
> improvements) in the DXF driver, including adding new test cases and 
> updating documentation when needed:
> 
> https://trac.osgeo.org/gdal/ticket/7111
> 
> https://trac.osgeo.org/gdal/ticket/7106
> 
> https://trac.osgeo.org/gdal/ticket/7098
> 
> https://trac.osgeo.org/gdal/ticket/7105
> 
> https://trac.osgeo.org/gdal/ticket/7099
> 
> https://trac.osgeo.org/gdal/ticket/7089
> 
> https://trac.osgeo.org/gdal/ticket/7038
> 
> https://trac.osgeo.org/gdal/ticket/7006
> 
> https://trac.osgeo.org/gdal/ticket/6971
> 
> And there are more to come:
> 
> https://trac.osgeo.org/gdal/ticket/7120
> 
> https://trac.osgeo.org/gdal/ticket/7121
> 
> https://trac.osgeo.org/gdal/ticket/7122
> 
> So it would be more convenient to grant him direct commit rights.
> 
> ~~~~
> 
> Motion: grant commit rights to Alan Thomas
> 
> +1 Even
> 
> ~~~~~
> 
> Alan, could you reply to the list confirming that you agree on
> 
> https://trac.osgeo.org/gdal/wiki/rfc3_commiters
> 
> Best regards,
> 
> Even
> 
> -- 
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From ari.jolma at gmail.com  Wed Nov  1 09:06:53 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 1 Nov 2017 18:06:53 +0200
Subject: [gdal-dev] WCS 1.1 in GDAL
In-Reply-To: <2151402.RHCuToJjIP@even-i700>
References: <08437c2d-f827-aead-351c-5180708616ca@gmail.com>
 <8c91c9d5-329b-8ba5-c512-bf6f15b873bb@gmail.com>
 <2151402.RHCuToJjIP@even-i700>
Message-ID: <13844617-af20-bf5c-217d-a5acfa153e6d@gmail.com>

Even Rouault kirjoitti 01.11.2017 klo 13:20:
>
> On mercredi 1 novembre 2017 13:05:09 CET Ari Jolma wrote:
>
> > Anyway, the question is, should gdalgmlcoverage.cpp be in the gcore?
>
> Feel free to move it to frmts/wcs as it only used by it. You'd 
> probably want to remove the declaration of it from gcore/gdal_priv.h 
> as well.
>

Should be done now ok.

> Looking at GDALParseGMLCoverage() code, I see a "GDALJP2Metadata" 
> remaining CPLDebug message, but it is no longer used by the GMLJP2 
> code which has a specialized version of it now. You may have a look at 
> GDALJP2Metadata::ParseGMLCoverageDesc() in gcore/gdaljp2metadata.cpp 
> by the way, in particular the logic for axis inversion around lines 
> 1055-1089. Note: there are also stuff specific of GMLJP2 issues at the 
> end of the function, so I would *not* recommend blindly porting all this.
>

Thanks for the reminder.

> > The
>
> > GDAL sources are sometimes confusing. For example there is gmlutils.cpp
>
> > - which is used in WCS
>
> In your in-progress work I suppose. Can't see that in trunk.
>
> Could probably make sense to move it in ogr/ then (we have already 
> ogr/gml2ogrgeometry.cpp and ogr2gmlgeometry.cpp there)
>

Yes, I looked around for existing code to check for the axis order swap.

I'm beginning to see light at the end of the tunnel and perhaps could 
really start testing with 2.0.1 servers soon.

There's undocumented "WCS_SDS:" method for accessing WCS servers and 
putting data from different times into bands. I'll need to study that a 
bit and maybe implement same kind of system.

Ari

> -- 
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/3413b397/attachment.html>

From howard at hobu.co  Wed Nov  1 09:49:43 2017
From: howard at hobu.co (Howard Butler)
Date: Wed, 1 Nov 2017 11:49:43 -0500
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <734b71b8-3ab2-1319-e1ab-804d4beb3d4f@mapgears.com>
References: <6093989.p8PumcTCPI@even-i700>
 <734b71b8-3ab2-1319-e1ab-804d4beb3d4f@mapgears.com>
Message-ID: <9CC229AE-70E6-4CE9-8042-D6DD8C17C1BF@hobu.co>

+1

> On Nov 1, 2017, at 9:09 AM, Daniel Morissette <dmorissette at mapgears.com> wrote:
> 
> +1.   Great to have someone around to look after DXF stuff.
> 
> Daniel
> 
> 
> On 2017-11-01 5:48 AM, Even Rouault wrote:
>> Hi PSC,
>> Alan has done in the last months a lot of great work (fixes and improvements) in the DXF driver, including adding new test cases and updating documentation when needed:
>> https://trac.osgeo.org/gdal/ticket/7111
>> https://trac.osgeo.org/gdal/ticket/7106
>> https://trac.osgeo.org/gdal/ticket/7098
>> https://trac.osgeo.org/gdal/ticket/7105
>> https://trac.osgeo.org/gdal/ticket/7099
>> https://trac.osgeo.org/gdal/ticket/7089
>> https://trac.osgeo.org/gdal/ticket/7038
>> https://trac.osgeo.org/gdal/ticket/7006
>> https://trac.osgeo.org/gdal/ticket/6971
>> And there are more to come:
>> https://trac.osgeo.org/gdal/ticket/7120
>> https://trac.osgeo.org/gdal/ticket/7121
>> https://trac.osgeo.org/gdal/ticket/7122
>> So it would be more convenient to grant him direct commit rights.
>> ~~~~
>> Motion: grant commit rights to Alan Thomas
>> +1 Even
>> ~~~~~
>> Alan, could you reply to the list confirming that you agree on
>> https://trac.osgeo.org/gdal/wiki/rfc3_commiters
>> Best regards,
>> Even
>> -- 
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> -- 
> Daniel Morissette
> Mapgears Inc
> T: +1 418-696-5056 #201
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From jmckenna at gatewaygeomatics.com  Wed Nov  1 11:26:16 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 1 Nov 2017 15:26:16 -0300
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <1680715.4lzt5iEthT@even-i700>
References: <1680715.4lzt5iEthT@even-i700>
Message-ID: <8780fbd3-af94-c284-732f-7198df568d54@gatewaygeomatics.com>

On 2017-11-01 7:32 AM, Even Rouault wrote:
> Hi,
> 
> I've add an exchange with Sebastiaan Couwenberg about a schedule that 
> would give GDAL 2.2.3 a chance to enter the next Ubuntu LTS 18.04. While 
> the date for the import freeze from Debian to Ubuntu is not know yet, 
> based on the last release cycle, it seems that a GDAL 2.2.3 released 
> this month would have a chance to make it (given other delays in Debian 
> transitionning from experimental to unstable)
> 
> So I intend cutting a GDAL 2.2.3 release candidate for Nov 20th.
> 
> Please raise tickets if there are bug fixes that need to be backported 
> and haven't yet been.
> 
> Even
> 

Hi Even,

Also, it is rarely ever discussed but I find that releases occurring 
near the timing of other projects in the family can be helpful for all 
(users, packagers, developers): MapServer release will be around the 
week of the 15th also, so a Nov 20th GDAL release would be great.  This 
can't always happen, but when it does it is sure nice.  -jeff




From schwehr at gmail.com  Wed Nov  1 13:27:54 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 1 Nov 2017 13:27:54 -0700
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <6093989.p8PumcTCPI@even-i700>
References: <6093989.p8PumcTCPI@even-i700>
Message-ID: <CACmBxytVKiF52p_EKSxeYrv5GUer_Y9r-LE__j581HgzHNyMjw@mail.gmail.com>

+1

On Wed, Nov 1, 2017 at 2:48 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi PSC,
>
>
>
> Alan has done in the last months a lot of great work (fixes and
> improvements) in the DXF driver, including adding new test cases and
> updating documentation when needed:
>
> https://trac.osgeo.org/gdal/ticket/7111
>
> https://trac.osgeo.org/gdal/ticket/7106
>
> https://trac.osgeo.org/gdal/ticket/7098
>
> https://trac.osgeo.org/gdal/ticket/7105
>
> https://trac.osgeo.org/gdal/ticket/7099
>
> https://trac.osgeo.org/gdal/ticket/7089
>
> https://trac.osgeo.org/gdal/ticket/7038
>
> https://trac.osgeo.org/gdal/ticket/7006
>
> https://trac.osgeo.org/gdal/ticket/6971
>
>
>
> And there are more to come:
>
> https://trac.osgeo.org/gdal/ticket/7120
>
> https://trac.osgeo.org/gdal/ticket/7121
>
> https://trac.osgeo.org/gdal/ticket/7122
>
>
>
> So it would be more convenient to grant him direct commit rights.
>
>
>
> ~~~~
>
>
>
> Motion: grant commit rights to Alan Thomas
>
>
>
> +1 Even
>
>
>
> ~~~~~
>
>
>
> Alan, could you reply to the list confirming that you agree on
>
> https://trac.osgeo.org/gdal/wiki/rfc3_commiters
>
>
>
> Best regards,
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/7465a634/attachment.html>

From nyall.dawson at gmail.com  Wed Nov  1 13:59:21 2017
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Thu, 2 Nov 2017 06:59:21 +1000
Subject: [gdal-dev] Proposed changed to solve inconsistant spatial
 filtering for null or empty geometries
In-Reply-To: <1667829.xa35DArXaz@even-i700>
References: <1667829.xa35DArXaz@even-i700>
Message-ID: <CAB28AshzEorDG_hsyS7gzgTFY-01HYmxCXhjLRLa26uNhNLFhQ@mail.gmail.com>

On 1 November 2017 at 21:02, Even Rouault <even.rouault at spatialys.com> wrote:

> So null or empty geometries are never selected when a spatial filter is set.
> This last behaviour seems to be the most logical for me, and I'd propose we
> adopt it for non-SQL based drivers as well.

My 2c is also that empty/null geometries do NOT intersect a filter
rectangle, and so should not be included here.

Nyall

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov  1 14:48:54 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 1 Nov 2017 14:48:54 -0700 (MST)
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <6093989.p8PumcTCPI@even-i700>
References: <6093989.p8PumcTCPI@even-i700>
Message-ID: <1509572934790-0.post@n6.nabble.com>

Even Rouault-2 wrote
> Motion: grant commit rights to Alan Thomas
> 
> +1 Even

+1

-Jukka Rahkonen-




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From szekerest at gmail.com  Wed Nov  1 14:54:08 2017
From: szekerest at gmail.com (Tamas Szekeres)
Date: Wed, 1 Nov 2017 22:54:08 +0100
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <6093989.p8PumcTCPI@even-i700>
References: <6093989.p8PumcTCPI@even-i700>
Message-ID: <CACALY+SCYPVye56ZR4NLdekuzG-DxrTgkyHGE4EW0u5gWE2QKA@mail.gmail.com>

+1

Tamas

2017-11-01 10:48 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:

> Hi PSC,
>
>
>
> Alan has done in the last months a lot of great work (fixes and
> improvements) in the DXF driver, including adding new test cases and
> updating documentation when needed:
>
> https://trac.osgeo.org/gdal/ticket/7111
>
> https://trac.osgeo.org/gdal/ticket/7106
>
> https://trac.osgeo.org/gdal/ticket/7098
>
> https://trac.osgeo.org/gdal/ticket/7105
>
> https://trac.osgeo.org/gdal/ticket/7099
>
> https://trac.osgeo.org/gdal/ticket/7089
>
> https://trac.osgeo.org/gdal/ticket/7038
>
> https://trac.osgeo.org/gdal/ticket/7006
>
> https://trac.osgeo.org/gdal/ticket/6971
>
>
>
> And there are more to come:
>
> https://trac.osgeo.org/gdal/ticket/7120
>
> https://trac.osgeo.org/gdal/ticket/7121
>
> https://trac.osgeo.org/gdal/ticket/7122
>
>
>
> So it would be more convenient to grant him direct commit rights.
>
>
>
> ~~~~
>
>
>
> Motion: grant commit rights to Alan Thomas
>
>
>
> +1 Even
>
>
>
> ~~~~~
>
>
>
> Alan, could you reply to the list confirming that you agree on
>
> https://trac.osgeo.org/gdal/wiki/rfc3_commiters
>
>
>
> Best regards,
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171101/bb370d05/attachment.html>

From mofoyoda at gmail.com  Wed Nov  1 17:11:06 2017
From: mofoyoda at gmail.com (Nikolai Bezdna)
Date: Thu, 2 Nov 2017 03:11:06 +0300
Subject: [gdal-dev] DXF dimension objects are interpreted wrong
Message-ID: <29C758FA-B16D-4DA5-A48F-506149329404@gmail.com>

Hi all!

DXF dimensions get wrong interpretation when read with OGR:
OGR attempts to always draw a vertical or horizontal arrow line, while DXF has a correct angle for it.
Attached is how it looks in AutoCAD <https://www.dropbox.com/s/aplj0cf2v2qoz3y/autocad.png?dl=0> and how it looks in QGIS <https://www.dropbox.com/s/zvo8x32hgyl13np/qgis.png?dl=0> after ogr2ogr to PostGIS format.

AutoCAD: https://www.dropbox.com/s/aplj0cf2v2qoz3y/autocad.png?dl=0
QGIS: https://www.dropbox.com/s/zvo8x32hgyl13np/qgis.png?dl=0



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/1585af88/attachment-0001.html>

From athomas at thinkspatial.com.au  Wed Nov  1 18:29:52 2017
From: athomas at thinkspatial.com.au (Alan Thomas)
Date: Thu, 2 Nov 2017 12:29:52 +1100
Subject: [gdal-dev] DXF dimension objects are interpreted wrong
In-Reply-To: <29C758FA-B16D-4DA5-A48F-506149329404@gmail.com>
References: <29C758FA-B16D-4DA5-A48F-506149329404@gmail.com>
Message-ID: <CALhO07yeaGyhO-cSzRsHB=M3O4T-v4z56OpdmJGtz9XfkeMx=g@mail.gmail.com>

Hi Nikolai,

This issue looks to be addressed in a pull request I currently have
open (https://github.com/OSGeo/gdal/pull/257). Non-orthogonal
dimensions are rendered at the correct angle.

Alan

On 2 November 2017 at 11:11, Nikolai Bezdna <mofoyoda at gmail.com> wrote:
> Hi all!
>
> DXF dimensions get wrong interpretation when read with OGR:
> OGR attempts to always draw a vertical or horizontal arrow line, while DXF
> has a correct angle for it.
> Attached is how it looks in AutoCAD and how it looks in QGIS after ogr2ogr
> to PostGIS format.
>
> AutoCAD: https://www.dropbox.com/s/aplj0cf2v2qoz3y/autocad.png?dl=0
> QGIS: https://www.dropbox.com/s/zvo8x32hgyl13np/qgis.png?dl=0
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Alan Thomas
Software Developer
ThinkSpatial
http://www.thinkspatial.com.au

From andre+joost at nurfuerspam.de  Thu Nov  2 07:08:46 2017
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Thu, 02 Nov 2017 15:08:46 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <1680715.4lzt5iEthT@even-i700>
References: <1680715.4lzt5iEthT@even-i700>
Message-ID: <otf9k0$kdh$1@blaine.gmane.org>

Am 01.11.2017 um 11:32 schrieb Even Rouault:
> Hi,
>
> I've add an exchange with Sebastiaan Couwenberg about a schedule that would
> give GDAL 2.2.3 a chance to enter the next Ubuntu LTS 18.04. While the date
> for the import freeze from Debian to Ubuntu is not know yet, based on the last
> release cycle, it seems that a GDAL 2.2.3 released this month would have a
> chance to make it (given other delays in Debian transitionning from
> experimental to unstable)
> So I intend cutting a GDAL 2.2.3 release candidate for Nov 20th.
> Please raise tickets if there are bug fixes that need to be backported and
> haven't yet been.
>

EPSG has released v9.2 of their database a few weeks ago. Since current 
GDAL is still at v9.0, it would be a good time to update:

  https://trac.osgeo.org/gdal/ticket/7125

Greetings,
André Joost



From even.rouault at spatialys.com  Thu Nov  2 07:51:15 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Nov 2017 15:51:15 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <otf9k0$kdh$1@blaine.gmane.org>
References: <1680715.4lzt5iEthT@even-i700> <otf9k0$kdh$1@blaine.gmane.org>
Message-ID: <1584641.2xrUyy8OI6@even-i700>

On jeudi 2 novembre 2017 15:08:46 CET Andre Joost wrote:
> Am 01.11.2017 um 11:32 schrieb Even Rouault:
> > Hi,
> > 
> > I've add an exchange with Sebastiaan Couwenberg about a schedule that
> > would
> > give GDAL 2.2.3 a chance to enter the next Ubuntu LTS 18.04. While the
> > date
> > for the import freeze from Debian to Ubuntu is not know yet, based on the
> > last release cycle, it seems that a GDAL 2.2.3 released this month would
> > have a chance to make it (given other delays in Debian transitionning
> > from experimental to unstable)
> > So I intend cutting a GDAL 2.2.3 release candidate for Nov 20th.
> > Please raise tickets if there are bug fixes that need to be backported and
> > haven't yet been.
> 
> EPSG has released v9.2 of their database a few weeks ago. Since current
> GDAL is still at v9.0, it would be a good time to update:
> 
>   https://trac.osgeo.org/gdal/ticket/7125

Andre,

I don't think this would appropriate for a bugfix release. More something for trunk.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/3861ddad/attachment.html>

From even.rouault at spatialys.com  Thu Nov  2 07:52:52 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Nov 2017 15:52:52 +0100
Subject: [gdal-dev] Proposed changed to solve inconsistant spatial
	filtering for null or empty geometries
In-Reply-To: <1667829.xa35DArXaz@even-i700>
References: <1667829.xa35DArXaz@even-i700>
Message-ID: <1877850.M1AAjADvib@even-i700>

> So null or empty geometries are never selected when a spatial filter is 
set.
> This last behaviour seems to be the most logical for me, and I'd 
propose we
> adopt it for non-SQL based drivers as well.

Done in trunk per https://trac.osgeo.org/gdal/ticket/7123

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/01adb561/attachment.html>

From gabriel.vatin at kinaxia.fr  Thu Nov  2 08:00:55 2017
From: gabriel.vatin at kinaxia.fr (Gabriel Vatin)
Date: Thu, 2 Nov 2017 16:00:55 +0100
Subject: [gdal-dev] _gdal.FillNodata not Python function
Message-ID: <5f4ea766-5864-e769-e4e0-62ac9198f48e@kinaxia.fr>

Hi all,

I'm working with Python 3.6 32bits, GDAL package 
(GDAL‑2.2.2‑cp36‑cp36m‑win32.whl) i've installed from here : 
https://www.lfd.uci.edu/~gohlke/pythonlibs/

I also installed the gdal-202-1800-core.msi from here : 
http://www.gisinternals.com/query.html?content=filelist&file=release-1800-gdal-2-2-1-mapserver-7-0-6.zip

Here is the error I get when I try the fillnodata python utility :
gdal_fillnodata -md 2 myImage.tif myImage_correction.tif
Traceback (most recent call last):
   File "C:\Python36\Scripts\gdal_fillnodata.py", line 197, in <module>
     callback = prog_func )
   File "C:\Python36\lib\site-packages\osgeo\gdal.py", line 2742, in 
FillNodata
     return _gdal.FillNodata(*args, **kwargs)
RuntimeError: Object given is not a Python function

Do you have any idea how to fix it ? Maybe wrong installation ?... Thanks !


Gabriel

From nickmcummins at icloud.com  Thu Nov  2 11:35:26 2017
From: nickmcummins at icloud.com (Nick Cummins)
Date: Thu, 02 Nov 2017 18:35:26 +0000 (GMT)
Subject: [gdal-dev] =?utf-8?q?Error_building_Python_bindings_-_GDALCreateD?=
 =?utf-8?q?river_was_not_declared_in_this_scope?=
Message-ID: <ae12e79b-fb92-469b-9f3e-4ac9aa7bd5a9@me.com>

Hi,



I'm trying to build GDAL bindings for Python 3. I have the gdal-2.2.2-1 package installed from the Arch Linux official repositories, which does contain bindings for Python 2.7.



PYTHONPATH=/usr/lib/python2.7/site-packages/osgeo
python2

>>> from osgeo import gdal

>>> exit()



python3

>>> from osgeo import gdal

Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ModuleNotFoundError: No module named 'osgeo'



But when I try to build the bindings for Python 3myself (have tried using the python-gdal package from Arch's AUR, building it manually, and using easy_install GDAL), I get the following error:

➜  Desktop sudo easy_install GDAL       
Searching for GDAL
Reading https://pypi.python.org/simple/GDAL/
Downloading https://pypi.python.org/packages/11/cd/edef955a6ef6cb4f2113647d7465b34663e074451b66919e734466ba5197/GDAL-2.2.2.tar.gz#md5=bc5a58ec0e82420fdc910bafc3b5800a
Best match: GDAL 2.2.2
Processing GDAL-2.2.2.tar.gz
Writing /tmp/easy_install-jom80hpq/GDAL-2.2.2/setup.cfg
Running GDAL-2.2.2/setup.py -q bdist_egg --dist-dir /tmp/easy_install-jom80hpq/GDAL-2.2.2/egg-dist-tmp-tf275y_9
cc1plus: warning: command line option ‘-Wstrict-prototypes’ is valid for C/ObjC but not for C++
cc1plus: warning: command line option ‘-Wstrict-prototypes’ is valid for C/ObjC but not for C++
extensions/osr_wrap.cpp:3339:13: warning: ‘void GDALPythonFreeCStr(void*, int)’ defined but not used [-Wunused-function]
 static void GDALPythonFreeCStr(void* ptr, int bToFree)
             ^~~~~~~~~~~~~~~~~~
extensions/osr_wrap.cpp:3309:14: warning: ‘char* GDALPythonObjectToCStr(PyObject*, int*)’ defined but not used [-Wunused-function]
 static char* GDALPythonObjectToCStr(PyObject* pyObject, int* pbToFree)
              ^~~~~~~~~~~~~~~~~~~~~~
cc1plus: warning: command line option ‘-Wstrict-prototypes’ is valid for C/ObjC but not for C++
cc1plus: warning: command line option ‘-Wstrict-prototypes’ is valid for C/ObjC but not for C++
extensions/gnm_wrap.cpp:3321:13: warning: ‘void GDALPythonFreeCStr(void*, int)’ defined but not used [-Wunused-function]
 static void GDALPythonFreeCStr(void* ptr, int bToFree)
             ^~~~~~~~~~~~~~~~~~
extensions/gnm_wrap.cpp:3291:14: warning: ‘char* GDALPythonObjectToCStr(PyObject*, int*)’ defined but not used [-Wunused-function]
 static char* GDALPythonObjectToCStr(PyObject* pyObject, int* pbToFree)
              ^~~~~~~~~~~~~~~~~~~~~~
cc1plus: warning: command line option ‘-Wstrict-prototypes’ is valid for C/ObjC but not for C++
In file included from /usr/include/python3.6m/numpy/ndarraytypes.h:1809:0,
                 from /usr/include/python3.6m/numpy/ndarrayobject.h:18,
                 from /usr/include/python3.6m/numpy/arrayobject.h:4,
                 from extensions/gdal_array_wrap.cpp:3464:
/usr/include/python3.6m/numpy/npy_1_7_deprecated_api.h:15:2: warning: #warning "Using deprecated NumPy API, disable it by " "#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-Wcpp]
 #warning "Using deprecated NumPy API, disable it by " \
  ^~~~~~~
extensions/gdal_array_wrap.cpp: In function ‘void GDALRegister_NUMPY()’:
extensions/gdal_array_wrap.cpp:3528:45: error: ‘GDALCreateDriver’ was not declared in this scope
         poDriver = static_cast<GDALDriver*>(GDALCreateDriver());
                                             ^~~~~~~~~~~~~~~~
extensions/gdal_array_wrap.cpp:3528:45: note: suggested alternative: ‘GDALGetDriver’
         poDriver = static_cast<GDALDriver*>(GDALCreateDriver());
                                             ^~~~~~~~~~~~~~~~
                                             GDALGetDriver
extensions/gdal_array_wrap.cpp: At global scope:
extensions/gdal_array_wrap.cpp:3448:13: warning: ‘void GDALPythonFreeCStr(void*, int)’ defined but not used [-Wunused-function]
 static void GDALPythonFreeCStr(void* ptr, int bToFree)
             ^~~~~~~~~~~~~~~~~~
extensions/gdal_array_wrap.cpp:3418:14: warning: ‘char* GDALPythonObjectToCStr(PyObject*, int*)’ defined but not used [-Wunused-function]
 static char* GDALPythonObjectToCStr(PyObject* pyObject, int* pbToFree)
              ^~~~~~~~~~~~~~~~~~~~~~
error: Setup script exited with error: command 'gcc' failed with exit status 1


Any ideas? Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/088f74cd/attachment.html>

From even.rouault at spatialys.com  Thu Nov  2 12:41:31 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Nov 2017 20:41:31 +0100
Subject: [gdal-dev] Error building Python bindings - GDALCreateDriver
	was not declared in this scope
In-Reply-To: <ae12e79b-fb92-469b-9f3e-4ac9aa7bd5a9@me.com>
References: <ae12e79b-fb92-469b-9f3e-4ac9aa7bd5a9@me.com>
Message-ID: <4421362.tQ9pnPTXer@even-i700>

On jeudi 2 novembre 2017 18:35:26 CET Nick Cummins wrote:
> Hi,
> 
> 
> 
> I'm trying to build GDAL bindings for Python 3. I have the gdal-2.2.2-1
> package installed from the Arch Linux official repositories, which does
> contain bindings for Python 2.7

I'd suspect the Python bindings try to inclue the GDAL headers of an older version 
than 2.2.2
GDALCreateDriver should be declared in gdal.h

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/fb59e908/attachment.html>

From hemantbist at gmail.com  Thu Nov  2 13:39:56 2017
From: hemantbist at gmail.com (Hemant Bist)
Date: Thu, 2 Nov 2017 13:39:56 -0700
Subject: [gdal-dev] Exporting large geojsons to postgis using ogr2ogr
Message-ID: <CAHgSXQ=HdmEL_B1K0n6mB50DDC0Kb34Va40fM1oLKzdaxdtwfA@mail.gmail.com>

Hi,
ogr2ogr is repeatedly failing for me with the following error when I try to
import a large geojson (5gb) to postgres. The geojson itself was created by
ogr2ogr from a ESRI gdb file.
I would appreciate any pointers for workarounds. I only found 1] which
indicates that I may have to manually(using custom script) split the
geojson file.

1]
https://gis.stackexchange.com/questions/16340/alternatives-to-ogr2ogr-for-loading-large-geojson-files-to-postgis
 ogr2ogr  -f "PostgreSQL" -append -update -nlt GEOMETRY -t_srs EPSG:4326
PG:"dbname=mydb  tables=dummy" vol2/myuser/delme/a.json'  -nln tmpx -lco
FID=gid -lco PRECISION=NO

ERROR 1: GeoJSON parsing error: buffer size overflow (at offset 0)
ERROR 4: Failed to read GeoJSON data
FAILURE:
Unable to open datasource `/vol2/myuser/delme/a.json' with the following
drivers.
  -> PCIDSK
  -> JPEG2000
  -> PDF
  -> ESRI Shapefile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/77dc5b06/attachment-0001.html>

From mofoyoda at gmail.com  Thu Nov  2 13:43:51 2017
From: mofoyoda at gmail.com (Nikolai Bezdna)
Date: Thu, 2 Nov 2017 23:43:51 +0300
Subject: [gdal-dev] stack smashing when using ogrinfo with DB2 driver
Message-ID: <EED772C8-7453-4BDF-80B0-2AFB33A9C700@gmail.com>

I get a strange behaviour when using ogrinfo (or ogr2ogr) with DB2 driver.

ogrinfo "DB2ODBC:database=mydb;DSN=MYDB;Tables=MYSCHEMA.MYTABLE” MYSCHEMA.MYTABLE

Reports:

INFO: Open of `DB2ODBC:database=mydb;DSN=MYDB;Tables=MYSCHEMA.MYTABLE'
     using driver `DB2ODBC' successful.
*** stack smashing detected ***: ogrinfo terminated
======= Backtrace: =========
/lib64/libc.so.6(+0x6fb0c)[0x7fc821d9ab0c]
/lib64/libc.so.6(__fortify_fail+0x37)[0x7fc821e22a77]
/lib64/libc.so.6(__fortify_fail+0x0)[0x7fc821e22a40]
/usr/lib64/libgdal.so(+0xa874d9)[0x7fc822d504d9]
/usr/lib64/libgdal.so(_ZN16OGRDB2DataSource20CreateMetadataTablesEv+0x4f)[0x7fc822d5b91f]
/usr/lib64/libgdal.so(_ZN16OGRDB2DataSource17HasMetadataTablesEv+0xcd)[0x7fc822d5bc3d]
/usr/lib64/libgdal.so(_ZN16OGRDB2DataSource11GetMetadataEPKc+0xa3)[0x7fc822d5c783]
ogrinfo[0x4031e1]
ogrinfo[0x403309]
ogrinfo[0x401e1a]
/lib64/libc.so.6(__libc_start_main+0xf0)[0x7fc821d4b640]
ogrinfo[0x403039]

However I can get info on my table when wrapping into VRT and using ogrinfo on it.
I thought the same mechanism is used for querying wrapped sources.


Another question is - why does VRT driver switch a layer to read only mode when using FID tag to specify primary key column?

From even.rouault at spatialys.com  Thu Nov  2 13:45:46 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Nov 2017 21:45:46 +0100
Subject: [gdal-dev] Exporting large geojsons to postgis using ogr2ogr
In-Reply-To: <CAHgSXQ=HdmEL_B1K0n6mB50DDC0Kb34Va40fM1oLKzdaxdtwfA@mail.gmail.com>
References: <CAHgSXQ=HdmEL_B1K0n6mB50DDC0Kb34Va40fM1oLKzdaxdtwfA@mail.gmail.com>
Message-ID: <6570895.ySdKja8gv7@even-i700>

On jeudi 2 novembre 2017 13:39:56 CET Hemant Bist wrote:
> Hi,
> ogr2ogr is repeatedly failing for me with the following error when I try to
> import a large geojson (5gb) to postgres. The geojson itself was created by
> ogr2ogr from a ESRI gdb file.
> I would appreciate any pointers for workarounds. I only found 1] which
> indicates that I may have to manually(using custom script) split the
> geojson file.

I've fixed this a couple days ago in GDAL trunk to be able to read arbitrarily 
large GeoJSON files with little RAM.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/e617cad6/attachment.html>

From even.rouault at spatialys.com  Thu Nov  2 14:10:20 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 02 Nov 2017 22:10:20 +0100
Subject: [gdal-dev] stack smashing when using ogrinfo with DB2 driver
In-Reply-To: <EED772C8-7453-4BDF-80B0-2AFB33A9C700@gmail.com>
References: <EED772C8-7453-4BDF-80B0-2AFB33A9C700@gmail.com>
Message-ID: <1581375.sOR5SNpFZv@even-i700>

> 
> Another question is - why does VRT driver switch a layer to read only mode
> when using FID tag to specify primary key column?

I can just answer on that non-DB2 specific part. The reason is that when explicitly setting FID, 
when you want to update the underlying layer, you'd need to access its real FID, but, in the 
general case, the exposed FID at the VRT level cannot be matched with the underlying FID.

For example imagine you have a CSV file with

my_id,foo
10,"bar"
11",baz"

For the OGR CSV driver, the FID of this CSV file is implicit. The first record will be FID 1, the 
next one 2

If in your VRT you set <FID>my_id</FID>, then in the OGR VRT layer, you'll have 2 features of 
FID 10 and 11.
If you do SetFeature(vrt_feature) where vrt_feature.my_id = 11, the VRT driver would have to 
realize that this vrt_feature.my_id= 11 corresponds to csv_feature.implicit_id = 2. Which he 
cannot do efficiently (would require a full scan)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171102/04c18a3b/attachment.html>

From spir.robert at gmail.com  Thu Nov  2 23:55:57 2017
From: spir.robert at gmail.com (=?UTF-8?B?UsOzYmVydCDFoHBpcg==?=)
Date: Fri, 3 Nov 2017 07:55:57 +0100
Subject: [gdal-dev] Reading sentinel 2 L2A datasets
Message-ID: <CANOVgt4vSvcru_gmr5wOTowsbw7_waPjPoYtFtcq+on4bqSyQQ@mail.gmail.com>

Hi all,
I'm using GDAL to process sentinel-2 data (in c++). I have no problem
processing S2B and S2A L1C datasets, I can open them, read the subdatasets
and process the data.
But when I try to open L2A dataset, it looks like there are no subdatasets
and I cannot access the bands.
I have attached gdalinfo output from this dataset and the dataset xml. Is
there any way how I can access the subdatasets or this type of dataset is
not currently supported in GDAL?

Thanks,
Robert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/f5cf502e/attachment-0001.html>
-------------- next part --------------
Driver: SENTINEL2/Sentinel 2
Files: /vsizip//data/tmp/soft/S2A_MSIL2A_20171015T095031_N0205_R079_T33UXP_20171015T095357.zip/S2A_MSIL2A_20171015T095031_N0205_R079_T33UXP_20171015T095357.SAFE/MTD_MSIL2A.xml
Size is 512, 512
Coordinate System is `'
Metadata:
  AOT_RETRIEVAL_ACCURACY=0.0
  CLOUD_COVERAGE_ASSESSMENT=0.1984
  CLOUD_COVERAGE_PERCENTAGE=0.518579
  CLOUD_SHADOW_PERCENTAGE=0.094366
  DARK_FEATURES_PERCENTAGE=1.190103
  DATATAKE_1_DATATAKE_SENSING_START=2017-10-15T09:50:31.026Z
  DATATAKE_1_DATATAKE_TYPE=INS-NOBS
  DATATAKE_1_ID=GS2A_20171015T095031_012088_N02.05
  DATATAKE_1_SENSING_ORBIT_DIRECTION=DESCENDING
  DATATAKE_1_SENSING_ORBIT_NUMBER=79
  DATATAKE_1_SPACECRAFT_NAME=Sentinel-2A
  DEGRADED_ANC_DATA_PERCENTAGE=0
  DEGRADED_MSI_DATA_PERCENTAGE=0
  FOOTPRINT=POLYGON((16.360279246283664 48.74498411169783, 17.852438708473066 48.71769475117851, 17.798094715302927 47.73104447774509, 16.3343313489668 47.75740973734738, 16.360279246283664 48.74498411169783))
  FORMAT_CORRECTNESS_FLAG=PASSED
  GENERAL_QUALITY_FLAG=PASSED
  GENERATION_TIME=2017-10-19T08:52:27Z
  GEOMETRIC_QUALITY_FLAG=PASSED
  HIGH_PROBA_CLOUDS_PERCENTAGE=0.105969
  L1C_TOA_QUANTIFICATION_VALUE=10000
  L1C_TOA_QUANTIFICATION_VALUE_UNIT=none
  L2A_AOT_QUANTIFICATION_VALUE=1000.0
  L2A_AOT_QUANTIFICATION_VALUE_UNIT=none
  L2A_BOA_QUANTIFICATION_VALUE=10000
  L2A_BOA_QUANTIFICATION_VALUE_UNIT=none
  L2A_WVP_QUANTIFICATION_VALUE=1000.0
  L2A_WVP_QUANTIFICATION_VALUE_UNIT=cm
  MEDIUM_PROBA_CLOUDS_PERCENTAGE=0.406588
  NODATA_PIXEL_PERCENTAGE=0.000100
  NOT_VEGETATED_PERCENTAGE=40.847874
  PREVIEW_GEO_INFO=Not applicable
  PREVIEW_IMAGE_URL=Not applicable
  PROCESSING_BASELINE=02.05
  PROCESSING_LEVEL=Level-2Ap
  PRODUCT_START_TIME=2017-10-15T09:50:31.026Z
  PRODUCT_STOP_TIME=2017-10-15T09:50:31.026Z
  PRODUCT_TYPE=S2MSI2Ap
  PRODUCT_URI_1C=S2A_MSIL1C_20171015T095031_N0205_R079_T33UXP_20171015T095357.SAFE
  PRODUCT_URI_2A=S2A_MSIL2A_20171015T095031_N0205_R079_T33UXP_20171015T095357.SAFE
  RADIATIVE_TRANSFER_ACCURAY=0.0
  RADIOMETRIC_QUALITY_FLAG=PASSED
  REFERENCE_BAND=B1
  REFLECTANCE_CONVERSION_U=1.00445351171828
  SATURATED_DEFECTIVE_PIXEL_PERCENTAGE=0.000000
  SENSOR_QUALITY_FLAG=PASSED
  SNOW_ICE_PERCENTAGE=0.002143
  SPECIAL_VALUE_NODATA=0
  SPECIAL_VALUE_SATURATED=65535
  THIN_CIRRUS_PERCENTAGE=0.006022
  UNCLASSIFIED_PERCENTAGE=3.285500
  VEGETATION_PERCENTAGE=52.199417
  WATER_PERCENTAGE=1.862016
  WATER_VAPOUR_RETRIEVAL_ACCURACY=0.0
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  512.0)
Upper Right (  512.0,    0.0)
Lower Right (  512.0,  512.0)
Center      (  256.0,  256.0)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MTD_MSIL2A.xml
Type: text/xml
Size: 53783 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/f5cf502e/attachment-0001.xml>

From ari.jolma at gmail.com  Thu Nov  2 23:59:37 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 3 Nov 2017 08:59:37 +0200
Subject: [gdal-dev] Reading sentinel 2 L2A datasets
In-Reply-To: <CANOVgt4vSvcru_gmr5wOTowsbw7_waPjPoYtFtcq+on4bqSyQQ@mail.gmail.com>
References: <CANOVgt4vSvcru_gmr5wOTowsbw7_waPjPoYtFtcq+on4bqSyQQ@mail.gmail.com>
Message-ID: <9d288936-5f76-6c7a-dd90-b3f7b990f7a1@gmail.com>

Just a comment on this post. It was initially blocked since it is > 50 
kB. I've now increased the size limit to 100 kB.

Ari


Róbert Špir kirjoitti 03.11.2017 klo 08:55:
> Hi all,
> I'm using GDAL to process sentinel-2 data (in c++). I have no problem 
> processing S2B and S2A L1C datasets, I can open them, read the 
> subdatasets and process the data.
> But when I try to open L2A dataset, it looks like there are no 
> subdatasets and I cannot access the bands.
> I have attached gdalinfo output from this dataset and the dataset xml. 
> Is there any way how I can access the subdatasets or this type of 
> dataset is not currently supported in GDAL?
>
> Thanks,
> Robert
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/9dafa271/attachment.html>

From ari.jolma at gmail.com  Fri Nov  3 00:57:06 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 3 Nov 2017 09:57:06 +0200
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
Message-ID: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>

I have two things that I need to ask/discuss regarding WCS 2.0

1) My understanding is that there are potentially three CRS in 
operation: the CRS of the bbox of the coverage (the native CRS of the 
server); the CRS of the grid; and the CRS where the user wants the data. 
I can imagine that it is perfectly possible for a server to advertise 
data from an area bounded by geographic coordinates, and that the data 
is in some specific projected coordinate system. Also, the data could be 
regular but not east-north (it is rotated for example). This would be 
described in a CoverageDescription. Despite the rotation, GDAL would 
show the data east-nort (without rotation), since only the bbox of the 
coverage is given.

Again, it is perfectly possible that the user wants the data in some CRS 
that is not the native CRS of the WCS. The GetCoverage request can 
contain an instruction for the server to serve the data in the CRS the 
user wants the data (this is an extension in 2.0). User can set this (it 
must be one of those supported by the server) in the dataset definition 
(WCS_GDAL XML). Thus GDAL needs to show the coverage bbox to its users 
in that CRS. And, as above, the GeoTransform is east-north.

Is this correct analysis?

BTW, the coordinate transformation of the bbox is not done in WCS driver 
at the moment in the case of user CRS != server native CRS.


2) WCS can offer multidimensional data with complex data records. I want 
the GDAL user to have a control on how the data is organized into 
(current) GDAL. For example the server may offer spatio-temporal (x/y/t) 
data with about wave heights in a sea (to link this to what I'm getting 
paid for now :)) that are described as average and max. Obviously I want 
x/y bands, but I may want either the temporal data or the wave height 
data into bands, depending on the application. The workflow would go

1. gdalinfo to the server, see this data as a layer with name 
"VHM0_year_meanmax", gdalinfo reports that layer as a subdataset

2. gdalinfo into the layer, now it reports that there is an additional 
dimension (t) and that the datarecord consists of two values mean and 
max; it also reports information about the time (begin, end, step)

3. I decide to use a specific time and start using datasets with two 
bands (mean and max)

I have such data as NetCDF and I don't think I can follow that workflow 
with it since the driver puts the mean and max wave heights right away 
into subdatasets and time into bands.

In the WCS there could/should be a similar default behavior but that 
should be changeable by options (-oo t=some_timestamp).

Thoughts?

Ari



From ari.jolma at gmail.com  Fri Nov  3 01:30:00 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 3 Nov 2017 10:30:00 +0200
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
Message-ID: <ddc384b8-8121-8e7a-ef5d-8860259e3d1e@gmail.com>

one detail forgotten

Ari Jolma kirjoitti 03.11.2017 klo 09:57:
> I have two things that I need to ask/discuss regarding WCS 2.0
>
> 1) My understanding is that there are potentially three CRS in 
> operation: the CRS of the bbox of the coverage (the native CRS of the 
> server); the CRS of the grid; and the CRS where the user wants the 
> data. I can imagine that it is perfectly possible for a server to 
> advertise data from an area bounded by geographic coordinates, and 
> that the data is in some specific projected coordinate system. Also, 
> the data could be regular but not east-north (it is rotated for 
> example). This would be described in a CoverageDescription. Despite 
> the rotation, GDAL would show the data east-nort (without rotation), 
> since only the bbox of the coverage is given.

There is also the coverageFunction, which contains, in the case of 
grids, a GridFunction. GridFunction may contain non-Linear sequenceRules 
but they are probably too exotic to be supported by the GDAL WCS driver.

>
> Again, it is perfectly possible that the user wants the data in some 
> CRS that is not the native CRS of the WCS. The GetCoverage request can 
> contain an instruction for the server to serve the data in the CRS the 
> user wants the data (this is an extension in 2.0). User can set this 
> (it must be one of those supported by the server) in the dataset 
> definition (WCS_GDAL XML). Thus GDAL needs to show the coverage bbox 
> to its users in that CRS. And, as above, the GeoTransform is east-north.
>
> Is this correct analysis?
>
> BTW, the coordinate transformation of the bbox is not done in WCS 
> driver at the moment in the case of user CRS != server native CRS.
>
>
> 2) WCS can offer multidimensional data with complex data records. I 
> want the GDAL user to have a control on how the data is organized into 
> (current) GDAL. For example the server may offer spatio-temporal 
> (x/y/t) data with about wave heights in a sea (to link this to what 
> I'm getting paid for now :)) that are described as average and max. 
> Obviously I want x/y bands, but I may want either the temporal data or 
> the wave height data into bands, depending on the application. The 
> workflow would go
>
> 1. gdalinfo to the server, see this data as a layer with name 
> "VHM0_year_meanmax", gdalinfo reports that layer as a subdataset
>
> 2. gdalinfo into the layer, now it reports that there is an additional 
> dimension (t) and that the datarecord consists of two values mean and 
> max; it also reports information about the time (begin, end, step)
>
> 3. I decide to use a specific time and start using datasets with two 
> bands (mean and max)
>
> I have such data as NetCDF and I don't think I can follow that 
> workflow with it since the driver puts the mean and max wave heights 
> right away into subdatasets and time into bands.
>
> In the WCS there could/should be a similar default behavior but that 
> should be changeable by options (-oo t=some_timestamp).
>
> Thoughts?
>
> Ari
>
>


From even.rouault at spatialys.com  Fri Nov  3 01:30:22 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 03 Nov 2017 09:30:22 +0100
Subject: [gdal-dev] Reading sentinel 2 L2A datasets
In-Reply-To: <CANOVgt4vSvcru_gmr5wOTowsbw7_waPjPoYtFtcq+on4bqSyQQ@mail.gmail.com>
References: <CANOVgt4vSvcru_gmr5wOTowsbw7_waPjPoYtFtcq+on4bqSyQQ@mail.gmail.com>
Message-ID: <2714276.Ved8YBqKPs@even-i700>

On vendredi 3 novembre 2017 07:55:57 CET Róbert Špir wrote:
> Hi all,
> I'm using GDAL to process sentinel-2 data (in c++). I have no problem
> processing S2B and S2A L1C datasets, I can open them, read the subdatasets
> and process the data.
> But when I try to open L2A dataset, it looks like there are no subdatasets
> and I cannot access the bands.
> I have attached gdalinfo output from this dataset and the dataset xml. Is
> there any way how I can access the subdatasets or this type of dataset is
> not currently supported in GDAL?

Robert,

yes currently the newest formulation of L2A datasets ("SAFE_COMPACT") is not supported 
by the driver. The original formulation is, but Copernicus changed the format a bit 
afterwards, so some adaptation in the driver would be needed.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/3070f9b7/attachment.html>

From p.baumann at jacobs-university.de  Fri Nov  3 01:54:28 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Fri, 3 Nov 2017 09:54:28 +0100
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
Message-ID: <2feba636-dd39-3fb1-6669-52344903ac29@jacobs-university.de>



On 11/03/2017 08:57 AM, Ari Jolma wrote:
> I have two things that I need to ask/discuss regarding WCS 2.0
>
> 1) My understanding is that there are potentially three CRS in operation: the
> CRS of the bbox of the coverage (the native CRS of the server); the CRS of the
> grid; and the CRS where the user wants the data. I can imagine that it is
> perfectly possible for a server to advertise data from an area bounded by
> geographic coordinates, and that the data is in some specific projected
> coordinate system. Also, the data could be regular but not east-north (it is
> rotated for example). This would be described in a CoverageDescription.
> Despite the rotation, GDAL would show the data east-nort (without rotation),
> since only the bbox of the coverage is given.
>
> Again, it is perfectly possible that the user wants the data in some CRS that
> is not the native CRS of the WCS. The GetCoverage request can contain an
> instruction for the server to serve the data in the CRS the user wants the
> data (this is an extension in 2.0). User can set this (it must be one of those
> supported by the server) 

that is correct, Ari

> in the dataset definition (WCS_GDAL XML). Thus GDAL needs to show the coverage
> bbox to its users in that CRS. 

no, it's just one bbox; WGS84 is common. Otherwise you'd have to advertise
sometimes thousands of bbox variants, which is not feasible.
-Peter

> And, as above, the GeoTransform is east-north.
>
> Is this correct analysis?
>
> BTW, the coordinate transformation of the bbox is not done in WCS driver at
> the moment in the case of user CRS != server native CRS.
>
>
> 2) WCS can offer multidimensional data with complex data records. I want the
> GDAL user to have a control on how the data is organized into (current) GDAL.
> For example the server may offer spatio-temporal (x/y/t) data with about wave
> heights in a sea (to link this to what I'm getting paid for now :)) that are
> described as average and max. Obviously I want x/y bands, but I may want
> either the temporal data or the wave height data into bands, depending on the
> application. The workflow would go
>
> 1. gdalinfo to the server, see this data as a layer with name
> "VHM0_year_meanmax", gdalinfo reports that layer as a subdataset
>
> 2. gdalinfo into the layer, now it reports that there is an additional
> dimension (t) and that the datarecord consists of two values mean and max; it
> also reports information about the time (begin, end, step)
>
> 3. I decide to use a specific time and start using datasets with two bands
> (mean and max)
>
> I have such data as NetCDF and I don't think I can follow that workflow with
> it since the driver puts the mean and max wave heights right away into
> subdatasets and time into bands.
>
> In the WCS there could/should be a similar default behavior but that should be
> changeable by options (-oo t=some_timestamp).
>
> Thoughts?
>
> Ari
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)



From even.rouault at spatialys.com  Fri Nov  3 02:07:33 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 03 Nov 2017 10:07:33 +0100
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
Message-ID: <9681431.gVClmmzbjL@even-i700>

> 1) My understanding is that there are potentially three CRS in
> operation: the CRS of the bbox of the coverage (the native CRS of the
> server); the CRS of the grid; and the CRS where the user wants the data.
> I can imagine that it is perfectly possible for a server to advertise
> data from an area bounded by geographic coordinates, and that the data
> is in some specific projected coordinate system.

For me the "native" CRS (as much as a client can see) is the one of the 
CoverageDescription.boundedBy.Envelope at srsName attribute. If the server advertizes it as 
EPSG:4326, but the native data is in something else, this is an implementation detail of the 
server. That said, as you mention, the user could then decide to request in that alternative 
CRS if it has knowledge of that.

> Also, the data could be
> regular but not east-north (it is rotated for example). This would be
> described in a CoverageDescription. Despite the rotation, GDAL would
> show the data east-nort (without rotation), since only the bbox of the
> coverage is given.

You should be able to retrieve the rotation/shearing terms in the 
domainSet.RectifiedGrid.offsetVector 's element similarly to other WCS versions

Regarding GridFunction, there was a thread about this some time ago:
 https://lists.osgeo.org/pipermail/gdal-dev/2017-April/thread.html#46366

> 
> Again, it is perfectly possible that the user wants the data in some CRS
> that is not the native CRS of the WCS. The GetCoverage request can
> contain an instruction for the server to serve the data in the CRS the
> user wants the data (this is an extension in 2.0). User can set this (it
> must be one of those supported by the server) in the dataset definition
> (WCS_GDAL XML). Thus GDAL needs to show the coverage bbox to its users
> in that CRS. And, as above, the GeoTransform is east-north.
> 
> Is this correct analysis?

Yes, one could image a user specifying something like
WCS:http://blaba&CRS=something to ask for server reprojection, and the geotransform 
exposed to the user should be in that CRS for consistency.

> 
> 2) [...]
> In the WCS there could/should be a similar default behavior but that
> should be changeable by options (-oo t=some_timestamp).

Sounds reasonable.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/77903419/attachment.html>

From ari.jolma at gmail.com  Fri Nov  3 02:18:50 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 3 Nov 2017 11:18:50 +0200
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <2feba636-dd39-3fb1-6669-52344903ac29@jacobs-university.de>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
 <2feba636-dd39-3fb1-6669-52344903ac29@jacobs-university.de>
Message-ID: <044a8275-a0b6-b889-8876-10dc7ab7ced5@gmail.com>

Peter Baumann kirjoitti 03.11.2017 klo 10:54:
>
> On 11/03/2017 08:57 AM, Ari Jolma wrote:
>> I have two things that I need to ask/discuss regarding WCS 2.0
>>
>> 1) My understanding is that there are potentially three CRS in operation: the
>> CRS of the bbox of the coverage (the native CRS of the server); the CRS of the
>> grid; and the CRS where the user wants the data. I can imagine that it is
>> perfectly possible for a server to advertise data from an area bounded by
>> geographic coordinates, and that the data is in some specific projected
>> coordinate system. Also, the data could be regular but not east-north (it is
>> rotated for example). This would be described in a CoverageDescription.
>> Despite the rotation, GDAL would show the data east-nort (without rotation),
>> since only the bbox of the coverage is given.
>>
>> Again, it is perfectly possible that the user wants the data in some CRS that
>> is not the native CRS of the WCS. The GetCoverage request can contain an
>> instruction for the server to serve the data in the CRS the user wants the
>> data (this is an extension in 2.0). User can set this (it must be one of those
>> supported by the server)
> that is correct, Ari
>
>> in the dataset definition (WCS_GDAL XML). Thus GDAL needs to show the coverage
>> bbox to its users in that CRS.
> no, it's just one bbox; WGS84 is common. Otherwise you'd have to advertise
> sometimes thousands of bbox variants, which is not feasible.

What I mean here is that the GDAL dataset object, once initialized and 
being a real one (i.e., usable for accessing data , not a kind of path 
to subdatasets that are real ones), has a CRS, GeoTransform, and also 
the raster size (nr of cells). And the CRS of the GDAL dataset may be 
the native CRS of the server, or something the user sets. That then 
dictates also the GeoTransform (since a GeoTransform contains a point 
and distances in the CRS). I hope I'm being clear here. It is true that 
there may be thousands of bbox variants (for example GeoServer says it 
supports ~5800 CRSs, they are all listed in the Capabilities XML), but 
only one bbox is eventually shown to the user in the dataset object, and 
it must be in the CRS of the dataset object.

Another thing, the raster size. Since the real raster, whose size is 
given in GridEnvelope in CoverageDescription, may be rotated relative to 
the GDAL dataset, the GDAL dataset size is in general case not the size 
of the real raster. It's just a computation but the result is that the 
size of the WCS dataset raster may be an approximation.

Ari

> -Peter
>
>> And, as above, the GeoTransform is east-north.
>>
>> Is this correct analysis?
>>
>> BTW, the coordinate transformation of the bbox is not done in WCS driver at
>> the moment in the case of user CRS != server native CRS.
>>
>>
>> 2) WCS can offer multidimensional data with complex data records. I want the
>> GDAL user to have a control on how the data is organized into (current) GDAL.
>> For example the server may offer spatio-temporal (x/y/t) data with about wave
>> heights in a sea (to link this to what I'm getting paid for now :)) that are
>> described as average and max. Obviously I want x/y bands, but I may want
>> either the temporal data or the wave height data into bands, depending on the
>> application. The workflow would go
>>
>> 1. gdalinfo to the server, see this data as a layer with name
>> "VHM0_year_meanmax", gdalinfo reports that layer as a subdataset
>>
>> 2. gdalinfo into the layer, now it reports that there is an additional
>> dimension (t) and that the datarecord consists of two values mean and max; it
>> also reports information about the time (begin, end, step)
>>
>> 3. I decide to use a specific time and start using datasets with two bands
>> (mean and max)
>>
>> I have such data as NetCDF and I don't think I can follow that workflow with
>> it since the driver puts the mean and max wave heights right away into
>> subdatasets and time into bands.
>>
>> In the WCS there could/should be a similar default behavior but that should be
>> changeable by options (-oo t=some_timestamp).
>>
>> Thoughts?
>>
>> Ari
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From ari.jolma at gmail.com  Fri Nov  3 02:23:08 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 3 Nov 2017 11:23:08 +0200
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <9681431.gVClmmzbjL@even-i700>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
 <9681431.gVClmmzbjL@even-i700>
Message-ID: <c37deccb-b86e-51e3-6613-7554f6f893b3@gmail.com>

Even Rouault kirjoitti 03.11.2017 klo 11:07:
>
> > 1) My understanding is that there are potentially three CRS in
>
> > operation: the CRS of the bbox of the coverage (the native CRS of the
>
> > server); the CRS of the grid; and the CRS where the user wants the data.
>
> > I can imagine that it is perfectly possible for a server to advertise
>
> > data from an area bounded by geographic coordinates, and that the data
>
> > is in some specific projected coordinate system.
>
> For me the "native" CRS (as much as a client can see) is the one of 
> the CoverageDescription.boundedBy.Envelope at srsName attribute
>

exactly

> . If the server advertizes it as EPSG:4326, but the native data is in 
> something else, this is an implementation detail of the server. That 
> said, as you mention, the user could then decide to request in that 
> alternative CRS if it has knowledge of that.
>
> > Also, the data could be
>
> > regular but not east-north (it is rotated for example). This would be
>
> > described in a CoverageDescription. Despite the rotation, GDAL would
>
> > show the data east-nort (without rotation), since only the bbox of the
>
> > coverage is given.
>
> You should be able to retrieve the rotation/shearing terms in the 
> domainSet.RectifiedGrid.offsetVector 's element similarly to other WCS 
> versions
>

yes, and that is needed to compute (approximate) the size of the GDAL 
dataset raster, as I just wrote in another reply to this thread.

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/6a1b8af0/attachment-0001.html>

From even.rouault at spatialys.com  Fri Nov  3 02:38:56 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 03 Nov 2017 10:38:56 +0100
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <044a8275-a0b6-b889-8876-10dc7ab7ced5@gmail.com>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
 <2feba636-dd39-3fb1-6669-52344903ac29@jacobs-university.de>
 <044a8275-a0b6-b889-8876-10dc7ab7ced5@gmail.com>
Message-ID: <1675740.LgTZBZX0HH@even-i700>

> Another thing, the raster size. Since the real raster, whose size is
> given in GridEnvelope in CoverageDescription, may be rotated relative to
> the GDAL dataset, the GDAL dataset size is in general case not the size
> of the real raster. It's just a computation but the result is that the
> size of the WCS dataset raster may be an approximation.

Ah, i think I see your point

If the grid offsetVector express a rotation. WCSParseGMLCoverage() currently  expose 
as dimension the value of limits.GridEnvelope.high[] - limits.GridEnvelope.low[] + 1 and 
the offsetVector's in the geotransform. So this is consistant.
But when you do a RasterIO() request which translates to a WCS GetCoverage request 
you express a BBOX, and not something in grid/image coordinates. Wondering what kind 
of response a server would return then... Would it be a "straigth" grid our would it keep 
the rotation exposed in the CoverageDescription

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/ca43ecf8/attachment.html>

From spir.robert at gmail.com  Fri Nov  3 02:54:22 2017
From: spir.robert at gmail.com (=?UTF-8?B?UsOzYmVydCDFoHBpcg==?=)
Date: Fri, 3 Nov 2017 10:54:22 +0100
Subject: [gdal-dev] Reading sentinel 2 L2A datasets
In-Reply-To: <2714276.Ved8YBqKPs@even-i700>
References: <CANOVgt4vSvcru_gmr5wOTowsbw7_waPjPoYtFtcq+on4bqSyQQ@mail.gmail.com>
 <2714276.Ved8YBqKPs@even-i700>
Message-ID: <CANOVgt5RP10ehFtXM-k2wFHDk=oJ=0A2KAv3fDGrCU2ug5rejw@mail.gmail.com>

Thanks for the info, are there any plans to add this support in the near
future?

Robert

On Fri, Nov 3, 2017 at 9:30 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On vendredi 3 novembre 2017 07:55:57 CET Róbert Špir wrote:
>
> > Hi all,
>
> > I'm using GDAL to process sentinel-2 data (in c++). I have no problem
>
> > processing S2B and S2A L1C datasets, I can open them, read the
> subdatasets
>
> > and process the data.
>
> > But when I try to open L2A dataset, it looks like there are no
> subdatasets
>
> > and I cannot access the bands.
>
> > I have attached gdalinfo output from this dataset and the dataset xml. Is
>
> > there any way how I can access the subdatasets or this type of dataset is
>
> > not currently supported in GDAL?
>
>
>
> Robert,
>
>
>
> yes currently the newest formulation of L2A datasets ("SAFE_COMPACT") is
> not supported by the driver. The original formulation is, but Copernicus
> changed the format a bit afterwards, so some adaptation in the driver would
> be needed.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/78c99046/attachment.html>

From even.rouault at spatialys.com  Fri Nov  3 04:16:48 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 03 Nov 2017 12:16:48 +0100
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <6093989.p8PumcTCPI@even-i700>
References: <6093989.p8PumcTCPI@even-i700>
Message-ID: <4220927.oByq43xpZy@even-i700>

> 
> Motion: grant commit rights to Alan Thomas

I declared this motion passed with +1 from DanielM, HowardB, KurtS, JukkaR, 
TamasS and myself.

Welcome aboard Alan !
I've just toggled SVN commit rights for you (when asked by svn for user/
password, use your OSGeo user credentials). Let me know if you have issues. I 
suppose you want the "athomas at thinkspatial dot com dot au" email to be the 
one associated when mirroring SVN to git ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171103/f16c090e/attachment.html>

From athomas at thinkspatial.com.au  Fri Nov  3 18:47:42 2017
From: athomas at thinkspatial.com.au (Alan Thomas)
Date: Sat, 4 Nov 2017 12:47:42 +1100
Subject: [gdal-dev] Motion: grant commit rights to Alan Thomas
In-Reply-To: <4220927.oByq43xpZy@even-i700>
References: <6093989.p8PumcTCPI@even-i700> <4220927.oByq43xpZy@even-i700>
Message-ID: <CALhO07y6jyZLWf__OaLqM-p7MJad=u+kOsg8N_uArRT0ch9ejg@mail.gmail.com>

Thanks, all, for your support. I look forward to the opportunity to
help maintain the DXF driver.

Yes, please associate the ThinkSpatial address.

Alan

On 3 November 2017 at 22:16, Even Rouault <even.rouault at spatialys.com> wrote:
>>
>
>> Motion: grant commit rights to Alan Thomas
>
>
>
> I declared this motion passed with +1 from DanielM, HowardB, KurtS, JukkaR,
> TamasS and myself.
>
>
>
> Welcome aboard Alan !
>
> I've just toggled SVN commit rights for you (when asked by svn for
> user/password, use your OSGeo user credentials). Let me know if you have
> issues. I suppose you want the "athomas at thinkspatial dot com dot au"
> email to be the one associated when mirroring SVN to git ?
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com



-- 
Alan Thomas
Software Developer
ThinkSpatial
http://www.thinkspatial.com.au

From kaarigar at gmail.com  Sat Nov  4 12:04:37 2017
From: kaarigar at gmail.com (Karu Kaarigar)
Date: Sat, 4 Nov 2017 12:04:37 -0700
Subject: [gdal-dev] gdalwarp from C#
Message-ID: <CAJbDoZqWZMkPW8i-xD2ZSjfTyctp0vJ-ymfJNjhNCthwu3eo9Q@mail.gmail.com>

I am trying to use gdalwarp using C# bindings. I am using 64bit libs.
However, I am not able to find proper docs on its usage. Specifically I
need to know how to use the GDALWarpAppOptions and the format of options
string array passed to its constructor. I also need to know the call
semantics of various wrapper methods (wrapper_GDALWarpDestName,
wrapper_GDALWarpDestName). I m confused about its arguments such as
SWIGTYPE_p_p_GDALDatasetShadow, etc.

Any help or pointers is highly appreciated. Is there any sample code that
shows how to use gdalwarp from C#? Thanks you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171104/7be3ceff/attachment.html>

From nyall.dawson at gmail.com  Sat Nov  4 20:16:43 2017
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Sun, 5 Nov 2017 13:16:43 +1000
Subject: [gdal-dev] Possible to determine whether a vector format is spatial?
Message-ID: <CAB28Ash4743bpVwozLXz6d0sJG1ba-=UhYSJe_XMvmKe2hrigw@mail.gmail.com>

Hi all,

I'm wondering if there's any way of determining through driver
metadata whether a particular format supports geometry or not?

Looking through the metadata shown by ogrinfo --format, I can't see
anything that could be used to differentiate spatial formats vs
non-spatial formats (eg xls, xlsx, ods). Is there another way I could
test for this support?

I'm wanting to cut down the list of supported output formats in the
QGIS UI for operations where only formats with spatial support make
sense.

Regards,
Nyall

From even.rouault at spatialys.com  Sun Nov  5 01:36:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 05 Nov 2017 10:36:06 +0100
Subject: [gdal-dev] Possible to determine whether a vector format is
	spatial?
In-Reply-To: <CAB28Ash4743bpVwozLXz6d0sJG1ba-=UhYSJe_XMvmKe2hrigw@mail.gmail.com>
References: <CAB28Ash4743bpVwozLXz6d0sJG1ba-=UhYSJe_XMvmKe2hrigw@mail.gmail.com>
Message-ID: <1872328.lf53T3Jihk@even-i700>

On dimanche 5 novembre 2017 13:16:43 CET Nyall Dawson wrote:
> Hi all,
> 
> I'm wondering if there's any way of determining through driver
> metadata whether a particular format supports geometry or not?
> 
> Looking through the metadata shown by ogrinfo --format, I can't see
> anything that could be used to differentiate spatial formats vs
> non-spatial formats (eg xls, xlsx, ods). Is there another way I could
> test for this support?
> 

There's indeed no driver metadata for this currently.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171105/17d747d3/attachment.html>

From szekerest at gmail.com  Sun Nov  5 09:22:20 2017
From: szekerest at gmail.com (Tamas Szekeres)
Date: Sun, 5 Nov 2017 18:22:20 +0100
Subject: [gdal-dev] gdalwarp from C#
In-Reply-To: <CAJbDoZqWZMkPW8i-xD2ZSjfTyctp0vJ-ymfJNjhNCthwu3eo9Q@mail.gmail.com>
References: <CAJbDoZqWZMkPW8i-xD2ZSjfTyctp0vJ-ymfJNjhNCthwu3eo9Q@mail.gmail.com>
Message-ID: <CACALY+RD4791W_JvMoDu7rx-5U8hzfURvPgEm-8PFH9WZUhPUQ@mail.gmail.com>

Would Gdal.ReprojectImage do what you want in this particular case? This is
the signature that can be used in the C# bindings:

*public static CPLErr ReprojectImage(Dataset src_ds, Dataset dst_ds, string
src_wkt, string dst_wkt, ResampleAlg eResampleAlg, double WarpMemoryLimit,
double maxerror, Gdal.GDALProgressFuncDelegate callback, string
callback_data, string[] options)*

Best regards,

Tamas

2017-11-04 20:04 GMT+01:00 Karu Kaarigar <kaarigar at gmail.com>:

> I am trying to use gdalwarp using C# bindings. I am using 64bit libs.
> However, I am not able to find proper docs on its usage. Specifically I
> need to know how to use the GDALWarpAppOptions and the format of options
> string array passed to its constructor. I also need to know the call
> semantics of various wrapper methods (wrapper_GDALWarpDestName,
> wrapper_GDALWarpDestName). I m confused about its arguments such as
> SWIGTYPE_p_p_GDALDatasetShadow, etc.
>
> Any help or pointers is highly appreciated. Is there any sample code that
> shows how to use gdalwarp from C#? Thanks you.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171105/b6073621/attachment.html>

From nyall.dawson at gmail.com  Sun Nov  5 14:28:20 2017
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Mon, 6 Nov 2017 08:28:20 +1000
Subject: [gdal-dev] Possible to determine whether a vector format is
	spatial?
In-Reply-To: <1872328.lf53T3Jihk@even-i700>
References: <CAB28Ash4743bpVwozLXz6d0sJG1ba-=UhYSJe_XMvmKe2hrigw@mail.gmail.com>
 <1872328.lf53T3Jihk@even-i700>
Message-ID: <CAB28AshbyM-uv0QC+CA=efkaT-OJpsqR76uumZSqBz1DB2GDhQ@mail.gmail.com>

On 5 November 2017 at 19:36, Even Rouault <even.rouault at spatialys.com> wrote:
> On dimanche 5 novembre 2017 13:16:43 CET Nyall Dawson wrote:
>
> There's indeed no driver metadata for this currently.
>

Thanks. PR at https://github.com/OSGeo/gdal/pull/259

Nyall

From bontepaarden at gmail.com  Mon Nov  6 23:45:51 2017
From: bontepaarden at gmail.com (Paul Meems)
Date: Tue, 7 Nov 2017 08:45:51 +0100
Subject: [gdal-dev] gdalwarp from C#
In-Reply-To: <CAJbDoZqWZMkPW8i-xD2ZSjfTyctp0vJ-ymfJNjhNCthwu3eo9Q@mail.gmail.com>
References: <CAJbDoZqWZMkPW8i-xD2ZSjfTyctp0vJ-ymfJNjhNCthwu3eo9Q@mail.gmail.com>
Message-ID: <CAHNf2YRAO+3jVvaSMy4VuLKwiDvOk+B1k3rG55y_O3xscPmZvA@mail.gmail.com>

We're using it like this:

using (var ds = _gdalProxy.Open(input, Access.GA_ReadOnly))
{
    if (ds == null)
    {
        throw new Exception("Can't open GDAL dataset: " + input);
    }

    var gdalOptions = new GDALWarpAppOptions(options);
    var ptr = new[] { Dataset.getCPtr(ds).Handle };
    var gcHandle = GCHandle.Alloc(ptr, GCHandleType.Pinned);
    try
    {
        // https://trac.osgeo.org/gdal/ticket/6437
        var dss = new
SWIGTYPE_p_p_GDALDatasetShadow(gcHandle.AddrOfPinnedObject(), false, null);
        using (var newDs = _gdalProxy.wrapper_GDALWarpDestName(output, 1,
dss, gdalOptions, null, null))
        {
            if (newDs == null)
            {
                throw new Exception("GdalWarp failed: " +
_gdalProxy.GetLastErrorMsg());
            }
        }
    }
    finally
    {
        if (gcHandle.IsAllocated)
            gcHandle.Free();
    }

    return true;
}




Paul

*Paul Meems *
Release manager, configuration manager
and forum moderator of MapWindow GIS.
www.mapwindow.org

Owner of MapWindow.nl - Support for
Dutch speaking users.
www.mapwindow.nl


*The MapWindow GIS project has moved to GitHub
<https://github.com/MapWindow>!*


Download the latest MapWinGIS mapping engine.
<https://github.com/MapWindow/MapWinGIS/releases>

Download the latest MapWindow 5 open source desktop application.
<https://github.com/MapWindow/MapWindow5/releases>

2017-11-04 20:04 GMT+01:00 Karu Kaarigar <kaarigar at gmail.com>:

> I am trying to use gdalwarp using C# bindings. I am using 64bit libs.
> However, I am not able to find proper docs on its usage. Specifically I
> need to know how to use the GDALWarpAppOptions and the format of options
> string array passed to its constructor. I also need to know the call
> semantics of various wrapper methods (wrapper_GDALWarpDestName,
> wrapper_GDALWarpDestName). I m confused about its arguments such as
> SWIGTYPE_p_p_GDALDatasetShadow, etc.
>
> Any help or pointers is highly appreciated. Is there any sample code that
> shows how to use gdalwarp from C#? Thanks you.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/12e1f229/attachment.html>

From vincent.bernat at magellium.fr  Mon Nov  6 23:55:04 2017
From: vincent.bernat at magellium.fr (Vincent BERNAT)
Date: Tue, 7 Nov 2017 07:55:04 +0000
Subject: [gdal-dev] [gdal 2.2.2] different result with gdal 2.1.0
In-Reply-To: <5212177.2KvNqHDvaO@even-i700>
References: <1509436070082.90129@magellium.fr>,<5212177.2KvNqHDvaO@even-i700>
Message-ID: <1510041303339.39942@magellium.fr>

Thanks for your reply.


I have these differents only with images using driver SRP/Standard Raster Product (ASRP/USRP)


i did it with gdalwrap with 2.1.0 and 2.2.2 :

>>gdalwrap input.IMG output.IMG -overwrite -t_srs EPSG:4326


and here are the 2 gdalinfo i got in outputs :


Driver: GTiff/GeoTIFF
Files: OUT_2.2.2.IMG
Size is 2165, 188
Coordinate System is:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.257223563,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0],
    UNIT["degree",0.0174532925199433],
    AUTHORITY["EPSG","4326"]]
Origin = (1.000000000000000,-84.998318287963713)
Pixel Size = (0.000376928984429,-0.000376928984429)
Metadata:
  AREA_OR_POINT=Area
  SRP_CREATIONDATE=20070417
  SRP_EDN=0
  SRP_NAM=APOLES01
  SRP_PRODUCT=ASRP
  SRP_REVISIONDATE=20070417
  SRP_SCA=50000
  SRP_ZNA=18
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (   1.0000000, -84.9983183) (  1d 0' 0.00"E, 84d59'53.95"S)
Lower Left  (   1.0000000, -85.0691809) (  1d 0' 0.00"E, 85d 4' 9.05"S)
Upper Right (   1.8160513, -84.9983183) (  1d48'57.78"E, 84d59'53.95"S)
Lower Right (   1.8160513, -85.0691809) (  1d48'57.78"E, 85d 4' 9.05"S)
Center      (   1.4080256, -85.0337496) (  1d24'28.89"E, 85d 2' 1.50"S)
Band 1 Block=2165x3 Type=Byte, ColorInterp=Palette
  NoData Value=0
  Color Table (RGB with 256 entries)
    0: 0,0,0,0
    1: 0,0,17,255

-------------------------------------------------------------------------------------------------


gdalinfo OUT_2.1.0.IMG
Driver: GTiff/GeoTIFF
Size is 11865, 2172
Coordinate System is:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.257223563,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0],
    UNIT["degree",0.0174532925199433],
    AUTHORITY["EPSG","4326"]]
Origin = (-71.565051177077976,-75.410804142370040)
Pixel Size = (0.004477910774178,-0.004477910774178)
Metadata:
  AREA_OR_POINT=Area
  SRP_CREATIONDATE=20070417
  SRP_EDN=0
  SRP_NAM=APOLES01
  SRP_PRODUCT=ASRP
  SRP_REVISIONDATE=20070417
  SRP_SCA=50000
  SRP_ZNA=18
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  ( -71.5650512, -75.4108041) ( 71d33'54.18"W, 75d24'38.89"S)
Lower Left  ( -71.5650512, -85.1368263) ( 71d33'54.18"W, 85d 8'12.57"S)
Upper Right ( -18.4346398, -75.4108041) ( 18d26' 4.70"W, 75d24'38.89"S)
Lower Right ( -18.4346398, -85.1368263) ( 18d26' 4.70"W, 85d 8'12.57"S)
Center      ( -44.9998455, -80.2738152) ( 44d59'59.44"W, 80d16'25.73"S)
Band 1 Block=11865x1 Type=Byte, ColorInterp=Palette
  NoData Value=0
  Color Table (RGB with 256 entries)
    0: 0,0,0,255

-------------------------------------------------------------------------------------------------



________________________________
De : Even Rouault <even.rouault at spatialys.com>
Envoyé : mardi 31 octobre 2017 12:49
À : gdal-dev at lists.osgeo.org
Cc : Vincent BERNAT
Objet : Re: [gdal-dev] [gdal 2.2.2] different result with gdal 2.1.0


On mardi 31 octobre 2017 07:47:50 CET Vincent BERNAT wrote:

> Hello all,

>

>

> I was working with gdal 2.1.0 and i decide to update to 2.2.2

>

> I work on Centos.

>

>

> Everything is ok but on one image, i don't get the same result (and the

> result with 2.2.2 seems incorrect).

>

>

> One of the most important difference is the result of the call of this

> function :

>

> GDALSuggestedWarpOutput



You don't give enough information for other people to be able to reproduce. Which arguments do you pass to GDALSuggestedWarpOutput ?



Can you reproduce with gdalwarp ?



Here's what I've tried:



* generate an image with equivalent size and georeferencing as yours



gdal_translate byte.tif test.tif -a_srs 'PROJCS["ARC_System_Zone_18",

GEOGCS["GCS_Sphere",

DATUM["D_Sphere",

SPHEROID["Sphere",6378137.0,0.0]],

PRIMEM["Greenwich",0],

UNIT["degree",0.0174532925199433]],

PROJECTION["Azimuthal_Equidistant"],

PARAMETER["latitude_of_center",-90],

PARAMETER["longitude_of_center",0],

PARAMETER["false_easting",0],

PARAMETER["false_northing",0]]' \

-outsize 1536 1536 -a_ullr 9713.965 556512.681 17400.989 548825.658



* wrap it to WGS84



gdalwarp test.tif out.tif -overwrite -t_srs EPSG:4326





With GDAL trunk or 2.1, I get the exact same result:



$ gdalinfo -checksum out.tif

Driver: GTiff/GeoTIFF

Files: out.tif

Size is 2165, 188

Coordinate System is:

GEOGCS["WGS 84",

DATUM["WGS_1984",

SPHEROID["WGS 84",6378137,298.257223563,

AUTHORITY["EPSG","7030"]],

AUTHORITY["EPSG","6326"]],

PRIMEM["Greenwich",0],

UNIT["degree",0.0174532925199433],

AUTHORITY["EPSG","4326"]]

Origin = (1.000000002034652,-84.998318292160022)

Pixel Size = (0.000376928999761,-0.000376928999761)

Metadata:

AREA_OR_POINT=Area

Image Structure Metadata:

INTERLEAVE=BAND

Corner Coordinates:

Upper Left ( 1.0000000, -84.9983183) ( 1d 0' 0.00"E, 84d59'53.95"S)

Lower Left ( 1.0000000, -85.0691809) ( 1d 0' 0.00"E, 85d 4' 9.05"S)

Upper Right ( 1.8160513, -84.9983183) ( 1d48'57.78"E, 84d59'53.95"S)

Lower Right ( 1.8160513, -85.0691809) ( 1d48'57.78"E, 85d 4' 9.05"S)

Center ( 1.4080256, -85.0337496) ( 1d24'28.89"E, 85d 2' 1.50"S)

Band 1 Block=2165x3 Type=Byte, ColorInterp=Gray

Checksum=51779



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/7e836d28/attachment-0001.html>

From ari.jolma at gmail.com  Tue Nov  7 00:56:07 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 7 Nov 2017 10:56:07 +0200
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
Message-ID: <9374b59c-91d8-bac0-58de-f42231923e46@gmail.com>

Thanks for the replies before. I believe I'm getting closer, but slowly.

In my earlier question I was referring to three CRSs. I now believe that 
it is only two since I had overlooked requirement 23, which to my 
understanding requires that the CRS of the coverage (top level boundedBy 
element) is the same as the CRS of the grid (in domainSet element). Thus 
GDAL can and should set the dataset size and geotransform by what's in 
domainSet and there's no such ambiguity in the grid size as I thought.

To get multidimensional data into GDAL 2D domain, one may need to slice 
the data at some point in the non x/y dimensions. I'm testing this with 
the Rasdaman server. My code currently creates a KVP 
"SUBSET=unix(2008-01-08T00:02:58.000Z)" in an attempt to slice the time 
dimension. The whole test URL is

http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=test_irr_cube_2&FORMAT=application%2Foctet-stream&SUBSET=E(75042.7273594,95042.7273593873)&SUBSET=N(5434865.55794,5454865.55794)&SUBSET=unix(2008-01-08T00:02:58.000Z)&RANGESUBSET=b1

which replies

Trimming subset in WCS must follow this syntax 'lowerBound,upperBound', 
given '2008-01-08T00:02:58.000Z'.

I don't understand why. I'm trying to slice, not trim. I don't know of 
other servers serving >2D data so I can't test with other brands.

With a MapServer instance I have a problem setting the rangesubset, it 
does not seem to work with field names, only indexes.

http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=BGS_EMODNET_CentralMed-MCol&FORMAT=image%2Ftiff&SUBSET=long(9.83125,9.83958334)&SUBSET=lat(46.18124999,46.18958333)&RANGESUBSET=band1

does not work although band1 is given as name in coverage description, but

http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=BGS_EMODNET_CentralMed-MCol&FORMAT=image%2Ftiff&SUBSET=long(9.83125,9.83958334)&SUBSET=lat(46.18124999,46.18958333)&RANGESUBSET=1

works.

Ari


Ari Jolma kirjoitti 03.11.2017 klo 09:57:
> I have two things that I need to ask/discuss regarding WCS 2.0
>
> 1) My understanding is that there are potentially three CRS in 
> operation: the CRS of the bbox of the coverage (the native CRS of the 
> server); the CRS of the grid; and the CRS where the user wants the 
> data. I can imagine that it is perfectly possible for a server to 
> advertise data from an area bounded by geographic coordinates, and 
> that the data is in some specific projected coordinate system. Also, 
> the data could be regular but not east-north (it is rotated for 
> example). This would be described in a CoverageDescription. Despite 
> the rotation, GDAL would show the data east-nort (without rotation), 
> since only the bbox of the coverage is given.
>
> Again, it is perfectly possible that the user wants the data in some 
> CRS that is not the native CRS of the WCS. The GetCoverage request can 
> contain an instruction for the server to serve the data in the CRS the 
> user wants the data (this is an extension in 2.0). User can set this 
> (it must be one of those supported by the server) in the dataset 
> definition (WCS_GDAL XML). Thus GDAL needs to show the coverage bbox 
> to its users in that CRS. And, as above, the GeoTransform is east-north.
>
> Is this correct analysis?
>
> BTW, the coordinate transformation of the bbox is not done in WCS 
> driver at the moment in the case of user CRS != server native CRS.
>
>
> 2) WCS can offer multidimensional data with complex data records. I 
> want the GDAL user to have a control on how the data is organized into 
> (current) GDAL. For example the server may offer spatio-temporal 
> (x/y/t) data with about wave heights in a sea (to link this to what 
> I'm getting paid for now :)) that are described as average and max. 
> Obviously I want x/y bands, but I may want either the temporal data or 
> the wave height data into bands, depending on the application. The 
> workflow would go
>
> 1. gdalinfo to the server, see this data as a layer with name 
> "VHM0_year_meanmax", gdalinfo reports that layer as a subdataset
>
> 2. gdalinfo into the layer, now it reports that there is an additional 
> dimension (t) and that the datarecord consists of two values mean and 
> max; it also reports information about the time (begin, end, step)
>
> 3. I decide to use a specific time and start using datasets with two 
> bands (mean and max)
>
> I have such data as NetCDF and I don't think I can follow that 
> workflow with it since the driver puts the mean and max wave heights 
> right away into subdatasets and time into bands.
>
> In the WCS there could/should be a similar default behavior but that 
> should be changeable by options (-oo t=some_timestamp).
>
> Thoughts?
>
> Ari
>
>


From p.baumann at jacobs-university.de  Tue Nov  7 06:29:42 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Tue, 7 Nov 2017 15:29:42 +0100
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <9374b59c-91d8-bac0-58de-f42231923e46@gmail.com>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
 <9374b59c-91d8-bac0-58de-f42231923e46@gmail.com>
Message-ID: <a057a71a-7a80-2dde-1985-3de192476c6a@jacobs-university.de>

Ari-


On 11/07/2017 09:56 AM, Ari Jolma wrote:
> Thanks for the replies before. I believe I'm getting closer, but slowly.
>
> In my earlier question I was referring to three CRSs. I now believe that it is
> only two since I had overlooked requirement 23, which to my understanding
> requires that the CRS of the coverage (top level boundedBy element) is the
> same as the CRS of the grid (in domainSet element). Thus GDAL can and should
> set the dataset size and geotransform by what's in domainSet and there's no
> such ambiguity in the grid size as I thought.
>
> To get multidimensional data into GDAL 2D domain, one may need to slice the
> data at some point in the non x/y dimensions. I'm testing this with the
> Rasdaman server. My code currently creates a KVP
> "SUBSET=unix(2008-01-08T00:02:58.000Z)" in an attempt to slice the time
> dimension. The whole test URL is
>
> http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=test_irr_cube_2&FORMAT=application%2Foctet-stream&SUBSET=E(75042.7273594,95042.7273593873)&SUBSET=N(5434865.55794,5454865.55794)&SUBSET=unix(2008-01-08T00:02:58.000Z)&RANGESUBSET=b1
>
>
> which replies
>
> Trimming subset in WCS must follow this syntax 'lowerBound,upperBound', given
> '2008-01-08T00:02:58.000Z'.

did you try putting the time string in double quotes? As the string can have any
syntax it needs to be escaped.

>
> I don't understand why. I'm trying to slice, not trim. I don't know of other
> servers serving >2D data so I can't test with other brands.

syntactically, you are slicing because you have only one time coordinate;
trimming needs lower + upper bound.

-Peter


>
> With a MapServer instance I have a problem setting the rangesubset, it does
> not seem to work with field names, only indexes.
>
> http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=BGS_EMODNET_CentralMed-MCol&FORMAT=image%2Ftiff&SUBSET=long(9.83125,9.83958334)&SUBSET=lat(46.18124999,46.18958333)&RANGESUBSET=band1
>
>
> does not work although band1 is given as name in coverage description, but
>
> http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=BGS_EMODNET_CentralMed-MCol&FORMAT=image%2Ftiff&SUBSET=long(9.83125,9.83958334)&SUBSET=lat(46.18124999,46.18958333)&RANGESUBSET=1
>
>
> works.
>
> Ari
>
>
> Ari Jolma kirjoitti 03.11.2017 klo 09:57:
>> I have two things that I need to ask/discuss regarding WCS 2.0
>>
>> 1) My understanding is that there are potentially three CRS in operation: the
>> CRS of the bbox of the coverage (the native CRS of the server); the CRS of
>> the grid; and the CRS where the user wants the data. I can imagine that it is
>> perfectly possible for a server to advertise data from an area bounded by
>> geographic coordinates, and that the data is in some specific projected
>> coordinate system. Also, the data could be regular but not east-north (it is
>> rotated for example). This would be described in a CoverageDescription.
>> Despite the rotation, GDAL would show the data east-nort (without rotation),
>> since only the bbox of the coverage is given.
>>
>> Again, it is perfectly possible that the user wants the data in some CRS that
>> is not the native CRS of the WCS. The GetCoverage request can contain an
>> instruction for the server to serve the data in the CRS the user wants the
>> data (this is an extension in 2.0). User can set this (it must be one of
>> those supported by the server) in the dataset definition (WCS_GDAL XML). Thus
>> GDAL needs to show the coverage bbox to its users in that CRS. And, as above,
>> the GeoTransform is east-north.
>>
>> Is this correct analysis?
>>
>> BTW, the coordinate transformation of the bbox is not done in WCS driver at
>> the moment in the case of user CRS != server native CRS.
>>
>>
>> 2) WCS can offer multidimensional data with complex data records. I want the
>> GDAL user to have a control on how the data is organized into (current) GDAL.
>> For example the server may offer spatio-temporal (x/y/t) data with about wave
>> heights in a sea (to link this to what I'm getting paid for now :)) that are
>> described as average and max. Obviously I want x/y bands, but I may want
>> either the temporal data or the wave height data into bands, depending on the
>> application. The workflow would go
>>
>> 1. gdalinfo to the server, see this data as a layer with name
>> "VHM0_year_meanmax", gdalinfo reports that layer as a subdataset
>>
>> 2. gdalinfo into the layer, now it reports that there is an additional
>> dimension (t) and that the datarecord consists of two values mean and max; it
>> also reports information about the time (begin, end, step)
>>
>> 3. I decide to use a specific time and start using datasets with two bands
>> (mean and max)
>>
>> I have such data as NetCDF and I don't think I can follow that workflow with
>> it since the driver puts the mean and max wave heights right away into
>> subdatasets and time into bands.
>>
>> In the WCS there could/should be a similar default behavior but that should
>> be changeable by options (-oo t=some_timestamp).
>>
>> Thoughts?
>>
>> Ari
>>
>>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)



From ari.jolma at gmail.com  Tue Nov  7 06:59:05 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 7 Nov 2017 16:59:05 +0200
Subject: [gdal-dev] WCS 2.0, getting (multidimensional) data
In-Reply-To: <a057a71a-7a80-2dde-1985-3de192476c6a@jacobs-university.de>
References: <da58f92d-d69a-e599-794b-0ad714848304@gmail.com>
 <9374b59c-91d8-bac0-58de-f42231923e46@gmail.com>
 <a057a71a-7a80-2dde-1985-3de192476c6a@jacobs-university.de>
Message-ID: <7e18cc8c-1c35-ae58-d966-aaf5b6320b55@gmail.com>

Peter Baumann kirjoitti 07.11.2017 klo 16:29:
> Ari-
>
>
> On 11/07/2017 09:56 AM, Ari Jolma wrote:
>> To get multidimensional data into GDAL 2D domain, one may need to slice the
>> data at some point in the non x/y dimensions. I'm testing this with the
>> Rasdaman server. My code currently creates a KVP
>> "SUBSET=unix(2008-01-08T00:02:58.000Z)" in an attempt to slice the time
>> dimension. The whole test URL is
>>
>> http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=test_irr_cube_2&FORMAT=application%2Foctet-stream&SUBSET=E(75042.7273594,95042.7273593873)&SUBSET=N(5434865.55794,5454865.55794)&SUBSET=unix(2008-01-08T00:02:58.000Z)&RANGESUBSET=b1
>>
>>
>> which replies
>>
>> Trimming subset in WCS must follow this syntax 'lowerBound,upperBound', given
>> '2008-01-08T00:02:58.000Z'.
> did you try putting the time string in double quotes? As the string can have any
> syntax it needs to be escaped.

ok, thanks, that works.

Ari


From nik at nikosalexandris.net  Tue Nov  7 07:15:42 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Tue, 7 Nov 2017 16:15:42 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
Message-ID: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>

Dear OSM experts,

a reproducible workflow that extracts specific tags from OSM's Planet
data set, includes:

1. downloading OSM Planet in form of a pbf file

2. convert pbf to o5m using `osmconvert`

3  extract areas of interest in separate `aoi_*.o5m` files, based on boundaries in form of .poly
files, using `osmconvert`

4. filtering for specific tags (i.e. highways), parallel tasks in 80 cores

```bash
# custom function for 'highway' tags
function osmfilterhighway { osmfilter $1 --drop-version --keep="highway=track =footway =bridleway =path" > $(basename $1 .o5m)_highway.osm; }
export -f osmfilterhighway

# filter
find . -type f -name \*aoi*.o5m |parallel -j80 osmfilterhighway {}
```

1. Is it any better using GDAL's `osmconf.ini` "method" [0],
over `osmconvert` and `osmfilter`, in terms of reliability/speed etc.?

2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?

3. What is the way to split "other_tags" in multiple new fields *when*
knowing exactly which tags are contained and should be obtained?

Thank you for any help,

Nikos


[0] https://svn.osgeo.org/gdal/trunk/gdal/data/osmconf.ini
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/eaa3d190/attachment.sig>

From gabriel.vatin at kinaxia.fr  Tue Nov  7 09:04:29 2017
From: gabriel.vatin at kinaxia.fr (Gabriel Vatin)
Date: Tue, 7 Nov 2017 18:04:29 +0100
Subject: [gdal-dev] _gdal.FillNodata not Python function
In-Reply-To: <5f4ea766-5864-e769-e4e0-62ac9198f48e@kinaxia.fr>
References: <5f4ea766-5864-e769-e4e0-62ac9198f48e@kinaxia.fr>
Message-ID: <5174b2ed-7f7b-6530-5ae5-9c7d5bf3078b@kinaxia.fr>

Still no ideas about this bug ?...

Gabriel


Le 02/11/2017 à 16:00, Gabriel Vatin a écrit :
> Hi all,
>
> I'm working with Python 3.6 32bits, GDAL package 
> (GDAL‑2.2.2‑cp36‑cp36m‑win32.whl) i've installed from here : 
> https://www.lfd.uci.edu/~gohlke/pythonlibs/
>
> I also installed the gdal-202-1800-core.msi from here : 
> http://www.gisinternals.com/query.html?content=filelist&file=release-1800-gdal-2-2-1-mapserver-7-0-6.zip
>
> Here is the error I get when I try the fillnodata python utility :
> gdal_fillnodata -md 2 myImage.tif myImage_correction.tif
> Traceback (most recent call last):
>   File "C:\Python36\Scripts\gdal_fillnodata.py", line 197, in <module>
>     callback = prog_func )
>   File "C:\Python36\lib\site-packages\osgeo\gdal.py", line 2742, in 
> FillNodata
>     return _gdal.FillNodata(*args, **kwargs)
> RuntimeError: Object given is not a Python function
>
> Do you have any idea how to fix it ? Maybe wrong installation ?... 
> Thanks !
>
>
> Gabriel



From roarke.gaskill at weather.com  Tue Nov  7 13:22:37 2017
From: roarke.gaskill at weather.com (Roarke Gaskill)
Date: Tue, 7 Nov 2017 15:22:37 -0600
Subject: [gdal-dev] Grib2 Question
Message-ID: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>

Hi,

Why is the number of points greater than 33554432 considered nonsense?

https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/grib/degrib18/g2clib-1.0.4/g2_unpack5.c#L77


Thanks,
Roarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/74efa689/attachment.html>

From even.rouault at spatialys.com  Tue Nov  7 13:30:43 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 07 Nov 2017 22:30:43 +0100
Subject: [gdal-dev] [gdal 2.2.2] different result with gdal 2.1.0
In-Reply-To: <1510041303339.39942@magellium.fr>
References: <1509436070082.90129@magellium.fr> <5212177.2KvNqHDvaO@even-i700>
 <1510041303339.39942@magellium.fr>
Message-ID: <1523076.XH4BmzbLk6@even-i700>

Vincent,

digging into the GDAL 2.2.0 NEWS file, I see:
"""
ASRP driver:
 * fix georeferencing of polar arc zone images (#6560)
""""

So if there's an issue it is mostly related to that change, rather than on the gdalwarp / 
GDALSuggestedWarpOutput side of things

And that fix was backported to GDAL 2.1.1, which explains I saw same results in the latest 
state of GDAL 2.1, 2.2 and trunk branchs, if you are on GDAL 2.1.0 which has not this fix

You should already see the difference of georeferencing between GDAL 2.1.0 and later 
version by doing a gdalinfo on the source ASRP file.

Do you have strong reasons to believe that GDAL 2.1.0 was really georeferencing 
correctly your dataset ? 
The change done in https://trac.osgeo.org/gdal/ticket/6560 seems at first sight to be an 
improvement regarding the previous behaviour

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/cfb38aff/attachment.html>

From even.rouault at spatialys.com  Tue Nov  7 13:37:02 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 07 Nov 2017 22:37:02 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
Message-ID: <3018023.1N5UhNMUuu@even-i700>

> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?

Yes, but within the limits ot the shapefile, and particularly .dbf format: limitation to 254 
characters for field values, 10 characters for field names... which are easily violated by 
OSM extracts.

Spatialite, GeoPackage, PostGIS etc. would be better choices as output format

> 
> 3. What is the way to split "other_tags" in multiple new fields *when*
> knowing exactly which tags are contained and should be obtained?

Edit osmconf.ini to add in the attributes= settings the tag names you're interested in.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/02a1b496/attachment.html>

From schwehr at gmail.com  Tue Nov  7 13:51:30 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 7 Nov 2017 13:51:30 -0800
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
Message-ID: <CACmBxyt9pVNQvDSbS=meTyuyta2YpDngsf3NEbUi-Uiy+HiUTQ@mail.gmail.com>

It's possible to cause massive allocations with a tiny corrupted grib file
causing an out-of-memory.  I found that case with the llvm ASAN fuzzer.  If
you have a specification that gives a more reasoned maximum or a better
overall check, I'm listening.  I definitely think the sanity checking can
be improved.  Mostly I just try to survive the g2clib code.  It doesn't
come with tests and digging through GRIB specs to match up to g2clib source
isn't my favorite thing to do.

https://github.com/OSGeo/gdal/commit/ae92f7fb8e32381124a37588d27b9af695afce20

On Tue, Nov 7, 2017 at 1:22 PM, Roarke Gaskill <roarke.gaskill at weather.com>
wrote:

> Hi,
>
> Why is the number of points greater than 33554432 considered nonsense?
>
> https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/grib/
> degrib18/g2clib-1.0.4/g2_unpack5.c#L77
>
>
> Thanks,
> Roarke
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/8ae1e194/attachment.html>

From even.rouault at spatialys.com  Tue Nov  7 14:03:59 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 07 Nov 2017 23:03:59 +0100
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CACmBxyt9pVNQvDSbS=meTyuyta2YpDngsf3NEbUi-Uiy+HiUTQ@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <CACmBxyt9pVNQvDSbS=meTyuyta2YpDngsf3NEbUi-Uiy+HiUTQ@mail.gmail.com>
Message-ID: <3279559.8E5PNBDTHO@even-i700>

On mardi 7 novembre 2017 13:51:30 CET Kurt Schwehr wrote:
> It's possible to cause massive allocations with a tiny corrupted grib file
> causing an out-of-memory.  I found that case with the llvm ASAN fuzzer.  If
> you have a specification that gives a more reasoned maximum or a better
> overall check, I'm listening.  I definitely think the sanity checking can
> be improved.  Mostly I just try to survive the g2clib code.  It doesn't
> come with tests and digging through GRIB specs to match up to g2clib source
> isn't my favorite thing to do.
> 
> https://github.com/OSGeo/gdal/commit/ae92f7fb8e32381124a37588d27b9af695afce2
> 0

I guess that if Roarke is asking the question he might have a dataset that breaks this limit ? If 
so, we might consider reverting that change, or making it more robust (which can be very 
tricky I know. Perhaps some heuristics with the file size ?), or just using it in fuzzing mode and 
not in production for now. And a pointer to such a dataset would be much appreciated.

(By the way: 2<<24 is IMHO an usual way of writing a limit. I confused it with 2^24 initially. So 
1 << 25 would perhaps be better. Or just in decimal form as it is completely arbitary and not 
related to a binary encoding)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/ee839da7/attachment-0001.html>

From roarke.gaskill at weather.com  Tue Nov  7 14:15:47 2017
From: roarke.gaskill at weather.com (Roarke Gaskill)
Date: Tue, 7 Nov 2017 16:15:47 -0600
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <3279559.8E5PNBDTHO@even-i700>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <CACmBxyt9pVNQvDSbS=meTyuyta2YpDngsf3NEbUi-Uiy+HiUTQ@mail.gmail.com>
 <3279559.8E5PNBDTHO@even-i700>
Message-ID: <CADyWFeWXwWrQTrMLhvb4oxyqPnPkQawr-1Y7zLP_Kwx6saUmdg@mail.gmail.com>

Wouldn't the the max size be limited by the number of bytes read?  So in
this case 4 bytes.

http://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_sect5.shtml

Looking at netcdf's implementation they treat the value as a 32 bit signed
int.

https://github.com/Unidata/thredds/blob/5.0.0/grib/src/main/java/ucar/nc2/grib/grib2/Grib2SectionDataRepresentation.java#L69

I am dealing with proprietary grib2 files that do break the current limit
of 33554432.



On Tue, Nov 7, 2017 at 4:03 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 7 novembre 2017 13:51:30 CET Kurt Schwehr wrote:
>
> > It's possible to cause massive allocations with a tiny corrupted grib
> file
>
> > causing an out-of-memory. I found that case with the llvm ASAN fuzzer. If
>
> > you have a specification that gives a more reasoned maximum or a better
>
> > overall check, I'm listening. I definitely think the sanity checking can
>
> > be improved. Mostly I just try to survive the g2clib code. It doesn't
>
> > come with tests and digging through GRIB specs to match up to g2clib
> source
>
> > isn't my favorite thing to do.
>
> >
>
> > https://github.com/OSGeo/gdal/commit/ae92f7fb8e32381124a37588d27b9a
> f695afce2
>
> > 0
>
>
>
> I guess that if Roarke is asking the question he might have a dataset that
> breaks this limit ? If so, we might consider reverting that change, or
> making it more robust (which can be very tricky I know. Perhaps some
> heuristics with the file size ?), or just using it in fuzzing mode and not
> in production for now. And a pointer to such a dataset would be much
> appreciated.
>
>
>
> (By the way: 2<<24 is IMHO an usual way of writing a limit. I confused it
> with 2^24 initially. So 1 << 25 would perhaps be better. Or just in decimal
> form as it is completely arbitary and not related to a binary encoding)
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
*Roarke **Gaskill  *|Senior Software Engineer
*e:* roarke.gaskill at weather.com
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/fb5bc99c/attachment.html>

From schwehr at gmail.com  Tue Nov  7 14:21:27 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 7 Nov 2017 14:21:27 -0800
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CADyWFeWXwWrQTrMLhvb4oxyqPnPkQawr-1Y7zLP_Kwx6saUmdg@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <CACmBxyt9pVNQvDSbS=meTyuyta2YpDngsf3NEbUi-Uiy+HiUTQ@mail.gmail.com>
 <3279559.8E5PNBDTHO@even-i700>
 <CADyWFeWXwWrQTrMLhvb4oxyqPnPkQawr-1Y7zLP_Kwx6saUmdg@mail.gmail.com>
Message-ID: <CACmBxytsHc=6OD9AcG7Dk11bgX-muBSXjYBtfM7KoofVZTiY_g@mail.gmail.com>

Yeah, 1 << ## would have been better.  Sigh.

But really, someone needs to work through the logic of this stuff and do
something that actually works through what is reasonable.  Code that is
intelligent and explains why it is doing is far preferable.  OOM is not
okay in the world I work in, so I tried to pick a large number (basically
at random) that should let almost all cases through until someone took more
time.

allowing a full range number without checking to see if the size is
reasonable is a *major* problem for me.  An OOM is a fatal (as in no error
message, your process is dead) situation in my world, so allowing larger
without checking seems unpleasant.

Perhaps a config option to allow massive files through in the short term?

On Tue, Nov 7, 2017 at 2:15 PM, Roarke Gaskill <roarke.gaskill at weather.com>
wrote:

>
> Wouldn't the the max size be limited by the number of bytes read?  So in
> this case 4 bytes.
>
> http://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_sect5.shtml
>
> Looking at netcdf's implementation they treat the value as a 32 bit signed
> int.
>
> https://github.com/Unidata/thredds/blob/5.0.0/grib/src/
> main/java/ucar/nc2/grib/grib2/Grib2SectionDataRepresentation.java#L69
>
> I am dealing with proprietary grib2 files that do break the current limit
> of 33554432.
>
>
>
> On Tue, Nov 7, 2017 at 4:03 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> On mardi 7 novembre 2017 13:51:30 CET Kurt Schwehr wrote:
>>
>> > It's possible to cause massive allocations with a tiny corrupted grib
>> file
>>
>> > causing an out-of-memory. I found that case with the llvm ASAN fuzzer.
>> If
>>
>> > you have a specification that gives a more reasoned maximum or a better
>>
>> > overall check, I'm listening. I definitely think the sanity checking can
>>
>> > be improved. Mostly I just try to survive the g2clib code. It doesn't
>>
>> > come with tests and digging through GRIB specs to match up to g2clib
>> source
>>
>> > isn't my favorite thing to do.
>>
>> >
>>
>> > https://github.com/OSGeo/gdal/commit/ae92f7fb8e32381124a3758
>> 8d27b9af695afce2
>>
>> > 0
>>
>>
>>
>> I guess that if Roarke is asking the question he might have a dataset
>> that breaks this limit ? If so, we might consider reverting that change, or
>> making it more robust (which can be very tricky I know. Perhaps some
>> heuristics with the file size ?), or just using it in fuzzing mode and not
>> in production for now. And a pointer to such a dataset would be much
>> appreciated.
>>
>>
>>
>> (By the way: 2<<24 is IMHO an usual way of writing a limit. I confused it
>> with 2^24 initially. So 1 << 25 would perhaps be better. Or just in decimal
>> form as it is completely arbitary and not related to a binary encoding)
>>
>>
>>
>> Even
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>
>
>
> --
> *Roarke **Gaskill  *|Senior Software Engineer
> *e:* roarke.gaskill at weather.com
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps>
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/305ec3e5/attachment.html>

From even.rouault at spatialys.com  Tue Nov  7 15:18:41 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 08 Nov 2017 00:18:41 +0100
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CACmBxytsHc=6OD9AcG7Dk11bgX-muBSXjYBtfM7KoofVZTiY_g@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <CADyWFeWXwWrQTrMLhvb4oxyqPnPkQawr-1Y7zLP_Kwx6saUmdg@mail.gmail.com>
 <CACmBxytsHc=6OD9AcG7Dk11bgX-muBSXjYBtfM7KoofVZTiY_g@mail.gmail.com>
Message-ID: <9746430.F1krINGSEk@even-i700>

On mardi 7 novembre 2017 14:21:27 CET Kurt Schwehr wrote:
> Yeah, 1 << ## would have been better.  Sigh.
> 
> But really, someone needs to work through the logic of this stuff and do
> something that actually works through what is reasonable.  Code that is
> intelligent and explains why it is doing is far preferable.  OOM is not
> okay in the world I work in, so I tried to pick a large number (basically
> at random) that should let almost all cases through until someone took more
> time.

I'm afraid this is unlikely that "someone" pops up by magic to address that, given the time 
investment it would represent. For work related to adding a write side to the GRIB2 driver, I 
might try in the coming weeks to resync with newest version of g2clib & degrib, which by 
itself will be certainly a challenging exercice given all the patching we have done through the 
years, but adressing such issues of being robust with "hostile" files is definitely not in the 
scope of work.

I'm not sure if there are other C/C++ grib1+grib2 libs that would be better in that aspect, 
while having at least the same level of functionality, and a permissive license.

> 
> allowing a full range number without checking to see if the size is
> reasonable is a *major* problem for me.  An OOM is a fatal (as in no error
> message, your process is dead) situation in my world, so allowing larger
> without checking seems unpleasant.
> 
> Perhaps a config option to allow massive files through in the short term?

I think the vast majority of users are likely less concerned with potential OOM situations on 
hostile/corrupted files, but more willing to have a working behaviour with real world 
datasets, so the reverse logic would seem better to me.

Or can we increase this threshold so that it works with datasets likes Roarke's one ? Kurt, 
what would be the maximum value you could bear ?
Roarke, can you add some breakpoint / debug message to see what value of *ndpts you get 
for your dataset ?

If we go with safe mode by default and a config option to disable it, then it should output a 
warning that explains which config option to enable to disable the limitation. + in the doc 
page of the driver.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/34841fa6/attachment-0001.html>

From schwehr at gmail.com  Tue Nov  7 15:34:15 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 7 Nov 2017 15:34:15 -0800
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <9746430.F1krINGSEk@even-i700>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <CADyWFeWXwWrQTrMLhvb4oxyqPnPkQawr-1Y7zLP_Kwx6saUmdg@mail.gmail.com>
 <CACmBxytsHc=6OD9AcG7Dk11bgX-muBSXjYBtfM7KoofVZTiY_g@mail.gmail.com>
 <9746430.F1krINGSEk@even-i700>
Message-ID: <CACmBxyvY8QFa+rYUCmZMKu03dBidA7gG+QyCxSj6PSF1L0=t7w@mail.gmail.com>

Why not something like this and just let me pick a small number?

#ifdef GRIB_MAX_ALLOC
const int knMaxAllloc = GRIB_MAX_ALLOC;
#else
const int knMaxAlloc = some massive number;
#endif

On Tue, Nov 7, 2017 at 3:18 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 7 novembre 2017 14:21:27 CET Kurt Schwehr wrote:
>
> > Yeah, 1 << ## would have been better. Sigh.
>
> >
>
> > But really, someone needs to work through the logic of this stuff and do
>
> > something that actually works through what is reasonable. Code that is
>
> > intelligent and explains why it is doing is far preferable. OOM is not
>
> > okay in the world I work in, so I tried to pick a large number (basically
>
> > at random) that should let almost all cases through until someone took
> more
>
> > time.
>
>
>
> I'm afraid this is unlikely that "someone" pops up by magic to address
> that, given the time investment it would represent. For work related to
> adding a write side to the GRIB2 driver, I might try in the coming weeks to
> resync with newest version of g2clib & degrib, which by itself will be
> certainly a challenging exercice given all the patching we have done
> through the years, but adressing such issues of being robust with "hostile"
> files is definitely not in the scope of work.
>
>
>
> I'm not sure if there are other C/C++ grib1+grib2 libs that would be
> better in that aspect, while having at least the same level of
> functionality, and a permissive license.
>
>
>
> >
>
> > allowing a full range number without checking to see if the size is
>
> > reasonable is a *major* problem for me. An OOM is a fatal (as in no error
>
> > message, your process is dead) situation in my world, so allowing larger
>
> > without checking seems unpleasant.
>
> >
>
> > Perhaps a config option to allow massive files through in the short term?
>
>
>
> I think the vast majority of users are likely less concerned with
> potential OOM situations on hostile/corrupted files, but more willing to
> have a working behaviour with real world datasets, so the reverse logic
> would seem better to me.
>
>
>
> Or can we increase this threshold so that it works with datasets likes
> Roarke's one ? Kurt, what would be the maximum value you could bear ?
>
> Roarke, can you add some breakpoint / debug message to see what value of
> *ndpts you get for your dataset ?
>
>
>
> If we go with safe mode by default and a config option to disable it, then
> it should output a warning that explains which config option to enable to
> disable the limitation. + in the doc page of the driver.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/c10eaac5/attachment.html>

From even.rouault at spatialys.com  Tue Nov  7 15:43:01 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 08 Nov 2017 00:43:01 +0100
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CACmBxyvY8QFa+rYUCmZMKu03dBidA7gG+QyCxSj6PSF1L0=t7w@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <9746430.F1krINGSEk@even-i700>
 <CACmBxyvY8QFa+rYUCmZMKu03dBidA7gG+QyCxSj6PSF1L0=t7w@mail.gmail.com>
Message-ID: <5054366.t4ZaB3EV3M@even-i700>

On mardi 7 novembre 2017 15:34:15 CET Kurt Schwehr wrote:
> Why not something like this and just let me pick a small number?
> 
> #ifdef GRIB_MAX_ALLOC
> const int knMaxAllloc = GRIB_MAX_ALLOC;
> #else
> const int knMaxAlloc = some massive number;
> #endif
> 

Yes, looks reasonable. I guess "some massive number" should probably be 
INT_MAX if we don't have a better way to do sanity checking right now.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/61da438d/attachment.html>

From roarke.gaskill at weather.com  Tue Nov  7 15:45:57 2017
From: roarke.gaskill at weather.com (Roarke Gaskill)
Date: Tue, 7 Nov 2017 17:45:57 -0600
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <5054366.t4ZaB3EV3M@even-i700>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <9746430.F1krINGSEk@even-i700>
 <CACmBxyvY8QFa+rYUCmZMKu03dBidA7gG+QyCxSj6PSF1L0=t7w@mail.gmail.com>
 <5054366.t4ZaB3EV3M@even-i700>
Message-ID: <CADyWFeU3U34_whypM-PC+qt_HdvSxpx_UoPiUD0r2mH4mawrFQ@mail.gmail.com>

It seems inappropriate (even as a quick hack) to put the size check in the
grib parser. With the check there, you are not able to run simple utilities
like gdalinfo on large files. What if I wanted to use gdalinfo to find out
if the file is too big to process?

If it is decided to continue with this quick hack, better logging would be
very helpful.

The number of points in the file I am testing is 67108864

On Tue, Nov 7, 2017 at 5:43 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 7 novembre 2017 15:34:15 CET Kurt Schwehr wrote:
>
> > Why not something like this and just let me pick a small number?
>
> >
>
> > #ifdef GRIB_MAX_ALLOC
>
> > const int knMaxAllloc = GRIB_MAX_ALLOC;
>
> > #else
>
> > const int knMaxAlloc = some massive number;
>
> > #endif
>
> >
>
>
>
> Yes, looks reasonable. I guess "some massive number" should probably be
> INT_MAX if we don't have a better way to do sanity checking right now.
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
*Roarke **Gaskill  *|Senior Software Engineer
*e:* roarke.gaskill at weather.com
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/e2655caa/attachment.html>

From even.rouault at spatialys.com  Tue Nov  7 15:58:10 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 08 Nov 2017 00:58:10 +0100
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CADyWFeU3U34_whypM-PC+qt_HdvSxpx_UoPiUD0r2mH4mawrFQ@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <5054366.t4ZaB3EV3M@even-i700>
 <CADyWFeU3U34_whypM-PC+qt_HdvSxpx_UoPiUD0r2mH4mawrFQ@mail.gmail.com>
Message-ID: <12484028.2fhZeA0js1@even-i700>

On mardi 7 novembre 2017 17:45:57 CET Roarke Gaskill wrote:
> It seems inappropriate (even as a quick hack) to put the size check in the
> grib parser. 

If we default to knMaxAllloc = INT_MAX, given that *ndpts is g2int, then the check will 
be a no-op. Actually the compiler and/or static analyzers will probably complain about 
that... So INT_MAX - 1 is probably a better choice :-)


> With the check there, you are not able to run simple utilities
> like gdalinfo on large files. What if I wanted to use gdalinfo to find out
> if the file is too big to process?

Unfortunately given how the GRIB degrib and underlying libaries used are done, you 
cannot get metadata without processing the whole file.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/5f93427e/attachment-0001.html>

From roarke.gaskill at weather.com  Tue Nov  7 16:02:07 2017
From: roarke.gaskill at weather.com (Roarke Gaskill)
Date: Tue, 7 Nov 2017 18:02:07 -0600
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <12484028.2fhZeA0js1@even-i700>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <5054366.t4ZaB3EV3M@even-i700>
 <CADyWFeU3U34_whypM-PC+qt_HdvSxpx_UoPiUD0r2mH4mawrFQ@mail.gmail.com>
 <12484028.2fhZeA0js1@even-i700>
Message-ID: <CADyWFeXciwqpOuuWM-4Em7mb88KmW8fPWxz4BNQ-7iDMKRpDag@mail.gmail.com>

> Unfortunately given how the GRIB degrib and underlying libaries used are
done, you cannot get metadata without processing the whole file.

Oh, so the OOM would happen even when calling gdalinfo? I was assuming it
was later processing that was getting the OOM.

On Tue, Nov 7, 2017 at 5:58 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 7 novembre 2017 17:45:57 CET Roarke Gaskill wrote:
>
> > It seems inappropriate (even as a quick hack) to put the size check in
> the
>
> > grib parser.
>
>
>
> If we default to knMaxAllloc = INT_MAX, given that *ndpts is g2int, then
> the check will be a no-op. Actually the compiler and/or static analyzers
> will probably complain about that... So INT_MAX - 1 is probably a better
> choice :-)
>
>
>
>
>
> > With the check there, you are not able to run simple utilities
>
> > like gdalinfo on large files. What if I wanted to use gdalinfo to find
> out
>
> > if the file is too big to process?
>
>
>
> Unfortunately given how the GRIB degrib and underlying libaries used are
> done, you cannot get metadata without processing the whole file.
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
*Roarke **Gaskill  *|Senior Software Engineer
*e:* roarke.gaskill at weather.com
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps> <http://weather.com/apps>
<http://weather.com/apps>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/e12d4804/attachment.html>

From schwehr at gmail.com  Tue Nov  7 20:03:25 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 7 Nov 2017 20:03:25 -0800
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CADyWFeXciwqpOuuWM-4Em7mb88KmW8fPWxz4BNQ-7iDMKRpDag@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <5054366.t4ZaB3EV3M@even-i700>
 <CADyWFeU3U34_whypM-PC+qt_HdvSxpx_UoPiUD0r2mH4mawrFQ@mail.gmail.com>
 <12484028.2fhZeA0js1@even-i700>
 <CADyWFeXciwqpOuuWM-4Em7mb88KmW8fPWxz4BNQ-7iDMKRpDag@mail.gmail.com>
Message-ID: <CACmBxyvksJkPfqh+==qcgTSJx-pUgdPUx+mk8ROU0DZcqVpbVA@mail.gmail.com>

I'm pretty sick today, so I'll hold off making the change until tomorrow
(unless anyone wants to beat me to it)

-kurt

On Tue, Nov 7, 2017 at 4:02 PM, Roarke Gaskill <roarke.gaskill at weather.com>
wrote:

> > Unfortunately given how the GRIB degrib and underlying libaries used
> are done, you cannot get metadata without processing the whole file.
>
> Oh, so the OOM would happen even when calling gdalinfo? I was assuming it
> was later processing that was getting the OOM.
>
> On Tue, Nov 7, 2017 at 5:58 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> On mardi 7 novembre 2017 17:45:57 CET Roarke Gaskill wrote:
>>
>> > It seems inappropriate (even as a quick hack) to put the size check in
>> the
>>
>> > grib parser.
>>
>>
>>
>> If we default to knMaxAllloc = INT_MAX, given that *ndpts is g2int, then
>> the check will be a no-op. Actually the compiler and/or static analyzers
>> will probably complain about that... So INT_MAX - 1 is probably a better
>> choice :-)
>>
>>
>>
>>
>>
>> > With the check there, you are not able to run simple utilities
>>
>> > like gdalinfo on large files. What if I wanted to use gdalinfo to find
>> out
>>
>> > if the file is too big to process?
>>
>>
>>
>> Unfortunately given how the GRIB degrib and underlying libaries used are
>> done, you cannot get metadata without processing the whole file.
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>
>
>
> --
> *Roarke **Gaskill  *|Senior Software Engineer
> *e:* roarke.gaskill at weather.com
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps> <http://weather.com/apps>
> <http://weather.com/apps>
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171107/2fcbbed9/attachment.html>

From frank.broniewski at gmail.com  Tue Nov  7 23:54:00 2017
From: frank.broniewski at gmail.com (Frank Broniewski)
Date: Wed, 8 Nov 2017 08:54:00 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
Message-ID: <5a02b81b.e184500a.8eb09.1c35@mx.google.com>

Hi Nikos,

I am using a similar approach to yours to extract data from OSM files to a GIS format. I chose Spatiallite as a format since it is superior to the Shapefile format in all areas.
FYI here’s what I do:
osmconvert -b="5.5,49,8,50.5" -o=saarland.osm.pbf "europe-latest.osm.pbf"
ogr2ogr --config OSM_CONFIG_FILE /home/frank/gdal/osmconf.ini -f SQLite -dsco SPATIALITE=YES -progress -gt 65536 -t_srs "EPSG:31466" /tmp/saarland.sqlite /tmp/saarland.osm.pbf

Please note the “–config” switch for a custom osmconf.ini. With that you can copy the config to a custom location and have several configs for many use cases.

HTH
Frank

Dipl. Geogr. Frank Broniewski
Waldhölzbacher Str. 51
66679 Losheim am See
06872 5090684
www.frankbroniewski.com

Von: Nikos Alexandris
Gesendet: Dienstag, 7. November 2017 16:15
An: gdal-dev at lists.osgeo.org
Betreff: [gdal-dev] Extracting keys & values from OSM Planet

Dear OSM experts,

a reproducible workflow that extracts specific tags from OSM's Planet
data set, includes:

1. downloading OSM Planet in form of a pbf file

2. convert pbf to o5m using `osmconvert`

3  extract areas of interest in separate `aoi_*.o5m` files, based on boundaries in form of .poly
files, using `osmconvert`

4. filtering for specific tags (i.e. highways), parallel tasks in 80 cores

```bash
# custom function for 'highway' tags
function osmfilterhighway { osmfilter $1 --drop-version --keep="highway=track =footway =bridleway =path" > $(basename $1 .o5m)_highway.osm; }
export -f osmfilterhighway

# filter
find . -type f -name \*aoi*.o5m |parallel -j80 osmfilterhighway {}
```

1. Is it any better using GDAL's `osmconf.ini` "method" [0],
over `osmconvert` and `osmfilter`, in terms of reliability/speed etc.?

2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?

3. What is the way to split "other_tags" in multiple new fields *when*
knowing exactly which tags are contained and should be obtained?

Thank you for any help,

Nikos


[0] https://svn.osgeo.org/gdal/trunk/gdal/data/osmconf.ini

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/3021f4b5/attachment-0001.html>

From even.rouault at spatialys.com  Wed Nov  8 02:35:23 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 08 Nov 2017 11:35:23 +0100
Subject: [gdal-dev] _gdal.FillNodata not Python function
In-Reply-To: <5174b2ed-7f7b-6530-5ae5-9c7d5bf3078b@kinaxia.fr>
References: <5f4ea766-5864-e769-e4e0-62ac9198f48e@kinaxia.fr>
 <5174b2ed-7f7b-6530-5ae5-9c7d5bf3078b@kinaxia.fr>
Message-ID: <2842474.m8oGd7NWQ4@even-i700>

Gabriel,

> > 
> > I'm working with Python 3.6 32bits, GDAL package
> > (GDAL‑2.2.2‑cp36‑cp36m‑win32.whl) i've installed from here :
> > https://www.lfd.uci.edu/~gohlke/pythonlibs/

I don't have experience regarding those binaries.

> > 
> > I also installed the gdal-202-1800-core.msi from here :
> > http://www.gisinternals.com/query.html?content=filelist&file=release-1800-
> > gdal-2-2-1-mapserver-7-0-6.zip
> > 
> > Here is the error I get when I try the fillnodata python utility :
> > gdal_fillnodata -md 2 myImage.tif myImage_correction.tif
> > Traceback (most recent call last):
> >   File "C:\Python36\Scripts\gdal_fillnodata.py", line 197, in <module>
> >     callback = prog_func )
> >   File "C:\Python36\lib\site-packages\osgeo\gdal.py", line 2742, in
> > FillNodata
> >     return _gdal.FillNodata(*args, **kwargs)
> > RuntimeError: Object given is not a Python function
> > 
> > Do you have any idea how to fix it ? Maybe wrong installation ?...
> > Thanks !

For what is worth, I've downloaded and installed:
http://download.gisinternals.com/sdk/downloads/release-1800-gdal-2-2-1-mapserver-7-0-6.zip
http://download.gisinternals.com/sdk/downloads/release-1800-gdal-2-2-1-mapserver-7-0-6/GDAL-2.2.1.win32-py3.4.msi
https://www.python.org/ftp/python/3.4.3/python-3.4.3.msi

and a common line similar to yours work fine.

So I suspect the issue is with the Python stuff from GDAL‑2.2.2‑cp36‑cp36m‑win32.whl , and using it
with the native lib provided by gisinternals will not help. But as shown above, if you use
the Python package provided by gisinternals, that should work.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/ccab025b/attachment.html>

From nik at nikosalexandris.net  Wed Nov  8 02:38:18 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Wed, 8 Nov 2017 11:38:18 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <5a02b81b.e184500a.8eb09.1c35@mx.google.com>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <5a02b81b.e184500a.8eb09.1c35@mx.google.com>
Message-ID: <20171108103817.kvvky57qlv7j35dd@mail.nikosalexandris.net>

Frank Broniewski:

>Hi Nikos,
>
>I am using a similar approach to yours to extract data from OSM files
>to a GIS format. I chose Spatiallite as a format since it is superior
>to the Shapefile format in all areas.  FYI here’s what I do:

>osmconvert -b="5.5,49,8,50.5" -o=saarland.osm.pbf "europe-latest.osm.pbf"

>ogr2ogr --config OSM_CONFIG_FILE /home/frank/gdal/osmconf.ini -f SQLite -dsco SPATIALITE=YES -progress -gt 65536 -t_srs "EPSG:31466" >/tmp/saarland.sqlite /tmp/saarland.osm.pbf

>Please note the “–config” switch for a custom osmconf.ini. With that
>you can copy the config to a custom location and have several configs
>for many use cases.

Thank you Even and Frank!

I will likely adopt the `osmconf.ini` method.

@Frank, I would go a step further if time permits. A function or script that
takes something like `layer=lines` and
`keys="track,footway,bridleway,path"` as input parameters and outputs the
custom configuration file.

From reading the driver's manual [0], there is a hint about the spatial,
filtering resulting in lines or polygons missing vertices. Is this a/the
reason, to stick to `osmconvert` for extracting areas of interest?

Thank you for your (invaluable) time, Nikos

[0] http://www.gdal.org/drv_osm.html
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/18fcf3db/attachment.sig>

From ari.jolma at gmail.com  Wed Nov  8 03:48:49 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 8 Nov 2017 13:48:49 +0200
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
Message-ID: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>

I've got to the point in the new WCS driver development, where I'm 
trying to issue GetCoverage request to a GeoServer, which is serving 
data in EPSG that has axis order swapped.

This is related to the earlier discussion

https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046366.html

The data serving is at

https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393

The boundedBy tells that the axisLabels are "Y X" and the lower corner 
is "6543350.381089335 3061592.6391462097" and upper corner is 
"7307056.899896299 3432141.361396798". This makes sense, in that EPSG X 
(easting) runs up from 3000000 and Y (northing) runs up from 6500000.

What I don't understand is why I need to make the GetCoverage request 
with subset=Y(3061592,3061632) and subset=X(7307016,7307056). If I 
define them as I would expect

https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393&FORMAT=image%2Ftiff&SUBSET=X%283061592.63914621,3061632.65520693%29&SUBSET=Y%287307016.88383558,7307056.8998963%29

I get "Empty intersection after subsetting".

A MapServer that serves data with EPSG that has axis order swapped is at

http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=DescribeCoverage&version=2.0.1&coverageid=BGS_EMODNET_CentralMed-MCol

It works using the above logic. However, it does not have GridFunction, 
which GeoServer has (it is "+2 +1", i.e., the data is east first, then 
north).

and Rasdaman server at

http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=BlueMarbleCov

Works using the above logic. However, it *has* GridFunction, which is 
the same as GeoServer has. However, it has the order of offsetVectors 
swapped - which I think is correct (as is also written here 
https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046421.html)

So, I can make Rasdaman work for CRS with swapped order by default (also 
the returned geotiff is ok), and for MapServer and GeoServer I need to 
have at least two hack options (NoOffsetSwap and NoGridEnvelopeSwap, 
maybe there could be only one). I have not yet checked if the rasters 
returned from those two are ok.

Ari





From ari.jolma at gmail.com  Wed Nov  8 04:50:54 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 8 Nov 2017 14:50:54 +0200
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
Message-ID: <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>

Ari Jolma kirjoitti 08.11.2017 klo 13:48:
>  for MapServer and GeoServer I need to have at least two hack options 
> (NoOffsetSwap and NoGridEnvelopeSwap, maybe there could be only one). 
> I have not yet checked if the rasters returned from those two are ok.

The rasters that those servers return are ok. I just need the one 
additional hack option for GeoServer to swap the axis names for the 
GetCoverage request.

I also don't need to use the GridFunction information.

BTW, it seems that GDAL driver options are usually all upcase. Is that 
just a convention, and could it perhaps be violated? The reason for 
options like "PreferredFormat=xxx" for the WCS driver (instead of 
"PREFERREDFORMAT=xxx") is that 'PreferredFormat' is the name of the 
element in the WCS_GDAL XML. My approach in the new WCS driver is to use 
options to set values in the WCS_GDAL XML since that XML file is in the 
cache and meant to be maintained by the driver.

Ari


From even.rouault at spatialys.com  Wed Nov  8 05:42:51 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 08 Nov 2017 14:42:51 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
Message-ID: <2058494.1KC9oNcdcJ@even-i700>

On mercredi 8 novembre 2017 14:50:54 CET Ari Jolma wrote:
> Ari Jolma kirjoitti 08.11.2017 klo 13:48:
> >  for MapServer and GeoServer I need to have at least two hack options
> > (NoOffsetSwap and NoGridEnvelopeSwap, maybe there could be only one).
> > I have not yet checked if the rasters returned from those two are ok.
> 
> The rasters that those servers return are ok. I just need the one
> additional hack option for GeoServer to swap the axis names for the
> GetCoverage request.
> 
> I also don't need to use the GridFunction information.

One thing that is confusing, and rings some bells to me as I saw that with GMLJP2 (the
GDAL_JP2K_ALT_OFFSETVECTOR_ORDER config option in gdaljp2metadata.cpp) is the order of the offetVector element

>From your example, we have:

MapServer:
<gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/4326">0 0.004167</gml:offsetVector>
<gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/4326">-0.004167 0</gml:offsetVector>

GeoServer:
<gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">0.0 20.00803035910304</gml:offsetVector>
<gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">-20.00803035910304 0.0</gml:offsetVector>

Rasdaman
<offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">-0.02 0</offsetVector>
<offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">0 0.02</offsetVector> 

So in all 3 cases, the order of the value *inside* a offetVector element is lat/northing long/easting as those CRS as lat-long / northing-easting. OK

BUT Rasdaman does an extra swap of the offsetVector elements themselves.

What is not clear (among many things) is when GridFunction applies. If it applies before linking the raster/grid space to the georeferenced space,
that is the first offsetVector applies to the fastest varying dimension of the final grid,
then I'd say MapServer & GeoServer do the right thing (GeoServer probably closer to correctenss, due to te
presence of the GridFunction). Otherwise, if its applied at the very end of the process, Rasdaman is probably correct.

Practically I'd say if you have
<offsetVector srsName="...">A B</offsetVector>
<offsetVector srsName="...">C D</offsetVector> 
with SRS with lat-long or northing-easting order, with high confidence regarding how "correct" an implementation is:
 * if A != 0 and D > 0 and C=B=0, D the x resolution and A is the y resolution .
 * if A=D=0 and C != 0 and B > 0, then B is the x resolution and C the y resolution.
In other situations, good luck...

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/9a786fbe/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov  8 06:42:09 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 8 Nov 2017 07:42:09 -0700 (MST)
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <2058494.1KC9oNcdcJ@even-i700>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <2058494.1KC9oNcdcJ@even-i700>
Message-ID: <1510152129293-0.post@n6.nabble.com>

Even Rouault-2 wrote
> On mercredi 8 novembre 2017 14:50:54 CET Ari Jolma wrote:
>> Ari Jolma kirjoitti 08.11.2017 klo 13:48:
>> >  for MapServer and GeoServer I need to have at least two hack options
>> > (NoOffsetSwap and NoGridEnvelopeSwap, maybe there could be only one).
>> > I have not yet checked if the rasters returned from those two are ok.

Hi,

I fear that we are going in circles, see this not-so-old thread
http://osgeo-org.1560.x6.nabble.com/gdal-dev-GML-lat-lon-coverages-and-interoperability-td5315441.html

I wonder if we should open a new wiki page for the discussion about WCS 2.0
axis order and if we should define swapped axis by using
GridFunction-axisOrder="+2 +1">Linear which means "take the second number
and increase the first offset vector with it, then take the second number
and increase the first axes", or by writing the offset vectors as "first
number is moving me from top to down, the second number from left to right".

I got an impression that in that thread seven months ago the offset vector
solution without using GridFunction was more or less recommended by Dr.
Baumann at least for easy coverages like aerial images. I would like that
too because then client software would not need to know what are
GridFunctions, just to read the offset vectors right.

I also wonder that if client is supposed to handle axisOrder="+2 +1">linear,
should it then be able to handle also everything else that is defined on
page 223 of 437 of the GML 3.2.1 standard in chapter "19.3.14 sequenceRule,
SequenceRuleType, SequenceRuleEnumeration"


-Jukka Rahkonen-







--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From piero.campa at gmail.com  Wed Nov  8 06:50:48 2017
From: piero.campa at gmail.com (Piero Campalani)
Date: Wed, 8 Nov 2017 15:50:48 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
Message-ID: <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>

Hi there,

The gml:GridFunction is *not* an auxiliary definition of the grid geometry,
but rather a guidance on how to link the grid to the *range set* (i.e. the
data), so it shall not be compared with the "domain" information (offset
vectors and so on).

As Even properly underlines, the order of the coordinates in the offset
vectors shall refer to the order of the CRS axis definition, that is
(concerning EPSG:4326) the first coordinate/number is the latitude, the
second is the longitude (with proper -/+ sign whether the COVERAGE axis
attached to the vector is concordant/discordant with the CRS axis
direction).

The order of the offset-vectors themselves refers to the order of the GRID
axes (the pic in [1] might be helpful decoding the XML of it all!).
This order is what can be referred to in the GridFunction: +1 --> first
GRID axis, +2 --> second GRID axis, etc.

For instance, what rasdaman seems to tell on the coverage is the the first
9000-points COVERAGE axis is the vertical axis, increasing South-ward,
while the second 18000-points axis follows the East direction.
Via GridFunction, it then says then that the data you will get in a WCS
GetCoverage response will span the 2nd (horizontal) axis first.

hth!
-Piero

[1]
http://rasdaman.org/wiki/PetascopeUserGuide#GridaxislabelsandCRSaxislabels
[2]
http://rasdaman.org/wiki/PetascopeSubsets#Geometricinterpretationofacoverage

On 8 November 2017 at 14:42, <gdal-dev-request at lists.osgeo.org> wrote:

> Message: 3
> Date: Wed, 8 Nov 2017 13:48:49 +0200
> From: Ari Jolma <ari.jolma at gmail.com>
> To: "'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org)"
>         <gdal-dev at lists.osgeo.org>
> Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
> Message-ID: <fff6a965-8ac8-ebbc-c244-f81451fc3117 at gmail.com>
> Content-Type: text/plain; charset=utf-8; format=flowed
>
> I've got to the point in the new WCS driver development, where I'm
> trying to issue GetCoverage request to a GeoServer, which is serving
> data in EPSG that has axis order swapped.
>
> This is related to the earlier discussion
>
> https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046366.html
>
> The data serving is at
>
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&
> REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=
> smartsea__eusm2016-EPSG2393
>
> The boundedBy tells that the axisLabels are "Y X" and the lower corner
> is "6543350.381089335 3061592.6391462097" and upper corner is
> "7307056.899896299 3432141.361396798". This makes sense, in that EPSG X
> (easting) runs up from 3000000 and Y (northing) runs up from 6500000.
>
> What I don't understand is why I need to make the GetCoverage request
> with subset=Y(3061592,3061632) and subset=X(7307016,7307056). If I
> define them as I would expect
>
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&
> REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=smartsea__
> eusm2016-EPSG2393&FORMAT=image%2Ftiff&SUBSET=X%283061592.63914621,3061632.
> 65520693%29&SUBSET=Y%287307016.88383558,7307056.8998963%29
>
> I get "Empty intersection after subsetting".
>
> A MapServer that serves data with EPSG that has axis order swapped is at
>
> http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?
> SERVICE=WCS&REQUEST=DescribeCoverage&version=2.0.1&coverageid=BGS_EMODNET_
> CentralMed-MCol
>
> It works using the above logic. However, it does not have GridFunction,
> which GeoServer has (it is "+2 +1", i.e., the data is east first, then
> north).
>
> and Rasdaman server at
> ​​
>
>
> http://ows.rasdaman.org/rasdaa32c78aman/ows?SERVICE=WCS&
> REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=BlueMarbleCov
> <http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=BlueMarbleCov>
>
> Works using the above logic. However, it *has* GridFunction, which is
> the same as GeoServer has. However, it has the order of offsetVectors
> swapped - which I think is correct (as is also written here
> https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046421.html)
>
> So, I can make Rasdaman work for CRS with swapped order by default (also
> the returned geotiff is ok), and for MapServer and GeoServer I need to
> have at least two hack options (NoOffsetSwap and NoGridEnvelopeSwap,
> maybe there could be only one). I have not yet checked if the rasters
> returned from those two are ok.
>
> Ari
>
>
>
>
>
>
> ------------------------------
>
> Message: 4
> Date: Wed, 8 Nov 2017 14:50:54 +0200
> From: Ari Jolma <ari.jolma at gmail.com>
> To: "'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org)"
>         <gdal-dev at lists.osgeo.org>
> Subject: Re: [gdal-dev] WCS GetCoverage with AxisOrder swap
> Message-ID: <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8 at gmail.com>
> Content-Type: text/plain; charset=utf-8; format=flowed
>
> Ari Jolma kirjoitti 08.11.2017 klo 13:48:
> >  for MapServer and GeoServer I need to have at least two hack options
> > (NoOffsetSwap and NoGridEnvelopeSwap, maybe there could be only one).
> > I have not yet checked if the rasters returned from those two are ok.
>
> The rasters that those servers return are ok. I just need the one
> additional hack option for GeoServer to swap the axis names for the
> GetCoverage request.
>
> I also don't need to use the GridFunction information.
>
> BTW, it seems that GDAL driver options are usually all upcase. Is that
> just a convention, and could it perhaps be violated? The reason for
> options like "PreferredFormat=xxx" for the WCS driver (instead of
> "PREFERREDFORMAT=xxx") is that 'PreferredFormat' is the name of the
> element in the WCS_GDAL XML. My approach in the new WCS driver is to use
> options to set values in the WCS_GDAL XML since that XML file is in the
> cache and meant to be maintained by the driver.
>
> Ari
>
>
>
> ------------------------------
>
> Message: 5
> Date: Wed, 08 Nov 2017 14:42:51 +0100
> From: Even Rouault <even.rouault at spatialys.com>
> To: gdal-dev at lists.osgeo.org
> Subject: Re: [gdal-dev] WCS GetCoverage with AxisOrder swap
> Message-ID: <2058494.1KC9oNcdcJ at even-i700>
> Content-Type: text/plain; charset="iso-8859-1"
>
> On mercredi 8 novembre 2017 14:50:54 CET Ari Jolma wrote:
> > Ari Jolma kirjoitti 08.11.2017 klo 13:48:
> > >  for MapServer and GeoServer I need to have at least two hack options
> > > (NoOffsetSwap and NoGridEnvelopeSwap, maybe there could be only one).
> > > I have not yet checked if the rasters returned from those two are ok.
> >
> > The rasters that those servers return are ok. I just need the one
> > additional hack option for GeoServer to swap the axis names for the
> > GetCoverage request.
> >
> > I also don't need to use the GridFunction information.
>
> One thing that is confusing, and rings some bells to me as I saw that with
> GMLJP2 (the
> GDAL_JP2K_ALT_OFFSETVECTOR_ORDER config option in gdaljp2metadata.cpp) is
> the order of the offetVector element
>
> >From your example, we have:
>
> MapServer:
> <gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/4326">0
> 0.004167</gml:offsetVector>
> <gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/4326">-0.004167
> 0</gml:offsetVector>
>
> GeoServer:
> <gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">0.0
> 20.00803035910304</gml:offsetVector>
> <gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393
> ">-20.00803035910304 0.0</gml:offsetVector>
>
> Rasdaman
> <offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">-0.02
> 0</offsetVector>
> <offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">0
> 0.02</offsetVector>
>
> So in all 3 cases, the order of the value *inside* a offetVector element
> is lat/northing long/easting as those CRS as lat-long / northing-easting. OK
>
> BUT Rasdaman does an extra swap of the offsetVector elements themselves.
>
> What is not clear (among many things) is when GridFunction applies. If it
> applies before linking the raster/grid space to the georeferenced space,
> that is the first offsetVector applies to the fastest varying dimension of
> the final grid,
> then I'd say MapServer & GeoServer do the right thing (GeoServer probably
> closer to correctenss, due to te
> presence of the GridFunction). Otherwise, if its applied at the very end
> of the process, Rasdaman is probably correct.
>
> Practically I'd say if you have
> <offsetVector srsName="...">A B</offsetVector>
> <offsetVector srsName="...">C D</offsetVector>
> with SRS with lat-long or northing-easting order, with high confidence
> regarding how "correct" an implementation is:
>  * if A != 0 and D > 0 and C=B=0, D the x resolution and A is the y
> resolution .
>  * if A=D=0 and C != 0 and B > 0, then B is the x resolution and C the y
> resolution.
> In other situations, good luck...
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <http://lists.osgeo.org/pipermail/gdal-dev/
> attachments/20171108/9a786fbe/attachment.html>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> ------------------------------
>
> End of gdal-dev Digest, Vol 162, Issue 22
> *****************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/ba1c5b3d/attachment-0001.html>

From even.rouault at spatialys.com  Wed Nov  8 07:31:42 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 08 Nov 2017 16:31:42 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
References: <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
Message-ID: <19119758.vFUb0KjAUD@even-i700>

On mercredi 8 novembre 2017 15:50:48 CET Piero Campalani wrote:
> Hi there,
> 
> The gml:GridFunction is *not* an auxiliary definition of the grid geometry,
> but rather a guidance on how to link the grid to the *range set* (i.e. the
> data), so it shall not be compared with the "domain" information (offset
> vectors and so on).
> 
> As Even properly underlines, the order of the coordinates in the offset
> vectors shall refer to the order of the CRS axis definition, that is
> (concerning EPSG:4326) the first coordinate/number is the latitude, the
> second is the longitude (with proper -/+ sign whether the COVERAGE axis
> attached to the vector is concordant/discordant with the CRS axis
> direction).
> 
> The order of the offset-vectors themselves refers to the order of the GRID
> axes (the pic in [1] might be helpful decoding the XML of it all!).
> This order is what can be referred to in the GridFunction: +1 --> first
> GRID axis, +2 --> second GRID axis, etc.
> 
> For instance, what rasdaman seems to tell on the coverage is the the first
> 9000-points COVERAGE axis is the vertical axis, increasing South-ward,
> while the second 18000-points axis follows the East direction.
> Via GridFunction, it then says then that the data you will get in a WCS
> GetCoverage response will span the 2nd (horizontal) axis first.

OK thanks for the explanations. Makes some sense.... 
So it would seem that if you want to return a GeoTIFF in
traditional GIS order (ie faster varying dimension corresponds to longitude), AND you emit
offsetVector in the way Rasdaman does, it seems
that emitting a gml:GridFunction +2 +1 would be required.

But actually, looking closely at the drawing at
http://rasdaman.org/wiki/PetascopeUserGuide#GridaxislabelsandCRSaxislabels , I see
RectifiedGrid.axisLabels="t Long Lat", whereas RectifiedGrid.origin.Point at axisLabels="t Lat Long"
(note the inversion). The second offset vector expressed an increase in longitude (0 0 0.5), while the
third one a decrease in latitude (0 -0.5 0). Which is the GIS friendly order.

So, it would seem that there are 2 more or less equivalent way of achieving the same end result ?

And thus MapServer output at
http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=DescribeCoverage&version=2.0.1&coverageid=BGS_EMODNET_CentralMed-MCol
could probably be correct, but it would be better for RectifiedGrid.axisLabels to be changed to "long lat" to better
reflect what is done.
Rasdaman output at http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=BlueMarbleCov would be correct
And GeoServer output at https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393
would either need to remove the GridFunction (ala MapServer) or keep it and invert the order in which its offsetVector appear (ala Rasdaman)


And for WCS subsetting, when you write something like SUBSET=AXIS_NAME(min,max),
where AXIS_NAME should come from ? From the RectifiedGrid.axisLabels I guess ?
(to be opposed to CoverageDescription.boundedBy.Envelope at axisLabels)
Then in Ari's test with GeoServer
https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393, in theory "i" and "j" should be the axis requested ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/2968671c/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov  8 07:57:09 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 8 Nov 2017 08:57:09 -0700 (MST)
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <19119758.vFUb0KjAUD@even-i700>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <19119758.vFUb0KjAUD@even-i700>
Message-ID: <1510156629668-0.post@n6.nabble.com>

Even Rouault-2 wrote
> So, it would seem that there are 2 more or less equivalent way of
> achieving the same end result ?

My understanding is that these two are equivalent and define a grid in
EPSG:4326 with pixel size of 1 degree (if it is an image). First way is to
turn the offset vectors, this is also used in an example in the OGC GML in
JPEG 2000 (GMLJP2) standard.

offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">0
1</offsetVector
offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">-1
0</offsetVector

The second way is to turn the axes order.

&lt;GridFunction>
  <sequenceRule axisOrder="+2 +1">Linear</sequenceRule>
</GridFunction>
offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">-1
0</offsetVector
offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">0
1</offsetVector

It is also possible to write the first variant as complete so it is not
necessary to know what are the default values of sequenceRule

&lt;GridFunction>
  <sequenceRule axisOrder="+1 +2">Linear</sequenceRule>
</GridFunction>
offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">0
1</offsetVector
offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">-1
0</offsetVector


-Jukka Rahkonen-




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From schwehr at gmail.com  Wed Nov  8 10:02:48 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 8 Nov 2017 10:02:48 -0800
Subject: [gdal-dev] Grib2 Question
In-Reply-To: <CACmBxyvksJkPfqh+==qcgTSJx-pUgdPUx+mk8ROU0DZcqVpbVA@mail.gmail.com>
References: <CADyWFeWZrM31joVpr5mtuDC4EjXLfSaGD6SDCedmPmxcjTewtQ@mail.gmail.com>
 <5054366.t4ZaB3EV3M@even-i700>
 <CADyWFeU3U34_whypM-PC+qt_HdvSxpx_UoPiUD0r2mH4mawrFQ@mail.gmail.com>
 <12484028.2fhZeA0js1@even-i700>
 <CADyWFeXciwqpOuuWM-4Em7mb88KmW8fPWxz4BNQ-7iDMKRpDag@mail.gmail.com>
 <CACmBxyvksJkPfqh+==qcgTSJx-pUgdPUx+mk8ROU0DZcqVpbVA@mail.gmail.com>
Message-ID: <CACmBxys+9_r0mRncwvNqwb11zWCAzYfptrY-w_7YCY2nwxk4Zg@mail.gmail.com>

https://trac.osgeo.org/gdal/changeset/40664

On Tue, Nov 7, 2017 at 8:03 PM, Kurt Schwehr <schwehr at gmail.com> wrote:

> I'm pretty sick today, so I'll hold off making the change until tomorrow
> (unless anyone wants to beat me to it)
>
> -kurt
>
> On Tue, Nov 7, 2017 at 4:02 PM, Roarke Gaskill <roarke.gaskill at weather.com
> > wrote:
>
>> > Unfortunately given how the GRIB degrib and underlying libaries used
>> are done, you cannot get metadata without processing the whole file.
>>
>> Oh, so the OOM would happen even when calling gdalinfo? I was assuming it
>> was later processing that was getting the OOM.
>>
>> On Tue, Nov 7, 2017 at 5:58 PM, Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> On mardi 7 novembre 2017 17:45:57 CET Roarke Gaskill wrote:
>>>
>>> > It seems inappropriate (even as a quick hack) to put the size check in
>>> the
>>>
>>> > grib parser.
>>>
>>>
>>>
>>> If we default to knMaxAllloc = INT_MAX, given that *ndpts is g2int, then
>>> the check will be a no-op. Actually the compiler and/or static analyzers
>>> will probably complain about that... So INT_MAX - 1 is probably a better
>>> choice :-)
>>>
>>>
>>>
>>>
>>>
>>> > With the check there, you are not able to run simple utilities
>>>
>>> > like gdalinfo on large files. What if I wanted to use gdalinfo to find
>>> out
>>>
>>> > if the file is too big to process?
>>>
>>>
>>>
>>> Unfortunately given how the GRIB degrib and underlying libaries used are
>>> done, you cannot get metadata without processing the whole file.
>>>
>>>
>>>
>>> --
>>>
>>> Spatialys - Geospatial professional services
>>>
>>> http://www.spatialys.com
>>>
>>
>>
>>
>> --
>> *Roarke **Gaskill  *|Senior Software Engineer
>> *e:* roarke.gaskill at weather.com
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps> <http://weather.com/apps>
>> <http://weather.com/apps>
>>
>
>
>
> --
> --
> http://schwehr.org
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/b4d42bdc/attachment-0001.html>

From ari.jolma at gmail.com  Wed Nov  8 13:01:34 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 8 Nov 2017 23:01:34 +0200
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <19119758.vFUb0KjAUD@even-i700>
References: <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <19119758.vFUb0KjAUD@even-i700>
Message-ID: <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>

Even Rouault kirjoitti 08.11.2017 klo 17:31:

> On mercredi 8 novembre 2017 15:50:48 CET Piero Campalani wrote:
>
>
> > This order is what can be referred to in the GridFunction: +1 --> first
>
> > GRID axis, +2 --> second GRID axis, etc.
>

Ok, this tells me that the axisOrder attribute in sequenceRule 
determines how to consider the GridEnvelope and the order of the 
offsetVectors in the Grid element.

>
>  And thus MapServer output at
>
> http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=DescribeCoverage&version=2.0.1&coverageid=BGS_EMODNET_CentralMed-MCol
>
> could probably be correct, but it would be better for 
> RectifiedGrid.axisLabels to be changed to "long lat" to better
>
> reflect what is done.
>

At least it fixes the driver for MapServer in this case (no hack options 
needed) since it does not define the axisOrder.

> And GeoServer output at 
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393
>
> would either need to remove the GridFunction (ala MapServer) or keep 
> it and invert the order in which its offsetVector appear (ala Rasdaman)
>

Invert the offsetVector order *and* invert the axis in GridEnvelope 
(otherwise the size is wrong).

> And for WCS subsetting, when you write something like 
> SUBSET=AXIS_NAME(min,max),
>
> where AXIS_NAME should come from ? From the RectifiedGrid.axisLabels I 
> guess ?
>
> (to be opposed to CoverageDescription.boundedBy.Envelope at axisLabels)
>
> Then in Ari's test with GeoServer
>
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393, 
> in theory "i" and "j" should be the axis requested ?
>

That does not work -- it's good that they are different since that shows 
it is not ok (invalid axis label error). Maybe the logic is related to 
the axis names? It's hard to tell since I don't find the logic in the 
GeoServer source code.

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171108/67bb96db/attachment.html>

From p.baumann at jacobs-university.de  Wed Nov  8 15:13:39 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Thu, 9 Nov 2017 00:13:39 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>
References: <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <19119758.vFUb0KjAUD@even-i700>
 <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>
Message-ID: <2cf256a1-3def-5925-2aca-fc889e1f0bbb@jacobs-university.de>


On 11/08/2017 10:01 PM, Ari Jolma wrote:
>
> Even Rouault kirjoitti 08.11.2017 klo 17:31:
>
>> On mercredi 8 novembre 2017 15:50:48 CET Piero Campalani wrote:
>>
>>
>> > This order is what can be referred to in the GridFunction: +1 --> first
>>
>> > GRID axis, +2 --> second GRID axis, etc.
>>
>
> Ok, this tells me that the axisOrder attribute in sequenceRule determines how
> to consider the GridEnvelope and the order of the offsetVectors in the Grid
> element.

the axisLabels attribute determines axis order, and this in turn refers to the
CRS definition behind the URL in srsName.
SequenceRule / GridFunction is just for the internal linearization (whose
description depends, ie: interprets axis order) - and BTW only applies to GML
(and JSON and RDF), not necessarily to binary encodings which usually determine
their own internal structure.

My team has analysed your report and says:

On 11/08/2017 02:56 PM, Bang Pham Huu wrote:
>
> I checked the result as I think it is like this
>
> + GeoServer is correct with http://www.opengis.net/def/crs/EPSG/0/2393 as this
> one is X, Y so the offset vector is correct.
>
> offsetVector1: X (positive), Y (negative)
>
> offsetVector2: Y (negative), X (positive)
>
> + Rasdaman is also correct with http://ows.rasdaman.org/def/crs/EPSG/0/4326
> (Lat, Long) so the offset vector is correct.
>
> offsetVector1: Y (negative), X (positive)
>
> offsetVector2: X (positive), Y (negative)
>
> and with a CRS with X, Y order like
> http://www.opengis.net/def/crs/EPSG/0/3857, Rasdaman returns offset vector
> with correct order, e.g from a 2D coverage imported with this CRS:
>
> <offsetVectorsrsName="http://localhost:8080/def/crs/EPSG/0/3857">23613.2868316
> 0</offsetVector>
> <offsetVectorsrsName="http://localhost:8080/def/crs/EPSG/0/3857">0
> -23613.2868316</offsetVector>
>
> + Mapserver is not correct for http://www.opengis.net/def/crs/EPSG/0/4326 (it
> should be as same as Rasdaman).
>
>


-Peter

>
>>
>>  And thus MapServer output at
>>
>> http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=DescribeCoverage&version=2.0.1&coverageid=BGS_EMODNET_CentralMed-MCol
>>
>> could probably be correct, but it would be better for
>> RectifiedGrid.axisLabels to be changed to "long lat" to better
>>
>> reflect what is done.
>>
>
> At least it fixes the driver for MapServer in this case (no hack options
> needed) since it does not define the axisOrder.
>
>> And GeoServer output at
>> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393
>>
>> would either need to remove the GridFunction (ala MapServer) or keep it and
>> invert the order in which its offsetVector appear (ala Rasdaman)
>>
>
> Invert the offsetVector order *and* invert the axis in GridEnvelope (otherwise
> the size is wrong).
>
>>  
>>
>>  
>>
>> And for WCS subsetting, when you write something like SUBSET=AXIS_NAME(min,max),
>>
>> where AXIS_NAME should come from ? From the RectifiedGrid.axisLabels I guess ?
>>
>> (to be opposed to CoverageDescription.boundedBy.Envelope at axisLabels)
>>
>> Then in Ari's test with GeoServer
>>
>> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393,
>> in theory "i" and "j" should be the axis requested ?
>>
>
> That does not work -- it's good that they are different since that shows it is
> not ok (invalid axis label error). Maybe the logic is related to the axis
> names? It's hard to tell since I don't find the logic in the GeoServer source
> code.
>
> Ari
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/7bef36d0/attachment-0001.html>

From even.rouault at spatialys.com  Wed Nov  8 23:41:33 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 09 Nov 2017 08:41:33 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <2cf256a1-3def-5925-2aca-fc889e1f0bbb@jacobs-university.de>
References: <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>
 <2cf256a1-3def-5925-2aca-fc889e1f0bbb@jacobs-university.de>
Message-ID: <2412504.K68ujnRmfP@even-i700>

Peter,

> the axisLabels attribute determines axis order, and this in turn refers to the
> CRS definition behind the URL in srsName.

Does the value of RectifiedGrid.axisLabels must be correlated with the one of the CRS,
or can it be a "random" value ?
For example, GeoServer has <gml:RectifiedGrid><gml:axisLabels>i j</gml:axisLabels></gml:RectifiedGrid>

> My team has analysed your report and says:

Thanks but I'm afraid I'm even more confused now.

> 
> On 11/08/2017 02:56 PM, Bang Pham Huu wrote:
> > I checked the result as I think it is like this
> > 
> > + GeoServer is correct with http://www.opengis.net/def/crs/EPSG/0/2393 as
> > this one is X, Y so the offset vector is correct.

In EPSG, http://www.opengis.net/def/axis/EPSG/0/48 = X = NORTH and 
http://www.opengis.net/def/axis/EPSG/0/47 = Y = EAST. So this CRS has the "GIS-unfriendly" order.

But if you consider
<gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/2393" axisLabels="Y X" uomLabels="m m" srsDimension="2">
<gml:lowerCorner>6543350.381089335 3061592.6391462097</gml:lowerCorner>
<gml:upperCorner>7307056.899896299 3432141.361396798</gml:upperCorner></gml:Envelope>

and assume from the above that Y=EAST=6543350.381089335 and X=NORTH=3061592.6391462097 (lower corner values),
this doesn't transform to a location in Finland.

Whereas X=NORTH=6543350.381089335 and Y=EAST=3061592.6391462097 does transform to Finland

So I think the axisLabels here is wrong, it should be axisLabels="X Y"


> > 
> > offsetVector1: X (positive), Y (negative)
> > 
> > offsetVector2: Y (negative), X (positive)

Can't correlate the above reasoning about the sign of values with the actual output of
https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393
which is
<gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">0.0 20.00803035910304</gml:offsetVector>
<gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">-20.00803035910304 0.0</gml:offsetVector>

Given what you said about <gml:GridFunction> not applying to GeoTIFF output, then
this would be correct since the above would express that the first axis (along the width of the image) of the GeoTIFF
express positive easting space and the second axis (along height) express negative northing spacing (image north-up oriented)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/9e0729df/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov  9 01:36:49 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 9 Nov 2017 02:36:49 -0700 (MST)
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <2412504.K68ujnRmfP@even-i700>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <19119758.vFUb0KjAUD@even-i700>
 <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>
 <2cf256a1-3def-5925-2aca-fc889e1f0bbb@jacobs-university.de>
 <2412504.K68ujnRmfP@even-i700>
Message-ID: <1510220209458-0.post@n6.nabble.com>

Even Rouault-2 wrote
> Peter,
> 
>> the axisLabels attribute determines axis order, and this in turn refers
>> to the
>> CRS definition behind the URL in srsName.
> 
> Does the value of RectifiedGrid.axisLabels must be correlated with the one
> of the CRS,
> or can it be a "random" value ?
> For example, GeoServer has 
> <gml:RectifiedGrid>
> <gml:axisLabels>
> i j
> </gml:axisLabels>
> </gml:RectifiedGrid>
>> My team has analysed your report and says:
> 
> Thanks but I'm afraid I'm even more confused now.
> 
>> 
>> On 11/08/2017 02:56 PM, Bang Pham Huu wrote:
>> > I checked the result as I think it is like this
>> > 
>> > + GeoServer is correct with http://www.opengis.net/def/crs/EPSG/0/2393
>> as
>> > this one is X, Y so the offset vector is correct.
> 
> In EPSG, http://www.opengis.net/def/axis/EPSG/0/48 = X = NORTH and 
> http://www.opengis.net/def/axis/EPSG/0/47 = Y = EAST. So this CRS has the
> "GIS-unfriendly" order.
> 
> But if you consider
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/2393"
> axisLabels="Y X" uomLabels="m m" srsDimension="2">
> <gml:lowerCorner>
> 6543350.381089335 3061592.6391462097
> </gml:lowerCorner>
> <gml:upperCorner>
> 7307056.899896299 3432141.361396798
> </gml:upperCorner>
> </gml:Envelope>
> and assume from the above that Y=EAST=6543350.381089335 and
> X=NORTH=3061592.6391462097 (lower corner values),
> this doesn't transform to a location in Finland.
> 
> Whereas X=NORTH=6543350.381089335 and Y=EAST=3061592.6391462097 does
> transform to Finland
> 
> So I think the axisLabels here is wrong, it should be axisLabels="X Y"
> 
> 
>> > 
>> > offsetVector1: X (positive), Y (negative)
>> > 
>> > offsetVector2: Y (negative), X (positive)
> 
> Can't correlate the above reasoning about the sign of values with the
> actual output of
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393
> which is
> <gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">
> 0.0 20.00803035910304
> </gml:offsetVector>
> <gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">
> -20.00803035910304 0.0
> </gml:offsetVector>
> Given what you said about 
> <gml:GridFunction>
>  not applying to GeoTIFF output, then
> this would be correct since the above would express that the first axis
> (along the width of the image) of the GeoTIFF
> express positive easting space and the second axis (along height) express
> negative northing spacing (image north-up oriented)
> 
> Even
> 
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev

Hi folks,

I think that it is extremely good to discuss about axisOrder, GridFunctions,
offsetVectors, axisLabels etc. because for sure we all want to build
interoperability between different WCS 2.0 implementations.
However, I think that this mailing list thread is rather making more
confusion than clarifying things. First, it is very hard to follow who wrote
what and when, and if that was an answer, then what was the question. And if
we make errors with our conclusions, or if we forget to think about all
aspects in out analyzes, it is very hard to clarify that on the mailing
list. We should have something like Google document or a wiki page as a
workplace.

About incomplete analyzes, I feel that the Rasdaman team perhaps forgot to
check the GridFunction when they analyzed the offsetVectors.
In the Rasdaman case there is an axisOrder rule
axisOrder="+2 +1"
and offset vectors are
offsetVector srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">-0.02 0
srsName="http://ows.rasdaman.org/def/crs/EPSG/0/4326">0 0.02

In the Mapserver case there is no axisOrder rule which meant that it is the
default
axisOrder="+1 +2"
and offset vectors are
offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/4326">0 0.004167
offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/4326">-0.004167
0

Question:
Doesn’t these two expressions lead to same result? Yes or no?

-Jukka Rahkonen-




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From andrea.aime at geo-solutions.it  Thu Nov  9 01:44:14 2017
From: andrea.aime at geo-solutions.it (Andrea Aime)
Date: Thu, 9 Nov 2017 10:44:14 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <1510220209458-0.post@n6.nabble.com>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <19119758.vFUb0KjAUD@even-i700>
 <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>
 <2cf256a1-3def-5925-2aca-fc889e1f0bbb@jacobs-university.de>
 <2412504.K68ujnRmfP@even-i700> <1510220209458-0.post@n6.nabble.com>
Message-ID: <CA+nxMTtSfVX29D1txyNOBLO3_sgCx4hqK09dNTPTQ-CesLkS1Q@mail.gmail.com>

On Thu, Nov 9, 2017 at 10:36 AM, jratike80 <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi folks,
>
> I think that it is extremely good to discuss about axisOrder,
> GridFunctions,
> offsetVectors, axisLabels etc. because for sure we all want to build
> interoperability between different WCS 2.0 implementations.
> However, I think that this mailing list thread is rather making more
> confusion than clarifying things. First, it is very hard to follow who
> wrote
> what and when, and if that was an answer, then what was the question. And
> if
> we make errors with our conclusions, or if we forget to think about all
> aspects in out analyzes, it is very hard to clarify that on the mailing
> list. We should have something like Google document or a wiki page as a
> workplace.
>

Fully agreed, a small tutorial with a few user cases (geographic, projected
east/north,
projected north/east) and (all?) valid ways to describe those situations
would be
very useful

Cheers
Andrea

==
GeoServer Professional Services from the experts! Visit http://goo.gl/it488V
for more information.
==

Ing. Andrea Aime
@geowolf
Technical Lead

GeoSolutions S.A.S.
Via di Montramito 3/A
55054  Massarosa (LU)
phone: +39 0584 962313
fax: +39 0584 1660272
mob: +39  339 8844549

http://www.geo-solutions.it
http://twitter.com/geosolutions_it

AVVERTENZE AI SENSI DEL D.Lgs. 196/2003

Le informazioni contenute in questo messaggio di posta elettronica e/o
nel/i file/s allegato/i sono da considerarsi strettamente riservate. Il
loro utilizzo è consentito esclusivamente al destinatario del messaggio,
per le finalità indicate nel messaggio stesso. Qualora riceviate questo
messaggio senza esserne il destinatario, Vi preghiamo cortesemente di
darcene notizia via e-mail e di procedere alla distruzione del messaggio
stesso, cancellandolo dal Vostro sistema. Conservare il messaggio stesso,
divulgarlo anche in parte, distribuirlo ad altri soggetti, copiarlo, od
utilizzarlo per finalità diverse, costituisce comportamento contrario ai
principi dettati dal D.Lgs. 196/2003.

The information in this message and/or attachments, is intended solely for
the attention and use of the named addressee(s) and may be confidential or
proprietary in nature or covered by the provisions of privacy act
(Legislative Decree June, 30 2003, no.196 - Italy's New Data Protection
Code).Any use not in accord with its purpose, any disclosure, reproduction,
copying, distribution, or either dissemination, either whole or partial, is
strictly forbidden except previous formal approval of the named
addressee(s). If you are not the intended recipient, please contact
immediately the sender by telephone, fax or e-mail and delete the
information in this message that has been received in error. The sender
does not give any warranty or accept liability as the content, accuracy or
completeness of sent messages and accepts no responsibility  for changes
made after they were sent or for other risks which arise as a result of
e-mail transmission, viruses, etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/95fb42c9/attachment-0001.html>

From piero.campa at gmail.com  Thu Nov  9 01:53:54 2017
From: piero.campa at gmail.com (Piero Campalani)
Date: Thu, 9 Nov 2017 10:53:54 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
Message-ID: <CAMp9JaMneTsbeyR3qX3EKyvDmaN_=EC_0wS3dJU=H9tRfJVX6Q@mail.gmail.com>

Even,

On 8 November 2017 at 16:31, Even Rouault <even.rouault at spatialys.com>
wrote:

> OK thanks for the explanations. Makes some sense....
>
> So it would seem that if you want to return a GeoTIFF in
>
> traditional GIS order (ie faster varying dimension corresponds to
> longitude), AND you emit
> ​ ​
> offsetVector in the way Rasdaman does, it seems
>
> that emitting a gml:GridFunction +2 +1 would be required.
>

​Yes, as Jukka also pointed out in a later reply.  !

If you /match/ the description of the geometry of the grid (origin, offset
vectors order, etc) with the way you list the grid _data_ then you don't
need the GridFunction (that is, you can assume the default +1 +2 ... +N
linear rule).

In the other case, you need to instruct the client on how to interpret the
data.

(I believe that if the GridFunction would not be optional, this all would
be a little less confusing)



> But actually, looking closely at the drawing at
>
> http://rasdaman.org/wiki/PetascopeUserGuid
> <http://rasdaman.org/wiki/PetascopeUserGuide#GridaxislabelsandCRSaxislabels>
> ​​
> <http://rasdaman.org/wiki/PetascopeUserGuide#GridaxislabelsandCRSaxislabels>
> e#GridaxislabelsandCRSaxislabels
> <http://rasdaman.org/wiki/PetascopeUserGuide#GridaxislabelsandCRSaxislabels>
> , I see
>
> ​​
> RectifiedGrid.axisLabels="t Long Lat", whereas
> ​​
> RectifiedGrid.origin.Point at axisLabels="t Lat Long"
> ​ ​
> (note the inversion). The second offset vector expressed an increase in
> longitude (0 0 0.5), while thethird one a decrease in latitude (0 -0.5 0).
> Which is the GIS friendly order.
>
>
>
> So, it would seem that there are 2 more or less equivalent way of
> achieving the same end result ?
>

GRID axes names (in spite of the CRS axes names which are formally
described in its definition) are arbitrary: in the example, the rasdaman
​implementation chooses to name grid axes by the CRS axes they span.

​RectifiedGrid.axisLabels (GRID axes) are "t Long Lat", but could just be
"0 1 2", or "a b c". Naming them after the CRS they span is just more
convenient.

​RectifiedGrid.origin.Point at axisLabels are the CRS axes names instead,
hence latitude goes first.
The GML there is OK: indeed you see the 2nd offset-vector, the direction of
the 2nd "Long"-labelled GRID axis) goes '0 0 0.5', hence in the easting
direction.

​​


>
> And thus MapServer output at
>
> http://194.66.252.1
> <http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=DescribeCoverage&version=2.0.1&coverageid=BGS_EMODNET_CentralMed-MCol>
>
> And thus MapServer output at
>
> http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?
> SERVICE=WCS&REQUEST=DescribeCoverage&version=2.0.1&coverageid=BGS_EMODNET_
> CentralMed-MCol
>
> could probably be correct, but it would be better for
> RectifiedGrid.axisLabels to be changed to "long lat" to better
> ​ ​
> reflect what is done.
>
>
Exactly, that output is not OK as it is now.



> ​​
> And GeoServer output at https://msp.smartsea.fmi.fi/
> geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&
> VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393
>
> would either need to remove the GridFunction (ala MapServer) or keep it
> and invert the order in which its offsetVector appear (ala Rasdaman)
>
>
>

If GeoServer is not going to span the North direction first in the
GetCoverage responses, then that description is wrong.
Being EPSG:2393 a North-first CRS, the geometry of the grid already defines
the North-ward as first (+1), and East-ward as second (+2), so if that is
the rule which GeoServer will use to list the data, the GridFunction there
is wrong.



> And for WCS subsetting, when you write something like
> SUBSET=AXIS_NAME(min,max),
> ​ ​
> where AXIS_NAME should come from ? From the RectifiedGrid.axisLabels I
> guess ?
>
​


​NO, subsetting/subspacing​ is meant to work aligned with the coordinate
system (!)
You choose your (sub)space of interest, and then the server will filter out
all the grid points that get included in that space, independently of its,
say, geometric profile (indeed in extreme settings, what you get might not
be a grid! see below)

Example: imagine an oblique 100x100 2D regular grid in a 3D "X Y Z" CS
space. The grid has 2 "i" and "j" axes, with origin in "0 0 0" and offset
vectors which might be "1 1 0.5" for i and "-0.5 -0.5 1" for j.
The user's might want to fetch all the grid points in the small cube
delimited by X(0:3) Y(0:3) Z(7:10). in the 3D space, the user has defined
this little cube which will act as spatial filter for the oblique grid.

Subsetting via GRID indexes would be probably achieved if you request a
GetCoverage by using the "Index?D" CRS which is mean

Anyway.. it was just for keeping it a little less abstract.
WCS subsettings need the CRS axis names.

(In this nasty example, if you'd want to subset the oblique grid by taking
its 10x10 subgrid starting from the origin, then a) the server would need
to implement the WCS CRS extension, b) you would need to set the
"subsettingCrs" parameter to, say,
http://ows.rasdaman.org/def/crs/OGC/0/Index2D in the GetCoverage request,
and subset to i(0:9) and j(0:9))
[1] http://rasdaman.org/wiki/IndexCrss

Then in Ari's test with GeoServer
>
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&
> REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=
> smartsea__eusm2016-EPSG2393, in theory "i" and "j" should be the axis
> requested ?
>
>
No: having explained that here above, you see subsets in Ari's case should
be "X" and "Y", as defined in EPSG:2393.​

-
​Piero !​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/0fb4d88f/attachment.html>

From even.rouault at spatialys.com  Thu Nov  9 02:37:04 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 09 Nov 2017 11:37:04 +0100
Subject: [gdal-dev] Fwd: Request for OSGeo Budget 2018
Message-ID: <16070081.Kq9FEJi5fG@even-i700>

Hi,

See below: OSGeo board asking projects is they need budget for 2018.

Even

----------  Forwarded Message  ----------
[...]

We are trying to collect the budget requests for each commitee before the
next board meeting (21st of November) to make sure we can approve them
before the start of the year. If your commitee has any request for budget
for 2018, this is the time and place to do so.

To send it, you can either answer this email or send the budget directly to
the board mailing list. Either way, it will end up in the board mailing
list.

Some resources that may help you on this task:
 * https://wiki.osgeo.org/wiki/OSGeo_Budget_2017
 * https://wiki.osgeo.org/wiki/OSGeo_Budget_2018

At this moment (next two weeks) it doesn't have to be very detailed
(although it will help us). We just need to know your plans for next year
to make sure we can allocate money for all of our needs. And if we can't,
we need to discuss priorities.

[...]
-----------------------------------------

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/a99d05dd/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov  9 05:18:59 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 9 Nov 2017 06:18:59 -0700 (MST)
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <CAMp9JaMneTsbeyR3qX3EKyvDmaN_=EC_0wS3dJU=H9tRfJVX6Q@mail.gmail.com>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <CAMp9JaMneTsbeyR3qX3EKyvDmaN_=EC_0wS3dJU=H9tRfJVX6Q@mail.gmail.com>
Message-ID: <1510233539251-0.post@n6.nabble.com>

Piero Campa wrote
>> And for WCS subsetting, when you write something like
>> SUBSET=AXIS_NAME(min,max),
>> ​ ​
>> where AXIS_NAME should come from ? From the RectifiedGrid.axisLabels I
>> guess ?
>>
> ​
> ​NO, subsetting/subspacing​ is meant to work aligned with the coordinate
> system (!)
> You choose your (sub)space of interest, and then the server will filter
> out
> all the grid points that get included in that space, independently of its,
> say, geometric profile (indeed in extreme settings, what you get might not
> be a grid! see below)

Hi,

When Ari gets totally familiar with this then he will like to continue.
About the first new thing he wants to do will be to get response from WCS
with non-native pixel size. The he starts to read the Scaling extension
https://portal.opengeospatial.org/files/12-039 and then he learns that
scaling is done in the RectifiedGrid domain and RectifiedGrid.axisLabels are
exactly what he must use. Poor man.

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From ari.jolma at gmail.com  Thu Nov  9 05:52:15 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 9 Nov 2017 15:52:15 +0200
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <1510233539251-0.post@n6.nabble.com>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <CAMp9JaMneTsbeyR3qX3EKyvDmaN_=EC_0wS3dJU=H9tRfJVX6Q@mail.gmail.com>
 <1510233539251-0.post@n6.nabble.com>
Message-ID: <3f7402eb-0f3c-fe5f-9f4e-a9da18095294@gmail.com>

jratike80 kirjoitti 09.11.2017 klo 15:18:
> Piero Campa wrote
>>> And for WCS subsetting, when you write something like
>>> SUBSET=AXIS_NAME(min,max),
>>> ​ ​
>>> where AXIS_NAME should come from ? From the RectifiedGrid.axisLabels I
>>> guess ?
>>>
>> ​
>> ​NO, subsetting/subspacing​ is meant to work aligned with the coordinate
>> system (!)
>> You choose your (sub)space of interest, and then the server will filter
>> out
>> all the grid points that get included in that space, independently of its,
>> say, geometric profile (indeed in extreme settings, what you get might not
>> be a grid! see below)
> Hi,
>
> When Ari gets totally familiar with this then he will like to continue.
> About the first new thing he wants to do will be to get response from WCS
> with non-native pixel size. The he starts to read the Scaling extension
> https://portal.opengeospatial.org/files/12-039 and then he learns that
> scaling is done in the RectifiedGrid domain and RectifiedGrid.axisLabels are
> exactly what he must use. Poor man.

I had this in my code already

if (scaled) {
         // scaling is expressed in grid axes
         std::vector<CPLString> grid_axes = 
Split(CPLGetXMLValue(psService, "GridAxes", ""), ",");
         tmp.Printf("&SCALESIZE=%s(%i),%s(%i)", grid_axes[0].c_str(), 
nBufXSize, grid_axes[1].c_str(), nBufYSize);
         request += tmp;
     }

However, I have not yet tested it. I.e., GDAL gives me (the driver) a 
buffer where to write. I'm reasoning I should use the scalesize. The 
GridAxes is saved from the coverage description.

Ari

>
> -Jukka Rahkonen-
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From ari.jolma at gmail.com  Thu Nov  9 06:12:06 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 9 Nov 2017 16:12:06 +0200
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <3f7402eb-0f3c-fe5f-9f4e-a9da18095294@gmail.com>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <CAMp9JaMneTsbeyR3qX3EKyvDmaN_=EC_0wS3dJU=H9tRfJVX6Q@mail.gmail.com>
 <1510233539251-0.post@n6.nabble.com>
 <3f7402eb-0f3c-fe5f-9f4e-a9da18095294@gmail.com>
Message-ID: <7e2d579e-6cd3-fa84-fc22-c3088782a6de@gmail.com>

Ari Jolma kirjoitti 09.11.2017 klo 15:52:
> jratike80 kirjoitti 09.11.2017 klo 15:18:
>> Piero Campa wrote
>>>> And for WCS subsetting, when you write something like
>>>> SUBSET=AXIS_NAME(min,max),
>>>> ​ ​
>>>> where AXIS_NAME should come from ? From the RectifiedGrid.axisLabels I
>>>> guess ?
>>>>
>>> ​
>>> ​NO, subsetting/subspacing​ is meant to work aligned with the 
>>> coordinate
>>> system (!)
>>> You choose your (sub)space of interest, and then the server will filter
>>> out
>>> all the grid points that get included in that space, independently 
>>> of its,
>>> say, geometric profile (indeed in extreme settings, what you get 
>>> might not
>>> be a grid! see below)
>> Hi,
>>
>> When Ari gets totally familiar with this then he will like to continue.
>> About the first new thing he wants to do will be to get response from 
>> WCS
>> with non-native pixel size. The he starts to read the Scaling extension
>> https://portal.opengeospatial.org/files/12-039 and then he learns that
>> scaling is done in the RectifiedGrid domain and 
>> RectifiedGrid.axisLabels are
>> exactly what he must use. Poor man.
>
> I had this in my code already
>
> if (scaled) {
>         // scaling is expressed in grid axes
>         std::vector<CPLString> grid_axes = 
> Split(CPLGetXMLValue(psService, "GridAxes", ""), ",");
>         tmp.Printf("&SCALESIZE=%s(%i),%s(%i)", grid_axes[0].c_str(), 
> nBufXSize, grid_axes[1].c_str(), nBufYSize);
>         request += tmp;
>     }
>
> However, I have not yet tested it. I.e., GDAL gives me (the driver) a 
> buffer where to write. I'm reasoning I should use the scalesize. The 
> GridAxes is saved from the coverage description.

Now I have, all with the axis order swapped CRS. MapServer and Rasdaman 
return fine geotiffs. GeoServer returns something that GDAL complains 
"Returned tile does not match expected configuration. Got 13x20 instead 
of 20x13.", which is expected since with GeoServer I'm having the grid 
axis order problems.

Ari


From p.baumann at jacobs-university.de  Thu Nov  9 08:09:14 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Thu, 9 Nov 2017 17:09:14 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <2412504.K68ujnRmfP@even-i700>
References: <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>
 <2cf256a1-3def-5925-2aca-fc889e1f0bbb@jacobs-university.de>
 <2412504.K68ujnRmfP@even-i700>
Message-ID: <7f645c33-5cd0-583e-79ca-cbbec3b05f23@jacobs-university.de>

Even-

very good question:

On 11/09/2017 08:41 AM, Even Rouault wrote:
>
> Peter,
>
>  
>
> > the axisLabels attribute determines axis order, and this in turn refers to the
>
> > CRS definition behind the URL in srsName.
>
>  
>
> Does the value of RectifiedGrid.axisLabels must be correlated with the one of
> the CRS,
>
> or can it be a "random" value ?
>
> For example, GeoServer has <gml:RectifiedGrid><gml:axisLabels>i
> j</gml:axisLabels></gml:RectifiedGrid>
>

In CIS 1.0 it _must_ be the axis name as given in the CRS's axisAbbrev element.
At some time, however, OGP informed the world (well: the WCS.SWG) that this is
not normative and they reserve to change it, which they did: "Long" -> "Lon".
After the dust around this rumble settled the mechanism (agreed between WCS.SWG
and CRS.SWG) was slightly relaxed for CIS 1.1: axisLabels can use _any_ unique
identifier (say, axisLabels="x1 x2 x3") and only its positional order defines
the mapping between the CRS axis and the coverage axis.

So, in CIS 1.0: exact string equality, CIS 1.1: "random" value.

-Peter

>  
>
> > My team has analysed your report and says:
>
>  
>
> Thanks but I'm afraid I'm even more confused now.
>
>  
>
> >
>
> > On 11/08/2017 02:56 PM, Bang Pham Huu wrote:
>
> > > I checked the result as I think it is like this
>
> > >
>
> > > + GeoServer is correct with http://www.opengis.net/def/crs/EPSG/0/2393 as
>
> > > this one is X, Y so the offset vector is correct.
>
>  
>
> In EPSG, http://www.opengis.net/def/axis/EPSG/0/48 = X = NORTH and
>
> http://www.opengis.net/def/axis/EPSG/0/47 = Y = EAST. So this CRS has the
> "GIS-unfriendly" order.
>
>  
>
> But if you consider
>
> <gml:Envelope srsName="http://www.opengis.net/def/crs/EPSG/0/2393"
> axisLabels="Y X" uomLabels="m m" srsDimension="2">
>
> <gml:lowerCorner>6543350.381089335 3061592.6391462097</gml:lowerCorner>
>
> <gml:upperCorner>7307056.899896299
> 3432141.361396798</gml:upperCorner></gml:Envelope>
>
>  
>
> and assume from the above that Y=EAST=6543350.381089335 and
> X=NORTH=3061592.6391462097 (lower corner values),
>
> this doesn't transform to a location in Finland.
>
>  
>
> Whereas X=NORTH=6543350.381089335 and Y=EAST=3061592.6391462097 does transform
> to Finland
>
>  
>
> So I think the axisLabels here is wrong, it should be axisLabels="X Y"
>
>  
>
>  
>
> > >
>
> > > offsetVector1: X (positive), Y (negative)
>
> > >
>
> > > offsetVector2: Y (negative), X (positive)
>
>  
>
> Can't correlate the above reasoning about the sign of values with the actual
> output of
>
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=smartsea__eusm2016-EPSG2393
>
> which is
>
> <gml:offsetVector srsName="http://www.opengis.net/def/crs/EPSG/0/2393">0.0
> 20.00803035910304</gml:offsetVector>
>
> <gml:offsetVector
> srsName="http://www.opengis.net/def/crs/EPSG/0/2393">-20.00803035910304
> 0.0</gml:offsetVector>
>
>  
>
> Given what you said about <gml:GridFunction> not applying to GeoTIFF output, then
>
> this would be correct since the above would express that the first axis (along
> the width of the image) of the GeoTIFF
>
> express positive easting space and the second axis (along height) express
> negative northing spacing (image north-up oriented)
>
>  
>
> Even
>
>  
>
> -- 
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/5f1b8d40/attachment-0001.html>

From p.baumann at jacobs-university.de  Thu Nov  9 08:10:33 2017
From: p.baumann at jacobs-university.de (Peter Baumann)
Date: Thu, 9 Nov 2017 17:10:33 +0100
Subject: [gdal-dev] WCS GetCoverage with AxisOrder swap
In-Reply-To: <CA+nxMTtSfVX29D1txyNOBLO3_sgCx4hqK09dNTPTQ-CesLkS1Q@mail.gmail.com>
References: <fff6a965-8ac8-ebbc-c244-f81451fc3117@gmail.com>
 <bd7723d6-9fd7-fa2c-4770-7c68d4c357d8@gmail.com>
 <CAMp9JaOPU+J1qFpHbvCZ6uniO+Y1dq+aB0Xdmb1n+CQmuF7kgg@mail.gmail.com>
 <19119758.vFUb0KjAUD@even-i700>
 <ae0fd2a1-6b6b-c194-5f43-8905c8130054@gmail.com>
 <2cf256a1-3def-5925-2aca-fc889e1f0bbb@jacobs-university.de>
 <2412504.K68ujnRmfP@even-i700> <1510220209458-0.post@n6.nabble.com>
 <CA+nxMTtSfVX29D1txyNOBLO3_sgCx4hqK09dNTPTQ-CesLkS1Q@mail.gmail.com>
Message-ID: <14e1fe04-9893-46dd-7194-857cd5775858@jacobs-university.de>



On 11/09/2017 10:44 AM, Andrea Aime wrote:
> On Thu, Nov 9, 2017 at 10:36 AM, jratike80
> <jukka.rahkonen at maanmittauslaitos.fi
> <mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
>
>     Hi folks,
>
>     I think that it is extremely good to discuss about axisOrder, GridFunctions,
>     offsetVectors, axisLabels etc. because for sure we all want to build
>     interoperability between different WCS 2.0 implementations.
>     However, I think that this mailing list thread is rather making more
>     confusion than clarifying things. First, it is very hard to follow who wrote
>     what and when, and if that was an answer, then what was the question. And if
>     we make errors with our conclusions, or if we forget to think about all
>     aspects in out analyzes, it is very hard to clarify that on the mailing
>     list. We should have something like Google document or a wiki page as a
>     workplace.
>
>
> Fully agreed, a small tutorial with a few user cases (geographic, projected
> east/north,
> projected north/east) and (all?) valid ways to describe those situations would be
> very useful

absolutely! Just remember, standardization - like open-source development - is a
voluntary activity with consequently limited resources.
-Peter

>
> Cheers
> Andrea
>
> ==GeoServer Professional Services from the experts! Visit http://goo.gl/it488V
> for more information.==Ing. Andrea Aime @geowolfTechnical LeadGeoSolutions
> S.A.S.Via di Montramito 3/A55054  Massarosa (LU)phone: +39 0584 962313fax: +39
> 0584 1660272mob: +39  339
> 8844549http://www.geo-solutions.ithttp://twitter.com/geosolutions_it
>
> AVVERTENZE AI SENSI DEL D.Lgs. 196/2003
>
> Le informazioni contenute in questo messaggio di posta elettronica e/o nel/i
> file/s allegato/i sono da considerarsi strettamente riservate. Il loro
> utilizzo è consentito esclusivamente al destinatario del messaggio, per le
> finalità indicate nel messaggio stesso. Qualora riceviate questo messaggio
> senza esserne il destinatario, Vi preghiamo cortesemente di darcene notizia
> via e-mail e di procedere alla distruzione del messaggio stesso, cancellandolo
> dal Vostro sistema. Conservare il messaggio stesso, divulgarlo anche in parte,
> distribuirlo ad altri soggetti, copiarlo, od utilizzarlo per finalità diverse,
> costituisce comportamento contrario ai principi dettati dal D.Lgs. 196/2003.
>
> The information in this message and/or attachments, is intended solely for the
> attention and use of the named addressee(s) and may be confidential or
> proprietary in nature or covered by the provisions of privacy act (Legislative
> Decree June, 30 2003, no.196 - Italy's New Data Protection Code).Any use not
> in accord with its purpose, any disclosure, reproduction, copying,
> distribution, or either dissemination, either whole or partial, is strictly
> forbidden except previous formal approval of the named addressee(s). If you
> are not the intended recipient, please contact immediately the sender by
> telephone, fax or e-mail and delete the information in this message that has
> been received in error. The sender does not give any warranty or accept
> liability as the content, accuracy or completeness of sent messages and
> accepts no responsibility  for changes made after they were sent or for other
> risks which arise as a result of e-mail transmission, viruses, etc.
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Dr. Peter Baumann
 - Professor of Computer Science, Jacobs University Bremen
   www.faculty.jacobs-university.de/pbaumann
   mail: p.baumann at jacobs-university.de
   tel: +49-421-200-3178, fax: +49-421-200-493178
 - Executive Director, rasdaman GmbH Bremen (HRB 26793)
   www.rasdaman.com, mail: baumann at rasdaman.com
   tel: 0800-rasdaman, fax: 0800-rasdafax, mobile: +49-173-5837882
"Si forte in alienas manus oberraverit hec peregrina epistola incertis ventis dimissa, sed Deo commendata, precamur ut ei reddatur cui soli destinata, nec preripiat quisquam non sibi parata." (mail disclaimer, AD 1083)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/7297432e/attachment.html>

From sault.don at gmail.com  Thu Nov  9 11:52:07 2017
From: sault.don at gmail.com (Donovan Cameron)
Date: Thu, 9 Nov 2017 12:52:07 -0700
Subject: [gdal-dev] transformation failure from WGS 84 to GRS 1980
Message-ID: <04f59f4c-8ac3-eadc-4624-08ad2081cb7d@gmail.com>

Afternoon!

I recently upgraded to gdal 2.2.2 from 2.1 on linux and when I try to 
use ogr2ogr to append/update an existing table in PostgreSQL/PostGIS the 
command fails because it can't apply a transformation.

The command works fine in gdal 2.1.

The command I'm using is:

    ogr2ogr -update -append -gt unlimited -progress -f PostgreSQL
    pg:"host=sfngis dbname=witaskewin" input_tlus_pts.shp -nln
    fn_sfn.sfn_tlus_flg_pt -lco GEOMETRY_NAME=geom -s_srs "EPSG:4326"
    -t_srs "EPSG:3005" -dim 2

The first part of the error says:

    ERROR 6: Failed to initialize PROJ.4 with `+proj=longlat
    +datum=WGS84 +no_defs'.
    unknown elliptical parameter name
    ERROR 1: Failed to create coordinate transformation between the
    following coordinate systems.  This may be because they
    are not transformable, or because projection services
    (PROJ.4 DLL/.so) could not be loaded.

Here's the details on the source and target projections:

    ERROR 1: Source:
    GEOGCS["WGS 84",
         DATUM["WGS_1984",
             SPHEROID["WGS 84",6378137,298.257223563,
                 AUTHORITY["EPSG","7030"]],
             AUTHORITY["EPSG","6326"]],
         PRIMEM["Greenwich",0,
             AUTHORITY["EPSG","8901"]],
         UNIT["degree",0.0174532925199433,
             AUTHORITY["EPSG","9122"]],
         AUTHORITY["EPSG","4326"]]
    ERROR 1: Target:
    PROJCS["NAD83 / BC Albers",
         GEOGCS["NAD83",
             DATUM["North_American_Datum_1983",
                 SPHEROID["GRS 1980",6378137,298.257222101,
                     AUTHORITY["EPSG","7019"]],
                 TOWGS84[0,0,0,0,0,0,0],
                 AUTHORITY["EPSG","6269"]],
             PRIMEM["Greenwich",0,
                 AUTHORITY["EPSG","8901"]],
             UNIT["degree",0.0174532925199433,
                 AUTHORITY["EPSG","9122"]],
             AUTHORITY["EPSG","4269"]],
         PROJECTION["Albers_Conic_Equal_Area"],
         PARAMETER["standard_parallel_1",50],
         PARAMETER["standard_parallel_2",58.5],
         PARAMETER["latitude_of_center",45],
         PARAMETER["longitude_of_center",-126],
         PARAMETER["false_easting",1000000],
         PARAMETER["false_northing",0],
         UNIT["metre",1,
             AUTHORITY["EPSG","9001"]],
         AXIS["Easting",EAST],
         AXIS["Northing",NORTH],
         AUTHORITY["EPSG","3005"]]

It looks like gdal is able to find libproj.so:

% ldd /usr/lib/libgdal.so | grep proj
         libproj.so.12 => /usr/lib/libproj.so.12 (0x00007f1e67458000)

-- 
Kind regards,

Donovan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/b478c978/attachment-0001.html>

From even.rouault at spatialys.com  Thu Nov  9 13:01:46 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 09 Nov 2017 22:01:46 +0100
Subject: [gdal-dev] Call for discussion on RFC 70: Guessing output
	format from output file name extension
In-Reply-To: <1682531.OuxYCctptX@even-i700>
References: <1682531.OuxYCctptX@even-i700>
Message-ID: <100687958.DMY5J9Ms9T@even-i700>

On samedi 19 août 2017 22:49:19 CET Even Rouault wrote:
> Hi,
> 
> This is a call for discussion on:
> https://trac.osgeo.org/gdal/wiki/rfc70_output_format_guess
> 
> Summary:
> This proposal is to add syntaxic sugar to make GDAL and OGR command line
> utilities, so they take into account the extension of the output filename to
> guess which output driver to use, when it is not explicitly specified.
> 

I've found some time to do the initial implementation (for C++ utilities now):
https://github.com/rouault/gdal2/tree/rfc70

It went mostly along my initial ideas.

I've also updated the RFC text to reflect a change in behaviour w.r.t my initial ideas:
"""
When several drivers declare this extension (for example KML and LIBKML for .kml), the 
utility will select the first registered driver (except netCDF instead of GMT for .nc files), and a 
warning is emitted specifying which driver is used
"""

If there are no further comment, I'll call for a vote next week.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171109/f8bc6555/attachment.html>

From olivier at fieldap.com  Thu Nov  9 23:58:13 2017
From: olivier at fieldap.com (Olivier Chatry)
Date: Fri, 10 Nov 2017 08:58:13 +0100
Subject: [gdal-dev] ZMAP driver, support for comment section "+"
Message-ID: <CABcvH_QuAycXEND-_EB5-Wor5r+L4J+GWmRMAv_iRYcDpxvr6g@mail.gmail.com>

Hello !

I have a ZMAP file that apparently have comment inside, after the @ ( start
of the grid definition).

Here is an extract :


!     bla bla
!     bla bla
!     GRID FILE NAME   : bla bla
!     CREATION DATE    : bla bla
!     CREATION TIME    : bla bla
@blabla.zmap HEADER                     ,      GRID, 5
      15,    -99999.0000,       ,      4,      1
     441,    561,    867000.0000,    481000.0000,   9562000.0000,
 2573000.0000
         0.0000,         0.0000,         0.0000
@
+ Grid data starts after this line
    -99999.0000    -99999.0000    -99999.0000    -99999.0000    -99999.0000

QGIS was able to load the file just fine. I was not able to find any
standard for the ZMAP format ( but did not look a lot for it ).

I would gladly make a patch, but I'm not sure how I should proceed.

Any help ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/2083772b/attachment.html>

From andre+joost at nurfuerspam.de  Fri Nov 10 00:06:41 2017
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Fri, 10 Nov 2017 09:06:41 +0100
Subject: [gdal-dev] transformation failure from WGS 84 to GRS 1980
In-Reply-To: <04f59f4c-8ac3-eadc-4624-08ad2081cb7d@gmail.com>
References: <04f59f4c-8ac3-eadc-4624-08ad2081cb7d@gmail.com>
Message-ID: <ou3moj$56r$1@blaine.gmane.org>

Am 09.11.2017 um 20:52 schrieb Donovan Cameron:
> Afternoon!
>
> I recently upgraded to gdal 2.2.2 from 2.1 on linux and when I try to
> use ogr2ogr to append/update an existing table in PostgreSQL/PostGIS the
> command fails because it can't apply a transformation.
>
> The command works fine in gdal 2.1.
>

Where did you get gdal 2.2.2 from? I don't see it in any Ubuntu or 
Ubuntugis package.

Greetings,
André Joost



From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 10 00:11:42 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 10 Nov 2017 01:11:42 -0700 (MST)
Subject: [gdal-dev] ZMAP driver, support for comment section "+"
In-Reply-To: <CABcvH_QuAycXEND-_EB5-Wor5r+L4J+GWmRMAv_iRYcDpxvr6g@mail.gmail.com>
References: <CABcvH_QuAycXEND-_EB5-Wor5r+L4J+GWmRMAv_iRYcDpxvr6g@mail.gmail.com>
Message-ID: <1510301502410-0.post@n6.nabble.com>

Olivier Chatry wrote
> I would gladly make a patch, but I'm not sure how I should proceed.
> 
> Any help ?

Hi, 

Have you already found http://www.gdal.org/frmt_various.html and a link to
informal specification
https://lists.osgeo.org/pipermail/gdal-dev/2011-June/029173.html and the
code of the driver at
https://trac.osgeo.org/gdal/browser/trunk/gdal/frmts/zmap?

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 10 00:44:55 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 10 Nov 2017 08:44:55 +0000
Subject: [gdal-dev] Wiki page for WCS discussion and best practices created
Message-ID: <1510303493539.66002@maanmittauslaitos.fi>

Hi,

As an initial step I created a new page about WCS into the developers section of the GDAL wiki 
https://trac.osgeo.org/gdal/wiki/WCS%2Binteroperability

I suppose that all who have OSGeo user account can edit the page.

-Jukka Rahkonen-

From Jon.Morris at jbarisk.com  Fri Nov 10 00:49:31 2017
From: Jon.Morris at jbarisk.com (Jon Morris)
Date: Fri, 10 Nov 2017 08:49:31 +0000
Subject: [gdal-dev] GDAL make error
Message-ID: <MMXP123MB11332FC772F2E210DDF1B9C682540@MMXP123MB1133.GBRP123.PROD.OUTLOOK.COM>

Hi all,

We're having problems with a GDAL build from source and hope that someone here can point us in the right direction.

We've got a server running Scientific Linux 7 and we're using Jenkins 1.602.2 for CI. Every job builds our application from scratch, which includes a build of gdal. Up until yesterday, it was working fine, but then another user on that server installed postgres and we started to get build errors. Other users can still build the application, but the jenkins user fails each time with the error:

/home/jba/.jenkins/workspace/Farm_unit_tests/src/gdal/gdal/libgdal.so: undefined reference to `CPLHTTPSetOptions(void*, char**)'
/home/jba/.jenkins/workspace/Farm_unit_tests/src/gdal/gdal/libgdal.so: undefined reference to `OGRCreateExpatXMLParser()'
collect2: error: ld returned 1 exit status

Comparing the console output for earlier (successful) builds with later (failing) builds, we can see that during make, after the command (cd frmts; make), some extra options are enabled: -DFRMT_wcs -DFRMT_wms -DFRMT_plmosaic. Then later on in the build, after (cd apps; make appslib), the extra options -lexpat -lpcre and -lcurl appear.

Why would extra options be enabled when we haven't made any changes to the makefile? And are these extra options likely to be the failure in building libgdal.so?

Thanks,

Jon


Jon Morris
Software Developer

t: +44 (0) 1756 799919
Please click here<http://www.jbarisk.com/get-touch> if you would like to subscribe to our email news


Find out more about us here: www.jbarisk.com<http://www.jbarisk.com/> and follow us on Twitter @JBARisk<http://twitter.com/JBARisk> and LinkedIn<https://www.linkedin.com/company/2370847?trk=tyah&trkInfo=clickedVertical%3Acompany%2CclickedEntityId%3A2370847%2Cidx%3A2-1-2%2CtarId%3A1447414259786%2Ctas%3AJBA%20RISK%20MANAGEMENT>

The JBA Group supports the JBA Trust.

All JBA Risk Management's email messages contain confidential information and are intended only for the individual(s) named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail.
Please notify the sender immediately by email if you have received this email by mistake and delete this email from your system.


JBA Risk Management Limited is registered in England, company number 07732946, South Barn, Broughton Hall, Skipton, North Yorkshire, BD23 3AE, Telephone: +441756799919


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/05f34527/attachment-0001.html>

From mj10777 at googlemail.com  Fri Nov 10 01:05:47 2017
From: mj10777 at googlemail.com (Mark Johnson)
Date: Fri, 10 Nov 2017 10:05:47 +0100
Subject: [gdal-dev] Call for discussion on RFC 70: Guessing output
 format from output file name extension
Message-ID: <CAEEbjBimcGb_Yo-ieZbstj5qD+mXkHkFdn+U0g0L8azQOr8r1g@mail.gmail.com>

Reading the Magic-Header signatures first and then guessing from the file
extension may be a better approach.

In spatialite gaia_exif.c, the function gaiaGuessBlobType has a collection
of signatures to start with, combined with spatialite.c guess_mime_type
returning the mime type as string.

  //----------------------------------------------------------
  // https://en.wikipedia.org/wiki/List_of_file_signatures
  // https://gist.github.com/navinpai/983632
  // https://www.iana.org/assignments/media-types/media-types.xhtml
  //----------------------------------------------------------

Mark Johnson, Berlin Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/84d38067/attachment.html>

From frank.broniewski at gmail.com  Fri Nov 10 01:28:10 2017
From: frank.broniewski at gmail.com (Frank Broniewski)
Date: Fri, 10 Nov 2017 10:28:10 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <20171108103817.kvvky57qlv7j35dd@mail.nikosalexandris.net>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <5a02b81b.e184500a.8eb09.1c35@mx.google.com>
 <20171108103817.kvvky57qlv7j35dd@mail.nikosalexandris.net>
Message-ID: <5a05712c.5195500a.4b56d.9cca@mx.google.com>

Hi Nikos,

I think it would be quite easy to hack up a python script that generates a osmconf.ini with the configparser module and calls ogr2ogr via subprocess to process the data, but I don’t have done anything in that regard yet.
I don’t remember exactly anymore why I chose osmconvert over ogr2ogr for extracting a subregion from a larger PBF.  But as far as I remember osmconvert was superior in speed and accuracy for that task than ogr2ogr.

Dipl. Geogr. Frank Broniewski
Waldhölzbacher Str. 51
66679 Losheim am See
06872 5090684
www.frankbroniewski.com

Von: Nikos Alexandris
Gesendet: Mittwoch, 8. November 2017 11:38
An: Frank Broniewski
Cc: gdal-dev at lists.osgeo.org
Betreff: Re: AW: [gdal-dev] Extracting keys & values from OSM Planet

Frank Broniewski:

>Hi Nikos,
>
>I am using a similar approach to yours to extract data from OSM files
>to a GIS format. I chose Spatiallite as a format since it is superior
>to the Shapefile format in all areas.  FYI here’s what I do:

>osmconvert -b="5.5,49,8,50.5" -o=saarland.osm.pbf "europe-latest.osm.pbf"

>ogr2ogr --config OSM_CONFIG_FILE /home/frank/gdal/osmconf.ini -f SQLite -dsco SPATIALITE=YES -progress -gt 65536 -t_srs "EPSG:31466" >/tmp/saarland.sqlite /tmp/saarland.osm.pbf

>Please note the “–config” switch for a custom osmconf.ini. With that
>you can copy the config to a custom location and have several configs
>for many use cases.

Thank you Even and Frank!

I will likely adopt the `osmconf.ini` method.

@Frank, I would go a step further if time permits. A function or script that
takes something like `layer=lines` and
`keys="track,footway,bridleway,path"` as input parameters and outputs the
custom configuration file.

>From reading the driver's manual [0], there is a hint about the spatial,
filtering resulting in lines or polygons missing vertices. Is this a/the
reason, to stick to `osmconvert` for extracting areas of interest?

Thank you for your (invaluable) time, Nikos

[0] http://www.gdal.org/drv_osm.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/ac59c5b7/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 10 01:34:33 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 10 Nov 2017 02:34:33 -0700 (MST)
Subject: [gdal-dev] Call for discussion on RFC 70: Guessing output
 format from output file name extension
In-Reply-To: <CAEEbjBimcGb_Yo-ieZbstj5qD+mXkHkFdn+U0g0L8azQOr8r1g@mail.gmail.com>
References: <1682531.OuxYCctptX@even-i700> <100687958.DMY5J9Ms9T@even-i700>
 <CAEEbjBimcGb_Yo-ieZbstj5qD+mXkHkFdn+U0g0L8azQOr8r1g@mail.gmail.com>
Message-ID: <1510306473629-0.post@n6.nabble.com>

mj10777 wrote
> Reading the Magic-Header signatures first and then guessing from the file
> extension may be a better approach.

Hi,

The title says "Guessing output format from output file name extension",
like in 

ogr2ogr output.gpkg input.shp

Where would you read the Magic-Headers in this case?

-Jukka Rahkonen-





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Fri Nov 10 03:35:54 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 10 Nov 2017 12:35:54 +0100
Subject: [gdal-dev] GDAL make error
In-Reply-To: <MMXP123MB11332FC772F2E210DDF1B9C682540@MMXP123MB1133.GBRP123.PROD.OUTLOOK.COM>
References: <MMXP123MB11332FC772F2E210DDF1B9C682540@MMXP123MB1133.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <30210146.FGc4M17fci@even-i700>

> Why would extra options be enabled when we haven't made any changes 
to the
> makefile? And are these extra options likely to be the failure in building
> libgdal.so?

Jon,

Make sure you do a "make clean" as the configuration has changed

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/f40bf7e0/attachment.html>

From mj10777 at googlemail.com  Fri Nov 10 04:40:32 2017
From: mj10777 at googlemail.com (Mark Johnson)
Date: Fri, 10 Nov 2017 13:40:32 +0100
Subject: [gdal-dev] Call for discussion on RFC 70: Guessing output
 format from output file name extension
Message-ID: <CAEEbjBjsHJzJM0-L1x1yNtHxXYCzBz75OGJVGQFKeix-yPw37Q@mail.gmail.com>

>
> ogr2ogr output.gpkg input.shp Where would you read the Magic-Headers in
> this case?

Before the input file is opened.
Read the first 100 bytes, compare with known signatures


if ((memcmp (blob, tiff_signature_big, 4) == 0) &&
    (memcmp (blob, tiff_signature_little, 4) == 0))
{
  return type_tiff;
}
else if (strncmp ((char *) blob, "%PDF-", 5) == 0)
{
  return type_pdf;
}
else if (strncmp ((char *) blob, "SQLite format 3", 14) == 0)
{
  return type_sqlite3; // even if the extension is called '.db' or '.blombo'
}
else if (strncmp ((char *) blob, "** This file contains an SQLite 2", 14)
== 0)
{
  return type_sqlite2; // even if the extension is called '.db'
}
else if ((memcmp (blob, jp2_big, 12) == 0) &&
    (memcmp (blob, jp2_little, 12) == 0))
{
  return type_jp2;
}
else if ((memcmp (blob,jpeg1_signature, 2) == 0) &&
    (memcmp (blob, blob + size - 2, jpeg2_signature, 2) == 0))
{
  return type_jp2;
}
else // for other signatures
{
  return type_other;
}
else // for file extensions
{
  return type_kmz;
}

A Sqlite3 Database can have any type of extension.
Sometimes even '.sdb' is used, which normally is reserved for a
Sybase-Database - which is also a file based Database with its own Magic
Number.

To reliably determine this you use 'Magic Numbers', so that you know trough
knowledge instead of guessing.

'Magic Numbers' were introduced to avoid this problem, since a user could
rename the file to anything they want.

The above code is based on the used spatialite code, which read a BLOB,
where the file is stored and thus has no file-name or extension to read.

Reading the Magic-Header signatures first and then guessing from the
file extension may be a better approach.
>
> Even if the title uses the word 'Guessing', that is not a reason not so
suggest a more practical approach that, is less error prone.

Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/84944683/attachment-0001.html>

From even.rouault at spatialys.com  Fri Nov 10 04:46:26 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 10 Nov 2017 13:46:26 +0100
Subject: [gdal-dev] Call for discussion on RFC 70: Guessing output
	format from output file name extension
In-Reply-To: <CAEEbjBjsHJzJM0-L1x1yNtHxXYCzBz75OGJVGQFKeix-yPw37Q@mail.gmail.com>
References: <CAEEbjBjsHJzJM0-L1x1yNtHxXYCzBz75OGJVGQFKeix-yPw37Q@mail.gmail.com>
Message-ID: <3323251.0AIz3NpenM@even-i700>

On vendredi 10 novembre 2017 13:40:32 CET Mark Johnson wrote:
> > ogr2ogr output.gpkg input.shp Where would you read the Magic-Headers in
> > this case?
> 
> Before the input file is opened.

Mark, this RFC is about *non existing yet output* files (can't think how to make its 
title clearer :-)), so there's nothing to read. The only thing that can be used to 
guess the appropriate output driver is the filename.

What you describe is what has been implement since 19 years in GDAL to figure 
out which input driver matches an existing file ;-)

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/8bc53404/attachment.html>

From mj10777 at googlemail.com  Fri Nov 10 04:53:12 2017
From: mj10777 at googlemail.com (Mark Johnson)
Date: Fri, 10 Nov 2017 13:53:12 +0100
Subject: [gdal-dev] Call for discussion on RFC 70: Guessing output
 format from output file name extension
Message-ID: <CAEEbjBiv+K34GedYxdLc1hnjx2RtgCLcAJ5JcCO_uF8w9inzRg@mail.gmail.com>

Sorry, I overlooked the 'output filename to guess', while reading the PR
and title.

Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171110/d5e7c64a/attachment.html>

From sault.don at gmail.com  Fri Nov 10 23:45:36 2017
From: sault.don at gmail.com (Saulteau Don)
Date: Sat, 11 Nov 2017 00:45:36 -0700
Subject: [gdal-dev] transformation failure from WGS 84 to GRS 1980
In-Reply-To: <ou3moj$56r$1@blaine.gmane.org>
References: <04f59f4c-8ac3-eadc-4624-08ad2081cb7d@gmail.com>
 <ou3moj$56r$1@blaine.gmane.org>
Message-ID: <CAJo0jfMkh4vNiy8DDqj3OR4KuDx5Cs+fQGOCVXBGr0TpYhS98A@mail.gmail.com>

I'm running Arch Linux :)

On Nov 10, 2017 01:08, "Andre Joost" <andre+joost at nurfuerspam.de> wrote:

> Am 09.11.2017 um 20:52 schrieb Donovan Cameron:
>
>> Afternoon!
>>
>> I recently upgraded to gdal 2.2.2 from 2.1 on linux and when I try to
>> use ogr2ogr to append/update an existing table in PostgreSQL/PostGIS the
>> command fails because it can't apply a transformation.
>>
>> The command works fine in gdal 2.1.
>>
>>
> Where did you get gdal 2.2.2 from? I don't see it in any Ubuntu or
> Ubuntugis package.
>
> Greetings,
> André Joost
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171111/e23c9e1d/attachment.html>

From ari.jolma at gmail.com  Sat Nov 11 01:30:50 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Sat, 11 Nov 2017 11:30:50 +0200
Subject: [gdal-dev] Wiki page for WCS discussion and best practices
 created
In-Reply-To: <1510303493539.66002@maanmittauslaitos.fi>
References: <1510303493539.66002@maanmittauslaitos.fi>
Message-ID: <bb565807-82ae-f338-7277-7501ad2dc53f@gmail.com>

Rahkonen Jukka (MML) kirjoitti 10.11.2017 klo 10:44:
> Hi,
>
> As an initial step I created a new page about WCS into the developers section of the GDAL wiki
> https://trac.osgeo.org/gdal/wiki/WCS%2Binteroperability

I made a bold attempt to begin describing the fundamentals of coordinate 
systems in WCS and how those relate to the fundamentals of coordinate 
systems in GDAL.

Ari

>
> I suppose that all who have OSGeo user account can edit the page.
>
> -Jukka Rahkonen-
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From ari.jolma at gmail.com  Sat Nov 11 02:05:50 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Sat, 11 Nov 2017 12:05:50 +0200
Subject: [gdal-dev] Numeric accuracy
Message-ID: <67d2a0ab-8ba1-a519-1560-813ec4d57c48@gmail.com>

I have been bitten twice, once with ArcGIS and now with Rasdaman WCS, 
with numeric accuracy.

I'm making a data request on the corner of the bounding box, let's say 
it has minimum X of 75042.7273594. I'm setting my minX to that value and 
I'm enforcing it to that value with MAX (this was introduced because of 
a case with ArcGIS). The I print that to the request with "%.18g" (it 
was "%.15g" earlier but I changes it to that because of ArcGIS) and the 
result is 75042.7273593999998, which is not good for Rasdaman, since it 
is formally less than 75042.7273594. Although, in gdb

(gdb) p 75042.7273594 > 75042.727359399999
$7 = false

Any ideas how to detect/prevent these kinds of situations? Keep the 
checks and go back to "%.15g"? Not ok with ArcGIS.

Ari



From nik at nixanz.com  Fri Nov 10 16:09:48 2017
From: nik at nixanz.com (Nik Sands)
Date: Sat, 11 Nov 2017 11:09:48 +1100
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
Message-ID: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>

Hi,

I’m attempting to build GDAL for the first time in a while, and this is the first time for GDAL 2.2.2.  I’ve getting the following error when building for iOS arm64 on Mac OS X:

------------------------
geotiff.cpp:7653:13: error: unknown type name 'GUInt64'
    typedef GUInt64 WordType;
            ^
1 error generated.
make[2]: *** [../o/geotiff.lo] Error 1
make[1]: *** [gtiff-install-obj] Error 2
make: *** [frmts-target] Error 2
------------------------

The relevant part of geotiff.cpp is:

------------------------
#if SIZEOF_VOIDP == 8 || defined(__x86_64__)
    // We test __x86_64__ for x32 arch where SIZEOF_VOIDP == 4
    typedef GUInt64 WordType;
#else
    typedef unsigned int WordType;
#endif
------------------------

Should I be adding some exception condition into the ‘if’ part in order to get it to use unsigned int instead of GUInt64?  Or is there some other way that this should be handled for iOS arm64 when building on Mac OS X?

Cheers,
Nik.

========================================================
NIK SANDS
Line Tamer | Time Traveller | Space Cadet


From even.rouault at spatialys.com  Sat Nov 11 04:44:13 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 11 Nov 2017 13:44:13 +0100
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
In-Reply-To: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>
References: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>
Message-ID: <5703509.TombjQpW0C@even-i700>

On samedi 11 novembre 2017 11:09:48 CET Nik Sands wrote:
> Hi,
> 
> I’m attempting to build GDAL for the first time in a while, and this is the
> first time for GDAL 2.2.2.  I’ve getting the following error when building
> for iOS arm64 on Mac OS X:
> 
> ------------------------
> geotiff.cpp:7653:13: error: unknown type name 'GUInt64'
>     typedef GUInt64 WordType;
>             ^
> 1 error generated.
> make[2]: *** [../o/geotiff.lo] Error 1
> make[1]: *** [gtiff-install-obj] Error 2
> make: *** [frmts-target] Error 2
> ------------------------
> 
> The relevant part of geotiff.cpp is:
> 
> ------------------------
> #if SIZEOF_VOIDP == 8 || defined(__x86_64__)
>     // We test __x86_64__ for x32 arch where SIZEOF_VOIDP == 4
>     typedef GUInt64 WordType;
> #else
>     typedef unsigned int WordType;
> #endif
> ------------------------
> 
> Should I be adding some exception condition into the ‘if’ part in order to
> get it to use unsigned int instead of GUInt64?  Or is there some other way
> that this should be handled for iOS arm64 when building on Mac OS X?

Nik,

This is the sign of a serious configuration error. Patching it there will just hide many other 
problems elsewhere where 64bit integer is needed.

This likely occurs because HAVE_LONG_LONG is not set for some reason when configure 
runs.
If you run configure, I guess the "Checking for 64bit integer type" returns no.

Can you try the following (replace cc by the appropriate (cross)compiler binary) ?
echo 'int main() { long long off=0; }' > conftest.c
cc  -o conftest conftest.c 

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171111/d2b0e79f/attachment.html>

From ari.jolma at gmail.com  Sat Nov 11 07:00:17 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Sat, 11 Nov 2017 17:00:17 +0200
Subject: [gdal-dev] Numeric accuracy
In-Reply-To: <67d2a0ab-8ba1-a519-1560-813ec4d57c48@gmail.com>
References: <67d2a0ab-8ba1-a519-1560-813ec4d57c48@gmail.com>
Message-ID: <df775371-d656-5212-fd16-946fcb2383ae@gmail.com>

Ari Jolma kirjoitti 11.11.2017 klo 12:05:
> I have been bitten twice, once with ArcGIS and now with Rasdaman WCS, 
> with numeric accuracy.
>
> I'm making a data request on the corner of the bounding box, let's say 
> it has minimum X of 75042.7273594. I'm setting my minX to that value 
> and I'm enforcing it to that value with MAX (this was introduced 
> because of a case with ArcGIS). The I print that to the request with 
> "%.18g" (it was "%.15g" earlier but I changes it to that because of 
> ArcGIS) and the result is 75042.7273593999998, which is not good for 
> Rasdaman, since it is formally less than 75042.7273594. Although, in gdb
>
> (gdb) p 75042.7273594 > 75042.727359399999
> $7 = false
>
> Any ideas how to detect/prevent these kinds of situations? Keep the 
> checks and go back to "%.15g"? Not ok with ArcGIS.

I made a small function to convert the floating point numbers to strings 
(using "%.18g") and then comparing the strings. Seems to work but it 
requires storing the coverage envelope in the DescribeCoverage XML as 
strings and using those. That's since simply reading "75042.7273594" 
into a double and then printing it out with "%.18g" changes it into 
"75042.727359399999".

Ari

>
> Ari
>
>


From andre+joost at nurfuerspam.de  Sat Nov 11 07:02:43 2017
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Sat, 11 Nov 2017 16:02:43 +0100
Subject: [gdal-dev] transformation failure from WGS 84 to GRS 1980
In-Reply-To: <CAJo0jfMkh4vNiy8DDqj3OR4KuDx5Cs+fQGOCVXBGr0TpYhS98A@mail.gmail.com>
References: <04f59f4c-8ac3-eadc-4624-08ad2081cb7d@gmail.com>
 <ou3moj$56r$1@blaine.gmane.org>
 <CAJo0jfMkh4vNiy8DDqj3OR4KuDx5Cs+fQGOCVXBGr0TpYhS98A@mail.gmail.com>
Message-ID: <ou73ld$ud0$1@blaine.gmane.org>

Am 11.11.2017 um 08:45 schrieb Saulteau Don:
> I'm running Arch Linux :)
>

I don't have that running, but looking at 
https://www.archlinux.org/packages/?sort=&q=gdal&maintainer=&flagged=

I see a package 2.2.2-2 from 2017-11-09 and a package 2.2.2-3 from today.

Maybe the packaging went wrong on their side.

Greetings,
André Joost



From csbruce at cubewerx.com  Sat Nov 11 06:38:58 2017
From: csbruce at cubewerx.com (Craig Bruce)
Date: Sat, 11 Nov 2017 10:38:58 -0400
Subject: [gdal-dev] Numeric accuracy
In-Reply-To: <67d2a0ab-8ba1-a519-1560-813ec4d57c48@gmail.com>
References: <67d2a0ab-8ba1-a519-1560-813ec4d57c48@gmail.com>
Message-ID: <1c29bbc9-eab7-0b66-db2b-2f833c9f14a0@cubewerx.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171111/e6975577/attachment.html>

From jan.heckman at gmail.com  Sat Nov 11 10:58:08 2017
From: jan.heckman at gmail.com (Jan Heckman)
Date: Sat, 11 Nov 2017 19:58:08 +0100
Subject: [gdal-dev] Numeric accuracy
In-Reply-To: <67d2a0ab-8ba1-a519-1560-813ec4d57c48@gmail.com>
References: <67d2a0ab-8ba1-a519-1560-813ec4d57c48@gmail.com>
Message-ID: <CAKMUAtD7twBVepHa8oW53Ls9jfwj6cCwv4=r346qDXE=0enPFg@mail.gmail.com>

Hi Ari and all,

why not use machine epsilon <https://en.wikipedia.org/wiki/Machine_epsilon>?
somewhat over 1e-16 for double precision, or an even more tolerant
tolerance? Most cases of meter coordinates 0.001 is realistic.
Given projection errors, a bit more is also defensible.

Am I to simplistic?

On Sat, Nov 11, 2017 at 11:05 AM, Ari Jolma <ari.jolma at gmail.com> wrote:

> I have been bitten twice, once with ArcGIS and now with Rasdaman WCS, with
> numeric accuracy.
>
> I'm making a data request on the corner of the bounding box, let's say it
> has minimum X of 75042.7273594. I'm setting my minX to that value and I'm
> enforcing it to that value with MAX (this was introduced because of a case
> with ArcGIS). The I print that to the request with "%.18g" (it was "%.15g"
> earlier but I changes it to that because of ArcGIS) and the result is
> 75042.7273593999998, which is not good for Rasdaman, since it is formally
> less than 75042.7273594. Although, in gdb
>
> (gdb) p 75042.7273594 > 75042.727359399999
> $7 = false
>
> Any ideas how to detect/prevent these kinds of situations? Keep the checks
> and go back to "%.15g"? Not ok with ArcGIS.
>
> Ari
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171111/dfa46b03/attachment.html>

From sault.don at gmail.com  Sat Nov 11 19:53:14 2017
From: sault.don at gmail.com (Saulteau Don)
Date: Sat, 11 Nov 2017 20:53:14 -0700
Subject: [gdal-dev] transformation failure from WGS 84 to GRS 1980
In-Reply-To: <CAJo0jfOjLxnRjGb+8UaRUh7eZmhPxibVwvaFmXTZ5ztH1+gdTA@mail.gmail.com>
References: <04f59f4c-8ac3-eadc-4624-08ad2081cb7d@gmail.com>
 <ou3moj$56r$1@blaine.gmane.org>
 <CAJo0jfMkh4vNiy8DDqj3OR4KuDx5Cs+fQGOCVXBGr0TpYhS98A@mail.gmail.com>
 <ou73ld$ud0$1@blaine.gmane.org>
 <CAJo0jfOjLxnRjGb+8UaRUh7eZmhPxibVwvaFmXTZ5ztH1+gdTA@mail.gmail.com>
Message-ID: <CAJo0jfP7nXvuYd2-+cHeN3kDoH1Si66AYTVbcvcZXqgvBWJ1aw@mail.gmail.com>

I noticed that qgis built against the version I'm running also asks for the
transformation.

Maybe something to do with the differing ellipsoids.

On Nov 11, 2017 08:06, "Andre Joost" <andre+joost at nurfuerspam.de> wrote:

Am 11.11.2017 um 08:45 schrieb Saulteau Don:

> I'm running Arch Linux :)
>
>
I don't have that running, but looking at https://www.archlinux.org/pack
ages/?sort=&q=gdal&maintainer=&flagged=

I see a package 2.2.2-2 from 2017-11-09 and a package 2.2.2-3 from today.

Maybe the packaging went wrong on their side.


Greetings,
André Joost


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171111/24edcaa7/attachment.html>

From nik at nixanz.com  Sun Nov 12 00:50:47 2017
From: nik at nixanz.com (Nik Sands)
Date: Sun, 12 Nov 2017 19:50:47 +1100
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
In-Reply-To: <5703509.TombjQpW0C@even-i700>
References: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>
 <5703509.TombjQpW0C@even-i700>
Message-ID: <1E872397-BA83-4A60-8B11-4EAD1C91121E@nixanz.com>

Hi Even,

Thanks for your reply.  You are correct as usual.  Your ‘cc’ test produced no errors, and your mention of ‘HAVE_LONG_LONG’ reminded me that I had have issues with that when compiling older versions of GDAL as well.  So I went back to my old build script and checked and found that I always used to do the following:

—————————————————————————
    curl -O http://download.osgeo.org/gdal/$gdal_ver/gdal-$gdal_ver.tar.gz
    tar -xzf gdal-$gdal_ver.tar.gz
    sed 's/#undef HAVE_LONG_LONG/\/\* #undef HAVE_LONG_LONG \*\/\'$'\n#define HAVE_LONG_LONG 1/' gdal-$gdal_ver/port/cpl_config.h.in > gdal-$gdal_ver/port/cpl_config.h.in.NEW
    mv gdal-$gdal_ver/port/cpl_config.h.in gdal-$gdal_ver/port/cpl_config.h.in.ORIG
    mv gdal-$gdal_ver/port/cpl_config.h.in.NEW gdal-$gdal_ver/port/cpl_config.h.in
—————————————————————————

I’ve now done this again with GDAL 2.2.2 and this old work around gets it to compile OK (the same way the work around always did for older versions - I had just forgotten it).

Is there some way this could be changed in the config/source so that it has the correct HAVE_LONG_LONG value for iOS/arm64 without requiring this work around?

Cheers,
Nik.


> On 11 Nov 2017, at 11:44 pm, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> On samedi 11 novembre 2017 11:09:48 CET Nik Sands wrote:
> > Hi,
> > 
> > I’m attempting to build GDAL for the first time in a while, and this is the
> > first time for GDAL 2.2.2.  I’ve getting the following error when building
> > for iOS arm64 on Mac OS X:
> > 
> > ------------------------
> > geotiff.cpp:7653:13: error: unknown type name 'GUInt64'
> >     typedef GUInt64 WordType;
> >             ^
> > 1 error generated.
> > make[2]: *** [../o/geotiff.lo] Error 1
> > make[1]: *** [gtiff-install-obj] Error 2
> > make: *** [frmts-target] Error 2
> > ------------------------
> > 
> > The relevant part of geotiff.cpp is:
> > 
> > ------------------------
> > #if SIZEOF_VOIDP == 8 || defined(__x86_64__)
> >     // We test __x86_64__ for x32 arch where SIZEOF_VOIDP == 4
> >     typedef GUInt64 WordType;
> > #else
> >     typedef unsigned int WordType;
> > #endif
> > ------------------------
> > 
> > Should I be adding some exception condition into the ‘if’ part in order to
> > get it to use unsigned int instead of GUInt64?  Or is there some other way
> > that this should be handled for iOS arm64 when building on Mac OS X?
>  
> Nik,
>  
> This is the sign of a serious configuration error. Patching it there will just hide many other problems elsewhere where 64bit integer is needed.
>  
> This likely occurs because HAVE_LONG_LONG is not set for some reason when configure runs.
> If you run configure, I guess the "Checking for 64bit integer type" returns no.
>  
> Can you try the following (replace cc by the appropriate (cross)compiler binary) ?
> echo 'int main() { long long off=0; }' > conftest.c
> cc  -o conftest conftest.c 
>  
> Even
>  
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com <http://www.spatialys.com/>

========================================================
NIK SANDS
Line Tamer | Time Traveller | Space Cadet

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171112/3e816f27/attachment-0001.html>

From even.rouault at spatialys.com  Sun Nov 12 04:22:12 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 12 Nov 2017 13:22:12 +0100
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
In-Reply-To: <1E872397-BA83-4A60-8B11-4EAD1C91121E@nixanz.com>
References: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>
 <5703509.TombjQpW0C@even-i700>
 <1E872397-BA83-4A60-8B11-4EAD1C91121E@nixanz.com>
Message-ID: <5577632.1z0gkQKtnq@even-i700>

On dimanche 12 novembre 2017 19:50:47 CET Nik Sands wrote:
> Hi Even,
> 
> Thanks for your reply.  You are correct as usual.  Your ‘cc’ test produced
> no errors, 

And no warnings as well ?
Weird, since this is the test that is used to dected long long presence
See m4/acinclude.m4

Do you run configure with CCFLAGS defined ? For example, if CCFLAGS="-Wall", then the test 
will throw a warning that will make it fail.
I'm not sure why we use CCFLAGS in that file, whereas CFLAGS is used everywhere else.

What if you change in m4/acinclude.m4
  echo 'int main() { long long off=0; }' >> conftest.c
to
  echo 'int main() { long long off=0; (void)off; return 0; }' > conftest.c

and run autoconf to regenerate configure ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171112/f90c6489/attachment.html>

From aperi2007 at gmail.com  Mon Nov 13 00:00:38 2017
From: aperi2007 at gmail.com (Andrea Peri)
Date: Mon, 13 Nov 2017 09:00:38 +0100
Subject: [gdal-dev] compile gdal using the libpng 1.6.26
Message-ID: <CABqTJk8+bvvkmLHzy6Nh4c69urLnv==hpsBm22ODy1srQoEepQ@mail.gmail.com>

Hi,
I have a trouble with my qgis-server.

I have a debian stretch version 64bit where the libpng is at 1.6.26 version.

When I compile the gdal from source, it use its internal 1.2.56 version and
all is ok.

After, when I go to compile the qgis. Its cmake finding system found the
system libpng 1.6.26 and the qgis is compile using it.

But after this, when try to use the qgis-server (wms server) and asking the
png images.
It go in error .
The log explain me that the
qgis is compiled using the libpng-1.6.26 but is running using the
lib-1.2.56 version (of gdal).

I'm not able to say to qgis to compile using the libpng of gdal, so I like
to try to say at the gdal to compile not using its internal version, but
instead using the 1.6.26 from system.

I'm not sure this is possible to say using the gdal parameter "--with-png"
and also I'm not sure the 1.6.26 version is compatible with gdal 2.2.2.

Any experience to compile gdal with libpng 1.6.26 ?

Thx,
Andrea Peri



-- 
-----------------
Andrea Peri
. . . . . . . . .
qwerty àèìòù
-----------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171113/a3ef8fe3/attachment.html>

From even.rouault at spatialys.com  Mon Nov 13 03:23:56 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 13 Nov 2017 12:23:56 +0100
Subject: [gdal-dev] compile gdal using the libpng 1.6.26
In-Reply-To: <CABqTJk8+bvvkmLHzy6Nh4c69urLnv==hpsBm22ODy1srQoEepQ@mail.gmail.com>
References: <CABqTJk8+bvvkmLHzy6Nh4c69urLnv==hpsBm22ODy1srQoEepQ@mail.gmail.com>
Message-ID: <2007282.GiXDFN1Slx@even-i700>

On lundi 13 novembre 2017 09:00:38 CET Andrea Peri wrote:
> Hi,
> I have a trouble with my qgis-server.
> 
> I have a debian stretch version 64bit where the libpng is at 1.6.26 version.
> 
> When I compile the gdal from source, it use its internal 1.2.56 version and
> all is ok.
> 
> After, when I go to compile the qgis. Its cmake finding system found the
> system libpng 1.6.26 and the qgis is compile using it.
> 
> But after this, when try to use the qgis-server (wms server) and asking the
> png images.
> It go in error .
> The log explain me that the
> qgis is compiled using the libpng-1.6.26 but is running using the
> lib-1.2.56 version (of gdal).
> 
> I'm not able to say to qgis to compile using the libpng of gdal, so I like
> to try to say at the gdal to compile not using its internal version, but
> instead using the 1.6.26 from system.

Andrea,

Yes, you should definitely compile GDAL against system libpng if you plan to use it with other 
libs/apps that also link against system libpng. Normally the base ./configure of GDAL should 
fetch your system libpng (unless you explicitly specify --with-png=internal). I've just verified it 
on Stretch

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171113/8a17a132/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 13 05:39:41 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 13 Nov 2017 06:39:41 -0700 (MST)
Subject: [gdal-dev] Wiki page for WCS discussion and best practices
	created
In-Reply-To: <bb565807-82ae-f338-7277-7501ad2dc53f@gmail.com>
References: <1510303493539.66002@maanmittauslaitos.fi>
 <bb565807-82ae-f338-7277-7501ad2dc53f@gmail.com>
Message-ID: <1510580381748-0.post@n6.nabble.com>

Ari Jolma-2 wrote
> I made a bold attempt to begin describing the fundamentals of coordinate 
> systems in WCS and how those relate to the fundamentals of coordinate 
> systems in GDAL.
> 
> Ari

And I have
 
- Materialized my 6 pixel test image into a GeoTIFF image in EPSG:4326 and

- Published it with GeoServer so I could capture the DescribeCoverage
document

I would appreciate help with writing proper Python scripts for creating test
images A and B in different coordinate systems, as well as writing a
GetCoverage request for image B with subsets so that the result is a pixel
perfect copy of image A.




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From ari.jolma at gmail.com  Mon Nov 13 05:58:25 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Mon, 13 Nov 2017 15:58:25 +0200
Subject: [gdal-dev] Wiki page for WCS discussion and best practices
 created
In-Reply-To: <1510580381748-0.post@n6.nabble.com>
References: <1510303493539.66002@maanmittauslaitos.fi>
 <bb565807-82ae-f338-7277-7501ad2dc53f@gmail.com>
 <1510580381748-0.post@n6.nabble.com>
Message-ID: <05b9d0da-c97d-cb7e-4570-247e647c95ac@gmail.com>

jratike80 kirjoitti 13.11.2017 klo 15:39:
> Ari Jolma-2 wrote
>> I made a bold attempt to begin describing the fundamentals of coordinate
>> systems in WCS and how those relate to the fundamentals of coordinate
>> systems in GDAL.
>>
>> Ari
> And I have
>   
> - Materialized my 6 pixel test image into a GeoTIFF image in EPSG:4326 and
>
> - Published it with GeoServer so I could capture the DescribeCoverage
> document
>
> I would appreciate help with writing proper Python scripts for creating test
> images A and B in different coordinate systems, as well as writing a
> GetCoverage request for image B with subsets so that the result is a pixel
> perfect copy of image A.

Hm. I'm doing comprehensive tests on ArcGIS, MapServer, GeoServer, and 
Rasdaman, Versions 1.0.0, 1.1.0, 1.1.1, 1.1.2, and 2.0.1, inverted axis 
and normal axis. I don't have access to ArcGIS with inverted axis CRS or 
MapServer in not inverted axis CRS.

Test results in a table on the page

https://trac.osgeo.org/gdal/wiki/WCS%2Binteroperability

So far GeoServer 1.1 with inverted axis CRS data seems really strange. 
The returned geotiff is ok but GDAL doesn't like it as a result since it 
is east up, thus basically ok.

Ari

>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From nik at nixanz.com  Mon Nov 13 12:30:50 2017
From: nik at nixanz.com (Nik Sands)
Date: Tue, 14 Nov 2017 07:30:50 +1100
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
In-Reply-To: <5577632.1z0gkQKtnq@even-i700>
References: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>
 <5703509.TombjQpW0C@even-i700>
 <1E872397-BA83-4A60-8B11-4EAD1C91121E@nixanz.com>
 <5577632.1z0gkQKtnq@even-i700>
Message-ID: <A263E3B9-8FF2-44C8-99BD-375DFF0749E6@nixanz.com>

Hi Even,

If I include the -Wall option, then I do get just the one warning.  Here’s the command line I’m using, which is based on similar command lines from the make output…

------------------------------------
$ /Applications/Xcode.app/Contents/Developer/usr/bin/gcc -o conftest -arch arm64 -pipe -Os -gdwarf-2 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.1.sdk -Wno-implicit-function-declaration -fembed-bitcode -mno-thumb -Wall  -arch arm64 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.1.sdk conftest.c -ldl
conftest.c:1:24: warning: unused variable 'off' [-Wunused-variable]
int main() { long long off=0; }
                       ^
1 warning generated.
$
——————————————————

I made the change you suggested to acinclude.m4 and then ran autoconf.  Then I attempted to build GDAL again, but got the same error:

--------------------------------------------------
geotiff.cpp:7653:13: error: unknown type name 'GUInt64'
    typedef GUInt64 WordType;
            ^
1 error generated.
make[2]: *** [../o/geotiff.lo] Error 1
make[1]: *** [gtiff-install-obj] Error 2
make: *** [frmts-target] Error 2
--------------------------------------------------

I have to admit that I’m a very small-time developer and I’m somewhat out of my depth here, so forgive me if I sound like I don’t understand some of this stuff.

Cheers,
Nik.

> On 12 Nov 2017, at 11:22 pm, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> On dimanche 12 novembre 2017 19:50:47 CET Nik Sands wrote:
> > Hi Even,
> > 
> > Thanks for your reply.  You are correct as usual.  Your ‘cc’ test produced
> > no errors, 
>  
> And no warnings as well ?
> Weird, since this is the test that is used to dected long long presence
> See m4/acinclude.m4
>  
> Do you run configure with CCFLAGS defined ? For example, if CCFLAGS="-Wall", then the test will throw a warning that will make it fail.
> I'm not sure why we use CCFLAGS in that file, whereas CFLAGS is used everywhere else.
>  
> What if you change in m4/acinclude.m4
>   echo 'int main() { long long off=0; }' >> conftest.c
> to
>   echo 'int main() { long long off=0; (void)off; return 0; }' > conftest.c
>  
> and run autoconf to regenerate configure ?
>  
> Even
>  
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com <http://www.spatialys.com/>

========================================================
NIK SANDS
Line Tamer | Time Traveller | Space Cadet

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/da3c5af6/attachment.html>

From even.rouault at spatialys.com  Mon Nov 13 12:40:32 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 13 Nov 2017 21:40:32 +0100
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
In-Reply-To: <6DED087C-91AB-4543-A701-098943E09AB9@nixanz.com>
References: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>
 <5577632.1z0gkQKtnq@even-i700>
 <6DED087C-91AB-4543-A701-098943E09AB9@nixanz.com>
Message-ID: <2612861.OaarvabYQD@even-i700>

On mardi 14 novembre 2017 07:30:14 CET Nik Sands wrote:
> Hi Even,
> 
> If I include the -Wall option, then I do get just the one warning.  Here’s
> the command line I’m using, which is based on similar command lines from
> the make output…
> 
> ------------------------------------
> $ /Applications/Xcode.app/Contents/Developer/usr/bin/gcc -o conftest -arch
> arm64 -pipe -Os -gdwarf-2 -isysroot
> /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Deve
> loper/SDKs/iPhoneOS11.1.sdk -Wno-implicit-function-declaration
> -fembed-bitcode -mno-thumb -Wall  -arch arm64 -isysroot
> /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Deve
> loper/SDKs/iPhoneOS11.1.sdk conftest.c -ldl conftest.c:1:24: warning: unused
> variable 'off' [-Wunused-variable] int main() { long long off=0; }
>                        ^
> 1 warning generated.
> $

And what does the above return if you do it on the following conftest.c:

int main() { long long off=0; (void)off; return 0; }

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171113/b00cb65b/attachment.html>

From bishop.dev at gmail.com  Mon Nov 13 13:30:21 2017
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Tue, 14 Nov 2017 00:30:21 +0300
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
In-Reply-To: <A263E3B9-8FF2-44C8-99BD-375DFF0749E6@nixanz.com>
References: <3DD8683D-0CE2-4098-B615-425FB6108AC7@nixanz.com>
 <5703509.TombjQpW0C@even-i700>
 <1E872397-BA83-4A60-8B11-4EAD1C91121E@nixanz.com>
 <5577632.1z0gkQKtnq@even-i700>
 <A263E3B9-8FF2-44C8-99BD-375DFF0749E6@nixanz.com>
Message-ID: <4c2fd8d6-413f-fbf4-ff1d-12cd16bc159c@gmail.com>

Hi Nik,

You may try alternative build scenario using CMake.

1.  Install XCode command line tools if already not done this 
(https://www.embarcadero.com/starthere/xe5/mobdevsetup/ios/en/installing_the_commandline_tools.html) 
and CMake (https://cmake.org/download/)


2. In terminal execute commands:

 > git clone --depth 1 https://github.com/nextgis-borsch/lib_gdal.git
 > cd lib_gdal
 > mkdir build
 > cd build
 > cmake -G"Unix Makefiles" -DBUILD_TARGET_PLATFORM=IOS 
-DCMAKE_INSTALL_PREFIX=install -DCMAKE_BUILD_TYPE=Release 
-DENABLE_BITCODE=OFF -DIOS_ARCH=arm64 -DIOS_PLATFORM=OS -DENABLE_NEON=ON 
-DCMAKE_TOOLCHAIN_FILE=../cmake/ios.toolchain.cmake -DWITH_JSONC=ON 
-DWITH_JSONC_EXTERNAL=ON -DWITH_TIFF=ON -DWITH_TIFF_EXTERNAL=ON 
-DWITH_GeoTIFF=ON -DWITH_GeoTIFF_EXTERNAL=ON -DOSX_FRAMEWORK=ON 
-DENABLE_GIF=OFF -DENABLE_CAD=OFF -DENABLE_PNG=OFF -DGDAL_BUILD_APPS=OFF 
-DGDAL_BUILD_DOCS=OFF -DWITH_PYTHON=OFF ..

Some flags description:
-DIOS_ARCH maybe armv7, armv7s, arm64, i386 or x86_64
-DIOS_PLATFORM maybe IOS or SIMULATOR

After configuring you will see summary about GDAL build or error 
message. I expect everything will be fine.

Run this command to build GDAL:

 > cmake --build . -- -j 4

May be this need to rerun twice as dependency may not build on first run.

You may build GDAL for several architectures and create fat library 
using lipo -create command (I rewrite OpenCV py script to automate 
creating my own fat iOS library which use GDAL - 
https://github.com/nextgis/nextgis_datastore/blob/master/opt/ios/build_framework.py)


This is minimal build of GDAL. If you need some drivers which not build 
by listed command let me know - I'll help to modify command line options.

Best regards,
     Dmitry

13.11.2017 23:30, Nik Sands пишет:
> Hi Even,
>
> If I include the -Wall option, then I do get just the one warning.  Here’s the command line I’m using, which is based on similar command lines from the make output…
>
> ------------------------------------
> $ /Applications/Xcode.app/Contents/Developer/usr/bin/gcc -o conftest -arch arm64 -pipe -Os -gdwarf-2 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.1.sdk -Wno-implicit-function-declaration -fembed-bitcode -mno-thumb -Wall  -arch arm64 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.1.sdk conftest.c -ldl
> conftest.c:1:24: warning: unused variable 'off' [-Wunused-variable]
> int main() { long long off=0; }
>                         ^
> 1 warning generated.
> $
> ——————————————————
>
> I made the change you suggested to acinclude.m4 and then ran autoconf.  Then I attempted to build GDAL again, but got the same error:
>
> --------------------------------------------------
> geotiff.cpp:7653:13: error: unknown type name 'GUInt64'
>      typedef GUInt64 WordType;
>              ^
> 1 error generated.
> make[2]: *** [../o/geotiff.lo] Error 1
> make[1]: *** [gtiff-install-obj] Error 2
> make: *** [frmts-target] Error 2
> --------------------------------------------------
>
> I have to admit that I’m a very small-time developer and I’m somewhat out of my depth here, so forgive me if I sound like I don’t understand some of this stuff.
>
> Cheers,
> Nik.
>
>> On 12 Nov 2017, at 11:22 pm, Even Rouault <even.rouault at spatialys.com> wrote:
>>
>> On dimanche 12 novembre 2017 19:50:47 CET Nik Sands wrote:
>>> Hi Even,
>>>
>>> Thanks for your reply.  You are correct as usual.  Your ‘cc’ test produced
>>> no errors,
>>   
>> And no warnings as well ?
>> Weird, since this is the test that is used to dected long long presence
>> See m4/acinclude.m4
>>   
>> Do you run configure with CCFLAGS defined ? For example, if CCFLAGS="-Wall", then the test will throw a warning that will make it fail.
>> I'm not sure why we use CCFLAGS in that file, whereas CFLAGS is used everywhere else.
>>   
>> What if you change in m4/acinclude.m4
>>    echo 'int main() { long long off=0; }' >> conftest.c
>> to
>>    echo 'int main() { long long off=0; (void)off; return 0; }' > conftest.c
>>   
>> and run autoconf to regenerate configure ?
>>   
>> Even
>>   
>> -- 
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com <http://www.spatialys.com/>
> ========================================================
> NIK SANDS
> Line Tamer | Time Traveller | Space Cadet
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/e3e87c3c/attachment-0001.html>

From nik at nixanz.com  Mon Nov 13 16:19:47 2017
From: nik at nixanz.com (Nik Sands)
Date: Tue, 14 Nov 2017 11:19:47 +1100
Subject: [gdal-dev] Cannot build for iOS due to GUInt64 error
In-Reply-To: <2612861.OaarvabYQD@even-i700>
Message-ID: <1ff1ed3699f3030524499c13b8acab4286b7202e@atmail.dreamhost.com>

No output at all (no errors, no warnings) for that test.

Cheers,
Nik.

(PS.  Re-sent to include the list address)

-----------------------------------------
NIK SANDS
Line Tamer | Time Traveller | Space Cadet

----- Original Message -----
From:
 "Even Rouault" <even.rouault at spatialys.com>

To:
"Nik Sands" <nik at nixanz.com>
Cc:
<gdal-dev at lists.osgeo.org>
Sent:
Mon, 13 Nov 2017 21:40:32 +0100
Subject:
Re: [gdal-dev] Cannot build for iOS due to GUInt64 error

	On mardi 14 novembre 2017 07:30:14 CET Nik Sands wrote: 

	> Hi Even, 

	>  

	> If I include the -Wall option, then I do get just the one warning.
Here’s 

	> the command line I’m using, which is based on similar command
lines from 

	> the make output… 

	>  

	> ------------------------------------ 

	> $ /Applications/Xcode.app/Contents/Developer/usr/bin/gcc -o
conftest -arch 

	> arm64 -pipe -Os -gdwarf-2 -isysroot 

	>
/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Deve


	> loper/SDKs/iPhoneOS11.1.sdk -Wno-implicit-function-declaration 

	> -fembed-bitcode -mno-thumb -Wall -arch arm64 -isysroot 

	>
/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Deve


	> loper/SDKs/iPhoneOS11.1.sdk conftest.c -ldl conftest.c:1:24:
warning: unused 

	> variable 'off' [-Wunused-variable] int main() { long long off=0; } 

	> ^ 

	> 1 warning generated. 

	> $ 

	  

	And what does the above return if you do it on the following
conftest.c: 

	  

	int main() { long long off=0; (void)off; return 0; } 

	  

	--  

	Spatialys - Geospatial professional services 

	http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/fe4c37e4/attachment.html>

From even.rouault at spatialys.com  Tue Nov 14 02:23:54 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Nov 2017 11:23:54 +0100
Subject: [gdal-dev] Fwd: RE: [gdal 2.2.2] different result with gdal 2.1.0
Message-ID: <2631097.gJk4V7girH@even-i700>

CC'ing Vincent's latest answer

----------  Forwarded Message  ----------

Subject: RE: [gdal-dev] [gdal 2.2.2] different result with gdal 2.1.0
Date: mardi 14 novembre 2017, 10:04:51 CET
From: Vincent BERNAT <vincent.bernat at magellium.fr>
To: Even Rouault <even.rouault at spatialys.com>

Even,

Thanks for your reply.


In fact, you were right : my dataset was wrongly georeferencing and with gdal 2.2.2, it's ok.


I am sorry for the mistake!


Thanks again

Regards,


Vincent


________________________________
De : Even Rouault <even.rouault at spatialys.com>
Envoyé : mardi 7 novembre 2017 22:30
À : Vincent BERNAT
Cc : gdal-dev at lists.osgeo.org
Objet : Re: [gdal-dev] [gdal 2.2.2] different result with gdal 2.1.0


Vincent,



digging into the GDAL 2.2.0 NEWS file, I see:

"""

ASRP driver:

* fix georeferencing of polar arc zone images (#6560)

""""



So if there's an issue it is mostly related to that change, rather than on the gdalwarp / 
GDALSuggestedWarpOutput side of things



And that fix was backported to GDAL 2.1.1, which explains I saw same results in the latest 
state of GDAL 2.1, 2.2 and trunk branchs, if you are on GDAL 2.1.0 which has not this fix



You should already see the difference of georeferencing between GDAL 2.1.0 and later 
version by doing a gdalinfo on the source ASRP file.



Do you have strong reasons to believe that GDAL 2.1.0 was really georeferencing correctly 
your dataset ?

The change done in https://trac.osgeo.org/gdal/ticket/6560 seems at first sight to be an 
improvement regarding the previous behaviour



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com

-----------------------------------------
-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/88346ef1/attachment.html>

From gcpp.kalxas at gmail.com  Tue Nov 14 04:05:29 2017
From: gcpp.kalxas at gmail.com (Angelos Tzotsos)
Date: Tue, 14 Nov 2017 14:05:29 +0200
Subject: [gdal-dev] [OGC Portal] OGC Compliance Renewal Notification
 (Final Expiration Notice)
In-Reply-To: <eed80868-5c76-4cac-5b80-10a7631c15a9@gmail.com>
References: <E1e9X89-00087C-Ur@tic.ogcinc.net>
 <eed80868-5c76-4cac-5b80-10a7631c15a9@gmail.com>
Message-ID: <e4c5abd4-84e5-428a-a401-a69474bb7c20@gmail.com>

Update on the status of OGC renewals:

Submission deadline is today.

This issue is holding back GDAL passing the test:
https://github.com/opengeospatial/ets-kml22/issues/14
The technical contact reported that this issue is now fixed and that the 
plan is to deploy the fix end of November.
We have asked OGC to extend the deadline until this fix is deployed and 
waiting for their answer.

Best,
Angelos

On 10/31/2017 08:15 PM, Angelos Tzotsos wrote:
> Hi all,
>
> Just an update on the status of our OGC certification renewals:
> We currently have 3 projects under certification:
> MapServer, GDAL and pycsw.
>
> pycsw has passed all the tests for CSW 2.0 and CSW 3.0 and is ready to 
> be certified once again.
> Even has reported an issue with CITE tests and GDAL, so our 
> application is waiting for feedback from CITE developers.
> Unfortunately MapServer has not yet responded (adding mapserver-dev 
> list in CC). There is still time for other projects to submit their 
> CITE test results and get certified through the OSGeo account.
>
> Best,
> Angelos
>
> On 10/31/2017 04:03 PM, Barbara Sherman wrote:
>>    Open Source Geospatial Foundation
>>
>> *! Your Compliance Records Expire Today !*
>>
>> This is an automated email to inform you that your OGC-certified 
>> compliance
>> license(s) for the following products are due to be renewed by 
>> *October 31st,
>> 2017*. After that date your products will no longer be listed as 
>> certified OGC
>> compliant.
>>
>> If you have already received an earlier notice and have started the 
>> renewal
>> process please ignore this message.
>>
>> We invite you to easily renew online in our implementation portal:
>> http://www.opengeospatial.org/resource/products/registration
>>
>> As a reminder, the account used to manage your certification listings 
>> is: *osgeo
>> (info at osgeo.org <mailto:info at osgeo.org>)*
>>
>> If you have any questions please send an email to 
>> compliance at opengeospatial.org
>> <mailto:compliance at opengeospatial.org>. The OGC compliance team will 
>> be more
>> than glad to help you.
>>
>> -------------------------------------------------------------------------------- 
>>
>>
>>
>>      Current OGC-Compliant Listings
>>
>>
>>        GDAL/OGR 1.11
>>
>> Specification(s)    Original Certification
>> OGC KML 2.2.0     2014-08-15
>> OGC KML (Level 2) 2.2.0     2014-08-15
>> OGC KML (Level 3) 2.2.0     2014-08-15
>>
>>
>>        GDAL/OGR 2.1
>>
>> Specification(s)    Original Certification
>> OGC KML 2.2.0
>> (OGC Reference Implementation)    2016-11-30
>> OGC KML (Level 2) 2.2.0
>> (OGC Reference Implementation)    2016-11-30
>> OGC KML (Level 3) 2.2.0
>> (OGC Reference Implementation)    2016-11-30
>>
>>
>>        MapServer 6.2
>>
>> Specification(s)    Original Certification
>> OpenGIS Web Map Service (WMS) Implementation Specification 1.3.0
>> (OGC Reference Implementation)    2016-01-12
>>
>>
>>        pycsw 1.10
>>
>> Specification(s)    Original Certification
>> OpenGIS Catalogue Service Implementation Specification 2.0.2 2016-01-26
>> OpenGIS Catalogue Service Implementation Specification [Catalogue 
>> Service for
>> the Web] 2.0.2     2016-01-26
>>
>>
>>        pycsw 2.0
>>
>> Specification(s)    Original Certification
>> OGCÂ® Catalogue Services 3.0 Specification - HTTP Protocol Binding 3.0
>> (OGC Reference Implementation)    2016-11-30
>> OGCÂ® Catalogue Services 3.0 Specification - HTTP Protocol Binding 
>> (OpenSearch) 3.0
>> (OGC Reference Implementation)    2016-11-30
>> OpenGIS Catalogue Service Implementation Specification 2.0.2
>> (OGC Reference Implementation)    2016-11-30
>> OpenGIS Catalogue Service Implementation Specification [Catalogue 
>> Service for
>> the Web] 2.0.2
>> (OGC Reference Implementation)    2016-11-30
>>
>>
>>
>

-- 
Angelos Tzotsos, PhD
Charter Member
Open Source Geospatial Foundation
http://users.ntua.gr/tzotsos


From even.rouault at spatialys.com  Tue Nov 14 06:36:51 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Nov 2017 15:36:51 +0100
Subject: [gdal-dev] GDAL annual report
Message-ID: <1781130.JHhsnQ9noC@even-i700>

Hi,

The OSGeo board requested a project status for GDAL. I've drafted
https://trac.osgeo.org/gdal/wiki/AnnualReport2016_first_half_2017
You're welcome to do edits.

I'll also attend the next OSGeo board meeting (Nov 21st 14h UTC) on 
invitation of the board. If there are points you would want to communicate 
to the board, let me know.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/1027264b/attachment.html>

From ari.jolma at gmail.com  Tue Nov 14 07:41:16 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 14 Nov 2017 17:41:16 +0200
Subject: [gdal-dev] WCS driver work
Message-ID: <792d51a2-b76f-1f8e-5e2f-73b65ff85607@gmail.com>

I've got very close to being able to get valid data (visual comparison 
in QGIS) from various server types and WCS versions.

I've documented the results here: 
https://trac.osgeo.org/gdal/wiki/WCS%2Binteroperability

It seems that I need eight option flags to cover all cases. Mostly the 
problems are with CRS that have inverted axis order. Also it seems to be 
a problem if the server or the standard does not support requesting 
directly tiles of specific size. It is especially a problem since GDAL 
fails the call if the size is not expected.

The only combination that I have not yet managed to get to work is 
GeoServer with version 1.1 and inverted axis order. I can get a decent 
response but the returned geotiff has slightly wrong size (59x38 instead 
of 60x38). The problematic call is below[1].

Also, I have/know only a few servers and I lack some combinations; I've 
also found a server with a combination that I've managed to test ok, but 
whose behavior I can't yet explain[2].

I'm writing documentation and test code but the latter will still take 
some time to be ready for the trunk.

The code is at https://github.com/ajolma/gdal/tree/trunk/gdal/frmts/wcs

I've also made one ticket regarding port code 
https://trac.osgeo.org/gdal/ticket/7141

Ari

[1] 
https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&VERSION=1.1.0&REQUEST=GetCoverage&IDENTIFIER=smartsea%3Aeusm2016-EPSG2393&FORMAT=image%2Ftiff&BOUNDINGBOX=6620001.14539506,3199988.18514013,6670001.21326246,3279980.29051582,urn:ogc:def:crs:EPSG::2393&RangeSubset=contents&GridBaseCRS=urn:ogc:def:crs:EPSG::2393&GridCS=urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS&GridType=urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs&GridOrigin=6670001.21326246,3199988.18514013&GridOffsets=0,1333.20175626157,-1315.79125966838,0

[2] 
https://lists.osgeo.org/pipermail/mapserver-users/2017-November/080339.html



From ari.jolma at gmail.com  Tue Nov 14 08:02:40 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 14 Nov 2017 18:02:40 +0200
Subject: [gdal-dev] Wiki page for WCS discussion and best practices
 created
In-Reply-To: <1510580381748-0.post@n6.nabble.com>
References: <1510303493539.66002@maanmittauslaitos.fi>
 <bb565807-82ae-f338-7277-7501ad2dc53f@gmail.com>
 <1510580381748-0.post@n6.nabble.com>
Message-ID: <66c89d02-b7a8-2afe-8a8b-dba79a76b190@gmail.com>

jratike80 kirjoitti 13.11.2017 klo 15:39:
> Ari Jolma-2 wrote
>> I made a bold attempt to begin describing the fundamentals of coordinate
>> systems in WCS and how those relate to the fundamentals of coordinate
>> systems in GDAL.
>>
>> Ari
> And I have
>   
> - Materialized my 6 pixel test image into a GeoTIFF image in EPSG:4326 and
>
> - Published it with GeoServer so I could capture the DescribeCoverage
> document

The URL of the server?

Ari

>
> I would appreciate help with writing proper Python scripts for creating test
> images A and B in different coordinate systems, as well as writing a
> GetCoverage request for image B with subsets so that the result is a pixel
> perfect copy of image A.
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From lucianpls at yahoo.com  Tue Nov 14 12:04:18 2017
From: lucianpls at yahoo.com (Lucian Plesea)
Date: Tue, 14 Nov 2017 20:04:18 +0000 (UTC)
Subject: [gdal-dev] Windows MSVC exception handling model
References: <334916899.4731.1510689858197.ref@mail.yahoo.com>
Message-ID: <334916899.4731.1510689858197@mail.yahoo.com>

Is there a specific reason to use /EHsc and not /EHs for windows compilation?The difference is that /EHsc, which is used now, tells the MSVC that extern "C" functions can't throw exceptions.
I am trying to use libjpeg and use C++ exception instead of setjmp/longjmp, by having libjpeg call a C++ function that throws an exception.  With /EHs it works fine, but with /EHsc, incorrect code will be generated and the exception will not be caught.
Thanks,
Lucian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/01f05dce/attachment.html>

From even.rouault at spatialys.com  Tue Nov 14 12:30:48 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Nov 2017 21:30:48 +0100
Subject: [gdal-dev] Windows MSVC exception handling model
In-Reply-To: <334916899.4731.1510689858197@mail.yahoo.com>
References: <334916899.4731.1510689858197.ref@mail.yahoo.com>
 <334916899.4731.1510689858197@mail.yahoo.com>
Message-ID: <2854380.LMFdVFWuCQ@even-i700>

On mardi 14 novembre 2017 20:04:18 CET Lucian Plesea wrote:
> Is there a specific reason to use /EHsc and not /EHs for windows
> compilation?The difference is that /EHsc, which is used now, tells the MSVC
> that extern "C" functions can't throw exceptions. I am trying to use
> libjpeg and use C++ exception instead of setjmp/longjmp, by having libjpeg
> call a C++ function that throws an exception.  With /EHs it works fine, but
> with /EHsc, incorrect code will be generated and the exception will not be
> caught. Thanks,

My digging of history:

*/GX flag introduced per
https://github.com/OSGeo/gdal/commit/08015d0aed3fdab22c9048ed45d017faa4b43cdf

* modified to /EHsc per
https://github.com/OSGeo/gdal/commit/6fea01f333617751c4086a354e53836cb70f3cab
https://trac.osgeo.org/gdal/ticket/1083

I'd believe /EHsc might theoretically generate better code than /EHs since no code for
exception catching is needed when calling extern C functions

But I'd be concerned that with gcc throwing C++ exceptions from symbols with C linkage
would be undefined behaviour, as the following thread would seem to suggest:

https://stackoverflow.com/questions/15845681/can-c-functions-marked-as-extern-c-throw

Apparently gcc -fexceptions might help
       -fexceptions
           Enable exception handling.  Generates extra code needed to propagate exceptions.  For some targets, this implies GCC generates frame unwind information for all functions, which can produce
           significant data size overhead, although it does not affect execution.  If you do not specify this option, GCC enables it by default for languages like C++ that normally require exception
           handling, and disables it for languages like C that do not normally require it.  However, you may need to enable this option when compiling C code that needs to interoperate properly with
           exception handlers written in C++.  You may also wish to disable this option if you are compiling older C++ programs that don't use exception handling.

But what about other compilers, etc.

So it would seem safer to me avoiding throwing C++ exception from libjpeg callbacks.

But I'm aware that setjmp/longjmp in C++ code is also tricky to do correctly. The safer is to create
small wrappers for each C function that can cause longjmp() to be called, and make sure no
C++ object is used in the wrapper itself.

like the following used in the png driver:

static bool safe_png_read_image(png_structp hPNG,
                                png_bytep *png_rows,
                                jmp_buf     sSetJmpContext)
{
    if( setjmp( sSetJmpContext ) != 0 )
        return false;
    png_read_image( hPNG, png_rows );
    return true;
}


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/5718d7c1/attachment.html>

From Jacob.Adams at cachecounty.org  Tue Nov 14 12:16:40 2017
From: Jacob.Adams at cachecounty.org (Jacob Adams)
Date: Tue, 14 Nov 2017 13:16:40 -0700
Subject: [gdal-dev] Impact of tile size on artifacts in JPEG-compressed Tiffs
Message-ID: <5A0AECB8020000AC00016C57@mail.cachecounty.org>

I'd like to check my understanding of the impact of the tile size on JPEG-compressed geotiffs. 

I've been getting dark bands 4 or 5 pixels wide on the bottom and right edges of the image when manually creating large image tiles from a collection of smaller tiles. I'm using the common aggressive compression settings for jpeg with a specified extent (in map units) as follows:
gdal_merge.py -ps .25 .25 -ul_lr 1528148 3773703 1529109 3772785 -co compress=jpeg -co interleave=pixel -co photometric=ycbcr -co tiled=yes -o <outfile> <infiles>

While subtle, they are distracting and are more visible when placed next to other imagery or when resampling. 

I've found two ways to get rid of them via trial and error: 
1) Don't use tiling.
2) Make sure your image size (in pixels) is a multiple of your tile size. 

I want to use tiling to speed up access time. If I adjust the extent to make the image size a multiple of some of the factors of the tile size, such as 128, 16, or 8 (for a default tile size of 256x256) the dark area is still there but shrinks to one or two pixels. This tells me it's not related to the MCU of the JPEG compression. 

Am I correct in saying that the image size should be a multiple of the tile size when using compress=jpeg and tiled=yes to avoid generating these darker bands on the bottom and right edges of the images?

Thanks,
Jake Adams
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/f325b52f/attachment.html>

From schwehr at gmail.com  Tue Nov 14 14:20:58 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 14 Nov 2017 14:20:58 -0800
Subject: [gdal-dev] Creating Cloud Optimized GeoTIFFs
In-Reply-To: <37364207.nlYVYg3d7h@even-i700>
References: <CACkcqcUzFPHeZHfO3-d2f6aL4xaxMbTTd6LCf2b+2g_0A=7H8w@mail.gmail.com>
 <37364207.nlYVYg3d7h@even-i700>
Message-ID: <CACmBxyt6jXDxqHsTddh7tgxzHPQ5UmGNXTx2Fkdr6ZJK1BtCsw@mail.gmail.com>

Hi Even,

I have some follow up questions on Cloud Optimized GeoTIFFs:

* Is there a preferred/better INTERLEAVE if there is more than one band?
* Is there a preferred tile blocksize?  You have 512 in your examples.  Are
there any major trade offs between using 128, 256, 512, or 1024 for x and y
block sizes?
* Should tiles be square?  Does it matter?
* Is it better to skip tiling for small images?  If so, at what threshold
do you think the switch should happen?  1024?
* Is DEFLATE preferred for compression type over LZW for lossless
compression?
* If the writer isn't constrained by compute power, are there preferred
ZLEVEL and PREDICTOR values?  Is there a time cost for decompressing
ZLEVEL=9 over 1?

I'm a little confused by this code from validate_cloud_optimized_geotiff.py:

    if main_band.XSize >= 512 or main_band.YSize >= 512:
        if check_tiled:
            block_size = main_band.GetBlockSize()
            if block_size[0] == main_band.XSize and block_size[0] > 1024:
                errors += ["The file is greater than 512xH or Wx512," +
                           "but is not tiled"]

Will the above correctly fail an image that is (say) 256x2048 if it is not
tiled?

Thanks!
-kurt

On Wed, May 10, 2017 at 1:53 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mercredi 10 mai 2017 14:41:44 CEST Peter Schmitt wrote:
>
> > Hi,
>
> >
>
> > I ran into something confusing when using gdal-2.2.0 to generate Cloud
>
> > Optimized GeoTIFFs following the instructions at:
>
> > https://trac.osgeo.org/gdal/wiki/CloudOptimizedGeoTIFF
>
> >
>
> > Here's what I did:
>
> >
>
> > 1. Fetch an image:
>
> > env CPL_VSIL_CURL_ALLOWED_EXTENSIONS=tif GDAL_DISABLE_READDIR_ON_OPEN=
> YES
>
> > VSI_CACHE=TRUE gdal_translate
>
> > https://github.com/mapbox/rasterio/raw/master/tests/data/RGB.byte.tif
>
> > rgb_byte_jpg.tif -co TILED=YES -co COMPRESS=JPEG -co PHOTOMETRIC=YCBCR
>
> >
>
> > Not a cloud-optimized GeoTIFF as expected:
>
> >
>
> > validate_cloud_optimized_geotiff.py rgb_byte_jpg.tif
>
> > rgb_byte_jpg.tif is NOT a valid cloud optimized GeoTIFF : The file should
>
> > have overviews
>
> >
>
> >
>
> > 2. Add internal overviews:
>
> > gdaladdo -r average rgb_byte_jpg.tif 2 4 8 16 32
>
> >
>
> > validate_cloud_optimized_geotiff.py rgb_byte_jpg.tif
>
> >
>
> > rgb_byte_jpg.tif is NOT a valid cloud optimized GeoTIFF : The offset of
> the
>
> > first block of overview of index 3 should be after the one of the
> overview
>
> > of index 4
>
> >
>
> >
>
> > 3. Translate the image again copying source overviews added above.
>
> >
>
> > gdal_translate rgb_byte_jpg.tif rgb_byte_jpg_trans.tif -co TILED=YES -co
>
> > COMPRESS=JPEG -co PHOTOMETRIC=YCBCR -co COPY_SRC_OVERVIEWS=YES
>
> >
>
> > Now the image _is_ cloud-optimized.
>
> >
>
> > validate_cloud_optimized_geotiff.py rgb_byte_jpg_trans.tif
>
> > rgb_byte_jpg_trans.tif is a valid cloud optimized GeoTIFF
>
> >
>
> >
>
> > I expected the image to be "cloud optimized" at step 2. Why do I need an
>
> > additional translate?
>
>
>
> Peter,
>
>
>
> Because gdaladdo will add the overview IFD at the end of the file, whereas
> in the definition of cloud optimized GeoTIFF, they must be all at the
> beginning of the file so as to be efficiently fetchable. And that can only
> be done with gdal_translate -co COPY_SRC_OVERVIEWS=YES
>
> To avoid quality loss you should only use JPEG compression for the final
> gdal_translate stage.
>
>
>
> Even
>
>
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171114/6be5c20b/attachment-0001.html>

From ari.jolma at gmail.com  Tue Nov 14 22:26:09 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 15 Nov 2017 08:26:09 +0200
Subject: [gdal-dev] WCS driver work
In-Reply-To: <792d51a2-b76f-1f8e-5e2f-73b65ff85607@gmail.com>
References: <792d51a2-b76f-1f8e-5e2f-73b65ff85607@gmail.com>
Message-ID: <3512b17a-126d-205e-6c90-40e382f22def@gmail.com>

Ari Jolma kirjoitti 14.11.2017 klo 17:41:
> I've got very close to being able to get valid data (visual comparison 
> in QGIS) from various server types and WCS versions.
>
> I've documented the results here: 
> https://trac.osgeo.org/gdal/wiki/WCS%2Binteroperability
>
> It seems that I need eight option flags to cover all cases. Mostly the 
> problems are with CRS that have inverted axis order. Also it seems to 
> be a problem if the server or the standard does not support requesting 
> directly tiles of specific size. It is especially a problem since GDAL 
> fails the call if the size is not expected.
>
> The only combination that I have not yet managed to get to work is 
> GeoServer with version 1.1 and inverted axis order. I can get a decent 
> response but the returned geotiff has slightly wrong size (59x38 
> instead of 60x38). The problematic call is below[1].

I was able to fix this by computing the pixel size a bit differently 
(kind of numeric problem again, since you want n pixels, the pixel size 
needs to be computed like you need n+0.5 pixels).

Ari

>
> Also, I have/know only a few servers and I lack some combinations; 
> I've also found a server with a combination that I've managed to test 
> ok, but whose behavior I can't yet explain[2].
>
> I'm writing documentation and test code but the latter will still take 
> some time to be ready for the trunk.
>
> The code is at https://github.com/ajolma/gdal/tree/trunk/gdal/frmts/wcs
>
> I've also made one ticket regarding port code 
> https://trac.osgeo.org/gdal/ticket/7141
>
> Ari
>
> [1] 
> https://msp.smartsea.fmi.fi/geoserver/wcs?SERVICE=WCS&VERSION=1.1.0&REQUEST=GetCoverage&IDENTIFIER=smartsea%3Aeusm2016-EPSG2393&FORMAT=image%2Ftiff&BOUNDINGBOX=6620001.14539506,3199988.18514013,6670001.21326246,3279980.29051582,urn:ogc:def:crs:EPSG::2393&RangeSubset=contents&GridBaseCRS=urn:ogc:def:crs:EPSG::2393&GridCS=urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS&GridType=urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs&GridOrigin=6670001.21326246,3199988.18514013&GridOffsets=0,1333.20175626157,-1315.79125966838,0
>
> [2] 
> https://lists.osgeo.org/pipermail/mapserver-users/2017-November/080339.html
>
>


From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov 14 23:09:54 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 15 Nov 2017 00:09:54 -0700 (MST)
Subject: [gdal-dev] Wiki page for WCS discussion and best practices
	created
In-Reply-To: <66c89d02-b7a8-2afe-8a8b-dba79a76b190@gmail.com>
References: <1510303493539.66002@maanmittauslaitos.fi>
 <bb565807-82ae-f338-7277-7501ad2dc53f@gmail.com>
 <1510580381748-0.post@n6.nabble.com>
 <66c89d02-b7a8-2afe-8a8b-dba79a76b190@gmail.com>
Message-ID: <1510729794667-0.post@n6.nabble.com>

Ari Jolma-2 wrote
> jratike80 kirjoitti 13.11.2017 klo 15:39:
> 
>> And I have
>>   
>> - Materialized my 6 pixel test image into a GeoTIFF image in EPSG:4326
>> and
>>
>> - Published it with GeoServer so I could capture the DescribeCoverage
>> document
> 
> The URL of the server?

I tend to use localhost :) Standard GeoServer 2.11 installation from the
zip, thus reproducible.

-Jukka-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From ari.jolma at gmail.com  Wed Nov 15 00:58:23 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 15 Nov 2017 10:58:23 +0200
Subject: [gdal-dev] Logics of CPLGetXMLValue and CPLFetchBool
Message-ID: <d3ccbf03-40ac-93b2-d97d-53b366fcbc13@gmail.com>

I thought it would be perhaps good to have CPLGetXMLBoolean since we 
have CPLFetchBool and many of the option values needed by the new WCS 
driver are boolean flags and the option values end up in the service 
XML. It would twist the brain a bit less if one could simply use 
CPLGetXMLBoolean.

The logic of CPLFetchBool is that it is true if a key exists but is not 
defined or if the value is not something considered untrue ('NO', etc). 
The logic of CPLGetXMLValue is that it returns the given default in the 
case the element/attribute is not found or if it is found but is empty, 
i.e., not defined.

Thus the return value of CPLGetXMLBoolean can't use CPLGetXMLValue if it 
follows the logic of CPLFetchBool. That is true is existence and no denial.

What say?

Ari



From even.rouault at spatialys.com  Wed Nov 15 03:40:32 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Nov 2017 12:40:32 +0100
Subject: [gdal-dev] Logics of CPLGetXMLValue and CPLFetchBool
In-Reply-To: <d3ccbf03-40ac-93b2-d97d-53b366fcbc13@gmail.com>
References: <d3ccbf03-40ac-93b2-d97d-53b366fcbc13@gmail.com>
Message-ID: <2854483.VsgTqnpGyM@even-i700>

On mercredi 15 novembre 2017 10:58:23 CET Ari Jolma wrote:
> I thought it would be perhaps good to have CPLGetXMLBoolean since we
> have CPLFetchBool and many of the option values needed by the new WCS
> driver are boolean flags and the option values end up in the service
> XML. It would twist the brain a bit less if one could simply use
> CPLGetXMLBoolean.
> 
> The logic of CPLFetchBool is that it is true if a key exists but is not
> defined or if the value is not something considered untrue ('NO', etc).
> The logic of CPLGetXMLValue is that it returns the given default in the
> case the element/attribute is not found or if it is found but is empty,
> i.e., not defined.
> 
> Thus the return value of CPLGetXMLBoolean can't use CPLGetXMLValue if it
> follows the logic of CPLFetchBool. That is true is existence and no denial.
> 

Why not
 CPLGetXMLBoolean(node) == CPLTestBool(CPLGetXMLValue(node,NULL,"NO")) ?


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/65a430d9/attachment.html>

From even.rouault at spatialys.com  Wed Nov 15 04:02:47 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Nov 2017 13:02:47 +0100
Subject: [gdal-dev] Creating Cloud Optimized GeoTIFFs
In-Reply-To: <CACmBxyt6jXDxqHsTddh7tgxzHPQ5UmGNXTx2Fkdr6ZJK1BtCsw@mail.gmail.com>
References: <CACkcqcUzFPHeZHfO3-d2f6aL4xaxMbTTd6LCf2b+2g_0A=7H8w@mail.gmail.com>
 <37364207.nlYVYg3d7h@even-i700>
 <CACmBxyt6jXDxqHsTddh7tgxzHPQ5UmGNXTx2Fkdr6ZJK1BtCsw@mail.gmail.com>
Message-ID: <3762097.fEcczomedL@even-i700>

On mardi 14 novembre 2017 14:20:58 CET Kurt Schwehr wrote:
> Hi Even,
> 
> I have some follow up questions on Cloud Optimized GeoTIFFs:

The main constraint of C.O.G is that all the IFD definitions are at the beginning of the file, to 
avoid seeking at various points in it. Other parameters are pretty much unspecified.

> 
> * Is there a preferred/better INTERLEAVE if there is more than one band?

Depends on access patterns. If as soon as you process one pixel you need to access the value 
for all bands, then INTERLEAVE=PIXEL is better, and it will result in smaller sizes of 
StripOffsets/TileOffsets and StripByteCount/TileByteCount arrays

> * Is there a preferred tile blocksize?  You have 512 in your examples.  Are
> there any major trade offs between using 128, 256, 512, or 1024 for x and y
> block sizes?

Too small blocksizes will result in larger ...Offsets and ...ByteCount arrays. 

> * Should tiles be square?  Does it matter?

No

> * Is it better to skip tiling for small images?  If so, at what threshold
> do you think the switch should happen?  1024?

I'm not sure if that has an importance. But it is not wise to have an image whose one 
dimension is larger than the corresponding block dimension (as blocks are not truncated)

> * Is DEFLATE preferred for compression type over LZW for lossless
> compression?

Unspecified. DEFLATE is more CPU intensive, but if network times are the limiting factor, it is 
worth as more eficient

> * If the writer isn't constrained by compute power, are there preferred
> ZLEVEL and PREDICTOR values?  Is there a time cost for decompressing
> ZLEVEL=9 over 1?

PREDICTOR has neglectable CPU inflence (just a add/diff on integer values), but will not 
always result in smaller file sizes. Depends on the dataset

If I trust https://github.com/inikep/lzbench , the time cost for decompression for Deflate/Zlib 
doesn't seem to vary much with ZLEVEL. So the higher the better.
I don't know for LZW.

> 
> I'm a little confused by this code from validate_cloud_optimized_geotiff.py:
> 
>     if main_band.XSize >= 512 or main_band.YSize >= 512:
>         if check_tiled:
>             block_size = main_band.GetBlockSize()
>             if block_size[0] == main_band.XSize and block_size[0] > 1024:
>                 errors += ["The file is greater than 512xH or Wx512," +
>                            "but is not tiled"]
> 
> Will the above correctly fail an image that is (say) 256x2048 if it is not
> tiled?

No, it will pass this test. Since in that case block_size[0] == xsize == 256.
But for such a narrow image, it should probably warn if it is not tiled, as the number of strips, 
if letting to default strip height, will be larger than really necessary.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/9af81de4/attachment-0001.html>

From ari.jolma at gmail.com  Wed Nov 15 05:51:28 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 15 Nov 2017 15:51:28 +0200
Subject: [gdal-dev] Logics of CPLGetXMLValue and CPLFetchBool
In-Reply-To: <2854483.VsgTqnpGyM@even-i700>
References: <d3ccbf03-40ac-93b2-d97d-53b366fcbc13@gmail.com>
 <2854483.VsgTqnpGyM@even-i700>
Message-ID: <eb0402e0-b3a5-a059-bcdd-ca73626b9215@gmail.com>

Even Rouault kirjoitti 15.11.2017 klo 13:40:

> On mercredi 15 novembre 2017 10:58:23 CET Ari Jolma wrote:
>
>
> >
>
> > Thus the return value of CPLGetXMLBoolean can't use CPLGetXMLValue if it
>
> > follows the logic of CPLFetchBool. That is true is existence and no 
> denial.
>
> >
>
> Why not
>
> CPLGetXMLBoolean(node) == CPLTestBool(CPLGetXMLValue(node,NULL,"NO")) ?
>

Ah, but I want to test with node *and* path. Node will be the top level 
node of the service XML.

Anyway, I think I need to start with

CSLFetchNameValueDef(poOpenInfo->papszOpenOptions

and based on that explicitly set the element value to "TRUE" if the 
option exists and is not false. Then I can rely on the value of the 
element being "TRUE" if it is set.

Ari


> -- 
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/5aa1c130/attachment.html>

From even.rouault at spatialys.com  Wed Nov 15 07:07:03 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Nov 2017 16:07:03 +0100
Subject: [gdal-dev] Motion: Adopt RFC 70: Guessing output format from output
	file name extension
Message-ID: <2513584.D9Il50F02D@even-i700>

Hi,

I move to adopt RFC 70: Guessing output format from output file name 
extension

    https://trac.osgeo.org/gdal/wiki/rfc70_output_format_guess

Starting with my +1,

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/e56c8109/attachment.html>

From even.rouault at spatialys.com  Wed Nov 15 07:24:02 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Nov 2017 16:24:02 +0100
Subject: [gdal-dev] Impact of tile size on artifacts in JPEG-compressed
	Tiffs
In-Reply-To: <5A0AECB8020000AC00016C57@mail.cachecounty.org>
References: <5A0AECB8020000AC00016C57@mail.cachecounty.org>
Message-ID: <1762761.o9ocfY1XSQ@even-i700>

On mardi 14 novembre 2017 13:16:40 CET Jacob Adams wrote:
> I'd like to check my understanding of the impact of the tile size on
> JPEG-compressed geotiffs.
> 
> I've been getting dark bands 4 or 5 pixels wide on the bottom and right
> edges of the image when manually creating large image tiles from a
> collection of smaller tiles. I'm using the common aggressive compression
> settings for jpeg with a specified extent (in map units) as follows:
> gdal_merge.py -ps .25 .25 -ul_lr 1528148 3773703 1529109 3772785 -co
> compress=jpeg -co interleave=pixel -co photometric=ycbcr -co tiled=yes -o
> <outfile> <infiles>
> 
> While subtle, they are distracting and are more visible when placed next to
> other imagery or when resampling.
> 
> I've found two ways to get rid of them via trial and error:
> 1) Don't use tiling.
> 2) Make sure your image size (in pixels) is a multiple of your tile size.
> 
> I want to use tiling to speed up access time. If I adjust the extent to make
> the image size a multiple of some of the factors of the tile size, such as
> 128, 16, or 8 (for a default tile size of 256x256) the dark area is still
> there but shrinks to one or two pixels. This tells me it's not related to
> the MCU of the JPEG compression.
> 
> Am I correct in saying that the image size should be a multiple of the tile
> size when using compress=jpeg and tiled=yes to avoid generating these
> darker bands on the bottom and right edges of the images?

I wouldn't expect that effect to be as strong as you observed, but indeed there are technical 
grounds for your findings. When a tile is partial, ie for the right most or bottom most tiles 
when tile size is not a multiple of the tile dimension, the TIFF format still impose that the 
invisible parts of the tile must be encoded. So we have to fill them with some value. 
Currently, for JPEG compression, we fill the invisible portions of the tile by replicating the 
values of the last column (or line). Perhaps with your data, given the JPEG compression 
characteristics, this causes artifacts. Wondering if mirroring (at least to fill a full MCU) 
wouldn't produce better results.
If you feel like experimenting hacking this, the play ground is at
https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L8175

I would have thought you shouldn't get artifacts if image_size % tile_size is a multiple of the 
MCU (16 in that instance since you use YCbCr), but apparently you still observed artifacts. 
Puzzling.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/48e5a49a/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov 15 08:03:07 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 15 Nov 2017 09:03:07 -0700 (MST)
Subject: [gdal-dev] Motion: Adopt RFC 70: Guessing output format from
 output file name extension
In-Reply-To: <2513584.D9Il50F02D@even-i700>
References: <2513584.D9Il50F02D@even-i700>
Message-ID: <1510761787788-0.post@n6.nabble.com>

Even Rouault-2 wrote
> Hi,
> 
> I move to adopt RFC 70: Guessing output format from output file name 
> extension
> 
>     https://trac.osgeo.org/gdal/wiki/rfc70_output_format_guess
> 
> Starting with my +1,

+1

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov 15 08:08:17 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 15 Nov 2017 09:08:17 -0700 (MST)
Subject: [gdal-dev] Impact of tile size on artifacts in JPEG-compressed
 Tiffs
In-Reply-To: <5A0AECB8020000AC00016C57@mail.cachecounty.org>
References: <5A0AECB8020000AC00016C57@mail.cachecounty.org>
Message-ID: <1510762097906-0.post@n6.nabble.com>

Jacob Adams wrote
> I'd like to check my understanding of the impact of the tile size on
> JPEG-compressed geotiffs. 
> 
> I've been getting dark bands 4 or 5 pixels wide on the bottom and right
> edges of the image when manually creating large image tiles from a
> collection of smaller tiles. I'm using the common aggressive compression
> settings for jpeg with a specified extent (in map units) as follows:
> gdal_merge.py -ps .25 .25 -ul_lr 1528148 3773703 1529109 3772785 -co
> compress=jpeg -co interleave=pixel -co photometric=ycbcr -co tiled=yes -o 
> <outfile>
>  
> <infiles>
> While subtle, they are distracting and are more visible when placed next
> to other imagery or when resampling. 
> 
> I've found two ways to get rid of them via trial and error: 
> 1) Don't use tiling.
> 2) Make sure your image size (in pixels) is a multiple of your tile size. 
> 
> I want to use tiling to speed up access time. If I adjust the extent to
> make the image size a multiple of some of the factors of the tile size,
> such as 128, 16, or 8 (for a default tile size of 256x256) the dark area
> is still there but shrinks to one or two pixels. This tells me it's not
> related to the MCU of the JPEG compression. 
> 
> Am I correct in saying that the image size should be a multiple of the
> tile size when using compress=jpeg and tiled=yes to avoid generating these
> darker bands on the bottom and right edges of the images?
> 
> Thanks,
> Jake Adams
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev

Hi,

I would also have a try by making first a virtual mosaic with gdalbuildvrt
and then running gdal_translate instead of using gdal_merge.py.

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Wed Nov 15 09:22:46 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Nov 2017 18:22:46 +0100
Subject: [gdal-dev] Command line utilities on Windows and Unicode characters
Message-ID: <3171244.seRan8BoEH@even-i700>

Hi,

Just to inform you that I've fixed recently in trunk a long standing issue with command line 
utilities on Windows with non-ascii characters.

Previously we used the standard main() entry point, which got the arguments in the 
current codepage (which was already a limitation in case you wanted to deal with 
characters not in the codepage) whereas the rest of GDAL expects UTF-8.

So now we use the wmain() entry point and recode fom UCS-2 to UTF-8

I'm not completely sure of all impacts, hence this warning.

Implemented per https://trac.osgeo.org/gdal/ticket/7065

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/e3dc8f1b/attachment.html>

From Jacob.Adams at cachecounty.org  Wed Nov 15 11:20:34 2017
From: Jacob.Adams at cachecounty.org (Jacob Adams)
Date: Wed, 15 Nov 2017 12:20:34 -0700
Subject: [gdal-dev] Impact of tile size on artifacts in
In-Reply-To: <mailman.16187.1510762099.21183.gdal-dev@lists.osgeo.org>
References: <mailman.16187.1510762099.21183.gdal-dev@lists.osgeo.org>
Message-ID: <5A0C3112020000AC00016C9A@mail.cachecounty.org>

> I wouldn't expect that effect to be as strong as you observed, but indeed there are technical 
> grounds for your findings. When a tile is partial, ie for the right most or bottom most tiles 
> when tile size is not a multiple of the tile dimension, the TIFF format still impose that the 
> invisible parts of the tile must be encoded. So we have to fill them with some value. 
> Currently, for JPEG compression, we fill the invisible portions of the tile by replicating the 
> values of the last column (or line). Perhaps with your data, given the JPEG compression 
> characteristics, this causes artifacts. Wondering if mirroring (at least to fill a full MCU) 
> wouldn't produce better results.
> If you feel like experimenting hacking this, the play ground is at
> https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L8175 

Thanks for the insights Even. I'll take a stab at hacking on it and post a ticket if I get anything worth sharing. The aerial imagery I'm working with covers a lot of farms with a large amount of light-brown field areas, where a long, grey line shows up more than it might inside a darker urban or forested area.

> I would also have a try by making first a virtual mosaic with gdalbuildvrt
> and then running gdal_translate instead of using gdal_merge.py.
> 
> -Jukka Rahkonen-

Thanks for the idea, I hadn't thought of that. I tried both this and gdalwarp too while I was at it but they seem to give the exact same output as the gdal_merge method. Based on these results and the code Even linked to, it looks like this is caused by the geotiff driver itself, not the method used to mosaic the files together. 

I think my best bet moving forward is to just modify the extent to be multiples of the tile size until I can play around with the code.

Jake Adams





From szekerest at gmail.com  Wed Nov 15 11:45:53 2017
From: szekerest at gmail.com (Tamas Szekeres)
Date: Wed, 15 Nov 2017 20:45:53 +0100
Subject: [gdal-dev] Motion: Adopt RFC 70: Guessing output format from
 output file name extension
In-Reply-To: <2513584.D9Il50F02D@even-i700>
References: <2513584.D9Il50F02D@even-i700>
Message-ID: <CACALY+RjKEC8C6oUGzuQ_qWTtjD6-iNs=1t_mUSTf4ggNUn8vw@mail.gmail.com>

+1

Best regards,

Tamas



2017-11-15 16:07 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:

> Hi,
>
>
>
> I move to adopt RFC 70: Guessing output format from output file name
> extension
>
>
>
> https://trac.osgeo.org/gdal/wiki/rfc70_output_format_guess
>
>
>
> Starting with my +1,
>
>
>
> Best regards,
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/2415e5db/attachment.html>

From dmorissette at mapgears.com  Wed Nov 15 11:51:55 2017
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Wed, 15 Nov 2017 14:51:55 -0500
Subject: [gdal-dev] Motion: Adopt RFC 70: Guessing output format from
 output file name extension
In-Reply-To: <2513584.D9Il50F02D@even-i700>
References: <2513584.D9Il50F02D@even-i700>
Message-ID: <7fc7a356-5088-8d97-75ce-7549627bb0e4@mapgears.com>

+1

Daniel


On 2017-11-15 10:07 AM, Even Rouault wrote:
> Hi,
> 
> I move to adopt RFC 70: Guessing output format from output file name 
> extension
> 
> https://trac.osgeo.org/gdal/wiki/rfc70_output_format_guess
> 
> Starting with my +1,
> 
> Best regards,
> 
> Even
> 
> -- 
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From ap.joseph at live.com  Wed Nov 15 12:55:06 2017
From: ap.joseph at live.com (Andrew Joseph)
Date: Wed, 15 Nov 2017 14:55:06 -0600
Subject: [gdal-dev] Enable --with-static-proj4 by default if ESRI FGDB
	option is given on Linux
Message-ID: <CAHDApB7JWn9-S5gtfWaPcvu8Q_c=Xh=xYqvkWREywt35=GNVaA@mail.gmail.com>

I ran into an issue a few days ago where an ogr_fdw foreign data wrapper in
postgis was throwing

[XX000] ERROR: AddToPROJ4SRSCache: could not parse proj4 string '+proj=lcc
+lat_1=31.88333333333333 +lat_2=30.11666666666667 +lat_0=29.66666666666667
+lon_0=-100.3333333333333 +x_0=699999.9998983998 +y_0=3000000 +datum=NAD83
+units=us-ft +no_defs ' unknown elliptical parameter name

See
http://postgis.17.x6.nabble.com/XX000-ERROR-AddToPROJ4SRSCache-could-not-parse-proj4-string-td5011978.html

I built Proj4 from source and removed all apt packages that depended on
proj4 and ensured that the relevant grids were installed. To my great
astonishment and misery, the issue still persisted, so I assumed it was a
bug in ogr_fdw gdal/postgis/gdal. After several days of  trying different
version combinations to try to determine which package was responsible, I
still received the same error. Finally, I recompiled GDAL without ESRI FGDB
support and to my amazement everything worked perfectly.  I thought to
myself, how could the FGDB library possibly affect proj4 when there is no
libproj.so that comes with it? Then I found this:

http://osgeo-org.1560.x6.nabble.com/gdal-dev-compiling-gdal-with-esri-file-gdb-td5311469.html

Apparently the ESRI FGDB library is packaged in a nonstandard way that
results in proj4 being embedded in the .so file -like a tapeworm -wreaking
silent havoc on all packages that depend on proj4.

To save others from this hellish debugging process, it might be worth
either checking for the FGDB libraries and throwing an error if GDAL is
configured without --wtih-static-proj4=location or setting that option by
default.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/755ea8ec/attachment.html>

From aperi2007 at gmail.com  Wed Nov 15 12:55:43 2017
From: aperi2007 at gmail.com (Andrea Peri)
Date: Wed, 15 Nov 2017 21:55:43 +0100
Subject: [gdal-dev] compile gdal using the libpng 1.6.26
In-Reply-To: <2007282.GiXDFN1Slx@even-i700>
References: <CABqTJk8+bvvkmLHzy6Nh4c69urLnv==hpsBm22ODy1srQoEepQ@mail.gmail.com>
 <2007282.GiXDFN1Slx@even-i700>
Message-ID: <CABqTJk_Sk4Qaqk6Sd3gZV6ZH+JNv1N75NYVLA599ayzGVova-w@mail.gmail.com>

Hi Even,

I have resolved with your hints.

Thx for help.

Andrea.


2017-11-13 12:23 GMT+01:00 Even Rouault <even.rouault at spatialys.com>:

> On lundi 13 novembre 2017 09:00:38 CET Andrea Peri wrote:
>
> > Hi,
>
> > I have a trouble with my qgis-server.
>
> >
>
> > I have a debian stretch version 64bit where the libpng is at 1.6.26
> version.
>
> >
>
> > When I compile the gdal from source, it use its internal 1.2.56 version
> and
>
> > all is ok.
>
> >
>
> > After, when I go to compile the qgis. Its cmake finding system found the
>
> > system libpng 1.6.26 and the qgis is compile using it.
>
> >
>
> > But after this, when try to use the qgis-server (wms server) and asking
> the
>
> > png images.
>
> > It go in error .
>
> > The log explain me that the
>
> > qgis is compiled using the libpng-1.6.26 but is running using the
>
> > lib-1.2.56 version (of gdal).
>
> >
>
> > I'm not able to say to qgis to compile using the libpng of gdal, so I
> like
>
> > to try to say at the gdal to compile not using its internal version, but
>
> > instead using the 1.6.26 from system.
>
>
>
> Andrea,
>
>
>
> Yes, you should definitely compile GDAL against system libpng if you plan
> to use it with other libs/apps that also link against system libpng.
> Normally the base ./configure of GDAL should fetch your system libpng
> (unless you explicitly specify --with-png=internal). I've just verified it
> on Stretch
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
-----------------
Andrea Peri
. . . . . . . . .
qwerty àèìòù
-----------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/8f776968/attachment.html>

From even.rouault at spatialys.com  Wed Nov 15 13:19:15 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Nov 2017 22:19:15 +0100
Subject: [gdal-dev] Enable --with-static-proj4 by default if ESRI FGDB
	option is given on Linux
In-Reply-To: <CAHDApB7JWn9-S5gtfWaPcvu8Q_c=Xh=xYqvkWREywt35=GNVaA@mail.gmail.com>
References: <CAHDApB7JWn9-S5gtfWaPcvu8Q_c=Xh=xYqvkWREywt35=GNVaA@mail.gmail.com>
Message-ID: <4973692.aiZlgiY0Z5@even-i700>

> To save others from this hellish debugging process, it might be worth
> either checking for the FGDB libraries and throwing an error if GDAL is
> configured without --wtih-static-proj4=location or setting that option by
> default.

./configure should already output a warning about that situation at the end:
https://trac.osgeo.org/gdal/changeset/37668
I've turned that as an error:
https://trac.osgeo.org/gdal/changeset/40724

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/b1071e72/attachment.html>

From chris.marsh at usask.ca  Wed Nov 15 14:20:12 2017
From: chris.marsh at usask.ca (Chris Marsh)
Date: Wed, 15 Nov 2017 16:20:12 -0600
Subject: [gdal-dev] Enable --with-static-proj4 by default if ESRI FGDB
 option is given on Linux
In-Reply-To: <4973692.aiZlgiY0Z5@even-i700>
References: <CAHDApB7JWn9-S5gtfWaPcvu8Q_c=Xh=xYqvkWREywt35=GNVaA@mail.gmail.com>
 <4973692.aiZlgiY0Z5@even-i700>
Message-ID: <CAFgDerH9E-WrerxyNaunddCQG9tx43XVimcxfUnKOCmq0oSeuw@mail.gmail.com>

As I have been unable to solve my strange proj4 related issues  as per
http://osgeo-org.1560.x6.nabble.com/Failed-to-initialize-PROJ-4-with-quot-quot-td5338323.html

I wonder if this is at all related to my issues and why changing proj4
versions makes no difference....
Is --without-fgdb the correct way to disable this feature so I can test?

Cheers
Chris


On 15 November 2017 at 15:19, Even Rouault <even.rouault at spatialys.com>
wrote:

>
>
> > To save others from this hellish debugging process, it might be worth
>
> > either checking for the FGDB libraries and throwing an error if GDAL is
>
> > configured without --wtih-static-proj4=location or setting that option by
>
> > default.
>
>
>
> ./configure should already output a warning about that situation at the
> end:
>
> https://trac.osgeo.org/gdal/changeset/37668
>
> I've turned that as an error:
>
> https://trac.osgeo.org/gdal/changeset/40724
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/b2bbb36e/attachment-0001.html>

From ap.joseph at live.com  Wed Nov 15 14:52:01 2017
From: ap.joseph at live.com (Andrew Joseph)
Date: Wed, 15 Nov 2017 16:52:01 -0600
Subject: [gdal-dev] Enable --with-static-proj4 by default if ESRI FGDB
 option is given on Linux
In-Reply-To: <CAFgDerH9E-WrerxyNaunddCQG9tx43XVimcxfUnKOCmq0oSeuw@mail.gmail.com>
References: <CAHDApB7JWn9-S5gtfWaPcvu8Q_c=Xh=xYqvkWREywt35=GNVaA@mail.gmail.com>
 <4973692.aiZlgiY0Z5@even-i700>
 <CAFgDerH9E-WrerxyNaunddCQG9tx43XVimcxfUnKOCmq0oSeuw@mail.gmail.com>
Message-ID: <CAHDApB4RH=VmjuqNiik5mhBjiwrx6pmTrCWu3wBqsqqye-innA@mail.gmail.com>

> I've turned that as an error:

Thanks, much appreciated -that will probably save at least 10 people from
sitting at a coffee shop at 3am, recompiling anxiously for the 100th time,
pulling out what is left of their hair, subsisting on stale pizza and
wondering why they chose a career in programming!
I suppose in the future, I should pay more attention to the configure
output when debugging rather than proceeding directly to make && make
install -one of the downsides of utilizing new features with docker
automated builds.

> I wonder if this is at all related to my issues and why changing proj4
versions makes no difference....
> Is --without-fgdb the correct way to disable this feature so I can test?

Chris,

It would only be related if you installed the ESRI Filegeodatabase driver
located here https://github.com/Esri/file-geodatabase-api -NOT the built in
OpenFileGDB driver. I installed this using the following commands:
FGDB_DIR=FileGDB_API-64gcc51
FGDB_DOWNLOAD=FileGDB_API_1_5_1-64gcc51.tar.gz
cd /tmp
wget -q -O /tmp/${FGDB_DOWNLOAD}
https://github.com/Esri/file-geodatabase-api/raw/master/FileGDB_API_1.5.1/${FGDB_DOWNLOAD}
tar -C /tmp -xzf /tmp/${FGDB_DOWNLOAD}
cd /tmp/${FGDB_DIR}
cp lib/* /usr/local/lib
cp include/* /usr/local/include
ldconfig

If you installed similarly, --without-fgdb wouldn't fix the issue since the
proj4 culprit lib is still present and will still malevolently conflict. On
my Ubuntu 16.04 setup, this actually failed only when ogr_fdw (a postgis
extension that uses gdal) was utilized -not on GDAL itself.
Using --with-static-proj4=<PATH(usually either /usr or /usr/local)> when
configuring GDAL fixed the issue for me.

If you want to ensure you have proj4 installed properly, they provide a
convenient Dockerfile that shows all necessary instructions here
https://github.com/OSGeo/proj.4/blob/master/Dockerfile

On Wed, Nov 15, 2017 at 4:20 PM, Chris Marsh <chris.marsh at usask.ca> wrote:

> As I have been unable to solve my strange proj4 related issues  as per
> http://osgeo-org.1560.x6.nabble.com/Failed-to-initialize-PROJ-4-with-quot-
> quot-td5338323.html
> <https://nam01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fosgeo-org.1560.x6.nabble.com%2FFailed-to-initialize-PROJ-4-with-quot-quot-td5338323.html&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=eQ7ooxEyUi8VKau1g1PoH0j5bMv5RJbCHYjG09EhzPo%3D&reserved=0>
>
> I wonder if this is at all related to my issues and why changing proj4
> versions makes no difference....
> Is --without-fgdb the correct way to disable this feature so I can test?
>
> Cheers
> Chris
>
>
> On 15 November 2017 at 15:19, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>>
>>
>> > To save others from this hellish debugging process, it might be worth
>>
>> > either checking for the FGDB libraries and throwing an error if GDAL is
>>
>> > configured without --wtih-static-proj4=location or setting that option
>> by
>>
>> > default.
>>
>>
>>
>> ./configure should already output a warning about that situation at the
>> end:
>>
>> https://trac.osgeo.org/gdal/changeset/37668
>> <https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Ftrac.osgeo.org%2Fgdal%2Fchangeset%2F37668&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=%2ByXDabdw%2Bq6Bi6aj5igcX34jjt%2BMQZqPbGwT9aSN1tA%3D&reserved=0>
>>
>> I've turned that as an error:
>>
>> https://trac.osgeo.org/gdal/changeset/40724
>> <https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Ftrac.osgeo.org%2Fgdal%2Fchangeset%2F40724&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=D6LRzrOENG1QvtvjZbv1HVCcDmCftKjubMOyTUZHb3A%3D&reserved=0>
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>> <https://nam01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=cfWFzwWzROa9AkRDD9r3DkLW4kHno%2BbhYzIpeB%2FTLJk%3D&reserved=0>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> <https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=ixqckFmzRKh2jFZ2YcfytIc0sTIWm%2FcZSmZvAomt9M0%3D&reserved=0>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171115/635d8742/attachment.html>

From ari.jolma at gmail.com  Wed Nov 15 22:01:25 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 16 Nov 2017 08:01:25 +0200
Subject: [gdal-dev] Logics of CPLGetXMLValue and CPLFetchBool
In-Reply-To: <eb0402e0-b3a5-a059-bcdd-ca73626b9215@gmail.com>
References: <d3ccbf03-40ac-93b2-d97d-53b366fcbc13@gmail.com>
 <2854483.VsgTqnpGyM@even-i700>
 <eb0402e0-b3a5-a059-bcdd-ca73626b9215@gmail.com>
Message-ID: <2a2708c4-fc61-0dbc-584d-7af358253f7f@gmail.com>

Ari Jolma kirjoitti 15.11.2017 klo 15:51:
>
> Even Rouault kirjoitti 15.11.2017 klo 13:40:
>
>> On mercredi 15 novembre 2017 10:58:23 CET Ari Jolma wrote:
>>
>>
>> >
>>
>> > Thus the return value of CPLGetXMLBoolean can't use CPLGetXMLValue 
>> if it
>>
>> > follows the logic of CPLFetchBool. That is true is existence and no 
>> denial.
>>
>> >
>>
>> Why not
>>
>> CPLGetXMLBoolean(node) == CPLTestBool(CPLGetXMLValue(node,NULL,"NO")) ?
>>
>
> Ah, but I want to test with node *and* path. Node will be the top 
> level node of the service XML.
>
> Anyway, I think I need to start with
>
> CSLFetchNameValueDef(poOpenInfo->papszOpenOptions
>
> and based on that explicitly set the element value to "TRUE" if the 
> option exists and is not false. Then I can rely on the value of the 
> element being "TRUE" if it is set.

I think the best approach is

CPLGetXMLBoolean(node, path) ==

node = CPLGetXMLNode(node, path);
if node == NULL return FALSE;
value = CPLGetXMLValue(node, NULL, "");
if value == "" return TRUE;
return CPLTestBool(value);

This should return TRUE if the node exists and does not contain 
something that is considered untrue in GDAL, which is consistent with 
how CPLFetchBool() behaves.

Ari


>
> Ari
>
>
>> -- 
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171116/0c57ca83/attachment.html>

From ari.jolma at gmail.com  Thu Nov 16 11:50:17 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 16 Nov 2017 21:50:17 +0200
Subject: [gdal-dev] The new WCS driver
Message-ID: <67c1abba-72aa-0fe4-ddf9-6f18378ac88c@gmail.com>

I'm happy to suggest that

https://github.com/ajolma/gdal/tree/trunk/gdal/frmts/wcs

would be accepted into the GDAL trunk, thus to be included into the 
coming version 2.3.

I'm not making a PL since the GDAL at github is not a primary source. 
There is a python test program in the above directory (it should be 
moved to autotest eventually but it's now there for easier access).

There are a couple of things that I've done:

1) Introduced "WCS:<URL>" syntax for the driver.

2) Introduced a cache for various XML files (GDA WCS service file, GDAL 
metadata files, server responses).

3) Split the driver into a base class and version specific subclasses.

I have tested the driver with four real servers (ArcGIS, GeoServer, 
MapServer, and Rasdaman) and it can work with all of them in all 
versions they support. I have checked the responses (scaled and in CRS 
with inverted axis order (except ArcGIS)) in QGIS and they are ok - not 
always identical with each other but close enough. There is 
documentation and test code - Perl code to run gdal_translate calls to 
real servers and Python code to run tests against the responses obtained).

However, I assume there to be many small things in the code to 
review/change. I find the typical GDAL code often difficult to read and 
especially write. So I have written the code in a way that's easier for 
me to work with. I think there could be more strict rules for writing 
the code, and an automatic code checker (linter) would be useful. 
Besides things that a linter would check, I find it useful to write and 
debug shorter functions (max a screenful), while GDAL functions tend to 
be long, which often make them hard for me to understand and follow. 
Some issues specific to this work:

- I ended up writing quite many utility functions. Some may reinvent 
some wheels.

- The initial call to the server returns a dataset with subdatasets but 
without bands. It may be that opening a subdataset returns a dataset 
without bands (there are more than 2 dimensions). Then the additional 
subdataset metadata is added to the SUBDATASETS metadata domain.

- The idea is that the service file in the cache is maintained through 
options, which is used to change values in the file. The current set of 
options is expected to grow.

- I have not tested the more exotic features of the driver - especially 
mapping the time dimension to bands etc. I hope I have not broken what 
worked before. This is an area where more work is needed.

- The code compiles and the tests run ok in a new Linux machine.

Ari



From chris.marsh at usask.ca  Thu Nov 16 12:03:38 2017
From: chris.marsh at usask.ca (Chris Marsh)
Date: Thu, 16 Nov 2017 14:03:38 -0600
Subject: [gdal-dev] Enable --with-static-proj4 by default if ESRI FGDB
 option is given on Linux
In-Reply-To: <CAHDApB4RH=VmjuqNiik5mhBjiwrx6pmTrCWu3wBqsqqye-innA@mail.gmail.com>
References: <CAHDApB7JWn9-S5gtfWaPcvu8Q_c=Xh=xYqvkWREywt35=GNVaA@mail.gmail.com>
 <4973692.aiZlgiY0Z5@even-i700>
 <CAFgDerH9E-WrerxyNaunddCQG9tx43XVimcxfUnKOCmq0oSeuw@mail.gmail.com>
 <CAHDApB4RH=VmjuqNiik5mhBjiwrx6pmTrCWu3wBqsqqye-innA@mail.gmail.com>
Message-ID: <CAFgDerFzwCSSSgoqULtGDSdmKg6-c=wPpgLYJqTKmd68U+fRyQ@mail.gmail.com>

Hi Andrew,

Ah damn. Thanks for the info.
Cheers
Chris



On 15 November 2017 at 16:52, Andrew Joseph <ap.joseph at live.com> wrote:

> > I've turned that as an error:
>
> Thanks, much appreciated -that will probably save at least 10 people from
> sitting at a coffee shop at 3am, recompiling anxiously for the 100th time,
> pulling out what is left of their hair, subsisting on stale pizza and
> wondering why they chose a career in programming!
> I suppose in the future, I should pay more attention to the configure
> output when debugging rather than proceeding directly to make && make
> install -one of the downsides of utilizing new features with docker
> automated builds.
>
> > I wonder if this is at all related to my issues and why changing proj4
> versions makes no difference....
> > Is --without-fgdb the correct way to disable this feature so I can test?
>
> Chris,
>
> It would only be related if you installed the ESRI Filegeodatabase driver
> located here https://github.com/Esri/file-geodatabase-api -NOT the built
> in OpenFileGDB driver. I installed this using the following commands:
> FGDB_DIR=FileGDB_API-64gcc51
> FGDB_DOWNLOAD=FileGDB_API_1_5_1-64gcc51.tar.gz
> cd /tmp
> wget -q -O /tmp/${FGDB_DOWNLOAD} https://github.com/Esri/file-
> geodatabase-api/raw/master/FileGDB_API_1.5.1/${FGDB_DOWNLOAD}
> tar -C /tmp -xzf /tmp/${FGDB_DOWNLOAD}
> cd /tmp/${FGDB_DIR}
> cp lib/* /usr/local/lib
> cp include/* /usr/local/include
> ldconfig
>
> If you installed similarly, --without-fgdb wouldn't fix the issue since
> the proj4 culprit lib is still present and will still malevolently
> conflict. On my Ubuntu 16.04 setup, this actually failed only when ogr_fdw
> (a postgis extension that uses gdal) was utilized -not on GDAL itself.
> Using --with-static-proj4=<PATH(usually either /usr or /usr/local)> when
> configuring GDAL fixed the issue for me.
>
> If you want to ensure you have proj4 installed properly, they provide a
> convenient Dockerfile that shows all necessary instructions here
> https://github.com/OSGeo/proj.4/blob/master/Dockerfile
>
> On Wed, Nov 15, 2017 at 4:20 PM, Chris Marsh <chris.marsh at usask.ca> wrote:
>
>> As I have been unable to solve my strange proj4 related issues  as per
>> http://osgeo-org.1560.x6.nabble.com/Failed-to-initialize-
>> PROJ-4-with-quot-quot-td5338323.html
>> <https://nam01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fosgeo-org.1560.x6.nabble.com%2FFailed-to-initialize-PROJ-4-with-quot-quot-td5338323.html&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=eQ7ooxEyUi8VKau1g1PoH0j5bMv5RJbCHYjG09EhzPo%3D&reserved=0>
>>
>> I wonder if this is at all related to my issues and why changing proj4
>> versions makes no difference....
>> Is --without-fgdb the correct way to disable this feature so I can test?
>>
>> Cheers
>> Chris
>>
>>
>> On 15 November 2017 at 15:19, Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>>
>>>
>>> > To save others from this hellish debugging process, it might be worth
>>>
>>> > either checking for the FGDB libraries and throwing an error if GDAL is
>>>
>>> > configured without --wtih-static-proj4=location or setting that option
>>> by
>>>
>>> > default.
>>>
>>>
>>>
>>> ./configure should already output a warning about that situation at the
>>> end:
>>>
>>> https://trac.osgeo.org/gdal/changeset/37668
>>> <https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Ftrac.osgeo.org%2Fgdal%2Fchangeset%2F37668&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=%2ByXDabdw%2Bq6Bi6aj5igcX34jjt%2BMQZqPbGwT9aSN1tA%3D&reserved=0>
>>>
>>> I've turned that as an error:
>>>
>>> https://trac.osgeo.org/gdal/changeset/40724
>>> <https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Ftrac.osgeo.org%2Fgdal%2Fchangeset%2F40724&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=D6LRzrOENG1QvtvjZbv1HVCcDmCftKjubMOyTUZHb3A%3D&reserved=0>
>>>
>>>
>>>
>>> --
>>>
>>> Spatialys - Geospatial professional services
>>>
>>> http://www.spatialys.com
>>> <https://nam01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=cfWFzwWzROa9AkRDD9r3DkLW4kHno%2BbhYzIpeB%2FTLJk%3D&reserved=0>
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>> <https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=02%7C01%7Cap.joseph%40live.com%7C9f986c0f58864e9a2b8208d52c772391%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636463812560164450&sdata=ixqckFmzRKh2jFZ2YcfytIc0sTIWm%2FcZSmZvAomt9M0%3D&reserved=0>
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171116/49af5dfa/attachment.html>

From even.rouault at spatialys.com  Thu Nov 16 12:07:47 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 16 Nov 2017 21:07:47 +0100
Subject: [gdal-dev] The new WCS driver
In-Reply-To: <67c1abba-72aa-0fe4-ddf9-6f18378ac88c@gmail.com>
References: <67c1abba-72aa-0fe4-ddf9-6f18378ac88c@gmail.com>
Message-ID: <3239271.7SpdZ4XIdp@even-i700>

Hi Ari,

> https://github.com/ajolma/gdal/tree/trunk/gdal/frmts/wcs
> 
> would be accepted into the GDAL trunk, thus to be included into the
> coming version 2.3.
> 
> I'm not making a PL since the GDAL at github is not a primary source.

Well, a lot of people already do pull requests. That's rather convenient to pre-test changes 
and running Travis-CI & AppVeyor on them. And also to enable other people to add review 
comments (I tried directly on your tree, but apparently I need to identify which commit has 
introduced which line to be able to comment, whereas with a pull request I believe you can 
comment on whatever changed lined)

If you work in a github tree like you did, you can even trigger Travis-CI & AppVeyor, before 
doing any pull request, by logging into them with your GH credentials and enabling your 
repo.

> There is a python test program in the above directory (it should be
> moved to autotest eventually but it's now there for easier access).
> 
> There are a couple of things that I've done:
> 
> 1) Introduced "WCS:<URL>" syntax for the driver.
> 
> 2) Introduced a cache for various XML files (GDA WCS service file, GDAL
> metadata files, server responses).
> 
> 3) Split the driver into a base class and version specific subclasses.
> 
> I have tested the driver with four real servers (ArcGIS, GeoServer,
> MapServer, and Rasdaman) and it can work with all of them in all
> versions they support. I have checked the responses (scaled and in CRS
> with inverted axis order (except ArcGIS)) in QGIS and they are ok - not
> always identical with each other but close enough. There is
> documentation and test code - Perl code to run gdal_translate calls to
> real servers and Python code to run tests against the responses obtained).
> 
> However, I assume there to be many small things in the code to
> review/change. I find the typical GDAL code often difficult to read and
> especially write. So I have written the code in a way that's easier for
> me to work with. I think there could be more strict rules for writing
> the code, and an automatic code checker (linter) would be useful.

We have already various "linting" tools that run: cppcheck, clang static analyzer, coverity scan 
and a few ad-hoc scripts in scripts/ . But indeed we don't enforce things like maximum size of 
a function, etc.

> Besides things that a linter would check, I find it useful to write and
> debug shorter functions (max a screenful), while GDAL functions tend to
> be long, which often make them hard for me to understand and follow.
> Some issues specific to this work:
> 
> - I ended up writing quite many utility functions. Some may reinvent
> some wheels.
> 
> - The initial call to the server returns a dataset with subdatasets but
> without bands. It may be that opening a subdataset returns a dataset
> without bands (there are more than 2 dimensions). Then the additional
> subdataset metadata is added to the SUBDATASETS metadata domain.
> 
> - The idea is that the service file in the cache is maintained through
> options, which is used to change values in the file. The current set of
> options is expected to grow.
> 
> - I have not tested the more exotic features of the driver - especially
> mapping the time dimension to bands etc. I hope I have not broken what
> worked before. This is an area where more work is needed.
> 
> - The code compiles and the tests run ok in a new Linux machine.
> 
> Ari
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171116/acc6b1ef/attachment-0001.html>

From neteler at osgeo.org  Thu Nov 16 13:16:30 2017
From: neteler at osgeo.org (Markus Neteler)
Date: Thu, 16 Nov 2017 22:16:30 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <8780fbd3-af94-c284-732f-7198df568d54@gatewaygeomatics.com>
References: <1680715.4lzt5iEthT@even-i700>
 <8780fbd3-af94-c284-732f-7198df568d54@gatewaygeomatics.com>
Message-ID: <CALFmHhuUAQWSguMQ=DGiG3vd4vbGWXpi7W-GSKSs98i=r-Y9rQ@mail.gmail.com>

On Wed, Nov 1, 2017 at 7:26 PM, Jeff McKenna
<jmckenna at gatewaygeomatics.com> wrote:
> On 2017-11-01 7:32 AM, Even Rouault wrote:
>> I've add an exchange with Sebastiaan Couwenberg about a schedule that
>> would give GDAL 2.2.3 a chance to enter the next Ubuntu LTS 18.04. While the
>> date for the import freeze from Debian to Ubuntu is not know yet, based on
>> the last release cycle, it seems that a GDAL 2.2.3 released this month would
>> have a chance to make it (given other delays in Debian transitionning from
>> experimental to unstable)
>>
>> So I intend cutting a GDAL 2.2.3 release candidate for Nov 20th.
>>
>> Please raise tickets if there are bug fixes that need to be backported and
>> haven't yet been.
>>
>> Even
>>
>
> Hi Even,
>
> Also, it is rarely ever discussed but I find that releases occurring near
> the timing of other projects in the family can be helpful for all (users,
> packagers, developers): MapServer release will be around the week of the
> 15th also, so a Nov 20th GDAL release would be great.  This can't always
> happen, but when it does it is sure nice.  -jeff

Hi,

interestingly we are going to publish GRASS GIS 7.4.0 RC1 also in these days!

Best,
Markus

-- 
Markus Neteler, PhD
http://www.mundialis.de - free data with free software
http://grass.osgeo.org
http://courses.neteler.org/blog

From ari.jolma at gmail.com  Fri Nov 17 00:27:34 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 17 Nov 2017 10:27:34 +0200
Subject: [gdal-dev] The new WCS driver
In-Reply-To: <3239271.7SpdZ4XIdp@even-i700>
References: <67c1abba-72aa-0fe4-ddf9-6f18378ac88c@gmail.com>
 <3239271.7SpdZ4XIdp@even-i700>
Message-ID: <adfd3cc8-6240-a1fd-771e-4726147d70ea@gmail.com>

Even Rouault kirjoitti 16.11.2017 klo 22:07:
>
> We have already various "linting" tools that run: cppcheck, clang 
> static analyzer, coverity scan and a few ad-hoc scripts in scripts/ . 
> But indeed we don't enforce things like maximum size of a function, etc.
>

clang looks interesting. I installed it but it seems that it needs 
various things. I see clang-format in scripts but that's not very 
helpful as such. Is there an easy howto get started somewhere? I'd like 
to run something like "clang-tidy *.cpp" in the directory where I do things.

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171117/d043d447/attachment.html>

From even.rouault at spatialys.com  Fri Nov 17 00:40:01 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 17 Nov 2017 09:40:01 +0100
Subject: [gdal-dev] The new WCS driver
In-Reply-To: <adfd3cc8-6240-a1fd-771e-4726147d70ea@gmail.com>
References: <67c1abba-72aa-0fe4-ddf9-6f18378ac88c@gmail.com>
 <3239271.7SpdZ4XIdp@even-i700>
 <adfd3cc8-6240-a1fd-771e-4726147d70ea@gmail.com>
Message-ID: <9330611.XFMntH5gRA@even-i700>

On vendredi 17 novembre 2017 10:27:34 CET Ari Jolma wrote:
> Even Rouault kirjoitti 16.11.2017 klo 22:07:
> > We have already various "linting" tools that run: cppcheck, clang
> > static analyzer, coverity scan and a few ad-hoc scripts in scripts/ .
> > But indeed we don't enforce things like maximum size of a function, etc.
> 
> clang looks interesting. I installed it but it seems that it needs
> various things. I see clang-format in scripts but that's not very
> helpful as such. Is there an easy howto get started somewhere? I'd like
> to run something like "clang-tidy *.cpp" in the directory where I do things.

Code formatting has been discussed in:
https://trac.osgeo.org/gdal/wiki/rfc69_cplusplus_formatting

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171117/77b5bf60/attachment.html>

From sebastic at xs4all.nl  Fri Nov 17 00:58:45 2017
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Fri, 17 Nov 2017 09:58:45 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <CALFmHhuUAQWSguMQ=DGiG3vd4vbGWXpi7W-GSKSs98i=r-Y9rQ@mail.gmail.com>
References: <1680715.4lzt5iEthT@even-i700>
 <8780fbd3-af94-c284-732f-7198df568d54@gatewaygeomatics.com>
 <CALFmHhuUAQWSguMQ=DGiG3vd4vbGWXpi7W-GSKSs98i=r-Y9rQ@mail.gmail.com>
Message-ID: <8681b22e-f4b7-ebea-4df3-045079484df6@xs4all.nl>

On 11/16/2017 10:16 PM, Markus Neteler wrote:
> On Wed, Nov 1, 2017 at 7:26 PM, Jeff McKenna
> <jmckenna at gatewaygeomatics.com> wrote:
>> On 2017-11-01 7:32 AM, Even Rouault wrote:
>>> I've add an exchange with Sebastiaan Couwenberg about a schedule that
>>> would give GDAL 2.2.3 a chance to enter the next Ubuntu LTS 18.04. While the
>>> date for the import freeze from Debian to Ubuntu is not know yet, based on
>>> the last release cycle, it seems that a GDAL 2.2.3 released this month would
>>> have a chance to make it (given other delays in Debian transitionning from
>>> experimental to unstable)
>>>
>>> So I intend cutting a GDAL 2.2.3 release candidate for Nov 20th.
>>>
>>> Please raise tickets if there are bug fixes that need to be backported and
>>> haven't yet been.
>>>
>>> Even
>>>
>>
>> Hi Even,
>>
>> Also, it is rarely ever discussed but I find that releases occurring near
>> the timing of other projects in the family can be helpful for all (users,
>> packagers, developers): MapServer release will be around the week of the
>> 15th also, so a Nov 20th GDAL release would be great.  This can't always
>> happen, but when it does it is sure nice.  -jeff
> 
> Hi,
> 
> interestingly we are going to publish GRASS GIS 7.4.0 RC1 also in these days!

Has the gdal-grass plugin been updated to support 7.4? Or are there no
new libraries that need to be linked like last time? [0]

[0] https://trac.osgeo.org/gdal/ticket/6785

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From landa.martin at gmail.com  Fri Nov 17 02:58:21 2017
From: landa.martin at gmail.com (Martin Landa)
Date: Fri, 17 Nov 2017 11:58:21 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <8681b22e-f4b7-ebea-4df3-045079484df6@xs4all.nl>
References: <1680715.4lzt5iEthT@even-i700>
 <8780fbd3-af94-c284-732f-7198df568d54@gatewaygeomatics.com>
 <CALFmHhuUAQWSguMQ=DGiG3vd4vbGWXpi7W-GSKSs98i=r-Y9rQ@mail.gmail.com>
 <8681b22e-f4b7-ebea-4df3-045079484df6@xs4all.nl>
Message-ID: <CA+Ei1OdBBhQp284_u0SLwL+k8kFsmGXzVdNijc+fU_uDW7MCzQ@mail.gmail.com>

Hi,

2017-11-17 9:58 GMT+01:00 Sebastiaan Couwenberg <sebastic at xs4all.nl>:
> Has the gdal-grass plugin been updated to support 7.4? Or are there no
> new libraries that need to be linked like last time? [0]
>
> [0] https://trac.osgeo.org/gdal/ticket/6785

I tried to compile plugin against GRASS 7.4, no problem appeared. Ma

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From sebastic at xs4all.nl  Fri Nov 17 02:59:00 2017
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Fri, 17 Nov 2017 11:59:00 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <CA+Ei1OdBBhQp284_u0SLwL+k8kFsmGXzVdNijc+fU_uDW7MCzQ@mail.gmail.com>
References: <1680715.4lzt5iEthT@even-i700>
 <8780fbd3-af94-c284-732f-7198df568d54@gatewaygeomatics.com>
 <CALFmHhuUAQWSguMQ=DGiG3vd4vbGWXpi7W-GSKSs98i=r-Y9rQ@mail.gmail.com>
 <8681b22e-f4b7-ebea-4df3-045079484df6@xs4all.nl>
 <CA+Ei1OdBBhQp284_u0SLwL+k8kFsmGXzVdNijc+fU_uDW7MCzQ@mail.gmail.com>
Message-ID: <eb3163d6-91d8-d319-b35a-5150ceef1ef0@xs4all.nl>

On 11/17/2017 11:58 AM, Martin Landa wrote:
> Hi,
> 
> 2017-11-17 9:58 GMT+01:00 Sebastiaan Couwenberg <sebastic at xs4all.nl>:
>> Has the gdal-grass plugin been updated to support 7.4? Or are there no
>> new libraries that need to be linked like last time? [0]
>>
>> [0] https://trac.osgeo.org/gdal/ticket/6785
> 
> I tried to compile plugin against GRASS 7.4, no problem appeared. Ma

Compiling wasn't the issue last time, it only showed at runtime.

I just packaged GRASS 7.4.0-RC1, and there are no new libraries like
last time, so that won't be an issue.

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From louis-philippe.rousseaulambert2 at canada.ca  Fri Nov 17 12:05:52 2017
From: louis-philippe.rousseaulambert2 at canada.ca (Rousseau Lambert2, Louis-Philippe (EC))
Date: Fri, 17 Nov 2017 20:05:52 +0000
Subject: [gdal-dev] Merge many raster using maximum value where overlaps
References: <ab1851ed173440bbbdabda3970b54ce2@PELEPCDEXC006.birch.int.bell.ca>
Message-ID: <mailman.11.1510949159.21180.gdal-dev@lists.osgeo.org>

Hi everyone,

I would like to have your opinion on some processing I have to do. 

So I have to merge many rasters (eventually more then 50). Some overlaps
(never completely), but others don't, my files when merged cover Canada.
I have to keep the maximum value where there is some overlap between
different files.

My first try was to use gdal_calc with --calc="maximum(A,B)", but it can
only input 26 files at a time. And The output of gdal_calc is only the
region of overlap, in my case I have to keep the whole extent of my
rasters, not only the region of overlap... Is there a way I could use
gdal_calc and keep everything, not only the overlap?

My second try was to use gdalwarp with a vrt of all my files as input
and use -r max for my resampling. My results were that it only
overlapped my geotiff and did not took the maximum value.

My last try, was to use gdalwarp to ensure that all my files have the
same extent and that pixel overlap perfectly. Then I create a mosaic
using gdal_merge of all my rasters. At this point I don't manage yet the
maximum value. Then I loop trough all my geotiff using gdal_calc to
output the overlap region between one geotiff and my mosaic. then I can
merge the overlap region with my mosaic. Finally I get a mosaic of the
maximum value where my raster overlap.

I don't really like this solution because if I have 50 files, I have to
use gdal_calc 50 times and merge the result 50 times... That seems a lot
of processing to simply get the maximum value in a mosaic.

Can you think of a better way to do? Any thoughts or opinions are welcome!

Louis-Philippe R. Lambert


From neteler at osgeo.org  Sat Nov 18 08:01:00 2017
From: neteler at osgeo.org (Markus Neteler)
Date: Sat, 18 Nov 2017 17:01:00 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <eb3163d6-91d8-d319-b35a-5150ceef1ef0@xs4all.nl>
References: <1680715.4lzt5iEthT@even-i700>
 <8780fbd3-af94-c284-732f-7198df568d54@gatewaygeomatics.com>
 <CALFmHhuUAQWSguMQ=DGiG3vd4vbGWXpi7W-GSKSs98i=r-Y9rQ@mail.gmail.com>
 <8681b22e-f4b7-ebea-4df3-045079484df6@xs4all.nl>
 <CA+Ei1OdBBhQp284_u0SLwL+k8kFsmGXzVdNijc+fU_uDW7MCzQ@mail.gmail.com>
 <eb3163d6-91d8-d319-b35a-5150ceef1ef0@xs4all.nl>
Message-ID: <CALFmHhss=b9oCnud05VWaphBLMQh536f31qzrRedvN06gL0obg@mail.gmail.com>

Hi Even,

On Fri, Nov 17, 2017 at 11:59 AM, Sebastiaan Couwenberg
<sebastic at xs4all.nl> wrote:
> On 11/17/2017 11:58 AM, Martin Landa wrote:
>> Hi,
>>
>> 2017-11-17 9:58 GMT+01:00 Sebastiaan Couwenberg <sebastic at xs4all.nl>:
>>> Has the gdal-grass plugin been updated to support 7.4? Or are there no
>>> new libraries that need to be linked like last time? [0]
>>>
>>> [0] https://trac.osgeo.org/gdal/ticket/6785
>>
>> I tried to compile plugin against GRASS 7.4, no problem appeared. Ma
>
> Compiling wasn't the issue last time, it only showed at runtime.

Configuration works also here but I didn't try yet to run it.

@Even: would it be possible to extract the "gdal-grass" as a separate tarball?
The existing one is too old:

http://download.osgeo.org/gdal/gdal-grass-1.11.2.tar.gz    06-Feb-2015
07:37     49K

thanks
Markus

From even.rouault at spatialys.com  Sat Nov 18 08:06:48 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 18 Nov 2017 17:06:48 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <CALFmHhss=b9oCnud05VWaphBLMQh536f31qzrRedvN06gL0obg@mail.gmail.com>
References: <1680715.4lzt5iEthT@even-i700>
 <eb3163d6-91d8-d319-b35a-5150ceef1ef0@xs4all.nl>
 <CALFmHhss=b9oCnud05VWaphBLMQh536f31qzrRedvN06gL0obg@mail.gmail.com>
Message-ID: <2372413.s8AhdctkMk@even-i700>

Markus,

> @Even: would it be possible to extract the "gdal-grass" as a separate
> tarball? The existing one is too old:
> 
> http://download.osgeo.org/gdal/gdal-grass-1.11.2.tar.gz    06-Feb-2015
> 07:37     49K

We should probably create an "old_releases" subdirectory and put everything in the top 
directory in it.

The most recent one is in:

http://download.osgeo.org/gdal/2.2.0/gdal-grass-2.2.0.tar.gz

But that's true it is not in
http://download.osgeo.org/gdal/2.2.2/
We should probably put in every point release, even if unchanged.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171118/c51afaf7/attachment.html>

From neteler at osgeo.org  Sat Nov 18 08:28:46 2017
From: neteler at osgeo.org (Markus Neteler)
Date: Sat, 18 Nov 2017 17:28:46 +0100
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <2372413.s8AhdctkMk@even-i700>
References: <1680715.4lzt5iEthT@even-i700>
 <eb3163d6-91d8-d319-b35a-5150ceef1ef0@xs4all.nl>
 <CALFmHhss=b9oCnud05VWaphBLMQh536f31qzrRedvN06gL0obg@mail.gmail.com>
 <2372413.s8AhdctkMk@even-i700>
Message-ID: <CALFmHhuvLW-EKxQN=HYiEVGhQ60pwp3zgTBWLHRAf0EJVHeONA@mail.gmail.com>

Even,

On Sat, Nov 18, 2017 at 5:06 PM, Even Rouault
<even.rouault at spatialys.com> wrote:
> Markus,
>
>
>
>> @Even: would it be possible to extract the "gdal-grass" as a separate
>
>> tarball? The existing one is too old:
>
>>
>
>> http://download.osgeo.org/gdal/gdal-grass-1.11.2.tar.gz 06-Feb-2015
>
>> 07:37 49K
>
>
>
> We should probably create an "old_releases" subdirectory and put everything
> in the top directory in it.

... there is already:
http://download.osgeo.org/gdal/gdal-grass-old/

> The most recent one is in:
>
> http://download.osgeo.org/gdal/2.2.0/gdal-grass-2.2.0.tar.gz

ah, I missed that it is alongside the releases.

>
> But that's true it is not in
>
> http://download.osgeo.org/gdal/2.2.2/
>
> We should probably put in every point release, even if unchanged.

Yes, thanks. Otherwise hard to fine... (the file is tiny anyway).

Markus

From gcpp.kalxas at gmail.com  Sat Nov 18 08:31:22 2017
From: gcpp.kalxas at gmail.com (Angelos Tzotsos)
Date: Sat, 18 Nov 2017 18:31:22 +0200
Subject: [gdal-dev] GDAL 2.2.3 planning
In-Reply-To: <2372413.s8AhdctkMk@even-i700>
References: <1680715.4lzt5iEthT@even-i700>
 <eb3163d6-91d8-d319-b35a-5150ceef1ef0@xs4all.nl>
 <CALFmHhss=b9oCnud05VWaphBLMQh536f31qzrRedvN06gL0obg@mail.gmail.com>
 <2372413.s8AhdctkMk@even-i700>
Message-ID: <5d947c5d-8bb3-e70e-c1ee-f2a4439af336@gmail.com>

The tar ball is automatically extracted from Debian git:

http://http.debian.net/debian/pool/main/libg/libgdal-grass/libgdal-grass_2.2.2.orig.tar.gz

Best,
Angelos

On 11/18/2017 06:06 PM, Even Rouault wrote:
> Markus,
>
>> @Even: would it be possible to extract the "gdal-grass" as a separate
>> tarball? The existing one is too old:
>>
>> http://download.osgeo.org/gdal/gdal-grass-1.11.2.tar.gz    06-Feb-2015
>> 07:37     49K
> We should probably create an "old_releases" subdirectory and put everything in the top
> directory in it.
>
> The most recent one is in:
>
> http://download.osgeo.org/gdal/2.2.0/gdal-grass-2.2.0.tar.gz
>
> But that's true it is not in
> http://download.osgeo.org/gdal/2.2.2/
> We should probably put in every point release, even if unchanged.
>
> Even
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Angelos Tzotsos, PhD
Charter Member
Open Source Geospatial Foundation
http://users.ntua.gr/tzotsos

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171118/eb69f311/attachment.html>

From even.rouault at spatialys.com  Mon Nov 20 03:03:25 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 Nov 2017 12:03:25 +0100
Subject: [gdal-dev] Motion: promote GDAL 2.2.3 RC1 for release
Message-ID: <9533995.N4EQC2AYju@even-i700>

Hi,

(Combining both RC availability announcement and motion for vote)

I have prepared a GDAL/OGR 2.2.3 release candidate.

Peek up an archive among the following ones (by ascending size):

  http://download.osgeo.org/gdal/2.2.3/gdal-2.2.3RC1.tar.xz
  http://download.osgeo.org/gdal/2.2.3/gdal-2.2.3RC1.tar.gz
  http://download.osgeo.org/gdal/2.2.3/gdal223RC1.zip

A snapshot of the GDAL GRASS plugin is also available (unchanged since 2.2.0)

  http://download.osgeo.org/gdal/2.2.3/gdal-grass-2.2.3RC1.tar.gz

A snapshot of the gdalautotest suite is also available :

  http://download.osgeo.org/gdal/2.2.3/gdalautotest-2.2.3RC1.tar.gz
  http://download.osgeo.org/gdal/2.2.3/gdalautotest-2.2.3RC1.zip

The NEWS file is here :

  http://trac.osgeo.org/gdal/wiki/Release/2.2.3-News

~~~~~

Motion: promote GDAL 2.2.3 RC1 for release

Starting with my +1

~~~~~

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/610256c3/attachment.html>

From even.rouault at spatialys.com  Mon Nov 20 03:05:12 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 Nov 2017 12:05:12 +0100
Subject: [gdal-dev] Motion: Adopt RFC 70: Guessing output format from
	output file name extension
In-Reply-To: <2513584.D9Il50F02D@even-i700>
References: <2513584.D9Il50F02D@even-i700>
Message-ID: <1600613.iMegxs5l1Z@even-i700>

On mercredi 15 novembre 2017 16:07:03 CET Even Rouault wrote:
> Hi,
> 
> I move to adopt RFC 70: Guessing output format from output file name
> extension
> 
>     https://trac.osgeo.org/gdal/wiki/rfc70_output_format_guess
> 
> Starting with my +1,

I declare this motion passed with +1 from JukkaR, TamasS, DanielM and myself.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/0fa2f479/attachment.html>

From nik at nikosalexandris.net  Mon Nov 20 06:48:20 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Mon, 20 Nov 2017 15:48:20 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <3018023.1N5UhNMUuu@even-i700>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <3018023.1N5UhNMUuu@even-i700>
Message-ID: <20171120144820.hbq3mziqrkep2q35@mail.nikosalexandris.net>

* Even Rouault <even.rouault at spatialys.com> [2017-11-07 22:37:02 +0100]:

>> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?
>
>Yes, but within the limits ot the shapefile, and particularly .dbf format: limitation to 254
>characters for field values, 10 characters for field names... which are easily violated by
>OSM extracts.
>
>Spatialite, GeoPackage, PostGIS etc. would be better choices as output format
>
>>
>> 3. What is the way to split "other_tags" in multiple new fields *when*
>> knowing exactly which tags are contained and should be obtained?
>
>Edit osmconf.ini to add in the attributes= settings the tag names you're interested in.
>
>Even

Dear List,

in a custom .ini file, under the [points] layer, an `attributes=`
instruction set of values that includes `natural,cave_entrance` (key and
value under OSM's Natural key), well extracts for the points layer some
existing nodes which bear the tag `natural:cave_entrance`.

It is not required, as far as I understand the documentation, to include both
the parent key and any values (under it) of interest. Perhaps it may be
practical to have the attributes of interest split in a separate column.

The command I tested, for example, is:

```
ogr2ogr --config OSM_CONFIG_FILE custom.ini -f SQLite -dsco SPATIALITE=YES -gt 65536 -progress output.sqlite source.osm
```

While this is sufficient for the work I am doing (I can filter
`cave_entrance`s out from the `natural` column in the `output.sqlite` file), I
wonder why the entries for some nodes correctly bear the string
`cave_entrance` in the `natural` column, yet the `cave_entrance` column
itself is empty for the same entries.

Thank you for any hints, Nikos
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/c702302b/attachment.sig>

From even.rouault at spatialys.com  Mon Nov 20 06:59:51 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 Nov 2017 15:59:51 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <20171120144820.hbq3mziqrkep2q35@mail.nikosalexandris.net>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <3018023.1N5UhNMUuu@even-i700>
 <20171120144820.hbq3mziqrkep2q35@mail.nikosalexandris.net>
Message-ID: <1607187.EOHbA5ROJG@even-i700>

On lundi 20 novembre 2017 15:48:20 CET Nikos Alexandris wrote:
> * Even Rouault <even.rouault at spatialys.com> [2017-11-07 22:37:02 +0100]:
> >> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?
> >
> >Yes, but within the limits ot the shapefile, and particularly .dbf format:
> >limitation to 254 characters for field values, 10 characters for field
> >names... which are easily violated by OSM extracts.
> >
> >Spatialite, GeoPackage, PostGIS etc. would be better choices as output
> >format>
> >> 3. What is the way to split "other_tags" in multiple new fields *when*
> >> knowing exactly which tags are contained and should be obtained?
> >
> >Edit osmconf.ini to add in the attributes= settings the tag names you're
> >interested in.
> >
> >Even
> 
> Dear List,
> 
> in a custom .ini file, under the [points] layer, an `attributes=`
> instruction set of values that includes `natural,cave_entrance` (key and
> value under OSM's Natural key), well extracts for the points layer some
> existing nodes which bear the tag `natural:cave_entrance`.
> 
> It is not required, as far as I understand the documentation, to include
> both the parent key and any values (under it) of interest. Perhaps it may
> be practical to have the attributes of interest split in a separate column.
> 
> The command I tested, for example, is:
> 
> ```
> ogr2ogr --config OSM_CONFIG_FILE custom.ini -f SQLite -dsco SPATIALITE=YES
> -gt 65536 -progress output.sqlite source.osm ```
> 
> While this is sufficient for the work I am doing (I can filter
> `cave_entrance`s out from the `natural` column in the `output.sqlite` file),
> I wonder why the entries for some nodes correctly bear the string
> `cave_entrance` in the `natural` column, yet the `cave_entrance` column
> itself is empty for the same entries.

The attributes keyword in osmconf.ini will select OSM tags whose *key* is one of the item 
specified in attributes.
If you want to filter by value, you may add a -where or -sql clause  with something like 
"natural = 'cave_entrance'"

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/eefeb040/attachment-0001.html>

From f.b.antoci at gmail.com  Mon Nov 20 07:57:57 2017
From: f.b.antoci at gmail.com (Fabio Antoci)
Date: Mon, 20 Nov 2017 15:57:57 +0000
Subject: [gdal-dev] gdal library compiled for .NET CORE / UWP (Universal
	Windows Platform)
Message-ID: <CAKMrR946JqzPYVcJwaTU1+i0paDNrCxebS9MHoKnCCy-vVEVAg@mail.gmail.com>

Hi,

I'm trying to develop an application for UWP with gdal library.
I tried to compile the library to my own but I had a lot of errors due to
the .NET_CORE

e.g. *HandleRef* are not supported as the *ApplicationException....*

Did anyone already compile the GDAL for UWP or have some experiences doing
that?

Thanks,

Best regards

Fabio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/9f9c0996/attachment.html>

From gfrancis.dev at gmail.com  Mon Nov 20 09:38:27 2017
From: gfrancis.dev at gmail.com (Gareth Francis)
Date: Mon, 20 Nov 2017 17:38:27 +0000
Subject: [gdal-dev] gdal library compiled for .NET CORE / UWP (Universal
 Windows Platform)
In-Reply-To: <CAKMrR946JqzPYVcJwaTU1+i0paDNrCxebS9MHoKnCCy-vVEVAg@mail.gmail.com>
References: <CAKMrR946JqzPYVcJwaTU1+i0paDNrCxebS9MHoKnCCy-vVEVAg@mail.gmail.com>
Message-ID: <CAEKysgQTDsFu7oYZSM0UZtYLNnAkwus4vS549F_Y7k=eVGFm1g@mail.gmail.com>

I haven't used .net core but this should contain the relevant information:
https://github.com/swig/swig/issues/820

SWIG uses HandleRef to marshal pointers into .Net. Looks like the latest
version of .Net core includes these types?

If you can't use a verison of .Net with these types the GDAL SWIG wrappers
would need rework to use a different type for pointers (Unless they already
have this option, haven't used them personally)

On 20 November 2017 at 15:57, Fabio Antoci <f.b.antoci at gmail.com> wrote:

> Hi,
>
> I'm trying to develop an application for UWP with gdal library.
> I tried to compile the library to my own but I had a lot of errors due to
> the .NET_CORE
>
> e.g. *HandleRef* are not supported as the *ApplicationException....*
>
> Did anyone already compile the GDAL for UWP or have some experiences doing
> that?
>
> Thanks,
>
> Best regards
>
> Fabio
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--------------------
Gareth Francis
www.gfrancisdev.co.uk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/5b54bd1b/attachment.html>

From jmckenna at gatewaygeomatics.com  Mon Nov 20 10:30:57 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Mon, 20 Nov 2017 14:30:57 -0400
Subject: [gdal-dev] Motion: promote GDAL 2.2.3 RC1 for release
In-Reply-To: <9533995.N4EQC2AYju@even-i700>
References: <9533995.N4EQC2AYju@even-i700>
Message-ID: <54e26f70-7d17-520f-e2c2-0fcf816dba55@gatewaygeomatics.com>

On 2017-11-20 7:03 AM, Even Rouault wrote:
> 
> ~~~~~
> 
> Motion: promote GDAL 2.2.3 RC1 for release
> 
> Starting with my +1
> 
> ~~~~~
> 


+1  Works well here on Windows.

-jeff





-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/







From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 20 13:05:56 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 20 Nov 2017 14:05:56 -0700 (MST)
Subject: [gdal-dev] Motion: promote GDAL 2.2.3 RC1 for release
In-Reply-To: <9533995.N4EQC2AYju@even-i700>
References: <9533995.N4EQC2AYju@even-i700>
Message-ID: <1511211956239-0.post@n6.nabble.com>

Even Rouault-2 wrote
> Motion: promote GDAL 2.2.3 RC1 for release
> 
> Starting with my +1
> 
> ~~~~~
> 
> Best regards,
> 
> Even

+1 

-Jukka Rahkonen-




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From nicolas.cadieux at archeotec.ca  Mon Nov 20 13:48:49 2017
From: nicolas.cadieux at archeotec.ca (Nicolas Cadieux)
Date: Mon, 20 Nov 2017 16:48:49 -0500
Subject: [gdal-dev] Merge many raster using maximum value where overlaps
In-Reply-To: <20171117200559.80F566146636@lists.osgeo.org>
References: <ab1851ed173440bbbdabda3970b54ce2@PELEPCDEXC006.birch.int.bell.ca>
 <20171117200559.80F566146636@lists.osgeo.org>
Message-ID: <C8B63132-E8D3-4EFA-A880-6AF8E0473ADD@archeotec.ca>

Hi,

You may be able to do that with the Saga grid mosaic.  You can select ´max’ for overlapping areas.  

http://www.saga-gis.org/saga_tool_doc/2.3.0/grid_tools_3.html

 Nicolas

> Le 17 nov. 2017 à 15:05, Rousseau Lambert2, Louis-Philippe (EC) <louis-philippe.rousseaulambert2 at canada.ca> a écrit :
> 
> Hi everyone,
> 
> I would like to have your opinion on some processing I have to do. 
> 
> So I have to merge many rasters (eventually more then 50). Some overlaps
> (never completely), but others don't, my files when merged cover Canada.
> I have to keep the maximum value where there is some overlap between
> different files.
> 
> My first try was to use gdal_calc with --calc="maximum(A,B)", but it can
> only input 26 files at a time. And The output of gdal_calc is only the
> region of overlap, in my case I have to keep the whole extent of my
> rasters, not only the region of overlap... Is there a way I could use
> gdal_calc and keep everything, not only the overlap?
> 
> My second try was to use gdalwarp with a vrt of all my files as input
> and use -r max for my resampling. My results were that it only
> overlapped my geotiff and did not took the maximum value.
> 
> My last try, was to use gdalwarp to ensure that all my files have the
> same extent and that pixel overlap perfectly. Then I create a mosaic
> using gdal_merge of all my rasters. At this point I don't manage yet the
> maximum value. Then I loop trough all my geotiff using gdal_calc to
> output the overlap region between one geotiff and my mosaic. then I can
> merge the overlap region with my mosaic. Finally I get a mosaic of the
> maximum value where my raster overlap.
> 
> I don't really like this solution because if I have 50 files, I have to
> use gdal_calc 50 times and merge the result 50 times... That seems a lot
> of processing to simply get the maximum value in a mosaic.
> 
> Can you think of a better way to do? Any thoughts or opinions are welcome!
> 
> Louis-Philippe R. Lambert
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/592d1b7c/attachment.html>

From dshean at gmail.com  Mon Nov 20 16:07:36 2017
From: dshean at gmail.com (David Shean)
Date: Mon, 20 Nov 2017 16:07:36 -0800
Subject: [gdal-dev] Merge many raster using maximum value where overlaps
In-Reply-To: <C8B63132-E8D3-4EFA-A880-6AF8E0473ADD@archeotec.ca>
References: <ab1851ed173440bbbdabda3970b54ce2@PELEPCDEXC006.birch.int.bell.ca>
 <20171117200559.80F566146636@lists.osgeo.org>
 <C8B63132-E8D3-4EFA-A880-6AF8E0473ADD@archeotec.ca>
Message-ID: <3D0D72A5-C33F-408C-8B47-29A0CBD997FA@gmail.com>

Hi all,
This is also possible with the dem_mosaic tool, part of the NASA Ames Stereo Pipeline toolkit.  The utility is multithreaded and meant to handle an arbitrary number of large rasters efficiently.  You want the ‘—max’ command line option.

Unfortunately, the official NASA ASP site is currently down, but you can download precompiled binaries for Linux and OS X here: https://github.com/NeoGeographyToolkit/StereoPipeline/releases.  See the asp_book.pdf for documentation and usage on dem_mosaic.

Hope that helps.
-David


> On Nov 20, 2017, at 1:48 PM, Nicolas Cadieux <nicolas.cadieux at archeotec.ca> wrote:
> 
> Hi,
> 
> You may be able to do that with the Saga grid mosaic.  You can select ´max’ for overlapping areas.  
> 
> http://www.saga-gis.org/saga_tool_doc/2.3.0/grid_tools_3.html <http://www.saga-gis.org/saga_tool_doc/2.3.0/grid_tools_3.html>
> 
>  Nicolas
> 
> Le 17 nov. 2017 à 15:05, Rousseau Lambert2, Louis-Philippe (EC) <louis-philippe.rousseaulambert2 at canada.ca <mailto:louis-philippe.rousseaulambert2 at canada.ca>> a écrit :
> 
>> Hi everyone,
>> 
>> I would like to have your opinion on some processing I have to do. 
>> 
>> So I have to merge many rasters (eventually more then 50). Some overlaps
>> (never completely), but others don't, my files when merged cover Canada.
>> I have to keep the maximum value where there is some overlap between
>> different files.
>> 
>> My first try was to use gdal_calc with --calc="maximum(A,B)", but it can
>> only input 26 files at a time. And The output of gdal_calc is only the
>> region of overlap, in my case I have to keep the whole extent of my
>> rasters, not only the region of overlap... Is there a way I could use
>> gdal_calc and keep everything, not only the overlap?
>> 
>> My second try was to use gdalwarp with a vrt of all my files as input
>> and use -r max for my resampling. My results were that it only
>> overlapped my geotiff and did not took the maximum value.
>> 
>> My last try, was to use gdalwarp to ensure that all my files have the
>> same extent and that pixel overlap perfectly. Then I create a mosaic
>> using gdal_merge of all my rasters. At this point I don't manage yet the
>> maximum value. Then I loop trough all my geotiff using gdal_calc to
>> output the overlap region between one geotiff and my mosaic. then I can
>> merge the overlap region with my mosaic. Finally I get a mosaic of the
>> maximum value where my raster overlap.
>> 
>> I don't really like this solution because if I have 50 files, I have to
>> use gdal_calc 50 times and merge the result 50 times... That seems a lot
>> of processing to simply get the maximum value in a mosaic.
>> 
>> Can you think of a better way to do? Any thoughts or opinions are welcome!
>> 
>> Louis-Philippe R. Lambert
>> 
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev>_______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171120/73ad99ac/attachment.html>

From nik at nikosalexandris.net  Tue Nov 21 00:52:41 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Tue, 21 Nov 2017 09:52:41 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <1607187.EOHbA5ROJG@even-i700>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <3018023.1N5UhNMUuu@even-i700>
 <20171120144820.hbq3mziqrkep2q35@mail.nikosalexandris.net>
 <1607187.EOHbA5ROJG@even-i700>
Message-ID: <20171121085240.jy5w6syxeemws6px@mail.nikosalexandris.net>

* Even Rouault <even.rouault at spatialys.com> [2017-11-20 15:59:51 +0100]:

>On lundi 20 novembre 2017 15:48:20 CET Nikos Alexandris wrote:
>> * Even Rouault <even.rouault at spatialys.com> [2017-11-07 22:37:02 +0100]:
>> >> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?
>> >
>> >Yes, but within the limits ot the shapefile, and particularly .dbf format:
>> >limitation to 254 characters for field values, 10 characters for field
>> >names... which are easily violated by OSM extracts.
>> >
>> >Spatialite, GeoPackage, PostGIS etc. would be better choices as output
>> >format>
>> >> 3. What is the way to split "other_tags" in multiple new fields *when*
>> >> knowing exactly which tags are contained and should be obtained?
>> >
>> >Edit osmconf.ini to add in the attributes= settings the tag names you're
>> >interested in.
>> >
>> >Even
>>
>> Dear List,
>>
>> in a custom .ini file, under the [points] layer, an `attributes=`
>> instruction set of values that includes `natural,cave_entrance` (key and
>> value under OSM's Natural key), well extracts for the points layer some
>> existing nodes which bear the tag `natural:cave_entrance`.
>>
>> It is not required, as far as I understand the documentation, to include
>> both the parent key and any values (under it) of interest. Perhaps it may
>> be practical to have the attributes of interest split in a separate column.
>>
>> The command I tested, for example, is:
>>
>> ```
>> ogr2ogr --config OSM_CONFIG_FILE custom.ini -f SQLite -dsco SPATIALITE=YES
>> -gt 65536 -progress output.sqlite source.osm ```
>>
>> While this is sufficient for the work I am doing (I can filter
>> `cave_entrance`s out from the `natural` column in the `output.sqlite` file),
>> I wonder why the entries for some nodes correctly bear the string
>> `cave_entrance` in the `natural` column, yet the `cave_entrance` column
>> itself is empty for the same entries.
>
>The attributes keyword in osmconf.ini will select OSM tags whose *key* is one of the item
>specified in attributes.
>If you want to filter by value, you may add a -where or -sql clause  with something like
>"natural = 'cave_entrance'"
>
>Even

Merci Even.

How does the driver handle the "too many tags in node/relation" errors?
Throw them away?

Nikos

>-- 
>Spatialys - Geospatial professional services
>http://www.spatialys.com

-- 
Nikos Alexandris | Remote Sensing & Geomatics
GPG Key Fingerprint 6F9D4506F3CA28380974D31A9053534B693C4FB3 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/5243ee0a/attachment.sig>

From kassies at gmail.com  Tue Nov 21 01:23:00 2017
From: kassies at gmail.com (Rutger)
Date: Tue, 21 Nov 2017 02:23:00 -0700 (MST)
Subject: [gdal-dev] Merge many raster using maximum value where overlaps
In-Reply-To: <3D0D72A5-C33F-408C-8B47-29A0CBD997FA@gmail.com>
References: <20171117200559.A181A6146652@lists.osgeo.org>
 <C8B63132-E8D3-4EFA-A880-6AF8E0473ADD@archeotec.ca>
 <3D0D72A5-C33F-408C-8B47-29A0CBD997FA@gmail.com>
Message-ID: <1511256180934-0.post@n6.nabble.com>

You could also consider using the VRT pixel functions (since 2.2). I'm not
sure about the performance when using the Python pixel functions (or perhaps
with Numba), i haven't done any benchmarks. It might be a 'nice to have' if
some statistics like max,min,std are added to the default functions if that
will be a lot faster. I'm not sure how much effort that would take, but
given that mul, diff etc are already there perhaps its really easy.

You can make a normal VRT mosaic with gdalbuildvrt, and then add the pixel
function to it yourself. The part you should add looks something like:



More information can be found at:
http://www.gdal.org/gdal_vrttut.html#gdal_vrttut_derived_python


Regards,
Rutger



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From nik at nikosalexandris.net  Tue Nov 21 01:25:42 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Tue, 21 Nov 2017 10:25:42 +0100
Subject: [gdal-dev] Vertical datum conversion for SRTM data
Message-ID: <20171121092542.g65hr7odn4ykbmzd@mail.nikosalexandris.net>

Dear list, can GDAL handle the following exercise?

Of interest is the Mean Sea Level, based on NASA’s SRTM. I am new in this
topic. Is the following equation correct?

SRTM(MSL) = SRTM(WGS84) - MSL(WGS84) [*]


Is it “correct” to recommend the https://hydrosheds.cr.usgs.gov/ data
set for Mean Sea Level related studies? I refer specifically to i) 5.1
Void-filled digital elevation model  and ii) 5.2 Hydrologically conditioned
elevation [**]


Thank you, Nikos
--


Basic (notes to self)

- Types of vertical datums: tidal, gravimetric, geodetic
- Obviously, if source is seal level -> tidal, if geoid -> gravimetric, if ellipsoid -> geodetic
- MSL is a (type of a) vertical datum


From SRTM(EGM96) to SRTM(MHHW)

The report <http://sealevel.climatecentral.org/uploads/research/Global-Mapping-Choices-Report.pdf>
describes the conversion of NASA’s SRTM, referenced to the EGM96 geoid, to
refer to the local mean higher-high water (MHHW) tidal datum, say SRTM(MHHW).

The conversion involves:

1. get MSL tidal, resolution. 2-arc-minute [0]

2. get MHHW(MSL), res. 2-arc-minute [1]

3. upsample MSL(TP) and MHHW(MSL) (based on NN) to SRTM's res. 3-arc-second [2]

4. geo-reference SRTM(EGM96) & MSL(TP) to WGS84; outputs: SRTM(WGS84) & MSL(WGS84) [3]

5. convert from "tidal" to "geodetic": MHHW(WGS84) = MHHW(MSL) + MSL(WGS84) | [4]

6. SRTM(MHHW) = SRTM(WGS84) - MHHW(WGS84) [5]


Details

[*] Equation re-built based on the steps described here

[**] chrome-extension://oemmndcbldboiebfnladdacbdfmadadm/https://hydrosheds.cr.usgs.gov/webappcontent/HydroSHEDS_TechDoc_v10.pdf

[0] begin with the global 2-arc-minute mean sea surface MSS_CNES_CLS_11
(Aviso 2014) based on 16 years of satellite altimetry observations
(1993-2009), referenced to the Topex-Poseidon ellipsoid, and here called
MSL(TP) (MSL for mean sea level);

[1] Employ a global MHHW grid, MHHW(MSL), referenced to the MSL tidal datum, provided by Mark Merrifield
of the University of Hawaii, and developed using the model TPXO8 at 2-arcminute resolution (Egbert et. al,
2002)

[2] Upsample these grids to 3-arc-second SRTM resolution and georeference using nearest-neighbor
interpolation

[3] Convert both SRTM(EGM96) and MSL(TP) to reference the WGS84 ellipsoid

[4] Convert MHHW grid to reference WGS84 through the operation: MHHW(WGS84) = MSL(WGS84) + MHHW(MSL)

[5] Convert SRTM to MHHW reference through the operation, SRTM(MHHW) =
SRTM(WGS84) - MHHW(WGS84)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/fc9210fb/attachment.sig>

From kassies at gmail.com  Tue Nov 21 01:34:41 2017
From: kassies at gmail.com (Rutger)
Date: Tue, 21 Nov 2017 02:34:41 -0700 (MST)
Subject: [gdal-dev] Merge many raster using maximum value where overlaps
In-Reply-To: <1511256180934-0.post@n6.nabble.com>
References: <20171117200559.A181A6146652@lists.osgeo.org>
 <C8B63132-E8D3-4EFA-A880-6AF8E0473ADD@archeotec.ca>
 <3D0D72A5-C33F-408C-8B47-29A0CBD997FA@gmail.com>
 <1511256180934-0.post@n6.nabble.com>
Message-ID: <1511256881339-0.post@n6.nabble.com>

Sorry, i had the code embedded as raw text. It appears to be left out of my
previous post, even though it worked in the preview.

Here it is:

  <VRTRasterBand dataType="Float32" band="1"
subClass="VRTDerivedRasterBand">
  
  <PixelFunctionType>max</PixelFunctionType>
  <PixelFunctionLanguage>Python</PixelFunctionLanguage>
  <PixelFunctionCode>
    </PixelFunctionCode>


Regards,
Rutger




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From ari.jolma at gmail.com  Tue Nov 21 02:23:31 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 21 Nov 2017 12:23:31 +0200
Subject: [gdal-dev] Multidimensional raster support in GDAL
Message-ID: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>

I'd like to get back to this topic a bit since I learned something from 
the standards that I believe was not discussed in the earlier discussion

https://lists.osgeo.org/pipermail/gdal-dev/2017-October/047464.html

In WCS 1 the range of the data - remember the main conceptual division 
to the domain (the X,Y, etc dimensions) and the range (the data if you 
will) - consists of fields, which may consist of bands. That is, a field 
may have an array value (an array of bands). In WCS 2, this separation 
is, firstly, outsourced to SWE since the datatype of range is 
SWE::DataRecord, and, secondly, left as further work in the range 
subsetting extension. The current range subsetting extension makes no 
difference between fields and bands, they are the same and there is no 
structure.

The GDAL WCS driver has had some experimental support for time as field 
and different time steps as bands. I'm not sure if there are many people 
using it since I believe the functionality is currently broken when used 
together with MapServer. The brokenness seems to be so serious that when 
making a gdal_translate call where the source is a WCS that has a field 
with more than one band (and GDAL recognizes it as such) and the call 
does not involve scaling, the call fails. The reason seems to be that 
gdal_translate accesses the data band by band.

I guess my point is here is that this is another difference between the 
GDAL data model and the general coverage data model. The simple approach 
to the data model mismatch is to allow GDAL datasets to be made from 
coverage sources with queries. Also one thing I realized I need for the 
new WCS driver is something which distinguishes different GDAL datasets 
made from a single coverage.

Best regards,

Ari



From even.rouault at spatialys.com  Tue Nov 21 03:18:22 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 Nov 2017 12:18:22 +0100
Subject: [gdal-dev] Vertical datum conversion for SRTM data
In-Reply-To: <20171121092542.g65hr7odn4ykbmzd@mail.nikosalexandris.net>
References: <20171121092542.g65hr7odn4ykbmzd@mail.nikosalexandris.net>
Message-ID: <1782950.IRRLykFeda@even-i700>

On mardi 21 novembre 2017 10:25:42 CET Nikos Alexandris wrote:
> Dear list, can GDAL handle the following exercise?
> 
> Of interest is the Mean Sea Level, based on NASA’s SRTM. I am new in this
> topic. Is the following equation correct?
> 
> SRTM(MSL) = SRTM(WGS84) - MSL(WGS84) [*]
> 
> 
> Is it “correct” to recommend the https://hydrosheds.cr.usgs.gov/ data
> set for Mean Sea Level related studies? I refer specifically to i) 5.1
> Void-filled digital elevation model  and ii) 5.2 Hydrologically conditioned
> elevation [**]

Not completely sure this answers your questions ,but this is related.

Quoting end of http://www.gdal.org/gdalwarp.html:

"""
    (GDAL >= 2.2) To transform a DEM from geoid elevations (using EGM96) to WGS84 ellipsoidal heights:

gdalwarp -overwrite in_dem.tif out_dem.tif -s_srs EPSG:4326+5773 -t_srs EPSG:4979
"""

This assumes the egm96_15.gtx grid is in the proj.4 resource directory.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/e63db7c7/attachment.html>

From michael.smith.erdc at gmail.com  Tue Nov 21 03:27:41 2017
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Tue, 21 Nov 2017 06:27:41 -0500
Subject: [gdal-dev] Vertical datum conversion for SRTM data
In-Reply-To: <1782950.IRRLykFeda@even-i700>
References: <20171121092542.g65hr7odn4ykbmzd@mail.nikosalexandris.net>
 <1782950.IRRLykFeda@even-i700>
Message-ID: <FFB12F45-A74C-42D3-82E8-A017C80DF5EA@gmail.com>

Egm96 grid shift file available from http://download.osgeo.org/proj/vdatum/egm96_15/egm96_15.gtx

 

Mike

 

 

-- 

Michael Smith

Remote Sensing/GIS Center

US Army Corps of Engineers

 

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Even Rouault <even.rouault at spatialys.com>
Date: Tuesday, November 21, 2017 at 6:18 AM
To: <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Vertical datum conversion for SRTM data

 

On mardi 21 novembre 2017 10:25:42 CET Nikos Alexandris wrote:

> Dear list, can GDAL handle the following exercise?

> 

> Of interest is the Mean Sea Level, based on NASA’s SRTM. I am new in this

> topic. Is the following equation correct?

> 

> SRTM(MSL) = SRTM(WGS84) - MSL(WGS84) [*]

> 

> 

> Is it “correct” to recommend the https://hydrosheds.cr.usgs.gov/ data

> set for Mean Sea Level related studies? I refer specifically to i) 5.1

> Void-filled digital elevation model and ii) 5.2 Hydrologically conditioned

> elevation [**]

 

Not completely sure this answers your questions ,but this is related.

 

Quoting end of http://www.gdal.org/gdalwarp.html:

 

"""

(GDAL >= 2.2) To transform a DEM from geoid elevations (using EGM96) to WGS84 ellipsoidal heights:

 

gdalwarp -overwrite in_dem.tif out_dem.tif -s_srs EPSG:4326+5773 -t_srs EPSG:4979

"""

 

This assumes the egm96_15.gtx grid is in the proj.4 resource directory.

 

-- 

Spatialys - Geospatial professional services

http://www.spatialys.com

_______________________________________________ gdal-dev mailing list gdal-dev at lists.osgeo.org https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/f5fd2b0b/attachment-0001.html>

From nik at nikosalexandris.net  Tue Nov 21 04:33:51 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Tue, 21 Nov 2017 13:33:51 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <1607187.EOHbA5ROJG@even-i700>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <3018023.1N5UhNMUuu@even-i700>
 <20171120144820.hbq3mziqrkep2q35@mail.nikosalexandris.net>
 <1607187.EOHbA5ROJG@even-i700>
Message-ID: <20171121123350.ksx3wfb53us3za3z@mail.nikosalexandris.net>

* Even Rouault <even.rouault at spatialys.com> [2017-11-20 15:59:51 +0100]:

>On lundi 20 novembre 2017 15:48:20 CET Nikos Alexandris wrote:
>> * Even Rouault <even.rouault at spatialys.com> [2017-11-07 22:37:02 +0100]:
>> >> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?
>> >
>> >Yes, but within the limits ot the shapefile, and particularly .dbf format:
>> >limitation to 254 characters for field values, 10 characters for field
>> >names... which are easily violated by OSM extracts.
>> >
>> >Spatialite, GeoPackage, PostGIS etc. would be better choices as output
>> >format>
>> >> 3. What is the way to split "other_tags" in multiple new fields *when*
>> >> knowing exactly which tags are contained and should be obtained?
>> >
>> >Edit osmconf.ini to add in the attributes= settings the tag names you're
>> >interested in.
>> >
>> >Even
>>
>> Dear List,
>>
>> in a custom .ini file, under the [points] layer, an `attributes=`
>> instruction set of values that includes `natural,cave_entrance` (key and
>> value under OSM's Natural key), well extracts for the points layer some
>> existing nodes which bear the tag `natural:cave_entrance`.
>>
>> It is not required, as far as I understand the documentation, to include
>> both the parent key and any values (under it) of interest. Perhaps it may
>> be practical to have the attributes of interest split in a separate column.
>>
>> The command I tested, for example, is:
>>
>> ```
>> ogr2ogr --config OSM_CONFIG_FILE custom.ini -f SQLite -dsco SPATIALITE=YES
>> -gt 65536 -progress output.sqlite source.osm ```
>>
>> While this is sufficient for the work I am doing (I can filter
>> `cave_entrance`s out from the `natural` column in the `output.sqlite` file),
>> I wonder why the entries for some nodes correctly bear the string
>> `cave_entrance` in the `natural` column, yet the `cave_entrance` column
>> itself is empty for the same entries.
>
>The attributes keyword in osmconf.ini will select OSM tags whose *key* is one of the item
>specified in attributes.
>If you want to filter by value, you may add a -where or -sql clause  with something like
>"natural = 'cave_entrance'"

Apologies for yet another message on this. OSM needs its time to
understand. What is somewhat confusing is the fact that some values,
e.g. 'drinking_water' for keys, i.e. 'natural', are also keys
themselves.  Anothr example is 'parking'. It can be the value in
the 'amenity=parking' tag or itself, being a key, "contains"
(sub-)values such as 'surface', 'multi-storey' and more.

It really takes to go through each and every key in OSM and see what
is of interest.

Nikos
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/c90a2018/attachment.sig>

From even.rouault at spatialys.com  Tue Nov 21 06:06:14 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 Nov 2017 15:06:14 +0100
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
References: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
Message-ID: <3272820.QKutdsYveo@even-i700>

On mardi 21 novembre 2017 12:23:31 CET Ari Jolma wrote:
> I'd like to get back to this topic a bit since I learned something from
> the standards that I believe was not discussed in the earlier discussion
> 
> https://lists.osgeo.org/pipermail/gdal-dev/2017-October/047464.html
> 
> In WCS 1 the range of the data - remember the main conceptual division
> to the domain (the X,Y, etc dimensions) and the range (the data if you
> will) - consists of fields, which may consist of bands. That is, a field
> may have an array value (an array of bands). In WCS 2, this separation
> is, firstly, outsourced to SWE since the datatype of range is
> SWE::DataRecord, and, secondly, left as further work in the range
> subsetting extension. The current range subsetting extension makes no
> difference between fields and bands, they are the same and there is no
> structure.

Looking at the WCS 1.1 spec, the RangeSubset KVP syntax shows indeed a lot of complexity. 

RangeSubset = FieldSubset *( “;” FieldSubset )
FieldSubset = FieldId [ “:” Interpolation ] [ “[” AxisSubsets “]” ] AxisSubsets = AxisSubset *( “,” 
AxisSubset )
AxisSubset = AxisId “[” Keys “]”
Keys = Key *( “,” Key )

Not sure if implemetations in practice go beyond having a single field made of a single axis 
(at least this is what MapServer supports).

> 
> The GDAL WCS driver has had some experimental support for time as field

I'd say more than the time support is a kind of ad-hoc dimensional parameter.

> and different time steps as bands.

My reading of the code and doc of the current driver is that time steps are treated as 
subdatasets, and not bands.
See https://trac.osgeo.org/gdal/ticket/3449

> I'm not sure if there are many people
> using it since I believe the functionality is currently broken when used
> together with MapServer. The brokenness seems to be so serious that when
> making a gdal_translate call where the source is a WCS that has a field
> with more than one band (and GDAL recognizes it as such) and the call
> does not involve scaling, the call fails.

Is it really an issue specific of time or something more general about multiband support ?

I've just spent some time looking at mapserver code & doc, and there's some confusion 
regarding multiband support . In particular the WCS 2.0 code has a mode where it uses the 
WCS 1.x mapfile metadata item "wcs_rangeset_axes" in a way not compatible with the WCS 
1.x implementation, see
https://github.com/mapserver/mapserver/pull/5523

However for WCS 1.0, I managed to make band subsetting work with the following conf in 
the mapfile (no time component)

   "wcs_bandcount" "9"
   "wcs_rangeset_axes" "bands"
   "wcs_rangeset_name" "Landsat 5 TM Bands"
   "wcs_rangeset_label" "Bands"
   "wcs_rangeset_description" "Bands for Landsat 5 TM"

DescribeCoverage reports:

    <rangeSet>
      <RangeSet>
        <description>Bands for Landsat 5 TM</description>
        <name>Landsat 5 TM Bands</name>
        <label>Bands</label>
        <axisDescription>
          <AxisDescription>
            <name>bands</name>
            <label>Bands/Channels/Samples</label>
            <values>
              <singleValue>1</singleValue>
              <singleValue>2</singleValue>
              <singleValue>3</singleValue>
              <singleValue>4</singleValue>
              <singleValue>5</singleValue>
              <singleValue>6</singleValue>
              <singleValue>7</singleValue>
              <singleValue>8</singleValue>
              <singleValue>9</singleValue>
            </values>
          </AxisDescription>
        </axisDescription>
        <nullValues>
          <singleValue>0</singleValue>
        </nullValues>
      </RangeSet>
    </rangeSet>

And the following GetCoverage request succeeds and returns 3 bands
SERVICE=WCS&VERSION=1.0.0&REQUEST=GetCoverage&COVERAGE=multi&FORMAT=GEOT
IFF_8&BBOX=15,48,16,49&bands=9,5,1&CRS=EPSG:4326&WIDTH=5&HEIGHT=5

> The reason seems to be that
> gdal_translate accesses the data band by band.

gdal_translate (actually GDALDatasetCopyWholeRaster()) uses the INTERLEAVE=PIXEL/
BAND metadata item of the IMAGE_STRUCTURE domain as a hint whether to read band by 
band or all bands together

So if you add the following, it should request all bands :
poDS->SetMetadataItem("INTERLEAVE", "PIXEL", "IMAGE_STRUCTURE")

> 
> I guess my point is here is that this is another difference between the
> GDAL data model and the general coverage data model. The simple approach
> to the data model mismatch is to allow GDAL datasets to be made from
> coverage sources with queries. Also one thing I realized I need for the
> new WCS driver is something which distinguishes different GDAL datasets
> made from a single coverage.

I'm not sure what you have in mind,

> 
> Best regards,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/58b3b0ae/attachment-0001.html>

From ari.jolma at gmail.com  Tue Nov 21 08:42:15 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 21 Nov 2017 18:42:15 +0200
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <3272820.QKutdsYveo@even-i700>
References: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
 <3272820.QKutdsYveo@even-i700>
Message-ID: <c99117f9-1d19-26cc-6a84-7cdc619ece7d@gmail.com>

Even Rouault kirjoitti 21.11.2017 klo 16:06:
>
> > and different time steps as bands.
>
> My reading of the code and doc of the current driver is that time 
> steps are treated as subdatasets, and not bands.
>

Yes. My mistake.

> > I'm not sure if there are many people
>
> > using it since I believe the functionality is currently broken when used
>
> > together with MapServer. The brokenness seems to be so serious that when
>
> > making a gdal_translate call where the source is a WCS that has a field
>
> > with more than one band (and GDAL recognizes it as such) and the call
>
> > does not involve scaling, the call fails.
>
> Is it really an issue specific of time or something more general about 
> multiband support ?
>
> I've just spent some time looking at mapserver code & doc, and there's 
> some confusion regarding multiband support . In particular the WCS 2.0 
> code has a mode where it uses the WCS 1.x mapfile metadata item 
> "wcs_rangeset_axes" in a way not compatible with the WCS 1.x 
> implementation, see
>
> https://github.com/mapserver/mapserver/pull/5523
>
> However for WCS 1.0, I managed to make band subsetting work with the 
> following conf in the mapfile (no time component)
>
> "wcs_bandcount" "9"
>
> "wcs_rangeset_axes" "bands"
>
> "wcs_rangeset_name" "Landsat 5 TM Bands"
>
> "wcs_rangeset_label" "Bands"
>
> "wcs_rangeset_description" "Bands for Landsat 5 TM"
>
> DescribeCoverage reports:
>
> <rangeSet>
>
> <RangeSet>
>
> <description>Bands for Landsat 5 TM</description>
>
> <name>Landsat 5 TM Bands</name>
>
> <label>Bands</label>
>
> <axisDescription>
>
> <AxisDescription>
>
> <name>bands</name>
>
> <label>Bands/Channels/Samples</label>
>
> <values>
>
> <singleValue>1</singleValue>
>
> <singleValue>2</singleValue>
>
> <singleValue>3</singleValue>
>
> <singleValue>4</singleValue>
>
> <singleValue>5</singleValue>
>
> <singleValue>6</singleValue>
>
> <singleValue>7</singleValue>
>
> <singleValue>8</singleValue>
>
> <singleValue>9</singleValue>
>
> </values>
>
> </AxisDescription>
>
> </axisDescription>
>
> <nullValues>
>
> <singleValue>0</singleValue>
>
> </nullValues>
>
> </RangeSet>
>
> </rangeSet>
>
> And the following GetCoverage request succeeds and returns 3 bands
>
> SERVICE=WCS&VERSION=1.0.0&REQUEST=GetCoverage&COVERAGE=multi&FORMAT=GEOTIFF_8&BBOX=15,48,16,49&bands=9,5,1&CRS=EPSG:4326&WIDTH=5&HEIGHT=5
>

So it's a misconfiguration at 194.66.252.155

http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=1.0.0&COVERAGE=BGS_EMODNET_CentralMed-MCol&FORMAT=GTiff&BBOX=9.83125,44.05624829,14.09792008,46.18958333&WIDTH=1024&HEIGHT=512&CRS=EPSG:4326&bands=1

returns 3 bands although the DescribeCoverage is similar.

> > The reason seems to be that
>
> > gdal_translate accesses the data band by band.
>
> gdal_translate (actually GDALDatasetCopyWholeRaster()) uses the 
> INTERLEAVE=PIXEL/BAND metadata item of the IMAGE_STRUCTURE domain as a 
> hint whether to read band by band or all bands together
>
> So if you add the following, it should request all bands :
>
> poDS->SetMetadataItem("INTERLEAVE", "PIXEL", "IMAGE_STRUCTURE")
>

ok, with that I can remove the need for the user option. And probably it 
is anyway usually better,

> >
>
> > I guess my point is here is that this is another difference between the
>
> > GDAL data model and the general coverage data model. The simple approach
>
> > to the data model mismatch is to allow GDAL datasets to be made from
>
> > coverage sources with queries. Also one thing I realized I need for the
>
> > new WCS driver is something which distinguishes different GDAL datasets
>
> > made from a single coverage.
>
> I'm not sure what you have in mind,
>

Somehow the user must be able to write

dataset_1 = GDAL.Open("WCS:URL?coverage=coverage_a")
dataset_2 = GDAL.Open("WCS:URL?coverage=coverage_a")

So that for example dataset_1 is band c from coverage_a and dataset_2 is 
band d from the same coverage (this example is stupid but I think this 
is a valid issue with more complex coverages). I guess that needs to be 
in the dataset name somehow since that is the key to to service file.

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/bb238cdc/attachment.html>

From even.rouault at spatialys.com  Tue Nov 21 08:51:47 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 Nov 2017 17:51:47 +0100
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <c99117f9-1d19-26cc-6a84-7cdc619ece7d@gmail.com>
References: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
 <3272820.QKutdsYveo@even-i700>
 <c99117f9-1d19-26cc-6a84-7cdc619ece7d@gmail.com>
Message-ID: <1646090.Acil3JLFJf@even-i700>

> > And the following GetCoverage request succeeds and returns 3 bands
> > 
> > 
SERVICE=WCS&VERSION=1.0.0&REQUEST=GetCoverage&COVERAGE=multi&FORMAT=GEOT
IF
> > F_8&BBOX=15,48,16,49&bands=9,5,1&CRS=EPSG:4326&WIDTH=5&HEIGHT=5
> So it's a misconfiguration at 194.66.252.155

Yes, probably an issue with the definition of their GTiff output format
See 
https://github.com/mapserver/mapserver/issues/3919#issuecomment-4944131

> Somehow the user must be able to write
> 
> dataset_1 = GDAL.Open("WCS:URL?coverage=coverage_a")
> dataset_2 = GDAL.Open("WCS:URL?coverage=coverage_a")
> 
> So that for example dataset_1 is band c from coverage_a and dataset_2 is
> band d from the same coverage (this example is stupid but I think this
> is a valid issue with more complex coverages). I guess that needs to be
> in the dataset name somehow since that is the key to to service file.

You probably intended to add band specification in the above dataset names ?

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171121/f1ba9a3e/attachment-0001.html>

From ari.jolma at gmail.com  Tue Nov 21 22:23:23 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 22 Nov 2017 08:23:23 +0200
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <1646090.Acil3JLFJf@even-i700>
References: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
 <3272820.QKutdsYveo@even-i700>
 <c99117f9-1d19-26cc-6a84-7cdc619ece7d@gmail.com>
 <1646090.Acil3JLFJf@even-i700>
Message-ID: <fa57ac2d-949e-73b4-d69c-6713d99d6c14@gmail.com>

Even Rouault kirjoitti 21.11.2017 klo 18:51:
>
> > Somehow the user must be able to write
>
> >
>
> > dataset_1 = GDAL.Open("WCS:URL?coverage=coverage_a")
>
> > dataset_2 = GDAL.Open("WCS:URL?coverage=coverage_a")
>
> >
>
> > So that for example dataset_1 is band c from coverage_a and dataset_2 is
>
> > band d from the same coverage (this example is stupid but I think this
>
> > is a valid issue with more complex coverages). I guess that needs to be
>
> > in the dataset name somehow since that is the key to to service file.
>
> You probably intended to add band specification in the above dataset 
> names ?
>

I intentionally left them out, since up to now I've used the URL with 
version and coverage name as the cache key but it's clear that all 
parameters that can affect the contents of the dataset must be in the 
name (URL, cache key) and not in options.

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/ea452d04/attachment.html>

From andre+joost at nurfuerspam.de  Wed Nov 22 01:58:31 2017
From: andre+joost at nurfuerspam.de (Andre Joost)
Date: Wed, 22 Nov 2017 10:58:31 +0100
Subject: [gdal-dev] Vertical datum conversion for SRTM data
In-Reply-To: <FFB12F45-A74C-42D3-82E8-A017C80DF5EA@gmail.com>
References: <20171121092542.g65hr7odn4ykbmzd@mail.nikosalexandris.net>
 <1782950.IRRLykFeda@even-i700>
 <FFB12F45-A74C-42D3-82E8-A017C80DF5EA@gmail.com>
Message-ID: <ov3hri$cc7$1@blaine.gmane.org>

Am 21.11.2017 um 12:27 schrieb Michael Smith:
> Egm96 grid shift file available from http://download.osgeo.org/proj/vdatum/egm96_15/egm96_15.gtx
>
>

Note that OSGEO4W64 still ships an incorrect version of the file from 
2010. According to http://download.osgeo.org/proj/vdatum/egm96_15/ the 
file should be from 2014 (not 2010).

HTH,
André Joost



From aborruso at gmail.com  Wed Nov 22 03:36:34 2017
From: aborruso at gmail.com (aborruso)
Date: Wed, 22 Nov 2017 04:36:34 -0700 (MST)
Subject: [gdal-dev] Using field name as variable in a "dialect sqlite" query
Message-ID: <1511350594114-0.post@n6.nabble.com>

Hi,
I have this kind of CSV

ID,x,y,epsg
1,500000,4000000,32633
1,500000,4000000,32632

Is it possible to use ogrinfo and a "dialect sqlite" query in this way, and
set the EPSG by reading the value from the `epsg` field?

ogrinfo -dialect sqlite -sql "select ST_GeomFromText('POINT(' || x || ' ' ||
y || ')',epsg) from source" source.csv source

If yes, how?

Thank you



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From ari.jolma at gmail.com  Wed Nov 22 04:38:55 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 22 Nov 2017 14:38:55 +0200
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <3272820.QKutdsYveo@even-i700>
References: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
 <3272820.QKutdsYveo@even-i700>
Message-ID: <b42fdfed-e690-3c47-a839-6b8475986ad9@gmail.com>

Even Rouault kirjoitti 21.11.2017 klo 16:06:
>
> gdal_translate (actually GDALDatasetCopyWholeRaster()) uses the 
> INTERLEAVE=PIXEL/BAND metadata item of the IMAGE_STRUCTURE domain as a 
> hint whether to read band by band or all bands together
>
> So if you add the following, it should request all bands :
>
> poDS->SetMetadataItem("INTERLEAVE", "PIXEL", "IMAGE_STRUCTURE")
>

I don't see that happening in the case of WCS driver:

PIXEL_INTERLEAVE=TRUE is my option to set the metadata item but it could 
be set with option INTERLEAVE=PIXEL, which GDALDatasetCopyWholeRaster() 
examines.

8<-------------------
gdal_translate -oo PIXEL_INTERLEAVE=TRUE -oo OriginAtBoundary -oo 
CACHE=wcs_cache -srcwin 0 0 2 2 
"WCS:http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?version=1.0.0&coverage=BGS_EMODNET_CentralMed-MCol" 
x
GNM: GNMRegisterAllInternal
GNM: RegisterGNMFile
GNM: RegisterGNMdatabase
Setting INTERLEAVE to PIXEL
GDAL: 
GDALOpen(WCS:http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?version=1.0.0&coverage=BGS_EMODNET_CentralMed-MCol, 
this=0x1256210) succeeds as WCS.
Input file size is 2977, 3883
0GTiff: Reopen with strip chop enabled
GDAL: GDAL_CACHEMAX = 585 MB
GDAL: GDALDatasetCopyWholeRaster(): 2*2 swaths, bInterleave=1
URL=http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=1.0.0&COVERAGE=BGS_EMODNET_CentralMed-MCol&FORMAT=GTiff&BBOX=9.83125,44.05624829,14.09792008,46.18958333&WIDTH=1024&HEIGHT=512&CRS=EPSG:4326&bands=1
HTTP: 
Fetch(http://194.66.252.155/cgi-bin/BGS_EMODnet_bathymetry/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=1.0.0&COVERAGE=BGS_EMODNET_CentralMed-MCol&FORMAT=GTiff&BBOX=9.83125,44.05624829,14.09792008,46.18958333&WIDTH=1024&HEIGHT=512&CRS=EPSG:4326&bands=1)
HTTP: libcurl/7.47.0 OpenSSL/1.0.2g zlib/1.2.8 libidn/1.32 librtmp/2.3
WCS: GDALOpenResult() on content-type: image/tiff
GDAL: GDALOpen(/vsimem/wcs/0x1256210/wcsresult.dat, this=0x12a2610) 
succeeds as GTiff.
ERROR 1: Returned tile does not match expected band configuration.
Got 3 bands instead of one although the coverage has band range type.

GDAL: GDALClose(/vsimem/wcs/0x1256210/wcsresult.dat, this=0x12a2610)
ERROR 1: wcs_cache/znQnc.xml, band 1: IReadBlock failed at X offset 0, Y 
offset 0: Returned tile does not match expected band configuration.
Got 3 bands instead of one although the coverage has band range type.

GDAL: GDALClose(wcs_cache/znQnc.xml, this=0x1256210)
GDAL: In GDALDestroy - unloading GDAL shared library.
8<-------------------



Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/159191be/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Nov 22 04:59:22 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 22 Nov 2017 05:59:22 -0700 (MST)
Subject: [gdal-dev] Using field name as variable in a "dialect sqlite"
 query
In-Reply-To: <1511350594114-0.post@n6.nabble.com>
References: <1511350594114-0.post@n6.nabble.com>
Message-ID: <1511355562140-0.post@n6.nabble.com>

aborruso wrote
> Hi,
> I have this kind of CSV
> 
> ID,x,y,epsg
> 1,500000,4000000,32633
> 1,500000,4000000,32632
> 
> Is it possible to use ogrinfo and a "dialect sqlite" query in this way,
> and
> set the EPSG by reading the value from the `epsg` field?
> 
> ogrinfo -dialect sqlite -sql "select ST_GeomFromText('POINT(' || x || ' '
> ||
> y || ')',epsg) from source" source.csv source
> 
> If yes, how?
> 
> Thank you

You can have only one SRID on a layer so you must either split your data by
the epsg field or transform each record to same SRID. Otherwise your request
was almost complete.

I wonder if anybody has tried to make SQL injection through the name of the
geometry column :)

ogrinfo -dialect sqlite -sql "select ST_GeomFromText('POINT('|| x || ' ' ||
y || ')',CAST(epsg AS integer)) from coords" coords.csv
INFO: Open of `coords.csv'
      using driver `CSV' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 2
Extent: (500000.000000, 4000000.000000) - (500000.000000, 4000000.000000)
Layer SRS WKT:
PROJCS["WGS 84 / UTM zone 33N",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AXIS["Latitude",NORTH],
        AXIS["Longitude",EAST],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",15],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["Easting",EAST],
    AXIS["Northing",NORTH],
    AUTHORITY["EPSG","32633"]]
Geometry Column = ST_GeomFromText('POINT('|| x || ' ' || y || ')',CAST(epsg
AS integer))
OGRFeature(SELECT):0
  POINT (500000 4000000)

OGRFeature(SELECT):1
  POINT (500000 4000000)

-Jukka Rahkonen-




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Wed Nov 22 05:11:00 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Nov 2017 14:11:00 +0100
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <b42fdfed-e690-3c47-a839-6b8475986ad9@gmail.com>
References: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
 <3272820.QKutdsYveo@even-i700>
 <b42fdfed-e690-3c47-a839-6b8475986ad9@gmail.com>
Message-ID: <2582711.SLiKPilUSX@even-i700>

On mercredi 22 novembre 2017 14:38:55 CET Ari Jolma wrote:
> Even Rouault kirjoitti 21.11.2017 klo 16:06:
> > gdal_translate (actually GDALDatasetCopyWholeRaster()) uses the
> > INTERLEAVE=PIXEL/BAND metadata item of the IMAGE_STRUCTURE domain as a
> > hint whether to read band by band or all bands together
> > 
> > So if you add the following, it should request all bands :
> > 
> > poDS->SetMetadataItem("INTERLEAVE", "PIXEL", "IMAGE_STRUCTURE")
> 
> I don't see that happening in the case of WCS driver:
> 
> PIXEL_INTERLEAVE=TRUE is my option to set the metadata item but it could
> be set with option INTERLEAVE=PIXEL, which GDALDatasetCopyWholeRaster()
> examines.
> 

Probably related to the logic of WCSDataset::TestUseBlockIO() which given your area of 
interest size of 2x2 will force bocked IO instead of direct IO

If PIXEL_INTERLEAVE=TRUE  is set, you might want to force the implementation of 
WCSRasterBand::IReadBlock() to read all the bands.

Note: the above is with the current trunk logic. Didn't check if you modified this.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/3ee2784e/attachment-0001.html>

From nik at nikosalexandris.net  Wed Nov 22 05:14:38 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Wed, 22 Nov 2017 14:14:38 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <1607187.EOHbA5ROJG@even-i700>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <3018023.1N5UhNMUuu@even-i700>
 <20171120144820.hbq3mziqrkep2q35@mail.nikosalexandris.net>
 <1607187.EOHbA5ROJG@even-i700>
Message-ID: <20171122131437.yai54gaziovp6gfc@mail.nikosalexandris.net>

* Even Rouault <even.rouault at spatialys.com> [2017-11-20 15:59:51 +0100]:

>On lundi 20 novembre 2017 15:48:20 CET Nikos Alexandris wrote:
>> * Even Rouault <even.rouault at spatialys.com> [2017-11-07 22:37:02 +0100]:
>> >> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?
>> >
>> >Yes, but within the limits ot the shapefile, and particularly .dbf format:
>> >limitation to 254 characters for field values, 10 characters for field
>> >names... which are easily violated by OSM extracts.
>> >
>> >Spatialite, GeoPackage, PostGIS etc. would be better choices as output
>> >format>
>> >> 3. What is the way to split "other_tags" in multiple new fields *when*
>> >> knowing exactly which tags are contained and should be obtained?
>> >
>> >Edit osmconf.ini to add in the attributes= settings the tag names you're
>> >interested in.
>> >
>> >Even
>>
>> Dear List,
>>
>> in a custom .ini file, under the [points] layer, an `attributes=`
>> instruction set of values that includes `natural,cave_entrance` (key and
>> value under OSM's Natural key), well extracts for the points layer some
>> existing nodes which bear the tag `natural:cave_entrance`.
>>
>> It is not required, as far as I understand the documentation, to include
>> both the parent key and any values (under it) of interest. Perhaps it may
>> be practical to have the attributes of interest split in a separate column.
>>
>> The command I tested, for example, is:
>>
>> ```
>> ogr2ogr --config OSM_CONFIG_FILE custom.ini -f SQLite -dsco SPATIALITE=YES
>> -gt 65536 -progress output.sqlite source.osm ```
>>
>> While this is sufficient for the work I am doing (I can filter
>> `cave_entrance`s out from the `natural` column in the `output.sqlite` file),
>> I wonder why the entries for some nodes correctly bear the string
>> `cave_entrance` in the `natural` column, yet the `cave_entrance` column
>> itself is empty for the same entries.
>
>The attributes keyword in osmconf.ini will select OSM tags whose *key* is one of the item
>specified in attributes.
>If you want to filter by value, you may add a -where or -sql clause  with something like
>"natural = 'cave_entrance'"

This works!

Yet, I can't seem to find an answer on the web, nor a solution by trying. I'd
like to perform SQL queries in one go: one querying the points layer and another
one the lines layer.

This is certainly not a JOIN operation, as far as I understand. And
UNION only works in data sourced from the same table/layer. Is it doable
to merge an 

SELECT *
FROM points
WHERE ...

and an

SELECT *
FROM lines
WHERE ...

query?

Thank you, Nikos
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/196bee5b/attachment.sig>

From even.rouault at spatialys.com  Wed Nov 22 05:30:23 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Nov 2017 14:30:23 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <20171122131437.yai54gaziovp6gfc@mail.nikosalexandris.net>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <1607187.EOHbA5ROJG@even-i700>
 <20171122131437.yai54gaziovp6gfc@mail.nikosalexandris.net>
Message-ID: <4797434.MxTFvvyTVY@even-i700>

On mercredi 22 novembre 2017 14:14:38 CET Nikos Alexandris wrote:
> * Even Rouault <even.rouault at spatialys.com> [2017-11-20 15:59:51 +0100]:
> >On lundi 20 novembre 2017 15:48:20 CET Nikos Alexandris wrote:
> >> * Even Rouault <even.rouault at spatialys.com> [2017-11-07 22:37:02 +0100]:
> >> >> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?
> >> >
> >> >Yes, but within the limits ot the shapefile, and particularly .dbf
> >> >format:
> >> >limitation to 254 characters for field values, 10 characters for field
> >> >names... which are easily violated by OSM extracts.
> >> >
> >> >Spatialite, GeoPackage, PostGIS etc. would be better choices as output
> >> >format>
> >> >
> >> >> 3. What is the way to split "other_tags" in multiple new fields *when*
> >> >> knowing exactly which tags are contained and should be obtained?
> >> >
> >> >Edit osmconf.ini to add in the attributes= settings the tag names you're
> >> >interested in.
> >> >
> >> >Even
> >> 
> >> Dear List,
> >> 
> >> in a custom .ini file, under the [points] layer, an `attributes=`
> >> instruction set of values that includes `natural,cave_entrance` (key and
> >> value under OSM's Natural key), well extracts for the points layer some
> >> existing nodes which bear the tag `natural:cave_entrance`.
> >> 
> >> It is not required, as far as I understand the documentation, to include
> >> both the parent key and any values (under it) of interest. Perhaps it may
> >> be practical to have the attributes of interest split in a separate
> >> column.
> >> 
> >> The command I tested, for example, is:
> >> 
> >> ```
> >> ogr2ogr --config OSM_CONFIG_FILE custom.ini -f SQLite -dsco
> >> SPATIALITE=YES
> >> -gt 65536 -progress output.sqlite source.osm ```
> >> 
> >> While this is sufficient for the work I am doing (I can filter
> >> `cave_entrance`s out from the `natural` column in the `output.sqlite`
> >> file), I wonder why the entries for some nodes correctly bear the string
> >> `cave_entrance` in the `natural` column, yet the `cave_entrance` column
> >> itself is empty for the same entries.
> >
> >The attributes keyword in osmconf.ini will select OSM tags whose *key* is
> >one of the item specified in attributes.
> >If you want to filter by value, you may add a -where or -sql clause  with
> >something like "natural = 'cave_entrance'"
> 
> This works!
> 
> Yet, I can't seem to find an answer on the web, nor a solution by trying.
> I'd like to perform SQL queries in one go: one querying the points layer
> and another one the lines layer.
> 
> This is certainly not a JOIN operation, as far as I understand. And
> UNION only works in data sourced from the same table/layer. Is it doable
> to merge an
> 
> SELECT *
> FROM points
> WHERE ...
> 
> and an
> 
> SELECT *
> FROM lines
> WHERE ...
> 
> query?

You can't do that in a single operation with ogr2ogr. You may use ogr2ogr for each layer, with 
-append if you need to append to an existing output file

Or if you want to do in a single operation. You can use a OGR VRT
( http://gdal.org/drv_vrt.html ) file like the following one (customize the name of the 
datasource and the SQL expressions) as the input file of ogr2ogr

<OGRVRTDataSource>
  <OGRVRTLayer name="points">
    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
    <SrcSQL>SELECT * FROM points</SrcSQL>
    <GeometryType>wkbPoint</GeometryType>
    <LayerSRS>WGS84</LayerSRS>
  </OGRVRTLayer>
  <OGRVRTLayer name="lines">
    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
    <SrcSQL>SELECT * FROM lines</SrcSQL>
    <GeometryType>wkbLineString</GeometryType>
    <LayerSRS>WGS84</LayerSRS>
  </OGRVRTLayer>
  <OGRVRTLayer name="multilinestrings">
    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
    <SrcSQL>SELECT * FROM multilinestrings</SrcSQL>
    <GeometryType>wkbMultiLineString</GeometryType>
    <LayerSRS>WGS84</LayerSRS>
  </OGRVRTLayer>
  <OGRVRTLayer name="multipolygons">
    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
    <SrcSQL>SELECT * FROM multipolygons</SrcSQL>
    <GeometryType>wkbMultiPolygon</GeometryType>
    <LayerSRS>WGS84</LayerSRS>
  </OGRVRTLayer>
  <OGRVRTLayer name="other_relations">
    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
    <SrcSQL>SELECT * FROM other_relations</SrcSQL>
    <GeometryType>wkbGeometryCollection</GeometryType>
    <LayerSRS>WGS84</LayerSRS>
  </OGRVRTLayer>
</OGRVRTDataSource>

Even

-- 
Spatialys - Geospatial professional services
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/be4de287/attachment-0001.html>

From nik at nikosalexandris.net  Wed Nov 22 06:51:45 2017
From: nik at nikosalexandris.net (Nikos Alexandris)
Date: Wed, 22 Nov 2017 15:51:45 +0100
Subject: [gdal-dev] Extracting keys & values from OSM Planet
In-Reply-To: <4797434.MxTFvvyTVY@even-i700>
References: <20171107151541.oqthni24isqiy7qo@mail.nikosalexandris.net>
 <1607187.EOHbA5ROJG@even-i700>
 <20171122131437.yai54gaziovp6gfc@mail.nikosalexandris.net>
 <4797434.MxTFvvyTVY@even-i700>
Message-ID: <20171122145144.eykdt4atovzbtdom@mail.nikosalexandris.net>

* Even Rouault <even.rouault at spatialys.com> [2017-11-22 14:30:23 +0100]:

>On mercredi 22 novembre 2017 14:14:38 CET Nikos Alexandris wrote:
>> * Even Rouault <even.rouault at spatialys.com> [2017-11-20 15:59:51 +0100]:
>> >On lundi 20 novembre 2017 15:48:20 CET Nikos Alexandris wrote:
>> >> * Even Rouault <even.rouault at spatialys.com> [2017-11-07 22:37:02 +0100]:
>> >> >> 2. Is OGR handling well the conversion from .osm to ESRI Shapefiles?
>> >> >
>> >> >Yes, but within the limits ot the shapefile, and particularly .dbf
>> >> >format:
>> >> >limitation to 254 characters for field values, 10 characters for field
>> >> >names... which are easily violated by OSM extracts.
>> >> >
>> >> >Spatialite, GeoPackage, PostGIS etc. would be better choices as output
>> >> >format>
>> >> >
>> >> >> 3. What is the way to split "other_tags" in multiple new fields *when*
>> >> >> knowing exactly which tags are contained and should be obtained?
>> >> >
>> >> >Edit osmconf.ini to add in the attributes= settings the tag names you're
>> >> >interested in.
>> >> >
>> >> >Even
>> >>
>> >> Dear List,
>> >>
>> >> in a custom .ini file, under the [points] layer, an `attributes=`
>> >> instruction set of values that includes `natural,cave_entrance` (key and
>> >> value under OSM's Natural key), well extracts for the points layer some
>> >> existing nodes which bear the tag `natural:cave_entrance`.
>> >>
>> >> It is not required, as far as I understand the documentation, to include
>> >> both the parent key and any values (under it) of interest. Perhaps it may
>> >> be practical to have the attributes of interest split in a separate
>> >> column.
>> >>
>> >> The command I tested, for example, is:
>> >>
>> >> ```
>> >> ogr2ogr --config OSM_CONFIG_FILE custom.ini -f SQLite -dsco
>> >> SPATIALITE=YES
>> >> -gt 65536 -progress output.sqlite source.osm ```
>> >>
>> >> While this is sufficient for the work I am doing (I can filter
>> >> `cave_entrance`s out from the `natural` column in the `output.sqlite`
>> >> file), I wonder why the entries for some nodes correctly bear the string
>> >> `cave_entrance` in the `natural` column, yet the `cave_entrance` column
>> >> itself is empty for the same entries.
>> >
>> >The attributes keyword in osmconf.ini will select OSM tags whose *key* is
>> >one of the item specified in attributes.
>> >If you want to filter by value, you may add a -where or -sql clause  with
>> >something like "natural = 'cave_entrance'"
>>
>> This works!
>>
>> Yet, I can't seem to find an answer on the web, nor a solution by trying.
>> I'd like to perform SQL queries in one go: one querying the points layer
>> and another one the lines layer.
>>
>> This is certainly not a JOIN operation, as far as I understand. And
>> UNION only works in data sourced from the same table/layer. Is it doable
>> to merge an
>>
>> SELECT *
>> FROM points
>> WHERE ...
>>
>> and an
>>
>> SELECT *
>> FROM lines
>> WHERE ...
>>
>> query?
>
>You can't do that in a single operation with ogr2ogr. You may use ogr2ogr for each layer, with
>-append if you need to append to an existing output file
>
>Or if you want to do in a single operation. You can use a OGR VRT
>( http://gdal.org/drv_vrt.html ) file like the following one (customize the name of the
>datasource and the SQL expressions) as the input file of ogr2ogr
>
><OGRVRTDataSource>
>  <OGRVRTLayer name="points">
>    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
>    <SrcSQL>SELECT * FROM points</SrcSQL>
>    <GeometryType>wkbPoint</GeometryType>
>    <LayerSRS>WGS84</LayerSRS>
>  </OGRVRTLayer>
>  <OGRVRTLayer name="lines">
>    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
>    <SrcSQL>SELECT * FROM lines</SrcSQL>
>    <GeometryType>wkbLineString</GeometryType>
>    <LayerSRS>WGS84</LayerSRS>
>  </OGRVRTLayer>
>  <OGRVRTLayer name="multilinestrings">
>    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
>    <SrcSQL>SELECT * FROM multilinestrings</SrcSQL>
>    <GeometryType>wkbMultiLineString</GeometryType>
>    <LayerSRS>WGS84</LayerSRS>
>  </OGRVRTLayer>
>  <OGRVRTLayer name="multipolygons">
>    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
>    <SrcSQL>SELECT * FROM multipolygons</SrcSQL>
>    <GeometryType>wkbMultiPolygon</GeometryType>
>    <LayerSRS>WGS84</LayerSRS>
>  </OGRVRTLayer>
>  <OGRVRTLayer name="other_relations">
>    <SrcDataSource relativeToVRT="1" shared="0">in.osm</SrcDataSource>
>    <SrcSQL>SELECT * FROM other_relations</SrcSQL>
>    <GeometryType>wkbGeometryCollection</GeometryType>
>    <LayerSRS>WGS84</LayerSRS>
>  </OGRVRTLayer>
></OGRVRTDataSource>

Magnifique!  Both work as expected.


Some bash functions:

For a single operation, given a custom osmconf.ini file

# Syntax: osm2sqlite  INI-FILE  SQL-CLAUSE  SOURCE.OSM
# Reusing parts from INI and SQL filenames for the output file
function osm2sqlite { ogr2ogr --config OSM_CONFIG_FILE $1 -sql @"$2" -f SQLite -dsco SPATIALITE=YES -gt 65536 -progress $(basename $3 .osm)_$(basename $1 .ini)_${2#*.}.sqlite $3; };


For two operations

# First filtering
# Syntax: osm2sqlite  INI-FILE  SQL-CLAUSE  SOURCE.OSM
function osm2sqlite { ogr2ogr --config OSM_CONFIG_FILE $1 -sql @"$2" -f SQLite -dsco SPATIALITE=YES -gt 65536 -progress $(basename $3 .osm)_$(basename $1 .ini).sqlite $3; };

# Filter and append to output file of the above command, given the same source file is used
# Syntax: osm2sqlite.append  INI-FILE  SQL-CLAUSE  SOURCE.OSM
function osm2sqlite.append { ogr2ogr -append --config OSM_CONFIG_FILE $1 -sql @"$2" -f SQLite -dsco SPATIALITE=YES -gt 65536 -progress $(basename $3 .osm)_$(basename $1 .ini).sqlite $3; };


Similar for the VRT file, just skipping the '-sql' part. For
completeness, I kept only points and lines in the VRT file, since I am
not interested, at the moment, for the rest of the features.

Merci Even u. Danke Frank,

Nikos
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/3e9ec9b5/attachment.sig>

From gane.prog at gmail.com  Wed Nov 22 07:04:22 2017
From: gane.prog at gmail.com (Gane R)
Date: Wed, 22 Nov 2017 20:34:22 +0530
Subject: [gdal-dev] Page Selection in GeoPDF in GDAL utilizes like
 gdalwarp, gdal_translate
In-Reply-To: <005f01d34efd$c1072640$431572c0$@frogmouth.net>
References: <CALMrLdDGjoVq0Jmqr2x37orChn_hq3g2WH59vjQBH+_jpWaDsg@mail.gmail.com>
 <005f01d34efd$c1072640$431572c0$@frogmouth.net>
Message-ID: <CALMrLdCq_Ofp3ybVO1midqSVjOgMBZbdE-PvmOtg4zSdgL1YMQ@mail.gmail.com>

Thanks for your reply,
I got it working by referencing the the subsets like PDF:

On Fri, Oct 27, 2017 at 1:59 PM, <bradh at frogmouth.net> wrote:

> You should be able to just use the normal subdataset referencing. I like
> gdalinfo to get the syntax.
>
>
>
> Brad
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/7369f5d6/attachment.html>

From ari.jolma at gmail.com  Wed Nov 22 07:33:54 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Wed, 22 Nov 2017 17:33:54 +0200
Subject: [gdal-dev] Multidimensional raster support in GDAL
In-Reply-To: <2582711.SLiKPilUSX@even-i700>
References: <126f806d-646f-7067-3216-a4f548fce1f0@gmail.com>
 <3272820.QKutdsYveo@even-i700>
 <b42fdfed-e690-3c47-a839-6b8475986ad9@gmail.com>
 <2582711.SLiKPilUSX@even-i700>
Message-ID: <e295b31d-0433-7a66-9551-f3f36a06aa63@gmail.com>

Even Rouault kirjoitti 22.11.2017 klo 15:11:
>
> On mercredi 22 novembre 2017 14:38:55 CET Ari Jolma wrote:
>
> > Even Rouault kirjoitti 21.11.2017 klo 16:06:
>
> > > gdal_translate (actually GDALDatasetCopyWholeRaster()) uses the
>
> > > INTERLEAVE=PIXEL/BAND metadata item of the IMAGE_STRUCTURE domain as a
>
> > > hint whether to read band by band or all bands together
>
> > >
>
> > > So if you add the following, it should request all bands :
>
> > >
>
> > > poDS->SetMetadataItem("INTERLEAVE", "PIXEL", "IMAGE_STRUCTURE")
>
> >
>
> > I don't see that happening in the case of WCS driver:
>
> >
>
> > PIXEL_INTERLEAVE=TRUE is my option to set the metadata item but it could
>
> > be set with option INTERLEAVE=PIXEL, which GDALDatasetCopyWholeRaster()
>
> > examines.
>
> >
>
> Probably related to the logic of WCSDataset::TestUseBlockIO() which 
> given your area of interest size of 2x2 will force bocked IO instead 
> of direct IO
>
> If PIXEL_INTERLEAVE=TRUE is set, you might want to force the 
> implementation of WCSRasterBand::IReadBlock() to read all the bands.
>

I guess the situation is same for WCSDataset::IRasterIO which may be 
called BandCount and BandMap.

Works fine.

Ari

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/6b8add21/attachment.html>

From ramotswa at gmail.com  Wed Nov 22 07:56:47 2017
From: ramotswa at gmail.com (Tobias Reinicke)
Date: Wed, 22 Nov 2017 15:56:47 +0000
Subject: [gdal-dev] Fwd: Grib2 template extension (again).
In-Reply-To: <CAPitpCYYbNyTYmp3njDTFSusSyZ-se9PUqQLEUqG13=PKh+mDg@mail.gmail.com>
References: <CAPitpCZATVTjPjbrAA+US4MmvaDZgeL2W9dibU4v2sM2gTM61g@mail.gmail.com>
 <CAPitpCYYbNyTYmp3njDTFSusSyZ-se9PUqQLEUqG13=PKh+mDg@mail.gmail.com>
Message-ID: <CAPitpCYQgFUfy8it3eOae_mGyGGuox0bHkEXp0_LNwB+cQkj6w@mail.gmail.com>

Hello All,

I can't raise a bug I'm afraid but I thought I'd mention that it looks like
the grib format I am looking at using has a template of 40. I know gdal was
recently updated to cope with 30, so apologies for this.

File to use to reproduce with gdalinfo
https://download.regional.atmosphere.copernicus.eu/services/
CAMS50?token=__M0bChV6QsoOFqHz31VRqnpr4GhWPtcpaRy3oeZjBNSg__
&grid=0.1&model=ENSEMBLE&package=ANALYSIS_PM10_SURFACE&
time=-24H-1H&referencetime=2017-09-12T00:00:00Z&format=GRIB2&licence=yes


Cheers,

Toby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/e9726065/attachment.html>

From even.rouault at spatialys.com  Wed Nov 22 09:07:13 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Nov 2017 18:07:13 +0100
Subject: [gdal-dev] Fwd: Grib2 template extension (again).
In-Reply-To: <CAPitpCYQgFUfy8it3eOae_mGyGGuox0bHkEXp0_LNwB+cQkj6w@mail.gmail.com>
References: <CAPitpCZATVTjPjbrAA+US4MmvaDZgeL2W9dibU4v2sM2gTM61g@mail.gmail.com>
 <CAPitpCYYbNyTYmp3njDTFSusSyZ-se9PUqQLEUqG13=PKh+mDg@mail.gmail.com>
 <CAPitpCYQgFUfy8it3eOae_mGyGGuox0bHkEXp0_LNwB+cQkj6w@mail.gmail.com>
Message-ID: <19657932.HabDcYKlQR@even-i700>

On mercredi 22 novembre 2017 15:56:47 CET Tobias Reinicke wrote:
> Hello All,
> 
> I can't raise a bug I'm afraid but I thought I'd mention that it looks like
> the grib format I am looking at using has a template of 40. I know gdal was
> recently updated to cope with 30, so apologies for this.
> 
> File to use to reproduce with gdalinfo
> https://download.regional.atmosphere.copernicus.eu/services/
> CAMS50?token=__M0bChV6QsoOFqHz31VRqnpr4GhWPtcpaRy3oeZjBNSg__
> &grid=0.1&model=ENSEMBLE&package=ANALYSIS_PM10_SURFACE&
> time=-24H-1H&referencetime=2017-09-12T00:00:00Z&format=GRIB2&licence=yes

Tobias,

Support added in trunk per
https://trac.osgeo.org/gdal/changeset/40796

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171122/6fb4da65/attachment-0001.html>

From even.rouault at spatialys.com  Thu Nov 23 02:39:45 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 23 Nov 2017 11:39:45 +0100
Subject: [gdal-dev] Motion: promote GDAL 2.2.3 RC1 for release
In-Reply-To: <9533995.N4EQC2AYju@even-i700>
References: <9533995.N4EQC2AYju@even-i700>
Message-ID: <22588455.bNYYZBLHeS@even-i700>

> 
> Motion: promote GDAL 2.2.3 RC1 for release
> 
> Starting with my +1

I declare this motion passed with +1 from PSC members JukkaR and 
myself, as well from community member Jeff McKenna

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171123/07008638/attachment.html>

From even.rouault at spatialys.com  Thu Nov 23 02:59:23 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 23 Nov 2017 11:59:23 +0100
Subject: [gdal-dev] GDAL/OGR 2.2.3 is released
Message-ID: <2179723.LFWbx3oMTz@even-i700>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the release of the 
GDAL/OGR 2.2.3 bug fix version. 

Consult the release notes for the list of issues addressed :
  https://trac.osgeo.org/gdal/wiki/Release/2.2.3-News

The sources are available at:

  http://download.osgeo.org/gdal/2.2.3/gdal-2.2.3.tar.xz
  http://download.osgeo.org/gdal/2.2.3/gdal-2.2.3.tar.gz
  http://download.osgeo.org/gdal/2.2.3/gdal223.zip
  http://download.osgeo.org/gdal/2.2.3/gdal-grass-2.2.3.tar.gz

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171123/4197b3fc/attachment.html>

From ari.jolma at gmail.com  Thu Nov 23 05:40:21 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 23 Nov 2017 15:40:21 +0200
Subject: [gdal-dev] GDAL WCS driver: testing range and domain subsetting
Message-ID: <e15c1c17-f18b-edab-23e8-aa9fd561ddb0@gmail.com>

I guess this goes to the Rasdaman people (My application to the Rasdaman 
email list is pending). Why does this query

http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=test_irr_cube_2&FORMAT=image%2Ftiff&SUBSET=E%2875042.7273594,95042.7273594%29&SUBSET=N%285434865.5579399997,5454865.5579399997%29&RANGESUBSET=b2

fail with

Error evaluating rasdaman query: 'SELECT encode(c[0:1,0:1,0:3].1, "tiff" 
, 
"{\"geoReference\":{\"crs\":\"EPSG:32633\",\"bbox\":{\"xmin\":75042.7273594,\"ymin\":5434865.55794,\"xmax\":95042.7273594,\"ymax\":5454865.55794}}}") 
FROM test_irr_cube_2 AS c'

?

I'm developing the range and domain subsetting in the GDAL WCS driver, 
here the idea was to map the time (axis 'unix') to bands. Therefore I 
need to limit the range to one field.

Ari



From ari.jolma at gmail.com  Thu Nov 23 08:02:16 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 23 Nov 2017 18:02:16 +0200
Subject: [gdal-dev] GDAL WCS driver: testing range and domain subsetting
In-Reply-To: <e15c1c17-f18b-edab-23e8-aa9fd561ddb0@gmail.com>
References: <e15c1c17-f18b-edab-23e8-aa9fd561ddb0@gmail.com>
Message-ID: <ca14c6a7-43bd-adc1-75dc-8479c8eb1ea0@gmail.com>

Ari Jolma kirjoitti 23.11.2017 klo 15:40:

> I guess this goes to the Rasdaman people (My application to the 
> Rasdaman email list is pending). Why does this query
>
> http://ows.rasdaman.org/rasdaman/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=test_irr_cube_2&FORMAT=image%2Ftiff&SUBSET=E%2875042.7273594,95042.7273594%29&SUBSET=N%285434865.5579399997,5454865.5579399997%29&RANGESUBSET=b2 
>
>
> fail with
>
> Error evaluating rasdaman query: 'SELECT encode(c[0:1,0:1,0:3].1, 
> "tiff" , 
> "{\"geoReference\":{\"crs\":\"EPSG:32633\",\"bbox\":{\"xmin\":75042.7273594,\"ymin\":5434865.55794,\"xmax\":95042.7273594,\"ymax\":5454865.55794}}}") 
> FROM test_irr_cube_2 AS c'

It seems to be a problem with formats. Rasdaman agrees to write the data 
to a NetCDF file.

Ari


From aborruso at gmail.com  Thu Nov 23 08:43:34 2017
From: aborruso at gmail.com (aborruso)
Date: Thu, 23 Nov 2017 09:43:34 -0700 (MST)
Subject: [gdal-dev] Using field name as variable in a "dialect sqlite"
	query
In-Reply-To: <1511355562140-0.post@n6.nabble.com>
References: <1511350594114-0.post@n6.nabble.com>
 <1511355562140-0.post@n6.nabble.com>
Message-ID: <1511455414993-0.post@n6.nabble.com>

Hi Jukka,


jratike80 wrote
> You can have only one SRID on a layer so you must either split your data
> by
> the epsg field or transform each record to same SRID. Otherwise your
> request
> was almost complete.

I know, but my problem was the source!


jratike80 wrote
> ogrinfo -dialect sqlite -sql "select ST_GeomFromText('POINT('|| x || ' '
> ||
> y || ')',CAST(epsg AS integer)) from coords" coords.csv

And thank you to your example I have found the solution that was right for
me:

ogrinfo -dialect sqlite -sql "select ST_TRANSFORM(ST_GeomFromText('POINT('||
x || ' ' || y || ')',CAST(epsg AS integer)),4326) from coords" coords.csv 

It gives me 

OGRFeature(SELECT):0
  POINT (15.0 36.1447180988163)

OGRFeature(SELECT):1
  POINT (9.0 36.1447180988163)

Than I have unified all, without splitting my source file (as you have
written I have trasformed each record to same SRID).

You and ogr are great :)




--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From robertofig85 at gmail.com  Thu Nov 23 10:43:54 2017
From: robertofig85 at gmail.com (Roberto Ribeiro)
Date: Thu, 23 Nov 2017 16:43:54 -0200
Subject: [gdal-dev] Standardization of Bounding Box structure
Message-ID: <CANTZQ+y5B+ChPpr4yymXzDHDDqBJVt3QnkibwqddJn537jNx2A@mail.gmail.com>

In OGR, the GetGeometry() method from the Geometry class returns a bounding
box in the (xmin, xmax, ymin, ymax) structure. However, the
SetSpatialFilterRect() method from the Layer class expects a bounding box
in the (xmin, ymin, xmax, ymax) structure. This is a problem that can be
worked around, but it does generate confusion. Any reason why this couldn't
be standardized?

Also, on a similar note, having SetSpatialFilterRect expect an array of
coordinates, instead of coordinates as individual arguements, seems more
logical to me, as it's how every other GIS package returns bounding box
info afaik, including OGR's GetGeometry.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171123/c70bcf51/attachment.html>

From SGONG at mdacorporation.com  Thu Nov 23 12:25:08 2017
From: SGONG at mdacorporation.com (Shawn Gong)
Date: Thu, 23 Nov 2017 20:25:08 +0000
Subject: [gdal-dev] pass gdal dataset as an argument from Python to C
Message-ID: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>

Hi list,



Has anyone done this before?

I try to pass a gdal dataset as an argument from Python to C.



in my C code, I have

PyObject* py_my_func(PyObject *self, PyObject *args)
{

    PyObject *poDataset;



   if(!PyArg_ParseTuple(args, "Odd", &poDataset, &a1, &a2))
  {
    return NULL;
  }



  my_func(poDataset, a1, a2);
}



void my_func(GDALDatasetH hDataset, double a1, double a2)

{

}



Python crashed and hDataset was NULL

Is it possible to do or I did something wrong?



BTW, I have passed either a filename or a gdal array as an argument from Python to C, with success.


Thanks,
Shawn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171123/6632109a/attachment.html>

From ari.jolma at gmail.com  Fri Nov 24 01:06:03 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Fri, 24 Nov 2017 11:06:03 +0200
Subject: [gdal-dev] Standardization of Bounding Box structure
In-Reply-To: <CANTZQ+y5B+ChPpr4yymXzDHDDqBJVt3QnkibwqddJn537jNx2A@mail.gmail.com>
References: <CANTZQ+y5B+ChPpr4yymXzDHDDqBJVt3QnkibwqddJn537jNx2A@mail.gmail.com>
Message-ID: <b31446b9-4878-6e45-1d90-a64cc4558a19@gmail.com>

Roberto Ribeiro kirjoitti 23.11.2017 klo 20:43:
> In OGR, the GetGeometry() method from the Geometry class returns a 
> bounding box in the (xmin, xmax, ymin, ymax) structure. However, the 
> SetSpatialFilterRect() method from the Layer class expects a bounding 
> box in the (xmin, ymin, xmax, ymax) structure. This is a problem that 
> can be worked around, but it does generate confusion. Any reason why 
> this couldn't be standardized?

There are also for example in gdal_translate also "xoff yoff xsize 
ysize", i.e., (xmin, ymin, xmax-xmin, ymax-ymin) and "ulx uly lrx lry", 
i.e., (xmin, ymax, xmax, ymin).

I guess the main reason is that changing the interface is a major 
change. So, perhaps this could be put on the list of things to consider 
changing in GDAL 3.0.

Ari

>
> Also, on a similar note, having SetSpatialFilterRect expect an array 
> of coordinates, instead of coordinates as individual arguements, seems 
> more logical to me, as it's how every other GIS package returns 
> bounding box info afaik, including OGR's GetGeometry.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171124/7d8ff9a7/attachment.html>

From Roger.Bivand at nhh.no  Fri Nov 24 01:37:11 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Nov 2017 02:37:11 -0700 (MST)
Subject: [gdal-dev] report proj4 version to which gdal is linked?
Message-ID: <1511516231812-0.post@n6.nabble.com>

I've looked in ogr/ogrct.cpp, but cannot see that the proj4 version that is
detected internally is exposed for reporting through a function in the API.
It would be convenient if GDAL could report versions of some of its
dependencies. Checks for GDAL built with or without GEOS are now in R sf and
rgdal packages, because some drivers behave differently if GDAL was built
with or without GEOS (but not the GEOS version, which may matter for static
builds), We'd like to report the proj4 version used to build GDAL too, and
would value advice. This will become critical shortly, with the forthcoming
release of proj4 5.0.0, which uses a different API. There is going to be a
lot of muddle, so being able to check will be helpful for many. Should I
file a trac request?

Roger



-----
Roger Bivand
NHH Norwegian School of Economics, Bergen, Norway
--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Fri Nov 24 02:12:01 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 24 Nov 2017 11:12:01 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <1511516231812-0.post@n6.nabble.com>
References: <1511516231812-0.post@n6.nabble.com>
Message-ID: <16108767.0qxreERKry@even-i700>

On vendredi 24 novembre 2017 02:37:11 CET Roger Bivand wrote:
> I've looked in ogr/ogrct.cpp, but cannot see that the proj4 version that is
> detected internally is exposed for reporting through a function in the API.
> It would be convenient if GDAL could report versions of some of its
> dependencies. Checks for GDAL built with or without GEOS are now in R sf and
> rgdal packages, because some drivers behave differently if GDAL was built
> with or without GEOS (but not the GEOS version, which may matter for static
> builds), We'd like to report the proj4 version used to build GDAL too, and
> would value advice. This will become critical shortly, with the forthcoming
> release of proj4 5.0.0, which uses a different API. There is going to be a
> lot of muddle, so being able to check will be helpful for many. 

There are 2 different notions :
- the proj version used at compile time
- the proj version used at link time

proj 4.X only offers the PJ_VERSION macro, so you can only detect the compile time version. 

GDAL has currently 2 modes to support proj:
- classic mode where you build against proj headers and link the GDAL shared object against 
the proj shared object at build time. In that mode, currently,we could potentially report 
PJ_VERSION
- full dynamic mode where there's no build requirement and at runtime you dlopen proj. In 
that mode, currently, it is really hard to know which proj version we end up linking against 
(you can make some guess depending on which symbols are available...)

proj 5 will have compile time PROJ_VERSION_ macros, and a proj_info() function giving the 
version at runtime.

A few months before, I proposed to drop the support for the "full dynamic mode" as it makes 
code messy. This didn't make concensus at that time, so I dropped the ball for now. But for 
proj 5 support, I think we really need to get rid of the full dynamic mode.

If proj 5 still supports the old proj_api.h (which seems to be the direction), as soon as it will 
be released, we could probably make proj 5 the minimum version for a proj-enabled GDAL 
build (since other components of the ecosystem depending on proj 4 API will still work), so as 
to avoid supporting 2 different APIs. Well, maybe this is a bold move, and perhaps still 
supporting proj 4 classic mode will not be that hard, but I definitly don't want to have to 
support "proj 4 classic mode" + "proj 4 full dynamic mode" + "proj 5 classic mode".

> Should I
> file a trac request?

You may

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171124/f3e590a7/attachment.html>

From sunil.chaudhary at nwgeo.com  Fri Nov 24 09:08:32 2017
From: sunil.chaudhary at nwgeo.com (sunil.chaudhary)
Date: Fri, 24 Nov 2017 10:08:32 -0700 (MST)
Subject: [gdal-dev] gdalwarp putting in incorrect values for -dstnodata
Message-ID: <1511543312621-0.post@n6.nabble.com>

Hello I'm hoping someone can help me out here. I'm using gdal version 2.1.1.
What I am trying to do is use gdalwarp to clip a raster to a shape file and
then set the no data value to black or 0.

the command I am using to do this is:

gdalwarp -cutline HxIP_HVA_GP_z11_30cm_2014.shp -dstnodata 0
GB_AB_z11_deflate.tif GB_AB_z11_nodata.tif

What is happening is that in the output file all red values that are 0 are
being turned into the no data value (See Image 1)



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From Roger.Bivand at nhh.no  Fri Nov 24 09:22:28 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Nov 2017 18:22:28 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <16108767.0qxreERKry@even-i700>
References: <1511516231812-0.post@n6.nabble.com>
 <16108767.0qxreERKry@even-i700>
Message-ID: <alpine.LFD.2.21.1711241740040.21450@reclus.nhh.no>

On Fri, 24 Nov 2017, Even Rouault wrote:

> On vendredi 24 novembre 2017 02:37:11 CET Roger Bivand wrote:
>> I've looked in ogr/ogrct.cpp, but cannot see that the proj4 version that is
>> detected internally is exposed for reporting through a function in the API.
>> It would be convenient if GDAL could report versions of some of its
>> dependencies. Checks for GDAL built with or without GEOS are now in R sf and
>> rgdal packages, because some drivers behave differently if GDAL was built
>> with or without GEOS (but not the GEOS version, which may matter for static
>> builds), We'd like to report the proj4 version used to build GDAL too, and
>> would value advice. This will become critical shortly, with the forthcoming
>> release of proj4 5.0.0, which uses a different API. There is going to be a
>> lot of muddle, so being able to check will be helpful for many.
>
> There are 2 different notions :
> - the proj version used at compile time
> - the proj version used at link time
>
> proj 4.X only offers the PJ_VERSION macro, so you can only detect the 
> compile time version.

In rgdal, we use:

#include <proj_api.h>

SEXP
PROJ4VersionInfo(void) {
     SEXP ans;

     PROTECT(ans=NEW_LIST(2));
     SET_VECTOR_ELT(ans, 0, NEW_CHARACTER(1));
     SET_VECTOR_ELT(ans, 1, NEW_INTEGER(1));
     SET_STRING_ELT(VECTOR_ELT(ans, 0), 0,
         COPY_TO_USER_STRING(pj_get_release()));
     INTEGER_POINTER(VECTOR_ELT(ans, 1))[0] = PJ_VERSION;

     UNPROTECT(1);

     return(ans);
}

to get both the declaration in proj_api.h and the one in pj_release.c 
(because they have differed). I would have (perhaps) hoped that 
pj_release.c is the runtime version, but mileage may vary ...

>
> GDAL has currently 2 modes to support proj:
> - classic mode where you build against proj headers and link the GDAL 
> shared object against the proj shared object at build time. In that 
> mode, currently,we could potentially report PJ_VERSION

That would help.

> - full dynamic mode where there's no build requirement and at runtime 
> you dlopen proj. In that mode, currently, it is really hard to know 
> which proj version we end up linking against (you can make some guess 
> depending on which symbols are available...)
>

or maybe create a pointer to pj_get_release()?

> proj 5 will have compile time PROJ_VERSION_ macros, and a proj_info() 
> function giving the version at runtime.
>
> A few months before, I proposed to drop the support for the "full 
> dynamic mode" as it makes code messy. This didn't make concensus at that 
> time, so I dropped the ball for now. But for proj 5 support, I think we 
> really need to get rid of the full dynamic mode.
>
> If proj 5 still supports the old proj_api.h (which seems to be the 
> direction), as soon as it will be released, we could probably make proj 
> 5 the minimum version for a proj-enabled GDAL build (since other 
> components of the ecosystem depending on proj 4 API will still work), so 
> as to avoid supporting 2 different APIs. Well, maybe this is a bold 
> move, and perhaps still supporting proj 4 classic mode will not be that 
> hard, but I definitly don't want to have to support "proj 4 classic 
> mode" + "proj 4 full dynamic mode" + "proj 5 classic mode".

Yes, too many modes is misuse of limited time, and the speed of (overdue 
?) changes in proj4 suggests that this is wise, also in relation to the 
downstream applications and packaging communities. It would be unfortunate 
if major platforms remained stuck with poorly supported versions of proj4.

>
>> Should I file a trac request?
>
> You may

Thanks, I'll see what I can do with this.

Roger

>
> Even
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From even.rouault at spatialys.com  Fri Nov 24 09:56:53 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 24 Nov 2017 18:56:53 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <alpine.LFD.2.21.1711241740040.21450@reclus.nhh.no>
References: <1511516231812-0.post@n6.nabble.com>
 <16108767.0qxreERKry@even-i700>
 <alpine.LFD.2.21.1711241740040.21450@reclus.nhh.no>
Message-ID: <2612624.cbcJHzDOTW@even-i700>

> I would have (perhaps) hoped that
> pj_release.c is the runtime version, but mileage may 
vary ...

It is. I just missed pj_get_release()

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171124/76f2bf30/attachment.html>

From Roger.Bivand at nhh.no  Fri Nov 24 13:19:08 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Nov 2017 22:19:08 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <2612624.cbcJHzDOTW@even-i700>
References: <1511516231812-0.post@n6.nabble.com>
 <16108767.0qxreERKry@even-i700>
 <alpine.LFD.2.21.1711241740040.21450@reclus.nhh.no>
 <2612624.cbcJHzDOTW@even-i700>
Message-ID: <alpine.LFD.2.21.1711242215290.25942@reclus.nhh.no>

On Fri, 24 Nov 2017, Even Rouault wrote:

>> I would have (perhaps) hoped that
>> pj_release.c is the runtime version, but mileage may
> vary ...
>
> It is. I just missed pj_get_release()
>

Thanks, I guess you can see a resoluion. Which gdal header is the most 
logical to expose this in?

It's a bit fragile, because the string is entered manually, rather than 
coming from "above" in the build tree, but at least is there. Making sure 
programatically that proj knows itself what its version is whould simplify 
things a lot.

Roger

>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From even.rouault at spatialys.com  Fri Nov 24 13:30:20 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 24 Nov 2017 22:30:20 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <alpine.LFD.2.21.1711242215290.25942@reclus.nhh.no>
References: <1511516231812-0.post@n6.nabble.com> <2612624.cbcJHzDOTW@even-i700>
 <alpine.LFD.2.21.1711242215290.25942@reclus.nhh.no>
Message-ID: <2827968.Csh7aUTDua@even-i700>

On vendredi 24 novembre 2017 22:19:08 CET Roger Bivand wrote:
> On Fri, 24 Nov 2017, Even Rouault wrote:
> >> I would have (perhaps) hoped that
> >> pj_release.c is the runtime version, but mileage may
> > 
> > vary ...
> > 
> > It is. I just missed pj_get_release()
> 
> Thanks, I guess you can see a resoluion. Which gdal header is the most
> logical to expose this in?

Would probably makes sense to add the version found at build time in
GDALVersionInfo("BUILD_INFO") in
https://github.com/OSGeo/gdal/blob/trunk/gdal/gcore/gdal_misc.cpp#L2099

PROJ_VERSION=x.y.z\n

and have a similar GDALVersionInfo("RUNTIME_INFO") for the version found at runtime 
(pj_get_release() / proj_info())

PROJ_VERSION=x.y.z\n


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171124/914416bb/attachment.html>

From Roger.Bivand at nhh.no  Sat Nov 25 04:53:56 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 25 Nov 2017 13:53:56 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <2827968.Csh7aUTDua@even-i700>
References: <1511516231812-0.post@n6.nabble.com> <2612624.cbcJHzDOTW@even-i700>
 <alpine.LFD.2.21.1711242215290.25942@reclus.nhh.no>
 <2827968.Csh7aUTDua@even-i700>
Message-ID: <alpine.LFD.2.21.1711251347160.8117@reclus.nhh.no>

On Fri, 24 Nov 2017, Even Rouault wrote:

> On vendredi 24 novembre 2017 22:19:08 CET Roger Bivand wrote:
>> On Fri, 24 Nov 2017, Even Rouault wrote:
>>>> I would have (perhaps) hoped that
>>>> pj_release.c is the runtime version, but mileage may
>>>
>>> vary ...
>>>
>>> It is. I just missed pj_get_release()
>>
>> Thanks, I guess you can see a resoluion. Which gdal header is the most
>> logical to expose this in?
>
> Would probably makes sense to add the version found at build time in
> GDALVersionInfo("BUILD_INFO") in
> https://github.com/OSGeo/gdal/blob/trunk/gdal/gcore/gdal_misc.cpp#L2099
>
> PROJ_VERSION=x.y.z\n
>
> and have a similar GDALVersionInfo("RUNTIME_INFO") for the version found at runtime
> (pj_get_release() / proj_info())
>
> PROJ_VERSION=x.y.z\n
>

Thanks, that would match nicely, as rgdal already has bindings for 
GDALVersionInfo() but only uses "--version" and "VERSION_NUM" so far; our 
test for GDAL built with GEOS tests a fake union to detect success or 
failure.

Roger

>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From even.rouault at spatialys.com  Sat Nov 25 05:47:29 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 25 Nov 2017 14:47:29 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <alpine.LFD.2.21.1711251347160.8117@reclus.nhh.no>
References: <1511516231812-0.post@n6.nabble.com> <2827968.Csh7aUTDua@even-i700>
 <alpine.LFD.2.21.1711251347160.8117@reclus.nhh.no>
Message-ID: <12419093.sQXOxo2iHd@even-i700>

> Thanks, that would match nicely, as rgdal already has bindings for
> GDALVersionInfo() but only uses "--version" and "VERSION_NUM" so far; our
> test for GDAL built with GEOS tests a fake union to detect success or
> failure.

Was available through the C++ API with OGRGeometryFactory::haveGEOS() but 
I've now exposed it in GDALVersionInfo("BUILD_INFO") per 	
https://trac.osgeo.org/gdal/changeset/40832

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171125/470dd865/attachment.html>

From edzer.pebesma at uni-muenster.de  Sat Nov 25 08:49:33 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 25 Nov 2017 17:49:33 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <12419093.sQXOxo2iHd@even-i700>
References: <1511516231812-0.post@n6.nabble.com> <2827968.Csh7aUTDua@even-i700>
 <alpine.LFD.2.21.1711251347160.8117@reclus.nhh.no>
 <12419093.sQXOxo2iHd@even-i700>
Message-ID: <62e95e77-abd3-f128-69b8-41eaf04edeaa@uni-muenster.de>



On 11/25/2017 02:47 PM, Even Rouault wrote:
>  
> 
>> Thanks, that would match nicely, as rgdal already has bindings for
> 
>> GDALVersionInfo() but only uses "--version" and "VERSION_NUM" so far; our
> 
>> test for GDAL built with GEOS tests a fake union to detect success or
> 
>> failure.
> 
>  
> 
> Was available through the C++ API with OGRGeometryFactory::haveGEOS()

On the system I work on (Ubuntu 17.04 with ubuntugis-unstable GDAL),
haveGEOS() seems unreliable (giving false, where it is true).

The runtime check R packages rgdal and sf use is simply trying out a
Union: https://github.com/r-spatial/sf/blob/master/src/gdal.cpp#L422-L437

> but I've now exposed it in GDALVersionInfo("BUILD_INFO") per
> 
> https://trac.osgeo.org/gdal/changeset/40832
> 
>  
> 
> Even
> 
>  
> 
> -- 
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From edzer.pebesma at uni-muenster.de  Sat Nov 25 08:53:58 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 25 Nov 2017 17:53:58 +0100
Subject: [gdal-dev] report proj4 version to which gdal is linked?
In-Reply-To: <62e95e77-abd3-f128-69b8-41eaf04edeaa@uni-muenster.de>
References: <1511516231812-0.post@n6.nabble.com> <2827968.Csh7aUTDua@even-i700>
 <alpine.LFD.2.21.1711251347160.8117@reclus.nhh.no>
 <12419093.sQXOxo2iHd@even-i700>
 <62e95e77-abd3-f128-69b8-41eaf04edeaa@uni-muenster.de>
Message-ID: <ce111800-ed50-9b62-edbd-6fd3e98359de@uni-muenster.de>



On 11/25/2017 05:49 PM, Edzer Pebesma wrote:
> On the system I work on (Ubuntu 17.04 with ubuntugis-unstable GDAL),
> haveGEOS() seems unreliable (giving false, where it is true).

I'm sorry, that was a wrong diagnosis of a self-caused problem.
-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From edzer.pebesma at uni-muenster.de  Sun Nov 26 09:36:50 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 26 Nov 2017 18:36:50 +0100
Subject: [gdal-dev] 4D netcdf-CF file with pressure as elevation
Message-ID: <79588f87-37e5-d8f9-e99c-0a67611d374f@uni-muenster.de>

This came up here: https://github.com/r-spatial/stars/issues/12

We have a CF-1.4 conformant netcdf file found here:
https://drive.google.com/open?id=1QtmsU5OKegOcoVi00qnxozbbHr8DqA4U

which has some 4-dimensional arrays with time and vertical pressure
level coordinates. When reading this through the gdal netcdf driver, we see:

gdalinfo NETCDF:"CORDEXRUN_4_RAD.1990010100.nc":cl | head -170 | tail -7

  NETCDF_DIM_EXTRA={time,kz}
  NETCDF_DIM_kz_DEF={18,6}

NETCDF_DIM_kz_VALUES={351390,351396,351402,351408,351414,351420,351426,351432,351438,351444,351450,351456,351462,351468,351474,351480,351486,351492,351498,351504,351510,351516,351522,351528,351534,351540,351546,351552,351558,351564,351570,351576,351582,351588,351594,351600,351606,351612,351618,351624,351630,351636,351642,351648,351654,351660,351666,351672,351678,351684,351690,351696,351702,351708,351714,351720,351726,351732,351738,351744,351750,351756,351762,351768,351774,351780,351786,351792,351798,351804,351810,351816,351822,351828,351834,351840,351846,351852,351858,351864,351870,351876,351882,351888,351894,351900,351906,351912,351918,351924,351930,351936,351942,351948,351954,351960,351966,351972,351978,351984,351990,351996,352002,352008,352014,352020,352026,352032,352038,352044,352050,352056,352062,352068,352074,352080,352086,352092,352098,352104}
  NETCDF_DIM_time_DEF={120,6}

NETCDF_DIM_time_VALUES={351390,351396,351402,351408,351414,351420,351426,351432,351438,351444,351450,351456,351462,351468,351474,351480,351486,351492,351498,351504,351510,351516,351522,351528,351534,351540,351546,351552,351558,351564,351570,351576,351582,351588,351594,351600,351606,351612,351618,351624,351630,351636,351642,351648,351654,351660,351666,351672,351678,351684,351690,351696,351702,351708,351714,351720,351726,351732,351738,351744,351750,351756,351762,351768,351774,351780,351786,351792,351798,351804,351810,351816,351822,351828,351834,351840,351846,351852,351858,351864,351870,351876,351882,351888,351894,351900,351906,351912,351918,351924,351930,351936,351942,351948,351954,351960,351966,351972,351978,351984,351990,351996,352002,352008,352014,352020,352026,352032,352038,352044,352050,352056,352062,352068,352074,352080,352086,352092,352098,352104}
  time#bounds=time_bnds
  time#calendar=gregorian

and the last band has metainfo:

Band 2160 Block=65x1 Type=Float32, ColorInterp=Undefined
  NoData Value=9.96920996838686905e+36
  Unit Type: 1
  Metadata:
    cell_methods=time: point
    coordinates=xlat xlon
    grid_mapping=crs
    long_name=Cloud fractional cover
    NETCDF_DIM_Kz=351492
    NETCDF_DIM_time=352104
    NETCDF_VARNAME=cl
    standard_name=cloud_area_fraction_in_atmosphere_layer
    units=1

which suggests to me that the kz dimension coordinates (elevation by
pressure level) per band, as well as their list of values are wrong, and
were copied from the time values.

I noted from the ncdump that the file has a time(time) variable with the
time values, but not a kz(kz) variable; instead it has a sigma(kz)
variable with pressure values which vary between 0 and 1.

Is this known behaviour?
-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From even.rouault at spatialys.com  Sun Nov 26 10:10:44 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 26 Nov 2017 19:10:44 +0100
Subject: [gdal-dev] 4D netcdf-CF file with pressure as elevation
In-Reply-To: <79588f87-37e5-d8f9-e99c-0a67611d374f@uni-muenster.de>
References: <79588f87-37e5-d8f9-e99c-0a67611d374f@uni-muenster.de>
Message-ID: <17606922.8t2Fin42sk@even-i700>

> I noted from the ncdump that the file has a time(time) variable with the
> time values, but not a kz(kz) variable; instead it has a sigma(kz)
> variable with pressure values which vary between 0 and 1.
> 
> Is this known behaviour?

Edzer,

I don't think so, but this is definitely a bug. I indeed see in the code that it assumes that if 
a variable is indexed by a dimension, there's a 1D variable of the same name that this 
dimension.
Can you create a ticket about that ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171126/c5016e90/attachment.html>

From edzer.pebesma at uni-muenster.de  Sun Nov 26 13:15:38 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 26 Nov 2017 22:15:38 +0100
Subject: [gdal-dev] 4D netcdf-CF file with pressure as elevation
In-Reply-To: <17606922.8t2Fin42sk@even-i700>
References: <79588f87-37e5-d8f9-e99c-0a67611d374f@uni-muenster.de>
 <17606922.8t2Fin42sk@even-i700>
Message-ID: <157e18c0-b9d8-7392-ec99-101591eed84d@uni-muenster.de>



On 11/26/2017 07:10 PM, Even Rouault wrote:
>  
> 
>> I noted from the ncdump that the file has a time(time) variable with the
> 
>> time values, but not a kz(kz) variable; instead it has a sigma(kz)
> 
>> variable with pressure values which vary between 0 and 1.
> 
>>
> 
>> Is this known behaviour?
> 
>  
> 
> Edzer,
> 
>  
> 
> I don't think so, but this is definitely a bug. I indeed see in the code
> that it assumes that if a variable is indexed by a dimension, there's a
> 1D variable of the same name that this dimension.
> 
> Can you create a ticket about that ?

Sure: https://trac.osgeo.org/gdal/ticket/7165

> 
>  
> 
> Even
> 
>  
> 
> -- 
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From sean at mapbox.com  Mon Nov 27 08:09:16 2017
From: sean at mapbox.com (Sean Gillies)
Date: Mon, 27 Nov 2017 09:09:16 -0700
Subject: [gdal-dev] pass gdal dataset as an argument from Python to C
In-Reply-To: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>
References: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>
Message-ID: <CADPhZXyEA==C3wkEMq3_Dthvmk7aJm1py3BNZWQn8=Kc4j6PWA@mail.gmail.com>

Shawn,

PyObject and GDALDatasetH are incompatible types and you can't pass the
former to a function that expects the latter. I'm surprised your program
can compile with these incompatible types.

Do you mean for your module to extend GDAL's Python bindings? If you look
inside the C code of GDAL's Python bindings you may be able to see how to
get the GDALDatasetH associated with a Python dataset object.

Hope this helps,


On Thu, Nov 23, 2017 at 1:25 PM, Shawn Gong <SGONG at mdacorporation.com>
wrote:

> Hi list,
>
>
>
> Has anyone done this before?
>
> I try to pass a gdal dataset as an argument from Python to C.
>
>
>
> in my C code, I have
>
> PyObject* py_my_func(PyObject *self, PyObject *args)
> {
>
>     PyObject *poDataset;
>
>
>
>    if(!PyArg_ParseTuple(args, "Odd", &poDataset, &a1, &a2))
>   {
>     return NULL;
>   }
>
>
>
>   my_func(poDataset, a1, a2);
> }
>
>
>
> void my_func(GDALDatasetH hDataset, double a1, double a2)
>
> {
>
> }
>
>
>
> Python crashed and hDataset was NULL
>
> Is it possible to do or I did something wrong?
>
>
>
> BTW, I have passed either a filename or a gdal array as an argument from
> Python to C, with success.
>
> Thanks,
> Shawn
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171127/ad9c0a3a/attachment.html>

From SGONG at mdacorporation.com  Mon Nov 27 08:34:07 2017
From: SGONG at mdacorporation.com (Shawn Gong)
Date: Mon, 27 Nov 2017 16:34:07 +0000
Subject: [gdal-dev] pass gdal dataset as an argument from Python to C
In-Reply-To: <CADPhZXyEA==C3wkEMq3_Dthvmk7aJm1py3BNZWQn8=Kc4j6PWA@mail.gmail.com>
References: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>,
 <CADPhZXyEA==C3wkEMq3_Dthvmk7aJm1py3BNZWQn8=Kc4j6PWA@mail.gmail.com>
Message-ID: <7DCBC135929FF74E8A5488B1814AC6BC3FFA3653@exbermd02.ds.mda.ca>

Thank you Sean.



What I want to do is to compile C/C++ code into "_my_c_module.pyd" and then to be called by Python. The Python code passes an argument to C/C++.

I did previously by passing a file name (str) or a numpy array as argument to C/C++, and it is all good.

This time I want to pass a gdal dataset as an argument:



in Python:

    from osgeo import gdal

    import _my_c_module

    ds=gdal.Open('my_filename")

    result = _my_c_module.function1(ds)



is this possible? If yes, how?



Shawn

________________________________
From: Sean Gillies [sean at mapbox.com]
Sent: November-27-17 11:09 AM
To: Shawn Gong
Cc: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] pass gdal dataset as an argument from Python to C

Shawn,

PyObject and GDALDatasetH are incompatible types and you can't pass the former to a function that expects the latter. I'm surprised your program can compile with these incompatible types.

Do you mean for your module to extend GDAL's Python bindings? If you look inside the C code of GDAL's Python bindings you may be able to see how to get the GDALDatasetH associated with a Python dataset object.

Hope this helps,


On Thu, Nov 23, 2017 at 1:25 PM, Shawn Gong <SGONG at mdacorporation.com<mailto:SGONG at mdacorporation.com>> wrote:

Hi list,



Has anyone done this before?

I try to pass a gdal dataset as an argument from Python to C.



in my C code, I have

PyObject* py_my_func(PyObject *self, PyObject *args)
{

    PyObject *poDataset;



   if(!PyArg_ParseTuple(args, "Odd", &poDataset, &a1, &a2))
  {
    return NULL;
  }



  my_func(poDataset, a1, a2);
}



void my_func(GDALDatasetH hDataset, double a1, double a2)

{

}



Python crashed and hDataset was NULL

Is it possible to do or I did something wrong?



BTW, I have passed either a filename or a gdal array as an argument from Python to C, with success.


Thanks,
Shawn

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev



--
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171127/e0d94865/attachment.html>

From ari.jolma at gmail.com  Mon Nov 27 08:52:26 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Mon, 27 Nov 2017 18:52:26 +0200
Subject: [gdal-dev] Build with MinGW in Linux
Message-ID: <5e14f500-ff55-924c-cd14-4568ab4106ce@gmail.com>

My PR https://github.com/OSGeo/gdal/pull/265 currently fails on MinGW 
cross compilation and on Windows (AppVeyor) while running a test 
involving gdal.Translate (python code). The error is "ValueError: 
Received a NULL pointer." which is from the Swig bindings.

How could I study the issue on my own Linux? I.e., how do I setup a 
MinGW cross-compilation setup, are there instructions somewhere? I could 
do that on a virtual machine but rather not in Windows. I've compiled 
years ago on MinGW but that was in Windows and it seems that 
cross-compilation (like Travis is doing) has improved lately.

Ari



From manisandro at gmail.com  Mon Nov 27 09:00:53 2017
From: manisandro at gmail.com (Sandro Mani)
Date: Mon, 27 Nov 2017 18:00:53 +0100
Subject: [gdal-dev] Build with MinGW in Linux
In-Reply-To: <5e14f500-ff55-924c-cd14-4568ab4106ce@gmail.com>
References: <5e14f500-ff55-924c-cd14-4568ab4106ce@gmail.com>
Message-ID: <2f97d7eb-ba87-b64e-bf83-97e59b371c5b@gmail.com>


On 27.11.2017 17:52, Ari Jolma wrote:
> My PR https://github.com/OSGeo/gdal/pull/265 currently fails on MinGW 
> cross compilation and on Windows (AppVeyor) while running a test 
> involving gdal.Translate (python code). The error is "ValueError: 
> Received a NULL pointer." which is from the Swig bindings.
>
> How could I study the issue on my own Linux? I.e., how do I setup a 
> MinGW cross-compilation setup, are there instructions somewhere? I 
> could do that on a virtual machine but rather not in Windows. I've 
> compiled years ago on MinGW but that was in Windows and it seems that 
> cross-compilation (like Travis is doing) has improved lately.
>
Fedora ships a mingw-gdal package, the steps to build it are basically 
documented in the spec file [1]. Just install everything listed as 
BuildRequires and follow the relevant steps in %prep and %build.

Hope this helps
Sandro

[1] 
https://src.fedoraproject.org/rpms/mingw-gdal/blob/master/f/mingw-gdal.spec


From even.rouault at spatialys.com  Mon Nov 27 09:13:18 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Nov 2017 18:13:18 +0100
Subject: [gdal-dev] Build with MinGW in Linux
In-Reply-To: <5e14f500-ff55-924c-cd14-4568ab4106ce@gmail.com>
References: <5e14f500-ff55-924c-cd14-4568ab4106ce@gmail.com>
Message-ID: <3095322.OHkiIkslBR@even-i700>

On lundi 27 novembre 2017 18:52:26 CET Ari Jolma wrote:
> My PR https://github.com/OSGeo/gdal/pull/265 currently fails on MinGW
> cross compilation and on Windows (AppVeyor) while running a test
> involving gdal.Translate (python code). The error is "ValueError:
> Received a NULL pointer." which is from the Swig bindings.
> 
> How could I study the issue on my own Linux? I.e., how do I setup a
> MinGW cross-compilation setup, are there instructions somewhere? I could
> do that on a virtual machine but rather not in Windows. I've compiled
> years ago on MinGW but that was in Windows and it seems that
> cross-compilation (like Travis is doing) has improved lately.
> 

For the mingw error, I guess you could reproduce the same with a non-curl enabled build (the 
mingw targets do not have curl enabled)

wcs_6() lacks an introductory check:

if gdaltest.wcs_drv is None:
	return 'skip'

The MSVC/Appveyor failures are different and look like a segfault ( the AppVeyor target do 
have curl enabled)


> Ari
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171127/77f52e7c/attachment-0001.html>

From sean at mapbox.com  Mon Nov 27 10:46:50 2017
From: sean at mapbox.com (Sean Gillies)
Date: Mon, 27 Nov 2017 11:46:50 -0700
Subject: [gdal-dev] pass gdal dataset as an argument from Python to C
In-Reply-To: <7DCBC135929FF74E8A5488B1814AC6BC3FFA3653@exbermd02.ds.mda.ca>
References: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>
 <CADPhZXyEA==C3wkEMq3_Dthvmk7aJm1py3BNZWQn8=Kc4j6PWA@mail.gmail.com>
 <7DCBC135929FF74E8A5488B1814AC6BC3FFA3653@exbermd02.ds.mda.ca>
Message-ID: <CADPhZXxFsUzrA76XZuaONcY9L+AAJNq7CRintbaaYZ=beptZFA@mail.gmail.com>

I believe it's possible, yes, but it will be challenging. I'm not aware of
anybody else doing this.

In
https://github.com/OSGeo/gdal/blob/trunk/gdal/swig/python/extensions/gdal_wrap.cpp
you can see examples of C++ functions that access the GDAL objects
referenced by Python objects. This isn't a stable public API by any means,
and therefore I hesitate to recommend it. Maybe Even would be able to
comment more on how much support there is for the SWIG-generated C++ Python
classes.

I presume you've already tried writing "_my_module" in Python and found it
to be too slow?

Good luck!

On Mon, Nov 27, 2017 at 9:34 AM, Shawn Gong <SGONG at mdacorporation.com>
wrote:

> Thank you Sean.
>
>
>
> What I want to do is to compile C/C++ code into "_my_c_module.pyd" and
> then to be called by Python. The Python code passes an argument to C/C++.
>
> I did previously by passing a file name (str) or a numpy array as
> argument to C/C++, and it is all good.
>
> This time I want to pass a gdal dataset as an argument:
>
>
>
> in Python:
>
>     from osgeo import gdal
>
>     import _my_c_module
>
>     ds=gdal.Open('my_filename")
>
>     result = _my_c_module.function1(ds)
>
>
>
> is this possible? If yes, how?
>
>
>
>
> Shawn
> ------------------------------
> *From:* Sean Gillies [sean at mapbox.com]
> *Sent:* November-27-17 11:09 AM
> *To:* Shawn Gong
> *Cc:* gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] pass gdal dataset as an argument from Python to
> C
>
> Shawn,
>
> PyObject and GDALDatasetH are incompatible types and you can't pass the
> former to a function that expects the latter. I'm surprised your program
> can compile with these incompatible types.
>
> Do you mean for your module to extend GDAL's Python bindings? If you look
> inside the C code of GDAL's Python bindings you may be able to see how to
> get the GDALDatasetH associated with a Python dataset object.
>
> Hope this helps,
>
>
> On Thu, Nov 23, 2017 at 1:25 PM, Shawn Gong <SGONG at mdacorporation.com>
> wrote:
>
>> Hi list,
>>
>>
>>
>> Has anyone done this before?
>>
>> I try to pass a gdal dataset as an argument from Python to C.
>>
>>
>>
>> in my C code, I have
>>
>> PyObject* py_my_func(PyObject *self, PyObject *args)
>> {
>>
>>     PyObject *poDataset;
>>
>>
>>
>>    if(!PyArg_ParseTuple(args, "Odd", &poDataset, &a1, &a2))
>>   {
>>     return NULL;
>>   }
>>
>>
>>
>>   my_func(poDataset, a1, a2);
>> }
>>
>>
>>
>> void my_func(GDALDatasetH hDataset, double a1, double a2)
>>
>> {
>>
>> }
>>
>>
>>
>> Python crashed and hDataset was NULL
>>
>> Is it possible to do or I did something wrong?
>>
>>
>>
>> BTW, I have passed either a filename or a gdal array as an argument from
>> Python to C, with success.
>>
>> Thanks,
>> Shawn
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
>
> --
> Sean Gillies
>



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171127/9489576f/attachment.html>

From even.rouault at spatialys.com  Mon Nov 27 11:10:57 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Nov 2017 20:10:57 +0100
Subject: [gdal-dev] pass gdal dataset as an argument from Python to C
In-Reply-To: <CADPhZXxFsUzrA76XZuaONcY9L+AAJNq7CRintbaaYZ=beptZFA@mail.gmail.com>
References: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>
 <7DCBC135929FF74E8A5488B1814AC6BC3FFA3653@exbermd02.ds.mda.ca>
 <CADPhZXxFsUzrA76XZuaONcY9L+AAJNq7CRintbaaYZ=beptZFA@mail.gmail.com>
Message-ID: <1930432.TdlMmKryY3@even-i700>

On lundi 27 novembre 2017 11:46:50 CET Sean Gillies wrote:
> I believe it's possible, yes, but it will be challenging. I'm not aware of
> anybody else doing this.
> 
> In
> https://github.com/OSGeo/gdal/blob/trunk/gdal/swig/python/extensions/gdal_wr
> ap.cpp you can see examples of C++ functions that access the GDAL objects
> referenced by Python objects. This isn't a stable public API by any means,
> and therefore I hesitate to recommend it. Maybe Even would be able to
> comment more on how much support there is for the SWIG-generated C++ Python
> classes.
> 

Yes should be doable by "importing" some SWIG_ methods from gdal_wrap.cpp. This might be
fragile in case the SWIG_ wrapping structures evolve.

Interesting bits:

SWIGINTERN PyObject *_wrap_Dataset_RasterXSize_get(PyObject *SWIGUNUSEDPARM(self), PyObject *args) {
  PyObject *resultobj = 0; int bLocalUseExceptionsCode = bUseExceptions;
  GDALDatasetShadow *arg1 = (GDALDatasetShadow *) 0 ;
  void *argp1 = 0 ;
  int res1 = 0 ;
  PyObject * obj0 = 0 ;
  int result;
  
  if (!PyArg_ParseTuple(args,(char *)"O:Dataset_RasterXSize_get",&obj0)) SWIG_fail;
  res1 = SWIG_ConvertPtr(obj0, &argp1,SWIGTYPE_p_GDALDatasetShadow, 0 |  0 );
  if (!SWIG_IsOK(res1)) {
    SWIG_exception_fail(SWIG_ArgError(res1), "in method '" "Dataset_RasterXSize_get" "', argument " "1"" of type '" "GDALDatasetShadow *""'"); 
  }
  arg1 = reinterpret_cast< GDALDatasetShadow * >(argp1);
  ....
}

(GDALDatasetShadow* is an alias of GDALDataset*)

static PyMethodDef SwigMethods[] = {
	 { (char *)"Dataset_RasterXSize_get", _wrap_Dataset_RasterXSize_get, METH_VARARGS, (char *)"Dataset_RasterXSize_get(Dataset self) -> int"},
}


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171127/affcf115/attachment.html>

From SGONG at mdacorporation.com  Mon Nov 27 11:45:42 2017
From: SGONG at mdacorporation.com (Shawn Gong)
Date: Mon, 27 Nov 2017 19:45:42 +0000
Subject: [gdal-dev] pass gdal dataset as an argument from Python to C
In-Reply-To: <1930432.TdlMmKryY3@even-i700>
References: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>
 <7DCBC135929FF74E8A5488B1814AC6BC3FFA3653@exbermd02.ds.mda.ca>
 <CADPhZXxFsUzrA76XZuaONcY9L+AAJNq7CRintbaaYZ=beptZFA@mail.gmail.com>,
 <1930432.TdlMmKryY3@even-i700>
Message-ID: <7DCBC135929FF74E8A5488B1814AC6BC3FFA368D@exbermd02.ds.mda.ca>

Thank you both Sean and Even.


SWIG is too complicated for me, and I will find a work around.

Shawn

________________________________
From: Even Rouault [even.rouault at spatialys.com]
Sent: November-27-17 2:10 PM
To: gdal-dev at lists.osgeo.org
Cc: Sean Gillies; Shawn Gong
Subject: Re: [gdal-dev] pass gdal dataset as an argument from Python to C


On lundi 27 novembre 2017 11:46:50 CET Sean Gillies wrote:

> I believe it's possible, yes, but it will be challenging. I'm not aware of

> anybody else doing this.

>

> In

> https://github.com/OSGeo/gdal/blob/trunk/gdal/swig/python/extensions/gdal_wr

> ap.cpp you can see examples of C++ functions that access the GDAL objects

> referenced by Python objects. This isn't a stable public API by any means,

> and therefore I hesitate to recommend it. Maybe Even would be able to

> comment more on how much support there is for the SWIG-generated C++ Python

> classes.

>



Yes should be doable by "importing" some SWIG_ methods from gdal_wrap.cpp. This might be

fragile in case the SWIG_ wrapping structures evolve.



Interesting bits:



SWIGINTERN PyObject *_wrap_Dataset_RasterXSize_get(PyObject *SWIGUNUSEDPARM(self), PyObject *args) {

PyObject *resultobj = 0; int bLocalUseExceptionsCode = bUseExceptions;

GDALDatasetShadow *arg1 = (GDALDatasetShadow *) 0 ;

void *argp1 = 0 ;

int res1 = 0 ;

PyObject * obj0 = 0 ;

int result;

if (!PyArg_ParseTuple(args,(char *)"O:Dataset_RasterXSize_get",&obj0)) SWIG_fail;

res1 = SWIG_ConvertPtr(obj0, &argp1,SWIGTYPE_p_GDALDatasetShadow, 0 | 0 );

if (!SWIG_IsOK(res1)) {

SWIG_exception_fail(SWIG_ArgError(res1), "in method '" "Dataset_RasterXSize_get" "', argument " "1"" of type '" "GDALDatasetShadow *""'");

}

arg1 = reinterpret_cast< GDALDatasetShadow * >(argp1);

....

}



(GDALDatasetShadow* is an alias of GDALDataset*)



static PyMethodDef SwigMethods[] = {

{ (char *)"Dataset_RasterXSize_get", _wrap_Dataset_RasterXSize_get, METH_VARARGS, (char *)"Dataset_RasterXSize_get(Dataset self) -> int"},

}





--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171127/d37fe410/attachment-0001.html>

From sunil.chaudhary at nwgeo.com  Mon Nov 27 13:21:01 2017
From: sunil.chaudhary at nwgeo.com (sunil.chaudhary)
Date: Mon, 27 Nov 2017 14:21:01 -0700 (MST)
Subject: [gdal-dev] How to use -dstnodata in gdalwarp
Message-ID: <1511817661651-0.post@n6.nabble.com>

Can someone give me the correct syntax on how to use -dstnodata in gdalwarp?
I'm having an issue where when I'm trying to use this option I'm getting
some unpredictable outputs

What I am trying to do is set the output no data value as black or 0, so for
my command line I put in the following: 

gdalwarp -dstnodata 0 GB_AB_z11_deflate.tif GB_AB_z11_deflate_nodata.tif

For the output what I would expect is that the black pixels would be set to
no data, what I am getting however is whenever the program see's a R value
as 0 it sets it to no data. So if I have a pixel with the value of 0 15 36
it sets the R as no data.

Am I using this parameter incorrectly, or is there a bug in the program? 
<http://osgeo-org.1560.x6.nabble.com/file/t382122/no_data1.png> 
<http://osgeo-org.1560.x6.nabble.com/file/t382122/no_data2.png> 



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From sunil.chaudhary at nwgeo.com  Mon Nov 27 13:38:55 2017
From: sunil.chaudhary at nwgeo.com (sunil.chaudhary)
Date: Mon, 27 Nov 2017 14:38:55 -0700 (MST)
Subject: [gdal-dev] How to use -dstnodata in gdalwarp
In-Reply-To: <1511817661651-0.post@n6.nabble.com>
References: <1511817661651-0.post@n6.nabble.com>
Message-ID: <1511818735551-0.post@n6.nabble.com>

I have also tried quoting the dstnodata value as "0 0 0" and I got the same
result



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Mon Nov 27 14:54:13 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Nov 2017 23:54:13 +0100
Subject: [gdal-dev] How to use -dstnodata in gdalwarp
In-Reply-To: <1511818735551-0.post@n6.nabble.com>
References: <1511817661651-0.post@n6.nabble.com>
 <1511818735551-0.post@n6.nabble.com>
Message-ID: <1824299.ck2VLmGPFP@even-i700>

On lundi 27 novembre 2017 14:38:55 CET sunil.chaudhary wrote:
> I have also tried quoting the dstnodata value as "0 0 0" and I got the same
> result

The issue is more likely on the source side.

Try adding: -srcnodata "0 0 0"
Or: -wo UNIFIED_SRC_NODATA=YES

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171127/80199a96/attachment.html>

From sunil.chaudhary at nwgeo.com  Mon Nov 27 14:56:49 2017
From: sunil.chaudhary at nwgeo.com (sunil.chaudhary)
Date: Mon, 27 Nov 2017 15:56:49 -0700 (MST)
Subject: [gdal-dev] How to use -dstnodata in gdalwarp
In-Reply-To: <1824299.ck2VLmGPFP@even-i700>
References: <1511817661651-0.post@n6.nabble.com>
 <1511818735551-0.post@n6.nabble.com> <1824299.ck2VLmGPFP@even-i700>
Message-ID: <1511823409580-0.post@n6.nabble.com>

I have tried using -srcnodata 0 but I got the same result.
I don't know about -wo UNIFIED_SRC_NODATA=YES, what exactly does that do?



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 27 22:34:10 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 27 Nov 2017 23:34:10 -0700 (MST)
Subject: [gdal-dev] How to use -dstnodata in gdalwarp
In-Reply-To: <1511823409580-0.post@n6.nabble.com>
References: <1511817661651-0.post@n6.nabble.com>
 <1511818735551-0.post@n6.nabble.com> <1824299.ck2VLmGPFP@even-i700>
 <1511823409580-0.post@n6.nabble.com>
Message-ID: <1511850850227-0.post@n6.nabble.com>

sunil.chaudhary wrote
> I have tried using -srcnodata 0 but I got the same result.
> I don't know about -wo UNIFIED_SRC_NODATA=YES, what exactly does that do?

Hi,

Read carefully what Even wrote and try exactly with -srcnodata "0 0 0".
There is a link to warpinp options in http://www.gdal.org/gdalwarp.html, the
link leads to
http://www.gdal.org/structGDALWarpOptions.html#a0ed77f9917bb96c7a9aabd73d4d06e08,
and there you can read about UNIFIES_SRC_NODATA this:

UNIFIED_SRC_NODATA=YES/NO: By default nodata masking values considered
independently for each band. However, sometimes it is desired to treat all
bands as nodata if and only if, all bands match the corresponding nodata
values. To get this behavior set this option to YES. Note:
UNIFIED_SRC_NODATA=YES is set by default, when called from gdalwarp /
GDALWarp()

-Jukka Rahkonen-



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From ari.jolma at gmail.com  Tue Nov 28 00:02:10 2017
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 28 Nov 2017 10:02:10 +0200
Subject: [gdal-dev] pass gdal dataset as an argument from Python to C
In-Reply-To: <CADPhZXxFsUzrA76XZuaONcY9L+AAJNq7CRintbaaYZ=beptZFA@mail.gmail.com>
References: <7DCBC135929FF74E8A5488B1814AC6BC3FF9B413@exbermd02.ds.mda.ca>
 <CADPhZXyEA==C3wkEMq3_Dthvmk7aJm1py3BNZWQn8=Kc4j6PWA@mail.gmail.com>
 <7DCBC135929FF74E8A5488B1814AC6BC3FFA3653@exbermd02.ds.mda.ca>
 <CADPhZXxFsUzrA76XZuaONcY9L+AAJNq7CRintbaaYZ=beptZFA@mail.gmail.com>
Message-ID: <84343291-b601-4041-b459-269b241a1710@gmail.com>

Sean Gillies kirjoitti 27.11.2017 klo 20:46:

> I believe it's possible, yes, but it will be challenging. I'm not 
> aware of anybody else doing this.

I'm doing it but in the Perl side. It's not impossible but Swig does 
wrap the C pointers quite deep into the Perl object (it must be similar 
in the Python Swig), so it needs a bit of research. However, I think it 
is a quite stable way Swig does it and it's a matter of making a typemap 
or a small function.

I think it is quite an important way to build extensions or link 
systems. In my case I needed a system computing a raster dataset (band) 
from other bands using a Bayesian network. I had built a Perl interface 
to a proprietary Bayesian network engine, and thus I needed only the the 
linkage code, which I built and is this:

https://github.com/ajolma/Geo-GDAL-Bayes-Hugin

See the typemap file for an example of a typemap (GDAL Band Perl object 
to a C GDALBandH pointer).

Ari

>
> In 
> https://github.com/OSGeo/gdal/blob/trunk/gdal/swig/python/extensions/gdal_wrap.cpp 
> you can see examples of C++ functions that access the GDAL objects 
> referenced by Python objects. This isn't a stable public API by any 
> means, and therefore I hesitate to recommend it. Maybe Even would be 
> able to comment more on how much support there is for the 
> SWIG-generated C++ Python classes.
>
> I presume you've already tried writing "_my_module" in Python and 
> found it to be too slow?
>
> Good luck!
>
> On Mon, Nov 27, 2017 at 9:34 AM, Shawn Gong <SGONG at mdacorporation.com 
> <mailto:SGONG at mdacorporation.com>> wrote:
>
>     Thank you Sean.
>
>     What I want to do is to compile C/C++ code into "_my_c_module.pyd"
>     and then to be called by Python. The Python code passes an
>     argument to C/C++.
>
>     I did previously by passing a file name (str) or a numpy array as
>     argument to C/C++, and it is all good.
>
>     This time I want to pass a gdal dataset as an argument:
>
>     in Python:
>
>         from osgeo import gdal
>
>         import _my_c_module
>
>         ds=gdal.Open('my_filename")
>
>         result = _my_c_module.function1(ds)
>
>     is this possible? If yes, how?
>
>
>     Shawn
>
>     ------------------------------------------------------------------------
>     *From:* Sean Gillies [sean at mapbox.com <mailto:sean at mapbox.com>]
>     *Sent:* November-27-17 11:09 AM
>     *To:* Shawn Gong
>     *Cc:* gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     *Subject:* Re: [gdal-dev] pass gdal dataset as an argument from
>     Python to C
>
>     Shawn,
>
>     PyObject and GDALDatasetH are incompatible types and you can't
>     pass the former to a function that expects the latter. I'm
>     surprised your program can compile with these incompatible types.
>
>     Do you mean for your module to extend GDAL's Python bindings? If
>     you look inside the C code of GDAL's Python bindings you may be
>     able to see how to get the GDALDatasetH associated with a Python
>     dataset object.
>
>     Hope this helps,
>
>
>     On Thu, Nov 23, 2017 at 1:25 PM, Shawn Gong
>     <SGONG at mdacorporation.com <mailto:SGONG at mdacorporation.com>> wrote:
>
>         Hi list,
>
>         Has anyone done this before?
>
>         I try to pass a gdal dataset as an argument from Python to C.
>
>         in my C code, I have
>
>         PyObject* py_my_func(PyObject *self, PyObject *args)
>         {
>
>             PyObject *poDataset;
>
>            if(!PyArg_ParseTuple(args, "Odd", &poDataset, &a1, &a2))
>           {
>             return NULL;
>           }
>
>           my_func(poDataset, a1, a2);
>         }
>
>         void my_func(GDALDatasetH hDataset, double a1, double a2)
>
>         {
>
>         }
>
>         Python crashed and hDataset was NULL
>
>         Is it possible to do or I did something wrong?
>
>         BTW, I have passed either a filename or a gdal array as an
>         argument from Python to C, with success.
>
>         Thanks,
>         Shawn
>
>         _______________________________________________
>         gdal-dev mailing list
>         gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>         <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>
>
>
>     -- 
>     Sean Gillies
>
>
>
>
> -- 
> Sean Gillies
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/44373d26/attachment-0001.html>

From renehh at gmail.com  Tue Nov 28 04:09:29 2017
From: renehh at gmail.com (=?UTF-8?B?UmVuw6kgSGFuc2Vu?=)
Date: Tue, 28 Nov 2017 12:09:29 +0000
Subject: [gdal-dev] Building with support for VirtualOGR
Message-ID: <CAB-60nhUfGsNn1=-roMNN60_3gm4bn35HnaTm24oZjyjUVz_=w@mail.gmail.com>

Hi all,


As the subject reveals, I'm trying to compile with SQLite support, so I can
load libgdal.so as an extension, as per the example on
http://gdal.org/drv_sqlite.html.

I'm building with the Android NDK and it succeeds, seemingly fine, but when
I load the library as an extension:

sqlite3_exec(db, "SELECT load_extension('libgdal.so',
'sqlite3_extension_init');", callback, 0, &zErrMsg);

I get an error:

"SQL error: undefined symbol: sqlite3_extension_init"

I went looking for the definition of *sqlite3_extension_init*, and it
appears to be define guarded behind
"VIRTUAL_OGR_DYNAMIC_EXTENSION_ENABLED", so I tried to rebuild with that
flag set. This is my build script:

#!/usr/bin/env bash

set -e

export PATH=$PATH:`pwd`/android-21-toolchain/bin
export COMMON_FLAGS="-mthumb -DVIRTUAL_OGR_DYNAMIC_EXTENSION_ENABLED"
export CFLAGS="$COMMON_FLAGS"
export CXXFLAGS="$COMMON_FLAGS"
export LIBS="-lsupc++ -lstdc++"

./configure --host=arm-linux-androideabi --prefix=`pwd`/external/gdal

make
make install

Scanning the symbols in the produced .so, still doesn't include anything
*sqlite3** however:

$ nm -A install/external/gdal/lib/libgdal.so | wc -l
   56967
$ nm -A install/external/gdal/lib/libgdal.so | ag sqlite3 | wc -l
       0

I've really been scratching my head over this, so what am I doing glaringly
wrong?


Best regards,

René Hansen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/7d5b4293/attachment.html>

From even.rouault at spatialys.com  Tue Nov 28 04:28:22 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 28 Nov 2017 13:28:22 +0100
Subject: [gdal-dev] Building with support for VirtualOGR
In-Reply-To: <CAB-60nhUfGsNn1=-roMNN60_3gm4bn35HnaTm24oZjyjUVz_=w@mail.gmail.com>
References: <CAB-60nhUfGsNn1=-roMNN60_3gm4bn35HnaTm24oZjyjUVz_=w@mail.gmail.com>
Message-ID: <4624140.BAU4XUmASl@even-i700>

René,

> As the subject reveals, I'm trying to compile with SQLite support, so I can
> load libgdal.so as an extension, as per the example on
> http://gdal.org/drv_sqlite.html.
> 
> I'm building with the Android NDK and it succeeds, seemingly fine, but when
> I load the library as an extension:
[...]
> I've really been scratching my head over this, so what am I doing glaringly
> wrong?

You don't have to manually define VIRTUAL_OGR_DYNAMIC_EXTENSION_ENABLED. The 
likely explanation is that configure fails to detect sqlite3. Did you check the output of the 
configure to see if there's a "SQLite support:         yes" line arround the end ?

You may need to add
--with-sqlite3=/path/to/cross/compiled/sqlite3/installation/prefix

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/5e34c594/attachment.html>

From renehh at gmail.com  Tue Nov 28 05:25:42 2017
From: renehh at gmail.com (=?UTF-8?B?UmVuw6kgSGFuc2Vu?=)
Date: Tue, 28 Nov 2017 13:25:42 +0000
Subject: [gdal-dev] Building with support for VirtualOGR
In-Reply-To: <4624140.BAU4XUmASl@even-i700>
References: <CAB-60nhUfGsNn1=-roMNN60_3gm4bn35HnaTm24oZjyjUVz_=w@mail.gmail.com>
 <4624140.BAU4XUmASl@even-i700>
Message-ID: <CAB-60niT1t+Nh5m9rQCABtBkBPn=KGQAcScttLe0SJgJde+-pw@mail.gmail.com>

Jackpot. That was it!

It's amazing what kind of blindspots you can develop, setting up cross
compilations.

Now I'm wrestling with build errors related to jpeg and jpeg12, apparently
just disabling them with --with-jpeg=no and --without-jpeg12, breaks all
kinds of other stuff.

Alas, that is a different battle. Thanks Even!


/René


On Tue, 28 Nov 2017 at 13:28 Even Rouault <even.rouault at spatialys.com>
wrote:

> René,
>
>
>
> > As the subject reveals, I'm trying to compile with SQLite support, so I
> can
>
> > load libgdal.so as an extension, as per the example on
>
> > http://gdal.org/drv_sqlite.html.
>
> >
>
> > I'm building with the Android NDK and it succeeds, seemingly fine, but
> when
>
> > I load the library as an extension:
>
> [...]
>
> > I've really been scratching my head over this, so what am I doing
> glaringly
>
> > wrong?
>
>
>
> You don't have to manually define VIRTUAL_OGR_DYNAMIC_EXTENSION_ENABLED.
> The likely explanation is that configure fails to detect sqlite3. Did you
> check the output of the configure to see if there's a "SQLite support: yes"
> line arround the end ?
>
>
>
> You may need to add
>
> --with-sqlite3=/path/to/cross/compiled/sqlite3/installation/prefix
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/5de178ea/attachment.html>

From renehh at gmail.com  Tue Nov 28 05:54:35 2017
From: renehh at gmail.com (=?UTF-8?B?UmVuw6kgSGFuc2Vu?=)
Date: Tue, 28 Nov 2017 13:54:35 +0000
Subject: [gdal-dev] Building with support for VirtualOGR
In-Reply-To: <CAB-60niT1t+Nh5m9rQCABtBkBPn=KGQAcScttLe0SJgJde+-pw@mail.gmail.com>
References: <CAB-60nhUfGsNn1=-roMNN60_3gm4bn35HnaTm24oZjyjUVz_=w@mail.gmail.com>
 <4624140.BAU4XUmASl@even-i700>
 <CAB-60niT1t+Nh5m9rQCABtBkBPn=KGQAcScttLe0SJgJde+-pw@mail.gmail.com>
Message-ID: <CAB-60ngLOqTayJTtf-SPBzmY9vYtjwAvid70zZAHY9HOxVRKzQ@mail.gmail.com>

For future reference, this was the winning combination to get through a
make/install, with the Android NDK for me:

./configure --host=arm-linux-androideabi
--prefix=`pwd`/install/external/gdal \
  --with-sqlite3=/path/to/sqlite/xcompilation \
  --with-jpeg=internal \
  --without-jpeg12

Now I've got sqlite3 symbols defined aplenty:

$ nm -A install/external/gdal/lib/libgdal.so | ag sqlite3 | wc -l
     194

Thanks again!

/René

On Tue, 28 Nov 2017 at 14:25 René Hansen <renehh at gmail.com> wrote:

> Jackpot. That was it!
>
> It's amazing what kind of blindspots you can develop, setting up cross
> compilations.
>
> Now I'm wrestling with build errors related to jpeg and jpeg12, apparently
> just disabling them with --with-jpeg=no and --without-jpeg12, breaks all
> kinds of other stuff.
>
> Alas, that is a different battle. Thanks Even!
>
>
> /René
>
>
> On Tue, 28 Nov 2017 at 13:28 Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> René,
>>
>>
>>
>> > As the subject reveals, I'm trying to compile with SQLite support, so I
>> can
>>
>> > load libgdal.so as an extension, as per the example on
>>
>> > http://gdal.org/drv_sqlite.html.
>>
>> >
>>
>> > I'm building with the Android NDK and it succeeds, seemingly fine, but
>> when
>>
>> > I load the library as an extension:
>>
>> [...]
>>
>> > I've really been scratching my head over this, so what am I doing
>> glaringly
>>
>> > wrong?
>>
>>
>>
>> You don't have to manually define VIRTUAL_OGR_DYNAMIC_EXTENSION_ENABLED.
>> The likely explanation is that configure fails to detect sqlite3. Did you
>> check the output of the configure to see if there's a "SQLite support: yes"
>> line arround the end ?
>>
>>
>>
>> You may need to add
>>
>> --with-sqlite3=/path/to/cross/compiled/sqlite3/installation/prefix
>>
>>
>>
>> Even
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/40cd2d23/attachment-0001.html>

From victor at amigocloud.com  Tue Nov 28 15:00:11 2017
From: victor at amigocloud.com (Victor Chernetsky)
Date: Tue, 28 Nov 2017 15:00:11 -0800
Subject: [gdal-dev]  Question about command line options -append
Message-ID: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>

Hello,

How do I get value/state of a command line option of ogr2ogr. For instance
I want to handle options like -append, -update inside of my DataSource
class? Is there a documentation about it?

Thanks,
*Victor Chernetsky*

+1 (408) 368-4607
victor at amigocloud.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/0f9e3565/attachment.html>

From even.rouault at spatialys.com  Tue Nov 28 15:15:40 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 Nov 2017 00:15:40 +0100
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
Message-ID: <5486947.oQo7sa8ony@even-i700>

On mardi 28 novembre 2017 15:00:11 CET Victor Chernetsky wrote:
> Hello,
> 
> How do I get value/state of a command line option of ogr2ogr. For instance
> I want to handle options like -append, -update inside of my DataSource
> class? Is there a documentation about it?

Victor,

-append and -update are just ways of operating of ogr2ogr and the drivers are not aware of 
them. The consequence are just how ogr2ogr use the driver API.

* -update: open the dataset in update mode

* -append imply -update, and instruct ogr2ogr to reuse exisisting layers instead of erroring 
out if they exist.

In both cases, features will get inserted through ICreateFeature()

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/02135cbb/attachment.html>

From victor at amigocloud.com  Tue Nov 28 15:20:20 2017
From: victor at amigocloud.com (Victor Chernetsky)
Date: Tue, 28 Nov 2017 15:20:20 -0800
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <5486947.oQo7sa8ony@even-i700>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <5486947.oQo7sa8ony@even-i700>
Message-ID: <CAGhxFKVJZcEzYPk2M8KpF5ri_qWT=cJM4_bcCeQTsqw6Pay5ZQ@mail.gmail.com>

Hi Even,

Then in my driver, how do I know if I have to append data to existing
dataset, or overwrite existing data, or create a new dataset all together?

What about -overwrite option?

Thanks,

*Victor Chernetsky*


+1 (408) 368-4607
victor at amigocloud.com

On Tue, Nov 28, 2017 at 3:15 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 28 novembre 2017 15:00:11 CET Victor Chernetsky wrote:
>
> > Hello,
>
> >
>
> > How do I get value/state of a command line option of ogr2ogr. For
> instance
>
> > I want to handle options like -append, -update inside of my DataSource
>
> > class? Is there a documentation about it?
>
>
>
> Victor,
>
>
>
> -append and -update are just ways of operating of ogr2ogr and the drivers
> are not aware of them. The consequence are just how ogr2ogr use the driver
> API.
>
>
>
> * -update: open the dataset in update mode
>
>
>
> * -append imply -update, and instruct ogr2ogr to reuse exisisting layers
> instead of erroring out if they exist.
>
>
>
> In both cases, features will get inserted through ICreateFeature()
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/680f68d1/attachment.html>

From even.rouault at spatialys.com  Tue Nov 28 15:30:11 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 Nov 2017 00:30:11 +0100
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <CAGhxFKVJZcEzYPk2M8KpF5ri_qWT=cJM4_bcCeQTsqw6Pay5ZQ@mail.gmail.com>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <5486947.oQo7sa8ony@even-i700>
 <CAGhxFKVJZcEzYPk2M8KpF5ri_qWT=cJM4_bcCeQTsqw6Pay5ZQ@mail.gmail.com>
Message-ID: <2930727.YVHMchzVpP@even-i700>

On mardi 28 novembre 2017 15:20:20 CET Victor Chernetsky wrote:
> Hi Even,
> 
> Then in my driver, how do I know if I have to append data to existing
> dataset, 
> or overwrite existing data, or create a new dataset all together?

That should work automagically if you correctly implement the semantics of the 
relevant dataset and layer virtual methods

If the user doesn't specify -append or -overwrite, but just -update, and the layer doesn't exist, 
then ogr2ogr will call GDALDataset::ICreateLayer()

> 
> What about -overwrite option?

If the user specify -overwrite, then ogr2ogr will call GDALDataset::DeleteLayer(), and then 
ICreateLayer()

Looking quickly at the amigocloud driver, everything looks in place already.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/db424625/attachment.html>

From victor at amigocloud.com  Tue Nov 28 15:40:46 2017
From: victor at amigocloud.com (Victor Chernetsky)
Date: Tue, 28 Nov 2017 15:40:46 -0800
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <2930727.YVHMchzVpP@even-i700>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <5486947.oQo7sa8ony@even-i700>
 <CAGhxFKVJZcEzYPk2M8KpF5ri_qWT=cJM4_bcCeQTsqw6Pay5ZQ@mail.gmail.com>
 <2930727.YVHMchzVpP@even-i700>
Message-ID: <CAGhxFKU1d2f2Qjei26qQwE9tezt6pYLBtn_LzJn1O3554DQ2eg@mail.gmail.com>

Here is my example:
ogr2ogr -overwrite -f AmigoCloud "AmigoCloud:15276 datasets=100056"
~/Downloads/Visits.geojson

I am trying to append, or overwrite data into existing dataset id:100056.
But it still created a new dataset, and it did not delete/clean old
dataset. I am thinking I need to do something in
my OGRAmigoCloudDataSource::ICreateLayer(). I am not checking if dataset
exist. I always create a new one.

How should I handle this case?


*Victor Chernetsky*


+1 (408) 368-4607
victor at amigocloud.com

On Tue, Nov 28, 2017 at 3:30 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 28 novembre 2017 15:20:20 CET Victor Chernetsky wrote:
>
> > Hi Even,
>
> >
>
> > Then in my driver, how do I know if I have to append data to existing
>
> > dataset,
>
> > or overwrite existing data, or create a new dataset all together?
>
>
>
> That should work automagically if you correctly implement the semantics of
> the
>
> relevant dataset and layer virtual methods
>
>
>
> If the user doesn't specify -append or -overwrite, but just -update, and
> the layer doesn't exist, then ogr2ogr will call GDALDataset::ICreateLayer()
>
>
>
> >
>
> > What about -overwrite option?
>
>
>
> If the user specify -overwrite, then ogr2ogr will call
> GDALDataset::DeleteLayer(), and then ICreateLayer()
>
>
>
> Looking quickly at the amigocloud driver, everything looks in place
> already.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/91842b98/attachment-0001.html>

From even.rouault at spatialys.com  Tue Nov 28 16:01:42 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 Nov 2017 01:01:42 +0100
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <CAGhxFKU1d2f2Qjei26qQwE9tezt6pYLBtn_LzJn1O3554DQ2eg@mail.gmail.com>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <2930727.YVHMchzVpP@even-i700>
 <CAGhxFKU1d2f2Qjei26qQwE9tezt6pYLBtn_LzJn1O3554DQ2eg@mail.gmail.com>
Message-ID: <9910573.csnDsC4sIZ@even-i700>

On mardi 28 novembre 2017 15:40:46 CET Victor Chernetsky wrote:
> Here is my example:
> ogr2ogr -overwrite -f AmigoCloud "AmigoCloud:15276 datasets=100056"
> ~/Downloads/Visits.geojson
> 
> I am trying to append, or overwrite data into existing dataset id:100056.
> But it still created a new dataset, and it did not delete/clean old
> dataset.

-overwrite overwrite *layers* not datasets
Here it will probably create a new layer because the layer name of Visits.geojson
must be "Visits" and probably doesn't exist yet in your dataset.

If you want to overwrite an existing layer foo with the geojson, you must add "-nln foo"

> I am thinking I need to do something in
> my OGRAmigoCloudDataSource::ICreateLayer(). I am not checking if dataset
> exist. I always create a new one.

You can have a look at the ogr2ogr logic to decide how to overwrite a layer:
https://github.com/OSGeo/gdal/blob/trunk/gdal/apps/ogr2ogr_lib.cpp#L3180

For non-ogr2ogr clients, you could indeed add a check if a layer of same name already exists
A number of drivers also support a OVERWRITE=YES layer creation option
See 
https://github.com/OSGeo/gdal/blob/trunk/gdal/ogr/ogrsf_frmts/carto/ogrcartodatasource.cpp#L412

The advantage when you write an example is that you have tens of examples to get inspiration from ;-)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/ea8e9ff0/attachment.html>

From victor at amigocloud.com  Tue Nov 28 16:26:39 2017
From: victor at amigocloud.com (Victor Chernetsky)
Date: Tue, 28 Nov 2017 16:26:39 -0800
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <9910573.csnDsC4sIZ@even-i700>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <2930727.YVHMchzVpP@even-i700>
 <CAGhxFKU1d2f2Qjei26qQwE9tezt6pYLBtn_LzJn1O3554DQ2eg@mail.gmail.com>
 <9910573.csnDsC4sIZ@even-i700>
Message-ID: <CAGhxFKXP6eV0aCOE+dgDgV1rtw1PH4OigShTGs=t1oHNod4edA@mail.gmail.com>

Thanks, this helps!

The thing is I cannot really use layer name to identify an AmigoCloud
dataset. In AmigoCloud we have names, but they are not guarantied to be
unique. We use dataset Id to identify a dataset (ogr layer) instead. In my
example "Visits" it's just a name of the source data file, which gdal uses
as a layer name. This is fine, but for destination AmigoCloud dataset I
specify a dataset id explicitly anyway. So I know my destination dataset,
and if it exists or not. I think with the info I have now I could do few
small changes to handle these cases.



*Victor Chernetsky*


+1 (408) 368-4607
victor at amigocloud.com

On Tue, Nov 28, 2017 at 4:01 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 28 novembre 2017 15:40:46 CET Victor Chernetsky wrote:
>
> > Here is my example:
>
> > ogr2ogr -overwrite -f AmigoCloud "AmigoCloud:15276 datasets=100056"
>
> > ~/Downloads/Visits.geojson
>
> >
>
> > I am trying to append, or overwrite data into existing dataset id:100056.
>
> > But it still created a new dataset, and it did not delete/clean old
>
> > dataset.
>
>
>
> -overwrite overwrite *layers* not datasets
>
> Here it will probably create a new layer because the layer name of
> Visits.geojson
>
> must be "Visits" and probably doesn't exist yet in your dataset.
>
>
>
> If you want to overwrite an existing layer foo with the geojson, you must
> add "-nln foo"
>
>
>
> > I am thinking I need to do something in
>
> > my OGRAmigoCloudDataSource::ICreateLayer(). I am not checking if dataset
>
> > exist. I always create a new one.
>
>
>
> You can have a look at the ogr2ogr logic to decide how to overwrite a
> layer:
>
> https://github.com/OSGeo/gdal/blob/trunk/gdal/apps/ogr2ogr_lib.cpp#L3180
>
>
>
> For non-ogr2ogr clients, you could indeed add a check if a layer of same
> name already exists
>
> A number of drivers also support a OVERWRITE=YES layer creation option
>
> See
>
> https://github.com/OSGeo/gdal/blob/trunk/gdal/ogr/ogrsf_frmts/carto/
> ogrcartodatasource.cpp#L412
>
>
>
> The advantage when you write an example is that you have tens of examples
> to get inspiration from ;-)
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/338c93fb/attachment.html>

From larry at shafferinteractive.com  Tue Nov 28 21:03:29 2017
From: larry at shafferinteractive.com (Larry Shaffer)
Date: Tue, 28 Nov 2017 22:03:29 -0700
Subject: [gdal-dev] About CMake build again
In-Reply-To: <CABUeae9jEtS2k3e49K6xF5md6B1kcEHnOOar1677s4K_Mb0L9w@mail.gmail.com>
References: <24279829-bc4c-cb12-03c6-2e13282f841b@gmail.com>
 <2354612.titQqOS24Y@even-i700>
 <CABUeae9jEtS2k3e49K6xF5md6B1kcEHnOOar1677s4K_Mb0L9w@mail.gmail.com>
Message-ID: <CA+nQOR9=Fe_r3=wETA_D5=joNYwbPASqPa48HKHV6AvuuQqOGQ@mail.gmail.com>

Hi All,

Apologies for top-posting, albeit the thread has stopped for ~month.

While I have not contributed that much to the GDAL project over the years,
I have build it a LOT (mostly on Win and macOS [0]). Switching to CMake
would be a good future-proof, cross-platform move, even if it is overly
verbose at times.

My concern, like others noted here, is that it will not necessarily be
greatly advantageous over the current build scripts. Unless... such an
endeavor leveraged some of CMake's more useful features, namely ease of
defining inter-library pre- or post-build-time dependencies, and external
projects.

*Make drivers plugins*
One of my biggest frustrations with building (and rebuilding) libgdal comes
from the default opportunistic way it finds and links against external libs
when configuring. Sure driver building can be controlled with options, but
why do I need to do this to build the *base* library? If libgdal was rarely
built and all drivers loaded as drivers, programs like QGIS wouldn't crash
because some obscure driver's lib changed (happens often with Homebrew).
This prompts a required rebuild of libgdal again.

I realize that this will take some extra work, and loading all drivers as
plugins may reduce some performance metric(s). The resulting CMake
configure options, though, could be specific to driver, not library, e.g.
-D GDAL_MRSID=ON would generate that plugin, building only the main libgdal
binary and any other dependent lib or driver plugins (none here) as needed.
Build time would be minimal, with the plugin immediately available for
distribution packaging.

Surely I'm not the only person who would love to see this, and CMake
porting would be the ideal time to craft this.

*External projects*
While Borsch has some awesome features, it currently requires out-of-tree
resources. If building GDAL with all dependencies local, like may be
required for a full static iOS build, is a goal, then the existing CMake
ExternalProject feature can be leveraged. A fine example of this is the
SuperBuild aspect of Orfeo ToolBox [1]. Such a setup could existing in-tree
for GDAL, though there is obvious overhead in maintaining
ExternalProject build scripts for many libs; so, maybe only for a standard
set makes sense.


Btw, CMake works very well on macOS and is my preferred build tool,
especially when used with Ninja generator.  :^)

[0] https://github.com/OSGeo/homebrew-osgeo4mac/tree/master/Formula
[1] https://github.com/orfeotoolbox/OTB/tree/develop/SuperBuild

Regards,

Larry Shaffer
Dakota Cartography
Black Hills, South Dakota
----------------------------------
Boundless Desktop and QGIS Support/Development
Boundless Spatial - http://boundlessgeo.com
lshaffer at boundlessgeo.com

On Tue, Oct 31, 2017 at 5:54 AM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 30 October 2017 at 23:14, Even Rouault <even.rouault at spatialys.com>
> wrote:
> >
> > Trying to sum up my thoughts on this topic and answering to various
> points
> > raised in this discussion thread:
> >
> > - I believe a relevant question to ask to ourselves would be:
> > "imagine that GDAL would come without any build system at all, what is
> the one that we would add" ?
>
> Assuming multi-platform is the critical requirement, there are no real
> altenratives that beat CMake.
>
> > Ok, that's a bit silly to turn the question like that, a more
> > realistic one would be
> > "imagine you're going to create a software that will rule over the
> world, for the 20 next years
> > and beyond, and should run on all reasonable platforms, which build
> system would we use?
>
> IMHO, answer to that is:
> First, write portable code in build system agnostic way:
> - Stick to C/C++ standard libraries as much as possible
> - Stick to vanila preprocessor magic to handle C/C++ library
> differences and incompatibilities.
> - Eliminate or platform-specific generated headers (or keep it small,
> one for all)
> Then, choose multi-platfor build system and keep build configuration
> scripts *small*.
>
> That will make it easy to compile the code with any build system
> current user wants to use
> or any build system the project will switch over to in future, if
> necessary.
>
> > If the answer is clearly "cmake", then it is worth examining if there is
> not a path that
> > would lead us to that point.
>
> No, the anwer is not "clearly cmake".
> CMake is great because it's multi-platform, it is available virtually
> everywhere and easy to install.
> CMake is terrible because it did not develop any best practices or
> conventions regarding how
> a perfect build configuration should be developed with CMake. That
> historically led to home grown,
> overgrown, bloated piles of CMake scripts specific to projects that
> require maintenance on its own.
> Even worse, many of those badly written scripts made it into CMake
> distribution as FindXXX.cmake
> modules, and CMake team did not reject or unify them.
> The freedom led to ecosystem of numerous distinct build monsters
> governed by specific conventions
> based on CMake like ECM from KDE, BCM from Boost, and Borsch fall
> sinto similar category, I think.
> Naturally, GDAL would grown its own, beause CMake is rubbish :-)
>
> An ideal build configuration scripts should be small, even for a large
> project.
> Here is example of such setup proposed for Boost
> https://github.com/ned14/boost-bmv-cmake
> There is no pile of custom CMake macros or modules provided and that
> is an ideal :)
>
> > Similar question: is it an effort that will make GDAL development a bit
> > easier for new contributors?
>
> Perhaps, potentially, may be.
> Certainly, CMake makes development friendly for use with modern IDEs.
>
> > A nice side effect could also be the opportunity to drop some cruft that
> has
> > accumulated over years in the current build systems (supporting ancient
> > library versions that no longer make sense)
>
> Dropping existing cruft is good.
> Replacing cruft with new CMake cruft is bad idea.
> Unfortunately, in most cases I've seen that is what happens when a
> project migrates to CMake.
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171128/e184d31c/attachment-0001.html>

From howard at hobu.co  Wed Nov 29 09:47:28 2017
From: howard at hobu.co (Howard Butler)
Date: Wed, 29 Nov 2017 11:47:28 -0600
Subject: [gdal-dev] About CMake build again
In-Reply-To: <CA+nQOR9=Fe_r3=wETA_D5=joNYwbPASqPa48HKHV6AvuuQqOGQ@mail.gmail.com>
References: <24279829-bc4c-cb12-03c6-2e13282f841b@gmail.com>
 <2354612.titQqOS24Y@even-i700>
 <CABUeae9jEtS2k3e49K6xF5md6B1kcEHnOOar1677s4K_Mb0L9w@mail.gmail.com>
 <CA+nQOR9=Fe_r3=wETA_D5=joNYwbPASqPa48HKHV6AvuuQqOGQ@mail.gmail.com>
Message-ID: <6a789e1f-3f2b-5a73-c34e-a0eff0a065e6@hobu.co>

Larry,

I agree that CMake brings some nice and useful features to the table. We
use it for PDAL, but we started out with CMake so there was no migration
that needed to be made.

CMake for GDAL is a project sustainment issue much more than a
technology switch and a patch. A person or a group of persons needs to
step forward to provide the patches that implement CMake support, and
then that group needs to stick around and keep it up in parallel to the
existing build systems for a while (three major releases?) as all of the
issues with it are identified and resolved. It would be a slog. That
group has to want it bad to bring it over the finish line.

That effort would have to compete against doing nothing, which every
packaging system that packages GDAL has already plumbed and stitched
around to make work. It is a tough sale. Does CMake have so many
compelling features, protections, and conveniences to make it worth it?
The project needs to answer that question for itself by trying it in
parallel with what it is already doing.

Finally, CMake is aggressive about deprecating features, its language is
often just as arbitrary as the much hated autotools/automake stack, and
it is now on its third attempt to regularize dependency detection for
projects.  The deprecations mean significant configuration churn, and
the dependency detection one is probably the most painful -- especially
for projects that have been around a long time. These challenges mean
trading one set of known annoyances with the current build stack for an
unknown-to-the-project set. The problem is that a try-it-and-see cost to
get started with such a substantial project as GDAL is very high.

Howard


On 11/28/17 11:03 PM, Larry Shaffer wrote:
> Hi All,
>
> Apologies for top-posting, albeit the thread has stopped for ~month.
>
> While I have not contributed that much to the GDAL project over the years,
> I have build it a LOT (mostly on Win and macOS [0]). Switching to CMake
> would be a good future-proof, cross-platform move, even if it is overly
> verbose at times.
>
> My concern, like others noted here, is that it will not necessarily be
> greatly advantageous over the current build scripts. Unless... such an
> endeavor leveraged some of CMake's more useful features, namely ease of
> defining inter-library pre- or post-build-time dependencies, and external
> projects.
>
> *Make drivers plugins*
> One of my biggest frustrations with building (and rebuilding) libgdal comes
> from the default opportunistic way it finds and links against external libs
> when configuring. Sure driver building can be controlled with options, but
> why do I need to do this to build the *base* library? If libgdal was rarely
> built and all drivers loaded as drivers, programs like QGIS wouldn't crash
> because some obscure driver's lib changed (happens often with Homebrew).
> This prompts a required rebuild of libgdal again.
>
> I realize that this will take some extra work, and loading all drivers as
> plugins may reduce some performance metric(s). The resulting CMake
> configure options, though, could be specific to driver, not library, e.g.
> -D GDAL_MRSID=ON would generate that plugin, building only the main libgdal
> binary and any other dependent lib or driver plugins (none here) as needed.
> Build time would be minimal, with the plugin immediately available for
> distribution packaging.
>
> Surely I'm not the only person who would love to see this, and CMake
> porting would be the ideal time to craft this.
>
> *External projects*
> While Borsch has some awesome features, it currently requires out-of-tree
> resources. If building GDAL with all dependencies local, like may be
> required for a full static iOS build, is a goal, then the existing CMake
> ExternalProject feature can be leveraged. A fine example of this is the
> SuperBuild aspect of Orfeo ToolBox [1]. Such a setup could existing in-tree
> for GDAL, though there is obvious overhead in maintaining
> ExternalProject build scripts for many libs; so, maybe only for a standard
> set makes sense.
>
>
> Btw, CMake works very well on macOS and is my preferred build tool,
> especially when used with Ninja generator.  :^)
>
> [0] https://github.com/OSGeo/homebrew-osgeo4mac/tree/master/Formula
> [1] https://github.com/orfeotoolbox/OTB/tree/develop/SuperBuild
>
> Regards,
>
> Larry Shaffer
> Dakota Cartography
> Black Hills, South Dakota
> ----------------------------------
> Boundless Desktop and QGIS Support/Development
> Boundless Spatial - http://boundlessgeo.com
> lshaffer at boundlessgeo.com
>
> On Tue, Oct 31, 2017 at 5:54 AM, Mateusz Loskot <mateusz at loskot.net> wrote:
>
>> On 30 October 2017 at 23:14, Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>> Trying to sum up my thoughts on this topic and answering to various
>> points
>>> raised in this discussion thread:
>>>
>>> - I believe a relevant question to ask to ourselves would be:
>>> "imagine that GDAL would come without any build system at all, what is
>> the one that we would add" ?
>>
>> Assuming multi-platform is the critical requirement, there are no real
>> altenratives that beat CMake.
>>
>>> Ok, that's a bit silly to turn the question like that, a more
>>> realistic one would be
>>> "imagine you're going to create a software that will rule over the
>> world, for the 20 next years
>>> and beyond, and should run on all reasonable platforms, which build
>> system would we use?
>>
>> IMHO, answer to that is:
>> First, write portable code in build system agnostic way:
>> - Stick to C/C++ standard libraries as much as possible
>> - Stick to vanila preprocessor magic to handle C/C++ library
>> differences and incompatibilities.
>> - Eliminate or platform-specific generated headers (or keep it small,
>> one for all)
>> Then, choose multi-platfor build system and keep build configuration
>> scripts *small*.
>>
>> That will make it easy to compile the code with any build system
>> current user wants to use
>> or any build system the project will switch over to in future, if
>> necessary.
>>
>>> If the answer is clearly "cmake", then it is worth examining if there is
>> not a path that
>>> would lead us to that point.
>> No, the anwer is not "clearly cmake".
>> CMake is great because it's multi-platform, it is available virtually
>> everywhere and easy to install.
>> CMake is terrible because it did not develop any best practices or
>> conventions regarding how
>> a perfect build configuration should be developed with CMake. That
>> historically led to home grown,
>> overgrown, bloated piles of CMake scripts specific to projects that
>> require maintenance on its own.
>> Even worse, many of those badly written scripts made it into CMake
>> distribution as FindXXX.cmake
>> modules, and CMake team did not reject or unify them.
>> The freedom led to ecosystem of numerous distinct build monsters
>> governed by specific conventions
>> based on CMake like ECM from KDE, BCM from Boost, and Borsch fall
>> sinto similar category, I think.
>> Naturally, GDAL would grown its own, beause CMake is rubbish :-)
>>
>> An ideal build configuration scripts should be small, even for a large
>> project.
>> Here is example of such setup proposed for Boost
>> https://github.com/ned14/boost-bmv-cmake
>> There is no pile of custom CMake macros or modules provided and that
>> is an ideal :)
>>
>>> Similar question: is it an effort that will make GDAL development a bit
>>> easier for new contributors?
>> Perhaps, potentially, may be.
>> Certainly, CMake makes development friendly for use with modern IDEs.
>>
>>> A nice side effect could also be the opportunity to drop some cruft that
>> has
>>> accumulated over years in the current build systems (supporting ancient
>>> library versions that no longer make sense)
>> Dropping existing cruft is good.
>> Replacing cruft with new CMake cruft is bad idea.
>> Unfortunately, in most cases I've seen that is what happens when a
>> project migrates to CMake.
>>
>> Best regards,
>> --
>> Mateusz Loskot, http://mateusz.loskot.net
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 548 bytes
Desc: OpenPGP digital signature
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/934a4c2f/attachment.sig>

From schwehr at gmail.com  Wed Nov 29 10:39:39 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 29 Nov 2017 10:39:39 -0800
Subject: [gdal-dev] About CMake build again
In-Reply-To: <6a789e1f-3f2b-5a73-c34e-a0eff0a065e6@hobu.co>
References: <24279829-bc4c-cb12-03c6-2e13282f841b@gmail.com>
 <2354612.titQqOS24Y@even-i700>
 <CABUeae9jEtS2k3e49K6xF5md6B1kcEHnOOar1677s4K_Mb0L9w@mail.gmail.com>
 <CA+nQOR9=Fe_r3=wETA_D5=joNYwbPASqPa48HKHV6AvuuQqOGQ@mail.gmail.com>
 <6a789e1f-3f2b-5a73-c34e-a0eff0a065e6@hobu.co>
Message-ID: <CACmBxytKU-7ttE6ors_GEzq9nT_noy4-YGovf2AK=0RbQ-DCSw@mail.gmail.com>

+1 to what Howard said.

Two thoughts... (and I'm not saying CMake is any worse than autoconf)

Alternative build systems:

I co-maintain (mostly just me) a bazel build of GDAL (including autotest2,
expat, geos, hdf4, hdf5, hdfeos, kakadu, libgeotiff, libgif, libpng,
libtiff, netcdf, jpeg, proj, sqlite, zlib, and some other stuff).  It's
exhausting, but it's critical for my business needs. I'm happy to share
parts of it if anyone wants.  bazel has lots of great features.  It scales
well with parallelization (> 5K build targets with 10's of thousands of
source files), does ci well, lets me query the tree (love the DAG
<https://en.wikipedia.org/wiki/Directed_acyclic_graph>), and I get to "live
at head".  I've added a few patches to GDAL to make it easier for my
parallel universe, but the burden is on me and the other folks in that same
space, not the core of GDAL.  bazel isn't about the flexibility that many
packagers of GDAL want and sometimes require.

Make drivers plugins:

You talk about the issues of homebrew and crashing with changes due to
other libs:  That's a design tradeoff that homebrew took and why I'm still
living in fink for that kind of world (bias: I have fink commit access).  A
massively plugin world is going to make things even more messy for folks
would do actually make sure that requirements are met.  In fink, we try
(yeah, it's hard) to force / check ABI compatibility so that you get those
types of issues less often.  But that has little to do with the build
system.  I worry that more plugs means that end users will have more
targets for disaster and packagers have more nodes to worry about.  I
suggest watching CppCon 2017: Titus Winters “C++ as a "Live at Head"
Language” <https://www.youtube.com/watch?v=tISy7EJQPzI> and thinking hard
about the ABI issues he discusses.

I did separate out most of port/ into a separate library in my bazel world
to speed up and reduce the footprint of some autotest2 tests
<https://github.com/schwehr/gdal-autotest2/tree/master/cpp/port>.  It would
be nice to be able to layer more.  e.g.  I'd love to have a
GDALCoreRegister and GDALAllRegister, where core was the minimum set of
drivers and GDALAllRegister lived in a separate lib with the rest of the
drivers.  But plugins?  Can homebrew have a binary cache like
fink/macports?  Or does the design preclude that?


On Wed, Nov 29, 2017 at 9:47 AM, Howard Butler <howard at hobu.co> wrote:

> Larry,
>
> I agree that CMake brings some nice and useful features to the table. We
> use it for PDAL, but we started out with CMake so there was no migration
> that needed to be made.
>
> CMake for GDAL is a project sustainment issue much more than a
> technology switch and a patch. A person or a group of persons needs to
> step forward to provide the patches that implement CMake support, and
> then that group needs to stick around and keep it up in parallel to the
> existing build systems for a while (three major releases?) as all of the
> issues with it are identified and resolved. It would be a slog. That
> group has to want it bad to bring it over the finish line.
>
> That effort would have to compete against doing nothing, which every
> packaging system that packages GDAL has already plumbed and stitched
> around to make work. It is a tough sale. Does CMake have so many
> compelling features, protections, and conveniences to make it worth it?
> The project needs to answer that question for itself by trying it in
> parallel with what it is already doing.
>
> Finally, CMake is aggressive about deprecating features, its language is
> often just as arbitrary as the much hated autotools/automake stack, and
> it is now on its third attempt to regularize dependency detection for
> projects.  The deprecations mean significant configuration churn, and
> the dependency detection one is probably the most painful -- especially
> for projects that have been around a long time. These challenges mean
> trading one set of known annoyances with the current build stack for an
> unknown-to-the-project set. The problem is that a try-it-and-see cost to
> get started with such a substantial project as GDAL is very high.
>
> Howard
>
>
> On 11/28/17 11:03 PM, Larry Shaffer wrote:
> > Hi All,
> >
> > Apologies for top-posting, albeit the thread has stopped for ~month.
> >
> > While I have not contributed that much to the GDAL project over the
> years,
> > I have build it a LOT (mostly on Win and macOS [0]). Switching to CMake
> > would be a good future-proof, cross-platform move, even if it is overly
> > verbose at times.
> >
> > My concern, like others noted here, is that it will not necessarily be
> > greatly advantageous over the current build scripts. Unless... such an
> > endeavor leveraged some of CMake's more useful features, namely ease of
> > defining inter-library pre- or post-build-time dependencies, and external
> > projects.
> >
> > *Make drivers plugins*
> > One of my biggest frustrations with building (and rebuilding) libgdal
> comes
> > from the default opportunistic way it finds and links against external
> libs
> > when configuring. Sure driver building can be controlled with options,
> but
> > why do I need to do this to build the *base* library? If libgdal was
> rarely
> > built and all drivers loaded as drivers, programs like QGIS wouldn't
> crash
> > because some obscure driver's lib changed (happens often with Homebrew).
> > This prompts a required rebuild of libgdal again.
> >
> > I realize that this will take some extra work, and loading all drivers as
> > plugins may reduce some performance metric(s). The resulting CMake
> > configure options, though, could be specific to driver, not library, e.g.
> > -D GDAL_MRSID=ON would generate that plugin, building only the main
> libgdal
> > binary and any other dependent lib or driver plugins (none here) as
> needed.
> > Build time would be minimal, with the plugin immediately available for
> > distribution packaging.
> >
> > Surely I'm not the only person who would love to see this, and CMake
> > porting would be the ideal time to craft this.
> >
> > *External projects*
> > While Borsch has some awesome features, it currently requires out-of-tree
> > resources. If building GDAL with all dependencies local, like may be
> > required for a full static iOS build, is a goal, then the existing CMake
> > ExternalProject feature can be leveraged. A fine example of this is the
> > SuperBuild aspect of Orfeo ToolBox [1]. Such a setup could existing
> in-tree
> > for GDAL, though there is obvious overhead in maintaining
> > ExternalProject build scripts for many libs; so, maybe only for a
> standard
> > set makes sense.
> >
> >
> > Btw, CMake works very well on macOS and is my preferred build tool,
> > especially when used with Ninja generator.  :^)
> >
> > [0] https://github.com/OSGeo/homebrew-osgeo4mac/tree/master/Formula
> > [1] https://github.com/orfeotoolbox/OTB/tree/develop/SuperBuild
> >
> > Regards,
> >
> > Larry Shaffer
> > Dakota Cartography
> > Black Hills, South Dakota
> > ----------------------------------
> > Boundless Desktop and QGIS Support/Development
> > Boundless Spatial - http://boundlessgeo.com
> > lshaffer at boundlessgeo.com
> >
> > On Tue, Oct 31, 2017 at 5:54 AM, Mateusz Loskot <mateusz at loskot.net>
> wrote:
> >
> >> On 30 October 2017 at 23:14, Even Rouault <even.rouault at spatialys.com>
> >> wrote:
> >>> Trying to sum up my thoughts on this topic and answering to various
> >> points
> >>> raised in this discussion thread:
> >>>
> >>> - I believe a relevant question to ask to ourselves would be:
> >>> "imagine that GDAL would come without any build system at all, what is
> >> the one that we would add" ?
> >>
> >> Assuming multi-platform is the critical requirement, there are no real
> >> altenratives that beat CMake.
> >>
> >>> Ok, that's a bit silly to turn the question like that, a more
> >>> realistic one would be
> >>> "imagine you're going to create a software that will rule over the
> >> world, for the 20 next years
> >>> and beyond, and should run on all reasonable platforms, which build
> >> system would we use?
> >>
> >> IMHO, answer to that is:
> >> First, write portable code in build system agnostic way:
> >> - Stick to C/C++ standard libraries as much as possible
> >> - Stick to vanila preprocessor magic to handle C/C++ library
> >> differences and incompatibilities.
> >> - Eliminate or platform-specific generated headers (or keep it small,
> >> one for all)
> >> Then, choose multi-platfor build system and keep build configuration
> >> scripts *small*.
> >>
> >> That will make it easy to compile the code with any build system
> >> current user wants to use
> >> or any build system the project will switch over to in future, if
> >> necessary.
> >>
> >>> If the answer is clearly "cmake", then it is worth examining if there
> is
> >> not a path that
> >>> would lead us to that point.
> >> No, the anwer is not "clearly cmake".
> >> CMake is great because it's multi-platform, it is available virtually
> >> everywhere and easy to install.
> >> CMake is terrible because it did not develop any best practices or
> >> conventions regarding how
> >> a perfect build configuration should be developed with CMake. That
> >> historically led to home grown,
> >> overgrown, bloated piles of CMake scripts specific to projects that
> >> require maintenance on its own.
> >> Even worse, many of those badly written scripts made it into CMake
> >> distribution as FindXXX.cmake
> >> modules, and CMake team did not reject or unify them.
> >> The freedom led to ecosystem of numerous distinct build monsters
> >> governed by specific conventions
> >> based on CMake like ECM from KDE, BCM from Boost, and Borsch fall
> >> sinto similar category, I think.
> >> Naturally, GDAL would grown its own, beause CMake is rubbish :-)
> >>
> >> An ideal build configuration scripts should be small, even for a large
> >> project.
> >> Here is example of such setup proposed for Boost
> >> https://github.com/ned14/boost-bmv-cmake
> >> There is no pile of custom CMake macros or modules provided and that
> >> is an ideal :)
> >>
> >>> Similar question: is it an effort that will make GDAL development a bit
> >>> easier for new contributors?
> >> Perhaps, potentially, may be.
> >> Certainly, CMake makes development friendly for use with modern IDEs.
> >>
> >>> A nice side effect could also be the opportunity to drop some cruft
> that
> >> has
> >>> accumulated over years in the current build systems (supporting ancient
> >>> library versions that no longer make sense)
> >> Dropping existing cruft is good.
> >> Replacing cruft with new CMake cruft is bad idea.
> >> Unfortunately, in most cases I've seen that is what happens when a
> >> project migrates to CMake.
> >>
> >> Best regards,
> >> --
> >> Mateusz Loskot, http://mateusz.loskot.net
> >> _______________________________________________
> >> gdal-dev mailing list
> >> gdal-dev at lists.osgeo.org
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/ab948ab4/attachment-0001.html>

From victor at amigocloud.com  Wed Nov 29 12:00:17 2017
From: victor at amigocloud.com (Victor Chernetsky)
Date: Wed, 29 Nov 2017 12:00:17 -0800
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <CAGhxFKXP6eV0aCOE+dgDgV1rtw1PH4OigShTGs=t1oHNod4edA@mail.gmail.com>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <2930727.YVHMchzVpP@even-i700>
 <CAGhxFKU1d2f2Qjei26qQwE9tezt6pYLBtn_LzJn1O3554DQ2eg@mail.gmail.com>
 <9910573.csnDsC4sIZ@even-i700>
 <CAGhxFKXP6eV0aCOE+dgDgV1rtw1PH4OigShTGs=t1oHNod4edA@mail.gmail.com>
Message-ID: <CAGhxFKUeX5ec-dZNVLuiP_=r599AY9sjHmhARr3EMNvzVO-Y4Q@mail.gmail.com>

Hey Even,

How do I set OVERWRITE option?
I tried all these:
ogr2ogr -overwrite -f AmigoCloud "AmigoCloud:15276 datasets=100322"
~/Downloads/Visits.geojson
ogr2ogr --config OVERWRITE YES -f AmigoCloud "AmigoCloud:15276
datasets=100322" ~/Downloads/Visits.geojson
ogr2ogr -oo OVERWRITE=YES -f AmigoCloud "AmigoCloud:15276 datasets=100322"
~/Downloads/Visits.geojson

In my driver CSLFetchNameValue( papszOptions, "OVERWRITE" ) is always NULL,
and DeleteLayer(int iLayer) never gets called.

How do switch ogr2ogr onto overwrite mode? Or how do I catch it in my
driver?

Thanks,


*Victor Chernetsky*


+1 (408) 368-4607
victor at amigocloud.com

On Tue, Nov 28, 2017 at 4:26 PM, Victor Chernetsky <victor at amigocloud.com>
wrote:

> Thanks, this helps!
>
> The thing is I cannot really use layer name to identify an AmigoCloud
> dataset. In AmigoCloud we have names, but they are not guarantied to be
> unique. We use dataset Id to identify a dataset (ogr layer) instead. In my
> example "Visits" it's just a name of the source data file, which gdal uses
> as a layer name. This is fine, but for destination AmigoCloud dataset I
> specify a dataset id explicitly anyway. So I know my destination dataset,
> and if it exists or not. I think with the info I have now I could do few
> small changes to handle these cases.
>
>
>
> *Victor Chernetsky*
>
>
> +1 (408) 368-4607
> victor at amigocloud.com
>
> On Tue, Nov 28, 2017 at 4:01 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> On mardi 28 novembre 2017 15:40:46 CET Victor Chernetsky wrote:
>>
>> > Here is my example:
>>
>> > ogr2ogr -overwrite -f AmigoCloud "AmigoCloud:15276 datasets=100056"
>>
>> > ~/Downloads/Visits.geojson
>>
>> >
>>
>> > I am trying to append, or overwrite data into existing dataset
>> id:100056.
>>
>> > But it still created a new dataset, and it did not delete/clean old
>>
>> > dataset.
>>
>>
>>
>> -overwrite overwrite *layers* not datasets
>>
>> Here it will probably create a new layer because the layer name of
>> Visits.geojson
>>
>> must be "Visits" and probably doesn't exist yet in your dataset.
>>
>>
>>
>> If you want to overwrite an existing layer foo with the geojson, you must
>> add "-nln foo"
>>
>>
>>
>> > I am thinking I need to do something in
>>
>> > my OGRAmigoCloudDataSource::ICreateLayer(). I am not checking if
>> dataset
>>
>> > exist. I always create a new one.
>>
>>
>>
>> You can have a look at the ogr2ogr logic to decide how to overwrite a
>> layer:
>>
>> https://github.com/OSGeo/gdal/blob/trunk/gdal/apps/ogr2ogr_lib.cpp#L3180
>>
>>
>>
>> For non-ogr2ogr clients, you could indeed add a check if a layer of same
>> name already exists
>>
>> A number of drivers also support a OVERWRITE=YES layer creation option
>>
>> See
>>
>> https://github.com/OSGeo/gdal/blob/trunk/gdal/ogr/ogrsf_frmt
>> s/carto/ogrcartodatasource.cpp#L412
>>
>>
>>
>> The advantage when you write an example is that you have tens of examples
>> to get inspiration from ;-)
>>
>>
>>
>> Even
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/a31e2680/attachment.html>

From even.rouault at spatialys.com  Wed Nov 29 12:02:53 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 Nov 2017 21:02:53 +0100
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <CAGhxFKUeX5ec-dZNVLuiP_=r599AY9sjHmhARr3EMNvzVO-Y4Q@mail.gmail.com>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <CAGhxFKXP6eV0aCOE+dgDgV1rtw1PH4OigShTGs=t1oHNod4edA@mail.gmail.com>
 <CAGhxFKUeX5ec-dZNVLuiP_=r599AY9sjHmhARr3EMNvzVO-Y4Q@mail.gmail.com>
Message-ID: <2340689.rrYvsmyFsG@even-i700>

On mercredi 29 novembre 2017 12:00:17 CET Victor Chernetsky wrote:
> Hey Even,
> 
> How do I set OVERWRITE option?

With -lco OVERWRITE=YES since this is a layer creation option

> I tried all these:
> ogr2ogr -overwrite -f AmigoCloud "AmigoCloud:15276 datasets=100322"

This will trigger the logic at
https://github.com/OSGeo/gdal/blob/trunk/gdal/apps/ogr2ogr_lib.cpp#L3180
that first try to see if a layer has the same name as the input layer name, and if so call 
DeleteLayer() on it


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/9e7c6d9b/attachment.html>

From victor at amigocloud.com  Wed Nov 29 13:33:17 2017
From: victor at amigocloud.com (Victor Chernetsky)
Date: Wed, 29 Nov 2017 13:33:17 -0800
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <2340689.rrYvsmyFsG@even-i700>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <CAGhxFKXP6eV0aCOE+dgDgV1rtw1PH4OigShTGs=t1oHNod4edA@mail.gmail.com>
 <CAGhxFKUeX5ec-dZNVLuiP_=r599AY9sjHmhARr3EMNvzVO-Y4Q@mail.gmail.com>
 <2340689.rrYvsmyFsG@even-i700>
Message-ID: <CAGhxFKWiuFLm46zc7tjP64nr-dGOJOKGTz2ZZ3vXvdJiBfgZ+A@mail.gmail.com>

Thanks, this worked!

I have a followup question: how does gdal/ogr2ogr knows that my destination
dataset/layer exists?
For instance, -append option suppose to do different things if layer
exists, or not. I don't see any isExists() APIs that would check it.

Thanks,
*Victor Chernetsky*


+1 (408) 368-4607
victor at amigocloud.com

On Wed, Nov 29, 2017 at 12:02 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mercredi 29 novembre 2017 12:00:17 CET Victor Chernetsky wrote:
>
> > Hey Even,
>
> >
>
> > How do I set OVERWRITE option?
>
>
>
> With -lco OVERWRITE=YES since this is a layer creation option
>
>
>
> > I tried all these:
>
> > ogr2ogr -overwrite -f AmigoCloud "AmigoCloud:15276 datasets=100322"
>
>
>
> This will trigger the logic at
>
> https://github.com/OSGeo/gdal/blob/trunk/gdal/apps/ogr2ogr_lib.cpp#L3180
>
> that first try to see if a layer has the same name as the input layer
> name, and if so call DeleteLayer() on it
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/29f23fd6/attachment.html>

From even.rouault at spatialys.com  Wed Nov 29 13:53:44 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 Nov 2017 22:53:44 +0100
Subject: [gdal-dev] Question about command line options -append
In-Reply-To: <CAGhxFKWiuFLm46zc7tjP64nr-dGOJOKGTz2ZZ3vXvdJiBfgZ+A@mail.gmail.com>
References: <CAGhxFKW=yMY52xB53BurWtDuj3162qE=02cyQY5992bYY-q0Ag@mail.gmail.com>
 <2340689.rrYvsmyFsG@even-i700>
 <CAGhxFKWiuFLm46zc7tjP64nr-dGOJOKGTz2ZZ3vXvdJiBfgZ+A@mail.gmail.com>
Message-ID: <1565362.hqXEgEPBBi@even-i700>

On mercredi 29 novembre 2017 13:33:17 CET Victor Chernetsky wrote:
> Thanks, this worked!
> 
> I have a followup question: how does gdal/ogr2ogr knows that my 
destination
> dataset/layer exists?

For the dataset, it tries to GDALOpen() it.

For the layer, by iterating over layers with GetLayer() and checking their 
names against the target layer name. See the portion of ogr2ogr I pointed 
to.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20171129/e946f934/attachment-0001.html>

