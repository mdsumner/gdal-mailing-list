From mdsumner at gmail.com  Tue Mar  1 16:55:32 2022
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 2 Mar 2022 11:55:32 +1100
Subject: [gdal-dev] question re netcdf grid_mapping
Message-ID: <CAAcGz9_-iG721ZSTCPab3RtV_OqeoKgeso51BNRDScQbKH5wzw@mail.gmail.com>

Hello, I'm looking at the constants for CF_PT_* projection families in

frmts/netcdf/netcdf_cf_constants.h

I have a grid_mapping variable with attributes:

   # float swiss_lv95_coordinates ;
       #          swiss_lv95_coordinates:_FillValue = -1.f ;
       #          swiss_lv95_coordinates:grid_mapping_name = "Oblique
Mercator (LV95 - CH1903+)" ;
       #          swiss_lv95_coordinates:longitude_of_projection_center =
7.43958333 ;
       #          swiss_lv95_coordinates:latitude_of_projection_center =
46.9524056 ;
       #          swiss_lv95_coordinates:false_easting = 2600000. ;
       #          swiss_lv95_coordinates:false_northing = 1200000. ;
       #          swiss_lv95_coordinates:inverse_flattening = 299.1528128 ;
       #          swiss_lv95_coordinates:semi_major_axis = 6377397.155 ;

and by my understanding this would require something like

#define    CF_PT_LV95     "Oblique Mercator (LV95 - CH1903+)"

and then attendant logic in the driver for that case, this is "EPSG:2056".

It seems like this is a very long project of collating specific values used
for a crs name ... where the more general case would use those parameters
to build an Oblique Mercator - but this is Swiss oblique mercator  with a
simpler set of initialization params.

Is it a case of needing a very specific else if to match this case, or is
there some more to this?

Is it worth contributing cases as PRs?

(I'm inclined to advise "use -a_srs 'EPSG:2056'". )

Cheers, Mike

Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220302/dec0fa1b/attachment.html>

From alansnow21 at gmail.com  Tue Mar  1 19:31:03 2022
From: alansnow21 at gmail.com (Alan Snow)
Date: Tue, 1 Mar 2022 21:31:03 -0600
Subject: [gdal-dev] question re netcdf grid_mapping
In-Reply-To: <CAAcGz9_-iG721ZSTCPab3RtV_OqeoKgeso51BNRDScQbKH5wzw@mail.gmail.com>
References: <CAAcGz9_-iG721ZSTCPab3RtV_OqeoKgeso51BNRDScQbKH5wzw@mail.gmail.com>
Message-ID: <CAGybdFQaqb_93kQMZA6OivzF-q95V2WfLgBseJwNhwwSWnpjcQ@mail.gmail.com>

Hi Michael,

I don't claim to be an expert in the projection you are using or what the
GDAL team would like to do in this scenario, but hopefully the information
presented here will be helpful to you.

The grid mapping name "Oblique Mercator (LV95 - CH1903+)" in the netCDF
file does not appear to be in the list of supported grid mappings:
http://cfconventions.org/cf-conventions/cf-conventions.html#appendix-grid-mappings

Using pyproj to dump EPSG;2056 to CF parameters (
https://pyproj4.github.io/pyproj/latest/build_crs_cf.html), the grid
mapping name is "oblique_mercator":
>>> from pyproj import CRS
>>> crs = CRS("EPSG:2056")
>>> crs.to_cf()
{'azimuth_of_central_line': 90.0,
 'false_easting': 2600000.0,
 'false_northing': 1200000.0,
 'geographic_crs_name': 'CH1903+',
 'grid_mapping_name': 'oblique_mercator',
 'horizontal_datum_name': 'CH1903+',
 'inverse_flattening': 299.1528128,
 'latitude_of_projection_origin': 46.95240555555556,
 'longitude_of_prime_meridian': 0.0,
 'longitude_of_projection_origin': 7.439583333333333,
 'prime_meridian_name': 'Greenwich',
 'projected_crs_name': 'CH1903+ / LV95',
 'reference_ellipsoid_name': 'Bessel 1841',
 'scale_factor_at_projection_origin': 1.0,
 'semi_major_axis': 6377397.155,
 'semi_minor_axis': 6356078.962818189}

If the pyproj version is correct, I am wondering if the appropriate action
in this scenario is to contact the provider of the netCDF file to look into
and potentially address the issue?

If the swiss oblique mercator differs from the regular oblique mercator and
is not correctly represented by the current grid mappings in the CF
conventions, it may be worth opening an issue here to add it to the CF
conventions: https://github.com/cf-convention/cf-conventions. Once the
change is accepted there, I imagine a PR to GDAL will likely be welcome.

Best,
Alan

On Tue, Mar 1, 2022 at 6:57 PM Michael Sumner <mdsumner at gmail.com> wrote:

> Hello, I'm looking at the constants for CF_PT_* projection families in
>
> frmts/netcdf/netcdf_cf_constants.h
>
> I have a grid_mapping variable with attributes:
>
>    # float swiss_lv95_coordinates ;
>        #          swiss_lv95_coordinates:_FillValue = -1.f ;
>        #          swiss_lv95_coordinates:grid_mapping_name = "Oblique
> Mercator (LV95 - CH1903+)" ;
>        #          swiss_lv95_coordinates:longitude_of_projection_center =
> 7.43958333 ;
>        #          swiss_lv95_coordinates:latitude_of_projection_center =
> 46.9524056 ;
>        #          swiss_lv95_coordinates:false_easting = 2600000. ;
>        #          swiss_lv95_coordinates:false_northing = 1200000. ;
>        #          swiss_lv95_coordinates:inverse_flattening = 299.1528128 ;
>        #          swiss_lv95_coordinates:semi_major_axis = 6377397.155 ;
>
> and by my understanding this would require something like
>
> #define    CF_PT_LV95     "Oblique Mercator (LV95 - CH1903+)"
>
> and then attendant logic in the driver for that case, this is "EPSG:2056".
>
> It seems like this is a very long project of collating specific values
> used for a crs name ... where the more general case would use those
> parameters to build an Oblique Mercator - but this is Swiss oblique
> mercator  with a simpler set of initialization params.
>
> Is it a case of needing a very specific else if to match this case, or is
> there some more to this?
>
> Is it worth contributing cases as PRs?
>
> (I'm inclined to advise "use -a_srs 'EPSG:2056'". )
>
> Cheers, Mike
>
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Alan Snow
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220301/bef4dc4b/attachment.html>

From szymon.piskula at os.uk  Tue Mar  1 23:21:01 2022
From: szymon.piskula at os.uk (Szymon Piskula (C))
Date: Wed, 2 Mar 2022 07:21:01 +0000
Subject: [gdal-dev] FW: GDAL MVT Multithreading
In-Reply-To: <LO0P123MB6301B9739C37183959FB0FD79D029@LO0P123MB6301.GBRP123.PROD.OUTLOOK.COM>
References: <LO0P123MB6301B9739C37183959FB0FD79D029@LO0P123MB6301.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <LO0P123MB6301A5650FCE4FE13375072E9D039@LO0P123MB6301.GBRP123.PROD.OUTLOOK.COM>

Hello,

I am trying to speed up my MVT generation with GDAL. The GDAL documentation says that some of the work can be multi-threaded by use of the GDAL_NUM_THREADS parameter. From my understanding by default there should be as many threads in the pool as many cores there are on the machine. Since I run on Azure VM, I tried scaling up and down between 4 and 16 core but my MVT test data always processes in 10minutes, regardless of the VM spec. I tried running ogr2ogr both with setting --config GDAL_NUM_THREADS 2 (to try force slow down) or help speed up with --config GDAL_NUM_THREADS 12 by hinting to use more threads. Still my processing time is nearly fixed and does not change. I also tried setting the environmental variable GDAL_NUM_THREADS 12 but no change with performance. Does anyone know please how well the GDAL MVT actually multi-threads? Can this help speed things up in any significant way? Or is there a different way to control the multi-threading ? The full command I run (on Windows) is :

ogr2ogr --debug ON --config GDAL_NUM_THREADS 12 -f MVT F:\Task_3 -dsco MINZOOM=16 -dsco MAXZOOM=17 -dsco MAX_SIZE=1000000 -dsco EXTENT=8192 -dsco COMPRESS=NO PG:<constring> tablea, tableb

My GDAL Version is:
GDAL 3.4.1, released 2021/12/27

I can see that the tiles are written to the .temp.db SQLite, then are written to the local disk folder, so I wonder if it's the SQLite bit that is the bottleneck ?

Thank you


This email and any attachments are intended only for the intended recipient and may contain sensitive information. If you are not the intended recipient, please immediately delete this email and inform the sender.

OS email communications may be monitored to ensure the secure and effective operation of our systems and for other lawful purposes. Subject to contract: No rights are to be derived from any proposal contained in this email until a written agreement containing all necessary terms is executed between the relevant parties.

Thank you for your cooperation.

Ordnance Survey Limited (Company Registration number 09121572)
Registered Office: Explorer House
Adanac Drive
Southampton SO16 0AS
Tel: 03456 050505
http://www.os.uk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220302/14492d11/attachment-0001.html>

From momtchil at momtchev.com  Wed Mar  2 06:57:30 2022
From: momtchil at momtchev.com (Momtchil Momtchev)
Date: Wed, 2 Mar 2022 15:57:30 +0100
Subject: [gdal-dev] FW: GDAL MVT Multithreading
In-Reply-To: <LO0P123MB6301A5650FCE4FE13375072E9D039@LO0P123MB6301.GBRP123.PROD.OUTLOOK.COM>
References: <LO0P123MB6301B9739C37183959FB0FD79D029@LO0P123MB6301.GBRP123.PROD.OUTLOOK.COM>
 <LO0P123MB6301A5650FCE4FE13375072E9D039@LO0P123MB6301.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <5e11e4a2-6856-8e77-905f-377507855db7@momtchev.com>


Can you check the CPU usage of your process? Normally, if you don't 
specify /GDAL_NUM_THREADS/, GDAL will use as many threads as there are 
CPU cores. Also try reducing to =1 to see if it slows down.


On 02/03/2022 08:21, Szymon Piskula (C) via gdal-dev wrote:
>
> Hello,
>
> I am trying to speed up my MVT generation with GDAL. The GDAL 
> documentation says that some of the work can be multi-threaded by use 
> of the GDAL_NUM_THREADS parameter. From my understanding by default 
> there should be as many threads in the pool as many cores there are on 
> the machine. Since I run on Azure VM, I tried scaling up and down 
> between 4 and 16 core but my MVT test data always processes in 
> 10minutes, regardless of the VM spec. I tried running ogr2ogr both 
> with setting --config GDAL_NUM_THREADS 2 (to try force slow down) or 
> help speed up with --config GDAL_NUM_THREADS 12 by hinting to use more 
> threads. Still my processing time is nearly fixed and does not change. 
> I also tried setting the environmental variable GDAL_NUM_THREADS 12 
> but no change with performance. Does anyone know please how well the 
> GDAL MVT actually multi-threads? Can this help speed things up in any 
> significant way? Or is there a different way to control the 
> multi-threading ? The full command I run (on Windows) is :
>
> ogr2ogr --debug ON --config GDAL_NUM_THREADS 12 -f MVT F:\Task_3 -dsco 
> MINZOOM=16 -dsco MAXZOOM=17 -dsco MAX_SIZE=1000000 -dsco EXTENT=8192 
> -dsco COMPRESS=NO PG:<constring> tablea, tableb
>
> My GDAL Version is:
>
> GDAL 3.4.1, released 2021/12/27
>
> I can see that the tiles are written to the .temp.db SQLite, then are 
> written to the local disk folder, so I wonder if it?s the SQLite bit 
> that is the bottleneck ?
>
> Thank you
>
>
>
> This email and any attachments are intended only for the intended 
> recipient and may contain sensitive information. If you are not the 
> intended recipient, please immediately delete this email and inform 
> the sender.
>
> OS email communications may be monitored to ensure the secure and 
> effective operation of our systems and for other lawful purposes. 
> Subject to contract: No rights are to be derived from any proposal 
> contained in this email until a written agreement containing all 
> necessary terms is executed between the relevant parties.
>
> Thank you for your cooperation.
>
> Ordnance Survey Limited (Company Registration number 09121572)
> Registered Office: Explorer House
> Adanac Drive
> Southampton SO16 0AS
> Tel: 03456 050505
> http://www.os.uk
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Momtchil Momtchev<momtchil at momtchev.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220302/607073b6/attachment.html>

From mdsumner at gmail.com  Wed Mar  2 13:45:34 2022
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 3 Mar 2022 08:45:34 +1100
Subject: [gdal-dev] question re netcdf grid_mapping
In-Reply-To: <CAGybdFQaqb_93kQMZA6OivzF-q95V2WfLgBseJwNhwwSWnpjcQ@mail.gmail.com>
References: <CAAcGz9_-iG721ZSTCPab3RtV_OqeoKgeso51BNRDScQbKH5wzw@mail.gmail.com>
 <CAGybdFQaqb_93kQMZA6OivzF-q95V2WfLgBseJwNhwwSWnpjcQ@mail.gmail.com>
Message-ID: <CAAcGz98qsfKcvrAA+YXHfJq3jnWUcBnbkEFKCDqT5z8gzCaYEA@mail.gmail.com>

On Wed, Mar 2, 2022 at 2:31 PM Alan Snow <alansnow21 at gmail.com> wrote:

> Hi Michael,
>
> I don't claim to be an expert in the projection you are using or what the
> GDAL team would like to do in this scenario, but hopefully the information
> presented here will be helpful to you.
>
>

  excellent, thanks so much Alan this clarifies.

Best, Mike



> The grid mapping name "Oblique Mercator (LV95 - CH1903+)" in the netCDF
> file does not appear to be in the list of supported grid mappings:
>
> http://cfconventions.org/cf-conventions/cf-conventions.html#appendix-grid-mappings
>
> Using pyproj to dump EPSG;2056 to CF parameters (
> https://pyproj4.github.io/pyproj/latest/build_crs_cf.html), the grid
> mapping name is "oblique_mercator":
> >>> from pyproj import CRS
> >>> crs = CRS("EPSG:2056")
> >>> crs.to_cf()
> {'azimuth_of_central_line': 90.0,
>  'false_easting': 2600000.0,
>  'false_northing': 1200000.0,
>  'geographic_crs_name': 'CH1903+',
>  'grid_mapping_name': 'oblique_mercator',
>  'horizontal_datum_name': 'CH1903+',
>  'inverse_flattening': 299.1528128,
>  'latitude_of_projection_origin': 46.95240555555556,
>  'longitude_of_prime_meridian': 0.0,
>  'longitude_of_projection_origin': 7.439583333333333,
>  'prime_meridian_name': 'Greenwich',
>  'projected_crs_name': 'CH1903+ / LV95',
>  'reference_ellipsoid_name': 'Bessel 1841',
>  'scale_factor_at_projection_origin': 1.0,
>  'semi_major_axis': 6377397.155,
>  'semi_minor_axis': 6356078.962818189}
>
> If the pyproj version is correct, I am wondering if the appropriate action
> in this scenario is to contact the provider of the netCDF file to look into
> and potentially address the issue?
>
> If the swiss oblique mercator differs from the regular oblique mercator
> and is not correctly represented by the current grid mappings in the CF
> conventions, it may be worth opening an issue here to add it to the CF
> conventions: https://github.com/cf-convention/cf-conventions. Once the
> change is accepted there, I imagine a PR to GDAL will likely be welcome.
>
> Best,
> Alan
>
> On Tue, Mar 1, 2022 at 6:57 PM Michael Sumner <mdsumner at gmail.com> wrote:
>
>> Hello, I'm looking at the constants for CF_PT_* projection families in
>>
>> frmts/netcdf/netcdf_cf_constants.h
>>
>> I have a grid_mapping variable with attributes:
>>
>>    # float swiss_lv95_coordinates ;
>>        #          swiss_lv95_coordinates:_FillValue = -1.f ;
>>        #          swiss_lv95_coordinates:grid_mapping_name = "Oblique
>> Mercator (LV95 - CH1903+)" ;
>>        #          swiss_lv95_coordinates:longitude_of_projection_center =
>> 7.43958333 ;
>>        #          swiss_lv95_coordinates:latitude_of_projection_center =
>> 46.9524056 ;
>>        #          swiss_lv95_coordinates:false_easting = 2600000. ;
>>        #          swiss_lv95_coordinates:false_northing = 1200000. ;
>>        #          swiss_lv95_coordinates:inverse_flattening = 299.1528128
>> ;
>>        #          swiss_lv95_coordinates:semi_major_axis = 6377397.155 ;
>>
>> and by my understanding this would require something like
>>
>> #define    CF_PT_LV95     "Oblique Mercator (LV95 - CH1903+)"
>>
>> and then attendant logic in the driver for that case, this is
>> "EPSG:2056".
>>
>> It seems like this is a very long project of collating specific values
>> used for a crs name ... where the more general case would use those
>> parameters to build an Oblique Mercator - but this is Swiss oblique
>> mercator  with a simpler set of initialization params.
>>
>> Is it a case of needing a very specific else if to match this case, or is
>> there some more to this?
>>
>> Is it worth contributing cases as PRs?
>>
>> (I'm inclined to advise "use -a_srs 'EPSG:2056'". )
>>
>> Cheers, Mike
>>
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> --
> Alan Snow
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220303/77ecdaec/attachment.html>

From mdsumner at gmail.com  Thu Mar  3 02:14:34 2022
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 3 Mar 2022 21:14:34 +1100
Subject: [gdal-dev] VRT dataset to text in-memory?
Message-ID: <CAAcGz9-AU5m1oxu18cxgz=9rmUrzPnYki7yEBsmnwO3zkZcvEw@mail.gmail.com>

Hello, reading the raster VRT tutorial

https://gdal.org/drivers/raster/vrt.html#creation-of-vrt-datasets

with this code:

//
int   nBand;
GDALDriver *poDriver = (GDALDriver *) GDALGetDriverByName( "VRT" );
GDALDataset *poSrcDS, *poVRTDS;
poSrcDS = (GDALDataset *) GDALOpenShared( pszSourceFilename, GA_ReadOnly );
poVRTDS = poDriver->CreateCopy( "", poSrcDS, FALSE, NULL, NULL, NULL );
//

Is there a way to obtained the VRT XML text representing poVRTDS without
writing to an actual file?

Sorry if this is obvious, haven't been able to find an example that does
what I want. I've seen examples using GetMetadataItem from a band for parts
of the XML, but can't see how to get the entire thing.

Thanks for your help.

Best, Mike


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220303/29ee73dc/attachment.html>

From Loic.DUTRIEUX at ec.europa.eu  Thu Mar  3 03:55:50 2022
From: Loic.DUTRIEUX at ec.europa.eu (DUTRIEUX Loic)
Date: Thu, 3 Mar 2022 11:55:50 +0000
Subject: [gdal-dev] Implications of "Multi-column primary key in [table] to
 supported" warning
Message-ID: <42c0cdfc388c47479a56bd4fec4247b1@ec.europa.eu>

Hi everyone,

Quick question, I'm using ogr2ogr to clone a postGIS database to a spatialite file database (by the way, very convenient that ogr2ogr handles the transfer of non-spatial tables too). The database contains many-to-many relations and as a consequence association tables with multiple primary keys. When I run ogr2ogr I get a warning saying that Multi-column primary key are not supported.
Should I be worried of that warning for my use case or is it safe to assume that db relations won't get mixed up.

Thanks and kind regards,
Lo?c

From jukka.rahkonen at maanmittauslaitos.fi  Thu Mar  3 04:55:33 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 3 Mar 2022 12:55:33 +0000
Subject: [gdal-dev] Implications of "Multi-column primary key in [table]
 to supported" warning
Message-ID: <9d62de327ee74ba9b8546f6fe3d228fc@maanmittauslaitos.fi>

Hi,

If you have a table with multi-column primary key (composite key) then the target table in Spatialite obviously will not have the same PK. I would guess that none of the columns in the composite is unique and usable as PK so the only possibility is to create a new unique column for the PK. Therefore the tables that you will have are not identical with the source tables by their schemas. The foreign key constraints between the tables are dropped any way, ogr2ogr does not try to transfer them ever.

I think you can answer your question yourself by making a test with your own data. If all of the tables that have a composite PK get a new PK field in Spatialite (I guess it will of type "integer autoincrement") and if the row counts in source and target tables match I believe that the data has been transferred right. When it comes to question "is it safe to assume that db relations won't get mixed up" you do not have any constrained relations left in Spatialite. The data integrity is OK immediately after the conversion but at that stage there is nothing in Spatialite that prevents you from making edits that you should't do. But you can add similar constraints that you have in PostGIS afterward into SQLite https://sqlite.org/foreignkeys.html. I am not sure that all type of constraints that you can have in PostGIS are supported in SQLite but foreign key should behave in the same way.

SQLite driver https://gdal.org/drivers/vector/sqlite.html supports prelude_statements but if you want to re-create constraints you would need something like postlude_statements. It means that ogr2ogr cannot do the whole job but you must run the required SQL statements with ogrinfo or some SQLite client.

-Jukka Rahkonen-



-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta DUTRIEUX Loic
L?hetetty: torstai 3. maaliskuuta 2022 13.56
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Implications of "Multi-column primary key in [table] to supported" warning

Hi everyone,

Quick question, I'm using ogr2ogr to clone a postGIS database to a spatialite file database (by the way, very convenient that ogr2ogr handles the transfer of non-spatial tables too). The database contains many-to-many relations and as a consequence association tables with multiple primary keys. When I run ogr2ogr I get a warning saying that Multi-column primary key are not supported.
Should I be worried of that warning for my use case or is it safe to assume that db relations won't get mixed up.

Thanks and kind regards,
Lo?c
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From mateusz at loskot.net  Thu Mar  3 10:33:40 2022
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 3 Mar 2022 19:33:40 +0100
Subject: [gdal-dev] VRT dataset to text in-memory?
In-Reply-To: <CAAcGz9-AU5m1oxu18cxgz=9rmUrzPnYki7yEBsmnwO3zkZcvEw@mail.gmail.com>
References: <CAAcGz9-AU5m1oxu18cxgz=9rmUrzPnYki7yEBsmnwO3zkZcvEw@mail.gmail.com>
Message-ID: <CABUeae_eu8TM4AyiebP_DEh7xVGDqtdoj_iNXv+byiWrXshWhQ@mail.gmail.com>

On Thu, 3 Mar 2022 at 11:16, Michael Sumner <mdsumner at gmail.com> wrote:
>
> Hello, reading the raster VRT tutorial
>
> https://gdal.org/drivers/raster/vrt.html#creation-of-vrt-datasets
>
> with this code:
>
> //
> int   nBand;
> GDALDriver *poDriver = (GDALDriver *) GDALGetDriverByName( "VRT" );
> GDALDataset *poSrcDS, *poVRTDS;
> poSrcDS = (GDALDataset *) GDALOpenShared( pszSourceFilename, GA_ReadOnly );
> poVRTDS = poDriver->CreateCopy( "", poSrcDS, FALSE, NULL, NULL, NULL );
> //
>
> Is there a way to obtained the VRT XML text representing poVRTDS without writing to an actual file?

Check what the https://gdal.org/programs/gdalbuildvrt.html does:
https://github.com/OSGeo/gdal/blob/master/apps/gdalbuildvrt_bin.cpp#L192-L196
which is this call
https://github.com/OSGeo/gdal/blob/master/apps/gdalbuildvrt_lib.cpp#L1691
which uses this builder class
https://github.com/OSGeo/gdal/blob/master/apps/gdalbuildvrt_lib.cpp#L1769
which is/can be built as a library and linked against.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From englishchristophera at gmail.com  Thu Mar  3 12:03:19 2022
From: englishchristophera at gmail.com (chris english)
Date: Thu, 3 Mar 2022 15:03:19 -0500
Subject: [gdal-dev] CMAKE poppler c++17
Message-ID: <CAASFQpRob=GvSKmkMXMNVj9bVsfxw5vRM8SnNEz57NAxj--a7w@mail.gmail.com>

Hi,
I am a weak link when it comes to CMAKE. Geos-3.10.2 and PROJ-8.2.1 were a
breeze nonetheless.  A source build of libpoppler.so.119 via ./configure
went smoothly.

I have consistently failed at ogrpdflayer (well, only four times so far) on
'optional', that is a C++17 thing. <-  an example of a feeble understanding
of build process requirements.

Recklessly editing lines in CMakeLists.txt:
41 # check compiler and set preferences.
42 set(CMAKE_CXX_STANDARD 17)
[ 44%] Built target gdal_STACIT
[ 44%] Building CXX object
frmts/pdf/CMakeFiles/gdal_PDF.dir/ogrpdflayer.cpp.o

but further along we run across c++17 be contra-indicated as to

[ 49%] Built target gdal_PostGISRaster
[ 49%] Building CXX object
frmts/dods/CMakeFiles/gdal_DODS.dir/dodsdataset2.cpp.o

from /home/chris/gdal/frmts/dods/dodsdataset2.cpp:38:
/usr/local/include/libdap/RCReader.h:114:16: error: ISO C++17 does not
allow dynamic exception specifications
  114 |     RCReader() throw(Error);

which leads to a set by individual target approach as is said to be
available

set_property(TARGET tgt PROPERTY CXX_STANDARD 17)
set_property(TARGET tgt PROPERTY CXX_STANDARD 11)

and were this the solution, what would it look like and where might it
reside in say

CMakeCache.txt, or have I just gotten this all wrong, as I expect I have.

Ubuntu 20.04, gcc-9.3.0, and happy to have broken through to 49%, but wouldn't

that's 99% good news.

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220303/727f8456/attachment.html>

From jmckenna at gatewaygeomatics.com  Thu Mar  3 12:26:17 2022
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 3 Mar 2022 16:26:17 -0400
Subject: [gdal-dev] CMAKE poppler c++17
In-Reply-To: <CAASFQpRob=GvSKmkMXMNVj9bVsfxw5vRM8SnNEz57NAxj--a7w@mail.gmail.com>
References: <CAASFQpRob=GvSKmkMXMNVj9bVsfxw5vRM8SnNEz57NAxj--a7w@mail.gmail.com>
Message-ID: <3547ded6-b554-2c74-0b99-658d15403066@gatewaygeomatics.com>

Hi Chris,

I'm not sure if this is exactly related to your issue, but here are my 
thoughts:

I do know that the recent poppler release relies on the C++17 standard, 
and there was a recent change in GDAL to accommodate this (see 
https://github.com/OSGeo/gdal/issues/5071 ).

In my case (for the Windows / MS4W community) I had to patch GDAL 3.4.1 
for this, but in your case you might want to grab GDAL-master from git 
as that will be easier to handle the new poppler.


-jeff



-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/




On 2022-03-03 4:03 p.m., chris english wrote:
> Hi,
> I am a weak link when it comes to CMAKE. Geos-3.10.2 and PROJ-8.2.1 were 
> a breeze nonetheless.? A source build of libpoppler.so.119 via 
> ./configure went smoothly.
> 
> I have consistently failed at ogrpdflayer (well, only four times so far) 
> on 'optional', that is a C++17 thing. <-? an example of a feeble 
> understanding of build process requirements.
> 
> Recklessly editing lines in CMakeLists.txt:
> 41 # check compiler and set preferences.
> 42 set(CMAKE_CXX_STANDARD 17)
> [ 44%] Built target gdal_STACIT
> [ 44%] Building CXX object 
> frmts/pdf/CMakeFiles/gdal_PDF.dir/ogrpdflayer.cpp.o
> 
> but further along we run across c++17 be contra-indicated as to
> 
> [ 49%] Built target gdal_PostGISRaster
> [ 49%] Building CXX object 
> frmts/dods/CMakeFiles/gdal_DODS.dir/dodsdataset2.cpp.o
> 
> from /home/chris/gdal/frmts/dods/dodsdataset2.cpp:38:
> /usr/local/include/libdap/RCReader.h:114:16: error: ISO C++17 does not 
> allow dynamic exception specifications
>  ? 114 | ? ? RCReader() throw(Error);
> 
> which leads to a set by individual target approach as is said to be 
> available
> 
> set_property(TARGETtgtPROPERTYCXX_STANDARD17)
> set_property(TARGETtgtPROPERTYCXX_STANDARD11)
> 
> and were this the solution, what would it look like and where might it 
> reside in say
> 
> CMakeCache.txt, or have I just gotten this all wrong, as I expect I have.
> 
> Ubuntu 20.04, gcc-9.3.0, and happy to have broken through to 49%, but 
> wouldn't
> 
> that's 99% good news.
> 
> Chris
> 
> 

From englishchristophera at gmail.com  Thu Mar  3 16:29:14 2022
From: englishchristophera at gmail.com (chris english)
Date: Thu, 3 Mar 2022 19:29:14 -0500
Subject: [gdal-dev] CMAKE poppler c++17
In-Reply-To: <3547ded6-b554-2c74-0b99-658d15403066@gatewaygeomatics.com>
References: <CAASFQpRob=GvSKmkMXMNVj9bVsfxw5vRM8SnNEz57NAxj--a7w@mail.gmail.com>
 <3547ded6-b554-2c74-0b99-658d15403066@gatewaygeomatics.com>
Message-ID: <CAASFQpT_kn8Ucskk01SUCx5Nmm5zB8xnuy-hqRp5CaKE0zsnMQ@mail.gmail.com>

Thanks Jeff.
Process details matter, I missed that Poppler source was actually at gitlab
rather than my github based clone, so rebuilt poppler, using CMAKE this
time.
[100%] Built target poppler-render
Install the project...
-- Install configuration: "Release"
-- Installing: /usr/local/lib/libpoppler.so.119.0.0
-- Up-to-date: /usr/local/lib/libpoppler.so.119
-- Set runtime path of "/usr/local/lib/libpoppler.so.119.0.0" to
"/usr/local/lib"

which in the context of the patch 089f84b:
if ("${POPPLER_VERSION_MINOR}" MATCHES "0?[0-9]+")
string(REGEX REPLACE "0?([0-9]+)" "\\1" POPPLER_VERSION_MINOR
${POPPLER_VERSION_MINOR})
endif ()
if (POPPLER_VERSION_MAJOR GREATER 21)
target_compile_features(gdal_PDF PRIVATE cxx_std_17)
endif ()
target_compile_definitions(gdal_PDF PRIVATE -DHAVE_POPPLER
-DPOPPLER_MAJOR_VERSION=${POPPLER_VERSION_MAJOR}
-DPOPPLER_MINOR_VERSION=${POPPLER_VERSION_MINOR})
endif ()

and happily, 119 remains > 21, so poppler patch 089f84b worked.
Thereafter, MrSid driver cratered on some 2004 Lizardtech defines in
lt_platform.h that defined possible GCC compilers topping out at <= 5
(rather than a future unimaginable 9 or 12). Removing a desire for MrSid,
in this instance through ccmake,
Re-clone gdal and we get to this, new, somewhat indecipherable, not quite
there, but achingly close:
[ 89%] Building CXX object
gcore/mdreader/CMakeFiles/gcore_mdreader.dir/reader_spot.cpp.o
[ 89%] Built target gcore_mdreader
CMakeFiles/GDAL.dir/build.make:2661: *** target pattern contains no '%'.
Stop.
make[1]: *** [CMakeFiles/Makefile2:4871: CMakeFiles/GDAL.dir/all] Error 2

And from there I guess I will attempt to chug along.

Losing MrSid is a disappointment as the earliest USGS experimental
photogrammetry data available, albeit without sufficient viable GPCs (for
local areas as many were lost through time), was predicated on coastal
overflights related to beach erosion control efforts/federal expenses from
100 years ago. To my view, sufficient GPCs still exist within and across
the dataset, that it could serve as an historic measure, with an
appropriate eye toward the geographic basis that remaining GPCs indicate.
But it will no longer be local area, though that is what a certain client
wants.

Happily, or unhappily, my above error reveals some 8 google responses, with
none censored to show most relevant.

And, as CMAKE is our fate, and gdal is our best tool, we will endeavor to
persevere, so we can also get sf in R to load again.

Chris


On Thu, Mar 3, 2022 at 3:26 PM Jeff McKenna <jmckenna at gatewaygeomatics.com>
wrote:

> Hi Chris,
>
> I'm not sure if this is exactly related to your issue, but here are my
> thoughts:
>
> I do know that the recent poppler release relies on the C++17 standard,
> and there was a recent change in GDAL to accommodate this (see
> https://github.com/OSGeo/gdal/issues/5071 ).
>
> In my case (for the Windows / MS4W community) I had to patch GDAL 3.4.1
> for this, but in your case you might want to grab GDAL-master from git
> as that will be easier to handle the new poppler.
>
>
> -jeff
>
>
>
> --
> Jeff McKenna
> GatewayGeo: Developers of MS4W, MapServer Consulting and Training
> co-founder of FOSS4G
> http://gatewaygeo.com/
>
>
>
>
> On 2022-03-03 4:03 p.m., chris english wrote:
> > Hi,
> > I am a weak link when it comes to CMAKE. Geos-3.10.2 and PROJ-8.2.1 were
> > a breeze nonetheless.  A source build of libpoppler.so.119 via
> > ./configure went smoothly.
> >
> > I have consistently failed at ogrpdflayer (well, only four times so far)
> > on 'optional', that is a C++17 thing. <-  an example of a feeble
> > understanding of build process requirements.
> >
> > Recklessly editing lines in CMakeLists.txt:
> > 41 # check compiler and set preferences.
> > 42 set(CMAKE_CXX_STANDARD 17)
> > [ 44%] Built target gdal_STACIT
> > [ 44%] Building CXX object
> > frmts/pdf/CMakeFiles/gdal_PDF.dir/ogrpdflayer.cpp.o
> >
> > but further along we run across c++17 be contra-indicated as to
> >
> > [ 49%] Built target gdal_PostGISRaster
> > [ 49%] Building CXX object
> > frmts/dods/CMakeFiles/gdal_DODS.dir/dodsdataset2.cpp.o
> >
> > from /home/chris/gdal/frmts/dods/dodsdataset2.cpp:38:
> > /usr/local/include/libdap/RCReader.h:114:16: error: ISO C++17 does not
> > allow dynamic exception specifications
> >    114 |     RCReader() throw(Error);
> >
> > which leads to a set by individual target approach as is said to be
> > available
> >
> > set_property(TARGETtgtPROPERTYCXX_STANDARD17)
> > set_property(TARGETtgtPROPERTYCXX_STANDARD11)
> >
> > and were this the solution, what would it look like and where might it
> > reside in say
> >
> > CMakeCache.txt, or have I just gotten this all wrong, as I expect I have.
> >
> > Ubuntu 20.04, gcc-9.3.0, and happy to have broken through to 49%, but
> > wouldn't
> >
> > that's 99% good news.
> >
> > Chris
> >
> >
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220303/c5ec08f1/attachment-0001.html>

From englishchristophera at gmail.com  Thu Mar  3 16:40:26 2022
From: englishchristophera at gmail.com (chris english)
Date: Thu, 3 Mar 2022 19:40:26 -0500
Subject: [gdal-dev] CMAKE [ 89%] Built target gcore_mdreader *** target
 pattern contains no '%'
Message-ID: <CAASFQpRgAHpiNR4bpynE1khygCMqRH_LKLfT-JfLA67kH-rKzw@mail.gmail.com>

This subject line is a mash up of this:

[ 89%] Built target gcore_mdreader
CMakeFiles/GDAL.dir/build.make:2661: *** target pattern contains no '%'.
Stop.
make[1]: *** [CMakeFiles/Makefile2:4871: CMakeFiles/GDAL.dir/all] Error 2

and hereafter I have no idea of how to proceed. I've previously dispensed
with other recalcitrant drivers (MrSid), can I do the same with target
'gcore' without the world collapsing upon me and would my functionality be
greatly reduced.?

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220303/8da619a7/attachment.html>

From englishchristophera at gmail.com  Thu Mar  3 16:48:25 2022
From: englishchristophera at gmail.com (chris english)
Date: Thu, 3 Mar 2022 19:48:25 -0500
Subject: [gdal-dev] crunch lib
Message-ID: <CAASFQpR2409T-O9WVM2bVPT5DNRAWuGfEXzTcAP9uWjiKx9vKg@mail.gmail.com>

https://github.com/DaemonEngine/crunch
appears to be a better source to point to for crunch, as it builds, whereas
crunch link in docs doesn't.
And builds for the hapless, as I believe I've demonstrated.
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220303/fd080d3d/attachment.html>

From hfpmartins at gmail.com  Fri Mar  4 03:07:01 2022
From: hfpmartins at gmail.com (Hugo)
Date: Fri, 4 Mar 2022 12:07:01 +0100
Subject: [gdal-dev] Weird behavior while reprojecting geometries
Message-ID: <CAFtnPwqp1EVmWDD0P0u7fY2TYeoxQ+6Z-mBm9nEXKr2HRXcYBQ@mail.gmail.com>

Hi guys,

I'm having weird behavior using ogr and osr through python while
reprojecting point geometries.

Following code:
wgs = osr.SpatialReference()
wgs.ImportFromEPSG(4326)

etrs = osr.SpatialReference()
etrs.ImportFromEPSG(3763)

geom = ogr.Geometry(ogr.wkbPoint)
geom.AddPoint(-9.10165,38.73981)
#geom.AddPoint(38.73981,-9.10165)
geom.AssignSpatialReference(wgs)

reproj = osr.CoordinateTransformation(wgs, etrs)
geom.Transform(reproj)

If I run it as it is I get wrong coordinates in the target SRS. However if
I switch X,Y when building the geometry (the commented line) I will get the
correct coordinates. What is weird is that I have another script reading
from geonames dataset and there this behavior doesn't happen.

I'm using GDAL 3.4.1 installed through conda on Ubuntu 20.04.

Any hints?
thanks in advance

-- 
Hugo Martins
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220304/ce70215b/attachment.html>

From idan at miara.com  Fri Mar  4 03:13:32 2022
From: idan at miara.com (Idan Miara)
Date: Fri, 4 Mar 2022 13:13:32 +0200
Subject: [gdal-dev] Weird behavior while reprojecting geometries
In-Reply-To: <CAEDrt3-=KqgkBHotBdc2fEUWaP+wkOa9ADzkAZPCh86Ht3+iAQ@mail.gmail.com>
References: <CAFtnPwqp1EVmWDD0P0u7fY2TYeoxQ+6Z-mBm9nEXKr2HRXcYBQ@mail.gmail.com>
 <CAEDrt3-=KqgkBHotBdc2fEUWaP+wkOa9ADzkAZPCh86Ht3+iAQ@mail.gmail.com>
Message-ID: <CAEDrt3-=zZc2EmWYPMhqscO+Eqhb+C5rxbJBVhejSTj7_9XFyA@mail.gmail.com>

On Fri, 4 Mar 2022, 13:12 Idan Miara, <idan at miara.com> wrote:

> Hi,
> Are you familiar with the axis order that was introduced in gdal 3 and its
> affects on 4326?
> https://gdal.org/tutorials/osr_api_tut.html#crs-and-axis-order
>
> On Fri, 4 Mar 2022, 13:07 Hugo, <hfpmartins at gmail.com> wrote:
>
>> Hi guys,
>>
>> I'm having weird behavior using ogr and osr through python while
>> reprojecting point geometries.
>>
>> Following code:
>> wgs = osr.SpatialReference()
>> wgs.ImportFromEPSG(4326)
>>
>> etrs = osr.SpatialReference()
>> etrs.ImportFromEPSG(3763)
>>
>> geom = ogr.Geometry(ogr.wkbPoint)
>> geom.AddPoint(-9.10165,38.73981)
>> #geom.AddPoint(38.73981,-9.10165)
>> geom.AssignSpatialReference(wgs)
>>
>> reproj = osr.CoordinateTransformation(wgs, etrs)
>> geom.Transform(reproj)
>>
>> If I run it as it is I get wrong coordinates in the target SRS. However
>> if I switch X,Y when building the geometry (the commented line) I will get
>> the correct coordinates. What is weird is that I have another script
>> reading from geonames dataset and there this behavior doesn't happen.
>>
>> I'm using GDAL 3.4.1 installed through conda on Ubuntu 20.04.
>>
>> Any hints?
>> thanks in advance
>>
>> --
>> Hugo Martins
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220304/2fb270b2/attachment.html>

From hfpmartins at gmail.com  Fri Mar  4 03:29:53 2022
From: hfpmartins at gmail.com (Hugo)
Date: Fri, 4 Mar 2022 12:29:53 +0100
Subject: [gdal-dev] Weird behavior while reprojecting geometries
In-Reply-To: <CAEDrt3-=zZc2EmWYPMhqscO+Eqhb+C5rxbJBVhejSTj7_9XFyA@mail.gmail.com>
References: <CAFtnPwqp1EVmWDD0P0u7fY2TYeoxQ+6Z-mBm9nEXKr2HRXcYBQ@mail.gmail.com>
 <CAEDrt3-=KqgkBHotBdc2fEUWaP+wkOa9ADzkAZPCh86Ht3+iAQ@mail.gmail.com>
 <CAEDrt3-=zZc2EmWYPMhqscO+Eqhb+C5rxbJBVhejSTj7_9XFyA@mail.gmail.com>
Message-ID: <CAFtnPwp44B7ot+eGHP=tVMLeBjTMEcfeiQeFC3W=SXM9e_gz-Q@mail.gmail.com>

Hi Idan,

It is indeed this the issue. I was not aware of this change. Man, it has
been a while since I have touched GDAL.
Thanks a lot for your help.

Idan Miara <idan at miara.com> escreveu no dia sexta, 4/03/2022 ?(s) 12:13:

>
>
> On Fri, 4 Mar 2022, 13:12 Idan Miara, <idan at miara.com> wrote:
>
>> Hi,
>> Are you familiar with the axis order that was introduced in gdal 3 and
>> its affects on 4326?
>> https://gdal.org/tutorials/osr_api_tut.html#crs-and-axis-order
>>
>> On Fri, 4 Mar 2022, 13:07 Hugo, <hfpmartins at gmail.com> wrote:
>>
>>> Hi guys,
>>>
>>> I'm having weird behavior using ogr and osr through python while
>>> reprojecting point geometries.
>>>
>>> Following code:
>>> wgs = osr.SpatialReference()
>>> wgs.ImportFromEPSG(4326)
>>>
>>> etrs = osr.SpatialReference()
>>> etrs.ImportFromEPSG(3763)
>>>
>>> geom = ogr.Geometry(ogr.wkbPoint)
>>> geom.AddPoint(-9.10165,38.73981)
>>> #geom.AddPoint(38.73981,-9.10165)
>>> geom.AssignSpatialReference(wgs)
>>>
>>> reproj = osr.CoordinateTransformation(wgs, etrs)
>>> geom.Transform(reproj)
>>>
>>> If I run it as it is I get wrong coordinates in the target SRS. However
>>> if I switch X,Y when building the geometry (the commented line) I will get
>>> the correct coordinates. What is weird is that I have another script
>>> reading from geonames dataset and there this behavior doesn't happen.
>>>
>>> I'm using GDAL 3.4.1 installed through conda on Ubuntu 20.04.
>>>
>>> Any hints?
>>> thanks in advance
>>>
>>> --
>>> Hugo Martins
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>

-- 
Hugo Martins
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220304/ca817b7e/attachment.html>

From Loic.DUTRIEUX at ec.europa.eu  Fri Mar  4 07:01:47 2022
From: Loic.DUTRIEUX at ec.europa.eu (DUTRIEUX Loic)
Date: Fri, 4 Mar 2022 15:01:47 +0000
Subject: [gdal-dev] Implications of "Multi-column primary key in [table]
 to supported" warning
In-Reply-To: <9d62de327ee74ba9b8546f6fe3d228fc@maanmittauslaitos.fi>
References: <9d62de327ee74ba9b8546f6fe3d228fc@maanmittauslaitos.fi>
Message-ID: <02cfddc81b6d44a587dfcc1955a94773@ec.europa.eu>

Thanks for the many insights Jukka, it has helped me a lot in thinking where to dig and what to look at.

First, and this is what matters the most to me, I was able to confirm data integrity by comparing for each table the pg version to the sqlite version. Some types are altered (e.g. Dates which do not exist in sqlite and therefore became strings, and a JSON which also became a string, even though sqlite has a json type) but that's not a big issue.
I confirm that Foreign keys constraint are gone, if I run a "spatialite mydb.sqlite .schema | grep FOREI", only the spatialite extension tables are left. As you said it implies that the safety net is gone and the database no longer prevents me from making edits I shouldn't do but since this database is intended mainly for read only usage and not data management, that is perfectly acceptable.
As for the association tables, you guessed right, the composite key is gone and an additional ogc_fid primary key is added.

Thanks again,
Kind regards,
Lo?c
________________________________________
From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Sent: 03 March 2022 13:55:33
To: DUTRIEUX Loic (JRC-ISPRA); gdal-dev at lists.osgeo.org
Subject: Re: Implications of "Multi-column primary key in [table] to supported" warning

Hi,

If you have a table with multi-column primary key (composite key) then the target table in Spatialite obviously will not have the same PK. I would guess that none of the columns in the composite is unique and usable as PK so the only possibility is to create a new unique column for the PK. Therefore the tables that you will have are not identical with the source tables by their schemas. The foreign key constraints between the tables are dropped any way, ogr2ogr does not try to transfer them ever.

I think you can answer your question yourself by making a test with your own data. If all of the tables that have a composite PK get a new PK field in Spatialite (I guess it will of type "integer autoincrement") and if the row counts in source and target tables match I believe that the data has been transferred right. When it comes to question "is it safe to assume that db relations won't get mixed up" you do not have any constrained relations left in Spatialite. The data integrity is OK immediately after the conversion but at that stage there is nothing in Spatialite that prevents you from making edits that you should't do. But you can add similar constraints that you have in PostGIS afterward into SQLite https://urldefense.com/v3/__https://sqlite.org/foreignkeys.html__;!!DOxrgLBm!XPxXzkROhjk7yXj_UMlx2cbkKXEZfzDfmaMiH6Vp7pfUEbQ4fUUGEDTCfGCvSCFs8-qDs1E$ . I am not sure that all type of constraints that you can have in PostGIS are supported in SQLite but foreign key should behave in the same way.

SQLite driver https://urldefense.com/v3/__https://gdal.org/drivers/vector/sqlite.html__;!!DOxrgLBm!XPxXzkROhjk7yXj_UMlx2cbkKXEZfzDfmaMiH6Vp7pfUEbQ4fUUGEDTCfGCvSCFskfue4zU$  supports prelude_statements but if you want to re-create constraints you would need something like postlude_statements. It means that ogr2ogr cannot do the whole job but you must run the required SQL statements with ogrinfo or some SQLite client.

-Jukka Rahkonen-



-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta DUTRIEUX Loic
L?hetetty: torstai 3. maaliskuuta 2022 13.56
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Implications of "Multi-column primary key in [table] to supported" warning

Hi everyone,

Quick question, I'm using ogr2ogr to clone a postGIS database to a spatialite file database (by the way, very convenient that ogr2ogr handles the transfer of non-spatial tables too). The database contains many-to-many relations and as a consequence association tables with multiple primary keys. When I run ogr2ogr I get a warning saying that Multi-column primary key are not supported.
Should I be worried of that warning for my use case or is it safe to assume that db relations won't get mixed up.

Thanks and kind regards,
Lo?c
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://urldefense.com/v3/__https://lists.osgeo.org/mailman/listinfo/gdal-dev__;!!DOxrgLBm!XPxXzkROhjk7yXj_UMlx2cbkKXEZfzDfmaMiH6Vp7pfUEbQ4fUUGEDTCfGCvSCFsH0SPbLQ$

From englishchristophera at gmail.com  Fri Mar  4 11:02:09 2022
From: englishchristophera at gmail.com (chris english)
Date: Fri, 4 Mar 2022 14:02:09 -0500
Subject: [gdal-dev] Attempting a coherent CMAKE problem report from a git
 clone- steps taken
Message-ID: <CAASFQpQZDy7vz0Zsqjxkn1ba7PiFO_ALMDUkRf3s2WQPEy8Yyw@mail.gmail.com>

Concerning (executed in either git download directory or build):
~/gdal$ git describe
v3.3.0-2898-gba4e7c404b

Condition: was building and stopped with
[ 89%] Built target gcore_mdreader
CMakeFiles/GDAL.dir/build.make:2661: *** target pattern contains no '%'.
Stop.
make[1]: *** [CMakeFiles/Makefile2:4871: CMakeFiles/GDAL.dir/all] Error 2
make: *** [Makefile:146: all] Error 2

As we were building objects in gcore, the
'CMakeFiles/GDAL.dir/build.make:2661:'
refers to ~/gdal/build/gcore/CMakeFiles/GDAL.dir/build.make, line 2661 that
is in the neighborhood of a problem at line 2667:
GEOS::geos_c-NOT FOUND
Well, that could be bad, and says the problem is local rather than with the
git.
Perhaps a sudo ldconfig is called for. Done.
In ~/gdal/build rm CMakeCache.txt
Run cmake .. again
Copy and paste all output to editor and down at bottom find
IMPORTED_LOCATION not set for imported target "GEOS::geos_c" configuration
  "Release".
OK, so not something that ldconfig fixes. Pass in libgeos...how?
Resorting to ccmake ..
Pg 25 of 44
GEOS_DIR  /usr/local/lib/cmake/GEOS
contains:
ls /usr/local/lib/cmake/GEOS
geos-config.cmake  geos-config-version.cmake  geos-targets.cmake
 local.cmake
So, nothing looking very useful, change to /usr/local/lib and try again
change to /usr/local/lib/libgeos_c.so
And try:
build$ cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
-DCMAKE_BUILD_TYPE=Release -DGEOS_DIR=/usr/local/lib/libgeos_c
And finally, this is where I am stuck.
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220304/5b9dc41b/attachment.html>

From englishchristophera at gmail.com  Fri Mar  4 11:21:21 2022
From: englishchristophera at gmail.com (chris english)
Date: Fri, 4 Mar 2022 14:21:21 -0500
Subject: [gdal-dev] Attempting a coherent CMAKE problem report from a
 git clone- steps taken
In-Reply-To: <CAASFQpQZDy7vz0Zsqjxkn1ba7PiFO_ALMDUkRf3s2WQPEy8Yyw@mail.gmail.com>
References: <CAASFQpQZDy7vz0Zsqjxkn1ba7PiFO_ALMDUkRf3s2WQPEy8Yyw@mail.gmail.com>
Message-ID: <CAASFQpRK1rirdPEhEbO0nTUMb5GOMuOc=Y3Goq+=u4sGRjqktQ@mail.gmail.com>

This generated file, local.cmake, seems to suggest that the build should
still be pointing (GEOS_DIR) /usr/local/lib/cmake/GEOS, but
GEOS::geos_c location still doesn't get set.
#----------------------------------------------------------------
# Generated CMake target import file for configuration
"Release-DCMAKE_INSTALL_PREFIX=/usr/local".
#----------------------------------------------------------------

# Commands may need to know the format version.
set(CMAKE_IMPORT_FILE_VERSION 1)

# Import target "GEOS::geos" for configuration
"Release-DCMAKE_INSTALL_PREFIX=/usr/local"
set_property(TARGET GEOS::geos APPEND PROPERTY IMPORTED_CONFIGURATIONS
RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL)
set_target_properties(GEOS::geos PROPERTIES
  IMPORTED_LOCATION_RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL
"${_IMPORT_PREFIX}/lib/libgeos.so.3.10.2"
  IMPORTED_SONAME_RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL
"libgeos.so.3.10.2"
  )

list(APPEND _IMPORT_CHECK_TARGETS GEOS::geos )
list(APPEND _IMPORT_CHECK_FILES_FOR_GEOS::geos
"${_IMPORT_PREFIX}/lib/libgeos.so.3.10.2" )

# Import target "GEOS::geos_c" for configuration
"Release-DCMAKE_INSTALL_PREFIX=/usr/local"
set_property(TARGET GEOS::geos_c APPEND PROPERTY IMPORTED_CONFIGURATIONS
RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL)
set_target_properties(GEOS::geos_c PROPERTIES

IMPORTED_LINK_DEPENDENT_LIBRARIES_RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL
"GEOS::geos"
  IMPORTED_LOCATION_RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL
"${_IMPORT_PREFIX}/lib/libgeos_c.so.1.16.0"
  IMPORTED_SONAME_RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL "libgeos_c.so.1"
  )

list(APPEND _IMPORT_CHECK_TARGETS GEOS::geos_c )
list(APPEND _IMPORT_CHECK_FILES_FOR_GEOS::geos_c
"${_IMPORT_PREFIX}/lib/libgeos_c.so.1.16.0" )

# Commands beyond this point should not need to know the version.
set(CMAKE_IMPORT_FILE_VERSION)

On Fri, Mar 4, 2022 at 2:02 PM chris english <englishchristophera at gmail.com>
wrote:

> Concerning (executed in either git download directory or build):
> ~/gdal$ git describe
> v3.3.0-2898-gba4e7c404b
>
> Condition: was building and stopped with
> [ 89%] Built target gcore_mdreader
> CMakeFiles/GDAL.dir/build.make:2661: *** target pattern contains no '%'.
> Stop.
> make[1]: *** [CMakeFiles/Makefile2:4871: CMakeFiles/GDAL.dir/all] Error 2
> make: *** [Makefile:146: all] Error 2
>
> As we were building objects in gcore, the
> 'CMakeFiles/GDAL.dir/build.make:2661:'
> refers to ~/gdal/build/gcore/CMakeFiles/GDAL.dir/build.make, line 2661
> that is in the neighborhood of a problem at line 2667:
> GEOS::geos_c-NOT FOUND
> Well, that could be bad, and says the problem is local rather than with
> the git.
> Perhaps a sudo ldconfig is called for. Done.
> In ~/gdal/build rm CMakeCache.txt
> Run cmake .. again
> Copy and paste all output to editor and down at bottom find
> IMPORTED_LOCATION not set for imported target "GEOS::geos_c" configuration
>   "Release".
> OK, so not something that ldconfig fixes. Pass in libgeos...how?
> Resorting to ccmake ..
> Pg 25 of 44
> GEOS_DIR  /usr/local/lib/cmake/GEOS
> contains:
> ls /usr/local/lib/cmake/GEOS
> geos-config.cmake  geos-config-version.cmake  geos-targets.cmake
>  local.cmake
> So, nothing looking very useful, change to /usr/local/lib and try again
> change to /usr/local/lib/libgeos_c.so
> And try:
> build$ cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
> -DCMAKE_BUILD_TYPE=Release -DGEOS_DIR=/usr/local/lib/libgeos_c
> And finally, this is where I am stuck.
> Chris
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220304/10ecac96/attachment.html>

From dg0yt at darc.de  Fri Mar  4 11:26:09 2022
From: dg0yt at darc.de (dg0yt at darc.de)
Date: Fri, 4 Mar 2022 20:26:09 +0100 (CET)
Subject: [gdal-dev] Attempting a coherent CMAKE problem report from a
 git clone- steps taken
In-Reply-To: <CAASFQpRK1rirdPEhEbO0nTUMb5GOMuOc=Y3Goq+=u4sGRjqktQ@mail.gmail.com>
References: <CAASFQpQZDy7vz0Zsqjxkn1ba7PiFO_ALMDUkRf3s2WQPEy8Yyw@mail.gmail.com>
 <CAASFQpRK1rirdPEhEbO0nTUMb5GOMuOc=Y3Goq+=u4sGRjqktQ@mail.gmail.com>
Message-ID: <1421250479.723246.1646421969081@office.mailbox.org>

It looks like you missed a " " after -DCMAKE_BUILD_TYPE=Release when configuring GEOS:

> set_property(TARGET GEOS::geos APPEND PROPERTY IMPORTED_CONFIGURATIONS RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL)

Kai.

From maphew at gmail.com  Fri Mar  4 14:19:05 2022
From: maphew at gmail.com (Matt Wilkie)
Date: Fri, 4 Mar 2022 15:19:05 -0700
Subject: [gdal-dev] gdal-utils: understanding the __main__ pattern
Message-ID: <CANGB9XTayUw138VGK3J6LB9nVHEuNuXvx0nmhtqY4kaU+srh2A@mail.gmail.com>

Hello folks who know about the python script construction :)

The pattern used in all of the python scripts under swig/python/gdal-utils
is foreign to me. Can someone explain what's going on and why it's used?
(or point to where this has been explored already).

if __name__ == '__main__':
    sys.exit(main(sys.argv))

Gdal utils .py all end with the block above. Everything else I've used to
this point are more like:

if __name__ == '__main__':
    main(sys.argv)

The motivation for asking (besides just being curious about something new!)
is that I'm trying to figure out how we can use pip to create standard
launch wrappers in PYTHONHOME\Scripts instead of manual post-install setup
of the batch files we use now. When I change setup.py to do this via
console_scripts the resulting wrappers fail on this main construct. So I
need to understand what the original intent is to try and come up with a
remedy.

```
? gdal_edit fooo
Traceback (most recent call last):
  File "C:\Users\Matt\.conda\envs\gdal\Scripts\gdal_edit-script.py", line
33, in <module>
    sys.exit(load_entry_point('gdal-utils', 'console_scripts',
'gdal_edit')())
TypeError: main() missing 1 required positional argument: 'argv'
```

Thanks!

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220304/82831758/attachment.html>

From englishchristophera at gmail.com  Fri Mar  4 21:30:03 2022
From: englishchristophera at gmail.com (chris english)
Date: Sat, 5 Mar 2022 00:30:03 -0500
Subject: [gdal-dev] Attempting a coherent CMAKE problem report from a
 git clone- steps taken
In-Reply-To: <1421250479.723246.1646421969081@office.mailbox.org>
References: <CAASFQpQZDy7vz0Zsqjxkn1ba7PiFO_ALMDUkRf3s2WQPEy8Yyw@mail.gmail.com>
 <CAASFQpRK1rirdPEhEbO0nTUMb5GOMuOc=Y3Goq+=u4sGRjqktQ@mail.gmail.com>
 <1421250479.723246.1646421969081@office.mailbox.org>
Message-ID: <CAASFQpQr9ExJ4O0vkx3n3n0VXzmi+peDMVKzsXSJbhPBO7dDxw@mail.gmail.com>

Kai,
Rebuilt Geos with your insight, and two spaces between all -D entries,
including eliminating MrSid that was complied under gcc 521 or so and might
likely cause problems, using GDAL build hints
<https://gdal.org/build_hints.html>, and we have success on on *target
gcore_mdreader*, and I'll move on to sorting out what is wrong with missing
symbols in whatever provides 'nc_open_mem', viz:
[ 89%] Built target gcore_mdreader
[ 89%] Linking CXX shared library libgdal.so
/usr/bin/ld: frmts/netcdf/CMakeFiles/gdal_netCDF.dir/netcdfdataset.cpp.o:
in function `netCDFDataset::Open(GDALOpenInfo*)':
netcdfdataset.cpp:(.text+0x283d4): undefined reference to `nc_open_mem'
/usr/bin/ld: netcdfdataset.cpp:(.text+0x2852a): undefined reference to
`nc_open_mem'

Looks like updating libnetcdf...or perhaps not netcdf won't play nice with
hdf5-1.12.1 till 4.9 dist release
<https://github.com/Unidata/netcdf-c/issues/2166> so drop netcdf for now.
And have to figure out turning off DODs, but wow, spotting a missing space,
I'd have to perl that or something. But, have now arrived at:

[ 86%] Built target gcore_mdreader
[ 86%] Linking CXX shared library libgdal.so
/usr/bin/ld: frmts/dods/CMakeFiles/gdal_DODS.dir/dodsdataset2.cpp.o: in
function `get_variable(libdap::DDS&, std::__cxx11::basic_string<char,
std::char_traits<char>, std::allocator<char> > const&)':
dodsdataset2.cpp:(.text+0x624): undefined reference to
`libdap::www2id(std::__cxx11::basic_string<char, std::char_traits<char>,
std::allocator<char> > const&, std::__cxx11::basic_string<char,
std::char_traits<char>, std::allocator<char> > const&,
std::__cxx11::basic_string<char, std::char_traits<char>,
std::allocator<char> > const&)'  <------snip

and appears -DGDAL_ENABLE_DRIVER_DODS:BOOL=OFF is not doing it. So,
continuing.
Thanks again.



On Fri, Mar 4, 2022 at 2:26 PM <dg0yt at darc.de> wrote:

> It looks like you missed a " " after -DCMAKE_BUILD_TYPE=Release when
> configuring GEOS:
>
> > set_property(TARGET GEOS::geos APPEND PROPERTY IMPORTED_CONFIGURATIONS
> RELEASE-DCMAKE_INSTALL_PREFIX=/USR/LOCAL)
>
> Kai.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220305/9c9de420/attachment.html>

From englishchristophera at gmail.com  Sat Mar  5 19:50:12 2022
From: englishchristophera at gmail.com (chris english)
Date: Sat, 5 Mar 2022 22:50:12 -0500
Subject: [gdal-dev] CMAKE Report:[ 98%] Linking CXX executable pytest_runner;
 recompile with -fPIE/-fPIC
Message-ID: <CAASFQpRebM7UPkw1ojnmnuUPJ4c9fMMvQN4xE8Hd6fbRi7wh3w@mail.gmail.com>

This can't be a novel 'almost got there', but then not.
[ 98%] Linking CXX executable pytest_runner
/usr/bin/ld: /usr/local/lib/libpython3.6m.a(pylifecycle.o): relocation
R_X86_64_32 against `.rodata.str1.1' can not be used when making a PIE
object; recompile with -fPIE
/usr/bin/ld: /usr/local/lib/libpython3.6m.a(pystate.o): relocation
R_X86_64_32S against symbol `_PyEval_EvalFrameDefault' can not be used when
making a PIE object; recompile with -fPIE

In ubuntu-20.04, so have Python2.7, Python3.6, Python3.8, and 3.9, and
generally advised against summarily removing any, so...they stay.
Still working with git describe: v3.3.0-2898-gba4e7c404b

I'd like to say -fPIE is probably -fPIC, but beyond that I don't know how
to proceed.
Previously, to get to here, eliminated all DODS, libdap, netcdf, mrsid
references.
Any help to get beyond 98% to 100% good news appreciated.
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220305/ca586d39/attachment.html>

From even.rouault at spatialys.com  Sun Mar  6 02:52:38 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Mar 2022 11:52:38 +0100
Subject: [gdal-dev] gdal-utils: understanding the __main__ pattern
In-Reply-To: <CANGB9XTayUw138VGK3J6LB9nVHEuNuXvx0nmhtqY4kaU+srh2A@mail.gmail.com>
References: <CANGB9XTayUw138VGK3J6LB9nVHEuNuXvx0nmhtqY4kaU+srh2A@mail.gmail.com>
Message-ID: <b3126f58-d1a1-7066-6161-547f105d9ab7@spatialys.com>

Matt,

Le 04/03/2022 ? 23:19, Matt Wilkie a ?crit?:
> Hello folks who know about the python script construction :)
>
> The pattern used in all of the python scripts under 
> swig/python/gdal-utils is foreign to me. Can someone explain what's 
> going on and why it's used? (or point to where this has been explored 
> already).
>
> if__name__ == '__main__':
> ? ? sys.exit(main(sys.argv))
>
> Gdal utils .py all end with the block above. Everything else I've used 
> to this point are more like:
>
> if__name__ == '__main__':
> ? ? main(sys.argv)
I believe the idea was that the main() function could be used as a 
library function, in larger processing scripts, and thus using 
sys.exit() in the main itself would be quite unfriendly. If you just do 
main(sys.argv), the return value of the main wouldn't be propagated to 
the caller, right ? Or perhaps "everything else" you are refering to 
uses exceptions ?, and thus errors are naturally propagated to the caller.
>
> The motivation for asking (besides just being curious about something 
> new!) is that I'm trying to figure out how we can use pip to create 
> standard launch wrappers in PYTHONHOME\Scripts instead of manual 
> post-install setup of the batch files we use now. When I change 
> setup.py to do this via console_scripts the resulting wrappers fail on 
> this main construct. So I need to understand what the original intent 
> is to try and come up with a remedy.
>
> ```
> ? gdal_edit fooo
> Traceback (most recent call last):
> ? File "C:\Users\Matt\.conda\envs\gdal\Scripts\gdal_edit-script.py", 
> line 33, in <module>
> ? ? sys.exit(load_entry_point('gdal-utils', 'console_scripts', 
> 'gdal_edit')())
> TypeError: main() missing 1 required positional argument: 'argv'
> ```

The issue seems to be different. I believe this was mentioned in a 
recent ticket or pull request that the main() signature should probably 
be changed to

def main(argv = None):
 ??? if argv is None:
 ??? ? ? argv = sys.argv


Take all the above with a grain of salt. I'm not an expert in the best 
way to create idiomatic Python scripts. A large part of what we have too 
is largely due to just things being like they are, not necessarily with 
deep reasons.

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sun Mar  6 03:18:52 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Mar 2022 12:18:52 +0100
Subject: [gdal-dev] VRT dataset to text in-memory?
In-Reply-To: <CAAcGz9-AU5m1oxu18cxgz=9rmUrzPnYki7yEBsmnwO3zkZcvEw@mail.gmail.com>
References: <CAAcGz9-AU5m1oxu18cxgz=9rmUrzPnYki7yEBsmnwO3zkZcvEw@mail.gmail.com>
Message-ID: <1b07a474-ebc9-cdec-8725-db9aa3a5b673@spatialys.com>

Michael,

yes you can get the VRT XML text with:

poVRTDS->GetMetadata("xml:VRT")[0]

If you can submit a pull request documenting that, that would be welcome

Even

Le 03/03/2022 ? 11:14, Michael Sumner a ?crit?:
> Hello, reading the raster VRT tutorial
>
> https://gdal.org/drivers/raster/vrt.html#creation-of-vrt-datasets
>
> with this code:
>
> //
> int ? nBand;
> GDALDriver *poDriver = (GDALDriver *) GDALGetDriverByName( "VRT" );
> GDALDataset *poSrcDS, *poVRTDS;
> poSrcDS = (GDALDataset *) GDALOpenShared( pszSourceFilename, 
> GA_ReadOnly );
> poVRTDS = poDriver->CreateCopy( "", poSrcDS, FALSE, NULL, NULL, NULL );
> //
>
> Is there a way to obtained the VRT XML text representing poVRTDS 
> without writing to an actual file?
>
> Sorry if this is obvious, haven't been able to find an example that 
> does what I want. I've seen examples using GetMetadataItem from a band 
> for parts of the XML, but can't see how to get the entire thing.
>
> Thanks for your help.
>
> Best, Mike
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220306/5aa7e3fa/attachment.html>

From even.rouault at spatialys.com  Sun Mar  6 10:31:44 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Mar 2022 19:31:44 +0100
Subject: [gdal-dev] crunch lib
In-Reply-To: <CAASFQpR2409T-O9WVM2bVPT5DNRAWuGfEXzTcAP9uWjiKx9vKg@mail.gmail.com>
References: <CAASFQpR2409T-O9WVM2bVPT5DNRAWuGfEXzTcAP9uWjiKx9vKg@mail.gmail.com>
Message-ID: <1bab0594-c2e2-6794-d900-7e7461986ef3@spatialys.com>

Can you be more explicit of what does not work exactly ?

- I've just tried https://github.com/DaemonEngine/crunch and it does 
build, but doesn't install headers or a library file, so can't be easily 
used by GDAL

- I've just tried successfully the build instructions at 
https://gdal.org/drivers/raster/dds.html#build-crunch (for Linux), and 
then managed to build GDAL against it with "cmake .. 
-DCMAKE_PREFIX_PATH=/home/even/install-crunch"

Even

Le 04/03/2022 ? 01:48, chris english a ?crit?:
> https://github.com/DaemonEngine/crunch
> appears to be a better source to point to for crunch, as it builds, 
> whereas crunch link in docs doesn't.
> And builds for the hapless, as I believe I've demonstrated.
> Chris
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sun Mar  6 10:34:01 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Mar 2022 19:34:01 +0100
Subject: [gdal-dev] CMAKE [ 89%] Built target gcore_mdreader *** target
 pattern contains no '%'
In-Reply-To: <CAASFQpRgAHpiNR4bpynE1khygCMqRH_LKLfT-JfLA67kH-rKzw@mail.gmail.com>
References: <CAASFQpRgAHpiNR4bpynE1khygCMqRH_LKLfT-JfLA67kH-rKzw@mail.gmail.com>
Message-ID: <ec243aa6-8a60-a34e-b6dd-ee9fe52110a2@spatialys.com>

In some circumstances, stale CMake cache variables of previous failed 
builds remain, and make it hard to do new builds even after having 
correcting the error. You can solve this by removing CMakeCache.txt to 
have a clean cmake run.

Le 04/03/2022 ? 01:40, chris english a ?crit?:
> This subject line is a mash up of this:
>
> [ 89%] Built target gcore_mdreader
> CMakeFiles/GDAL.dir/build.make:2661: *** target pattern contains no 
> '%'.? Stop.
> make[1]: *** [CMakeFiles/Makefile2:4871: CMakeFiles/GDAL.dir/all] Error 2
>
> and hereafter I have no idea of how to proceed. I've previously 
> dispensed with other recalcitrant drivers (MrSid), can I do the same 
> with target 'gcore' without the world collapsing upon me and would my 
> functionality be greatly reduced.?
>
> Chris
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sun Mar  6 10:42:05 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Mar 2022 19:42:05 +0100
Subject: [gdal-dev] CMAKE poppler c++17
In-Reply-To: <CAASFQpT_kn8Ucskk01SUCx5Nmm5zB8xnuy-hqRp5CaKE0zsnMQ@mail.gmail.com>
References: <CAASFQpRob=GvSKmkMXMNVj9bVsfxw5vRM8SnNEz57NAxj--a7w@mail.gmail.com>
 <3547ded6-b554-2c74-0b99-658d15403066@gatewaygeomatics.com>
 <CAASFQpT_kn8Ucskk01SUCx5Nmm5zB8xnuy-hqRp5CaKE0zsnMQ@mail.gmail.com>
Message-ID: <0e3c8036-f64e-5e78-73d7-79538b63041c@spatialys.com>

| Thereafter, MrSid driver cratered on some 2004 Lizardtech defines in 
lt_platform.h that defined possible GCC compilers topping out at <= 5 
(rather than a future unimaginable 9 or 12). Removing a desire for 
MrSid, in this instance through ccmake,

That's completely unrelated to building GDAL through autoconf or cmake. 
This is an issue with the LizardTech SDK that indeed remains stuck to 
ancient GCC versions

I see I locally patched line 40 of lt_platform.h to remove the GCC 
version check, and then things go flawlessly

#if (defined(__GNUC__) || defined(__GNUG__)) // && (3 <= __GNUC__ && 
__GNUC__ <= 5)

I've just tried to submit this issue to their support service.

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220306/2706aaeb/attachment.html>

From even.rouault at spatialys.com  Sun Mar  6 10:50:04 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 6 Mar 2022 19:50:04 +0100
Subject: [gdal-dev] Attempting a coherent CMAKE problem report from a
 git clone- steps taken
In-Reply-To: <CAASFQpQr9ExJ4O0vkx3n3n0VXzmi+peDMVKzsXSJbhPBO7dDxw@mail.gmail.com>
References: <CAASFQpQZDy7vz0Zsqjxkn1ba7PiFO_ALMDUkRf3s2WQPEy8Yyw@mail.gmail.com>
 <CAASFQpRK1rirdPEhEbO0nTUMb5GOMuOc=Y3Goq+=u4sGRjqktQ@mail.gmail.com>
 <1421250479.723246.1646421969081@office.mailbox.org>
 <CAASFQpQr9ExJ4O0vkx3n3n0VXzmi+peDMVKzsXSJbhPBO7dDxw@mail.gmail.com>
Message-ID: <d6103316-0a67-c02a-5bd4-8ef8e5a17f9f@spatialys.com>


Le 05/03/2022 ? 06:30, chris english a ?crit?:
> Kai,
> Rebuilt Geos with your insight, and two spaces between all -D entries, 
> including eliminating MrSid that was complied under gcc 521 or so and 
> might likely cause problems, using GDAL build hints 
> <https://gdal.org/build_hints.html>, and we have success on on *target 
> gcore_mdreader*, and I'll move on to sorting out what is wrong with 
> missing symbols in whatever provides 'nc_open_mem', viz:
> [ 89%] Built target gcore_mdreader
> [ 89%] Linking CXX shared library libgdal.so
> /usr/bin/ld: 
> frmts/netcdf/CMakeFiles/gdal_netCDF.dir/netcdfdataset.cpp.o: in 
> function `netCDFDataset::Open(GDALOpenInfo*)':
> netcdfdataset.cpp:(.text+0x283d4): undefined reference to `nc_open_mem'
> /usr/bin/ld: netcdfdataset.cpp:(.text+0x2852a): undefined reference to 
> `nc_open_mem'
nc_open_mem is provided by the netCDF library. Your issue might come 
perharps from doing an initial cmake run with some netCDF version that 
includes that symbol , and re-running with an older one that hasn't it, 
and then cmake is confused becaused it has kept in cache that the netCDF 
lib has the nc_open_mem symbol. Removing CMakeCache.txt and re-running 
would solve it.
>
> Looks like updating libnetcdf...or perhaps not netcdf won't play nice 
> with hdf5-1.12.1 till 4.9 dist release 
> <https://github.com/Unidata/netcdf-c/issues/2166> so drop netcdf for now.
> And have to figure out turning off DODs, but wow, spotting a missing 
> space, I'd have to perl that or something. But, have now arrived at:
Which version of libdap do you use ? Note that support for DODS is 
likely to be dropped as we lack maintainers for it (see 
https://github.com/OSGeo/gdal/issues/5173)
>
> [ 86%] Built target gcore_mdreader
> [ 86%] Linking CXX shared library libgdal.so
> /usr/bin/ld: frmts/dods/CMakeFiles/gdal_DODS.dir/dodsdataset2.cpp.o: 
> in function `get_variable(libdap::DDS&, 
> std::__cxx11::basic_string<char, std::char_traits<char>, 
> std::allocator<char> > const&)':
> dodsdataset2.cpp:(.text+0x624): undefined reference to 
> `libdap::www2id(std::__cxx11::basic_string<char, 
> std::char_traits<char>, std::allocator<char> > const&, 
> std::__cxx11::basic_string<char, std::char_traits<char>, 
> std::allocator<char> > const&, std::__cxx11::basic_string<char, 
> std::char_traits<char>, std::allocator<char> > const&)'? <------snip
>
> and appears -DGDAL_ENABLE_DRIVER_DODS:BOOL=OFF is not doing it.

That's weird... Note that there's also a OGR DODS driver, so to fully 
remove any DODS support -DOGR_ENABLE_DRIVER_DODS:BOOL=OFF would be 
needed too

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220306/7883e933/attachment-0001.html>

From englishchristophera at gmail.com  Sun Mar  6 13:17:26 2022
From: englishchristophera at gmail.com (chris english)
Date: Sun, 6 Mar 2022 16:17:26 -0500
Subject: [gdal-dev] CMAKE poppler c++17
In-Reply-To: <0e3c8036-f64e-5e78-73d7-79538b63041c@spatialys.com>
References: <CAASFQpRob=GvSKmkMXMNVj9bVsfxw5vRM8SnNEz57NAxj--a7w@mail.gmail.com>
 <3547ded6-b554-2c74-0b99-658d15403066@gatewaygeomatics.com>
 <CAASFQpT_kn8Ucskk01SUCx5Nmm5zB8xnuy-hqRp5CaKE0zsnMQ@mail.gmail.com>
 <0e3c8036-f64e-5e78-73d7-79538b63041c@spatialys.com>
Message-ID: <CAASFQpTpp69MR3hw3rG78QbxFUEmkz3P72mmFQZeh_FL0FAAjw@mail.gmail.com>

I will follow your lead locally and comment out the GCC version check as
MrSid is useful, and perhaps Maintainer to Maintainer
would have more effect over at LizardTech. And apologies for inflicting
this on your work email threads.

I noted a desire to get feedback in anticipation of the CMAKE
transition/requirement, and these are one person's prat falls.
Halfway through a python .so testing now (hadn't given much thought to 'Do
I have a python .so?' as I've been building gdal since 1.10.1,
and all gdal tools have worked- so what? me worry?).

I think the -DODs transition could be a little smoother as it creates a
head scratch, what to do about dap and netcdf, and am a little discouraged
by the -D use deprecated approach as it seems =NO, rather than =YES,
doesn't unentangle DODS from dap and netcdf, but don't anticipate needing
them again for a little while so will see how it develops.

Anyway, at the end, I hope to both be successful, note the things one must
be mindful of in anticipation of using cmake (like having a python.so &
etc), as this has really forced me to come to grips with cmake, and why it
would be advantageous both to users as maintainers.

Thanks again for the MrSid tip.
Chris


On Sun, Mar 6, 2022 at 1:42 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> | Thereafter, MrSid driver cratered on some 2004 Lizardtech defines in
> lt_platform.h that defined possible GCC compilers topping out at <= 5
> (rather than a future unimaginable 9 or 12). Removing a desire for MrSid,
> in this instance through ccmake,
>
> That's completely unrelated to building GDAL through autoconf or cmake.
> This is an issue with the LizardTech SDK that indeed remains stuck to
> ancient GCC versions
>
> I see I locally patched line 40 of lt_platform.h to remove the GCC version
> check, and then things go flawlessly
>
> #if (defined(__GNUC__) || defined(__GNUG__)) // && (3 <= __GNUC__ &&
> __GNUC__ <= 5)
>
> I've just tried to submit this issue to their support service.
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220306/708f2f6c/attachment.html>

From englishchristophera at gmail.com  Sun Mar  6 13:42:43 2022
From: englishchristophera at gmail.com (chris english)
Date: Sun, 6 Mar 2022 16:42:43 -0500
Subject: [gdal-dev] Attempting a coherent CMAKE problem report from a
 git clone- steps taken
In-Reply-To: <d6103316-0a67-c02a-5bd4-8ef8e5a17f9f@spatialys.com>
References: <CAASFQpQZDy7vz0Zsqjxkn1ba7PiFO_ALMDUkRf3s2WQPEy8Yyw@mail.gmail.com>
 <CAASFQpRK1rirdPEhEbO0nTUMb5GOMuOc=Y3Goq+=u4sGRjqktQ@mail.gmail.com>
 <1421250479.723246.1646421969081@office.mailbox.org>
 <CAASFQpQr9ExJ4O0vkx3n3n0VXzmi+peDMVKzsXSJbhPBO7dDxw@mail.gmail.com>
 <d6103316-0a67-c02a-5bd4-8ef8e5a17f9f@spatialys.com>
Message-ID: <CAASFQpSUgD5NEfO98Gb3vBuc0wFwtqMwtD4qYcDahXE_hxVcHQ@mail.gmail.com>

Noted. And it seems this reflects the generosity of the gdal/cmake find
process, that any pertinent libs found will be included on the premise that
if one went to the effort to have them, one must want them. And when no
longer needed, remove them, which most users neglect to do at their peril;
but, they are not long sighted Maintainers.

And there are those few GDAL/OGR couplets where both must be addressed, but
if the logic is that you can't do OGR but that you have GDAL
driver...though it seems that's neither the logic nor code, they are
separate, and both will be addressed.

On Sun, Mar 6, 2022 at 1:50 PM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 05/03/2022 ? 06:30, chris english a ?crit :
>
> Kai,
> Rebuilt Geos with your insight, and two spaces between all -D entries,
> including eliminating MrSid that was complied under gcc 521 or so and might
> likely cause problems, using GDAL build hints
> <https://gdal.org/build_hints.html>, and we have success on on *target
> gcore_mdreader*, and I'll move on to sorting out what is wrong with
> missing symbols in whatever provides 'nc_open_mem', viz:
> [ 89%] Built target gcore_mdreader
> [ 89%] Linking CXX shared library libgdal.so
> /usr/bin/ld: frmts/netcdf/CMakeFiles/gdal_netCDF.dir/netcdfdataset.cpp.o:
> in function `netCDFDataset::Open(GDALOpenInfo*)':
> netcdfdataset.cpp:(.text+0x283d4): undefined reference to `nc_open_mem'
> /usr/bin/ld: netcdfdataset.cpp:(.text+0x2852a): undefined reference to
> `nc_open_mem'
>
> nc_open_mem is provided by the netCDF library. Your issue might come
> perharps from doing an initial cmake run with some netCDF version that
> includes that symbol , and re-running with an older one that hasn't it, and
> then cmake is confused becaused it has kept in cache that the netCDF lib
> has the nc_open_mem symbol. Removing CMakeCache.txt and re-running would
> solve it.
>
>
> Looks like updating libnetcdf...or perhaps not netcdf won't play nice
> with hdf5-1.12.1 till 4.9 dist release
> <https://github.com/Unidata/netcdf-c/issues/2166> so drop netcdf for now.
> And have to figure out turning off DODs, but wow, spotting a missing
> space, I'd have to perl that or something. But, have now arrived at:
>
> Which version of libdap do you use ? Note that support for DODS is likely
> to be dropped as we lack maintainers for it (see
> https://github.com/OSGeo/gdal/issues/5173)
>
>
> [ 86%] Built target gcore_mdreader
> [ 86%] Linking CXX shared library libgdal.so
> /usr/bin/ld: frmts/dods/CMakeFiles/gdal_DODS.dir/dodsdataset2.cpp.o: in
> function `get_variable(libdap::DDS&, std::__cxx11::basic_string<char,
> std::char_traits<char>, std::allocator<char> > const&)':
> dodsdataset2.cpp:(.text+0x624): undefined reference to
> `libdap::www2id(std::__cxx11::basic_string<char, std::char_traits<char>,
> std::allocator<char> > const&, std::__cxx11::basic_string<char,
> std::char_traits<char>, std::allocator<char> > const&,
> std::__cxx11::basic_string<char, std::char_traits<char>,
> std::allocator<char> > const&)'  <------snip
>
> and appears -DGDAL_ENABLE_DRIVER_DODS:BOOL=OFF is not doing it.
>
> That's weird... Note that there's also a OGR DODS driver, so to fully
> remove any DODS support -DOGR_ENABLE_DRIVER_DODS:BOOL=OFF would be needed
> too
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220306/ea0818fc/attachment.html>

From englishchristophera at gmail.com  Sun Mar  6 13:51:23 2022
From: englishchristophera at gmail.com (chris english)
Date: Sun, 6 Mar 2022 16:51:23 -0500
Subject: [gdal-dev] crunch lib
In-Reply-To: <1bab0594-c2e2-6794-d900-7e7461986ef3@spatialys.com>
References: <CAASFQpR2409T-O9WVM2bVPT5DNRAWuGfEXzTcAP9uWjiKx9vKg@mail.gmail.com>
 <1bab0594-c2e2-6794-d900-7e7461986ef3@spatialys.com>
Message-ID: <CAASFQpRg2kXt7TQ7d1W19YwOFCLMEUpAuUGHbuUKSOYkE2kXaQ@mail.gmail.com>

I defer, though had the opposite experience and the DaemonEngine fork
seemed more recently maintained,
suggested to be the reason for their fork.

On Sun, Mar 6, 2022 at 1:31 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Can you be more explicit of what does not work exactly ?
>
> - I've just tried https://github.com/DaemonEngine/crunch and it does
> build, but doesn't install headers or a library file, so can't be easily
> used by GDAL
>
> - I've just tried successfully the build instructions at
> https://gdal.org/drivers/raster/dds.html#build-crunch (for Linux), and
> then managed to build GDAL against it with "cmake ..
> -DCMAKE_PREFIX_PATH=/home/even/install-crunch"
>
> Even
>
> Le 04/03/2022 ? 01:48, chris english a ?crit :
> > https://github.com/DaemonEngine/crunch
> > appears to be a better source to point to for crunch, as it builds,
> > whereas crunch link in docs doesn't.
> > And builds for the hapless, as I believe I've demonstrated.
> > Chris
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220306/e74afb2a/attachment.html>

From mdsumner at gmail.com  Sun Mar  6 20:06:20 2022
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 7 Mar 2022 15:06:20 +1100
Subject: [gdal-dev] VRT dataset to text in-memory?
In-Reply-To: <1b07a474-ebc9-cdec-8725-db9aa3a5b673@spatialys.com>
References: <CAAcGz9-AU5m1oxu18cxgz=9rmUrzPnYki7yEBsmnwO3zkZcvEw@mail.gmail.com>
 <1b07a474-ebc9-cdec-8725-db9aa3a5b673@spatialys.com>
Message-ID: <CAAcGz9_fhpJxSvN2NWmc6aC_F6DqOKkcLF4mRz=FNiMb+7NOMw@mail.gmail.com>

Excellent, Even - thanks so much, I have this working now.  I've crafted a
PR for the example.

Mateusz: thank you for the source code overview, I will be using that too.

Best, Mike

On Sun, Mar 6, 2022 at 10:18 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Michael,
>
> yes you can get the VRT XML text with:
>
> poVRTDS->GetMetadata("xml:VRT")[0]
>
> If you can submit a pull request documenting that, that would be welcome
>
> Even
> Le 03/03/2022 ? 11:14, Michael Sumner a ?crit :
>
> Hello, reading the raster VRT tutorial
>
> https://gdal.org/drivers/raster/vrt.html#creation-of-vrt-datasets
>
> with this code:
>
> //
> int   nBand;
> GDALDriver *poDriver = (GDALDriver *) GDALGetDriverByName( "VRT" );
> GDALDataset *poSrcDS, *poVRTDS;
> poSrcDS = (GDALDataset *) GDALOpenShared( pszSourceFilename, GA_ReadOnly );
> poVRTDS = poDriver->CreateCopy( "", poSrcDS, FALSE, NULL, NULL, NULL );
> //
>
> Is there a way to obtained the VRT XML text representing poVRTDS without
> writing to an actual file?
>
> Sorry if this is obvious, haven't been able to find an example that does
> what I want. I've seen examples using GetMetadataItem from a band for parts
> of the XML, but can't see how to get the entire thing.
>
> Thanks for your help.
>
> Best, Mike
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220307/73213e28/attachment-0001.html>

From even.rouault at spatialys.com  Mon Mar  7 03:26:15 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 7 Mar 2022 12:26:15 +0100
Subject: [gdal-dev] GDAL 3.4.2 RC1 available
Message-ID: <a4e94c3a-ee65-4ca2-9f08-ae8413b1c7be@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.4.2 release candidate.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.4.2/gdal342rc1.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc1.zip

GDAL-GRASS plugin:

 ? https://download.osgeo.org/gdal/3.4.2/gdal-grass-3.4.2.tar.gz

The NEWS file is here :

 ? https://github.com/OSGeo/gdal/blob/v3.4.2RC1/gdal/NEWS.md

I'll call for a vote promoting it to final later this week if no
serious problems are reported before.

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From chaitanyajalluri at gmail.com  Mon Mar  7 04:42:56 2022
From: chaitanyajalluri at gmail.com (Chaitanya Jalluri)
Date: Mon, 7 Mar 2022 18:12:56 +0530
Subject: [gdal-dev] GDAL support on OCI
Message-ID: <CALfZSLXJ_kRMG-bOyLv1OAkZs=jkL96k894+fgFEnNYrAoLfyQ@mail.gmail.com>

Hi,

Does gdal support the accessing and rendering data on the fly (i.e virtual
file systems ) from the Oracle cloud storage?? I couldn't see any support
of this in the documentation https://gdal.org/user/virtual_file_systems.html .
Can you please help with it?

Thanks and regards
Chaitanya Jalluri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220307/f8277e71/attachment.html>

From ivan.lucena at outlook.com  Mon Mar  7 05:27:14 2022
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Mon, 7 Mar 2022 13:27:14 +0000
Subject: [gdal-dev] GDAL support on OCI
In-Reply-To: <CALfZSLXJ_kRMG-bOyLv1OAkZs=jkL96k894+fgFEnNYrAoLfyQ@mail.gmail.com>
References: <CALfZSLXJ_kRMG-bOyLv1OAkZs=jkL96k894+fgFEnNYrAoLfyQ@mail.gmail.com>
Message-ID: <MN2PR04MB5693F92839B41A0BEF4ED23AF2089@MN2PR04MB5693.namprd04.prod.outlook.com>

Interesting question Chaitanya,

But the answer is probably no.

The VSI drivers mentioned on that page are supposed to access assets, buckets and file system on popular cloud services.

There is no Oracle Cloud Infrastructure (OCI) driver for that purpose, but you might be able to access spatial data types SDO_GEOMETRY and SDO_GEORASTER tables/columns on a server running on the cloud, just like if it were running in any machine. No?

The GDAL/OGR driver OCI, developed many decades ago, was named OCI in reference to the Oracle C SDK. It can access "vector" data in SDO_GEOMETRY type.

https://gdal.org/drivers/vector/oci.html#vector-oci

The GDAL georaster driver is a raster driver that supports SDO_GEORASTER type.

https://gdal.org/drivers/raster/georaster.html

Inside the georaster driver code there is a VSI/OCI driver that can read images in BLOB data type on the database.

https://github.com/OSGeo/gdal/blob/master/frmts/georaster/cpl_vsil_ocilob.cpp

That driver is rarely exposed for the public and there is documentation. It is used by the georaster driver to read JPEG200 compression. But it can be used to store Geotiffs or any other raster file format into an BLOB.

With those GDAL driver and with the data stored in oracle databases, you can have rendering on the fly in QGIS, ArcMap, etc.

But if you have other geospatial types inside an oracle schema, like ST_GEOMETRY, TERRALIB or SDE_GEOMETRY for example, those are not supported by GDAL.

Again, if all you want is to access files on OCI storage and rendering on the fly,  that wasn't developed yet. You might find command line tools that you can pipe the data into GDAL based application, but not rendering on the fly. I think.

I hope it helps to clarify,

Ivan

________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Chaitanya Jalluri <chaitanyajalluri at gmail.com>
Sent: Monday, March 7, 2022 7:42 AM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] GDAL support on OCI

Hi,

Does gdal support the accessing and rendering data on the fly (i.e virtual file systems ) from the Oracle cloud storage?? I couldn't see any support of this in the documentation https://gdal.org/user/virtual_file_systems.html .  Can you please help with it?

Thanks and regards
Chaitanya Jalluri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220307/e2983ccd/attachment.html>

From chaitanyajalluri at gmail.com  Mon Mar  7 05:39:38 2022
From: chaitanyajalluri at gmail.com (Chaitanya Jalluri)
Date: Mon, 7 Mar 2022 19:09:38 +0530
Subject: [gdal-dev] GDAL support on OCI
In-Reply-To: <MN2PR04MB5693F92839B41A0BEF4ED23AF2089@MN2PR04MB5693.namprd04.prod.outlook.com>
References: <CALfZSLXJ_kRMG-bOyLv1OAkZs=jkL96k894+fgFEnNYrAoLfyQ@mail.gmail.com>
 <MN2PR04MB5693F92839B41A0BEF4ED23AF2089@MN2PR04MB5693.namprd04.prod.outlook.com>
Message-ID: <CALfZSLXs1eTiFKVuVwtEbGu0fKyiSX=frN5dmV+6yQT=Y+kknQ@mail.gmail.com>

Hi Ivan,

Thanks for your reply. Yes, it clarified my query.

Thanks and Regards
Chaitanya Jalluri

On Mon, Mar 7, 2022 at 6:57 PM Ivan Lucena <ivan.lucena at outlook.com> wrote:

> Interesting question Chaitanya,
>
> But the answer is probably no.
>
> The VSI drivers mentioned on that page are supposed to access assets,
> buckets and file system on popular cloud services.
>
> There is no Oracle Cloud Infrastructure (OCI) driver for that purpose, but
> you might be able to access spatial data types SDO_GEOMETRY and
> SDO_GEORASTER tables/columns on a server running on the cloud, just like if
> it were running in any machine. No?
>
> The GDAL/OGR driver OCI, developed many decades ago, was named OCI in
> reference to the Oracle C SDK. It can access "vector" data in SDO_GEOMETRY
> type.
>
> https://gdal.org/drivers/vector/oci.html#vector-oci
>
> The GDAL georaster driver is a raster driver that supports SDO_GEORASTER
> type.
>
> https://gdal.org/drivers/raster/georaster.html
>
> Inside the georaster driver code there is a VSI/OCI driver that can read
> images in BLOB data type on the database.
>
>
> https://github.com/OSGeo/gdal/blob/master/frmts/georaster/cpl_vsil_ocilob.cpp
>
> That driver is rarely exposed for the public and there is documentation.
> It is used by the georaster driver to read JPEG200 compression. But it can
> be used to store Geotiffs or any other raster file format into an BLOB.
>
> With those GDAL driver and with the data stored in oracle databases, you
> can have rendering on the fly in QGIS, ArcMap, etc.
>
> But if you have other geospatial types inside an oracle schema, like
> ST_GEOMETRY, TERRALIB or SDE_GEOMETRY for example, those are not supported
> by GDAL.
>
> Again, if all you want is to access files on OCI storage and rendering on
> the fly,  that wasn't developed yet. You might find command line tools that
> you can pipe the data into GDAL based application, but not rendering on the
> fly. I think.
>
> I hope it helps to clarify,
>
> Ivan
>
> ------------------------------
> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of
> Chaitanya Jalluri <chaitanyajalluri at gmail.com>
> *Sent:* Monday, March 7, 2022 7:42 AM
> *To:* gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
> *Subject:* [gdal-dev] GDAL support on OCI
>
> Hi,
>
> Does gdal support the accessing and rendering data on the fly (i.e virtual
> file systems ) from the Oracle cloud storage?? I couldn't see any support
> of this in the documentation
> https://gdal.org/user/virtual_file_systems.html .  Can you please help
> with it?
>
> Thanks and regards
> Chaitanya Jalluri
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220307/b542ba08/attachment-0001.html>

From englishchristophera at gmail.com  Mon Mar  7 14:48:44 2022
From: englishchristophera at gmail.com (chris english)
Date: Mon, 7 Mar 2022 17:48:44 -0500
Subject: [gdal-dev] CMAKE Report:[ 98%] Linking CXX executable
 pytest_runner; recompile with -fPIE/-fPIC
In-Reply-To: <CAASFQpRebM7UPkw1ojnmnuUPJ4c9fMMvQN4xE8Hd6fbRi7wh3w@mail.gmail.com>
References: <CAASFQpRebM7UPkw1ojnmnuUPJ4c9fMMvQN4xE8Hd6fbRi7wh3w@mail.gmail.com>
Message-ID: <CAASFQpQ0BiS9n=nkuVoce9RMwq3suqE-KwP2FrUTgaXFe7uN9w@mail.gmail.com>

This following line say there was no python(3.6 in this case).so to compile
against found,
/usr/bin/ld: /usr/local/lib/libpython3.6m.a(pylifecycle.o): relocation
R_X86_64_32 against `.rodata.str1.1' can not be used when making a PIE
object; recompile with -fPIE

Reinstall python, ./configure --enable-shared # in this case python-3.6.9
from source (because mention of this version was deep in the CMake weeds),
and things go surprisingly smoothly.
git describe
v3.3.0-2898-gba4e7c404b

~/gdal$ gdalinfo --version
GDAL 3.5.0dev-ba4e7c404b, released 2022/02/28

DODS exclusion by turning both GDAL driver and OGR to OFF
Updated Netcdf, HDF4 & HDF5 - so stack improved there

I got so conditioned to out of tree builds that I tried it on the python
reinstall.
CMake, it's more than a build, it's an adventure.

Chris


On Sat, Mar 5, 2022 at 10:50 PM chris english <englishchristophera at gmail.com>
wrote:

> This can't be a novel 'almost got there', but then not.
> [ 98%] Linking CXX executable pytest_runner
> /usr/bin/ld: /usr/local/lib/libpython3.6m.a(pylifecycle.o): relocation
> R_X86_64_32 against `.rodata.str1.1' can not be used when making a PIE
> object; recompile with -fPIE
> /usr/bin/ld: /usr/local/lib/libpython3.6m.a(pystate.o): relocation
> R_X86_64_32S against symbol `_PyEval_EvalFrameDefault' can not be used when
> making a PIE object; recompile with -fPIE
>
> In ubuntu-20.04, so have Python2.7, Python3.6, Python3.8, and 3.9, and
> generally advised against summarily removing any, so...they stay.
> Still working with git describe: v3.3.0-2898-gba4e7c404b
>
> I'd like to say -fPIE is probably -fPIC, but beyond that I don't know how
> to proceed.
> Previously, to get to here, eliminated all DODS, libdap, netcdf, mrsid
> references.
> Any help to get beyond 98% to 100% good news appreciated.
> Chris
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220307/a7032be4/attachment.html>

From even.rouault at spatialys.com  Tue Mar  8 02:59:28 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 8 Mar 2022 11:59:28 +0100
Subject: [gdal-dev] GDAL 3.4.2 RC2 available
In-Reply-To: <a4e94c3a-ee65-4ca2-9f08-ae8413b1c7be@spatialys.com>
References: <a4e94c3a-ee65-4ca2-9f08-ae8413b1c7be@spatialys.com>
Message-ID: <22324924-e351-16a9-014c-7f5755107061@spatialys.com>

Hi,

I've issued a RC2 with 2 additional fixes:

- DIMAP driver: register metadata on all 6 PNEO bands (#5420)
- GTIFF driver: remove limitation to 32,000 bytes when writing the GDAL 
metadata tag (#4116)

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc2.tar.xz
 ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.4.2/gdal342rc2.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc2.zip

GDAL-GRASS plugin:

 ? https://download.osgeo.org/gdal/3.4.2/gdal-grass-3.4.2.tar.gz

The NEWS file is here :

 ? https://github.com/OSGeo/gdal/blob/v3.4.2RC2/gdal/NEWS.md

Even

Le 07/03/2022 ? 12:26, Even Rouault a ?crit?:
> Hi,
>
> I have prepared a GDAL/OGR 3.4.2 release candidate.
>
> Pick up an archive among the following ones (by ascending size):
>
> ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc1.tar.xz
> ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.4.2/gdal342rc1.zip
>
> A snapshot of the gdalautotest suite is also available :
>
> https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc1.zip
>
> GDAL-GRASS plugin:
>
> ? https://download.osgeo.org/gdal/3.4.2/gdal-grass-3.4.2.tar.gz
>
> The NEWS file is here :
>
> ? https://github.com/OSGeo/gdal/blob/v3.4.2RC1/gdal/NEWS.md
>
> I'll call for a vote promoting it to final later this week if no
> serious problems are reported before.
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Tue Mar  8 08:05:27 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 8 Mar 2022 17:05:27 +0100
Subject: [gdal-dev] libgeotiff 1.7.1 release candidate
Message-ID: <9492576f-a5d6-3677-5e38-1ab2fc2a908c@spatialys.com>

Hi,

I've prepared a libgeotiff 1.7.1 release candidate.

http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc1.tar.gz
http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc1.zip

I'll promote it to final later this week if nothing serious is reported 
on it before.


News is:

libgeotiff 1.7.1
----------------

* geotiff.h: more precise signature for GTIFDirectoryInfo()
* applygeo.c/geotifcp.c: use uint16/32_t instead of old libtiff non _t 
custom types
* Bump CMake min to 3.0.0 and remove apparently unneeded cmake_policy() 
declarations
* CMake: remove libjpeg and libz from linking of libgeotiff itself.
* geo_config.h: prefix HAVE_xxx and restrict it to 
GEOTIFF_HAVE_STRINGS_H (fixes #61)
* GTIFPrintDefn(): avoid potential nullptr deref. CID 1469240
* CMake: use variable for installation subdirectories, and make sure 
INTERFACE_INCLUDE_DIRECTORIES is exported (fixes #67)
* ReadKey(): only allow reading a key with TIFFTagLocation=0 that has a 
count of 1 to avoid reading an illegal address (and crashing) when using 
GTIFKeyGet() or PrintKey() (fixes #66)
* ReadKey(): add extra warning messages
* CMake: avoid INTERFACE_LINK_LIBRARIES vs 
LINK_INTERFACE_LIBRARIES_DEBUG warning about TIFF

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From bontepaarden at gmail.com  Wed Mar  9 07:14:19 2022
From: bontepaarden at gmail.com (Paul Meems)
Date: Wed, 9 Mar 2022 16:14:19 +0100
Subject: [gdal-dev] gdal_translate options
Message-ID: <CAHNf2YSs8oc8rq2o-sMENqb+Ehf7dhkANLWhvaHHULf0GUeF9w@mail.gmail.com>

Hi List,

We use GDAL3+ with MapWinGIS (C++ ActiveX control) and I'm working on
making unit/functional tests for it.

In one of our functions, we use GDALTranslate().
I'm creating the unit tests in C#:
We pass the options as a string array to our C++ function, which expects
SAFEARRAY*

This one is working:
var options = new[]
{
    "-of", "GTiff",
    "-co",  "TILED=YES"
};
And this one is causing an AccessViolationException
var options = new[]
{
      "-ot", "Float32",
      "-tr", "0.2", "0.2",
      "-r", "average",
      "-projwin", "-180", "90", "180", "-90"
};

When I run the last one on the command line using the same GDAL version and
the same input file, it is working as well:
gdal_translate -ot "Float32" -tr  0.2 0.2 -r "average" -projwin -180 90 180
-90 float32_50m.tif float32_50m-translated.tif
So clearly we're doing something wrong in probably creating the array of
options.

Our C++ code looks like this:
STDMETHODIMP CGdalUtils::GdalRasterTranslate(BSTR sourceFilename, BSTR
destinationFilename, SAFEARRAY* options, VARIANT_BOOL* retVal)
{
  AFX_MANAGE_STATE(AfxGetStaticModuleState());
  *retVal = VARIANT_FALSE;
  _detailedError = "No error";

  const CStringW srcFilename(sourceFilename);

  // Open file as GdalDataset:
  const auto dt = GdalHelper::OpenRasterDatasetW(srcFilename, GA_ReadOnly);
  if (!dt)
  {
    _detailedError = "Can't open " + srcFilename + " as a raster file.";
    ErrorMsg(tkINVALID_FILENAME);
    goto cleaning;
  }

  // Make options:
  char** translateOptions = nullptr;
  translateOptions = ConvertSafeArrayToChar(options);

  const auto gdalTranslateOptions =
GDALTranslateOptionsNew(translateOptions, nullptr);
  if (!gdalTranslateOptions)
  {
    _detailedError = "Can't convert the option array to
GDALTranslateOptions";
    ErrorMessage(tkINVALID_PARAMETERS_ARRAY);
    goto cleaning;
  }

  // Call the gdalTranslate function:
  GDALTranslateOptionsSetProgress(gdalTranslateOptions,
GDALProgressCallback, &params);
  m_globalSettings.SetGdalUtf8(true);
  const auto dtNew = GDALTranslate(CString(destinationFilename), dt,
gdalTranslateOptions, nullptr);
  m_globalSettings.SetGdalUtf8(false);

  if (dtNew)
  {
    *retVal = VARIANT_TRUE;
    GDALClose(dtNew);
  }
  else
  {
    ErrorMessage(tkGDAL_ERROR);
    _detailedError = CPLGetLastErrorMsg();
  }

cleaning:
  if (gdalTranslateOptions)
    GDALTranslateOptionsFree(gdalTranslateOptions);

  if (translateOptions)
    CSLDestroy(translateOptions);

  if (dt)
    GDALClose(dt);

  return S_OK;
}

My questions:

   1. How should the options array be formatted?
   2. And how can we detect if the  gdalTranslateOptions are correct before
   we send them to GDALTranslate?


Thanks,

Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220309/2fe8098f/attachment.html>

From jmckenna at gatewaygeomatics.com  Wed Mar  9 11:53:55 2022
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 9 Mar 2022 15:53:55 -0400
Subject: [gdal-dev] GDAL 3.4.2 RC2 available
In-Reply-To: <22324924-e351-16a9-014c-7f5755107061@spatialys.com>
References: <a4e94c3a-ee65-4ca2-9f08-ae8413b1c7be@spatialys.com>
 <22324924-e351-16a9-014c-7f5755107061@spatialys.com>
Message-ID: <bfe5ad08-18f8-149a-2384-4978fb49dc3d@gatewaygeomatics.com>

Thanks Even.  RC2 works well on Windows in the MS4W build environment. 
The only issue was that I had to re-apply the patch for Poppler 22.x 
(this is the known issue of course, that is well discussed 
https://lists.osgeo.org/pipermail/gdal-dev/2022-March/055529.html )

-jeff



-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/


On 2022-03-08 6:59 a.m., Even Rouault wrote:
> Hi,
> 
> I've issued a RC2 with 2 additional fixes:
> 
> - DIMAP driver: register metadata on all 6 PNEO bands (#5420)
> - GTIFF driver: remove limitation to 32,000 bytes when writing the GDAL 
> metadata tag (#4116)
> 
> Pick up an archive among the following ones (by ascending size):
> 
>  ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc2.tar.xz
>  ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc2.tar.gz
>  ? https://download.osgeo.org/gdal/3.4.2/gdal342rc2.zip
> 
> A snapshot of the gdalautotest suite is also available :
> 
> https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc2.tar.gz
>  ? https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc2.zip
> 
> GDAL-GRASS plugin:
> 
>  ? https://download.osgeo.org/gdal/3.4.2/gdal-grass-3.4.2.tar.gz
> 
> The NEWS file is here :
> 
>  ? https://github.com/OSGeo/gdal/blob/v3.4.2RC2/gdal/NEWS.md
> 
> Even
> 
> Le 07/03/2022 ? 12:26, Even Rouault a ?crit?:
>> Hi,
>>
>> I have prepared a GDAL/OGR 3.4.2 release candidate.
>>
>> Pick up an archive among the following ones (by ascending size):
>>
>> ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc1.tar.xz
>> ? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2rc1.tar.gz
>> ? https://download.osgeo.org/gdal/3.4.2/gdal342rc1.zip
>>
>> A snapshot of the gdalautotest suite is also available :
>>
>> https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc1.tar.gz
>> ? https://download.osgeo.org/gdal/3.4.2/gdalautotest-3.4.2rc1.zip
>>
>> GDAL-GRASS plugin:
>>
>> ? https://download.osgeo.org/gdal/3.4.2/gdal-grass-3.4.2.tar.gz
>>
>> The NEWS file is here :
>>
>> ? https://github.com/OSGeo/gdal/blob/v3.4.2RC1/gdal/NEWS.md
>>
>> I'll call for a vote promoting it to final later this week if no
>> serious problems are reported before.
>>
>> Best regards,
>>
>> Even
>>


From even.rouault at spatialys.com  Wed Mar  9 12:02:01 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 9 Mar 2022 21:02:01 +0100
Subject: [gdal-dev] GDAL 3.4.2 RC2 available
In-Reply-To: <bfe5ad08-18f8-149a-2384-4978fb49dc3d@gatewaygeomatics.com>
References: <a4e94c3a-ee65-4ca2-9f08-ae8413b1c7be@spatialys.com>
 <22324924-e351-16a9-014c-7f5755107061@spatialys.com>
 <bfe5ad08-18f8-149a-2384-4978fb49dc3d@gatewaygeomatics.com>
Message-ID: <9e16b9b8-64cf-65bb-5f78-fd2e899b40dc@spatialys.com>


Le 09/03/2022 ? 20:53, Jeff McKenna a ?crit?:
> Thanks Even.? RC2 works well on Windows in the MS4W build environment. 
> The only issue was that I had to re-apply the patch for Poppler 22.x 
> (this is the known issue of course, that is well discussed 
> https://lists.osgeo.org/pipermail/gdal-dev/2022-March/055529.html )

Which patch did you need re-apply ? The ones of master are normally 
included in 3.4.2 : 
https://github.com/OSGeo/gdal/commit/2d5f96f233e6bda613e98e056bb9a39d12409e32 
+ 
https://github.com/OSGeo/gdal/commit/cbcfe2c8c5507ea00ef7371029ff94d0bf6f4a77 
.? But for nmake based builds, you perhaps need to add a /std:c++17 
switch to the POPPLER_CFLAGS variable (PS: the benefit of the CMake 
based builds where a single CMake command can be used to bump to c++17 
for all platforms is obvious here)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jmckenna at gatewaygeomatics.com  Wed Mar  9 12:05:40 2022
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 9 Mar 2022 16:05:40 -0400
Subject: [gdal-dev] GDAL 3.4.2 RC2 available
In-Reply-To: <9e16b9b8-64cf-65bb-5f78-fd2e899b40dc@spatialys.com>
References: <a4e94c3a-ee65-4ca2-9f08-ae8413b1c7be@spatialys.com>
 <22324924-e351-16a9-014c-7f5755107061@spatialys.com>
 <bfe5ad08-18f8-149a-2384-4978fb49dc3d@gatewaygeomatics.com>
 <9e16b9b8-64cf-65bb-5f78-fd2e899b40dc@spatialys.com>
Message-ID: <43aaa06d-a50b-e41e-ba07-3a44ec161c06@gatewaygeomatics.com>

On 2022-03-09 4:02 p.m., Even Rouault wrote:
> 
> Le 09/03/2022 ? 20:53, Jeff McKenna a ?crit?:
>> Thanks Even.? RC2 works well on Windows in the MS4W build environment. 
>> The only issue was that I had to re-apply the patch for Poppler 22.x 
>> (this is the known issue of course, that is well discussed 
>> https://lists.osgeo.org/pipermail/gdal-dev/2022-March/055529.html )
> 
> Which patch did you need re-apply ? The ones of master are normally 
> included in 3.4.2 : 
> https://github.com/OSGeo/gdal/commit/2d5f96f233e6bda613e98e056bb9a39d12409e32 
> + 
> https://github.com/OSGeo/gdal/commit/cbcfe2c8c5507ea00ef7371029ff94d0bf6f4a77 
> .? But for nmake based builds, you perhaps need to add a /std:c++17 
> switch to the POPPLER_CFLAGS variable (PS: the benefit of the CMake 
> based builds where a single CMake command can be used to bump to c++17 
> for all platforms is obvious here)

My builds are CMake, and that was the exact patch I've been applying to 
the POPPLER_EXTRAFLAGS, you're correct.  After that, CMake runs fine for me.

-jeff




-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/

From jmckenna at gatewaygeomatics.com  Wed Mar  9 12:06:51 2022
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 9 Mar 2022 16:06:51 -0400
Subject: [gdal-dev] GDAL 3.4.2 RC2 available
In-Reply-To: <43aaa06d-a50b-e41e-ba07-3a44ec161c06@gatewaygeomatics.com>
References: <a4e94c3a-ee65-4ca2-9f08-ae8413b1c7be@spatialys.com>
 <22324924-e351-16a9-014c-7f5755107061@spatialys.com>
 <bfe5ad08-18f8-149a-2384-4978fb49dc3d@gatewaygeomatics.com>
 <9e16b9b8-64cf-65bb-5f78-fd2e899b40dc@spatialys.com>
 <43aaa06d-a50b-e41e-ba07-3a44ec161c06@gatewaygeomatics.com>
Message-ID: <07c17588-8f50-9676-e4ec-5e13cfa5c3f5@gatewaygeomatics.com>

On 2022-03-09 4:05 p.m., Jeff McKenna wrote:
> On 2022-03-09 4:02 p.m., Even Rouault wrote:
>>
>> Le 09/03/2022 ? 20:53, Jeff McKenna a ?crit?:
>>> Thanks Even.? RC2 works well on Windows in the MS4W build 
>>> environment. The only issue was that I had to re-apply the patch for 
>>> Poppler 22.x (this is the known issue of course, that is well 
>>> discussed 
>>> https://lists.osgeo.org/pipermail/gdal-dev/2022-March/055529.html )
>>
>> Which patch did you need re-apply ? The ones of master are normally 
>> included in 3.4.2 : 
>> https://github.com/OSGeo/gdal/commit/2d5f96f233e6bda613e98e056bb9a39d12409e32 
>> + 
>> https://github.com/OSGeo/gdal/commit/cbcfe2c8c5507ea00ef7371029ff94d0bf6f4a77 
>> .? But for nmake based builds, you perhaps need to add a /std:c++17 
>> switch to the POPPLER_CFLAGS variable (PS: the benefit of the CMake 
>> based builds where a single CMake command can be used to bump to c++17 
>> for all platforms is obvious here)
> 
> My builds are CMake, and that was the exact patch I've been applying to 
> the POPPLER_EXTRAFLAGS, you're correct.? After that, CMake runs fine for 
> me.

Ah sorry you're 100% correct, this was not with CMake, it was an nmake 
build.  Sorry (I was testing GeoTIFF with CMake minutes before this, 
confusing my brain ha).

-jeff




-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/

From even.rouault at spatialys.com  Wed Mar  9 23:41:37 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 10 Mar 2022 08:41:37 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.4.2 RC2
Message-ID: <ae88eace-58f7-941e-8270-ec15f55c47cc@spatialys.com>

Hi,

Motion:

Adopt GDAL 3.4.2 RC2 as final 3.4.2 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Thu Mar 10 00:03:38 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 10 Mar 2022 08:03:38 +0000
Subject: [gdal-dev] Motion: promote GDAL 3.4.2 RC2
Message-ID: <91449be66d0a426d8eb58efa324245cf@maanmittauslaitos.fi>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: torstai 10. maaliskuuta 2022 9.42
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: promote GDAL 3.4.2 RC2

Hi,

Motion:

Adopt GDAL 3.4.2 RC2 as final 3.4.2 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Thu Mar 10 00:39:08 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 10 Mar 2022 09:39:08 +0100
Subject: [gdal-dev] libgeotiff 1.7.1 rc2 available
In-Reply-To: <9492576f-a5d6-3677-5e38-1ab2fc2a908c@spatialys.com>
References: <9492576f-a5d6-3677-5e38-1ab2fc2a908c@spatialys.com>
Message-ID: <c3972247-1f19-43bb-5492-392ea8fd5137@spatialys.com>

Hi,

I've prepared a RC2 for libgeotiff 1.7.1 with the following additional 
changes w.r.t rc1:

* CMake: Fix dllexport
* CMake: Revise exported cmake config wrt BUILD_SHARED_LIBS
* CMake: Revise exported cmake config wrt dependencies
* CMake: Respect <Pkg>_FIND_QUIETLY

Download links:

http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc2.tar.gz
http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc2.zip

Even

Le 08/03/2022 ? 17:05, Even Rouault a ?crit?:
> Hi,
>
> I've prepared a libgeotiff 1.7.1 release candidate.
>
> http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc1.tar.gz
> http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc1.zip
>
> I'll promote it to final later this week if nothing serious is 
> reported on it before.
>
>
> News is:
>
> libgeotiff 1.7.1
> ----------------
>
> * geotiff.h: more precise signature for GTIFDirectoryInfo()
> * applygeo.c/geotifcp.c: use uint16/32_t instead of old libtiff non _t 
> custom types
> * Bump CMake min to 3.0.0 and remove apparently unneeded 
> cmake_policy() declarations
> * CMake: remove libjpeg and libz from linking of libgeotiff itself.
> * geo_config.h: prefix HAVE_xxx and restrict it to 
> GEOTIFF_HAVE_STRINGS_H (fixes #61)
> * GTIFPrintDefn(): avoid potential nullptr deref. CID 1469240
> * CMake: use variable for installation subdirectories, and make sure 
> INTERFACE_INCLUDE_DIRECTORIES is exported (fixes #67)
> * ReadKey(): only allow reading a key with TIFFTagLocation=0 that has 
> a count of 1 to avoid reading an illegal address (and crashing) when 
> using GTIFKeyGet() or PrintKey() (fixes #66)
> * ReadKey(): add extra warning messages
> * CMake: avoid INTERFACE_LINK_LIBRARIES vs 
> LINK_INTERFACE_LIBRARIES_DEBUG warning about TIFF
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From boxerab at protonmail.com  Thu Mar 10 05:18:35 2022
From: boxerab at protonmail.com (Aaron Boxer)
Date: Thu, 10 Mar 2022 13:18:35 +0000
Subject: [gdal-dev] Grok JPEG 2000 Pull Request
Message-ID: <EtbTdOJXkE04Pzr874GzmPyustPYbjRGh2omb5y3FDtmJPXZcPn4WGH588KRI9wD4_S-3Zzji0-xb0IoqIS3BZZ_uUDNblS2P9vV5POrjjU=@protonmail.com>

Hi Folks,

Grok JPEG 2000 library v9.7.2 has just been released.
This open source project is now significantly faster
than the closed source proprietary Kakadu library v8.05
in a number of workflows involving large single and multi tiled images.

You can check out the benchmarks here:
https://github.com/GrokImageCompression/grok

Release is available at :
https://github.com/GrokImageCompression/grok/releases/tag/v9.7.2

GDAL PR in progress here:
https://github.com/OSGeo/gdal/pull/5117

Cheers,Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220310/a2b53efb/attachment.html>

From howard at hobu.co  Thu Mar 10 08:52:42 2022
From: howard at hobu.co (Howard Butler)
Date: Thu, 10 Mar 2022 10:52:42 -0600
Subject: [gdal-dev] Motion: promote GDAL 3.4.2 RC2
In-Reply-To: <91449be66d0a426d8eb58efa324245cf@maanmittauslaitos.fi>
References: <91449be66d0a426d8eb58efa324245cf@maanmittauslaitos.fi>
Message-ID: <A866782B-02C3-4C85-9F73-AEDE925D0ECB@hobu.co>

+1 

Howard

> On Mar 10, 2022, at 2:03 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> 
> +1
> 
> -Jukka Rahkonen-
> 
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
> L?hetetty: torstai 10. maaliskuuta 2022 9.42
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] Motion: promote GDAL 3.4.2 RC2
> 
> Hi,
> 
> Motion:
> 
> Adopt GDAL 3.4.2 RC2 as final 3.4.2 release
> 
> Starting with my +1
> 
> Even
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From mateusz at loskot.net  Thu Mar 10 09:17:50 2022
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 10 Mar 2022 18:17:50 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.4.2 RC2
In-Reply-To: <A866782B-02C3-4C85-9F73-AEDE925D0ECB@hobu.co>
References: <91449be66d0a426d8eb58efa324245cf@maanmittauslaitos.fi>
 <A866782B-02C3-4C85-9F73-AEDE925D0ECB@hobu.co>
Message-ID: <CABUeae8WdO1pi8+1n443dTOFQRV3DGp_UrGBVLkm3UgCXa=buA@mail.gmail.com>

+1 Mateusz

On Thu, 10 Mar 2022 at 17:52, Howard Butler <howard at hobu.co> wrote:
>
> +1
>
> Howard
>
> > On Mar 10, 2022, at 2:03 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> >
> > +1
> >
> > -Jukka Rahkonen-
> >
> > -----Alkuper?inen viesti-----
> > L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
> > L?hetetty: torstai 10. maaliskuuta 2022 9.42
> > Vastaanottaja: gdal-dev at lists.osgeo.org
> > Aihe: [gdal-dev] Motion: promote GDAL 3.4.2 RC2
> >
> > Hi,
> >
> > Motion:
> >
> > Adopt GDAL 3.4.2 RC2 as final 3.4.2 release
> >
> > Starting with my +1
> >
> > Even
> >
> > --
> > http://www.spatialys.com
> > My software is free, but my time generally not.
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Mateusz Loskot, http://mateusz.loskot.net

From even.rouault at spatialys.com  Mon Mar 14 04:14:34 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 14 Mar 2022 12:14:34 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.4.2 RC2
In-Reply-To: <ae88eace-58f7-941e-8270-ec15f55c47cc@spatialys.com>
References: <ae88eace-58f7-941e-8270-ec15f55c47cc@spatialys.com>
Message-ID: <a88f26e6-8fcd-8921-6357-037a570e9194@spatialys.com>

Motion passed with +1 from PSC members JukkaR, HowardB, MateuszL and myself

Le 10/03/2022 ? 08:41, Even Rouault a ?crit?:
> Hi,
>
> Motion:
>
> Adopt GDAL 3.4.2 RC2 as final 3.4.2 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Mar 14 04:39:28 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 14 Mar 2022 12:39:28 +0100
Subject: [gdal-dev] GDAL 3.4.2 is released
Message-ID: <9bdba954-d5da-fe48-ad29-1b363f6d72bc@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the
release of the GDAL/OGR 3.4.2 bug fix version.

Consult the release notes for the list of issues addressed :

 ? https://github.com/OSGeo/gdal/blob/v3.4.2/gdal/NEWS.md

The sources are available at:

 ??? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2.tar.xz
 ??? https://download.osgeo.org/gdal/3.4.2/gdal-3.4.2.tar.gz
 ??? https://download.osgeo.org/gdal/3.4.2/gdal342.zip
 ??? https://download.osgeo.org/gdal/3.4.2/gdal-grass-3.4.2.tar.gz

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Mar 14 04:46:55 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 14 Mar 2022 12:46:55 +0100
Subject: [gdal-dev] libgeotiff 1.7.1 is released
Message-ID: <920290eb-9155-62e9-5c07-be4b405dafb4@spatialys.com>

Hi,

Source packages can be found at:

http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1.tar.gz

http://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1.zip

News is:

* geotiff.h: more precise signature for GTIFDirectoryInfo()
* applygeo.c/geotifcp.c: use uint16/32_t instead of old libtiff non _t 
custom types
* Bump CMake min to 3.0.0 and remove apparently unneeded cmake_policy() 
declarations
* CMake: remove libjpeg and libz from linking of libgeotiff itself.
* geo_config.h: prefix HAVE_xxx and restrict it to 
GEOTIFF_HAVE_STRINGS_H (fixes #61)
* GTIFPrintDefn(): avoid potential nullptr deref. CID 1469240
* CMake: use variable for installation subdirectories, and make sure 
INTERFACE_INCLUDE_DIRECTORIES is exported (fixes #67)
* ReadKey(): only allow reading a key with TIFFTagLocation=0 that has a 
count of 1 to avoid reading an illegal address (and crashing) when using 
GTIFKeyGet() or PrintKey() (fixes #66)
* ReadKey(): add extra warning messages
* CMake: avoid INTERFACE_LINK_LIBRARIES vs 
LINK_INTERFACE_LIBRARIES_DEBUG warning about TIFF
* CMake: Fix dllexport
* CMake: Revise exported cmake config wrt BUILD_SHARED_LIBS
* CMake: Revise exported cmake config wrt dependencies
* CMake: Respect <Pkg>_FIND_QUIETLY

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From j1 at jimenezshaw.com  Mon Mar 14 13:05:41 2022
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 14 Mar 2022 21:05:41 +0100
Subject: [gdal-dev] CMake and unexpected driver
Message-ID: <CADRrdKshWac9-=sozdPn1yWg6x7q-=nPu=j0C=iMuppi93ykxg@mail.gmail.com>

Hi

I am testing CMake compilation. So far so good. I am setting these CMake
variables:

GDAL_USE_EXTERNAL_LIBS=OFF // disable everything and enable only what I need
GDAL_USE_ICONV=ON // otherwise it does not compile in Ubuntu 20.04
GDAL_USE_EXPAT=ON
GDAL_USE_TIFF=ON
GDAL_USE_GEOTIFF=ON
GDAL_USE_JPEG=ON
GDAL_USE_ZLIB=ON

As you can see, PNG is not enabled. Actually it says:

-- Disabled components:
...
 *PNG component has been detected, but is disabled with GDAL_USE_PNG=OFF

However, in a test application, this statement works:
nullptr != GetGDALDriverManager()->GetDriverByName("PNG")

Why is it able to return a "valid" driver for PNG, when it was not enabled
in the CMake configuration?

Thanks.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220314/eb796442/attachment.html>

From even.rouault at spatialys.com  Mon Mar 14 13:33:33 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 14 Mar 2022 21:33:33 +0100
Subject: [gdal-dev] CMake and unexpected driver
In-Reply-To: <CADRrdKshWac9-=sozdPn1yWg6x7q-=nPu=j0C=iMuppi93ykxg@mail.gmail.com>
References: <CADRrdKshWac9-=sozdPn1yWg6x7q-=nPu=j0C=iMuppi93ykxg@mail.gmail.com>
Message-ID: <ac8f12a3-268a-52ff-4ecd-adf93779e03b@spatialys.com>

Javier,
> GDAL_USE_ICONV=ON // otherwise it does not compile in Ubuntu 20.04
Fixed per 
https://github.com/OSGeo/gdal/commit/b183f2d9eb6c9dd7eefde194ced26d1913c06820
> GDAL_USE_EXPAT=ON
> GDAL_USE_TIFF=ON
> GDAL_USE_GEOTIFF=ON
> GDAL_USE_JPEG=ON
> GDAL_USE_ZLIB=ON
>
> As you can see, PNG is not enabled. Actually it says:
>
> -- Disabled components:
> ...
> ?*PNG component has been detected, but is disabled with GDAL_USE_PNG=OFF

Just a misleading notification message, due to the 
GDAL_USE_PNG_INTERNAL=ON being probably set.

Fixed per 
https://github.com/OSGeo/gdal/commit/339132cb09c4ba78ffa0b641f298184dcf4f7ab0

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From j1 at jimenezshaw.com  Mon Mar 14 14:05:51 2022
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 14 Mar 2022 22:05:51 +0100
Subject: [gdal-dev] CMake and unexpected driver
In-Reply-To: <ac8f12a3-268a-52ff-4ecd-adf93779e03b@spatialys.com>
References: <CADRrdKshWac9-=sozdPn1yWg6x7q-=nPu=j0C=iMuppi93ykxg@mail.gmail.com>
 <ac8f12a3-268a-52ff-4ecd-adf93779e03b@spatialys.com>
Message-ID: <CADRrdKtrTpGtDTK+KNB3xpX=EGLM9Ad5gRNVe7M6RGX95mWwMA@mail.gmail.com>

Thanks!
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Mon, 14 Mar 2022 at 21:33, Even Rouault <even.rouault at spatialys.com>
wrote:

> Javier,
> > GDAL_USE_ICONV=ON // otherwise it does not compile in Ubuntu 20.04
> Fixed per
>
> https://github.com/OSGeo/gdal/commit/b183f2d9eb6c9dd7eefde194ced26d1913c06820
> > GDAL_USE_EXPAT=ON
> > GDAL_USE_TIFF=ON
> > GDAL_USE_GEOTIFF=ON
> > GDAL_USE_JPEG=ON
> > GDAL_USE_ZLIB=ON
> >
> > As you can see, PNG is not enabled. Actually it says:
> >
> > -- Disabled components:
> > ...
> >  *PNG component has been detected, but is disabled with GDAL_USE_PNG=OFF
>
> Just a misleading notification message, due to the
> GDAL_USE_PNG_INTERNAL=ON being probably set.
>
> Fixed per
>
> https://github.com/OSGeo/gdal/commit/339132cb09c4ba78ffa0b641f298184dcf4f7ab0
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220314/5d8d2600/attachment.html>

From mdsumner at gmail.com  Mon Mar 14 22:06:29 2022
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 15 Mar 2022 16:06:29 +1100
Subject: [gdal-dev] regular grid longlat netcdf without crs meta
Message-ID: <CAAcGz98BDCBRC+=U6UC9A7LhrQGdO=pfUd5pt5Od=+i2_VmMDA@mail.gmail.com>

Hi,

these files don't present to GDAL with a CRS, but it seems not out of place
to assume that they can use 'oSRS.SetWellKnownGeogCS("WGS84")', when no
other indication is found and there are dimensions 'lon,lat' or
'longitude,latitude'

https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/

An example sds specifically:

/vsicurl/NETCDF:"/vsicurl/
https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/202202/oisst-avhrr-v02r01.20220201.nc
":sst

Would that be reasonable? Perhaps controlled by an env var? Is there an
established control for this I'm missing? (I'm not looking for '-a_srs' or
VRT, I want the auto-detection to work for these and many other
similar file sources without augmentation).

(It's not out of the question that I could submit a PR for this, just
flagging discussion in case I'm missing something.)

Thanks.

Best, Mike


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220315/d9b85599/attachment.html>

From mdsumner at gmail.com  Mon Mar 14 22:31:50 2022
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 15 Mar 2022 16:31:50 +1100
Subject: [gdal-dev] regular grid longlat netcdf without crs meta
In-Reply-To: <CAAcGz98BDCBRC+=U6UC9A7LhrQGdO=pfUd5pt5Od=+i2_VmMDA@mail.gmail.com>
References: <CAAcGz98BDCBRC+=U6UC9A7LhrQGdO=pfUd5pt5Od=+i2_VmMDA@mail.gmail.com>
Message-ID: <CAAcGz98gL0eHC+Z8VhGA7K+W+KoRbPT24PtaQvGAsMWKmDHKwA@mail.gmail.com>

gosh, very sorry I messed up the SDS string - I've posted as a gist here
with the gdalinfo output:

https://gist.github.com/mdsumner/615441365e3a0691c457493fe62b78bf

Best, Mike


On Tue, Mar 15, 2022 at 4:06 PM Michael Sumner <mdsumner at gmail.com> wrote:
>
> Hi,
>
> these files don't present to GDAL with a CRS, but it seems not out of
place to assume that they can use 'oSRS.SetWellKnownGeogCS("WGS84")', when
no other indication is found and there are dimensions 'lon,lat' or
'longitude,latitude'
>
>
https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/
>
> An example sds specifically:
>
> /vsicurl/NETCDF:"/vsicurl/
https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/202202/oisst-avhrr-v02r01.20220201.nc
":sst
>
> Would that be reasonable? Perhaps controlled by an env var? Is there an
established control for this I'm missing? (I'm not looking for '-a_srs' or
VRT, I want the auto-detection to work for these and many other similar
file sources without augmentation).
>
> (It's not out of the question that I could submit a PR for this, just
flagging discussion in case I'm missing something.)
>
> Thanks.
>
> Best, Mike
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com



--
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220315/76b5dc66/attachment.html>

From j1 at jimenezshaw.com  Tue Mar 15 01:20:19 2022
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 15 Mar 2022 09:20:19 +0100
Subject: [gdal-dev] CMake and internal json-c
Message-ID: <CADRrdKuYjouT9kui5SRoY04Gey18_a_t-gy=EPvi8NPrM6hGDQ@mail.gmail.com>

Hi

Keep working with CMake and GDAL_USE_EXTERNAL_LIBS=OFF
Now I want to enable json-c

If I do not say anything, I get this message:
-- JSONC has been found, but is disabled due to GDAL_USE_EXTERNAL_LIBS=OFF.
Enable it by setting GDAL_USE_JSONC=ON

If I say
GDAL_USE_JSONC=ON
GDAL_USE_JSONC_INTERNAL=ON

the log message is
-- Could NOT find JSONC (missing: JSONC_DIR)
-- Found JSONC: /usr/lib/x86_64-linux-gnu/libjson-c.so
and later
-- The following OPTIONAL packages have been found:
...
* JSONC
   json-c library (external)


Looks like I am doing something wrong, or the "internal" configuration is
ignored.

In my computer I have libjson-c installed, but in CI it is not. I want to
reproduce the same behaviour in both.

Thanks
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220315/50181705/attachment-0001.html>

From even.rouault at spatialys.com  Tue Mar 15 04:16:33 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 15 Mar 2022 12:16:33 +0100
Subject: [gdal-dev] CMake and internal json-c
In-Reply-To: <CADRrdKuYjouT9kui5SRoY04Gey18_a_t-gy=EPvi8NPrM6hGDQ@mail.gmail.com>
References: <CADRrdKuYjouT9kui5SRoY04Gey18_a_t-gy=EPvi8NPrM6hGDQ@mail.gmail.com>
Message-ID: <e1b67599-3945-2615-1c32-8b53c61d6ed1@spatialys.com>

Hi,

if you define both GDAL_USE_JSONC=ON and GDAL_USE_JSONC_INTERNAL=ON, the 
use of the internal variant will take precedence. It would be a good 
contribution to mention that in https://gdal.org/build_hints.html

Technically, the report is correct: external json-c has been found. But 
it is not used. The standard CMake FeatureSummary functionality that is 
used doesn't take that subtlety into account. One could possible decide 
to remove the external component from the list of detected component 
when there's a corresponding _INTERNAL=ON? setting. If you feel it would 
be good, please file an issue about that. Bonus point if accompanied 
with a patch. The solution would probably to add some code to all 
|PACKAGES_FOUND| before the call to feature_summary() (cf 
https://cmake.org/cmake/help/latest/module/FeatureSummary.html)

Even

Le 15/03/2022 ? 09:20, Javier Jimenez Shaw a ?crit?:
> Hi
>
> Keep working with CMake and GDAL_USE_EXTERNAL_LIBS=OFF
> Now I want to enable json-c
>
> If I do not say anything, I get this message:
> -- JSONC has been found, but is disabled due to 
> GDAL_USE_EXTERNAL_LIBS=OFF. Enable it by setting GDAL_USE_JSONC=ON
>
> If I say
> GDAL_USE_JSONC=ON
> GDAL_USE_JSONC_INTERNAL=ON
>
> the log message is
> -- Could NOT find JSONC (missing: JSONC_DIR)
> -- Found JSONC: /usr/lib/x86_64-linux-gnu/libjson-c.so
> and later
> -- The following OPTIONAL packages have been found:
> ...
> * JSONC
> ? ?json-c library (external)
>
>
> Looks like I am doing something wrong, or the "internal" configuration 
> is ignored.
>
> In my computer I have libjson-c installed, but in CI it is not. I want 
> to reproduce the same behaviour in both.
>
> Thanks
> .___ ._ ..._ .. . ._. .___ .. __ . _. . __..? ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220315/dde068af/attachment.html>

From even.rouault at spatialys.com  Tue Mar 15 04:38:03 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 15 Mar 2022 12:38:03 +0100
Subject: [gdal-dev] regular grid longlat netcdf without crs meta
In-Reply-To: <CAAcGz98BDCBRC+=U6UC9A7LhrQGdO=pfUd5pt5Od=+i2_VmMDA@mail.gmail.com>
References: <CAAcGz98BDCBRC+=U6UC9A7LhrQGdO=pfUd5pt5Od=+i2_VmMDA@mail.gmail.com>
Message-ID: <497f715b-ddfc-ae1d-ac30-c998bfdd3d67@spatialys.com>

Michael,

Le 15/03/2022 ? 06:06, Michael Sumner a ?crit?:
> Hi,
>
> these files don't present to GDAL with a CRS, but it seems not out of 
> place to assume that they can use 'oSRS.SetWellKnownGeogCS("WGS84")', 
> when no other indication is found and there are dimensions 'lon,lat' 
> or 'longitude,latitude'
>
> https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/
>
> An example sds specifically:
>
> /vsicurl/NETCDF:"/vsicurl/https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/202202/oisst-avhrr-v02r01.20220201.nc":sst
>
> Would that be reasonable? Perhaps controlled by an env var? Is there 
> an established control for this I'm missing? (I'm not looking for 
> '-a_srs' or VRT, I want the auto-detection to work for these and many 
> other similar?file sources without augmentation).

I wouldn't expose WGS84 by default, because it might be another Earth 
geographic CRS, or even a non-Earth geographic CRS.

Potential solution:

- add a GDAL_NETCDF_DEFAULT_GEOGRAPHIC_CRS configuration option (that 
could be set to EPSG:4326 e.g) that would be used in the situation where 
the netCDF CF attributes to define a geographic CRS, but without the 
actual CRS definition, are not set.

- or, more involved but more powerful, add a configuration file in data/ 
, let's say a netcdf_product_conf.json or whatever, where you would 
define a set of product types, with matching global attributes and their 
values and the corresponding CRS.

e.g (not sure my set of "matching_attributes" is appropriate for your 
use case)

{
 ??? "product_type": {
 ??????? "noaa_ncei_oisst": {? // the id of the product here is 
completely arbitrary
 ??????????? "defining_global_attributes": {
 ??????????????? "title": "NOAA/NCEI 1/4 Degree Daily Optimum 
Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - 
Final",
 ??????????????? "geospatial_lat_units": "degrees_north",
 ??????????????? "geospatial_lon_units": "degrees_east"
 ??????????? },
 ??????????? "default_values": {
 ??????????????? "crs": "EPSG:4326"
 ??????????? }
 ??????? }
 ??? }

}

- or, both the easiest and hardest one, convince the data producer to 
just use the netCDF CF conventions to their full capabilities.

Even

>
> (It's not out of the question that I could submit a PR for this, just 
> flagging discussion in case I'm missing something.)
>
> Thanks.
>
> Best, Mike
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220315/e91acf7f/attachment.html>

From mdsumner at gmail.com  Tue Mar 15 15:17:32 2022
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 16 Mar 2022 09:17:32 +1100
Subject: [gdal-dev] regular grid longlat netcdf without crs meta
In-Reply-To: <497f715b-ddfc-ae1d-ac30-c998bfdd3d67@spatialys.com>
References: <CAAcGz98BDCBRC+=U6UC9A7LhrQGdO=pfUd5pt5Od=+i2_VmMDA@mail.gmail.com>
 <497f715b-ddfc-ae1d-ac30-c998bfdd3d67@spatialys.com>
Message-ID: <CAAcGz98wuR6PGdKZOj8hy_GSw9g0VBUzMw90EyczT9aCnZZ_=w@mail.gmail.com>

Thanks Even, that's excellent.

I agree about the providers, and I inform them (the OISST project replied
with a promise to fix in future. I wish they and many others would catch on
to how terrible NetCDF is for 2D regular grids and just use good geotiffs
but hoo boo whoa).

Extending GDAL has more positive impact (for me at least) as the heuristics
will catch many other products.

Best, Mike


On Tue, 15 Mar 2022, 22:38 Even Rouault, <even.rouault at spatialys.com> wrote:
>
> Michael,
>
> Le 15/03/2022 ? 06:06, Michael Sumner a ?crit :
>
> Hi,
>
> these files don't present to GDAL with a CRS, but it seems not out of
place to assume that they can use 'oSRS.SetWellKnownGeogCS("WGS84")', when
no other indication is found and there are dimensions 'lon,lat' or
'longitude,latitude'
>
>
https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/
>
> An example sds specifically:
>
> /vsicurl/NETCDF:"/vsicurl/
https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/202202/oisst-avhrr-v02r01.20220201.nc
":sst
>
> Would that be reasonable? Perhaps controlled by an env var? Is there an
established control for this I'm missing? (I'm not looking for '-a_srs' or
VRT, I want the auto-detection to work for these and many other similar
file sources without augmentation).
>
> I wouldn't expose WGS84 by default, because it might be another Earth
geographic CRS, or even a non-Earth geographic CRS.
>
> Potential solution:
>
> - add a GDAL_NETCDF_DEFAULT_GEOGRAPHIC_CRS configuration option (that
could be set to EPSG:4326 e.g) that would be used in the situation where
the netCDF CF attributes to define a geographic CRS, but without the actual
CRS definition, are not set.
>
> - or, more involved but more powerful, add a configuration file in data/
, let's say a netcdf_product_conf.json or whatever, where you would define
a set of product types, with matching global attributes and their values
and the corresponding CRS.
>
> e.g (not sure my set of "matching_attributes" is appropriate for your use
case)
>
> {
>     "product_type": {
>         "noaa_ncei_oisst": {  // the id of the product here is completely
arbitrary
>             "defining_global_attributes": {
>                 "title": "NOAA/NCEI 1/4 Degree Daily Optimum
Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 -
Final",
>                 "geospatial_lat_units": "degrees_north",
>                 "geospatial_lon_units": "degrees_east"
>             },
>             "default_values": {
>                 "crs": "EPSG:4326"
>             }
>         }
>     }
>
> }
>
> - or, both the easiest and hardest one, convince the data producer to
just use the netCDF CF conventions to their full capabilities.
>
> Even
>
>
> (It's not out of the question that I could submit a PR for this, just
flagging discussion in case I'm missing something.)
>
> Thanks.
>
> Best, Mike
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220316/c530b208/attachment.html>

From inti.luna.rsgis at gmail.com  Wed Mar 16 07:48:43 2022
From: inti.luna.rsgis at gmail.com (inti luna)
Date: Wed, 16 Mar 2022 15:48:43 +0100
Subject: [gdal-dev] Translate HDF MODIS subdataset get dimensions wrong
Message-ID: <CABZ8+BDXbt4voorFKz=Wtng0psitR=JMhcmvL5RR6Rbvh0Dp8A@mail.gmail.com>

Hello,
I am trying to read a subdaset from modis total precipitable water product(
https://ladsweb.modaps.eosdis.nasa.gov/missions-and-measurements/products/MOD05_L2).
The specific subdataset is Qualiy_Assurance_NIR.

Checking the file with gdalinfo provide details about subdatasets:

For example:
gdalinfo MOD05_L2.A2013152.0035.061.2017299012514.hdf

Output extract:
SUBDATASET_8_NAME=HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Water_Vapor_Correction_Factors
  SUBDATASET_8_DESC=[2030x1354] Water_Vapor_Correction_Factors mod05
(16-bit integer)

SUBDATASET_9_NAME=HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Water_Vapor_Infrared
  SUBDATASET_9_DESC=[406x270] Water_Vapor_Infrared mod05 (16-bit integer)

SUBDATASET_10_NAME=HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Quality_Assurance_Near_Infrared
  SUBDATASET_10_DESC=[2030x1354x1] Quality_Assurance_Near_Infrared mod05
(8-bit integer)
---------------------------------------
It can be seen that subdataset 8 has dimensions 2030x1354 which is fine but
subdataset 10 has dimensions 2030x1354x1 which when using gdal translate to
pass it to a geotif gives a raster file with 1x1354 dimensions with 2030
bands which is not right, it should be a file with 2030x1354. What can be
done to correct this or to pass it to the dimensions and match other
subdatasets.
-------
command used to pass it to geotif
-------
gdal_translate
HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Quality_Assurance_Near_Infrared
b10_QA_NIR.tif
------

Thank you for any guidance
Ernesto
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220316/9143de12/attachment.html>

From even.rouault at spatialys.com  Wed Mar 16 08:08:52 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 16 Mar 2022 16:08:52 +0100
Subject: [gdal-dev] Translate HDF MODIS subdataset get dimensions wrong
In-Reply-To: <CABZ8+BDXbt4voorFKz=Wtng0psitR=JMhcmvL5RR6Rbvh0Dp8A@mail.gmail.com>
References: <CABZ8+BDXbt4voorFKz=Wtng0psitR=JMhcmvL5RR6Rbvh0Dp8A@mail.gmail.com>
Message-ID: <21e8cc1d-180a-4eb5-96f0-1407f088311f@spatialys.com>

You could certainly do that with the -array switch of 
https://gdal.org/programs/gdalmdimtranslate.html using a view expression 
that does subsetting 
(https://gdal.org/api/gdalmdarray_cpp.html#_CPPv4NK11GDALMDArray7GetViewERKNSt6stringE 
. similar to numpy slicing/indexing syntax)

Use https://gdal.org/programs/gdalmdiminfo.html to get the path to the 
variable of interest.

Even

Le 16/03/2022 ? 15:48, inti luna a ?crit?:
> Hello,
> I am trying to read a subdaset from modis total precipitable water 
> product(https://ladsweb.modaps.eosdis.nasa.gov/missions-and-measurements/products/MOD05_L2). 
> The specific subdataset is Qualiy_Assurance_NIR.
>
> Checking the file with gdalinfo provide details about subdatasets:
>
> For example:
> gdalinfo MOD05_L2.A2013152.0035.061.2017299012514.hdf
>
> Output extract:
> SUBDATASET_8_NAME=HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Water_Vapor_Correction_Factors
> ? SUBDATASET_8_DESC=[2030x1354] Water_Vapor_Correction_Factors mod05 
> (16-bit integer)
> SUBDATASET_9_NAME=HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Water_Vapor_Infrared
> ? SUBDATASET_9_DESC=[406x270] Water_Vapor_Infrared mod05 (16-bit integer)
> SUBDATASET_10_NAME=HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Quality_Assurance_Near_Infrared
> ? SUBDATASET_10_DESC=[2030x1354x1] Quality_Assurance_Near_Infrared 
> mod05 (8-bit integer)
> ---------------------------------------
> It can be seen that subdataset 8 has dimensions 2030x1354 which is 
> fine but subdataset 10 has dimensions 2030x1354x1 which when using 
> gdal translate to pass it to a geotif gives a raster file with 1x1354 
> dimensions with 2030 bands which is not right, it should be a file 
> with 2030x1354. What can be done to correct this or to pass it to the 
> dimensions and match other subdatasets.
> -------
> command used to pass it to geotif
> -------
> gdal_translate 
> HDF4_EOS:EOS_SWATH:"MOD05_L2.A2013152.0035.061.2017299012514.hdf":mod05:Quality_Assurance_Near_Infrared 
> b10_QA_NIR.tif
> ------
>
> Thank you for any guidance
> Ernesto
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220316/12a4a69f/attachment.html>

From gdt at lexort.com  Fri Mar 18 11:16:34 2022
From: gdt at lexort.com (Greg Troxel)
Date: Fri, 18 Mar 2022 14:16:34 -0400
Subject: [gdal-dev] CI status - passing on all platforms?
Message-ID: <rmimthndt31.fsf@s1.lexort.com>


background:

  I am testing the cmake build and then will be converting the pkgsrc
  package to use cmake so I can be ready for 3.5.0.  Because I am not
  aware of any pre-release distribution tarballs with up-to-date cmake
  support, I'm heading down the path of what would be "make dist" in
  autoconf, and, as I was cautioned, that isn't super portable.

  So, i'm working on a PR to make mkgdaldist.sh more portable and
  document what you need to run it.  I am now able to create
  distribution tarballs on NetBSD, and then build a pkgsrc package with
  them.  (It's all safe and not very interesting changes; this message
  isn't intended to be about the not-yet-filed PR.)

I have the chaneges on a master-based feature branch in my fork, and CI
ran when I force-pushed it recently (thanks if anyone enabled that for
me).  After fixing a shellcheck style nit, I force-pushed again and
Ubuntu 18.04 32bit failed:

  https://github.com/gdt/gdal/runs/5600578897?check_suite_focus=true

with final output

  =========================== short test summary info ============================
  FAILED alg/applyverticalshiftgrid.py::test_applyverticalshiftgrid_6 - assert ...
  FAILED alg/applyverticalshiftgrid.py::test_applyverticalshiftgrid_7 - assert ...
  FAILED utilities/test_gdalwarp_lib.py::test_gdalwarp_lib_135 - AssertionError...
  = 3 failed, 8284 passed, 1066 skipped, 2 xfailed, 25 warnings in 845.46s (0:14:05) =
  100 - done.

This just about can't be because of my change, and all the other jobs
passed, so I'm guessing this either always happens or there is some CI
flakiness.

Therefore I'm going to treat this failure as noise, but I wanted to say
that out loud in case I'm confused, and mention it in case people want
to do something about master.

My tree that had this issue is:

  https://github.com/gdt/gdal/tree/mkgdaldist-portability

if anyone cares.

Thanks,
Greg
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220318/13679358/attachment.sig>

From even.rouault at spatialys.com  Fri Mar 18 11:28:19 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 18 Mar 2022 19:28:19 +0100
Subject: [gdal-dev] CI status - passing on all platforms?
In-Reply-To: <rmimthndt31.fsf@s1.lexort.com>
References: <rmimthndt31.fsf@s1.lexort.com>
Message-ID: <498b8f0c-0aa4-0796-f690-58b9acdc9bf8@spatialys.com>


Le 18/03/2022 ? 19:16, Greg Troxel a ?crit?:
>   After fixing a shellcheck style nit, I force-pushed again and
> Ubuntu 18.04 32bit failed:
>
>    https://github.com/gdt/gdal/runs/5600578897?check_suite_focus=true
>
> with final output
>
>    =========================== short test summary info ============================
>    FAILED alg/applyverticalshiftgrid.py::test_applyverticalshiftgrid_6 - assert ...
>    FAILED alg/applyverticalshiftgrid.py::test_applyverticalshiftgrid_7 - assert ...
>    FAILED utilities/test_gdalwarp_lib.py::test_gdalwarp_lib_135 - AssertionError...
>    = 3 failed, 8284 passed, 1066 skipped, 2 xfailed, 25 warnings in 845.46s (0:14:05) =
>    100 - done.

Was fixed a few hours ago per https://github.com/OSGeo/gdal/pull/5466


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sriddell at geocue.com  Fri Mar 18 13:14:12 2022
From: sriddell at geocue.com (Steve Riddell)
Date: Fri, 18 Mar 2022 20:14:12 +0000
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
Message-ID: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>

Hi,

I?m getting an error (below) using GDAL trying to set up a transformation between NAD83(CSRS) geodetic, w/ ellipsoidal heights, and NAD83(CSRS) geodetic, CGVD28 heights. Similar transformations work fine on some datums,  but fail on others.  Hope someone can offer some insight.  Note the if I don't use the PROJ4_GRIDS extension, I don't get the error, but I don't get the geoid adjustment either.

COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["Ellipsoid (Meters)",
        VERT_DATUM["Ellipsoid",2002],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["ellipsoidal height",UP]]]

COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]


ERROR 6: Cannot find coordinate operations from `EPSG:4955' to `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height - HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83 Canadian Spatial Reference System",ELLIPSOID["GRS 1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic latitude (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic longitude (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation (geog2D domain)",ID["EPSG",9606]],PARAMETER["X-axis translation",0,ID["EPSG",8605]],PARAMETER["Y-axis translation",0,ID["EPSG",8606]],PARAMETER["Z-axis translation",0,ID["EPSG",8607]],PARAMETER["X-axis rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis rotation",0,ID["EPSG",8610]],PARAMETER["Scale difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28 height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of 1928"],CS[vertical,1],AXIS["gravity-related height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28 height - HT2_0 to WGS84 ellipsoidal height",METHOD["GravityRelatedHeight to Geographic3D"],PARAMETERFILE["Geoid (height correction) model file","HT2_0.gtx",ID["EPSG",8666]]]]]'



Thanks in advance for any assistance!
Best regards,

Steve



Steve Riddell
Software Engineering
GeoCue Group, Inc.
520 6th Street | Madison, AL 35756 USA
Phone: 256.461.8289 | Fax: 256.461.8249
LIDAR/Drone Mapping Software & Services ? True View? 3D Imaging Sensors ? Image/LIDAR Data Management Solutions
 www.geocue.com<http://www.geocue.com/>  support.geocue.com<https://support.geocue.com/>




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220318/79d032c7/attachment-0001.html>

From even.rouault at spatialys.com  Fri Mar 18 15:05:27 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 18 Mar 2022 23:05:27 +0100
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
Message-ID: <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>

Steve,

Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123

The complexity of dealing with legacy features TOWGS84[] and PROJ4_GRIDS 
is highly stressing PROJ pipeline computation engine.

Using the plain EPSG codes? EPSG:4955 -> EPSG:4617+5713 would be much 
preferable here

Even

Le 18/03/2022 ? 21:14, Steve Riddell a ?crit?:
>
> Hi,
>
> I?m getting an error (below) using GDAL trying to set up a 
> transformation between NAD83(CSRS) geodetic, w/ ellipsoidal heights, 
> and NAD83(CSRS) geodetic, CGVD28 heights. Similar transformations work 
> fine on some datums,? but fail on others. ?Hope someone can offer some 
> insight.? Note the if I don't use the PROJ4_GRIDS extension, I don't 
> get the error, but I don't get the geoid adjustment either.
>
> COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
>
> ??? GEOGCS["NAD83(CSRS)",
>
> DATUM["NAD83_Canadian_Spatial_Reference_System",
>
> ??????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
> ??????????????? AUTHORITY["EPSG","7019"]],
>
> ??????????? TOWGS84[0,0,0,0,0,0,0],
>
> ??????????? AUTHORITY["EPSG","6140"]],
>
> ??????? PRIMEM["Greenwich",0,
>
> ??????????? AUTHORITY["EPSG","8901"]],
>
> ??????? UNIT["degree",0.0174532925199433,
>
> ??????????? AUTHORITY["EPSG","9122"]],
>
> ??????? AUTHORITY["EPSG","4617"]],
>
> ??? VERT_CS["Ellipsoid (Meters)",
>
> ??????? VERT_DATUM["Ellipsoid",2002],
>
> ??????? UNIT["metre",1,
>
> ??????????? AUTHORITY["EPSG","9001"]],
>
> ??????? AXIS["ellipsoidal height",UP]]]
>
> COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
>
> ??? GEOGCS["NAD83(CSRS)",
>
> DATUM["NAD83_Canadian_Spatial_Reference_System",
>
> ??????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
> ??????????????? AUTHORITY["EPSG","7019"]],
>
> ??????????? TOWGS84[0,0,0,0,0,0,0],
>
> ??????????? AUTHORITY["EPSG","6140"]],
>
> ??????? PRIMEM["Greenwich",0,
>
> ??????????? AUTHORITY["EPSG","8901"]],
>
> ??????? UNIT["degree",0.0174532925199433,
>
> ??????????? AUTHORITY["EPSG","9122"]],
>
> ??????? AUTHORITY["EPSG","4617"]],
>
> ??? VERT_CS["CGVD28 height - HT2_0",
>
> ??????? VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
>
> EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
>
> ??????????? AUTHORITY["EPSG","5114"]],
>
> ??????? UNIT["metre",1,
>
> ??????????? AUTHORITY["EPSG","9001"]],
>
> ??????? AXIS["Gravity-related height",UP],
>
> ??????? AUTHORITY["EPSG","5713"]]]
>
> ERROR 6: Cannot find coordinate operations from `EPSG:4955' to 
> `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height - 
> HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83 Canadian 
> Spatial Reference System",ELLIPSOID["GRS 
> 1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic 
> latitude 
> (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic 
> longitude 
> (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS 
> 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 
> 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation 
> from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation 
> (geog2D domain)",ID["EPSG",9606]],PARAMETER["X-axis 
> translation",0,ID["EPSG",8605]],PARAMETER["Y-axis 
> translation",0,ID["EPSG",8606]],PARAMETER["Z-axis 
> translation",0,ID["EPSG",8607]],PARAMETER["X-axis 
> rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis 
> rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis 
> rotation",0,ID["EPSG",8610]],PARAMETER["Scale 
> difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28 
> height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of 
> 1928"],CS[vertical,1],AXIS["gravity-related 
> height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS 
> 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 
> 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal 
> height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28 
> height - HT2_0 to WGS84 ellipsoidal 
> height",METHOD["GravityRelatedHeight to 
> Geographic3D"],PARAMETERFILE["Geoid (height correction) model 
> file","HT2_0.gtx",ID["EPSG",8666]]]]]'
>
> Thanks in advance for any assistance! Best regards,
> Steve
>
> Steve Riddell
>
> Software Engineering
>
> *GeoCue Group, Inc.*
>
> 520 6th Street | Madison, AL 35756 USA**
>
> *Phone:*256.461.8289 | *Fax:* 256.461.8249
>
> /LIDAR/Drone Mapping Software & Services //? //True View? 3D Imaging 
> Sensors //?//Image/LIDAR Data Management Solutions///
>
> www.geocue.com <http://www.geocue.com/>support.geocue.com 
> <https://support.geocue.com/>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220318/9eae3de6/attachment.html>

From sriddell at geocue.com  Fri Mar 18 16:17:04 2022
From: sriddell at geocue.com (Steve Riddell)
Date: Fri, 18 Mar 2022 23:17:04 +0000
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
Message-ID: <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>

Thanks very much, Even.  For reporting the problem, I ?packaged up? a case with CRS?s with EPGS codes. For the actual problem I?m working, the target CRS is a custom projection ?no EPSG.

From: Even Rouault <even.rouault at spatialys.com>
Sent: Friday, March 18, 2022 5:05 PM
To: Steve Riddell <sriddell at geocue.com>; gdal-dev at lists.osgeo.org
Subject: Re: OGRCreateCoordinateTransformation()


Steve,

Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123

The complexity of dealing with legacy features TOWGS84[] and PROJ4_GRIDS is highly stressing PROJ pipeline computation engine.

Using the plain EPSG codes  EPSG:4955 -> EPSG:4617+5713 would be much preferable here

Even
Le 18/03/2022 ? 21:14, Steve Riddell a ?crit :
Hi,

I?m getting an error (below) using GDAL trying to set up a transformation between NAD83(CSRS) geodetic, w/ ellipsoidal heights, and NAD83(CSRS) geodetic, CGVD28 heights. Similar transformations work fine on some datums,  but fail on others.  Hope someone can offer some insight.  Note the if I don't use the PROJ4_GRIDS extension, I don't get the error, but I don't get the geoid adjustment either.

COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["Ellipsoid (Meters)",
        VERT_DATUM["Ellipsoid",2002],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["ellipsoidal height",UP]]]

COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]


ERROR 6: Cannot find coordinate operations from `EPSG:4955' to `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height - HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83 Canadian Spatial Reference System",ELLIPSOID["GRS 1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic latitude (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic longitude (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation (geog2D domain)",ID["EPSG",9606]],PARAMETER["X-axis translation",0,ID["EPSG",8605]],PARAMETER["Y-axis translation",0,ID["EPSG",8606]],PARAMETER["Z-axis translation",0,ID["EPSG",8607]],PARAMETER["X-axis rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis rotation",0,ID["EPSG",8610]],PARAMETER["Scale difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28 height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of 1928"],CS[vertical,1],AXIS["gravity-related height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28 height - HT2_0 to WGS84 ellipsoidal height",METHOD["GravityRelatedHeight to Geographic3D"],PARAMETERFILE["Geoid (height correction) model file","HT2_0.gtx",ID["EPSG",8666]]]]]'



Thanks in advance for any assistance!

Best regards,

Steve



Steve Riddell
Software Engineering
GeoCue Group, Inc.
520 6th Street | Madison, AL 35756 USA
Phone: 256.461.8289 | Fax: 256.461.8249
LIDAR/Drone Mapping Software & Services ? True View? 3D Imaging Sensors ? Image/LIDAR Data Management Solutions
 www.geocue.com<http://www.geocue.com/>  support.geocue.com<https://support.geocue.com/>





--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220318/712bb29c/attachment-0001.html>

From j1 at jimenezshaw.com  Sat Mar 19 05:12:40 2022
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sat, 19 Mar 2022 13:12:40 +0100
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
 <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
Message-ID: <CADRrdKtax-q_mMcBNoF_V5s3yZLv3Johq5aR=Kk9g2SjQV5O-g@mail.gmail.com>

Hi

Is there a "more modern" way to use a geoid file that is not included in
the default ones? (let's say, a non open one, like the German)
EXTENSION["PROJ4_GRIDS","HT2_0.gtx"] seems to be "proj4 style", right?

Even mentioned months ago that the tag GEOIDMODEL meaning was changed by
EPSG somehow (or it was not clear at the beginning, and they implemented in
a different way). But I do not know is that working in PROJ.

When a user has a non-free geoid file, and want to use it with PROJ, what
is the proper procedure without changing "proj.db"? (I would prefer
something in the CRS WKT more than transformation pipeline. But it is just
a wish)

BTW, I do not want to use TOWGS84 (that was part of the problem above).

Thanks
Javier.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Sat, 19 Mar 2022 at 00:17, Steve Riddell <sriddell at geocue.com> wrote:

> Thanks very much, Even.  For reporting the problem, I ?packaged up? a case
> with CRS?s with EPGS codes. For the actual problem I?m working, the target
> CRS is a custom projection ?no EPSG.
>
>
>
> *From:* Even Rouault <even.rouault at spatialys.com>
> *Sent:* Friday, March 18, 2022 5:05 PM
> *To:* Steve Riddell <sriddell at geocue.com>; gdal-dev at lists.osgeo.org
> *Subject:* Re: OGRCreateCoordinateTransformation()
>
>
>
> Steve,
>
> Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123
>
> The complexity of dealing with legacy features TOWGS84[] and PROJ4_GRIDS
> is highly stressing PROJ pipeline computation engine.
>
> Using the plain EPSG codes  EPSG:4955 -> EPSG:4617+5713 would be much
> preferable here
>
> Even
>
> Le 18/03/2022 ? 21:14, Steve Riddell a ?crit :
>
> Hi,
>
>
>
> I?m getting an error (below) using GDAL trying to set up a transformation
> between NAD83(CSRS) geodetic, w/ ellipsoidal heights, and NAD83(CSRS)
> geodetic, CGVD28 heights. Similar transformations work fine on some
> datums,  but fail on others.  Hope someone can offer some insight.  Note
> the if I don't use the PROJ4_GRIDS extension, I don't get the error, but I
> don't get the geoid adjustment either.
>
>
>
> COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
>
>     GEOGCS["NAD83(CSRS)",
>
>         DATUM["NAD83_Canadian_Spatial_Reference_System",
>
>             SPHEROID["GRS 1980",6378137,298.257222101,
>
>                 AUTHORITY["EPSG","7019"]],
>
>             TOWGS84[0,0,0,0,0,0,0],
>
>             AUTHORITY["EPSG","6140"]],
>
>         PRIMEM["Greenwich",0,
>
>             AUTHORITY["EPSG","8901"]],
>
>         UNIT["degree",0.0174532925199433,
>
>             AUTHORITY["EPSG","9122"]],
>
>         AUTHORITY["EPSG","4617"]],
>
>     VERT_CS["Ellipsoid (Meters)",
>
>         VERT_DATUM["Ellipsoid",2002],
>
>         UNIT["metre",1,
>
>             AUTHORITY["EPSG","9001"]],
>
>         AXIS["ellipsoidal height",UP]]]
>
>
>
> COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
>
>     GEOGCS["NAD83(CSRS)",
>
>         DATUM["NAD83_Canadian_Spatial_Reference_System",
>
>             SPHEROID["GRS 1980",6378137,298.257222101,
>
>                 AUTHORITY["EPSG","7019"]],
>
>             TOWGS84[0,0,0,0,0,0,0],
>
>             AUTHORITY["EPSG","6140"]],
>
>         PRIMEM["Greenwich",0,
>
>             AUTHORITY["EPSG","8901"]],
>
>         UNIT["degree",0.0174532925199433,
>
>             AUTHORITY["EPSG","9122"]],
>
>         AUTHORITY["EPSG","4617"]],
>
>     VERT_CS["CGVD28 height - HT2_0",
>
>         VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
>
>             EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
>
>             AUTHORITY["EPSG","5114"]],
>
>         UNIT["metre",1,
>
>             AUTHORITY["EPSG","9001"]],
>
>         AXIS["Gravity-related height",UP],
>
>         AUTHORITY["EPSG","5713"]]]
>
>
>
>
>
> ERROR 6: Cannot find coordinate operations from `EPSG:4955' to
> `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height -
> HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83 Canadian
> Spatial Reference System",ELLIPSOID["GRS
> 1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic
> latitude
> (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic
> longitude
> (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS
> 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS
> 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation
> from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation (geog2D
> domain)",ID["EPSG",9606]],PARAMETER["X-axis
> translation",0,ID["EPSG",8605]],PARAMETER["Y-axis
> translation",0,ID["EPSG",8606]],PARAMETER["Z-axis
> translation",0,ID["EPSG",8607]],PARAMETER["X-axis
> rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis
> rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis
> rotation",0,ID["EPSG",8610]],PARAMETER["Scale
> difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28 height
> - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of
> 1928"],CS[vertical,1],AXIS["gravity-related
> height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS
> 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS
> 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal
> height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28
> height - HT2_0 to WGS84 ellipsoidal height",METHOD["GravityRelatedHeight to
> Geographic3D"],PARAMETERFILE["Geoid (height correction) model
> file","HT2_0.gtx",ID["EPSG",8666]]]]]'
>
>
>
> Thanks in advance for any assistance!
>
> Best regards,
>
> Steve
>
>
>
>
>
> Steve Riddell
>
> Software Engineering
>
> *GeoCue Group, Inc.*
>
> 520 6th Street | Madison, AL 35756 USA
>
> *Phone:* 256.461.8289 | *Fax:* 256.461.8249
>
> *LIDAR/Drone Mapping Software & Services **? True View? 3D Imaging
> Sensors **? Image/LIDAR Data Management Solutions*
>
>  www.geocue.com  support.geocue.com
>
>
>
>
>
>
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220319/d69100b4/attachment.html>

From even.rouault at spatialys.com  Sun Mar 20 16:05:56 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 21 Mar 2022 00:05:56 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
Message-ID: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>

Hi,

As discussed a few weeks ago, here's a GDAL 3.5.0alpha1 snapshot, mostly 
for the sake of exercising the new CMake build system (thanks to all 
early testers and contributors!). The libtool numbers have *not* been 
updated (I believe they are still the same as the 3.3.0 release). This 
is not meant as being pushed to any distribution channel yet.

Download links:
http://download.osgeo.org/gdal/3.5.0/gdal-3.5.0alpha1.tar.gz
http://download.osgeo.org/gdal/3.5.0/gdal-3.5.0alpha1.tar.xz
http://download.osgeo.org/gdal/3.5.0/gdal350alpha1.zip

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Mon Mar 21 04:43:25 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 21 Mar 2022 11:43:25 +0000
Subject: [gdal-dev] Why does ogrinfo use backtics in the output?
Message-ID: <24ee872b9bf44af682739a4388a585ba@maanmittauslaitos.fi>

Hi,

I have been wondering for a long time why orginfo is using backtics/backquotes in the output. In this example before "foo" and "ESRI"

ogrinfo foo.shp
INFO: Open of `foo.shp'
      using driver `ESRI Shapefile' successful.

Not so big problem but in markup the backtick means the beginning/end of a code block and copy-pasting ogrinfo report may require some hand editing. Would it make any harm to use single quotes at both ends?

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220321/8bd71f1b/attachment.html>

From even.rouault at spatialys.com  Mon Mar 21 05:16:15 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 21 Mar 2022 13:16:15 +0100
Subject: [gdal-dev] Why does ogrinfo use backtics in the output?
In-Reply-To: <24ee872b9bf44af682739a4388a585ba@maanmittauslaitos.fi>
References: <24ee872b9bf44af682739a4388a585ba@maanmittauslaitos.fi>
Message-ID: <7a2309e9-2025-5620-1679-768ff6eb4d0c@spatialys.com>

Hi Jukka,

those backtics are there from day one: 
https://github.com/OSGeo/gdal/commit/3359e3f9f2b1d4c1197ab14395efe652eded37da 
. I suppose this is just for aesthetics. I assume this should be fine to 
change that to single quotes (although some downstream consumers that 
would dump ogrinfo output and do exact comparison with reference files 
would probably be unhappy, but we have regularly do changes that affect 
the exact output of ogrinfo through the years).? If you want to do that, 
a few expected results in autotest/utilities/test_ogrinfo.py will need 
to be adapted as well as 
https://github.com/OSGeo/gdal/blob/master/apps/ogrinfo.cpp

Even

Le 21/03/2022 ? 12:43, Rahkonen Jukka (MML) a ?crit?:
>
> Hi,
>
> I have been wondering for a long time why orginfo is using 
> backtics/backquotes in the output. In this example before ?foo? and ?ESRI?
>
> ogrinfo foo.shp
>
> INFO: Open of `foo.shp'
>
> ????? using driver `ESRI Shapefile' successful.
>
> Not so big problem but in markup the backtick means the beginning/end 
> of a code block and copy-pasting ogrinfo report may require some hand 
> editing. Would it make any harm to use single quotes at both ends?
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220321/7e7dacbf/attachment.html>

From sebastic at xs4all.nl  Mon Mar 21 10:39:08 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Mon, 21 Mar 2022 18:39:08 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
Message-ID: <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>

Quite a lot of new files which suggests that CPACK_SOURCE_IGNORE_FILES 
needs more work.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From sebastic at xs4all.nl  Mon Mar 21 10:51:57 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Mon, 21 Mar 2022 18:51:57 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>
Message-ID: <28e73914-afd2-51ea-bbe7-bbb649d13d2e@xs4all.nl>

On 3/21/22 18:39, Sebastiaan Couwenberg wrote:
> Quite a lot of new files which suggests that CPACK_SOURCE_IGNORE_FILES 
> needs more work.

Also quite a lot of noise in the diff due $Id$ expansion changes like:

- * $Id: armadillo_headers.h dd1e0e25c2d41bbb0b63061751483276ab5da090 
2019-04-27 15:27:04 +0200 Even Rouault $
+ * $Id: armadillo_headers.h  $

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From even.rouault at spatialys.com  Mon Mar 21 11:14:20 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 21 Mar 2022 19:14:20 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>
Message-ID: <d5762557-8f34-7552-efc3-f9cdf003e841@spatialys.com>


Le 21/03/2022 ? 18:39, Sebastiaan Couwenberg a ?crit?:
> Quite a lot of new files which suggests that CPACK_SOURCE_IGNORE_FILES 
> needs more work.

CPack hasn't been used at all to generate the tarball. This is the 
traditionnal mkgdaldist.sh script. I suspect this comes from gdal/ 
content having been moved to topdir, and now things like .github/ or? 
doc/ are included and should probably be cleaned up. Other things you 
spotted ?

| Also quite a lot of noise in the diff due $Id$ expansion changes like:

I suspect this is also due to the gdal/ moving, which must breaks the 
history. That $Id$ expansion could probably be just removed.

I filed https://github.com/OSGeo/gdal/issues/5483 about those ? topics

>
> Kind Regards,
>
> Bas
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Mar 21 12:35:56 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 21 Mar 2022 20:35:56 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
Message-ID: <dafb96ec-158a-3d86-3ba0-2e8472e69ab2@spatialys.com>

Forgot to mention that the GDAL specific options to control the CMake 
build are documented in https://gdal.org/build_hints.html (of course 
general CMake variables that control builds, like the ones listed at 
https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html, can 
also generally be used)

Practical examples of build recipees as used by CI can be found in 
https://github.com/OSGeo/gdal/blob/master/.github/workflows/cmake_builds.yml 
and 
https://github.com/OSGeo/gdal/blob/master/.github/workflows/android_cmake/start.sh 
(although for the later this is probably done in the most idiomatic way 
to cross-compile for Android)

Even

Le 21/03/2022 ? 00:05, Even Rouault a ?crit?:
> Hi,
>
> As discussed a few weeks ago, here's a GDAL 3.5.0alpha1 snapshot, 
> mostly for the sake of exercising the new CMake build system (thanks 
> to all early testers and contributors!). The libtool numbers have 
> *not* been updated (I believe they are still the same as the 3.3.0 
> release). This is not meant as being pushed to any distribution 
> channel yet.
>
> Download links:
> http://download.osgeo.org/gdal/3.5.0/gdal-3.5.0alpha1.tar.gz
> http://download.osgeo.org/gdal/3.5.0/gdal-3.5.0alpha1.tar.xz
> http://download.osgeo.org/gdal/3.5.0/gdal350alpha1.zip
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Tue Mar 22 04:56:05 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 22 Mar 2022 11:56:05 +0000
Subject: [gdal-dev] Is PAM always used before GeoTIFF tags?
Message-ID: <5834688c94fa4f32a773c3e91798323f@maanmittauslaitos.fi>

Hi,

See this question https://gis.stackexchange.com/questions/426418/create-rectified-geotiff-given-aux-xml-produced-from-arcgis?

The GeoTIFF driver documentation https://gdal.org/drivers/raster/gtiff.html#georeferencing says about the order in which the georeferencing is searched "By default, information is fetched in following order (first listed is the most prioritary): PAM (Persistent Auxiliary metadata) .aux.xml sidecar file, INTERNAL (GeoTIFF keys and tags), TABFILE (.tab), WORLDFILE (.tfw, .tifw/.tiffw or .wld)."
However, in this case it seems that GeoTIFF tags are used instead of PAM if not especially asked with --config GDAL_GEOREF_SOURCES PAM

I am also curious to know how the SourceGCP values in this PAM file gets converted into pixel rows and columns. For example these values
<SourceGCPs xsi:type="typens:ArrayOfDouble">
        <Double>3.3670799903498199</Double>
        <Double>14.344873843184562</Double>
seem to turn into (1010.12399710495,3376.53784704463). How does it happen and where is it documented? I think there must happen some scaling and offsetting but is this something ESRI specific? I found this ESRI document but there the columns and rows appear unscaled in the aux.xml file https://doc.arcgis.com/en/imagery/workflows/browse-imagery/workflow/workflow-appendices.htm.

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220322/32f13a3c/attachment.html>

From even.rouault at spatialys.com  Tue Mar 22 07:04:29 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Mar 2022 15:04:29 +0100
Subject: [gdal-dev] Is PAM always used before GeoTIFF tags?
In-Reply-To: <5834688c94fa4f32a773c3e91798323f@maanmittauslaitos.fi>
References: <5834688c94fa4f32a773c3e91798323f@maanmittauslaitos.fi>
Message-ID: <548723da-f4e5-105c-f41f-c438ac07993e@spatialys.com>

Jukka,

Le 22/03/2022 ? 12:56, Rahkonen Jukka (MML) a ?crit?:
>
> Hi,
>
> See this question 
> https://gis.stackexchange.com/questions/426418/create-rectified-geotiff-given-aux-xml-produced-from-arcgis?
>
> The GeoTIFF driver documentation 
> https://gdal.org/drivers/raster/gtiff.html#georeferencing says about 
> the order in which the georeferencing is searched ?By default, 
> information is fetched in following order (first listed is the most 
> prioritary): PAM (Persistent Auxiliary metadata) .aux.xml sidecar 
> file, INTERNAL (GeoTIFF keys and tags), TABFILE (.tab), WORLDFILE 
> (.tfw, .tifw/.tiffw or .wld).?
>
> However, in this case it seems that GeoTIFF tags are used instead of 
> PAM if not especially asked with --config GDAL_GEOREF_SOURCES PAM
>
Yes I can see in the code that for that particular case with standard 
TIFF tags expressing a geotransform (which is completely buggy on the 
sample file of the stackexchange thread) an this ESRI GeodataXform 
.aux.xml stuff, both will be reported. I've just fixed this in 
https://github.com/OSGeo/gdal/commit/acbd907896418330315f3e6febf620d4686023ac

Adding -to SRC_METHOD=GCP_POLYNOMIAL or GCP_TPS to gdalwarp will force 
the GCPs to be used.

> I am also curious to know how the SourceGCP values in this PAM file 
> gets converted into pixel rows and columns. For example these values
>
> <SourceGCPs xsi:type="typens:ArrayOfDouble">
>
> <Double>3.3670799903498199</Double>
>
> <Double>14.344873843184562</Double>
>
> seem to turn into (1010.12399710495,3376.53784704463). How does it 
> happen and where is it documented? I think there must happen some 
> scaling and offsetting but is this something ESRI specific? I found 
> this ESRI document but there the columns and rows appear unscaled in 
> the aux.xml file 
> https://doc.arcgis.com/en/imagery/workflows/browse-imagery/workflow/workflow-appendices.htm.
>
I see support for the ESRI GeodataXform .aux.xml stuff was added in 
https://github.com/OSGeo/gdal/commit/7025e356c28

The interesting part to explain the difference between the values in the 
files and the ones reported by gdalinfo is in:

+??????????????????????? // The origin used is the bottom left corner,
+??????????????????????? // and raw values are in inches !
+??????????????????????? pasGCPList[i].dfGCPPixel = adfSourceGCPs[2*i] *
+ CPLAtof(pszTIFFTagXRes);
+??????????????????????? pasGCPList[i].dfGCPLine = nRasterYSize -
+??????????????????????????????? adfSourceGCPs[2*i+1] * 
CPLAtof(pszTIFFTagYRes);

At least this was found to be necessary on the sample file that was used 
to develop this code. And actually trying with the file in the 
stackexchange thread, this leads to correct georeferencing.

Even

> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220322/55e48153/attachment.html>

From sebastic at xs4all.nl  Tue Mar 22 11:10:11 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Tue, 22 Mar 2022 19:10:11 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <d5762557-8f34-7552-efc3-f9cdf003e841@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>
 <d5762557-8f34-7552-efc3-f9cdf003e841@spatialys.com>
Message-ID: <d8570355-60fd-5773-0f6d-78e5f16d893a@xs4all.nl>

On 3/21/22 19:14, Even Rouault wrote:
> Other things you spotted ?

A bunch of new data (and one ini) files, and some helper scripts like:

  frmts/grib/degrib/extract_tables.py
  frmts/grib/degrib/merge_degrib_and_wmo_tables.py

There doesn't seem to be an equivalent for:

  --with-threads

  --with-sse
  --with-ssse3
  --with-avx

The latter three seem to only be detected whether they're available at 
build time, this is somewhat problematic for distribution packages where 
the system building it won't be the same as the ones running it.

Also no GDAL_USE_GRASS to disable it explicitly like --with-grass=no.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From even.rouault at spatialys.com  Tue Mar 22 11:22:35 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Mar 2022 19:22:35 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <d8570355-60fd-5773-0f6d-78e5f16d893a@xs4all.nl>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>
 <d5762557-8f34-7552-efc3-f9cdf003e841@spatialys.com>
 <d8570355-60fd-5773-0f6d-78e5f16d893a@xs4all.nl>
Message-ID: <5574cc04-a2e5-db5d-18f9-2779d7d5505f@spatialys.com>


Le 22/03/2022 ? 19:10, Sebastiaan Couwenberg a ?crit?:
> On 3/21/22 19:14, Even Rouault wrote:
>> Other things you spotted ?
>
> A bunch of new data (and one ini) files, 
Those new data files are intended. I assume you're refering to 
drivers.ini ? This is intended too.
> and some helper scripts like:
>
> ?frmts/grib/degrib/extract_tables.py
> ?frmts/grib/degrib/merge_degrib_and_wmo_tables.py
for the sake of simplicity, I'd would just keep them in the tarball, 
even if not used during the build.
>
> There doesn't seem to be an equivalent for:
>
> ?--with-threads
The --without-thread configuration on autoconf was untested. It perhaps 
builds, but not sure if runtime behaviour is correct. Offering no thread 
support doesn't seem very useful those days.
>
> ?--with-sse
> ?--with-ssse3
> ?--with-avx
>
> The latter three seem to only be detected whether they're available at 
> build time, this is somewhat problematic for distribution packages 
> where the system building it won't be the same as the ones running it.

Those builds flags aren't necessary. The build system indeed does detect 
if the compiler supports SSE3 or AVX, and builds separate object files 
that can use those instruction sets, but they are only used at runtime 
if the intruction set is available. Hence you can do a generic binary 
that will run everywhere.

If I remember well the reason for those flags, it was because some 
(older?) Solaris version flagged a whole binary as requiring AVX, as 
soon as an object file with AVX was included in it. We'll see if there's 
a future need to be able to re-introduce such flags, but that doesn't 
seem very compelling for now.

>
> Also no GDAL_USE_GRASS to disable it explicitly like --with-grass=no.

I tried to raise the status of the GRASS plugin and its future some time 
ago. A potential option would be to move it to an external repository, 
due to the cyclic dependency of GDAL and GRASS, but nobody jumped to 
take action. I believe we should just completely disable CMake build 
support for it for now, and people would just use the standalone 
autoconf script that goes with the tarball of the plugin.

Even

>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Tue Mar 22 11:41:19 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Mar 2022 19:41:19 +0100
Subject: [gdal-dev] Moving GDAL GRASS driver in a dedicated repository ?
In-Reply-To: <CAG+h=FEN6Xz3z0RA+F7aWkk461POO=FVyvT34p2obG4pk3y-KA@mail.gmail.com>
References: <36ba97a9-1dc6-eacb-8765-55c0c4a97929@spatialys.com>
 <CAG+h=FEN6Xz3z0RA+F7aWkk461POO=FVyvT34p2obG4pk3y-KA@mail.gmail.com>
Message-ID: <1e6f27ce-89c3-c154-970c-d38333aa9d28@spatialys.com>

Hi,

bumping again this topic, after feedback just received on 3.5.0alpha1.

For now, I'm heading to completely disable CMake build support for the 
GRASS drivers in https://github.com/OSGeo/gdal/pull/5490 . Only the 
existing autoconf scripts that are provided with the plugin (if they 
work ?) will be usable.

As noted in my comments, CMake build support could potentially be 
re-enabled, but just allowed the driver to be built as a plugin, and not 
built-in in GDAL core lib. However that would still do a full GDAL 
build, not just the driver, so this is perhaps not so useful (a CMake 
build for the driver would just use an already built GDAL and use 
find_package(GDAL) )

It would be good if someone could step up as the maintainer of the 
driver in-tree, or in an external repository. Otherwise we might just 
end up giving it the treatment of other drivers that lack attention from 
a maintainer, ie rm -rf .

Even

Le 23/11/2021 ? 21:50, Markus Metz a ?crit?:
> Hi Even,
>
> IMHO it has been a bit of a luxury that the GDAL GRASS driver was 
> allowed to exist as a regular GDAL supported format within 
> frmts/grass. With every new release of GDAL, you (the GDAL 
> maintainers) also released a separate new GDAL GRASS driver which was 
> really nice of you!
>
> Considering the workaround for this circular dependency, I agree that 
> a dedicated repository makes sense.
>
> I personally don't use the GDAL GRASS driver at all (I just try to 
> maintain it), but I am aware that a number of projects use the GDAL 
> GRASS driver. Feedback from any affected projects would be helpful.
>
> Markus M
>
> On Thu, Nov 18, 2021 at 7:13 PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Hi,
>
>     (writing to both GDAL and GRASS lists)
>
>     Working on the transition to CMake as the GDAL build system, the
>     particular status of the GRASS driver in GDAL raised my attention.
>
>     (The following is based on my understanding. It has been ages since I
>     didn't try this...)
>
>     This driver is a bit odd in the sense that there's a cyclic
>     dependency
>     to work around, as GRASS links to GDAL , but the GDAL GRASS driver
>     needs
>     to be linked against GRASS.
>
>     So the usual procedure is:
>
>     - build GDAL without the GRASS driver
>
>     - build GRASS against GDAL
>
>     - build the GDAL GRASS driver from the separate gdal-grass tarball
>     that
>     GDAL distributes along its main tarball.
>
>     With the current GDAL autoconf build system, there's also the
>     possibility to rebuild GDAL with the GRASS driver builtin in libgdal,
>     but that's a bit odd, since you need to make sure that this new
>     libgdal
>     is the one that GRASS will link against at runtime, otherwise
>     chaos will
>     ensure. I'm not sure if that's used. This is typically something I
>     would
>     *not* want to support in the new GDAL cmake build.
>
>     All in all, given the particular nature of that driver, I believe it
>     would be better in a dedicated repository, with its standalone build
>     scripts, whose initial version could be just the ones of
>     https://github.com/OSGeo/gdal/tree/master/frmts/grass/pkg, or
>     evolve to
>     CMake or whatever the maintainers of that driver would prefer. I
>     believe
>     this would make the situation clearer.
>
>     Opinions ? and people interested in setting up that dedicated
>     repository ?
>
>     Even
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220322/b11cbe9f/attachment.html>

From sebastic at xs4all.nl  Tue Mar 22 11:52:16 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Tue, 22 Mar 2022 19:52:16 +0100
Subject: [gdal-dev] Moving GDAL GRASS driver in a dedicated repository ?
In-Reply-To: <1e6f27ce-89c3-c154-970c-d38333aa9d28@spatialys.com>
References: <36ba97a9-1dc6-eacb-8765-55c0c4a97929@spatialys.com>
 <CAG+h=FEN6Xz3z0RA+F7aWkk461POO=FVyvT34p2obG4pk3y-KA@mail.gmail.com>
 <1e6f27ce-89c3-c154-970c-d38333aa9d28@spatialys.com>
Message-ID: <5d02e4c3-bac8-d960-b500-a9545491b349@xs4all.nl>

On 3/22/22 19:41, Even Rouault wrote:
> bumping again this topic, after feedback just received on 3.5.0alpha1.
> 
> For now, I'm heading to completely disable CMake build support for the 
> GRASS drivers in https://github.com/OSGeo/gdal/pull/5490 . Only the 
> existing autoconf scripts that are provided with the plugin (if they 
> work ?) will be usable.

The libgdal-grass Debian package uses the autoconf bits.

> As noted in my comments, CMake build support could potentially be 
> re-enabled, but just allowed the driver to be built as a plugin, and not 
> built-in in GDAL core lib. However that would still do a full GDAL 
> build, not just the driver, so this is perhaps not so useful (a CMake 
> build for the driver would just use an already built GDAL and use 
> find_package(GDAL) )
> 
> It would be good if someone could step up as the maintainer of the 
> driver in-tree, or in an external repository. Otherwise we might just 
> end up giving it the treatment of other drivers that lack attention from 
> a maintainer, ie rm -rf .

According to the wiki Markus and Markus are the maintainers of the GRASS 
driver:

  https://github.com/OSGeo/gdal/wiki/Maintainers-per-sub-system

With GRASS using non-standard library directories it doesn't work that 
well as recently discussed on grass-dev:

  https://lists.osgeo.org/pipermail/grass-dev/2022-February/095596.html

Removing the driver upstream and the libgdal-grass package from Debian 
would make my life easier, so no objection from me.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From even.rouault at spatialys.com  Tue Mar 22 11:58:17 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Mar 2022 19:58:17 +0100
Subject: [gdal-dev] Motion (V2): remove and deprecate a few drivers
In-Reply-To: <fa89453f-1e2b-2f68-85a1-0b40f50a83e0@spatialys.com>
References: <fa89453f-1e2b-2f68-85a1-0b40f50a83e0@spatialys.com>
Message-ID: <5c2eebb8-a874-891a-4257-64f0751a2bf0@spatialys.com>

Hi,

I'd appreciate if I could get some approval of 
https://github.com/OSGeo/gdal/pull/5269 (it'll need some trivial 
adjustment to be applied due to conflicts) that implements the below 
decision (for some reason people tend to be more generous in adding 
emojis to pull requests that add new features than ones that remove code).

The removal of the OpenDAP/DODS drivers is not included in that PR since 
there was apparently some interest in it 
https://github.com/OSGeo/gdal/issues/5173, but that failed to 
materialize with concrete elements to be able to support them, so I 
believe they will ultimately go to the rm -rf road too.

Even

Le 04/03/2021 ? 17:32, Even Rouault a ?crit?:
> Hi,
>
> Updating my yesterday motion with the feedback received (only second 
> bullet updated with a more restricted set of drivers)
>
> Motion:
>
> - remove the vector drivers BNA, AeronavFAA, HTF, OpenAir, SEGUKOOA, 
> SEGY, SUA, XPlane and raster drivers BPG, E00GRID, EPSILON, 
> IGNFHeightASCIIGrid, NTv1. They have all been authored by myself and 
> I'm not aware of them having been much used or being still in use. 
> Implemented in https://github.com/OSGeo/gdal/pull/3373. They (driver 
> code, doc and tests) have been moved to the 
> https://github.com/OSGeo/gdal-extra-drivers
>
> - deprecate the raster drivers DODS, JPEG2000 (superseded per 
> JP2OpenJPEG), JPEGLS, MG4LIDAR, FUJIBAS, IDA, INGR, ZMAP and vector 
> driver ARCGEN, ArcObjects, CLOUDANT, COUCHDB, DB2, DODS, FME, 
> GEOMEDIA, GTM, INGRES, MONGODB (superserded per MongoDBV3), REC, WALK 
> . They will now be disabled at runtime by default, with an explicit 
> error message when they are triggered, unless the 
> GDAL_ENABLE_DEPRECATED_DRIVER_{drivername}
> configuration option is set to YES, and will be removed in GDAL 3.5. 
> Implemented in https://github.com/OSGeo/gdal/pull/3505
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jluis at ualg.pt  Tue Mar 22 12:23:38 2022
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Tue, 22 Mar 2022 19:23:38 +0000
Subject: [gdal-dev] Motion (V2): remove and deprecate a few drivers
In-Reply-To: <5c2eebb8-a874-891a-4257-64f0751a2bf0@spatialys.com>
References: <fa89453f-1e2b-2f68-85a1-0b40f50a83e0@spatialys.com>
 <5c2eebb8-a874-891a-4257-64f0751a2bf0@spatialys.com>
Message-ID: <AM6PR04MB3959EC331ED083A5C24E7881A6179@AM6PR04MB3959.eurprd04.prod.outlook.com>

Even,

Please the vector GMT driver is not to be removed

https://github.com/OSGeo/gdal/pull/5269/commits/f89bccc10e00ef57312165f5ee11f5ee1f1dddc3

it's very much used in GMT. We talked about this before (sorry didn't keep references of it).
What is to be deprecated is the old netCDF GMT grid format, but not the vector one (whose implementation was paid for).

Cheers

Joaquim

-----Original Message-----
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Even Rouault
Sent: Tuesday, March 22, 2022 6:58 PM
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Motion (V2): remove and deprecate a few drivers

Hi,

I'd appreciate if I could get some approval of
https://github.com/OSGeo/gdal/pull/5269 (it'll need some trivial adjustment to be applied due to conflicts) that implements the below decision (for some reason people tend to be more generous in adding emojis to pull requests that add new features than ones that remove code).

The removal of the OpenDAP/DODS drivers is not included in that PR since there was apparently some interest in it https://github.com/OSGeo/gdal/issues/5173, but that failed to materialize with concrete elements to be able to support them, so I believe they will ultimately go to the rm -rf road too.

Even

Le 04/03/2021 ? 17:32, Even Rouault a ?crit?:
> Hi,
>
> Updating my yesterday motion with the feedback received (only second 
> bullet updated with a more restricted set of drivers)
>
> Motion:
>
> - remove the vector drivers BNA, AeronavFAA, HTF, OpenAir, SEGUKOOA, 
> SEGY, SUA, XPlane and raster drivers BPG, E00GRID, EPSILON, 
> IGNFHeightASCIIGrid, NTv1. They have all been authored by myself and 
> I'm not aware of them having been much used or being still in use.
> Implemented in https://github.com/OSGeo/gdal/pull/3373. They (driver 
> code, doc and tests) have been moved to the 
> https://github.com/OSGeo/gdal-extra-drivers
>
> - deprecate the raster drivers DODS, JPEG2000 (superseded per 
> JP2OpenJPEG), JPEGLS, MG4LIDAR, FUJIBAS, IDA, INGR, ZMAP and vector 
> driver ARCGEN, ArcObjects, CLOUDANT, COUCHDB, DB2, DODS, FME, 
> GEOMEDIA, GTM, INGRES, MONGODB (superserded per MongoDBV3), REC, WALK 
> . They will now be disabled at runtime by default, with an explicit 
> error message when they are triggered, unless the 
> GDAL_ENABLE_DEPRECATED_DRIVER_{drivername}
> configuration option is set to YES, and will be removed in GDAL 3.5. 
> Implemented in https://github.com/OSGeo/gdal/pull/3505
>
> Starting with my +1
>
> Even
>
--
http://www.spatialys.com
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Tue Mar 22 13:08:27 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 22 Mar 2022 21:08:27 +0100
Subject: [gdal-dev] Motion (V2): remove and deprecate a few drivers
In-Reply-To: <AM6PR04MB3959EC331ED083A5C24E7881A6179@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <fa89453f-1e2b-2f68-85a1-0b40f50a83e0@spatialys.com>
 <5c2eebb8-a874-891a-4257-64f0751a2bf0@spatialys.com>
 <AM6PR04MB3959EC331ED083A5C24E7881A6179@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <5e1a6b2b-5051-7728-9e29-1eddc5ec2963@spatialys.com>


Le 22/03/2022 ? 20:23, Joaquim Manuel Freire Lu?s a ?crit?:
> Even,
>
> Please the vector GMT driver is not to be removed
It is not. The commit you refer to removes the GTM (GPS Track Maker) driver.
>
> https://github.com/OSGeo/gdal/pull/5269/commits/f89bccc10e00ef57312165f5ee11f5ee1f1dddc3
>
> it's very much used in GMT. We talked about this before (sorry didn't keep references of it).
> What is to be deprecated is the old netCDF GMT grid format, but not the vector one
I'm in line with that.
> (whose implementation was paid for).
I assume most GDAL drivers, including those in that batch of removal, 
have been paid for at some point. That's not a criterion by itself to 
keep them 15 years after if no one is willing to keep up with their 
overhead and can justify they are still relevant.
>
> Cheers
>
> Joaquim
>
> -----Original Message-----
> From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Even Rouault
> Sent: Tuesday, March 22, 2022 6:58 PM
> To: gdal-dev at lists.osgeo.org
> Subject: Re: [gdal-dev] Motion (V2): remove and deprecate a few drivers
>
> Hi,
>
> I'd appreciate if I could get some approval of
> https://github.com/OSGeo/gdal/pull/5269 (it'll need some trivial adjustment to be applied due to conflicts) that implements the below decision (for some reason people tend to be more generous in adding emojis to pull requests that add new features than ones that remove code).
>
> The removal of the OpenDAP/DODS drivers is not included in that PR since there was apparently some interest in it https://github.com/OSGeo/gdal/issues/5173, but that failed to materialize with concrete elements to be able to support them, so I believe they will ultimately go to the rm -rf road too.
>
> Even
>
> Le 04/03/2021 ? 17:32, Even Rouault a ?crit?:
>> Hi,
>>
>> Updating my yesterday motion with the feedback received (only second
>> bullet updated with a more restricted set of drivers)
>>
>> Motion:
>>
>> - remove the vector drivers BNA, AeronavFAA, HTF, OpenAir, SEGUKOOA,
>> SEGY, SUA, XPlane and raster drivers BPG, E00GRID, EPSILON,
>> IGNFHeightASCIIGrid, NTv1. They have all been authored by myself and
>> I'm not aware of them having been much used or being still in use.
>> Implemented in https://github.com/OSGeo/gdal/pull/3373. They (driver
>> code, doc and tests) have been moved to the
>> https://github.com/OSGeo/gdal-extra-drivers
>>
>> - deprecate the raster drivers DODS, JPEG2000 (superseded per
>> JP2OpenJPEG), JPEGLS, MG4LIDAR, FUJIBAS, IDA, INGR, ZMAP and vector
>> driver ARCGEN, ArcObjects, CLOUDANT, COUCHDB, DB2, DODS, FME,
>> GEOMEDIA, GTM, INGRES, MONGODB (superserded per MongoDBV3), REC, WALK
>> . They will now be disabled at runtime by default, with an explicit
>> error message when they are triggered, unless the
>> GDAL_ENABLE_DEPRECATED_DRIVER_{drivername}
>> configuration option is set to YES, and will be removed in GDAL 3.5.
>> Implemented in https://github.com/OSGeo/gdal/pull/3505
>>
>> Starting with my +1
>>
>> Even
>>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From Matt.Wilkie at yukon.ca  Tue Mar 22 14:08:31 2022
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Tue, 22 Mar 2022 21:08:31 +0000
Subject: [gdal-dev] GDAL Python style guide?
Message-ID: <823455b70ba442a5994b2bf05ec5ed36@yukon.ca>

Hi All,

What's the closest thing to a style guide for GDAL Python code? I found "RFC 69: C/C++ Code Formatting"[0] but haven't discovered anything for python yet. I'm wondering about preferred line length, autopep8 vs black vs ... formatting tools, variable naming patterns, etc.

[0] https://gdal.org/development/rfc/rfc69_cplusplus_formatting.html

Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca<http://yukon.ca/>
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220322/5c5fb3c3/attachment.html>

From sebastic at xs4all.nl  Tue Mar 22 14:28:16 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Tue, 22 Mar 2022 22:28:16 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <d5762557-8f34-7552-efc3-f9cdf003e841@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <4ac9a530-00be-01d8-d0f3-8a8834fffbd5@xs4all.nl>
 <d5762557-8f34-7552-efc3-f9cdf003e841@spatialys.com>
Message-ID: <c5e694c8-532e-43d1-b290-ab6f2cf7b450@xs4all.nl>

On 3/21/22 19:14, Even Rouault wrote:
> Other things you spotted ?

There doesn't seem to be an equivalent for the install-man target, there 
is no CMakeLists.txt in man/man1 nor is that directory included in 
gdal.cmake.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From jluis at ualg.pt  Tue Mar 22 15:25:21 2022
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Tue, 22 Mar 2022 22:25:21 +0000
Subject: [gdal-dev] Motion (V2): remove and deprecate a few drivers
In-Reply-To: <5e1a6b2b-5051-7728-9e29-1eddc5ec2963@spatialys.com>
References: <fa89453f-1e2b-2f68-85a1-0b40f50a83e0@spatialys.com>
 <5c2eebb8-a874-891a-4257-64f0751a2bf0@spatialys.com>
 <AM6PR04MB3959EC331ED083A5C24E7881A6179@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <5e1a6b2b-5051-7728-9e29-1eddc5ec2963@spatialys.com>
Message-ID: <AM6PR04MB395997C4B2B4E2C3D667F632A6179@AM6PR04MB3959.eurprd04.prod.outlook.com>

Damn it. Can't tell a GTM from a GMT. Sorry. 

-----Original Message-----
From: Even Rouault <even.rouault at spatialys.com> 
Sent: Tuesday, March 22, 2022 8:08 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Motion (V2): remove and deprecate a few drivers


Le 22/03/2022 ? 20:23, Joaquim Manuel Freire Lu?s a ?crit?:
> Even,
>
> Please the vector GMT driver is not to be removed
It is not. The commit you refer to removes the GTM (GPS Track Maker) driver.
>
> https://github.com/OSGeo/gdal/pull/5269/commits/f89bccc10e00ef57312165
> f5ee11f5ee1f1dddc3
>
> it's very much used in GMT. We talked about this before (sorry didn't keep references of it).
> What is to be deprecated is the old netCDF GMT grid format, but not 
> the vector one
I'm in line with that.
> (whose implementation was paid for).
I assume most GDAL drivers, including those in that batch of removal, have been paid for at some point. That's not a criterion by itself to keep them 15 years after if no one is willing to keep up with their overhead and can justify they are still relevant.
>
> Cheers
>
> Joaquim
>
> -----Original Message-----
> From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Even 
> Rouault
> Sent: Tuesday, March 22, 2022 6:58 PM
> To: gdal-dev at lists.osgeo.org
> Subject: Re: [gdal-dev] Motion (V2): remove and deprecate a few 
> drivers
>
> Hi,
>
> I'd appreciate if I could get some approval of
> https://github.com/OSGeo/gdal/pull/5269 (it'll need some trivial adjustment to be applied due to conflicts) that implements the below decision (for some reason people tend to be more generous in adding emojis to pull requests that add new features than ones that remove code).
>
> The removal of the OpenDAP/DODS drivers is not included in that PR since there was apparently some interest in it https://github.com/OSGeo/gdal/issues/5173, but that failed to materialize with concrete elements to be able to support them, so I believe they will ultimately go to the rm -rf road too.
>
> Even
>
> Le 04/03/2021 ? 17:32, Even Rouault a ?crit?:
>> Hi,
>>
>> Updating my yesterday motion with the feedback received (only second 
>> bullet updated with a more restricted set of drivers)
>>
>> Motion:
>>
>> - remove the vector drivers BNA, AeronavFAA, HTF, OpenAir, SEGUKOOA, 
>> SEGY, SUA, XPlane and raster drivers BPG, E00GRID, EPSILON, 
>> IGNFHeightASCIIGrid, NTv1. They have all been authored by myself and 
>> I'm not aware of them having been much used or being still in use.
>> Implemented in https://github.com/OSGeo/gdal/pull/3373. They (driver 
>> code, doc and tests) have been moved to the 
>> https://github.com/OSGeo/gdal-extra-drivers
>>
>> - deprecate the raster drivers DODS, JPEG2000 (superseded per 
>> JP2OpenJPEG), JPEGLS, MG4LIDAR, FUJIBAS, IDA, INGR, ZMAP and vector 
>> driver ARCGEN, ArcObjects, CLOUDANT, COUCHDB, DB2, DODS, FME, 
>> GEOMEDIA, GTM, INGRES, MONGODB (superserded per MongoDBV3), REC, WALK 
>> . They will now be disabled at runtime by default, with an explicit 
>> error message when they are triggered, unless the 
>> GDAL_ENABLE_DEPRECATED_DRIVER_{drivername}
>> configuration option is set to YES, and will be removed in GDAL 3.5.
>> Implemented in https://github.com/OSGeo/gdal/pull/3505
>>
>> Starting with my +1
>>
>> Even
>>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

--
http://www.spatialys.com
My software is free, but my time generally not.


From jtang at nltinc.com.au  Tue Mar 22 17:30:52 2022
From: jtang at nltinc.com.au (Jacky Tang)
Date: Wed, 23 Mar 2022 10:30:52 +1000
Subject: [gdal-dev] OGR Style is null for Geometry Collections
Message-ID: <CAH-gBrcyj6ehf4PBVFqAVj+o+qbdR1p1-tbJo_2xW+w-Yf9zuA@mail.gmail.com>

Jacky Tang <jtang at nltinc.com.au>
08:29 (2 hours ago)
to gdal-dev
Hello,

I am having some issues retrieving the OGR style with ogr2ogr for geometry
collections, as it returns null and the geometries themselves do not
include OGR style. Any assistance would be greatly appreciated!

ogr2ogr
  -f geojson
  -s_srs "EPSG:2000"
  -t_srs "EPSG:4326"
  -dialect sqlite -sql "select layer, geometry, ogr_style from entities"
  -lco RFC7946=YES
  -skipfailures
  "map.geojson"
  "map.dwg"

I have also tried `select *, ogr_style` with no luck either.

Example output GeometryCollection:
{
    "type": "Feature",
    "properties": {
        "Layer": "1",
        "OGR_STYLE": null
    },
    "geometry": {
        "type": "GeometryCollection",
        "geometries": [
            {
                "type": "LineString",
                "coordinates": [
                    [
                        -55.9868404,
                        67.0981691,
                        167.342
                    ],
                    [
                        -55.986836,
                        67.0981869,
                        167.342
                    ]
                ]
            },
            {
                "type": "LineString",
                "coordinates": [
                    [
                        -55.9868611,
                        67.0981788,
                        167.342
                    ],
                    [
                        -55.9868153,
                        67.0981771,
                        167.342
                    ]
                ]
            }
        ]
    }
}


Thanks!

Kindest Regards,
Jacky
Software Engineer
NLT Digital
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220323/6d4426ab/attachment.html>

From Matt.Wilkie at yukon.ca  Wed Mar 23 09:51:37 2022
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Wed, 23 Mar 2022 16:51:37 +0000
Subject: [gdal-dev] Guidelines for optimal image dimensions
Message-ID: <1e85a2879e794f9d800be2dc0d97db59@yukon.ca>

Does anyone have guidelines of what the general purpose optimal image dimensions in pixels are for any given type? (3 band 8bit RGB, 1 band 16bit signed, ...)

At some point the time it takes to do anything in memory on a whole image exceeds the time it takes to read the next chunk from storage and repeat. I'm curious how to figure out what the point of diminishing returns is. The quest behind the question is determining a good default tile size for our image repository.

There's a hundred variables that's going to make it a different answer for every organization, and that it will change over time as hardware and software changes. My hunch is there's a close enough approximation that works for most situations much of the time.  Before I embark on  series of trials to figure out what our local optimum is I figured I'd ask and see what other work in this area there might be.

Your thoughts?
Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca<http://yukon.ca/>
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220323/280d63ef/attachment-0001.html>

From felipematas at yahoo.com  Wed Mar 23 11:18:52 2022
From: felipematas at yahoo.com (Felipe Matas)
Date: Wed, 23 Mar 2022 18:18:52 +0000 (UTC)
Subject: [gdal-dev] Connect ogr2ogr without socket
References: <1593303032.1172963.1648059532365.ref@mail.yahoo.com>
Message-ID: <1593303032.1172963.1648059532365@mail.yahoo.com>

Hi, I'm testing a new db that is dolt, is like git in db, literally, but that db does not support connection through socket, but the db is mysql, or like a simulation of it, I'm trying this to check the connection:
ogrinfo MySQL:"host=127.0.0.1 port=3306 user='root' password='' dbname='test'"

I try several syntax too, and the answer from the ogrinfo was similar to:

ERROR 1: MySQL connect failed for: host=127.0.0.1;port=3306;user='root';password=XXXXXXXXXXXXXXXXXXXXXXX connect to local MySQL server through socket '/run/mysqld/mysqld.sock' (2)
ERROR 1: MySQL connect failed for: host=127.0.0.1;port=3306;user='root';password=XXXXXXXXXXXXXXXXXXXXXXX connect to local MySQL server through socket '/run/mysqld/mysqld.sock' (2)
FAILURE:
Unable to open datasource `MySQL:host=127.0.0.1;port=3306;user='root';password='';dbname='water'' with the following drivers.
(here the very long list of drivers, MySQL is in the list.
ogr is trying to connect from a socket, and the db does not support it, the connection need to be TCP, how can I force the ogr to use TCP? (not just for local, for remote servers too, and ogr2ogr too)

Thx.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220323/f753bdd6/attachment.html>

From felipematas at yahoo.com  Wed Mar 23 12:36:09 2022
From: felipematas at yahoo.com (Felipe Matas)
Date: Wed, 23 Mar 2022 19:36:09 +0000 (UTC)
Subject: [gdal-dev] Connect ogr2ogr without socket
In-Reply-To: <1593303032.1172963.1648059532365@mail.yahoo.com>
References: <1593303032.1172963.1648059532365.ref@mail.yahoo.com>
 <1593303032.1172963.1648059532365@mail.yahoo.com>
Message-ID: <1542368620.1193069.1648064169259@mail.yahoo.com>

 Well, I was using bad the syntax, and if instead of localhost I use the numbers, works, at least half of it.., I'll check this more instead ask here first, to confirm here where to ask.
Thx :)
   El mi?rcoles, 23 de marzo de 2022, 03:21:06 p.?m. GMT-3, Felipe Matas via gdal-dev <gdal-dev at lists.osgeo.org> escribi?:  
 
 Hi, I'm testing a new db that is dolt, is like git in db, literally, but that db does not support connection through socket, but the db is mysql, or like a simulation of it, I'm trying this to check the connection:
ogrinfo MySQL:"host=127.0.0.1 port=3306 user='root' password='' dbname='test'"

I try several syntax too, and the answer from the ogrinfo was similar to:

ERROR 1: MySQL connect failed for: host=127.0.0.1;port=3306;user='root';password=XXXXXXXXXXXXXXXXXXXXXXX connect to local MySQL server through socket '/run/mysqld/mysqld.sock' (2)
ERROR 1: MySQL connect failed for: host=127.0.0.1;port=3306;user='root';password=XXXXXXXXXXXXXXXXXXXXXXX connect to local MySQL server through socket '/run/mysqld/mysqld.sock' (2)
FAILURE:
Unable to open datasource `MySQL:host=127.0.0.1;port=3306;user='root';password='';dbname='water'' with the following drivers.
(here the very long list of drivers, MySQL is in the list.
ogr is trying to connect from a socket, and the db does not support it, the connection need to be TCP, how can I force the ogr to use TCP? (not just for local, for remote servers too, and ogr2ogr too)

Thx.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev
  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220323/b8be6a02/attachment.html>

From sriddell at geocue.com  Wed Mar 23 15:42:05 2022
From: sriddell at geocue.com (Steve Riddell)
Date: Wed, 23 Mar 2022 22:42:05 +0000
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
 <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
Message-ID: <CY4PR01MB2406A2CE96E342DD7E5D795FA6189@CY4PR01MB2406.prod.exchangelabs.com>

Hi Even,

I tried the fix with the CRS?s I sent, and it worked. But as I mentioned, my real target CRS is a custom projected system (below), and it still fails with what seems to be the same error as in my original email.

COMPD_CS["TempTM + CGVD28 height - HT2_0",
    PROJCS["Custom",
        GEOGCS["NAD83(CSRS)",
            DATUM["NAD83_Canadian_Spatial_Reference_System",
                SPHEROID["GRS 1980",6378137,298.257222101,
                    AUTHORITY["EPSG","7019"]],
                TOWGS84[0,0,0,0,0,0,0],
                AUTHORITY["EPSG","6140"]],
            PRIMEM["Greenwich",0,
                AUTHORITY["EPSG","8901"]],
            UNIT["degree",0.0174532925199433,
                AUTHORITY["EPSG","9122"]],
            AUTHORITY["EPSG","4617"]],
        PROJECTION["Transverse_Mercator"],
        PARAMETER["latitude_of_origin",49.351346659616],
        PARAMETER["central_meridian",-123.20266499149],
        PARAMETER["scale_factor",1],
        PARAMETER["false_easting",15307.188],
        PARAMETER["false_northing",6540.975],
        UNIT["Meters",1],
        AXIS["Easting",EAST],
        AXIS["Northing",NORTH]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]

Experimenting, I removed the ?TOWGS84? directive from BOTH the source and target systems, and I do get an answer instead of an error:

For test point: (49.351346658, -123.202664992, 289.809)
I get: (15307.1880,6540.9748,307.744)

But since geoid separation at the test point is -18.238, Z should be 308.047.  In fact, if I code up the following pipeline and initialize a transform object:

strPipe = "+proj=pipeline\
        +step +proj=axisswap +order=2, 1\
        +step +proj=unitconvert +xy_in=deg +xy_out=rad\
        +step +inv +proj=vgridshift +grids=HT2_0.gtx +multiplier=1\
        +step +proj=tmerc +lat_0=49.351346659616 +lon_0=-123.20266499149 +k=1\
        +x_0=15307.188 +y_0=6540.975 +ellps=GRS80";

The call to Transform() gives: (15307.1880, 6540.9748, 308.042)   -- XY matches above, but now I get the expected Z (-0.005).  However, I?d like to avoid assembling pipelines for every conversion/transform.

Any arrows left in your quiver?

Thanks,
Steve



From: Steve Riddell
Sent: Friday, March 18, 2022 6:17 PM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: RE: OGRCreateCoordinateTransformation()

Thanks very much, Even.  For reporting the problem, I ?packaged up? a case with CRS?s with EPGS codes. For the actual problem I?m working, the target CRS is a custom projection ?no EPSG.

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Friday, March 18, 2022 5:05 PM
To: Steve Riddell <sriddell at geocue.com<mailto:sriddell at geocue.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: OGRCreateCoordinateTransformation()


Steve,

Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123

The complexity of dealing with legacy features TOWGS84[] and PROJ4_GRIDS is highly stressing PROJ pipeline computation engine.

Using the plain EPSG codes  EPSG:4955 -> EPSG:4617+5713 would be much preferable here

Even
Le 18/03/2022 ? 21:14, Steve Riddell a ?crit :
Hi,

I?m getting an error (below) using GDAL trying to set up a transformation between NAD83(CSRS) geodetic, w/ ellipsoidal heights, and NAD83(CSRS) geodetic, CGVD28 heights. Similar transformations work fine on some datums,  but fail on others.  Hope someone can offer some insight.  Note the if I don't use the PROJ4_GRIDS extension, I don't get the error, but I don't get the geoid adjustment either.

COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["Ellipsoid (Meters)",
        VERT_DATUM["Ellipsoid",2002],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["ellipsoidal height",UP]]]

COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]


ERROR 6: Cannot find coordinate operations from `EPSG:4955' to `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height - HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83 Canadian Spatial Reference System",ELLIPSOID["GRS 1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic latitude (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic longitude (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation (geog2D domain)",ID["EPSG",9606]],PARAMETER["X-axis translation",0,ID["EPSG",8605]],PARAMETER["Y-axis translation",0,ID["EPSG",8606]],PARAMETER["Z-axis translation",0,ID["EPSG",8607]],PARAMETER["X-axis rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis rotation",0,ID["EPSG",8610]],PARAMETER["Scale difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28 height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of 1928"],CS[vertical,1],AXIS["gravity-related height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28 height - HT2_0 to WGS84 ellipsoidal height",METHOD["GravityRelatedHeight to Geographic3D"],PARAMETERFILE["Geoid (height correction) model file","HT2_0.gtx",ID["EPSG",8666]]]]]'



Thanks in advance for any assistance!

Best regards,

Steve



Steve Riddell
Software Engineering
GeoCue Group, Inc.
520 6th Street | Madison, AL 35756 USA
Phone: 256.461.8289 | Fax: 256.461.8249
LIDAR/Drone Mapping Software & Services ? True View? 3D Imaging Sensors ? Image/LIDAR Data Management Solutions
 www.geocue.com<http://www.geocue.com/>  support.geocue.com<https://support.geocue.com/>





--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220323/ead67550/attachment-0001.html>

From even.rouault at spatialys.com  Wed Mar 23 16:06:21 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Mar 2022 00:06:21 +0100
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <CY4PR01MB2406A2CE96E342DD7E5D795FA6189@CY4PR01MB2406.prod.exchangelabs.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
 <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <CY4PR01MB2406A2CE96E342DD7E5D795FA6189@CY4PR01MB2406.prod.exchangelabs.com>
Message-ID: <69912c61-97a2-c404-9280-2ed71298af37@spatialys.com>

Steve,

you may try PR https://github.com/OSGeo/PROJ/pull/3126 or 
https://github.com/OSGeo/PROJ/pull/3127, that might potentially help, 
but they don't make consensus (see discussions of those PRs). Basically 
it is a nightmare to deal with the old TOWGS84 / PROJ4_GRIDS approach, 
that poorly specifies some elements of transformations (especially the 
vertical part), and doesn't fit well in the ISO-19111 model used by 
newer PROJ (we use and abuse the BoundCRS approach in complex ways). One 
of the issue too is that we've realized late in the process that we 
didn't emulate some aspects of the old transformation pipeline, and 
there isn't general enthusiasm to change that now.

Even

Le 23/03/2022 ? 23:42, Steve Riddell a ?crit?:
>
> Hi Even,
>
> I tried the fix with the CRS?s I sent, and it worked. But as I 
> mentioned, my real target CRS is a custom projected system (below), 
> and it still fails with what seems to be the same error as in my 
> original email.
>
> COMPD_CS["TempTM + CGVD28 height - HT2_0",
>
> ??? PROJCS["Custom",
>
> ??????? GEOGCS["NAD83(CSRS)",
>
> DATUM["NAD83_Canadian_Spatial_Reference_System",
>
> ??????????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
> AUTHORITY["EPSG","7019"]],
>
> ??????????????? TOWGS84[0,0,0,0,0,0,0],
>
> ??????????????? AUTHORITY["EPSG","6140"]],
>
> ??????????? PRIMEM["Greenwich",0,
>
> ??????????????? AUTHORITY["EPSG","8901"]],
>
> UNIT["degree",0.0174532925199433,
>
> ??????????????? AUTHORITY["EPSG","9122"]],
>
> ??????????? AUTHORITY["EPSG","4617"]],
>
> ??????? PROJECTION["Transverse_Mercator"],
>
> PARAMETER["latitude_of_origin",49.351346659616],
>
> PARAMETER["central_meridian",-123.20266499149],
>
> ??????? PARAMETER["scale_factor",1],
>
> PARAMETER["false_easting",15307.188],
>
> PARAMETER["false_northing",6540.975],
>
> ??????? UNIT["Meters",1],
>
> ??????? AXIS["Easting",EAST],
>
> ??????? AXIS["Northing",NORTH]],
>
> ??? VERT_CS["CGVD28 height - HT2_0",
>
> ??????? VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
>
> EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
>
> ??????????? AUTHORITY["EPSG","5114"]],
>
> ??????? UNIT["metre",1,
>
> ??????????? AUTHORITY["EPSG","9001"]],
>
> ??????? AXIS["Gravity-related height",UP],
>
> ??????? AUTHORITY["EPSG","5713"]]]
>
> Experimenting, I removed the ?TOWGS84? directive from BOTH the source 
> and target systems, and I do get an answer instead of an error:
>
> For test point: (49.351346658, -123.202664992, 289.809)
>
> I get: (15307.1880,6540.9748,307.744)
>
> But since geoid separation at the test point is -18.238, Z should be 
> 308.047.? In fact, if I code up the following pipeline and initialize 
> a transform object:
>
> strPipe ="+proj=pipeline\
>
> ??????? +step +proj=axisswap +order=2, 1\
>
> ??????? +step +proj=unitconvert +xy_in=deg +xy_out=rad\
>
> ??????? +step +inv +proj=vgridshift +grids=HT2_0.gtx +multiplier=1\
>
> ??????? +step +proj=tmerc +lat_0=49.351346659616 
> +lon_0=-123.20266499149 +k=1\
>
> ??????? +x_0=15307.188 +y_0=6540.975 +ellps=GRS80";
>
> The call to Transform() gives: (15307.1880, 6540.9748, 308.042)?? -- 
> XY matches above, but now I get the expected Z (-0.005). ?However, I?d 
> like to avoid assembling pipelines for every conversion/transform.
>
> Any arrows left in your quiver?
>
> Thanks,
>
> Steve
>
> *From:* Steve Riddell
> *Sent:* Friday, March 18, 2022 6:17 PM
> *To:* Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> *Subject:* RE: OGRCreateCoordinateTransformation()
>
> Thanks very much, Even.? For reporting the problem, I ?packaged up? a 
> case with CRS?s with EPGS codes. For the actual problem I?m working, 
> the target CRS is a custom projection ?no EPSG.
>
> *From:* Even Rouault <even.rouault at spatialys.com>
> *Sent:* Friday, March 18, 2022 5:05 PM
> *To:* Steve Riddell <sriddell at geocue.com>; gdal-dev at lists.osgeo.org
> *Subject:* Re: OGRCreateCoordinateTransformation()
>
> Steve,
>
> Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123
>
> The complexity of dealing with legacy features TOWGS84[] and 
> PROJ4_GRIDS is highly stressing PROJ pipeline computation engine.
>
> Using the plain EPSG codes? EPSG:4955 -> EPSG:4617+5713 would be much 
> preferable here
>
> Even
>
> Le 18/03/2022 ? 21:14, Steve Riddell a ?crit?:
>
>     Hi,
>
>     I?m getting an error (below) using GDAL trying to set up a
>     transformation between NAD83(CSRS) geodetic, w/ ellipsoidal
>     heights, and NAD83(CSRS) geodetic, CGVD28 heights. Similar
>     transformations work fine on some datums,? but fail on others.
>     ?Hope someone can offer some insight.? Note the if I don't use the
>     PROJ4_GRIDS extension, I don't get the error, but I don't get the
>     geoid adjustment either.
>
>     COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
>
>     ??? GEOGCS["NAD83(CSRS)",
>
>     DATUM["NAD83_Canadian_Spatial_Reference_System",
>
>     ??????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
>     AUTHORITY["EPSG","7019"]],
>
>     ??????????? TOWGS84[0,0,0,0,0,0,0],
>
>     ??????????? AUTHORITY["EPSG","6140"]],
>
>     ??????? PRIMEM["Greenwich",0,
>
>     ??????????? AUTHORITY["EPSG","8901"]],
>
>     ??????? UNIT["degree",0.0174532925199433,
>
>     ??????????? AUTHORITY["EPSG","9122"]],
>
>     ??????? AUTHORITY["EPSG","4617"]],
>
>     ??? VERT_CS["Ellipsoid (Meters)",
>
>     ??????? VERT_DATUM["Ellipsoid",2002],
>
>     ??????? UNIT["metre",1,
>
>     ??????????? AUTHORITY["EPSG","9001"]],
>
>     ??????? AXIS["ellipsoidal height",UP]]]
>
>     COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
>
>     ??? GEOGCS["NAD83(CSRS)",
>
>     DATUM["NAD83_Canadian_Spatial_Reference_System",
>
>     ??????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
>     AUTHORITY["EPSG","7019"]],
>
>     ??????????? TOWGS84[0,0,0,0,0,0,0],
>
>     ??????????? AUTHORITY["EPSG","6140"]],
>
>     ??????? PRIMEM["Greenwich",0,
>
>     ??????????? AUTHORITY["EPSG","8901"]],
>
>     ??????? UNIT["degree",0.0174532925199433,
>
>     ??????????? AUTHORITY["EPSG","9122"]],
>
>     ??????? AUTHORITY["EPSG","4617"]],
>
>     ??? VERT_CS["CGVD28 height - HT2_0",
>
>     ??????? VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
>
>     EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
>
>     ??????????? AUTHORITY["EPSG","5114"]],
>
>     ??????? UNIT["metre",1,
>
>     ??????????? AUTHORITY["EPSG","9001"]],
>
>     ??????? AXIS["Gravity-related height",UP],
>
>     ??????? AUTHORITY["EPSG","5713"]]]
>
>     ERROR 6: Cannot find coordinate operations from `EPSG:4955' to
>     `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height -
>     HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83
>     Canadian Spatial Reference System",ELLIPSOID["GRS
>     1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic
>     latitude
>     (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic
>     longitude
>     (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS
>     84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS
>     84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation
>     from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation
>     (geog2D domain)",ID["EPSG",9606]],PARAMETER["X-axis
>     translation",0,ID["EPSG",8605]],PARAMETER["Y-axis
>     translation",0,ID["EPSG",8606]],PARAMETER["Z-axis
>     translation",0,ID["EPSG",8607]],PARAMETER["X-axis
>     rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis
>     rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis
>     rotation",0,ID["EPSG",8610]],PARAMETER["Scale
>     difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28
>     height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of
>     1928"],CS[vertical,1],AXIS["gravity-related
>     height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS
>     84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS
>     84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal
>     height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28
>     height - HT2_0 to WGS84 ellipsoidal
>     height",METHOD["GravityRelatedHeight to
>     Geographic3D"],PARAMETERFILE["Geoid (height correction) model
>     file","HT2_0.gtx",ID["EPSG",8666]]]]]'
>
>       
>
>     Thanks in advance for any assistance!
>
>     Best regards,
>
>     Steve
>
>     Steve Riddell
>
>     Software Engineering
>
>     *GeoCue Group, Inc.*
>
>     520 6th Street | Madison, AL 35756 USA
>
>     *Phone:*256.461.8289 | *Fax:* 256.461.8249
>
>     /LIDAR/Drone Mapping Software & Services //? True View? 3D Imaging
>     Sensors //?Image/LIDAR Data Management Solutions/
>
>     www.geocue.com <http://www.geocue.com/>support.geocue.com
>     <https://support.geocue.com/>
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/a47b70c8/attachment-0001.html>

From manisandro at gmail.com  Thu Mar 24 04:05:06 2022
From: manisandro at gmail.com (Sandro Mani)
Date: Thu, 24 Mar 2022 12:05:06 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
Message-ID: <2bcd0b00-bfe3-542d-72e9-d23aac89133d@gmail.com>


On 21.03.22 00:05, Even Rouault wrote:
> Hi,
>
> As discussed a few weeks ago, here's a GDAL 3.5.0alpha1 snapshot, 
> mostly for the sake of exercising the new CMake build system (thanks 
> to all early testers and contributors!). The libtool numbers have 
> *not* been updated (I believe they are still the same as the 3.3.0 
> release). This is not meant as being pushed to any distribution 
> channel yet.
>
I gave it a spin for Fedora:

- Does not build against JasPer-3.0.2: there are two signature mismatches:

-static int JPEG2000_VSIL_read(jas_stream_obj_t *obj, char *buf, 
unsigned cnt)
+static ssize_t JPEG2000_VSIL_read(jas_stream_obj_t *obj, char *buf, 
size_t cnt)

-static int JPEG2000_VSIL_write(jas_stream_obj_t *obj, const char *buf, 
unsigned int cnt)
+static ssize_t JPEG2000_VSIL_write(jas_stream_obj_t *obj, const char 
*buf, size_t cnt)

Plus reliance on jasper symbols which are not exported by default by 
JasPer: jp2_encode, jp2_box_destroy, jp2_box_get

- lib/gdalplugins shuold honour LIB_SUFFIX:

 ?? set(INSTALL_PLUGIN_DIR
-????? "lib/gdalplugins"
+????? "lib${LIB_SUFFIX}/gdalplugins"
 ?????? CACHE PATH "Installation sub-directory for plugins")

- I wasn't able to figure out how to build the docs? cmake 
-DBUILD_DOCS=On works so far as cmake configuration succeeds. Then make 
documentation fails with missing br/ru localized files, and commenting 
those targets out there seems to be a mismatch between the footer name 
(gdal_footer.html vs footer.html?)


Sandro


From even.rouault at spatialys.com  Thu Mar 24 04:23:02 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Mar 2022 12:23:02 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <2bcd0b00-bfe3-542d-72e9-d23aac89133d@gmail.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <2bcd0b00-bfe3-542d-72e9-d23aac89133d@gmail.com>
Message-ID: <5b44fd56-8fbb-9385-d6ed-785549110aac@spatialys.com>

Hi Sandro,

I gave it a spin for Fedora:
>
> - Does not build against JasPer-3.0.2: there are two signature 
> mismatches:
>
Jasper support will be dropped soon (see 
https://github.com/OSGeo/gdal/pull/5269). You should rather use the 
JP2OpenJPEG driver using libopenjp2 from 
https://github.com/uclouvain/openjpeg/. You can for now disable Jasper 
detection? with -DGDAL_USE_JASPER=OFF
>
> - lib/gdalplugins shuold honour LIB_SUFFIX:
>
queued in https://github.com/OSGeo/gdal/pull/5501
>
> - I wasn't able to figure out how to build the docs? cmake 
> -DBUILD_DOCS=On works so far as cmake configuration succeeds. Then 
> make documentation fails with missing br/ru localized files, and 
> commenting those targets out there seems to be a mismatch between the 
> footer name (gdal_footer.html vs footer.html?)

Yes I noticed that too a few days ago : 
https://github.com/OSGeo/gdal/issues/5484 .? The doc for now is to be 
built manually with "make html" / "make man" from the doc subdirectory. 
But since the switch of the doc from static HTML pages (I suspect the 
doc/CMakeLists.txt originally dates back to that era) to Sphinx a few 
years ago, we no longer delivered the doc/ in tarballs (only the 
generated man pages were). They got re-included in alpha1 a bit by 
accident (since the move of the content of the gdal/ directory to the 
top level directory, and the mkgdaldist.sh script not taking that yet 
fully into account).

I'm not sure what to do with docs:

- do like we did in recent versions, ie have no doc/ directory in the 
tarball, and just generated man pages (will need 
https://github.com/OSGeo/gdal/issues/5491 to be implemented to 
automatically have CMake to install the generated man pages)

- or ship doc/ in tarballs, and thus make sphinx-build and other related 
Python packages 
(https://github.com/OSGeo/gdal/blob/master/doc/requirements.txt) a 
requirement to build the HTML, PDF and man pages (I know this isn't 
popular for some packagers).

- variant of the above: ship doc/ in tarballs, with the addition of 
pre-generated man pages. That way, only people that want the HTML & PDF 
doc really need to go through sphinx-build.

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sebastic at xs4all.nl  Thu Mar 24 04:28:40 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Thu, 24 Mar 2022 12:28:40 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <5b44fd56-8fbb-9385-d6ed-785549110aac@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <2bcd0b00-bfe3-542d-72e9-d23aac89133d@gmail.com>
 <5b44fd56-8fbb-9385-d6ed-785549110aac@spatialys.com>
Message-ID: <4dac22a1-9019-d592-7bc3-0aea5623aa06@xs4all.nl>

On 3/24/22 12:23, Even Rouault wrote:
> - do like we did in recent versions, ie have no doc/ directory in the 
> tarball, and just generated man pages (will need 
> https://github.com/OSGeo/gdal/issues/5491 to be implemented to 
> automatically have CMake to install the generated man pages)

This has my preference, the Debian package strips the doc directory from 
the upstream tarball (since 3.1.0~rc1) because license & copyright 
review was a PITA.

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From manisandro at gmail.com  Thu Mar 24 05:16:11 2022
From: manisandro at gmail.com (Sandro Mani)
Date: Thu, 24 Mar 2022 13:16:11 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <5b44fd56-8fbb-9385-d6ed-785549110aac@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <2bcd0b00-bfe3-542d-72e9-d23aac89133d@gmail.com>
 <5b44fd56-8fbb-9385-d6ed-785549110aac@spatialys.com>
Message-ID: <fbdc6ee7-eb72-146a-f329-0e2ff702266d@gmail.com>


On 24.03.22 12:23, Even Rouault wrote:
>>
>> - I wasn't able to figure out how to build the docs? cmake 
>> -DBUILD_DOCS=On works so far as cmake configuration succeeds. Then 
>> make documentation fails with missing br/ru localized files, and 
>> commenting those targets out there seems to be a mismatch between the 
>> footer name (gdal_footer.html vs footer.html?)
>
> Yes I noticed that too a few days ago : 
> https://github.com/OSGeo/gdal/issues/5484 .? The doc for now is to be 
> built manually with "make html" / "make man" from the doc 
> subdirectory. But since the switch of the doc from static HTML pages 
> (I suspect the doc/CMakeLists.txt originally dates back to that era) 
> to Sphinx a few years ago, we no longer delivered the doc/ in tarballs 
> (only the generated man pages were). They got re-included in alpha1 a 
> bit by accident (since the move of the content of the gdal/ directory 
> to the top level directory, and the mkgdaldist.sh script not taking 
> that yet fully into account).
>
> I'm not sure what to do with docs:
>
> - do like we did in recent versions, ie have no doc/ directory in the 
> tarball, and just generated man pages (will need 
> https://github.com/OSGeo/gdal/issues/5491 to be implemented to 
> automatically have CMake to install the generated man pages)
>
> - or ship doc/ in tarballs, and thus make sphinx-build and other 
> related Python packages 
> (https://github.com/OSGeo/gdal/blob/master/doc/requirements.txt) a 
> requirement to build the HTML, PDF and man pages (I know this isn't 
> popular for some packagers).
>
> - variant of the above: ship doc/ in tarballs, with the addition of 
> pre-generated man pages. That way, only people that want the HTML & 
> PDF doc really need to go through sphinx-build.
>
I'd for for either the first or third option.


Thanks
Sandro


From lars.fricke at skendata.de  Thu Mar 24 05:53:14 2022
From: lars.fricke at skendata.de (Lars Fricke)
Date: Thu, 24 Mar 2022 13:53:14 +0100
Subject: [gdal-dev] ogr wfs not forwarding bbox
Message-ID: <b010a5af-1a7e-39fa-3da0-e33a66b6e02e@skendata.de>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/629bac5e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OpenPGP_0x667E0B7B73E250FB.asc
Type: application/pgp-keys
Size: 2460 bytes
Desc: OpenPGP public key
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/629bac5e/attachment-0001.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OpenPGP_signature
Type: application/pgp-signature
Size: 665 bytes
Desc: OpenPGP digital signature
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/629bac5e/attachment-0001.sig>

From sebastic at xs4all.nl  Thu Mar 24 05:56:37 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Thu, 24 Mar 2022 13:56:37 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
Message-ID: <5ad41b6c-d096-53cd-6d0a-6b2f7cd73710@xs4all.nl>

How will the gdal-grass tarball be generated?

Will frmts/grass/GNUmakefile remain with only the dist target, e.g. like 
attached patch?

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
-------------- next part --------------
A non-text attachment was scrubbed...
Name: grass.patch
Type: text/x-patch
Size: 597 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/11108f91/attachment.bin>

From even.rouault at spatialys.com  Thu Mar 24 06:46:20 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Mar 2022 14:46:20 +0100
Subject: [gdal-dev] GDAL 3.5.0alpha1 available
In-Reply-To: <5ad41b6c-d096-53cd-6d0a-6b2f7cd73710@xs4all.nl>
References: <12e237f4-e56d-fde8-5739-19f05a32abd7@spatialys.com>
 <5ad41b6c-d096-53cd-6d0a-6b2f7cd73710@xs4all.nl>
Message-ID: <e53919f2-c1f8-c053-e1b6-a08092073100@spatialys.com>

Bas,

given that autoconf support for GDAL will remain in 3.5.0, we can keep 
things unchanged for now in frmts/grass/GNUmakefile if the driver 
remains in-tree. Once autoconf support for GDAL is gone, indeed the 
simplification of your patch could be done.

But the status of last discussions is that the GRASS drivers will 
probably be moved in their own repository before 3.5.0.

Even

Le 24/03/2022 ? 13:56, Sebastiaan Couwenberg a ?crit?:
> How will the gdal-grass tarball be generated?
>
> Will frmts/grass/GNUmakefile remain with only the dist target, e.g. 
> like attached patch?
>
> Kind Regards,
>
> Bas
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sean.gillies at gmail.com  Thu Mar 24 07:28:58 2022
From: sean.gillies at gmail.com (Sean Gillies)
Date: Thu, 24 Mar 2022 08:28:58 -0600
Subject: [gdal-dev] RFC for the new cloud credentials framework in PR 5463
 and 5390?
Message-ID: <CAOodmJpid+3qSNLkFOOwnzawLtSVOwvWEvqSnQE4sC9Eth8sUw@mail.gmail.com>

Hi all,

The intent and scope of the features developed in
https://github.com/OSGeo/gdal/pull/5463 and
https://github.com/OSGeo/gdal/pull/5390 seem rather big and unclear to me.
This seems to me to warrant an RFC. Yes? No?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/6d454aa4/attachment.html>

From even.rouault at spatialys.com  Thu Mar 24 07:45:48 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Mar 2022 15:45:48 +0100
Subject: [gdal-dev] RFC for the new cloud credentials framework in PR
 5463 and 5390?
In-Reply-To: <CAOodmJpid+3qSNLkFOOwnzawLtSVOwvWEvqSnQE4sC9Eth8sUw@mail.gmail.com>
References: <CAOodmJpid+3qSNLkFOOwnzawLtSVOwvWEvqSnQE4sC9Eth8sUw@mail.gmail.com>
Message-ID: <d9fa3258-3b58-7994-fe0d-b7046dcd9058@spatialys.com>

Sean,

I saw them as business-as-usual enhancements not impacting the software 
in fundamental ways. I'm not sure what I would put in a RFC that is not 
in their commit message. Maybe I don't understand what your concern is.

Even

Le 24/03/2022 ? 15:28, Sean Gillies a ?crit?:
> Hi all,
>
> The intent and scope of the features developed in 
> https://github.com/OSGeo/gdal/pull/5463 and 
> https://github.com/OSGeo/gdal/pull/5390 seem rather big and unclear to 
> me. This seems to me to warrant an RFC. Yes? No?
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/9cdd01be/attachment.html>

From sean.gillies at gmail.com  Thu Mar 24 08:12:05 2022
From: sean.gillies at gmail.com (Sean Gillies)
Date: Thu, 24 Mar 2022 09:12:05 -0600
Subject: [gdal-dev] RFC for the new cloud credentials framework in PR
 5463 and 5390?
In-Reply-To: <d9fa3258-3b58-7994-fe0d-b7046dcd9058@spatialys.com>
References: <CAOodmJpid+3qSNLkFOOwnzawLtSVOwvWEvqSnQE4sC9Eth8sUw@mail.gmail.com>
 <d9fa3258-3b58-7994-fe0d-b7046dcd9058@spatialys.com>
Message-ID: <CAOodmJqe7PXjC7tOGFmVCoRwhSE9gAQ+bdeu492MP+gD5DF5OQ@mail.gmail.com>

Even,

At the very least, the new file duplicates storage of credentials that may
already be stored in cloud-specific credentials files, and creates a new
way for users to expose their secrets. Also, cloud providers and
organizations have moved or are moving to focusing on short-lived
credentials, SSO, etc. How useful is a cross-cloud credentials file if it
supports only static credentials? Why not support named profiles already
defined in cloud-specific files? Python and C++ programmers haven't needed
this framework because they can maintain their own maps of credentials or
roles to resources, so I guess this feature is mainly for command line
users? Do command line users do this kind of thing enough to warrant a new
framework?

On Thu, Mar 24, 2022 at 8:45 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Sean,
>
> I saw them as business-as-usual enhancements not impacting the software in
> fundamental ways. I'm not sure what I would put in a RFC that is not in
> their commit message. Maybe I don't understand what your concern is.
>
> Even
> Le 24/03/2022 ? 15:28, Sean Gillies a ?crit :
>
> Hi all,
>
> The intent and scope of the features developed in
> https://github.com/OSGeo/gdal/pull/5463 and
> https://github.com/OSGeo/gdal/pull/5390 seem rather big and unclear to
> me. This seems to me to warrant an RFC. Yes? No?
>
>
-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/e7f1a5ba/attachment.html>

From sriddell at geocue.com  Thu Mar 24 08:28:05 2022
From: sriddell at geocue.com (Steve Riddell)
Date: Thu, 24 Mar 2022 15:28:05 +0000
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <69912c61-97a2-c404-9280-2ed71298af37@spatialys.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
 <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <CY4PR01MB2406A2CE96E342DD7E5D795FA6189@CY4PR01MB2406.prod.exchangelabs.com>
 <69912c61-97a2-c404-9280-2ed71298af37@spatialys.com>
Message-ID: <BN6PR01MB2404D77116699E1C7F55B982A6199@BN6PR01MB2404.prod.exchangelabs.com>

Hi Even,

Does the fact that there isn?t a consensus mean 3126 & 3127 aren?t going to end up in a PROJ release?

I read through the PR?s. Are you thinking my issue is that a vertical shift is being introduced because of a transformation to WGS84 (from NAD83(CSRS)) to look up the geoid separation value?

PROJ4_GRIDS provided a way to specify exactly which geoid file(s) to use.  Some vertical datums, such as NAVD88, only have a single EPSG code for multiple geoids ? what?s the replacement for PROJ4_GRIDS in PROJ9?  If I could switch to WKT2 strings (not sure that?s really feasible) does it fix these problems?

Thanks,
steve

From: Even Rouault <even.rouault at spatialys.com>
Sent: Wednesday, March 23, 2022 6:06 PM
To: Steve Riddell <sriddell at geocue.com>; gdal-dev at lists.osgeo.org
Subject: Re: OGRCreateCoordinateTransformation()


Steve,

you may try PR https://github.com/OSGeo/PROJ/pull/3126 or https://github.com/OSGeo/PROJ/pull/3127, that might potentially help, but they don't make consensus (see discussions of those PRs). Basically it is a nightmare to deal with the old TOWGS84 / PROJ4_GRIDS approach, that poorly specifies some elements of transformations (especially the vertical part), and doesn't fit well in the ISO-19111 model used by newer PROJ (we use and abuse the BoundCRS approach in complex ways). One of the issue too is that we've realized late in the process that we didn't emulate some aspects of the old transformation pipeline, and there isn't general enthusiasm to change that now.

Even
Le 23/03/2022 ? 23:42, Steve Riddell a ?crit :
Hi Even,

I tried the fix with the CRS?s I sent, and it worked. But as I mentioned, my real target CRS is a custom projected system (below), and it still fails with what seems to be the same error as in my original email.

COMPD_CS["TempTM + CGVD28 height - HT2_0",
    PROJCS["Custom",
        GEOGCS["NAD83(CSRS)",
            DATUM["NAD83_Canadian_Spatial_Reference_System",
                SPHEROID["GRS 1980",6378137,298.257222101,
                    AUTHORITY["EPSG","7019"]],
                TOWGS84[0,0,0,0,0,0,0],
                AUTHORITY["EPSG","6140"]],
            PRIMEM["Greenwich",0,
                AUTHORITY["EPSG","8901"]],
            UNIT["degree",0.0174532925199433,
                AUTHORITY["EPSG","9122"]],
            AUTHORITY["EPSG","4617"]],
        PROJECTION["Transverse_Mercator"],
        PARAMETER["latitude_of_origin",49.351346659616],
        PARAMETER["central_meridian",-123.20266499149],
        PARAMETER["scale_factor",1],
        PARAMETER["false_easting",15307.188],
        PARAMETER["false_northing",6540.975],
        UNIT["Meters",1],
        AXIS["Easting",EAST],
        AXIS["Northing",NORTH]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]

Experimenting, I removed the ?TOWGS84? directive from BOTH the source and target systems, and I do get an answer instead of an error:

For test point: (49.351346658, -123.202664992, 289.809)
I get: (15307.1880,6540.9748,307.744)

But since geoid separation at the test point is -18.238, Z should be 308.047.  In fact, if I code up the following pipeline and initialize a transform object:

strPipe = "+proj=pipeline\
        +step +proj=axisswap +order=2, 1\
        +step +proj=unitconvert +xy_in=deg +xy_out=rad\
        +step +inv +proj=vgridshift +grids=HT2_0.gtx +multiplier=1\
        +step +proj=tmerc +lat_0=49.351346659616 +lon_0=-123.20266499149 +k=1\
        +x_0=15307.188 +y_0=6540.975 +ellps=GRS80";

The call to Transform() gives: (15307.1880, 6540.9748, 308.042)   -- XY matches above, but now I get the expected Z (-0.005).  However, I?d like to avoid assembling pipelines for every conversion/transform.

Any arrows left in your quiver?

Thanks,
Steve



From: Steve Riddell
Sent: Friday, March 18, 2022 6:17 PM
To: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: RE: OGRCreateCoordinateTransformation()

Thanks very much, Even.  For reporting the problem, I ?packaged up? a case with CRS?s with EPGS codes. For the actual problem I?m working, the target CRS is a custom projection ?no EPSG.

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Friday, March 18, 2022 5:05 PM
To: Steve Riddell <sriddell at geocue.com<mailto:sriddell at geocue.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: OGRCreateCoordinateTransformation()


Steve,

Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123

The complexity of dealing with legacy features TOWGS84[] and PROJ4_GRIDS is highly stressing PROJ pipeline computation engine.

Using the plain EPSG codes  EPSG:4955 -> EPSG:4617+5713 would be much preferable here

Even
Le 18/03/2022 ? 21:14, Steve Riddell a ?crit :
Hi,

I?m getting an error (below) using GDAL trying to set up a transformation between NAD83(CSRS) geodetic, w/ ellipsoidal heights, and NAD83(CSRS) geodetic, CGVD28 heights. Similar transformations work fine on some datums,  but fail on others.  Hope someone can offer some insight.  Note the if I don't use the PROJ4_GRIDS extension, I don't get the error, but I don't get the geoid adjustment either.

COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["Ellipsoid (Meters)",
        VERT_DATUM["Ellipsoid",2002],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["ellipsoidal height",UP]]]

COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]


ERROR 6: Cannot find coordinate operations from `EPSG:4955' to `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height - HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83 Canadian Spatial Reference System",ELLIPSOID["GRS 1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic latitude (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic longitude (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation (geog2D domain)",ID["EPSG",9606]],PARAMETER["X-axis translation",0,ID["EPSG",8605]],PARAMETER["Y-axis translation",0,ID["EPSG",8606]],PARAMETER["Z-axis translation",0,ID["EPSG",8607]],PARAMETER["X-axis rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis rotation",0,ID["EPSG",8610]],PARAMETER["Scale difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28 height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of 1928"],CS[vertical,1],AXIS["gravity-related height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28 height - HT2_0 to WGS84 ellipsoidal height",METHOD["GravityRelatedHeight to Geographic3D"],PARAMETERFILE["Geoid (height correction) model file","HT2_0.gtx",ID["EPSG",8666]]]]]'



Thanks in advance for any assistance!

Best regards,

Steve



Steve Riddell
Software Engineering
GeoCue Group, Inc.
520 6th Street | Madison, AL 35756 USA
Phone: 256.461.8289 | Fax: 256.461.8249
LIDAR/Drone Mapping Software & Services ? True View? 3D Imaging Sensors ? Image/LIDAR Data Management Solutions
 www.geocue.com<http://www.geocue.com/>  support.geocue.com<https://support.geocue.com/>





--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/4e6efd7c/attachment-0001.html>

From even.rouault at spatialys.com  Thu Mar 24 08:28:32 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Mar 2022 16:28:32 +0100
Subject: [gdal-dev] RFC for the new cloud credentials framework in PR
 5463 and 5390?
In-Reply-To: <CAOodmJqe7PXjC7tOGFmVCoRwhSE9gAQ+bdeu492MP+gD5DF5OQ@mail.gmail.com>
References: <CAOodmJpid+3qSNLkFOOwnzawLtSVOwvWEvqSnQE4sC9Eth8sUw@mail.gmail.com>
 <d9fa3258-3b58-7994-fe0d-b7046dcd9058@spatialys.com>
 <CAOodmJqe7PXjC7tOGFmVCoRwhSE9gAQ+bdeu492MP+gD5DF5OQ@mail.gmail.com>
Message-ID: <3ec463dd-e5d5-9812-4749-d8d8748269d4@spatialys.com>

Sean,

You can use any of the existing cloud-storage oriented configuration 
option, so for example for AWS, you could just set the AWS_PROFILE 
(being one listed in 
https://gdal.org/user/virtual_file_systems.html#vsis3-aws-s3-files) that 
corresponds to a path. The main use case was for code that constantly 
switches between buckets of the same provider that have different 
credentials, and where having to swap between the right configuration 
options constantly is a pain, but indeed it might also be convenient for 
command line usage where you have to deal with the same recurring buckets.

Le 24/03/2022 ? 16:12, Sean Gillies a ?crit?:
> Even,
>
> At the very least, the new file duplicates storage of credentials that 
> may already be stored in cloud-specific credentials files, and creates 
> a new way for users to expose their secrets. Also, cloud providers and 
> organizations have moved or are moving to focusing on short-lived 
> credentials, SSO, etc. How useful is a cross-cloud credentials file if 
> it supports only static credentials? Why not support named profiles 
> already defined in cloud-specific files? Python and C++ programmers 
> haven't needed this framework because they can maintain their own maps 
> of credentials or roles to resources, so I guess this feature is 
> mainly for command line users? Do command line users do this kind of 
> thing enough to warrant a new framework?
>
> On Thu, Mar 24, 2022 at 8:45 AM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Sean,
>
>     I saw them as business-as-usual enhancements not impacting the
>     software in fundamental ways. I'm not sure what I would put in a
>     RFC that is not in their commit message. Maybe I don't understand
>     what your concern is.
>
>     Even
>
>     Le 24/03/2022 ? 15:28, Sean Gillies a ?crit?:
>>     Hi all,
>>
>>     The intent and scope of the features developed in
>>     https://github.com/OSGeo/gdal/pull/5463 and
>>     https://github.com/OSGeo/gdal/pull/5390 seem rather big and
>>     unclear to me. This seems to me to warrant an RFC. Yes? No?
>>
>
> -- 
> Sean Gillies

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/d84868fc/attachment.html>

From even.rouault at spatialys.com  Thu Mar 24 08:50:22 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Mar 2022 16:50:22 +0100
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <BN6PR01MB2404D77116699E1C7F55B982A6199@BN6PR01MB2404.prod.exchangelabs.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
 <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <CY4PR01MB2406A2CE96E342DD7E5D795FA6189@CY4PR01MB2406.prod.exchangelabs.com>
 <69912c61-97a2-c404-9280-2ed71298af37@spatialys.com>
 <BN6PR01MB2404D77116699E1C7F55B982A6199@BN6PR01MB2404.prod.exchangelabs.com>
Message-ID: <79889ab4-7ae3-7395-4fa8-117f5cb61859@spatialys.com>

Steve,

(adding proj mailing list since it's actually purely a PROJ topic

> Does the fact that there isn?t a consensus mean 3126 & 3127 aren?t 
> going to end up in a PROJ release?
>

Did you try them to confirm they help ? Maybe if you want to weight in 
the PRs (if they actually help) that could change the balance.

> I read through the PR?s. Are you thinking my issue is that a vertical 
> shift is being introduced because of a transformation to WGS84 (from 
> NAD83(CSRS)) to look up the geoid separation value?
>
That's probably an issue with the wrong interpolation CRS being used, 
but I can't generally predict how this complex code works without 
launching a debugger and step-by-step tracing what happens.
>
> PROJ4_GRIDS provided a way to specify exactly which geoid file(s) to 
> use.? Some vertical datums, such as NAVD88, only have a single EPSG 
> code for multiple geoids ? what?s the replacement for PROJ4_GRIDS in 
> PROJ9? ?If I could switch to WKT2 strings (not sure that?s really 
> feasible) does it fix these problems?
>
WKT2 hardly helps for that. The closest equivalent is the GEOIDMODEL[] 
sub node of a VERTCRS[] 
(http://docs.opengeospatial.org/is/18-010r7/18-010r7.html#83). But 
that's something that refer to an existing transformation . And in a 
VRTCRS[] you can actually have several GEOIDMODEL[] listed (e.g. for 
NAVD88, all the geoid models), since that's more a definition of the 
VertCRS than which particular geoid model to use. So that's not 
nominally appropriate for a "random" grid not known of PROJ, although we 
have a bit bent the concept to allow a GEOIDMODEL["PROJ 
name_of_the_grid_dot_tif_or_gtx"]. But I would suspect that in that 
situation the ambiguity with the geographic / interpolation CRS to use 
would be similar to WKT1 PROJ4_GRIDS.
>
> Thanks,
>
> steve
>
> *From:* Even Rouault <even.rouault at spatialys.com>
> *Sent:* Wednesday, March 23, 2022 6:06 PM
> *To:* Steve Riddell <sriddell at geocue.com>; gdal-dev at lists.osgeo.org
> *Subject:* Re: OGRCreateCoordinateTransformation()
>
> Steve,
>
> you may try PR https://github.com/OSGeo/PROJ/pull/3126 or 
> https://github.com/OSGeo/PROJ/pull/3127, that might potentially help, 
> but they don't make consensus (see discussions of those PRs). 
> Basically it is a nightmare to deal with the old TOWGS84 / PROJ4_GRIDS 
> approach, that poorly specifies some elements of transformations 
> (especially the vertical part), and doesn't fit well in the ISO-19111 
> model used by newer PROJ (we use and abuse the BoundCRS approach in 
> complex ways). One of the issue too is that we've realized late in the 
> process that we didn't emulate some aspects of the old transformation 
> pipeline, and there isn't general enthusiasm to change that now.
>
> Even
>
> Le 23/03/2022 ? 23:42, Steve Riddell a ?crit?:
>
>     Hi Even,
>
>     I tried the fix with the CRS?s I sent, and it worked. But as I
>     mentioned, my real target CRS is a custom projected system
>     (below), and it still fails with what seems to be the same error
>     as in my original email.
>
>     COMPD_CS["TempTM + CGVD28 height - HT2_0",
>
>     ??? PROJCS["Custom",
>
>     ??????? GEOGCS["NAD83(CSRS)",
>
>     DATUM["NAD83_Canadian_Spatial_Reference_System",
>
>     ??????????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
>     AUTHORITY["EPSG","7019"]],
>
>     ??????????????? TOWGS84[0,0,0,0,0,0,0],
>
>     AUTHORITY["EPSG","6140"]],
>
>     ??????????? PRIMEM["Greenwich",0,
>
>     AUTHORITY["EPSG","8901"]],
>
>     UNIT["degree",0.0174532925199433,
>
>     AUTHORITY["EPSG","9122"]],
>
>     ??????????? AUTHORITY["EPSG","4617"]],
>
>     PROJECTION["Transverse_Mercator"],
>
>     PARAMETER["latitude_of_origin",49.351346659616],
>
>     PARAMETER["central_meridian",-123.20266499149],
>
>     ??????? PARAMETER["scale_factor",1],
>
>     PARAMETER["false_easting",15307.188],
>
>     PARAMETER["false_northing",6540.975],
>
>     ??????? UNIT["Meters",1],
>
>     ??????? AXIS["Easting",EAST],
>
>     ??????? AXIS["Northing",NORTH]],
>
>     ??? VERT_CS["CGVD28 height - HT2_0",
>
>     ??????? VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
>
>     EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
>
>     ??????????? AUTHORITY["EPSG","5114"]],
>
>     ??????? UNIT["metre",1,
>
>     ??????????? AUTHORITY["EPSG","9001"]],
>
>     ??????? AXIS["Gravity-related height",UP],
>
>     ??????? AUTHORITY["EPSG","5713"]]]
>
>     Experimenting, I removed the ?TOWGS84? directive from BOTH the
>     source and target systems, and I do get an answer instead of an error:
>
>     For test point: (49.351346658, -123.202664992, 289.809)
>
>     I get: (15307.1880,6540.9748,307.744)
>
>     But since geoid separation at the test point is -18.238, Z should
>     be 308.047.? In fact, if I code up the following pipeline and
>     initialize a transform object:
>
>     strPipe ="+proj=pipeline\
>
>     ??????? +step +proj=axisswap +order=2, 1\
>
>     ??????? +step +proj=unitconvert +xy_in=deg +xy_out=rad\
>
>     ??????? +step +inv +proj=vgridshift +grids=HT2_0.gtx +multiplier=1\
>
>     ??????? +step +proj=tmerc +lat_0=49.351346659616
>     +lon_0=-123.20266499149 +k=1\
>
>     ??????? +x_0=15307.188 +y_0=6540.975 +ellps=GRS80";
>
>     The call to Transform() gives: (15307.1880, 6540.9748, 308.042)??
>     -- XY matches above, but now I get the expected Z (-0.005).
>     ?However, I?d like to avoid assembling pipelines for every
>     conversion/transform.
>
>     Any arrows left in your quiver?
>
>     Thanks,
>
>     Steve
>
>     *From:* Steve Riddell
>     *Sent:* Friday, March 18, 2022 6:17 PM
>     *To:* Even Rouault <even.rouault at spatialys.com>
>     <mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
>     *Subject:* RE: OGRCreateCoordinateTransformation()
>
>     Thanks very much, Even.? For reporting the problem, I ?packaged
>     up? a case with CRS?s with EPGS codes. For the actual problem I?m
>     working, the target CRS is a custom projection ?no EPSG.
>
>     *From:* Even Rouault <even.rouault at spatialys.com>
>     *Sent:* Friday, March 18, 2022 5:05 PM
>     *To:* Steve Riddell <sriddell at geocue.com>; gdal-dev at lists.osgeo.org
>     *Subject:* Re: OGRCreateCoordinateTransformation()
>
>     Steve,
>
>     Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123
>
>     The complexity of dealing with legacy features TOWGS84[] and
>     PROJ4_GRIDS is highly stressing PROJ pipeline computation engine.
>
>     Using the plain EPSG codes? EPSG:4955 -> EPSG:4617+5713 would be
>     much preferable here
>
>     Even
>
>     Le 18/03/2022 ? 21:14, Steve Riddell a ?crit?:
>
>         Hi,
>
>         I?m getting an error (below) using GDAL trying to set up a
>         transformation between NAD83(CSRS) geodetic, w/ ellipsoidal
>         heights, and NAD83(CSRS) geodetic, CGVD28 heights. Similar
>         transformations work fine on some datums,? but fail on others.
>         ?Hope someone can offer some insight.? Note the if I don't use
>         the PROJ4_GRIDS extension, I don't get the error, but I don't
>         get the geoid adjustment either.
>
>         COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
>
>         ??? GEOGCS["NAD83(CSRS)",
>
>         DATUM["NAD83_Canadian_Spatial_Reference_System",
>
>         ??????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
>         AUTHORITY["EPSG","7019"]],
>
>         ??????????? TOWGS84[0,0,0,0,0,0,0],
>
>         ??????????? AUTHORITY["EPSG","6140"]],
>
>         ??????? PRIMEM["Greenwich",0,
>
>         ??????????? AUTHORITY["EPSG","8901"]],
>
>         UNIT["degree",0.0174532925199433,
>
>         ??????????? AUTHORITY["EPSG","9122"]],
>
>         ??????? AUTHORITY["EPSG","4617"]],
>
>         ??? VERT_CS["Ellipsoid (Meters)",
>
>         ??????? VERT_DATUM["Ellipsoid",2002],
>
>         ??????? UNIT["metre",1,
>
>         ??????????? AUTHORITY["EPSG","9001"]],
>
>         ??????? AXIS["ellipsoidal height",UP]]]
>
>         COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
>
>         ??? GEOGCS["NAD83(CSRS)",
>
>         DATUM["NAD83_Canadian_Spatial_Reference_System",
>
>         ??????????? SPHEROID["GRS 1980",6378137,298.257222101,
>
>         AUTHORITY["EPSG","7019"]],
>
>         ??????????? TOWGS84[0,0,0,0,0,0,0],
>
>         ??????????? AUTHORITY["EPSG","6140"]],
>
>         ??????? PRIMEM["Greenwich",0,
>
>         ??????????? AUTHORITY["EPSG","8901"]],
>
>         UNIT["degree",0.0174532925199433,
>
>         ??????????? AUTHORITY["EPSG","9122"]],
>
>         ??????? AUTHORITY["EPSG","4617"]],
>
>         ??? VERT_CS["CGVD28 height - HT2_0",
>
>         ??????? VERT_DATUM["Canadian Geodetic Vertical Datum of
>         1928",2005,
>
>         EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
>
>         ??????????? AUTHORITY["EPSG","5114"]],
>
>         ??????? UNIT["metre",1,
>
>         ??????????? AUTHORITY["EPSG","9001"]],
>
>         ??????? AXIS["Gravity-related height",UP],
>
>         ??????? AUTHORITY["EPSG","5713"]]]
>
>         ERROR 6: Cannot find coordinate operations from `EPSG:4955' to
>         `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height -
>         HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83
>         Canadian Spatial Reference System",ELLIPSOID["GRS
>         1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic
>         latitude
>         (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic
>         longitude
>         (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS
>         84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS
>         84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation
>         from NAD83(CSRS) to WGS84",METHOD["Position Vector
>         transformation (geog2D
>         domain)",ID["EPSG",9606]],PARAMETER["X-axis
>         translation",0,ID["EPSG",8605]],PARAMETER["Y-axis
>         translation",0,ID["EPSG",8606]],PARAMETER["Z-axis
>         translation",0,ID["EPSG",8607]],PARAMETER["X-axis
>         rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis
>         rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis
>         rotation",0,ID["EPSG",8610]],PARAMETER["Scale
>         difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28
>         height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of
>         1928"],CS[vertical,1],AXIS["gravity-related
>         height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS
>         84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS
>         84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal
>         height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28
>         height - HT2_0 to WGS84 ellipsoidal
>         height",METHOD["GravityRelatedHeight to
>         Geographic3D"],PARAMETERFILE["Geoid (height correction) model
>         file","HT2_0.gtx",ID["EPSG",8666]]]]]'
>
>           
>
>         Thanks in advance for any assistance!
>
>         Best regards,
>
>         Steve
>
>         Steve Riddell
>
>         Software Engineering
>
>         *GeoCue Group, Inc.*
>
>         520 6th Street | Madison, AL 35756 USA
>
>         *Phone:*256.461.8289 | *Fax:* 256.461.8249
>
>         /LIDAR/Drone Mapping Software & Services //? True View? 3D
>         Imaging Sensors //?Image/LIDAR Data Management Solutions/
>
>         www.geocue.com <http://www.geocue.com/>support.geocue.com
>         <https://support.geocue.com/>
>
>     -- 
>
>     http://www.spatialys.com
>
>     My software is free, but my time generally not.
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/87ccbf45/attachment-0001.html>

From even.rouault at spatialys.com  Thu Mar 24 10:54:44 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Mar 2022 18:54:44 +0100
Subject: [gdal-dev] [PROJ] OGRCreateCoordinateTransformation()
In-Reply-To: <CABG=M1Pb9E4mue1YtcDjDPCXfb=XL62y1v0K4g5AY=T-YX3z6w@mail.gmail.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
 <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <CY4PR01MB2406A2CE96E342DD7E5D795FA6189@CY4PR01MB2406.prod.exchangelabs.com>
 <69912c61-97a2-c404-9280-2ed71298af37@spatialys.com>
 <BN6PR01MB2404D77116699E1C7F55B982A6199@BN6PR01MB2404.prod.exchangelabs.com>
 <79889ab4-7ae3-7395-4fa8-117f5cb61859@spatialys.com>
 <CABG=M1Pb9E4mue1YtcDjDPCXfb=XL62y1v0K4g5AY=T-YX3z6w@mail.gmail.com>
Message-ID: <1ae9d38a-c4d1-e9ef-8335-2ebee25fea1a@spatialys.com>


Le 24/03/2022 ? 18:36, Erixen Cruz a ?crit?:
>
>>     PROJ4_GRIDS provided a way to specify exactly which geoid file(s)
>>     to use.? Some vertical datums, such as NAVD88, only have a single
>>     EPSG code for multiple geoids ? what?s the replacement for
>>     PROJ4_GRIDS in PROJ9?? If I could switch to WKT2 strings (not
>>     sure that?s really feasible) does it fix these problems?
>>
>     ?WKT2 hardly helps for that.
>
>
> There is one way to get WKT2 to do just this. Here's the start of the 
> thread about that: 
> https://lists.osgeo.org/pipermail/proj/2019-December/009142.html. TLDR 
> you use a BOUNDCRS with an ABRIDGEDTRANSFORMATION. Thanks again, Even, 
> for pointing us in this direction.
>
> This is not ideal though. Like Even said, this (mis)use of BOUNDCRS 
> doesn't fit very cleanly in PROJ9 at the moment.

yeah, that can be used in PROJ (and that's exactly how a WKT1 with a 
TOWGS84 or PROJ4_GRIDS, or a PROJ.4 strings with 
+towgs84/+nadgrids/+geoidgrids end up being represented), but 
pedantically a BOUNDCRS[] is not a CRS. PROJ does accept is as a CRS 
(such as a COMPOUNDCRS of BOUNDCRS[]) because there was no other 
convenient way of modeling those legacy features in ISO19111:2019 / 
WKT2:2019, but this is an extension, and strictly conforming other 
implementations would reject that.

And the ABRIDGEDTRANSFORMATION[]? syntax cannot be used for vertical 
transformations where the geographic CRS would not be the interpolation CRS.


-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220324/b08cef76/attachment.html>

From snehal.waychal at gmail.com  Thu Mar 24 23:23:34 2022
From: snehal.waychal at gmail.com (snehal waychal)
Date: Fri, 25 Mar 2022 07:23:34 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
Message-ID: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>

Dear GDAL Team,

I would like to ask about the patch release policy for the older GDAL
versions. I understand that the GitHub issue is not the place to ask such
questions and hence posting it here. As this is my first post here, please
let me know if I should ask this somewhere else.

On platforms like Debian Bullseye or Ubuntu Focal (current LTS), the GDAL
versions available are 3.2.2 and 3.0.4 respectively. Python bindings
installation for such older releases (<3.3) works as long as the setuptools
version is < 58.0.0. This is due to removal of use_2to3 from newer
setuptools[1]. This compatibility issue was fixed in GDAL v3.3 release[2].
There is a system package python3-gdal but if I understand correctly this
is available for the default python version. So this doesn't work for
official python docker images based on Debian LTS where the python version
is different from system one.

As LTS platforms mentioned above with older GDAL versions are widely used
and there are situations where newer setuptools usage is enforced (e.g. by
modern python package manager tools, see issues in pipenv[3] or poetry[4]),
we face quite some trouble to have GDAL python package working in complex
python environments. Considering the discussion in linked issues, this also
affects GDAL users as well [5].

We could use some inconvenient workarounds but it would be helpful if there
could be a patch release for issues like setuptools compatibility in older
GDAL versions (e.g. 3.2.2) which are commonly used on LTS platforms like
Debian Bullseye. And especially when the effort of backporting fix like [1]
is simple as patch[2] is directly applicable:

```console
git clone https://github.com/OSGeo/gdal.git -b v3.2.2
git cherry-pick 36b6ccdb0e6889743c2ec8b9d8cd7fee3d2df9dd --strategy-option
theirs

# minor some changes and generate sdist for pypi release
python setup.py sdist
```

Given the above considerations, I wonder if there would be a possibility of
having patch releases. I think creating PR won't be much work if this would
be an acceptable policy. I believe this would help quite some people.

Thank you!

[1] https://github.com/OSGeo/gdal/issues/4467
[2]
https://github.com/OSGeo/gdal/commit/36b6ccdb0e6889743c2ec8b9d8cd7fee3d2df9dd
[3] https://github.com/pypa/pipenv/issues/2364
[4] https://github.com/python-poetry/poetry/issues/1584
[5] https://github.com/pypa/setuptools/issues/2781
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220325/db326ca8/attachment.html>

From even.rouault at spatialys.com  Fri Mar 25 04:07:03 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 25 Mar 2022 12:07:03 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
Message-ID: <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>

Snehal,

what you discuss here is all about the patch & backport policy of the 
Debian GDAL package. You can try to file a bug to Debian and point to 
the patch you'd want to see backported, but I can't promise if there 
would be interest in their maintenance team to create an updated package 
with it (my understanding is that even if we'd release a new 3.2.x patch 
release, it wouldn't be packaged in LTS distributions. I'm not sure how 
much of that is linked to Debian policy or availability of people that 
do the work)

For Ubuntu, there's the ubuntugis-unstable PPA with more recent versions.

Using Conda can also be a convenient way to get the latest GDAL on LTS 
releases that stick with older versions: 
https://gdal.org/download.html#conda

Even


Le 25/03/2022 ? 07:23, snehal waychal a ?crit?:
> Dear GDAL Team,
>
> I would like to ask about the patch release policy for the older GDAL 
> versions. I understand that the GitHub issue is not the place to ask 
> such questions and hence posting it here. As this is my first post 
> here, please let me know if I should ask this somewhere else.
>
> On platforms like Debian Bullseye or Ubuntu Focal (current LTS), the 
> GDAL versions available are 3.2.2 and 3.0.4 respectively. Python 
> bindings installation for such older releases (<3.3) works as long as 
> the setuptools version is < 58.0.0. This is due to removal of use_2to3 
> from newer setuptools[1]. This compatibility issue was fixed in GDAL 
> v3.3 release[2]. There is a system package python3-gdal but if I 
> understand correctly this is available for the default python version. 
> So this doesn't work for official python docker images based on Debian 
> LTS where the python version is different from system one.
>
> As LTS platforms mentioned above with older GDAL versions are widely 
> used and there are situations where newer setuptools usage is enforced 
> (e.g. by modern python package manager tools, see issues in pipenv[3] 
> or poetry[4]), we face quite some trouble to have GDAL python package 
> working in complex python environments. Considering the discussion in 
> linked issues, this also affects GDAL users as well [5].
>
> We could use some inconvenient?workarounds but it would be helpful if 
> there could be a patch release for issues like setuptools 
> compatibility in older GDAL versions (e.g. 3.2.2) which are commonly 
> used on LTS platforms like Debian Bullseye. And especially when the 
> effort of backporting fix like [1] is simple as patch[2] is directly 
> applicable:
>
> ```console
> git clone https://github.com/OSGeo/gdal.git -b v3.2.2
> git cherry-pick 36b6ccdb0e6889743c2ec8b9d8cd7fee3d2df9dd 
> --strategy-option theirs
>
> # minor some changes and generate sdist for pypi release
> python setup.py sdist
> ```
>
> Given the above considerations, I wonder if there would be a 
> possibility of having patch releases. I think creating PR won't be 
> much work if this would be an acceptable policy. I believe this would 
> help quite some people.
>
> Thank you!
>
> [1] https://github.com/OSGeo/gdal/issues/4467
> [2] 
> https://github.com/OSGeo/gdal/commit/36b6ccdb0e6889743c2ec8b9d8cd7fee3d2df9dd
> [3] https://github.com/pypa/pipenv/issues/2364
> [4] https://github.com/python-poetry/poetry/issues/1584
> [5] https://github.com/pypa/setuptools/issues/2781
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sebastic at xs4all.nl  Fri Mar 25 04:29:02 2022
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Fri, 25 Mar 2022 12:29:02 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
 <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
Message-ID: <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>

On 3/25/22 12:07, Even Rouault wrote:
> what you discuss here is all about the patch & backport policy of the 
> Debian GDAL package. You can try to file a bug to Debian and point to 
> the patch you'd want to see backported, but I can't promise if there 
> would be interest in their maintenance team to create an updated package 
> with it (my understanding is that even if we'd release a new 3.2.x patch 
> release, it wouldn't be packaged in LTS distributions. I'm not sure how 
> much of that is linked to Debian policy or availability of people that 
> do the work)

Packages in Debian stable releases only get updates to fix bugs of 
severity important or higher [0]. GDAL patch releases also contain 
changes for lower severity issues, it's not worth the effort to vet all 
those changes. Any changes to packages in stable also risk introducing 
regressions which are highly undesirable in LTS releases known for their 
stability.

People should be maintaining their own packaging repositories where they 
host packages with changes for their needs that cannot be easily 
upstreamed to the package in the distribution itself. Scratching your 
own itch was a corner stone of Open Source that people are seemingly 
forgetting or never having known about in the first place.

[0] 
https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From snehal.waychal at gmail.com  Fri Mar 25 05:13:55 2022
From: snehal.waychal at gmail.com (snehal waychal)
Date: Fri, 25 Mar 2022 13:13:55 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
 <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
 <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>
Message-ID: <CAPaOVv7qoSR7zg+N9Lt3ytOmzrv5UUzKcHUtKxovUZNLL9tp0Q@mail.gmail.com>

Dear Even, dear Bas,


Thank you very much for the quick response and highlighting the
Debian/Ubuntu release policy aspects. And also about the link to the
ubuntugis-unstable PPA.


>* what you discuss here is all about the patch & backport policy of the *

>* Debian GDAL package. You can try to file a bug to Debian and point to *

>* the patch you'd want to see backported,*


But just to be sure I haven?t misunderstood your response or misrepresented
the original issue. The patch release I described is also needed in the
official releases of the GDAL **python** package. If I am not mistaken, the
GDAL team is taking care of source distributions on
https://pypi.org/project/GDAL/. I looked into released pypi versions and if
I am not mistaken there is no patch release for v3.2.2 with fix for
setuptools compatibility issue.


So, if we could make a new patch release of the* *python* package of GDAL*
and push the sdist package to pypi.org (something like 3.2.2.1, as I
described in the previous email) then that would also solve the issue.
Because as python developers, we install *python* packages via
pip/pipenv/poetry and those package managers would pick the new patch
release from pypi.org. (The GDAL library component libgdal-dev v3.2.2 will
still come from the debian system package repo and there is no issue with
that).


Hope I am not missing something obvious here. Please let me know.


Thank you again!


Regards,

Snehal

On Fri, Mar 25, 2022 at 12:29 PM Sebastiaan Couwenberg <sebastic at xs4all.nl>
wrote:

> On 3/25/22 12:07, Even Rouault wrote:
> > what you discuss here is all about the patch & backport policy of the
> > Debian GDAL package. You can try to file a bug to Debian and point to
> > the patch you'd want to see backported, but I can't promise if there
> > would be interest in their maintenance team to create an updated package
> > with it (my understanding is that even if we'd release a new 3.2.x patch
> > release, it wouldn't be packaged in LTS distributions. I'm not sure how
> > much of that is linked to Debian policy or availability of people that
> > do the work)
>
> Packages in Debian stable releases only get updates to fix bugs of
> severity important or higher [0]. GDAL patch releases also contain
> changes for lower severity issues, it's not worth the effort to vet all
> those changes. Any changes to packages in stable also risk introducing
> regressions which are highly undesirable in LTS releases known for their
> stability.
>
> People should be maintaining their own packaging repositories where they
> host packages with changes for their needs that cannot be easily
> upstreamed to the package in the distribution itself. Scratching your
> own itch was a corner stone of Open Source that people are seemingly
> forgetting or never having known about in the first place.
>
> [0]
>
> https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions
>
> Kind Regards,
>
> Bas
>
> --
>   GPG Key ID: 4096R/6750F10AE88D4AF1
> Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220325/8b975fdf/attachment-0001.html>

From even.rouault at spatialys.com  Fri Mar 25 05:45:21 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 25 Mar 2022 13:45:21 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <CAPaOVv7qoSR7zg+N9Lt3ytOmzrv5UUzKcHUtKxovUZNLL9tp0Q@mail.gmail.com>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
 <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
 <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>
 <CAPaOVv7qoSR7zg+N9Lt3ytOmzrv5UUzKcHUtKxovUZNLL9tp0Q@mail.gmail.com>
Message-ID: <ef4bde0c-6f15-63c2-6c75-e552cbf0af66@spatialys.com>

ok, I missed this was on the pypi package.

I've tried to make a patch over 3.2.2. For now, I've uploaded it only to 
https://test.pypi.org/project/GDAL/3.2.2.1/? . Can you test that and 
confirm that works properly ? If so, I'll push it to pypi official.

I've tracked the changes in a patch/3.2.2.1 branch, sitting for now in 
my fork:

https://github.com/OSGeo/gdal/compare/v3.2.2..rouault:patch/3.2.2.1?expand=1

I'll push that to OSGeo/gdal as well and tag once confirmed things work fine

Hoping I'm not going into troubles doing this stuff outside of our usual 
release processes...

Even

Le 25/03/2022 ? 13:13, snehal waychal a ?crit?:
>
> Dear Even, dear Bas,
>
>
> Thank you very much for the quick response and highlightingthe 
> Debian/Ubuntu release policy aspects. And also about the link to the 
> ubuntugis-unstable PPA.
>
>
> >/what you discuss here is all about the patch & backport policy of the/
>
> >/Debian GDAL package. You can try to file a bug to Debian and point to/
>
> >/the patch you'd want to see backported,/
>
>
> But just to be sure I haven?t misunderstoodyour response or 
> misrepresented the original issue. The patch release I described is 
> also needed in the official releases of the GDAL **python** package. 
> If I am not mistaken, the GDAL team is taking care of source 
> distributions on https://pypi.org/project/GDAL/ 
> <https://pypi.org/project/GDAL/>. I looked into released pypi versions 
> and if I am not mistaken there is no patch release for v3.2.2 with fix 
> for setuptools compatibility issue.
>
>
> So, if we could make a new patch release of the/*python* package of 
> GDAL/ and push the sdist package to pypi.org <http://pypi.org> 
> (something like 3.2.2.1, as I described in the previous email) then 
> that would also solve the issue. Because as python developers, we 
> install *python* packages via pip/pipenv/poetry and those package 
> managers would pick the new patch release from pypi.org 
> <http://pypi.org>. (The GDAL library component libgdal-dev v3.2.2 will 
> still come from the debian system package repo and there is no issue 
> with that).
>
>
> Hope I am not missing something obvious here. Please let me know.
>
>
> Thank you again!
>
>
> Regards,
>
> Snehal
>
>
> On Fri, Mar 25, 2022 at 12:29 PM Sebastiaan Couwenberg 
> <sebastic at xs4all.nl> wrote:
>
>     On 3/25/22 12:07, Even Rouault wrote:
>     > what you discuss here is all about the patch & backport policy
>     of the
>     > Debian GDAL package. You can try to file a bug to Debian and
>     point to
>     > the patch you'd want to see backported, but I can't promise if
>     there
>     > would be interest in their maintenance team to create an updated
>     package
>     > with it (my understanding is that even if we'd release a new
>     3.2.x patch
>     > release, it wouldn't be packaged in LTS distributions. I'm not
>     sure how
>     > much of that is linked to Debian policy or availability of
>     people that
>     > do the work)
>
>     Packages in Debian stable releases only get updates to fix bugs of
>     severity important or higher [0]. GDAL patch releases also contain
>     changes for lower severity issues, it's not worth the effort to
>     vet all
>     those changes. Any changes to packages in stable also risk
>     introducing
>     regressions which are highly undesirable in LTS releases known for
>     their
>     stability.
>
>     People should be maintaining their own packaging repositories
>     where they
>     host packages with changes for their needs that cannot be easily
>     upstreamed to the package in the distribution itself. Scratching your
>     own itch was a corner stone of Open Source that people are seemingly
>     forgetting or never having known about in the first place.
>
>     [0]
>     https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions
>
>     Kind Regards,
>
>     Bas
>
>     -- 
>     ? GPG Key ID: 4096R/6750F10AE88D4AF1
>     Fingerprint: 8182 DE41 7056 408D 6146? 50D1 6750 F10A E88D 4AF1
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220325/63b47b95/attachment.html>

From snehal.waychal at gmail.com  Fri Mar 25 15:24:40 2022
From: snehal.waychal at gmail.com (snehal waychal)
Date: Fri, 25 Mar 2022 23:24:40 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <ef4bde0c-6f15-63c2-6c75-e552cbf0af66@spatialys.com>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
 <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
 <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>
 <CAPaOVv7qoSR7zg+N9Lt3ytOmzrv5UUzKcHUtKxovUZNLL9tp0Q@mail.gmail.com>
 <ef4bde0c-6f15-63c2-6c75-e552cbf0af66@spatialys.com>
Message-ID: <CAPaOVv4VtfLHerg9jbEwt+hL7UabET2T9zbKj609_Qk+CEW2_Q@mail.gmail.com>

Dear Evan,


Oh! thank you very much for a fast test release!


I can confirm that released version works as expected. And to be sure, here
is what/how I have tested:


```

$ docker run -it python:3.7.13-slim-bullseye bash


$ apt-get update && apt-get install -y libgdal-dev gcc g++


# let's take newer, problematic setuptools

$ pip install -U setuptools

$ pip list

Package       Version

----------     -------

pip                 22.0.4

setuptools    61.0.0

wheel            0.37.1


# existing release from pypi.org fails


$ pip install gdal==3.2.2


Collecting gdal==3.2.2

  Downloading GDAL-3.2.2.tar.gz (601 kB)

     ???????????????????????????????????????? 601.7/601.7 KB 8.0 MB/s eta
0:00:00

  Preparing metadata (setup.py) ... error

  error: subprocess-exited-with-error


  ? python setup.py egg_info did not run successfully.

  ? exit code: 1

  ??> [6 lines of output]

      WARNING: numpy not available!  Array support will not be enabled

      /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
UserWarning: Unknown distribution option: 'use_2to3_fixers'

        warnings.warn(msg)

      /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
UserWarning: Unknown distribution option: 'use_2to3_exclude_fixers'

        warnings.warn(msg)

      error in GDAL setup command: use_2to3 is invalid.

      [end of output]


  note: This error originates from a subprocess, and is likely not a
problem with pip.

error: metadata-generation-failed


? Encountered error while generating package metadata.

??> See above for output.


note: This is an issue with the package mentioned above, not pip.

hint: See above for details.





# installing newer one from test.pypi.org works fine!



$ pip install -i https://test.pypi.org/simple/ GDAL==3.2.2.1


Looking in indexes: https://test.pypi.org/simple/

Collecting GDAL==3.2.2.1

  Downloading
https://test-files.pythonhosted.org/packages/b7/02/4356dbdabf8f4fa898fe2378c8c096df3da254508ec8bc0663920cf4b92d/GDAL-3.2.2.1.tar.gz
(600 kB)

     ???????????????????????????????????????? 600.9/600.9 KB 8.2 MB/s eta
0:00:00

  Preparing metadata (setup.py) ... done

Building wheels for collected packages: GDAL

  Building wheel for GDAL (setup.py) ... done

  Created wheel for GDAL: filename=GDAL-3.2.2.1-cp37-cp37m-linux_x86_64.whl
size=816416
sha256=0209dc3c56cd626137c53187c4a8fb7758587c9030cf8d479d8a2c7864fd5c77

  Stored in directory:
/root/.cache/pip/wheels/4b/f2/02/0ca533c034c5cc5840d619cd7004f32d3362c04a1c1500d0a1

Successfully built GDAL

Installing collected packages: GDAL

Successfully installed GDAL-3.2.2.1

WARNING: Running pip as the 'root' user can result in broken permissions
and conflicting behaviour with the system package manager. It is
recommended to use a virtual environment instead:
https://pip.pypa.io/warnings/venv


```


I hope this gives us some confidence that we are on a right track! :)


If I should test something else, please let me know! Looking forward for
the release on the pypi.org.


Thank you again!!


Regards,

Snehal


On Fri, Mar 25, 2022 at 1:45 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> ok, I missed this was on the pypi package.
>
> I've tried to make a patch over 3.2.2. For now, I've uploaded it only to
> https://test.pypi.org/project/GDAL/3.2.2.1/  . Can you test that and
> confirm that works properly ? If so, I'll push it to pypi official.
>
> I've tracked the changes in a patch/3.2.2.1 branch, sitting for now in my
> fork:
>
>
> https://github.com/OSGeo/gdal/compare/v3.2.2..rouault:patch/3.2.2.1?expand=1
>
> I'll push that to OSGeo/gdal as well and tag once confirmed things work
> fine
>
> Hoping I'm not going into troubles doing this stuff outside of our usual
> release processes...
>
> Even
> Le 25/03/2022 ? 13:13, snehal waychal a ?crit :
>
> Dear Even, dear Bas,
>
>
> Thank you very much for the quick response and highlighting the
> Debian/Ubuntu release policy aspects. And also about the link to the
> ubuntugis-unstable PPA.
>
>
> >* what you discuss here is all about the patch & backport policy of the *
>
> >* Debian GDAL package. You can try to file a bug to Debian and point to *
>
> >* the patch you'd want to see backported,*
>
>
> But just to be sure I haven?t misunderstood your response or
> misrepresented the original issue. The patch release I described is also
> needed in the official releases of the GDAL **python** package. If I am
> not mistaken, the GDAL team is taking care of source distributions on
> https://pypi.org/project/GDAL/. I looked into released pypi versions and
> if I am not mistaken there is no patch release for v3.2.2 with fix for
> setuptools compatibility issue.
>
>
> So, if we could make a new patch release of the* *python* package of GDAL*
> and push the sdist package to pypi.org (something like 3.2.2.1, as I
> described in the previous email) then that would also solve the issue.
> Because as python developers, we install *python* packages via
> pip/pipenv/poetry and those package managers would pick the new patch
> release from pypi.org. (The GDAL library component libgdal-dev v3.2.2
> will still come from the debian system package repo and there is no issue
> with that).
>
>
> Hope I am not missing something obvious here. Please let me know.
>
>
> Thank you again!
>
>
> Regards,
>
> Snehal
>
> On Fri, Mar 25, 2022 at 12:29 PM Sebastiaan Couwenberg <sebastic at xs4all.nl>
> wrote:
>
>> On 3/25/22 12:07, Even Rouault wrote:
>> > what you discuss here is all about the patch & backport policy of the
>> > Debian GDAL package. You can try to file a bug to Debian and point to
>> > the patch you'd want to see backported, but I can't promise if there
>> > would be interest in their maintenance team to create an updated
>> package
>> > with it (my understanding is that even if we'd release a new 3.2.x
>> patch
>> > release, it wouldn't be packaged in LTS distributions. I'm not sure how
>> > much of that is linked to Debian policy or availability of people that
>> > do the work)
>>
>> Packages in Debian stable releases only get updates to fix bugs of
>> severity important or higher [0]. GDAL patch releases also contain
>> changes for lower severity issues, it's not worth the effort to vet all
>> those changes. Any changes to packages in stable also risk introducing
>> regressions which are highly undesirable in LTS releases known for their
>> stability.
>>
>> People should be maintaining their own packaging repositories where they
>> host packages with changes for their needs that cannot be easily
>> upstreamed to the package in the distribution itself. Scratching your
>> own itch was a corner stone of Open Source that people are seemingly
>> forgetting or never having known about in the first place.
>>
>> [0]
>>
>> https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions
>>
>> Kind Regards,
>>
>> Bas
>>
>> --
>>   GPG Key ID: 4096R/6750F10AE88D4AF1
>> Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220325/6a57b246/attachment-0001.html>

From even.rouault at spatialys.com  Fri Mar 25 15:33:52 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 25 Mar 2022 23:33:52 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <CAPaOVv4VtfLHerg9jbEwt+hL7UabET2T9zbKj609_Qk+CEW2_Q@mail.gmail.com>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
 <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
 <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>
 <CAPaOVv7qoSR7zg+N9Lt3ytOmzrv5UUzKcHUtKxovUZNLL9tp0Q@mail.gmail.com>
 <ef4bde0c-6f15-63c2-6c75-e552cbf0af66@spatialys.com>
 <CAPaOVv4VtfLHerg9jbEwt+hL7UabET2T9zbKj609_Qk+CEW2_Q@mail.gmail.com>
Message-ID: <9be6ca31-77c8-cd28-a8f2-ced063ea3ec6@spatialys.com>

ok, just pushed to https://pypi.org/project/GDAL/3.2.2.1/

Le 25/03/2022 ? 23:24, snehal waychal a ?crit?:
>
> Dear Evan,
>
>
> Oh! thank you very much for a fast test release!
>
>
> I can confirm that released version works as expected. And to be sure, 
> here is what/how I have tested:
>
>
>     ```
>
>     $ docker run -it python:3.7.13-slim-bullseye bash
>
>
>     $ apt-get update && apt-get install -y libgdal-dev gcc g++
>
>
>     # let's take newer, problematic setuptools
>
>     $ pip install -U setuptools
>
>     $ pip list
>
>     PackageVersion
>
>     -----------------
>
>     pip22.0.4
>
>     setuptools61.0.0
>
>     wheel0.37.1
>
>
>     # existing release from pypi.org <http://pypi.org> fails
>
>
>     $ pip install gdal==3.2.2
>
>
>     Collecting gdal==3.2.2
>
>     Downloading GDAL-3.2.2.tar.gz (601 kB)
>
>     ???????????????????????????????????????? 601.7/601.7 KB 8.0 MB/s
>     eta 0:00:00
>
>     Preparing metadata (setup.py) ... error
>
>     error: subprocess-exited-with-error
>
>
>     ? python setup.py egg_info did not run successfully.
>
>     ? exit code: 1
>
>     ??> [6 lines of output]
>
>     WARNING: numpy not available!Array support will not be enabled
>
>     /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
>     UserWarning: Unknown distribution option: 'use_2to3_fixers'
>
>     warnings.warn(msg)
>
>     /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
>     UserWarning: Unknown distribution option: 'use_2to3_exclude_fixers'
>
>     warnings.warn(msg)
>
>     error in GDAL setup command: use_2to3 is invalid.
>
>     [end of output]
>
>
>     note: This error originates from a subprocess, and is likely not a
>     problem with pip.
>
>     error: metadata-generation-failed
>
>
>     ? Encountered error while generating package metadata.
>
>     ??> See above for output.
>
>
>     note: This is an issue with the package mentioned above, not pip.
>
>     hint: See above for details.
>
>     # installing newer one from test.pypi.org <http://test.pypi.org>
>     works fine!
>
>     $ pip install -i https://test.pypi.org/simple/ GDAL==3.2.2.1
>
>
>     Looking in indexes: https://test.pypi.org/simple/
>
>     Collecting GDAL==3.2.2.1
>
>     Downloading
>     https://test-files.pythonhosted.org/packages/b7/02/4356dbdabf8f4fa898fe2378c8c096df3da254508ec8bc0663920cf4b92d/GDAL-3.2.2.1.tar.gz
>     (600 kB)
>
>     ???????????????????????????????????????? 600.9/600.9 KB 8.2 MB/s
>     eta 0:00:00
>
>     Preparing metadata (setup.py) ... done
>
>     Building wheels for collected packages: GDAL
>
>     Building wheel for GDAL (setup.py) ... done
>
>     Created wheel for GDAL:
>     filename=GDAL-3.2.2.1-cp37-cp37m-linux_x86_64.whl size=816416
>     sha256=0209dc3c56cd626137c53187c4a8fb7758587c9030cf8d479d8a2c7864fd5c77
>
>     Stored in directory:
>     /root/.cache/pip/wheels/4b/f2/02/0ca533c034c5cc5840d619cd7004f32d3362c04a1c1500d0a1
>
>     Successfully built GDAL
>
>     Installing collected packages: GDAL
>
>     Successfully installed GDAL-3.2.2.1
>
>     WARNING: Running pip as the 'root' user can result in broken
>     permissions and conflicting behaviour with the system package
>     manager. It is recommended to use a virtual environment
>     instead:https://pip.pypa.io/warnings/venv
>
>
>     ```
>
>
> I hope this gives us some confidence that we are on a right track! :)
>
>
> If I should test something else, please let me know! Looking forward 
> for the release on the pypi.org <http://pypi.org>.
>
>
> Thank you again!!
>
>
> Regards,
>
> Snehal
>
>
>
> On Fri, Mar 25, 2022 at 1:45 PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     ok, I missed this was on the pypi package.
>
>     I've tried to make a patch over 3.2.2. For now, I've uploaded it
>     only to https://test.pypi.org/project/GDAL/3.2.2.1/ . Can you test
>     that and confirm that works properly ? If so, I'll push it to pypi
>     official.
>
>     I've tracked the changes in a patch/3.2.2.1 <http://3.2.2.1>
>     branch, sitting for now in my fork:
>
>     https://github.com/OSGeo/gdal/compare/v3.2.2..rouault:patch/3.2.2.1?expand=1
>
>     I'll push that to OSGeo/gdal as well and tag once confirmed things
>     work fine
>
>     Hoping I'm not going into troubles doing this stuff outside of our
>     usual release processes...
>
>     Even
>
>     Le 25/03/2022 ? 13:13, snehal waychal a ?crit?:
>>
>>     Dear Even, dear Bas,
>>
>>
>>     Thank you very much for the quick response and highlightingthe
>>     Debian/Ubuntu release policy aspects. And also about the link to
>>     the ubuntugis-unstable PPA.
>>
>>
>>     >/what you discuss here is all about the patch & backport policy
>>     of the/
>>
>>     >/Debian GDAL package. You can try to file a bug to Debian and
>>     point to/
>>
>>     >/the patch you'd want to see backported,/
>>
>>
>>     But just to be sure I haven?t misunderstoodyour response or
>>     misrepresented the original issue. The patch release I described
>>     is also needed in the official releases of the GDAL **python**
>>     package. If I am not mistaken, the GDAL team is taking care of
>>     source distributions on https://pypi.org/project/GDAL/
>>     <https://pypi.org/project/GDAL/>. I looked into released pypi
>>     versions and if I am not mistaken there is no patch release for
>>     v3.2.2 with fix for setuptools compatibility issue.
>>
>>
>>     So, if we could make a new patch release of the/*python* package
>>     of GDAL/ and push the sdist package to pypi.org <http://pypi.org>
>>     (something like 3.2.2.1, as I described in the previous email)
>>     then that would also solve the issue. Because as python
>>     developers, we install *python* packages via pip/pipenv/poetry
>>     and those package managers would pick the new patch release from
>>     pypi.org <http://pypi.org>. (The GDAL library component
>>     libgdal-dev v3.2.2 will still come from the debian system package
>>     repo and there is no issue with that).
>>
>>
>>     Hope I am not missing something obvious here. Please let me know.
>>
>>
>>     Thank you again!
>>
>>
>>     Regards,
>>
>>     Snehal
>>
>>
>>     On Fri, Mar 25, 2022 at 12:29 PM Sebastiaan Couwenberg
>>     <sebastic at xs4all.nl> wrote:
>>
>>         On 3/25/22 12:07, Even Rouault wrote:
>>         > what you discuss here is all about the patch & backport
>>         policy of the
>>         > Debian GDAL package. You can try to file a bug to Debian
>>         and point to
>>         > the patch you'd want to see backported, but I can't promise
>>         if there
>>         > would be interest in their maintenance team to create an
>>         updated package
>>         > with it (my understanding is that even if we'd release a
>>         new 3.2.x patch
>>         > release, it wouldn't be packaged in LTS distributions. I'm
>>         not sure how
>>         > much of that is linked to Debian policy or availability of
>>         people that
>>         > do the work)
>>
>>         Packages in Debian stable releases only get updates to fix
>>         bugs of
>>         severity important or higher [0]. GDAL patch releases also
>>         contain
>>         changes for lower severity issues, it's not worth the effort
>>         to vet all
>>         those changes. Any changes to packages in stable also risk
>>         introducing
>>         regressions which are highly undesirable in LTS releases
>>         known for their
>>         stability.
>>
>>         People should be maintaining their own packaging repositories
>>         where they
>>         host packages with changes for their needs that cannot be easily
>>         upstreamed to the package in the distribution itself.
>>         Scratching your
>>         own itch was a corner stone of Open Source that people are
>>         seemingly
>>         forgetting or never having known about in the first place.
>>
>>         [0]
>>         https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions
>>
>>         Kind Regards,
>>
>>         Bas
>>
>>         -- 
>>         ? GPG Key ID: 4096R/6750F10AE88D4AF1
>>         Fingerprint: 8182 DE41 7056 408D 6146? 50D1 6750 F10A E88D 4AF1
>>         _______________________________________________
>>         gdal-dev mailing list
>>         gdal-dev at lists.osgeo.org
>>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220325/df0ee682/attachment-0001.html>

From momtchil at momtchev.com  Fri Mar 25 15:40:09 2022
From: momtchil at momtchev.com (Momtchil Momtchev)
Date: Fri, 25 Mar 2022 23:40:09 +0100
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <CAPaOVv4VtfLHerg9jbEwt+hL7UabET2T9zbKj609_Qk+CEW2_Q@mail.gmail.com>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
 <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
 <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>
 <CAPaOVv7qoSR7zg+N9Lt3ytOmzrv5UUzKcHUtKxovUZNLL9tp0Q@mail.gmail.com>
 <ef4bde0c-6f15-63c2-6c75-e552cbf0af66@spatialys.com>
 <CAPaOVv4VtfLHerg9jbEwt+hL7UabET2T9zbKj609_Qk+CEW2_Q@mail.gmail.com>
Message-ID: <c50a64dd-1b21-162e-3b5e-3198ff6a3336@momtchev.com>


If you have lots of Debian servers, what you can do is to use the Debian 
experimental GDAL packages - which are usually up to date with the 
latest version of GDAL - and to set up a Dockerfile to build these for 
Debian stable and then to use reprepro to distribute them to your 
machines. If you have never done this before, you have about 1 day of 
work to set up everything. I did maintain a GDAL distribution for Debian 
10 for a few years. You can find my Dockerfiles here:

https://github.com/mmomtchev/debbuild-gdal


On 25/03/2022 23:24, snehal waychal wrote:
>
> Dear Evan,
>
>
> Oh! thank you very much for a fast test release!
>
>
> I can confirm that released version works as expected. And to be sure, 
> here is what/how I have tested:
>
>
>     ```
>
>     $ docker run -it python:3.7.13-slim-bullseye bash
>
>
>     $ apt-get update && apt-get install -y libgdal-dev gcc g++
>
>
>     # let's take newer, problematic setuptools
>
>     $ pip install -U setuptools
>
>     $ pip list
>
>     PackageVersion
>
>     -----------------
>
>     pip22.0.4
>
>     setuptools61.0.0
>
>     wheel0.37.1
>
>
>     # existing release from pypi.org <http://pypi.org> fails
>
>
>     $ pip install gdal==3.2.2
>
>
>     Collecting gdal==3.2.2
>
>     Downloading GDAL-3.2.2.tar.gz (601 kB)
>
>     ???????????????????????????????????????? 601.7/601.7 KB 8.0 MB/s
>     eta 0:00:00
>
>     Preparing metadata (setup.py) ... error
>
>     error: subprocess-exited-with-error
>
>
>     ? python setup.py egg_info did not run successfully.
>
>     ? exit code: 1
>
>     ??> [6 lines of output]
>
>     WARNING: numpy not available!Array support will not be enabled
>
>     /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
>     UserWarning: Unknown distribution option: 'use_2to3_fixers'
>
>     warnings.warn(msg)
>
>     /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
>     UserWarning: Unknown distribution option: 'use_2to3_exclude_fixers'
>
>     warnings.warn(msg)
>
>     error in GDAL setup command: use_2to3 is invalid.
>
>     [end of output]
>
>
>     note: This error originates from a subprocess, and is likely not a
>     problem with pip.
>
>     error: metadata-generation-failed
>
>
>     ? Encountered error while generating package metadata.
>
>     ??> See above for output.
>
>
>     note: This is an issue with the package mentioned above, not pip.
>
>     hint: See above for details.
>
>     # installing newer one from test.pypi.org <http://test.pypi.org>
>     works fine!
>
>     $ pip install -i https://test.pypi.org/simple/ GDAL==3.2.2.1
>
>
>     Looking in indexes: https://test.pypi.org/simple/
>
>     Collecting GDAL==3.2.2.1
>
>     Downloading
>     https://test-files.pythonhosted.org/packages/b7/02/4356dbdabf8f4fa898fe2378c8c096df3da254508ec8bc0663920cf4b92d/GDAL-3.2.2.1.tar.gz
>     (600 kB)
>
>     ???????????????????????????????????????? 600.9/600.9 KB 8.2 MB/s
>     eta 0:00:00
>
>     Preparing metadata (setup.py) ... done
>
>     Building wheels for collected packages: GDAL
>
>     Building wheel for GDAL (setup.py) ... done
>
>     Created wheel for GDAL:
>     filename=GDAL-3.2.2.1-cp37-cp37m-linux_x86_64.whl size=816416
>     sha256=0209dc3c56cd626137c53187c4a8fb7758587c9030cf8d479d8a2c7864fd5c77
>
>     Stored in directory:
>     /root/.cache/pip/wheels/4b/f2/02/0ca533c034c5cc5840d619cd7004f32d3362c04a1c1500d0a1
>
>     Successfully built GDAL
>
>     Installing collected packages: GDAL
>
>     Successfully installed GDAL-3.2.2.1
>
>     WARNING: Running pip as the 'root' user can result in broken
>     permissions and conflicting behaviour with the system package
>     manager. It is recommended to use a virtual environment
>     instead:https://pip.pypa.io/warnings/venv
>
>
>     ```
>
>
> I hope this gives us some confidence that we are on a right track! :)
>
>
> If I should test something else, please let me know! Looking forward 
> for the release on the pypi.org <http://pypi.org>.
>
>
> Thank you again!!
>
>
> Regards,
>
> Snehal
>
>
>
> On Fri, Mar 25, 2022 at 1:45 PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     ok, I missed this was on the pypi package.
>
>     I've tried to make a patch over 3.2.2. For now, I've uploaded it
>     only to https://test.pypi.org/project/GDAL/3.2.2.1/ . Can you test
>     that and confirm that works properly ? If so, I'll push it to pypi
>     official.
>
>     I've tracked the changes in a patch/3.2.2.1 <http://3.2.2.1>
>     branch, sitting for now in my fork:
>
>     https://github.com/OSGeo/gdal/compare/v3.2.2..rouault:patch/3.2.2.1?expand=1
>
>     I'll push that to OSGeo/gdal as well and tag once confirmed things
>     work fine
>
>     Hoping I'm not going into troubles doing this stuff outside of our
>     usual release processes...
>
>     Even
>
>     Le 25/03/2022 ? 13:13, snehal waychal a ?crit?:
>>
>>     Dear Even, dear Bas,
>>
>>
>>     Thank you very much for the quick response and highlightingthe
>>     Debian/Ubuntu release policy aspects. And also about the link to
>>     the ubuntugis-unstable PPA.
>>
>>
>>     >/what you discuss here is all about the patch & backport policy
>>     of the/
>>
>>     >/Debian GDAL package. You can try to file a bug to Debian and
>>     point to/
>>
>>     >/the patch you'd want to see backported,/
>>
>>
>>     But just to be sure I haven?t misunderstoodyour response or
>>     misrepresented the original issue. The patch release I described
>>     is also needed in the official releases of the GDAL **python**
>>     package. If I am not mistaken, the GDAL team is taking care of
>>     source distributions on https://pypi.org/project/GDAL/
>>     <https://pypi.org/project/GDAL/>. I looked into released pypi
>>     versions and if I am not mistaken there is no patch release for
>>     v3.2.2 with fix for setuptools compatibility issue.
>>
>>
>>     So, if we could make a new patch release of the/*python* package
>>     of GDAL/ and push the sdist package to pypi.org <http://pypi.org>
>>     (something like 3.2.2.1, as I described in the previous email)
>>     then that would also solve the issue. Because as python
>>     developers, we install *python* packages via pip/pipenv/poetry
>>     and those package managers would pick the new patch release from
>>     pypi.org <http://pypi.org>. (The GDAL library component
>>     libgdal-dev v3.2.2 will still come from the debian system package
>>     repo and there is no issue with that).
>>
>>
>>     Hope I am not missing something obvious here. Please let me know.
>>
>>
>>     Thank you again!
>>
>>
>>     Regards,
>>
>>     Snehal
>>
>>
>>     On Fri, Mar 25, 2022 at 12:29 PM Sebastiaan Couwenberg
>>     <sebastic at xs4all.nl> wrote:
>>
>>         On 3/25/22 12:07, Even Rouault wrote:
>>         > what you discuss here is all about the patch & backport
>>         policy of the
>>         > Debian GDAL package. You can try to file a bug to Debian
>>         and point to
>>         > the patch you'd want to see backported, but I can't promise
>>         if there
>>         > would be interest in their maintenance team to create an
>>         updated package
>>         > with it (my understanding is that even if we'd release a
>>         new 3.2.x patch
>>         > release, it wouldn't be packaged in LTS distributions. I'm
>>         not sure how
>>         > much of that is linked to Debian policy or availability of
>>         people that
>>         > do the work)
>>
>>         Packages in Debian stable releases only get updates to fix
>>         bugs of
>>         severity important or higher [0]. GDAL patch releases also
>>         contain
>>         changes for lower severity issues, it's not worth the effort
>>         to vet all
>>         those changes. Any changes to packages in stable also risk
>>         introducing
>>         regressions which are highly undesirable in LTS releases
>>         known for their
>>         stability.
>>
>>         People should be maintaining their own packaging repositories
>>         where they
>>         host packages with changes for their needs that cannot be easily
>>         upstreamed to the package in the distribution itself.
>>         Scratching your
>>         own itch was a corner stone of Open Source that people are
>>         seemingly
>>         forgetting or never having known about in the first place.
>>
>>         [0]
>>         https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions
>>
>>         Kind Regards,
>>
>>         Bas
>>
>>         -- 
>>         ? GPG Key ID: 4096R/6750F10AE88D4AF1
>>         Fingerprint: 8182 DE41 7056 408D 6146? 50D1 6750 F10A E88D 4AF1
>>         _______________________________________________
>>         gdal-dev mailing list
>>         gdal-dev at lists.osgeo.org
>>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
Momtchil Momtchev<momtchil at momtchev.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220325/323bebdf/attachment-0001.html>

From snehal.waychal at gmail.com  Sun Mar 27 06:37:34 2022
From: snehal.waychal at gmail.com (snehal waychal)
Date: Sun, 27 Mar 2022 15:37:34 +0200
Subject: [gdal-dev] About bug fix / patch release policy for older GDAL
 versions (setuptools >= 58.0 and GDAL <3.3 compatibility issues)
In-Reply-To: <c50a64dd-1b21-162e-3b5e-3198ff6a3336@momtchev.com>
References: <CAPaOVv6taMf0V5_Z4H4tAre7Xu2EEVNzX+9s4w31hz-1qhN44w@mail.gmail.com>
 <15ba1b9d-9984-b728-23a3-e8c71b023967@spatialys.com>
 <fdcbb763-8936-8b6a-6333-3dba4d2381c5@xs4all.nl>
 <CAPaOVv7qoSR7zg+N9Lt3ytOmzrv5UUzKcHUtKxovUZNLL9tp0Q@mail.gmail.com>
 <ef4bde0c-6f15-63c2-6c75-e552cbf0af66@spatialys.com>
 <CAPaOVv4VtfLHerg9jbEwt+hL7UabET2T9zbKj609_Qk+CEW2_Q@mail.gmail.com>
 <c50a64dd-1b21-162e-3b5e-3198ff6a3336@momtchev.com>
Message-ID: <CAPaOVv4H_wgSXc+KtqEZo13yxRi_1i30zMhXjvxg2kW+ZHo+VA@mail.gmail.com>

Thank you Momtchil for providing additional references including
debbuild-gdal! Currently we do not have such a use case but I see that it
would be useful if we want to upgrade to a newer GDAL version on an
existing distribution. If I am not mistaken, the Dockerfiles are not
updated for Bullseye and especially for Aarch64. Is there someone else now
maintaining these packages for newer Debian distribution? If so, reference
to those could be helpful if I (or someone else) will need to revisit this
in the future.


- Snehal



On Fri, Mar 25, 2022 at 11:40 PM Momtchil Momtchev <momtchil at momtchev.com>
wrote:

>
> If you have lots of Debian servers, what you can do is to use the Debian
> experimental GDAL packages - which are usually up to date with the latest
> version of GDAL - and to set up a Dockerfile to build these for Debian
> stable and then to use reprepro to distribute them to your machines. If you
> have never done this before, you have about 1 day of work to set up
> everything. I did maintain a GDAL distribution for Debian 10 for a few
> years. You can find my Dockerfiles here:
>
> https://github.com/mmomtchev/debbuild-gdal
>
>
> On 25/03/2022 23:24, snehal waychal wrote:
>
> Dear Evan,
>
>
> Oh! thank you very much for a fast test release!
>
>
> I can confirm that released version works as expected. And to be sure,
> here is what/how I have tested:
>
>
> ```
>
> $ docker run -it python:3.7.13-slim-bullseye bash
>
>
> $ apt-get update && apt-get install -y libgdal-dev gcc g++
>
>
> # let's take newer, problematic setuptools
>
> $ pip install -U setuptools
>
> $ pip list
>
> Package       Version
>
> ----------     -------
>
> pip                 22.0.4
>
> setuptools    61.0.0
>
> wheel            0.37.1
>
>
> # existing release from pypi.org fails
>
>
> $ pip install gdal==3.2.2
>
>
> Collecting gdal==3.2.2
>
>   Downloading GDAL-3.2.2.tar.gz (601 kB)
>
>      ???????????????????????????????????????? 601.7/601.7 KB 8.0 MB/s eta
> 0:00:00
>
>   Preparing metadata (setup.py) ... error
>
>   error: subprocess-exited-with-error
>
>
>   ? python setup.py egg_info did not run successfully.
>
>   ? exit code: 1
>
>   ??> [6 lines of output]
>
>       WARNING: numpy not available!  Array support will not be enabled
>
>       /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
> UserWarning: Unknown distribution option: 'use_2to3_fixers'
>
>         warnings.warn(msg)
>
>       /usr/local/lib/python3.7/site-packages/setuptools/_distutils/dist.py:275:
> UserWarning: Unknown distribution option: 'use_2to3_exclude_fixers'
>
>         warnings.warn(msg)
>
>       error in GDAL setup command: use_2to3 is invalid.
>
>       [end of output]
>
>
>   note: This error originates from a subprocess, and is likely not a
> problem with pip.
>
> error: metadata-generation-failed
>
>
> ? Encountered error while generating package metadata.
>
> ??> See above for output.
>
>
> note: This is an issue with the package mentioned above, not pip.
>
> hint: See above for details.
>
>
>
>
>
> # installing newer one from test.pypi.org works fine!
>
>
>
> $ pip install -i https://test.pypi.org/simple/ GDAL==3.2.2.1
>
>
> Looking in indexes: https://test.pypi.org/simple/
>
> Collecting GDAL==3.2.2.1
>
>   Downloading
> https://test-files.pythonhosted.org/packages/b7/02/4356dbdabf8f4fa898fe2378c8c096df3da254508ec8bc0663920cf4b92d/GDAL-3.2.2.1.tar.gz
> (600 kB)
>
>      ???????????????????????????????????????? 600.9/600.9 KB 8.2 MB/s eta
> 0:00:00
>
>   Preparing metadata (setup.py) ... done
>
> Building wheels for collected packages: GDAL
>
>   Building wheel for GDAL (setup.py) ... done
>
>   Created wheel for GDAL:
> filename=GDAL-3.2.2.1-cp37-cp37m-linux_x86_64.whl size=816416
> sha256=0209dc3c56cd626137c53187c4a8fb7758587c9030cf8d479d8a2c7864fd5c77
>
>   Stored in directory:
> /root/.cache/pip/wheels/4b/f2/02/0ca533c034c5cc5840d619cd7004f32d3362c04a1c1500d0a1
>
> Successfully built GDAL
>
> Installing collected packages: GDAL
>
> Successfully installed GDAL-3.2.2.1
>
> WARNING: Running pip as the 'root' user can result in broken permissions
> and conflicting behaviour with the system package manager. It is
> recommended to use a virtual environment instead:
> https://pip.pypa.io/warnings/venv
>
>
> ```
>
>
> I hope this gives us some confidence that we are on a right track! :)
>
>
> If I should test something else, please let me know! Looking forward for
> the release on the pypi.org.
>
>
> Thank you again!!
>
>
> Regards,
>
> Snehal
>
>
> On Fri, Mar 25, 2022 at 1:45 PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> ok, I missed this was on the pypi package.
>>
>> I've tried to make a patch over 3.2.2. For now, I've uploaded it only to
>> https://test.pypi.org/project/GDAL/3.2.2.1/  . Can you test that and
>> confirm that works properly ? If so, I'll push it to pypi official.
>>
>> I've tracked the changes in a patch/3.2.2.1 branch, sitting for now in
>> my fork:
>>
>>
>> https://github.com/OSGeo/gdal/compare/v3.2.2..rouault:patch/3.2.2.1?expand=1
>>
>> I'll push that to OSGeo/gdal as well and tag once confirmed things work
>> fine
>>
>> Hoping I'm not going into troubles doing this stuff outside of our usual
>> release processes...
>>
>> Even
>> Le 25/03/2022 ? 13:13, snehal waychal a ?crit :
>>
>> Dear Even, dear Bas,
>>
>>
>> Thank you very much for the quick response and highlighting the
>> Debian/Ubuntu release policy aspects. And also about the link to the
>> ubuntugis-unstable PPA.
>>
>>
>> >* what you discuss here is all about the patch & backport policy of
>> the *
>>
>> >* Debian GDAL package. You can try to file a bug to Debian and point
>> to *
>>
>> >* the patch you'd want to see backported,*
>>
>>
>> But just to be sure I haven?t misunderstood your response or
>> misrepresented the original issue. The patch release I described is also
>> needed in the official releases of the GDAL **python** package. If I am
>> not mistaken, the GDAL team is taking care of source distributions on
>> https://pypi.org/project/GDAL/. I looked into released pypi versions and
>> if I am not mistaken there is no patch release for v3.2.2 with fix for
>> setuptools compatibility issue.
>>
>>
>> So, if we could make a new patch release of the* *python* package of
>> GDAL* and push the sdist package to pypi.org (something like 3.2.2.1, as
>> I described in the previous email) then that would also solve the issue.
>> Because as python developers, we install *python* packages via
>> pip/pipenv/poetry and those package managers would pick the new patch
>> release from pypi.org. (The GDAL library component libgdal-dev v3.2.2
>> will still come from the debian system package repo and there is no issue
>> with that).
>>
>>
>> Hope I am not missing something obvious here. Please let me know.
>>
>>
>> Thank you again!
>>
>>
>> Regards,
>>
>> Snehal
>>
>> On Fri, Mar 25, 2022 at 12:29 PM Sebastiaan Couwenberg <
>> sebastic at xs4all.nl> wrote:
>>
>>> On 3/25/22 12:07, Even Rouault wrote:
>>> > what you discuss here is all about the patch & backport policy of the
>>> > Debian GDAL package. You can try to file a bug to Debian and point to
>>> > the patch you'd want to see backported, but I can't promise if there
>>> > would be interest in their maintenance team to create an updated
>>> package
>>> > with it (my understanding is that even if we'd release a new 3.2.x
>>> patch
>>> > release, it wouldn't be packaged in LTS distributions. I'm not sure
>>> how
>>> > much of that is linked to Debian policy or availability of people that
>>> > do the work)
>>>
>>> Packages in Debian stable releases only get updates to fix bugs of
>>> severity important or higher [0]. GDAL patch releases also contain
>>> changes for lower severity issues, it's not worth the effort to vet all
>>> those changes. Any changes to packages in stable also risk introducing
>>> regressions which are highly undesirable in LTS releases known for their
>>> stability.
>>>
>>> People should be maintaining their own packaging repositories where they
>>> host packages with changes for their needs that cannot be easily
>>> upstreamed to the package in the distribution itself. Scratching your
>>> own itch was a corner stone of Open Source that people are seemingly
>>> forgetting or never having known about in the first place.
>>>
>>> [0]
>>>
>>> https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions
>>>
>>> Kind Regards,
>>>
>>> Bas
>>>
>>> --
>>>   GPG Key ID: 4096R/6750F10AE88D4AF1
>>> Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> Momtchil Momtchev <momtchil at momtchev.com> <momtchil at momtchev.com>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220327/3b224bd4/attachment-0001.html>

From lelong.ph at meltemus.com  Mon Mar 28 05:58:03 2022
From: lelong.ph at meltemus.com (Philippe Lelong)
Date: Mon, 28 Mar 2022 12:58:03 +0000
Subject: [gdal-dev] Memory allocation issues on Android 11+ and scudo
Message-ID: <4a02d507464245a9927fa96256baf66e@meltemus.com>

Hi,


I am searching for this issue for months now, and cannot find any solution.

To make a long story short, we are using GDAL to decode OGR/S57 charts for years now. We are facing numerous crashes under Android 11 and up if and only if this Android 11 implementation is using SCUDO as a memory allocator (if jemalloc is used no problems). We face this problem with an old GDAL2.1.3 version, so we updated to GDAL 3.4.1 but the issue is the same.


What I can see is that the memory grows exponentially until no more memory is available and crash, even on systems with huge memory available while an Android device without SCUDO and very limited memory (let's say 4Gb) in the same exact conditions, with the same apk, runs perfectly. The logcat command show this:



03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.612   630   630 D io_stats: !@ Write_top(KB): kworker/u16:1(32583) 8
03-28 12:40:34.820  4959  5041 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5042 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5033 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5031 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5038 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5040 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes

and then crash

Any help on how to debug and eventually fix this would be highly appreciated.

Best regards,
Philippe from qtVlm development team.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220328/84665a76/attachment.html>

From gdt at lexort.com  Mon Mar 28 06:16:30 2022
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 28 Mar 2022 09:16:30 -0400
Subject: [gdal-dev] Memory allocation issues on Android 11+ and scudo
In-Reply-To: <4a02d507464245a9927fa96256baf66e@meltemus.com> (Philippe
 Lelong's message of "Mon, 28 Mar 2022 12:58:03 +0000")
References: <4a02d507464245a9927fa96256baf66e@meltemus.com>
Message-ID: <rmitubi6wup.fsf@s1.lexort.com>


Philippe Lelong <lelong.ph at meltemus.com> writes:

> What I can see is that the memory grows exponentially until no more
> memory is available and crash, even on systems with huge memory
> available while an Android device without SCUDO and very limited
> memory (let's say 4Gb) in the same exact conditions, with the same
> apk, runs perfectly. The logcat command show this:

You said "exponentially" but you didn't attach a graph of usage, so I
have no idea if you really mean exponentially and what exponent :-)

I also can't tell what "huge memory" means and if that's android or not.

You didn't give the build recipe; I'm assuming this is inside an apk
using NDK, but it could be within termux.

> 03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
> 03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
> 03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
> 03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
> 03-28 12:40:34.612   630   630 D io_stats: !@ Write_top(KB): kworker/u16:1(32583) 8
> 03-28 12:40:34.820  4959  5041 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
> 03-28 12:40:34.820  4959  5042 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
> 03-28 12:40:34.820  4959  5033 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
> 03-28 12:40:34.820  4959  5031 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
> 03-28 12:40:34.820  4959  5038 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
> 03-28 12:40:34.820  4959  5040 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes

It seems obvious that you should use some kind of malloc debugging that
has a trace of malloc/free to a log and then postprocess it.

Keep in mind that the bug could be in this other allocator.  I'm not
saying it's likely, just that it's best not to make assumptions.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220328/da734496/attachment.sig>

From even.rouault at spatialys.com  Mon Mar 28 06:24:02 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 28 Mar 2022 15:24:02 +0200
Subject: [gdal-dev] Memory allocation issues on Android 11+ and scudo
In-Reply-To: <4a02d507464245a9927fa96256baf66e@meltemus.com>
References: <4a02d507464245a9927fa96256baf66e@meltemus.com>
Message-ID: <242686ab-582c-d165-d8a4-20de414743b2@spatialys.com>

Hi,

didn't hear about Scudo before, but it seems it is a LLVM side project: 
https://llvm.org/docs/ScudoHardenedAllocator.html

So perhaps you could build and use it on Linux as shown in 
https://llvm.org/docs/ScudoHardenedAllocator.html#library

Besides a potential bug in the allocator, it might be that the S57 
driver has a memory allocation pattern that doesn't please Scudo.

Assuming that the problematic memory allocations are done using GDAL's 
VSIMalloc() (and not C++ new/delete), then have a look at the various 
#define that you can set at the top of port/cpl_vsisimple.cpp and can be 
used to trace memory allocations

// Uncomment to check consistent usage of VSIMalloc(), VSIRealloc(),
// VSICalloc(), VSIFree(), VSIStrdup().
// #define DEBUG_VSIMALLOC

// Uncomment to compute memory usage statistics.
// DEBUG_VSIMALLOC must also be defined.
// #define DEBUG_VSIMALLOC_STATS

// Uncomment to print every memory allocation or deallocation.
// DEBUG_VSIMALLOC must also be defined.
// #define DEBUG_VSIMALLOC_VERBOSE

// Number of bytes of the malloc/calloc/free that triggers a debug trace.
// Can be 0 for all allocs.
#define THRESHOLD_PRINT 10000

Even


Le 28/03/2022 ? 14:58, Philippe Lelong a ?crit?:
>
> Hi,
>
>
> I am searching for this issue for months now, and cannot find any 
> solution.
>
>
> To make a long story short, we are using GDAL to decode OGR/S57 charts 
> for years now. We are facing numerous crashes under Android 11 and up 
> if and only if this Android 11 implementation is using SCUDO as a 
> memory allocator (if jemalloc is used no problems). We face this 
> problem with an old GDAL2.1.3 version, so we updated to GDAL 3.4.1 but 
> the issue is the same.
>
>
> What I can see is that the memory grows exponentially until no more 
> memory is available and crash, even on systems with huge memory 
> available while an Android device without SCUDO and very limited 
> memory (let's say 4Gb) in the same exact?conditions, with the same 
> apk, runs perfectly. The logcat command show this:
>
> 03-28 12:40:34.255? 4959? 5005 W libc? ? : malloc(264196) failed: 
> returning null pointer
> 03-28 12:40:34.255? 4959? 5005 W libc? ? : malloc(264196) failed: 
> returning null pointer
> 03-28 12:40:34.256? 4959? 5005 W libc? ? : malloc(264196) failed: 
> returning null pointer
> 03-28 12:40:34.256? 4959? 5005 W libc? ? : malloc(264196) failed: 
> returning null pointer
> 03-28 12:40:34.612? ?630? ?630 D io_stats: !@ Write_top(KB): 
> kworker/u16:1(32583) 8
> 03-28 12:40:34.820? 4959? 5041 I scudo? ?: Scudo ERROR: out of memory 
> trying to allocate 64 bytes
> 03-28 12:40:34.820? 4959? 5042 I scudo? ?: Scudo ERROR: out of memory 
> trying to allocate 64 bytes
> 03-28 12:40:34.820? 4959? 5033 I scudo? ?: Scudo ERROR: out of memory 
> trying to allocate 64 bytes
> 03-28 12:40:34.820? 4959? 5031 I scudo? ?: Scudo ERROR: out of memory 
> trying to allocate 64 bytes
> 03-28 12:40:34.820? 4959? 5038 I scudo? ?: Scudo ERROR: out of memory 
> trying to allocate 64 bytes
> 03-28 12:40:34.820? 4959? 5040 I scudo? ?: Scudo ERROR: out of memory 
> trying to allocate 64 bytes
>
> and then crash
>
> Any help on how to debug and eventually fix this would be highly 
> appreciated.
>
> Best regards,
> Philippe from qtVlm development team.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220328/7b5f56e9/attachment.html>

From lelong.ph at meltemus.com  Mon Mar 28 06:50:13 2022
From: lelong.ph at meltemus.com (Philippe Lelong)
Date: Mon, 28 Mar 2022 13:50:13 +0000
Subject: [gdal-dev] Memory allocation issues on Android 11+ and scudo
In-Reply-To: <242686ab-582c-d165-d8a4-20de414743b2@spatialys.com>
References: <4a02d507464245a9927fa96256baf66e@meltemus.com>,
 <242686ab-582c-d165-d8a4-20de414743b2@spatialys.com>
Message-ID: <300e56b68efc4b96b17e70c6cd75a655@meltemus.com>

Thanks Even and Greg for your fast replies


The app and GDAL are built with Android NDK 21 (I have tried NDK 30 and 31) and is targeting SDK 30. High memory Android device is 10Gb or even 14Gb with RAM PLUS. I can add that the app itself is based on Qt 5.15.8 and runs fine on Windows, Linux, Raspberry 2/3/4 32bits or 64bits, MacOS, iOS and Android without Scudo. It is heavily multithreaded including during GDAL calls.


I can also add that I have tried a 32bits build (armv7) running on these armV8 devices, same problem, although the messages in logcat are a bit different. I can also say that I am 99.9% sure this is triggered by GDAL, because our same exactly S52/57 module reading other formats without GDAL does not crash.


I have seen these debug defines in cpl_simple.cpp. I will enable them, rebuild and report here. I don't have a scudo device apart from a emulated one but it is x86-64 and it does not seem to behave exactly the same as the users' ARM64 bits (Samsung S21). My feeling is that it is connected to ARM 64 architecture.


Thanks again, more later hopefully.

Philippe.


________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Monday, March 28, 2022 3:24 PM
To: Philippe Lelong; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Memory allocation issues on Android 11+ and scudo


Hi,

didn't hear about Scudo before, but it seems it is a LLVM side project: https://llvm.org/docs/ScudoHardenedAllocator.html

So perhaps you could build and use it on Linux as shown in https://llvm.org/docs/ScudoHardenedAllocator.html#library

Besides a potential bug in the allocator, it might be that the S57 driver has a memory allocation pattern that doesn't please Scudo.

Assuming that the problematic memory allocations are done using GDAL's VSIMalloc() (and not C++ new/delete), then have a look at the various #define that you can set at the top of port/cpl_vsisimple.cpp and can be used to trace memory allocations

// Uncomment to check consistent usage of VSIMalloc(), VSIRealloc(),
// VSICalloc(), VSIFree(), VSIStrdup().
// #define DEBUG_VSIMALLOC

// Uncomment to compute memory usage statistics.
// DEBUG_VSIMALLOC must also be defined.
// #define DEBUG_VSIMALLOC_STATS

// Uncomment to print every memory allocation or deallocation.
// DEBUG_VSIMALLOC must also be defined.
// #define DEBUG_VSIMALLOC_VERBOSE

// Number of bytes of the malloc/calloc/free that triggers a debug trace.
// Can be 0 for all allocs.
#define THRESHOLD_PRINT 10000

Even



Le 28/03/2022 ? 14:58, Philippe Lelong a ?crit :

Hi,


I am searching for this issue for months now, and cannot find any solution.

To make a long story short, we are using GDAL to decode OGR/S57 charts for years now. We are facing numerous crashes under Android 11 and up if and only if this Android 11 implementation is using SCUDO as a memory allocator (if jemalloc is used no problems). We face this problem with an old GDAL2.1.3 version, so we updated to GDAL 3.4.1 but the issue is the same.


What I can see is that the memory grows exponentially until no more memory is available and crash, even on systems with huge memory available while an Android device without SCUDO and very limited memory (let's say 4Gb) in the same exact conditions, with the same apk, runs perfectly. The logcat command show this:



03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.612   630   630 D io_stats: !@ Write_top(KB): kworker/u16:1(32583) 8
03-28 12:40:34.820  4959  5041 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5042 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5033 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5031 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5038 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5040 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes

and then crash

Any help on how to debug and eventually fix this would be highly appreciated.

Best regards,
Philippe from qtVlm development team.




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220328/ba0ddf0a/attachment-0001.html>

From volkanyazici at live.com  Mon Mar 28 07:08:49 2022
From: volkanyazici at live.com (volkan yazici)
Date: Mon, 28 Mar 2022 14:08:49 +0000
Subject: [gdal-dev] Band names when raster stacking
Message-ID: <AS8P191MB16889DBA6552936FCF6A020AB31D9@AS8P191MB1688.EURP191.PROD.OUTLOOK.COM>

Hi,

I use this code for raster stacking:

outvrt = ('result/raster_stack_vrt.tif')
outtif = ('result/raster_stack.tif')
tifs = glob.glob('data/*.tif')
outds = gdal.BuildVRT(outvrt, tifs, separate = True)
outds = gdal.Translate(outtif, outds)

Band names are automatically generated as band_1, band_2.... I want the band names to be the same as the tif names. I found the bandList argument in gdal.BuildVRTOptions but that didn't produce the result I wanted either. How can I make band names automatically generated from the names of tif files?

----
Volkan.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220328/8f0002dc/attachment.html>

From even.rouault at spatialys.com  Mon Mar 28 07:11:57 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 28 Mar 2022 16:11:57 +0200
Subject: [gdal-dev] Band names when raster stacking
In-Reply-To: <AS8P191MB16889DBA6552936FCF6A020AB31D9@AS8P191MB1688.EURP191.PROD.OUTLOOK.COM>
References: <AS8P191MB16889DBA6552936FCF6A020AB31D9@AS8P191MB1688.EURP191.PROD.OUTLOOK.COM>
Message-ID: <63359817-0f6f-3cc2-8b14-1e1beed0285a@spatialys.com>

Known issue: https://github.com/OSGeo/gdal/issues/3627

Le 28/03/2022 ? 16:08, volkan yazici a ?crit?:
> Hi,
>
> I use this code for raster stacking:
>
> outvrt = ('result/raster_stack_vrt.tif')
> outtif = ('result/raster_stack.tif')
> tifs = glob.glob('data/*.tif')
> outds = gdal.BuildVRT(outvrt, tifs, separate = True)
> outds = gdal.Translate(outtif, outds)
>
> Band names are automatically generated as band_1, band_2.... I want 
> the band names to be the same as the tif names. I found the bandList 
> argument in gdal.BuildVRTOptions but that didn't produce the result I 
> wanted either. How can I make band names automatically generated from 
> the names of tif files?
>
> ----
> Volkan.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220328/f281afa8/attachment.html>

From sriddell at geocue.com  Mon Mar 28 11:37:08 2022
From: sriddell at geocue.com (Steve Riddell)
Date: Mon, 28 Mar 2022 18:37:08 +0000
Subject: [gdal-dev] OGRCreateCoordinateTransformation()
In-Reply-To: <79889ab4-7ae3-7395-4fa8-117f5cb61859@spatialys.com>
References: <BN6PR01MB2404FCA6CCDEA6EC80A54C1DA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <d252d733-fd7d-bf6a-9ea4-b87577281b08@spatialys.com>
 <BN6PR01MB2404EB72D07D505A7311929AA6139@BN6PR01MB2404.prod.exchangelabs.com>
 <CY4PR01MB2406A2CE96E342DD7E5D795FA6189@CY4PR01MB2406.prod.exchangelabs.com>
 <69912c61-97a2-c404-9280-2ed71298af37@spatialys.com>
 <BN6PR01MB2404D77116699E1C7F55B982A6199@BN6PR01MB2404.prod.exchangelabs.com>
 <79889ab4-7ae3-7395-4fa8-117f5cb61859@spatialys.com>
Message-ID: <BN6PR01MB2404D7E7315F6F52B450745AA61D9@BN6PR01MB2404.prod.exchangelabs.com>

Hi Even,
Sorry for the delay, but I?ve now tested with PR3216, alone, and then with PR3127.  I?m getting the same behavior as I reported below.   Perhaps my best chance at getting this to work is to either directly make proj calls, or construct the pipeline myself and pass through gdal?
Steve


From: Even Rouault <even.rouault at spatialys.com>
Sent: Thursday, March 24, 2022 10:50 AM
To: Steve Riddell <sriddell at geocue.com>; proj <proj at lists.osgeo.org>
Cc: gdal-dev at lists.osgeo.org
Subject: Re: OGRCreateCoordinateTransformation()


Steve,

(adding proj mailing list since it's actually purely a PROJ topic


Does the fact that there isn?t a consensus mean 3126 & 3127 aren?t going to end up in a PROJ release?



Did you try them to confirm they help ? Maybe if you want to weight in the PRs (if they actually help) that could change the balance.

I read through the PR?s. Are you thinking my issue is that a vertical shift is being introduced because of a transformation to WGS84 (from NAD83(CSRS)) to look up the geoid separation value?
That's probably an issue with the wrong interpolation CRS being used, but I can't generally predict how this complex code works without launching a debugger and step-by-step tracing what happens.


PROJ4_GRIDS provided a way to specify exactly which geoid file(s) to use.  Some vertical datums, such as NAVD88, only have a single EPSG code for multiple geoids ? what?s the replacement for PROJ4_GRIDS in PROJ9?  If I could switch to WKT2 strings (not sure that?s really feasible) does it fix these problems?
WKT2 hardly helps for that. The closest equivalent is the GEOIDMODEL[] sub node of a VERTCRS[] (http://docs.opengeospatial.org/is/18-010r7/18-010r7.html#83). But that's something that refer to an existing transformation . And in a VRTCRS[] you can actually have several GEOIDMODEL[] listed (e.g. for NAVD88, all the geoid models), since that's more a definition of the VertCRS than which particular geoid model to use. So that's not nominally appropriate for a "random" grid not known of PROJ, although we have a bit bent the concept to allow a GEOIDMODEL["PROJ name_of_the_grid_dot_tif_or_gtx"]. But I would suspect that in that situation the ambiguity with the geographic / interpolation CRS to use would be similar to WKT1 PROJ4_GRIDS.


Thanks,
steve

From: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>
Sent: Wednesday, March 23, 2022 6:06 PM
To: Steve Riddell <sriddell at geocue.com><mailto:sriddell at geocue.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: OGRCreateCoordinateTransformation()


Steve,

you may try PR https://github.com/OSGeo/PROJ/pull/3126 or https://github.com/OSGeo/PROJ/pull/3127, that might potentially help, but they don't make consensus (see discussions of those PRs). Basically it is a nightmare to deal with the old TOWGS84 / PROJ4_GRIDS approach, that poorly specifies some elements of transformations (especially the vertical part), and doesn't fit well in the ISO-19111 model used by newer PROJ (we use and abuse the BoundCRS approach in complex ways). One of the issue too is that we've realized late in the process that we didn't emulate some aspects of the old transformation pipeline, and there isn't general enthusiasm to change that now.

Even
Le 23/03/2022 ? 23:42, Steve Riddell a ?crit :
Hi Even,

I tried the fix with the CRS?s I sent, and it worked. But as I mentioned, my real target CRS is a custom projected system (below), and it still fails with what seems to be the same error as in my original email.

COMPD_CS["TempTM + CGVD28 height - HT2_0",
    PROJCS["Custom",
        GEOGCS["NAD83(CSRS)",
            DATUM["NAD83_Canadian_Spatial_Reference_System",
                SPHEROID["GRS 1980",6378137,298.257222101,
                    AUTHORITY["EPSG","7019"]],
                TOWGS84[0,0,0,0,0,0,0],
                AUTHORITY["EPSG","6140"]],
            PRIMEM["Greenwich",0,
                AUTHORITY["EPSG","8901"]],
            UNIT["degree",0.0174532925199433,
                AUTHORITY["EPSG","9122"]],
            AUTHORITY["EPSG","4617"]],
        PROJECTION["Transverse_Mercator"],
        PARAMETER["latitude_of_origin",49.351346659616],
        PARAMETER["central_meridian",-123.20266499149],
        PARAMETER["scale_factor",1],
        PARAMETER["false_easting",15307.188],
        PARAMETER["false_northing",6540.975],
        UNIT["Meters",1],
        AXIS["Easting",EAST],
        AXIS["Northing",NORTH]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]

Experimenting, I removed the ?TOWGS84? directive from BOTH the source and target systems, and I do get an answer instead of an error:

For test point: (49.351346658, -123.202664992, 289.809)
I get: (15307.1880,6540.9748,307.744)

But since geoid separation at the test point is -18.238, Z should be 308.047.  In fact, if I code up the following pipeline and initialize a transform object:

strPipe = "+proj=pipeline\
        +step +proj=axisswap +order=2, 1\
        +step +proj=unitconvert +xy_in=deg +xy_out=rad\
        +step +inv +proj=vgridshift +grids=HT2_0.gtx +multiplier=1\
        +step +proj=tmerc +lat_0=49.351346659616 +lon_0=-123.20266499149 +k=1\
        +x_0=15307.188 +y_0=6540.975 +ellps=GRS80";

The call to Transform() gives: (15307.1880, 6540.9748, 308.042)   -- XY matches above, but now I get the expected Z (-0.005).  However, I?d like to avoid assembling pipelines for every conversion/transform.

Any arrows left in your quiver?

Thanks,
Steve



From: Steve Riddell
Sent: Friday, March 18, 2022 6:17 PM
To: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: RE: OGRCreateCoordinateTransformation()

Thanks very much, Even.  For reporting the problem, I ?packaged up? a case with CRS?s with EPGS codes. For the actual problem I?m working, the target CRS is a custom projection ?no EPSG.

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Friday, March 18, 2022 5:05 PM
To: Steve Riddell <sriddell at geocue.com<mailto:sriddell at geocue.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: OGRCreateCoordinateTransformation()


Steve,

Fix in PROJ queued in https://github.com/OSGeo/PROJ/pull/3123

The complexity of dealing with legacy features TOWGS84[] and PROJ4_GRIDS is highly stressing PROJ pipeline computation engine.

Using the plain EPSG codes  EPSG:4955 -> EPSG:4617+5713 would be much preferable here

Even
Le 18/03/2022 ? 21:14, Steve Riddell a ?crit :
Hi,

I?m getting an error (below) using GDAL trying to set up a transformation between NAD83(CSRS) geodetic, w/ ellipsoidal heights, and NAD83(CSRS) geodetic, CGVD28 heights. Similar transformations work fine on some datums,  but fail on others.  Hope someone can offer some insight.  Note the if I don't use the PROJ4_GRIDS extension, I don't get the error, but I don't get the geoid adjustment either.

COMPD_CS["NAD83(CSRS) + Ellipsoid (Meters)",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["Ellipsoid (Meters)",
        VERT_DATUM["Ellipsoid",2002],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["ellipsoidal height",UP]]]

COMPD_CS["NAD83(CSRS) + CGVD28 height - HT2_0",
    GEOGCS["NAD83(CSRS)",
        DATUM["NAD83_Canadian_Spatial_Reference_System",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6140"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4617"]],
    VERT_CS["CGVD28 height - HT2_0",
        VERT_DATUM["Canadian Geodetic Vertical Datum of 1928",2005,
            EXTENSION["PROJ4_GRIDS","HT2_0.gtx"],
            AUTHORITY["EPSG","5114"]],
        UNIT["metre",1,
            AUTHORITY["EPSG","9001"]],
        AXIS["Gravity-related height",UP],
        AUTHORITY["EPSG","5713"]]]


ERROR 6: Cannot find coordinate operations from `EPSG:4955' to `COMPOUNDCRS["NAD83(CSRS) + CGVD28 height - HT2_0",BOUNDCRS[SOURCECRS[GEOGCRS["NAD83(CSRS)",DATUM["NAD83 Canadian Spatial Reference System",ELLIPSOID["GRS 1980",6378137,298.257222101,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["geodetic latitude (Lat)",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["geodetic longitude (Lon)",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4617]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,2],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]]],ABRIDGEDTRANSFORMATION["Transformation from NAD83(CSRS) to WGS84",METHOD["Position Vector transformation (geog2D domain)",ID["EPSG",9606]],PARAMETER["X-axis translation",0,ID["EPSG",8605]],PARAMETER["Y-axis translation",0,ID["EPSG",8606]],PARAMETER["Z-axis translation",0,ID["EPSG",8607]],PARAMETER["X-axis rotation",0,ID["EPSG",8608]],PARAMETER["Y-axis rotation",0,ID["EPSG",8609]],PARAMETER["Z-axis rotation",0,ID["EPSG",8610]],PARAMETER["Scale difference",1,ID["EPSG",8611]]]],BOUNDCRS[SOURCECRS[VERTCRS["CGVD28 height - HT2_0",VDATUM["Canadian Geodetic Vertical Datum of 1928"],CS[vertical,1],AXIS["gravity-related height",up,LENGTHUNIT["metre",1]],ID["EPSG",5713]]],TARGETCRS[GEOGCRS["WGS 84",DATUM["World Geodetic System 1984",ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],CS[ellipsoidal,3],AXIS["latitude",north,ORDER[1],ANGLEUNIT["degree",0.0174532925199433]],AXIS["longitude",east,ORDER[2],ANGLEUNIT["degree",0.0174532925199433]],AXIS["ellipsoidal height",up,ORDER[3],LENGTHUNIT["metre",1]],ID["EPSG",4979]]],ABRIDGEDTRANSFORMATION["CGVD28 height - HT2_0 to WGS84 ellipsoidal height",METHOD["GravityRelatedHeight to Geographic3D"],PARAMETERFILE["Geoid (height correction) model file","HT2_0.gtx",ID["EPSG",8666]]]]]'



Thanks in advance for any assistance!

Best regards,

Steve



Steve Riddell
Software Engineering
GeoCue Group, Inc.
520 6th Street | Madison, AL 35756 USA
Phone: 256.461.8289 | Fax: 256.461.8249
LIDAR/Drone Mapping Software & Services ? True View? 3D Imaging Sensors ? Image/LIDAR Data Management Solutions
 www.geocue.com<http://www.geocue.com/>  support.geocue.com<https://support.geocue.com/>





--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220328/fd7290bd/attachment-0001.html>

From lelong.ph at meltemus.com  Mon Mar 28 22:15:00 2022
From: lelong.ph at meltemus.com (Philippe Lelong)
Date: Tue, 29 Mar 2022 05:15:00 +0000
Subject: [gdal-dev] Memory allocation issues on Android 11+ and scudo
In-Reply-To: <300e56b68efc4b96b17e70c6cd75a655@meltemus.com>
References: <4a02d507464245a9927fa96256baf66e@meltemus.com>,
 <242686ab-582c-d165-d8a4-20de414743b2@spatialys.com>,
 <300e56b68efc4b96b17e70c6cd75a655@meltemus.com>
Message-ID: <97af754a281742a6b04b818d52f64f55@meltemus.com>

Hi,

I have some results.


First of all note that fprintf(stderr,...)  does nothing on Android since it is redirected to /dev/null. I had to modify cpl_simple.txt in order to use

__android_log_print(ANDROID_LOG_INFO,LOG_TAG, ... instead.


You can find the full logs here: https://www.virtual-winds.org/maitai/gdal_crash.zip


Here is the end of one of them, just before the crash:



03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIRealloc(0x7736492fd0, 14768) = 0x7736489630, current_cumul = 22725820, mal+cal-free = 163282
03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIRealloc(0x7736489630, 14784) = 0x7736489630, current_cumul = 22725836, mal+cal-free = 163282
03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIMalloc(14784) = 0x773645f620, current_cumul = 22740668, mal+cal-free = 163283
03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIRealloc(0x773645f620, 14800) = 0x773645f620, current_cumul = 22740684, mal+cal-free = 163284
03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIRealloc(0x773645f620, 29568) = 0x7736455c60, current_cumul = 22755452, mal+cal-free = 163284
03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIRealloc(0x7736455c60, 29584) = 0x7736455c60, current_cumul = 22755468, mal+cal-free = 163284
03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIFree(0x773669f630, (14784 bytes))
03-28 21:02:14.430 20211 20268 E GDAL_VSI: Thread[0x7765183cb0] VSIFree(0x7736489630, (14784 bytes))
03-28 21:02:14.431  1781  5039 D BtGatt.ContextMap: remove() - id: 10
03-28 21:02:14.431  1781  5039 E BtGatt.ContextMap: remove() - removed: 10
03-28 21:02:14.432  1323  1567 D ActivityManager: Received SERVICE intent 0xa7cee6b Key{startService pkg=com.sec.android.app.shealth intent=act=com.samsung.android.app.shealth.tracker.pedometer.PedometerService.HBA cmp=com.sec.android.app.shealth/com.samsung.android.app.shealth.tracker.pedometer.service.PedometerService flags=0x0 u=0} requestCode=0 from uid 1000
03-28 21:02:14.433  1781  3013 I bt_stack: [INFO:gatt_api.cc(1102)] GATT_Deregister gatt_if=10
03-28 21:02:14.434  3224  3224 W [MCFServer]_BleAdapterCallbackManager: onCallbackDied - client was dead, unregister bleAdapter callback appId:17
03-28 21:02:14.435  3224  3224 I [MCFServer]_McfMainController: destroyBleAdapter - appId=17 , mBleAdapterCallbacks size:0
03-28 21:02:14.435  3224  3224 I [MCFServer]_McfMainController: destroyBleAdapter - mBleAdapterCallbacks is empty, destroyBleAdapterManager after 3s
03-28 21:02:14.435  1781  3013 I bt_stack: [INFO:gatt_api.cc(1155)] Initialize tGATT_REG
03-28 21:02:14.438  1781  2610 E BtGatt.GattService: [GSIM LOG]: gsimLogHandler, msg: MESSAGE_SCAN_STOP, appName: com.samsung.android.mcfserver, scannerId: 10, reportDelayMillis=0
03-28 21:02:14.440  1323  1567 V SamsungAlarmManager: setLocked to kernel - W:94823351 / NW:94183790, now=94162423
03-28 21:02:14.441  1323  1323 W Looper  : Drained
03-28 21:02:14.441  1323  3033 W LocationManagerService: onFreezeStateChanged, uid[10400]=false
03-28 21:02:14.441  1323  3033 I PowerManagerService: [PWL] SetWakeLockEnableDisable uid = 10400 , disable= false
03-28 21:02:14.441  1323  3033 I PowerManagerService: [PWL] can not change uid =  10400
03-28 21:02:14.442  1323  1360 V SamsungAlarmManager: setLocked to kernel - W:94823351 / NW:94183790, now=94162425
03-28 21:02:14.444  1323  1546 W system_server: Long monitor contention with owner AlarmManager (1567) at void com.android.server.alarm.AlarmManagerService$AlarmThread.run()(AlarmManagerService.java:5025) waiters=0 in void com.android.server.alarm.AlarmManagerService$DeliveryTracker.alarmComplete(android.os.IBinder) for 296ms
03-28 21:02:14.444   857   857 D Zygote  : Forked child process 21000
03-28 21:02:14.444  1323  3033 W LocationManagerService: onFreezeStateChanged, uid[10301]=false
03-28 21:02:14.445  1323  3033 I PowerManagerService: [PWL] SetWakeLockEnableDisable uid = 10301 , disable= false
03-28 21:02:14.445  1323  1432 I ActivityManager: Start proc 21000:android:drmService/1000 for service {android/com.android.server.DrmEventService}
03-28 21:02:14.445  1323  3033 I PowerManagerService: [PWL] can not change uid =  10301
03-28 21:02:14.445  1323  1431 W BroadcastQueue: Skipping deliver [background] BroadcastRecord{9698798 u-1 android.intent.action.BATTERY_CHANGED} to ReceiverList{8e48bc4 19599 com.facebook.orca/10400/u0 remote:393b6d7}: process gone or crashing
03-28 21:02:14.445  1323  1431 W BroadcastQueue: Skipping deliver [background] BroadcastRecord{9698798 u-1 android.intent.action.BATTERY_CHANGED} to ReceiverList{687dc5e 19599 com.facebook.orca/10400/u0 remote:b49e199}: process gone or crashing
03-28 21:02:14.446  1323  1431 W BroadcastQueue: Skipping deliver [background] BroadcastRecord{cf3bf1 u-1 android.intent.action.BATTERY_CHANGED} to ReceiverList{26d4e3d 19145 com.facebook.katana/10301/u0 remote:87e8394}: process gone or crashing
03-28 21:02:14.446  1323  3033 W LocationManagerService: onFreezeStateChanged, uid[10382]=false
03-28 21:02:14.446  1323  3033 I PowerManagerService: [PWL] SetWakeLockEnableDisable uid = 10382 , disable= false
03-28 21:02:14.446  1323  3033 I PowerManagerService: [PWL] can not change uid =  10382
03-28 21:02:14.447  1809  1809 D QS      : setQSExpansion 0.0 -122.85
03-28 21:02:14.449  8549  8549 I PedometerService: onStartCommand  true, true, true, 1648400236406, 1648400236842, false, false
03-28 21:02:14.451  1809  1809 V SecQSFragmentAnimatorBase: setQsExpansionPosition 0.0
03-28 21:02:14.451  1809  1809 V QsExpandAnimator: setQsExpansionPosition 0.0 0
03-28 21:02:14.451  1323  1431 W BroadcastQueue: Skipping deliver [background] BroadcastRecord{cf3bf1 u-1 android.intent.action.BATTERY_CHANGED} to ReceiverList{86abcc6 19145 com.facebook.katana/10301/u0 remote:8f3e2a1}: process gone or crashing
03-28 21:02:14.452  1323  1360 D SamsungAlarmManager: setInexact (T:3/F:0/AC:false) 20220329T000214 now=94162435 - CU:10251/CP:2699/OP:PendingIntent{9e623d6: PendingIntentRecord{650d89a com.google.android.gms/com.google.android.gms.tron broadcastIntent}}
03-28 21:02:14.452  1323  1360 V SamsungAlarmManager: setLocked to kernel - W:94823351 / NW:94183790, now=94162435
03-28 21:02:14.457  1323  2605 D SemContextService: lock : requestToUpdate
03-28 21:02:14.458  1323  2605 D SemContext.CaeProvider.SensorStatusCheckImpl: Sensor Check Event is null!!
03-28 21:02:14.458  1323  2605 D SemContextService:     .requestToUpdate() : service = Sensor Status Check
03-28 21:02:14.458  1323  2605 D SemContextService: unlock : requestToUpdate
03-28 21:02:14.464  1809  1809 D QS      : setQSExpansion 0.0 -122.85
03-28 21:02:14.466  8549 31023 I SHEALTH#WI#WearableConnectionMonitor: (print) : getConnectedWearableDeviceList(), size : 1
03-28 21:02:14.466 20211 20264 E GDAL_VSI: Thread[0x776957bcb0] VSIRealloc(0x78ab48f090, 13504) = 0x77341bbb20, current_cumul = 22743760, mal+cal-free = 163385
03-28 21:02:14.466 20211 20264 E GDAL_VSI: Thread[0x776957bcb0] VSIRealloc(0x77341bbb20, 13520) = 0x77341bbb20, current_cumul = 22743776, mal+cal-free = 163385
03-28 21:02:14.470 21000 21000 E android:drmSer: Not starting debugger since process cannot load the jdwp agent.
03-28 21:02:14.471 21000 21000 E USNET   : USNET: appName: android:drmService
03-28 21:02:14.471 21000 21000 D ProcessState: Binder ioctl to enable oneway spam detection failed: Invalid argument
03-28 21:02:14.473   996  1051 I heimdall: insert_task_to_group:64, insert tgid 21000 to group com.google.process.gapps, ret = 0
03-28 21:02:14.476 21000 21000 D ActivityThread: setConscryptValidator
03-28 21:02:14.476 21000 21000 D ActivityThread: setConscryptValidator - put
03-28 21:02:14.479  1323  2605 I ActivityManager: DSS OFF for android
03-28 21:02:14.484  1323  2605 D ActivityManager: attachApplicationLocked() app=ProcessRecord{60e4cac 21000:android:drmService/1000} app.isolatedEntryPoint=null instr2=null
03-28 21:02:14.492  1809  1809 W LooperSlow: RunCallback: type=3, action=android.view.ViewRootImpl$TraversalRunnable at d06ee61, token=null, latencyMillis=918, dur=91ms
03-28 21:02:14.494  1809  1809 D IndicatorGardenInputProperty: updateRotation() prv:-1 >> new:0
03-28 21:02:14.495  1809  1809 D DeviceState: getDeviceResolutionPixelSize - currentDensity = 450 deviceDensity = 450 initialDisplaySizeFactor = 1440 currentDisplaySizeFactor = 1080 initialDisplayDensity = 600 proportionalDensity = 450 proportionalPixel = 72
03-28 21:02:14.495  1809  1809 D DeviceState: getDeviceResolutionPixelSize - currentDensity = 450 deviceDensity = 450 initialDisplaySizeFactor = 1440 currentDisplaySizeFactor = 1080 initialDisplayDensity = 600 proportionalDensity = 450 proportionalPixel = 27
03-28 21:02:14.495  1809  1809 D DeviceState: getDeviceResolutionPixelSize - currentDensity = 450 deviceDensity = 450 initialDisplaySizeFactor = 1440 currentDisplaySizeFactor = 1080 initialDisplayDensity = 600 proportionalDensity = 450 proportionalPixel = 16
03-28 21:02:14.495  1809  1809 E IndicatorGardenAlgorithmBasicCutout: NOT MATCH !!!! resourceHeight:74, cutoutHeight:75 ([IndicatorGardenInputProperty]  Rotation(0-0,90-1,180-2,270-3)0, Density:2.8125, ScreenWidthSize:1080, CoverSidePadding:0, mIndicatorGardenCenterOffset:12, mCameraCutoutCropSize:0, mGardenPaddingStart:23, mIndicatorCornerPadding:72, mCameraSidePadding:27, mCameraTopMargin:16, DpCutout:DisplayCutout{insets=Rect(0, 75 - 0, 0) waterfall=Insets{left=0, top=0, right=0, bottom=0} boundingRect={Bounds=[Rect(0, 0 - 0, 0), Rect(511, 0 - 569, 75), Rect(0, 0 - 0, 0), Rect(0, 0 - 0, 0)]} cutoutPathParserInfo={CutoutPathParserInfo{displayWidth=1080 displayHeight=2400 density={2.8125} cutoutSpec={M 0, 0 H -10.4 V 26.66666666666667 H 10.4 V 0 H 0 Z @dp} rotation={0} scale={1.0}}}})
03-28 21:02:14.495  1809  1809 E IndicatorGardenAlgorithmBasicCutout: NOT MATCH !!!! resourceHeight:74, cutoutHeight:75 ([IndicatorGardenInputProperty]  Rotation(0-0,90-1,180-2,270-3)0, Density:2.8125, ScreenWidthSize:1080, CoverSidePadding:0, mIndicatorGardenCenterOffset:12, mCameraCutoutCropSize:0, mGardenPaddingStart:23, mIndicatorCornerPadding:72, mCameraSidePadding:27, mCameraTopMargin:16, DpCutout:DisplayCutout{insets=Rect(0, 75 - 0, 0) waterfall=Insets{left=0, top=0, right=0, bottom=0} boundingRect={Bounds=[Rect(0, 0 - 0, 0), Rect(511, 0 - 569, 75), Rect(0, 0 - 0, 0), Rect(0, 0 - 0, 0)]} cutoutPathParserInfo={CutoutPathParserInfo{displayWidth=1080 displayHeight=2400 density={2.8125} cutoutSpec={M 0, 0 H -10.4 V 26.66666666666667 H 10.4 V 0 H 0 Z @dp} rotation={0} scale={1.0}}}})
03-28 21:02:14.495 21000 21000 D ActivityThread: handleBindApplication()++ app=android:drmService
03-28 21:02:14.496 21000 21000 D CompatibilityChangeReporter: Compat change id reported: 171979766; UID 1000; state: ENABLED
03-28 21:02:14.505  1809  1809 D SystemUIService: SYSUI_RAM_OPTIMIZATION onTrimMemory=15
03-28 21:02:14.506   583   583 I lmkd    : 2(delay),0(swap), 0(freelimit) memory pressure events were skipped after a kill!
03-28 21:02:14.506  1809  1809 D StatusBar: SYSUI_RAM_OPTIMIZATION onTrimMemory=15
03-28 21:02:14.506  1809  1809 D SystemUIService: onTrimMemory : 15
03-28 21:02:14.506   583   583 I lmkd    : cached 0, sandbox(not0) 0
03-28 21:02:14.506  1809  1809 D SystemUIService: Last Info is 03-28 21:00:08.559. It still remains until reset time. So skip this.
03-28 21:02:14.506  1809  1809 D SystemUIService: SYSUI_RAM_OPTIMIZATION onTrimMemory=15
03-28 21:02:14.506  1809  1809 D StatusBar: SYSUI_RAM_OPTIMIZATION onTrimMemory=15
03-28 21:02:14.506  1809  1809 D SystemUIService: onTrimMemory : 15
03-28 21:02:14.507  1809  1809 D SystemUIService: Last Info is 03-28 21:00:08.559. It still remains until reset time. So skip this.
03-28 21:02:14.507  1809  1809 W Looper  : Slow dispatch took 106ms main h=android.view.Choreographer$FrameHandler c=android.view.Choreographer$FrameDisplayEventReceiver at 15dac12 m=0
03-28 21:02:14.510   583   583 E libprocessgroup: set_timerslack_ns write failed: No such process
03-28 21:02:14.511   583   583 I lmkd    : Reclaim 'android.process.acore' (27861), uid 10071, oom_score_adj 850, state 99 to free 33916kB rss, 56816kB swap; reason: low watermark is breached and swap is low (1848484kB < 838860kB)
03-28 21:02:14.521 20211 20264 E GDAL_VSI: Thread[0x776957bcb0] VSIFree(0x77341bbb20, (13520 bytes))
03-28 21:02:14.533   857   857 I Zygote  : Process 27861 exited due to signal 9 (Killed)
03-28 21:02:14.533  1323  5047 D InputMethodManagerService: removeClient
03-28 21:02:14.533   583   583 I lmkd    : cached 0, sandbox(not0) 0
03-28 21:02:14.535   583   583 E libprocessgroup: set_timerslack_ns write failed: No such process
03-28 21:02:14.537  1323  2310 I ActivityManager: Process android.process.acore (pid 27861) has died: picked CEM (290,316)
03-28 21:02:14.537  1323  1433 I libprocessgroup: Successfully killed process cgroup uid 10071 pid 27861 in 0ms
03-28 21:02:14.538   583   583 I lmkd    : Reclaim 'com.samsung.cmh:CMH' (28089), uid 5004, oom_score_adj 850, state 99 to free 29444kB rss, 53292kB swap; reason: low watermark is breached and swap is low (1863132kB < 838860kB)
03-28 21:02:14.539  1781  1781 D HidDeviceService: handleMessage(): msg.what=8
03-28 21:02:14.540  1809  1809 W LooperSlow: RunCallback: type=3, action=android.view.ViewRootImpl$TraversalRunnable at fe916b9, token=null, latencyMillis=31, dur=31ms
03-28 21:02:14.540  1809  1809 W Looper  : Slow dispatch took 31ms main h=android.view.Choreographer$FrameHandler c=android.view.Choreographer$FrameDisplayEventReceiver at 15dac12 m=0
03-28 21:02:14.541  1809  1809 W Looper  : Drained
03-28 21:02:14.557 20211 20264 E GDAL_VSI: Thread[0x776957bcb0] VSIRealloc(0x789d45b450, 21280) = 0x772f097cc0, current_cumul = 22758320, mal+cal-free = 163504
03-28 21:02:14.557 20211 20264 E GDAL_VSI: Thread[0x776957bcb0] VSIRealloc(0x772f097cc0, 21296) = 0x772f097cc0, current_cumul = 22758336, mal+cal-free = 163504
03-28 21:02:14.558 20211 20269 E GDAL_VSI: Thread[0x7764085cb0] VSIFree(0x7a89741610, (55312 bytes))
03-28 21:02:14.566   857   857 I Zygote  : Process 28089 exited due to signal 9 (Killed)
03-28 21:02:14.566  1323  1553 I ActivityManager: Process com.samsung.cmh:CMH (pid 28089) has died: picked CEM (277,320)
03-28 21:02:14.566   583   583 I lmkd    : cached 0, sandbox(not0) 0
03-28 21:02:14.566 20211 20262 E GDAL_VSI: Thread[0x7770e3dcb0] VSIRealloc(0x7a3f23d980, 57120) = 0x7a3f23d980, current_cumul = 22716708, mal+cal-free = 163501
03-28 21:02:14.566  1323  1433 I libprocessgroup: Successfully killed process cgroup uid 5004 pid 28089 in 0ms
03-28 21:02:14.568  1781  1781 D HidDeviceService: handleMessage(): msg.what=8
03-28 21:02:14.575   583   583 I lmkd    : Reclaim 'com.google.android.gms' (18299), uid 10251, oom_score_adj 800, state 10 to free 41892kB rss, 50312kB swap; reason: low watermark is breached and swap is low (1871592kB < 838860kB)
03-28 21:02:14.588 20983 20983 V GraphicsEnvironment: ANGLE Developer option for 'com.google.android.apps.turbo' set to: 'default'
03-28 21:02:14.594  1809  3054 I OpenGLRenderer: Davey! duration=989ms; Flags=0, FrameTimelineVsyncId=1355581, IntendedVsync=50486826840932, Vsync=50487676840898, InputEventId=0, HandleInputStart=50487682229734, AnimationStart=50487682230811, PerformTraversalsStart=50487682231618, DrawStart=50487777157695, FrameDeadline=50486843507598, FrameInterval=50487682147349, FrameStartTime=16666666, SyncQueued=50487779379772, SyncStart=50487780687541, IssueDrawCommandsStart=50487786418772, SwapBuffers=50487808932657, FrameCompleted=50487817955695, DequeueBufferDuration=1428731, QueueBufferDuration=4194269, GpuCompleted=50487811641964, SwapBuffersCompleted=50487817955695, DisplayPresentTime=0,
03-28 21:02:14.608  1323  2605 D ConnectivityService: ConnectivityService NetworkRequestInfo binderDied(uid/pid:10251/18299, [NetworkRequest [ LISTEN id=3417, [ Transports: WIFI Capabilities: NOT_RESTRICTED&TRUSTED&NOT_VPN&NOT_VCN_MANAGED Uid: 10251 RequestorUid: 10251 RequestorPkg: com.google.android.gms UnderlyingNetworks: Null] ]], android.os.BinderProxy at f2b50f3)
03-28 21:02:14.608   583   583 I lmkd    : cached 0, sandbox(not0) 0
03-28 21:02:14.609   857   857 I Zygote  : Process 18299 exited due to signal 9 (Killed)
03-28 21:02:14.610  1323  2457 D ConnectivityService: ConnectivityService NetworkRequestInfo binderDied(uid/pid:10251/18299, [NetworkRequest [ LISTEN id=3418, [ Transports: WIFI Capabilities: NOT_RESTRICTED&TRUSTED&NOT_VPN&NOT_VCN_MANAGED Uid: 10251 RequestorUid: 10251 RequestorPkg: com.google.android.gms UnderlyingNetworks: Null] ]], android.os.BinderProxy at 70db1b0)
03-28 21:02:14.610  1323  2605 I ActivityManager: Process com.google.android.gms (pid 18299) has died: svc SVC (283,318)
03-28 21:02:14.611  1323  1433 I libprocessgroup: Successfully killed process cgroup uid 10251 pid 18299 in 0ms
03-28 21:02:14.611  1323  2605 W ActivityManager: Scheduling restart of crashed service com.google.android.gms/.cast.service.CastPersistentService in 50492ms for start-requested
03-28 21:02:14.613  1323  5045 E WifiMulticastLockManager: Multicaster binderDied
03-28 21:02:14.615   583   583 E libprocessgroup: set_timerslack_ns write failed: No such process
03-28 21:02:14.616 20211 20267 W libc    : malloc(40) failed: returning null pointer
03-28 21:02:14.616 20211 20263 W libc    : malloc(40) failed: returning null pointer
03-28 21:02:14.616 20211 20266 W libc    : malloc(34) failed: returning null pointer
03-28 21:02:14.616 20211 20269 W libc    : malloc(72) failed: returning null pointer
03-28 21:02:14.616 20211 20268 W libc    : malloc(32) failed: returning null pointer
03-28 21:02:14.616 20211 20262 W libc    : malloc(68) failed: returning null pointer
03-28 21:02:14.616 20211 20264 W libc    : malloc(32) failed: returning null pointer
03-28 21:02:14.617 20211 20265 W libc    : malloc(32) failed: returning null pointer
03-28 21:02:14.617 20211 20269 W libc    : malloc(128) failed: returning null pointer
--------- beginning of crash
03-28 21:02:14.617 20211 20262 F libc    : Fatal signal 6 (SIGABRT), code -1 (SI_QUEUE) in tid 20262 (Thread (pooled)), pid 20211 (.meltemus.qtvlm)
03-28 21:02:14.617 20211 20264 W libc    : malloc(128) failed: returning null pointer

I hope you can understand something, I don't.

Best regards and thank


________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Philippe Lelong <lelong.ph at meltemus.com>
Sent: Monday, March 28, 2022 3:50 PM
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Memory allocation issues on Android 11+ and scudo


Thanks Even and Greg for your fast replies


The app and GDAL are built with Android NDK 21 (I have tried NDK 30 and 31) and is targeting SDK 30. High memory Android device is 10Gb or even 14Gb with RAM PLUS. I can add that the app itself is based on Qt 5.15.8 and runs fine on Windows, Linux, Raspberry 2/3/4 32bits or 64bits, MacOS, iOS and Android without Scudo. It is heavily multithreaded including during GDAL calls.


I can also add that I have tried a 32bits build (armv7) running on these armV8 devices, same problem, although the messages in logcat are a bit different. I can also say that I am 99.9% sure this is triggered by GDAL, because our same exactly S52/57 module reading other formats without GDAL does not crash.


I have seen these debug defines in cpl_simple.cpp. I will enable them, rebuild and report here. I don't have a scudo device apart from a emulated one but it is x86-64 and it does not seem to behave exactly the same as the users' ARM64 bits (Samsung S21). My feeling is that it is connected to ARM 64 architecture.


Thanks again, more later hopefully.

Philippe.


________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Monday, March 28, 2022 3:24 PM
To: Philippe Lelong; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Memory allocation issues on Android 11+ and scudo


Hi,

didn't hear about Scudo before, but it seems it is a LLVM side project: https://llvm.org/docs/ScudoHardenedAllocator.html

So perhaps you could build and use it on Linux as shown in https://llvm.org/docs/ScudoHardenedAllocator.html#library

Besides a potential bug in the allocator, it might be that the S57 driver has a memory allocation pattern that doesn't please Scudo.

Assuming that the problematic memory allocations are done using GDAL's VSIMalloc() (and not C++ new/delete), then have a look at the various #define that you can set at the top of port/cpl_vsisimple.cpp and can be used to trace memory allocations

// Uncomment to check consistent usage of VSIMalloc(), VSIRealloc(),
// VSICalloc(), VSIFree(), VSIStrdup().
// #define DEBUG_VSIMALLOC

// Uncomment to compute memory usage statistics.
// DEBUG_VSIMALLOC must also be defined.
// #define DEBUG_VSIMALLOC_STATS

// Uncomment to print every memory allocation or deallocation.
// DEBUG_VSIMALLOC must also be defined.
// #define DEBUG_VSIMALLOC_VERBOSE

// Number of bytes of the malloc/calloc/free that triggers a debug trace.
// Can be 0 for all allocs.
#define THRESHOLD_PRINT 10000

Even



Le 28/03/2022 ? 14:58, Philippe Lelong a ?crit :

Hi,


I am searching for this issue for months now, and cannot find any solution.

To make a long story short, we are using GDAL to decode OGR/S57 charts for years now. We are facing numerous crashes under Android 11 and up if and only if this Android 11 implementation is using SCUDO as a memory allocator (if jemalloc is used no problems). We face this problem with an old GDAL2.1.3 version, so we updated to GDAL 3.4.1 but the issue is the same.


What I can see is that the memory grows exponentially until no more memory is available and crash, even on systems with huge memory available while an Android device without SCUDO and very limited memory (let's say 4Gb) in the same exact conditions, with the same apk, runs perfectly. The logcat command show this:



03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.255  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.256  4959  5005 W libc    : malloc(264196) failed: returning null pointer
03-28 12:40:34.612   630   630 D io_stats: !@ Write_top(KB): kworker/u16:1(32583) 8
03-28 12:40:34.820  4959  5041 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5042 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5033 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5031 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5038 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes
03-28 12:40:34.820  4959  5040 I scudo   : Scudo ERROR: out of memory trying to allocate 64 bytes

and then crash

Any help on how to debug and eventually fix this would be highly appreciated.

Best regards,
Philippe from qtVlm development team.




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/eb18524f/attachment-0001.html>

From jose.calvo at vexcelgroup.com  Mon Mar 28 23:59:22 2022
From: jose.calvo at vexcelgroup.com (Jose Calvo)
Date: Tue, 29 Mar 2022 06:59:22 +0000
Subject: [gdal-dev] Create COG jpeg tiles with JFIF APPn markers
Message-ID: <BL1PR12MB5190329AFA73B4349D0C5ECA811E9@BL1PR12MB5190.namprd12.prod.outlook.com>

Hi.

Currently my c++ app creates COG files from GeoTiff tiled files.


GeoTiff files are created using JPEG compression with YCBCR photometric using following creation options:

  *   PROFILE=GeoTIFF
  *   TILED=YES
  *   BLOCKXSIZE=xxx
  *   BLOCKYSIZE=xxx
  *   COMPRESS=JPEG
  *   PHOTOMETRIC=YCBCR
  *   JPEG_QUALITY=xx
  *   JPEGTABLESMODE=0

>From this Geotiff files, app creates COG tiled files using following options:

  *   BLOCKSIZE=xxx
  *   OVERVIEWS=FORCE_USE_EXISTING
  *   COMPRESS=JPEG
  *   QUALITY=xx

Those tiles contain normal JPEG markers (SOI, SOF0, DQT) but no JFIF marker (APPn) is added. How can I ensure adding this JFIF marker?

I'm using gdal 3.1.0.7 in a ubuntu 20.10 using both strategies:

  *   internal jpeg and tiff code: --with-jpeg=internal --with-libtiff=internal
  *   external jpeg and tiff libraries: libjpeg.so.8.2.2 libtiff.so.5.5.0

Thanks in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/00389890/attachment.html>

From dirk.vdb at gmail.com  Tue Mar 29 00:40:53 2022
From: dirk.vdb at gmail.com (Dirk Vanden Boer)
Date: Tue, 29 Mar 2022 09:40:53 +0200
Subject: [gdal-dev] Errors when reading large xlsx files
Message-ID: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>

Hi,

When reading xlsx files that contains a lot of lines gdal reports the
following error multiple times:
| Adding too many columns to too many existing features

It comes from the the xlsx driver:
GIntBig nFeatureCount = poCurLayer->GetFeatureCount(false);
if( nFeatureCount > 0 &&
    static_cast<size_t>(apoCurLineValues.size() -
        poCurLayer->GetLayerDefn()->GetFieldCount()) >
            static_cast<size_t>(100000 / nFeatureCount) )
{
    CPLError(CE_Failure, CPLE_NotSupported,
                "Adding too many columns to too many "
                "existing features");
    return;
}

The featureCount in my case is 128741
apoCurLineValues.size() = 8
fieldCount = 7

Why is this error reported? Does it impact the actual read data?
I do notice when I open the file in excel and select everything, the eight
column in the file is empty but also gets selected.

Kind regards,
Dirk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/41136711/attachment.html>

From daniel.fred.evans at gmail.com  Tue Mar 29 01:06:17 2022
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Tue, 29 Mar 2022 09:06:17 +0100
Subject: [gdal-dev] Errors when reading large xlsx files
In-Reply-To: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>
References: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>
Message-ID: <CANnaQaZ=RgzROHUwdNphwbCOBrEG3Xaxos+5GwdzL4eAXBpApg@mail.gmail.com>

Hi Dirk,

> I do notice when I open the file in excel and select everything, the
eight column in the file is empty but also gets selected.

It looks like that's the key here.

The code you identified gets hit if GDAL encounters a row with more
populated columns than the previous one, and if the product of (previous
numbers of rows read) x (number of columns to be added) is too high
(>100,000), GDAL gives the error you're getting. That functionality was
added in commit 4f3f1fa [1], in response to an OSSFuzz vulnerability report
noting that GDAL becomes very slow if an Excel file adds many extra columns
after reading many rows already (presumably as it has to modify every
feature already read). I think this is where Even would start pointing out
that there's downsides to such automated security scanners, as the
distinction between "it's just slow for large files" (>25s in the report)
and "an actual DOS attack" is awkward when dealing with typical GIS data
volumes.

Are you sure the 8th column contains no data at all? Even if it is empty,
my experience is that Excel can be pretty stubborn about saving empty
columns that have contained data at some point in the file's history. From
memory, selecting the whole column, deleting it, and saving again usually
convinces Excel to no longer save it.

Regards,
Daniel

[1]
https://github.com/OSGeo/gdal/commit/4f3f1facc5da0eeac71f6b1ba946b7618386ee7d

On Tue, 29 Mar 2022 at 08:41, Dirk Vanden Boer <dirk.vdb at gmail.com> wrote:

> Hi,
>
> When reading xlsx files that contains a lot of lines gdal reports the
> following error multiple times:
> | Adding too many columns to too many existing features
>
> It comes from the the xlsx driver:
> GIntBig nFeatureCount = poCurLayer->GetFeatureCount(false);
> if( nFeatureCount > 0 &&
>     static_cast<size_t>(apoCurLineValues.size() -
>         poCurLayer->GetLayerDefn()->GetFieldCount()) >
>             static_cast<size_t>(100000 / nFeatureCount) )
> {
>     CPLError(CE_Failure, CPLE_NotSupported,
>                 "Adding too many columns to too many "
>                 "existing features");
>     return;
> }
>
> The featureCount in my case is 128741
> apoCurLineValues.size() = 8
> fieldCount = 7
>
> Why is this error reported? Does it impact the actual read data?
> I do notice when I open the file in excel and select everything, the eight
> column in the file is empty but also gets selected.
>
> Kind regards,
> Dirk
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/f9701476/attachment.html>

From dirk.vdb at gmail.com  Tue Mar 29 01:19:49 2022
From: dirk.vdb at gmail.com (Dirk Vanden Boer)
Date: Tue, 29 Mar 2022 10:19:49 +0200
Subject: [gdal-dev] Errors when reading large xlsx files
In-Reply-To: <CANnaQaZ=RgzROHUwdNphwbCOBrEG3Xaxos+5GwdzL4eAXBpApg@mail.gmail.com>
References: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>
 <CANnaQaZ=RgzROHUwdNphwbCOBrEG3Xaxos+5GwdzL4eAXBpApg@mail.gmail.com>
Message-ID: <CADuK5a37RX21MosL2LGdU9j37cJq8vLL326UN_CK4euKY27nYg@mail.gmail.com>

Scanning through the file, it turns out 2 lines actually have a value in
the eight column, that's why the column is present, it doesn't have a
header for that column however.

So I have 2 questions:
- does the error impact the returned data?
- Is there a way to suppress this error without disabling the gdal log
handling. My logs are flooded with these messages, modifying the xlsx files
is not an option because there are many and they are supplied by clients
and regularly updated.

Regards,
Dirk

On Tue, Mar 29, 2022 at 10:06 AM Daniel Evans <daniel.fred.evans at gmail.com>
wrote:

> Hi Dirk,
>
> > I do notice when I open the file in excel and select everything, the
> eight column in the file is empty but also gets selected.
>
> It looks like that's the key here.
>
> The code you identified gets hit if GDAL encounters a row with more
> populated columns than the previous one, and if the product of (previous
> numbers of rows read) x (number of columns to be added) is too high
> (>100,000), GDAL gives the error you're getting. That functionality was
> added in commit 4f3f1fa [1], in response to an OSSFuzz vulnerability report
> noting that GDAL becomes very slow if an Excel file adds many extra columns
> after reading many rows already (presumably as it has to modify every
> feature already read). I think this is where Even would start pointing out
> that there's downsides to such automated security scanners, as the
> distinction between "it's just slow for large files" (>25s in the report)
> and "an actual DOS attack" is awkward when dealing with typical GIS data
> volumes.
>
> Are you sure the 8th column contains no data at all? Even if it is empty,
> my experience is that Excel can be pretty stubborn about saving empty
> columns that have contained data at some point in the file's history. From
> memory, selecting the whole column, deleting it, and saving again usually
> convinces Excel to no longer save it.
>
> Regards,
> Daniel
>
> [1]
> https://github.com/OSGeo/gdal/commit/4f3f1facc5da0eeac71f6b1ba946b7618386ee7d
>
> On Tue, 29 Mar 2022 at 08:41, Dirk Vanden Boer <dirk.vdb at gmail.com> wrote:
>
>> Hi,
>>
>> When reading xlsx files that contains a lot of lines gdal reports the
>> following error multiple times:
>> | Adding too many columns to too many existing features
>>
>> It comes from the the xlsx driver:
>> GIntBig nFeatureCount = poCurLayer->GetFeatureCount(false);
>> if( nFeatureCount > 0 &&
>>     static_cast<size_t>(apoCurLineValues.size() -
>>         poCurLayer->GetLayerDefn()->GetFieldCount()) >
>>             static_cast<size_t>(100000 / nFeatureCount) )
>> {
>>     CPLError(CE_Failure, CPLE_NotSupported,
>>                 "Adding too many columns to too many "
>>                 "existing features");
>>     return;
>> }
>>
>> The featureCount in my case is 128741
>> apoCurLineValues.size() = 8
>> fieldCount = 7
>>
>> Why is this error reported? Does it impact the actual read data?
>> I do notice when I open the file in excel and select everything, the
>> eight column in the file is empty but also gets selected.
>>
>> Kind regards,
>> Dirk
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/1c2a6654/attachment-0001.html>

From andrew at aitchison.me.uk  Tue Mar 29 05:45:30 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 29 Mar 2022 13:45:30 +0100 (BST)
Subject: [gdal-dev] The Not Rocket Science Rule Of Software Engineering
Message-ID: <5060af80-b1b3-c46a-bf81-62837d918eb1@aitchison.me.uk>


I have been reading The Not Rocket Science Rule Of Software Engineering
https://graydon2.dreamwidth.org/1597.html
which is:
        automatically maintain a repository of code
        that always passes all the tests

Does https://github.com/OSGeo/gdal have a branch with this property ?

If we do not yet, it should in principal be easy:
whenever HEAD of master passes all test, pull that to a current-working branch
(in practice we have 16 top-level tests, so would need a wrapper which says
whether they all passed or not).


A comment on the above blog post is:
   Aegis has a delightful wrinkle on this: each changeset has to not just
   pass all existing tests, but also come with a new test, independently
   tracked and associated with the change, that must fail before the
   change, and pass after it.

That would be a useful addition too.

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From gdt at lexort.com  Tue Mar 29 06:16:53 2022
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 29 Mar 2022 09:16:53 -0400
Subject: [gdal-dev] The Not Rocket Science Rule Of Software Engineering
In-Reply-To: <5060af80-b1b3-c46a-bf81-62837d918eb1@aitchison.me.uk> (Andrew
 C. Aitchison's message of "Tue, 29 Mar 2022 13:45:30 +0100 (BST)")
References: <5060af80-b1b3-c46a-bf81-62837d918eb1@aitchison.me.uk>
Message-ID: <rmi4k3gzynu.fsf@s1.lexort.com>


Andrew C Aitchison <andrew at aitchison.me.uk> writes:

> I have been reading The Not Rocket Science Rule Of Software Engineering
> https://graydon2.dreamwidth.org/1597.html
> which is:
>        automatically maintain a repository of code
>        that always passes all the tests
>
> Does https://github.com/OSGeo/gdal have a branch with this property ?
>
> If we do not yet, it should in principal be easy:
> whenever HEAD of master passes all test, pull that to a current-working branch
> (in practice we have 16 top-level tests, so would need a wrapper which says
> whether they all passed or not).

In principle it's easy.  In the real world, "passes all tests" is
woefully underspecified because there are many of:

 operating systems
 operating system versions
 CPU types

 versions of each dependency (which themselves may or may not "pass all tests")

 whether or not grids are installed for proj
 
 probably something else I haven't thought of.

In the general case, CI schemes cover a small fraction of the above.

> A comment on the above blog post is:
>   Aegis has a delightful wrinkle on this: each changeset has to not just
>   pass all existing tests, but also come with a new test, independently
>   tracked and associated with the change, that must fail before the
>   change, and pass after it.
>
> That would be a useful addition too.

It would lead to bugs not getting fixed because it becomes too much
effort.  Or maybe you're volunteering to write the tests for all the
one-line bugfixes?

And, it runs into the same issue: I recently submitted a PR -- which was
merged -- that improved portability of mkgdaldist.sh.  I don't think
there were tests for that, and if there were CI doesn't happen on NetBSD
anyway.  Surely you don't mean it is reasonable to block such PRs on
lack of testing.

I do think that for changes that fix a real bug, it is nicer to have a
new test case than not, and that changes shouldn't be merged if they
cause test regressions on the set of systems CI runs on, plus reports.

And if there is a bug, it's nice to add a new xfail test case to the
tests, even before the fix.


From watching gdal (and many other things as a packager), gdal is in
very good shape this way.  Tests seem to essentially always pass on
GNU/Linux, and I have found some failures on NetBSD, now almost entirely
resolved (a blend of test environment documentation and fixes to gdal).
So I think things are actually in quite good shape, and the biggest
issues are the proj grid-present issue and lack of official CI on
minority platforms.  Minority platform CI is important to everyone,
because it tends to shake out bugs that remain latent on the platform
most development happens, because of course bugs that manifest there are
already fixed.



I really don't mean to argue against "tests are a great thing and should
exist" at all.  Just that I think it's harder than it seems, and that
gdal is already doing a great job.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/4fb1159d/attachment.sig>

From even.rouault at spatialys.com  Tue Mar 29 06:36:26 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 29 Mar 2022 15:36:26 +0200
Subject: [gdal-dev] The Not Rocket Science Rule Of Software Engineering
In-Reply-To: <5060af80-b1b3-c46a-bf81-62837d918eb1@aitchison.me.uk>
References: <5060af80-b1b3-c46a-bf81-62837d918eb1@aitchison.me.uk>
Message-ID: <43dad1e3-ddf0-23c0-a12c-6a91ddd8bd26@spatialys.com>


Le 29/03/2022 ? 14:45, Andrew C Aitchison a ?crit?:
>
> I have been reading The Not Rocket Science Rule Of Software Engineering
> https://graydon2.dreamwidth.org/1597.html
> which is:
> ?????? automatically maintain a repository of code
> ?????? that always passes all the tests
>
> Does https://github.com/OSGeo/gdal have a branch with this property ?
All branches should have that property most of the time, at least to the 
extent our CI is representative and around the time the commit was done 
(our CI depends on external stuff that might independently change/break. 
So something that used to pass might be broken if replayed later). Just 
observe the nice badges at https://github.com/OSGeo/gdal#readme or 
navigate through the branches in github UI and look at the status of the 
head commit. That's the purpose of using pull requests to ensure we 
don't push broken stuff (at least we don't push stuff *known* to be 
broken because there's a test to assert it)
>
> If we do not yet, it should in principal be easy:
> whenever HEAD of master passes all test, pull that to a 
> current-working branch
> (in practice we have 16 top-level tests, so would need a wrapper which 
> says
> whether they all passed or not).
>
>
> A comment on the above blog post is:
> ? Aegis has a delightful wrinkle on this: each changeset has to not just
> ? pass all existing tests, but also come with a new test, independently
> ? tracked and associated with the change, that must fail before the
> ? change, and pass after it.
>
> That would be a useful addition too.

We try to keep with that policy too as much as practical. But that's 
definitely not 100% of the time, as sometimes creating a reliable test 
can be really difficult and time consuming (a 5 minute fix could involve 
sometimes hours, days or weeks of effort to create a test case). A few 
typical exceptions I've in mind:

- a commit depends on a too large dataset, that is not reasonable to 
push into the repository given it size, and creating a smaller version 
is not practical, especially for binary formats (could require writing 
dedicated & complex code to generate a smaller dataset)

- a fix depends on a fuzzed dataset. We could incorporate fuzzed 
datasets into the repository, but, due to the nature of fuzzing, they 
are most of the time broken in many ways, and consequently they don't 
necessarily exercise only the code path that is fixed. So, if 
incorporated, a further change in the driver could cause them to be 
rejected for another reason, and they would no longer test the code path 
they initially exercised.

- changes that are related to performance improvements. Measuring 
reliably speed of execution is already tricky locally, and even more in 
cloud environments used by CI. But that's definitely something we could 
try to put in place. One potential solution is in the same worker to 
build a version before (or the last released version) and after the 
change, and compare.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From daniel.fred.evans at gmail.com  Tue Mar 29 11:09:18 2022
From: daniel.fred.evans at gmail.com (Daniel Evans)
Date: Tue, 29 Mar 2022 19:09:18 +0100
Subject: [gdal-dev] Errors when reading large xlsx files
In-Reply-To: <CADuK5a37RX21MosL2LGdU9j37cJq8vLL326UN_CK4euKY27nYg@mail.gmail.com>
References: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>
 <CANnaQaZ=RgzROHUwdNphwbCOBrEG3Xaxos+5GwdzL4eAXBpApg@mail.gmail.com>
 <CADuK5a37RX21MosL2LGdU9j37cJq8vLL326UN_CK4euKY27nYg@mail.gmail.com>
Message-ID: <CANnaQaatKjZPo7zLqddsq_4SqZysRex+fRrcnxQ9em22+hAVQw@mail.gmail.com>

> does the error impact the returned data?

The effect will at least be to ignore any rows for which this message was
raised - the function is unconditionally exited after the error is raised,
before a new feature is added to the current layer.

> Is there a way to suppress this error without disabling the gdal log
handling. My logs are flooded with these messages, modifying the xlsx files
is not an option because there are many and they are supplied by clients
and regularly updated.

I suspect the only way is by providing GDAL with a custom error handler,
which ignores this specific message and otherwise delegates back to
CPLDefaultErrorHandler() (or prints to stderr itself).

Regards,
Daniel

On Tue, 29 Mar 2022 at 09:20, Dirk Vanden Boer <dirk.vdb at gmail.com> wrote:

> Scanning through the file, it turns out 2 lines actually have a value in
> the eight column, that's why the column is present, it doesn't have a
> header for that column however.
>
> So I have 2 questions:
> - does the error impact the returned data?
> - Is there a way to suppress this error without disabling the gdal log
> handling. My logs are flooded with these messages, modifying the xlsx files
> is not an option because there are many and they are supplied by clients
> and regularly updated.
>
> Regards,
> Dirk
>
> On Tue, Mar 29, 2022 at 10:06 AM Daniel Evans <daniel.fred.evans at gmail.com>
> wrote:
>
>> Hi Dirk,
>>
>> > I do notice when I open the file in excel and select everything, the
>> eight column in the file is empty but also gets selected.
>>
>> It looks like that's the key here.
>>
>> The code you identified gets hit if GDAL encounters a row with more
>> populated columns than the previous one, and if the product of (previous
>> numbers of rows read) x (number of columns to be added) is too high
>> (>100,000), GDAL gives the error you're getting. That functionality was
>> added in commit 4f3f1fa [1], in response to an OSSFuzz vulnerability report
>> noting that GDAL becomes very slow if an Excel file adds many extra columns
>> after reading many rows already (presumably as it has to modify every
>> feature already read). I think this is where Even would start pointing out
>> that there's downsides to such automated security scanners, as the
>> distinction between "it's just slow for large files" (>25s in the report)
>> and "an actual DOS attack" is awkward when dealing with typical GIS data
>> volumes.
>>
>> Are you sure the 8th column contains no data at all? Even if it is empty,
>> my experience is that Excel can be pretty stubborn about saving empty
>> columns that have contained data at some point in the file's history. From
>> memory, selecting the whole column, deleting it, and saving again usually
>> convinces Excel to no longer save it.
>>
>> Regards,
>> Daniel
>>
>> [1]
>> https://github.com/OSGeo/gdal/commit/4f3f1facc5da0eeac71f6b1ba946b7618386ee7d
>>
>> On Tue, 29 Mar 2022 at 08:41, Dirk Vanden Boer <dirk.vdb at gmail.com>
>> wrote:
>>
>>> Hi,
>>>
>>> When reading xlsx files that contains a lot of lines gdal reports the
>>> following error multiple times:
>>> | Adding too many columns to too many existing features
>>>
>>> It comes from the the xlsx driver:
>>> GIntBig nFeatureCount = poCurLayer->GetFeatureCount(false);
>>> if( nFeatureCount > 0 &&
>>>     static_cast<size_t>(apoCurLineValues.size() -
>>>         poCurLayer->GetLayerDefn()->GetFieldCount()) >
>>>             static_cast<size_t>(100000 / nFeatureCount) )
>>> {
>>>     CPLError(CE_Failure, CPLE_NotSupported,
>>>                 "Adding too many columns to too many "
>>>                 "existing features");
>>>     return;
>>> }
>>>
>>> The featureCount in my case is 128741
>>> apoCurLineValues.size() = 8
>>> fieldCount = 7
>>>
>>> Why is this error reported? Does it impact the actual read data?
>>> I do notice when I open the file in excel and select everything, the
>>> eight column in the file is empty but also gets selected.
>>>
>>> Kind regards,
>>> Dirk
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/3882a6d9/attachment.html>

From dirk.vdb at gmail.com  Tue Mar 29 11:29:35 2022
From: dirk.vdb at gmail.com (Dirk Vanden Boer)
Date: Tue, 29 Mar 2022 20:29:35 +0200
Subject: [gdal-dev] Errors when reading large xlsx files
In-Reply-To: <CANnaQaatKjZPo7zLqddsq_4SqZysRex+fRrcnxQ9em22+hAVQw@mail.gmail.com>
References: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>
 <CANnaQaZ=RgzROHUwdNphwbCOBrEG3Xaxos+5GwdzL4eAXBpApg@mail.gmail.com>
 <CADuK5a37RX21MosL2LGdU9j37cJq8vLL326UN_CK4euKY27nYg@mail.gmail.com>
 <CANnaQaatKjZPo7zLqddsq_4SqZysRex+fRrcnxQ9em22+hAVQw@mail.gmail.com>
Message-ID: <CADuK5a3EHbot+pzLG_oRf3FD7TSpRoB64VJRBisfyhpEH4wLAw@mail.gmail.com>

> The effect will at least be to ignore any rows for which this message was
raised - the function is unconditionally exited after the error is raised,
before a new feature is added to the current layer.

So do I understand correctly that for files containing roughly more than
100000 lines, rows that contain more columns of data than the detected
headers are not readable?
Because if that is the case I will be required to patch my gdal version to
not skip these lines.

Regards,
Dirk

On Tue, Mar 29, 2022 at 8:09 PM Daniel Evans <daniel.fred.evans at gmail.com>
wrote:

> > does the error impact the returned data?
>
> The effect will at least be to ignore any rows for which this message was
> raised - the function is unconditionally exited after the error is raised,
> before a new feature is added to the current layer.
>
> > Is there a way to suppress this error without disabling the gdal log
> handling. My logs are flooded with these messages, modifying the xlsx files
> is not an option because there are many and they are supplied by clients
> and regularly updated.
>
> I suspect the only way is by providing GDAL with a custom error handler,
> which ignores this specific message and otherwise delegates back to
> CPLDefaultErrorHandler() (or prints to stderr itself).
>
> Regards,
> Daniel
>
> On Tue, 29 Mar 2022 at 09:20, Dirk Vanden Boer <dirk.vdb at gmail.com> wrote:
>
>> Scanning through the file, it turns out 2 lines actually have a value in
>> the eight column, that's why the column is present, it doesn't have a
>> header for that column however.
>>
>> So I have 2 questions:
>> - does the error impact the returned data?
>> - Is there a way to suppress this error without disabling the gdal log
>> handling. My logs are flooded with these messages, modifying the xlsx files
>> is not an option because there are many and they are supplied by clients
>> and regularly updated.
>>
>> Regards,
>> Dirk
>>
>> On Tue, Mar 29, 2022 at 10:06 AM Daniel Evans <
>> daniel.fred.evans at gmail.com> wrote:
>>
>>> Hi Dirk,
>>>
>>> > I do notice when I open the file in excel and select everything, the
>>> eight column in the file is empty but also gets selected.
>>>
>>> It looks like that's the key here.
>>>
>>> The code you identified gets hit if GDAL encounters a row with more
>>> populated columns than the previous one, and if the product of (previous
>>> numbers of rows read) x (number of columns to be added) is too high
>>> (>100,000), GDAL gives the error you're getting. That functionality was
>>> added in commit 4f3f1fa [1], in response to an OSSFuzz vulnerability report
>>> noting that GDAL becomes very slow if an Excel file adds many extra columns
>>> after reading many rows already (presumably as it has to modify every
>>> feature already read). I think this is where Even would start pointing out
>>> that there's downsides to such automated security scanners, as the
>>> distinction between "it's just slow for large files" (>25s in the report)
>>> and "an actual DOS attack" is awkward when dealing with typical GIS data
>>> volumes.
>>>
>>> Are you sure the 8th column contains no data at all? Even if it is
>>> empty, my experience is that Excel can be pretty stubborn about saving
>>> empty columns that have contained data at some point in the file's history.
>>> From memory, selecting the whole column, deleting it, and saving again
>>> usually convinces Excel to no longer save it.
>>>
>>> Regards,
>>> Daniel
>>>
>>> [1]
>>> https://github.com/OSGeo/gdal/commit/4f3f1facc5da0eeac71f6b1ba946b7618386ee7d
>>>
>>> On Tue, 29 Mar 2022 at 08:41, Dirk Vanden Boer <dirk.vdb at gmail.com>
>>> wrote:
>>>
>>>> Hi,
>>>>
>>>> When reading xlsx files that contains a lot of lines gdal reports the
>>>> following error multiple times:
>>>> | Adding too many columns to too many existing features
>>>>
>>>> It comes from the the xlsx driver:
>>>> GIntBig nFeatureCount = poCurLayer->GetFeatureCount(false);
>>>> if( nFeatureCount > 0 &&
>>>>     static_cast<size_t>(apoCurLineValues.size() -
>>>>         poCurLayer->GetLayerDefn()->GetFieldCount()) >
>>>>             static_cast<size_t>(100000 / nFeatureCount) )
>>>> {
>>>>     CPLError(CE_Failure, CPLE_NotSupported,
>>>>                 "Adding too many columns to too many "
>>>>                 "existing features");
>>>>     return;
>>>> }
>>>>
>>>> The featureCount in my case is 128741
>>>> apoCurLineValues.size() = 8
>>>> fieldCount = 7
>>>>
>>>> Why is this error reported? Does it impact the actual read data?
>>>> I do notice when I open the file in excel and select everything, the
>>>> eight column in the file is empty but also gets selected.
>>>>
>>>> Kind regards,
>>>> Dirk
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/a5177b8a/attachment-0001.html>

From even.rouault at spatialys.com  Tue Mar 29 12:25:07 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 29 Mar 2022 21:25:07 +0200
Subject: [gdal-dev] Errors when reading large xlsx files
In-Reply-To: <CADuK5a3EHbot+pzLG_oRf3FD7TSpRoB64VJRBisfyhpEH4wLAw@mail.gmail.com>
References: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>
 <CANnaQaZ=RgzROHUwdNphwbCOBrEG3Xaxos+5GwdzL4eAXBpApg@mail.gmail.com>
 <CADuK5a37RX21MosL2LGdU9j37cJq8vLL326UN_CK4euKY27nYg@mail.gmail.com>
 <CANnaQaatKjZPo7zLqddsq_4SqZysRex+fRrcnxQ9em22+hAVQw@mail.gmail.com>
 <CADuK5a3EHbot+pzLG_oRf3FD7TSpRoB64VJRBisfyhpEH4wLAw@mail.gmail.com>
Message-ID: <1ee07fd3-9a70-88a1-94f0-08bc97f22953@spatialys.com>


Le 29/03/2022 ? 20:29, Dirk Vanden Boer a ?crit?:
> > The effect will at least be to ignore any rows for which this 
> message was raised - the function is unconditionally exited after the 
> error is raised, before a new feature is added to the current layer.
>
> So do I understand correctly that for files containing roughly more 
> than 100000 lines, rows that contain more columns of data than the 
> detected headers are not readable?
> Because if that is the case I will be required to patch my gdal 
> version to not skip these lines.
Please file an issue about that at https://github.com/OSGeo/gdal/issues
>
> Regards,
> Dirk
>
> On Tue, Mar 29, 2022 at 8:09 PM Daniel Evans 
> <daniel.fred.evans at gmail.com> wrote:
>
>     > does the error impact the returned data?
>
>     The effect will at least be to ignore any rows for which this
>     message was raised - the function is unconditionally exited after
>     the error is raised, before a new feature is added to the current
>     layer.
>
>     > Is there a way to suppress this error without disabling the gdal
>     log handling. My logs are flooded with these messages, modifying
>     the xlsx files is not an option because there are many and they
>     are supplied by clients and regularly updated.
>
>     I suspect the only way is by providing GDAL with a custom error
>     handler, which ignores this specific message and otherwise
>     delegates back to CPLDefaultErrorHandler() (or prints to stderr
>     itself).
>
>     Regards,
>     Daniel
>
>     On Tue, 29 Mar 2022 at 09:20, Dirk Vanden Boer
>     <dirk.vdb at gmail.com> wrote:
>
>         Scanning through the file, it turns out 2 lines actually have
>         a value in the eight column, that's why the column is present,
>         it doesn't have a header for that column however.
>
>         So I have 2 questions:
>         - does the error impact the returned data?
>         - Is there a way to suppress this error without disabling the
>         gdal log handling. My logs are flooded with these messages,
>         modifying the xlsx files is not an option because there are
>         many and they are supplied by clients and regularly updated.
>
>         Regards,
>         Dirk
>
>         On Tue, Mar 29, 2022 at 10:06 AM Daniel Evans
>         <daniel.fred.evans at gmail.com> wrote:
>
>             Hi Dirk,
>
>             > I do notice when I open the file in excel and select
>             everything, the eight column in the file is empty but also
>             gets selected.
>
>             It looks like that's the key here.
>
>             The code you identified gets hit if GDAL encounters a row
>             with more populated columns than the previous one, and if
>             the product of (previous numbers of rows read) x (number
>             of columns to be added) is too high (>100,000), GDAL gives
>             the error you're getting. That functionality was added in
>             commit 4f3f1fa [1], in response to an OSSFuzz
>             vulnerability report noting that GDAL becomes very slow if
>             an Excel file adds many extra columns after reading many
>             rows already (presumably as it has to modify every feature
>             already read). I think this is where Even would start
>             pointing out that there's downsides to such automated
>             security scanners, as the distinction between "it's just
>             slow for large files" (>25s in the report) and "an actual
>             DOS attack" is awkward when dealing with typical GIS data
>             volumes.
>
>             Are you sure the 8th column contains no data at all? Even
>             if it is empty, my experience is that Excel can be pretty
>             stubborn about saving empty columns that have contained
>             data at some point in the file's history. From memory,
>             selecting the whole column, deleting it, and saving again
>             usually convinces Excel to no longer save it.
>
>             Regards,
>             Daniel
>
>             [1]
>             https://github.com/OSGeo/gdal/commit/4f3f1facc5da0eeac71f6b1ba946b7618386ee7d
>
>             On Tue, 29 Mar 2022 at 08:41, Dirk Vanden Boer
>             <dirk.vdb at gmail.com> wrote:
>
>                 Hi,
>
>                 When reading xlsx files that contains a lot of lines
>                 gdal reports the following error multiple times:
>                 | Adding too many columns to too many existing features
>
>                 It comes from the the xlsx driver:
>                 GIntBig nFeatureCount =
>                 poCurLayer->GetFeatureCount(false);
>                 if( nFeatureCount > 0 &&
>                 static_cast<size_t>(apoCurLineValues.size() -
>                 poCurLayer->GetLayerDefn()->GetFieldCount()) >
>                 ? ? ? ? ? ? static_cast<size_t>(100000 / nFeatureCount) )
>                 {
>                 ? ? CPLError(CE_Failure, CPLE_NotSupported,
>                 ? ? ? ? ? ? ? ? "Adding too many columns to too many "
>                 ? ? ? ? ? ? ? ? "existing features");
>                 ? ? return;
>                 }
>
>                 The featureCount in my case is 128741
>                 apoCurLineValues.size() = 8
>                 fieldCount = 7
>
>                 Why is this error reported? Does it impact the actual
>                 read data?
>                 I do notice when I open the file in excel and select
>                 everything, the eight column in the file is empty but
>                 also gets selected.
>
>                 Kind regards,
>                 Dirk
>                 _______________________________________________
>                 gdal-dev mailing list
>                 gdal-dev at lists.osgeo.org
>                 https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/b9088e9e/attachment.html>

From andrew at aitchison.me.uk  Tue Mar 29 12:27:36 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 29 Mar 2022 20:27:36 +0100 (BST)
Subject: [gdal-dev] Errors when reading large xlsx files
In-Reply-To: <CADuK5a37RX21MosL2LGdU9j37cJq8vLL326UN_CK4euKY27nYg@mail.gmail.com>
References: <CADuK5a3NJvWPR9ASQ9PHpq+8YtqHcq2zgAHrWQ0u_CAQ-yZYLw@mail.gmail.com>
 <CANnaQaZ=RgzROHUwdNphwbCOBrEG3Xaxos+5GwdzL4eAXBpApg@mail.gmail.com>
 <CADuK5a37RX21MosL2LGdU9j37cJq8vLL326UN_CK4euKY27nYg@mail.gmail.com>
Message-ID: <a434e09-a6e0-c4-7962-398d8d79907f@aitchison.me.uk>

On Tue, 29 Mar 2022, Dirk Vanden Boer wrote:

> Scanning through the file, it turns out 2 lines actually have a value in
> the eight column, that's why the column is present, it doesn't have a
> header for that column however.
>
> So I have 2 questions:
> - does the error impact the returned data?
> - Is there a way to suppress this error without disabling the gdal log
> handling. My logs are flooded with these messages, modifying the xlsx files
> is not an option because there are many and they are supplied by clients
> and regularly updated.

IIRC there are ways to batch-edit .xslx files.

Can you pre-process the xlsx file to add a header to that column -
" " may be sufficient ?

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From robin at rtwilson.com  Tue Mar 29 13:30:19 2022
From: robin at rtwilson.com (Robin Wilson)
Date: Tue, 29 Mar 2022 21:30:19 +0100
Subject: [gdal-dev] Trouble reprojecting feature that crosses antimeridian
Message-ID: <etPan.62436c60.7fabac2d.a67@rtwilson.com>

Hi,

I?ve been running into problems creating STAC items for images that cross the antimeridian. The geometries for the images are coming out as spanning the width of the whole world (from -180 to +180 degrees). With the help of the author of the tool I was using to create the STAC items (rio-stac), I?ve narrowed it down to a simple test case of reprojecting geometries (which is what the tool is doing internally).

If you put the following GeoJSON for an antimeridian-crossing polygon in?WGS 84 / UTM zone 1N in a file called test_32601.geojson:

```
{"type":"Polygon","coordinates":[[[377120,7577600],[418080,7577600],[418080,7618560],[377120,7618560],[377120,7577600]]]}
```

and then run the following:

```
ogr2ogr -f GeoJSON -s_srs epsg:32601 -t_srs epsg:4326 out_4326.geojson test_32601.geojson
```

The contents of the output file will be:

```
{ "type": "Polygon", "coordinates": [ [ [ -179.018099960087909, 68.666857319910392 ], [ -178.985579869598382, 68.299719485120988 ], [ -179.976982644969041, 68.284942315413858 ], [ 179.974309855567753, 68.651801088224246 ], [ 180.0, 68.652259945574556 ], [ 180.0, 68.652259945541758 ], [ 180.0, 68.652259944541754 ], [ -180.0, 68.652259944541754 ], [ -180.0, 68.652259945541758 ], [ -180.0, 68.652259945610126 ], [ -179.018099960087909, 68.666857319910392 ] ] ] }
```

In that output geometry there are longitudes of 180 and -180, so when plotted on a map it spans the whole width of the world.

The author of the rio-stac library did a PR to try and fix this problem (https://github.com/developmentseed/rio-stac/pull/30), but it doesn?t seem to have fixed it for this example, as the underlying GDAL code used by his library (through rasterio, I believe) is giving this result.

I find this result unexpected, but I have no knowledge of how GDAL deals with the antimeridian. Is this to be expected, or is this potentially a bug? If it isn?t a bug, is there any way around this?

Best regards,

Robin

Dr Robin Wilson
www.rtwilson.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/e6d9bdac/attachment-0001.html>

From Matt.Wilkie at yukon.ca  Tue Mar 29 13:55:49 2022
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Tue, 29 Mar 2022 20:55:49 +0000
Subject: [gdal-dev] Gitpod workspace with Ubuntu GDAL
Message-ID: <91b383d36fc04aef9b69a9961584538a@yukon.ca>

Gitpod workspace with Ubuntu GDAL

How to open a Gitpod<https://gitpod.io> machine with the version of GDAL in the Ubuntu software library.

  1.  Point browser at https://gitpod.io/#https://github.com/OSGeo/gdal
  2.  Login with Github credentials
  3.  In a couple of minutes the gitpod linux machine will be fired up and ready to use with Visual Studio Code open. There might be a cmake error, ignore it for now.
  4.  In the Terminal window install gdal (and whatever else you need).

# install gdal binaries, and git

sudo add-apt-repository -y ppa:ubuntugis/ubuntugis-unstable

sudo apt-get update

sudo apt-get install gdal-bin libgdal-dev



# verify gdal working

gdalinfo --version



# install gdal-utilties

python -m pip install swig/python/gdal-utils



# test gdal-utils working

gdal_edit

Optional: run tests to verify what parts of gdal are working

# Prep

python -m pip install -r requirements.txt



# Ensure gdal source code tree and the installed gdal binaries are the same version

git checkout v`gdal-config --version`

# and that python bindings match also

python -c "from osgeo import gdal;print(gdal.__version__)"



# Test only python utilities:

pytest pyscripts/



# All tests:

pytest

Pytest not found? Use python -m pytest instead. In next opening of bash shell it will work.



Result of investigation in https://github.com/OSGeo/gdal/issues/5442


Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca<http://yukon.ca/>
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/81a136a9/attachment.html>

From alansnow21 at gmail.com  Tue Mar 29 14:20:03 2022
From: alansnow21 at gmail.com (Alan Snow)
Date: Tue, 29 Mar 2022 16:20:03 -0500
Subject: [gdal-dev] Trouble reprojecting feature that crosses
 antimeridian
In-Reply-To: <etPan.62436c60.7fabac2d.a67@rtwilson.com>
References: <etPan.62436c60.7fabac2d.a67@rtwilson.com>
Message-ID: <CAGybdFTbwvVV7dv9sSvQiUJYZKZZJLMk2FGvXpaZcMzUKHUBSA@mail.gmail.com>

>From what I could tell, you are attempting to re-project a bounding box
across the antimeridian.

Here is one way to handle that (
https://pyproj4.github.io/pyproj/stable/api/transformer.html#pyproj.transformer.Transformer.transform_bounds
):
>>> import shapely.geometry
>>> from pyproj import Transformer
>>> transformer = Transformer.from_crs(32601, 4326, always_xy=True)
>>> def bounding_polygon(left, bottom, right, top):
...     if right < left:
...         return shapely.geometry.MultiPolygon(
...             [
...                 shapely.geometry.box(left, bottom, 180, top),
...                 shapely.geometry.box(-180, bottom, right, top),
...             ]
...         )
...     return shapely.geometry.box(left, bottom, right, top)
...
>>>
shapely.geometry.mapping(bounding_polygon(*transformer.transform_bounds(377120,
7577600, 418080, 7618560)))
{'type': 'MultiPolygon', 'coordinates': [(((180.0, 68.28494231541386),
(180.0, 68.66685731991039), (179.97430985556775, 68.66685731991039),
(179.97430985556775, 68.28494231541386), (180.0, 68.28494231541386)),),
(((-178.98557986959838, 68.28494231541386), (-178.98557986959838,
68.66685731991039), (-180.0, 68.66685731991039), (-180.0,
68.28494231541386), (-178.98557986959838, 68.28494231541386)),)]}

Alternatively, you could use rasterio.warp.transform_bounds (rasterio 1.3+
and GDAL 3.4+).
https://github.com/rasterio/rasterio/issues/2313


On Tue, Mar 29, 2022 at 3:30 PM Robin Wilson <robin at rtwilson.com> wrote:

> Hi,
>
> I?ve been running into problems creating STAC items for images that cross
> the antimeridian. The geometries for the images are coming out as spanning
> the width of the whole world (from -180 to +180 degrees). With the help of
> the author of the tool I was using to create the STAC items (rio-stac),
> I?ve narrowed it down to a simple test case of reprojecting geometries
> (which is what the tool is doing internally).
>
> If you put the following GeoJSON for an antimeridian-crossing polygon
> in WGS 84 / UTM zone 1N in a file called test_32601.geojson:
>
> ```
>
> {"type":"Polygon","coordinates":[[[377120,7577600],[418080,7577600],[418080,7618560],[377120,7618560],[377120,7577600]]]}
> ```
>
> and then run the following:
>
> ```
> ogr2ogr -f GeoJSON -s_srs epsg:32601 -t_srs epsg:4326 out_4326.geojson
> test_32601.geojson
> ```
>
> The contents of the output file will be:
>
> ```
> { "type": "Polygon", "coordinates": [ [ [ -179.018099960087909,
> 68.666857319910392 ], [ -178.985579869598382, 68.299719485120988 ], [
> -179.976982644969041, 68.284942315413858 ], [ 179.974309855567753,
> 68.651801088224246 ], [ 180.0, 68.652259945574556 ], [ 180.0,
> 68.652259945541758 ], [ 180.0, 68.652259944541754 ], [ -180.0,
> 68.652259944541754 ], [ -180.0, 68.652259945541758 ], [ -180.0,
> 68.652259945610126 ], [ -179.018099960087909, 68.666857319910392 ] ] ] }
> ```
>
> In that output geometry there are longitudes of 180 and -180, so when
> plotted on a map it spans the whole width of the world.
>
> The author of the rio-stac library did a PR to try and fix this problem (
> https://github.com/developmentseed/rio-stac/pull/30), but it doesn?t seem
> to have fixed it for this example, as the underlying GDAL code used by his
> library (through rasterio, I believe) is giving this result.
>
> I find this result unexpected, but I have no knowledge of how GDAL deals
> with the antimeridian. Is this to be expected, or is this potentially a
> bug? If it isn?t a bug, is there any way around this?
>
> Best regards,
>
> Robin
>
> Dr Robin Wilson
> www.rtwilson.com
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Alan Snow
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/f3723425/attachment.html>

From even.rouault at spatialys.com  Tue Mar 29 14:33:44 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 29 Mar 2022 23:33:44 +0200
Subject: [gdal-dev] Trouble reprojecting feature that crosses
 antimeridian
In-Reply-To: <etPan.62436c60.7fabac2d.a67@rtwilson.com>
References: <etPan.62436c60.7fabac2d.a67@rtwilson.com>
Message-ID: <70117d7f-f472-ed87-f13c-e965f66d252a@spatialys.com>

Was a bug. Fix queued in https://github.com/OSGeo/gdal/pull/5543

Le 29/03/2022 ? 22:30, Robin Wilson a ?crit?:
> Hi,
>
> I?ve been running into problems creating STAC items for images that 
> cross the antimeridian. The geometries for the images are coming out 
> as spanning the width of the whole world (from -180 to +180 degrees). 
> With the help of the author of the tool I was using to create the STAC 
> items (rio-stac), I?ve narrowed it down to a simple test case of 
> reprojecting geometries (which is what the tool is doing internally).
>
> If you put the following GeoJSON for an antimeridian-crossing polygon 
> in?WGS 84 / UTM zone 1N in a file called test_32601.geojson:
>
> ```
> {"type":"Polygon","coordinates":[[[377120,7577600],[418080,7577600],[418080,7618560],[377120,7618560],[377120,7577600]]]}
> ```
>
> and then run the following:
>
> ```
> ogr2ogr -f GeoJSON -s_srs epsg:32601 -t_srs epsg:4326 out_4326.geojson 
> test_32601.geojson
> ```
>
> The contents of the output file will be:
>
> ```
> { "type": "Polygon", "coordinates": [ [ [ -179.018099960087909, 
> 68.666857319910392 ], [ -178.985579869598382, 68.299719485120988 ], [ 
> -179.976982644969041, 68.284942315413858 ], [ 179.974309855567753, 
> 68.651801088224246 ], [ 180.0, 68.652259945574556 ], [ 180.0, 
> 68.652259945541758 ], [ 180.0, 68.652259944541754 ], [ -180.0, 
> 68.652259944541754 ], [ -180.0, 68.652259945541758 ], [ -180.0, 
> 68.652259945610126 ], [ -179.018099960087909, 68.666857319910392 ] ] ] }
> ```
>
> In that output geometry there are longitudes of 180 and -180, so when 
> plotted on a map it spans the whole width of the world.
>
> The author of the rio-stac library did a PR to try and fix this 
> problem (https://github.com/developmentseed/rio-stac/pull/30), but it 
> doesn?t seem to have fixed it for this example, as the underlying GDAL 
> code used by his library (through rasterio, I believe) is giving this 
> result.
>
> I find this result unexpected, but I have no knowledge of how GDAL 
> deals with the antimeridian. Is this to be expected, or is this 
> potentially a bug? If it isn?t a bug, is there any way around this?
>
> Best regards,
>
> Robin
>
> Dr Robin Wilson
> www.rtwilson.com <http://www.rtwilson.com>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220329/58df4442/attachment-0001.html>

From petebunting at mac.com  Wed Mar 30 03:59:24 2022
From: petebunting at mac.com (Pete Bunting)
Date: Wed, 30 Mar 2022 11:59:24 +0100
Subject: [gdal-dev] GDAL 3.4.2: gdalbuildvrt band selection bug
Message-ID: <25301AB6-8DA5-4FD9-A1F6-D78DAEFFBA0F@mac.com>

Hi, 

With the release of gdal 3.4.2, gdalbuildvrt seems to have a bug when selecting image bands. It works OK when band 1 is specified but if other band(s) in the image are used without band 1 then it seg faults. I noticed there were some changes around checking bands in the release notes "change logic to check homogenous number of bands? and I had a quick look at the commits but cannot see where this is occurring. 

# Works:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1

# Seg Faults:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2

ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(2) - Illegal band #
Segmentation fault (core dumped)


# Works:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1 -b 2 -b 3

# Seg Faults:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2 -b 3 -b 4

ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(4) - Illegal band #
Segmentation fault (core dumped)

Note, the input image I was using has 10 bands and these commands work with 3.4.1. I get the same seg fault on Mac, Linux and Windows ("Windows fatal exception: access violation"). 

Many thanks, 

Pete

From jukka.rahkonen at maanmittauslaitos.fi  Wed Mar 30 04:29:48 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 30 Mar 2022 11:29:48 +0000
Subject: [gdal-dev] GDAL 3.4.2: gdalbuildvrt band selection bug
Message-ID: <056de84902b043068097ce6810aafd34@maanmittauslaitos.fi>

Hi,

I can confirm with GDAL 3.5.0dev from gisinternals and with a normal RGB ortoimage.

gdalbuildvrt test.vrt p4433h.tif -b 2
0...10...20...30...40...50...60...70...80...90...100 - done.
ERROR 5: p4433h.tif: GDALDataset::GetRasterBand(2) - Illegal band #

With -b 1 -b 2 the command runs fine.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Pete Bunting via gdal-dev
L?hetetty: keskiviikko 30. maaliskuuta 2022 13.59
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] GDAL 3.4.2: gdalbuildvrt band selection bug

Hi, 

With the release of gdal 3.4.2, gdalbuildvrt seems to have a bug when selecting image bands. It works OK when band 1 is specified but if other band(s) in the image are used without band 1 then it seg faults. I noticed there were some changes around checking bands in the release notes "change logic to check homogenous number of bands? and I had a quick look at the commits but cannot see where this is occurring. 

# Works:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1

# Seg Faults:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2

ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(2) - Illegal band # Segmentation fault (core dumped)


# Works:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1 -b 2 -b 3

# Seg Faults:
gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2 -b 3 -b 4

ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(4) - Illegal band # Segmentation fault (core dumped)

Note, the input image I was using has 10 bands and these commands work with 3.4.1. I get the same seg fault on Mac, Linux and Windows ("Windows fatal exception: access violation"). 

Many thanks, 

Pete
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Wed Mar 30 06:21:44 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 30 Mar 2022 15:21:44 +0200
Subject: [gdal-dev] GDAL 3.4.2: gdalbuildvrt band selection bug
In-Reply-To: <25301AB6-8DA5-4FD9-A1F6-D78DAEFFBA0F@mac.com>
References: <25301AB6-8DA5-4FD9-A1F6-D78DAEFFBA0F@mac.com>
Message-ID: <d7cdcf86-94dd-baf2-51bf-a65e04dfb41f@spatialys.com>

Pete,

ouch, confirmed, and fix queued in 
https://github.com/OSGeo/gdal/pull/5547 . And the commit you mention was 
indeed the culprit.

Potential workarounds (besides generating the VRT on GDAL <= 3.4.0)

- if using gdalbuildvrt on a single source, you could just use 
"gdal_translate sen2_20210527_aber_subset.kea test.vrt -b 2", that will 
do the job equally well

- if using multiple sources, you could also use gdal_translate with band 
selection on the VRT generated by gdalbuildvrt (without band selection) 
to extract only the band(s) you're interested in, but obviously that 
creates one more file

(do not hesitate to file an issue in github for obvious regressions like 
that. emails tend to be easily forgotten)

Even

Le 30/03/2022 ? 12:59, Pete Bunting via gdal-dev a ?crit?:
> Hi,
>
> With the release of gdal 3.4.2, gdalbuildvrt seems to have a bug when selecting image bands. It works OK when band 1 is specified but if other band(s) in the image are used without band 1 then it seg faults. I noticed there were some changes around checking bands in the release notes "change logic to check homogenous number of bands? and I had a quick look at the commits but cannot see where this is occurring.
>
> # Works:
> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1
>
> # Seg Faults:
> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2
>
> ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(2) - Illegal band #
> Segmentation fault (core dumped)
>
>
> # Works:
> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1 -b 2 -b 3
>
> # Seg Faults:
> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2 -b 3 -b 4
>
> ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(4) - Illegal band #
> Segmentation fault (core dumped)
>
> Note, the input image I was using has 10 bands and these commands work with 3.4.1. I get the same seg fault on Mac, Linux and Windows ("Windows fatal exception: access violation").
>
> Many thanks,
>
> Pete
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From robin at rtwilson.com  Wed Mar 30 09:55:01 2022
From: robin at rtwilson.com (Robin Wilson)
Date: Wed, 30 Mar 2022 17:55:01 +0100
Subject: [gdal-dev] Trouble reprojecting feature that crosses
 antimeridian
In-Reply-To: <70117d7f-f472-ed87-f13c-e965f66d252a@spatialys.com>
References: <etPan.62436c60.7fabac2d.a67@rtwilson.com>
 <70117d7f-f472-ed87-f13c-e965f66d252a@spatialys.com>
Message-ID: <etPan.62448b6b.6709cce1.a67@rtwilson.com>

Thank you everyone for the responses, and Even for the bug fix.

Best regards,

Robin


On 29 March 2022 at 22:33:49, Even Rouault (even.rouault at spatialys.com) wrote:

Was a bug. Fix queued in https://github.com/OSGeo/gdal/pull/5543

Le 29/03/2022 ? 22:30, Robin Wilson a ?crit?:
Hi,

I?ve been running into problems creating STAC items for images that cross the antimeridian. The geometries for the images are coming out as spanning the width of the whole world (from -180 to +180 degrees). With the help of the author of the tool I was using to create the STAC items (rio-stac), I?ve narrowed it down to a simple test case of reprojecting geometries (which is what the tool is doing internally).

If you put the following GeoJSON for an antimeridian-crossing polygon in?WGS 84 / UTM zone 1N in a file called test_32601.geojson:

```
{"type":"Polygon","coordinates":[[[377120,7577600],[418080,7577600],[418080,7618560],[377120,7618560],[377120,7577600]]]}
```

and then run the following:

```
ogr2ogr -f GeoJSON -s_srs epsg:32601 -t_srs epsg:4326 out_4326.geojson test_32601.geojson
```

The contents of the output file will be:

```
{ "type": "Polygon", "coordinates": [ [ [ -179.018099960087909, 68.666857319910392 ], [ -178.985579869598382, 68.299719485120988 ], [ -179.976982644969041, 68.284942315413858 ], [ 179.974309855567753, 68.651801088224246 ], [ 180.0, 68.652259945574556 ], [ 180.0, 68.652259945541758 ], [ 180.0, 68.652259944541754 ], [ -180.0, 68.652259944541754 ], [ -180.0, 68.652259945541758 ], [ -180.0, 68.652259945610126 ], [ -179.018099960087909, 68.666857319910392 ] ] ] }
```

In that output geometry there are longitudes of 180 and -180, so when plotted on a map it spans the whole width of the world.

The author of the rio-stac library did a PR to try and fix this problem (https://github.com/developmentseed/rio-stac/pull/30), but it doesn?t seem to have fixed it for this example, as the underlying GDAL code used by his library (through rasterio, I believe) is giving this result.

I find this result unexpected, but I have no knowledge of how GDAL deals with the antimeridian. Is this to be expected, or is this potentially a bug? If it isn?t a bug, is there any way around this?

Best regards,

Robin

Dr Robin Wilson
www.rtwilson.com




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev
--  
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220330/b40bca55/attachment.html>

From petebunting at mac.com  Wed Mar 30 13:48:47 2022
From: petebunting at mac.com (Pete Bunting)
Date: Wed, 30 Mar 2022 21:48:47 +0100
Subject: [gdal-dev] GDAL 3.4.2: gdalbuildvrt band selection bug
In-Reply-To: <d7cdcf86-94dd-baf2-51bf-a65e04dfb41f@spatialys.com>
References: <25301AB6-8DA5-4FD9-A1F6-D78DAEFFBA0F@mac.com>
 <d7cdcf86-94dd-baf2-51bf-a65e04dfb41f@spatialys.com>
Message-ID: <D413902D-BE1D-4DC7-A9ED-255E4C2766EA@mac.com>

Thanks for the fix Even.

> On 30 Mar 2022, at 14:21, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> Pete,
> 
> ouch, confirmed, and fix queued in https://github.com/OSGeo/gdal/pull/5547 . And the commit you mention was indeed the culprit.
> 
> Potential workarounds (besides generating the VRT on GDAL <= 3.4.0)
> 
> - if using gdalbuildvrt on a single source, you could just use "gdal_translate sen2_20210527_aber_subset.kea test.vrt -b 2", that will do the job equally well
> 
> - if using multiple sources, you could also use gdal_translate with band selection on the VRT generated by gdalbuildvrt (without band selection) to extract only the band(s) you're interested in, but obviously that creates one more file
> 
> (do not hesitate to file an issue in github for obvious regressions like that. emails tend to be easily forgotten)
> 
> Even
> 
> Le 30/03/2022 ? 12:59, Pete Bunting via gdal-dev a ?crit :
>> Hi,
>> 
>> With the release of gdal 3.4.2, gdalbuildvrt seems to have a bug when selecting image bands. It works OK when band 1 is specified but if other band(s) in the image are used without band 1 then it seg faults. I noticed there were some changes around checking bands in the release notes "change logic to check homogenous number of bands? and I had a quick look at the commits but cannot see where this is occurring.
>> 
>> # Works:
>> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1
>> 
>> # Seg Faults:
>> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2
>> 
>> ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(2) - Illegal band #
>> Segmentation fault (core dumped)
>> 
>> 
>> # Works:
>> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 1 -b 2 -b 3
>> 
>> # Seg Faults:
>> gdalbuildvrt test.vrt sen2_20210527_aber_subset.kea -b 2 -b 3 -b 4
>> 
>> ERROR 5: sen2_20210527_aber_subset.kea: GDALDataset::GetRasterBand(4) - Illegal band #
>> Segmentation fault (core dumped)
>> 
>> Note, the input image I was using has 10 bands and these commands work with 3.4.1. I get the same seg fault on Mac, Linux and Windows ("Windows fatal exception: access violation").
>> 
>> Many thanks,
>> 
>> Pete
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
> 


