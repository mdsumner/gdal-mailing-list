From even.rouault at spatialys.com  Sun Jun  2 10:47:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 2 Jun 2024 19:47:59 +0200
Subject: [gdal-dev] gdalwarp across the antimeridian with a source
 extent >180E
In-Reply-To: <CAAcGz9-F2ttdk5AT+foCfiQXAXVyrcZhdm+R4uG0MGFAf5z6KQ@mail.gmail.com>
References: <CAAcGz9-F2ttdk5AT+foCfiQXAXVyrcZhdm+R4uG0MGFAf5z6KQ@mail.gmail.com>
Message-ID: <46f903d7-f95f-4b83-ad15-6fe640a8473f@spatialys.com>

Michael,

https://github.com/OSGeo/gdal/pull/10108 will fix it.

You can also workaround the issue by overriding the extent of the source 
dataset to be exactly -179.995,89.995,180.005,-89.995 with

 ?"vrt://NETCDF:20240102090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326&a_ullr=-179.995,89.995,180.005,-89.995"

The issue was twofolds:

- the dataset uses lon/lat arrays with single precision floating-point 
numbers. Hence -179.99 gets actually read a a read as 
-179.99000549316406 as a double-precision number, and thus the maxx - 
minxx difference was slightly over 360 degrees. I've added a heuristics 
to try to round -179.99-single-precision as -179.99-double-precision

- which defeated a heuristics in the warper to identify the center 
longitude of a dataset registered in a geographic CRS. This center 
longitude is just (min_lon + max_lon) / 2 if the dataset doesn't cover 
more than 360 degrees of longitude. This value, when computed, is passed 
as a hint OGRCoordinateTransformation so that it can post-correct 
longitudes to apply a +/- 360 degree offset, to be in the range of the 
source dataset. I've relaxed the sanity check to allow slighly more than 
360 degrees

Even


Le 01/06/2024 ? 08:19, Michael Sumner via gdal-dev a ?crit?:
> This data source has an odd georeferencing, it's a 36000x17999 raster 
> in the extent -179.995 -89.995 180.005 89.995.
>
> vrt://NETCDF:/vsicurl/https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326
>
> (Why is it 17999: well there's one missing row - you'd expect 18000 at 
> 0.01 resolution and that manifests as half a cell short at the top and 
> bottom).
>
> But also the x registration is half a cell to the east from what you 
> would expect.
>
> It's correctly registered in that frame though, if we shift it west by 
> the half cell I've verified visually that it "looks wrong" compared to 
> coastlines etc.
>
> The point of this report is, gdalwarp misses the western window of 
> data for a request across the antimeridian (there's no data in the 
> output east of 180).
>
> gdalwarp $dsn -te 173.00 -19.85 185.00 -15.00 out1.tif -co COMPRESS=LZW
>
> If we "fix" the extent to be more longitudinally pleasing, we get the 
> data east of the antimeridian, the map is properly filled either side 
> of the antimeridian.
>
>
> vrt://NETCDF:/vsicurl/https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326&a_ullr=-180,89.995,180,-89.995 
> <https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326&a_ullr=-180,89.995,180,-89.995>
>
> gdalwarp $dsnfix -te 173.00 -19.85 185.00 -15.00 out2.tif -co COMPRESS=LZW
>
>
> Which is good, but as mentioned above the workaround means we are now 
> half a cell out. It works fine for projected windows over the 
> antimeridian in either situation.
>
> The compressed file sizes reflect the missing data in the second one, 
> these are 625K and 1.1Mb.
>
> I'd like the warper to be able to correctly fill the data from the 
> western window in the original case, we have determined that we can't 
> feasibly "fix" the extent.
>
> Or maybe something else I'm missing? I don't *think* SAMPLE_GRID or 
> SOURCE_EXTRA helps here. I know that I could craft a meridian-crossing 
> combination in VRT but I'd rather like this workflow to work as-is.? 
> (Chasing down the weird grid referencing is another project, but it's 
> a really massive dataset so I'm pretty unconfident of that occurring).
>
> Cheers, Mike
>
> -- 
> Michael Sumner
> Research Software Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240602/d3435d8b/attachment.htm>

From andrew.bell.ia at gmail.com  Mon Jun  3 06:44:24 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Mon, 3 Jun 2024 09:44:24 -0400
Subject: [gdal-dev] Thread-safe raster access
Message-ID: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>

Hi,

I am aware that there isn't thread-safe raster access with the current GDAL
interface for various reasons. Given the state of processors, I was
wondering if it would be valuable to take a look at providing the ability
to do Raster I/O (at least reads) in a thread-safe way. This could be done
through a new set of API calls or perhaps by modifications to what
currently exists -- I don't know what makes sense at this point. I would be
happy to spend some time looking at this if there is interest, but I would
also like to learn from existing experience as to what kinds of things that
I'm surely not considering would have to be dealt with.

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240603/55870b67/attachment.htm>

From jctoney at gmail.com  Mon Jun  3 07:12:50 2024
From: jctoney at gmail.com (Chris Toney)
Date: Mon, 3 Jun 2024 08:12:50 -0600
Subject: [gdal-dev] Thread-safe raster access
In-Reply-To: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>
References: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>
Message-ID: <CALRbqOSpetsprvmdwke-kz6MtfuL6bUSoiD=D6-FZBq5sFwg-A@mail.gmail.com>

Hi Andrew,
Some related comments and links are in:
https://github.com/OSGeo/gdal/issues/9091

Chris

On Mon, Jun 3, 2024 at 7:44?AM Andrew Bell via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I am aware that there isn't thread-safe raster access with the current
> GDAL interface for various reasons. Given the state of processors, I was
> wondering if it would be valuable to take a look at providing the ability
> to do Raster I/O (at least reads) in a thread-safe way. This could be done
> through a new set of API calls or perhaps by modifications to what
> currently exists -- I don't know what makes sense at this point. I would be
> happy to spend some time looking at this if there is interest, but I would
> also like to learn from existing experience as to what kinds of things that
> I'm surely not considering would have to be dealt with.
>
> Thanks,
>
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240603/d70fd329/attachment.htm>

From j1 at jimenezshaw.com  Mon Jun  3 07:36:04 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 3 Jun 2024 16:36:04 +0200
Subject: [gdal-dev] Thread-safe raster access
In-Reply-To: <CALRbqOSpetsprvmdwke-kz6MtfuL6bUSoiD=D6-FZBq5sFwg-A@mail.gmail.com>
References: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>
 <CALRbqOSpetsprvmdwke-kz6MtfuL6bUSoiD=D6-FZBq5sFwg-A@mail.gmail.com>
Message-ID: <CADRrdKt=DT=+FoGkvOxjSQ-zxfTfmtDMfqRxz6DkV_i8RXAxpQ@mail.gmail.com>

If the purpose of multithreading is performance, a mutex will ruin that
performance.
Opening different datasets solves that already.

For writing, allowing different synchronous writers is... scary.

On Mon, 3 Jun 2024, 16:12 Chris Toney via gdal-dev, <
gdal-dev at lists.osgeo.org> wrote:

> Hi Andrew,
> Some related comments and links are in:
> https://github.com/OSGeo/gdal/issues/9091
>
> Chris
>
> On Mon, Jun 3, 2024 at 7:44?AM Andrew Bell via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi,
>>
>> I am aware that there isn't thread-safe raster access with the current
>> GDAL interface for various reasons. Given the state of processors, I was
>> wondering if it would be valuable to take a look at providing the ability
>> to do Raster I/O (at least reads) in a thread-safe way. This could be done
>> through a new set of API calls or perhaps by modifications to what
>> currently exists -- I don't know what makes sense at this point. I would be
>> happy to spend some time looking at this if there is interest, but I would
>> also like to learn from existing experience as to what kinds of things that
>> I'm surely not considering would have to be dealt with.
>>
>> Thanks,
>>
>> --
>> Andrew Bell
>> andrew.bell.ia at gmail.com
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240603/1b4e35d0/attachment.htm>

From even.rouault at spatialys.com  Mon Jun  3 10:04:50 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 3 Jun 2024 19:04:50 +0200
Subject: [gdal-dev] Thread-safe raster access
In-Reply-To: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>
References: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>
Message-ID: <c83a3916-8019-4986-823c-c16ed33f01b2@spatialys.com>

Andrew,

what would be the purpose of thread-safe access: just making it 
thread-safe without any particular requirement on how efficient this 
would be (1), or hope for true concurrent access with ideally close to 
linear scalability with the number of threads (2) ?

If (1), then we could add a GDALMutexedDataset class, similarly to 
https://github.com/OSGeo/gdal/blob/master/ogr/ogrsf_frmts/generic/ogrmutexeddatasource.h 
which exists on the vector side (just used by the FileGDB driver due to 
the fact that the underlying SDK is not even re-entrant), which uses the 
decorator pattern around all public API entry points to call the 
underlying dataset under a mutex.? One could imagine to have a 
GDAL_OF_THREADSAFE open flag that GDALOpen() would use to return such 
instance. Shouldn't be too hard to implement, but probably not that 
useful IMHO. I can anticipate most users would have higher expectations 
than a mutex-based implementation.

If (2), it seems to me that it would require a huge effort, and the 
programming language we use (C++) offers hardly any safety belt to make 
sure we don't make mistakes, the main one being forgetting to lock 
things that should be locked, or dead locks situation. If we go into 
doing that, I'm not even sure how we can reliably identify all parts of 
the code that must be modified

Neither GDAL raster?core nor any driver are designed to be thread-safe. 
For core, at least gcore/gdalarraybandblockcache.cpp and 
gcore/gdalhashsetbandblockcache.cpp which interact with the block cache 
should be made thread-safe, and "just" adding a lock would defeat the 
aim to achieve linear scalability. The change in GDALDataset::RasterIO() 
I did in 
https://github.com/OSGeo/gdal/commit/7f3a0e582eb189744bc7cb8e4a751135edaecaf5 
isn't thread-safe either (would be easy to make thread-safe though)

Once GDAL raster code is ready, the main challenge is making drivers 
themselves thread-safe. Raster drivers may directly read from a 
VSILFILE* handle, which isn't thread safe when using the standard Seek() 
+ Read() pair. A few VSIVirtualFileSystem have a PRead() implementation, 
which is thread-safe, but not all). Or they rely on using some instance 
of a "reader" returned by a third-party library (libtiff, libjpeg, 
libpng, sqlite3, etc.) (which in most cases also uses a?VSILFILE*), none 
of which are thread-safe (except sqlite3 that can be made thread-safe by 
passing a flag at sqlite3_open() time, that will basically applies 
strategy (1) by protecting all calls with a mutex). Perhaps using 
thread-specific instances of VSILFILE* and third-party "reader" objects 
could be a way of solving this. But realistically doing a pass in all 
GDAL drivers would be a multi-month-man to multi-year-man type of 
effort. A realistic plan should be designed to allow combining (1) and 
(2): (2) for a few select drivers, and (1) as a fallback for most 
drivers that wouldn't be updated.

Even

Le 03/06/2024 ? 15:44, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> I am aware that there isn't thread-safe raster access with the current 
> GDAL interface for various reasons. Given the state of processors, I 
> was wondering if it would be valuable to take a look at providing the 
> ability to do Raster I/O (at least reads) in a thread-safe way. This 
> could be done through a new set of API calls or perhaps by 
> modifications to what currently exists -- I don't know what makes 
> sense at this point. I would be happy to spend some time looking at 
> this if there is interest, but I would also like to learn from 
> existing experience as to what kinds of things that I'm surely not 
> considering would have to be dealt with.
>
> Thanks,
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240603/19fa8316/attachment.htm>

From mdsumner at gmail.com  Mon Jun  3 20:21:37 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 4 Jun 2024 13:21:37 +1000
Subject: [gdal-dev] gdalwarp across the antimeridian with a source
 extent >180E
In-Reply-To: <46f903d7-f95f-4b83-ad15-6fe640a8473f@spatialys.com>
References: <CAAcGz9-F2ttdk5AT+foCfiQXAXVyrcZhdm+R4uG0MGFAf5z6KQ@mail.gmail.com>
 <46f903d7-f95f-4b83-ad15-6fe640a8473f@spatialys.com>
Message-ID: <CAAcGz9_BBB=1aknRipqDdqxAzyqPXD5QNb+1s2z2-Gy-vi0rDQ@mail.gmail.com>

Thanks!   Educational as ever, this closes out a few hanging threads for
me, much appreciated.

Cheers, Mike



On Mon, Jun 3, 2024 at 3:48?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Michael,
>
> https://github.com/OSGeo/gdal/pull/10108 will fix it.
>
> You can also workaround the issue by overriding the extent of the source
> dataset to be exactly -179.995,89.995,180.005,-89.995 with
>
>
>  "vrt://NETCDF:20240102090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:
> analysed_sst?a_srs=EPSG:4326&a_ullr=-179.995,89.995,180.005,-89.995"
>
> The issue was twofolds:
>
> - the dataset uses lon/lat arrays with single precision floating-point
> numbers. Hence -179.99 gets actually read a a   read as -179.99000549316406
> as a double-precision number, and thus the maxx - minxx difference was
> slightly over 360 degrees. I've added a heuristics to try to round
> -179.99-single-precision as -179.99-double-precision
>
> - which defeated a heuristics in the warper to identify the center
> longitude of a dataset registered in a geographic CRS. This center
> longitude is just (min_lon + max_lon) / 2 if the dataset doesn't cover more
> than 360 degrees of longitude. This value, when computed, is passed as a
> hint OGRCoordinateTransformation so that it can post-correct longitudes to
> apply a +/- 360 degree offset, to be in the range of the source dataset.
> I've relaxed the sanity check to allow slighly more than 360 degrees
>
> Even
>
>
> Le 01/06/2024 ? 08:19, Michael Sumner via gdal-dev a ?crit :
>
> This data source has an odd georeferencing, it's a 36000x17999 raster in
> the extent -179.995 -89.995 180.005 89.995.
>
> vrt://NETCDF:/vsicurl/
> https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326
>
> (Why is it 17999: well there's one missing row - you'd expect 18000 at
> 0.01 resolution and that manifests as half a cell short at the top and
> bottom).
>
> But also the x registration is half a cell to the east from what you would
> expect.
>
> It's correctly registered in that frame though, if we shift it west by the
> half cell I've verified visually that it "looks wrong" compared to
> coastlines etc.
>
> The point of this report is, gdalwarp misses the western window of data
> for a request across the antimeridian (there's no data in the output east
> of 180).
>
> gdalwarp $dsn -te 173.00 -19.85 185.00 -15.00 out1.tif -co COMPRESS=LZW
>
> If we "fix" the extent to be more longitudinally pleasing, we get the data
> east of the antimeridian, the map is properly filled either side of the
> antimeridian.
>
>
> vrt://NETCDF:/vsicurl/
> https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326&a_ullr=-180,89.995,180,-89.995
>
> gdalwarp $dsnfix -te 173.00 -19.85 185.00 -15.00 out2.tif -co COMPRESS=LZW
>
>
> Which is good, but as mentioned above the workaround means we are now half
> a cell out. It works fine for projected windows over the antimeridian in
> either situation.
>
> The compressed file sizes reflect the missing data in the second one,
> these are 625K and 1.1Mb.
>
> I'd like the warper to be able to correctly fill the data from the western
> window in the original case, we have determined that we can't feasibly
> "fix" the extent.
>
> Or maybe something else I'm missing? I don't *think* SAMPLE_GRID or
> SOURCE_EXTRA helps here. I know that I could craft a meridian-crossing
> combination in VRT but I'd rather like this workflow to work as-is.
> (Chasing down the weird grid referencing is another project, but it's a
> really massive dataset so I'm pretty unconfident of that occurring).
>
> Cheers, Mike
>
> --
> Michael Sumner
> Research Software Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Research Software Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240604/a83d55c9/attachment.htm>

From variablestarlight at gmail.com  Tue Jun  4 07:29:51 2024
From: variablestarlight at gmail.com (=?UTF-8?Q?Hern=C3=A1n_De_Angelis?=)
Date: Tue, 4 Jun 2024 16:29:51 +0200
Subject: [gdal-dev] cmake error: IMPORTED_LOCATION not set for imported
 target "GEOTIFF::GEOTIFF"
Message-ID: <220e605c-e26c-4d9d-94e6-a913d882c454@gmail.com>

Hello!

While building GDAL 3.9.0 with libtiff 1.7.3 I am getting this error 
from ccmake when generating:

CMake Error in CMakeLists.txt:
 ?? IMPORTED_LOCATION not set for imported target "GEOTIFF::GEOTIFF"
 ?? configuration "Release".

I am used to build GDAL from source but never seen this before. Any hint 
on what does this mean and how to get around?

Thanks in advance!

Hern?n



From even.rouault at spatialys.com  Tue Jun  4 08:29:00 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 4 Jun 2024 17:29:00 +0200
Subject: [gdal-dev] cmake error: IMPORTED_LOCATION not set for imported
 target "GEOTIFF::GEOTIFF"
In-Reply-To: <220e605c-e26c-4d9d-94e6-a913d882c454@gmail.com>
References: <220e605c-e26c-4d9d-94e6-a913d882c454@gmail.com>
Message-ID: <9a49a9e3-cfba-45a2-ac99-dcf98d007ad5@spatialys.com>

Hi,

I don't reproduce this on my Linux setup. Can you give more information on:

- your operating system

- CMake version

- cmake command line you used to build libgeotiff

- cmake command line you use to build GDAL

Also, if you've reused an existing GDAL build directory that was used 
with a prior libgeotiff version, perhaps try rebuilding in a fresh build 
directory. libgeotiff CMake

Even

Le 04/06/2024 ? 16:29, Hern?n De Angelis via gdal-dev a ?crit?:
> Hello!
>
> While building GDAL 3.9.0 with libtiff 1.7.3 I am getting this error 
> from ccmake when generating:
>
> CMake Error in CMakeLists.txt:
> ?? IMPORTED_LOCATION not set for imported target "GEOTIFF::GEOTIFF"
> ?? configuration "Release".
>
> I am used to build GDAL from source but never seen this before. Any 
> hint on what does this mean and how to get around?
>
> Thanks in advance!
>
> Hern?n
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From variablestarlight at gmail.com  Tue Jun  4 10:04:26 2024
From: variablestarlight at gmail.com (=?UTF-8?Q?Hern=C3=A1n_De_Angelis?=)
Date: Tue, 4 Jun 2024 19:04:26 +0200
Subject: [gdal-dev] cmake error: IMPORTED_LOCATION not set for imported
 target "GEOTIFF::GEOTIFF"
In-Reply-To: <9a49a9e3-cfba-45a2-ac99-dcf98d007ad5@spatialys.com>
References: <220e605c-e26c-4d9d-94e6-a913d882c454@gmail.com>
 <9a49a9e3-cfba-45a2-ac99-dcf98d007ad5@spatialys.com>
Message-ID: <4f7483fb-eee9-4ba2-abfa-78cc34aeb1b1@gmail.com>

Thank you Even! That was it. Started with a fresh GDAL 3.9.0 directory 
and everything went fine as usual.

Best!

Hern?n


Den 2024-06-04 kl. 17:29, skrev Even Rouault:
> if you've reused an existing GDAL build directory that was used with a 
> prior libgeotiff version, perhaps try rebuilding in a fresh build 
> directory. libgeotiff CMake 

From rykovd at gmail.com  Tue Jun  4 18:35:38 2024
From: rykovd at gmail.com (Denis Rykov)
Date: Wed, 5 Jun 2024 03:35:38 +0200
Subject: [gdal-dev] gdaladdo slowness for VRTs
Message-ID: <CAJbvKNo72_BKcOugKBM5cr1dM6kNkCR-aOC+5tz2Dk5pYaaxyg@mail.gmail.com>

Hi,

I spotted a slow calculation of overviews and I'm wondering what could be
the reason.

$ gdal_create in.tif -if 20240602_230818_SN26_RR_VISUAL_MS.vrt
$ time gdaladdo -ro in.tif

gdaladdo -ro in.tif  4,25s user 6,23s system 34% cpu 30,623 total

But on the file of the same size and num of bands but VRT it takes much
more time:

$ time gdaladdo -ro 20240602_230818_SN26_RR_VISUAL_MS.vrt
gdaladdo -ro   55,36s user 5,06s system 44% cpu 2:14,79 total

Here is the output of gdalinfo of the VRT:

$ gdalinfo 20240602_230818_SN26_RR_VISUAL_MS.vrt
Driver: VRT/Virtual Raster
Files: 20240602_230818_SN26_RR_VISUAL_MS.vrt
       20240602_230818_SN26_RR_VISUAL_MS_340_5020.tif
       20240602_230818_SN26_RR_VISUAL_MS_340_5040.tif
       20240602_230818_SN26_RR_VISUAL_MS_360_5020.tif
       20240602_230818_SN26_RR_VISUAL_MS_360_5040.tif
       20240602_230818_SN26_RR_VISUAL_MS_360_5060.tif
Size is 20779, 46754
Coordinate System is:
PROJCRS["WGS 84 / UTM zone 59S",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 59S",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",171,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",10000000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",32759]]
Data axis to CRS axis mapping: 1,2
Origin = (353999.799999999988358,5068000.629999999888241)
Pixel Size = (0.770000000000000,-0.770000000000000)
Corner Coordinates:
Upper Left  (  353999.800, 5068000.630) (169d 9'45.50"E, 44d31'35.55"S)
Lower Left  (  353999.800, 5032000.050) (169d 9' 8.52"E, 44d51' 1.68"S)
Upper Right (  369999.630, 5068000.630) (169d21'50.06"E, 44d31'46.58"S)
Lower Right (  369999.630, 5032000.050) (169d21'17.12"E, 44d51'12.83"S)
Center      (  361999.715, 5050000.340) (169d15'30.36"E, 44d41'24.33"S)
Band 1 Block=128x128 Type=Byte, ColorInterp=Red
  NoData Value=0
Band 2 Block=128x128 Type=Byte, ColorInterp=Green
  NoData Value=0
Band 3 Block=128x128 Type=Byte, ColorInterp=Blue
  NoData Value=0
Band 4 Block=128x128 Type=Byte, ColorInterp=Undefined
  NoData Value=0

And gdalinfo output for one of the underlying rasters:

gdalinfo 20240602_230818_SN26_RR_VISUAL_MS_360_5040.tif
Driver: GTiff/GeoTIFF
Files: 20240602_230818_SN26_RR_VISUAL_MS_360_5040.tif
Size is 10390, 25974
Coordinate System is:
PROJCRS["WGS 84 / UTM zone 59S",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 59S",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",171,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",10000000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["Between 168?E and 174?E, southern hemisphere between 80?S and
equator, onshore and offshore. New Zealand."],
        BBOX[-80,168,0,174]],
    ID["EPSG",32759]]
Data axis to CRS axis mapping: 1,2
Origin = (359999.640000000013970,5060000.330000000074506)
Pixel Size = (0.770000000000000,-0.770000000000000)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (  359999.640, 5060000.330) (169d14' 9.36"E, 44d35'59.00"S)
Lower Left  (  359999.640, 5040000.350) (169d13'49.66"E, 44d46'46.86"S)
Upper Right (  367999.940, 5060000.330) (169d20'12.11"E, 44d36' 4.44"S)
Lower Right (  367999.940, 5040000.350) (169d19'53.53"E, 44d46'52.34"S)
Center      (  363999.790, 5050000.340) (169d17' 1.19"E, 44d41'25.70"S)
Band 1 Block=256x256 Type=Byte, ColorInterp=Red
  NoData Value=0
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
  NoData Value=0
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
  NoData Value=0
Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
  NoData Value=0

What could be the reason for such a significant difference?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240605/a5451e8c/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Jun  5 04:22:24 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 5 Jun 2024 11:22:24 +0000
Subject: [gdal-dev] gdaladdo slowness for VRTs
In-Reply-To: <CAJbvKNo72_BKcOugKBM5cr1dM6kNkCR-aOC+5tz2Dk5pYaaxyg@mail.gmail.com>
References: <CAJbvKNo72_BKcOugKBM5cr1dM6kNkCR-aOC+5tz2Dk5pYaaxyg@mail.gmail.com>
Message-ID: <DB9PR09MB68879F4D1950C99E4F7042CDFDF92@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

A better reference file can be created by materializing the VRT. The one created by gdal_create has the same raster values on all the pixels but the materialized one contains the same original image data. Maybe in your test case with uncompressed outputs the difference is not so big, but please test it anyway.

gdal_translate -of GTiff -co tiled=yes -co compress=LZW input.vrt output.tif
gdaladdo -ro output.tif

What is the difference in speed now? Ten times slower performance with vrt feels quite a lot.

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Denis Rykov via gdal-dev
L?hetetty: keskiviikko 5. kes?kuuta 2024 4.36
Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdaladdo slowness for VRTs

Hi,

I spotted a slow calculation of overviews and I'm wondering what could be the reason.

$ gdal_create in.tif -if 20240602_230818_SN26_RR_VISUAL_MS.vrt
$ time gdaladdo -ro in.tif
gdaladdo -ro in.tif  4,25s user 6,23s system 34% cpu 30,623 total

But on the file of the same size and num of bands but VRT it takes much more time:

$ time gdaladdo -ro 20240602_230818_SN26_RR_VISUAL_MS.vrt
gdaladdo -ro   55,36s user 5,06s system 44% cpu 2:14,79 total

Here is the output of gdalinfo of the VRT:

$ gdalinfo 20240602_230818_SN26_RR_VISUAL_MS.vrt
Driver: VRT/Virtual Raster
Files: 20240602_230818_SN26_RR_VISUAL_MS.vrt
       20240602_230818_SN26_RR_VISUAL_MS_340_5020.tif
       20240602_230818_SN26_RR_VISUAL_MS_340_5040.tif
       20240602_230818_SN26_RR_VISUAL_MS_360_5020.tif
       20240602_230818_SN26_RR_VISUAL_MS_360_5040.tif
       20240602_230818_SN26_RR_VISUAL_MS_360_5060.tif
Size is 20779, 46754
Coordinate System is:
PROJCRS["WGS 84 / UTM zone 59S",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 59S",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",171,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",10000000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",32759]]
Data axis to CRS axis mapping: 1,2
Origin = (353999.799999999988358,5068000.629999999888241)
Pixel Size = (0.770000000000000,-0.770000000000000)
Corner Coordinates:
Upper Left  (  353999.800, 5068000.630) (169d 9'45.50"E, 44d31'35.55"S)
Lower Left  (  353999.800, 5032000.050) (169d 9' 8.52"E, 44d51' 1.68"S)
Upper Right (  369999.630, 5068000.630) (169d21'50.06"E, 44d31'46.58"S)
Lower Right (  369999.630, 5032000.050) (169d21'17.12"E, 44d51'12.83"S)
Center      (  361999.715, 5050000.340) (169d15'30.36"E, 44d41'24.33"S)
Band 1 Block=128x128 Type=Byte, ColorInterp=Red
  NoData Value=0
Band 2 Block=128x128 Type=Byte, ColorInterp=Green
  NoData Value=0
Band 3 Block=128x128 Type=Byte, ColorInterp=Blue
  NoData Value=0
Band 4 Block=128x128 Type=Byte, ColorInterp=Undefined
  NoData Value=0

And gdalinfo output for one of the underlying rasters:

gdalinfo 20240602_230818_SN26_RR_VISUAL_MS_360_5040.tif
Driver: GTiff/GeoTIFF
Files: 20240602_230818_SN26_RR_VISUAL_MS_360_5040.tif
Size is 10390, 25974
Coordinate System is:
PROJCRS["WGS 84 / UTM zone 59S",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 59S",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",171,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",10000000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["Between 168?E and 174?E, southern hemisphere between 80?S and equator, onshore and offshore. New Zealand."],
        BBOX[-80,168,0,174]],
    ID["EPSG",32759]]
Data axis to CRS axis mapping: 1,2
Origin = (359999.640000000013970,5060000.330000000074506)
Pixel Size = (0.770000000000000,-0.770000000000000)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (  359999.640, 5060000.330) (169d14' 9.36"E, 44d35'59.00"S)
Lower Left  (  359999.640, 5040000.350) (169d13'49.66"E, 44d46'46.86"S)
Upper Right (  367999.940, 5060000.330) (169d20'12.11"E, 44d36' 4.44"S)
Lower Right (  367999.940, 5040000.350) (169d19'53.53"E, 44d46'52.34"S)
Center      (  363999.790, 5050000.340) (169d17' 1.19"E, 44d41'25.70"S)
Band 1 Block=256x256 Type=Byte, ColorInterp=Red
  NoData Value=0
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
  NoData Value=0
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
  NoData Value=0
Band 4 Block=256x256 Type=Byte, ColorInterp=Undefined
  NoData Value=0

What could be the reason for such a significant difference?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240605/f7431b73/attachment-0001.htm>

From didomeister at gmail.com  Wed Jun  5 13:31:00 2024
From: didomeister at gmail.com (Deyan Vasilev)
Date: Wed, 5 Jun 2024 23:31:00 +0300
Subject: [gdal-dev] Thread-safe raster access
In-Reply-To: <c83a3916-8019-4986-823c-c16ed33f01b2@spatialys.com>
References: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>
 <c83a3916-8019-4986-823c-c16ed33f01b2@spatialys.com>
Message-ID: <CAPULynWncJ2zKBeG0A6JnS_8uh=bUe=Zaoh7ZTWrEpEMqp9KTA@mail.gmail.com>

Hi,
I've written a piece of software that fetches tiles out of a single
MBTiles raster done by multiple threads. Tiles go to a common cache
which can be used by a "view" thread that assembles tiles on the
screen in a seamless map.

Each fetcher thread uses GDALOpenEx() and then RasterIO(GF_Read,,,) to
get individual RGB bands out of the stored PNG tiles in the source
MBTiles db. On the lowest level
GDALGPKGMBTilesLikePseudoDataset::ReadTile() does a sqlite3 "SELECT
tile_data FROM tiles..." with a db context which is unique to every
fetcher thread.

Giving a recap, a multithreaded raster read on a single raster source
is doable, eased probably by the sqlite raster container that I use in
my app.

Best regards,
Deyan




On Mon, Jun 3, 2024 at 8:04?PM Even Rouault via gdal-dev
<gdal-dev at lists.osgeo.org> wrote:
>
> Andrew,
>
> what would be the purpose of thread-safe access: just making it thread-safe without any particular requirement on how efficient this would be (1), or hope for true concurrent access with ideally close to linear scalability with the number of threads (2) ?
>
> If (1), then we could add a GDALMutexedDataset class, similarly to https://github.com/OSGeo/gdal/blob/master/ogr/ogrsf_frmts/generic/ogrmutexeddatasource.h which exists on the vector side (just used by the FileGDB driver due to the fact that the underlying SDK is not even re-entrant), which uses the decorator pattern around all public API entry points to call the underlying dataset under a mutex.  One could imagine to have a GDAL_OF_THREADSAFE open flag that GDALOpen() would use to return such instance. Shouldn't be too hard to implement, but probably not that useful IMHO. I can anticipate most users would have higher expectations than a mutex-based implementation.
>
> If (2), it seems to me that it would require a huge effort, and the programming language we use (C++) offers hardly any safety belt to make sure we don't make mistakes, the main one being forgetting to lock things that should be locked, or dead locks situation. If we go into doing that, I'm not even sure how we can reliably identify all parts of the code that must be modified
>
> Neither GDAL raster core nor any driver are designed to be thread-safe. For core, at least gcore/gdalarraybandblockcache.cpp and gcore/gdalhashsetbandblockcache.cpp which interact with the block cache should be made thread-safe, and "just" adding a lock would defeat the aim to achieve linear scalability. The change in GDALDataset::RasterIO() I did in https://github.com/OSGeo/gdal/commit/7f3a0e582eb189744bc7cb8e4a751135edaecaf5 isn't thread-safe either (would be easy to make thread-safe though)
>
> Once GDAL raster code is ready, the main challenge is making drivers themselves thread-safe. Raster drivers may directly read from a VSILFILE* handle, which isn't thread safe when using the standard Seek() + Read() pair. A few VSIVirtualFileSystem have a PRead() implementation, which is thread-safe, but not all). Or they rely on using some instance of a "reader" returned by a third-party library (libtiff, libjpeg, libpng, sqlite3, etc.) (which in most cases also uses a VSILFILE*), none of which are thread-safe (except sqlite3 that can be made thread-safe by passing a flag at sqlite3_open() time, that will basically applies strategy (1) by protecting all calls with a mutex). Perhaps using thread-specific instances of VSILFILE* and third-party "reader" objects could be a way of solving this. But realistically doing a pass in all GDAL drivers would be a multi-month-man to multi-year-man type of effort. A realistic plan should be designed to allow combining (1) and (2): (2) for a few select drivers, and (1) as a fallback for most drivers that wouldn't be updated.
>
> Even
>
> Le 03/06/2024 ? 15:44, Andrew Bell via gdal-dev a ?crit :
>
> Hi,
>
> I am aware that there isn't thread-safe raster access with the current GDAL interface for various reasons. Given the state of processors, I was wondering if it would be valuable to take a look at providing the ability to do Raster I/O (at least reads) in a thread-safe way. This could be done through a new set of API calls or perhaps by modifications to what currently exists -- I don't know what makes sense at this point. I would be happy to spend some time looking at this if there is interest, but I would also like to learn from existing experience as to what kinds of things that I'm surely not considering would have to be dealt with.
>
> Thanks,
>
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From andrew.bell.ia at gmail.com  Wed Jun  5 15:58:08 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Wed, 5 Jun 2024 18:58:08 -0400
Subject: [gdal-dev] Thread-safe raster access
In-Reply-To: <CAPULynWncJ2zKBeG0A6JnS_8uh=bUe=Zaoh7ZTWrEpEMqp9KTA@mail.gmail.com>
References: <CACJ51z3+bGgGxD02NtdsKP7wJRp47RPXR9tZZtt7JZ9c2yth-w@mail.gmail.com>
 <c83a3916-8019-4986-823c-c16ed33f01b2@spatialys.com>
 <CAPULynWncJ2zKBeG0A6JnS_8uh=bUe=Zaoh7ZTWrEpEMqp9KTA@mail.gmail.com>
Message-ID: <CACJ51z2TxhzF_i1G79Bain4ej51sTQOC_HX7HsEoOrzdTQCM7w@mail.gmail.com>

Hi all,

Thanks for the thoughts.

>From an algorithmic perspective, it's frustrating to have to wait to
read/write data. There are ways, up to a point, to avoid some of this with
the current interface, but it can make applications complicated and for
algorithms that can process blocks separately, having to wait on
reads/writes is unfortunate. I understand that some drivers will be
constrained due to the provided APIs, but I don't know that this needs to
hold back a more general implementation.

My thinking at this time is that some other interface is preferable to
trying to making the existing code thread-safe. It might make it easier to
write threaded applications as well. The current band model that allows
mixed reads and writes seems like it would complicate things. I wonder if
there are many applications that both read from and write to the same
raster.

GDAL is a long-lived system and it does many, many things well and provides
lots of options. Perhaps stripping away a certain amount of the current
flexibility would allow much of the driver code to be reused and progress
to be made in a more timely manner. The code doesn't have to do everything
to be useful.

Anyway, if you have further ideas, feel free to write me.

Thanks,


On Wed, Jun 5, 2024 at 4:31?PM Deyan Vasilev <didomeister at gmail.com> wrote:

> Hi,
> I've written a piece of software that fetches tiles out of a single
> MBTiles raster done by multiple threads. Tiles go to a common cache
> which can be used by a "view" thread that assembles tiles on the
> screen in a seamless map.
>
> Each fetcher thread uses GDALOpenEx() and then RasterIO(GF_Read,,,) to
> get individual RGB bands out of the stored PNG tiles in the source
> MBTiles db. On the lowest level
> GDALGPKGMBTilesLikePseudoDataset::ReadTile() does a sqlite3 "SELECT
> tile_data FROM tiles..." with a db context which is unique to every
> fetcher thread.
>
> Giving a recap, a multithreaded raster read on a single raster source
> is doable, eased probably by the sqlite raster container that I use in
> my app.
>
> Best regards,
> Deyan
>
>
>
>
> On Mon, Jun 3, 2024 at 8:04?PM Even Rouault via gdal-dev
> <gdal-dev at lists.osgeo.org> wrote:
> >
> > Andrew,
> >
> > what would be the purpose of thread-safe access: just making it
> thread-safe without any particular requirement on how efficient this would
> be (1), or hope for true concurrent access with ideally close to linear
> scalability with the number of threads (2) ?
> >
> > If (1), then we could add a GDALMutexedDataset class, similarly to
> https://github.com/OSGeo/gdal/blob/master/ogr/ogrsf_frmts/generic/ogrmutexeddatasource.h
> which exists on the vector side (just used by the FileGDB driver due to the
> fact that the underlying SDK is not even re-entrant), which uses the
> decorator pattern around all public API entry points to call the underlying
> dataset under a mutex.  One could imagine to have a GDAL_OF_THREADSAFE open
> flag that GDALOpen() would use to return such instance. Shouldn't be too
> hard to implement, but probably not that useful IMHO. I can anticipate most
> users would have higher expectations than a mutex-based implementation.
> >
> > If (2), it seems to me that it would require a huge effort, and the
> programming language we use (C++) offers hardly any safety belt to make
> sure we don't make mistakes, the main one being forgetting to lock things
> that should be locked, or dead locks situation. If we go into doing that,
> I'm not even sure how we can reliably identify all parts of the code that
> must be modified
> >
> > Neither GDAL raster core nor any driver are designed to be thread-safe.
> For core, at least gcore/gdalarraybandblockcache.cpp and
> gcore/gdalhashsetbandblockcache.cpp which interact with the block cache
> should be made thread-safe, and "just" adding a lock would defeat the aim
> to achieve linear scalability. The change in GDALDataset::RasterIO() I did
> in
> https://github.com/OSGeo/gdal/commit/7f3a0e582eb189744bc7cb8e4a751135edaecaf5
> isn't thread-safe either (would be easy to make thread-safe though)
> >
> > Once GDAL raster code is ready, the main challenge is making drivers
> themselves thread-safe. Raster drivers may directly read from a VSILFILE*
> handle, which isn't thread safe when using the standard Seek() + Read()
> pair. A few VSIVirtualFileSystem have a PRead() implementation, which is
> thread-safe, but not all). Or they rely on using some instance of a
> "reader" returned by a third-party library (libtiff, libjpeg, libpng,
> sqlite3, etc.) (which in most cases also uses a VSILFILE*), none of which
> are thread-safe (except sqlite3 that can be made thread-safe by passing a
> flag at sqlite3_open() time, that will basically applies strategy (1) by
> protecting all calls with a mutex). Perhaps using thread-specific instances
> of VSILFILE* and third-party "reader" objects could be a way of solving
> this. But realistically doing a pass in all GDAL drivers would be a
> multi-month-man to multi-year-man type of effort. A realistic plan should
> be designed to allow combining (1) and (2): (2) for a few select drivers,
> and (1) as a fallback for most drivers that wouldn't be updated.
> >
> > Even
> >
> > Le 03/06/2024 ? 15:44, Andrew Bell via gdal-dev a ?crit :
> >
> > Hi,
> >
> > I am aware that there isn't thread-safe raster access with the current
> GDAL interface for various reasons. Given the state of processors, I was
> wondering if it would be valuable to take a look at providing the ability
> to do Raster I/O (at least reads) in a thread-safe way. This could be done
> through a new set of API calls or perhaps by modifications to what
> currently exists -- I don't know what makes sense at this point. I would be
> happy to spend some time looking at this if there is interest, but I would
> also like to learn from existing experience as to what kinds of things that
> I'm surely not considering would have to be dealt with.
> >
> > Thanks,
> >
> > --
> > Andrew Bell
> > andrew.bell.ia at gmail.com
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >
> > --
> > http://www.spatialys.com
> > My software is free, but my time generally not.
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240605/9f89377b/attachment.htm>

From schnetter at gmail.com  Thu Jun  6 08:43:21 2024
From: schnetter at gmail.com (Erik Schnetter)
Date: Thu, 6 Jun 2024 11:43:21 -0400
Subject: [gdal-dev] Adding float16 support to GDAL
Message-ID: <CADKQjjdZFyLY+D40YJEjy3iK3QbJRi4SpwwM2ue8DRgd=5gMzg@mail.gmail.com>

I am interested in GDAL supporting float16 values (i.e. IEEE 16-bit
floating point values) natively. If this suggestion succeeds I will
most likely be able to provide such an implementation.

I have prepared a draft RFC for this, available as a pull request at
<https://github.com/OSGeo/gdal/pull/10146/files>. This spells out
details of my suggestion. I am looking for comments.

-erik

-- 
Erik Schnetter <schnetter at gmail.com>
http://www.perimeterinstitute.ca/personal/eschnetter/

From gdt at lexort.com  Thu Jun  6 10:17:10 2024
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 06 Jun 2024 13:17:10 -0400
Subject: [gdal-dev] doc bugs about prereqs,
 surfaced by updating pkgsrc for 3.9
Message-ID: <rmizfryvvmx.fsf@s1.lexort.com>

1) README.md points to build hints (my fault if that's wrong..):

  https://gdal.org/development/building_from_source.html

but really there is crucial information (like that a C++ compiler is
required!) at

  https://gdal.org/development/dev_environment.html

which is misplaced, because people are who merely intending to compile
gdal but not contribute to it, still need to know.  I almost didn't even
look at it before writing that it wasn't documented which C++ flavor is
needed, because it was obviously not about what I needed to know.

How do we want to fix this?

  move the prereqs into building_from_source (and probably flip that to
  before dev_environment)

  add a pointer in building_from_source that even for building as a
  user, see the prereqs listed in dev_environment

  something else?  (Overall I find the organizational intent hard to
  follow.  I would think "how to build from source" would be first, and
  then if people are getting help to set up an environment where they
  can run tests, make changes, etc. get into things that a user just
  building doesn't need to know.)

I lean to the first option as easy and good enough to address the
problem.

2) NEWS for 3.9 does not mention that there is now a requirement for a C++17
compiler.   I'm not complaining about the new language requirement,
given that 24 > 17 + enough, but that's a big deal, and it requires
packagers to code for that because not every compiler supports C++17.
gcc says

  https://gcc.gnu.org/projects/cxx-status.html#cxx17

you need gcc8.

It turned out that gdal 3.9 didn't build on NetBSD 9, and someone coded
the package for c++17 (which is easy).

Increased build requirements are a big enough deal that they belong up
front in NEWS.  If not in "in a nutshell", there should probably be a
"changes in requirements" section immediately after that.  (My view is
that building from source is the standard approach even if most don't,
and that because people use packaged binaries, packagers are a
particularly import audience, carrying the weight of all their users.
There are enough older/LTS things out there that one can't assume the
compiler supports newfangled stuff like c++17.  We can just about now
assume that c++11 support is present.)

3) The person also marked gdal for c17, but I can't find that in the
"dev_environment" page - it says c99.  It's also not in NEWS.  This may
be overzealous, and I'll ask.  Mentioning it because I'm already
writing.


Thanks,
Greg

From even.rouault at spatialys.com  Thu Jun  6 10:59:52 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 6 Jun 2024 19:59:52 +0200
Subject: [gdal-dev] doc bugs about prereqs,
 surfaced by updating pkgsrc for 3.9
In-Reply-To: <rmizfryvvmx.fsf@s1.lexort.com>
References: <rmizfryvvmx.fsf@s1.lexort.com>
Message-ID: <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com>


> which is misplaced, because people are who merely intending to compile
> gdal but not contribute to it, still need to know.  I almost didn't even
> look at it before writing that it wasn't documented which C++ flavor is
> needed, because it was obviously not about what I needed to know.
Attempt to improve in https://github.com/OSGeo/gdal/pull/10151
>
> 2) NEWS for 3.9 does not mention that there is now a requirement for a C++17
> compiler.

==> 3rd bullet point of "In a nutshell"

* [RFC 
98](https://gdal.org/development/rfc/rfc98_build_requirements_gdal_3_9.html):
 ? Build requirements for GDAL 3.9

> 3) The person also marked gdal for c17

Can you be more explicit about you mean by "the person also marked gdal 
for c17" : where exactly?

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240606/48f017d2/attachment.htm>

From gdt at lexort.com  Thu Jun  6 11:13:29 2024
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 06 Jun 2024 14:13:29 -0400
Subject: [gdal-dev] doc bugs about prereqs,
 surfaced by updating pkgsrc for 3.9
In-Reply-To: <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com> (Even
 Rouault's message of "Thu, 6 Jun 2024 19:59:52 +0200")
References: <rmizfryvvmx.fsf@s1.lexort.com>
 <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com>
Message-ID: <rmile3ivt12.fsf@s1.lexort.com>

Even Rouault <even.rouault at spatialys.com> writes:

>> which is misplaced, because people are who merely intending to compile
>> gdal but not contribute to it, still need to know.  I almost didn't even
>> look at it before writing that it wasn't documented which C++ flavor is
>> needed, because it was obviously not about what I needed to know.
> Attempt to improve in https://github.com/OSGeo/gdal/pull/10151

great, have commented.

>> 2) NEWS for 3.9 does not mention that there is now a requirement for a C++17
>> compiler.
>
> ==> 3rd bullet point of "In a nutshell"
>
> * [RFC
>   98](https://gdal.org/development/rfc/rfc98_build_requirements_gdal_3_9.html):
> ? Build requirements for GDAL 3.9

I see.  I didn't find that searching for C++17....  For packagers
reading, I would like to see

   * a C++17 compiler is now required

not a link to some RFC, basically inlining what's new.  Increased build
requirements are a huge big deal, because they need to be encoded in
packaging control files.  Especially compilers, because on many systems,
updating compilers is harder than updating geos along with gdal.

>> 3) The person also marked gdal for c17
>
> Can you be more explicit about you mean by "the person also marked
> gdal for c17" : where exactly?

In pkgsrc, we have checked in control files that decribe how to build
each package.  The gdal-lib package recently had a change to that file
saying that the C compiler must support C17, and I am suspecting that
requiring C17 is incorrect.  It's not in RFC98 either.  And you didn't
say "oh yeah we need c17 now".

gcc7, in NetBSD 9, supports almost all of c++17, but it seems that 100%
support is not until gcc8.  We may have an incorrect mapping c++17->7
when it should be 8.

Specifically:
  Template argument deduction for class templates
  P0512R0
needs 8.

So the big question is if gdal builds with gcc7, or if it needs 8.

From gdt at lexort.com  Thu Jun  6 11:21:29 2024
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 06 Jun 2024 14:21:29 -0400
Subject: [gdal-dev] doc bugs about prereqs,
 surfaced by updating pkgsrc for 3.9
In-Reply-To: <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com> (Even
 Rouault's message of "Thu, 6 Jun 2024 19:59:52 +0200")
References: <rmizfryvvmx.fsf@s1.lexort.com>
 <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com>
Message-ID: <rmih6e6vsnq.fsf@s1.lexort.com>

also, I am far from a cmake expert, but I looked in the CMakeFiles  and
cannot find where they

  - try to run the compiler with --std=c++17
  - fail the build if that does not work with a message that makes it
    clear that the compiler doesn't work --std=c++17
  - if it works, add --std=c++17 to the compiler invocations, because
    requiring a c++17 compiler is fine, but one can't assume that it
    uses it by default

Maybe it does all that and my cmake-fu is too weak.



From even.rouault at spatialys.com  Thu Jun  6 11:30:25 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 6 Jun 2024 20:30:25 +0200
Subject: [gdal-dev] doc bugs about prereqs,
 surfaced by updating pkgsrc for 3.9
In-Reply-To: <rmih6e6vsnq.fsf@s1.lexort.com>
References: <rmizfryvvmx.fsf@s1.lexort.com>
 <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com>
 <rmih6e6vsnq.fsf@s1.lexort.com>
Message-ID: <0f24cee8-5385-45d6-b4ad-e952a1305529@spatialys.com>


Le 06/06/2024 ? 20:21, Greg Troxel a ?crit?:
> also, I am far from a cmake expert, but I looked in the CMakeFiles  and
> cannot find where they
>
>    - try to run the compiler with --std=c++17
set(CMAKE_CXX_STANDARD 17) at
https://github.com/OSGeo/gdal/blob/399a0f55d20755120fa49dec36054d2fa8531fbc/CMakeLists.txt#L41
>    - fail the build if that does not work with a message that makes it
>      clear that the compiler doesn't work --std=c++17

cf set(CMAKE_CXX_STANDARD_REQUIRED ON) on following line

and 
https://cmake.org/cmake/help/latest/prop_tgt/CXX_STANDARD_REQUIRED.html#prop_tgt:CXX_STANDARD_REQUIRED

>    - if it works, add --std=c++17 to the compiler invocations, because
>      requiring a c++17 compiler is fine, but one can't assume that it
>      uses it by default

https://cmake.org/cmake/help/latest/prop_tgt/CXX_STANDARD.html#prop_tgt:CXX_STANDARD:

" For some compilers, this results in adding a flag such as 
|-std=gnu++11| to the compile line"

So all in all that should do the right thing.

No idea if you need gcc 7 or 8. I don't think we use super advanced 
C++17 features, so gcc 7 might be fine, but only experimentation would 
confirm that. I believe the minimum we test on our CI is gcc 9.4 that 
ships with Ubuntu 20.04

-- 

http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240606/e26d5f26/attachment.htm>

From sebastic at xs4all.nl  Thu Jun  6 11:29:36 2024
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Thu, 6 Jun 2024 20:29:36 +0200
Subject: [gdal-dev] doc bugs about prereqs,
 surfaced by updating pkgsrc for 3.9
In-Reply-To: <rmih6e6vsnq.fsf@s1.lexort.com>
References: <rmizfryvvmx.fsf@s1.lexort.com>
 <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com>
 <rmih6e6vsnq.fsf@s1.lexort.com>
Message-ID: <88db14fc-9d2a-4705-8991-afe36b09cb58@xs4all.nl>

On 6/6/24 8:21 PM, Greg Troxel via gdal-dev wrote:
> also, I am far from a cmake expert, but I looked in the CMakeFiles  and
> cannot find where they
> 
>    - try to run the compiler with --std=c++17

  # check compiler and set preferences.
  if (NOT CMAKE_CXX_STANDARD)
      set(CMAKE_CXX_STANDARD 17)
      set(CMAKE_CXX_STANDARD_REQUIRED ON)
  endif()

https://github.com/OSGeo/gdal/blob/master/CMakeLists.txt#L39-L43

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1


From andrew.bell.ia at gmail.com  Thu Jun  6 14:05:50 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Thu, 6 Jun 2024 17:05:50 -0400
Subject: [gdal-dev] get_cli_utility_path_internal
Message-ID: <CACJ51z0vhFFZu1Mg8XSp6oQsadtxqeNtOk8k+FnGxTp+VYB2HA@mail.gmail.com>

The function in the subject returns a path to a utility on which to run a
test. But in the process, it tries to run the utility itself. This seems
strange. In my case, the test itself failed, but the code reported "Could
not find {file}", which is incorrect. It also causes the actual tests to
get skipped, when they should fail.

I can fix this, but I don't understand why there's an attempt to run a
utility in order to determine its path. I would think that checking that
the file exists would be sufficient (and this already occurs), but I'm not
privy to the history.

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240606/dcc77a73/attachment.htm>

From even.rouault at spatialys.com  Thu Jun  6 14:19:47 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 6 Jun 2024 23:19:47 +0200
Subject: [gdal-dev] get_cli_utility_path_internal
In-Reply-To: <CACJ51z0vhFFZu1Mg8XSp6oQsadtxqeNtOk8k+FnGxTp+VYB2HA@mail.gmail.com>
References: <CACJ51z0vhFFZu1Mg8XSp6oQsadtxqeNtOk8k+FnGxTp+VYB2HA@mail.gmail.com>
Message-ID: <67368b1d-8fa4-444a-b1da-39d3a90a9e86@spatialys.com>

Andrew,

obviously this code having essentially passed through the ages since 
2008, I don't remember all the details :-) I assume this was an attempt 
to pick up a binary that could be run and was part of the build tree, 
instead of a system gdalinfo/etc. binary, but this could likely be 
simplified by assuming that the PATH is set to have the path for the 
binaries of the GDAL build listed first. Running through ctest should 
already ensure this. Running directly with pytest, not necessarily, but 
developers are then supposed to correctly set their env (e.g? with 
scripts/setdevenv.sh on Unix), and CI configs should hopefully do that. 
If you were to change this, it would be nice though to check that the 
version reported by the utility matches the one of the Python bindings 
to detect potentially mismatches.

Even

Le 06/06/2024 ? 23:05, Andrew Bell via gdal-dev a ?crit?:
> The function in the subject returns a path to a utility on which to 
> run a test. But in the process, it tries to run the utility itself. 
> This seems strange. In my case, the test itself failed, but the code 
> reported "Could not find {file}", which is incorrect. It also causes 
> the actual tests to get skipped, when they should fail.
>
> I can fix this, but I don't understand why there's an attempt to run a 
> utility in order to determine its path. I would think that checking 
> that the file exists would be sufficient (and this already occurs), 
> but I'm not privy to the history.
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240606/cf8ff263/attachment.htm>

From lefsky at gmail.com  Thu Jun  6 21:48:10 2024
From: lefsky at gmail.com (lefsky at gmail.com)
Date: Thu, 6 Jun 2024 22:48:10 -0600
Subject: [gdal-dev] Python code with gdal_calc
Message-ID: <CAPryQ-MeG4G-AdQGmiCv7gWt8Pf=hM1RpxFz0tOHVO41vKLhbg@mail.gmail.com>

I know gdal_calc calculates using "python syntax" but I've never seen
documentation for using numpy functions within the calc statement. From my
simplistic perspective, allowing numpy functions would make gdal_calc much
more powerful without too much additional coding.

Or is there something I'm missing?

M

Michael Lefsky (He/His)
Home Location: HVHF+GH
Cell: 970-980-9036
http://www.researcherid.com/rid/A-7224-2009

*?for being prematurely, and worse, intuitively right ? there?s a heavy
price. But for being wrong ? no, not so long as you?re wrong in a pack."
Gary Brecher / Portis*

*I acknowledge that I live and work on stolen land. This is the land of the
Cheyenne, Arapaho, Ute, and Ocheithi Sakowin people. To learn more about
these nations, please visit;
http://www.utemountainutetribe.com/
http://www.cheyennenation.com/
https://cheyenneandarapaho-nsn.gov/
https://native-land.ca/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240606/bbaf40ca/attachment.htm>

From public at postholer.com  Thu Jun  6 22:05:21 2024
From: public at postholer.com (Scott)
Date: Thu, 6 Jun 2024 22:05:21 -0700
Subject: [gdal-dev] Python code with gdal_calc
In-Reply-To: <CAPryQ-MeG4G-AdQGmiCv7gWt8Pf=hM1RpxFz0tOHVO41vKLhbg@mail.gmail.com>
References: <CAPryQ-MeG4G-AdQGmiCv7gWt8Pf=hM1RpxFz0tOHVO41vKLhbg@mail.gmail.com>
Message-ID: <32efb69f-d849-4c44-897a-0969b8402de5@postholer.com>

https://gdal.org/programs/gdal_calc.html

see the examples at the bottom. There are a number of numpy.* statements.

On 6/6/24 21:48, lefsky--- via gdal-dev wrote:
> I know gdal_calc calculates using "python syntax" but I've never seen 
> documentation for using numpy functions within the calc statement. From 
> my simplistic perspective, allowing numpy functions would make gdal_calc 
> much more powerful without too much additional coding.
> 
> Or is there something I'm missing?
> 
> M
> 
> Michael Lefsky (He/His)
> Home Location: HVHF+GH
> Cell: 970-980-9036
> http://www.researcherid.com/rid/A-7224-2009 
> <http://www.researcherid.com/rid/A-7224-2009>
> 
> /*?**for being prematurely, and worse, intuitively right ? there?s a 
> heavy price. But for being wrong ? no, not so long as you?re wrong in a 
> pack.****" Gary Brecher / Portis*/
> /*
> */
> *I acknowledge that I live and work on stolen land. This is the land of 
> the Cheyenne, Arapaho, Ute, and Ocheithi Sakowin people. To learn more 
> about these nations, please visit;
> http://www.utemountainutetribe.com/ <http://www.utemountainutetribe.com/>
> http://www.cheyennenation.com/ <http://www.cheyennenation.com/>
> https://cheyenneandarapaho-nsn.gov/ <https://cheyenneandarapaho-nsn.gov/>
> https://native-land.ca/ <https://native-land.ca/>
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From gdt at lexort.com  Fri Jun  7 08:38:52 2024
From: gdt at lexort.com (Greg Troxel)
Date: Fri, 07 Jun 2024 11:38:52 -0400
Subject: [gdal-dev] doc bugs about prereqs,
 surfaced by updating pkgsrc for 3.9
In-Reply-To: <0f24cee8-5385-45d6-b4ad-e952a1305529@spatialys.com> (Even
 Rouault's message of "Thu, 6 Jun 2024 20:30:25 +0200")
References: <rmizfryvvmx.fsf@s1.lexort.com>
 <b91291e5-cdd8-4c31-9086-200ea788654c@spatialys.com>
 <rmih6e6vsnq.fsf@s1.lexort.com>
 <0f24cee8-5385-45d6-b4ad-e952a1305529@spatialys.com>
Message-ID: <rmiplsspxtf.fsf@s1.lexort.com>

Even Rouault <even.rouault at spatialys.com> writes:

> [cmake]

Thanks for cluing me in; that  all makes sense.

> No idea if you need gcc 7 or 8. I don't think we use super advanced
> C++17 features, so gcc 7 might be fine, but only experimentation would
> confirm that. I believe the minimum we test on our CI is gcc 9.4 that
> ships with Ubuntu 20.04

7 fails, because gdal uses <charconv> and that only appeared in 8.  10
works, but you know that.  I am trying with 8, but gcc8 is still
building.  I'll report back if that fails.


From andrew.bell.ia at gmail.com  Fri Jun  7 10:36:40 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Fri, 7 Jun 2024 13:36:40 -0400
Subject: [gdal-dev] pre-commit hook failure
Message-ID: <CACJ51z1GCVM6sebOPkcd+Vb3CwBB7tWdWaYuEm4SFC5eH-oTzw@mail.gmail.com>

Hi,

I'm getting an error when flake8 runs as a pre-commit hook and it won't
allow me to commit code. My understanding was that the pre-commit stuff was
supposed to make sure the proper versions were found. Ideas?

(gdal) [viewshed-oor] $ git commit
black....................................................................Passed
isort....................................................................Passed
flake8...................................................................Failed
- hook id: flake8
- exit code: 1

Traceback (most recent call last):
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/bin/flake8",
line 8, in <module>
    sys.exit(main())
             ^^^^^^
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/cli.py",
line 22, in main
    app.run(argv)
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py",
line 363, in run
    self._run(argv)
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py",
line 350, in _run
    self.initialize(argv)
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py",
line 330, in initialize
    self.find_plugins(config_finder)
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py",
line 153, in find_plugins
    self.check_plugins = plugin_manager.Checkers(local_plugins.extension)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/plugins/manager.py",
line 356, in __init__
    self.manager = PluginManager(
                   ^^^^^^^^^^^^^^
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/plugins/manager.py",
line 238, in __init__
    self._load_entrypoint_plugins()
  File
"/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/plugins/manager.py",
line 254, in _load_entrypoint_plugins
    eps = importlib_metadata.entry_points().get(self.namespace, ())
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'EntryPoints' object has no attribute 'get'

--
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240607/54de63f0/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Jun  7 10:49:52 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 7 Jun 2024 19:49:52 +0200
Subject: [gdal-dev] pre-commit hook failure
In-Reply-To: <CACJ51z1GCVM6sebOPkcd+Vb3CwBB7tWdWaYuEm4SFC5eH-oTzw@mail.gmail.com>
References: <CACJ51z1GCVM6sebOPkcd+Vb3CwBB7tWdWaYuEm4SFC5eH-oTzw@mail.gmail.com>
Message-ID: <84627538-1218-44bc-8918-c6fb41b4fd81@spatialys.com>

Andrew,

https://stackoverflow.com/questions/75591296/entrypoints-object-has-no-attribute-get-during-running-pre-commit 
would suggest that we should perhaps update the flake8 version in 
.pre-commit-config.yaml at the root of the GDAL source tree.

Can you give a try to https://github.com/OSGeo/gdal/pull/10163 ?

Even

Le 07/06/2024 ? 19:36, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> I'm getting an error when flake8 runs as a pre-commit hook and it 
> won't allow me to commit code. My understanding was that the 
> pre-commit stuff was supposed to make sure the proper versions were 
> found. Ideas?
>
> (gdal) [viewshed-oor] $ git commit
> black....................................................................Passed
> isort....................................................................Passed
> flake8...................................................................Failed
> - hook id: flake8
> - exit code: 1
>
> Traceback (most recent call last):
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/bin/flake8", 
> line 8, in <module>
> ? ? sys.exit(main())
> ? ? ? ? ? ? ?^^^^^^
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/cli.py", 
> line 22, in main
> ? ? app.run(argv)
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py", 
> line 363, in run
> ? ? self._run(argv)
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py", 
> line 350, in _run
> ? ? self.initialize(argv)
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py", 
> line 330, in initialize
> ? ? self.find_plugins(config_finder)
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/main/application.py", 
> line 153, in find_plugins
> ? ? self.check_plugins = plugin_manager.Checkers(local_plugins.extension)
> ?^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/plugins/manager.py", 
> line 356, in __init__
> ? ? self.manager = PluginManager(
> ? ? ? ? ? ? ? ? ? ?^^^^^^^^^^^^^^
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/plugins/manager.py", 
> line 238, in __init__
> ? ? self._load_entrypoint_plugins()
> ? File 
> "/Users/abell/.cache/pre-commit/repowsfp6jbc/py_env-python3.12/lib/python3.12/site-packages/flake8/plugins/manager.py", 
> line 254, in _load_entrypoint_plugins
> ? ? eps = importlib_metadata.entry_points().get(self.namespace, ())
> ? ? ? ? ? ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> AttributeError: 'EntryPoints' object has no attribute 'get'
>
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240607/f552c77c/attachment.htm>

From rykovd at gmail.com  Sun Jun  9 16:27:15 2024
From: rykovd at gmail.com (Denis Rykov)
Date: Mon, 10 Jun 2024 01:27:15 +0200
Subject: [gdal-dev] Discrepancy in utilizing overviews with gdalwarp
Message-ID: <CAJbvKNpmK6s59pMY3GHbb5e5AAzLeKetv1TzvgN-XPAWyNpavQ@mail.gmail.com>

I'd anticipate that both commands would yield the same outcome:

$ gdalwarp -oo OVERVIEW_LEVEL=1 -dstalpha input.vrt ovr1.tif
$ gdalwarp -ovr 1 -dstalpha input.vrt ovr1.tif

However, the reality is different. The first command behaves as intended,
utilizing overviews from *.vrt.ovr, while the second command operates
noticeably slower, seemingly disregarding the overviews.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240610/77e4f3e0/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 10 00:19:10 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 10 Jun 2024 07:19:10 +0000
Subject: [gdal-dev] Discrepancy in utilizing overviews with gdalwarp
In-Reply-To: <CAJbvKNpmK6s59pMY3GHbb5e5AAzLeKetv1TzvgN-XPAWyNpavQ@mail.gmail.com>
References: <CAJbvKNpmK6s59pMY3GHbb5e5AAzLeKetv1TzvgN-XPAWyNpavQ@mail.gmail.com>
Message-ID: <DB9PR09MB68871F51BE2344D797C73A6EFDC62@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

Those two commands behave in quite different ways. With ?-oo OVERVIEW_LEVEL=1? the output size is the size of the second overview. In my test case the original has 12000 x 12000 pixels and the command creates a 3000 x 3000 sized output

GDAL: GDALOverviewDataset(vrttest.vrt, this=000001CB3D728890) creation.
GDAL: Using GTiff driver
GDAL: Computing area of interest: 26.8805, 63.2011, 27, 63.255
Creating output file that is 3000P x 3000L.
?
GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=0,0,3000x3000 Dst=0,0,3000x3000
...10...20...30...40...50...60...70...80...90...100 - done.

With -ovr 1 the output has the size of the full resolution image, 12000 x 12000 pixels, even the data is read from the 3000 x 3000 overview. The pixels will be upsampled.

GDAL: Using GTiff driver
GDAL: Computing area of interest: 26.8805, 63.2011, 27, 63.255
Creating output file that is 12000P x 12000L.
WARP: Selecting overview level 1 for vrttest.vrt
?
GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=0,0,1500x750 Dst=0,0,6000x3000
...10.GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=1500,0,1500x750 Dst=6000,0,6000x3000
..20..GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=0,750,1500x750 Dst=0,3000,6000x3000
.30...GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=1500,750,1500x750 Dst=6000,3000,6000x3000
40...50GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=0,1500,1500x750 Dst=0,6000,6000x3000
...60.GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=1500,1500,1500x750 Dst=6000,6000,6000x3000
..70..GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=0,2250,1500x750 Dst=0,9000,6000x3000
.80...GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte() Src=1500,2250,1500x750 Dst=6000,9000,6000x3000
90...100 - done.
GDAL: Flushing dirty blocks: 0...10...20...30...40...50...60...70...80...90...100 - done.

The behavior is the same when using a TIFF with internal overviews as input instead of VRT. Obviously the -ovr option has been designed to force the use of some better-quality overview as source data when warping yields a smaller, downsampled image. The forced upsampling does not make much sense to me. I wonder if gdalwarp should even allow that?

The gdal_translate utility has also -ovr option https://gdal.org/programs/gdal_translate.html#cmdoption-gdal_translate-ovr. It behaves in a different way  when it comes to the size of the output, but with gdal_translate it makes sense.
?When -ovr is specified to an integer value, and none of -outsize and -tr is specified, the size of the overview will be used as the output size.?

Maybe the thing to do is to improve the documentation of the gdalwarp option https://gdal.org/programs/gdalwarp.html#cmdoption-gdalwarp-ovr and mention that this option does not have on effect on the size of the output.

-Jukka Rahkonen-




L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Denis Rykov via gdal-dev
L?hetetty: maanantai 10. kes?kuuta 2024 2.27
Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Discrepancy in utilizing overviews with gdalwarp

I'd anticipate that both commands would yield the same outcome:

$ gdalwarp -oo OVERVIEW_LEVEL=1 -dstalpha input.vrt ovr1.tif
$ gdalwarp -ovr 1 -dstalpha input.vrt ovr1.tif

However, the reality is different. The first command behaves as intended, utilizing overviews from *.vrt.ovr, while the second command operates noticeably slower, seemingly disregarding the overviews.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240610/6ecae5af/attachment-0001.htm>

From rykovd at gmail.com  Mon Jun 10 01:57:08 2024
From: rykovd at gmail.com (Denis Rykov)
Date: Mon, 10 Jun 2024 10:57:08 +0200
Subject: [gdal-dev] Discrepancy in utilizing overviews with gdalwarp
In-Reply-To: <DB9PR09MB68871F51BE2344D797C73A6EFDC62@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAJbvKNpmK6s59pMY3GHbb5e5AAzLeKetv1TzvgN-XPAWyNpavQ@mail.gmail.com>
 <DB9PR09MB68871F51BE2344D797C73A6EFDC62@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAJbvKNqeL56OkPMjas0Rb068XfoYGvP6TAx4smzin0xs6SDNiA@mail.gmail.com>

Thank you, Jukka, for reproducing the behavior and explaining the reason
behind it!

On Mon, Jun 10, 2024 at 9:19?AM Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Those two commands behave in quite different ways. With ?-oo
> OVERVIEW_LEVEL=1? the output size is the size of the second overview. In my
> test case the original has 12000 x 12000 pixels and the command creates a
> 3000 x 3000 sized output
>
>
>
> GDAL: GDALOverviewDataset(vrttest.vrt, this=000001CB3D728890) creation.
>
> GDAL: Using GTiff driver
>
> GDAL: Computing area of interest: 26.8805, 63.2011, 27, 63.255
>
> Creating output file that is 3000P x 3000L.
>
> ?
>
> GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=0,0,3000x3000 Dst=0,0,3000x3000
>
> ...10...20...30...40...50...60...70...80...90...100 - done.
>
>
>
> With -ovr 1 the output has the size of the full resolution image, 12000 x
> 12000 pixels, even the data is read from the 3000 x 3000 overview. The
> pixels will be upsampled.
>
>
>
> GDAL: Using GTiff driver
>
> GDAL: Computing area of interest: 26.8805, 63.2011, 27, 63.255
>
> Creating output file that is 12000P x 12000L.
>
> WARP: Selecting overview level 1 for vrttest.vrt
>
> ?
>
> GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=0,0,1500x750 Dst=0,0,6000x3000
>
> ...10.GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=1500,0,1500x750 Dst=6000,0,6000x3000
>
> ..20..GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=0,750,1500x750 Dst=0,3000,6000x3000
>
> .30...GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=1500,750,1500x750 Dst=6000,3000,6000x3000
>
> 40...50GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=0,1500,1500x750 Dst=0,6000,6000x3000
>
> ...60.GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=1500,1500,1500x750 Dst=6000,6000,6000x3000
>
> ..70..GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=0,2250,1500x750 Dst=0,9000,6000x3000
>
> .80...GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
> Src=1500,2250,1500x750 Dst=6000,9000,6000x3000
>
> 90...100 - done.
>
> GDAL: Flushing dirty blocks:
> 0...10...20...30...40...50...60...70...80...90...100 - done.
>
>
>
> The behavior is the same when using a TIFF with internal overviews as
> input instead of VRT. Obviously the -ovr option has been designed to force
> the use of some better-quality overview as source data when warping yields
> a smaller, downsampled image. The forced upsampling does not make much
> sense to me. I wonder if gdalwarp should even allow that?
>
>
>
> The gdal_translate utility has also -ovr option
> https://gdal.org/programs/gdal_translate.html#cmdoption-gdal_translate-ovr.
> It behaves in a different way  when it comes to the size of the output, but
> with gdal_translate it makes sense.
>
> ?When -ovr is specified to an integer value, and none of -outsize and -tr
> is specified, the size of the overview will be used as the output size.?
>
>
>
> Maybe the thing to do is to improve the documentation of the gdalwarp
> option https://gdal.org/programs/gdalwarp.html#cmdoption-gdalwarp-ovr and
> mention that this option does not have on effect on the size of the output.
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Denis
> Rykov via gdal-dev
> *L?hetetty:* maanantai 10. kes?kuuta 2024 2.27
> *Vastaanottaja:* gdal dev <gdal-dev at lists.osgeo.org>
> *Aihe:* [gdal-dev] Discrepancy in utilizing overviews with gdalwarp
>
>
>
> I'd anticipate that both commands would yield the same outcome:
>
> $ gdalwarp -oo OVERVIEW_LEVEL=1 -dstalpha input.vrt ovr1.tif
> $ gdalwarp -ovr 1 -dstalpha input.vrt ovr1.tif
>
>
>
> However, the reality is different. The first command behaves as intended,
> utilizing overviews from *.vrt.ovr, while the second command operates
> noticeably slower, seemingly disregarding the overviews.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240610/4ff4d66e/attachment.htm>

From even.rouault at spatialys.com  Mon Jun 10 06:16:00 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 10 Jun 2024 15:16:00 +0200
Subject: [gdal-dev] Discrepancy in utilizing overviews with gdalwarp
In-Reply-To: <CAJbvKNqeL56OkPMjas0Rb068XfoYGvP6TAx4smzin0xs6SDNiA@mail.gmail.com>
References: <CAJbvKNpmK6s59pMY3GHbb5e5AAzLeKetv1TzvgN-XPAWyNpavQ@mail.gmail.com>
 <DB9PR09MB68871F51BE2344D797C73A6EFDC62@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAJbvKNqeL56OkPMjas0Rb068XfoYGvP6TAx4smzin0xs6SDNiA@mail.gmail.com>
Message-ID: <e2d99ce0-1340-4078-91ff-e4ac2d5e11d4@spatialys.com>

Filed as https://github.com/OSGeo/gdal/issues/10174

Le 10/06/2024 ? 10:57, Denis Rykov via gdal-dev a ?crit?:
> Thank you, Jukka, for reproducing the behavior and explaining the 
> reason behind it!
>
> On Mon, Jun 10, 2024 at 9:19?AM Rahkonen Jukka 
> <jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
>     Hi,
>
>     Those two commands behave in quite different ways. With ?-oo
>     OVERVIEW_LEVEL=1? the output size is the size of the second
>     overview. In my test case the original has 12000 x 12000 pixels
>     and the command creates a 3000 x 3000 sized output
>
>     GDAL: GDALOverviewDataset(vrttest.vrt, this=000001CB3D728890)
>     creation.
>
>     GDAL: Using GTiff driver
>
>     GDAL: Computing area of interest: 26.8805, 63.2011, 27, 63.255
>
>     Creating output file that is 3000P x 3000L.
>
>     ?
>
>     GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=0,0,3000x3000 Dst=0,0,3000x3000
>
>     ...10...20...30...40...50...60...70...80...90...100 - done.
>
>     With -ovr 1 the output has the size of the full resolution image,
>     12000 x 12000 pixels, even the data is read from the 3000 x 3000
>     overview. The pixels will be upsampled.
>
>     GDAL: Using GTiff driver
>
>     GDAL: Computing area of interest: 26.8805, 63.2011, 27, 63.255
>
>     Creating output file that is 12000P x 12000L.
>
>     WARP: Selecting overview level 1 for vrttest.vrt
>
>     ?
>
>     GDAL: GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=0,0,1500x750 Dst=0,0,6000x3000
>
>     ...10.GDAL:
>     GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=1500,0,1500x750 Dst=6000,0,6000x3000
>
>     ..20..GDAL:
>     GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=0,750,1500x750 Dst=0,3000,6000x3000
>
>     .30...GDAL:
>     GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=1500,750,1500x750 Dst=6000,3000,6000x3000
>
>     40...50GDAL:
>     GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=0,1500,1500x750 Dst=0,6000,6000x3000
>
>     ...60.GDAL:
>     GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=1500,1500,1500x750 Dst=6000,6000,6000x3000
>
>     ..70..GDAL:
>     GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=0,2250,1500x750 Dst=0,9000,6000x3000
>
>     .80...GDAL:
>     GDALWarpKernel()::GWKNearestNoMasksOrDstDensityOnlyByte()
>     Src=1500,2250,1500x750 Dst=6000,9000,6000x3000
>
>     90...100 - done.
>
>     GDAL: Flushing dirty blocks:
>     0...10...20...30...40...50...60...70...80...90...100 - done.
>
>     The behavior is the same when using a TIFF with internal overviews
>     as input instead of VRT. Obviously the -ovr option has been
>     designed to force the use of some better-quality overview as
>     source data when warping yields a smaller, downsampled image. The
>     forced upsampling does not make much sense to me. I wonder if
>     gdalwarp should even allow that?
>
>     The gdal_translate utility has also -ovr option
>     https://gdal.org/programs/gdal_translate.html#cmdoption-gdal_translate-ovr.
>     It behaves in a different way ?when it comes to the size of the
>     output, but with gdal_translate it makes sense.
>
>     ?When -ovr is specified to an integer value, and none of -outsize
>     and -tr is specified, the size of the overview will be used as the
>     output size.?
>
>     Maybe the thing to do is to improve the documentation of the
>     gdalwarp option
>     https://gdal.org/programs/gdalwarp.html#cmdoption-gdalwarp-ovr and
>     mention that this option does not have on effect on the size of
>     the output.
>
>     -Jukka Rahkonen-
>
>     *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta
>     *Denis Rykov via gdal-dev
>     *L?hetetty:* maanantai 10. kes?kuuta 2024 2.27
>     *Vastaanottaja:* gdal dev <gdal-dev at lists.osgeo.org>
>     *Aihe:* [gdal-dev] Discrepancy in utilizing overviews with gdalwarp
>
>     I'd anticipate that both commands would yield the same outcome:
>
>     $ gdalwarp -oo OVERVIEW_LEVEL=1 -dstalpha input.vrt ovr1.tif
>     $ gdalwarp -ovr 1 -dstalpha input.vrt ovr1.tif
>
>     However, the reality is different. The first command behaves as
>     intended, utilizing overviews from |*.vrt.ovr|, while the second
>     command operates noticeably slower, seemingly disregarding the
>     overviews.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240610/9d9e0333/attachment-0001.htm>

From Marek.Setnik at obrum.pl  Tue Jun 11 03:11:26 2024
From: Marek.Setnik at obrum.pl (Marek Setnik)
Date: Tue, 11 Jun 2024 10:11:26 +0000
Subject: [gdal-dev] Adding multiple TREs to a NITF using gdal_translate
Message-ID: <47eef5f8504341f1b12c67a60f049585@obrum.pl>

Hello!

I'm having trouble with adding multiple TREs to a NITF file (using C++ API), the documentation mentions that the TRE creation options allows for that but I can't figure out the syntax, how do I achieve something like this: TRE=NAME1=VALUES1,NAME2=VALUES2 ? (I also tried to use TRE creation option twice like so: -co TRE=NAME1=VALUES1 -co TRE=NAME2=VALUES2, but the second TRE gets ignored)


Thanks in advance!

Marek

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/12348609/attachment.htm>

From Marek.Setnik at obrum.pl  Tue Jun 11 05:17:38 2024
From: Marek.Setnik at obrum.pl (Marek Setnik)
Date: Tue, 11 Jun 2024 12:17:38 +0000
Subject: [gdal-dev] Odp.: Adding multiple TREs to a NITF using gdal_translate
In-Reply-To: <cf0c6ee1-12bc-41ea-b72d-7e3b90fc9c48@email.android.com>
References: <47eef5f8504341f1b12c67a60f049585@obrum.pl>,
 <cf0c6ee1-12bc-41ea-b72d-7e3b90fc9c48@email.android.com>
Message-ID: <0acde5548475461e921e3f22a32160be@obrum.pl>

Oh, that's perfect actually, it did tell me that using TRE twice should work and it actually does. My error was that I had extra bytes at the end of my TREs, I removed those and now I've got all my TREs showing up, so thank you!

________________________________
Od: Brad Hards <bradh at frogmouth.net>
Wys?ane: wtorek, 11 czerwca 2024 14:05:19
Do: Marek Setnik
DW: gdal-dev at lists.osgeo.org
Temat: Re: [gdal-dev] Adding multiple TREs to a NITF using gdal_translate

Not quite what you asked for, but https://github.com/OSGeo/gdal/blob/master/autotest/gdrivers/nitf.py#L2101 might be another way to achieve what you need. Otherwise,  some more details on exact TREs might be relevant.

On 11 June 2024 8:11 pm, Marek Setnik via gdal-dev <gdal-dev at lists.osgeo.org> wrote:

Hello!

I'm having trouble with adding multiple TREs to a NITF file (using C++ API), the documentation mentions that the TRE creation options allows for that but I can't figure out the syntax, how do I achieve something like this: TRE=NAME1=VALUES1,NAME2=VALUES2 ? (I also tried to use TRE creation option twice like so: -co TRE=NAME1=VALUES1 -co TRE=NAME2=VALUES2, but the second TRE gets ignored)


Thanks in advance!

Marek


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/f24bddb7/attachment.htm>

From bradh at frogmouth.net  Tue Jun 11 05:05:19 2024
From: bradh at frogmouth.net (Brad Hards)
Date: Tue, 11 Jun 2024 22:05:19 +1000
Subject: [gdal-dev] Adding multiple TREs to a NITF using gdal_translate
In-Reply-To: <47eef5f8504341f1b12c67a60f049585@obrum.pl>
Message-ID: <cf0c6ee1-12bc-41ea-b72d-7e3b90fc9c48@email.android.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/09da8cdd/attachment.htm>

From even.rouault at spatialys.com  Tue Jun 11 06:00:06 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 11 Jun 2024 15:00:06 +0200
Subject: [gdal-dev] Adding multiple TREs to a NITF using gdal_translate
In-Reply-To: <47eef5f8504341f1b12c67a60f049585@obrum.pl>
References: <47eef5f8504341f1b12c67a60f049585@obrum.pl>
Message-ID: <92868b77-9f88-48d9-b90b-614d75c97a3c@spatialys.com>


Le 11/06/2024 ? 12:11, Marek Setnik via gdal-dev a ?crit?:
>
> Hello!
>
> I'm having trouble with adding multiple TREs to a NITF file (using C++ 
> API), the documentation mentions that the TRE creation options allows 
> for that but I can't figure out the syntax, how do I achieve something 
> like this: TRE=NAME1=VALUES1,NAME2=VALUES2?? (I also tried to use TRE 
> creation option twice like so: -co TRE=NAME1=VALUES1 -co 
> TRE=NAME2=VALUES2, but the second TRE gets ignored)
>
You need to specify the TRE=NAME=VALUE several times


$ gdal_translate byte.tif test.ntf -co TRE=NAME1=VALUES1 -co 
TRE=NAME2=VALUES2

$ gdalinfo test.ntf

[...]

Metadata (TRE):
 ? NAME1=VALUES1
 ? NAME2=VALUES2


Using the C++ API,? this would be something like:

char** options = NULL;

options = CSLAddString(options, "TRE=NAME1=VALUES1");?? // Do not use 
CSLSetNameValue() otherwise the second TRE would override the first one
options = CSLAddString(options, "TRE=NAME2=VALUES2");

GDALCreateCopy(hDrv, "out.ntf", src_ds, false, options, nullptr, nullptr);


Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/0465dd31/attachment.htm>

From johannespaul92 at gmail.com  Tue Jun 11 07:02:03 2024
From: johannespaul92 at gmail.com (Johannes Paul)
Date: Tue, 11 Jun 2024 16:02:03 +0200
Subject: [gdal-dev] GDALGetGeoTransform
Message-ID: <CACcmK9bbqiyqCPZh0LnM7qS7szH9f63W5hO4ANDYQSm=25+W0A@mail.gmail.com>

Hello,

coming back to an old thread regarding a DIMAP product which has no lon/lat
(https://lists.osgeo.org/pipermail/gdal-dev/2018-January/048014.html).
GDALGetGeoTransform method will return CE_None despite GeoTransformation
matrix is not as expected, and in that specific case I would rather use
GDALGCPsToGeoTransform to compute GeoTransform array.

Is there a way I can detect GDALGetGeoTransform shall not be used ?

Thanks,
Johannes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/4987d00e/attachment.htm>

From even.rouault at spatialys.com  Tue Jun 11 07:09:11 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 11 Jun 2024 16:09:11 +0200
Subject: [gdal-dev] GDALGetGeoTransform
In-Reply-To: <CACcmK9bbqiyqCPZh0LnM7qS7szH9f63W5hO4ANDYQSm=25+W0A@mail.gmail.com>
References: <CACcmK9bbqiyqCPZh0LnM7qS7szH9f63W5hO4ANDYQSm=25+W0A@mail.gmail.com>
Message-ID: <3cb5c827-20e0-4fd6-b572-6ee76f9da086@spatialys.com>

Johannes,

access to your DIMAP product would be needed to investigate.

I assume the product also returns RPC??? If so, test GetMetadata("RPC") 
!= null, and if it does, you can likely consider than any GeoTransform 
is "garbage". If you have RPCs, you can directly compute a geotransform. 
You need to reproject using GDALWarp() with the "-rpc" option.

Even

Le 11/06/2024 ? 16:02, Johannes Paul via gdal-dev a ?crit?:
> Hello,
>
> coming back to an old thread regarding a DIMAP product which has no 
> lon/lat 
> (https://lists.osgeo.org/pipermail/gdal-dev/2018-January/048014.html).
> GDALGetGeoTransform method will return CE_None despite 
> GeoTransformation matrix is not as expected, and in that specific case 
> I would rather use GDALGCPsToGeoTransform to compute GeoTransform array.
>
> Is there a way I can detect GDALGetGeoTransform shall not be used ?
>
> Thanks,
> Johannes
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From lnicola at dend.ro  Tue Jun 11 07:07:36 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Tue, 11 Jun 2024 17:07:36 +0300
Subject: [gdal-dev] GDALGetGeoTransform
In-Reply-To: <CACcmK9bbqiyqCPZh0LnM7qS7szH9f63W5hO4ANDYQSm=25+W0A@mail.gmail.com>
References: <CACcmK9bbqiyqCPZh0LnM7qS7szH9f63W5hO4ANDYQSm=25+W0A@mail.gmail.com>
Message-ID: <25d2baf0-71aa-45e3-a9a9-7ceba1717d25@app.fastmail.com>

Hi Johannes,

You can use GDALGetGCPCount to check if the file has GCPs, then use gdalwarp -tps or the equivalent to uncrinkle it: https://stackoverflow.com/questions/48770002/project-raster-file-using-gcps.

Laurentiu

On Tue, Jun 11, 2024, at 17:02, Johannes Paul via gdal-dev wrote:
> Hello,
> 
> coming back to an old thread regarding a DIMAP product which has no lon/lat (https://lists.osgeo.org/pipermail/gdal-dev/2018-January/048014.html).
> GDALGetGeoTransform method will return CE_None despite GeoTransformation matrix is not as expected, and in that specific case I would rather use GDALGCPsToGeoTransform to compute GeoTransform array.
> 
> Is there a way I can detect GDALGetGeoTransform shall not be used ?
> 
> Thanks,
> Johannes
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/fd0f67e8/attachment-0001.htm>

From timhirrel at tdhgis.com  Tue Jun 11 07:30:52 2024
From: timhirrel at tdhgis.com (Tim Hirrel)
Date: Tue, 11 Jun 2024 07:30:52 -0700
Subject: [gdal-dev] TdhOGR - Vector Data Translation
Message-ID: <CAKQqExTUJ4Z47HbkaYE8Lb0PbQQOqougyKGN2ptzP_7vjinVww@mail.gmail.com>

Greetings:

TdhOGR <https://sites.google.com/tdhgis.com/tdhogr/home> translates vector
data between various formats while optionally transforming the coordinates
to a different reference system.  The data formats for source and target
include those provided by the GDAL/OGR library and the TDH vector data
apps. OpenStreetMap data can be used as a source.

TdhOGR provides a Graphical User Interface and an online help file for ease
of use. TdhOGR runs on Linux and MS Windows, is free of charge and contains
no advertisements or usage limitations.
Please let me know if you have any questions or suggestions.

Thank you,
Tim Hirrel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/fbfb3a62/attachment.htm>

From johannespaul92 at gmail.com  Tue Jun 11 07:41:33 2024
From: johannespaul92 at gmail.com (Johannes Paul)
Date: Tue, 11 Jun 2024 16:41:33 +0200
Subject: [gdal-dev] GDALGetGeoTransform
In-Reply-To: <3cb5c827-20e0-4fd6-b572-6ee76f9da086@spatialys.com>
References: <CACcmK9bbqiyqCPZh0LnM7qS7szH9f63W5hO4ANDYQSm=25+W0A@mail.gmail.com>
 <3cb5c827-20e0-4fd6-b572-6ee76f9da086@spatialys.com>
Message-ID: <CACcmK9ZwbaR2Eyy7Hytbxfph2BacinTJqddLO+aQ5-LzsZU1gQ@mail.gmail.com>

Thanks Even, that's what I was looking for.
Thanks a lot for the support.

On Tue, 11 Jun 2024 at 16:09, Even Rouault <even.rouault at spatialys.com>
wrote:

> Johannes,
>
> access to your DIMAP product would be needed to investigate.
>
> I assume the product also returns RPC?   If so, test GetMetadata("RPC")
> != null, and if it does, you can likely consider than any GeoTransform
> is "garbage". If you have RPCs, you can directly compute a geotransform.
> You need to reproject using GDALWarp() with the "-rpc" option.
>
> Even
>
> Le 11/06/2024 ? 16:02, Johannes Paul via gdal-dev a ?crit :
> > Hello,
> >
> > coming back to an old thread regarding a DIMAP product which has no
> > lon/lat
> > (https://lists.osgeo.org/pipermail/gdal-dev/2018-January/048014.html).
> > GDALGetGeoTransform method will return CE_None despite
> > GeoTransformation matrix is not as expected, and in that specific case
> > I would rather use GDALGCPsToGeoTransform to compute GeoTransform array.
> >
> > Is there a way I can detect GDALGetGeoTransform shall not be used ?
> >
> > Thanks,
> > Johannes
> >
> >
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/81c08065/attachment.htm>

From alexandre.gacon at gmail.com  Tue Jun 11 08:33:48 2024
From: alexandre.gacon at gmail.com (Alexandre Gacon)
Date: Tue, 11 Jun 2024 17:33:48 +0200
Subject: [gdal-dev] ogr2ogr no longer works with non super user in PG after
 update
Message-ID: <CAFJaAp7yGPf4283tVMcUahspJ6YAxgyX9Zav7w10Y2k7nFsg3w@mail.gmail.com>

Hello there,

After updating our stack from GDAL 3.4.1 to GDAL 3.9.0, we have ogr2ogr
calls which no longer succeed with the following message:

ERROR:  permission denied to create event trigger
"ogr_system_tables_event_trigger_for_metadata".  HINT:  Must be superuser
to create an event trigger.

If I dig in the codebase, it is related to a change named "
PG: serialize GDAL multidomain metadata of layer as XML in a
ogr_system_tables.metadata table"

We don't have multidomain in our data: is it mandatory no to use a
superuser when importing data into a PG DB with ogr2ogr or is there a way
to dismiss this message?

Regards

-- 
Alexandre Gacon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/e8985ccb/attachment.htm>

From even.rouault at spatialys.com  Tue Jun 11 08:43:00 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 11 Jun 2024 17:43:00 +0200
Subject: [gdal-dev] ogr2ogr no longer works with non super user in PG
 after update
In-Reply-To: <CAFJaAp7yGPf4283tVMcUahspJ6YAxgyX9Zav7w10Y2k7nFsg3w@mail.gmail.com>
References: <CAFJaAp7yGPf4283tVMcUahspJ6YAxgyX9Zav7w10Y2k7nFsg3w@mail.gmail.com>
Message-ID: <94674e36-7b03-43b1-809d-2755b631b6f1@spatialys.com>

Hi,

The issue has been reported in https://github.com/OSGeo/gdal/issues/9994 
and should be be fixed in 3.9.1 per 
https://github.com/OSGeo/gdal/pull/10004 (testing of the 3.9 branch at 
https://github.com/OSGeo/gdal/tree/release/3.9 would be appreciated to 
confirm that it fixes error for various permission scenarios)

You can?typically get the error with 3.9.0 when importing a shapefile 
since there is a layer metadata item set on the shapefile layer when 
reading it, that gets automatically imported by ogr2ogr. You can 
workaround the issue by specifying the "-nomd" ogr2ogr option

Even

Le 11/06/2024 ? 17:33, Alexandre Gacon via gdal-dev a ?crit?:
> Hello there,
>
> After updating our stack from GDAL 3.4.1 to GDAL 3.9.0, we have 
> ogr2ogr calls which no longer succeed with the following message:
>
> ERROR: permission denied to create event trigger 
> "ogr_system_tables_event_trigger_for_metadata".? HINT:? Must be 
> superuser to create an event trigger.
>
> If I dig in the codebase, it is related to a change named "
> PG: serialize GDAL multidomain metadata of layer as XML in a 
> ogr_system_tables.metadata table"
>
> We don't have multidomain in our data: is it mandatory no to use a 
> superuser when importing data into a PG DB with ogr2ogr or is there a 
> way to dismiss this message?
>
> Regards
>
> -- 
> Alexandre Gacon
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/261ee533/attachment.htm>

From andrew.bell.ia at gmail.com  Tue Jun 11 12:22:41 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Tue, 11 Jun 2024 15:22:41 -0400
Subject: [gdal-dev] gdal2xyz
Message-ID: <CACJ51z1dvihnt_HqKPi=-mv7iCgOnKFHY1r0ADrS=e1w35FN-A@mail.gmail.com>

Hi,

The documentation describes an application `gdal2xyz`, but I don't see one
built in my development environment. I also don't see anything in the
CMakeLists.txt that refers to it. Is it named something I'm not expecting?
Does it still exist?

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/81d50586/attachment.htm>

From even.rouault at spatialys.com  Tue Jun 11 12:31:06 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 11 Jun 2024 21:31:06 +0200
Subject: [gdal-dev] gdal2xyz
In-Reply-To: <CACJ51z1dvihnt_HqKPi=-mv7iCgOnKFHY1r0ADrS=e1w35FN-A@mail.gmail.com>
References: <CACJ51z1dvihnt_HqKPi=-mv7iCgOnKFHY1r0ADrS=e1w35FN-A@mail.gmail.com>
Message-ID: <d3ab11af-8ac4-49c9-b8b0-72a66553a771@spatialys.com>


Le 11/06/2024 ? 21:22, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> The documentation describes an application `gdal2xyz`, but I don't see 
> one built in my development environment. I also don't see anything in 
> the CMakeLists.txt that refers to it. Is it named something I'm not 
> expecting? Does it still exist?

Yes, it still exists. This is a Python utility. In your build 
environment, if you source scripts/setdevenv.sh, your path will include 
$build_dir/swig/python/gdal-utils/scripts where you can find it. There, 
it will be available only with the .py extension. It is also available 
without the .py extension through a launcher script if you install the 
gdal or gdal-utils packages (with make install).

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240611/f270fa10/attachment.htm>

From even.rouault at spatialys.com  Tue Jun 11 16:17:11 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 12 Jun 2024 01:17:11 +0200
Subject: [gdal-dev] gdal2xyz
In-Reply-To: <d3ab11af-8ac4-49c9-b8b0-72a66553a771@spatialys.com>
References: <CACJ51z1dvihnt_HqKPi=-mv7iCgOnKFHY1r0ADrS=e1w35FN-A@mail.gmail.com>
 <d3ab11af-8ac4-49c9-b8b0-72a66553a771@spatialys.com>
Message-ID: <38e3dbe8-8d65-47c1-bc74-12c44ff75fbb@spatialys.com>


Le 11/06/2024 ? 21:31, Even Rouault via gdal-dev a ?crit?:
>
>
> Le 11/06/2024 ? 21:22, Andrew Bell via gdal-dev a ?crit?:
>> Hi,
>>
>> The documentation describes an application `gdal2xyz`, but I don't 
>> see one built in my development environment. I also don't see 
>> anything in the CMakeLists.txt that refers to it. Is it named 
>> something I'm not expecting? Does it still exist?
>
> Yes, it still exists. This is a Python utility. In your build 
> environment, if you source scripts/setdevenv.sh, your path will 
> include $build_dir/swig/python/gdal-utils/scripts where you can find 
> it. There, it will be available only with the .py extension. It is 
> also available without the .py extension through a launcher script if 
> you install the gdal or gdal-utils packages (with make install).
>
==> https://github.com/OSGeo/gdal/pull/10195 to also add launcher 
scripts without .py extension for development environment

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240612/7f3d2b56/attachment.htm>

From nyall.dawson at gmail.com  Tue Jun 11 18:30:37 2024
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Wed, 12 Jun 2024 11:30:37 +1000
Subject: [gdal-dev] Changing many features in a GPKG in a transaction,
 why is the index updated?
Message-ID: <CAB28AsjnGeU=_rRh-UhW5o=sOMeC+NnfmvHvPT=ZthfzG5ynbg@mail.gmail.com>

Hi list,

I'm trying to understand some unexpected behavior I'm seeing while
profiling bulk attribute changes in a GPKG file.

First, I start a transaction on the layer using OGR_L_StartTransaction.
This is successful.
I then make many calls to OGR_L_SetFeature, changing different features,
before finalizing the transaction with OGR_L_CommitTransaction.

Now, when profiling this code, I'm seeing that
OGRGeoPackageTableLayer::ISetFeature(OGRFeature*) is taking a very large
chunk of time. This is due to the call to sqlite3_step at
https://github.com/OSGeo/gdal/blob/2b94d7a274bfeb881a176016de932ba8acd1b79a/ogr/ogrsf_frmts/gpkg/ogrgeopackagetablelayer.cpp#L3134
triggering a call to rtreeUpdate within sqlite3.

I'm confused as to why this is happening. If I'm in a transaction,
shouldn't the index update be deferred until the transaction is committed?
Why would it be updating after every individual update?

Hoping someone can explain what I'm missing here...
Nyall
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240612/baf138cf/attachment.htm>

From even.rouault at spatialys.com  Tue Jun 11 18:54:15 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 12 Jun 2024 03:54:15 +0200
Subject: [gdal-dev] Changing many features in a GPKG in a transaction,
 why is the index updated?
In-Reply-To: <CAB28AsjnGeU=_rRh-UhW5o=sOMeC+NnfmvHvPT=ZthfzG5ynbg@mail.gmail.com>
References: <CAB28AsjnGeU=_rRh-UhW5o=sOMeC+NnfmvHvPT=ZthfzG5ynbg@mail.gmail.com>
Message-ID: <bbdf26cd-6244-49e3-9946-488a27efb962@spatialys.com>

Hi Nyall,

What you observe is fully expected. The spatial index must be kept fully 
in sync with the changes in the feature table, even when run within a 
transaction. Otherwise if during the transaction you would execute a 
spatial query, you would get inconsistents result if the spatial index 
wasn't updated. And even if doing only updates, I don't think there 
would really be a way to optimize updating the RTree for several 
geometries at once, at least not with what is available now in SQLite. 
When creating a new table and inserting features, we have an 
optimization to delay (actually build in parallel) the spatial index, 
but such an optimization is really restricted to that particular use 
case. Updates are more complicated.

But... as you mention "bulk attribute changes", assuming you don't 
change geometries, you would be better using OGR_L_UpdateFeature() where 
you could specify to update only a subset of attributes instead of 
updating the whole feature. In that case, the RTree triggers would not 
run. That said even if the update RTree trigger runs, it checks that the 
geometry hasn't changed, so as you mention rtreeUpdate running, I 
suspect you change the geometries as well, in which case I have no 
suggestion.

Even

Le 12/06/2024 ? 03:30, Nyall Dawson via gdal-dev a ?crit?:
> Hi list,
>
> I'm trying to understand some unexpected behavior I'm seeing while 
> profiling bulk attribute changes in a GPKG file.
>
> First, I start a transaction on the layer using 
> OGR_L_StartTransaction. This is successful.
> I then make many calls to?OGR_L_SetFeature, changing different 
> features, before finalizing the transaction with?OGR_L_CommitTransaction.
>
> Now, when profiling this code, I'm seeing that 
> OGRGeoPackageTableLayer::ISetFeature(OGRFeature*) is taking a very 
> large chunk of time. This is due to the call to sqlite3_step at 
> https://github.com/OSGeo/gdal/blob/2b94d7a274bfeb881a176016de932ba8acd1b79a/ogr/ogrsf_frmts/gpkg/ogrgeopackagetablelayer.cpp#L3134 
> triggering a call to rtreeUpdate within sqlite3.
>
> I'm confused as to why this is happening. If I'm in a transaction, 
> shouldn't the index update be deferred until the transaction is 
> committed? Why would it be updating after every individual update?
>
> Hoping someone can explain what I'm missing here...
> Nyall
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From nyall.dawson at gmail.com  Tue Jun 11 20:28:18 2024
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Wed, 12 Jun 2024 13:28:18 +1000
Subject: [gdal-dev] Changing many features in a GPKG in a transaction,
 why is the index updated?
In-Reply-To: <bbdf26cd-6244-49e3-9946-488a27efb962@spatialys.com>
References: <CAB28AsjnGeU=_rRh-UhW5o=sOMeC+NnfmvHvPT=ZthfzG5ynbg@mail.gmail.com>
 <bbdf26cd-6244-49e3-9946-488a27efb962@spatialys.com>
Message-ID: <CAB28Asij=GL0GTXksW=Gi__X0tLiyfuq=Hjn8kiCM2DQmRDjMQ@mail.gmail.com>

On Wed, 12 Jun 2024 at 11:54, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> But... as you mention "bulk attribute changes", assuming you don't
> change geometries, you would be better using OGR_L_UpdateFeature() where
> you could specify to update only a subset of attributes instead of
> updating the whole feature. In that case, the RTree triggers would not
> run.

Thanks for the pointer Even -- indeed switching to OGR_L_UpdateFeature does
give a massive performance boost and avoids the unwanted index updates!
This is great!

> That said even if the update RTree trigger runs, it checks that the
> geometry hasn't changed, so as you mention rtreeUpdate running, I
> suspect you change the geometries as well, in which case I have no
> suggestion.

There was definitely no (intentional) geometry modification happening ?

Nyall

>
> Even
>
> Le 12/06/2024 ? 03:30, Nyall Dawson via gdal-dev a ?crit :
> > Hi list,
> >
> > I'm trying to understand some unexpected behavior I'm seeing while
> > profiling bulk attribute changes in a GPKG file.
> >
> > First, I start a transaction on the layer using
> > OGR_L_StartTransaction. This is successful.
> > I then make many calls to OGR_L_SetFeature, changing different
> > features, before finalizing the transaction with
OGR_L_CommitTransaction.
> >
> > Now, when profiling this code, I'm seeing that
> > OGRGeoPackageTableLayer::ISetFeature(OGRFeature*) is taking a very
> > large chunk of time. This is due to the call to sqlite3_step at
> >
https://github.com/OSGeo/gdal/blob/2b94d7a274bfeb881a176016de932ba8acd1b79a/ogr/ogrsf_frmts/gpkg/ogrgeopackagetablelayer.cpp#L3134
> > triggering a call to rtreeUpdate within sqlite3.
> >
> > I'm confused as to why this is happening. If I'm in a transaction,
> > shouldn't the index update be deferred until the transaction is
> > committed? Why would it be updating after every individual update?
> >
> > Hoping someone can explain what I'm missing here...
> > Nyall
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240612/c258e971/attachment-0001.htm>

From alexandre.gacon at gmail.com  Tue Jun 11 21:22:06 2024
From: alexandre.gacon at gmail.com (Alexandre Gacon)
Date: Wed, 12 Jun 2024 06:22:06 +0200
Subject: [gdal-dev] ogr2ogr no longer works with non super user in PG
 after update
In-Reply-To: <94674e36-7b03-43b1-809d-2755b631b6f1@spatialys.com>
References: <CAFJaAp7yGPf4283tVMcUahspJ6YAxgyX9Zav7w10Y2k7nFsg3w@mail.gmail.com>
 <94674e36-7b03-43b1-809d-2755b631b6f1@spatialys.com>
Message-ID: <CAFJaAp53keQoVp6zQX9F56w4=oHUG6btOR8Pt5CkjM5UsiYMVQ@mail.gmail.com>

Thanks even for the feedback. I have just spotted the nomd option but I
didn't get the time to test it.

Regards
Alexandre

Le mar. 11 juin 2024 ? 17:43, Even Rouault <even.rouault at spatialys.com> a
?crit :

> Hi,
>
> The issue has been reported in https://github.com/OSGeo/gdal/issues/9994
> and should be be fixed in 3.9.1 per
> https://github.com/OSGeo/gdal/pull/10004 (testing of the 3.9 branch at
> https://github.com/OSGeo/gdal/tree/release/3.9 would be appreciated to
> confirm that it fixes error for various permission scenarios)
>
> You can typically get the error with 3.9.0 when importing a shapefile
> since there is a layer metadata item set on the shapefile layer when
> reading it, that gets automatically imported by ogr2ogr. You can workaround
> the issue by specifying the "-nomd" ogr2ogr option
>
> Even
> Le 11/06/2024 ? 17:33, Alexandre Gacon via gdal-dev a ?crit :
>
> Hello there,
>
> After updating our stack from GDAL 3.4.1 to GDAL 3.9.0, we have ogr2ogr
> calls which no longer succeed with the following message:
>
> ERROR:  permission denied to create event trigger
> "ogr_system_tables_event_trigger_for_metadata".  HINT:  Must be superuser
> to create an event trigger.
>
> If I dig in the codebase, it is related to a change named "
> PG: serialize GDAL multidomain metadata of layer as XML in a
> ogr_system_tables.metadata table"
>
> We don't have multidomain in our data: is it mandatory no to use a
> superuser when importing data into a PG DB with ogr2ogr or is there a way
> to dismiss this message?
>
> Regards
>
> --
> Alexandre Gacon
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240612/824dbc92/attachment.htm>

From raghav.singh at eagleview.com  Sun Jun 16 23:42:15 2024
From: raghav.singh at eagleview.com (Raghav Singh)
Date: Mon, 17 Jun 2024 06:42:15 +0000
Subject: [gdal-dev] Getting GETBlockRef error
Message-ID: <SA1PR20MB612199B62DD6E29721B7F5C48CCD2@SA1PR20MB6121.namprd20.prod.outlook.com>

Hi everyone,

I am running into an issue with a wms imagery when I am running that in my local with latest mapserver-8.0.1 and gdal version with this temp configurations -
<GDAL_WMS>
    <Service name="TMS">
        <ServerUrl>http://{serverURL}/tile?tileRow=${y}&amp;tileColumn=${x}&amp;zoomLevel=${z}&amp;minZoom=7&amp;maxZoom=22</ServerUrl>
    </Service>
    <DataWindow>
        <UpperLeftX>-20037508.34</UpperLeftX>
        <UpperLeftY>20037508.34</UpperLeftY>
        <LowerRightX>20037508.34</LowerRightX>
        <LowerRightY>-20037508.34</LowerRightY>
        <TileLevel>21</TileLevel>
        <TileCountX>1</TileCountX>
        <TileCountY>1</TileCountY>
        <YOrigin>bottom</YOrigin>
    </DataWindow>
    <Projection>EPSG:3857</Projection>
    <BlockSizeX>256</BlockSizeX>
    <BlockSizeY>256</BlockSizeY>
    <BandsCount>3</BandsCount>
    <Timeout>60</Timeout>
    <MaxConnections>4</MaxConnections>
    <ZeroBlockHttpCodes>204,404,500</ZeroBlockHttpCodes>
    <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
</GDAL_WMS>
all my calls are running fine and I am getting the wms imagery. But when I am running this in my application which is actually using mapserver version 6.4.1 I am getting this error -

<ServiceExceptionReport xmlns="http://www.opengis.net/ogc" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.3.0" xsi:schemaLocation="http://www.opengis.net/ogc http://schemas.opengis.net/wms/1.3.0/exceptions_1_3_0.xsd">
<ServiceException> msDrawMap(): Image handling error. Failed to draw layer named 'PICT-TXXTXR24-y70fWdrEKM'. drawGDAL(): Unable to access file. GDALDatasetRasterIO() failed: GetBlockRef failed at X block offset 999552, Y block offset 1684413 </ServiceException>
</ServiceExceptionReport>

Any idea?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240617/8f02ce4d/attachment.htm>

From even.rouault at spatialys.com  Wed Jun 19 04:53:38 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 19 Jun 2024 13:53:38 +0200
Subject: [gdal-dev] GDAL 3.9.1 release candidate available
Message-ID: <fd730897-25d4-40bb-8a5c-a122271cb044@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.9.1 release candidate.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.9.1/gdal391rc1.zip

A snapshot of the gdalautotest suite is also available:

https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc1.zip

The NEWS file is here:

 ? https://github.com/OSGeo/gdal/blob/v3.9.1RC1/NEWS.md

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From luis.michaelis at iee.fraunhofer.de  Thu Jun 20 05:11:49 2024
From: luis.michaelis at iee.fraunhofer.de (Michaelis, Luis)
Date: Thu, 20 Jun 2024 12:11:49 +0000
Subject: [gdal-dev] Question: Layer intersection in Python
Message-ID: <FR2P281MB0186C68FDF929971A6FFD83FDAC82@FR2P281MB0186.DEUP281.PROD.OUTLOOK.COM>

Hello GDAL devs!
I've got a question about layer intersection detection.

I'd like to use the GDAL Python interface to do batched intersection checks between two vector layers, one containing only two-point line strings and one containing terrain contour lines. To compute these intersections, I would like to use the `ogr.Layer.Intersection` function, since it is supposed do batched intersection detection in native code.

Since all of the intersections will either be points or multi points, I was expecting to use the `KEEP_LOWER_DIMENSION_GEOMETRIES` and `PROMOTE_TO_MULTI` options, to record the intersections into a new layer with a multi-point geometry. This, however, does not work and I simply don't get any intersections at all. Setting the geometry to just points does also not work. In neither of these cases are any errors or warnings issued.

When I use a destination layer with a `wkbUnknown` geometry however, I do get warnings about it trying to add muti-point geometries to a point layer (which I would sort of expect). Setting `SKIP_FAILURES` and saving the resulting shape, I can actually see the intersection points but as expected, I can't see the multipoint intersections. They're simply missing.

So, the question is: am I missing something? Do need to add some metadata information to the destination layer before computing the intersections or is what I'm trying to do impossible?

Here's the code I've written: https://gist.github.com/lmichaelis-fhg/3ae5ba63b92c1a6ad609baa3ccbfbf80#file-dem-generate-rix-gdal-py-L109-L121

- Luis

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240620/d50d7b69/attachment.htm>

From even.rouault at spatialys.com  Thu Jun 20 05:52:10 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 20 Jun 2024 14:52:10 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.9.1RC1 as 3.9.1 release
Message-ID: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>

Hi,

Motion:

Adopt GDAL 3.9.1RC1 as 3.9.1 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From howard at hobu.co  Thu Jun 20 06:18:54 2024
From: howard at hobu.co (Howard Butler)
Date: Thu, 20 Jun 2024 08:18:54 -0500
Subject: [gdal-dev] Motion: Adopt GDAL 3.9.1RC1 as 3.9.1 release
In-Reply-To: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
References: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
Message-ID: <426E832B-E5DC-4CB4-A6E1-4BE4482792F0@hobu.co>

+1 Howard

> On Jun 20, 2024, at 7:52?AM, Even Rouault via gdal-dev <gdal-dev at lists.osgeo.org> wrote:
> 
> Hi,
> 
> Motion:
> 
> Adopt GDAL 3.9.1RC1 as 3.9.1 release
> 
> Starting with my +1
> 
> Even
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From j1 at jimenezshaw.com  Thu Jun 20 06:18:53 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 20 Jun 2024 15:18:53 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.9.1RC1 as 3.9.1 release
In-Reply-To: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
References: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
Message-ID: <CADRrdKtpStY70GxgyDzr=ux5NHR42fnHVdu1FnpEE7Eu9wRdjg@mail.gmail.com>

Javier +1

On Thu, 20 Jun 2024 at 14:52, Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> Motion:
>
> Adopt GDAL 3.9.1RC1 as 3.9.1 release
>
> Starting with my +1
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240620/cef930ff/attachment-0001.htm>

From gdt at lexort.com  Thu Jun 20 06:30:18 2024
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 20 Jun 2024 09:30:18 -0400
Subject: [gdal-dev] Motion: Adopt GDAL 3.9.1RC1 as 3.9.1 release
In-Reply-To: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com> (Even
 Rouault via gdal-dev's message of "Thu, 20 Jun 2024 14:52:10 +0200")
References: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
Message-ID: <rmiwmmjbv2t.fsf@s1.lexort.com>

Even Rouault via gdal-dev <gdal-dev at lists.osgeo.org> writes:

> Motion:
>
> Adopt GDAL 3.9.1RC1 as 3.9.1 release

I haven't had a chance to test in the 24h59m between the rc and
proposing a release.  Not sure when I will, but this interval seems
super short.   Of the beyond-core-team people that usually test, has
anybody else tested or not tested yet?

From gdt at lexort.com  Thu Jun 20 10:26:26 2024
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 20 Jun 2024 13:26:26 -0400
Subject: [gdal-dev] GDAL 3.9.1 release candidate available
In-Reply-To: <fd730897-25d4-40bb-8a5c-a122271cb044@spatialys.com> (Even
 Rouault via gdal-dev's message of "Wed, 19 Jun 2024 13:53:38 +0200")
References: <fd730897-25d4-40bb-8a5c-a122271cb044@spatialys.com>
Message-ID: <rmi4j9na5kt.fsf@s1.lexort.com>

Even Rouault via gdal-dev <gdal-dev at lists.osgeo.org> writes:

> ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc1.tar.xz

I locally updated pkgsrc, and it builds fine on NetBSD 10 amd64.  qgis
3.36 using it (without recompiling qgis) starts up and loads geopackage
vector layers and postgis vector layers.

So seems good on my end.

From even.rouault at spatialys.com  Thu Jun 20 10:43:12 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 20 Jun 2024 19:43:12 +0200
Subject: [gdal-dev] Question: Layer intersection in Python
In-Reply-To: <FR2P281MB0186C68FDF929971A6FFD83FDAC82@FR2P281MB0186.DEUP281.PROD.OUTLOOK.COM>
References: <FR2P281MB0186C68FDF929971A6FFD83FDAC82@FR2P281MB0186.DEUP281.PROD.OUTLOOK.COM>
Message-ID: <b68f1bfb-20fb-4724-93e9-56af9717a8b1@spatialys.com>

Luis,

the issue is that shapefile layers do not really support a genuine 
unknown layer geometry type. They accept it on layer creation, but as 
soon as you write the first feature into it, the feature layer geometry 
type is used as the layer geometry type, and shapefile don't accept a 
mix of points and multipoints. Which brings to another issue is that 
PROMOTE_TO_MULTI until now only affected lines and polygons, not points. 
I've fixed this with https://github.com/OSGeo/gdal/pull/10258 .

One workaround for you is to write your result in a Memory layer or a 
GeoPackage layer for example, and then use gdal.VectorTranslate() to 
convert it to a multipoint shapefile

Even

Le 20/06/2024 ? 14:11, Michaelis, Luis via gdal-dev a ?crit?:
>
> Hello GDAL devs!
>
> I?ve got a question about layer intersection detection.
>
> I?d like to use the GDAL Python interface to do batched intersection 
> checks between two vector layers, one containing only two-point line 
> strings and one containing terrain contour lines. To compute these 
> intersections, I would like to use the `ogr.Layer.Intersection` 
> function, since it is supposed do batched intersection detection in 
> native code.
>
> Since all of the intersections will either be points or multi points, 
> I was expecting to use the `KEEP_LOWER_DIMENSION_GEOMETRIES` and 
> `PROMOTE_TO_MULTI` options, to record the intersections into a new 
> layer with a multi-point geometry. This, however, does not work and I 
> simply don?t get any intersections at all. Setting the geometry to 
> just points does also not work. In neither of these cases are any 
> errors or warnings issued.
>
> When I use a destination layer with a `wkbUnknown` geometry however, I 
> do get warnings about it trying to add muti-point geometries to a 
> point layer (which I would sort of expect). Setting `SKIP_FAILURES` 
> and saving the resulting shape, I can actually see the intersection 
> points but as expected, I can?t see the multipoint intersections. 
> They?re simply missing.
>
> So, the question is: am I missing something? Do need to add some 
> metadata information to the destination layer before computing the 
> intersections or is what I?m trying to do impossible?
>
> Here?s the code I?ve written: 
> https://gist.github.com/lmichaelis-fhg/3ae5ba63b92c1a6ad609baa3ccbfbf80#file-dem-generate-rix-gdal-py-L109-L121
>
> - Luis
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240620/7bc60a72/attachment.htm>

From luis.michaelis at iee.fraunhofer.de  Fri Jun 21 00:54:28 2024
From: luis.michaelis at iee.fraunhofer.de (Michaelis, Luis)
Date: Fri, 21 Jun 2024 07:54:28 +0000
Subject: [gdal-dev] Question: Layer intersection in Python
In-Reply-To: <b68f1bfb-20fb-4724-93e9-56af9717a8b1@spatialys.com>
References: <FR2P281MB0186C68FDF929971A6FFD83FDAC82@FR2P281MB0186.DEUP281.PROD.OUTLOOK.COM>
 <b68f1bfb-20fb-4724-93e9-56af9717a8b1@spatialys.com>
Message-ID: <FR2P281MB01860EDE709EDEFD84F86CFADAC92@FR2P281MB0186.DEUP281.PROD.OUTLOOK.COM>

Hey Even,

thank you for the exceptionally quick and helpful reply! Switching to the GPKG/MEMORY drivers did indeed fix the problem, and since I don?t rely on the output being a shapefile this works perfectly fine for me. I never thought about switching to a different driver.

Thanks again for the great work!

- Luis

From: Even Rouault <even.rouault at spatialys.com>
Sent: 20 June 2024 19:43
To: Michaelis, Luis <luis.michaelis at iee.fraunhofer.de>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Question: Layer intersection in Python


Luis,

the issue is that shapefile layers do not really support a genuine unknown layer geometry type. They accept it on layer creation, but as soon as you write the first feature into it, the feature layer geometry type is used as the layer geometry type, and shapefile don't accept a mix of points and multipoints. Which brings to another issue is that PROMOTE_TO_MULTI until now only affected lines and polygons, not points. I've fixed this with https://github.com/OSGeo/gdal/pull/10258 .

One workaround for you is to write your result in a Memory layer or a GeoPackage layer for example, and then use gdal.VectorTranslate() to convert it to a multipoint shapefile

Even
Le 20/06/2024 ? 14:11, Michaelis, Luis via gdal-dev a ?crit :
Hello GDAL devs!
I?ve got a question about layer intersection detection.

I?d like to use the GDAL Python interface to do batched intersection checks between two vector layers, one containing only two-point line strings and one containing terrain contour lines. To compute these intersections, I would like to use the `ogr.Layer.Intersection` function, since it is supposed do batched intersection detection in native code.

Since all of the intersections will either be points or multi points, I was expecting to use the `KEEP_LOWER_DIMENSION_GEOMETRIES` and `PROMOTE_TO_MULTI` options, to record the intersections into a new layer with a multi-point geometry. This, however, does not work and I simply don?t get any intersections at all. Setting the geometry to just points does also not work. In neither of these cases are any errors or warnings issued.

When I use a destination layer with a `wkbUnknown` geometry however, I do get warnings about it trying to add muti-point geometries to a point layer (which I would sort of expect). Setting `SKIP_FAILURES` and saving the resulting shape, I can actually see the intersection points but as expected, I can?t see the multipoint intersections. They?re simply missing.

So, the question is: am I missing something? Do need to add some metadata information to the destination layer before computing the intersections or is what I?m trying to do impossible?

Here?s the code I?ve written: https://gist.github.com/lmichaelis-fhg/3ae5ba63b92c1a6ad609baa3ccbfbf80#file-dem-generate-rix-gdal-py-L109-L121

- Luis




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240621/915d5ed7/attachment-0001.htm>

From andrew at aitchison.me.uk  Fri Jun 21 08:40:38 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Fri, 21 Jun 2024 16:40:38 +0100 (BST)
Subject: [gdal-dev] Motion: Adopt GDAL 3.9.1RC1 as 3.9.1 release
In-Reply-To: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
References: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
Message-ID: <b751df28-1422-9a6c-7f60-2e13dfde7a7e@aitchison.me.uk>

On Thu, 20 Jun 2024, Even Rouault via gdal-dev wrote:

> Motion:
>
> Adopt GDAL 3.9.1RC1 as 3.9.1 release
>
> Starting with my +1

As Greg said, 25 hours isn't long to test

I've managed to build and run some tests on Ubuntu 24-04/Noble
using clang compilers (v18 as shipped by Ubuntu and/or v19 from ...)

pytest complained that it could not find h5.py until I installed
    python3-h5py:amd64 (3.10.0-1ubuntu3)

Like several recent gdal versions on other recent Ubuntu releases,
it complains about setup.py
-------------   ...   ...  ...  -----------------------
Install the project...
-- Install configuration: "debug"
Using numpy 1.26.4
running install
/usr/lib/python3/dist-packages/setuptools/_distutils/cmd.py:66: 
SetuptoolsDeprecationWarning: setup.py install is deprecated.
!!

********************************************************************************
         Please avoid running ``setup.py`` directly.
         Instead, use pypa/build, pypa/installer or other
         standards-based tools.

         See
 	https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html for
 	details.

********************************************************************************

!!  self.initialize_options()
running build
-------------   ...   ...  ...  -----------------------

# cd /home/werdna/gdal/3.9.1/gdalautotest/gdrivers
# pytest
Test session starts (platform: linux, Python 3.12.3, pytest 7.4.4, 
pytest-sugar 1.0.0)
benchmark: 4.0.0 (defaults: timer=time.perf_counter disable_gc=False 
min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 
warmup=False warmup_iterations=100000)
rootdir: /home/werdna/gdal/3.9.1/gdalautotest-3.9.1/gdrivers
plugins: env-0.8.2, flake8-1.1.1, benchmark-4.0.0, sugar-1.0.0
collecting 7 items
???????????????????????????? ERROR collecting data/s104/generate_test.py 
????????????????????????????
import file mismatch:
imported module 'generate_test' has this __file__ attribute:

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/gdrivers/data/s102/generate_test.py
which is not the same as the test file we want to collect:

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/gdrivers/data/s104/generate_test.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for 
your test file modules

???????????????????????????? ERROR collecting data/s111/generate_test.py 
????????????????????????????
import file mismatch:
imported module 'generate_test' has this __file__ attribute:

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/gdrivers/data/s102/generate_test.py
which is not the same as the test file we want to collect:

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/gdrivers/data/s111/generate_test.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for 
your test file modules
collected 7 items / 2 errors

========================================= warnings summary 
==========================================
test_validate_jp2.py:41

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/gdrivers/test_validate_jp2.py:41: 
PytestUnknownMarkWarning: Unknown pytest.mark.require_driver - is this a 
typo?  You can register custom marks to avoid this warning - for details, 
see https://docs.pytest.org/en/stable/how-to/mark.html
     pytestmark = pytest.mark.require_driver("JP2OpenJPEG")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
====================================== short test summary info 
======================================
FAILED data/s104/generate_test.py
FAILED data/s111/generate_test.py
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

Results (0.76s):

I removed *all* the __pycache__ directories in the tree, reran the 
tests and got the same errors.

------------------------------------

Attached (as ogr_basic_test.py.errout) is the output of
running the ogr test ogr_basic_test.py from directory
3.9.1/gdalautotest/ogr

I haven't really tried to run the test suite since the switch
to cmake, but the current errors suggest that the suite is
not ready for someone as inexperienced with it as me to use
it to pass or fail the latest release on this platform.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk
-------------- next part --------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-7.4.4, pluggy-1.4.0
benchmark: 4.0.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/werdna/gdal/3.9.1/gdalautotest-3.9.1/ogr
plugins: env-0.8.2, flake8-1.1.1, benchmark-4.0.0, sugar-1.0.0
collected 68 items

ogr_basic_test.py .....F...s.......................FF.............F..... [ 79%]
..........EEE.                                                           [100%]

==================================== ERRORS ====================================
_________ ERROR at setup of test_geom_use_after_transfer_to_feature_1 __________
file /home/werdna/gdal/3.9.1/gdalautotest-3.9.1/ogr/ogr_basic_test.py, line 1132
  def test_geom_use_after_transfer_to_feature_1(tmp_vsimem):
E       fixture 'tmp_vsimem' not found
>       available fixtures: benchmark, benchmark_weave, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, doctest_namespace, file_handler, handle_delete, handle_get, handle_post, handle_put, monkeypatch, poly_feat, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, server, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/ogr/ogr_basic_test.py:1132
________ ERROR at setup of test_geom_use_after_transfer_to_feature[int] ________
file /home/werdna/gdal/3.9.1/gdalautotest-3.9.1/ogr/ogr_basic_test.py, line 1146
  @pytest.mark.parametrize("arg_type", ("int", "string"))
  def test_geom_use_after_transfer_to_feature(tmp_vsimem, arg_type):
E       fixture 'tmp_vsimem' not found
>       available fixtures: benchmark, benchmark_weave, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, doctest_namespace, file_handler, handle_delete, handle_get, handle_post, handle_put, monkeypatch, poly_feat, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, server, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/ogr/ogr_basic_test.py:1146
______ ERROR at setup of test_geom_use_after_transfer_to_feature[string] _______
file /home/werdna/gdal/3.9.1/gdalautotest-3.9.1/ogr/ogr_basic_test.py, line 1146
  @pytest.mark.parametrize("arg_type", ("int", "string"))
  def test_geom_use_after_transfer_to_feature(tmp_vsimem, arg_type):
E       fixture 'tmp_vsimem' not found
>       available fixtures: benchmark, benchmark_weave, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, doctest_namespace, file_handler, handle_delete, handle_get, handle_post, handle_put, monkeypatch, poly_feat, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, server, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/home/werdna/gdal/3.9.1/gdalautotest-3.9.1/ogr/ogr_basic_test.py:1146
=================================== FAILURES ===================================
_______________________________ test_ogr_basic_6 _______________________________

    def test_ogr_basic_6():
    
>       with pytest.raises(Exception):
E       Failed: DID NOT RAISE <class 'Exception'>

ogr_basic_test.py:176: Failed
______________________________ test_ogr_basic_14 _______________________________

tmp_path = PosixPath('/tmp/user/500/pytest-of-werdna/pytest-2/test_ogr_basic_140')

    def test_ogr_basic_14(tmp_path):
    
        old_dir = os.getcwd()
        os.chdir(tmp_path)
        try:
>           with pytest.raises(Exception):
E           Failed: DID NOT RAISE <class 'Exception'>

ogr_basic_test.py:621: Failed
______________________________ test_ogr_basic_15 _______________________________

    def test_ogr_basic_15():
    
        ds = ogr.Open("data/poly.shp")
        lyr = ds.GetLayer(0)
    
        with gdal.ExceptionMgr(useExceptions=True):
>           with pytest.raises(
                Exception,
                match=r".*CreateFeature : unsupported operation on a read-only datasource.*",
            ):
E           Failed: DID NOT RAISE <class 'Exception'>

ogr_basic_test.py:637: Failed
----------------------------- Captured stderr call -----------------------------
ERROR 6: CreateFeature : unsupported operation on a read-only datasource.
____________________ test_feature_defn_use_after_layer_del _____________________

    def test_feature_defn_use_after_layer_del():
        with ogr.Open("data/poly.shp") as ds:
            lyr = ds.GetLayer(0)
    
            defn1 = lyr.GetLayerDefn()
            defn2 = lyr.GetLayerDefn()
    
>           with pytest.raises(
                Exception,
                match=r"OGRFeatureDefn::AddFieldDefn\(\) not allowed on a sealed object",
            ):
E           Failed: DID NOT RAISE <class 'Exception'>

ogr_basic_test.py:927: Failed
----------------------------- Captured stderr call -----------------------------
ERROR 1: OGRFeatureDefn::AddFieldDefn() not allowed on a sealed object
=============================== warnings summary ===============================
ogr_basic_test.py::test_ogr_basic_1
  /usr/local/gdal/3.9.1.llvm/lib/python3/dist-packages/osgeo/ogr.py:601: FutureWarning: Neither ogr.UseExceptions() nor ogr.DontUseExceptions() has been explicitly called. In GDAL 4.0, exceptions will be enabled by default.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED ogr_basic_test.py::test_ogr_basic_6 - Failed: DID NOT RAISE <class 'Ex...
FAILED ogr_basic_test.py::test_ogr_basic_14 - Failed: DID NOT RAISE <class 'E...
FAILED ogr_basic_test.py::test_ogr_basic_15 - Failed: DID NOT RAISE <class 'E...
FAILED ogr_basic_test.py::test_feature_defn_use_after_layer_del - Failed: DID...
ERROR ogr_basic_test.py::test_geom_use_after_transfer_to_feature_1
ERROR ogr_basic_test.py::test_geom_use_after_transfer_to_feature[int]
ERROR ogr_basic_test.py::test_geom_use_after_transfer_to_feature[string]
========= 4 failed, 60 passed, 1 skipped, 1 warning, 3 errors in 0.34s =========

From even.rouault at spatialys.com  Fri Jun 21 09:31:47 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 21 Jun 2024 18:31:47 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.9.1RC1 as 3.9.1 release
In-Reply-To: <b751df28-1422-9a6c-7f60-2e13dfde7a7e@aitchison.me.uk>
References: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
 <b751df28-1422-9a6c-7f60-2e13dfde7a7e@aitchison.me.uk>
Message-ID: <e3cdef64-b808-43ac-b794-5ba3f3c2bbc2@spatialys.com>

Andrew,
> As Greg said, 25 hours isn't long to test

There's also a 2 business days phase after the motion has been initiated 
before declaring it passed, which will lead to us after the week end, so 
if someone finds something critical enough, that can still be taken into 
account. Hard to know if people will test or not, and how much time they 
need.

| Like several recent gdal versions on other recent Ubuntu releases, it 
complains about setup.py

yeah... Someone brave enough might try to switch the build process to 
use pip install. But that'd definitely require changing some development 
workflows.

>
> I haven't really tried to run the test suite since the switch
> to cmake, but the current errors suggest that the suite is
> not ready for someone as inexperienced with it as me to use
> it to pass or fail the latest release on this platform.

Proper test execution requires the pytest.ini file to be generated, 
which is a CMake generated artifact. The error messages you pasted 
inline are clearly related to that (pytest tries to run some python 
files that aren't designed to be run as tests, and might require h5py 
which is normally not needed for only test excutions). I suspect the 
ones in the attached file might also be due to that. So if using the 
release tarballs, you need to untar/unzip gdal-autotest-3.9.1 in a 
subdirectory of gdal-3.9.1 and make sure that subdirectory is called 
"autotest" (to get the same organization as the git tree). Then from the 
build directory, you can run ctest.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240621/0ebf658e/attachment.htm>

From even.rouault at spatialys.com  Sat Jun 22 05:01:36 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 22 Jun 2024 14:01:36 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.9.1RC1 as 3.9.1 release
In-Reply-To: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
References: <c02d5925-fcd8-4742-9671-d8fbccf51489@spatialys.com>
Message-ID: <2ff9f205-ce51-467f-8366-c3833ff5e479@spatialys.com>

Changing my vote to -1. I've just discovered a few recent regressions of 
3.9.1 that were not in 3.9.0 (last 2 commits of 
https://github.com/OSGeo/gdal/pull/10267)

I'm going to prepare a 3.9.1RC2.

Le 20/06/2024 ? 14:52, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> Motion:
>
> Adopt GDAL 3.9.1RC1 as 3.9.1 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sat Jun 22 15:13:00 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 23 Jun 2024 00:13:00 +0200
Subject: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it
Message-ID: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>

I've issued a 2nd release candidate for 3.9.1 with the following 
additional fixes:
- GDALSieveFilter(): avoid assert() when all pixels are masked (3.9.0 
regression)
 ? (raster/rasterio#3101)
- Overview generation: fix multi-threaded bug, resulting in 
locks/crashes with
 ? GeoPackage in particular (#10245)
- VRT: fix serialization of separatable kernel in 
VRTKernelFilteredSource (#10253)
- Zarr: SerializeNumericNoData(): use CPLJSonObject::Add(uint64_t) to 
avoid potential
 ? undefined behavior casts
- OGR SQL: fix crash when the ON expression of a JOIN contains OGR special
 ? fields (in particular feature id)
- OGR layer algebra: honour PROMOTE_TO_MULTI=YES for Points
- OGRFeature::SetField(int, double): avoid UndefinedBehavior when 
passing NaN
- OGRFeature::SetField(int, GIntBig): avoid UndefinedBehavior when 
passing value
 ? close to INT64_MAX
- OGRLayer::WriteArrowBatch(): avoid UndefinedBehavior when trying to 
convert
 ? NaN to Int64
- GeoParquet: always write version=1.1.0
- SQLite/GPKG: detect UNIQUE constraints expressed as a ', CONSTRAINT 
name UNIQUE (column_name)'
 ? at the end of CREATE TABLE (qgis/QGIS#57823)
- GDALRasterBand::ComputeStatistics(): fix bad progress percentage 
computation (3.9.1rc1 regression)
- OGRSpatialReference::importFromUSGS(): avoid out-of-bounds access to 
array (3.9.1rc1 regression)

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.xz
 ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.9.1/gdal391rc2.zip

A snapshot of the gdalautotest suite is also available:

https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.zip

The NEWS file is here:

 ?? https://github.com/OSGeo/gdal/blob/v3.9.1RC2/NEWS.md

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Jun 24 07:06:51 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 24 Jun 2024 16:06:51 +0200
Subject: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it
In-Reply-To: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
References: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
Message-ID: <d09aaddd-568f-4e5b-918e-b3836dc2460b@spatialys.com>

Forgot to add my +1 obviously

Le 23/06/2024 ? 00:13, Even Rouault via gdal-dev a ?crit?:
> I've issued a 2nd release candidate for 3.9.1 with the following 
> additional fixes:
> - GDALSieveFilter(): avoid assert() when all pixels are masked (3.9.0 
> regression)
> ? (raster/rasterio#3101)
> - Overview generation: fix multi-threaded bug, resulting in 
> locks/crashes with
> ? GeoPackage in particular (#10245)
> - VRT: fix serialization of separatable kernel in 
> VRTKernelFilteredSource (#10253)
> - Zarr: SerializeNumericNoData(): use CPLJSonObject::Add(uint64_t) to 
> avoid potential
> ? undefined behavior casts
> - OGR SQL: fix crash when the ON expression of a JOIN contains OGR 
> special
> ? fields (in particular feature id)
> - OGR layer algebra: honour PROMOTE_TO_MULTI=YES for Points
> - OGRFeature::SetField(int, double): avoid UndefinedBehavior when 
> passing NaN
> - OGRFeature::SetField(int, GIntBig): avoid UndefinedBehavior when 
> passing value
> ? close to INT64_MAX
> - OGRLayer::WriteArrowBatch(): avoid UndefinedBehavior when trying to 
> convert
> ? NaN to Int64
> - GeoParquet: always write version=1.1.0
> - SQLite/GPKG: detect UNIQUE constraints expressed as a ', CONSTRAINT 
> name UNIQUE (column_name)'
> ? at the end of CREATE TABLE (qgis/QGIS#57823)
> - GDALRasterBand::ComputeStatistics(): fix bad progress percentage 
> computation (3.9.1rc1 regression)
> - OGRSpatialReference::importFromUSGS(): avoid out-of-bounds access to 
> array (3.9.1rc1 regression)
>
> Pick up an archive among the following ones (by ascending size):
>
> ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.xz
> ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.gz
> ? https://download.osgeo.org/gdal/3.9.1/gdal391rc2.zip
>
> A snapshot of the gdalautotest suite is also available:
>
> https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.tar.gz
> ? https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.zip
>
> The NEWS file is here:
>
> ?? https://github.com/OSGeo/gdal/blob/v3.9.1RC2/NEWS.md
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 24 07:35:04 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 24 Jun 2024 14:35:04 +0000
Subject: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it
In-Reply-To: <d09aaddd-568f-4e5b-918e-b3836dc2460b@spatialys.com>
References: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
 <d09aaddd-568f-4e5b-918e-b3836dc2460b@spatialys.com>
Message-ID: <DB9PR09MB6887A3D5CFEAA200F947C8AFFDD42@DB9PR09MB6887.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
L?hetetty: maanantai 24. kes?kuuta 2024 17.07
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it

Forgot to add my +1 obviously

Le 23/06/2024 ? 00:13, Even Rouault via gdal-dev a ?crit :
> I've issued a 2nd release candidate for 3.9.1 with the following
> additional fixes:
> - GDALSieveFilter(): avoid assert() when all pixels are masked (3.9.0
> regression)
>   (raster/rasterio#3101)
> - Overview generation: fix multi-threaded bug, resulting in
> locks/crashes with
>   GeoPackage in particular (#10245)
> - VRT: fix serialization of separatable kernel in
> VRTKernelFilteredSource (#10253)
> - Zarr: SerializeNumericNoData(): use CPLJSonObject::Add(uint64_t) to
> avoid potential
>   undefined behavior casts
> - OGR SQL: fix crash when the ON expression of a JOIN contains OGR
> special
>   fields (in particular feature id)
> - OGR layer algebra: honour PROMOTE_TO_MULTI=YES for Points
> - OGRFeature::SetField(int, double): avoid UndefinedBehavior when
> passing NaN
> - OGRFeature::SetField(int, GIntBig): avoid UndefinedBehavior when
> passing value
>   close to INT64_MAX
> - OGRLayer::WriteArrowBatch(): avoid UndefinedBehavior when trying to
> convert
>   NaN to Int64
> - GeoParquet: always write version=1.1.0
> - SQLite/GPKG: detect UNIQUE constraints expressed as a ', CONSTRAINT
> name UNIQUE (column_name)'
>   at the end of CREATE TABLE (qgis/QGIS#57823)
> - GDALRasterBand::ComputeStatistics(): fix bad progress percentage
> computation (3.9.1rc1 regression)
> - OGRSpatialReference::importFromUSGS(): avoid out-of-bounds access to
> array (3.9.1rc1 regression)
>
> Pick up an archive among the following ones (by ascending size):
>
>
> https://down/
> load.osgeo.org%2Fgdal%2F3.9.1%2Fgdal-3.9.1rc2.tar.xz&data=05%7C02%7Cju
> kka.rahkonen%40maanmittauslaitos.fi%7C8a878635699b4327b7a808dc9456f122
> %7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638548353038914451%7CUnk
> nown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWw
> iLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=QKDKxmtYu3yqWkt%2BEJoWs2F%2FDP%2F2d
> NXNrJeqdpzJ2lY%3D&reserved=0
>
> https://down/
> load.osgeo.org%2Fgdal%2F3.9.1%2Fgdal-3.9.1rc2.tar.gz&data=05%7C02%7Cju
> kka.rahkonen%40maanmittauslaitos.fi%7C8a878635699b4327b7a808dc9456f122
> %7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638548353038923721%7CUnk
> nown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWw
> iLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=k%2FwOHtldnSwPj27c7KqPojnTO%2FOQwMh
> CYGHZC9HuZ5w%3D&reserved=0
>
> https://down/
> load.osgeo.org%2Fgdal%2F3.9.1%2Fgdal391rc2.zip&data=05%7C02%7Cjukka.ra
> hkonen%40maanmittauslaitos.fi%7C8a878635699b4327b7a808dc9456f122%7Cc4f
> 8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638548353038929699%7CUnknown%7
> CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXV
> CI6Mn0%3D%7C0%7C%7C%7C&sdata=206oYiEKWF2bTeYN6SsWa4fq8nBSPKWhhtPqYCzBc
> pw%3D&reserved=0
>
> A snapshot of the gdalautotest suite is also available:
>
> https://down/
> load.osgeo.org%2Fgdal%2F3.9.1%2Fgdalautotest-3.9.1rc2.tar.gz&data=05%7
> C02%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C8a878635699b4327b7a808dc
> 9456f122%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C6385483530389349
> 68%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI
> 6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=MPXYE%2FWq%2BwnMYK6tKCpid9b
> eoCPWFY%2BBefivpTHpjNE%3D&reserved=0
>
> https://down/
> load.osgeo.org%2Fgdal%2F3.9.1%2Fgdalautotest-3.9.1rc2.zip&data=05%7C02
> %7Cjukka.rahkonen%40maanmittauslaitos.fi%7C8a878635699b4327b7a808dc945
> 6f122%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638548353038939284%
> 7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik
> 1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=o6qmt5kC1FbwhjGdIlH3cnlQRezBKO
> KoW80sjdtvxcY%3D&reserved=0
>
> The NEWS file is here:
>
>
> https://gith/
> ub.com%2FOSGeo%2Fgdal%2Fblob%2Fv3.9.1RC2%2FNEWS.md&data=05%7C02%7Cjukk
> a.rahkonen%40maanmittauslaitos.fi%7C8a878635699b4327b7a808dc9456f122%7
> Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C638548353038943612%7CUnkno
> wn%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiL
> CJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=bO%2ByyJi9Pbq%2BV9i09xFtnn8hG6iJQbzmZ
> UMW%2Bfwo%2FC0%3D&reserved=0
>
> Even
>
--
http://www.spatialys.com/
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From szekerest at gmail.com  Mon Jun 24 07:46:49 2024
From: szekerest at gmail.com (Tamas Szekeres)
Date: Mon, 24 Jun 2024 16:46:49 +0200
Subject: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it
In-Reply-To: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
References: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
Message-ID: <CACALY+SWjn3qTerZ8sPU9eG=xi+iROVV+WVBeC1xLt0L8da+0Q@mail.gmail.com>

+1

Tamas


Even Rouault via gdal-dev <gdal-dev at lists.osgeo.org> ezt ?rta (id?pont:
2024. j?n. 23., V, 0:13):

> I've issued a 2nd release candidate for 3.9.1 with the following
> additional fixes:
> - GDALSieveFilter(): avoid assert() when all pixels are masked (3.9.0
> regression)
>    (raster/rasterio#3101)
> - Overview generation: fix multi-threaded bug, resulting in
> locks/crashes with
>    GeoPackage in particular (#10245)
> - VRT: fix serialization of separatable kernel in
> VRTKernelFilteredSource (#10253)
> - Zarr: SerializeNumericNoData(): use CPLJSonObject::Add(uint64_t) to
> avoid potential
>    undefined behavior casts
> - OGR SQL: fix crash when the ON expression of a JOIN contains OGR special
>    fields (in particular feature id)
> - OGR layer algebra: honour PROMOTE_TO_MULTI=YES for Points
> - OGRFeature::SetField(int, double): avoid UndefinedBehavior when
> passing NaN
> - OGRFeature::SetField(int, GIntBig): avoid UndefinedBehavior when
> passing value
>    close to INT64_MAX
> - OGRLayer::WriteArrowBatch(): avoid UndefinedBehavior when trying to
> convert
>    NaN to Int64
> - GeoParquet: always write version=1.1.0
> - SQLite/GPKG: detect UNIQUE constraints expressed as a ', CONSTRAINT
> name UNIQUE (column_name)'
>    at the end of CREATE TABLE (qgis/QGIS#57823)
> - GDALRasterBand::ComputeStatistics(): fix bad progress percentage
> computation (3.9.1rc1 regression)
> - OGRSpatialReference::importFromUSGS(): avoid out-of-bounds access to
> array (3.9.1rc1 regression)
>
> Pick up an archive among the following ones (by ascending size):
>
>    https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.xz
>    https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.gz
>    https://download.osgeo.org/gdal/3.9.1/gdal391rc2.zip
>
> A snapshot of the gdalautotest suite is also available:
>
> https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.tar.gz
>    https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.zip
>
> The NEWS file is here:
>
>     https://github.com/OSGeo/gdal/blob/v3.9.1RC2/NEWS.md
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240624/26fc4f3a/attachment.htm>

From howard at hobu.co  Mon Jun 24 08:09:29 2024
From: howard at hobu.co (Howard Butler)
Date: Mon, 24 Jun 2024 10:09:29 -0500
Subject: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it
In-Reply-To: <CACALY+SWjn3qTerZ8sPU9eG=xi+iROVV+WVBeC1xLt0L8da+0Q@mail.gmail.com>
References: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
 <CACALY+SWjn3qTerZ8sPU9eG=xi+iROVV+WVBeC1xLt0L8da+0Q@mail.gmail.com>
Message-ID: <56DFB503-CBDF-47CA-A54A-E50DC06CEB78@hobu.co>

+1

Howard

> On Jun 24, 2024, at 9:46?AM, Tamas Szekeres via gdal-dev <gdal-dev at lists.osgeo.org> wrote:
> 
> +1
> 
> Tamas
> 
> 
> Even Rouault via gdal-dev <gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>> ezt ?rta (id?pont: 2024. j?n. 23., V, 0:13):
>> I've issued a 2nd release candidate for 3.9.1 with the following 
>> additional fixes:
>> - GDALSieveFilter(): avoid assert() when all pixels are masked (3.9.0 
>> regression)
>>    (raster/rasterio#3101)
>> - Overview generation: fix multi-threaded bug, resulting in 
>> locks/crashes with
>>    GeoPackage in particular (#10245)
>> - VRT: fix serialization of separatable kernel in 
>> VRTKernelFilteredSource (#10253)
>> - Zarr: SerializeNumericNoData(): use CPLJSonObject::Add(uint64_t) to 
>> avoid potential
>>    undefined behavior casts
>> - OGR SQL: fix crash when the ON expression of a JOIN contains OGR special
>>    fields (in particular feature id)
>> - OGR layer algebra: honour PROMOTE_TO_MULTI=YES for Points
>> - OGRFeature::SetField(int, double): avoid UndefinedBehavior when 
>> passing NaN
>> - OGRFeature::SetField(int, GIntBig): avoid UndefinedBehavior when 
>> passing value
>>    close to INT64_MAX
>> - OGRLayer::WriteArrowBatch(): avoid UndefinedBehavior when trying to 
>> convert
>>    NaN to Int64
>> - GeoParquet: always write version=1.1.0
>> - SQLite/GPKG: detect UNIQUE constraints expressed as a ', CONSTRAINT 
>> name UNIQUE (column_name)'
>>    at the end of CREATE TABLE (qgis/QGIS#57823)
>> - GDALRasterBand::ComputeStatistics(): fix bad progress percentage 
>> computation (3.9.1rc1 regression)
>> - OGRSpatialReference::importFromUSGS(): avoid out-of-bounds access to 
>> array (3.9.1rc1 regression)
>> 
>> Pick up an archive among the following ones (by ascending size):
>> 
>>    https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.xz
>>    https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.gz
>>    https://download.osgeo.org/gdal/3.9.1/gdal391rc2.zip
>> 
>> A snapshot of the gdalautotest suite is also available:
>> 
>> https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.tar.gz
>>    https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.zip
>> 
>> The NEWS file is here:
>> 
>>     https://github.com/OSGeo/gdal/blob/v3.9.1RC2/NEWS.md
>> 
>> Even
>> 
>> -- 
>> http://www.spatialys.com <http://www.spatialys.com/>
>> My software is free, but my time generally not.
>> 
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240624/ed2d28fd/attachment-0001.htm>

From j1 at jimenezshaw.com  Mon Jun 24 08:14:45 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 24 Jun 2024 17:14:45 +0200
Subject: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it
In-Reply-To: <56DFB503-CBDF-47CA-A54A-E50DC06CEB78@hobu.co>
References: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
 <CACALY+SWjn3qTerZ8sPU9eG=xi+iROVV+WVBeC1xLt0L8da+0Q@mail.gmail.com>
 <56DFB503-CBDF-47CA-A54A-E50DC06CEB78@hobu.co>
Message-ID: <CADRrdKuejWeAL2=OpkaivAqS4o6aYoCQMue5LVSavqwxw94Fyg@mail.gmail.com>

+1 Javier

On Mon, 24 Jun 2024 at 17:09, Howard Butler via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> +1
>
> Howard
>
> On Jun 24, 2024, at 9:46?AM, Tamas Szekeres via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> +1
>
> Tamas
>
>
> Even Rouault via gdal-dev <gdal-dev at lists.osgeo.org> ezt ?rta (id?pont:
> 2024. j?n. 23., V, 0:13):
>
>> I've issued a 2nd release candidate for 3.9.1 with the following
>> additional fixes:
>> - GDALSieveFilter(): avoid assert() when all pixels are masked (3.9.0
>> regression)
>>    (raster/rasterio#3101)
>> - Overview generation: fix multi-threaded bug, resulting in
>> locks/crashes with
>>    GeoPackage in particular (#10245)
>> - VRT: fix serialization of separatable kernel in
>> VRTKernelFilteredSource (#10253)
>> - Zarr: SerializeNumericNoData(): use CPLJSonObject::Add(uint64_t) to
>> avoid potential
>>    undefined behavior casts
>> - OGR SQL: fix crash when the ON expression of a JOIN contains OGR special
>>    fields (in particular feature id)
>> - OGR layer algebra: honour PROMOTE_TO_MULTI=YES for Points
>> - OGRFeature::SetField(int, double): avoid UndefinedBehavior when
>> passing NaN
>> - OGRFeature::SetField(int, GIntBig): avoid UndefinedBehavior when
>> passing value
>>    close to INT64_MAX
>> - OGRLayer::WriteArrowBatch(): avoid UndefinedBehavior when trying to
>> convert
>>    NaN to Int64
>> - GeoParquet: always write version=1.1.0
>> - SQLite/GPKG: detect UNIQUE constraints expressed as a ', CONSTRAINT
>> name UNIQUE (column_name)'
>>    at the end of CREATE TABLE (qgis/QGIS#57823)
>> - GDALRasterBand::ComputeStatistics(): fix bad progress percentage
>> computation (3.9.1rc1 regression)
>> - OGRSpatialReference::importFromUSGS(): avoid out-of-bounds access to
>> array (3.9.1rc1 regression)
>>
>> Pick up an archive among the following ones (by ascending size):
>>
>>    https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.xz
>>    https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.gz
>>    https://download.osgeo.org/gdal/3.9.1/gdal391rc2.zip
>>
>> A snapshot of the gdalautotest suite is also available:
>>
>> https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.tar.gz
>>    https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.zip
>>
>> The NEWS file is here:
>>
>>     https://github.com/OSGeo/gdal/blob/v3.9.1RC2/NEWS.md
>>
>> Even
>>
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240624/10441b6d/attachment.htm>

From public at postholer.com  Mon Jun 24 09:39:58 2024
From: public at postholer.com (Scott)
Date: Mon, 24 Jun 2024 09:39:58 -0700
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
Message-ID: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>

When building 3.9.1 rc1/r2 I get the following when linking. If I 
comment srsinfo out of the makefile, all other gdal/ogr apps build fine 
with no issues.

uname -a:
Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 
(2024-05-03) x86_64 GNU/Linux

Thanks!

Build output below:

[ 98%] Building CXX object apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
In file included from /usr/include/c++/12/ext/string_conversions.h:41,
                  from /usr/include/c++/12/bits/basic_string.h:3960,
                  from /usr/include/c++/12/string:53,
                  from 
/export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
                  from 
/export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
                  from 
/export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
/usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No such file 
or directory
    75 | #include_next <stdlib.h>
       |               ^~~~~~~~~~
compilation terminated.
make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76: 
apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
make[1]: *** [CMakeFiles/Makefile2:10247: 
apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
make: *** [Makefile:146: all] Error 2


From even.rouault at spatialys.com  Mon Jun 24 10:01:02 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 24 Jun 2024 19:01:02 +0200
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
Message-ID: <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>

Hi,

What is the version of your Debian system ? Is it "clean" ? Can you for 
example reproduce in the corresponding debian:XXX docker image?

https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+" 
shows that this error message is quite common, although on quick 
reading, I couldn't spot a common point/solution between all those 
occurrences

Even

Le 24/06/2024 ? 18:39, Scott via gdal-dev a ?crit?:
> When building 3.9.1 rc1/r2 I get the following when linking. If I 
> comment srsinfo out of the makefile, all other gdal/ogr apps build 
> fine with no issues.
>
> uname -a:
> Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 
> (2024-05-03) x86_64 GNU/Linux
>
> Thanks!
>
> Build output below:
>
> [ 98%] Building CXX object 
> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
> In file included from /usr/include/c++/12/ext/string_conversions.h:41,
> ???????????????? from /usr/include/c++/12/bits/basic_string.h:3960,
> ???????????????? from /usr/include/c++/12/string:53,
> ???????????????? from 
> /export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
> ???????????????? from 
> /export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
> ???????????????? from 
> /export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
> /usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No such file 
> or directory
> ?? 75 | #include_next <stdlib.h>
> ????? |?????????????? ^~~~~~~~~~
> compilation terminated.
> make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76: 
> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
> make[1]: *** [CMakeFiles/Makefile2:10247: 
> apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
> make: *** [Makefile:146: all] Error 2
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From public at postholer.com  Mon Jun 24 10:15:42 2024
From: public at postholer.com (Scott)
Date: Mon, 24 Jun 2024 10:15:42 -0700
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
Message-ID: <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>

It's Debian 12. No, it's not clean. It's had several versions of gdal, 
et al, on it.

It appears srsinfo in not finding stdlib.h and all the other apps do, 
which is the part I found odd.

Docker is not the environment I'm building in.

Thanks!

On 6/24/24 10:01, Even Rouault wrote:
> Hi,
> 
> What is the version of your Debian system ? Is it "clean" ? Can you for 
> example reproduce in the corresponding debian:XXX docker image?
> 
> https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+" shows that this error message is quite common, although on quick reading, I couldn't spot a common point/solution between all those occurrences
> 
> Even
> 
> Le 24/06/2024 ? 18:39, Scott via gdal-dev a ?crit?:
>> When building 3.9.1 rc1/r2 I get the following when linking. If I 
>> comment srsinfo out of the makefile, all other gdal/ogr apps build 
>> fine with no issues.
>>
>> uname -a:
>> Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 
>> (2024-05-03) x86_64 GNU/Linux
>>
>> Thanks!
>>
>> Build output below:
>>
>> [ 98%] Building CXX object 
>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
>> In file included from /usr/include/c++/12/ext/string_conversions.h:41,
>> ???????????????? from /usr/include/c++/12/bits/basic_string.h:3960,
>> ???????????????? from /usr/include/c++/12/string:53,
>> ???????????????? from 
>> /export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
>> ???????????????? from 
>> /export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
>> ???????????????? from 
>> /export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
>> /usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No such file 
>> or directory
>> ?? 75 | #include_next <stdlib.h>
>> ????? |?????????????? ^~~~~~~~~~
>> compilation terminated.
>> make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76: 
>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
>> make[1]: *** [CMakeFiles/Makefile2:10247: 
>> apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
>> make: *** [Makefile:146: all] Error 2
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 

From even.rouault at spatialys.com  Mon Jun 24 10:25:05 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 24 Jun 2024 19:25:05 +0200
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
Message-ID: <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>


Le 24/06/2024 ? 19:15, Scott a ?crit?:
> It's Debian 12. No, it's not clean. It's had several versions of gdal, 
> et al, on it.
>
> It appears srsinfo in not finding stdlib.h and all the other apps do, 
> which is the part I found odd.
>
> Docker is not the environment I'm building in.

yes, but that's the most convenient way for me to try to reproduce all 
the diverse environments people can use

Just trying the following works fine for me:

docker run --rm -it -v /home/even/gdal/3.9:/home/even/gdal/3.9 debian:12

(inside it)

cd /home/even/gdal/3.9/build_debian_12/
apt update && apt install cmake g++ make libproj-dev
cmake ..
make -j$(nproc)

>
> Thanks!
>
> On 6/24/24 10:01, Even Rouault wrote:
>> Hi,
>>
>> What is the version of your Debian system ? Is it "clean" ? Can you 
>> for example reproduce in the corresponding debian:XXX docker image?
>>
>> https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+" 
>> shows that this error message is quite common, although on quick 
>> reading, I couldn't spot a common point/solution between all those 
>> occurrences
>>
>> Even
>>
>> Le 24/06/2024 ? 18:39, Scott via gdal-dev a ?crit?:
>>> When building 3.9.1 rc1/r2 I get the following when linking. If I 
>>> comment srsinfo out of the makefile, all other gdal/ogr apps build 
>>> fine with no issues.
>>>
>>> uname -a:
>>> Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 
>>> (2024-05-03) x86_64 GNU/Linux
>>>
>>> Thanks!
>>>
>>> Build output below:
>>>
>>> [ 98%] Building CXX object 
>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
>>> In file included from /usr/include/c++/12/ext/string_conversions.h:41,
>>> ???????????????? from /usr/include/c++/12/bits/basic_string.h:3960,
>>> ???????????????? from /usr/include/c++/12/string:53,
>>> ???????????????? from 
>>> /export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
>>> ???????????????? from 
>>> /export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
>>> ???????????????? from 
>>> /export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
>>> /usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No such 
>>> file or directory
>>> ?? 75 | #include_next <stdlib.h>
>>> ????? |?????????????? ^~~~~~~~~~
>>> compilation terminated.
>>> make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76: 
>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
>>> make[1]: *** [CMakeFiles/Makefile2:10247: 
>>> apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
>>> make: *** [Makefile:146: all] Error 2
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From public at postholer.com  Mon Jun 24 10:52:57 2024
From: public at postholer.com (Scott)
Date: Mon, 24 Jun 2024 10:52:57 -0700
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
Message-ID: <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>

Thanks for the docker instructions. It built nice and clean.

That still leaves the question, in my environment, why do all the apps 
except gdalsrsinfo build? I seriously doubt stdlib.h is only used by 
gdalsrsinfo.

Thanks for the help! I'll try and figure it out.

On 6/24/24 10:25, Even Rouault wrote:
> 
> Le 24/06/2024 ? 19:15, Scott a ?crit?:
>> It's Debian 12. No, it's not clean. It's had several versions of gdal, 
>> et al, on it.
>>
>> It appears srsinfo in not finding stdlib.h and all the other apps do, 
>> which is the part I found odd.
>>
>> Docker is not the environment I'm building in.
> 
> yes, but that's the most convenient way for me to try to reproduce all 
> the diverse environments people can use
> 
> Just trying the following works fine for me:
> 
> docker run --rm -it -v /home/even/gdal/3.9:/home/even/gdal/3.9 debian:12
> 
> (inside it)
> 
> cd /home/even/gdal/3.9/build_debian_12/
> apt update && apt install cmake g++ make libproj-dev
> cmake ..
> make -j$(nproc)
> 
>>
>> Thanks!
>>
>> On 6/24/24 10:01, Even Rouault wrote:
>>> Hi,
>>>
>>> What is the version of your Debian system ? Is it "clean" ? Can you 
>>> for example reproduce in the corresponding debian:XXX docker image?
>>>
>>> https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+" shows that this error message is quite common, although on quick reading, I couldn't spot a common point/solution between all those occurrences
>>>
>>> Even
>>>
>>> Le 24/06/2024 ? 18:39, Scott via gdal-dev a ?crit?:
>>>> When building 3.9.1 rc1/r2 I get the following when linking. If I 
>>>> comment srsinfo out of the makefile, all other gdal/ogr apps build 
>>>> fine with no issues.
>>>>
>>>> uname -a:
>>>> Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 
>>>> (2024-05-03) x86_64 GNU/Linux
>>>>
>>>> Thanks!
>>>>
>>>> Build output below:
>>>>
>>>> [ 98%] Building CXX object 
>>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
>>>> In file included from /usr/include/c++/12/ext/string_conversions.h:41,
>>>> ???????????????? from /usr/include/c++/12/bits/basic_string.h:3960,
>>>> ???????????????? from /usr/include/c++/12/string:53,
>>>> ???????????????? from 
>>>> /export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
>>>> ???????????????? from 
>>>> /export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
>>>> ???????????????? from 
>>>> /export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
>>>> /usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No such 
>>>> file or directory
>>>> ?? 75 | #include_next <stdlib.h>
>>>> ????? |?????????????? ^~~~~~~~~~
>>>> compilation terminated.
>>>> make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76: 
>>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
>>>> make[1]: *** [CMakeFiles/Makefile2:10247: 
>>>> apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
>>>> make: *** [Makefile:146: all] Error 2
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>

From bdezonia at gmail.com  Mon Jun 24 10:57:27 2024
From: bdezonia at gmail.com (Barry DeZonia)
Date: Mon, 24 Jun 2024 12:57:27 -0500
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
Message-ID: <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>

Scott, is it that you are using #include_next instead of #include?
#include_next makes assumptions about the environment that #include does
not.

On Mon, Jun 24, 2024 at 12:53?PM Scott via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Thanks for the docker instructions. It built nice and clean.
>
> That still leaves the question, in my environment, why do all the apps
> except gdalsrsinfo build? I seriously doubt stdlib.h is only used by
> gdalsrsinfo.
>
> Thanks for the help! I'll try and figure it out.
>
> On 6/24/24 10:25, Even Rouault wrote:
> >
> > Le 24/06/2024 ? 19:15, Scott a ?crit :
> >> It's Debian 12. No, it's not clean. It's had several versions of gdal,
> >> et al, on it.
> >>
> >> It appears srsinfo in not finding stdlib.h and all the other apps do,
> >> which is the part I found odd.
> >>
> >> Docker is not the environment I'm building in.
> >
> > yes, but that's the most convenient way for me to try to reproduce all
> > the diverse environments people can use
> >
> > Just trying the following works fine for me:
> >
> > docker run --rm -it -v /home/even/gdal/3.9:/home/even/gdal/3.9 debian:12
> >
> > (inside it)
> >
> > cd /home/even/gdal/3.9/build_debian_12/
> > apt update && apt install cmake g++ make libproj-dev
> > cmake ..
> > make -j$(nproc)
> >
> >>
> >> Thanks!
> >>
> >> On 6/24/24 10:01, Even Rouault wrote:
> >>> Hi,
> >>>
> >>> What is the version of your Debian system ? Is it "clean" ? Can you
> >>> for example reproduce in the corresponding debian:XXX docker image?
> >>>
> >>>
> https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+"
> shows that this error message is quite common, although on quick reading, I
> couldn't spot a common point/solution between all those occurrences
> >>>
> >>> Even
> >>>
> >>> Le 24/06/2024 ? 18:39, Scott via gdal-dev a ?crit :
> >>>> When building 3.9.1 rc1/r2 I get the following when linking. If I
> >>>> comment srsinfo out of the makefile, all other gdal/ogr apps build
> >>>> fine with no issues.
> >>>>
> >>>> uname -a:
> >>>> Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1
> >>>> (2024-05-03) x86_64 GNU/Linux
> >>>>
> >>>> Thanks!
> >>>>
> >>>> Build output below:
> >>>>
> >>>> [ 98%] Building CXX object
> >>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
> >>>> In file included from /usr/include/c++/12/ext/string_conversions.h:41,
> >>>>                  from /usr/include/c++/12/bits/basic_string.h:3960,
> >>>>                  from /usr/include/c++/12/string:53,
> >>>>                  from
> >>>> /export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
> >>>>                  from
> >>>> /export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
> >>>>                  from
> >>>> /export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
> >>>> /usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No such
> >>>> file or directory
> >>>>    75 | #include_next <stdlib.h>
> >>>>       |               ^~~~~~~~~~
> >>>> compilation terminated.
> >>>> make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76:
> >>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
> >>>> make[1]: *** [CMakeFiles/Makefile2:10247:
> >>>> apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
> >>>> make: *** [Makefile:146: all] Error 2
> >>>>
> >>>> _______________________________________________
> >>>> gdal-dev mailing list
> >>>> gdal-dev at lists.osgeo.org
> >>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240624/fccbde48/attachment.htm>

From gdt at lexort.com  Mon Jun 24 11:03:10 2024
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 24 Jun 2024 14:03:10 -0400
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 (Barry DeZonia via gdal-dev's message of "Mon, 24 Jun 2024 12:57:27
 -0500")
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
Message-ID: <rmi34p2rzfl.fsf@s1.lexort.com>

Barry DeZonia via gdal-dev <gdal-dev at lists.osgeo.org> writes:

> Scott, is it that you are using #include_next instead of #include?
> #include_next makes assumptions about the environment that #include does
> not.

And, stdlib.h is very much required by POSIX.  On Debian 12 amd64,
/usr/include/stdlib.h is there, just as expected/required.

#include_next is new to me.   Using it seems irregular, and using it for
 stdlib seems wrong, from a posix-compliance point of view.

Is this in the gdal sources?

From public at postholer.com  Mon Jun 24 11:03:53 2024
From: public at postholer.com (Scott)
Date: Mon, 24 Jun 2024 11:03:53 -0700
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
Message-ID: <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>

Yes, I saw that. It's the default code. I tried changing it to just 
'include' early on and got a whole new set of errors.

Changing the default source code without an understanding of the bigger 
picture leaves me a bit out of my element, though.

Thanks!

On 6/24/24 10:57, Barry DeZonia wrote:
> Scott, is it that you are using #include_next instead of #include? 
> #include_next makes assumptions about the environment that #include does 
> not.
> 
> On Mon, Jun 24, 2024 at 12:53?PM Scott via gdal-dev 
> <gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>> wrote:
> 
>     Thanks for the docker instructions. It built nice and clean.
> 
>     That still leaves the question, in my environment, why do all the apps
>     except gdalsrsinfo build? I seriously doubt stdlib.h is only used by
>     gdalsrsinfo.
> 
>     Thanks for the help! I'll try and figure it out.
> 
>     On 6/24/24 10:25, Even Rouault wrote:
>      >
>      > Le 24/06/2024 ? 19:15, Scott a ?crit?:
>      >> It's Debian 12. No, it's not clean. It's had several versions of
>     gdal,
>      >> et al, on it.
>      >>
>      >> It appears srsinfo in not finding stdlib.h and all the other
>     apps do,
>      >> which is the part I found odd.
>      >>
>      >> Docker is not the environment I'm building in.
>      >
>      > yes, but that's the most convenient way for me to try to
>     reproduce all
>      > the diverse environments people can use
>      >
>      > Just trying the following works fine for me:
>      >
>      > docker run --rm -it -v /home/even/gdal/3.9:/home/even/gdal/3.9
>     debian:12
>      >
>      > (inside it)
>      >
>      > cd /home/even/gdal/3.9/build_debian_12/
>      > apt update && apt install cmake g++ make libproj-dev
>      > cmake ..
>      > make -j$(nproc)
>      >
>      >>
>      >> Thanks!
>      >>
>      >> On 6/24/24 10:01, Even Rouault wrote:
>      >>> Hi,
>      >>>
>      >>> What is the version of your Debian system ? Is it "clean" ? Can
>     you
>      >>> for example reproduce in the corresponding debian:XXX docker image?
>      >>>
>      >>>
>     https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+ <https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+>" shows that this error message is quite common, although on quick reading, I couldn't spot a common point/solution between all those occurrences
>      >>>
>      >>> Even
>      >>>
>      >>> Le 24/06/2024 ? 18:39, Scott via gdal-dev a ?crit?:
>      >>>> When building 3.9.1 rc1/r2 I get the following when linking. If I
>      >>>> comment srsinfo out of the makefile, all other gdal/ogr apps
>     build
>      >>>> fine with no issues.
>      >>>>
>      >>>> uname -a:
>      >>>> Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian
>     6.1.90-1
>      >>>> (2024-05-03) x86_64 GNU/Linux
>      >>>>
>      >>>> Thanks!
>      >>>>
>      >>>> Build output below:
>      >>>>
>      >>>> [ 98%] Building CXX object
>      >>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
>      >>>> In file included from
>     /usr/include/c++/12/ext/string_conversions.h:41,
>      >>>> ???????????????? from
>     /usr/include/c++/12/bits/basic_string.h:3960,
>      >>>> ???????????????? from /usr/include/c++/12/string:53,
>      >>>> ???????????????? from
>      >>>> /export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
>      >>>> ???????????????? from
>      >>>> /export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
>      >>>> ???????????????? from
>      >>>> /export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
>      >>>> /usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No such
>      >>>> file or directory
>      >>>> ?? 75 | #include_next <stdlib.h>
>      >>>> ????? |?????????????? ^~~~~~~~~~
>      >>>> compilation terminated.
>      >>>> make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76:
>      >>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
>      >>>> make[1]: *** [CMakeFiles/Makefile2:10247:
>      >>>> apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
>      >>>> make: *** [Makefile:146: all] Error 2
>      >>>>
>      >>>> _______________________________________________
>      >>>> gdal-dev mailing list
>      >>>> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>      >>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>      >>>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> 

From public at postholer.com  Mon Jun 24 11:12:14 2024
From: public at postholer.com (Scott)
Date: Mon, 24 Jun 2024 11:12:14 -0700
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
Message-ID: <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com>

#include_next is part of the c++ version 12. You can find it's usage 
here on debian 12:

/usr/include/c++/12/cstdlib, line 75


On 6/24/24 11:03, Scott via gdal-dev wrote:
> Yes, I saw that. It's the default code. I tried changing it to just 
> 'include' early on and got a whole new set of errors.
> 
> Changing the default source code without an understanding of the bigger 
> picture leaves me a bit out of my element, though.
> 
> Thanks!
> 
> On 6/24/24 10:57, Barry DeZonia wrote:
>> Scott, is it that you are using #include_next instead of #include? 
>> #include_next makes assumptions about the environment that #include 
>> does not.
>>
>> On Mon, Jun 24, 2024 at 12:53?PM Scott via gdal-dev 
>> <gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>> wrote:
>>
>> ??? Thanks for the docker instructions. It built nice and clean.
>>
>> ??? That still leaves the question, in my environment, why do all the 
>> apps
>> ??? except gdalsrsinfo build? I seriously doubt stdlib.h is only used by
>> ??? gdalsrsinfo.
>>
>> ??? Thanks for the help! I'll try and figure it out.
>>
>> ??? On 6/24/24 10:25, Even Rouault wrote:
>> ???? >
>> ???? > Le 24/06/2024 ? 19:15, Scott a ?crit?:
>> ???? >> It's Debian 12. No, it's not clean. It's had several versions of
>> ??? gdal,
>> ???? >> et al, on it.
>> ???? >>
>> ???? >> It appears srsinfo in not finding stdlib.h and all the other
>> ??? apps do,
>> ???? >> which is the part I found odd.
>> ???? >>
>> ???? >> Docker is not the environment I'm building in.
>> ???? >
>> ???? > yes, but that's the most convenient way for me to try to
>> ??? reproduce all
>> ???? > the diverse environments people can use
>> ???? >
>> ???? > Just trying the following works fine for me:
>> ???? >
>> ???? > docker run --rm -it -v /home/even/gdal/3.9:/home/even/gdal/3.9
>> ??? debian:12
>> ???? >
>> ???? > (inside it)
>> ???? >
>> ???? > cd /home/even/gdal/3.9/build_debian_12/
>> ???? > apt update && apt install cmake g++ make libproj-dev
>> ???? > cmake ..
>> ???? > make -j$(nproc)
>> ???? >
>> ???? >>
>> ???? >> Thanks!
>> ???? >>
>> ???? >> On 6/24/24 10:01, Even Rouault wrote:
>> ???? >>> Hi,
>> ???? >>>
>> ???? >>> What is the version of your Debian system ? Is it "clean" ? Can
>> ??? you
>> ???? >>> for example reproduce in the corresponding debian:XXX docker 
>> image?
>> ???? >>>
>> ???? >>>
>>     
>> https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+ <https://www.google.com/search?q=fatal+error%3A+stdlib.h%3A+No+such+file+or+directory+>" shows that this error message is quite common, although on quick reading, I couldn't spot a common point/solution between all those occurrences
>> ???? >>>
>> ???? >>> Even
>> ???? >>>
>> ???? >>> Le 24/06/2024 ? 18:39, Scott via gdal-dev a ?crit?:
>> ???? >>>> When building 3.9.1 rc1/r2 I get the following when linking. 
>> If I
>> ???? >>>> comment srsinfo out of the makefile, all other gdal/ogr apps
>> ??? build
>> ???? >>>> fine with no issues.
>> ???? >>>>
>> ???? >>>> uname -a:
>> ???? >>>> Linux MyHost 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian
>> ??? 6.1.90-1
>> ???? >>>> (2024-05-03) x86_64 GNU/Linux
>> ???? >>>>
>> ???? >>>> Thanks!
>> ???? >>>>
>> ???? >>>> Build output below:
>> ???? >>>>
>> ???? >>>> [ 98%] Building CXX object
>> ???? >>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o
>> ???? >>>> In file included from
>> ??? /usr/include/c++/12/ext/string_conversions.h:41,
>> ???? >>>> ???????????????? from
>> ??? /usr/include/c++/12/bits/basic_string.h:3960,
>> ???? >>>> ???????????????? from /usr/include/c++/12/string:53,
>> ???? >>>> ???????????????? from
>> ???? >>>> /export/gis/local/src/gdal-3.9.1/port/cpl_error.h:256,
>> ???? >>>> ???????????????? from
>> ???? >>>> /export/gis/local/src/gdal-3.9.1/port/cpl_string.h:35,
>> ???? >>>> ???????????????? from
>> ???? >>>> /export/gis/local/src/gdal-3.9.1/apps/gdalsrsinfo.cpp:32:
>> ???? >>>> /usr/include/c++/12/cstdlib:75:15: fatal error: stdlib.h: No 
>> such
>> ???? >>>> file or directory
>> ???? >>>> ?? 75 | #include_next <stdlib.h>
>> ???? >>>> ????? |?????????????? ^~~~~~~~~~
>> ???? >>>> compilation terminated.
>> ???? >>>> make[2]: *** [apps/CMakeFiles/gdalsrsinfo.dir/build.make:76:
>> ???? >>>> apps/CMakeFiles/gdalsrsinfo.dir/gdalsrsinfo.cpp.o] Error 1
>> ???? >>>> make[1]: *** [CMakeFiles/Makefile2:10247:
>> ???? >>>> apps/CMakeFiles/gdalsrsinfo.dir/all] Error 2
>> ???? >>>> make: *** [Makefile:146: all] Error 2
>> ???? >>>>
>> ???? >>>> _______________________________________________
>> ???? >>>> gdal-dev mailing list
>> ???? >>>> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>> ???? >>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> ??? <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>> ???? >>>
>> ??? _______________________________________________
>> ??? gdal-dev mailing list
>> ??? gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>> ??? https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> ??? <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From gdt at lexort.com  Mon Jun 24 11:20:17 2024
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 24 Jun 2024 14:20:17 -0400
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com> (Scott via
 gdal-dev's message of "Mon, 24 Jun 2024 11:12:14 -0700")
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
 <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com>
Message-ID: <rmipls6qk2m.fsf@s1.lexort.com>

Scott via gdal-dev <gdal-dev at lists.osgeo.org> writes:

> #include_next is part of the c++ version 12. You can find it's usage
>  here on debian 12:
>
> /usr/include/c++/12/cstdlib, line 75

I think that's gcc 12, not C++12 which is not a thing :-)

It being used in an internal header supplied by the compiler is one
thing.  I do not understand how an include of stdlib in a user program
can do that sensibly.  It's supposed to mean that only things in the
include path after this file that was found, are to be searched.
That's very tricky and requires assumptions/checks about the include
order, and cmake does not seem to guarantee a lot in that department.


From gdt at lexort.com  Mon Jun 24 11:24:46 2024
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 24 Jun 2024 14:24:46 -0400
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <rmipls6qk2m.fsf@s1.lexort.com> (Greg Troxel via gdal-dev's
 message of "Mon, 24 Jun 2024 14:20:17 -0400")
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
 <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com>
 <rmipls6qk2m.fsf@s1.lexort.com>
Message-ID: <rmile2uqjv5.fsf@s1.lexort.com>

I egreped over the gdal 3.9.1rc2 sources and do not find this
include_next stdlib at all.

  $ egrep -R include_next.*stdlib .

Please explain where you think it is in the sources.

From bdezonia at gmail.com  Mon Jun 24 11:25:11 2024
From: bdezonia at gmail.com (Barry DeZonia)
Date: Mon, 24 Jun 2024 13:25:11 -0500
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <rmipls6qk2m.fsf@s1.lexort.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
 <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com>
 <rmipls6qk2m.fsf@s1.lexort.com>
Message-ID: <CAKcvfuS1KNAStT9ecj4reLvE=PwLehXtXke67+YcMT3jg6=gRA@mail.gmail.com>

Yeah, I didn't know about this pragma directive at all. A simple summary
about it is here (including disclaimers on use).

https://stackoverflow.com/questions/10261382/why-would-one-use-include-next-in-a-project

On Mon, Jun 24, 2024 at 1:20?PM Greg Troxel via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Scott via gdal-dev <gdal-dev at lists.osgeo.org> writes:
>
> > #include_next is part of the c++ version 12. You can find it's usage
> >  here on debian 12:
> >
> > /usr/include/c++/12/cstdlib, line 75
>
> I think that's gcc 12, not C++12 which is not a thing :-)
>
> It being used in an internal header supplied by the compiler is one
> thing.  I do not understand how an include of stdlib in a user program
> can do that sensibly.  It's supposed to mean that only things in the
> include path after this file that was found, are to be searched.
> That's very tricky and requires assumptions/checks about the include
> order, and cmake does not seem to guarantee a lot in that department.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240624/9c9a9f98/attachment.htm>

From public at postholer.com  Mon Jun 24 11:33:10 2024
From: public at postholer.com (Scott)
Date: Mon, 24 Jun 2024 11:33:10 -0700
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <rmile2uqjv5.fsf@s1.lexort.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
 <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com>
 <rmipls6qk2m.fsf@s1.lexort.com> <rmile2uqjv5.fsf@s1.lexort.com>
Message-ID: <a481a463-52cf-4e4b-9bca-d3ddf0fd9da5@postholer.com>

On debian 12:

/usr/include/c++/12/cstdlib, line 75. Context:

// Need to ensure this finds the C library's <stdlib.h> not a libstdc++
// wrapper that might already be installed later in the include search path.
#define _GLIBCXX_INCLUDE_NEXT_C_HEADERS
#include_next <stdlib.h>
#undef _GLIBCXX_INCLUDE_NEXT_C_HEADERS
#include <bits/std_abs.h>

...

On 6/24/24 11:24, Greg Troxel via gdal-dev wrote:
> I egreped over the gdal 3.9.1rc2 sources and do not find this
> include_next stdlib at all.
> 
>    $ egrep -R include_next.*stdlib .
> 
> Please explain where you think it is in the sources.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From gdt at lexort.com  Mon Jun 24 11:53:26 2024
From: gdt at lexort.com (Greg Troxel)
Date: Mon, 24 Jun 2024 14:53:26 -0400
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <a481a463-52cf-4e4b-9bca-d3ddf0fd9da5@postholer.com> (Scott via
 gdal-dev's message of "Mon, 24 Jun 2024 11:33:10 -0700")
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
 <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com>
 <rmipls6qk2m.fsf@s1.lexort.com> <rmile2uqjv5.fsf@s1.lexort.com>
 <a481a463-52cf-4e4b-9bca-d3ddf0fd9da5@postholer.com>
Message-ID: <rmih6diqijd.fsf@s1.lexort.com>

Scott via gdal-dev <gdal-dev at lists.osgeo.org> writes:

> On debian 12:
>
> /usr/include/c++/12/cstdlib, line 75. Context:
>
> // Need to ensure this finds the C library's <stdlib.h> not a libstdc++
> // wrapper that might already be installed later in the include search path.
> #define _GLIBCXX_INCLUDE_NEXT_C_HEADERS
> #include_next <stdlib.h>
> #undef _GLIBCXX_INCLUDE_NEXT_C_HEADERS
> #include <bits/std_abs.h>

Is this then a Debian/gcc12 bug?

From bdezonia at gmail.com  Mon Jun 24 12:07:36 2024
From: bdezonia at gmail.com (Barry DeZonia)
Date: Mon, 24 Jun 2024 14:07:36 -0500
Subject: [gdal-dev] Error linking srsinfo in 3.9.1 (rc1 or rc2)
In-Reply-To: <rmih6diqijd.fsf@s1.lexort.com>
References: <a9b64811-8192-4ff1-86c7-b2b7df42f852@postholer.com>
 <b1562e15-6b1e-4c98-b757-e674b6d7c9a8@spatialys.com>
 <9e9bc3cf-add0-4e61-bae9-bada19bc2563@postholer.com>
 <4e43dc5d-7756-41a1-a4c5-3a79bd990dec@spatialys.com>
 <56589860-30f1-439e-b580-ed7c6c3bf644@postholer.com>
 <CAKcvfuTRbYJvjBNddufTMzeOm+JaOUh_F8KOiN48WWbSoMA+hA@mail.gmail.com>
 <d49c51fe-9212-401a-beee-02dccd3d0b4a@postholer.com>
 <9b646feb-8f1e-444e-b5b9-28d4205a9035@postholer.com>
 <rmipls6qk2m.fsf@s1.lexort.com> <rmile2uqjv5.fsf@s1.lexort.com>
 <a481a463-52cf-4e4b-9bca-d3ddf0fd9da5@postholer.com>
 <rmih6diqijd.fsf@s1.lexort.com>
Message-ID: <CAKcvfuR1gZ=0x6o-ZEJhpztzeWQ9Wz6-p0MuPAtwm1QD3r4ruA@mail.gmail.com>

Greg, you might want to CC Evan into this email chain.

On Mon, Jun 24, 2024 at 1:53?PM Greg Troxel via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Scott via gdal-dev <gdal-dev at lists.osgeo.org> writes:
>
> > On debian 12:
> >
> > /usr/include/c++/12/cstdlib, line 75. Context:
> >
> > // Need to ensure this finds the C library's <stdlib.h> not a libstdc++
> > // wrapper that might already be installed later in the include search
> path.
> > #define _GLIBCXX_INCLUDE_NEXT_C_HEADERS
> > #include_next <stdlib.h>
> > #undef _GLIBCXX_INCLUDE_NEXT_C_HEADERS
> > #include <bits/std_abs.h>
>
> Is this then a Debian/gcc12 bug?
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240624/9c9ba586/attachment.htm>

From andrew at aitchison.me.uk  Tue Jun 25 06:14:45 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 25 Jun 2024 14:14:45 +0100 (BST)
Subject: [gdal-dev] testclosedondestroydm.test
Message-ID: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>


This is not a new failure, so thre is no need for this to hold up 3.9.1.

System: Ubuntu 24-04/Noble on Intel x86-64.
# ctest --output-on-failure

  ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ----

28/51 Test #28: test-closed-on-destroy-DM ........***Failed    0.19 sec
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from testclosedondestroydm
[ RUN      ] testclosedondestroydm.test
ERROR 4: /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif: No such file or directory
ERROR 3: Checksum value could not be computed due to I/O read error.
ERROR 4: /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/tmp/cache/file9_j2c.ntf: No such file or directory
Warning 1: byte3.tif: File open for read-only accessing, creating mask externally.
ERROR 4: `/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/sid/mercator.sid' 
not recognized as being in a supported file format.
unknown file: Failure
C++ exception with description "basic_string::_M_create" thrown in the test body.

[  FAILED  ] testclosedondestroydm.test (157 ms)
[----------] 1 test from testclosedondestroydm (157 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (157 ms total)
[  PASSED  ] 0 tests.
[  FAILED  ] 1 test, listed below:
[  FAILED  ] testclosedondestroydm.test

  1 FAILED TEST

  ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ----

Indeed
   /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif
does not exist, but
   /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/rgbsmall.tif
does.
(I cannot find a file9_j2c with any extension anywhere, but I guess it is supposed to be built at test time.)

Full ctest log at:
 	https://www.aitchison.me.uk/gdal/ctest.391.gnu.errlog

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Tue Jun 25 06:21:54 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Jun 2024 15:21:54 +0200
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
Message-ID: <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>

Can you run "gdb autotest/cpp/testclosedondestroydm" , "run" , and when 
it crashed "bt" so we have a backtrace of where it crashes? (all of that 
after running "source ../scripts/setdevenv.sh")

Le 25/06/2024 ? 15:14, Andrew C Aitchison via gdal-dev a ?crit?:
>
> This is not a new failure, so thre is no need for this to hold up 3.9.1.
>
> System: Ubuntu 24-04/Noble on Intel x86-64.
> # ctest --output-on-failure
>
> ?---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ----
>
> 28/51 Test #28: test-closed-on-destroy-DM ........***Failed 0.19 sec
> [==========] Running 1 test from 1 test suite.
> [----------] Global test environment set-up.
> [----------] 1 test from testclosedondestroydm
> [ RUN????? ] testclosedondestroydm.test
> ERROR 4: 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif: 
> No such file or directory
> ERROR 3: Checksum value could not be computed due to I/O read error.
> ERROR 4: 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/tmp/cache/file9_j2c.ntf: 
> No such file or directory
> Warning 1: byte3.tif: File open for read-only accessing, creating mask 
> externally.
> ERROR 4: 
> `/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/sid/mercator.sid' 
> not recognized as being in a supported file format.
> unknown file: Failure
> C++ exception with description "basic_string::_M_create" thrown in the 
> test body.
>
> [? FAILED? ] testclosedondestroydm.test (157 ms)
> [----------] 1 test from testclosedondestroydm (157 ms total)
>
> [----------] Global test environment tear-down
> [==========] 1 test from 1 test suite ran. (157 ms total)
> [? PASSED? ] 0 tests.
> [? FAILED? ] 1 test, listed below:
> [? FAILED? ] testclosedondestroydm.test
>
> ?1 FAILED TEST
>
> ?---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ----
>
> Indeed
> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif
> does not exist, but
> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/rgbsmall.tif
> does.
> (I cannot find a file9_j2c with any extension anywhere, but I guess it 
> is supposed to be built at test time.)
>
> Full ctest log at:
> ????https://www.aitchison.me.uk/gdal/ctest.391.gnu.errlog
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew at aitchison.me.uk  Tue Jun 25 07:25:55 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 25 Jun 2024 15:25:55 +0100 (BST)
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
 <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
Message-ID: <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>

On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:

> Can you run "gdb autotest/cpp/testclosedondestroydm" , "run" , and when it 
> crashed "bt" so we have a backtrace of where it crashes? (all of that after 
> running "source ../scripts/setdevenv.sh")

It doesn't crash:

(gdb) run
Starting program: 
/home/werdna/gdal/3.9.1/gdal-3.9.1.gnu/autotest/cpp/testclosedondestroydm
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from testclosedondestroydm
[ RUN      ] testclosedondestroydm.test
ERROR 4: /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif: No such file or directory
ERROR 3: Checksum value could not be computed due to I/O read error.
ERROR 4: /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/tmp/cache/file9_j2c.ntf: No such file or directory Warning 1: byte3.tif: File open for read-only accessing, creating mask externally.
ERROR 4: `/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/sid/mercator.sid' not recognized as being in a supported file format.
unknown file: Failure
C++ exception with description "basic_string::_M_create" thrown in the test body.

[  FAILED  ] testclosedondestroydm.test (112 ms)
[----------] 1 test from testclosedondestroydm (112 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (112 ms total)
[  PASSED  ] 0 tests.
[  FAILED  ] 1 test, listed below:
[  FAILED  ] testclosedondestroydm.test

  1 FAILED TEST
[Inferior 1 (process 889503) exited with code 01]
(gdb) bt
No stack.

----------------------------------------------------------

ln -s ../rgbsmall.tif autotest/gdrivers/data/dimap/rgbsmall.tif
 	gets rid of the lines:
ERROR 4: /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif: No such file or directory
ERROR 3: Checksum value could not be computed due to I/O read error.
 	but otherwise the same failures.

I do not have the MrSID SDK, so not recognizing mercator.sid is expected.

Would an strace be any use ? Any particular options ?


> Le 25/06/2024 ? 15:14, Andrew C Aitchison via gdal-dev a ?crit?:
>> 
>> This is not a new failure, so thre is no need for this to hold up 3.9.1.
>> 
>> System: Ubuntu 24-04/Noble on Intel x86-64.
>> # ctest --output-on-failure
>> 
>> ?---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ----
>> 
>> 28/51 Test #28: test-closed-on-destroy-DM ........***Failed 0.19 sec
>> [==========] Running 1 test from 1 test suite.
>> [----------] Global test environment set-up.
>> [----------] 1 test from testclosedondestroydm
>> [ RUN????? ] testclosedondestroydm.test
>> ERROR 4: 
>> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif: 
>> No such file or directory
>> ERROR 3: Checksum value could not be computed due to I/O read error.
>> ERROR 4: 
>> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/tmp/cache/file9_j2c.ntf: 
>> No such file or directory
>> Warning 1: byte3.tif: File open for read-only accessing, creating mask 
>> externally.
>> ERROR 4: 
>> `/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/sid/mercator.sid' 
>> not recognized as being in a supported file format.
>> unknown file: Failure
>> C++ exception with description "basic_string::_M_create" thrown in the test 
>> body.
>> 
>> [? FAILED? ] testclosedondestroydm.test (157 ms)
>> [----------] 1 test from testclosedondestroydm (157 ms total)
>> 
>> [----------] Global test environment tear-down
>> [==========] 1 test from 1 test suite ran. (157 ms total)
>> [? PASSED? ] 0 tests.
>> [? FAILED? ] 1 test, listed below:
>> [? FAILED? ] testclosedondestroydm.test
>> 
>> ?1 FAILED TEST
>> 
>> ?---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ---- 8< ----
>> 
>> Indeed
>> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/dimap/rgbsmall.tif
>> does not exist, but
>> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/rgbsmall.tif
>> does.
>> (I cannot find a file9_j2c with any extension anywhere, but I guess it is 
>> supposed to be built at test time.)
>> 
>> Full ctest log at:
>> ????https://www.aitchison.me.uk/gdal/ctest.391.gnu.errlog
>>

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Tue Jun 25 07:32:20 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Jun 2024 16:32:20 +0200
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
 <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
 <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>
Message-ID: <c1acd52c-1177-449d-93d3-1b573dbdadc6@spatialys.com>


Le 25/06/2024 ? 16:25, Andrew C Aitchison a ?crit?:
> On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:
>
>> Can you run "gdb autotest/cpp/testclosedondestroydm" , "run" , and 
>> when it crashed "bt" so we have a backtrace of where it crashes? (all 
>> of that after running "source ../scripts/setdevenv.sh")
>
> It doesn't crash:

Ah, the gtest framework must catch the exception. OK, so after starting 
gdb and before "run", type "catch throw", so that debugger stops when 
the exception is thrown, and then "bt"


>
> I do not have the MrSID SDK, so not recognizing mercator.sid is expected.

yes, a number of error messages in that test are expected depending on 
which drivers are there / not there, and will not make it fail. The 
FAILED you get is related to a unexpected C++ exception


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew at aitchison.me.uk  Tue Jun 25 07:52:35 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 25 Jun 2024 15:52:35 +0100 (BST)
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <c1acd52c-1177-449d-93d3-1b573dbdadc6@spatialys.com>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
 <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
 <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>
 <c1acd52c-1177-449d-93d3-1b573dbdadc6@spatialys.com>
Message-ID: <20479ef8-f23c-2f15-5420-31348584e701@aitchison.me.uk>

On Tue, 25 Jun 2024, Even Rouault wrote:

>
> Le 25/06/2024 ? 16:25, Andrew C Aitchison a ?crit?:
>> On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:
>> 
>>> Can you run "gdb autotest/cpp/testclosedondestroydm" , "run" , and when it 
>>> crashed "bt" so we have a backtrace of where it crashes? (all of that 
>>> after running "source ../scripts/setdevenv.sh")
>> 
>> It doesn't crash:
>
> Ah, the gtest framework must catch the exception. OK, so after starting gdb 
> and before "run", type "catch throw", so that debugger stops when the 
> exception is thrown, and then "bt"


#0  0x00007ffff4ebb0f1 in __cxxabiv1::__cxa_throw (obj=0x55555576b940,
     tinfo=0x7ffff17bb348 <typeinfo for osgeo::proj::io::FormattingException>,
     dest=0x7ffff15e2070 <osgeo::proj::io::FormattingException::~FormattingException()>)
     at ../../../../src/libstdc++-v3/libsupc++/eh_throw.cc:81
#1  0x00007ffff14b2c34 in osgeo::proj::operation::Conversion::_exportToPROJString (this=<optimized out>, formatter=0x55555576b330)
     at /usr/include/c++/13/bits/allocator.h:184
#2  0x00007ffff15e357d in osgeo::proj::io::IPROJStringExportable::exportToPROJString[abi:cxx11](osgeo::proj::io::PROJStringFormatter*) const (this=0x5555557797d8, formatter=0x55555576b330) at /usr/src/proj-9.4.0-1build2/src/iso19111/io.cpp:8306
#3  0x00007ffff165548c in pj_obj_create (ctx=0x5555556a0180, objIn=...) at /usr/src/proj-9.4.0-1build2/src/iso19111/c_api.cpp:201
#4  0x00007ffff1662633 in proj_create_conversion (ctx=0x5555556a0180, name=0x0, auth_name=<optimized out>, code=0x0,
     method_name=0x0, method_auth_name=0x0, method_code=0x0, param_count=0, params=0x0)
     at /usr/include/c++/13/bits/shared_ptr_base.h:1068
#5  0x00007ffff5f6585a in OGRSpatialReference::SetProjCS (this=0x7fffffffb750, pszName=0x555555773320 "NAD27 / UTM zone 11N")
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/ogr/ogrspatialreference.cpp:5548
#6  0x00007ffff615c359 in GTIFGetOGISDefnAsOSR (hGTIF=0x555555a063a0, psDefn=0x555555772f80)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gt_wkt_srs.cpp:856
#7  0x00007ffff60ffabe in GTiffDataset::LookForProjectionFromGeoTIFF (this=0x55555569f0e0)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:4149
#8  0x00007ffff60ff8b3 in GTiffDataset::LookForProjection (this=0x55555569f0e0)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:4096
#9  0x00007ffff61074e2 in GTiffDataset::GetSpatialRef (this=0x55555569f0e0)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:6179
#10 0x00007ffff72569cb in GDALProxyPoolDataset::Create (
     pszSourceDatasetDescription=0x555555765d90 "/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gcore/data/byte.tif",
     papszOpenOptionsIn=0x0, eAccessIn=GA_ReadOnly, bSharedIn=1, pszOwner=0x7fffffffcfb0 "0x55555569e798")
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdalproxypool.cpp:811
#11 0x00007ffff61b6943 in VRTSimpleSource::OpenSource (this=0x555555a27b70)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/vrt/vrtsources.cpp:720
#12 0x00007ffff61b6be5 in VRTSimpleSource::GetRasterBand (this=0x555555a27b70)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/vrt/vrtsources.cpp:774
#13 0x00007ffff61af01b in VRTSourcedRasterBand::SkipBufferInitialization (this=0x5555556a0ff0)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/vrt/vrtsourcedrasterband.cpp:1941
#14 0x00007ffff61a8b14 in VRTSourcedRasterBand::IRasterIO (this=0x5555556a0ff0, eRWFlag=GF_Read, nXOff=0, nYOff=0, nXSize=20,
     nYSize=20, pData=0x5555556e62c0, nBufXSize=20, nBufYSize=20, eBufType=GDT_Int32, nPixelSpace=4, nLineSpace=80,
     psExtraArg=0x7fffffffd230) at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/vrt/vrtsourcedrasterband.cpp:318
#15 0x00007ffff71f09f5 in GDALRasterBand::RasterIO (this=0x5555556a0ff0, eRWFlag=GF_Read, nXOff=0, nYOff=0, nXSize=20, nYSize=20,
     pData=0x5555556e62c0, nBufXSize=20, nBufYSize=20, eBufType=GDT_Int32, nPixelSpace=4, nLineSpace=80, psExtraArg=0x7fffffffd230)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdalrasterband.cpp:426
#16 0x00007ffff71f0ae0 in GDALRasterIO (hBand=0x5555556a0ff0, eRWFlag=GF_Read, nXOff=0, nYOff=0, nXSize=20, nYSize=20,
     pData=0x5555556e62c0, nBufXSize=20, nBufYSize=20, eBufType=GDT_Int32, nPixelSpace=0, nLineSpace=0)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdalrasterband.cpp:459
#17 0x00007ffff5e09311 in GDALChecksumImage (hBand=0x5555556a0ff0, nXOff=0, nYOff=0, nXSize=20, nYSize=20)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/alg/gdalchecksum.cpp:297
#18 0x0000555555565454 in (anonymous namespace)::testclosedondestroydm_test_Test::TestBody (this=0x5555555d44e0)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/cpp/testclosedondestroydm.cpp:108
#19 0x000055555559df0f in void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ()
#20 0x00005555555847c6 in testing::Test::Run() ()
#21 0x0000555555584985 in testing::TestInfo::Run() ()
#22 0x0000555555584b6f in testing::TestSuite::Run() ()
#23 0x00005555555929dc in testing::internal::UnitTestImpl::RunAllTests() ()
#24 0x000055555559e5e7 in bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ()
#25 0x0000555555584d68 in testing::UnitTest::Run() ()
#26 0x0000555555566ea4 in RUN_ALL_TESTS () at /usr/include/gtest/gtest.h:2317
#27 0x0000555555566dac in main (argc=1, argv=0x5555556017b0) at /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/cpp/main_gtest.cpp:55

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Tue Jun 25 07:58:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Jun 2024 16:58:48 +0200
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <20479ef8-f23c-2f15-5420-31348584e701@aitchison.me.uk>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
 <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
 <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>
 <c1acd52c-1177-449d-93d3-1b573dbdadc6@spatialys.com>
 <20479ef8-f23c-2f15-5420-31348584e701@aitchison.me.uk>
Message-ID: <ccfd1319-d69f-408f-a3e0-d3327a4d358b@spatialys.com>


Le 25/06/2024 ? 16:52, Andrew C Aitchison a ?crit?:
> On Tue, 25 Jun 2024, Even Rouault wrote:
>
>>
>> Le 25/06/2024 ? 16:25, Andrew C Aitchison a ?crit?:
>>> On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:
>>>
>>>> Can you run "gdb autotest/cpp/testclosedondestroydm" , "run" , and 
>>>> when it crashed "bt" so we have a backtrace of where it crashes 
>>>> (all of that after running "source ../scripts/setdevenv.sh")
>>>
>>> It doesn't crash:
>>
>> Ah, the gtest framework must catch the exception. OK, so after 
>> starting gdb and before "run", type "catch throw", so that debugger 
>> stops when the exception is thrown, and then "bt"

Ok, those that occur in PROJ are expected and not fatal. Go on with 
"cont" (you may need to skip another one occurring in 
proj_crs_get_coordoperation())


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew at aitchison.me.uk  Tue Jun 25 09:42:36 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 25 Jun 2024 17:42:36 +0100 (BST)
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <ccfd1319-d69f-408f-a3e0-d3327a4d358b@spatialys.com>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
 <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
 <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>
 <c1acd52c-1177-449d-93d3-1b573dbdadc6@spatialys.com>
 <20479ef8-f23c-2f15-5420-31348584e701@aitchison.me.uk>
 <ccfd1319-d69f-408f-a3e0-d3327a4d358b@spatialys.com>
Message-ID: <93108648-e4d0-8453-ff21-71a4e4ca0f79@aitchison.me.uk>

On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:

> Le 25/06/2024 ? 16:52, Andrew C Aitchison a ?crit?:
>> On Tue, 25 Jun 2024, Even Rouault wrote:
>> 
>>> 
>>> Le 25/06/2024 ? 16:25, Andrew C Aitchison a ?crit?:
>>>> On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:
>>>> 
>>>>> Can you run "gdb autotest/cpp/testclosedondestroydm" , "run" , and when 
>>>>> it crashed "bt" so we have a backtrace of where it crashes (all of that 
>>>>> after running "source ../scripts/setdevenv.sh")
>>>> 
>>>> It doesn't crash:
>>> 
>>> Ah, the gtest framework must catch the exception. OK, so after starting 
>>> gdb and before "run", type "catch throw", so that debugger stops when the 
>>> exception is thrown, and then "bt"
>
> Ok, those that occur in PROJ are expected and not fatal. Go on with "cont" 
> (you may need to skip another one occurring in proj_crs_get_coordoperation())

This is the exception after proj_crs_get_coordoperation()
(I also scripted backtraces after every exception until the run completes;
at https://www.aitchison.me.uk/gdal/gdb.testclosedondestroydm ):

(gdb) cont
Continuing.

Catchpoint 1 (exception thrown), 0x00007ffff4ebb0f1 in __cxa_throw () from /lib/x86_64-linux-gnu/libstdc++.so.6
(gdb) bt
#0  0x00007ffff4ebb0f1 in __cxa_throw () from /lib/x86_64-linux-gnu/libstdc++.so.6
#1  0x00007ffff14b2c34 in ?? () from /lib/x86_64-linux-gnu/libproj.so.25
#2  0x00007ffff15e357d in osgeo::proj::io::IPROJStringExportable::exportToPROJString[abi:cxx11](osgeo::proj::io::PROJStringFormatter*) const ()
    from /lib/x86_64-linux-gnu/libproj.so.25
#3  0x00007ffff165548c in ?? () from /lib/x86_64-linux-gnu/libproj.so.25
#4  0x00007ffff1662633 in proj_create_conversion () from /lib/x86_64-linux-gnu/libproj.so.25
#5  0x00007ffff5f6585a in OGRSpatialReference::SetProjCS (this=0x7fffffffb800, pszName=0x555555cfc180 "NAD27 / UTM zone 11N")
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/ogr/ogrspatialreference.cpp:5548
#6  0x00007ffff615c359 in GTIFGetOGISDefnAsOSR (hGTIF=0x555555b84150, psDefn=0x555555a34720) at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gt_wkt_srs.cpp:856
#7  0x00007ffff60ffabe in GTiffDataset::LookForProjectionFromGeoTIFF (this=0x555555cfb190) at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:4149
#8  0x00007ffff60ff8b3 in GTiffDataset::LookForProjection (this=0x555555cfb190) at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:4096
#9  0x00007ffff61074e2 in GTiffDataset::GetSpatialRef (this=0x555555cfb190) at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:6179
#10 0x00007ffff71d98a0 in GDALDataset::GetProjectionRef (this=0x555555cfb190) at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldataset.cpp:1148
#11 0x00007ffff64151f2 in TILDataset::Open (poOpenInfo=0x7fffffffd310) at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/til/tildataset.cpp:326
#12 0x00007ffff71c45c1 in GDALDriver::Open (this=0x5555556259b0, poOpenInfo=0x7fffffffd310, bSetOpenOptions=false) at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldriver.cpp:116
#13 0x00007ffff71ddf25 in GDALOpenEx (pszFilename=0x5555555a02d8 "/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/til/testtil.til", nOpenFlags=66,
     papszAllowedDrivers=0x0, papszOpenOptions=0x0, papszSiblingFiles=0x0) at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldataset.cpp:3780
#14 0x00007ffff71dd2a2 in GDALOpen (pszFilename=0x5555555a02d8 "/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/til/testtil.til", eAccess=GA_ReadOnly)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldataset.cpp:3441
#15 0x0000555555565548 in (anonymous namespace)::testclosedondestroydm_test_Test::TestBody (this=0x5555555d44e0)
     at /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/cpp/testclosedondestroydm.cpp:125
#16 0x000055555559df0f in void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ()
#17 0x00005555555847c6 in testing::Test::Run() ()
#18 0x0000555555584985 in testing::TestInfo::Run() ()
#19 0x0000555555584b6f in testing::TestSuite::Run() ()
#20 0x00005555555929dc in testing::internal::UnitTestImpl::RunAllTests() ()
#21 0x000055555559e5e7 in bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ()
#22 0x0000555555584d68 in testing::UnitTest::Run() ()
#23 0x0000555555566ea4 in RUN_ALL_TESTS () at /usr/include/gtest/gtest.h:2317
#24 0x0000555555566dac in main (argc=1, argv=0x5555556017b0) at /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/cpp/main_gtest.cpp:55


-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Tue Jun 25 09:59:17 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 25 Jun 2024 18:59:17 +0200
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <93108648-e4d0-8453-ff21-71a4e4ca0f79@aitchison.me.uk>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
 <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
 <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>
 <c1acd52c-1177-449d-93d3-1b573dbdadc6@spatialys.com>
 <20479ef8-f23c-2f15-5420-31348584e701@aitchison.me.uk>
 <ccfd1319-d69f-408f-a3e0-d3327a4d358b@spatialys.com>
 <93108648-e4d0-8453-ff21-71a4e4ca0f79@aitchison.me.uk>
Message-ID: <a1b1a2a2-76be-4d95-822d-fec01cbe149f@spatialys.com>

ok, so the exception occurs in the embedded copy of tinyxml inside the 
ECW SDK ?

You likely need to apply those community patches to your libecwjp2 3.3 
sources: 
https://github.com/rouault/libecwj2-3.3-builds/blob/main/libecwj2-3.3.patch

Le 25/06/2024 ? 18:42, Andrew C Aitchison a ?crit?:
> On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:
>
>> Le 25/06/2024 ? 16:52, Andrew C Aitchison a ?crit?:
>>> On Tue, 25 Jun 2024, Even Rouault wrote:
>>>
>>>>
>>>> Le 25/06/2024 ? 16:25, Andrew C Aitchison a ?crit?:
>>>>> On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:
>>>>>
>>>>>> Can you run "gdb autotest/cpp/testclosedondestroydm" , "run" , 
>>>>>> and when it crashed "bt" so we have a backtrace of where it 
>>>>>> crashes (all of that after running "source ../scripts/setdevenv.sh")
>>>>>
>>>>> It doesn't crash:
>>>>
>>>> Ah, the gtest framework must catch the exception. OK, so after 
>>>> starting gdb and before "run", type "catch throw", so that debugger 
>>>> stops when the exception is thrown, and then "bt"
>>
>> Ok, those that occur in PROJ are expected and not fatal. Go on with 
>> "cont" (you may need to skip another one occurring in 
>> proj_crs_get_coordoperation())
>
> This is the exception after proj_crs_get_coordoperation()
> (I also scripted backtraces after every exception until the run 
> completes;
> at https://www.aitchison.me.uk/gdal/gdb.testclosedondestroydm ):
>
> (gdb) cont
> Continuing.
>
> Catchpoint 1 (exception thrown), 0x00007ffff4ebb0f1 in __cxa_throw () 
> from /lib/x86_64-linux-gnu/libstdc++.so.6
> (gdb) bt
> #0? 0x00007ffff4ebb0f1 in __cxa_throw () from 
> /lib/x86_64-linux-gnu/libstdc++.so.6
> #1? 0x00007ffff14b2c34 in ?? () from /lib/x86_64-linux-gnu/libproj.so.25
> #2? 0x00007ffff15e357d in 
> osgeo::proj::io::IPROJStringExportable::exportToPROJString[abi:cxx11](osgeo::proj::io::PROJStringFormatter*) 
> const ()
> ?? from /lib/x86_64-linux-gnu/libproj.so.25
> #3? 0x00007ffff165548c in ?? () from /lib/x86_64-linux-gnu/libproj.so.25
> #4? 0x00007ffff1662633 in proj_create_conversion () from 
> /lib/x86_64-linux-gnu/libproj.so.25
> #5? 0x00007ffff5f6585a in OGRSpatialReference::SetProjCS 
> (this=0x7fffffffb800, pszName=0x555555cfc180 "NAD27 / UTM zone 11N")
> ??? at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/ogr/ogrspatialreference.cpp:5548
> #6? 0x00007ffff615c359 in GTIFGetOGISDefnAsOSR (hGTIF=0x555555b84150, 
> psDefn=0x555555a34720) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gt_wkt_srs.cpp:856
> #7? 0x00007ffff60ffabe in GTiffDataset::LookForProjectionFromGeoTIFF 
> (this=0x555555cfb190) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:4149
> #8? 0x00007ffff60ff8b3 in GTiffDataset::LookForProjection 
> (this=0x555555cfb190) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:4096
> #9? 0x00007ffff61074e2 in GTiffDataset::GetSpatialRef 
> (this=0x555555cfb190) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/gtiff/gtiffdataset_read.cpp:6179
> #10 0x00007ffff71d98a0 in GDALDataset::GetProjectionRef 
> (this=0x555555cfb190) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldataset.cpp:1148
> #11 0x00007ffff64151f2 in TILDataset::Open (poOpenInfo=0x7fffffffd310) 
> at /home/werdna/gdal/3.9.1/gdal-3.9.1/frmts/til/tildataset.cpp:326
> #12 0x00007ffff71c45c1 in GDALDriver::Open (this=0x5555556259b0, 
> poOpenInfo=0x7fffffffd310, bSetOpenOptions=false) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldriver.cpp:116
> #13 0x00007ffff71ddf25 in GDALOpenEx (pszFilename=0x5555555a02d8 
> "/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/til/testtil.til", 
> nOpenFlags=66,
> ??? papszAllowedDrivers=0x0, papszOpenOptions=0x0, 
> papszSiblingFiles=0x0) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldataset.cpp:3780
> #14 0x00007ffff71dd2a2 in GDALOpen (pszFilename=0x5555555a02d8 
> "/home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/gdrivers/data/til/testtil.til", 
> eAccess=GA_ReadOnly)
> ??? at /home/werdna/gdal/3.9.1/gdal-3.9.1/gcore/gdaldataset.cpp:3441
> #15 0x0000555555565548 in (anonymous 
> namespace)::testclosedondestroydm_test_Test::TestBody 
> (this=0x5555555d44e0)
> ??? at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/cpp/testclosedondestroydm.cpp:125
> #16 0x000055555559df0f in void 
> testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, 
> void>(testing::Test*, void (testing::Test::*)(), char const*) ()
> #17 0x00005555555847c6 in testing::Test::Run() ()
> #18 0x0000555555584985 in testing::TestInfo::Run() ()
> #19 0x0000555555584b6f in testing::TestSuite::Run() ()
> #20 0x00005555555929dc in 
> testing::internal::UnitTestImpl::RunAllTests() ()
> #21 0x000055555559e5e7 in bool 
> testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, 
> bool>(testing::internal::UnitTestImpl*, bool 
> (testing::internal::UnitTestImpl::*)(), char const*) ()
> #22 0x0000555555584d68 in testing::UnitTest::Run() ()
> #23 0x0000555555566ea4 in RUN_ALL_TESTS () at 
> /usr/include/gtest/gtest.h:2317
> #24 0x0000555555566dac in main (argc=1, argv=0x5555556017b0) at 
> /home/werdna/gdal/3.9.1/gdal-3.9.1/autotest/cpp/main_gtest.cpp:55
>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From ashlyn.powell at blewinc.com  Tue Jun 25 12:55:04 2024
From: ashlyn.powell at blewinc.com (Ashlyn Powell)
Date: Tue, 25 Jun 2024 14:55:04 -0500
Subject: [gdal-dev] GDAL & CAD Files
Message-ID: <CAMw0XXgdWw2=D3FNbHtg3V_0pVDb2SwvaaC1VQ-nCs5gAjuV=w@mail.gmail.com>

Hello GDAL Devs,

I am new to using GDAL, and I just don't know enough about it yet.  I am
working with thousands of CAD files (DWG) to extract a project boundary
line then export it out as a KML. I would love to automate this process.
Does GDAL have the capability to work with DWG files? Has anyone attempted
this?    A problem I could see happening is the projection not being set up
correctly, and all of them exported boundary lines showing up in the ocean.

Any pointers are much appreciated! I thank you all for your time.

Thank you,
-- 
Ashlyn Powell
GIS Analyst | GIS
ashlyn.powell at blewinc.com <ashlyn.haynes at blewinc.com>
888-933-2111 <8889332111>
www.blewinc.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240625/708b3878/attachment.htm>

From schwehr at gmail.com  Tue Jun 25 13:03:18 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 25 Jun 2024 13:03:18 -0700
Subject: [gdal-dev] GDAL & CAD Files
In-Reply-To: <CAMw0XXgdWw2=D3FNbHtg3V_0pVDb2SwvaaC1VQ-nCs5gAjuV=w@mail.gmail.com>
References: <CAMw0XXgdWw2=D3FNbHtg3V_0pVDb2SwvaaC1VQ-nCs5gAjuV=w@mail.gmail.com>
Message-ID: <CACmBxytFW0SkXFVeQFHWXEMv9N6=rGtKdYXF6jYXDTEN8iV75A@mail.gmail.com>

https://gdal.org/drivers/vector/dwg.html says:

> DWG files are considered to have no georeferencing information through OGR

>From https://gdal.org/programs/ogr2ogr.html, you will need to specify the
spatial reference system / projection with "-s_srs"

-Kurt

On Tue, Jun 25, 2024 at 12:55?PM Ashlyn Powell via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hello GDAL Devs,
>
> I am new to using GDAL, and I just don't know enough about it yet.  I am
> working with thousands of CAD files (DWG) to extract a project boundary
> line then export it out as a KML. I would love to automate this process.
> Does GDAL have the capability to work with DWG files? Has anyone attempted
> this?    A problem I could see happening is the projection not being set up
> correctly, and all of them exported boundary lines showing up in the ocean.
>
> Any pointers are much appreciated! I thank you all for your time.
>
> Thank you,
> --
> Ashlyn Powell
> GIS Analyst | GIS
> ashlyn.powell at blewinc.com <ashlyn.haynes at blewinc.com>
> 888-933-2111 <8889332111>
> www.blewinc.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240625/8ec691f0/attachment.htm>

From michkowalczuk at gmail.com  Tue Jun 25 13:11:26 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Tue, 25 Jun 2024 22:11:26 +0200
Subject: [gdal-dev] GDAL & CAD Files
In-Reply-To: <CACmBxytFW0SkXFVeQFHWXEMv9N6=rGtKdYXF6jYXDTEN8iV75A@mail.gmail.com>
References: <CAMw0XXgdWw2=D3FNbHtg3V_0pVDb2SwvaaC1VQ-nCs5gAjuV=w@mail.gmail.com>
 <CACmBxytFW0SkXFVeQFHWXEMv9N6=rGtKdYXF6jYXDTEN8iV75A@mail.gmail.com>
Message-ID: <CAP+FqQCyRjtyzmuADJgG+5YA1GieD2iZYZmgJb0yL8xbK5r45Q@mail.gmail.com>

First of all, the dwg format is only available in gdal if you buy ODA SDK
which is very expensive. To omit this you can switch to DXF format which is
built-in by default in gdal.

https://www.opendesign.com/pricing
https://gdal.org/drivers/vector/dxf.html

Regards,
Michal

W dniu wt., 25.06.2024 o 22:04 Kurt Schwehr via gdal-dev <
gdal-dev at lists.osgeo.org> napisa?(a):

> https://gdal.org/drivers/vector/dwg.html says:
>
> > DWG files are considered to have no georeferencing information through
> OGR
>
> From https://gdal.org/programs/ogr2ogr.html, you will need to specify the
> spatial reference system / projection with "-s_srs"
>
> -Kurt
>
> On Tue, Jun 25, 2024 at 12:55?PM Ashlyn Powell via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hello GDAL Devs,
>>
>> I am new to using GDAL, and I just don't know enough about it yet.  I am
>> working with thousands of CAD files (DWG) to extract a project boundary
>> line then export it out as a KML. I would love to automate this process.
>> Does GDAL have the capability to work with DWG files? Has anyone attempted
>> this?    A problem I could see happening is the projection not being set up
>> correctly, and all of them exported boundary lines showing up in the ocean.
>>
>> Any pointers are much appreciated! I thank you all for your time.
>>
>> Thank you,
>> --
>> Ashlyn Powell
>> GIS Analyst | GIS
>> ashlyn.powell at blewinc.com <ashlyn.haynes at blewinc.com>
>> 888-933-2111 <8889332111>
>> www.blewinc.com
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240625/ea707c56/attachment.htm>

From andrew at aitchison.me.uk  Tue Jun 25 13:26:42 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 25 Jun 2024 21:26:42 +0100 (BST)
Subject: [gdal-dev] testclosedondestroydm.test
In-Reply-To: <a1b1a2a2-76be-4d95-822d-fec01cbe149f@spatialys.com>
References: <0642b1eb-6a1f-4137-3ba7-133b67093be5@aitchison.me.uk>
 <4e06f5d9-f625-4647-bffe-9e767dc92552@spatialys.com>
 <284a8173-fd44-dad5-bf8d-09a5ab52cd99@aitchison.me.uk>
 <c1acd52c-1177-449d-93d3-1b573dbdadc6@spatialys.com>
 <20479ef8-f23c-2f15-5420-31348584e701@aitchison.me.uk>
 <ccfd1319-d69f-408f-a3e0-d3327a4d358b@spatialys.com>
 <93108648-e4d0-8453-ff21-71a4e4ca0f79@aitchison.me.uk>
 <a1b1a2a2-76be-4d95-822d-fec01cbe149f@spatialys.com>
Message-ID: <364c8081-45e0-1a41-7527-2af3b8fdfb70@aitchison.me.uk>

On Tue, 25 Jun 2024, Even Rouault via gdal-dev wrote:

> ok, so the exception occurs in the embedded copy of tinyxml inside the ECW 
> SDK ?
>
> You likely need to apply those community patches to your libecwjp2 3.3 
> sources: 
> https://github.com/rouault/libecwj2-3.3-builds/blob/main/libecwj2-3.3.patch

Thanks. That worked.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From robert.coup at koordinates.com  Wed Jun 26 03:15:39 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Wed, 26 Jun 2024 11:15:39 +0100
Subject: [gdal-dev] GDAL & CAD Files
In-Reply-To: <CAP+FqQCyRjtyzmuADJgG+5YA1GieD2iZYZmgJb0yL8xbK5r45Q@mail.gmail.com>
References: <CAMw0XXgdWw2=D3FNbHtg3V_0pVDb2SwvaaC1VQ-nCs5gAjuV=w@mail.gmail.com>
 <CACmBxytFW0SkXFVeQFHWXEMv9N6=rGtKdYXF6jYXDTEN8iV75A@mail.gmail.com>
 <CAP+FqQCyRjtyzmuADJgG+5YA1GieD2iZYZmgJb0yL8xbK5r45Q@mail.gmail.com>
Message-ID: <CAFLLRp+7WMiY4JXJuj4hdKiMHb8+k=HP_DcraP5-TTi7noMZxQ@mail.gmail.com>

Hi,

On Tue, 25 Jun 2024 at 21:11, Micha? Kowalczuk via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> First of all, the dwg format is only available in gdal if you buy ODA SDK
> which is very expensive.
>

There is also an in-house-use license available for ODA
https://www.opendesign.com/pricing/individual

Alternatively, there are a number of tools that do DWG-to-DXF pipeline, and
then as Michal suggested you could then pass the DXF into GDAL. IME it very
much depends on the complexity of the drawings and the autocad features in
use.

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240626/33d506d7/attachment-0001.htm>

From even.rouault at spatialys.com  Wed Jun 26 04:15:12 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Jun 2024 13:15:12 +0200
Subject: [gdal-dev] GDAL 3.9.1 RC2 is available, and motion to approve it
In-Reply-To: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
References: <d3f7d290-5bd4-427a-818d-e5bb36e6d311@spatialys.com>
Message-ID: <de02aae2-279d-484b-af79-3a4ad64ac9f3@spatialys.com>

Motion passed with +1 from PSC members: JukkaR, TamasS, HowardB, JJShaw 
and me

Le 23/06/2024 ? 00:13, Even Rouault via gdal-dev a ?crit?:
> I've issued a 2nd release candidate for 3.9.1 with the following 
> additional fixes:
> - GDALSieveFilter(): avoid assert() when all pixels are masked (3.9.0 
> regression)
> ? (raster/rasterio#3101)
> - Overview generation: fix multi-threaded bug, resulting in 
> locks/crashes with
> ? GeoPackage in particular (#10245)
> - VRT: fix serialization of separatable kernel in 
> VRTKernelFilteredSource (#10253)
> - Zarr: SerializeNumericNoData(): use CPLJSonObject::Add(uint64_t) to 
> avoid potential
> ? undefined behavior casts
> - OGR SQL: fix crash when the ON expression of a JOIN contains OGR 
> special
> ? fields (in particular feature id)
> - OGR layer algebra: honour PROMOTE_TO_MULTI=YES for Points
> - OGRFeature::SetField(int, double): avoid UndefinedBehavior when 
> passing NaN
> - OGRFeature::SetField(int, GIntBig): avoid UndefinedBehavior when 
> passing value
> ? close to INT64_MAX
> - OGRLayer::WriteArrowBatch(): avoid UndefinedBehavior when trying to 
> convert
> ? NaN to Int64
> - GeoParquet: always write version=1.1.0
> - SQLite/GPKG: detect UNIQUE constraints expressed as a ', CONSTRAINT 
> name UNIQUE (column_name)'
> ? at the end of CREATE TABLE (qgis/QGIS#57823)
> - GDALRasterBand::ComputeStatistics(): fix bad progress percentage 
> computation (3.9.1rc1 regression)
> - OGRSpatialReference::importFromUSGS(): avoid out-of-bounds access to 
> array (3.9.1rc1 regression)
>
> Pick up an archive among the following ones (by ascending size):
>
> ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.xz
> ? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1rc2.tar.gz
> ? https://download.osgeo.org/gdal/3.9.1/gdal391rc2.zip
>
> A snapshot of the gdalautotest suite is also available:
>
> https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.tar.gz
> ? https://download.osgeo.org/gdal/3.9.1/gdalautotest-3.9.1rc2.zip
>
> The NEWS file is here:
>
> ?? https://github.com/OSGeo/gdal/blob/v3.9.1RC2/NEWS.md
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Jun 26 04:53:12 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Jun 2024 13:53:12 +0200
Subject: [gdal-dev] GDAL 3.9.1 is released
Message-ID: <2bad3cde-cd62-4981-b64f-c618e04105da@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the 
release of the GDAL/OGR 3.9.1 bug fix version.

Consult the release notes for the list of issues addressed:
 ??? https://github.com/OSGeo/gdal/blob/v3.9.1/NEWS.md

The sources are available at:

 ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.xz
 ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.xz.md5
 ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.xz.sig

or

 ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.gz
 ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.gz.md5
 ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.gz.sig

or

 ??? https://download.osgeo.org/gdal/3.9.1/gdal391.zip
 ??? https://download.osgeo.org/gdal/3.9.1/gdal391.zip.md5
 ??? https://download.osgeo.org/gdal/3.9.1/gdal391.zip.sig

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From nyall.dawson at gmail.com  Wed Jun 26 16:19:11 2024
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Thu, 27 Jun 2024 09:19:11 +1000
Subject: [gdal-dev] Anyway to embed credential options into a VRT?
Message-ID: <CAB28Asi2eixAhjYRsCkG+fHFYr3pp8gcVskx6Mh+8uwc6AtwOg@mail.gmail.com>

Hi list,

Reading through the vrt schema, I see that there's currently support
for open options for sources, but I can't see any support documented
for VSI credential options.

Has this been considered in the past? I'm unsure if it's an omission
by design (i.e. preventing plain text storage of credentials in a VRT)
or a feature request...

Nyall

From even.rouault at spatialys.com  Wed Jun 26 16:45:09 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 27 Jun 2024 01:45:09 +0200
Subject: [gdal-dev] Anyway to embed credential options into a VRT?
In-Reply-To: <CAB28Asi2eixAhjYRsCkG+fHFYr3pp8gcVskx6Mh+8uwc6AtwOg@mail.gmail.com>
References: <CAB28Asi2eixAhjYRsCkG+fHFYr3pp8gcVskx6Mh+8uwc6AtwOg@mail.gmail.com>
Message-ID: <89f2e979-3bdb-4183-895b-a56cce6e4aed@spatialys.com>

Hi Nyall,

> Reading through the vrt schema, I see that there's currently support
> for open options for sources, but I can't see any support documented
> for VSI credential options.
>
> Has this been considered in the past?
not that I'm aware of
>   I'm unsure if it's an omission
> by design (i.e. preventing plain text storage of credentials in a VRT)
> or a feature request...

Some analysis should be done because there might *potentially* be a 
security impact in doing that (besides just leaking secrets).

I'm cautious because defining general configuration options has 
definitely a security impact . For example if you would allow to define 
the GDAL_VRT_ENABLE_PYTHON configuration option in a VRT, that would 
allow arbitrary Python code to be executed, which is a big no no, since 
we want to be able to read safely untrusted VRTs, hence we can't 
currently set configuration option in a VRT, and we shouldn't allow that 
(or that would require restricting to a safe subset). Even allowing 
setting CPL_TMPDIR could have some bad impacts, and possibly other 
configuration options setting paths.

That said, on first examination of the places in the code where we call 
VSIGetPathSpecificOption (only in the /vsi virtual file system) and the 
type of parameter they read, and I don't think any of them would have 
major security impact like arbitrary code execution. Obviously if a user 
would set a secret there, it should be obvious that they must not share 
their VRT.

A somewhat related functionality is the possibility to specify path 
specific options in the GDAL configuration file. Cf end of paragraph of 
https://gdal.org/user/configoptions.html#gdal-configuration-file . That 
might help at least for personal use cases.

What kind of scenario do you have in mind? Sharing a VRT with sources 
that use AWS_NO_SIGN_REQUEST=YES ?

I would say if we'd allow to set path specific option in a VRT it would 
probably be prudent to restrict them to a allow-list to be on the safe 
side. Although that would be a bit annoying to maintain because each 
time one would introduce a new path specific option, one should extend 
the allow-list with it

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.


From nyall.dawson at gmail.com  Wed Jun 26 17:09:26 2024
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Thu, 27 Jun 2024 10:09:26 +1000
Subject: [gdal-dev] Anyway to embed credential options into a VRT?
In-Reply-To: <89f2e979-3bdb-4183-895b-a56cce6e4aed@spatialys.com>
References: <CAB28Asi2eixAhjYRsCkG+fHFYr3pp8gcVskx6Mh+8uwc6AtwOg@mail.gmail.com>
 <89f2e979-3bdb-4183-895b-a56cce6e4aed@spatialys.com>
Message-ID: <CAB28AsjZ-T9M0JUj1CHvtzyd5fDOL2hKz6ZbMKjnaMmL_7kiJA@mail.gmail.com>

On Thu, 27 Jun 2024 at 09:45, Even Rouault <even.rouault at spatialys.com> wrote:
>
> Hi Nyall,
>
> > Reading through the vrt schema, I see that there's currently support
> > for open options for sources, but I can't see any support documented
> > for VSI credential options.
> >
> > Has this been considered in the past?
> not that I'm aware of
> >   I'm unsure if it's an omission
> > by design (i.e. preventing plain text storage of credentials in a VRT)
> > or a feature request...
>
> Some analysis should be done because there might *potentially* be a
> security impact in doing that (besides just leaking secrets).

Ok, that was my gut feeling, so thanks for the confirmation!

> What kind of scenario do you have in mind? Sharing a VRT with sources
> that use AWS_NO_SIGN_REQUEST=YES ?

I can imagine that there's potentially a use case for internal use
within an organisation with some sensitive, organisation wide
credentials embedded. But allowing the various *_NO_SIGN_REQUEST
options would easily be the most common use case (and should(?!) come
with no security concerns).

>
> I would say if we'd allow to set path specific option in a VRT it would
> probably be prudent to restrict them to a allow-list to be on the safe
> side. Although that would be a bit annoying to maintain because each
> time one would introduce a new path specific option, one should extend
> the allow-list with it

That'd be a compelling argument to supporting *_NO_SIGN_REQUEST only.

Thanks for the insights!

Nyall

>
> Even
>
> --
>
> http://www.spatialys.com
> My software is free, but my time generally not.
>

From howard at hobu.co  Thu Jun 27 09:05:27 2024
From: howard at hobu.co (Howard Butler)
Date: Thu, 27 Jun 2024 11:05:27 -0500
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
Message-ID: <FBA9AFD4-A774-4D15-8975-0BDA7A91B2F4@hobu.co>

Howard Butler, Even Rouault, Dan Baston, and Javier Jimenez Shaw held the monthly GDAL Maintainers Meeting on 06/27/2024. The following items were discussed and reported upon:

Discussion Items
----------------------------

* GDAL 3.9.1 was released on June 26th, 2024. A synopsis of the additions, changes, bug fixes, and enhancements is available from https://github.com/OSGeo/gdal/blob/release/3.9/NEWS.md
* Completing migration of GDAL's documentation to ReadTheDocs infrastructure was discussed. The PR implementing it will be refreshed and users are encouraged to to visit https://gdal.readthedocs.io/ and report any issues or findings about it on the PR at https://github.com/OSGeo/gdal/pull/8681 
* The PR to include Nix build configuration in the GDAL tree was submitted by Ivan Mincik https://github.com/OSGeo/gdal/pull/10309 was discussed.
* Howard has been communicating with the company responsible for the MrSID DSK and was told there will no more builds provided. "I wanted to follow up and let you know that we understand the importance of this matter to you but after careful consideration, our leadership team has made the decision not to proceed with any updates to the SDK at this time." It is unclear if this means no MrSID builds at all or just for now, but given the current build's age and compiler support matrix, it is likely to become a significant data access issue for many with GDAL going forward.
* Microsoft has renewed their gold sponsorship for FY24. Thank you Microsoft for your continued support of the GDAL Sponsorship Program!

Maintenance activities update
------------------------------------------

Dan

* NASA proposal for next three years submitted
* Reviewed PRs
* Finished moving leftover content from Trac in preparation for decomissioning
* Discussed RAII enhancements and potential public API impacts of implementation

Even

* 90+ ticket traffic and PR reviews
* Made a driver pass to relax identification criteria when -if is used to help driver prefixing and partial bypass of co-implemented drivers such as JSON/GeoJSON or HDF/NetCDF
* Spent a lot of time investigating and working around GitHub CI Windows SDK issues and breakage caused by DLL Hell https://github.com/actions/runner-images/issues/10004 
* Implemented support to allow building some drivers entirely STANDALONE against out-of-tree GDAL libraries
* See you at FOSS4GE!

Javier

* See you at FOSS4GE!

The next GDAL Maintainers Meeting is 07/25/2024 at 13:00 UTC. Any GDAL PR contributors are welcome to join by reaching out to me for an invite.

Howard

From even.rouault at spatialys.com  Thu Jun 27 14:28:47 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 27 Jun 2024 23:28:47 +0200
Subject: [gdal-dev] GDAL 3.9.1 is released
In-Reply-To: <2bad3cde-cd62-4981-b64f-c618e04105da@spatialys.com>
References: <2bad3cde-cd62-4981-b64f-c618e04105da@spatialys.com>
Message-ID: <e122396f-3ff3-47f8-af85-5dcc736ae466@spatialys.com>

The Docker images are now available: 
https://github.com/OSGeo/gdal/tree/master/docker#images-of-releases

Even

Le 26/06/2024 ? 13:53, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> On behalf of the GDAL/OGR development team, I am pleased to announce 
> the release of the GDAL/OGR 3.9.1 bug fix version.
>
> Consult the release notes for the list of issues addressed:
> ??? https://github.com/OSGeo/gdal/blob/v3.9.1/NEWS.md
>
> The sources are available at:
>
> ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.xz
> ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.xz.md5
> ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.xz.sig
>
> or
>
> ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.gz
> ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.gz.md5
> ??? https://download.osgeo.org/gdal/3.9.1/gdal-3.9.1.tar.gz.sig
>
> or
>
> ??? https://download.osgeo.org/gdal/3.9.1/gdal391.zip
> ??? https://download.osgeo.org/gdal/3.9.1/gdal391.zip.md5
> ??? https://download.osgeo.org/gdal/3.9.1/gdal391.zip.sig
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From michkowalczuk at gmail.com  Fri Jun 28 05:59:47 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Fri, 28 Jun 2024 14:59:47 +0200
Subject: [gdal-dev] WMTS huge difference in performance - cache issue
Message-ID: <CAP+FqQA2R=8wsKQuzW3KQ7NuiRvOg38zAHUj+g61Dvz=2ZDb=w@mail.gmail.com>

Hi,
I have two sample WMTS servers.
The first is a Polish geoportal:
https://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500
and the second is German:
https://basemap.de/dienste/wmts_capabilities_web_raster.xml
Both work well in QGIS.
I use C API for creating bitmaps in my area of interest.
I use GDALDatasetRasterIO function directly with WMTS dataset and
appropriate arguments.
The first Polish server works smoothly for different extents, different
widths and heights of my output image. Unfortunately, the second one
(German) lasts forever.
During debugging I concluded the thesis that every GDALDatasetRasterIO in
my loop over raster lines, GDAL do not use cache but redownload the same
tiles.

Below is a fragment from GDAL log for well-working Polish server:












*[Fri Jun 28 13:06:16 2024].5430, 66.7590: HTTP: Requesting [1/3]
http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=0
<http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=0>[Fri
Jun 28 13:06:16 2024].5430, 66.7590: HTTP: Requesting [2/3]
http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=1
<http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=1>[Fri
Jun 28 13:06:16 2024].6670, 66.8830: HTTP: Requesting [3/3]
http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=2
<http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=2>[Fri
Jun 28 13:06:16 2024].8230, 67.0390: HTTP: Request [0]
http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=0
<http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=0>
: status = 200, type = image/png, error = (null)[Fri Jun 28 13:06:16
2024].8230, 67.0390: HTTP: Request [1]
http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=1
<http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=1>
: status = 200, type = image/png, error = (null)[Fri Jun 28 13:06:16
2024].8230, 67.0390: HTTP: Request [2]
http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=2
<http://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/G2_MOBILE_500?service=WMTS&request=GetTile&version=1.0.0&layer=G2_MOBILE_500&style=default&format=image/png&TileMatrixSet=EPSG:2180&TileMatrix=EPSG:2180:4&TileRow=2&TileCol=2>
: status = 200, type = image/png, error = (null)[Fri Jun 28 13:06:16
2024].8240, 67.0400: GDAL:
GDALOpen(/vsimem/wms/0000022663367550/wmsresult.dat, this=000002266059B0E0)
succeeds as PNG.[Fri Jun 28 13:06:16 2024].8260, 67.0420: GDAL:
GDALClose(/vsimem/wms/0000022663367550/wmsresult.dat,
this=000002266059B0E0)[Fri Jun 28 13:06:16 2024].8270, 67.0430: GDAL:
GDALOpen(/vsimem/wms/00000226632272D0/wmsresult.dat, this=000002266059B0E0)
succeeds as PNG.[Fri Jun 28 13:06:16 2024].8300, 67.0460: GDAL:
GDALClose(/vsimem/wms/00000226632272D0/wmsresult.dat,
this=000002266059B0E0)[Fri Jun 28 13:06:16 2024].8300, 67.0460: GDAL:
GDALOpen(/vsimem/wms/0000022661BEC8D0/wmsresult.dat, this=000002266059B0E0)
succeeds as PNG.[Fri Jun 28 13:06:16 2024].8330, 67.0490: GDAL:
GDALClose(/vsimem/wms/0000022661BEC8D0/wmsresult.dat,
this=000002266059B0E0) *
And here is log snippet for German server:




























































































*[Fri Jun 28 13:16:02 2024].0840, 652.3000: HTTP: Requesting [1/5]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/0.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/0.png>[Fri
Jun 28 13:16:02 2024].0840, 652.3000: HTTP: Requesting [2/5]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/1.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/1.png>[Fri
Jun 28 13:16:02 2024].2690, 652.4850: HTTP: Requesting [3/5]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/2.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/2.png>[Fri
Jun 28 13:16:02 2024].2870, 652.5030: HTTP: Requesting [4/5]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/3.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/3.png>[Fri
Jun 28 13:16:02 2024].3140, 652.5300: HTTP: Requesting [5/5]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png>[Fri
Jun 28 13:16:02 2024].5970, 652.8130: HTTP: Request [0]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/0.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/0.png>
: status = 200, type = image/png, error = (null)[Fri Jun 28 13:16:02
2024].5970, 652.8130: HTTP: Request [1]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/1.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/1.png>
: status = 200, type = image/png, error = (null)[Fri Jun 28 13:16:02
2024].5970, 652.8130: HTTP: Request [2]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/2.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/2.png>
: status = 200, type = image/png, error = (null)[Fri Jun 28 13:16:02
2024].5970, 652.8130: HTTP: Request [3]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/3.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/3.png>
: status = 200, type = image/png, error = (null)[Fri Jun 28 13:16:02
2024].5970, 652.8130: HTTP: Request [4]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png>
: status = 0, type = (null), error = (null)[Fri Jun 28 13:16:02 2024].5970,
652.8130: GDAL: GDALOpen(/vsimem/wms/0000022661D59690/wmsresult.dat,
this=000002266059B0E0) succeeds as PNG.[Fri Jun 28 13:16:02 2024].5990,
652.8150: GDAL: GDALClose(/vsimem/wms/0000022661D59690/wmsresult.dat,
this=000002266059B0E0)[Fri Jun 28 13:16:02 2024].6190, 652.8350: WMS: Clean
cache[Fri Jun 28 13:16:02 2024].6190, 652.8350: GDAL:
GDALOpen(/vsimem/wms/000002266237A190/wmsresult.dat, this=000002266059B0E0)
succeeds as PNG.[Fri Jun 28 13:16:02 2024].6200, 652.8360: GDAL:
GDALClose(/vsimem/wms/000002266237A190/wmsresult.dat,
this=000002266059B0E0)[Fri Jun 28 13:16:02 2024].6340, 652.8500: GDAL:
GDALOpen(/vsimem/wms/0000022662340E00/wmsresult.dat, this=000002266059B0E0)
succeeds as PNG.[Fri Jun 28 13:16:02 2024].6340, 652.8500: GDAL:
GDALClose(/vsimem/wms/0000022662340E00/wmsresult.dat,
this=000002266059B0E0)[Fri Jun 28 13:16:02 2024].6350, 652.8510: GDAL:
GDALOpen(/vsimem/wms/00000226605A35B0/wmsresult.dat, this=000002266059B0E0)
succeeds as PNG.[Fri Jun 28 13:16:02 2024].6360, 652.8520: GDAL:
GDALClose(/vsimem/wms/00000226605A35B0/wmsresult.dat,
this=000002266059B0E0)[Fri Jun 28 13:16:02 2024].6360, 652.8520: WMS:
ReadBlockFromCache[Fri Jun 28 13:16:02 2024].6370, 652.8530: CPLError:
./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/0/b/0bab9c0d45a96010ec0092c98e78a52d:
No such file or directoryERROR 4:
./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/0/b/0bab9c0d45a96010ec0092c98e78a52d:
No such file or directory[Fri Jun 28 13:16:02 2024].6370, 652.8530:
CPLError: GDALWMS: Unable to open downloaded block.ERROR 1: GDALWMS: Unable
to open downloaded block.[Fri Jun 28 13:16:02 2024].6370, 652.8530: WMS:
After ReadBlockFromCache[Fri Jun 28 13:16:02 2024].6370, 652.8530:
CPLError: GDALWMS: Unable to download block 4, 0.URL:   HTTP status code:
0, error: (null).Add the HTTP status code to <ZeroBlockHttpCodes> to ignore
this error (see http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDALWMS: Unable to download
block 4, 0.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).[Fri
Jun 28 13:16:02 2024].6370, 652.8530: CPLError: GDAL_WMS>, band 3:
IReadBlock failed at X offset 0, Y offset 0: GDALWMS: Unable to download
block 4, 0.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDAL_WMS>, band 3: IReadBlock
failed at X offset 0, Y offset 0: GDALWMS: Unable to download block 4,
0.URL:   HTTP status code: 0, error: (null).Add the HTTP status code to
<ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).[Fri
Jun 28 13:16:02 2024].6380, 652.8540: GDAL:
GDALOpen(./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/1/5/15b3159bb18ea6f97264bd4d0bac680e,
this=000002266059B0E0) succeeds as PNG.[Fri Jun 28 13:16:02 2024].6380,
652.8540: GDAL:
GDALClose(./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/1/5/15b3159bb18ea6f97264bd4d0bac680e,
this=000002266059B0E0)[Fri Jun 28 13:16:02 2024].6390, 652.8550: HTTP:
Requesting [1/1]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png>[Fri
Jun 28 13:16:02 2024].8540, 653.0700: HTTP: Request [0]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png>
: status = 0, type = (null), error = (null)[Fri Jun 28 13:16:02 2024].8540,
653.0700: WMS: ReadBlockFromCache[Fri Jun 28 13:16:02 2024].8550, 653.0710:
CPLError:
./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/0/b/0bab9c0d45a96010ec0092c98e78a52d:
No such file or directoryERROR 4:
./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/0/b/0bab9c0d45a96010ec0092c98e78a52d:
No such file or directory[Fri Jun 28 13:16:02 2024].8550, 653.0710:
CPLError: GDALWMS: Unable to open downloaded block.ERROR 1: GDALWMS: Unable
to open downloaded block.[Fri Jun 28 13:16:02 2024].8550, 653.0710: WMS:
After ReadBlockFromCache[Fri Jun 28 13:16:02 2024].8550, 653.0710:
CPLError: GDALWMS: Unable to download block 4, 0.URL:   HTTP status code:
0, error: (null).Add the HTTP status code to <ZeroBlockHttpCodes> to ignore
this error (see http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDALWMS: Unable to download
block 4, 0.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).[Fri
Jun 28 13:16:02 2024].8550, 653.0710: CPLError: GDAL_WMS>, band 3:
IReadBlock failed at X offset 0, Y offset 0: GDALWMS: Unable to download
block 4, 0.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDAL_WMS>, band 3: IReadBlock
failed at X offset 0, Y offset 0: GDALWMS: Unable to download block 4,
0.URL:   HTTP status code: 0, error: (null).Add the HTTP status code to
<ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).[Fri
Jun 28 13:16:02 2024].8560, 653.0720: GDAL:
GDALOpen(./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/1/5/15b3159bb18ea6f97264bd4d0bac680e,
this=000002266059B0E0) succeeds as PNG.[Fri Jun 28 13:16:02 2024].8560,
653.0720: GDAL:
GDALClose(./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/1/5/15b3159bb18ea6f97264bd4d0bac680e,
this=000002266059B0E0)[Fri Jun 28 13:16:02 2024].8570, 653.0730: HTTP:
Requesting [1/1]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png>[Fri
Jun 28 13:16:03 2024].0760, 653.2920: HTTP: Request [0]
https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png
<https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/de_basemapde_web_raster_farbe/default/DE_EPSG_25832_ADV/02/0/4.png>
: status = 0, type = (null), error = (null)[Fri Jun 28 13:16:03 2024].0760,
653.2920: WMS: ReadBlockFromCache[Fri Jun 28 13:16:03 2024].0760, 653.2920:
CPLError:
./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/0/b/0bab9c0d45a96010ec0092c98e78a52d:
No such file or directoryERROR 4:
./gdalwmscache\76ac5c8f3010af4e1a17a26a53e6ac32/0/b/0bab9c0d45a96010ec0092c98e78a52d:
No such file or directory[Fri Jun 28 13:16:03 2024].0760, 653.2920:
CPLError: GDALWMS: Unable to open downloaded block.ERROR 1: GDALWMS: Unable
to open downloaded block.[Fri Jun 28 13:16:03 2024].0760, 653.2920: WMS:
After ReadBlockFromCache[Fri Jun 28 13:16:03 2024].0760, 653.2920:
CPLError: GDALWMS: Unable to download block 4, 0.URL:   HTTP status code:
0, error: (null).Add the HTTP status code to <ZeroBlockHttpCodes> to ignore
this error (see http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDALWMS: Unable to download
block 4, 0.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).[Fri
Jun 28 13:16:03 2024].0760, 653.2920: CPLError: GDAL_WMS>, band 3:
IReadBlock failed at X offset 0, Y offset 0: GDALWMS: Unable to download
block 4, 0.URL:   HTTP status code: 0, error: (null).Add the HTTP status
code to <ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html
<http://www.gdal.org/frmt_wms.html>).ERROR 1: GDAL_WMS>, band 3: IReadBlock
failed at X offset 0, Y offset 0: GDALWMS: Unable to download block 4,
0.URL:   HTTP status code: 0, error: (null).Add the HTTP status code to
<ZeroBlockHttpCodes> to ignore this error (see
http://www.gdal.org/frmt_wms.html <http://www.gdal.org/frmt_wms.html>).*

How you see, GDAL tries to open cache that does not exist.
But in fact, it exist. I found all necessary tile for full extent map
request in gdalwmscache folder.
I can not send it in this email because of message size limits.

Regards,
Micha?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/f65beabd/attachment-0001.htm>

From Jon.Morris at jbarisk.com  Fri Jun 28 06:04:26 2024
From: Jon.Morris at jbarisk.com (Jon Morris)
Date: Fri, 28 Jun 2024 13:04:26 +0000
Subject: [gdal-dev] Detecting SPARSE rasters
Message-ID: <CWLP123MB6876E5CFA53E0B4DE125E69582D02@CWLP123MB6876.GBRP123.PROD.OUTLOOK.COM>

We usually use the SPARSE_OK option when creating GTiffs, but as a lot of our clients use ArcGIS, we need to ensure that the sparse option is not used for client deliverables. After a tiff has been created though, it's not easy to tell whether it is sparse or not. Is there an easy way of detecting which rasters are sparse and therefore cannot be sent to clients?

Using tiffinfo -D test.tif seems to give an error message like "TIFFFillTile: 0: Invalid tile byte count, tile 0." , so I've been using this to check, but is there a better way?

Or have Esri started supporting sparse rasters, and if so, does anyone know which version of ArcMap 10.x? (Our clients are mostly on older versions, not sure if any are using Pro yet).

Thanks,

Jon

Jon Morris
Software Developer
--


e: Jon.Morris at jbarisk.com
d:+44 (0)1756 587229
t: +44 (0)1756 799919
www.jbarisk.com
All JBA Risk Management's email messages contain confidential information and are intended only for the individual(s) named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail.
Please notify the sender immediately by email if you have received this email by mistake and delete this email from your system. 
JBA Risk Management Limited is registered in England, company number 07732946, 1 Broughton Park, Old Lane North, Broughton, Skipton, North Yorkshire, BD23 3FD, England.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/7febda1f/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image875014.png
Type: image/png
Size: 9321 bytes
Desc: image875014.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/7febda1f/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image205713.png
Type: image/png
Size: 774 bytes
Desc: image205713.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/7febda1f/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image770370.png
Type: image/png
Size: 1259 bytes
Desc: image770370.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/7febda1f/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image697000.png
Type: image/png
Size: 797 bytes
Desc: image697000.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/7febda1f/attachment-0007.png>

From even.rouault at spatialys.com  Fri Jun 28 10:01:06 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 28 Jun 2024 19:01:06 +0200
Subject: [gdal-dev] Detecting SPARSE rasters
In-Reply-To: <CWLP123MB6876E5CFA53E0B4DE125E69582D02@CWLP123MB6876.GBRP123.PROD.OUTLOOK.COM>
References: <CWLP123MB6876E5CFA53E0B4DE125E69582D02@CWLP123MB6876.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <85140528-390e-46c0-bf7b-840317a7f3f2@spatialys.com>

Jon,

Recommended solution: use GDALRasterBand::GetDataCoverageStatus() with 
nXOff, nYOff, nXSize, nYSize matching tile offset and size and check 
forGDAL_DATA_COVERAGE_STATUS_EMPTY. Cf 
https://gdal.org/development/rfc/rfc63_sparse_datasets_improvements.html

(undocumented solution, mostly used for internal testing: 
rasterBand->GetMetadataItem("BLOCK_SIZE_{block_x_offset}_{block_y_offset}", 
"TIFF") where {block_x_offset} / {block_y_offset} must be replaced by 
the block index along x and y.If it returns "0", it is a sparse block.)

Even

Le 28/06/2024 ? 15:04, Jon Morris via gdal-dev a ?crit?:
>
> We usually use the SPARSE_OK option when creating GTiffs, but as a lot 
> of our clients use ArcGIS, we need to ensure that the sparse option is 
> not used for client deliverables. After a tiff has been created 
> though, it?s not easy to tell whether it is sparse or not. Is there an 
> easy way of detecting which rasters are sparse and therefore cannot be 
> sent to clients?
>
> Using tiffinfo -D test.tif seems to give an error message like 
> ?TIFFFillTile: 0: Invalid tile byte count, tile 0.? , so I?ve been 
> using this to check, but is there a better way?
>
> Or have Esri started supporting sparse rasters, and if so, does anyone 
> know which version of ArcMap 10.x? (Our clients are mostly on older 
> versions, not sure if any are using Pro yet).
>
> Thanks,
>
> Jon
>
> *Jon Morris*
>
> *Software Developer*
>
> --
>
> e: ???? 	Jon.Morris at jbarisk.com
> d: 	+44?(0)1756?587229
> t: 	+44?(0)1756?799919 <tel:+44%20(0)1756%20799919>
>
> 	
>
> www.jbarisk.com <http://www.jbarisk.com/>
>
> <https://www.linkedin.com/company/jba-risk-management/>
>
> 	
> <https://twitter.com/JBARisk/>
>
> 	
> <https://www.youtube.com/channel/UC0iatom2jYbW96voW0rlpCw>
>
> 	
>
> All JBA Risk Management's email messages contain confidential 
> information and are intended only for the individual(s) named. If you 
> are not the named addressee you should not disseminate, distribute or 
> copy this e-mail.
> Please notify the sender immediately by email if you have received 
> this email by mistake and delete this email from your system.
> JBA Risk Management Limited is registered in England, company number 
> 07732946, 1 Broughton Park, Old Lane North, Broughton, Skipton, North 
> Yorkshire, BD23 3FD, England.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/18d18801/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image875014.png
Type: image/png
Size: 9321 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/18d18801/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image205713.png
Type: image/png
Size: 774 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/18d18801/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image770370.png
Type: image/png
Size: 1259 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/18d18801/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image697000.png
Type: image/png
Size: 797 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240628/18d18801/attachment-0007.png>

