From andrew at aitchison.me.uk  Mon Nov  1 01:59:54 2021
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 1 Nov 2021 08:59:54 +0000 (GMT)
Subject: [gdal-dev] Two JPEG-XL libraries - was Re:  draft NEWS for 3.4.0
In-Reply-To: <8fb5f792-7858-a829-9813-03f04ad830b0@spatialys.com>
References: <8fb5f792-7858-a829-9813-03f04ad830b0@spatialys.com>
Message-ID: <93b12988-e387-d5f6-22b4-f9b6cf215d66@aitchison.me.uk>

On Fri, 29 Oct 2021, Even Rouault wrote:

> if you feel bored this week end, you can review and submit tweaks for the 
> NEWS file:
>
> https://github.com/OSGeo/gdal/blob/release/3.4/gdal/NEWS

 	New optional dependencies

 	* libjxl (master) when using internal libtiff for JPEG-XL support in TIFF
 			...
 	* libbrunsli for JPEG-XL support in MRF driver (as well as existing libzstd)

*Two* optional JPEG-XL libraries could be confusing.
Is there a wish to update one driver so that we can use a single
JPEG-XL library ?

(I note that both are still under development,
perhaps it is to early to pick one?)

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From even.rouault at spatialys.com  Mon Nov  1 02:11:28 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 1 Nov 2021 10:11:28 +0100
Subject: [gdal-dev] Two JPEG-XL libraries - was Re: draft NEWS for 3.4.0
In-Reply-To: <93b12988-e387-d5f6-22b4-f9b6cf215d66@aitchison.me.uk>
References: <8fb5f792-7858-a829-9813-03f04ad830b0@spatialys.com>
 <93b12988-e387-d5f6-22b4-f9b6cf215d66@aitchison.me.uk>
Message-ID: <20bc6435-5c6f-fd92-056f-27de205a7366@spatialys.com>

Andrew,

this was discussed in https://github.com/OSGeo/gdal/pull/3945 . I also 
find the current situation not super satisfactory.

Even

Le 01/11/2021 ? 09:59, Andrew C Aitchison a ?crit?:
> On Fri, 29 Oct 2021, Even Rouault wrote:
>
>> if you feel bored this week end, you can review and submit tweaks for 
>> the NEWS file:
>>
>> https://github.com/OSGeo/gdal/blob/release/3.4/gdal/NEWS
>
> ????New optional dependencies
>
> ????* libjxl (master) when using internal libtiff for JPEG-XL support 
> in TIFF
> ??????????? ...
> ????* libbrunsli for JPEG-XL support in MRF driver (as well as 
> existing libzstd)
>
> *Two* optional JPEG-XL libraries could be confusing.
> Is there a wish to update one driver so that we can use a single
> JPEG-XL library ?
>
> (I note that both are still under development,
> perhaps it is to early to pick one?)
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Nov  1 09:27:39 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 1 Nov 2021 17:27:39 +0100
Subject: [gdal-dev] GDAL 3.4.0 RC1 available
Message-ID: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.4.0 release candidate.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.4.0/gdal340rc1.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.zip

A snapshot of the documentation is at:

 ? https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip

GDAL-GRASS plugin:

 ? https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz

NEWS at:

 ? https://github.com/OSGeo/gdal/blob/v3.4.0RC1/gdal/NEWS.md

I'll call for a vote promoting it to final later this week if no
serious problems are reported before.

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From Matt.Wilkie at yukon.ca  Mon Nov  1 11:10:14 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Mon, 1 Nov 2021 18:10:14 +0000
Subject: [gdal-dev] Add a list to MARC: gdal-dev
Message-ID: <0ed8829496a0479f935510e86562b7cc@yukon.ca>

Hi, would you please consider adding Gdal-dev to the MARC archives?

https://lists.osgeo.org/mailman/listinfo/gdal-dev

I'm not an administrator, just someone who relies on the community and is having difficulties consulting historical data now that Nabble has discontinued it's archive.

Thank you,

Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca<http://yukon.ca/>
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211101/ec1698b7/attachment.html>

From j1 at jimenezshaw.com  Mon Nov  1 11:19:35 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 1 Nov 2021 19:19:35 +0100
Subject: [gdal-dev] Add a list to MARC: gdal-dev
In-Reply-To: <0ed8829496a0479f935510e86562b7cc@yukon.ca>
References: <0ed8829496a0479f935510e86562b7cc@yukon.ca>
Message-ID: <CADRrdKvY+vdOWrSMTM_4w7sX8iPC-hxPhobcLcZDo5ynCsW_zA@mail.gmail.com>

I am in favor of that (and the same for PROJ please:
https://lists.osgeo.org/mailman/listinfo/proj). Currently it is very
complicated to find anything using a search engine.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Mon, 1 Nov 2021 at 19:10, <Matt.Wilkie at yukon.ca> wrote:

> Hi, would you please consider adding Gdal-dev to the MARC archives?
>
>
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> I?m not an administrator, just someone who relies on the community and is
> having difficulties consulting historical data now that Nabble has
> discontinued it?s archive.
>
>
>
> Thank you,
>
>
>
> *Matt Wilkie*
>
> Geomatics Developer & Administrator
>
> Environment | Technology, Innovation and Mapping
>
> T 867-667-8133 | *Yukon.ca <http://yukon.ca/>*
>
> *Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.*
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211101/37126aea/attachment-0001.html>

From Matt.Wilkie at yukon.ca  Mon Nov  1 11:31:11 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Mon, 1 Nov 2021 18:31:11 +0000
Subject: [gdal-dev] Gdal-dev mail archive search sites?
In-Reply-To: <CALFmHhsQmZnk6FDwa0r5X=no8Z87BXE3sJ+L1XKVt5me+b7Lxw@mail.gmail.com>
References: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
 <CALFmHhsQmZnk6FDwa0r5X=no8Z87BXE3sJ+L1XKVt5me+b7Lxw@mail.gmail.com>
Message-ID: <dbf47c3edbe04465bc8fde5ee1161b37@yukon.ca>

> What about starting this archive?
> https://marc.info/?q=about#Add

Thanks Markus,  I?ve asked MARC about adding gdal-dev.

I?ve done the same with Mail Archive[1] but the expected subscription confirmation doesn?t show up[2], though there is one dating back to 2008[3]. Maybe the old one is getting in the way?

[1]: https://www.mail-archive.com/faq.html#newlist
[2]: https://www.mail-archive.com/archive at mail-archive.com/maillist.html
[3]: https://www.mail-archive.com/archive at mail-archive.com/msg16721.html

I will follow up with gdal-dev-owner.

-Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211101/1fc9fde7/attachment.html>

From simon.eves at omnisci.com  Mon Nov  1 13:58:15 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Mon, 1 Nov 2021 13:58:15 -0700
Subject: [gdal-dev] Multi-threading GDALRasterBand::RasterIO() ?
In-Reply-To: <CAJf0KTQxax+k=JTd8acqQyat=wDNh9NW=soaPHYbS7VFHg3M8Q@mail.gmail.com>
References: <CAJf0KTQxax+k=JTd8acqQyat=wDNh9NW=soaPHYbS7VFHg3M8Q@mail.gmail.com>
Message-ID: <CAJf0KTTRzdkoggKGvC0YwMAyLHh04X6LRo-TTSuduSJOBCw-9w@mail.gmail.com>

You can ignore this.

I have rather belatedly found the documentation that says that one must
open a GDALDataset per thread, even if it's on the same file.

The multi-threading now works just fine.

Interestingly, we're not actually doing that with our existing geo
importer. I guess it's OK because we're pulling the OGRFeatures out with
the process thread, and only converting and loading them with the child
threads. I guess I really ought to rewrite that code too now. Sigh.

As you were...

Simon

On Sun, Oct 31, 2021 at 4:27 PM Simon Eves <simon.eves at omnisci.com> wrote:

> We are writing a raster importer, and finding that
> GDALRasterBand::RasterIO() is unexpectedly slow for some GRIB2 files.
>
> We have a file which is about 1800x1000 pixels, with 49 bands of type
> DOUBLE. The file is about 47MB on disc.
>
> Reading all the bands of a single scanline from this file takes about
> 1300ms, which is about 26ms per band, hence the entire file takes around 20
> minutes to import. All the time seems to be spent in the RasterIO() call,
> even though it's not doing any raster rescaling or data format conversion
> (1:1 pixels, fetching as GDT_Float64).
>
> So, I figured we'd try multi-threading it, but evidently the call is not
> thread-safe. Here is just one of various stack traces it will throw.
>
> libc.so.6!raise (Unknown Source:0)
> libc.so.6!abort (Unknown Source:0)
> libc.so.6![Unknown/Just-In-Time compiled code] (Unknown Source:0)
> libgdal.so.28!GRIBRasterBand::UncacheData(GRIBRasterBand * const this)
> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:948)
> libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:730)
> libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:697)
> libgdal.so.28!GRIBRasterBand::IReadBlock(GRIBRasterBand * const this, int
> nBlockYOff, void * pImage)
> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:803)
> libgdal.so.28!GDALRasterBand::GetLockedBlockRef(int bJustInitialize, int
> nYBlockOff, int nXBlockOff, GDALRasterBand * const this)
> (/build/scripts/gdal-3.2.2/gcore/gdal_priv.h:963)
> libgdal.so.28!GDALRasterBand::GetLockedBlockRef(GDALRasterBand * const
> this, int nXBlockOff, int nYBlockOff, int bJustInitialize)
> (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:1238)
> libgdal.so.28!GDALRasterBand::IRasterIO(GDALRasterBand * const this,
> GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
> pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
> nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
> (/build/scripts/gdal-3.2.2/gcore/rasterio.cpp:149)
> libgdal.so.28!GDALRasterBand::RasterIO(GDALRasterBand * const this,
> GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
> pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
> nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
> (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:372)
> import_export::Importer::<lambda(size_t, int)>::operator()(size_t, int)
> const(const import_export::Importer::<lambda(size_t, int)> * const
> __closure, const size_t thread_id, const int y)
> (/home/simon.eves/work/omniscidb-internal/ImportExport/Importer.cpp:5721)
> ...
>
> All of the parameters to the call are either constant or uncontended
> simple variables, and obviously there is a unique data buffer (pData) per
> thread.
>
> Is there anything we can do to make this work?
>
> I was intending to look into the lower level block-based API, in the hope
> that it will be faster, but have not yet done so.
>
> This is all with a local static build of GDAL 3.2.2 on Ubuntu 20.04 with
> GCC 9.
>
> Yours,
>
> Simon Eves
>
> --
> <http://www.omnisci.com/>
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>
>

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211101/575a362f/attachment.html>

From even.rouault at spatialys.com  Mon Nov  1 14:05:45 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 1 Nov 2021 22:05:45 +0100
Subject: [gdal-dev] Multi-threading GDALRasterBand::RasterIO() ?
In-Reply-To: <CAJf0KTTRzdkoggKGvC0YwMAyLHh04X6LRo-TTSuduSJOBCw-9w@mail.gmail.com>
References: <CAJf0KTQxax+k=JTd8acqQyat=wDNh9NW=soaPHYbS7VFHg3M8Q@mail.gmail.com>
 <CAJf0KTTRzdkoggKGvC0YwMAyLHh04X6LRo-TTSuduSJOBCw-9w@mail.gmail.com>
Message-ID: <fd387dbe-6a1e-977f-1890-c88929f4c0d5@spatialys.com>

Yes regarding multithreading. Regarding GRIB and performance issues, you 
must be aware that the GRIB driver when accessing a single pixel of a 
band needs to decompress data for the whole band. Hence there's a 
per-dataset cache of band data which default to 100 MB (you can increase 
it by setting the GRIB_CACHEMAX config option to a number in megabytes). 
So the most performance access pattern for GRIB is to read band per 
band, and no all-bands-of-a-line

Le 01/11/2021 ? 21:58, Simon Eves a ?crit?:
> You can ignore this.
>
> I have rather belatedly found the documentation that says that one 
> must open a GDALDataset per thread, even if it's on the same file.
>
> The multi-threading now works just fine.
>
> Interestingly, we're not actually doing that with our existing geo 
> importer. I guess it's OK because we're pulling the OGRFeatures out 
> with the process thread, and only converting and loading them with the 
> child threads. I guess I really ought?to rewrite that code too now. Sigh.
>
> As you were...
>
> Simon
>
> On Sun, Oct 31, 2021 at 4:27 PM Simon Eves <simon.eves at omnisci.com 
> <mailto:simon.eves at omnisci.com>> wrote:
>
>     We are writing a raster importer, and finding?that
>     GDALRasterBand::RasterIO() is unexpectedly slow for some GRIB2 files.
>
>     We have a file which is about 1800x1000 pixels, with 49 bands of
>     type DOUBLE. The file is about 47MB on disc.
>
>     Reading all the bands of a single scanline from this file takes
>     about 1300ms, which is about 26ms per band, hence the entire file
>     takes around 20 minutes to import. All the time seems to be spent
>     in the RasterIO() call, even though it's not doing any raster
>     rescaling or data format conversion (1:1 pixels, fetching as
>     GDT_Float64).
>
>     So, I figured we'd try multi-threading it, but evidently?the call
>     is not thread-safe. Here is just one of various stack traces it
>     will throw.
>
>     libc.so.6!raise (Unknown Source:0)
>     libc.so.6!abort (Unknown Source:0)
>     libc.so.6![Unknown/Just-In-Time compiled code] (Unknown Source:0)
>     libgdal.so.28!GRIBRasterBand::UncacheData(GRIBRasterBand * const
>     this) (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:948)
>     libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const
>     this) (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:730)
>     libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const
>     this) (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:697)
>     libgdal.so.28!GRIBRasterBand::IReadBlock(GRIBRasterBand * const
>     this, int nBlockYOff, void * pImage)
>     (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:803)
>     libgdal.so.28!GDALRasterBand::GetLockedBlockRef(int
>     bJustInitialize, int nYBlockOff, int nXBlockOff, GDALRasterBand *
>     const this) (/build/scripts/gdal-3.2.2/gcore/gdal_priv.h:963)
>     libgdal.so.28!GDALRasterBand::GetLockedBlockRef(GDALRasterBand *
>     const this, int nXBlockOff, int nYBlockOff, int bJustInitialize)
>     (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:1238)
>     libgdal.so.28!GDALRasterBand::IRasterIO(GDALRasterBand * const
>     this, GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int
>     nYSize, void * pData, int nBufXSize, int nBufYSize, GDALDataType
>     eBufType, GSpacing nPixelSpace, GSpacing nLineSpace,
>     GDALRasterIOExtraArg * psExtraArg)
>     (/build/scripts/gdal-3.2.2/gcore/rasterio.cpp:149)
>     libgdal.so.28!GDALRasterBand::RasterIO(GDALRasterBand * const
>     this, GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int
>     nYSize, void * pData, int nBufXSize, int nBufYSize, GDALDataType
>     eBufType, GSpacing nPixelSpace, GSpacing nLineSpace,
>     GDALRasterIOExtraArg * psExtraArg)
>     (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:372)
>     import_export::Importer::<lambda(size_t, int)>::operator()(size_t,
>     int) const(const import_export::Importer::<lambda(size_t, int)> *
>     const __closure, const size_t thread_id, const int y)
>     (/home/simon.eves/work/omniscidb-internal/ImportExport/Importer.cpp:5721)
>     ...
>
>     All of the parameters to the call are either constant or
>     uncontended simple variables, and obviously there is a unique data
>     buffer (pData) per thread.
>
>     Is there anything we can do to?make this work?
>
>     I was intending to look into the lower level block-based API, in
>     the hope that it will be faster, but have not yet done so.
>
>     This is all with a local static build of GDAL 3.2.2 on Ubuntu
>     20.04 with GCC 9.
>
>     Yours,
>
>     Simon Eves
>
>     -- 
>     <http://www.omnisci.com/>
>     	
>     Simon Eves
>     Senior Graphics Engineer, Rendering Group
>     100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
>     	
>     Email: simon.eves at omnisci.com <mailto:simon.eves at omnisci.com>?|
>     Cell: 	+1 (415) 902-1996
>
>
>
>
>
> -- 
> <http://www.omnisci.com/>
> 	
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> 	
> Email: simon.eves at omnisci.com <mailto:simon.eves at omnisci.com>?| Cell: 
> +1 (415) 902-1996
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211101/814ad8a6/attachment-0001.html>

From simon.eves at omnisci.com  Mon Nov  1 14:29:08 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Mon, 1 Nov 2021 14:29:08 -0700
Subject: [gdal-dev] Multi-threading GDALRasterBand::RasterIO() ?
In-Reply-To: <fd387dbe-6a1e-977f-1890-c88929f4c0d5@spatialys.com>
References: <CAJf0KTQxax+k=JTd8acqQyat=wDNh9NW=soaPHYbS7VFHg3M8Q@mail.gmail.com>
 <CAJf0KTTRzdkoggKGvC0YwMAyLHh04X6LRo-TTSuduSJOBCw-9w@mail.gmail.com>
 <fd387dbe-6a1e-977f-1890-c88929f4c0d5@spatialys.com>
Message-ID: <CAJf0KTS14HnRS63tN2KcN9ihAZsyJFOByYndEp0S416neayCqQ@mail.gmail.com>

Band by band makes sense. I shall do that instead. Thank you! :)

On Mon, Nov 1, 2021 at 2:05 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Yes regarding multithreading. Regarding GRIB and performance issues, you
> must be aware that the GRIB driver when accessing a single pixel of a band
> needs to decompress data for the whole band. Hence there's a per-dataset
> cache of band data which default to 100 MB (you can increase it by setting
> the GRIB_CACHEMAX config option to a number in megabytes). So the most
> performance access pattern for GRIB is to read band per band, and no
> all-bands-of-a-line
> Le 01/11/2021 ? 21:58, Simon Eves a ?crit :
>
> You can ignore this.
>
> I have rather belatedly found the documentation that says that one must
> open a GDALDataset per thread, even if it's on the same file.
>
> The multi-threading now works just fine.
>
> Interestingly, we're not actually doing that with our existing geo
> importer. I guess it's OK because we're pulling the OGRFeatures out with
> the process thread, and only converting and loading them with the child
> threads. I guess I really ought to rewrite that code too now. Sigh.
>
> As you were...
>
> Simon
>
> On Sun, Oct 31, 2021 at 4:27 PM Simon Eves <simon.eves at omnisci.com> wrote:
>
>> We are writing a raster importer, and finding that
>> GDALRasterBand::RasterIO() is unexpectedly slow for some GRIB2 files.
>>
>> We have a file which is about 1800x1000 pixels, with 49 bands of type
>> DOUBLE. The file is about 47MB on disc.
>>
>> Reading all the bands of a single scanline from this file takes about
>> 1300ms, which is about 26ms per band, hence the entire file takes around 20
>> minutes to import. All the time seems to be spent in the RasterIO() call,
>> even though it's not doing any raster rescaling or data format conversion
>> (1:1 pixels, fetching as GDT_Float64).
>>
>> So, I figured we'd try multi-threading it, but evidently the call is not
>> thread-safe. Here is just one of various stack traces it will throw.
>>
>> libc.so.6!raise (Unknown Source:0)
>> libc.so.6!abort (Unknown Source:0)
>> libc.so.6![Unknown/Just-In-Time compiled code] (Unknown Source:0)
>> libgdal.so.28!GRIBRasterBand::UncacheData(GRIBRasterBand * const this)
>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:948)
>> libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:730)
>> libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:697)
>> libgdal.so.28!GRIBRasterBand::IReadBlock(GRIBRasterBand * const this, int
>> nBlockYOff, void * pImage)
>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:803)
>> libgdal.so.28!GDALRasterBand::GetLockedBlockRef(int bJustInitialize, int
>> nYBlockOff, int nXBlockOff, GDALRasterBand * const this)
>> (/build/scripts/gdal-3.2.2/gcore/gdal_priv.h:963)
>> libgdal.so.28!GDALRasterBand::GetLockedBlockRef(GDALRasterBand * const
>> this, int nXBlockOff, int nYBlockOff, int bJustInitialize)
>> (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:1238)
>> libgdal.so.28!GDALRasterBand::IRasterIO(GDALRasterBand * const this,
>> GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
>> pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
>> nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
>> (/build/scripts/gdal-3.2.2/gcore/rasterio.cpp:149)
>> libgdal.so.28!GDALRasterBand::RasterIO(GDALRasterBand * const this,
>> GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
>> pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
>> nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
>> (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:372)
>> import_export::Importer::<lambda(size_t, int)>::operator()(size_t, int)
>> const(const import_export::Importer::<lambda(size_t, int)> * const
>> __closure, const size_t thread_id, const int y)
>> (/home/simon.eves/work/omniscidb-internal/ImportExport/Importer.cpp:5721)
>> ...
>>
>> All of the parameters to the call are either constant or uncontended
>> simple variables, and obviously there is a unique data buffer (pData) per
>> thread.
>>
>> Is there anything we can do to make this work?
>>
>> I was intending to look into the lower level block-based API, in the hope
>> that it will be faster, but have not yet done so.
>>
>> This is all with a local static build of GDAL 3.2.2 on Ubuntu 20.04 with
>> GCC 9.
>>
>> Yours,
>>
>> Simon Eves
>>
>> --
>> <http://www.omnisci.com/>
>> Simon Eves
>> Senior Graphics Engineer, Rendering Group
>> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>>
>>
>> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>>
>>
>
> --
> <http://www.omnisci.com/>
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211101/6f07c971/attachment-0001.html>

From simon.eves at omnisci.com  Mon Nov  1 14:45:50 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Mon, 1 Nov 2021 14:45:50 -0700
Subject: [gdal-dev] Multi-threading GDALRasterBand::RasterIO() ?
In-Reply-To: <CAJf0KTS14HnRS63tN2KcN9ihAZsyJFOByYndEp0S416neayCqQ@mail.gmail.com>
References: <CAJf0KTQxax+k=JTd8acqQyat=wDNh9NW=soaPHYbS7VFHg3M8Q@mail.gmail.com>
 <CAJf0KTTRzdkoggKGvC0YwMAyLHh04X6LRo-TTSuduSJOBCw-9w@mail.gmail.com>
 <fd387dbe-6a1e-977f-1890-c88929f4c0d5@spatialys.com>
 <CAJf0KTS14HnRS63tN2KcN9ihAZsyJFOByYndEp0S416neayCqQ@mail.gmail.com>
Message-ID: <CAJf0KTT2OZETuRXvXf4pMVNqopw5qmbW4R6+jfF5k4Y7jMj=8w@mail.gmail.com>

More specifically, I'm guessing the MOST efficient is to read whole blocks
from one band, which presumably avoids crossing compression boundaries etc.

A block may be a scanline, or it may be a tile, depending on the format.


On Mon, Nov 1, 2021 at 2:29 PM Simon Eves <simon.eves at omnisci.com> wrote:

> Band by band makes sense. I shall do that instead. Thank you! :)
>
> On Mon, Nov 1, 2021 at 2:05 PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Yes regarding multithreading. Regarding GRIB and performance issues, you
>> must be aware that the GRIB driver when accessing a single pixel of a band
>> needs to decompress data for the whole band. Hence there's a per-dataset
>> cache of band data which default to 100 MB (you can increase it by setting
>> the GRIB_CACHEMAX config option to a number in megabytes). So the most
>> performance access pattern for GRIB is to read band per band, and no
>> all-bands-of-a-line
>> Le 01/11/2021 ? 21:58, Simon Eves a ?crit :
>>
>> You can ignore this.
>>
>> I have rather belatedly found the documentation that says that one must
>> open a GDALDataset per thread, even if it's on the same file.
>>
>> The multi-threading now works just fine.
>>
>> Interestingly, we're not actually doing that with our existing geo
>> importer. I guess it's OK because we're pulling the OGRFeatures out with
>> the process thread, and only converting and loading them with the child
>> threads. I guess I really ought to rewrite that code too now. Sigh.
>>
>> As you were...
>>
>> Simon
>>
>> On Sun, Oct 31, 2021 at 4:27 PM Simon Eves <simon.eves at omnisci.com>
>> wrote:
>>
>>> We are writing a raster importer, and finding that
>>> GDALRasterBand::RasterIO() is unexpectedly slow for some GRIB2 files.
>>>
>>> We have a file which is about 1800x1000 pixels, with 49 bands of type
>>> DOUBLE. The file is about 47MB on disc.
>>>
>>> Reading all the bands of a single scanline from this file takes about
>>> 1300ms, which is about 26ms per band, hence the entire file takes around 20
>>> minutes to import. All the time seems to be spent in the RasterIO() call,
>>> even though it's not doing any raster rescaling or data format conversion
>>> (1:1 pixels, fetching as GDT_Float64).
>>>
>>> So, I figured we'd try multi-threading it, but evidently the call is not
>>> thread-safe. Here is just one of various stack traces it will throw.
>>>
>>> libc.so.6!raise (Unknown Source:0)
>>> libc.so.6!abort (Unknown Source:0)
>>> libc.so.6![Unknown/Just-In-Time compiled code] (Unknown Source:0)
>>> libgdal.so.28!GRIBRasterBand::UncacheData(GRIBRasterBand * const this)
>>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:948)
>>> libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
>>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:730)
>>> libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
>>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:697)
>>> libgdal.so.28!GRIBRasterBand::IReadBlock(GRIBRasterBand * const this,
>>> int nBlockYOff, void * pImage)
>>> (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:803)
>>> libgdal.so.28!GDALRasterBand::GetLockedBlockRef(int bJustInitialize, int
>>> nYBlockOff, int nXBlockOff, GDALRasterBand * const this)
>>> (/build/scripts/gdal-3.2.2/gcore/gdal_priv.h:963)
>>> libgdal.so.28!GDALRasterBand::GetLockedBlockRef(GDALRasterBand * const
>>> this, int nXBlockOff, int nYBlockOff, int bJustInitialize)
>>> (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:1238)
>>> libgdal.so.28!GDALRasterBand::IRasterIO(GDALRasterBand * const this,
>>> GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
>>> pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
>>> nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
>>> (/build/scripts/gdal-3.2.2/gcore/rasterio.cpp:149)
>>> libgdal.so.28!GDALRasterBand::RasterIO(GDALRasterBand * const this,
>>> GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
>>> pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
>>> nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
>>> (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:372)
>>> import_export::Importer::<lambda(size_t, int)>::operator()(size_t, int)
>>> const(const import_export::Importer::<lambda(size_t, int)> * const
>>> __closure, const size_t thread_id, const int y)
>>> (/home/simon.eves/work/omniscidb-internal/ImportExport/Importer.cpp:5721)
>>> ...
>>>
>>> All of the parameters to the call are either constant or uncontended
>>> simple variables, and obviously there is a unique data buffer (pData) per
>>> thread.
>>>
>>> Is there anything we can do to make this work?
>>>
>>> I was intending to look into the lower level block-based API, in the
>>> hope that it will be faster, but have not yet done so.
>>>
>>> This is all with a local static build of GDAL 3.2.2 on Ubuntu 20.04 with
>>> GCC 9.
>>>
>>> Yours,
>>>
>>> Simon Eves
>>>
>>> --
>>> <http://www.omnisci.com/>
>>> Simon Eves
>>> Senior Graphics Engineer, Rendering Group
>>> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>>>
>>>
>>> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>>>
>>>
>>
>> --
>> <http://www.omnisci.com/>
>> Simon Eves
>> Senior Graphics Engineer, Rendering Group
>> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>>
>>
>> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>>
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> <http://www.omnisci.com/>
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>
>

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211101/fc185e4c/attachment-0001.html>

From liporace at gmail.com  Mon Nov  1 15:22:23 2021
From: liporace at gmail.com (Frederico Liporace)
Date: Mon, 1 Nov 2021 19:22:23 -0300
Subject: [gdal-dev] current geolocation array implementation status
Message-ID: <CACX38Cp+hsvFWqGMa+UjHZo5E1yNrQqNbOFaw9VdzmGDrPcwsg@mail.gmail.com>

Hello,

I'm debugging an artifact that I encountered while using geolocation arrays:
https://github.com/OSGeo/gdal/issues/4707

While searching I found this ticket mentioning that the backward map
implementation is broken and a new implementation is being considered:
https://trac.osgeo.org/gdal/ticket/6959

I could help with this implementation. Is there more context available
on why it is being reconsidered? It seems to me that the general case
for the backward implementation is very hard - for instance, what kind
of discontinuities (gaps, overlaps) would be allowed in the
geolocation array? Would it be expected to be robust enough to correct
the Landsat 7 ETM+ SLC-off for instance? My guess is not.

PS. most of this information is on the github issue, I'm not sure if
this list is a better forum to discuss it.

rgds.,
Frederico Liporace

From Tritschler at Hydro-Consult.de  Mon Nov  1 23:32:04 2021
From: Tritschler at Hydro-Consult.de (Dr. Felix Tritschler)
Date: Tue, 2 Nov 2021 07:32:04 +0100
Subject: [gdal-dev] Bug report gdal_translate
Message-ID: <a6234645-888c-3e02-4579-2198c99a3d0b@Hydro-Consult.de>

Hello,

I stumbled across what appears to me as an typo in the gdal_translate 
function implemented in QGIS 3.18.2.
I performed a translation from a geotiff to a surfer (non-binary) .grd 
file without a specification of a NODATA-Value.

In the resulting .grd-file the NODATA value was 1.70141E+38.
But according to 
http://surferhelp.goldensoftware.com/topics/ascii_grid_file_format.htm
the correct NODATA value for this filetype has to be 1.71041E+38.

I don't feel skilled enough to fix this bug on my own (even don't know 
if I could do this =o), so please feel free to check and fix if necessary.

Cheers
Felix


From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov  2 02:16:01 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 2 Nov 2021 09:16:01 +0000
Subject: [gdal-dev] Hi:  Bug report gdal_translate
Message-ID: <6b9d36f6d31e4fd5a87cb7bb03664102@maanmittauslaitos.fi>

Hi,

I believe that you have found a bug in the Surfer documentation. You can see value 1.70141e+38, that is the maximum single precision float, used in for example
https://support.goldensoftware.com/hc/en-us/articles/226806408-How-do-I-make-all-Z-values-above-or-below-a-certain-threshold-value-transparent-in-Surfer-?mobile_site=false 

The GDAL AAIGRID driver does not seem to have a default value for nodata https://gdal.org/drivers/raster/aaigrid.html. The driver copies the nodata from the source dataset if it exists https://github.com/OSGeo/gdal/blob/master/frmts/aaigrid/aaigriddataset.cpp#L1275. There is some nodata handling in the code:
// Cast to float and back for make sure the NoData value matches
// that expressed by a float value.  Clamps to the range of a float
// if the value is too large.  Preserves +/-inf and NaN.

Maybe there should be a default nodata value, -9999 https://www.loc.gov/preservation/digital/formats/fdd/fdd000421.shtml
"Cells without actual values can be assigned a NoData value. The default value for NoData is -9999 but a different value can be specified in the header as shown in example below."

I read the comment "NoData values appear as 1.71041e38" from http://surferhelp.goldensoftware.com/topics/ascii_grid_file_format.htm so that it is the value how nodata appears in Surfer. You can test it by creating some ASCII grid files with different nodata values and opening them with Surfer. Commands would look like this "gdal_translate -of AAIGRID -a_nodata -99".

There may be a bug in theAAIGRID driver if the nodata in your source data and the nodata transferrer into ASCII grid files are different. Check the nodata values with gdalinfo. If nodata remains the same there is no bug. If you have 1.71041E+38 as nodata in your source data, what it the format and bit depth of the data?

-Jukka Rahkonen-
 
-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Dr. Felix Tritschler
L?hetetty: tiistai 2. marraskuuta 2021 8.32
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Bug report gdal_translate

Hello,

I stumbled across what appears to me as an typo in the gdal_translate function implemented in QGIS 3.18.2.
I performed a translation from a geotiff to a surfer (non-binary) .grd file without a specification of a NODATA-Value.

In the resulting .grd-file the NODATA value was 1.70141E+38.
But according to
http://surferhelp.goldensoftware.com/topics/ascii_grid_file_format.htm
the correct NODATA value for this filetype has to be 1.71041E+38.

I don't feel skilled enough to fix this bug on my own (even don't know if I could do this =o), so please feel free to check and fix if necessary.

Cheers
Felix

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From jmckenna at gatewaygeomatics.com  Tue Nov  2 05:05:03 2021
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 2 Nov 2021 09:05:03 -0300
Subject: [gdal-dev] Gdal-dev mail archive search sites?
In-Reply-To: <dbf47c3edbe04465bc8fde5ee1161b37@yukon.ca>
References: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
 <CALFmHhsQmZnk6FDwa0r5X=no8Z87BXE3sJ+L1XKVt5me+b7Lxw@mail.gmail.com>
 <dbf47c3edbe04465bc8fde5ee1161b37@yukon.ca>
Message-ID: <afc8b4dc-e4cc-0791-8b5e-cbb333c47e10@gatewaygeomatics.com>

Hi Matt,

mail-archive seems to be working now: 
https://www.mail-archive.com/gdal-dev at lists.osgeo.org/

-jeff



On 2021-11-01 3:31 p.m., Matt.Wilkie at yukon.ca wrote:
>>  What about starting this archive?
> 
>> https://marc.info/?q=about#Add
> 
> Thanks Markus, ?I?ve asked MARC about adding gdal-dev.
> 
> I?ve done the same with Mail Archive[1] but the expected subscription 
> confirmation doesn?t show up[2], though there is one dating back to 
> 2008[3]. Maybe the old one is getting in the way?
> 
> [1]: https://www.mail-archive.com/faq.html#newlist 
> <https://www.mail-archive.com/faq.html#newlist>
> 
> [2]: https://www.mail-archive.com/archive at mail-archive.com/maillist.html 
> <https://www.mail-archive.com/archive at mail-archive.com/maillist.html>
> 
> [3]: https://www.mail-archive.com/archive at mail-archive.com/msg16721.html 
> <https://www.mail-archive.com/archive at mail-archive.com/msg16721.html>
> 
> I will follow up with gdal-dev-owner.
> 
> -Matt//
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/

From bclay at infoscitex.com  Tue Nov  2 07:21:59 2021
From: bclay at infoscitex.com (Clay, Bruce)
Date: Tue, 2 Nov 2021 14:21:59 +0000
Subject: [gdal-dev] ogr2ogr does not convert OSM polygons
Message-ID: <BN1P110MB0721326C28BE12CC88DFDED6DE8B9@BN1P110MB0721.NAMP110.PROD.OUTLOOK.COM>

When I convert a OSM pbf file to postgres using the following script it does not create a multipolygon table

ogr2ogr -f PostgreSQL PG:"dbname='open_street_map' host='db-host' port='5432' user='postgres' password='pwd'" -lco schema=country country_pbf  --config OSM_MAX_TMPFILE_SIZE 1024

When I do the same thing using osm2pgsql (shown below) it creates the polygon table but not the other_relations table

osm2pgsql -H hostname -U postgres -d open_street_map --output-pgsql-schema=country --create --latlong -G --hstore --tag-transform-script /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.lua -C 2500 --number-processes 5 -S /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.style country-latest.osm.pbf.

I did not see this problem when I Googled.

Is this a known issue and is there a work around?

Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211102/13a0dc87/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov  2 08:11:33 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 2 Nov 2021 15:11:33 +0000
Subject: [gdal-dev] ogr2ogr does not convert OSM polygons
Message-ID: <13c753c98b9348ad953d3f0190d0018b@maanmittauslaitos.fi>

Hi,

What layers does "ogrinfo country_pbf" list? Can you reproduce the error with some small OSM country file from http://download.geofabrik.de/?
What is your operating system and GDAL version? Do you use the default osmconf.ini file? GDAL OSM driver and osm2pgsql are creating quite different database schemas so they are not very comparable.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clay, Bruce
L?hetetty: tiistai 2. marraskuuta 2021 16.22
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ogr2ogr does not convert OSM polygons

When I convert a OSM pbf file to postgres using the following script it does not create a multipolygon table

ogr2ogr -f PostgreSQL PG:"dbname='open_street_map' host='db-host' port='5432' user='postgres' password='pwd'" -lco schema=country country_pbf  --config OSM_MAX_TMPFILE_SIZE 1024

When I do the same thing using osm2pgsql (shown below) it creates the polygon table but not the other_relations table

osm2pgsql -H hostname -U postgres -d open_street_map --output-pgsql-schema=country --create --latlong -G --hstore --tag-transform-script /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.lua -C 2500 --number-processes 5 -S /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.style country-latest.osm.pbf.

I did not see this problem when I Googled.

Is this a known issue and is there a work around?

Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211102/09465d71/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov  2 09:29:30 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 2 Nov 2021 16:29:30 +0000
Subject: [gdal-dev] [EXTERNAL] Re: ogr2ogr does not convert OSM polygons
Message-ID: <d84b9bf53ebf4eb891710fbc5bd67553@maanmittauslaitos.fi>

Hi,

I made a couple of quick tests with algeria-latest

ogrinfo algeria-latest.osm.pbf
INFO: Open of `algeria-latest.osm.pbf'
      using driver `OSM' successful.
1: points (Point)
2: lines (Line String)
3: multilinestrings (Multi Line String)
4: multipolygons (Multi Polygon)
5: other_relations (Geometry Collection)

ogr2ogr -f GPKG algeria.gpkg algeria-latest.osm.pbf
0...10...20...30...40...50...60...70...80...90...100 - done.

ogrinfo algeria.gpkg multipolygons -so
INFO: Open of `algeria.gpkg'
      using driver `GPKG' successful.

Layer name: multipolygons
Geometry: Multi Polygon
Feature Count: 725379

There are multipolygons in the data and ogr2ogr can convert them into "multipolygons" when the target is GeoPackage. Repeat the test. If you get the same result the issue must have a connection to PostGIS. If you get a different result then there is something else.  By GDAL is from gisinternals.com, version 3.4.0dev.

-Jukka Rahkonen-

L?hett?j?: Clay, Bruce <bclay at infoscitex.com>
L?hetetty: tiistai 2. marraskuuta 2021 18.19
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons

Jukka:
  Thanks for your reply.

I was in the progress of loading all OSM so I started with Africa and saw the same thing for all pbf files.  You can pick a small one such as algeria-latest.osm.pbf.  In my post I  just replaced the country name with the word "country" to be generic.  All of the files came from the website you mentioned.

I am using the OSGeo shell on Windows 10.  gdalinfo show version is 3.0.4
I did not change the osmconf.ini file.

After looking deeper into the table osm2pgsql created I noticed roads are not actually put in the osm roads layer.  administrative boundaries or other lines were in there. More lines are in the table created by osm2pgsql than the table created by ogr2ogr.

it looks like ogr2ogr would produce a similar approach if it would generate the polygon table.

Bruce


________________________________
From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Tuesday, November 2, 2021 11:11 AM
To: Clay, Bruce <bclay at infoscitex.com<mailto:bclay at infoscitex.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons


Hi,



What layers does "ogrinfo country_pbf" list? Can you reproduce the error with some small OSM country file from http://download.geofabrik.de/<https://usg02.safelinks.protection.office365.us/?url=http%3A%2F%2Fdownload.geofabrik.de%2F&data=04%7C01%7Cbclay%40infoscitex.com%7Cd3072cf4fd6944d85eba08d99e131143%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637714627010157244%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=W1Mn6rR62o9fuXMpTnvNafi5zTgtUG89%2F5XQMJNw2R0%3D&reserved=0>?

What is your operating system and GDAL version? Do you use the default osmconf.ini file? GDAL OSM driver and osm2pgsql are creating quite different database schemas so they are not very comparable.



-Jukka Rahkonen-



L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Clay, Bruce
L?hetetty: tiistai 2. marraskuuta 2021 16.22
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogr2ogr does not convert OSM polygons



When I convert a OSM pbf file to postgres using the following script it does not create a multipolygon table



ogr2ogr -f PostgreSQL PG:"dbname='open_street_map' host='db-host' port='5432' user='postgres' password='pwd'" -lco schema=country country_pbf  --config OSM_MAX_TMPFILE_SIZE 1024



When I do the same thing using osm2pgsql (shown below) it creates the polygon table but not the other_relations table



osm2pgsql -H hostname -U postgres -d open_street_map --output-pgsql-schema=country --create --latlong -G --hstore --tag-transform-script /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.lua -C 2500 --number-processes 5 -S /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.style country-latest.osm.pbf.



I did not see this problem when I Googled.



Is this a known issue and is there a work around?



Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211102/3a4efbcb/attachment.html>

From even.rouault at spatialys.com  Tue Nov  2 10:17:57 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 2 Nov 2021 18:17:57 +0100
Subject: [gdal-dev] current geolocation array implementation status
In-Reply-To: <CACX38Cp+hsvFWqGMa+UjHZo5E1yNrQqNbOFaw9VdzmGDrPcwsg@mail.gmail.com>
References: <CACX38Cp+hsvFWqGMa+UjHZo5E1yNrQqNbOFaw9VdzmGDrPcwsg@mail.gmail.com>
Message-ID: <7e9abff9-24bf-ec96-549e-00368953ec0c@spatialys.com>

Frederico,

Le 01/11/2021 ? 23:22, Frederico Liporace a ?crit?:
> Hello,
>
> I'm debugging an artifact that I encountered while using geolocation arrays:
> https://github.com/OSGeo/gdal/issues/4707
>
> While searching I found this ticket mentioning that the backward map
> implementation is broken and a new implementation is being considered:
> https://trac.osgeo.org/gdal/ticket/6959
>
> I could help with this implementation. Is there more context available
> on why it is being reconsidered? It seems to me that the general case
> for the backward implementation is very hard - for instance, what kind
> of discontinuities (gaps, overlaps) would be allowed in the
> geolocation array? Would it be expected to be robust enough to correct
> the Landsat 7 ETM+ SLC-off for instance? My guess is not.

Yes the general case is likely hard and would probably require special 
techniques that could possibly be sensor specific. I guess the 
requirements for improvements on the existing code would be at least not 
degrade what works currently.

An idea for a new implementation would be to use an iterative process 
using the backward map as an initial guess and then iterating with the 
bilinear interpolation of the forward path to refine the solution up to 
convergence to some threshold of error to decide (could be 15% of a 
pixel size like the default setting of the gdalwarp approximate 
transformer of coordinate transformations)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From Matt.Wilkie at yukon.ca  Tue Nov  2 10:23:49 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Tue, 2 Nov 2021 17:23:49 +0000
Subject: [gdal-dev] Gdal-dev mail archive search sites?
In-Reply-To: <afc8b4dc-e4cc-0791-8b5e-cbb333c47e10@gatewaygeomatics.com>
References: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
 <CALFmHhsQmZnk6FDwa0r5X=no8Z87BXE3sJ+L1XKVt5me+b7Lxw@mail.gmail.com>
 <dbf47c3edbe04465bc8fde5ee1161b37@yukon.ca>
 <afc8b4dc-e4cc-0791-8b5e-cbb333c47e10@gatewaygeomatics.com>
Message-ID: <09ab7223e5df4c068d5aa60c3d944961@yukon.ca>

> Hi Matt,
>
> mail-archive seems to be working now: 
> https://www.mail-archive.com/gdal-dev at lists.osgeo.org/

Oh that's excellent, they picked up the history as far back as April 2020 as well!

-Matt

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov  2 12:35:00 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 2 Nov 2021 19:35:00 +0000
Subject: [gdal-dev] [EXTERNAL] Re: ogr2ogr does not convert OSM polygons
Message-ID: <b08daf199588474bbd4b72b220524135@maanmittauslaitos.fi>

Hi,

Please take care to send mail also to the list.

The error that you get means probably that the Proj coordinate transformation library finds an older version of the proj.db file. With the gisinternals installation that file is in [gdal_installation_directory]\bin\proj7\share. Environmental variable PROJ_LIB should point into there. How did you launch ogr2ogr after installation? If you installed from the zip file you must run first the batch file "sdkshell.bat" for setting the paths and environment variables. If you used installer then you should launch GDAL command window from the shortcuts. In both cases when settings are OK you can run ogr2ogr simply as "ogr2ogr".

Other_relations contain geometries which are of geometry type "GeometryCollection". Unfortunately QGIS has very little support for GeometryCollections. You can see the attributes but not the geometries. If you are interested in the relations you must use some workarounds with QGIS or use other programs. For example OpenJUMP can do pretty well with relations but it is not so well documented.

-Jukka Rahkonen-

L?hett?j?: Clay, Bruce <bclay at infoscitex.com>
L?hetetty: tiistai 2. marraskuuta 2021 20.35
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons

Jukka:
  I upgraded to 3.4.0 from sysinternals.  All tables appear to be going in ok but I do get an error message for each table (shown below).  QGIS shows the SRID is 4326.  "other_relations" has a geometry column and it loads in QGIS but the geometry does not show.  It appears I can get what I need for my task, just annoying messages.

Should "other_relations" show in QGIS?

Thanks for you help.

Bruce

Z:\OpenStreetMap\release-1916-x64-gdal-mapserver\bin\ogr2ogr -f PostgreSQL PG:"dbname='open_street_map' host='hostname' port='5432' user='postgres' password='pwd'" -lco schema=algeria algeria-latest.osm.pbf  --config OSM_MAX_TMPFILE_SIZE 1024
0...10...20...30...40.ERROR 1: PROJ: proj_create_from_database: cannot build geodeticCRS 4326: SQLite error on SELECT extent.description, extent.south_lat, extent.north_lat, extent.west_lon, extent.east_lon, scope.scope, (CASE WHEN scope.scope LIKE '%large scale%' THEN 0 ELSE 1 END) AS score FROM usage JOIN extent ON usage.extent_auth_name = extent.auth_name AND usage.extent_code = extent.code JOIN scope ON usage.scope_auth_name = scope.auth_name AND usage.scope_code = scope.code WHERE object_table_name = ? AND object_auth_name = ? AND object_code = ? ORDER BY score, usage.auth_name, usage.code: no such table: usage
..50...60...70...80...90...100 - done.
________________________________
From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Tuesday, November 2, 2021 12:32 PM
To: Clay, Bruce <bclay at infoscitex.com<mailto:bclay at infoscitex.com>>
Subject: VS: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons


Actually, it was GDAL 3.3.1 from OSGeo4W installer.



-Jukka-



L?hett?j?: Clay, Bruce <bclay at infoscitex.com<mailto:bclay at infoscitex.com>>
L?hetetty: tiistai 2. marraskuuta 2021 18.19
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons



Jukka:

  Thanks for your reply.



I was in the progress of loading all OSM so I started with Africa and saw the same thing for all pbf files.  You can pick a small one such as algeria-latest.osm.pbf.  In my post I  just replaced the country name with the word "country" to be generic.  All of the files came from the website you mentioned.



I am using the OSGeo shell on Windows 10.  gdalinfo show version is 3.0.4

I did not change the osmconf.ini file.



After looking deeper into the table osm2pgsql created I noticed roads are not actually put in the osm roads layer.  administrative boundaries or other lines were in there. More lines are in the table created by osm2pgsql than the table created by ogr2ogr.



it looks like ogr2ogr would produce a similar approach if it would generate the polygon table.



Bruce





________________________________

From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Tuesday, November 2, 2021 11:11 AM
To: Clay, Bruce <bclay at infoscitex.com<mailto:bclay at infoscitex.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons



Hi,



What layers does "ogrinfo country_pbf" list? Can you reproduce the error with some small OSM country file from http://download.geofabrik.de/<https://usg02.safelinks.protection.office365.us/?url=http%3A%2F%2Fdownload.geofabrik.de%2F&data=04%7C01%7Cbclay%40infoscitex.com%7Cf969c27fe7114268415508d99e1e4f3c%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637714675287814046%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=dO7y8hY%2BQcMN4U9ZZLqXtu7OKiJZMqluf1MdbNa6gBc%3D&reserved=0>?

What is your operating system and GDAL version? Do you use the default osmconf.ini file? GDAL OSM driver and osm2pgsql are creating quite different database schemas so they are not very comparable.



-Jukka Rahkonen-



L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Clay, Bruce
L?hetetty: tiistai 2. marraskuuta 2021 16.22
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogr2ogr does not convert OSM polygons



When I convert a OSM pbf file to postgres using the following script it does not create a multipolygon table



ogr2ogr -f PostgreSQL PG:"dbname='open_street_map' host='db-host' port='5432' user='postgres' password='pwd'" -lco schema=country country_pbf  --config OSM_MAX_TMPFILE_SIZE 1024



When I do the same thing using osm2pgsql (shown below) it creates the polygon table but not the other_relations table



osm2pgsql -H hostname -U postgres -d open_street_map --output-pgsql-schema=country --create --latlong -G --hstore --tag-transform-script /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.lua -C 2500 --number-processes 5 -S /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.style country-latest.osm.pbf.



I did not see this problem when I Googled.



Is this a known issue and is there a work around?



Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211102/71f979e6/attachment.html>

From edzer.pebesma at uni-muenster.de  Tue Nov  2 15:02:01 2021
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 2 Nov 2021 23:02:01 +0100
Subject: [gdal-dev] GDAL 3.4.0 RC1 available
In-Reply-To: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>
References: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>
Message-ID: <44bb27bb-6558-ff98-6f0c-209365b9e55b@uni-muenster.de>

This may have nothing to do with this RC but more with PROJ, but I found 
it while doing checks with R spatial packages against this RC.

With a CRS shown below, calling OGRSpatialReference->GetName() resulted 
with PROJ 8.0.1 in "UTM Zone 25, Southern Hemisphere" ; with PROJ 8.1.1 
or 8.2.0 it results in "SOURCECRS". Is this intended, or is there a 
problem with the WKT, or an issue somewhere else?

BOUNDCRS[
     SOURCECRS[
         PROJCRS["UTM Zone 25, Southern Hemisphere",
             BASEGEOGCRS["GRS 1980(IUGG, 1980)",
                 DATUM["unknown",
                     ELLIPSOID["GRS80",6378137,298.257222101,
                         LENGTHUNIT["metre",1,
                             ID["EPSG",9001]]]],
                 PRIMEM["Greenwich",0,
                     ANGLEUNIT["degree",0.0174532925199433,
                         ID["EPSG",9122]]]],
             CONVERSION["Transverse Mercator",
                 METHOD["Transverse Mercator",
                     ID["EPSG",9807]],
                 PARAMETER["Latitude of natural origin",0,
                     ANGLEUNIT["degree",0.0174532925199433],
                     ID["EPSG",8801]],
                 PARAMETER["Longitude of natural origin",-33,
                     ANGLEUNIT["degree",0.0174532925199433],
                     ID["EPSG",8802]],
                 PARAMETER["Scale factor at natural origin",0.9996,
                     SCALEUNIT["unity",1],
                     ID["EPSG",8805]],
                 PARAMETER["False easting",500000,
                     LENGTHUNIT["metre",1],
                     ID["EPSG",8806]],
                 PARAMETER["False northing",10000000,
                     LENGTHUNIT["metre",1],
                     ID["EPSG",8807]]],
             CS[Cartesian,2],
                 AXIS["easting",east,
                     ORDER[1],
                     LENGTHUNIT["metre",1,
                         ID["EPSG",9001]]],
                 AXIS["northing",north,
                     ORDER[2],
                     LENGTHUNIT["metre",1,
                         ID["EPSG",9001]]]]],
     TARGETCRS[
         GEOGCRS["WGS 84",
             DATUM["World Geodetic System 1984",
                 ELLIPSOID["WGS 84",6378137,298.257223563,
                     LENGTHUNIT["metre",1]]],
             PRIMEM["Greenwich",0,
                 ANGLEUNIT["degree",0.0174532925199433]],
             CS[ellipsoidal,2],
                 AXIS["geodetic latitude (Lat)",north,
                     ORDER[1],
                     ANGLEUNIT["degree",0.0174532925199433]],
                 AXIS["geodetic longitude (Lon)",east,
                     ORDER[2],
                     ANGLEUNIT["degree",0.0174532925199433]],
             USAGE[
                 SCOPE["Horizontal component of 3D system."],
                 AREA["World."],
                 BBOX[-90,-180,90,180]],
             ID["EPSG",4326]]],
     ABRIDGEDTRANSFORMATION["Transformation to WGS84",
         METHOD["Position Vector transformation (geog2D domain)",
             ID["EPSG",9606]],
         PARAMETER["X-axis translation",0,
             ID["EPSG",8605]],
         PARAMETER["Y-axis translation",0,
             ID["EPSG",8606]],
         PARAMETER["Z-axis translation",0,
             ID["EPSG",8607]],
         PARAMETER["X-axis rotation",0,
             ID["EPSG",8608]],
         PARAMETER["Y-axis rotation",0,
             ID["EPSG",8609]],
         PARAMETER["Z-axis rotation",0,
             ID["EPSG",8610]],
         PARAMETER["Scale difference",1,
             ID["EPSG",8611]]]]


On 01/11/2021 17:27, Even Rouault wrote:
> Hi,
> 
> I have prepared a GDAL/OGR 3.4.0 release candidate.
> 
> Pick up an archive among the following ones (by ascending size):
> 
>  ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.xz
>  ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.gz
>  ? https://download.osgeo.org/gdal/3.4.0/gdal340rc1.zip
> 
> A snapshot of the gdalautotest suite is also available :
> 
> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.tar.gz
>  ? https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.zip
> 
> A snapshot of the documentation is at:
> 
>  ? https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip
> 
> GDAL-GRASS plugin:
> 
>  ? https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz
> 
> NEWS at:
> 
>  ? https://github.com/OSGeo/gdal/blob/v3.4.0RC1/gdal/NEWS.md
> 
> I'll call for a vote promoting it to final later this week if no
> serious problems are reported before.
> 
> Best regards,
> 
> Even
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From even.rouault at spatialys.com  Wed Nov  3 03:09:48 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 Nov 2021 11:09:48 +0100
Subject: [gdal-dev] GDAL 3.4.0 RC1 available
In-Reply-To: <44bb27bb-6558-ff98-6f0c-209365b9e55b@uni-muenster.de>
References: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>
 <44bb27bb-6558-ff98-6f0c-209365b9e55b@uni-muenster.de>
Message-ID: <1f39da44-afc0-92b4-bdf7-83183fb30c26@spatialys.com>

Edzer,

This was indeed a PROJ 8.2.0 bug that I've fixed per 
https://github.com/OSGeo/PROJ/pull/2917

I've also committed a workaround in GDAL itself that will go into 3.4.0 RC2

Even

Le 02/11/2021 ? 23:02, Edzer Pebesma a ?crit?:
> This may have nothing to do with this RC but more with PROJ, but I 
> found it while doing checks with R spatial packages against this RC.
>
> With a CRS shown below, calling OGRSpatialReference->GetName() 
> resulted with PROJ 8.0.1 in "UTM Zone 25, Southern Hemisphere" ; with 
> PROJ 8.1.1 or 8.2.0 it results in "SOURCECRS". Is this intended, or is 
> there a problem with the WKT, or an issue somewhere else?
>
> BOUNDCRS[
> ??? SOURCECRS[
> ??????? PROJCRS["UTM Zone 25, Southern Hemisphere",
> ??????????? BASEGEOGCRS["GRS 1980(IUGG, 1980)",
> ??????????????? DATUM["unknown",
> ??????????????????? ELLIPSOID["GRS80",6378137,298.257222101,
> ??????????????????????? LENGTHUNIT["metre",1,
> ??????????????????????????? ID["EPSG",9001]]]],
> ??????????????? PRIMEM["Greenwich",0,
> ??????????????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????????????? ID["EPSG",9122]]]],
> ??????????? CONVERSION["Transverse Mercator",
> ??????????????? METHOD["Transverse Mercator",
> ??????????????????? ID["EPSG",9807]],
> ??????????????? PARAMETER["Latitude of natural origin",0,
> ??????????????????? ANGLEUNIT["degree",0.0174532925199433],
> ??????????????????? ID["EPSG",8801]],
> ??????????????? PARAMETER["Longitude of natural origin",-33,
> ??????????????????? ANGLEUNIT["degree",0.0174532925199433],
> ??????????????????? ID["EPSG",8802]],
> ??????????????? PARAMETER["Scale factor at natural origin",0.9996,
> ??????????????????? SCALEUNIT["unity",1],
> ??????????????????? ID["EPSG",8805]],
> ??????????????? PARAMETER["False easting",500000,
> ??????????????????? LENGTHUNIT["metre",1],
> ??????????????????? ID["EPSG",8806]],
> ??????????????? PARAMETER["False northing",10000000,
> ??????????????????? LENGTHUNIT["metre",1],
> ??????????????????? ID["EPSG",8807]]],
> ??????????? CS[Cartesian,2],
> ??????????????? AXIS["easting",east,
> ??????????????????? ORDER[1],
> ??????????????????? LENGTHUNIT["metre",1,
> ??????????????????????? ID["EPSG",9001]]],
> ??????????????? AXIS["northing",north,
> ??????????????????? ORDER[2],
> ??????????????????? LENGTHUNIT["metre",1,
> ??????????????????????? ID["EPSG",9001]]]]],
> ??? TARGETCRS[
> ??????? GEOGCRS["WGS 84",
> ??????????? DATUM["World Geodetic System 1984",
> ??????????????? ELLIPSOID["WGS 84",6378137,298.257223563,
> ??????????????????? LENGTHUNIT["metre",1]]],
> ??????????? PRIMEM["Greenwich",0,
> ??????????????? ANGLEUNIT["degree",0.0174532925199433]],
> ??????????? CS[ellipsoidal,2],
> ??????????????? AXIS["geodetic latitude (Lat)",north,
> ??????????????????? ORDER[1],
> ??????????????????? ANGLEUNIT["degree",0.0174532925199433]],
> ??????????????? AXIS["geodetic longitude (Lon)",east,
> ??????????????????? ORDER[2],
> ??????????????????? ANGLEUNIT["degree",0.0174532925199433]],
> ??????????? USAGE[
> ??????????????? SCOPE["Horizontal component of 3D system."],
> ??????????????? AREA["World."],
> ??????????????? BBOX[-90,-180,90,180]],
> ??????????? ID["EPSG",4326]]],
> ??? ABRIDGEDTRANSFORMATION["Transformation to WGS84",
> ??????? METHOD["Position Vector transformation (geog2D domain)",
> ??????????? ID["EPSG",9606]],
> ??????? PARAMETER["X-axis translation",0,
> ??????????? ID["EPSG",8605]],
> ??????? PARAMETER["Y-axis translation",0,
> ??????????? ID["EPSG",8606]],
> ??????? PARAMETER["Z-axis translation",0,
> ??????????? ID["EPSG",8607]],
> ??????? PARAMETER["X-axis rotation",0,
> ??????????? ID["EPSG",8608]],
> ??????? PARAMETER["Y-axis rotation",0,
> ??????????? ID["EPSG",8609]],
> ??????? PARAMETER["Z-axis rotation",0,
> ??????????? ID["EPSG",8610]],
> ??????? PARAMETER["Scale difference",1,
> ??????????? ID["EPSG",8611]]]]
>
>
> On 01/11/2021 17:27, Even Rouault wrote:
>> Hi,
>>
>> I have prepared a GDAL/OGR 3.4.0 release candidate.
>>
>> Pick up an archive among the following ones (by ascending size):
>>
>> ?? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.xz
>> ?? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.gz
>> ?? https://download.osgeo.org/gdal/3.4.0/gdal340rc1.zip
>>
>> A snapshot of the gdalautotest suite is also available :
>>
>> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.tar.gz
>> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.zip
>>
>> A snapshot of the documentation is at:
>>
>> ?? https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip
>>
>> GDAL-GRASS plugin:
>>
>> ?? https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz
>>
>> NEWS at:
>>
>> ?? https://github.com/OSGeo/gdal/blob/v3.4.0RC1/gdal/NEWS.md
>>
>> I'll call for a vote promoting it to final later this week if no
>> serious problems are reported before.
>>
>> Best regards,
>>
>> Even
>>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Nov  3 04:01:01 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 Nov 2021 12:01:01 +0100
Subject: [gdal-dev] GDAL 3.4.0 RC2 available (was Re: GDAL 3.4.0 RC1
 available)
In-Reply-To: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>
References: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>
Message-ID: <ca145143-634a-395b-9614-2f2a11c92c14@spatialys.com>

Hi,

I've issued a RC2 with the following changes w.r.t RC1:
- mkgdaldist.sh: remove autom4te.cache dir from archive (fixes #4748)
- GTiff: explicitly enable strip choping
- MITAB: allow reading MID/MIF files with lines up to 1 million bytes 
(fixes #3943)
- OGRSpatialReference::GetName(): workaround a PROJ 8.2.0 bug for BoundCRS

Updated links:

 ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc2.tar.xz
 ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.4.0/gdal340rc2.zip
https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc2.zip
 ? https://github.com/OSGeo/gdal/blob/v3.4.0RC2/gdal/NEWS.md

Even

Le 01/11/2021 ? 17:27, Even Rouault a ?crit?:
> Hi,
>
> I have prepared a GDAL/OGR 3.4.0 release candidate.
>
> Pick up an archive among the following ones (by ascending size):
>
> ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.xz
> ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.4.0/gdal340rc1.zip
>
> A snapshot of the gdalautotest suite is also available :
>
> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.zip
>
> A snapshot of the documentation is at:
>
> ? https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip
>
> GDAL-GRASS plugin:
>
> ? https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz
>
> NEWS at:
>
> ? https://github.com/OSGeo/gdal/blob/v3.4.0RC1/gdal/NEWS.md
>
> I'll call for a vote promoting it to final later this week if no
> serious problems are reported before.
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From warmerdam at pobox.com  Wed Nov  3 06:14:10 2021
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed, 3 Nov 2021 09:14:10 -0400
Subject: [gdal-dev] current geolocation array implementation status
In-Reply-To: <7e9abff9-24bf-ec96-549e-00368953ec0c@spatialys.com>
References: <CACX38Cp+hsvFWqGMa+UjHZo5E1yNrQqNbOFaw9VdzmGDrPcwsg@mail.gmail.com>
 <7e9abff9-24bf-ec96-549e-00368953ec0c@spatialys.com>
Message-ID: <CA+YzLBfMwkNWLkK=T5L2Wq747LNMLrnDFvbZOe8PyrHcAncXag@mail.gmail.com>

Frederico,

I've updated the ticket to reflect that I backed away from work on a new
implementation.  I would still like to see a reliable geolocation
transformer.

I am also still interested in the general topic of iterative approximate
inverses for transformers which are not inherently invertible.

Best regards,
Frank


On Tue, Nov 2, 2021 at 1:18 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Frederico,
>
> Le 01/11/2021 ? 23:22, Frederico Liporace a ?crit :
> > Hello,
> >
> > I'm debugging an artifact that I encountered while using geolocation
> arrays:
> > https://github.com/OSGeo/gdal/issues/4707
> >
> > While searching I found this ticket mentioning that the backward map
> > implementation is broken and a new implementation is being considered:
> > https://trac.osgeo.org/gdal/ticket/6959
> >
> > I could help with this implementation. Is there more context available
> > on why it is being reconsidered? It seems to me that the general case
> > for the backward implementation is very hard - for instance, what kind
> > of discontinuities (gaps, overlaps) would be allowed in the
> > geolocation array? Would it be expected to be robust enough to correct
> > the Landsat 7 ETM+ SLC-off for instance? My guess is not.
>
> Yes the general case is likely hard and would probably require special
> techniques that could possibly be sensor specific. I guess the
> requirements for improvements on the existing code would be at least not
> degrade what works currently.
>
> An idea for a new implementation would be to use an iterative process
> using the backward map as an initial guess and then iterating with the
> bilinear interpolation of the forward path to refine the solution up to
> convergence to some threshold of error to decide (could be 15% of a
> pixel size like the default setting of the gdalwarp approximate
> transformer of coordinate transformations)
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam at pobox.com
light and sound - activate the windows | +1 650-701-7823
and watch the world go round - Rush    | Geospatial Software Developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211103/11adb8f5/attachment.html>

From j1 at jimenezshaw.com  Wed Nov  3 06:49:35 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 3 Nov 2021 14:49:35 +0100
Subject: [gdal-dev] gdal2tiles and EPSG:27700
Message-ID: <CADRrdKtXkwvaRYp-ytPGfVP_q=-sURN4vmj07OkACLL6eW54HQ@mail.gmail.com>

Hi

I have a GeoTIFF in EPSG:27700, "OSGB36 / British National Grid"
For consistency reasons, I want to run gdal2tiles with an equivalent
transformation than the one I will use later to transform points using a
PROJ pipeline. For consistency reasons I will use that pipeline along the
time to transform the points, so an update in EPSG/PROJ does not change the
results (I generate the gdal2tiles at project creation time, but run the
transformation on the marker points along the time).

Getting the PROJ pipeline is easy with something like
projinfo -s EPSG:27700 -t EPSG:3857 --spatial-test intersects -o PROJ
--single-line -q
(the option --spatial-test intersects is very important. Otherwise you get
a ballpark. I am not using grids. I can use the area of use of the GeoTIFF
as well) It produces
+proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717
+x_0=400000 +y_0=-100000 +ellps=airy +step +proj=push +v_3 +step +proj=cart
+ellps=airy +step +proj=helmert +x=446.448 +y=-125.157 +z=542.06 +rx=0.15
+ry=0.247 +rz=0.842 +s=-20.489 +convention=position_vector +step +inv
+proj=cart +ellps=WGS84 +step +proj=pop +v_3 +step +proj=webmerc +lat_0=0
+lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84

However this pipeline does not work in gdal2tiles with the "-s" option,
complaining with these errors, and placing the data in the wrong place (not
very far from Null Island)
ERROR 1: PROJ: proj_crs_get_coordinate_system: Object is not a SingleCRS
ERROR 1: PROJ: proj_as_wkt: PROJBasedOperation can only be exported to WKT2
ERROR 1: PROJ: proj_crs_get_coordinate_system: Object is not a SingleCRS
ERROR 1: PROJ: proj_as_wkt: PROJBasedOperation can only be exported to WKT2

Running projinfo on EPSG:27700 gives me the ballpark one
projinfo EPSG:27700 -o PROJ --single-line
PROJ.4 string:
+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000
+ellps=airy +units=m +no_defs +type=crs

The difference using this pipeline (without Helmert parameters) is about
100 m near London. Perfectly noticeable ;)

(I think it does not include the Helmert transformation, because the area
of use of that transformation is a bit smaller than the geographic crs,
EPSG:4277)

Of course I could create the command manually, but I would like to have a
generic solution for multiple projects.

What can I do?

I'm using GDAL 3.0.4 (Ubuntu 20.04)

Thanks
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211103/bf3c48d6/attachment.html>

From even.rouault at spatialys.com  Wed Nov  3 07:03:16 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 3 Nov 2021 15:03:16 +0100
Subject: [gdal-dev] gdal2tiles and EPSG:27700
In-Reply-To: <CADRrdKtXkwvaRYp-ytPGfVP_q=-sURN4vmj07OkACLL6eW54HQ@mail.gmail.com>
References: <CADRrdKtXkwvaRYp-ytPGfVP_q=-sURN4vmj07OkACLL6eW54HQ@mail.gmail.com>
Message-ID: <98b26b6e-0efe-532c-6f82-dab761121c73@spatialys.com>


Le 03/11/2021 ? 14:49, Javier Jimenez Shaw a ?crit?:
> Hi
>
> I have a GeoTIFF in EPSG:27700, "OSGB36 / British National Grid"
> For consistency reasons, I want to run gdal2tiles with an equivalent 
> transformation than the one I will use later to transform points using 
> a PROJ pipeline. For consistency reasons I will use that pipeline 
> along the time to transform the points, so an update in EPSG/PROJ does 
> not change the results (I generate the gdal2tiles at project creation 
> time, but run the transformation on the marker points along the time).
>
> Getting the PROJ pipeline is easy with something like
> projinfo -s EPSG:27700 -t EPSG:3857 --spatial-test intersects -o PROJ 
> --single-line -q
> (the option --spatial-test intersects is very important. Otherwise you 
> get a ballpark. I am not using grids. I can use the area of use of the 
> GeoTIFF as well) It produces
> +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2 
> +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=push 
> +v_3 +step +proj=cart +ellps=airy +step +proj=helmert +x=446.448 
> +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842 +s=-20.489 
> +convention=position_vector +step +inv +proj=cart +ellps=WGS84 +step 
> +proj=pop +v_3 +step +proj=webmerc +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 
> +ellps=WGS84
>
> However this pipeline does not work in gdal2tiles with the "-s" 
> option, complaining with these errors, and placing the data in the 
> wrong place (not very far from Null Island)
> ERROR 1: PROJ: proj_crs_get_coordinate_system: Object is not a SingleCRS
> ERROR 1: PROJ: proj_as_wkt: PROJBasedOperation can only be exported to 
> WKT2
> ERROR 1: PROJ: proj_crs_get_coordinate_system: Object is not a SingleCRS
> ERROR 1: PROJ: proj_as_wkt: PROJBasedOperation can only be exported to 
> WKT2
This is expected. A coordinate operation is not a source CRS.
>
> Running projinfo on EPSG:27700 gives me the ballpark one
> projinfo EPSG:27700 -o PROJ --single-line
> PROJ.4 string:
> +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 
> +y_0=-100000 +ellps=airy +units=m +no_defs +type=crs
>
> The difference using this pipeline (without Helmert parameters) is 
> about 100 m near London. Perfectly noticeable ;)
>
> (I think it does not include the Helmert transformation, because the 
> area of use of that transformation is a bit smaller than the 
> geographic crs, EPSG:4277)
>
> Of course I could create the command manually, but I would like to 
> have a generic solution for multiple projects.
>
> What can I do?

Enhance gdal2tiles to be able to specify coordinate transformations: 
https://github.com/OSGeo/gdal/issues/3998

You could also possibly use gdalwarp -ct to directly generate the input 
dataset in EPSG:3857 with the pipeline of your choice

Or in that instance just use -s "+proj=tmerc +lat_0=49 +lon_0=-2 
+k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs 
+towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From vladimir.sandoval at yandex.com  Wed Nov  3 09:53:55 2021
From: vladimir.sandoval at yandex.com (Vladimir Sandoval)
Date: Wed, 03 Nov 2021 19:53:55 +0300
Subject: [gdal-dev] /vsis3/ write geotiff - am I reading this wrong?
Message-ID: <641491635957804@mail.yandex.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211103/e54c2dfe/attachment.html>

From edzer.pebesma at uni-muenster.de  Wed Nov  3 12:33:41 2021
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 3 Nov 2021 20:33:41 +0100
Subject: [gdal-dev] GDAL 3.4.0 RC1 available
In-Reply-To: <1f39da44-afc0-92b4-bdf7-83183fb30c26@spatialys.com>
References: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>
 <44bb27bb-6558-ff98-6f0c-209365b9e55b@uni-muenster.de>
 <1f39da44-afc0-92b4-bdf7-83183fb30c26@spatialys.com>
Message-ID: <608088ab-a37a-f5c1-c14e-29b45df2d95c@uni-muenster.de>

Confirming the workaround for PROJ 8.2.0 - thanks for the quick fix!

On 03/11/2021 11:09, Even Rouault wrote:
> Edzer,
> 
> This was indeed a PROJ 8.2.0 bug that I've fixed per 
> https://github.com/OSGeo/PROJ/pull/2917
> 
> I've also committed a workaround in GDAL itself that will go into 3.4.0 RC2
> 
> Even
> 
> Le 02/11/2021 ? 23:02, Edzer Pebesma a ?crit?:
>> This may have nothing to do with this RC but more with PROJ, but I 
>> found it while doing checks with R spatial packages against this RC.
>>
>> With a CRS shown below, calling OGRSpatialReference->GetName() 
>> resulted with PROJ 8.0.1 in "UTM Zone 25, Southern Hemisphere" ; with 
>> PROJ 8.1.1 or 8.2.0 it results in "SOURCECRS". Is this intended, or is 
>> there a problem with the WKT, or an issue somewhere else?
>>
>> BOUNDCRS[
>> ??? SOURCECRS[
>> ??????? PROJCRS["UTM Zone 25, Southern Hemisphere",
>> ??????????? BASEGEOGCRS["GRS 1980(IUGG, 1980)",
>> ??????????????? DATUM["unknown",
>> ??????????????????? ELLIPSOID["GRS80",6378137,298.257222101,
>> ??????????????????????? LENGTHUNIT["metre",1,
>> ??????????????????????????? ID["EPSG",9001]]]],
>> ??????????????? PRIMEM["Greenwich",0,
>> ??????????????????? ANGLEUNIT["degree",0.0174532925199433,
>> ??????????????????????? ID["EPSG",9122]]]],
>> ??????????? CONVERSION["Transverse Mercator",
>> ??????????????? METHOD["Transverse Mercator",
>> ??????????????????? ID["EPSG",9807]],
>> ??????????????? PARAMETER["Latitude of natural origin",0,
>> ??????????????????? ANGLEUNIT["degree",0.0174532925199433],
>> ??????????????????? ID["EPSG",8801]],
>> ??????????????? PARAMETER["Longitude of natural origin",-33,
>> ??????????????????? ANGLEUNIT["degree",0.0174532925199433],
>> ??????????????????? ID["EPSG",8802]],
>> ??????????????? PARAMETER["Scale factor at natural origin",0.9996,
>> ??????????????????? SCALEUNIT["unity",1],
>> ??????????????????? ID["EPSG",8805]],
>> ??????????????? PARAMETER["False easting",500000,
>> ??????????????????? LENGTHUNIT["metre",1],
>> ??????????????????? ID["EPSG",8806]],
>> ??????????????? PARAMETER["False northing",10000000,
>> ??????????????????? LENGTHUNIT["metre",1],
>> ??????????????????? ID["EPSG",8807]]],
>> ??????????? CS[Cartesian,2],
>> ??????????????? AXIS["easting",east,
>> ??????????????????? ORDER[1],
>> ??????????????????? LENGTHUNIT["metre",1,
>> ??????????????????????? ID["EPSG",9001]]],
>> ??????????????? AXIS["northing",north,
>> ??????????????????? ORDER[2],
>> ??????????????????? LENGTHUNIT["metre",1,
>> ??????????????????????? ID["EPSG",9001]]]]],
>> ??? TARGETCRS[
>> ??????? GEOGCRS["WGS 84",
>> ??????????? DATUM["World Geodetic System 1984",
>> ??????????????? ELLIPSOID["WGS 84",6378137,298.257223563,
>> ??????????????????? LENGTHUNIT["metre",1]]],
>> ??????????? PRIMEM["Greenwich",0,
>> ??????????????? ANGLEUNIT["degree",0.0174532925199433]],
>> ??????????? CS[ellipsoidal,2],
>> ??????????????? AXIS["geodetic latitude (Lat)",north,
>> ??????????????????? ORDER[1],
>> ??????????????????? ANGLEUNIT["degree",0.0174532925199433]],
>> ??????????????? AXIS["geodetic longitude (Lon)",east,
>> ??????????????????? ORDER[2],
>> ??????????????????? ANGLEUNIT["degree",0.0174532925199433]],
>> ??????????? USAGE[
>> ??????????????? SCOPE["Horizontal component of 3D system."],
>> ??????????????? AREA["World."],
>> ??????????????? BBOX[-90,-180,90,180]],
>> ??????????? ID["EPSG",4326]]],
>> ??? ABRIDGEDTRANSFORMATION["Transformation to WGS84",
>> ??????? METHOD["Position Vector transformation (geog2D domain)",
>> ??????????? ID["EPSG",9606]],
>> ??????? PARAMETER["X-axis translation",0,
>> ??????????? ID["EPSG",8605]],
>> ??????? PARAMETER["Y-axis translation",0,
>> ??????????? ID["EPSG",8606]],
>> ??????? PARAMETER["Z-axis translation",0,
>> ??????????? ID["EPSG",8607]],
>> ??????? PARAMETER["X-axis rotation",0,
>> ??????????? ID["EPSG",8608]],
>> ??????? PARAMETER["Y-axis rotation",0,
>> ??????????? ID["EPSG",8609]],
>> ??????? PARAMETER["Z-axis rotation",0,
>> ??????????? ID["EPSG",8610]],
>> ??????? PARAMETER["Scale difference",1,
>> ??????????? ID["EPSG",8611]]]]
>>
>>
>> On 01/11/2021 17:27, Even Rouault wrote:
>>> Hi,
>>>
>>> I have prepared a GDAL/OGR 3.4.0 release candidate.
>>>
>>> Pick up an archive among the following ones (by ascending size):
>>>
>>> ?? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.xz
>>> ?? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.gz
>>> ?? https://download.osgeo.org/gdal/3.4.0/gdal340rc1.zip
>>>
>>> A snapshot of the gdalautotest suite is also available :
>>>
>>> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.tar.gz
>>> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.zip
>>>
>>> A snapshot of the documentation is at:
>>>
>>> ?? https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip
>>>
>>> GDAL-GRASS plugin:
>>>
>>> ?? https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz
>>>
>>> NEWS at:
>>>
>>> ?? https://github.com/OSGeo/gdal/blob/v3.4.0RC1/gdal/NEWS.md
>>>
>>> I'll call for a vote promoting it to final later this week if no
>>> serious problems are reported before.
>>>
>>> Best regards,
>>>
>>> Even
>>>
>>

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

From liporace at gmail.com  Wed Nov  3 16:06:18 2021
From: liporace at gmail.com (Frederico Liporace)
Date: Wed, 3 Nov 2021 20:06:18 -0300
Subject: [gdal-dev] current geolocation array implementation status
In-Reply-To: <CA+YzLBfMwkNWLkK=T5L2Wq747LNMLrnDFvbZOe8PyrHcAncXag@mail.gmail.com>
References: <CACX38Cp+hsvFWqGMa+UjHZo5E1yNrQqNbOFaw9VdzmGDrPcwsg@mail.gmail.com>
 <7e9abff9-24bf-ec96-549e-00368953ec0c@spatialys.com>
 <CA+YzLBfMwkNWLkK=T5L2Wq747LNMLrnDFvbZOe8PyrHcAncXag@mail.gmail.com>
Message-ID: <CACX38CrD2qevxo_f2w5iYq7==WVZgyau8wNOTqsXSCcfq4Ff9A@mail.gmail.com>

Even, Frank,

Thanks for the feedback. I found that for the case I reported the
artifacts are being generated in the backmap gap filling process, this
is removing the internal gaps as expected but is also incorrectly
extending the backmap outside the valid area, effectively replicating
the pixel values on the input image borders.

I'm working on a possible fix and getting used to the algorithm that
is currently implemented.

I think that the Landsat TM/ETM approach could be an interesting idea
for a new implementation. It defines a regular grid in the input space
and an algorithm to find the corresponding input cell for any pixel in
the output space. The algorithm is detailed in section 3.1.5.3.6.4 of
the Landsat 7 Image Assessment System Geometric ATBD (*), figures
3-25/26/27 gives a gist of the algorithm.

rgds.,

(*) https://www.usgs.gov/media/files/landsat-7-image-assessment-system-geometric-atbd

On Wed, Nov 3, 2021 at 10:14 AM Frank Warmerdam <warmerdam at pobox.com> wrote:
>
> Frederico,
>
> I've updated the ticket to reflect that I backed away from work on a new implementation.  I would still like to see a reliable geolocation transformer.
>
> I am also still interested in the general topic of iterative approximate inverses for transformers which are not inherently invertible.
>
> Best regards,
> Frank
>
>
> On Tue, Nov 2, 2021 at 1:18 PM Even Rouault <even.rouault at spatialys.com> wrote:
>>
>> Frederico,
>>
>> Le 01/11/2021 ? 23:22, Frederico Liporace a ?crit :
>> > Hello,
>> >
>> > I'm debugging an artifact that I encountered while using geolocation arrays:
>> > https://github.com/OSGeo/gdal/issues/4707
>> >
>> > While searching I found this ticket mentioning that the backward map
>> > implementation is broken and a new implementation is being considered:
>> > https://trac.osgeo.org/gdal/ticket/6959
>> >
>> > I could help with this implementation. Is there more context available
>> > on why it is being reconsidered? It seems to me that the general case
>> > for the backward implementation is very hard - for instance, what kind
>> > of discontinuities (gaps, overlaps) would be allowed in the
>> > geolocation array? Would it be expected to be robust enough to correct
>> > the Landsat 7 ETM+ SLC-off for instance? My guess is not.
>>
>> Yes the general case is likely hard and would probably require special
>> techniques that could possibly be sensor specific. I guess the
>> requirements for improvements on the existing code would be at least not
>> degrade what works currently.
>>
>> An idea for a new implementation would be to use an iterative process
>> using the backward map as an initial guess and then iterating with the
>> bilinear interpolation of the forward path to refine the solution up to
>> convergence to some threshold of error to decide (could be 15% of a
>> pixel size like the default setting of the gdalwarp approximate
>> transformer of coordinate transformations)
>>
>> Even
>>
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> --
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
> light and sound - activate the windows | +1 650-701-7823
> and watch the world go round - Rush    | Geospatial Software Developer

From even.rouault at spatialys.com  Wed Nov  3 17:00:04 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 4 Nov 2021 01:00:04 +0100
Subject: [gdal-dev] CMake & MacOSX frameworks
Message-ID: <cd0152f0-3258-62f0-6832-6b0a4fcc178e@spatialys.com>

Hi,

I've attempted to tackle CMake MacOSX framework builds and submitted a 
few fixes & improvements in https://github.com/OSGeo/gdal/pull/4760, but 
this is quite outside my zone of expertise, and I'm stuck on an issue 
with plugin loading (see the PR). I'm not sure either of the general 
directory layout of such builds. I'd appreciate if people with more 
experience & interest on the matter could help on that.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From pedrongvenancio at gmail.com  Thu Nov  4 03:26:08 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Thu, 4 Nov 2021 10:26:08 +0000
Subject: [gdal-dev] GDAL/OGR coordinate transformations candidate
 operations priority
In-Reply-To: <CAMCJChsnS24zger2o9fNsZMG056CUBwe7yXAUTmcs5TbzeGz8A@mail.gmail.com>
References: <CAMCJChvTGy6LhEvytEnQBWHoym4-21xm2GCQW7kVMZSGpi1E+g@mail.gmail.com>
 <3a134d4e-afae-e253-59a6-be661a0d7cee@spatialys.com>
 <CAMCJChtDCmEop0Of8_ESRkTbEP1ctdHORvdH0J15wYJcre2HJg@mail.gmail.com>
 <6b8365b7-0aeb-de91-db2a-fb3e9de8c66b@spatialys.com>
 <CAMCJChsnS24zger2o9fNsZMG056CUBwe7yXAUTmcs5TbzeGz8A@mail.gmail.com>
Message-ID: <CAMCJChuWTfPmeKo+zco1VtO3M9Cdj4ncHqfzXd6+VpPxwO-ajA@mail.gmail.com>

Hi Even,

I'm testing this fix on PROJ 8.2.0, but I'm getting the same output than
before the fix:

C:\OSGeo4W>gdaltransform -s_srs EPSG:20790 -t_srs EPSG:3763
Enter X Y [Z [T]] values separated by space, and press Return.
286415 431434
86412.5265012686 131433.856093867 0

C:\OSGeo4W>gdalinfo --version
GDAL 3.3.3, released 2021/10/25

C:\OSGeo4W>proj
Rel. 8.2.0, November 1st, 2021
usage: proj [-bdeEfiIlmorsStTvVwW [args]] [+opt[=arg] ...] [file ...]

Can you confirm?

Thanks! Best regards,
Pedro


Pedro Ven?ncio <pedrongvenancio at gmail.com> escreveu no dia quarta,
6/10/2021 ?(s) 00:38:

> So, the default will be the use of the operation with better accuracy,
>> right?
>>
>> yes, due to the issue with the prime meridian, PROJ was confused and
>> didn't find any valid operation with the appropriate area of use, and thus
>> it fell back to an operation not using a grid
>>
> Perfect, thank you very much Even!
>
> Pedro
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211104/310eec0c/attachment.html>

From even.rouault at spatialys.com  Thu Nov  4 05:30:18 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 4 Nov 2021 13:30:18 +0100
Subject: [gdal-dev] GDAL 3.4.0 RC3 available
In-Reply-To: <ca145143-634a-395b-9614-2f2a11c92c14@spatialys.com>
References: <1646a36c-9bf5-d6bb-7bae-eb7833344061@spatialys.com>
 <ca145143-634a-395b-9614-2f2a11c92c14@spatialys.com>
Message-ID: <f0cef744-1fcb-90c7-d747-d61372a2b5ae@spatialys.com>

Hi,

a ultimate RC3 whose only change w.r.t RC2 is to fix a build issue in 
the DGNv8 driver (that depends on the proprietary ODA Teigha library, so 
only affects a subset of users)

Updated links:

 ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc3.tar.xz
 ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc3.tar.gz
 ? https://download.osgeo.org/gdal/3.4.0/gdal340rc3.zip
 ? https://github.com/OSGeo/gdal/blob/v3.4.0RC3/gdal/NEWS.md

Even

Le 03/11/2021 ? 12:01, Even Rouault a ?crit?:
> Hi,
>
> I've issued a RC2 with the following changes w.r.t RC1:
> - mkgdaldist.sh: remove autom4te.cache dir from archive (fixes #4748)
> - GTiff: explicitly enable strip choping
> - MITAB: allow reading MID/MIF files with lines up to 1 million bytes 
> (fixes #3943)
> - OGRSpatialReference::GetName(): workaround a PROJ 8.2.0 bug for 
> BoundCRS
>
> Updated links:
>
> ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc2.tar.xz
> ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc2.tar.gz
> ? https://download.osgeo.org/gdal/3.4.0/gdal340rc2.zip
> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc2.tar.gz
> ? https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc2.zip
> ? https://github.com/OSGeo/gdal/blob/v3.4.0RC2/gdal/NEWS.md
>
> Even
>
> Le 01/11/2021 ? 17:27, Even Rouault a ?crit?:
>> Hi,
>>
>> I have prepared a GDAL/OGR 3.4.0 release candidate.
>>
>> Pick up an archive among the following ones (by ascending size):
>>
>> ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.xz
>> ? https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0rc1.tar.gz
>> ? https://download.osgeo.org/gdal/3.4.0/gdal340rc1.zip
>>
>> A snapshot of the gdalautotest suite is also available :
>>
>> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.tar.gz
>> https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0rc1.zip
>>
>> A snapshot of the documentation is at:
>>
>> ? https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip
>>
>> GDAL-GRASS plugin:
>>
>> ? https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz
>>
>> NEWS at:
>>
>> ? https://github.com/OSGeo/gdal/blob/v3.4.0RC1/gdal/NEWS.md
>>
>> I'll call for a vote promoting it to final later this week if no
>> serious problems are reported before.
>>
>> Best regards,
>>
>> Even
>>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Nov  4 05:33:09 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 4 Nov 2021 13:33:09 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
Message-ID: <9ffcdbb7-d925-be0f-5c7a-8de6ecfa15e1@spatialys.com>

Hi,

RC3 should be the last iteration needed to allow 3.4.0 to be released.

Motion:

Adopt GDAL 3.4.0 RC3 as final 3.4.0 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov  4 07:23:50 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 4 Nov 2021 14:23:50 +0000
Subject: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
Message-ID: <263ffa069fea4a36bd79fceee48898e1@maanmittauslaitos.fi>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: torstai 4. marraskuuta 2021 14.33
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue

Hi,

RC3 should be the last iteration needed to allow 3.4.0 to be released.

Motion:

Adopt GDAL 3.4.0 RC3 as final 3.4.0 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From mateusz at loskot.net  Thu Nov  4 08:02:47 2021
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 4 Nov 2021 16:02:47 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
In-Reply-To: <263ffa069fea4a36bd79fceee48898e1@maanmittauslaitos.fi>
References: <263ffa069fea4a36bd79fceee48898e1@maanmittauslaitos.fi>
Message-ID: <CABUeae8iHBW6GXc8m4t9xcr2F5aU5RuG6gpVY0kfusifQNoyBw@mail.gmail.com>

+1 Mateusz

On Thu, 4 Nov 2021 at 15:23, Rahkonen Jukka (MML)
<jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> +1
>
> -Jukka Rahkonen-
>
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
> L?hetetty: torstai 4. marraskuuta 2021 14.33
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
>
> Hi,
>
> RC3 should be the last iteration needed to allow 3.4.0 to be released.
>
> Motion:
>
> Adopt GDAL 3.4.0 RC3 as final 3.4.0 release
>
> Starting with my +1
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Mateusz Loskot, http://mateusz.loskot.net

From howard at hobu.co  Thu Nov  4 08:23:51 2021
From: howard at hobu.co (Howard Butler)
Date: Thu, 4 Nov 2021 10:23:51 -0500
Subject: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
In-Reply-To: <CABUeae8iHBW6GXc8m4t9xcr2F5aU5RuG6gpVY0kfusifQNoyBw@mail.gmail.com>
References: <263ffa069fea4a36bd79fceee48898e1@maanmittauslaitos.fi>
 <CABUeae8iHBW6GXc8m4t9xcr2F5aU5RuG6gpVY0kfusifQNoyBw@mail.gmail.com>
Message-ID: <13215D7D-9D54-476A-B180-7F7A5226A845@hobu.co>

+1 Howard

> On Nov 4, 2021, at 10:02 AM, Mateusz Loskot <mateusz at loskot.net> wrote:
> 
> +1 Mateusz
> 
> On Thu, 4 Nov 2021 at 15:23, Rahkonen Jukka (MML)
> <jukka.rahkonen at maanmittauslaitos.fi> wrote:
>> 
>> +1
>> 
>> -Jukka Rahkonen-
>> 
>> -----Alkuper?inen viesti-----
>> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
>> L?hetetty: torstai 4. marraskuuta 2021 14.33
>> Vastaanottaja: gdal-dev at lists.osgeo.org
>> Aihe: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
>> 
>> Hi,
>> 
>> RC3 should be the last iteration needed to allow 3.4.0 to be released.
>> 
>> Motion:
>> 
>> Adopt GDAL 3.4.0 RC3 as final 3.4.0 release
>> 
>> Starting with my +1
>> 
>> Even
>> 
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>> 
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> 
> -- 
> Mateusz Loskot, http://mateusz.loskot.net
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From dmorissette at mapgears.com  Thu Nov  4 08:28:56 2021
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Thu, 4 Nov 2021 11:28:56 -0400
Subject: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
In-Reply-To: <13215D7D-9D54-476A-B180-7F7A5226A845@hobu.co>
References: <263ffa069fea4a36bd79fceee48898e1@maanmittauslaitos.fi>
 <CABUeae8iHBW6GXc8m4t9xcr2F5aU5RuG6gpVY0kfusifQNoyBw@mail.gmail.com>
 <13215D7D-9D54-476A-B180-7F7A5226A845@hobu.co>
Message-ID: <074d374e-b7fd-a647-a0a6-88d85091cd94@mapgears.com>

+1

Daniel

On 2021-11-04 11:23, Howard Butler wrote:
> +1 Howard
> 
>> On Nov 4, 2021, at 10:02 AM, Mateusz Loskot <mateusz at loskot.net> wrote:
>>
>> +1 Mateusz
>>
>> On Thu, 4 Nov 2021 at 15:23, Rahkonen Jukka (MML)
>> <jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>>
>>> +1
>>>
>>> -Jukka Rahkonen-
>>>
>>> -----Alkuper?inen viesti-----
>>> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
>>> L?hetetty: torstai 4. marraskuuta 2021 14.33
>>> Vastaanottaja: gdal-dev at lists.osgeo.org
>>> Aihe: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
>>>
>>> Hi,
>>>
>>> RC3 should be the last iteration needed to allow 3.4.0 to be released.
>>>
>>> Motion:
>>>
>>> Adopt GDAL 3.4.0 RC3 as final 3.4.0 release
>>>
>>> Starting with my +1
>>>
>>> Even
>>>
>>> --
>>> http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>> -- 
>> Mateusz Loskot, http://mateusz.loskot.net
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From vladimir.sandoval at yandex.com  Thu Nov  4 09:32:24 2021
From: vladimir.sandoval at yandex.com (Vladimir Sandoval)
Date: Thu, 04 Nov 2021 19:32:24 +0300
Subject: [gdal-dev] /vsis3/ write geotiff - am I reading this wrong?
In-Reply-To: <641491635957804@mail.yandex.com>
References: <641491635957804@mail.yandex.com>
Message-ID: <880251636043498@mail.yandex.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211104/8d9b901b/attachment.html>

From cgodkin at gmail.com  Fri Nov  5 07:25:28 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Fri, 5 Nov 2021 07:25:28 -0700
Subject: [gdal-dev] GeoTIFF gdalwarp puzzle
Message-ID: <CAE=8kmmrL0tVh4mL9z3g30uCSKpKhaqqS93f1OYT21FyBxcEhQ@mail.gmail.com>

Hi,

I'm working with some aviation charts and found one that behaves in a
puzzling manner.
This page
https://www.faa.gov/air_traffic/flight_info/aeronav/digital_products/vfr/
has two Caribbean VFR charts in GeoTIFF format.

I have been trying to run gdalwarp on "Caribbean 2 VFR Chart.tif" but I
only ever get a small area out of the map instead of the whole extent.
Specifically this command gives me just a smaller area output GeoTIFF:

gdalwarp -t_srs EPSG:4326 "Caribbean 2 VFR Chart.tif" out.tif --debug ON

I don't see anything from the debug output that explains this.

The other chart, "Caribbean 1 VFR Chart.tif," does not behave this way,
though the debug output from the same gdalwarp operation is much longer.

I can't see anything wrong.

I dragged both files into ArcGIS desktop explorer and both are displayed in
the proper location and in their entirety.

(I actually have a more elaborate workflow that works fine with chart #1
but this is the simplest operation I can think of that shows the problem
with chart #2.)

Thank you very much,
carl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211105/bed531ad/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov  5 07:51:34 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 5 Nov 2021 14:51:34 +0000
Subject: [gdal-dev] GeoTIFF gdalwarp puzzle
Message-ID: <daf841b57d1b4db9ba95ec07fa0801ad@maanmittauslaitos.fi>

Hi,

Works for me on Windows with GDAL 3.4.0dev and Oct 07 2021 version of the file.

gdalwarp -t_srs epsg:4326 "Caribbean 2 VFR Chart.tif" caribbean_4326.tif
Copying color table from Caribbean 2 VFR Chart.tif to new file.
Creating output file that is 18583P x 12118L.
Processing Caribbean 2 VFR Chart.tif [1/1] : 0...10...20...30...40...50...60...70...80...90...100 - done.

The map in caribbean_4326.tif is complete.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Carl Godkin
L?hetetty: perjantai 5. marraskuuta 2021 16.25
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] GeoTIFF gdalwarp puzzle

Hi,

I'm working with some aviation charts and found one that behaves in a puzzling manner.
This page https://www.faa.gov/air_traffic/flight_info/aeronav/digital_products/vfr/
has two Caribbean VFR charts in GeoTIFF format.

I have been trying to run gdalwarp on "Caribbean 2 VFR Chart.tif" but I only ever get a small area out of the map instead of the whole extent.  Specifically this command gives me just a smaller area output GeoTIFF:

gdalwarp -t_srs EPSG:4326 "Caribbean 2 VFR Chart.tif" out.tif --debug ON

I don't see anything from the debug output that explains this.

The other chart, "Caribbean 1 VFR Chart.tif," does not behave this way, though the debug output from the same gdalwarp operation is much longer.

I can't see anything wrong.

I dragged both files into ArcGIS desktop explorer and both are displayed in the proper location and in their entirety.

(I actually have a more elaborate workflow that works fine with chart #1 but this is the simplest operation I can think of that shows the problem with chart #2.)

Thank you very much,
carl


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211105/6a3f2d7c/attachment.html>

From cgodkin at gmail.com  Fri Nov  5 08:02:30 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Fri, 5 Nov 2021 08:02:30 -0700
Subject: [gdal-dev] GeoTIFF gdalwarp puzzle
In-Reply-To: <daf841b57d1b4db9ba95ec07fa0801ad@maanmittauslaitos.fi>
References: <daf841b57d1b4db9ba95ec07fa0801ad@maanmittauslaitos.fi>
Message-ID: <CAE=8kmkL8Q20qBDQH3_oyk+xf0wHAiZ3FGAnazOfzVNG3ZYVWg@mail.gmail.com>

Thanks for checking, Jukka.

I am using GDAL 3.3.3 and get a smaller range:

d:\gdal-3.3.3\bin64\gdalwarp.exe  -t_srs epsg:4326 "Caribbean 2 VFR
Chart.tif" caribbean_4326.tif
Copying color table from Caribbean 2 VFR Chart.tif to new file.
Creating output file that is 18714P x 10830L.
Processing Caribbean 2 VFR Chart.tif [1/1] :
0...10...20...30...40...50...60...70...80...90...100 - done.

Is there a bug fix between 3.3.3 and 3.4.0 that could account for this?

Meanwhile, I'll try to get GDAL 3.4.0 going here.  Thanks,

carl

On Fri, Nov 5, 2021 at 7:51 AM Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Works for me on Windows with GDAL 3.4.0dev and Oct 07 2021 version of the
> file.
>
> gdalwarp -t_srs epsg:4326 "Caribbean 2 VFR Chart.tif" caribbean_4326.tif
>
> Copying color table from Caribbean 2 VFR Chart.tif to new file.
>
> Creating output file that is 18583P x 12118L.
>
> Processing Caribbean 2 VFR Chart.tif [1/1] :
> 0...10...20...30...40...50...60...70...80...90...100 - done.
>
>
>
> The map in caribbean_4326.tif is complete.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Carl
> Godkin
> *L?hetetty:* perjantai 5. marraskuuta 2021 16.25
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] GeoTIFF gdalwarp puzzle
>
>
>
> Hi,
>
>
>
> I'm working with some aviation charts and found one that behaves in a
> puzzling manner.
>
> This page
> https://www.faa.gov/air_traffic/flight_info/aeronav/digital_products/vfr/
>
> has two Caribbean VFR charts in GeoTIFF format.
>
>
>
> I have been trying to run gdalwarp on "Caribbean 2 VFR Chart.tif" but I
> only ever get a small area out of the map instead of the whole extent.
> Specifically this command gives me just a smaller area output GeoTIFF:
>
>
>
> gdalwarp -t_srs EPSG:4326 "Caribbean 2 VFR Chart.tif" out.tif --debug ON
>
>
>
> I don't see anything from the debug output that explains this.
>
>
>
> The other chart, "Caribbean 1 VFR Chart.tif," does not behave this way,
> though the debug output from the same gdalwarp operation is much longer.
>
>
>
> I can't see anything wrong.
>
>
>
> I dragged both files into ArcGIS desktop explorer and both are displayed
> in the proper location and in their entirety.
>
>
>
> (I actually have a more elaborate workflow that works fine with chart #1
> but this is the simplest operation I can think of that shows the problem
> with chart #2.)
>
>
>
> Thank you very much,
>
> carl
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211105/08c87aa9/attachment-0001.html>

From cgodkin at gmail.com  Fri Nov  5 08:09:52 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Fri, 5 Nov 2021 08:09:52 -0700
Subject: [gdal-dev] GeoTIFF gdalwarp puzzle
In-Reply-To: <CAE=8kmkL8Q20qBDQH3_oyk+xf0wHAiZ3FGAnazOfzVNG3ZYVWg@mail.gmail.com>
References: <daf841b57d1b4db9ba95ec07fa0801ad@maanmittauslaitos.fi>
 <CAE=8kmkL8Q20qBDQH3_oyk+xf0wHAiZ3FGAnazOfzVNG3ZYVWg@mail.gmail.com>
Message-ID: <CAE=8kmmsjPYX-P6FG3j2ALLj3eAipubk0nbwsWaD+3KD8b2iZQ@mail.gmail.com>

Partially answering myself:

I just tried again with GDAL 2.4.4 (2020/01/08) that I have on my system as
part of MS4W and it works!

I have a way forward now.  I'm still going to build GDAL 3.4.0 and try it
there.

Thanks a lot,

carl

On Fri, Nov 5, 2021 at 8:02 AM Carl Godkin <cgodkin at gmail.com> wrote:

> Thanks for checking, Jukka.
>
> I am using GDAL 3.3.3 and get a smaller range:
>
> d:\gdal-3.3.3\bin64\gdalwarp.exe  -t_srs epsg:4326 "Caribbean 2 VFR
> Chart.tif" caribbean_4326.tif
> Copying color table from Caribbean 2 VFR Chart.tif to new file.
> Creating output file that is 18714P x 10830L.
> Processing Caribbean 2 VFR Chart.tif [1/1] :
> 0...10...20...30...40...50...60...70...80...90...100 - done.
>
> Is there a bug fix between 3.3.3 and 3.4.0 that could account for this?
>
> Meanwhile, I'll try to get GDAL 3.4.0 going here.  Thanks,
>
> carl
>
> On Fri, Nov 5, 2021 at 7:51 AM Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
>> Hi,
>>
>>
>>
>> Works for me on Windows with GDAL 3.4.0dev and Oct 07 2021 version of the
>> file.
>>
>> gdalwarp -t_srs epsg:4326 "Caribbean 2 VFR Chart.tif" caribbean_4326.tif
>>
>> Copying color table from Caribbean 2 VFR Chart.tif to new file.
>>
>> Creating output file that is 18583P x 12118L.
>>
>> Processing Caribbean 2 VFR Chart.tif [1/1] :
>> 0...10...20...30...40...50...60...70...80...90...100 - done.
>>
>>
>>
>> The map in caribbean_4326.tif is complete.
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Carl
>> Godkin
>> *L?hetetty:* perjantai 5. marraskuuta 2021 16.25
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Aihe:* [gdal-dev] GeoTIFF gdalwarp puzzle
>>
>>
>>
>> Hi,
>>
>>
>>
>> I'm working with some aviation charts and found one that behaves in a
>> puzzling manner.
>>
>> This page
>> https://www.faa.gov/air_traffic/flight_info/aeronav/digital_products/vfr/
>>
>>
>> has two Caribbean VFR charts in GeoTIFF format.
>>
>>
>>
>> I have been trying to run gdalwarp on "Caribbean 2 VFR Chart.tif" but I
>> only ever get a small area out of the map instead of the whole extent.
>> Specifically this command gives me just a smaller area output GeoTIFF:
>>
>>
>>
>> gdalwarp -t_srs EPSG:4326 "Caribbean 2 VFR Chart.tif" out.tif --debug ON
>>
>>
>>
>> I don't see anything from the debug output that explains this.
>>
>>
>>
>> The other chart, "Caribbean 1 VFR Chart.tif," does not behave this way,
>> though the debug output from the same gdalwarp operation is much longer.
>>
>>
>>
>> I can't see anything wrong.
>>
>>
>>
>> I dragged both files into ArcGIS desktop explorer and both are displayed
>> in the proper location and in their entirety.
>>
>>
>>
>> (I actually have a more elaborate workflow that works fine with chart #1
>> but this is the simplest operation I can think of that shows the problem
>> with chart #2.)
>>
>>
>>
>> Thank you very much,
>>
>> carl
>>
>>
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211105/3c6c53db/attachment.html>

From cgodkin at gmail.com  Fri Nov  5 08:36:25 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Fri, 5 Nov 2021 08:36:25 -0700
Subject: [gdal-dev] GeoTIFF gdalwarp puzzle
In-Reply-To: <CAE=8kmmsjPYX-P6FG3j2ALLj3eAipubk0nbwsWaD+3KD8b2iZQ@mail.gmail.com>
References: <daf841b57d1b4db9ba95ec07fa0801ad@maanmittauslaitos.fi>
 <CAE=8kmkL8Q20qBDQH3_oyk+xf0wHAiZ3FGAnazOfzVNG3ZYVWg@mail.gmail.com>
 <CAE=8kmmsjPYX-P6FG3j2ALLj3eAipubk0nbwsWaD+3KD8b2iZQ@mail.gmail.com>
Message-ID: <CAE=8km=XBxidJ5grVssJ==-3sfTnikVa4vf8WNya_oq7y4U+jw@mail.gmail.com>

...And it works fine for me in 3.4.0 as well.  Guess I just got unlucky
with the GDAL 3.3.x series!

Thanks,
carl

On Fri, Nov 5, 2021 at 8:09 AM Carl Godkin <cgodkin at gmail.com> wrote:

> Partially answering myself:
>
> I just tried again with GDAL 2.4.4 (2020/01/08) that I have on my system
> as part of MS4W and it works!
>
> I have a way forward now.  I'm still going to build GDAL 3.4.0 and try it
> there.
>
> Thanks a lot,
>
> carl
>
> On Fri, Nov 5, 2021 at 8:02 AM Carl Godkin <cgodkin at gmail.com> wrote:
>
>> Thanks for checking, Jukka.
>>
>> I am using GDAL 3.3.3 and get a smaller range:
>>
>> d:\gdal-3.3.3\bin64\gdalwarp.exe  -t_srs epsg:4326 "Caribbean 2 VFR
>> Chart.tif" caribbean_4326.tif
>> Copying color table from Caribbean 2 VFR Chart.tif to new file.
>> Creating output file that is 18714P x 10830L.
>> Processing Caribbean 2 VFR Chart.tif [1/1] :
>> 0...10...20...30...40...50...60...70...80...90...100 - done.
>>
>> Is there a bug fix between 3.3.3 and 3.4.0 that could account for this?
>>
>> Meanwhile, I'll try to get GDAL 3.4.0 going here.  Thanks,
>>
>> carl
>>
>> On Fri, Nov 5, 2021 at 7:51 AM Rahkonen Jukka (MML) <
>> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>
>>> Hi,
>>>
>>>
>>>
>>> Works for me on Windows with GDAL 3.4.0dev and Oct 07 2021 version of
>>> the file.
>>>
>>> gdalwarp -t_srs epsg:4326 "Caribbean 2 VFR Chart.tif" caribbean_4326.tif
>>>
>>> Copying color table from Caribbean 2 VFR Chart.tif to new file.
>>>
>>> Creating output file that is 18583P x 12118L.
>>>
>>> Processing Caribbean 2 VFR Chart.tif [1/1] :
>>> 0...10...20...30...40...50...60...70...80...90...100 - done.
>>>
>>>
>>>
>>> The map in caribbean_4326.tif is complete.
>>>
>>>
>>>
>>> -Jukka Rahkonen-
>>>
>>>
>>>
>>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Carl
>>> Godkin
>>> *L?hetetty:* perjantai 5. marraskuuta 2021 16.25
>>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>>> *Aihe:* [gdal-dev] GeoTIFF gdalwarp puzzle
>>>
>>>
>>>
>>> Hi,
>>>
>>>
>>>
>>> I'm working with some aviation charts and found one that behaves in a
>>> puzzling manner.
>>>
>>> This page
>>> https://www.faa.gov/air_traffic/flight_info/aeronav/digital_products/vfr/
>>>
>>>
>>> has two Caribbean VFR charts in GeoTIFF format.
>>>
>>>
>>>
>>> I have been trying to run gdalwarp on "Caribbean 2 VFR Chart.tif" but I
>>> only ever get a small area out of the map instead of the whole extent.
>>> Specifically this command gives me just a smaller area output GeoTIFF:
>>>
>>>
>>>
>>> gdalwarp -t_srs EPSG:4326 "Caribbean 2 VFR Chart.tif" out.tif --debug ON
>>>
>>>
>>>
>>> I don't see anything from the debug output that explains this.
>>>
>>>
>>>
>>> The other chart, "Caribbean 1 VFR Chart.tif," does not behave this way,
>>> though the debug output from the same gdalwarp operation is much longer.
>>>
>>>
>>>
>>> I can't see anything wrong.
>>>
>>>
>>>
>>> I dragged both files into ArcGIS desktop explorer and both are displayed
>>> in the proper location and in their entirety.
>>>
>>>
>>>
>>> (I actually have a more elaborate workflow that works fine with chart #1
>>> but this is the simplest operation I can think of that shows the problem
>>> with chart #2.)
>>>
>>>
>>>
>>> Thank you very much,
>>>
>>> carl
>>>
>>>
>>>
>>>
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211105/1c1dc70b/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov  5 09:22:42 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 5 Nov 2021 16:22:42 +0000
Subject: [gdal-dev] GeoTIFF gdalwarp puzzle
Message-ID: <ffaaa8086fc440869c361e123e6f2ecf@maanmittauslaitos.fi>

Hi,

I think it is not bad luck but something weird in GDAL 3.3. I tried again with version 3.3.1 from OSGeo4W and just like you I got also less pixels into output:

gdalwarp -t_srs epsg:4326 "Caribbean 2 VFR Chart.tif" caribbean_4326_2.tif
Copying color table from Caribbean 2 VFR Chart.tif to new file.
Creating output file that is 18714P x 10830L.

But this warped image is not at all the same than the one produced with GDAL 3.4. The image lacks all the legends etc. but not only those. I wonder is the TIFF file has been written in some special way on several pages or something.


-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Carl Godkin
L?hetetty: perjantai 5. marraskuuta 2021 17.36
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] GeoTIFF gdalwarp puzzle

...And it works fine for me in 3.4.0 as well.  Guess I just got unlucky with the GDAL 3.3.x series!

Thanks,
carl

On Fri, Nov 5, 2021 at 8:09 AM Carl Godkin <cgodkin at gmail.com<mailto:cgodkin at gmail.com>> wrote:
Partially answering myself:

I just tried again with GDAL 2.4.4 (2020/01/08) that I have on my system as part of MS4W and it works!

I have a way forward now.  I'm still going to build GDAL 3.4.0 and try it there.

Thanks a lot,

carl

On Fri, Nov 5, 2021 at 8:02 AM Carl Godkin <cgodkin at gmail.com<mailto:cgodkin at gmail.com>> wrote:
Thanks for checking, Jukka.

I am using GDAL 3.3.3 and get a smaller range:

d:\gdal-3.3.3\bin64\gdalwarp.exe  -t_srs epsg:4326 "Caribbean 2 VFR Chart.tif" caribbean_4326.tif
Copying color table from Caribbean 2 VFR Chart.tif to new file.
Creating output file that is 18714P x 10830L.
Processing Caribbean 2 VFR Chart.tif [1/1] : 0...10...20...30...40...50...60...70...80...90...100 - done.

Is there a bug fix between 3.3.3 and 3.4.0 that could account for this?

Meanwhile, I'll try to get GDAL 3.4.0 going here.  Thanks,

carl

On Fri, Nov 5, 2021 at 7:51 AM Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Works for me on Windows with GDAL 3.4.0dev and Oct 07 2021 version of the file.

gdalwarp -t_srs epsg:4326 "Caribbean 2 VFR Chart.tif" caribbean_4326.tif
Copying color table from Caribbean 2 VFR Chart.tif to new file.
Creating output file that is 18583P x 12118L.
Processing Caribbean 2 VFR Chart.tif [1/1] : 0...10...20...30...40...50...60...70...80...90...100 - done.

The map in caribbean_4326.tif is complete.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Carl Godkin
L?hetetty: perjantai 5. marraskuuta 2021 16.25
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] GeoTIFF gdalwarp puzzle

Hi,

I'm working with some aviation charts and found one that behaves in a puzzling manner.
This page https://www.faa.gov/air_traffic/flight_info/aeronav/digital_products/vfr/
has two Caribbean VFR charts in GeoTIFF format.

I have been trying to run gdalwarp on "Caribbean 2 VFR Chart.tif" but I only ever get a small area out of the map instead of the whole extent.  Specifically this command gives me just a smaller area output GeoTIFF:

gdalwarp -t_srs EPSG:4326 "Caribbean 2 VFR Chart.tif" out.tif --debug ON

I don't see anything from the debug output that explains this.

The other chart, "Caribbean 1 VFR Chart.tif," does not behave this way, though the debug output from the same gdalwarp operation is much longer.

I can't see anything wrong.

I dragged both files into ArcGIS desktop explorer and both are displayed in the proper location and in their entirety.

(I actually have a more elaborate workflow that works fine with chart #1 but this is the simplest operation I can think of that shows the problem with chart #2.)

Thank you very much,
carl


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211105/8359f8d5/attachment-0001.html>

From liporace at gmail.com  Fri Nov  5 14:33:09 2021
From: liporace at gmail.com (Frederico Liporace)
Date: Fri, 5 Nov 2021 18:33:09 -0300
Subject: [gdal-dev] GDALFillNodata() changing pixels outside valid image
 boundary
Message-ID: <CACX38Cq34CkvuDaAf8SmBFBc7TtYA3m5Q9Nxev-Z8pCLtGi89Q@mail.gmail.com>

Hi,

I found, while reviewing the geolocation array backmap implementation,
that GDALFillNodata() currently (master branch) may change nodata
pixels neighboring the valid image border. Is this expected behavior
or should the filling be strictly inside the original valid image data
boundaries?

If the issue is confirmed I'll work on a fix.

best rgds.,
Frederico Liporace

From even.rouault at spatialys.com  Fri Nov  5 15:02:33 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 5 Nov 2021 23:02:33 +0100
Subject: [gdal-dev] GDALFillNodata() changing pixels outside valid image
 boundary
In-Reply-To: <CACX38Cq34CkvuDaAf8SmBFBc7TtYA3m5Q9Nxev-Z8pCLtGi89Q@mail.gmail.com>
References: <CACX38Cq34CkvuDaAf8SmBFBc7TtYA3m5Q9Nxev-Z8pCLtGi89Q@mail.gmail.com>
Message-ID: <cd996237-dbe6-c0e4-90dc-521a79d8878d@spatialys.com>

Frederico,

I don't see any obvious sign in the code or doc that this would be 
intended (contrary to the -nb switch of the nearblack utility for example)

Even

Le 05/11/2021 ? 22:33, Frederico Liporace a ?crit?:
> Hi,
>
> I found, while reviewing the geolocation array backmap implementation,
> that GDALFillNodata() currently (master branch) may change nodata
> pixels neighboring the valid image border. Is this expected behavior
> or should the filling be strictly inside the original valid image data
> boundaries?
>
> If the issue is confirmed I'll work on a fix.
>
> best rgds.,
> Frederico Liporace
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From liporace at gmail.com  Sat Nov  6 15:28:33 2021
From: liporace at gmail.com (Frederico Liporace)
Date: Sat, 6 Nov 2021 19:28:33 -0300
Subject: [gdal-dev] GDALFillNodata() changing pixels outside valid image
 boundary
Message-ID: <CACX38Cqr9ytnEZeZ2+4JmmKcaTTSt8KyRny9XdLC4-aOXqcM2Q@mail.gmail.com>

Even,

Checked the code and it seems that the criteria for a nodata (ND)
pixel to be interpolated is that its distance to a valid pixel to be
less than dfMaxSearchDist (rasterfill.cpp:803)

This means that a ND pixel outside the valid image boundary will be
marked to be interpolated if it is close enough to the valid image
area. The current value for dfMaxSearchDist in the geolocation array
backmap is hard-coded to 3 pixels, which creates the "border" effect I
mentioned in issue #4707.

I could try for instance removing the pixel from the filling mask if
in the last scanned line a direct pixel neighbors' LastY is nNoDataVal
but I'm not sure that will be a general solution.

Fred

PS. I submitted a DRAFT PR with the WIP changes in the backmap
implementation and had no idea that this would start all CI workflows.
Please let me know if this is a problem, I may delete the PR and
submit a new one when finished.

From jmckenna at gatewaygeomatics.com  Sun Nov  7 07:58:08 2021
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Sun, 7 Nov 2021 11:58:08 -0400
Subject: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
In-Reply-To: <9ffcdbb7-d925-be0f-5c7a-8de6ecfa15e1@spatialys.com>
References: <9ffcdbb7-d925-be0f-5c7a-8de6ecfa15e1@spatialys.com>
Message-ID: <7179c433-e69f-d201-a89c-03fef1ba18cc@gatewaygeomatics.com>

RC3 works well in the MS4W/Windows environment.

Thanks!

-jeff



-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/


On 2021-11-04 9:33 a.m., Even Rouault wrote:
> Hi,
> 
> RC3 should be the last iteration needed to allow 3.4.0 to be released.
> 
> Motion:
> 
> Adopt GDAL 3.4.0 RC3 as final 3.4.0 release
> 
> Starting with my +1
> 
> Even
> 


From b.phamhuu at jacobs-university.de  Sun Nov  7 22:09:07 2021
From: b.phamhuu at jacobs-university.de (Bang Pham Huu)
Date: Mon, 8 Nov 2021 13:09:07 +0700
Subject: [gdal-dev] Process Sentinel-5p netCDF to tiff files but overlapping
 appears clearly between 2 files?
Message-ID: <d850b41a-4e94-6d83-d4c6-8bcc106804e3@jacobs-university.de>

Hello,

I've used 2 Sentinel-5p scenes in hdf5 / netCDF to geoTiff by gdal
version 2.2.4 like example below:

First, I extract the lat and lon coordinates from one HDF5 file

???? gdal_translate -of VRT
HDF5:"S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc"://PRODUCT/latitude
lat.vrt
???? gdal_translate -of VRT
HDF5:"S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc"://PRODUCT/longitude
lon.vrt

Then, I create the product.vrt like below

??????? <VRTDataset rasterXSize="450" rasterYSize="3735">
????? <Metadata domain="GEOLOCATION">
??????? <MDI key="LINE_OFFSET">0</MDI>
??????? <MDI key="LINE_STEP">1</MDI>
??????? <MDI key="PIXEL_OFFSET">0</MDI>
??????? <MDI key="PIXEL_STEP">1</MDI>
??????? <MDI key="X_BAND">1</MDI>
??????? <MDI
key="X_DATASET">/home/PROJECTS/Sentinel-5P/test_L2_AER_AI/lon.vrt</MDI>
??????? <MDI key="Y_BAND">1</MDI>
??????? <MDI
key="Y_DATASET">/home/PROJECTS/Sentinel-5P/test_L2_AER_AI/lat.vrt</MDI>
????? </Metadata>
????? <VRTRasterBand dataType="Float32" band="1">
??????? <Metadata>
????????? <MDI key="STATISTICS_MAXIMUM">9.9692099683869e+36</MDI>
????????? <MDI key="STATISTICS_MEAN">7.78603750784e+35</MDI>
????????? <MDI key="STATISTICS_MINIMUM">-7.209698677063</MDI>
????????? <MDI key="STATISTICS_STDDEV">2.6750402750247e+36</MDI>
??????? </Metadata>
??????? <SimpleSource>
????????? <SourceFilename
relativeToVRT="1">HDF5:S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc://PRODUCT/aerosol_index_340_380</SourceFilename>
????????? <SourceBand>1</SourceBand>
????????? <SourceProperties RasterXSize="450" RasterYSize="3735"
DataType="Float32" BlockXSize="225" BlockYSize="1868" />
????????? <SrcRect xOff="0" yOff="0" xSize="450" ySize="3735" />
????????? <DstRect xOff="0" yOff="0" xSize="450" ySize="3735" />
??????? </SimpleSource>
????? </VRTRasterBand>
??? </VRTDataset>

And finally, I extract the data inside the HDF5 to geoTiff and project
it to EPSG:4326 CRS.

??? gdalwarp -geoloc -t_srs EPSG:4326 -srcnodata 9.96921e+36f
product.vrt aerosol_index_340_380.tiff -tr 0.069 0.069 -tap -of GTiff

I did that for 2 files which are neighbor to extract the wanted
sub_dataset to tiff files and then opened them on QGIS.

** The image looks like below https://imgur.com/uu6pS5n

** The two extracted tiff files can be found from
https://drive.google.com/drive/folders/1lOXyJXhhzmfs5e_WTsKPOj96CHEEIyhP?usp=sharing

I wonder, why there are clear borders (the line in the middle) between
the 2 overlapping files?

Thanks,


From even.rouault at spatialys.com  Mon Nov  8 05:08:10 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 8 Nov 2021 14:08:10 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.4.0RC3 as final issue
In-Reply-To: <9ffcdbb7-d925-be0f-5c7a-8de6ecfa15e1@spatialys.com>
References: <9ffcdbb7-d925-be0f-5c7a-8de6ecfa15e1@spatialys.com>
Message-ID: <a602b49e-80b6-26a4-ac2f-902909494b0c@spatialys.com>

I declare this motion passed with +1 from PSC members JukkaR, MateuszL, 
HowardB, DanielM and me.

Even

Le 04/11/2021 ? 13:33, Even Rouault a ?crit?:
> Hi,
>
> RC3 should be the last iteration needed to allow 3.4.0 to be released.
>
> Motion:
>
> Adopt GDAL 3.4.0 RC3 as final 3.4.0 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Nov  8 05:42:08 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 8 Nov 2021 14:42:08 +0100
Subject: [gdal-dev] GDAL 3.4.0 is released
Message-ID: <3aa50e5c-aac2-0835-827a-6286dc90a101@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team and community, I am pleased to
announce the release of GDAL/OGR 3.4.0. GDAL/OGR is a C++ geospatial data
access library for raster and vector file formats, databases and web 
services.
It includes bindings for several languages, and a variety of command line
tools.

 ?? http://gdal.org/

The 3.4.0 release is a new feature release with the following highlights:

* [RFC 81](https://gdal.org/development/rfc/rfc81_coordinate_epoch.html):
 ? Support for coordinate epochs in geospatial formats.
 ? Implemented in FlatGeoBuf, GeoPackage, MEM, VRT
* New GDAL drivers:
 ? - [Zarr](https://gdal.org/drivers/raster/zarr.html):
 ??? read/write support for ZarrV2 (and experimental V3), using 2D 
classic raster
 ??? API or multidimensional API:
 ? - [STACIT](https://gdal.org/drivers/raster/stacit.html):
 ??? Spatio-Temporal Asset Catalog Items as virtual mosaics
* Other improvements:
 ? - number of enhancements in file system operations of /vsigs/
 ? - NITF: additions to comply with NITF Version 2.1 Commercial Dataset
 ??? Requirements Document (NCDRD)
 ? - ODBC and PGeo: multiple fixes and improvements
 ? - SAFE (Sentinel1): multiple improvements related to SLC/calibration 
(change
 ??? subdataset naming)
 ? - multidimensional API: caching, and other improvements
* Code linting and security fixes
* MDB driver (Java based) mark as deprecated. Planned for removal for 
GDAL 3.5.
 ? ODBC driver is the preferred solution (with up-to-date MDBTools 
library on
 ? non-Windows platforms)
* Writing side of Tiger driver deprecated and will be removed in GDAL 3.5
* Remainder: DODS, JPEG2000(Jasper), JPEGLS, MG4LIDAR, FUJIBAS, IDA, 
INGR and
 ? vector driver ARCGEN, ArcObjects, CLOUDANT, COUCHDB, DB2, DODS, FME, 
GEOMEDIA,
 ? GTM, INGRES, MONGODB, REC, WALK are planned for removal in GDAL 3.5. 
As well
 ? as Perl bindings

More complete information on the new features and fixes in the 3.4.0 
release can be found at:

 ? https://github.com/OSGeo/gdal/blob/v3.4.0/gdal/NEWS.md

The release can be downloaded from:
 ? * https://download.osgeo.org/gdal/3.4.0/gdal340.zip - source as a zip
 ? * https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0.tar.gz - source as 
.tar.gz
 ? * https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0.tar.xz - source as 
.tar.xz
 ? * https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz - 
GDAL-GRASS plugin
 ? * https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0.tar.gz - 
test suite
 ? * https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip - 
documentation / website

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From aduv1609 at gmail.com  Mon Nov  8 05:59:35 2021
From: aduv1609 at gmail.com (Abhay Duvvuri)
Date: Tue, 9 Nov 2021 00:59:35 +1100
Subject: [gdal-dev] WKID not set for reprojectionfrom WGS84 to GDA2020
Message-ID: <CAOYAbio_ert9YF_3MKkksLUBt7KAtXFy3N86uJHd7=1KvCQ7nA@mail.gmail.com>

Hi,

I am trying to reproject ESRI file geodatabase data from WGS84 (3857) to
GDA2020 (7844) with "FileGDB" driver option. The data is reprojected but
WKID is not set.
ogr2ogr tool is being used to reproject data.
Please let me know what can be done here.

Also, is there a docker image readily available with FileGDB configured. I
am able to build an image by following the steps from
https://github.com/OSGeo/gdal/tree/master/docker but wanted to check if
there is an image readily available.
Any advice here is greatly appreciated.

Thanks and regards,
Abhay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211109/a407068c/attachment.html>

From bclay at infoscitex.com  Mon Nov  8 06:18:46 2021
From: bclay at infoscitex.com (Clay, Bruce)
Date: Mon, 8 Nov 2021 14:18:46 +0000
Subject: [gdal-dev] [EXTERNAL] Re: ogr2ogr does not convert OSM polygons
In-Reply-To: <b08daf199588474bbd4b72b220524135@maanmittauslaitos.fi>
References: <b08daf199588474bbd4b72b220524135@maanmittauslaitos.fi>
Message-ID: <BN1P110MB0721C42C70BAC554C10C5ABCDE919@BN1P110MB0721.NAMP110.PROD.OUTLOOK.COM>

Jukka:
  I apologize for the delay getting back to you.  Thanks you for your help. I am posting this as the solution that worked for me in case it will help anyone else.

I created a batch file (CreateandLoadOsmSchema.bat) with the following calls:

"C:\Program Files\PostgreSQL\12\bin\psql" -h data-trust -d osm_%1  -p 5432 -U postgres -c "CREATE SCHEMA %2";

Z:\OpenStreetMap\release-1916-x64-gdal-mapserver\bin\ogr2ogr -f PostgreSQL PG:"dbname='osm_%1' host='<hostname>port='5432' user='postgres' password='<pwd>'" -lco schema=%2 %3  --config OSM_MAX_TMPFILE_SIZE 1024

then I created a separate batch file (CreateAndLoadAfricaOsm.bat) that contained:

set GDAL_DRIVER_PATH=Z:\OpenStreetMap\release-1916-x64-gdal-mapserver\bin
set PGPASSWORD=<pwd>

cd ..\africa

CALL ..\scripts\CreateAndLoadOsmSchema algeria algeria-latest.osm.pbf
CALL ..\scripts\CreateandLoadOsmSchema angola angola-latest.osm.pbf

added a line for each PBF that I downloaded

This created a postgresql /postgis table for each dataset.

Bruce



________________________________
From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Sent: Tuesday, November 2, 2021 3:35 PM
To: Clay, Bruce <bclay at infoscitex.com>
Cc: 'gdal-dev at lists.osgeo.org' <gdal-dev at lists.osgeo.org>
Subject: Re: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons


Hi,



Please take care to send mail also to the list.



The error that you get means probably that the Proj coordinate transformation library finds an older version of the proj.db file. With the gisinternals installation that file is in [gdal_installation_directory]\bin\proj7\share. Environmental variable PROJ_LIB should point into there. How did you launch ogr2ogr after installation? If you installed from the zip file you must run first the batch file ?sdkshell.bat? for setting the paths and environment variables. If you used installer then you should launch GDAL command window from the shortcuts. In both cases when settings are OK you can run ogr2ogr simply as ?ogr2ogr?.



Other_relations contain geometries which are of geometry type ?GeometryCollection?. Unfortunately QGIS has very little support for GeometryCollections. You can see the attributes but not the geometries. If you are interested in the relations you must use some workarounds with QGIS or use other programs. For example OpenJUMP can do pretty well with relations but it is not so well documented.



-Jukka Rahkonen-



L?hett?j?: Clay, Bruce <bclay at infoscitex.com>
L?hetetty: tiistai 2. marraskuuta 2021 20.35
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons



Jukka:

  I upgraded to 3.4.0 from sysinternals.  All tables appear to be going in ok but I do get an error message for each table (shown below).  QGIS shows the SRID is 4326.  "other_relations" has a geometry column and it loads in QGIS but the geometry does not show.  It appears I can get what I need for my task, just annoying messages.



Should "other_relations" show in QGIS?



Thanks for you help.



Bruce



Z:\OpenStreetMap\release-1916-x64-gdal-mapserver\bin\ogr2ogr -f PostgreSQL PG:"dbname='open_street_map' host='hostname' port='5432' user='postgres' password='pwd'" -lco schema=algeria algeria-latest.osm.pbf  --config OSM_MAX_TMPFILE_SIZE 1024

0...10...20...30...40.ERROR 1: PROJ: proj_create_from_database: cannot build geodeticCRS 4326: SQLite error on SELECT extent.description, extent.south_lat, extent.north_lat, extent.west_lon, extent.east_lon, scope.scope, (CASE WHEN scope.scope LIKE '%large scale%' THEN 0 ELSE 1 END) AS score FROM usage JOIN extent ON usage.extent_auth_name = extent.auth_name AND usage.extent_code = extent.code JOIN scope ON usage.scope_auth_name = scope.auth_name AND usage.scope_code = scope.code WHERE object_table_name = ? AND object_auth_name = ? AND object_code = ? ORDER BY score, usage.auth_name, usage.code: no such table: usage

..50...60...70...80...90...100 - done.

________________________________

From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Tuesday, November 2, 2021 12:32 PM
To: Clay, Bruce <bclay at infoscitex.com<mailto:bclay at infoscitex.com>>
Subject: VS: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons



Actually, it was GDAL 3.3.1 from OSGeo4W installer.



-Jukka-



L?hett?j?: Clay, Bruce <bclay at infoscitex.com<mailto:bclay at infoscitex.com>>
L?hetetty: tiistai 2. marraskuuta 2021 18.19
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons



Jukka:

  Thanks for your reply.



I was in the progress of loading all OSM so I started with Africa and saw the same thing for all pbf files.  You can pick a small one such as algeria-latest.osm.pbf.  In my post I  just replaced the country name with the word "country" to be generic.  All of the files came from the website you mentioned.



I am using the OSGeo shell on Windows 10.  gdalinfo show version is 3.0.4

I did not change the osmconf.ini file.



After looking deeper into the table osm2pgsql created I noticed roads are not actually put in the osm roads layer.  administrative boundaries or other lines were in there. More lines are in the table created by osm2pgsql than the table created by ogr2ogr.



it looks like ogr2ogr would produce a similar approach if it would generate the polygon table.



Bruce





________________________________

From: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Sent: Tuesday, November 2, 2021 11:11 AM
To: Clay, Bruce <bclay at infoscitex.com<mailto:bclay at infoscitex.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: [EXTERNAL] Re: ogr2ogr does not convert OSM polygons



Hi,



What layers does ?ogrinfo country_pbf? list? Can you reproduce the error with some small OSM country file from http://download.geofabrik.de/<https://usg02.safelinks.protection.office365.us/?url=http%3A%2F%2Fdownload.geofabrik.de%2F&data=04%7C01%7Cbclay%40infoscitex.com%7C693c41133a944e0a44dd08d99e37df46%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637714785093150348%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=CNmLeTGNprUF77hujrYlaWuG4vvrKGMC%2B8718zzXhY8%3D&reserved=0>?

What is your operating system and GDAL version? Do you use the default osmconf.ini file? GDAL OSM driver and osm2pgsql are creating quite different database schemas so they are not very comparable.



-Jukka Rahkonen-



L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Clay, Bruce
L?hetetty: tiistai 2. marraskuuta 2021 16.22
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogr2ogr does not convert OSM polygons



When I convert a OSM pbf file to postgres using the following script it does not create a multipolygon table



ogr2ogr -f PostgreSQL PG:"dbname='open_street_map' host='db-host' port='5432' user='postgres' password='pwd'" -lco schema=country country_pbf  --config OSM_MAX_TMPFILE_SIZE 1024



When I do the same thing using osm2pgsql (shown below) it creates the polygon table but not the other_relations table



osm2pgsql -H hostname -U postgres -d open_street_map --output-pgsql-schema=country --create --latlong -G --hstore --tag-transform-script /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.lua -C 2500 --number-processes 5 -S /OpenStreetMap/openstreetmap-carto-master/openstreetmap-carto.style country-latest.osm.pbf.



I did not see this problem when I Googled.



Is this a known issue and is there a work around?



Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/accc85d4/attachment-0001.html>

From bclay at infoscitex.com  Mon Nov  8 06:37:06 2021
From: bclay at infoscitex.com (Clay, Bruce)
Date: Mon, 8 Nov 2021 14:37:06 +0000
Subject: [gdal-dev] gdal2tiles.py - next step
Message-ID: <BN1P110MB0721C3DB4C9B3084C17B37A6DE919@BN1P110MB0721.NAMP110.PROD.OUTLOOK.COM>

I am trying to add WMTS / TMS to our current WMS mapserver.  I have some map tiles generated by gdal2tiles.py that appear to be valid.  There is a tilemapresource.xml file in the root of each tile set.

I am not sure the correct forum to ask this question but how do I configure mapserver to serve one of these tile sets when there is not a corresponding original source to put in the mapserver configuration file? I added the mapcache.xml file as follows

   <cache name="bm_200401" type = "disk">
     <base>H:/ms4w/cache/BlueMarbleTiles_200401</base>
</cache>

   <tileset name="bluemarble200401">
      <source>bluemarble_src</source>
      <cache>bm_200401</cache>
      <metatile>5 5</metatile>
      <format>PNG</format>
      <grid>WGS84</grid>

      <metadata>
        <title>Blue Marble 200401</title>
        <abstract>Blue Marble - January 2004 - tiles</abstract>
        <keywords>
          <keyword>Blue Marble</keyword>
          <keyword>tiles</keyword>
        </keywords>
      </metadata>
   </tileset>

   <tileset name="bluemarble200401">
      <source>bluemarble_src</source>
      <cache>bm_200401</cache>
      <metatile>5 5</metatile>
      <format>PNG</format>
      <grid>WGS84</grid>

      <metadata>
        <title>Blue Marble 200401</title>
        <abstract>Blue Marble - January 2004 - tiles</abstract>
        <keywords>
          <keyword>Blue Marble</keyword>
          <keyword>tiles</keyword>
        </keywords>
      </metadata>
   </tileset>

When I select the tile set in QGIS using
http://localhost/mapcache/wmts?service=wmts&request=getcapabilities&version=1.0.0

All of the layers show as available layers but the only ones that show on the map are the ones that have an entry in the WMS map file.

>From my understanding the tilemapresource.xml file generate by gdal2tiles.py specifies the zoom levels and resolution but it is not specified in any of the configuration files.

Any suggestions would be greatly appreciated.

Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/fd372442/attachment.html>

From stefano.iacovella at gmail.com  Mon Nov  8 07:15:01 2021
From: stefano.iacovella at gmail.com (Stefano Iacovella)
Date: Mon, 8 Nov 2021 16:15:01 +0100
Subject: [gdal-dev] Broken link in docs
Message-ID: <CAG9OqYq_W_uDrtjwEi_TdoNg-Ru=g72nVY9-gnE26e5PvLBWFw@mail.gmail.com>

Hi all,

I just noted a very small issue in this page:

https://gdal.org/download.html#linux-docker-images

After this period " Information on the content of the different
configurations can be found at " there's this URL:

https://github.com/OSGeo/gdal/tree/master/gdal/docker

It's broken, the working one is:

https://github.com/OSGeo/gdal/tree/master/docker

I'm sorry I'm not able to fix this by myself.

All the best

Stefano
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/d02cd3c4/attachment.html>

From even.rouault at spatialys.com  Mon Nov  8 07:22:31 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 8 Nov 2021 16:22:31 +0100
Subject: [gdal-dev] Broken link in docs
In-Reply-To: <CAG9OqYq_W_uDrtjwEi_TdoNg-Ru=g72nVY9-gnE26e5PvLBWFw@mail.gmail.com>
References: <CAG9OqYq_W_uDrtjwEi_TdoNg-Ru=g72nVY9-gnE26e5PvLBWFw@mail.gmail.com>
Message-ID: <ccf08ead-0267-cb22-157a-4b38a75f9d2f@spatialys.com>

Hi,

I've just fixed it. But anyone with a github account can easily do such 
fixes by clicking on the "Edit on github" link at the top right of each 
doc pages.

Even

Le 08/11/2021 ? 16:15, Stefano Iacovella a ?crit?:
> Hi all,
>
> I just noted a very small issue in this page:
>
> https://gdal.org/download.html#linux-docker-images 
> <https://gdal.org/download.html#linux-docker-images>
>
> After this period " Information on the content of the different 
> configurations can be found at " there's this URL:
>
> https://github.com/OSGeo/gdal/tree/master/gdal/docker 
> <https://github.com/OSGeo/gdal/tree/master/gdal/docker>
>
> It's broken, the working one is:
>
> https://github.com/OSGeo/gdal/tree/master/docker 
> <https://github.com/OSGeo/gdal/tree/master/docker>
>
> I'm sorry I'm not able to fix this by myself.
>
> All the best
>
> Stefano
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/b12d263d/attachment.html>

From stefano.iacovella at gmail.com  Mon Nov  8 07:27:22 2021
From: stefano.iacovella at gmail.com (Stefano Iacovella)
Date: Mon, 8 Nov 2021 16:27:22 +0100
Subject: [gdal-dev] Broken link in docs
In-Reply-To: <ccf08ead-0267-cb22-157a-4b38a75f9d2f@spatialys.com>
References: <CAG9OqYq_W_uDrtjwEi_TdoNg-Ru=g72nVY9-gnE26e5PvLBWFw@mail.gmail.com>
 <ccf08ead-0267-cb22-157a-4b38a75f9d2f@spatialys.com>
Message-ID: <CAG9OqYpE7-PmdJo4ekkRdjfrGW-UPb9H6XjBvXJ8=ZLA3WGSsA@mail.gmail.com>

Thanks Even,
I didn't see the edit feature, good to know for the next time :)

Stefano

Il giorno lun 8 nov 2021 alle ore 16:22 Even Rouault <
even.rouault at spatialys.com> ha scritto:

> Hi,
>
> I've just fixed it. But anyone with a github account can easily do such
> fixes by clicking on the "Edit on github" link at the top right of each doc
> pages.
>
> Even
> Le 08/11/2021 ? 16:15, Stefano Iacovella a ?crit :
>
> Hi all,
>
> I just noted a very small issue in this page:
>
> https://gdal.org/download.html#linux-docker-images
>
> After this period " Information on the content of the different
> configurations can be found at " there's this URL:
>
> https://github.com/OSGeo/gdal/tree/master/gdal/docker
>
> It's broken, the working one is:
>
> https://github.com/OSGeo/gdal/tree/master/docker
>
> I'm sorry I'm not able to fix this by myself.
>
> All the best
>
> Stefano
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/d19b5f7a/attachment-0001.html>

From even.rouault at spatialys.com  Mon Nov  8 07:34:09 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 8 Nov 2021 16:34:09 +0100
Subject: [gdal-dev] WKID not set for reprojectionfrom WGS84 to GDA2020
In-Reply-To: <CAOYAbio_ert9YF_3MKkksLUBt7KAtXFy3N86uJHd7=1KvCQ7nA@mail.gmail.com>
References: <CAOYAbio_ert9YF_3MKkksLUBt7KAtXFy3N86uJHd7=1KvCQ7nA@mail.gmail.com>
Message-ID: <2d65d9d8-31dd-fc91-9cb9-97928dd9e6f7@spatialys.com>

Abhay,

I've investigated a bit and the reason is that FileGDB SDK contains a 
catalog of geographic and projected CRS that doesn't contain GDA2020 / 
EPSG:7844. The SDK likely lags behind the capabilities of other Esri 
software.

I've just added in master a layer creation option (undocumented for now) 
to manually specify the WKID, like

ogr2ogr out.gdb in_dataset -t_srs EPSG:7844 -lco WKID=7844

The OpenFileGDB driver can make use of that code, but the FileGDB driver 
doesn't see it yet (but could potentially be modified to see it). I've 
no idea if other Esri software would probably recognize a layer with a 
SRS set this way. Feedback would be appreciated.

The official Docker images the project publishes don't contain 
close-source bits, hence no FileGDB driver.

Even

Le 08/11/2021 ? 14:59, Abhay Duvvuri a ?crit?:
> Hi,
>
> I am trying to reproject ESRI file geodatabase data from WGS84 (3857) 
> to GDA2020 (7844) with "FileGDB" driver option. The data is 
> reprojected but WKID is not set.
> ogr2ogr tool is being used to reproject data.
> Please let me know what can be done here.
>
> Also, is there a docker image readily available with FileGDB 
> configured. I am able to build an image by following the steps from 
> https://github.com/OSGeo/gdal/tree/master/docker 
> <https://github.com/OSGeo/gdal/tree/master/docker> but wanted to check 
> if there is an image readily available.
> Any advice here is greatly appreciated.
>
> Thanks and?regards,
> Abhay
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/eedea79f/attachment.html>

From jmckenna at gatewaygeomatics.com  Mon Nov  8 09:11:55 2021
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Mon, 8 Nov 2021 13:11:55 -0400
Subject: [gdal-dev] GDAL 3.4.0 is released
In-Reply-To: <3aa50e5c-aac2-0835-827a-6286dc90a101@spatialys.com>
References: <3aa50e5c-aac2-0835-827a-6286dc90a101@spatialys.com>
Message-ID: <19bee1e7-34b0-69cd-9da9-38dbb2867339@gatewaygeomatics.com>

All MapServer demo services (over 10+ OGC services) have been updated to 
GDAL 3.4.0 : https://demo.mapserver.org


-jeff



-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/




On 2021-11-08 9:42 a.m., Even Rouault wrote:
> Hi,
> 
> On behalf of the GDAL/OGR development team and community, I am pleased to
> announce the release of GDAL/OGR 3.4.0. GDAL/OGR is a C++ geospatial data
> access library for raster and vector file formats, databases and web 
> services.
> It includes bindings for several languages, and a variety of command line
> tools.
> 
>  ?? http://gdal.org/
> 
> The 3.4.0 release is a new feature release with the following highlights:
> 
> * [RFC 81](https://gdal.org/development/rfc/rfc81_coordinate_epoch.html):
>  ? Support for coordinate epochs in geospatial formats.
>  ? Implemented in FlatGeoBuf, GeoPackage, MEM, VRT
> * New GDAL drivers:
>  ? - [Zarr](https://gdal.org/drivers/raster/zarr.html):
>  ??? read/write support for ZarrV2 (and experimental V3), using 2D 
> classic raster
>  ??? API or multidimensional API:
>  ? - [STACIT](https://gdal.org/drivers/raster/stacit.html):
>  ??? Spatio-Temporal Asset Catalog Items as virtual mosaics
> * Other improvements:
>  ? - number of enhancements in file system operations of /vsigs/
>  ? - NITF: additions to comply with NITF Version 2.1 Commercial Dataset
>  ??? Requirements Document (NCDRD)
>  ? - ODBC and PGeo: multiple fixes and improvements
>  ? - SAFE (Sentinel1): multiple improvements related to SLC/calibration 
> (change
>  ??? subdataset naming)
>  ? - multidimensional API: caching, and other improvements
> * Code linting and security fixes
> * MDB driver (Java based) mark as deprecated. Planned for removal for 
> GDAL 3.5.
>  ? ODBC driver is the preferred solution (with up-to-date MDBTools 
> library on
>  ? non-Windows platforms)
> * Writing side of Tiger driver deprecated and will be removed in GDAL 3.5
> * Remainder: DODS, JPEG2000(Jasper), JPEGLS, MG4LIDAR, FUJIBAS, IDA, 
> INGR and
>  ? vector driver ARCGEN, ArcObjects, CLOUDANT, COUCHDB, DB2, DODS, FME, 
> GEOMEDIA,
>  ? GTM, INGRES, MONGODB, REC, WALK are planned for removal in GDAL 3.5. 
> As well
>  ? as Perl bindings
> 
> More complete information on the new features and fixes in the 3.4.0 
> release can be found at:
> 
>  ? https://github.com/OSGeo/gdal/blob/v3.4.0/gdal/NEWS.md
> 
> The release can be downloaded from:
>  ? * https://download.osgeo.org/gdal/3.4.0/gdal340.zip - source as a zip
>  ? * https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0.tar.gz - source as 
> .tar.gz
>  ? * https://download.osgeo.org/gdal/3.4.0/gdal-3.4.0.tar.xz - source as 
> .tar.xz
>  ? * https://download.osgeo.org/gdal/3.4.0/gdal-grass-3.4.0.tar.gz - 
> GDAL-GRASS plugin
>  ? * https://download.osgeo.org/gdal/3.4.0/gdalautotest-3.4.0.tar.gz - 
> test suite
>  ? * https://download.osgeo.org/gdal/3.4.0/gdal340doc.zip - 
> documentation / website
> 
> Best regards,
> 
> Even
> 


From simon.eves at omnisci.com  Mon Nov  8 12:44:30 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Mon, 8 Nov 2021 12:44:30 -0800
Subject: [gdal-dev] Driver DCAP flags
Message-ID: <CAJf0KTSiDphP6517x0OYA40Jro8c9Y80izgcR0SUUavnpM+fgg@mail.gmail.com>

Quick question...

Is it a definitive check for whether a GDALDriver is a Vector or Raster
driver to look for either DCAP_VECTOR=YES or DCAP_RASTER=YES in the default
meta-data?

Is every (vector or raster) driver guaranteed to have one or other of those?

TIA

Simon

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/c2ac72f5/attachment.html>

From even.rouault at spatialys.com  Mon Nov  8 14:24:31 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 8 Nov 2021 23:24:31 +0100
Subject: [gdal-dev] Driver DCAP flags
In-Reply-To: <CAJf0KTSiDphP6517x0OYA40Jro8c9Y80izgcR0SUUavnpM+fgg@mail.gmail.com>
References: <CAJf0KTSiDphP6517x0OYA40Jro8c9Y80izgcR0SUUavnpM+fgg@mail.gmail.com>
Message-ID: <7b97a1ba-6145-1c47-8e7b-89242c6821c1@spatialys.com>


Le 08/11/2021 ? 21:44, Simon Eves a ?crit?:
> Quick question...
>
> Is it a definitive check for whether a GDALDriver is a Vector or 
> Raster driver to look for either DCAP_VECTOR=YES or DCAP_RASTER=YES in 
> the default meta-data?
They should . It is how gdalinfo --formats or ogrinfo --formats 
recognize them
>
> Is every (vector or raster) driver guaranteed to have one or other of 
> those?
always recall THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY 
KIND, EXPRESS OR IMPLIED :-)
>
> TIA
>
> Simon
>
> -- 
> <http://www.omnisci.com/>
> 	
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> 	
> Email: simon.eves at omnisci.com <mailto:simon.eves at omnisci.com>?| Cell: 
> +1 (415) 902-1996
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/3814c3d4/attachment.html>

From simon.eves at omnisci.com  Mon Nov  8 16:20:57 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Mon, 8 Nov 2021 16:20:57 -0800
Subject: [gdal-dev] Strange behavior opening CSVs
Message-ID: <CAJf0KTRnAwwiaRtEba2jgihPpiJTwk_LR77zEdbBJJ9PyyqGqA@mail.gmail.com>

I am currently implementing a better file identifier, and during the course
of development, I unintentionally let GDAL try to GDALOpenEx() the attached
trivial CSV file.

First, it reported "Ungridded dataset: At line 3, change of Y direction"
(as a warning to the registered error-handler) and the returned
OGRDataSource* was null.

When I tried again, it then claimed that I was trying to open the same file
recursively. implying that it had, in fact, opened it, even though it never
returned a valid handle, so I wouldn't have been able to close it again
even if I'd wanted to.

I can reproduce the first part with gdalinfo.

This is with GDAL 3.2.2 on Ubuntu 20.04 with GCC 9.

I'll poke at the GDAL code myself when I have a bit more time.

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/88f5b914/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: symbol_test.csv
Type: text/csv
Size: 281 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/88f5b914/attachment-0001.csv>

From simon.eves at omnisci.com  Mon Nov  8 16:31:39 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Mon, 8 Nov 2021 16:31:39 -0800
Subject: [gdal-dev] Driver DCAP flags
In-Reply-To: <7b97a1ba-6145-1c47-8e7b-89242c6821c1@spatialys.com>
References: <CAJf0KTSiDphP6517x0OYA40Jro8c9Y80izgcR0SUUavnpM+fgg@mail.gmail.com>
 <7b97a1ba-6145-1c47-8e7b-89242c6821c1@spatialys.com>
Message-ID: <CAJf0KTROdvXjrbSXavLketeESKLsxvDZGL3uir8CaoaWZcv0BQ@mail.gmail.com>

Heh. Right.

On Mon, Nov 8, 2021 at 2:24 PM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 08/11/2021 ? 21:44, Simon Eves a ?crit :
>
> Quick question...
>
> Is it a definitive check for whether a GDALDriver is a Vector or Raster
> driver to look for either DCAP_VECTOR=YES or DCAP_RASTER=YES in the default
> meta-data?
>
> They should . It is how gdalinfo --formats or ogrinfo --formats recognize
> them
>
>
> Is every (vector or raster) driver guaranteed to have one or other of
> those?
>
> always recall THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY
> KIND, EXPRESS OR IMPLIED :-)
>
>
> TIA
>
> Simon
>
> --
> <http://www.omnisci.com/>
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211108/f5826a0b/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov  8 23:47:05 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 9 Nov 2021 07:47:05 +0000
Subject: [gdal-dev] Strange behavior opening CSVs
Message-ID: <b74bebd1d03d4980ae138aa272aaf384@maanmittauslaitos.fi>

Hi,

The trial with gdalinfo makes GDAL to try XYZ https://gdal.org/drivers/raster/xyz.html?highlight=xyz. It is not a bad guess at all. Ogrinfo tries CSV and finds the x, y, and val fields. I can?t say anything about the second part.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Simon Eves
L?hetetty: tiistai 9. marraskuuta 2021 2.21
Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Strange behavior opening CSVs

I am currently implementing a better file identifier, and during the course of development, I unintentionally let GDAL try to GDALOpenEx() the attached trivial CSV file.

First, it reported "Ungridded dataset: At line 3, change of Y direction" (as a warning to the registered error-handler) and the returned OGRDataSource* was null.

When I tried again, it then claimed that I was trying to open the same file recursively. implying that it had, in fact, opened it, even though it never returned a valid handle, so I wouldn't have been able to close it again even if I'd wanted to.

I can reproduce the first part with gdalinfo.

This is with GDAL 3.2.2 on Ubuntu 20.04 with GCC 9.

I'll poke at the GDAL code myself when I have a bit more time.

--
[http://www2.omnisci.com/l/298412/2018-09-18/3sqpg/298412/61753/OmniSci_Email_Header2.png]<http://www.omnisci.com/>

Simon Eves

Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA



Email: simon.eves at omnisci.com<mailto:simon.eves at omnisci.com> | Cell:

+1 (415) 902-1996





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211109/0b539915/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov  9 03:42:09 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 9 Nov 2021 11:42:09 +0000
Subject: [gdal-dev] Gdal2tiles, Python 3.9 and multiprocessing
Message-ID: <f34caa21574f45898074a61304985a9b@maanmittauslaitos.fi>

Hi,

Have a look at this gis.stackexchange question https://gis.stackexchange.com/questions/415925/error-in-gdal2tiles-with-processes.
Question is about using gdal2tiles with QGIS but the issue is reproduced also with OSGeo4w. Is there something changed in multiprocessing between Python versions 3.7 and 3.9, or is something else failing with errors:

RuntimeError:
        An attempt has been made to start a new process before the
        current process has finished its bootstrapping phase.

        This probably means that you are not using fork to start your
        child processes and you have forgotten to use the proper idiom
        in the main module:

            if __name__ == '__main__':
                freeze_support()
                ...

        The "freeze_support()" line can be omitted if the program
        is not going to be frozen to produce an executable.
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\multiprocessing\spawn.py", line 125, in _main
    prepare(preparation_data)
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\multiprocessing\spawn.py", line 236, in prepare
    _fixup_main_from_path(data['init_main_from_path'])
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\multiprocessing\spawn.py", line 287, in _fixup_main_from_path
    main_content = runpy.run_path(main_path,
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\runpy.py", line 268, in run_path
    return _run_module_code(code, init_globals, run_name,
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\runpy.py", line 97, in _run_module_code
    _run_code(code, mod_globals, init_globals,
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\Scripts\gdal2tiles.py", line 11, in <module>
    sys.exit(main(sys.argv))
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\site-packages\osgeo_utils\gdal2tiles.py", line 3257, in main
    multi_threaded_tiling(input_file, output_folder, options)
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\site-packages\osgeo_utils\gdal2tiles.py", line 3206, in multi_threaded_tiling
    pool = Pool(processes=nb_processes)
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\multiprocessing\context.py", line 119, in Pool
    return Pool(processes, initializer, initargs, maxtasksperchild,
  File "C:\PROGRA~1\QGIS32~1.0\apps\Python39\lib\multiprocessing\pool.py", line 212, in __init__
    self._repopulate_pool()

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211109/56dd0528/attachment.html>

From simon.eves at omnisci.com  Tue Nov  9 10:49:09 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Tue, 9 Nov 2021 10:49:09 -0800
Subject: [gdal-dev] Strange behavior opening CSVs
In-Reply-To: <b74bebd1d03d4980ae138aa272aaf384@maanmittauslaitos.fi>
References: <b74bebd1d03d4980ae138aa272aaf384@maanmittauslaitos.fi>
Message-ID: <CAJf0KTS+zEA06vYe9q31yvH86cbz2if9A5KZaZ3+jOFchasNRA@mail.gmail.com>

That makes sense. Thanks. Our plan is to trap CSV files before invoking the
GDAL identification.

The second part does seem like a bug, though.

On Mon, Nov 8, 2021 at 11:47 PM Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> The trial with gdalinfo makes GDAL to try XYZ
> https://gdal.org/drivers/raster/xyz.html?highlight=xyz. It is not a bad
> guess at all. Ogrinfo tries CSV and finds the x, y, and val fields. I can?t
> say anything about the second part.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Simon
> Eves
> *L?hetetty:* tiistai 9. marraskuuta 2021 2.21
> *Vastaanottaja:* gdal dev <gdal-dev at lists.osgeo.org>
> *Aihe:* [gdal-dev] Strange behavior opening CSVs
>
>
>
> I am currently implementing a better file identifier, and during the
> course of development, I unintentionally let GDAL try to GDALOpenEx() the
> attached trivial CSV file.
>
>
>
> First, it reported "Ungridded dataset: At line 3, change of Y direction"
> (as a warning to the registered error-handler) and the returned
> OGRDataSource* was null.
>
>
>
> When I tried again, it then claimed that I was trying to open the same
> file recursively. implying that it had, in fact, opened it, even though it
> never returned a valid handle, so I wouldn't have been able to close it
> again even if I'd wanted to.
>
>
>
> I can reproduce the first part with gdalinfo.
>
>
>
> This is with GDAL 3.2.2 on Ubuntu 20.04 with GCC 9.
>
>
>
> I'll poke at the GDAL code myself when I have a bit more time.
>
>
>
> --
>
> <http://www.omnisci.com/>
>
> *Simon Eves*
>
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
> Email: simon.eves at omnisci.com | Cell:
>
> +1 (415) 902-1996
>
>
>


-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211109/9c61c262/attachment.html>

From B.PhamHuu at jacobs-university.de  Tue Nov  9 22:21:54 2021
From: B.PhamHuu at jacobs-university.de (Pham Huu, Bang)
Date: Wed, 10 Nov 2021 06:21:54 +0000
Subject: [gdal-dev] Process Sentinel-5p netCDF to tiff files but
 overlapping appears clearly between 2 files?
In-Reply-To: <d850b41a-4e94-6d83-d4c6-8bcc106804e3@jacobs-university.de>
References: <d850b41a-4e94-6d83-d4c6-8bcc106804e3@jacobs-university.de>
Message-ID: <AM5P190MB024227B896CFAC59BCECB423DA939@AM5P190MB0242.EURP190.PROD.OUTLOOK.COM>

Did someone have the same issue to process Sentinel 5p to tiff file with gdal as well?

** The overlapping image on QGIS looks like below https://imgur.com/uu6pS5n

** The two extracted tiff files can be found from
https://drive.google.com/drive/folders/1lOXyJXhhzmfs5e_WTsKPOj96CHEEIyhP?usp=sharing


Best,

________________________________
From: Pham Huu, Bang
Sent: Monday, November 8, 2021 07:09
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Process Sentinel-5p netCDF to tiff files but overlapping appears clearly between 2 files?

Hello,

I've used 2 Sentinel-5p scenes in hdf5 / netCDF to geoTiff by gdal
version 2.2.4 like example below:

First, I extract the lat and lon coordinates from one HDF5 file

     gdal_translate -of VRT
HDF5:"S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc"://PRODUCT/latitude
lat.vrt
     gdal_translate -of VRT
HDF5:"S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc"://PRODUCT/longitude
lon.vrt

Then, I create the product.vrt like below

        <VRTDataset rasterXSize="450" rasterYSize="3735">
      <Metadata domain="GEOLOCATION">
        <MDI key="LINE_OFFSET">0</MDI>
        <MDI key="LINE_STEP">1</MDI>
        <MDI key="PIXEL_OFFSET">0</MDI>
        <MDI key="PIXEL_STEP">1</MDI>
        <MDI key="X_BAND">1</MDI>
        <MDI
key="X_DATASET">/home/PROJECTS/Sentinel-5P/test_L2_AER_AI/lon.vrt</MDI>
        <MDI key="Y_BAND">1</MDI>
        <MDI
key="Y_DATASET">/home/PROJECTS/Sentinel-5P/test_L2_AER_AI/lat.vrt</MDI>
      </Metadata>
      <VRTRasterBand dataType="Float32" band="1">
        <Metadata>
          <MDI key="STATISTICS_MAXIMUM">9.9692099683869e+36</MDI>
          <MDI key="STATISTICS_MEAN">7.78603750784e+35</MDI>
          <MDI key="STATISTICS_MINIMUM">-7.209698677063</MDI>
          <MDI key="STATISTICS_STDDEV">2.6750402750247e+36</MDI>
        </Metadata>
        <SimpleSource>
          <SourceFilename
relativeToVRT="1">HDF5:S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc://PRODUCT/aerosol_index_340_380</SourceFilename>
          <SourceBand>1</SourceBand>
          <SourceProperties RasterXSize="450" RasterYSize="3735"
DataType="Float32" BlockXSize="225" BlockYSize="1868" />
          <SrcRect xOff="0" yOff="0" xSize="450" ySize="3735" />
          <DstRect xOff="0" yOff="0" xSize="450" ySize="3735" />
        </SimpleSource>
      </VRTRasterBand>
    </VRTDataset>

And finally, I extract the data inside the HDF5 to geoTiff and project
it to EPSG:4326 CRS.

    gdalwarp -geoloc -t_srs EPSG:4326 -srcnodata 9.96921e+36f
product.vrt aerosol_index_340_380.tiff -tr 0.069 0.069 -tap -of GTiff

I did that for 2 files which are neighbor to extract the wanted
sub_dataset to tiff files and then opened them on QGIS.

** The image looks like below https://imgur.com/uu6pS5n

** The two extracted tiff files can be found from
https://drive.google.com/drive/folders/1lOXyJXhhzmfs5e_WTsKPOj96CHEEIyhP?usp=sharing

I wonder, why there are clear borders (the line in the middle) between
the 2 overlapping files?

Thanks,

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211110/355ee396/attachment.html>

From arb at sat.dundee.ac.uk  Wed Nov 10 07:15:59 2021
From: arb at sat.dundee.ac.uk (Andrew Brooks)
Date: Wed, 10 Nov 2021 15:15:59 +0000
Subject: [gdal-dev] COG driver create options vs GTiff
Message-ID: <CAHOfOo2o_KbXnUEobF825Y5rtn5e7aFcYOi0=1ddxQx_9bhxog@mail.gmail.com>

Hi

I can see that the COG driver does some pre-processing (eg. overviews and
reprojection) and then passes on the work to the GTiff driver. However I've
been trying to understand the relationship between the create options which
the COG driver accepts and the create options for the GTiff driver.

Some of the options are explicitly copied over, such as:
  BIGTIFF
  NUM_THREADS
  GEOTIFF_VERSION
  SPARSE_OK
some have a slightly different name (why?), such as:
  BLOCKSIZE (instead of BLOCKXSIZE)
  LEVEL (instead of ZLEVE)
some are necessarily additional, such as:
  OVERVIEWS
  TARGET_SRS
some are removed, such as:
  TILED (because it's implicit in COG)
but that leaves a whole bunch of others which are not documented, and I
can't see in the code how they might be handled:
  NBITS
  DISCARD_LSB
  ALPHA
  PIXELTYPE
  PROFILE
  PHOTOMETRIC
  GEOTIFF_KEYS_FLAVOR
  TFW, RPB, RPCTXT

Andrew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211110/b245c79c/attachment.html>

From even.rouault at spatialys.com  Wed Nov 10 07:22:38 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 10 Nov 2021 16:22:38 +0100
Subject: [gdal-dev] COG driver create options vs GTiff
In-Reply-To: <CAHOfOo2o_KbXnUEobF825Y5rtn5e7aFcYOi0=1ddxQx_9bhxog@mail.gmail.com>
References: <CAHOfOo2o_KbXnUEobF825Y5rtn5e7aFcYOi0=1ddxQx_9bhxog@mail.gmail.com>
Message-ID: <6ca309eb-c3ef-5de7-7360-e1709dd7e207@spatialys.com>



> some have a slightly different name (why?), such as:
> ? BLOCKSIZE (instead of BLOCKXSIZE)
> ? LEVEL (instead of ZLEVE)

Attempt to simplify things a bit


> some are necessarily additional, such as:
> ? OVERVIEWS
> ? TARGET_SRS
> some are removed, such as:
> ? TILED (because it's implicit in COG)
> but that leaves a whole bunch of others which are not documented, and 
> I can't see in the code how they might be handled:

They aren't supported by the COG driver, which was meant to simplify COG 
creation and not overwhelm users. Most of them could likely be added 
back to the COG driver, if the need arose.


> ? NBITS
> ? DISCARD_LSB
> ? ALPHA
> ? PIXELTYPE
> ? PROFILE
> ? PHOTOMETRIC
> ? GEOTIFF_KEYS_FLAVOR
> ? TFW, RPB, RPCTXT

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From bclay at infoscitex.com  Wed Nov 10 07:32:00 2021
From: bclay at infoscitex.com (Clay, Bruce)
Date: Wed, 10 Nov 2021 15:32:00 +0000
Subject: [gdal-dev] [EXTERNAL] Re:  GDAL 3.4.0 is released
In-Reply-To: <19bee1e7-34b0-69cd-9da9-38dbb2867339@gatewaygeomatics.com>
References: <3aa50e5c-aac2-0835-827a-6286dc90a101@spatialys.com>
 <19bee1e7-34b0-69cd-9da9-38dbb2867339@gatewaygeomatics.com>
Message-ID: <BN1P110MB0721EA66F5BC8DDEE9E98D1BDE939@BN1P110MB0721.NAMP110.PROD.OUTLOOK.COM>

Jeff:
  Can you add an example to the mapserver set of examples to add support for a slippy map (XYZ)?  I can not find anything that shows how to add a local slippy map directory tree to the map file.

Bruce

________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Jeff McKenna <jmckenna at gatewaygeomatics.com>
Sent: Monday, November 8, 2021 12:11 PM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: [gdal-dev] GDAL 3.4.0 is released

All MapServer demo services (over 10+ OGC services) have been updated to
GDAL 3.4.0 : https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fdemo.mapserver.org%2F&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363705518%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=p9jTVg8PKsaX899y62Oa3WIZsVN00Ita1O1nKYoVIeU%3D&amp;reserved=0


-jeff



--
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
https://usg02.safelinks.protection.office365.us/?url=http%3A%2F%2Fgatewaygeo.com%2F&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363705518%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=liq1maeD%2B%2B%2BnXz%2FMOg900v2GYaooSvcA6S2G06roBTY%3D&amp;reserved=0




On 2021-11-08 9:42 a.m., Even Rouault wrote:
> Hi,
>
> On behalf of the GDAL/OGR development team and community, I am pleased to
> announce the release of GDAL/OGR 3.4.0. GDAL/OGR is a C++ geospatial data
> access library for raster and vector file formats, databases and web
> services.
> It includes bindings for several languages, and a variety of command line
> tools.
>
>     https://usg02.safelinks.protection.office365.us/?url=http%3A%2F%2Fgdal.org%2F&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363705518%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=uyFxegtdVqazi%2BpUzHW6Y2vx5UVrwn97Xe4jxfgr9X0%3D&amp;reserved=0
>
> The 3.4.0 release is a new feature release with the following highlights:
>
> * [RFC 81](https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc81_coordinate_epoch.html&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363705518%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=IgtdgnC%2FtHwYr4jd5f2yGKj6hOxsgc6v1irtuDL30Hc%3D&amp;reserved=0):
>    Support for coordinate epochs in geospatial formats.
>    Implemented in FlatGeoBuf, GeoPackage, MEM, VRT
> * New GDAL drivers:
>    - [Zarr](https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgdal.org%2Fdrivers%2Fraster%2Fzarr.html&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=fv3Igmm8lc5xOStbrBonSoDQSboomAbiyWVKDwEpEvo%3D&amp;reserved=0):
>      read/write support for ZarrV2 (and experimental V3), using 2D
> classic raster
>      API or multidimensional API:
>    - [STACIT](https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgdal.org%2Fdrivers%2Fraster%2Fstacit.html&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=rYNT%2FG8BizGyNgTZiSPoGY%2Bwj1hU%2B%2FZHGPBZkXB8hRQ%3D&amp;reserved=0):
>      Spatio-Temporal Asset Catalog Items as virtual mosaics
> * Other improvements:
>    - number of enhancements in file system operations of /vsigs/
>    - NITF: additions to comply with NITF Version 2.1 Commercial Dataset
>      Requirements Document (NCDRD)
>    - ODBC and PGeo: multiple fixes and improvements
>    - SAFE (Sentinel1): multiple improvements related to SLC/calibration
> (change
>      subdataset naming)
>    - multidimensional API: caching, and other improvements
> * Code linting and security fixes
> * MDB driver (Java based) mark as deprecated. Planned for removal for
> GDAL 3.5.
>    ODBC driver is the preferred solution (with up-to-date MDBTools
> library on
>    non-Windows platforms)
> * Writing side of Tiger driver deprecated and will be removed in GDAL 3.5
> * Remainder: DODS, JPEG2000(Jasper), JPEGLS, MG4LIDAR, FUJIBAS, IDA,
> INGR and
>    vector driver ARCGEN, ArcObjects, CLOUDANT, COUCHDB, DB2, DODS, FME,
> GEOMEDIA,
>    GTM, INGRES, MONGODB, REC, WALK are planned for removal in GDAL 3.5.
> As well
>    as Perl bindings
>
> More complete information on the new features and fixes in the 3.4.0
> release can be found at:
>
>    https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fblob%2Fv3.4.0%2Fgdal%2FNEWS.md&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=GYtBAmSoLG57GdgmjmvNGuf8HB4U7p%2FIfuO56%2FlP9Zw%3D&amp;reserved=0
>
> The release can be downloaded from:
>    * https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fdownload.osgeo.org%2Fgdal%2F3.4.0%2Fgdal340.zip&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=TOQgqqzeRBJg%2FOVuJG%2BidqKrM68nA8WepR3X0fT9d30%3D&amp;reserved=0 - source as a zip
>    * https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fdownload.osgeo.org%2Fgdal%2F3.4.0%2Fgdal-3.4.0.tar.gz&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=3v4xfi7%2FC473ZEwO0rJFtM8oTrXxMyYbE40t3dLMMVI%3D&amp;reserved=0 - source as
> .tar.gz
>    * https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fdownload.osgeo.org%2Fgdal%2F3.4.0%2Fgdal-3.4.0.tar.xz&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=TV7J%2B6xRtvwa8UP0MSpi%2FoM2%2Fwcnc5tLwiJPaMPP%2F0o%3D&amp;reserved=0 - source as
> .tar.xz
>    * https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fdownload.osgeo.org%2Fgdal%2F3.4.0%2Fgdal-grass-3.4.0.tar.gz&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=HkD037FzWFo0iOMdhKXz5dro2azZG1R0SCABq29s4aM%3D&amp;reserved=0 -
> GDAL-GRASS plugin
>    * https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fdownload.osgeo.org%2Fgdal%2F3.4.0%2Fgdalautotest-3.4.0.tar.gz&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=snTmAp%2B2UQ8FWIBz8WyrG%2BG2FMMolpKg0NcT4lDt8bc%3D&amp;reserved=0 -
> test suite
>    * https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fdownload.osgeo.org%2Fgdal%2F3.4.0%2Fgdal340doc.zip&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=DUQgZmP5cKogUNgP9J6nom6gU6apep6kK4doJAey9ws%3D&amp;reserved=0 -
> documentation / website
>
> Best regards,
>
> Even
>

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&amp;data=04%7C01%7Cbclay%40infoscitex.com%7C52f6b9a5246f457b13c408d9a2dae757%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637719885363715511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=ofPDNbmZ91VnQOSXqj%2Fze4PFXn0LiKBlAtPk5X1VnKI%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211110/a7db5126/attachment-0001.html>

From Matt.Wilkie at yukon.ca  Wed Nov 10 13:03:48 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Wed, 10 Nov 2021 21:03:48 +0000
Subject: [gdal-dev] georeferenced but not georeferenced?
Message-ID: <dc5c68312fa14d299fcada70c0f7b316@yukon.ca>

Hi all,

I'm creating images from SPOT6/7 archive DIMAP format. The resulting images display in the correct position in the world when combined with other sources, however all the usual tools say the images have no georeferencing. 

* If the images have no georeferencing how do ArcMap/Pro and Qgis know to put them in the right place?
* How can I convert whatever-this-is into proper georeferencing so that other tools know how to handle them too?

Attached is a sample image.  It was created with (on one line):

    gdal_translate  -outsize 100 0 
    -co compress=zstd -co predictor=yes -co level=17 -co bigtiff=yes -of cog 
    .\path\to\IMG_SPOT6_MS_001_A\DIM_SPOT6_MS_201609082010410_SEN_1.XML 
    source_tiny.tif

The biggest problem this causes me at the moment is that gdal_pansharpen.py output does not have any kind of goereferencing, and I can't use old faithfuls like listgeo, geotiffcp, or gdalcopyproj.py to copy the coordinate system across.

thanks in advance for your thoughts,

Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: source_tiny.tif
Type: image/tiff
Size: 42390 bytes
Desc: source_tiny.tif
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211110/00bb6a71/attachment-0001.tif>

From even.rouault at spatialys.com  Wed Nov 10 13:15:57 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 10 Nov 2021 22:15:57 +0100
Subject: [gdal-dev] georeferenced but not georeferenced?
In-Reply-To: <dc5c68312fa14d299fcada70c0f7b316@yukon.ca>
References: <dc5c68312fa14d299fcada70c0f7b316@yukon.ca>
Message-ID: <7450e7a2-b17b-4614-f83a-eab09f85ed8f@spatialys.com>


Le 10/11/2021 ? 22:03, Matt.Wilkie at yukon.ca a ?crit?:
> Hi all,
>
> I'm creating images from SPOT6/7 archive DIMAP format. The resulting images display in the correct position in the world when combined with other sources, however all the usual tools say the images have no georeferencing.
>
> * If the images have no georeferencing how do ArcMap/Pro and Qgis know to put them in the right place?

Those images have RPC. You can see RPC information with gdalinfo in the 
"RPC Metadata" section

listeo/geotiffcp and a number of utilities are not RPC aware. But 
gdalwarp is.

> * How can I convert whatever-this-is into proper georeferencing so that other tools know how to handle them too?
You can use gdalwarp to orthorectify them.? You should generally specify 
-to RPC_DEM=some_dem_with_elevation_as_ellipsoidal_heights or -to 
RPC_HEIGHT=ellipsoidal_height. See 
https://gdal.org/api/gdal_alg.html?highlight=rpc_dem
>
> Attached is a sample image.  It was created with (on one line):
>
>      gdal_translate  -outsize 100 0
>      -co compress=zstd -co predictor=yes -co level=17 -co bigtiff=yes -of cog
>      .\path\to\IMG_SPOT6_MS_001_A\DIM_SPOT6_MS_201609082010410_SEN_1.XML
>      source_tiny.tif
>
> The biggest problem this causes me at the moment is that gdal_pansharpen.py output does not have any kind of goereferencing, and I can't use old faithfuls like listgeo, geotiffcp, or gdalcopyproj.py to copy the coordinate system across.
>
> thanks in advance for your thoughts,
>
> Matt Wilkie
> Geomatics Developer & Administrator
> Environment | Technology, Innovation and Mapping
> T 867-667-8133 | Yukon.ca
> Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211110/5162b589/attachment.html>

From yext0422 at 126.com  Wed Nov 10 18:48:35 2021
From: yext0422 at 126.com (=?UTF-8?B?5pmT5b2k?=)
Date: Thu, 11 Nov 2021 10:48:35 +0800 (GMT+08:00)
Subject: [gdal-dev] python gdal.warp error: The transformation is already
 "north up"
Message-ID: <42637880.4ff4.17d0ce5a305.Coremail.yext0422@126.com>

Hi all,
I'm working on some MODIS products and try to put them into WGS84 coordinate system after geometric correction. I used gdal.warp to process satellite image in form of HDF files(eg. MODIS fire product MOD14, MODIS aerosol product MOD04), but it threw an error which I was unable to fix:
The transformation is already "north up" or a transformation between pixel/line and georeferenced coordinates cannot be computed for HDF4_SDS:UNKNOWN:"MOD14.A2010182.0625.061.2021162192551.hdf":0. There
is no affine transformation and no GCPs. Specify transformation option SRC_METHOD=NO_GEOTRANSFORM to bypass this check.


My geometric correction code is like this:


        fireData = gdal.Warp(outName4, firemask,
                           dstSRS = 'EPSG:4326', format = 'GTiff',
                            resampleAlg = gdal.GRA_Bilinear)


The same code works when 'firemask' is read from MOD04 hdf files, but as long as I change the input raster from MOD14 hdf files, it throws an error like above.



My read data code is as below:
datasets = gdal.Open(fn)
dsSubDatasets = datasets.GetSubDatasets()
firemask = gdal.Open(dsSubDatasets[0][0])


As I tried to figure out this problem, I can't fine any parameter named "SRC_METHOD" in python gdal. Then I checked the metadata of MOD14 hdf file, it doesn't contain any coordinate system information.


Does anyone have any idea about this error?  Thank you for your time and any suggestion is welcomed!


Vera



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/b81e4b68/attachment.html>

From loridigia at gmail.com  Thu Nov 11 06:45:53 2021
From: loridigia at gmail.com (Lorenzo Di Giacomo)
Date: Thu, 11 Nov 2021 15:45:53 +0100
Subject: [gdal-dev] Mosaicing using GDAL Wrap / Translate
Message-ID: <CAERmyNR2JHpfTjeBdnh4fmmFydnya1C6UiKB=NvBvGcBoRhh+Q@mail.gmail.com>

Hi, i can't find a simple way (not to choose the cut coordinates manually)
in order to crop an entire raster image into N images given a fixed size of
pixel, how can this be achieved? Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/55e26898/attachment.html>

From lars.schylberg at blixtmail.se  Thu Nov 11 08:13:05 2021
From: lars.schylberg at blixtmail.se (lars.schylberg at blixtmail.se)
Date: Thu, 11 Nov 2021 16:13:05 +0000
Subject: [gdal-dev] Mosaicing using GDAL Wrap / Translate
In-Reply-To: <CAERmyNR2JHpfTjeBdnh4fmmFydnya1C6UiKB=NvBvGcBoRhh+Q@mail.gmail.com>
References: <CAERmyNR2JHpfTjeBdnh4fmmFydnya1C6UiKB=NvBvGcBoRhh+Q@mail.gmail.com>
Message-ID: <d4ebc19b0d817afe0fdfb660fc90a1a6@blixtmail.se>

Hi

I talked about this at the foss4g 2 years ago and shared a bash script where I do exactly what you are asking for. I don't know if you consider it to be easy, but
the example is this script: https://gist.github.com/LarsSchy/9ecb31eb964dd83820c139b2f2769a7c (https://gist.github.com/LarsSchy/9ecb31eb964dd83820c139b2f2769a7c)

Look at the function: retile_with_mask() in the script. The script is doing other things as well like creating a tile index for Mapserver usage and trimming the tiles from nodata parts.

Have fun / Lars S.
11 november 2021 kl. 15:46, "Lorenzo Di Giacomo" <loridigia at gmail.com (mailto:loridigia at gmail.com?to=%22Lorenzo%20Di%20Giacomo%22%20<loridigia at gmail.com>)> skrev:
Hi, i can't find a simple way (not to choose the cut coordinates manually) in order to crop an entire raster image into N images given a fixed size of pixel, how can this be achieved? Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/a668c570/attachment.html>

From loridigia at gmail.com  Thu Nov 11 08:54:18 2021
From: loridigia at gmail.com (Lorenzo Di Giacomo)
Date: Thu, 11 Nov 2021 17:54:18 +0100
Subject: [gdal-dev] Mosaicing using GDAL Wrap / Translate
In-Reply-To: <d4ebc19b0d817afe0fdfb660fc90a1a6@blixtmail.se>
References: <CAERmyNR2JHpfTjeBdnh4fmmFydnya1C6UiKB=NvBvGcBoRhh+Q@mail.gmail.com>
 <d4ebc19b0d817afe0fdfb660fc90a1a6@blixtmail.se>
Message-ID: <CAERmyNRiwdbRmLbER9hajk8gYYCKkgc+Y7wj-ir=D-86fKH8bw@mail.gmail.com>

I guess it'll do the trick but a python script would be appreciated instead
of rewriting it, if someone has it would be helpful, thanks!

Il giorno gio 11 nov 2021 alle ore 17:22 <lars.schylberg at blixtmail.se> ha
scritto:

> Hi
>
> I talked about this at the foss4g 2 years ago and shared a bash script
> where I do exactly what you are asking for. I don't know if you consider it
> to be easy, but
> the example is this script:
> https://gist.github.com/LarsSchy/9ecb31eb964dd83820c139b2f2769a7c
>
> Look at the function: retile_with_mask() in the script. The script is
> doing other things as well like creating a tile index for Mapserver usage
> and trimming the tiles from nodata parts.
>
> Have fun / Lars S.
>
>
> 11 november 2021 kl. 15:46, "Lorenzo Di Giacomo" <loridigia at gmail.com
> <loridigia at gmail.com?to=%22Lorenzo%20Di%20Giacomo%22%20%3Cloridigia at gmail.com%3E>>
> skrev:
>
> Hi, i can't find a simple way (not to choose the cut coordinates manually)
> in order to crop an entire raster image into N images given a fixed size of
> pixel, how can this be achieved? Thanks
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/035dcce3/attachment-0001.html>

From lars.schylberg at blixtmail.se  Thu Nov 11 10:07:30 2021
From: lars.schylberg at blixtmail.se (Lars Schylberg)
Date: Thu, 11 Nov 2021 19:07:30 +0100
Subject: [gdal-dev] Mosaicing using GDAL Wrap / Translate
In-Reply-To: <CAERmyNRiwdbRmLbER9hajk8gYYCKkgc+Y7wj-ir=D-86fKH8bw@mail.gmail.com>
References: <CAERmyNR2JHpfTjeBdnh4fmmFydnya1C6UiKB=NvBvGcBoRhh+Q@mail.gmail.com>
 <d4ebc19b0d817afe0fdfb660fc90a1a6@blixtmail.se>
 <CAERmyNRiwdbRmLbER9hajk8gYYCKkgc+Y7wj-ir=D-86fKH8bw@mail.gmail.com>
Message-ID: <e01dff8d-54e2-d9bf-2a7a-657cfdcaa9e9@blixtmail.se>

Hi,

Sorry, but I am a linux person and it usually takes me 3 times longer to 
write python.

There is the python program gdal_retile.py, but if I remember, it didn't 
handle my use case the way I wanted it.

/Lars S.

Den 2021-11-11 kl. 17:54, skrev Lorenzo Di Giacomo:
> I guess it'll do the trick but a python script would be appreciated 
> instead of rewriting it, if someone has it would be helpful, thanks!
>
> Il giorno gio 11 nov 2021 alle ore 17:22 <lars.schylberg at blixtmail.se> 
> ha scritto:
>
>     Hi
>
>     I talked about this at the foss4g 2 years ago and shared a bash
>     script where I do exactly what you are asking for. I don't know if
>     you consider it to be easy, but
>     the example is this script:
>     https://gist.github.com/LarsSchy/9ecb31eb964dd83820c139b2f2769a7c
>
>     Look at the function: retile_with_mask() in the script. The script
>     is doing other things as well like creating a tile index for
>     Mapserver usage and trimming the tiles from nodata parts.
>
>     Have fun / Lars S.
>
>
>     11 november 2021 kl. 15:46, "Lorenzo Di Giacomo"
>     <loridigia at gmail.com
>     <mailto:loridigia at gmail.com?to=%22Lorenzo%20Di%20Giacomo%22%20%3Cloridigia at gmail.com%3E>>
>     skrev:
>
>         Hi, i can't find a simple way (not to choose the cut
>         coordinates manually) in order to crop an entire raster image
>         into N images given a fixed size of pixel, how can this be
>         achieved? Thanks
>
>
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/4232a9f3/attachment.html>

From paraglide at yahoo.ca  Thu Nov 11 14:39:13 2021
From: paraglide at yahoo.ca (peter vG)
Date: Thu, 11 Nov 2021 22:39:13 +0000 (UTC)
Subject: [gdal-dev] Building Gdal with C++ Visual Studio 2019 - Error
 Linking.
References: <605088085.46107.1636670353808.ref@mail.yahoo.com>
Message-ID: <605088085.46107.1636670353808@mail.yahoo.com>

I've been trying to build the binaries for Gdal 3.3.3 (and 3.4.0) using Visual C++ (via Visual Studio 2019), but I am getting a linking error that has me scratching my head: LINK : "fatal error LNK1104: cannot open file 'C:\gdal-3.4.0\lib.obj'". What is lib.obj? I am new to Visual C++, having come from the CPP Builder world, so I'm still getting my head around this product. Any suggestions would be greatly appreciated as I am wasting my life trying to hunt down a solution!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/e05f46d0/attachment.html>

From hghklly at gmail.com  Thu Nov 11 16:02:24 2021
From: hghklly at gmail.com (Hugh Kelley)
Date: Thu, 11 Nov 2021 19:02:24 -0500
Subject: [gdal-dev] Building Gdal with C++ Visual Studio 2019 - Error
 Linking.
In-Reply-To: <605088085.46107.1636670353808@mail.yahoo.com>
References: <605088085.46107.1636670353808.ref@mail.yahoo.com>
 <605088085.46107.1636670353808@mail.yahoo.com>
Message-ID: <CAOrcXHHj4Ea5hgfkhpxbh9x1n2AugAnJpehkMUJ2PJBVvuo09w@mail.gmail.com>

At the risk of demonstrating my ignorance, if you're using visual studio
c++ because you're confined to a windows OS, you may have an easier time
switching to windows subsystem for Linux. Its easily set up and allows you
to run a Ubuntu vm from a windows machine. It nicely integrates with vs
code as well. Compiling things on windows is a nightmare in my experience.

On Thu, Nov 11, 2021, 5:39 PM peter vG via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> I've been trying to build the binaries for Gdal 3.3.3 (and 3.4.0) using
> Visual C++ (via Visual Studio 2019), but I am getting a linking error that
> has me scratching my head: LINK : "fatal error LNK1104: cannot open file
> 'C:\gdal-3.4.0\lib.obj'". What is lib.obj? I am new to Visual C++, having
> come from the CPP Builder world, so I'm still getting my head around this
> product. Any suggestions would be greatly appreciated as I am wasting my
> life trying to hunt down a solution!
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/20c677c9/attachment.html>

From cgodkin at gmail.com  Thu Nov 11 17:00:41 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 11 Nov 2021 17:00:41 -0800
Subject: [gdal-dev] Building Gdal with C++ Visual Studio 2019 - Error
 Linking.
In-Reply-To: <605088085.46107.1636670353808@mail.yahoo.com>
References: <605088085.46107.1636670353808.ref@mail.yahoo.com>
 <605088085.46107.1636670353808@mail.yahoo.com>
Message-ID: <CAE=8kmmkzCJJa6TUhCrwXZkhwMYhaka_YXaXCn+EdkC_3Nn1NQ@mail.gmail.com>

Hi Peter,

I think you'll have to tell us how you tried to build GDAL in order to get
more help.  There is a lot of variability, but here's how I recently built
both of the versions you mention:

First, I create a file I called "win64.opt" that looks like this:
-----8<--------------------------------------------
WIN64=YES

GDAL_HOME = d:\gdal-3.4.0
BINDIR = $(GDAL_HOME)\bin64
PLUGINDIR = $(BINDIR)\gdalplugins64
LIBDIR = $(GDAL_HOME)\lib64

OPENSSL_PATH=D:\openssl-1.1.1e
SSLLIBS = $(OPENSSL_PATH)/lib/libcrypto.lib $(OPENSSL_PATH)/lib/libssl.lib

CURL_DIR = d:\curl-7.69.1
CURL_INC = -I$(CURL_DIR)\include
CURL_LIB = $(CURL_DIR)\lib\libcurl_imp.lib $(SSLLIBS) wsock32.lib
wldap32.lib winmm.lib

PROJ_INCLUDE = -Id:\proj-8.1.1\include
PROJ_LIBRARY = d:\proj-8.1.1\lib\proj.lib shell32.lib ole32.lib

SQLITE_INC = -Id:\sqlite-3.28.0
SQLITE_LIB = d:\sqlite-3.28.0\sqlite3.lib
-----8<--------------------------------------------
Note that you'll have to build PROJ ahead of time first and adjust the
above depending on where you install it.

Then I build from the VS2019 command prompt with a command line like this
nmake -f makefile.vc EXT_NMAKE_OPT=win64.opt devinstall

If you just want the binaries and don't plan to build against GDAL, you can
use plain "install" instead.

(Note that the PROJ and GDAL worlds are moving to Cmake but the above has
worked for me for many years.)

Hope that helps,
carl


On Thu, Nov 11, 2021 at 2:39 PM peter vG via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> I've been trying to build the binaries for Gdal 3.3.3 (and 3.4.0) using
> Visual C++ (via Visual Studio 2019), but I am getting a linking error that
> has me scratching my head: LINK : "fatal error LNK1104: cannot open file
> 'C:\gdal-3.4.0\lib.obj'". What is lib.obj? I am new to Visual C++, having
> come from the CPP Builder world, so I'm still getting my head around this
> product. Any suggestions would be greatly appreciated as I am wasting my
> life trying to hunt down a solution!
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211111/859a003b/attachment.html>

From jmckenna at gatewaygeomatics.com  Fri Nov 12 07:13:35 2021
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Fri, 12 Nov 2021 11:13:35 -0400
Subject: [gdal-dev] Building Gdal with C++ Visual Studio 2019 - Error
 Linking.
In-Reply-To: <605088085.46107.1636670353808@mail.yahoo.com>
References: <605088085.46107.1636670353808.ref@mail.yahoo.com>
 <605088085.46107.1636670353808@mail.yahoo.com>
Message-ID: <4e13c5f7-d7c3-73e1-4992-1fa90a7c64c2@gatewaygeomatics.com>

Please also see the BuildHints wiki, as many of us were contributing 
there steps for Windows and other GDAL drivers over the years: 
https://trac.osgeo.org/gdal/wiki/BuildingOnWindows. Today it's still a 
gold mine of tips and configure steps that are key to making it all work 
together.

-jeff



-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/


On 2021-11-11 6:39 p.m., peter vG via gdal-dev wrote:
> I've been trying to build the binaries for Gdal 3.3.3 (and 3.4.0) using 
> Visual C++ (via Visual Studio 2019), but I am getting a linking error 
> that has me scratching my head: LINK : "fatal error LNK1104: cannot open 
> file 'C:\gdal-3.4.0\lib.obj'". What is lib.obj? I am new to Visual C++, 
> having come from the CPP Builder world, so I'm still getting my head 
> around this product. Any suggestions would be greatly appreciated as I 
> am wasting my life trying to hunt down a solution!
> 
>



From jluis at ualg.pt  Fri Nov 12 07:33:38 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Fri, 12 Nov 2021 15:33:38 +0000
Subject: [gdal-dev] Building Gdal with C++ Visual Studio 2019 - Error
 Linking.
In-Reply-To: <4e13c5f7-d7c3-73e1-4992-1fa90a7c64c2@gatewaygeomatics.com>
References: <605088085.46107.1636670353808.ref@mail.yahoo.com>
 <605088085.46107.1636670353808@mail.yahoo.com>
 <4e13c5f7-d7c3-73e1-4992-1fa90a7c64c2@gatewaygeomatics.com>
Message-ID: <AM6PR04MB3959AF5B1E18BE6EBB79C03AA6959@AM6PR04MB3959.eurprd04.prod.outlook.com>

My wild guess.

Somewhere you have a spaces-in-name shit and a code named (some variation of this) "lib thisprogram.cpp" got truncated and the linker is now searching for the lib.obj instead of "lib thisprogram.obj"

Joaquim

-----Original Message-----
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Jeff McKenna
Sent: Friday, November 12, 2021 3:14 PM
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Building Gdal with C++ Visual Studio 2019 - Error Linking.

Please also see the BuildHints wiki, as many of us were contributing there steps for Windows and other GDAL drivers over the years: 
https://trac.osgeo.org/gdal/wiki/BuildingOnWindows. Today it's still a gold mine of tips and configure steps that are key to making it all work together.

-jeff



--
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training co-founder of FOSS4G http://gatewaygeo.com/


On 2021-11-11 6:39 p.m., peter vG via gdal-dev wrote:
> I've been trying to build the binaries for Gdal 3.3.3 (and 3.4.0) using 
> Visual C++ (via Visual Studio 2019), but I am getting a linking error 
> that has me scratching my head: LINK : "fatal error LNK1104: cannot open 
> file 'C:\gdal-3.4.0\lib.obj'". What is lib.obj? I am new to Visual C++, 
> having come from the CPP Builder world, so I'm still getting my head 
> around this product. Any suggestions would be greatly appreciated as I 
> am wasting my life trying to hunt down a solution!
> 
>


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From loridigia at gmail.com  Fri Nov 12 08:13:39 2021
From: loridigia at gmail.com (Lorenzo Di Giacomo)
Date: Fri, 12 Nov 2021 17:13:39 +0100
Subject: [gdal-dev] Raster supported raster conversions
Message-ID: <CAERmyNQZQFBiKNAyYOpcOLUQtrYKL3_n9QhZCJ5N7cTYktshmw@mail.gmail.com>

Hi i have a question about format conversion:
How is it possibile to know the possible conversions between formats (using
gdal_translate)?
I found https://gdal.org/drivers/raster/index.html, so i guess is possible
to convert from format X to format Y iff the GDAL driver of format Y has
the "Creation" field to "yes" ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211112/aaa36179/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 12 08:53:34 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 12 Nov 2021 16:53:34 +0000
Subject: [gdal-dev] Raster supported raster conversions
Message-ID: <910003990a5e466ebf7deef54ee98a79@maanmittauslaitos.fi>

Hi,

Having one of these in driver capabilities is enough:

Supports: Create() - Create writable dataset.
  Supports: CreateCopy() - Create dataset by copying another.

There may be some special cases like WMS driver that according to that table supports Copy but obviously you cannot convert GeoTIFF into WMS service with GDAL but that must mean something else.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Lorenzo Di Giacomo
L?hetetty: perjantai 12. marraskuuta 2021 18.14
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Raster supported raster conversions

Hi i have a question about format conversion:
How is it possibile to know the possible conversions between formats (using gdal_translate)?
I found https://gdal.org/drivers/raster/index.html, so i guess is possible to convert from format X to format Y iff the GDAL driver of format Y has the "Creation" field to "yes" ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211112/78b13eab/attachment.html>

From loridigia at gmail.com  Sat Nov 13 00:13:35 2021
From: loridigia at gmail.com (Lorenzo Di Giacomo)
Date: Sat, 13 Nov 2021 09:13:35 +0100
Subject: [gdal-dev] Raster supported raster conversions
In-Reply-To: <910003990a5e466ebf7deef54ee98a79@maanmittauslaitos.fi>
References: <910003990a5e466ebf7deef54ee98a79@maanmittauslaitos.fi>
Message-ID: <CAERmyNTtjQb5Zp4u+oTRMNtwfr6Uv+iKwt5bd1SMySFGxTcW3A@mail.gmail.com>

Thank you !!

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211113/518c7045/attachment.html>

From simon.eves at omnisci.com  Sun Nov 14 16:32:52 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Sun, 14 Nov 2021 16:32:52 -0800
Subject: [gdal-dev] Intermittent memory-corruption crashes in GRIB2 import
In-Reply-To: <CAJf0KTTH3MitfRhAUP3Bs3U=2NNT58XMn0ZA+7Ck1yyxiiqTag@mail.gmail.com>
References: <CAJf0KTTH3MitfRhAUP3Bs3U=2NNT58XMn0ZA+7Ck1yyxiiqTag@mail.gmail.com>
Message-ID: <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>

We have recently implemented a geo raster importer, and all seems fine,
except that we hit an issue with a particular GRIB2 file from the NOAA
website, where we get an inconsistent crash inside GDAL after a few hundred
scanlines.

We have seen two different crashes inside GDAL, and a third in one of our
code paths, but given that there is a memory corruption, the latter is
perhaps unsurprising.

All crashes report "double free or corruption (fasttop)".

We are multi-threading the reading, but using a OGRDataSource per thread.
The child threads are only calling GetRasterBand(), GetRasterDataType() and
RasterIO() and only one one band at a time.

The GRIB2 file is 103MB with 73 Float64 bands, but only 2345x1597 "pixels".

We tried converting the file to GeoTIFF with gdal_translate (no options,
just in and out) and it took 28 minutes (on a ~2017 i7 quad 4.2), which is
surprising, as we have other GRIB2 files (between 2 and 12MB) which convert
"instantly". The resulting GeoTIFF is much bigger (21x) but seems to import
reliably, has basically the same schema (as reported by gdalinfo) and
results in the same data when imported into our system.

We only get the crash occasionally, and have only been able to trap it in
the Debugger a couple of times, with nothing obviously wrong.

Here is a link to the GRIB2 file in question:

https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing

Attached is the most common stack trace.

With a DEBUG build of GDAL, looks like it's crashing trying to do a
realloc() on "buffer" which is NULL, although that is supposedly a copy of
"&errBuffer" at the frame above which seems fine.

Gonna try robustifying that code and see what happens...

This is all with GDAL 3.2.2 on Ubuntu 20.04 LTS with GCC 9.

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211114/18e03b51/attachment.html>
-------------- next part --------------
libc.so.6!raise (Unknown Source:0)
libc.so.6!abort (Unknown Source:0)
libc.so.6![Unknown/Just-In-Time compiled code] (Unknown Source:0)
libc.so.6!realloc (Unknown Source:0)
libgdal.so.28!AllocSprintf(char ** Ptr, size_t * LenBuff, const char * fmt, struct __va_list_tag * ap) (/build/scripts/gdal-3.2.2/frmts/grib/degrib/degrib/myerror.c:126)
libgdal.so.28!errSprintf(const char * fmt) (/build/scripts/gdal-3.2.2/frmts/grib/degrib/degrib/myerror.c:393)
libgdal.so.28!ElemNameProb(int templat, uChar genID, int * convert, char ** unit, char ** comment, char ** name, double upperProb, double lowerProb, uChar probType, uChar timeIncrType, uChar timeRangeUnit, sInt4 lenTime, uChar subcat, uChar cat, int prodType, uShort2 subcenter, uChar mstrVersion) (/build/scripts/gdal-3.2.2/frmts/grib/degrib/degrib/metaname.cpp:2778)
libgdal.so.28!ParseElemName(uChar mstrVersion, uShort2 center, uShort2 subcenter, int prodType, int templat, int cat, int subcat, sInt4 lenTime, uChar timeRangeUnit, uChar statProcessID, uChar timeIncrType, uChar genID, uChar probType, double lowerProb, double upperProb, uChar derivedFcst, char ** name, char ** comment, char ** unit, int * convert, sChar percentile, uChar genProcess, sChar f_fstValue, double fstSurfValue, sChar f_sndValue, double sndSurfValue) (/build/scripts/gdal-3.2.2/frmts/grib/degrib/degrib/metaname.cpp:3542)
libgdal.so.28!MetaParse(grib_MetaData * meta, sInt4 * is0, sInt4 ns0, sInt4 * is1, sInt4 ns1, sInt4 * is2, sInt4 ns2, float * rdat, sInt4 nrdat, sInt4 * idat, sInt4 nidat, sInt4 * is3, sInt4 ns3, sInt4 * is4, sInt4 ns4, sInt4 * is5, sInt4 ns5, sInt4 grib_len, float xmissp, float xmisss, int simpVer, int simpWWA) (/build/scripts/gdal-3.2.2/frmts/grib/degrib/degrib/metaparse.cpp:2461)
libgdal.so.28!ReadGrib2Record(VSILFILE * fp, sChar f_unit, double ** Grib_Data, uInt4 * grib_DataLen, grib_MetaData * meta, IS_dataType * IS, int subgNum, double majEarth, double minEarth, int simpVer, int simpWWA, sInt4 * f_endMsg, LatLon * lwlf, LatLon * uprt) (/build/scripts/gdal-3.2.2/frmts/grib/degrib/degrib/degrib2.cpp:1199)
libgdal.so.28!GRIBRasterBand::ReadGribData(VSILFILE * fp, vsi_l_offset start, int subgNum, double ** data, grib_MetaData ** metaData) (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:930)
libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this) (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:746)
libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this) (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:697)
libgdal.so.28!GRIBRasterBand::IReadBlock(GRIBRasterBand * const this, int nBlockYOff, void * pImage) (/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:803)
libgdal.so.28!GDALRasterBand::GetLockedBlockRef(int bJustInitialize, int nYBlockOff, int nXBlockOff, GDALRasterBand * const this) (/build/scripts/gdal-3.2.2/gcore/gdal_priv.h:963)
libgdal.so.28!GDALRasterBand::GetLockedBlockRef(GDALRasterBand * const this, int nXBlockOff, int nYBlockOff, int bJustInitialize) (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:1238)
libgdal.so.28!GDALRasterBand::IRasterIO(GDALRasterBand * const this, GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg) (/build/scripts/gdal-3.2.2/gcore/rasterio.cpp:149)
libgdal.so.28!GDALRasterBand::RasterIO(GDALRasterBand * const this, GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void * pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg) (/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:372)
import_export::RasterImporter::getRawPixels(import_export::RasterImporter * const this, const uint32_t thread_idx, const uint32_t band_idx, const int y_start, const int num_rows, std::vector<std::byte, std::allocator<std::byte> > & raw_pixel_bytes) (/home/simon.eves/work/omniscidb-internal/ImportExport/RasterImporter.cpp:427)
import_export::Importer::<lambda(size_t, int, int)>::operator()(size_t, int, int) const(const import_export::Importer::<lambda(size_t, int, int)> * const __closure, const size_t thread_idx, const int y_start, const int y_end) (/home/simon.eves/work/omniscidb-internal/ImportExport/Importer.cpp:5737)
std::__invoke_impl<std::tuple<import_export::ImportStatus, std::array<float, 3> >, import_export::Importer::importGDALRaster(import_export::ColumnNameToSourceNameMapType, const Catalog_Namespace::SessionInfo*)::<lambda(size_t, int, int)>, long unsigned int, int, int>(std::__invoke_other, import_export::Importer::<lambda(size_t, int, int)> &&)(import_export::Importer::<lambda(size_t, int, int)> && __f) (/usr/include/c++/9/bits/invoke.h:60)
std::__invoke<import_export::Importer::importGDALRaster(import_export::ColumnNameToSourceNameMapType, const Catalog_Namespace::SessionInfo*)::<lambda(size_t, int, int)>, long unsigned int, int, int>(import_export::Importer::<lambda(size_t, int, int)> &&)(import_export::Importer::<lambda(size_t, int, int)> && __fn) (/usr/include/c++/9/bits/invoke.h:96)
std::thread::_Invoker<std::tuple<import_export::Importer::importGDALRaster(import_export::ColumnNameToSourceNameMapType, const Catalog_Namespace::SessionInfo*)::<lambda(size_t, int, int)>, long unsigned int, int, int> >::_M_invoke<0, 1, 2, 3>(std::_Index_tuple<0, 1, 2, 3>)(std::thread::_Invoker<std::tuple<import_export::Importer::importGDALRaster(import_export::ColumnNameToSourceNameMapType, const Catalog_Namespace::SessionInfo*)::<lambda(size_t, int, int)>, long unsigned int, int, int> > * const this) (/usr/include/c++/9/thread:244)
std::thread::_Invoker<std::tuple<import_export::Importer::importGDALRaster(import_export::ColumnNameToSourceNameMapType, const Catalog_Namespace::SessionInfo*)::<lambda(size_t, int, int)>, long unsigned int, int, int> >::operator()(void)(std::thread::_Invoker<std::tuple<import_export::Importer::importGDALRaster(import_export::ColumnNameToSourceNameMapType, const Catalog_Namespace::SessionInfo*)::<lambda(size_t, int, int)>, long unsigned int, int, int> > * const this) (/usr/include/c++/9/thread:251)
...

From andrew at aitchison.me.uk  Sun Nov 14 21:23:25 2021
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 15 Nov 2021 05:23:25 +0000 (GMT)
Subject: [gdal-dev] Intermittent memory-corruption crashes in GRIB2
 import
In-Reply-To: <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>
References: <CAJf0KTTH3MitfRhAUP3Bs3U=2NNT58XMn0ZA+7Ck1yyxiiqTag@mail.gmail.com>
 <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>
Message-ID: <118668ac-37ba-3123-794d-73d64347ccf@aitchison.me.uk>

On Sun, 14 Nov 2021, Simon Eves wrote:

> We have recently implemented a geo raster importer, and all seems fine,
> except that we hit an issue with a particular GRIB2 file from the NOAA
> website, where we get an inconsistent crash inside GDAL after a few hundred
> scanlines.
>
> We have seen two different crashes inside GDAL, and a third in one of our
> code paths, but given that there is a memory corruption, the latter is
> perhaps unsurprising.
>
> All crashes report "double free or corruption (fasttop)".
> We only get the crash occasionally, and have only been able to trap it in
> the Debugger a couple of times, with nothing obviously wrong.
>
> Here is a link to the GRIB2 file in question:
>
> https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing

Is running under valgrind an option ?

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From pepijn.szeker at tractebel.engie.com  Mon Nov 15 00:43:33 2021
From: pepijn.szeker at tractebel.engie.com (pepijn.szeker at tractebel.engie.com)
Date: Mon, 15 Nov 2021 08:43:33 +0000
Subject: [gdal-dev] gdal2tiles EPSG:3857 Out of Memory
Message-ID: <AM0PR05MB417831BF640DE481460A15D8B3989@AM0PR05MB4178.eurprd05.prod.outlook.com>

Dear all,

I assume this belongs to this mailing list instead of the GitHub Issues.
Find attached 2 pdf (plots from QGIS) of the same area, but plotted in EPSG:3857 and EPSG: 31370. (if attachments are not allowed: there is nothing special about what is on the pdf: it's simply 1 styled vector line and 1 labelled vector point).
The pdf were checked with gdalinfo. Except for the CRS, I don't notice anything peculiar.

Notice this is still gdal 2.4.0. Due to company restrictions gdal 3 tiling runs awfully slow. Maybe the problem is however known to any of you.

Windows 10, python 2.7

Task:

  *   Running gdal2tiles on the pdf, with parameters:
     *   -r antialias
     *   -z 12-18
     *   -processes=30

Problem:

  *   EPSG 31370 runs fine, but due to reprojection labels are slightly rotated
  *   EPSG 3857 plot would fix the above, but for some reason gdal2tiles will not run on this. It barely starts. After waiting long enough error codes start showing in the CMD. The errors contain easily hundreds of line.
See below a small excerpt:

Out of memory
Out of memory
0Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
ERROR 2: Cannot allocate result buffer
ERROR 2: memdataset.cpp, 1541: cannot allocate 1x1048576 bytes
Out of memory
Out of memory
Out of memory
ERROR 1: Bitmap decoded size (1x1) doesn't match raster size (1024x1024)
ERROR 1: C:\Users\MyUser\AppData\Local\Temp\tmpj7_ghurm\e4a8f99b-98d8-4425-b6d1-6540ff951385.vrt, band 2: IReadBlock failed at X offset 5, Y offset 2: Bitmap decoded size (1x1) doesn't match raster size (1024x1024)
.Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
ERROR 1: C:\Users\MyUser\AppData\Local\Temp\tmpj7_ghurm\e4a8f99b-98d8-4425-b6d1-6540ff951385.vrt, band 1: IReadBlock failed at X offset 1, Y offset 4
10Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory



Any pointers?
Met vriendelijke groeten,
Pepijn SZEK?R
Engineer - Transport Infrastructure
pepijn.szeker at tractebel.engie.com
<mailto:pepijn.szeker at tractebel.engie.com>M +32 499 61 25 58

[cid:image001.png at 01D7DA05.398D4450]



tractebel-engie.com
<http://tractebel-engie.com/>
TRACTEBEL ENGINEERING S.A.
Ilgatlaan 23
3500 Hasselt - BELGIUM

VAT BE 0412 639 681 RPR/RPM Brussels
Please consider the environment before printing this document.

[cid:image004.png at 01D7DA05.398D4450]<https://www.linkedin.com/company/tractebel-engie-group>  [cid:image006.png at 01D7DA05.398D4450] <https://twitter.com/Tractebel>   [cid:image008.png at 01D7DA05.398D4450] <https://www.instagram.com/tractebel_company>   [cid:image010.png at 01D7DA05.398D4450] <https://www.youtube.com/tractebelengie>



TRACTEBEL Privacy Statement: https://tractebel-engie.com/en/data-privacy

ENGIE Mail Disclaimer: http://www.engie.com/disclaimer/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 4492 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 256 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 717 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 758 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.png
Type: image/png
Size: 938 bytes
Desc: image008.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image010.png
Type: image/png
Size: 638 bytes
Desc: image010.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 3857.pdf
Type: application/pdf
Size: 11293 bytes
Desc: 3857.pdf
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0002.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 31370.pdf
Type: application/pdf
Size: 11434 bytes
Desc: 31370.pdf
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/f3e01cc4/attachment-0003.pdf>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 15 01:53:23 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 15 Nov 2021 09:53:23 +0000
Subject: [gdal-dev] gdal2tiles EPSG:3857 Out of Memory
Message-ID: <263ec746bd974ee6b15f70b70ecb9b93@maanmittauslaitos.fi>

Hi,

GDAL version 2.4.0 is not supported any more. I had a try with 3857.pdf with GDAL 3.1.7 and Python 3.7 by running
gdal2tiles -r average -z 12-18 3857.pdf

Process took 15 seconds with my Windows laptop. I guessed you meant -r average because -t antialias does not exist to my knowledge.

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta pepijn.szeker at tractebel.engie.com
L?hetetty: maanantai 15. marraskuuta 2021 10.44
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdal2tiles EPSG:3857 Out of Memory

Dear all,

I assume this belongs to this mailing list instead of the GitHub Issues.
Find attached 2 pdf (plots from QGIS) of the same area, but plotted in EPSG:3857 and EPSG: 31370. (if attachments are not allowed: there is nothing special about what is on the pdf: it's simply 1 styled vector line and 1 labelled vector point).
The pdf were checked with gdalinfo. Except for the CRS, I don't notice anything peculiar.

Notice this is still gdal 2.4.0. Due to company restrictions gdal 3 tiling runs awfully slow. Maybe the problem is however known to any of you.

Windows 10, python 2.7

Task:

  *   Running gdal2tiles on the pdf, with parameters:
     *   -r antialias
     *   -z 12-18
     *   -processes=30

Problem:

  *   EPSG 31370 runs fine, but due to reprojection labels are slightly rotated
  *   EPSG 3857 plot would fix the above, but for some reason gdal2tiles will not run on this. It barely starts. After waiting long enough error codes start showing in the CMD. The errors contain easily hundreds of line.
See below a small excerpt:

Out of memory
Out of memory
0Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
ERROR 2: Cannot allocate result buffer
ERROR 2: memdataset.cpp, 1541: cannot allocate 1x1048576 bytes
Out of memory
Out of memory
Out of memory
ERROR 1: Bitmap decoded size (1x1) doesn't match raster size (1024x1024)
ERROR 1: C:\Users\MyUser\AppData\Local\Temp\tmpj7_ghurm\e4a8f99b-98d8-4425-b6d1-6540ff951385.vrt, band 2: IReadBlock failed at X offset 5, Y offset 2: Bitmap decoded size (1x1) doesn't match raster size (1024x1024)
.Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
ERROR 1: C:\Users\MyUser\AppData\Local\Temp\tmpj7_ghurm\e4a8f99b-98d8-4425-b6d1-6540ff951385.vrt, band 1: IReadBlock failed at X offset 1, Y offset 4
10Out of memory
Out of memory
Out of memory
Out of memory
Out of memory
Out of memory



Any pointers?
Met vriendelijke groeten,
Pepijn SZEK?R
Engineer - Transport Infrastructure
pepijn.szeker at tractebel.engie.com
<mailto:pepijn.szeker at tractebel.engie.com>M +32 499 61 25 58

[cid:image001.png at 01D7DA16.53955430]



tractebel-engie.com
<http://tractebel-engie.com/>
TRACTEBEL ENGINEERING S.A.
Ilgatlaan 23
3500 Hasselt - BELGIUM

VAT BE 0412 639 681 RPR/RPM Brussels
Please consider the environment before printing this document.

[cid:image003.png at 01D7DA16.53955430]<https://www.linkedin.com/company/tractebel-engie-group>  [cid:image004.png at 01D7DA16.53955430] <https://twitter.com/Tractebel>   [cid:image005.png at 01D7DA16.53955430] <https://www.instagram.com/tractebel_company>   [cid:image006.png at 01D7DA16.53955430] <https://www.youtube.com/tractebelengie>



TRACTEBEL Privacy Statement: https://tractebel-engie.com/en/data-privacy

ENGIE Mail Disclaimer: http://www.engie.com/disclaimer/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fe562aea/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 4492 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fe562aea/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 256 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fe562aea/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 717 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fe562aea/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 758 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fe562aea/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 938 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fe562aea/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 638 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fe562aea/attachment-0011.png>

From b.phamhuu at jacobs-university.de  Mon Nov 15 02:59:20 2021
From: b.phamhuu at jacobs-university.de (Bang Pham Huu)
Date: Mon, 15 Nov 2021 17:59:20 +0700
Subject: [gdal-dev] Process Sentinel-5p netCDF to tiff files but
 overlapping appears clearly between 2 files?
In-Reply-To: <d850b41a-4e94-6d83-d4c6-8bcc106804e3@jacobs-university.de>
References: <d850b41a-4e94-6d83-d4c6-8bcc106804e3@jacobs-university.de>
Message-ID: <294876ed-1fc6-37e5-da3e-1aa8d2f3b9e1@jacobs-university.de>

Could anyone comment for this problem?

Thanks,

On 11/8/21 1:09 PM, Bang Pham Huu wrote:
> Hello,
>
> I've used 2 Sentinel-5p scenes in hdf5 / netCDF to geoTiff by gdal
> version 2.2.4 like example below:
>
> First, I extract the lat and lon coordinates from one HDF5 file
>
> ???? gdal_translate -of VRT
> HDF5:"S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc"://PRODUCT/latitude
> lat.vrt
> ???? gdal_translate -of VRT
> HDF5:"S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc"://PRODUCT/longitude
> lon.vrt
>
> Then, I create the product.vrt like below
>
> ??????? <VRTDataset rasterXSize="450" rasterYSize="3735">
> ????? <Metadata domain="GEOLOCATION">
> ??????? <MDI key="LINE_OFFSET">0</MDI>
> ??????? <MDI key="LINE_STEP">1</MDI>
> ??????? <MDI key="PIXEL_OFFSET">0</MDI>
> ??????? <MDI key="PIXEL_STEP">1</MDI>
> ??????? <MDI key="X_BAND">1</MDI>
> ??????? <MDI
> key="X_DATASET">/home/PROJECTS/Sentinel-5P/test_L2_AER_AI/lon.vrt</MDI>
> ??????? <MDI key="Y_BAND">1</MDI>
> ??????? <MDI
> key="Y_DATASET">/home/PROJECTS/Sentinel-5P/test_L2_AER_AI/lat.vrt</MDI>
> ????? </Metadata>
> ????? <VRTRasterBand dataType="Float32" band="1">
> ??????? <Metadata>
> ????????? <MDI key="STATISTICS_MAXIMUM">9.9692099683869e+36</MDI>
> ????????? <MDI key="STATISTICS_MEAN">7.78603750784e+35</MDI>
> ????????? <MDI key="STATISTICS_MINIMUM">-7.209698677063</MDI>
> ????????? <MDI key="STATISTICS_STDDEV">2.6750402750247e+36</MDI>
> ??????? </Metadata>
> ??????? <SimpleSource>
> ????????? <SourceFilename
> relativeToVRT="1">HDF5:S5P_OFFL_L2__AER_AI_20210501T110005_20210501T124135_18388_01_010400_20210503T005051.nc://PRODUCT/aerosol_index_340_380</SourceFilename>
> ????????? <SourceBand>1</SourceBand>
> ????????? <SourceProperties RasterXSize="450" RasterYSize="3735"
> DataType="Float32" BlockXSize="225" BlockYSize="1868" />
> ????????? <SrcRect xOff="0" yOff="0" xSize="450" ySize="3735" />
> ????????? <DstRect xOff="0" yOff="0" xSize="450" ySize="3735" />
> ??????? </SimpleSource>
> ????? </VRTRasterBand>
> ??? </VRTDataset>
>
> And finally, I extract the data inside the HDF5 to geoTiff and project
> it to EPSG:4326 CRS.
>
> ??? gdalwarp -geoloc -t_srs EPSG:4326 -srcnodata 9.96921e+36f
> product.vrt aerosol_index_340_380.tiff -tr 0.069 0.069 -tap -of GTiff
>
> I did that for 2 files which are neighbor to extract the wanted
> sub_dataset to tiff files and then opened them on QGIS.
>
> ** The image looks like below https://imgur.com/uu6pS5n
>
> ** The two extracted tiff files can be found from
> https://drive.google.com/drive/folders/1lOXyJXhhzmfs5e_WTsKPOj96CHEEIyhP?usp=sharing
>
> I wonder, why there are clear borders (the line in the middle) between
> the 2 overlapping files?
>
> Thanks,
>

From j1 at jimenezshaw.com  Mon Nov 15 04:45:16 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 15 Nov 2021 13:45:16 +0100
Subject: [gdal-dev] gdal2tiles and EPSG:27700
In-Reply-To: <98b26b6e-0efe-532c-6f82-dab761121c73@spatialys.com>
References: <CADRrdKtXkwvaRYp-ytPGfVP_q=-sURN4vmj07OkACLL6eW54HQ@mail.gmail.com>
 <98b26b6e-0efe-532c-6f82-dab761121c73@spatialys.com>
Message-ID: <CADRrdKuDFx8TFquPAvZxHPcrdcjwYuvjogiFZ7JPwHGRzush=w@mail.gmail.com>

Hi Even,

Using "gdalwarp -ct" was a good solution. It worked fine. Thanks!
However, when I tested it with another GeoTIFF, this case is from Japan,
gdalwarp is producing something strange.

The image is in EPSG:2455 "JGD2000 / Japan Plane Rectangular CS XIII" ,
that in EPSG is defined as northing-easting.
It is located here:
$ gdalinfo input.tif | grep Center
Center      (  -88109.342, -129144.325) (143d10'20.17"E, 42d49'56.66"N)

I generate the pipeline this way
$ projinfo -s EPSG:2455 -t EPSG:3857 -o PROJ --single-line -q
+proj=pipeline +step +proj=axisswap +order=2,1 +step +inv +proj=tmerc
+lat_0=44 +lon_0=144.25 +k=0.9999 +x_0=0 +y_0=0 +ellps=GRS80 +step
+proj=webmerc +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84

But gdalwarp is producing strange outputs with that pipeline.
Letting gdalwarp read the CRS, it works fine:
$ gdalwarp -t_srs EPSG:3857 input.tif to3857.tif
$ gdalinfo to3857.tif | grep Center
Center      (15937864.003, 5286496.999) (143d10'20.17"E, 42d49'56.66"N)

Setting both CRSs works fine as well:
$ gdalwarp -s_srs EPSG:2455 -t_srs EPSG:3857 input.tif from2455to3857.tif
$ gdalinfo from2455to3857.tif | grep Center
Center      (15937864.003, 5286496.999) (143d10'20.17"E, 42d49'56.66"N)

However using "-ct", swaps the output:
$ gdalwarp -ct '+proj=pipeline +step +proj=axisswap +order=2,1 +step +inv
+proj=tmerc +lat_0=44 +lon_0=144.25 +k=0.9999 +x_0=0 +y_0=0 +ellps=GRS80
+step +proj=webmerc +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84' input.tif
pipeline.tif
$ gdal_edit.py -a_srs EPSG:3857 pipeline.tif
$ gdalinfo pipeline.tif | grep Center
Center      ( 5286496.998,15937864.005) ( 47d29'21.88"E, 80d36'13.79"N)

Am I doing something wrong, or is there any problem in "gdalwarp"?

Thanks.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Wed, 3 Nov 2021 at 15:03, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 03/11/2021 ? 14:49, Javier Jimenez Shaw a ?crit :
> > Hi
> >
> > I have a GeoTIFF in EPSG:27700, "OSGB36 / British National Grid"
> > For consistency reasons, I want to run gdal2tiles with an equivalent
> > transformation than the one I will use later to transform points using
> > a PROJ pipeline. For consistency reasons I will use that pipeline
> > along the time to transform the points, so an update in EPSG/PROJ does
> > not change the results (I generate the gdal2tiles at project creation
> > time, but run the transformation on the marker points along the time).
> >
> > Getting the PROJ pipeline is easy with something like
> > projinfo -s EPSG:27700 -t EPSG:3857 --spatial-test intersects -o PROJ
> > --single-line -q
> > (the option --spatial-test intersects is very important. Otherwise you
> > get a ballpark. I am not using grids. I can use the area of use of the
> > GeoTIFF as well) It produces
> > +proj=pipeline +step +inv +proj=tmerc +lat_0=49 +lon_0=-2
> > +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +step +proj=push
> > +v_3 +step +proj=cart +ellps=airy +step +proj=helmert +x=446.448
> > +y=-125.157 +z=542.06 +rx=0.15 +ry=0.247 +rz=0.842 +s=-20.489
> > +convention=position_vector +step +inv +proj=cart +ellps=WGS84 +step
> > +proj=pop +v_3 +step +proj=webmerc +lat_0=0 +lon_0=0 +x_0=0 +y_0=0
> > +ellps=WGS84
> >
> > However this pipeline does not work in gdal2tiles with the "-s"
> > option, complaining with these errors, and placing the data in the
> > wrong place (not very far from Null Island)
> > ERROR 1: PROJ: proj_crs_get_coordinate_system: Object is not a SingleCRS
> > ERROR 1: PROJ: proj_as_wkt: PROJBasedOperation can only be exported to
> > WKT2
> > ERROR 1: PROJ: proj_crs_get_coordinate_system: Object is not a SingleCRS
> > ERROR 1: PROJ: proj_as_wkt: PROJBasedOperation can only be exported to
> > WKT2
> This is expected. A coordinate operation is not a source CRS.
> >
> > Running projinfo on EPSG:27700 gives me the ballpark one
> > projinfo EPSG:27700 -o PROJ --single-line
> > PROJ.4 string:
> > +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
> > +y_0=-100000 +ellps=airy +units=m +no_defs +type=crs
> >
> > The difference using this pipeline (without Helmert parameters) is
> > about 100 m near London. Perfectly noticeable ;)
> >
> > (I think it does not include the Helmert transformation, because the
> > area of use of that transformation is a bit smaller than the
> > geographic crs, EPSG:4277)
> >
> > Of course I could create the command manually, but I would like to
> > have a generic solution for multiple projects.
> >
> > What can I do?
>
> Enhance gdal2tiles to be able to specify coordinate transformations:
> https://github.com/OSGeo/gdal/issues/3998
>
> You could also possibly use gdalwarp -ct to directly generate the input
> dataset in EPSG:3857 with the pipeline of your choice
>
> Or in that instance just use -s "+proj=tmerc +lat_0=49 +lon_0=-2
> +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs
> +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/b702220b/attachment.html>

From even.rouault at spatialys.com  Mon Nov 15 04:54:33 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Nov 2021 13:54:33 +0100
Subject: [gdal-dev] gdal2tiles and EPSG:27700
In-Reply-To: <CADRrdKuDFx8TFquPAvZxHPcrdcjwYuvjogiFZ7JPwHGRzush=w@mail.gmail.com>
References: <CADRrdKtXkwvaRYp-ytPGfVP_q=-sURN4vmj07OkACLL6eW54HQ@mail.gmail.com>
 <98b26b6e-0efe-532c-6f82-dab761121c73@spatialys.com>
 <CADRrdKuDFx8TFquPAvZxHPcrdcjwYuvjogiFZ7JPwHGRzush=w@mail.gmail.com>
Message-ID: <2b20d4b6-b2de-d465-0197-eb415e1752cb@spatialys.com>

Javier,
> However using "-ct", swaps the output:
> $ gdalwarp -ct '+proj=pipeline +step +proj=axisswap +order=2,1 +step 
> +inv +proj=tmerc +lat_0=44 +lon_0=144.25 +k=0.9999 +x_0=0 +y_0=0 
> +ellps=GRS80 +step +proj=webmerc +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 
> +ellps=WGS84' input.tif pipeline.tif
You should add -t_srs EPSG:3857 in the above so that gdalwarp knows that 
the output SRS is != input SRS, and in particular so that it knows it 
axis order. The pipeline specified by -ct will be used even if -s_srs 
and/or -t_srs are specify.? And then you can remove the below gdal_edit
> $ gdal_edit.py -a_srs EPSG:3857 pipeline.tif

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/16fc7521/attachment-0001.html>

From even.rouault at spatialys.com  Mon Nov 15 04:59:02 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Nov 2021 13:59:02 +0100
Subject: [gdal-dev] Intermittent memory-corruption crashes in GRIB2
 import
In-Reply-To: <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>
References: <CAJf0KTTH3MitfRhAUP3Bs3U=2NNT58XMn0ZA+7Ck1yyxiiqTag@mail.gmail.com>
 <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>
Message-ID: <a2356819-7028-26ad-f46a-25a71ca2432a@spatialys.com>

Simon,

unfortunately there are a number of places in the degrib library which 
aren't thread-safe, and you just spotted that the errSprintf() routine 
was one of them. I've queued a fix for that in 
https://github.com/OSGeo/gdal/pull/4830. Could you try it ?

Regarding gdal_translate performance, this is related to something I 
mentioned recently (not sure to whom), but you'll get much better 
performance if you add -co INTERLEAVE=BAND, so that the output GeoTIFF 
is written band after band, to match the most performant access pattern 
for reading GRIB files.

Even

Le 15/11/2021 ? 01:32, Simon Eves a ?crit?:
> We have recently implemented a geo raster importer, and all seems 
> fine, except that we hit an issue with a particular GRIB2 file from 
> the NOAA website, where we get an inconsistent crash inside GDAL after 
> a few hundred scanlines.
>
> We have seen two different crashes inside GDAL, and a third in one of 
> our code paths, but given that?there is?a memory corruption, the 
> latter is perhaps unsurprising.
>
> All crashes report "double free or corruption (fasttop)".
>
> We are multi-threading the reading,?but using a OGRDataSource per 
> thread. The child threads are only calling?GetRasterBand(), 
> GetRasterDataType() and RasterIO() and only one one band at a time.
>
> The GRIB2 file is 103MB with 73 Float64 bands, but only 2345x1597 
> "pixels".
>
> We tried converting the file to GeoTIFF with gdal_translate (no 
> options, just in and out) and it took 28 minutes (on a ~2017 i7 quad 
> 4.2), which is surprising, as we have other GRIB2 files (between 2 and 
> 12MB) which convert "instantly". The resulting GeoTIFF is much bigger 
> (21x) but seems to import reliably, has basically the same schema (as 
> reported by gdalinfo) and results in the same data when imported into 
> our system.
>
> We only get the crash occasionally, and have only been able to trap it 
> in the Debugger a couple?of times, with nothing obviously wrong.
>
> Here is a link to the GRIB2 file in question:
>
> https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing 
> <https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing>
>
> Attached is the most common stack trace.
>
> With a DEBUG build of GDAL, looks like it's crashing trying to do a 
> realloc() on "buffer" which is NULL, although that is supposedly a 
> copy of "&errBuffer" at the frame above which seems fine.
>
> Gonna try robustifying that code and see what happens...
>
> This is all with GDAL 3.2.2 on Ubuntu 20.04 LTS with GCC 9.
>
> -- 
> <http://www.omnisci.com/>
> 	
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> 	
> Email: simon.eves at omnisci.com <mailto:simon.eves at omnisci.com>?| Cell: 
> +1 (415) 902-1996
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/aa49dee9/attachment.html>

From j1 at jimenezshaw.com  Mon Nov 15 05:29:13 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 15 Nov 2021 14:29:13 +0100
Subject: [gdal-dev] gdal2tiles and EPSG:27700
In-Reply-To: <2b20d4b6-b2de-d465-0197-eb415e1752cb@spatialys.com>
References: <CADRrdKtXkwvaRYp-ytPGfVP_q=-sURN4vmj07OkACLL6eW54HQ@mail.gmail.com>
 <98b26b6e-0efe-532c-6f82-dab761121c73@spatialys.com>
 <CADRrdKuDFx8TFquPAvZxHPcrdcjwYuvjogiFZ7JPwHGRzush=w@mail.gmail.com>
 <2b20d4b6-b2de-d465-0197-eb415e1752cb@spatialys.com>
Message-ID: <CADRrdKvLL-RagjjZRtpoYZ==Urm+L0+VSh3CKF77JvWehGbEZA@mail.gmail.com>

Thanks!
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Mon, 15 Nov 2021 at 13:54, Even Rouault <even.rouault at spatialys.com>
wrote:

> Javier,
>
> However using "-ct", swaps the output:
> $ gdalwarp -ct '+proj=pipeline +step +proj=axisswap +order=2,1 +step +inv
> +proj=tmerc +lat_0=44 +lon_0=144.25 +k=0.9999 +x_0=0 +y_0=0 +ellps=GRS80
> +step +proj=webmerc +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84' input.tif
> pipeline.tif
>
> You should add -t_srs EPSG:3857 in the above so that gdalwarp knows that
> the output SRS is != input SRS, and in particular so that it knows it axis
> order. The pipeline specified by -ct will be used even if -s_srs and/or
> -t_srs are specify.  And then you can remove the below gdal_edit
>
> $ gdal_edit.py -a_srs EPSG:3857 pipeline.tif
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/fff33a29/attachment.html>

From louis-philippe.rousseaulambert at ec.gc.ca  Mon Nov 15 06:25:14 2021
From: louis-philippe.rousseaulambert at ec.gc.ca (Rousseau Lambert,Louis-Philippe (ECCC))
Date: Mon, 15 Nov 2021 09:25:14 -0500
Subject: [gdal-dev] Polar stereographic projection invalid definition ?
Message-ID: <00febbc7-1f69-7041-ebe5-431dbf7d2939@ec.gc.ca>

Hi all,

I have an issue with a polar stereographic projection definition.

Context: I tried to open a NetCDF files in QGIS and with GDAL and it 
failed with:

  * Gdal:/ERROR 1: PROJ: proj_as_proj_string: Unsupported conversion
    method: Polar_Stereographic/
  * Qgis:/WARNING Could not reproject layer extent: Could not transform
    bounding box to taret CRS
    /

The projection fails with the previous error for both gdal and proj 
versions:

  * GDAL 3.1.3, 3.3.0
  * PROJ 7.2.0, 8.01

Test files (really any files in the folder will have the same behavior):

  * https://dd.weather.gc.ca/model_giops/netcdf/polar_stereographic/2d/00/003/CMC_giops_votemper_depth_0.5_ps5km60N_3h-mean_*{YYYYMMDDHH}*_P003.nc

I tried opening the files with an older gdal/proj version and it worked 
fine:

  * GDAL: |2.4.4, released 2020/01/08|
  * PROJ: Rel. 4.8.0, 6 March 2012

Here is the projection definition I got: /+proj=stere +lat_0=90 
+lat_ts=59.99993768695209 +lon_0=-100 +k=0.93301243 +x_0=4245000 
+y_0=5295000 +a=6371229 +b=6371229 +units=m +no_defs/

When I tried adding the projection manually in Qgis (3.20), I got the 
following error message:

/This proj projection definition is not valid://
//proj_create: lat_ts != lat_0 and k != 1 not supported for Polar 
Stereographic./

Should the projection definition be updated in the NetCDF files if this 
really is not a supported projection definition anymore, or is this a 
bug in gdal?

If this looks like a bug to you, let me know, I will open an issue on 
the gdal repo.

Thanks!

LP
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/3aa4b6c9/attachment-0001.html>

From even.rouault at spatialys.com  Mon Nov 15 06:30:28 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Nov 2021 15:30:28 +0100
Subject: [gdal-dev] Polar stereographic projection invalid definition ?
In-Reply-To: <00febbc7-1f69-7041-ebe5-431dbf7d2939@ec.gc.ca>
References: <00febbc7-1f69-7041-ebe5-431dbf7d2939@ec.gc.ca>
Message-ID: <3d939ba5-3bd3-bb92-7603-dd6d6b63cd40@spatialys.com>

Louis-Philippe,
>
> If this looks like a bug to you, let me know, I will open an issue on 
> the gdal repo.
>
You already did in https://github.com/OSGeo/gdal/issues/4144 :-). And 
this was fixed in 3.3.2

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From chuang at psi.edu  Mon Nov 15 10:53:51 2021
From: chuang at psi.edu (Frank Chuang)
Date: Mon, 15 Nov 2021 11:53:51 -0700
Subject: [gdal-dev] gdal issue with libcurl
Message-ID: <CAOABD4_hMELKEHauCCB7U51npBfNDTFQmtWPb3zeRi8NSrSVXQ@mail.gmail.com>

I just installed version 3.4.0 of gdal using standard conda install, but
having error message stating libcurl version is incompatible with libgdal:

dyld: Library not loaded: @rpath/libcurl.4.dylib
  Referenced from:
/Users/chuang/opt/anaconda3/envs/gdal/lib/libgdal.30.dylib
  Reason: Incompatible library version: libgdal.30.dylib requires version
12.0.0 or later, but libcurl.4.dylib provides version 8.0.0
Abort trap: 6

Can anyone provide suggestions on how to remedy this? Can this be solved
by turning curl off when executing gdal? Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211115/633f9e07/attachment.html>

From simon.eves at omnisci.com  Tue Nov 16 12:57:08 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Tue, 16 Nov 2021 12:57:08 -0800
Subject: [gdal-dev] Intermittent memory-corruption crashes in GRIB2
 import
In-Reply-To: <a2356819-7028-26ad-f46a-25a71ca2432a@spatialys.com>
References: <CAJf0KTTH3MitfRhAUP3Bs3U=2NNT58XMn0ZA+7Ck1yyxiiqTag@mail.gmail.com>
 <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>
 <a2356819-7028-26ad-f46a-25a71ca2432a@spatialys.com>
Message-ID: <CAJf0KTQgz5ZhiG1NKrcKeLowuFg3Mc+54LLUB3NBOS-Dh6JLvw@mail.gmail.com>

Hi Even,

Sorry for the slow response. I was out yesterday and this morning. Testing
your fix now.

Simon

On Mon, Nov 15, 2021 at 4:59 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Simon,
>
> unfortunately there are a number of places in the degrib library which
> aren't thread-safe, and you just spotted that the errSprintf() routine was
> one of them. I've queued a fix for that in
> https://github.com/OSGeo/gdal/pull/4830. Could you try it ?
>
> Regarding gdal_translate performance, this is related to something I
> mentioned recently (not sure to whom), but you'll get much better
> performance if you add -co INTERLEAVE=BAND, so that the output GeoTIFF is
> written band after band, to match the most performant access pattern for
> reading GRIB files.
>
> Even
> Le 15/11/2021 ? 01:32, Simon Eves a ?crit :
>
> We have recently implemented a geo raster importer, and all seems fine,
> except that we hit an issue with a particular GRIB2 file from the NOAA
> website, where we get an inconsistent crash inside GDAL after a few hundred
> scanlines.
>
> We have seen two different crashes inside GDAL, and a third in one of our
> code paths, but given that there is a memory corruption, the latter is
> perhaps unsurprising.
>
> All crashes report "double free or corruption (fasttop)".
>
> We are multi-threading the reading, but using a OGRDataSource per thread.
> The child threads are only calling GetRasterBand(), GetRasterDataType() and
> RasterIO() and only one one band at a time.
>
> The GRIB2 file is 103MB with 73 Float64 bands, but only 2345x1597 "pixels".
>
> We tried converting the file to GeoTIFF with gdal_translate (no options,
> just in and out) and it took 28 minutes (on a ~2017 i7 quad 4.2), which is
> surprising, as we have other GRIB2 files (between 2 and 12MB) which convert
> "instantly". The resulting GeoTIFF is much bigger (21x) but seems to import
> reliably, has basically the same schema (as reported by gdalinfo) and
> results in the same data when imported into our system.
>
> We only get the crash occasionally, and have only been able to trap it in
> the Debugger a couple of times, with nothing obviously wrong.
>
> Here is a link to the GRIB2 file in question:
>
>
> https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing
>
> Attached is the most common stack trace.
>
> With a DEBUG build of GDAL, looks like it's crashing trying to do a
> realloc() on "buffer" which is NULL, although that is supposedly a copy of
> "&errBuffer" at the frame above which seems fine.
>
> Gonna try robustifying that code and see what happens...
>
> This is all with GDAL 3.2.2 on Ubuntu 20.04 LTS with GCC 9.
>
> --
> <http://www.omnisci.com/>
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211116/7594f47b/attachment.html>

From simon.eves at omnisci.com  Tue Nov 16 15:21:11 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Tue, 16 Nov 2021 15:21:11 -0800
Subject: [gdal-dev] Intermittent memory-corruption crashes in GRIB2
 import
In-Reply-To: <CAJf0KTQgz5ZhiG1NKrcKeLowuFg3Mc+54LLUB3NBOS-Dh6JLvw@mail.gmail.com>
References: <CAJf0KTTH3MitfRhAUP3Bs3U=2NNT58XMn0ZA+7Ck1yyxiiqTag@mail.gmail.com>
 <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>
 <a2356819-7028-26ad-f46a-25a71ca2432a@spatialys.com>
 <CAJf0KTQgz5ZhiG1NKrcKeLowuFg3Mc+54LLUB3NBOS-Dh6JLvw@mail.gmail.com>
Message-ID: <CAJf0KTRJ9T-V+O9Ro8BCWn+am5AsB+UC+XENLjW0OMyfLV0KJw@mail.gmail.com>

Hi Even,

Thank you very much for the quick and plausible fix. It certainly seems to
resolve the issue on my machine. I'm sending a build to my colleague to
test it on his Threadripper, as he was the first one to hit it.

Looks like you have merged this into master and into the 3.4 release
branch. Can we assume, therefore, that it will be in 3.4.1, which
appears to be scheduled for the end of December?

Simon

On Tue, Nov 16, 2021 at 12:57 PM Simon Eves <simon.eves at omnisci.com> wrote:

> Hi Even,
>
> Sorry for the slow response. I was out yesterday and this morning. Testing
> your fix now.
>
> Simon
>
> On Mon, Nov 15, 2021 at 4:59 AM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Simon,
>>
>> unfortunately there are a number of places in the degrib library which
>> aren't thread-safe, and you just spotted that the errSprintf() routine was
>> one of them. I've queued a fix for that in
>> https://github.com/OSGeo/gdal/pull/4830. Could you try it ?
>>
>> Regarding gdal_translate performance, this is related to something I
>> mentioned recently (not sure to whom), but you'll get much better
>> performance if you add -co INTERLEAVE=BAND, so that the output GeoTIFF is
>> written band after band, to match the most performant access pattern for
>> reading GRIB files.
>>
>> Even
>> Le 15/11/2021 ? 01:32, Simon Eves a ?crit :
>>
>> We have recently implemented a geo raster importer, and all seems fine,
>> except that we hit an issue with a particular GRIB2 file from the NOAA
>> website, where we get an inconsistent crash inside GDAL after a few hundred
>> scanlines.
>>
>> We have seen two different crashes inside GDAL, and a third in one of our
>> code paths, but given that there is a memory corruption, the latter is
>> perhaps unsurprising.
>>
>> All crashes report "double free or corruption (fasttop)".
>>
>> We are multi-threading the reading, but using a OGRDataSource per thread.
>> The child threads are only calling GetRasterBand(), GetRasterDataType() and
>> RasterIO() and only one one band at a time.
>>
>> The GRIB2 file is 103MB with 73 Float64 bands, but only 2345x1597
>> "pixels".
>>
>> We tried converting the file to GeoTIFF with gdal_translate (no options,
>> just in and out) and it took 28 minutes (on a ~2017 i7 quad 4.2), which is
>> surprising, as we have other GRIB2 files (between 2 and 12MB) which convert
>> "instantly". The resulting GeoTIFF is much bigger (21x) but seems to import
>> reliably, has basically the same schema (as reported by gdalinfo) and
>> results in the same data when imported into our system.
>>
>> We only get the crash occasionally, and have only been able to trap it in
>> the Debugger a couple of times, with nothing obviously wrong.
>>
>> Here is a link to the GRIB2 file in question:
>>
>>
>> https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing
>>
>> Attached is the most common stack trace.
>>
>> With a DEBUG build of GDAL, looks like it's crashing trying to do a
>> realloc() on "buffer" which is NULL, although that is supposedly a copy of
>> "&errBuffer" at the frame above which seems fine.
>>
>> Gonna try robustifying that code and see what happens...
>>
>> This is all with GDAL 3.2.2 on Ubuntu 20.04 LTS with GCC 9.
>>
>> --
>> <http://www.omnisci.com/>
>> Simon Eves
>> Senior Graphics Engineer, Rendering Group
>> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>>
>>
>> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>>
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> <http://www.omnisci.com/>
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
>
>

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211116/cf0b71b2/attachment-0001.html>

From even.rouault at spatialys.com  Tue Nov 16 15:27:22 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 Nov 2021 00:27:22 +0100
Subject: [gdal-dev] Intermittent memory-corruption crashes in GRIB2
 import
In-Reply-To: <CAJf0KTRJ9T-V+O9Ro8BCWn+am5AsB+UC+XENLjW0OMyfLV0KJw@mail.gmail.com>
References: <CAJf0KTTH3MitfRhAUP3Bs3U=2NNT58XMn0ZA+7Ck1yyxiiqTag@mail.gmail.com>
 <CAJf0KTQk2yuqQ_sDvDmuStCWWELf-0Wm-SDSiBVd4iXOJZ68Sw@mail.gmail.com>
 <a2356819-7028-26ad-f46a-25a71ca2432a@spatialys.com>
 <CAJf0KTQgz5ZhiG1NKrcKeLowuFg3Mc+54LLUB3NBOS-Dh6JLvw@mail.gmail.com>
 <CAJf0KTRJ9T-V+O9Ro8BCWn+am5AsB+UC+XENLjW0OMyfLV0KJw@mail.gmail.com>
Message-ID: <03c0a1c7-e439-9690-41f2-38f9d1e24bbd@spatialys.com>


Le 17/11/2021 ? 00:21, Simon Eves a ?crit?:
> Hi Even,
>
> Thank you very much for the quick and plausible fix. It certainly 
> seems to resolve the issue on my machine. I'm sending a build to my 
> colleague?to test it on his Threadripper, as he was the first one to 
> hit it.
>
> Looks like you have merged this into master and into the 3.4 release 
> branch. Can we assume, therefore, that it will be in 3.4.1, which 
> appears?to be scheduled for the end of December?
your inference is correct :-)
>
> Simon
>
> On Tue, Nov 16, 2021 at 12:57 PM Simon Eves <simon.eves at omnisci.com 
> <mailto:simon.eves at omnisci.com>> wrote:
>
>     Hi Even,
>
>     Sorry for the slow response. I was out yesterday and this morning.
>     Testing your fix now.
>
>     Simon
>
>     On Mon, Nov 15, 2021 at 4:59 AM Even Rouault
>     <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>>
>     wrote:
>
>         Simon,
>
>         unfortunately there are a number of places in the degrib
>         library which aren't thread-safe, and you just spotted that
>         the errSprintf() routine was one of them. I've queued a fix
>         for that in https://github.com/OSGeo/gdal/pull/4830
>         <https://github.com/OSGeo/gdal/pull/4830>. Could you try it ?
>
>         Regarding gdal_translate performance, this is related to
>         something I mentioned recently (not sure to whom), but you'll
>         get much better performance if you add -co INTERLEAVE=BAND, so
>         that the output GeoTIFF is written band after band, to match
>         the most performant access pattern for reading GRIB files.
>
>         Even
>
>         Le 15/11/2021 ? 01:32, Simon Eves a ?crit?:
>>         We have recently implemented a geo raster importer, and all
>>         seems fine, except that we hit an issue with a particular
>>         GRIB2 file from the NOAA website, where we get an
>>         inconsistent crash inside GDAL after a few hundred scanlines.
>>
>>         We have seen two different crashes inside GDAL, and a third
>>         in one of our code paths, but given that?there is?a memory
>>         corruption, the latter is perhaps unsurprising.
>>
>>         All crashes report "double free or corruption (fasttop)".
>>
>>         We are multi-threading the reading,?but using a OGRDataSource
>>         per thread. The child threads are only
>>         calling?GetRasterBand(), GetRasterDataType() and RasterIO()
>>         and only one one band at a time.
>>
>>         The GRIB2 file is 103MB with 73 Float64 bands, but only
>>         2345x1597 "pixels".
>>
>>         We tried converting the file to GeoTIFF with gdal_translate
>>         (no options, just in and out) and it took 28 minutes (on a
>>         ~2017 i7 quad 4.2), which is surprising, as we have other
>>         GRIB2 files (between 2 and 12MB) which convert "instantly".
>>         The resulting GeoTIFF is much bigger (21x) but seems to
>>         import reliably, has basically the same schema (as reported
>>         by gdalinfo) and results in the same data when imported into
>>         our system.
>>
>>         We only get the crash occasionally, and have only been able
>>         to trap it in the Debugger a couple?of times, with nothing
>>         obviously wrong.
>>
>>         Here is a link to the GRIB2 file in question:
>>
>>         https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing
>>         <https://drive.google.com/file/d/12Fo6jnIhxzCvnSsup9n0kHVKy9lrHD2l/view?usp=sharing>
>>
>>         Attached is the most common stack trace.
>>
>>         With a DEBUG build of GDAL, looks like it's crashing trying
>>         to do a realloc() on "buffer" which is NULL, although that is
>>         supposedly a copy of "&errBuffer" at the frame above which
>>         seems fine.
>>
>>         Gonna try robustifying that code and see what happens...
>>
>>         This is all with GDAL 3.2.2 on Ubuntu 20.04 LTS with GCC 9.
>>
>>         -- 
>>         <http://www.omnisci.com/>
>>         	
>>         Simon Eves
>>         Senior Graphics Engineer, Rendering Group
>>         100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>>
>>
>>         	
>>         Email: simon.eves at omnisci.com
>>         <mailto:simon.eves at omnisci.com>?| Cell: 	+1 (415) 902-1996
>>
>>
>>
>>
>>         _______________________________________________
>>         gdal-dev mailing list
>>         gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>>         https://lists.osgeo.org/mailman/listinfo/gdal-dev  <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>         -- 
>         http://www.spatialys.com  <http://www.spatialys.com>
>         My software is free, but my time generally not.
>
>
>
>     -- 
>     <http://www.omnisci.com/>
>     	
>     Simon Eves
>     Senior Graphics Engineer, Rendering Group
>     100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
>     	
>     Email: simon.eves at omnisci.com <mailto:simon.eves at omnisci.com>?|
>     Cell: 	+1 (415) 902-1996
>
>
>
>
>
> -- 
> <http://www.omnisci.com/>
> 	
> Simon Eves
> Senior Graphics Engineer, Rendering Group
> 100 Montgomery St (5th Floor), San Francisco, CA 94104, USA
>
>
> 	
> Email: simon.eves at omnisci.com <mailto:simon.eves at omnisci.com>?| Cell: 
> +1 (415) 902-1996
>
>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211117/d84d6e54/attachment-0001.html>

From loridigia at gmail.com  Wed Nov 17 08:11:06 2021
From: loridigia at gmail.com (Lorenzo Di Giacomo)
Date: Wed, 17 Nov 2021 17:11:06 +0100
Subject: [gdal-dev] Black borders after reprojection GDAL_WARP
Message-ID: <CAERmyNQ9+6CAbhfiN-qXLk7144SRfHxjoSqutmn-gev1QTw9sQ@mail.gmail.com>

Hi all, i have a question, how is it possible to avoid black borders after
reprojection with "gdal_warp" ?
Basically i have an image that is little rotated, when i reprojected from
32632 to 4326 the resulting image has black borders more or less tight
depending on the rotation.
I saw i can change the colors of those no_data (using -dstnodata) but how
can i do if i dont want it at all? Adding another band result in a size
increase, that i don't want either.

Thanks !!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211117/81aecceb/attachment.html>

From roman.schiffer at gmail.com  Thu Nov 18 01:58:53 2021
From: roman.schiffer at gmail.com (Roman Breitfuss-Schiffer)
Date: Thu, 18 Nov 2021 10:58:53 +0100
Subject: [gdal-dev] GDALWMS - error: TCP connection reset by peer
Message-ID: <4699c913-77eb-eb9a-9b36-008f64b208b7@gmail.com>

Dear all!

We are running a Python application an a linux distribution (RedHat) 
which creates clips in MBTILES format from a WMS. We are using the 
Python-API and are basically doing something like this:

src_ds = gdal.Warp(
 ??? tmp_file,
 ??? ds_in,
 ??? format='GTiff',
 ??? outputBounds=[bbox[0], bbox[2], bbox[1], bbox[3]],
 ??? dstSRS=output_srs,
)
ds_out = gdal.Translate(
 ??? out_filepath,
 ??? src_ds,
 ??? format='MBTILES',
 ??? creationOptions=creation_options,
)

The application throughs an error from time to time since a few days. We 
couldn't figure out a pattern yet and therefore we are also not able to 
reproduce the error. The error is the following:

Mon Nov 15 13:48:13 2021: CPLError: GDALWMS: Unable to download block 
2765, 602.
URL: TCP connection reset by peer
 ? HTTP status code: 0, error: TCP connection reset by peer.
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error 
(see http://www.gdal.org/frmt_wms.html).
Mon Nov 15 13:48:13 2021: CPLError: /wms_xml/wms_config.xml, band 1: 
IReadBlock failed at X offset 2764, Y offset 601
Mon Nov 15 13:48:13 2021: CPLError: GetBlockRef failed at X block offset 
2764, Y block offset 601

The exact same data gets processed successfully in one run and not 
successfully in another run. We didn't change the code nor the Python or 
GDAL version. Hence, we are kind of puzzled as the error comes and goes 
seemingly at random.

Does anyone of you have any hints?

Thanks & best regards!
Roman

_______________________________________________
Dipl.-Ing. Roman Breitfuss-Schiffer, MSc. (GIS)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/f3c119b8/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 18 03:12:47 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 18 Nov 2021 11:12:47 +0000
Subject: [gdal-dev] GDALWMS - error: TCP connection reset by peer
Message-ID: <ebde98645a394925b8e00a0178d7fba5@maanmittauslaitos.fi>

Hi,

It seems that the WMS server is closing the door and there is nothing else to do on the GDAL side except to try again later. Contact the WMS service maintainer and report your troubles. They may be able to provide you a more reliable service especially if you are ready to pay for it.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Roman Breitfuss-Schiffer
L?hetetty: torstai 18. marraskuuta 2021 11.59
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] GDALWMS - error: TCP connection reset by peer


Dear all!

We are running a Python application an a linux distribution (RedHat) which creates clips in MBTILES format from a WMS. We are using the Python-API and are basically doing something like this:

src_ds = gdal.Warp(
    tmp_file,
    ds_in,
    format='GTiff',
    outputBounds=[bbox[0], bbox[2], bbox[1], bbox[3]],
    dstSRS=output_srs,
)
ds_out = gdal.Translate(
    out_filepath,
    src_ds,
    format='MBTILES',
    creationOptions=creation_options,
)

The application throughs an error from time to time since a few days. We couldn't figure out a pattern yet and therefore we are also not able to reproduce the error. The error is the following:

Mon Nov 15 13:48:13 2021: CPLError: GDALWMS: Unable to download block 2765, 602.
URL: TCP connection reset by peer
  HTTP status code: 0, error: TCP connection reset by peer.
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
Mon Nov 15 13:48:13 2021: CPLError: /wms_xml/wms_config.xml, band 1: IReadBlock failed at X offset 2764, Y offset 601
Mon Nov 15 13:48:13 2021: CPLError: GetBlockRef failed at X block offset 2764, Y block offset 601

The exact same data gets processed successfully in one run and not successfully in another run. We didn't change the code nor the Python or GDAL version. Hence, we are kind of puzzled as the error comes and goes seemingly at random.

Does anyone of you have any hints?

Thanks & best regards!
Roman

_______________________________________________

Dipl.-Ing. Roman Breitfuss-Schiffer, MSc. (GIS)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/8dff91f0/attachment.html>

From dncarreira at gmail.com  Thu Nov 18 03:44:54 2021
From: dncarreira at gmail.com (Duarte Carreira)
Date: Thu, 18 Nov 2021 11:44:54 +0000
Subject: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
 LERC_DEFLATE
Message-ID: <CAHE-9zCusXEy8j2hP9BhjpCNYaWEKcHyHHfq74WsZ75KkjaYQg@mail.gmail.com>

Hi there.

I am looking into compressing overviews for a DEM, with LERC_DEFLATE and it
works. But I'm trying to set the precision loss and get better compression,
since for overviews I don't really care that much.
Ok, so the question is how to set the MAX_Z_ERROR for overviews compressed
with LERC_DEFLATE?

More context:
My reasoning is to compress losslessly the dem with deflate predictor 3,
and then compress "lossly"  the overviews with lerc_deflate.
Since this is 32bit dataset, I can't use jpeg on the overviews.

Thanks in advance.
Duarte
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/8673a28a/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 18 04:41:27 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 18 Nov 2021 12:41:27 +0000
Subject: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
 LERC_DEFLATE
Message-ID: <e778ce694fd34b7ea16185c69c4748ad@maanmittauslaitos.fi>

Hi,

I made some tests with an 8 bit RGB image.
First observation was that gdaladdo supports lerc_deflate (even it is not documented), but it does not support ?MAX_Z_ERROR?. This yields same sized ovr file with or without max_z_error.
gdaladdo -ro lerc_def2.tif --config compress_overview lerc_deflate --config MAX_Z_ERROR 10

Another observation was that this option would really save some disk space. I compressed the lossless ovr file with gdal_translate by using -co max_z_error=10 and file sizes were:

source tiff: 432 072 372 bytes
lecr_deflate cog without overviews: 311 258 085 bytes

lossless lerc_deflate overviews: 118 954 009 bytes
lerc_deflare overviews with z_error=10: 52 400 583 bytes

For comparison even not relevant to original question about 32 bit data
jpeg-ycbcr overviews with default quality: 14 481 967 bytes

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Duarte Carreira
L?hetetty: torstai 18. marraskuuta 2021 13.45
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with LERC_DEFLATE

Hi there.

I am looking into compressing overviews for a DEM, with LERC_DEFLATE and it works. But I'm trying to set the precision loss and get better compression, since for overviews I don't really care that much.
Ok, so the question is how to set the MAX_Z_ERROR for overviews compressed with LERC_DEFLATE?

More context:
My reasoning is to compress losslessly the dem with deflate predictor 3, and then compress "lossly"  the overviews with lerc_deflate.
Since this is 32bit dataset, I can't use jpeg on the overviews.

Thanks in advance.
Duarte

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/887b5263/attachment-0001.html>

From cgodkin at gmail.com  Thu Nov 18 05:10:11 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 18 Nov 2021 05:10:11 -0800
Subject: [gdal-dev] Black borders after reprojection GDAL_WARP
In-Reply-To: <CAERmyNQ9+6CAbhfiN-qXLk7144SRfHxjoSqutmn-gev1QTw9sQ@mail.gmail.com>
References: <CAERmyNQ9+6CAbhfiN-qXLk7144SRfHxjoSqutmn-gev1QTw9sQ@mail.gmail.com>
Message-ID: <CAE=8km=UPiq-aRML4qusBEZtKXjVuh0OGbtEZPnbtn2aUMBBLA@mail.gmail.com>

 Hi Lorenzo,

I have faced this and there are two things to consider.

First, you can specify the georeferenced extents _and_ the SRS  of the
extents using something like this:

    gdalwarp -t_srs EPSG:3857 \
        -te_srs EPSG:4326 -te -109 32 -102 36 \
        input.tif output.tif

Note that I'm warping to one coordinate system but trimming based on
another one.  Is it possible that your black boundary is due to trimming in
the wrong coordinate system?  For instance, if your input map is projected
but the boundary of the map consists of parallels of latitude or
meridians of longitude, then you could use something like the above.  (You
can actually get even fancier by trimming with polygons too; see this
example for inspiration:
https://gis.stackexchange.com/questions/45053/gdalwarp-cutline-along-with-shapefile
.)

Second, recognize that the output will always be a rectangle in the output
SRS.  If the black border is due to "no data" areas outside the input map's
extent appearing in the output map, then you can use -dstalpha ("Create an
output alpha band to identify nodata (unset/transparent) pixels.") to mark
the output pixels that shouldn't be part of the map.  Basically your black
pixels become transparent in this case.

I hope that helps,
carl


On Wed, Nov 17, 2021 at 8:11 AM Lorenzo Di Giacomo <loridigia at gmail.com>
wrote:

> Hi all, i have a question, how is it possible to avoid black borders after
> reprojection with "gdal_warp" ?
> Basically i have an image that is little rotated, when i reprojected from
> 32632 to 4326 the resulting image has black borders more or less tight
> depending on the rotation.
> I saw i can change the colors of those no_data (using -dstnodata) but how
> can i do if i dont want it at all? Adding another band result in a size
> increase, that i don't want either.
>
> Thanks !!
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/fddb1f5b/attachment.html>

From loridigia at gmail.com  Thu Nov 18 06:34:31 2021
From: loridigia at gmail.com (Lorenzo Di Giacomo)
Date: Thu, 18 Nov 2021 15:34:31 +0100
Subject: [gdal-dev] Black borders after reprojection GDAL_WARP
In-Reply-To: <CAE=8km=UPiq-aRML4qusBEZtKXjVuh0OGbtEZPnbtn2aUMBBLA@mail.gmail.com>
References: <CAERmyNQ9+6CAbhfiN-qXLk7144SRfHxjoSqutmn-gev1QTw9sQ@mail.gmail.com>
 <CAE=8km=UPiq-aRML4qusBEZtKXjVuh0OGbtEZPnbtn2aUMBBLA@mail.gmail.com>
Message-ID: <CAERmyNRaRCy-xPXy9rDQzykN7oXR_YbGr_pxU_Ja6Y5oZZC8SQ@mail.gmail.com>

Hi Carl, thanks for your reply, i noticed that it happens even if i just
reproject the image, without cutting.
Of course the dstalpha works, but it increases the size of the image and it
changes its nature (adding another band) since this operation is an
intermediate operation the resulting image can't be different from the
original, just reporojected.



Il giorno gio 18 nov 2021 alle ore 14:11 Carl Godkin <cgodkin at gmail.com> ha
scritto:

>  Hi Lorenzo,
>
> I have faced this and there are two things to consider.
>
> First, you can specify the georeferenced extents _and_ the SRS  of the
> extents using something like this:
>
>     gdalwarp -t_srs EPSG:3857 \
>         -te_srs EPSG:4326 -te -109 32 -102 36 \
>         input.tif output.tif
>
> Note that I'm warping to one coordinate system but trimming based on
> another one.  Is it possible that your black boundary is due to trimming in
> the wrong coordinate system?  For instance, if your input map is projected
> but the boundary of the map consists of parallels of latitude or
> meridians of longitude, then you could use something like the above.  (You
> can actually get even fancier by trimming with polygons too; see this
> example for inspiration:
> https://gis.stackexchange.com/questions/45053/gdalwarp-cutline-along-with-shapefile
> .)
>
> Second, recognize that the output will always be a rectangle in the output
> SRS.  If the black border is due to "no data" areas outside the input map's
> extent appearing in the output map, then you can use -dstalpha ("Create an
> output alpha band to identify nodata (unset/transparent) pixels.") to mark
> the output pixels that shouldn't be part of the map.  Basically your black
> pixels become transparent in this case.
>
> I hope that helps,
> carl
>
>
> On Wed, Nov 17, 2021 at 8:11 AM Lorenzo Di Giacomo <loridigia at gmail.com>
> wrote:
>
>> Hi all, i have a question, how is it possible to avoid black borders
>> after reprojection with "gdal_warp" ?
>> Basically i have an image that is little rotated, when i reprojected from
>> 32632 to 4326 the resulting image has black borders more or less tight
>> depending on the rotation.
>> I saw i can change the colors of those no_data (using -dstnodata) but
>> how can i do if i dont want it at all? Adding another band result in a size
>> increase, that i don't want either.
>>
>> Thanks !!
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/4b33c752/attachment.html>

From even.rouault at spatialys.com  Thu Nov 18 06:36:50 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Nov 2021 15:36:50 +0100
Subject: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
 LERC_DEFLATE
In-Reply-To: <CAHE-9zCusXEy8j2hP9BhjpCNYaWEKcHyHHfq74WsZ75KkjaYQg@mail.gmail.com>
References: <CAHE-9zCusXEy8j2hP9BhjpCNYaWEKcHyHHfq74WsZ75KkjaYQg@mail.gmail.com>
Message-ID: <2a29c4e6-3f90-f44e-58f5-0ee2a5d0b49c@spatialys.com>

We would need a MAX_Z_ERROR_OVERVIEW config option for that. Please file 
an enhancement ticket

Even

Le 18/11/2021 ? 12:44, Duarte Carreira a ?crit?:
> Hi there.
>
> I am looking into compressing overviews for a DEM, with LERC_DEFLATE 
> and it works. But I'm trying to set the precision loss and get better 
> compression, since for overviews I don't really care that much.
> Ok, so the question is how to set the MAX_Z_ERROR for overviews 
> compressed with LERC_DEFLATE?
>
> More context:
> My reasoning is to compress losslessly the dem with deflate predictor 
> 3, and then compress "lossly"? the overviews with lerc_deflate.
> Since this is 32bit dataset, I can't use jpeg on the overviews.
>
> Thanks in advance.
> Duarte
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/a4654daa/attachment.html>

From even.rouault at spatialys.com  Thu Nov 18 06:46:23 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Nov 2021 15:46:23 +0100
Subject: [gdal-dev] Black borders after reprojection GDAL_WARP
In-Reply-To: <CAERmyNRaRCy-xPXy9rDQzykN7oXR_YbGr_pxU_Ja6Y5oZZC8SQ@mail.gmail.com>
References: <CAERmyNQ9+6CAbhfiN-qXLk7144SRfHxjoSqutmn-gev1QTw9sQ@mail.gmail.com>
 <CAE=8km=UPiq-aRML4qusBEZtKXjVuh0OGbtEZPnbtn2aUMBBLA@mail.gmail.com>
 <CAERmyNRaRCy-xPXy9rDQzykN7oXR_YbGr_pxU_Ja6Y5oZZC8SQ@mail.gmail.com>
Message-ID: <dd9089ae-7861-b8c3-990d-7c32a6302712@spatialys.com>

Black borders are completely expected: reprojection changes the geometry 
of the image.

That said, if the area of interest is sufficiently small and the 
geometry change being approximatively an affine transformation, you can 
try https://gdal.org/programs/gdalmove.html instead of gdalwarp to only 
alter the georeferencing information and not touch pixel values at all.

Even

Le 18/11/2021 ? 15:34, Lorenzo Di Giacomo a ?crit?:
> Hi Carl, thanks for your reply, i noticed that it happens even if i 
> just reproject the image, without cutting.
> Of course the dstalpha works, but it increases the size of the image 
> and it changes its nature (adding another band) since this operation 
> is an intermediate operation the resulting image can't be different 
> from the original, just reporojected.
>
>
>
> Il giorno gio 18 nov 2021 alle ore 14:11 Carl Godkin 
> <cgodkin at gmail.com <mailto:cgodkin at gmail.com>> ha scritto:
>
>     ?Hi Lorenzo,
>
>     I have faced this and there are two things to consider.
>
>     First, you can specify the?georeferenced extents _and_ the SRS? of
>     the extents using something like this:
>
>     ? ? gdalwarp -t_srs EPSG:3857 \
>     ? ? ? ? -te_srs EPSG:4326 -te -109 32 -102 36 \
>     ? ? ? ? input.tif output.tif
>
>     Note that I'm warping to one coordinate system but trimming based
>     on another one.? Is it possible that your black boundary is due to
>     trimming in the wrong coordinate?system?? For instance, if your
>     input map is projected but the boundary of the map consists?of
>     parallels?of latitude or meridians?of longitude, then you could
>     use something like the above.? (You can actually get even fancier
>     by trimming with polygons too; see this example for inspiration:
>     https://gis.stackexchange.com/questions/45053/gdalwarp-cutline-along-with-shapefile
>     <https://gis.stackexchange.com/questions/45053/gdalwarp-cutline-along-with-shapefile>
>     .)
>
>     Second, recognize that the output will always be a rectangle in
>     the output SRS.? If the black border is due to "no data" areas
>     outside the input map's extent appearing in the output map, then
>     you can use -dstalpha ("Create an output alpha band to identify
>     nodata (unset/transparent) pixels.") to mark the output pixels
>     that shouldn't be part of the map.? Basically your black pixels
>     become transparent in this case.
>
>     I hope that helps,
>     carl
>
>
>     On Wed, Nov 17, 2021 at 8:11 AM Lorenzo Di Giacomo
>     <loridigia at gmail.com <mailto:loridigia at gmail.com>> wrote:
>
>         Hi all, i have a question, how is it possible to avoid black
>         borders after reprojection with "gdal_warp" ?
>         Basically i have an image that is little rotated, when i
>         reprojected from 32632 to 4326 the resulting image has black
>         borders more or less tight depending on the rotation.
>         I saw i can change the colors of those no_data (using
>         -dstnodata) but how can i do if i dont?want it at all? Adding
>         another band result in a size increase, that i don't want either.
>
>         Thanks?!!
>         _______________________________________________
>         gdal-dev mailing list
>         gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>         <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/57c5c57e/attachment-0001.html>

From protoplanetario at gmail.com  Thu Nov 18 06:49:36 2021
From: protoplanetario at gmail.com (=?UTF-8?Q?Andr=C3=A9s_Nadal?=)
Date: Thu, 18 Nov 2021 11:49:36 -0300
Subject: [gdal-dev] ogr2ogr,
 perform queries to obtain values from the database
Message-ID: <CAJjdTHTwpUkeKBEHmj-egBtMnhPKpxvXxEJ_1t9=-VZBpgpZog@mail.gmail.com>

Hello.

Excuse me my English, it's not my native language.

I need to convert the names (string) of classes, in some fields of a
Shapefile, to the respective numerical values of the database.

In some cases, the fields have up to 3 different classes, for different
rows.

CLASS A = 1
CLASS B = 2
CLASS B = 3

The destination table, this already exists, and contains many other fields,
this using ogr2ogr.exe, from Windows CMD.

How to indicate to ogr2ogr.exe, which performs a query first, to obtain the
numerical value of the ' CLASS B', from PostGIS.

In this way insert the value 2 in the table.

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/bf47b67e/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 18 07:19:22 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 18 Nov 2021 15:19:22 +0000
Subject: [gdal-dev] ogr2ogr,
 perform queries to obtain values from the database
Message-ID: <2a4aea82f1e84882b0c0484ae35b1e4c@maanmittauslaitos.fi>

Hi,

I would suggest to consider other options first.


  *   Use OGR foreign data wrapper https://github.com/pramsey/pgsql-ogr-fdw and make the shapefile to appear as a PostGIS table. The you can make the JOIN in your PostGIS.
  *   Add both the shapefile and the classification table from PostgreSQL into GeoPackage or SpatiaLite database as separate tables and update the coded values into definition string with SQL locally.


If you really want to join shapefile and PostgreSQL tables directly with GDAL and ogr2ogr I believe the only way is to write a vector VRT file https://gdal.org/drivers/vector/vrt.html#vector-vrt  that makes those two to appear as two layers in one datasource. The result is actually logically rather similar than by using foreign data wrappers on the PostgreSQL side.

If I would need to do the task just once I would take the GeoPackage road but I have done that before and my view is therefore certainly biased.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Andr?s Nadal
L?hetetty: torstai 18. marraskuuta 2021 16.50
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ogr2ogr, perform queries to obtain values from the database

Hello.

Excuse me my English, it's not my native language.

I need to convert the names (string) of classes, in some fields of a Shapefile, to the respective numerical values of the database.

In some cases, the fields have up to 3 different classes, for different rows.

CLASS A = 1
CLASS B = 2
CLASS B = 3

The destination table, this already exists, and contains many other fields, this using ogr2ogr.exe, from Windows CMD.

How to indicate to ogr2ogr.exe, which performs a query first, to obtain the numerical value of the ' CLASS B', from PostGIS.

In this way insert the value 2 in the table.

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/5cefbfde/attachment.html>

From dncarreira at gmail.com  Thu Nov 18 08:30:24 2021
From: dncarreira at gmail.com (Duarte Carreira)
Date: Thu, 18 Nov 2021 16:30:24 +0000
Subject: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
 LERC_DEFLATE
In-Reply-To: <e778ce694fd34b7ea16185c69c4748ad@maanmittauslaitos.fi>
References: <e778ce694fd34b7ea16185c69c4748ad@maanmittauslaitos.fi>
Message-ID: <CAHE-9zBOpH9MD9oJ6d4hi6ba7EdgkZ4eRpbNjA50GrKKaUY_tA@mail.gmail.com>

Well, it didn't even occur to me to compress the overviews with translate...
I was expecting a bit more compressing from lerc...

About tif 32bit, what compression do you think would yield better ratios?

Thanks.

Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> escreveu no dia
quinta, 18/11/2021 ?(s) 12:41:

> Hi,
>
>
>
> I made some tests with an 8 bit RGB image.
>
> First observation was that gdaladdo supports lerc_deflate (even it is not
> documented), but it does not support ?MAX_Z_ERROR?. This yields same sized
> ovr file with or without max_z_error.
>
> gdaladdo -ro lerc_def2.tif --config compress_overview lerc_deflate
> --config MAX_Z_ERROR 10
>
>
>
> Another observation was that this option would really save some disk
> space. I compressed the lossless ovr file with gdal_translate by using -co
> max_z_error=10 and file sizes were:
>
>
>
> source tiff: 432 072 372 bytes
>
> lecr_deflate cog without overviews: 311 258 085 bytes
>
>
>
> lossless lerc_deflate overviews: 118 954 009 bytes
>
> lerc_deflare overviews with z_error=10: 52 400 583 bytes
>
>
>
> For comparison even not relevant to original question about 32 bit data
>
> jpeg-ycbcr overviews with default quality: 14 481 967 bytes
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Duarte
> Carreira
> *L?hetetty:* torstai 18. marraskuuta 2021 13.45
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
> LERC_DEFLATE
>
>
>
> Hi there.
>
>
>
> I am looking into compressing overviews for a DEM, with LERC_DEFLATE and
> it works. But I'm trying to set the precision loss and get better
> compression, since for overviews I don't really care that much.
>
> Ok, so the question is how to set the MAX_Z_ERROR for overviews compressed
> with LERC_DEFLATE?
>
>
>
> More context:
>
> My reasoning is to compress losslessly the dem with deflate predictor 3,
> and then compress "lossly"  the overviews with lerc_deflate.
>
> Since this is 32bit dataset, I can't use jpeg on the overviews.
>
>
>
> Thanks in advance.
>
> Duarte
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/8940b90c/attachment-0001.html>

From dncarreira at gmail.com  Thu Nov 18 09:15:00 2021
From: dncarreira at gmail.com (Duarte Carreira)
Date: Thu, 18 Nov 2021 17:15:00 +0000
Subject: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
 LERC_DEFLATE
Message-ID: <CAHE-9zCYBvGhutADfip0iTXvhvfBJCmAEMxzejY9jxwV+1F2oA@mail.gmail.com>

Hi Even. I created a ticket:
https://github.com/OSGeo/gdal/issues/4848

Thanks.

>We would need a MAX_Z_ERROR_OVERVIEW config option for that. Please >file an
enhancement ticket
>
>Even

>Le 18/11/2021 ? 12:44, Duarte Carreira a ?crit :
>>* Hi there.
*>>>>* I am looking into compressing overviews for a DEM, with LERC_DEFLATE
*>>* and it works. But I'm trying to set the precision loss and get better
*>>* compression, since for overviews I don't really care that much.
*>>* Ok, so the question is how to set the MAX_Z_ERROR for overviews
*>>* compressed with LERC_DEFLATE?
*>>>>* More context:
*>>* My reasoning is to compress losslessly the dem with deflate predictor
*>>* 3, and then compress "lossly"  the overviews with lerc_deflate.
*>>* Since this is 32bit dataset, I can't use jpeg on the overviews.
*>>>>* Thanks in advance.
*>>* Duarte*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/b0638453/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 18 09:34:44 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 18 Nov 2021 17:34:44 +0000
Subject: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
 LERC_DEFLATE
Message-ID: <ec8df394b5894a4d93cb5ba0b2e7e765@maanmittauslaitos.fi>

Hi,

I have no experience on 32 bit images but play with gdaladdo and compression options and report what you find. External overviews (-ro) are handy for testing because you can simply rename or delete the .ovr file and make new run with other options. External overviews take some more space than it takes to add internal overviews into TIFF but best option as external should be best as internal too.

-Jukka Rahkonen-

L?hett?j?: Duarte Carreira <dncarreira at gmail.com>
L?hetetty: torstai 18. marraskuuta 2021 18.30
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with LERC_DEFLATE

Well, it didn't even occur to me to compress the overviews with translate...
I was expecting a bit more compressing from lerc...

About tif 32bit, what compression do you think would yield better ratios?

Thanks.

Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> escreveu no dia quinta, 18/11/2021 ?(s) 12:41:
Hi,

I made some tests with an 8 bit RGB image.
First observation was that gdaladdo supports lerc_deflate (even it is not documented), but it does not support ?MAX_Z_ERROR?. This yields same sized ovr file with or without max_z_error.
gdaladdo -ro lerc_def2.tif --config compress_overview lerc_deflate --config MAX_Z_ERROR 10

Another observation was that this option would really save some disk space. I compressed the lossless ovr file with gdal_translate by using -co max_z_error=10 and file sizes were:

source tiff: 432 072 372 bytes
lecr_deflate cog without overviews: 311 258 085 bytes

lossless lerc_deflate overviews: 118 954 009 bytes
lerc_deflare overviews with z_error=10: 52 400 583 bytes

For comparison even not relevant to original question about 32 bit data
jpeg-ycbcr overviews with default quality: 14 481 967 bytes

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Duarte Carreira
L?hetetty: torstai 18. marraskuuta 2021 13.45
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with LERC_DEFLATE

Hi there.

I am looking into compressing overviews for a DEM, with LERC_DEFLATE and it works. But I'm trying to set the precision loss and get better compression, since for overviews I don't really care that much.
Ok, so the question is how to set the MAX_Z_ERROR for overviews compressed with LERC_DEFLATE?

More context:
My reasoning is to compress losslessly the dem with deflate predictor 3, and then compress "lossly"  the overviews with lerc_deflate.
Since this is 32bit dataset, I can't use jpeg on the overviews.

Thanks in advance.
Duarte

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/a564525a/attachment.html>

From even.rouault at spatialys.com  Thu Nov 18 10:12:35 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Nov 2021 19:12:35 +0100
Subject: [gdal-dev] Moving GDAL GRASS driver in a dedicated repository ?
Message-ID: <36ba97a9-1dc6-eacb-8765-55c0c4a97929@spatialys.com>

Hi,

(writing to both GDAL and GRASS lists)

Working on the transition to CMake as the GDAL build system, the 
particular status of the GRASS driver in GDAL raised my attention.

(The following is based on my understanding. It has been ages since I 
didn't try this...)

This driver is a bit odd in the sense that there's a cyclic dependency 
to work around, as GRASS links to GDAL , but the GDAL GRASS driver needs 
to be linked against GRASS.

So the usual procedure is:

- build GDAL without the GRASS driver

- build GRASS against GDAL

- build the GDAL GRASS driver from the separate gdal-grass tarball that 
GDAL distributes along its main tarball.

With the current GDAL autoconf build system, there's also the 
possibility to rebuild GDAL with the GRASS driver builtin in libgdal, 
but that's a bit odd, since you need to make sure that this new libgdal 
is the one that GRASS will link against at runtime, otherwise chaos will 
ensure. I'm not sure if that's used. This is typically something I would 
*not* want to support in the new GDAL cmake build.

All in all, given the particular nature of that driver, I believe it 
would be better in a dedicated repository, with its standalone build 
scripts, whose initial version could be just the ones of 
https://github.com/OSGeo/gdal/tree/master/frmts/grass/pkg, or evolve to 
CMake or whatever the maintainers of that driver would prefer. I believe 
this would make the situation clearer.

Opinions ? and people interested in setting up that dedicated repository ?

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From Matt.Wilkie at yukon.ca  Thu Nov 18 14:08:36 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Thu, 18 Nov 2021 22:08:36 +0000
Subject: [gdal-dev] georeferenced but not georeferenced?
In-Reply-To: <7450e7a2-b17b-4614-f83a-eab09f85ed8f@spatialys.com>
References: <dc5c68312fa14d299fcada70c0f7b316@yukon.ca>
 <7450e7a2-b17b-4614-f83a-eab09f85ed8f@spatialys.com>
Message-ID: <9cf180a1b6a749ce8b16f32837455aaf@yukon.ca>

Thank you Even, especially for highlighting a DEM should be used. I 'knew' that but hadn't taken the time to fully ingest the meaning. It's drastically changed how I'm approaching this project.

-Matt

From: Even Rouault <even.rouault at spatialys.com>
Sent: November 10, 2021 2:16 PM
To: Matt.Wilkie <Matt.Wilkie at yukon.ca>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] georeferenced but not georeferenced?

Le 10/11/2021 ? 22:03, Matt.Wilkie at yukon.ca<mailto:Matt.Wilkie at yukon.ca> a ?crit :

Hi all,



I'm creating images from SPOT6/7 archive DIMAP format. The resulting images display in the correct position in the world when combined with other sources, however all the usual tools say the images have no georeferencing.



* If the images have no georeferencing how do ArcMap/Pro and Qgis know to put them in the right place?

Those images have RPC. You can see RPC information with gdalinfo in the "RPC Metadata" section

listeo/geotiffcp and a number of utilities are not RPC aware. But gdalwarp is.



* How can I convert whatever-this-is into proper georeferencing so that other tools know how to handle them too?
You can use gdalwarp to orthorectify them.  You should generally specify -to RPC_DEM=some_dem_with_elevation_as_ellipsoidal_heights or -to RPC_HEIGHT=ellipsoidal_height. See https://gdal.org/api/gdal_alg.html?highlight=rpc_dem




Attached is a sample image.  It was created with (on one line):



    gdal_translate  -outsize 100 0

    -co compress=zstd -co predictor=yes -co level=17 -co bigtiff=yes -of cog

    .\path\to\IMG_SPOT6_MS_001_A\DIM_SPOT6_MS_201609082010410_SEN_1.XML

    source_tiny.tif



The biggest problem this causes me at the moment is that gdal_pansharpen.py output does not have any kind of goereferencing, and I can't use old faithfuls like listgeo, geotiffcp, or gdalcopyproj.py to copy the coordinate system across.



thanks in advance for your thoughts,



Matt Wilkie

Geomatics Developer & Administrator

Environment | Technology, Innovation and Mapping

T 867-667-8133 | Yukon.ca

Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<https://imsva91-ctp.trendmicro.com:443/wis/clicktime/v1/query?url=http%3a%2f%2fwww.spatialys.com&umid=9E426F74-D075-BC05-8F12-F338C4BD772D&auth=c132af8ee7c9d1278d61a701569070a095ce962e-893f1a6a29bf04fdcbd6545284ebfde530cc8c97>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211118/062ef3d4/attachment.html>

From roman.schiffer at gmail.com  Fri Nov 19 00:18:25 2021
From: roman.schiffer at gmail.com (Roman Breitfuss-Schiffer)
Date: Fri, 19 Nov 2021 09:18:25 +0100
Subject: [gdal-dev] GDALWMS - error: TCP connection reset by peer
In-Reply-To: <ebde98645a394925b8e00a0178d7fba5@maanmittauslaitos.fi>
References: <ebde98645a394925b8e00a0178d7fba5@maanmittauslaitos.fi>
Message-ID: <dee880e2-fd94-614d-9262-777d7ed96cf9@gmail.com>

Dear Jukka!

Thanks for your answer! I think I'm gonna follow that road you suggested.

We have been thinking a lot and I was just wondering if there could be 
some GDAL configuration which could cause that behaviour? For example 
the value for <MaxConnections> in the WMS XML file? Or if more 
applications are accessing the same WMS XML at the same time which is 
theoretically possible in our case.

Best regards
Roman

Am 18.11.2021 um 12:12 schrieb Rahkonen Jukka (MML):
>
> Hi,
>
> It seems that the WMS server is closing the door and there is nothing 
> else to do on the GDAL side except to try again later. Contact the WMS 
> service maintainer and report your troubles. They may be able to 
> provide you a more reliable service especially if you are ready to pay 
> for it.
>
> -Jukka Rahkonen-
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Roman Breitfuss-Schiffer
> *L?hetetty:* torstai 18. marraskuuta 2021 11.59
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] GDALWMS - error: TCP connection reset by peer
>
> Dear all!
>
> We are running a Python application an a linux distribution (RedHat) 
> which creates clips in MBTILES format from a WMS. We are using the 
> Python-API and are basically doing something like this:
>
> src_ds = gdal.Warp(
> ??? tmp_file,
> ??? ds_in,
> ??? format='GTiff',
> ??? outputBounds=[bbox[0], bbox[2], bbox[1], bbox[3]],
> ??? dstSRS=output_srs,
> )
> ds_out = gdal.Translate(
> ??? out_filepath,
> ??? src_ds,
> ??? format='MBTILES',
> ??? creationOptions=creation_options,
> )
>
> The application throughs an error from time to time since a few days. 
> We couldn't figure out a pattern yet and therefore we are also not 
> able to reproduce the error. The error is the following:
>
> Mon Nov 15 13:48:13 2021: CPLError: GDALWMS: Unable to download block 
> 2765, 602.
> URL: TCP connection reset by peer
> ? HTTP status code: 0, error: TCP connection reset by peer.
> Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error 
> (see http://www.gdal.org/frmt_wms.html).
> Mon Nov 15 13:48:13 2021: CPLError: /wms_xml/wms_config.xml, band 1: 
> IReadBlock failed at X offset 2764, Y offset 601
> Mon Nov 15 13:48:13 2021: CPLError: GetBlockRef failed at X block 
> offset 2764, Y block offset 601
>
> The exact same data gets processed successfully in one run and not 
> successfully in another run. We didn't change the code nor the Python 
> or GDAL version. Hence, we are kind of puzzled as the error comes and 
> goes seemingly at random.
>
> Does anyone of you have any hints?
>
> Thanks & best regards!
> Roman
>
> _______________________________________________
> Dipl.-Ing. Roman Breitfuss-Schiffer, MSc. (GIS)

-- 
_______________________________________________
Dipl.-Ing. Roman Breitfuss-Schiffer, MSc. (GIS)
Veronikagasse 38/20, 1170 Wien
+43 664 5547678
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211119/e777e2c9/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Nov 19 01:12:22 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 19 Nov 2021 09:12:22 +0000
Subject: [gdal-dev] GDALWMS - error: TCP connection reset by peer
Message-ID: <3c1eeb30a1624519be400c0ca3881ca2@maanmittauslaitos.fi>

Hi,

Large MaxConnections value leads to more concurrent requests and it may cause problems if the WMS server is very busy. Reducing MaxConnections may help if you are the only user of that WMS but if there are thousands of other users as well the service may still run at 100% and drop request either because they reach the server side timeout or because load balancer denies requests. If the overload is temporary then retry after a while could help but I do not believe that GDAL WMS driver can be configured that way  https://gdal.org/drivers/raster/wms.html.  Special tile cache programs like GeoWebCache are better prepared for failing requests https://www.geowebcache.org/docs/current/production/index.html#seed-failure-tolerance

The GDAL WMS configuration options are documented only by example https://gdal.org/drivers/raster/wms.html. I wonder where I could find information about the meaning of options that I can't guess by the name, like "CleanTimeout".

 -Jukka Rahkonen-

L?hett?j?: Roman Breitfuss-Schiffer <roman.schiffer at gmail.com>
L?hetetty: perjantai 19. marraskuuta 2021 10.18
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] GDALWMS - error: TCP connection reset by peer


Dear Jukka!

Thanks for your answer! I think I'm gonna follow that road you suggested.

We have been thinking a lot and I was just wondering if there could be some GDAL configuration which could cause that behaviour? For example the value for <MaxConnections> in the WMS XML file? Or if more applications are accessing the same WMS XML at the same time which is theoretically possible in our case.

Best regards
Roman
Am 18.11.2021 um 12:12 schrieb Rahkonen Jukka (MML):
Hi,

It seems that the WMS server is closing the door and there is nothing else to do on the GDAL side except to try again later. Contact the WMS service maintainer and report your troubles. They may be able to provide you a more reliable service especially if you are ready to pay for it.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> Puolesta Roman Breitfuss-Schiffer
L?hetetty: torstai 18. marraskuuta 2021 11.59
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] GDALWMS - error: TCP connection reset by peer


Dear all!

We are running a Python application an a linux distribution (RedHat) which creates clips in MBTILES format from a WMS. We are using the Python-API and are basically doing something like this:

src_ds = gdal.Warp(
    tmp_file,
    ds_in,
    format='GTiff',
    outputBounds=[bbox[0], bbox[2], bbox[1], bbox[3]],
    dstSRS=output_srs,
)
ds_out = gdal.Translate(
    out_filepath,
    src_ds,
    format='MBTILES',
    creationOptions=creation_options,
)

The application throughs an error from time to time since a few days. We couldn't figure out a pattern yet and therefore we are also not able to reproduce the error. The error is the following:

Mon Nov 15 13:48:13 2021: CPLError: GDALWMS: Unable to download block 2765, 602.
URL: TCP connection reset by peer
  HTTP status code: 0, error: TCP connection reset by peer.
Add the HTTP status code to <ZeroBlockHttpCodes> to ignore this error (see http://www.gdal.org/frmt_wms.html).
Mon Nov 15 13:48:13 2021: CPLError: /wms_xml/wms_config.xml, band 1: IReadBlock failed at X offset 2764, Y offset 601
Mon Nov 15 13:48:13 2021: CPLError: GetBlockRef failed at X block offset 2764, Y block offset 601

The exact same data gets processed successfully in one run and not successfully in another run. We didn't change the code nor the Python or GDAL version. Hence, we are kind of puzzled as the error comes and goes seemingly at random.

Does anyone of you have any hints?

Thanks & best regards!
Roman

_______________________________________________

Dipl.-Ing. Roman Breitfuss-Schiffer, MSc. (GIS)

--

_______________________________________________

Dipl.-Ing. Roman Breitfuss-Schiffer, MSc. (GIS)

Veronikagasse 38/20, 1170 Wien

+43 664 5547678
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211119/9c88cc42/attachment-0001.html>

From loridigia at gmail.com  Fri Nov 19 03:14:48 2021
From: loridigia at gmail.com (Lorenzo Di Giacomo)
Date: Fri, 19 Nov 2021 12:14:48 +0100
Subject: [gdal-dev] Black borders after reprojection GDAL_WARP
In-Reply-To: <dd9089ae-7861-b8c3-990d-7c32a6302712@spatialys.com>
References: <CAERmyNQ9+6CAbhfiN-qXLk7144SRfHxjoSqutmn-gev1QTw9sQ@mail.gmail.com>
 <CAE=8km=UPiq-aRML4qusBEZtKXjVuh0OGbtEZPnbtn2aUMBBLA@mail.gmail.com>
 <CAERmyNRaRCy-xPXy9rDQzykN7oXR_YbGr_pxU_Ja6Y5oZZC8SQ@mail.gmail.com>
 <dd9089ae-7861-b8c3-990d-7c32a6302712@spatialys.com>
Message-ID: <CAERmyNSD6xDKnLgZVS8z1Sz3+gQrGauhmJ=sWb8DL_OKcupNXg@mail.gmail.com>

Thanks Even, didn't know about gdalmove. I'll try !!


Il giorno gio 18 nov 2021 alle ore 15:47 Even Rouault <
even.rouault at spatialys.com> ha scritto:

> Black borders are completely expected: reprojection changes the geometry
> of the image.
>
> That said, if the area of interest is sufficiently small and the geometry
> change being approximatively an affine transformation, you can try
> https://gdal.org/programs/gdalmove.html instead of gdalwarp to only alter
> the georeferencing information and not touch pixel values at all.
>
> Even
> Le 18/11/2021 ? 15:34, Lorenzo Di Giacomo a ?crit :
>
> Hi Carl, thanks for your reply, i noticed that it happens even if i just
> reproject the image, without cutting.
> Of course the dstalpha works, but it increases the size of the image and
> it changes its nature (adding another band) since this operation is an
> intermediate operation the resulting image can't be different from the
> original, just reporojected.
>
>
>
> Il giorno gio 18 nov 2021 alle ore 14:11 Carl Godkin <cgodkin at gmail.com>
> ha scritto:
>
>>  Hi Lorenzo,
>>
>> I have faced this and there are two things to consider.
>>
>> First, you can specify the georeferenced extents _and_ the SRS  of the
>> extents using something like this:
>>
>>     gdalwarp -t_srs EPSG:3857 \
>>         -te_srs EPSG:4326 -te -109 32 -102 36 \
>>         input.tif output.tif
>>
>> Note that I'm warping to one coordinate system but trimming based on
>> another one.  Is it possible that your black boundary is due to trimming in
>> the wrong coordinate system?  For instance, if your input map is projected
>> but the boundary of the map consists of parallels of latitude or
>> meridians of longitude, then you could use something like the above.  (You
>> can actually get even fancier by trimming with polygons too; see this
>> example for inspiration:
>> https://gis.stackexchange.com/questions/45053/gdalwarp-cutline-along-with-shapefile
>> .)
>>
>> Second, recognize that the output will always be a rectangle in the
>> output SRS.  If the black border is due to "no data" areas outside the
>> input map's extent appearing in the output map, then you can use -dstalpha
>> ("Create an output alpha band to identify nodata (unset/transparent)
>> pixels.") to mark the output pixels that shouldn't be part of the map.
>> Basically your black pixels become transparent in this case.
>>
>> I hope that helps,
>> carl
>>
>>
>> On Wed, Nov 17, 2021 at 8:11 AM Lorenzo Di Giacomo <loridigia at gmail.com>
>> wrote:
>>
>>> Hi all, i have a question, how is it possible to avoid black borders
>>> after reprojection with "gdal_warp" ?
>>> Basically i have an image that is little rotated, when i reprojected
>>> from 32632 to 4326 the resulting image has black borders more or less tight
>>> depending on the rotation.
>>> I saw i can change the colors of those no_data (using -dstnodata) but
>>> how can i do if i dont want it at all? Adding another band result in a size
>>> increase, that i don't want either.
>>>
>>> Thanks !!
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211119/b123f862/attachment.html>

From dncarreira at gmail.com  Mon Nov 22 03:26:51 2021
From: dncarreira at gmail.com (Duarte Carreira)
Date: Mon, 22 Nov 2021 11:26:51 +0000
Subject: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
 LERC_DEFLATE
In-Reply-To: <ec8df394b5894a4d93cb5ba0b2e7e765@maanmittauslaitos.fi>
References: <ec8df394b5894a4d93cb5ba0b2e7e765@maanmittauslaitos.fi>
Message-ID: <CAHE-9zBR=DDtdLBuzqzcGcpBLzyfe-sVfAP-_huLHw-Cviyy_w@mail.gmail.com>

So I tried LERC_DEFLATE and MAX_Z_ERROR=0.5 and that worked amazingly! From
350MB DEFLATE PREDICTOR 3, to 45MB...

There are free 32bit elevation data here if anyone's interested:
https://land.copernicus.eu/imagery-in-situ/eu-dem/eu-dem-v1.1?tab=download.

Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> escreveu no dia
quinta, 18/11/2021 ?(s) 17:34:

> Hi,
>
>
>
> I have no experience on 32 bit images but play with gdaladdo and
> compression options and report what you find. External overviews (-ro) are
> handy for testing because you can simply rename or delete the .ovr file and
> make new run with other options. External overviews take some more space
> than it takes to add internal overviews into TIFF but best option as
> external should be best as internal too.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Duarte Carreira <dncarreira at gmail.com>
> *L?hetetty:* torstai 18. marraskuuta 2021 18.30
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
> LERC_DEFLATE
>
>
>
> Well, it didn't even occur to me to compress the overviews with
> translate...
>
> I was expecting a bit more compressing from lerc...
>
>
>
> About tif 32bit, what compression do you think would yield better ratios?
>
>
>
> Thanks.
>
>
>
> Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> escreveu no
> dia quinta, 18/11/2021 ?(s) 12:41:
>
> Hi,
>
>
>
> I made some tests with an 8 bit RGB image.
>
> First observation was that gdaladdo supports lerc_deflate (even it is not
> documented), but it does not support ?MAX_Z_ERROR?. This yields same sized
> ovr file with or without max_z_error.
>
> gdaladdo -ro lerc_def2.tif --config compress_overview lerc_deflate
> --config MAX_Z_ERROR 10
>
>
>
> Another observation was that this option would really save some disk
> space. I compressed the lossless ovr file with gdal_translate by using -co
> max_z_error=10 and file sizes were:
>
>
>
> source tiff: 432 072 372 bytes
>
> lecr_deflate cog without overviews: 311 258 085 bytes
>
>
>
> lossless lerc_deflate overviews: 118 954 009 bytes
>
> lerc_deflare overviews with z_error=10: 52 400 583 bytes
>
>
>
> For comparison even not relevant to original question about 32 bit data
>
> jpeg-ycbcr overviews with default quality: 14 481 967 bytes
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Duarte
> Carreira
> *L?hetetty:* torstai 18. marraskuuta 2021 13.45
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] setting MAX_Z_ERROR on overviews compressed with
> LERC_DEFLATE
>
>
>
> Hi there.
>
>
>
> I am looking into compressing overviews for a DEM, with LERC_DEFLATE and
> it works. But I'm trying to set the precision loss and get better
> compression, since for overviews I don't really care that much.
>
> Ok, so the question is how to set the MAX_Z_ERROR for overviews compressed
> with LERC_DEFLATE?
>
>
>
> More context:
>
> My reasoning is to compress losslessly the dem with deflate predictor 3,
> and then compress "lossly"  the overviews with lerc_deflate.
>
> Since this is 32bit dataset, I can't use jpeg on the overviews.
>
>
>
> Thanks in advance.
>
> Duarte
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211122/e9861b6b/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 22 05:49:39 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 22 Nov 2021 13:49:39 +0000
Subject: [gdal-dev] Gdal_edit and -gcp as read-only
Message-ID: <117489fa5a0545668985b0ce3fd3d02d@maanmittauslaitos.fi>

Hi,

I tried to add ground control points into a TIFF file with gdal_edit. I do not want to touch the TIFF so I used the read-only option and supposed that gcp would be written into .aux.xml file but that did not happen. Instead I got a message

gdal_edit -ro -gcp 1 1 20 30 test.tif
ERROR 6: test.tif: SetGCPs() is only supported on newly created GeoTIFF files.

Without -ro gdal_edit adds ground control points into the TIFF without errors. What might be the meaning of the message about "newly created GeoTIFF" and is there some way to make gdal_edit to write ground control points into PAM file? I know that I can use gdal_translate and VRT as a workaround but PAM .aux.xml could be a bit better for my whole workflow.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211122/7c28c85a/attachment.html>

From even.rouault at spatialys.com  Mon Nov 22 06:04:42 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Nov 2021 15:04:42 +0100
Subject: [gdal-dev] Gdal_edit and -gcp as read-only
In-Reply-To: <117489fa5a0545668985b0ce3fd3d02d@maanmittauslaitos.fi>
References: <117489fa5a0545668985b0ce3fd3d02d@maanmittauslaitos.fi>
Message-ID: <31be98ed-5642-51bf-1512-c21bc82d14f2@spatialys.com>

Hi Jukka,

from what I can see in 
https://github.com/OSGeo/gdal/commit/b5128c1ff3ac6ad44b225284f5be1f728840e7b3, 
this dates back to almost 20 years ago when SetGCPs() was initially 
implemented. And at that time, PAM didn't exist yet in GDAL :-)

Please create a ticket about (and mention SetGeoTransform() and 
SetSpatialRef() have the same issue)

Even

Le 22/11/2021 ? 14:49, Rahkonen Jukka (MML) a ?crit?:
>
> Hi,
>
> I tried to add ground control points into a TIFF file with gdal_edit. 
> I do not want to touch the TIFF so I used the read-only option and 
> supposed that gcp would be written into .aux.xml file but that did not 
> happen. Instead I got a message
>
> gdal_edit -ro -gcp 1 1 20 30 test.tif
> ERROR 6: test.tif: SetGCPs() is only supported on newly created 
> GeoTIFF files.
>
> Without -ro gdal_edit adds ground control points into the TIFF without 
> errors. What might be the meaning of the message about ?newly created 
> GeoTIFF? and is there some way to make gdal_edit to write ground 
> control points into PAM file? I know that I can use gdal_translate and 
> VRT as a workaround but PAM .aux.xml could be a bit better for my 
> whole workflow.
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211122/cba631fc/attachment.html>

From markus.metz.giswork at gmail.com  Tue Nov 23 12:50:51 2021
From: markus.metz.giswork at gmail.com (Markus Metz)
Date: Tue, 23 Nov 2021 21:50:51 +0100
Subject: [gdal-dev] Moving GDAL GRASS driver in a dedicated repository ?
In-Reply-To: <36ba97a9-1dc6-eacb-8765-55c0c4a97929@spatialys.com>
References: <36ba97a9-1dc6-eacb-8765-55c0c4a97929@spatialys.com>
Message-ID: <CAG+h=FEN6Xz3z0RA+F7aWkk461POO=FVyvT34p2obG4pk3y-KA@mail.gmail.com>

Hi Even,

IMHO it has been a bit of a luxury that the GDAL GRASS driver was allowed
to exist as a regular GDAL supported format within frmts/grass. With every
new release of GDAL, you (the GDAL maintainers) also released a separate
new GDAL GRASS driver which was really nice of you!

Considering the workaround for this circular dependency, I agree that a
dedicated repository makes sense.

I personally don't use the GDAL GRASS driver at all (I just try to maintain
it), but I am aware that a number of projects use the GDAL GRASS driver.
Feedback from any affected projects would be helpful.

Markus M

On Thu, Nov 18, 2021 at 7:13 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> (writing to both GDAL and GRASS lists)
>
> Working on the transition to CMake as the GDAL build system, the
> particular status of the GRASS driver in GDAL raised my attention.
>
> (The following is based on my understanding. It has been ages since I
> didn't try this...)
>
> This driver is a bit odd in the sense that there's a cyclic dependency
> to work around, as GRASS links to GDAL , but the GDAL GRASS driver needs
> to be linked against GRASS.
>
> So the usual procedure is:
>
> - build GDAL without the GRASS driver
>
> - build GRASS against GDAL
>
> - build the GDAL GRASS driver from the separate gdal-grass tarball that
> GDAL distributes along its main tarball.
>
> With the current GDAL autoconf build system, there's also the
> possibility to rebuild GDAL with the GRASS driver builtin in libgdal,
> but that's a bit odd, since you need to make sure that this new libgdal
> is the one that GRASS will link against at runtime, otherwise chaos will
> ensure. I'm not sure if that's used. This is typically something I would
> *not* want to support in the new GDAL cmake build.
>
> All in all, given the particular nature of that driver, I believe it
> would be better in a dedicated repository, with its standalone build
> scripts, whose initial version could be just the ones of
> https://github.com/OSGeo/gdal/tree/master/frmts/grass/pkg, or evolve to
> CMake or whatever the maintainers of that driver would prefer. I believe
> this would make the situation clearer.
>
> Opinions ? and people interested in setting up that dedicated repository ?
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211123/c3577845/attachment.html>

From rykovd at gmail.com  Wed Nov 24 02:51:50 2021
From: rykovd at gmail.com (Denis Rykov)
Date: Wed, 24 Nov 2021 11:51:50 +0100
Subject: [gdal-dev] Is it possible to have an external Color Table
 definition for GeoTIFF rasters?
Message-ID: <CAJbvKNrAVnrwigaawQwH4mY0HHoreUDu=V3WbnmTEMdAMnz0GQ@mail.gmail.com>

For example it works in case of ASCII rasters:

$ cat test.ascii.aux.xml <PAMDataset> <PAMRasterBand band="1"> <ColorInterp>
Palette</ColorInterp> <ColorTable> <Entry c1="0" c2="0" c3="0" c4="0" /> <
Entry c1="1" c2="2" c3="3" c4="4" /> <Entry c1="2" c2="4" c3="6" c4="8" /> <
Entry c1="3" c2="6" c3="9" c4="12" /> <Entry c1="4" c2="8" c3="12" c4="16"
/> </ColorTable> <Metadata> <MDI key="STATISTICS_MAXIMUM">4</MDI> <MDI key=
"STATISTICS_MEAN">1.75</MDI> <MDI key="STATISTICS_MINIMUM">0</MDI> <MDI key=
"STATISTICS_STDDEV">1.4790199457749</MDI> </Metadata> </PAMRasterBand> </
PAMDataset>

$ gdalinfo test.ascii Driver: AAIGrid/Arc/Info ASCII Grid Files: test.ascii
test.ascii.aux.xml Size is 5, 1 Origin =
(0.000000000000000,0.000000000000000) Pixel Size =
(1.000000000000000,-1.000000000000000) Corner Coordinates: Upper Left (
0.0000000, 0.0000000) Lower Left ( 0.0000000, -1.0000000) Upper Right (
5.0000000, 0.0000000) Lower Right ( 5.0000000, -1.0000000) Center (
2.5000000, -0.5000000) Band 1 Block=5x1 Type=Int32, ColorInterp=Palette
Min=0.000 Max=4.000 Minimum=0.000, Maximum=4.000, Mean=1.750, StdDev=1.479
NoData Value=3 Metadata: STATISTICS_MAXIMUM=4 STATISTICS_MEAN=1.75
STATISTICS_MINIMUM=0 STATISTICS_STDDEV=1.4790199457749 Color Table (RGB
with 5 entries) 0: 0,0,0,0 1: 1,2,3,4 2: 2,4,6,8 3: 3,6,9,12 4: 4,8,12,16

But the same approach (having a color table in external .aux.xml PAM file)
doesn't work for GeoTIFF rasters. According to the output of gdal_translate
we can see that GDAL doesn't take into account the color table defined in
the external file.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211124/8839a053/attachment.html>

From even.rouault at spatialys.com  Wed Nov 24 02:57:41 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 24 Nov 2021 11:57:41 +0100
Subject: [gdal-dev] Is it possible to have an external Color Table
 definition for GeoTIFF rasters?
In-Reply-To: <CAJbvKNrAVnrwigaawQwH4mY0HHoreUDu=V3WbnmTEMdAMnz0GQ@mail.gmail.com>
References: <CAJbvKNrAVnrwigaawQwH4mY0HHoreUDu=V3WbnmTEMdAMnz0GQ@mail.gmail.com>
Message-ID: <dea552e9-af09-7f5b-9389-e5d2d50834d5@spatialys.com>

Denis,
> But the same approach (having a color table in external .aux.xml PAM 
> file) doesn't work for GeoTIFF rasters. According to the output of 
> gdal_translate we can see that GDAL doesn't take into account the 
> color table defined in the external file.

Please file an issue about that, or even better, propose a pull request. 
This should mostly be a matter of having 
GTiffRasterBand::GetColorTable() call the base implementation of 
GDALPamRasterBand

Even


>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211124/015939f2/attachment-0001.html>

From rykovd at gmail.com  Wed Nov 24 03:14:13 2021
From: rykovd at gmail.com (Denis Rykov)
Date: Wed, 24 Nov 2021 12:14:13 +0100
Subject: [gdal-dev] Is it possible to have an external Color Table
 definition for GeoTIFF rasters?
In-Reply-To: <dea552e9-af09-7f5b-9389-e5d2d50834d5@spatialys.com>
References: <CAJbvKNrAVnrwigaawQwH4mY0HHoreUDu=V3WbnmTEMdAMnz0GQ@mail.gmail.com>
 <dea552e9-af09-7f5b-9389-e5d2d50834d5@spatialys.com>
Message-ID: <CAJbvKNpzeQQzdided41-O9jv7mPQkjjF7BnAXmSY0tBSsqrWNA@mail.gmail.com>

Thanks, Even! I've filed an issue: https://github.com/OSGeo/gdal/issues/4897

On Wed, Nov 24, 2021 at 11:57 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Denis,
>
> But the same approach (having a color table in external .aux.xml PAM file)
> doesn't work for GeoTIFF rasters. According to the output of gdal_translate
> we can see that GDAL doesn't take into account the color table defined in
> the external file.
>
> Please file an issue about that, or even better, propose a pull request.
> This should mostly be a matter of having GTiffRasterBand::GetColorTable()
> call the base implementation of GDALPamRasterBand
>
> Even
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211124/b1dfa20b/attachment.html>

From niki.kamp at gmail.com  Thu Nov 25 04:44:17 2021
From: niki.kamp at gmail.com (Nicole Kamp)
Date: Thu, 25 Nov 2021 13:44:17 +0100
Subject: [gdal-dev] GDAL COG - Problem with Overviews
Message-ID: <CA+YW3aVUuN+CQpN-sxK7gxhHCsmsbEuLRrKoqbPgOEY4eUkh+g@mail.gmail.com>

Dear GDAL Developers,
I have an overview problem with my Cloud Optimized GeoTIFF.
I tried to translate a 16 bit, 4 bands ortho image to a COG 8bit, 3 bands
image with JPEG compression.

That is the original image. <https://pasteboard.co/CLur6VdD0CwQ.jpg>
That is the result. <https://pasteboard.co/MJv3lOjlI8iM.jpg>

It works fine with LZW compression, but I need the JPEG compression. What
am I doing wrong?

Thanks,
Niki


Here is my code.
        for raster in glob.glob(str(parameters[self.INPUT_Pfad])+'/*.tif'):
            fileInfo = QFileInfo(raster)
            baseName = fileInfo.baseName()
            file_name = str(parameters[self.INPUT_Pfad])+'/'+baseName+'.tif'
            feedback.pushInfo(file_name)
            output_file1 =
str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'.tif'
            output_file2 =
str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'_cog.tif'

            # Create COG
            x_size = 6250
            y_size = 5000
            num_bands = 4

            src_ds = gdal.Open(file_name)
            format = "GTiff"
            driver = gdal.GetDriverByName(format)

            # Translate
            translate_options = gdal.TranslateOptions(format = 'COG',
outputType = gdal.GDT_Byte, bandList =
               [1,2,3],  scaleParams=[''],
                                          creationOptions =
['TILED=YES','COMPRESS=JPEG','BIGTIFF=IF_NEEDED',
                            'BLOCKXSIZE=512', 'BLOCKYSIZE=512',
'RESAMPLING=NEAREST',
          'OVERVIEWS=IGNORE_EXISTING', 'INTERLEAVE=PIXEL']
                                          )
            gdal.Translate(output_file1, src_ds, options=translate_options)

            translate_options = None
            src_ds = None
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211125/9781240c/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 25 04:49:13 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 25 Nov 2021 12:49:13 +0000
Subject: [gdal-dev] GDAL COG - Problem with Overviews
Message-ID: <3161668786e044d6a2a54847ebdac1c7@maanmittauslaitos.fi>

Hi,

Maybe the band list be zero based? Try [0,1,2].

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Nicole Kamp
L?hetetty: torstai 25. marraskuuta 2021 14.44
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] GDAL COG - Problem with Overviews

Dear GDAL Developers,
I have an overview problem with my Cloud Optimized GeoTIFF.
I tried to translate a 16 bit, 4 bands ortho image to a COG 8bit, 3 bands image with JPEG compression.

That is the original image.<https://pasteboard.co/CLur6VdD0CwQ.jpg>
That is the result.<https://pasteboard.co/MJv3lOjlI8iM.jpg>

It works fine with LZW compression, but I need the JPEG compression. What am I doing wrong?

Thanks,
Niki


Here is my code.
        for raster in glob.glob(str(parameters[self.INPUT_Pfad])+'/*.tif'):
            fileInfo = QFileInfo(raster)
            baseName = fileInfo.baseName()
            file_name = str(parameters[self.INPUT_Pfad])+'/'+baseName+'.tif'
            feedback.pushInfo(file_name)
            output_file1 = str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'.tif'
            output_file2 = str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'_cog.tif'

            # Create COG
            x_size = 6250
            y_size = 5000
            num_bands = 4

            src_ds = gdal.Open(file_name)
            format = "GTiff"
            driver = gdal.GetDriverByName(format)

            # Translate
            translate_options = gdal.TranslateOptions(format = 'COG', outputType = gdal.GDT_Byte, bandList =                                                     [1,2,3],  scaleParams=[''],
                                          creationOptions = ['TILED=YES','COMPRESS=JPEG','BIGTIFF=IF_NEEDED',                                                      'BLOCKXSIZE=512', 'BLOCKYSIZE=512', 'RESAMPLING=NEAREST',                                                                'OVERVIEWS=IGNORE_EXISTING', 'INTERLEAVE=PIXEL']
                                          )
            gdal.Translate(output_file1, src_ds, options=translate_options)

            translate_options = None
            src_ds = None
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211125/4f94ec61/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Nov 25 05:37:37 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 25 Nov 2021 13:37:37 +0000
Subject: [gdal-dev] GDAL COG - Problem with Overviews
Message-ID: <609a938d5fc84949aab35dc888f2dcef@maanmittauslaitos.fi>

Hi,

Please use ?reply to all? for including the list as a recipient.
More details would lead to less guessing. Please add gdalinfo about the source and result (georeferencing is not important), tell how did you get the image of the original (which bands were selected, was any color enhancement applied). QGIS and a look at Layer properties ? Symbology is good for that. Test with gdal_translate before going to Python and send us the command if you face the same trouble. If you cannot solve the problem yourself send a link to test image. It does not need to be your real image, any technically similar image is good and usually even better if you cut it smaller. A 200x200 pixel sized piece of the original image without georeferencing is one alternative that probably would not reveal secrets.

-Jukka Rahkonen-

L?hett?j?: Nicole Kamp <niki.kamp at gmail.com>
L?hetetty: torstai 25. marraskuuta 2021 15.22
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [gdal-dev] GDAL COG - Problem with Overviews

Hello!
Thanks. I tried it with 0,1,2 - it did not work.


On Thu, Nov 25, 2021 at 1:49 PM Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Maybe the band list be zero based? Try [0,1,2].

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Nicole Kamp
L?hetetty: torstai 25. marraskuuta 2021 14.44
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] GDAL COG - Problem with Overviews

Dear GDAL Developers,
I have an overview problem with my Cloud Optimized GeoTIFF.
I tried to translate a 16 bit, 4 bands ortho image to a COG 8bit, 3 bands image with JPEG compression.

That is the original image.<https://pasteboard.co/CLur6VdD0CwQ.jpg>
That is the result.<https://pasteboard.co/MJv3lOjlI8iM.jpg>

It works fine with LZW compression, but I need the JPEG compression. What am I doing wrong?

Thanks,
Niki


Here is my code.
        for raster in glob.glob(str(parameters[self.INPUT_Pfad])+'/*.tif'):
            fileInfo = QFileInfo(raster)
            baseName = fileInfo.baseName()
            file_name = str(parameters[self.INPUT_Pfad])+'/'+baseName+'.tif'
            feedback.pushInfo(file_name)
            output_file1 = str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'.tif'
            output_file2 = str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'_cog.tif'

            # Create COG
            x_size = 6250
            y_size = 5000
            num_bands = 4

            src_ds = gdal.Open(file_name)
            format = "GTiff"
            driver = gdal.GetDriverByName(format)

            # Translate
            translate_options = gdal.TranslateOptions(format = 'COG', outputType = gdal.GDT_Byte, bandList =                                                     [1,2,3],  scaleParams=[''],
                                          creationOptions = ['TILED=YES','COMPRESS=JPEG','BIGTIFF=IF_NEEDED',                                                      'BLOCKXSIZE=512', 'BLOCKYSIZE=512', 'RESAMPLING=NEAREST',                                                                'OVERVIEWS=IGNORE_EXISTING', 'INTERLEAVE=PIXEL']
                                          )
            gdal.Translate(output_file1, src_ds, options=translate_options)

            translate_options = None
            src_ds = None
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211125/ca1f343f/attachment-0001.html>

From daniel.scheffler at gfz-potsdam.de  Thu Nov 25 13:40:43 2021
From: daniel.scheffler at gfz-potsdam.de (Daniel Scheffler)
Date: Thu, 25 Nov 2021 22:40:43 +0100
Subject: [gdal-dev] Transformation of image data between pixel/line and
 projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <43c4ce21-dbe7-a5ea-ac73-ab11de6513cb@gfz-potsdam.de>
References: <e45cc197-ab09-04c1-97bb-ed0be2699d73@gfz-potsdam.de>
 <43c4ce21-dbe7-a5ea-ac73-ab11de6513cb@gfz-potsdam.de>
Message-ID: <8e78eb30-6a89-104b-d2c4-f9ea8231aced@gfz-potsdam.de>

Hi!

I am trying to convert image data from cartesian/image coordinates to 
projected coordinates AND vice versa using geolocation arrays in GDAL. I 
have two questions:

 1. Since this transformation is part of a processing chain implemented
    in Python, I try to transform the data directly in-memory, i.e,
    without any disk access. This saves IO time and avoids permission
    errors when trying to write temporary data on Windows. How can this
    be done? I got correct results with the code below, however, only
    when I temporarily write the data to disk. I tried to write the data
    to /vsimem/ using the MEM, GTiff and NUMPY drivers. However,
    gdal.Warp can?t find the data there (FileNotFoundError). I think,
    also the gdal.Transformer class might be useful and I found an
    interesting thread on that here
    <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
    and a related test in the GDAL autotest suite (here
    <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
    However, I can?t get it to work for my specific case.
 2. My second question is how I can invert the transformation, i.e., how
    can I transform an image with projected coordinates back to
    cartesian/image coordinates, given that a geolocation array tells
    GDAL where to put which pixel in the output? Background is a
    processing pipeline for satellite data where some processing steps
    are running in sensor geometry (image data as acquired by the
    sensor, without any geocoding and projection) and I need to provide
    corresponding AUX data which originally come with projected coordinates.

Here is the code I already have to convert a sample image from cartesian 
to projected coordinates:

    import os
    from tempfile import TemporaryDirectory
    from osgeo import gdal, osr
    import numpy as np
    from matplotlib import pyplot as plt


    # get some test data
    swath_data = np.random.randint(1, 100, (500, 400))
    lons, lats = np.meshgrid(np.linspace(3, 5, 500),
     ???????????????????????? np.linspace(40, 42, 400))

    with TemporaryDirectory() as td:
     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
     ??? p_data_tmp = os.path.join(td, 'data.tif')
     ??? p_data_vrt = os.path.join(td, 'data.vrt')
     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')

     ??? # save numpy arrays to temporary tif files
     ??? for arr, path in zip((swath_data, lons, lats), (p_data_tmp,
    p_lons_tmp, p_lats_tmp)):
     ??????? rows, cols = arr.shape
     ??????? drv = gdal.GetDriverByName('GTiff')
     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
     ??????? ds.GetRasterBand(1).WriteArray(arr)
     ??????? del ds

     ??? # add geolocation information to input data
     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
     ??? ds.SetMetadata(

     ??????? dict(
     ??????????? SRS=wgs84_wkt,
     ??????????? X_DATASET=p_lons_tmp,
     ??????????? Y_DATASET=p_lats_tmp,
     ??????????? X_BAND='1',
     ??????????? Y_BAND='1',
     ??????????? PIXEL_OFFSET='0',
     ??????????? LINE_OFFSET='0',
     ??????????? PIXEL_STEP='1',
     ??????????? LINE_STEP='1'
     ??????? ),
     ??????? 'GEOLOCATION'
     ??? )del ds

     ??? # warp from geolocation arrays and read the result
     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT', geoloc=True,
     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()

    # visualize input and output data
    fig, axes = plt.subplots(1, 4)
    for i, (arr, title) in enumerate(zip((swath_data, lons, lats,
    data_mapgeo),
     ????????????????????????????????? ('swath data', 'lons', 'lats',
    'projected data'))):
     ??? axes[i].imshow(arr, cmap='gray')
     ??? axes[i].set_title(title)
    plt.tight_layout()
    plt.show()


Any help would be highly appreciated!

Best,

Daniel Scheffler


-- 

M.Sc. Geogr. Daniel Scheffler

Helmholtz Centre Potsdam
GFZ German Research Centre For Geosciences
Department 1 - Geodesy and Remote Sensing
Section 1.4  - Remote Sensing
Telegrafenberg, 14473 Potsdam, Germany

Phone:  +49 (0)331/288-1198
e-mail:daniel.scheffler at gfz-potsdam.de
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211125/7430bc1f/attachment.html>

From niki.kamp at gmail.com  Fri Nov 26 03:30:55 2021
From: niki.kamp at gmail.com (Nicole Kamp)
Date: Fri, 26 Nov 2021 12:30:55 +0100
Subject: [gdal-dev] GDAL COG - Problem with Overviews
In-Reply-To: <609a938d5fc84949aab35dc888f2dcef@maanmittauslaitos.fi>
References: <609a938d5fc84949aab35dc888f2dcef@maanmittauslaitos.fi>
Message-ID: <CA+YW3aVXP2H9HV_13tiZYPhji-mZNcXFP8Yu-mxr_=sbwbz8Xw@mail.gmail.com>

Thanks a lot,
I was able to solve the problem with gdalinfo.

Nicole Kamp

On Thu, Nov 25, 2021 at 2:37 PM Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Please use ?reply to all? for including the list as a recipient.
>
> More details would lead to less guessing. Please add gdalinfo about the
> source and result (georeferencing is not important), tell how did you get
> the image of the original (which bands were selected, was any color
> enhancement applied). QGIS and a look at Layer properties ? Symbology is
> good for that. Test with gdal_translate before going to Python and send us
> the command if you face the same trouble. If you cannot solve the problem
> yourself send a link to test image. It does not need to be your real image,
> any technically similar image is good and usually even better if you cut it
> smaller. A 200x200 pixel sized piece of the original image without
> georeferencing is one alternative that probably would not reveal secrets.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Nicole Kamp <niki.kamp at gmail.com>
> *L?hetetty:* torstai 25. marraskuuta 2021 15.22
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Aihe:* Re: [gdal-dev] GDAL COG - Problem with Overviews
>
>
>
> Hello!
>
> Thanks. I tried it with 0,1,2 - it did not work.
>
>
>
>
>
> On Thu, Nov 25, 2021 at 1:49 PM Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> Maybe the band list be zero based? Try [0,1,2].
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Nicole
> Kamp
> *L?hetetty:* torstai 25. marraskuuta 2021 14.44
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] GDAL COG - Problem with Overviews
>
>
>
> Dear GDAL Developers,
>
> I have an overview problem with my Cloud Optimized GeoTIFF.
>
> I tried to translate a 16 bit, 4 bands ortho image to a COG 8bit, 3 bands
> image with JPEG compression.
>
>
>
> That is the original image. <https://pasteboard.co/CLur6VdD0CwQ.jpg>
> That is the result. <https://pasteboard.co/MJv3lOjlI8iM.jpg>
>
>
>
> It works fine with LZW compression, but I need the JPEG compression. What
> am I doing wrong?
>
>
>
> Thanks,
>
> Niki
>
>
>
>
>
> Here is my code.
>
>         for raster in glob.glob(str(parameters[self.INPUT_Pfad])+'/*.tif'):
>             fileInfo = QFileInfo(raster)
>             baseName = fileInfo.baseName()
>             file_name =
> str(parameters[self.INPUT_Pfad])+'/'+baseName+'.tif'
>             feedback.pushInfo(file_name)
>             output_file1 =
> str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'.tif'
>             output_file2 =
> str(parameters[self.OUTPUT_Pfad])+'/'+baseName+'_cog.tif'
>
>             # Create COG
>             x_size = 6250
>             y_size = 5000
>             num_bands = 4
>
>             src_ds = gdal.Open(file_name)
>             format = "GTiff"
>             driver = gdal.GetDriverByName(format)
>
>             # Translate
>             translate_options = gdal.TranslateOptions(format = 'COG',
> outputType = gdal.GDT_Byte, bandList =
>                [1,2,3],  scaleParams=[''],
>                                           creationOptions =
> ['TILED=YES','COMPRESS=JPEG','BIGTIFF=IF_NEEDED',
>                             'BLOCKXSIZE=512', 'BLOCKYSIZE=512',
> 'RESAMPLING=NEAREST',
>           'OVERVIEWS=IGNORE_EXISTING', 'INTERLEAVE=PIXEL']
>                                           )
>             gdal.Translate(output_file1, src_ds, options=translate_options)
>
>             translate_options = None
>             src_ds = None
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211126/5ed247c0/attachment.html>

From even.rouault at spatialys.com  Fri Nov 26 03:38:17 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 26 Nov 2021 12:38:17 +0100
Subject: [gdal-dev] Transformation of image data between pixel/line and
 projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <8e78eb30-6a89-104b-d2c4-f9ea8231aced@gfz-potsdam.de>
References: <e45cc197-ab09-04c1-97bb-ed0be2699d73@gfz-potsdam.de>
 <43c4ce21-dbe7-a5ea-ac73-ab11de6513cb@gfz-potsdam.de>
 <8e78eb30-6a89-104b-d2c4-f9ea8231aced@gfz-potsdam.de>
Message-ID: <2c9d72a2-3950-f846-b3e4-ee80500179a1@spatialys.com>

Daniel,
>
> I am trying to convert image data from cartesian/image coordinates to 
> projected coordinates AND vice versa using geolocation arrays in GDAL. 
> I have two questions:
>
>  1. Since this transformation is part of a processing chain
>     implemented in Python, I try to transform the data directly
>     in-memory, i.e, without any disk access. This saves IO time and
>     avoids permission errors when trying to write temporary data on
>     Windows. How can this be done? I got correct results with the code
>     below, however, only when I temporarily write the data to disk. I
>     tried to write the data to /vsimem/ using the MEM, GTiff and NUMPY
>     drivers. However, gdal.Warp can?t find the data there
>     (FileNotFoundError). I think, also the gdal.Transformer class
>     might be useful and I found an interesting thread on that here
>     <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
>     and a related test in the GDAL autotest suite (here
>     <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
>     However, I can?t get it to work for my specific case.
>
There's no reason it won't work with a in-memory dataset.

If you use a MEM dataset, then you need to provide the dataset object 
itself as the input dataset of gdal.Warp() (the name of a MEM dataset is 
completely ignored. a MEM dataset can't be opened, just created).

Similarly with a NUMPY dataset.?? With GTiff and /vsimem/, they behave 
as a regular file. If you pass it by name as input of gdal.Warp(), you 
need to make sure to close (ds = None typically) the dataset before, so 
it is properly flushed and can be opened. But you can also pass it as an 
object without that constraint.

You can also create purely in-memory VRT files by assigning them an 
empty name. Then of course you need to provide them as objects to 
gdal.Warp()


>  1. My second question is how I can invert the transformation, i.e.,
>     how can I transform an image with projected coordinates back to
>     cartesian/image coordinates, given that a geolocation array tells
>     GDAL where to put which pixel in the output? Background is a
>     processing pipeline for satellite data where some processing steps
>     are running in sensor geometry (image data as acquired by the
>     sensor, without any geocoding and projection) and I need to
>     provide corresponding AUX data which originally come with
>     projected coordinates.
>
The logic of GDALCreateGenImgProjTransformer2() around 
https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
which is for the source dataset should be ported a few lines after for 
the target dataset.? Probably with a new transformer option to be able 
to point to an auxiliary dataset, such as a VRT one of your example, to 
extract the geolocation metadata items from it, that would be different 
from the target dataset itself, because, except perhaps for the netCDF 
case, most GDAL datasets that expose a GEOLOCATION metadata domain must 
be read-only.
>
> 1.
>
> Here is the code I already have to convert a sample image from 
> cartesian to projected coordinates:
>
>     import os
>     from tempfile import TemporaryDirectory
>     from osgeo import gdal, osr
>     import numpy as np
>     from matplotlib import pyplot as plt
>
>
>     # get some test data
>     swath_data = np.random.randint(1, 100, (500, 400))
>     lons, lats = np.meshgrid(np.linspace(3, 5, 500),
>     ???????????????????????? np.linspace(40, 42, 400))
>
>     with TemporaryDirectory() as td:
>     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
>     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
>     ??? p_data_tmp = os.path.join(td, 'data.tif')
>     ??? p_data_vrt = os.path.join(td, 'data.vrt')
>     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')
>
>     ??? # save numpy arrays to temporary tif files
>     ??? for arr, path in zip((swath_data, lons, lats), (p_data_tmp,
>     p_lons_tmp, p_lats_tmp)):
>     ??????? rows, cols = arr.shape
>     ??????? drv = gdal.GetDriverByName('GTiff')
>     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
>     ??????? ds.GetRasterBand(1).WriteArray(arr)
>     ??????? del ds
>
>     ??? # add geolocation information to input data
>     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
>     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
>     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
>     ??? ds.SetMetadata(
>
>     ??????? dict(
>     ??????????? SRS=wgs84_wkt,
>     ??????????? X_DATASET=p_lons_tmp,
>     ??????????? Y_DATASET=p_lats_tmp,
>     ??????????? X_BAND='1',
>     ??????????? Y_BAND='1',
>     ??????????? PIXEL_OFFSET='0',
>     ??????????? LINE_OFFSET='0',
>     ??????????? PIXEL_STEP='1',
>     ??????????? LINE_STEP='1'
>     ??????? ),
>     ??????? 'GEOLOCATION'
>     ??? )del ds
>
>     ??? # warp from geolocation arrays and read the result
>     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT',
>     geoloc=True,
>     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
>     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()
>
>     # visualize input and output data
>     fig, axes = plt.subplots(1, 4)
>     for i, (arr, title) in enumerate(zip((swath_data, lons, lats,
>     data_mapgeo),
>     ????????????????????????????????? ('swath data', 'lons', 'lats',
>     'projected data'))):
>     ??? axes[i].imshow(arr, cmap='gray')
>     ??? axes[i].set_title(title)
>     plt.tight_layout()
>     plt.show()
>
>
> Any help would be highly appreciated!
>
> Best,
>
> Daniel Scheffler
>
>
> -- 
>
> M.Sc. Geogr. Daniel Scheffler
>
> Helmholtz Centre Potsdam
> GFZ German Research Centre For Geosciences
> Department 1 - Geodesy and Remote Sensing
> Section 1.4  - Remote Sensing
> Telegrafenberg, 14473 Potsdam, Germany
>
> Phone:  +49 (0)331/288-1198
> e-mail:daniel.scheffler at gfz-potsdam.de
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211126/d4aa8daa/attachment-0001.html>

From robert.coup at koordinates.com  Fri Nov 26 03:53:19 2021
From: robert.coup at koordinates.com (Robert Coup)
Date: Fri, 26 Nov 2021 11:53:19 +0000
Subject: [gdal-dev] GDAL COG - Problem with Overviews
In-Reply-To: <CA+YW3aVXP2H9HV_13tiZYPhji-mZNcXFP8Yu-mxr_=sbwbz8Xw@mail.gmail.com>
References: <609a938d5fc84949aab35dc888f2dcef@maanmittauslaitos.fi>
 <CA+YW3aVXP2H9HV_13tiZYPhji-mZNcXFP8Yu-mxr_=sbwbz8Xw@mail.gmail.com>
Message-ID: <CAFLLRpKUm1XM6LpCY6iqH7KY0S5e0STEU+fwfgWO0Hn29D=Nrg@mail.gmail.com>

Hi Nicole,

On Fri, 26 Nov 2021 at 11:31, Nicole Kamp <niki.kamp at gmail.com> wrote:

> Thanks a lot,
> I was able to solve the problem with gdalinfo.
>

It might be helpful for others who find your message in the future and who
are struggling with a similar problem to hear what your solution was?

https://xkcd.com/979/

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211126/f9957181/attachment.html>

From variablestarlight at gmail.com  Mon Nov 29 02:43:17 2021
From: variablestarlight at gmail.com (=?UTF-8?Q?Hern=c3=a1n_De_Angelis?=)
Date: Mon, 29 Nov 2021 11:43:17 +0100
Subject: [gdal-dev] ogr2ogr and WFS 2
Message-ID: <08cc2c17-b287-42b4-3a1a-51b551d6b98b@gmail.com>

Dear all

I seem to have problems understanding how ogr2ogr interacts with WFS and 
hope someone would be able to clarify.

I have this WFS:

https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?

The capabilities document states that it supports WFS 1.0.0, 1.1.0 and 
2.0.0.

If I do:

ogr2ogr -f GPKG test.gpkg 
"WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100"

I get a small and nice GPKG file very fast.

But if I do:

ogr2ogr -f GPKG test.gpkg 
"WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"

It downloads the whole layer.

This behaviour can be seriously impractical for services exposing a 
large number of features.


Pay attention that if I do:

curl 
"https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"

it retrieves a short document fast with just 100 features. The same of 
course if I invoke the service using WFS 1.0.0 or 1.1.0.


What is going on here? Is it me that I misunderstood something about how 
ogr2ogr is supposed to interact with WFS services?

Using GDAL 3.4.0, released 2021/11/04. But the same behaviour was 
observed in 3.3.2.


Thanks in advance for any clarification


Hern?n


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211129/345fc083/attachment.html>

From even.rouault at spatialys.com  Mon Nov 29 04:11:34 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Nov 2021 13:11:34 +0100
Subject: [gdal-dev] ogr2ogr and WFS 2
In-Reply-To: <08cc2c17-b287-42b4-3a1a-51b551d6b98b@gmail.com>
References: <08cc2c17-b287-42b4-3a1a-51b551d6b98b@gmail.com>
Message-ID: <327393d5-2794-6ff3-d202-f74236608072@spatialys.com>

Hern?n,

The URL you specify in the WFS: connection string isn't in general the 
one of a GetFeature request, but only the endpoint of the service. When 
you specify a GetFeature request, some heuristics trigger, but in WFS 2, 
the COUNT parameter is interpreted as the page size, but as this server 
supports paging, it is actually overridden by the page size returned by 
the server (this part is a bug, addressed per 
https://github.com/OSGeo/gdal/pull/4914), and anyway whatever the page 
size used, it scrolls by default through the results.

If you add? --config OGR_WFS_PAGING_ALLOWED NO you'll get the behavior 
you expect. The above mentioned pull request also clarifies this hopefully.

Even

Le 29/11/2021 ? 11:43, Hern?n De Angelis a ?crit?:
> Dear all
>
> I seem to have problems understanding how ogr2ogr interacts with WFS 
> and hope someone would be able to clarify.
>
> I have this WFS:
>
> https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?
>
> The capabilities document states that it supports WFS 1.0.0, 1.1.0 and 
> 2.0.0.
>
> If I do:
>
> ogr2ogr -f GPKG test.gpkg 
> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100"
>
> I get a small and nice GPKG file very fast.
>
> But if I do:
>
> ogr2ogr -f GPKG test.gpkg 
> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"
>
> It downloads the whole layer.
>
> This behaviour can be seriously impractical for services exposing a 
> large number of features.
>
>
> Pay attention that if I do:
>
> curl 
> "https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"
>
> it retrieves a short document fast with just 100 features. The same of 
> course if I invoke the service using WFS 1.0.0 or 1.1.0.
>
>
> What is going on here? Is it me that I misunderstood something about 
> how ogr2ogr is supposed to interact with WFS services?
>
> Using GDAL 3.4.0, released 2021/11/04. But the same behaviour was 
> observed in 3.3.2.
>
>
> Thanks in advance for any clarification
>
>
> Hern?n
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211129/688a3462/attachment.html>

From variablestarlight at gmail.com  Mon Nov 29 04:25:22 2021
From: variablestarlight at gmail.com (=?UTF-8?Q?Hern=c3=a1n_De_Angelis?=)
Date: Mon, 29 Nov 2021 13:25:22 +0100
Subject: [gdal-dev] ogr2ogr and WFS 2
In-Reply-To: <327393d5-2794-6ff3-d202-f74236608072@spatialys.com>
References: <08cc2c17-b287-42b4-3a1a-51b551d6b98b@gmail.com>
 <327393d5-2794-6ff3-d202-f74236608072@spatialys.com>
Message-ID: <c456241d-11fb-39b2-8e87-da0040f22ce2@gmail.com>

Thank you for the clarification, Even. Now I understand how this works. 
I also think the pull request will help to make ogr2ogr behave more as 
is intuitively expected.

Have a nice day!

Hern?n


Den 2021-11-29 kl. 13:11, skrev Even Rouault:
>
> Hern?n,
>
> The URL you specify in the WFS: connection string isn't in general the 
> one of a GetFeature request, but only the endpoint of the service. 
> When you specify a GetFeature request, some heuristics trigger, but in 
> WFS 2, the COUNT parameter is interpreted as the page size, but as 
> this server supports paging, it is actually overridden by the page 
> size returned by the server (this part is a bug, addressed per 
> https://github.com/OSGeo/gdal/pull/4914), and anyway whatever the page 
> size used, it scrolls by default through the results.
>
> If you add? --config OGR_WFS_PAGING_ALLOWED NO you'll get the behavior 
> you expect. The above mentioned pull request also clarifies this 
> hopefully.
>
> Even
>
> Le 29/11/2021 ? 11:43, Hern?n De Angelis a ?crit?:
>> Dear all
>>
>> I seem to have problems understanding how ogr2ogr interacts with WFS 
>> and hope someone would be able to clarify.
>>
>> I have this WFS:
>>
>> https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?
>>
>> The capabilities document states that it supports WFS 1.0.0, 1.1.0 
>> and 2.0.0.
>>
>> If I do:
>>
>> ogr2ogr -f GPKG test.gpkg 
>> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100"
>>
>> I get a small and nice GPKG file very fast.
>>
>> But if I do:
>>
>> ogr2ogr -f GPKG test.gpkg 
>> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"
>>
>> It downloads the whole layer.
>>
>> This behaviour can be seriously impractical for services exposing a 
>> large number of features.
>>
>>
>> Pay attention that if I do:
>>
>> curl 
>> "https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"
>>
>> it retrieves a short document fast with just 100 features. The same 
>> of course if I invoke the service using WFS 1.0.0 or 1.1.0.
>>
>>
>> What is going on here? Is it me that I misunderstood something about 
>> how ogr2ogr is supposed to interact with WFS services?
>>
>> Using GDAL 3.4.0, released 2021/11/04. But the same behaviour was 
>> observed in 3.3.2.
>>
>>
>> Thanks in advance for any clarification
>>
>>
>> Hern?n
>>
>>
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211129/c07e35cf/attachment-0001.html>

From matteo.ghetta at gmail.com  Mon Nov 29 08:51:47 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Mon, 29 Nov 2021 17:51:47 +0100
Subject: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)
Message-ID: <0fc90f84-be0f-7425-5009-662974ac23f3@gmail.com>

Hi all,

I'm trying to run a command with the GdalUtils.runGdal utility of QGIS 
but I get some troubles because of the encoding.

Basically I need to set the encoding to PGCLIENTENCODING=LATIN1. If I 
call it in a console, no problem at all (of course :) ). Wondering if I 
can set the encoding also within QGIS (that is basically via the ogr2ogr 
command).

I know that this is a more QGIS question, but QGIS is calling ogr2ogr, 
so I think if there is a ogr2ogr way to do that then also within QGIS 
should be possible.

Cheers and thanks for any ideas!

Matteo

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 29 12:02:02 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 29 Nov 2021 20:02:02 +0000
Subject: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)
Message-ID: <e52a25dc7a7a4607b8c44f403582db54@maanmittauslaitos.fi>

Hi,

There is some text about client encoding in https://gdal.org/drivers/vector/pg.html

" By default it is assumed that text being sent to Postgres is in the UTF-8 encoding. This is fine for plain ASCII, but can result in errors for extended characters (ASCII 155+, LATIN1, etc). While OGR provides no direct control over this, you can set the PGCLIENTENCODING environment variable to indicate the format being provided. For instance, if your text is LATIN1 you could set the environment variable to LATIN1 before using OGR and input would be assumed to be LATIN1 instead of UTF-8. An alternate way of setting the client encoding is to issue the following SQL command with ExecuteSQL() : "SET client_encoding TO encoding_name" where encoding_name is LATIN1, etc. Errors can be caught by enclosing this command with a CPLPushErrorHandler()/CPLPopErrorHandler() pair."

I would try with that environmental variable first.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta matteo
L?hetetty: maanantai 29. marraskuuta 2021 18.52
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)

Hi all,

I'm trying to run a command with the GdalUtils.runGdal utility of QGIS but I get some troubles because of the encoding.

Basically I need to set the encoding to PGCLIENTENCODING=LATIN1. If I call it in a console, no problem at all (of course :) ). Wondering if I can set the encoding also within QGIS (that is basically via the ogr2ogr command).

I know that this is a more QGIS question, but QGIS is calling ogr2ogr, so I think if there is a ogr2ogr way to do that then also within QGIS should be possible.

Cheers and thanks for any ideas!

Matteo
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Mon Nov 29 12:33:56 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 29 Nov 2021 21:33:56 +0100
Subject: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)
In-Reply-To: <e52a25dc7a7a4607b8c44f403582db54@maanmittauslaitos.fi>
References: <e52a25dc7a7a4607b8c44f403582db54@maanmittauslaitos.fi>
Message-ID: <68efefcf-ebb9-2429-aac6-7138d9489897@spatialys.com>

Hi,
> I would try with that environmental variable first.

The thing is that there's no way in the vector format conversion tool of 
QGIS to specify pure environment variables (GDAL configuration options 
can be passed with --config key value, but PGCLIENTENCODING can't be 
specify that way). However it is possible to use the PRELUDE_STATEMENTS 
open option of the PostgreSQL driver, by adding (a bit abusively) in the 
additional creation option entry box: ? -oo PRELUDE_STATEMENTS="SET 
client_encoding TO LATIN1"? (assuming that the need is to convert from 
PostgreSQL. )

Even

>
> -Jukka Rahkonen-
>
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta matteo
> L?hetetty: maanantai 29. marraskuuta 2021 18.52
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)
>
> Hi all,
>
> I'm trying to run a command with the GdalUtils.runGdal utility of QGIS but I get some troubles because of the encoding.
>
> Basically I need to set the encoding to PGCLIENTENCODING=LATIN1. If I call it in a console, no problem at all (of course :) ). Wondering if I can set the encoding also within QGIS (that is basically via the ogr2ogr command).
>
> I know that this is a more QGIS question, but QGIS is calling ogr2ogr, so I think if there is a ogr2ogr way to do that then also within QGIS should be possible.
>
> Cheers and thanks for any ideas!
>
> Matteo
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sowon at postech.ac.kr  Mon Nov 29 18:21:39 2021
From: sowon at postech.ac.kr (=?ks_c_5601-1987?B?udq80r/4?=)
Date: Tue, 30 Nov 2021 02:21:39 +0000
Subject: [gdal-dev] [ mailing list ]
Message-ID: <SLXP216MB10495C292C7AC17742236601FD679@SLXP216MB1049.KORP216.PROD.OUTLOOK.COM>

Dear sir,

Could you please take me off mailing list?

Best,
sowon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/69147b1a/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 29 23:04:05 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 30 Nov 2021 07:04:05 +0000
Subject: [gdal-dev] Should we make also GTiff to use TILED=YES as default?
Message-ID: <075fa74196b54984ac016cf08e3c55de@maanmittauslaitos.fi>

Hi,

There are loads of questions in the stack.exchange site where users have problems with performance when they do something with reading and writing very large image files. Big files have obviously become much more common now due to clouds. Users try to solve the problem by increasing GDAL_CACHEMAX and using multithreading etc. but they use the default GeoTIFF settings and keep on writing huge striped TIFFs. I wonder if we should make tiling the default also for the GTiff driver like it is in the COG driver.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/7fdbdf7a/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Nov 29 23:59:33 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 30 Nov 2021 07:59:33 +0000
Subject: [gdal-dev] ogr2ogr and WFS 2
Message-ID: <a69102cf67d048f4aa7daf3ab5816b2e@maanmittauslaitos.fi>

Hi,

There is something about WFS 2 and paging in https://gdal.org/drivers/vector/wfs.html

?Paging with WFS 2.0?
The WFS driver will automatically detect if server supports paging, when requesting a WFS 2.0 server. The page size (number of features fetched in a single request) is limited to 100 by default when not declared by the server. It can be changed by setting the OGR_WFS_PAGE_SIZE configuration option, or by specifying COUNT as a query parameter in the URL of the connection string.

If only the N first features must be downloaded and paging through the whole layer is not desirable, the OGR_WFS_PAGING_ALLOWED configuration option should be set to OFF.?

So by default normally GDAL goes to paging mode that makes it possible to read the whole featuretype, possibly restricted with BBOX or other filters but it should be possible to disable paging with --config OGR_WFS_PAGING_ALLOWED OFF. I would try that.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Hern?n De Angelis
L?hetetty: maanantai 29. marraskuuta 2021 12.43
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ogr2ogr and WFS 2

Dear all

I seem to have problems understanding how ogr2ogr interacts with WFS and hope someone would be able to clarify.

I have this WFS:

https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?

The capabilities document states that it supports WFS 1.0.0, 1.1.0 and 2.0.0.

If I do:

ogr2ogr -f GPKG test.gpkg "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100"

I get a small and nice GPKG file very fast.

But if I do:

ogr2ogr -f GPKG test.gpkg "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"

It downloads the whole layer.

This behaviour can be seriously impractical for services exposing a large number of features.


Pay attention that if I do:

curl "https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100"<https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100>

it retrieves a short document fast with just 100 features. The same of course if I invoke the service using WFS 1.0.0 or 1.1.0.


What is going on here? Is it me that I misunderstood something about how ogr2ogr is supposed to interact with WFS services?

Using GDAL 3.4.0, released 2021/11/04. But the same behaviour was observed in 3.3.2.


Thanks in advance for any clarification


Hern?n


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/e5b092b8/attachment-0001.html>

From variablestarlight at gmail.com  Tue Nov 30 00:34:15 2021
From: variablestarlight at gmail.com (=?UTF-8?Q?Hern=c3=a1n_De_Angelis?=)
Date: Tue, 30 Nov 2021 09:34:15 +0100
Subject: [gdal-dev] ogr2ogr and WFS 2
In-Reply-To: <a69102cf67d048f4aa7daf3ab5816b2e@maanmittauslaitos.fi>
References: <a69102cf67d048f4aa7daf3ab5816b2e@maanmittauslaitos.fi>
Message-ID: <d9f363b8-6579-f28e-3c6f-a88065d0db9e@gmail.com>

Thank you, Jukka. I did that and worked. I also had another case where 
it is important to get this right. It is when the total number of 
features exposed by the service exceeds the maximum number of features 
allowed to be fetched in one request (CountDefault). In this case it is 
also important to set the paging to NO, in addition with an adequate 
OGR_WFS_PAGE_SIZE so that the layer can be downloaded entirely, in 
several pages, without hitting the limit.

Best

Hern?n


Den 2021-11-30 kl. 08:59, skrev Rahkonen Jukka (MML):
>
> Hi,
>
> There is something about WFS 2 and paging in 
> https://gdal.org/drivers/vector/wfs.html
>
> ?Paging with WFS 2.0?
>
> The WFS driver will automatically detect if server supports paging, 
> when requesting a WFS 2.0 server. The page size (number of features 
> fetched in a single request) is limited to 100 by default when not 
> declared by the server. It can be changed by setting the 
> OGR_WFS_PAGE_SIZE configuration option, or by specifying COUNT as a 
> query parameter in the URL of the connection string.
>
> If only the N first features must be downloaded and paging through the 
> whole layer is not desirable, the OGR_WFS_PAGING_ALLOWED configuration 
> option should be set to OFF.?
>
> So by default normally GDAL goes to paging mode that makes it possible 
> to read the whole featuretype, possibly restricted with BBOX or other 
> filters but it should be possible to disable paging with --config 
> OGR_WFS_PAGING_ALLOWED OFF. I would try that.
>
> -Jukka Rahkonen-
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Hern?n De Angelis
> *L?hetetty:* maanantai 29. marraskuuta 2021 12.43
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] ogr2ogr and WFS 2
>
> Dear all
>
> I seem to have problems understanding how ogr2ogr interacts with WFS 
> and hope someone would be able to clarify.
>
> I have this WFS:
>
> https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?
>
> The capabilities document states that it supports WFS 1.0.0, 1.1.0 and 
> 2.0.0.
>
> If I do:
>
> ogr2ogr -f GPKG test.gpkg 
> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100 
> <https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100>"
>
> I get a small and nice GPKG file very fast.
>
> But if I do:
>
> ogr2ogr -f GPKG test.gpkg 
> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100 
> <https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100>"
>
> It downloads the whole layer.
>
> This behaviour can be seriously impractical for services exposing a 
> large number of features.
>
>
> Pay attention that if I do:
>
> curl 
> "https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100" 
> <https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100>
>
> it retrieves a short document fast with just 100 features. The same of 
> course if I invoke the service using WFS 1.0.0 or 1.1.0.
>
>
> What is going on here? Is it me that I misunderstood something about 
> how ogr2ogr is supposed to interact with WFS services?
>
> Using GDAL 3.4.0, released 2021/11/04. But the same behaviour was 
> observed in 3.3.2.
>
>
> Thanks in advance for any clarification
>
>
> Hern?n
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/56f93124/attachment.html>

From variablestarlight at gmail.com  Tue Nov 30 00:54:03 2021
From: variablestarlight at gmail.com (=?UTF-8?Q?Hern=c3=a1n_De_Angelis?=)
Date: Tue, 30 Nov 2021 09:54:03 +0100
Subject: [gdal-dev] ogr2ogr and WFS 2
In-Reply-To: <d9f363b8-6579-f28e-3c6f-a88065d0db9e@gmail.com>
References: <a69102cf67d048f4aa7daf3ab5816b2e@maanmittauslaitos.fi>
 <d9f363b8-6579-f28e-3c6f-a88065d0db9e@gmail.com>
Message-ID: <0203441f-93f9-5473-043b-f9dd2b6a41a9@gmail.com>

Sorry, in the message below I meant one needs to explicitly specify 
OGR_WFS_PAGING_ALLOWED YES, with a suitable OGR_WFS_PAGE_SIZE.



Den 2021-11-30 kl. 09:34, skrev Hern?n De Angelis:
> Thank you, Jukka. I did that and worked. I also had another case where 
> it is important to get this right. It is when the total number of 
> features exposed by the service exceeds the maximum number of features 
> allowed to be fetched in one request (CountDefault). In this case it 
> is also important to set the paging to NO, in addition with an 
> adequate OGR_WFS_PAGE_SIZE so that the layer can be downloaded 
> entirely, in several pages, without hitting the limit.
>
> Best
>
> Hern?n
>
>
> Den 2021-11-30 kl. 08:59, skrev Rahkonen Jukka (MML):
>>
>> Hi,
>>
>> There is something about WFS 2 and paging in 
>> https://gdal.org/drivers/vector/wfs.html
>>
>> ?Paging with WFS 2.0?
>>
>> The WFS driver will automatically detect if server supports paging, 
>> when requesting a WFS 2.0 server. The page size (number of features 
>> fetched in a single request) is limited to 100 by default when not 
>> declared by the server. It can be changed by setting the 
>> OGR_WFS_PAGE_SIZE configuration option, or by specifying COUNT as a 
>> query parameter in the URL of the connection string.
>>
>> If only the N first features must be downloaded and paging through 
>> the whole layer is not desirable, the OGR_WFS_PAGING_ALLOWED 
>> configuration option should be set to OFF.?
>>
>> So by default normally GDAL goes to paging mode that makes it 
>> possible to read the whole featuretype, possibly restricted with BBOX 
>> or other filters but it should be possible to disable paging with 
>> --config OGR_WFS_PAGING_ALLOWED OFF. I would try that.
>>
>> -Jukka Rahkonen-
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
>> *Hern?n De Angelis
>> *L?hetetty:* maanantai 29. marraskuuta 2021 12.43
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Aihe:* [gdal-dev] ogr2ogr and WFS 2
>>
>> Dear all
>>
>> I seem to have problems understanding how ogr2ogr interacts with WFS 
>> and hope someone would be able to clarify.
>>
>> I have this WFS:
>>
>> https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?
>>
>> The capabilities document states that it supports WFS 1.0.0, 1.1.0 
>> and 2.0.0.
>>
>> If I do:
>>
>> ogr2ogr -f GPKG test.gpkg 
>> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100 
>> <https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=stationsregistret:active_site&MAXFEATURES=100>"
>>
>> I get a small and nice GPKG file very fast.
>>
>> But if I do:
>>
>> ogr2ogr -f GPKG test.gpkg 
>> "WFS:https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100 
>> <https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100>"
>>
>> It downloads the whole layer.
>>
>> This behaviour can be seriously impractical for services exposing a 
>> large number of features.
>>
>>
>> Pay attention that if I do:
>>
>> curl 
>> "https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100" 
>> <https://stationsregister.miljodatasamverkan.se/geoserver/stationsregistret/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=stationsregistret:active_site&COUNT=100>
>>
>> it retrieves a short document fast with just 100 features. The same 
>> of course if I invoke the service using WFS 1.0.0 or 1.1.0.
>>
>>
>> What is going on here? Is it me that I misunderstood something about 
>> how ogr2ogr is supposed to interact with WFS services?
>>
>> Using GDAL 3.4.0, released 2021/11/04. But the same behaviour was 
>> observed in 3.3.2.
>>
>>
>> Thanks in advance for any clarification
>>
>>
>> Hern?n
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/a9a8b896/attachment-0001.html>

From j1 at jimenezshaw.com  Tue Nov 30 01:08:53 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 30 Nov 2021 10:08:53 +0100
Subject: [gdal-dev] Should we make also GTiff to use TILED=YES as
 default?
In-Reply-To: <075fa74196b54984ac016cf08e3c55de@maanmittauslaitos.fi>
References: <075fa74196b54984ac016cf08e3c55de@maanmittauslaitos.fi>
Message-ID: <CADRrdKvKnTMru+Ubgcix2rw+ji3KjcSTUjY9nTYrVZe=csPyvA@mail.gmail.com>

Hi Jukka

I don't think it is a good option.
TL;DR: tiled without overviews is extremely slow for a global view.

If you have a (big) image with TILED=YES but without overviews, it is
really really slow in QGIS (from seconds to many minutes).
The reason (I guess) is that QGIS is by default sub-sampling the image
using nearest neighbor. If the image is not tiled, then it has to read only
every nth line. However, when tiled, at the end has to read the full image
from file.
The bigger the zoom level, the faster it goes. But waiting 5 minutes to see
the global view of your image to know where to zoom in... you close QGIS
and blame somebody.

That changes dramatically if there are (proper) overviews available, of
course.

Cheers
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Tue, 30 Nov 2021 at 08:04, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> There are loads of questions in the stack.exchange site where users have
> problems with performance when they do something with reading and writing
> very large image files. Big files have obviously become much more common
> now due to clouds. Users try to solve the problem by increasing
> GDAL_CACHEMAX and using multithreading etc. but they use the default
> GeoTIFF settings and keep on writing huge striped TIFFs. I wonder if we
> should make tiling the default also for the GTiff driver like it is in the
> COG driver.
>
>
>
> -Jukka Rahkonen-
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/d6421343/attachment.html>

From mateusz at loskot.net  Tue Nov 30 01:23:43 2021
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 30 Nov 2021 10:23:43 +0100
Subject: [gdal-dev] [ mailing list ]
In-Reply-To: <SLXP216MB10495C292C7AC17742236601FD679@SLXP216MB1049.KORP216.PROD.OUTLOOK.COM>
References: <SLXP216MB10495C292C7AC17742236601FD679@SLXP216MB1049.KORP216.PROD.OUTLOOK.COM>
Message-ID: <CABUeae9+pC3UuB9yd26QDw9PhL+L+fZv4z=F0Uopgf1VMFZP1Q@mail.gmail.com>

On Tue, 30 Nov 2021 at 03:21, ??? <sowon at postech.ac.kr> wrote:
>
> Dear sir,
>
> Could you please take me off mailing list?

Go to https://lists.osgeo.org/mailman/listinfo/gdal-dev
Scroll to the bottom and follow the instructions starting
with "To unsubscribe from gdal-dev,..."

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From matteo.ghetta at gmail.com  Tue Nov 30 03:05:28 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 30 Nov 2021 12:05:28 +0100
Subject: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)
In-Reply-To: <68efefcf-ebb9-2429-aac6-7138d9489897@spatialys.com>
References: <e52a25dc7a7a4607b8c44f403582db54@maanmittauslaitos.fi>
 <68efefcf-ebb9-2429-aac6-7138d9489897@spatialys.com>
Message-ID: <f99521db-d923-bf7d-5cb5-6e8b8cc6e5c5@gmail.com>

Hi Rahkonen and Even,

thanks for the answers. If I add -oo PRELUDE_STATEMENTS="SET 
client_encoding TO LATIN1" the I get this error:

Warning 6: driver ESRI Shapefile does not support open option 
PRELUDE_STATEMENTS

and I think it that makes sense because I want to put in a UTF8 DB some 
LATIN1 shapefiles.

BTW: the shapefiles have been created with ogr2ogr from within QGIS (on 
a Linux computer), opened and edited on QGIS on Windows machines.

Other ideas are more than welcome!

Cheers!

Matteo

From daniel.scheffler at gfz-potsdam.de  Tue Nov 30 03:52:17 2021
From: daniel.scheffler at gfz-potsdam.de (Daniel Scheffler)
Date: Tue, 30 Nov 2021 12:52:17 +0100
Subject: [gdal-dev] Fwd: Transformation of image data between pixel/line and
 projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <77c9bbc0-b502-afe1-f7e0-37da24909829@gfz-potsdam.de>
References: <77c9bbc0-b502-afe1-f7e0-37da24909829@gfz-potsdam.de>
Message-ID: <c2cf3a49-200b-91a6-dd81-1b3059859558@gfz-potsdam.de>

Thanks a lot for taking the time, Even, I got the transformation from 
cartesian to projected coordinates to work in memory with the GTiff 
driver. With MEM, NUMPY or VRT it does not work because these formats 
are either not readable from /vsimem/ or don?t have a regular file path 
which is needed to set the X_DATASET and Y_DATASET keys in the 
GEOLOCATION metadata.

Regarding the inversion of this transformation, i.e., from projected 
coordinates to pixel/line:
> The logic of GDALCreateGenImgProjTransformer2() around 
> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
> which is for the source dataset should be ported a few lines after for 
> the target dataset.? Probably with a new transformer option to be able 
> to point to an auxiliary dataset, such as a VRT one of your example, 
> to extract the geolocation metadata items from it, that would be 
> different from the target dataset itself, because, except perhaps for 
> the netCDF case, most GDAL datasets that expose a GEOLOCATION metadata 
> domain must be read-only.

I don?t completely get what you mean here. To me, this sounds like there 
might be a way to do the inverted transformation using the C-API of 
GDAL. However, I am a Python developer and my C skills are a bit poor. 
Is there any way to use the Python bindings here?

Kind regards,
Daniel




Am 26.11.2021 um 12:38 schrieb Even Rouault:
> Daniel,
>>
>> I am trying to convert image data from cartesian/image coordinates to 
>> projected coordinates AND vice versa using geolocation arrays in 
>> GDAL. I have two questions:
>>
>>  1. Since this transformation is part of a processing chain
>>     implemented in Python, I try to transform the data directly
>>     in-memory, i.e, without any disk access. This saves IO time and
>>     avoids permission errors when trying to write temporary data on
>>     Windows. How can this be done? I got correct results with the
>>     code below, however, only when I temporarily write the data to
>>     disk. I tried to write the data to /vsimem/ using the MEM, GTiff
>>     and NUMPY drivers. However, gdal.Warp can?t find the data there
>>     (FileNotFoundError). I think, also the gdal.Transformer class
>>     might be useful and I found an interesting thread on that here
>>     <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
>>     and a related test in the GDAL autotest suite (here
>>     <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
>>     However, I can?t get it to work for my specific case.
>>
> There's no reason it won't work with a in-memory dataset.
>
> If you use a MEM dataset, then you need to provide the dataset object 
> itself as the input dataset of gdal.Warp() (the name of a MEM dataset 
> is completely ignored. a MEM dataset can't be opened, just created).
>
> Similarly with a NUMPY dataset.?? With GTiff and /vsimem/, they behave 
> as a regular file. If you pass it by name as input of gdal.Warp(), you 
> need to make sure to close (ds = None typically) the dataset before, 
> so it is properly flushed and can be opened. But you can also pass it 
> as an object without that constraint.
>
> You can also create purely in-memory VRT files by assigning them an 
> empty name. Then of course you need to provide them as objects to 
> gdal.Warp()
>
>
>>  1. My second question is how I can invert the transformation, i.e.,
>>     how can I transform an image with projected coordinates back to
>>     cartesian/image coordinates, given that a geolocation array tells
>>     GDAL where to put which pixel in the output? Background is a
>>     processing pipeline for satellite data where some processing
>>     steps are running in sensor geometry (image data as acquired by
>>     the sensor, without any geocoding and projection) and I need to
>>     provide corresponding AUX data which originally come with
>>     projected coordinates.
>>
> The logic of GDALCreateGenImgProjTransformer2() around 
> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
> which is for the source dataset should be ported a few lines after for 
> the target dataset.? Probably with a new transformer option to be able 
> to point to an auxiliary dataset, such as a VRT one of your example, 
> to extract the geolocation metadata items from it, that would be 
> different from the target dataset itself, because, except perhaps for 
> the netCDF case, most GDAL datasets that expose a GEOLOCATION metadata 
> domain must be read-only.
>>
>> 1.
>>
>>
>> Here is the code I already have to convert a sample image from 
>> cartesian to projected coordinates:
>>
>>     import os
>>     from tempfile import TemporaryDirectory
>>     from osgeo import gdal, osr
>>     import numpy as np
>>     from matplotlib import pyplot as plt
>>
>>
>>     # get some test data
>>     swath_data = np.random.randint(1, 100, (500, 400))
>>     lons, lats = np.meshgrid(np.linspace(3, 5, 500),
>>     ???????????????????????? np.linspace(40, 42, 400))
>>
>>     with TemporaryDirectory() as td:
>>     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
>>     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
>>     ??? p_data_tmp = os.path.join(td, 'data.tif')
>>     ??? p_data_vrt = os.path.join(td, 'data.vrt')
>>     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')
>>
>>     ??? # save numpy arrays to temporary tif files
>>     ??? for arr, path in zip((swath_data, lons, lats), (p_data_tmp,
>>     p_lons_tmp, p_lats_tmp)):
>>     ??????? rows, cols = arr.shape
>>     ??????? drv = gdal.GetDriverByName('GTiff')
>>     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
>>     ??????? ds.GetRasterBand(1).WriteArray(arr)
>>     ??????? del ds
>>
>>     ??? # add geolocation information to input data
>>     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
>>     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
>>     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
>>     ??? ds.SetMetadata(
>>
>>     ??????? dict(
>>     ??????????? SRS=wgs84_wkt,
>>     ??????????? X_DATASET=p_lons_tmp,
>>     ??????????? Y_DATASET=p_lats_tmp,
>>     ??????????? X_BAND='1',
>>     ??????????? Y_BAND='1',
>>     ??????????? PIXEL_OFFSET='0',
>>     ??????????? LINE_OFFSET='0',
>>     ??????????? PIXEL_STEP='1',
>>     ??????????? LINE_STEP='1'
>>     ??????? ),
>>     ??????? 'GEOLOCATION'
>>     ??? )del ds
>>
>>     ??? # warp from geolocation arrays and read the result
>>     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT',
>>     geoloc=True,
>>     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
>>     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()
>>
>>     # visualize input and output data
>>     fig, axes = plt.subplots(1, 4)
>>     for i, (arr, title) in enumerate(zip((swath_data, lons, lats,
>>     data_mapgeo),
>>     ????????????????????????????????? ('swath data', 'lons', 'lats',
>>     'projected data'))):
>>     ??? axes[i].imshow(arr, cmap='gray')
>>     ??? axes[i].set_title(title)
>>     plt.tight_layout()
>>     plt.show()
>>
>>
>> Any help would be highly appreciated!
>>
>> Best,
>>
>> Daniel Scheffler
>>
>>
>> -- 
>>
>> M.Sc. Geogr. Daniel Scheffler
>>
>> Helmholtz Centre Potsdam
>> GFZ German Research Centre For Geosciences
>> Department 1 - Geodesy and Remote Sensing
>> Section 1.4  - Remote Sensing
>> Telegrafenberg, 14473 Potsdam, Germany
>>
>> Phone:  +49 (0)331/288-1198
>> e-mail:daniel.scheffler at gfz-potsdam.de
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 

M.Sc. Geogr. Daniel Scheffler

Helmholtz Centre Potsdam
GFZ German Research Centre For Geosciences
Department 1 - Geodesy and Remote Sensing
Section 1.4  - Remote Sensing
Telegrafenberg, 14473 Potsdam, Germany

Phone:  +49 (0)331/288-1198
e-mail:daniel.scheffler at gfz-potsdam.de
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/745c22eb/attachment-0001.html>

From even.rouault at spatialys.com  Tue Nov 30 05:02:51 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 Nov 2021 14:02:51 +0100
Subject: [gdal-dev] Fwd: Transformation of image data between pixel/line
 and projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <c2cf3a49-200b-91a6-dd81-1b3059859558@gfz-potsdam.de>
References: <77c9bbc0-b502-afe1-f7e0-37da24909829@gfz-potsdam.de>
 <c2cf3a49-200b-91a6-dd81-1b3059859558@gfz-potsdam.de>
Message-ID: <1791a553-3e0e-f5e6-659d-11ac6f708ab3@spatialys.com>


Le 30/11/2021 ? 12:52, Daniel Scheffler a ?crit?:
> Thanks a lot for taking the time, Even, I got the transformation from 
> cartesian to projected coordinates to work in memory with the GTiff 
> driver. With MEM, NUMPY or VRT it does not work because these formats 
> are either not readable from /vsimem/ or don?t have a regular file 
> path which is needed to set the X_DATASET and Y_DATASET keys in the 
> GEOLOCATION metadata.
Ah indeed for X_DATASET/Y_DATASET, you can't use a MEM or NUMPY dataset. 
But a /vsimem/xxx dataset in another format should work.
>
> Regarding the inversion of this transformation, i.e., from projected 
> coordinates to pixel/line:
>> The logic of GDALCreateGenImgProjTransformer2() around 
>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>> which is for the source dataset should be ported a few lines after 
>> for the target dataset.? Probably with a new transformer option to be 
>> able to point to an auxiliary dataset, such as a VRT one of your 
>> example, to extract the geolocation metadata items from it, that 
>> would be different from the target dataset itself, because, except 
>> perhaps for the netCDF case, most GDAL datasets that expose a 
>> GEOLOCATION metadata domain must be read-only.
>
> I don?t completely get what you mean here. To me, this sounds like 
> there might be a way to do the inverted transformation using the C-API 
> of GDAL.
No, I meant there's some missing code to do that.
> However, I am a Python developer and my C skills are a bit poor. Is 
> there any way to use the Python bindings here?
>
> Kind regards,
> Daniel
>
>
>
>
> Am 26.11.2021 um 12:38 schrieb Even Rouault:
>> Daniel,
>>>
>>> I am trying to convert image data from cartesian/image coordinates 
>>> to projected coordinates AND vice versa using geolocation arrays in 
>>> GDAL. I have two questions:
>>>
>>>  1. Since this transformation is part of a processing chain
>>>     implemented in Python, I try to transform the data directly
>>>     in-memory, i.e, without any disk access. This saves IO time and
>>>     avoids permission errors when trying to write temporary data on
>>>     Windows. How can this be done? I got correct results with the
>>>     code below, however, only when I temporarily write the data to
>>>     disk. I tried to write the data to /vsimem/ using the MEM, GTiff
>>>     and NUMPY drivers. However, gdal.Warp can?t find the data there
>>>     (FileNotFoundError). I think, also the gdal.Transformer class
>>>     might be useful and I found an interesting thread on that here
>>>     <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
>>>     and a related test in the GDAL autotest suite (here
>>>     <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
>>>     However, I can?t get it to work for my specific case.
>>>
>> There's no reason it won't work with a in-memory dataset.
>>
>> If you use a MEM dataset, then you need to provide the dataset object 
>> itself as the input dataset of gdal.Warp() (the name of a MEM dataset 
>> is completely ignored. a MEM dataset can't be opened, just created).
>>
>> Similarly with a NUMPY dataset.?? With GTiff and /vsimem/, they 
>> behave as a regular file. If you pass it by name as input of 
>> gdal.Warp(), you need to make sure to close (ds = None typically) the 
>> dataset before, so it is properly flushed and can be opened. But you 
>> can also pass it as an object without that constraint.
>>
>> You can also create purely in-memory VRT files by assigning them an 
>> empty name. Then of course you need to provide them as objects to 
>> gdal.Warp()
>>
>>
>>>  1. My second question is how I can invert the transformation, i.e.,
>>>     how can I transform an image with projected coordinates back to
>>>     cartesian/image coordinates, given that a geolocation array
>>>     tells GDAL where to put which pixel in the output? Background is
>>>     a processing pipeline for satellite data where some processing
>>>     steps are running in sensor geometry (image data as acquired by
>>>     the sensor, without any geocoding and projection) and I need to
>>>     provide corresponding AUX data which originally come with
>>>     projected coordinates.
>>>
>> The logic of GDALCreateGenImgProjTransformer2() around 
>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>> which is for the source dataset should be ported a few lines after 
>> for the target dataset.? Probably with a new transformer option to be 
>> able to point to an auxiliary dataset, such as a VRT one of your 
>> example, to extract the geolocation metadata items from it, that 
>> would be different from the target dataset itself, because, except 
>> perhaps for the netCDF case, most GDAL datasets that expose a 
>> GEOLOCATION metadata domain must be read-only.
>>>
>>> 1.
>>>
>>>
>>> Here is the code I already have to convert a sample image from 
>>> cartesian to projected coordinates:
>>>
>>>     import os
>>>     from tempfile import TemporaryDirectory
>>>     from osgeo import gdal, osr
>>>     import numpy as np
>>>     from matplotlib import pyplot as plt
>>>
>>>
>>>     # get some test data
>>>     swath_data = np.random.randint(1, 100, (500, 400))
>>>     lons, lats = np.meshgrid(np.linspace(3, 5, 500),
>>>     ???????????????????????? np.linspace(40, 42, 400))
>>>
>>>     with TemporaryDirectory() as td:
>>>     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
>>>     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
>>>     ??? p_data_tmp = os.path.join(td, 'data.tif')
>>>     ??? p_data_vrt = os.path.join(td, 'data.vrt')
>>>     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')
>>>
>>>     ??? # save numpy arrays to temporary tif files
>>>     ??? for arr, path in zip((swath_data, lons, lats), (p_data_tmp,
>>>     p_lons_tmp, p_lats_tmp)):
>>>     ??????? rows, cols = arr.shape
>>>     ??????? drv = gdal.GetDriverByName('GTiff')
>>>     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
>>>     ??????? ds.GetRasterBand(1).WriteArray(arr)
>>>     ??????? del ds
>>>
>>>     ??? # add geolocation information to input data
>>>     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
>>>     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
>>>     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
>>>     ??? ds.SetMetadata(
>>>
>>>     ??????? dict(
>>>     ??????????? SRS=wgs84_wkt,
>>>     ??????????? X_DATASET=p_lons_tmp,
>>>     ??????????? Y_DATASET=p_lats_tmp,
>>>     ??????????? X_BAND='1',
>>>     ??????????? Y_BAND='1',
>>>     ??????????? PIXEL_OFFSET='0',
>>>     ??????????? LINE_OFFSET='0',
>>>     ??????????? PIXEL_STEP='1',
>>>     ??????????? LINE_STEP='1'
>>>     ??????? ),
>>>     ??????? 'GEOLOCATION'
>>>     ??? )del ds
>>>
>>>     ??? # warp from geolocation arrays and read the result
>>>     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT',
>>>     geoloc=True,
>>>     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
>>>     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()
>>>
>>>     # visualize input and output data
>>>     fig, axes = plt.subplots(1, 4)
>>>     for i, (arr, title) in enumerate(zip((swath_data, lons, lats,
>>>     data_mapgeo),
>>>     ????????????????????????????????? ('swath data', 'lons', 'lats',
>>>     'projected data'))):
>>>     ??? axes[i].imshow(arr, cmap='gray')
>>>     ??? axes[i].set_title(title)
>>>     plt.tight_layout()
>>>     plt.show()
>>>
>>>
>>> Any help would be highly appreciated!
>>>
>>> Best,
>>>
>>> Daniel Scheffler
>>>
>>>
>>> -- 
>>>
>>> M.Sc. Geogr. Daniel Scheffler
>>>
>>> Helmholtz Centre Potsdam
>>> GFZ German Research Centre For Geosciences
>>> Department 1 - Geodesy and Remote Sensing
>>> Section 1.4  - Remote Sensing
>>> Telegrafenberg, 14473 Potsdam, Germany
>>>
>>> Phone:  +49 (0)331/288-1198
>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> -- 
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>
> -- 
>
> M.Sc. Geogr. Daniel Scheffler
>
> Helmholtz Centre Potsdam
> GFZ German Research Centre For Geosciences
> Department 1 - Geodesy and Remote Sensing
> Section 1.4  - Remote Sensing
> Telegrafenberg, 14473 Potsdam, Germany
>
> Phone:  +49 (0)331/288-1198
> e-mail:daniel.scheffler at gfz-potsdam.de
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/091f7059/attachment.html>

From daniel.scheffler at gfz-potsdam.de  Tue Nov 30 05:20:05 2021
From: daniel.scheffler at gfz-potsdam.de (Daniel Scheffler)
Date: Tue, 30 Nov 2021 14:20:05 +0100
Subject: [gdal-dev] Fwd: Transformation of image data between pixel/line
 and projected coordinates - using geolocation arrays, in both directions,
 without disk access
In-Reply-To: <1791a553-3e0e-f5e6-659d-11ac6f708ab3@spatialys.com>
References: <77c9bbc0-b502-afe1-f7e0-37da24909829@gfz-potsdam.de>
 <c2cf3a49-200b-91a6-dd81-1b3059859558@gfz-potsdam.de>
 <1791a553-3e0e-f5e6-659d-11ac6f708ab3@spatialys.com>
Message-ID: <b1cf6b86-4922-ca9a-bdd4-ec4fff2883d7@gfz-potsdam.de>

Ok thanks, too bad that this is not implemented. I think the inversion 
of this transformation would be a nice feature to be added in GDAL. It 
would be very useful to me (especially if it is accessible via the 
Python bindings) and would ease the implementation in a processing 
pipeline for the upcoming EnMAP hyperspectral satellite. Should I open a 
feature request in the GDAL issue tracker on GitHub?


Am 30.11.2021 um 14:02 schrieb Even Rouault:
>
>
> Le 30/11/2021 ? 12:52, Daniel Scheffler a ?crit?:
>> Thanks a lot for taking the time, Even, I got the transformation from 
>> cartesian to projected coordinates to work in memory with the GTiff 
>> driver. With MEM, NUMPY or VRT it does not work because these formats 
>> are either not readable from /vsimem/ or don?t have a regular file 
>> path which is needed to set the X_DATASET and Y_DATASET keys in the 
>> GEOLOCATION metadata.
> Ah indeed for X_DATASET/Y_DATASET, you can't use a MEM or NUMPY 
> dataset. But a /vsimem/xxx dataset in another format should work.
>>
>> Regarding the inversion of this transformation, i.e., from projected 
>> coordinates to pixel/line:
>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>> which is for the source dataset should be ported a few lines after 
>>> for the target dataset.? Probably with a new transformer option to 
>>> be able to point to an auxiliary dataset, such as a VRT one of your 
>>> example, to extract the geolocation metadata items from it, that 
>>> would be different from the target dataset itself, because, except 
>>> perhaps for the netCDF case, most GDAL datasets that expose a 
>>> GEOLOCATION metadata domain must be read-only.
>>
>> I don?t completely get what you mean here. To me, this sounds like 
>> there might be a way to do the inverted transformation using the 
>> C-API of GDAL.
> No, I meant there's some missing code to do that.
>> However, I am a Python developer and my C skills are a bit poor. Is 
>> there any way to use the Python bindings here?
>>
>> Kind regards,
>> Daniel
>>
>>
>>
>>
>> Am 26.11.2021 um 12:38 schrieb Even Rouault:
>>> Daniel,
>>>>
>>>> I am trying to convert image data from cartesian/image coordinates 
>>>> to projected coordinates AND vice versa using geolocation arrays in 
>>>> GDAL. I have two questions:
>>>>
>>>>  1. Since this transformation is part of a processing chain
>>>>     implemented in Python, I try to transform the data directly
>>>>     in-memory, i.e, without any disk access. This saves IO time and
>>>>     avoids permission errors when trying to write temporary data on
>>>>     Windows. How can this be done? I got correct results with the
>>>>     code below, however, only when I temporarily write the data to
>>>>     disk. I tried to write the data to /vsimem/ using the MEM,
>>>>     GTiff and NUMPY drivers. However, gdal.Warp can?t find the data
>>>>     there (FileNotFoundError). I think, also the gdal.Transformer
>>>>     class might be useful and I found an interesting thread on that
>>>>     here
>>>>     <https://lists.osgeo.org/pipermail/gdal-dev/2012-January/031502.html>
>>>>     and a related test in the GDAL autotest suite (here
>>>>     <https://github.com/OSGeo/gdal/blob/master/autotest/alg/transformgeoloc.py>).
>>>>     However, I can?t get it to work for my specific case.
>>>>
>>> There's no reason it won't work with a in-memory dataset.
>>>
>>> If you use a MEM dataset, then you need to provide the dataset 
>>> object itself as the input dataset of gdal.Warp() (the name of a MEM 
>>> dataset is completely ignored. a MEM dataset can't be opened, just 
>>> created).
>>>
>>> Similarly with a NUMPY dataset.?? With GTiff and /vsimem/, they 
>>> behave as a regular file. If you pass it by name as input of 
>>> gdal.Warp(), you need to make sure to close (ds = None typically) 
>>> the dataset before, so it is properly flushed and can be opened. But 
>>> you can also pass it as an object without that constraint.
>>>
>>> You can also create purely in-memory VRT files by assigning them an 
>>> empty name. Then of course you need to provide them as objects to 
>>> gdal.Warp()
>>>
>>>
>>>>  1. My second question is how I can invert the transformation,
>>>>     i.e., how can I transform an image with projected coordinates
>>>>     back to cartesian/image coordinates, given that a geolocation
>>>>     array tells GDAL where to put which pixel in the output?
>>>>     Background is a processing pipeline for satellite data where
>>>>     some processing steps are running in sensor geometry (image
>>>>     data as acquired by the sensor, without any geocoding and
>>>>     projection) and I need to provide corresponding AUX data which
>>>>     originally come with projected coordinates.
>>>>
>>> The logic of GDALCreateGenImgProjTransformer2() around 
>>> https://github.com/OSGeo/gdal/blob/master/alg/gdaltransformer.cpp#L1825 
>>> which is for the source dataset should be ported a few lines after 
>>> for the target dataset.? Probably with a new transformer option to 
>>> be able to point to an auxiliary dataset, such as a VRT one of your 
>>> example, to extract the geolocation metadata items from it, that 
>>> would be different from the target dataset itself, because, except 
>>> perhaps for the netCDF case, most GDAL datasets that expose a 
>>> GEOLOCATION metadata domain must be read-only.
>>>>
>>>> 1.
>>>>
>>>>
>>>> Here is the code I already have to convert a sample image from 
>>>> cartesian to projected coordinates:
>>>>
>>>>     import os
>>>>     from tempfile import TemporaryDirectory
>>>>     from osgeo import gdal, osr
>>>>     import numpy as np
>>>>     from matplotlib import pyplot as plt
>>>>
>>>>
>>>>     # get some test data
>>>>     swath_data = np.random.randint(1, 100, (500, 400))
>>>>     lons, lats = np.meshgrid(np.linspace(3, 5, 500),
>>>>     ???????????????????????? np.linspace(40, 42, 400))
>>>>
>>>>     with TemporaryDirectory() as td:
>>>>     ??? p_lons_tmp = os.path.join(td, 'lons.tif')
>>>>     ??? p_lats_tmp = os.path.join(td, 'lats.tif')
>>>>     ??? p_data_tmp = os.path.join(td, 'data.tif')
>>>>     ??? p_data_vrt = os.path.join(td, 'data.vrt')
>>>>     ??? p_data_mapgeo_vrt = os.path.join(td, 'data_mapgeo.vrt')
>>>>
>>>>     ??? # save numpy arrays to temporary tif files
>>>>     ??? for arr, path in zip((swath_data, lons, lats), (p_data_tmp,
>>>>     p_lons_tmp, p_lats_tmp)):
>>>>     ??????? rows, cols = arr.shape
>>>>     ??????? drv = gdal.GetDriverByName('GTiff')
>>>>     ??????? ds = drv.Create(path, cols, rows, 1, gdal.GDT_Float64)
>>>>     ??????? ds.GetRasterBand(1).WriteArray(arr)
>>>>     ??????? del ds
>>>>
>>>>     ??? # add geolocation information to input data
>>>>     ??? wgs84_wkt = osr.GetUserInputAsWKT('WGS84')
>>>>     ??? utm_wkt = osr.GetUserInputAsWKT('EPSG:32632')
>>>>     ??? ds = gdal.Translate(p_data_vrt, p_data_tmp, format='VRT')
>>>>     ??? ds.SetMetadata(
>>>>
>>>>     ??????? dict(
>>>>     ??????????? SRS=wgs84_wkt,
>>>>     ??????????? X_DATASET=p_lons_tmp,
>>>>     ??????????? Y_DATASET=p_lats_tmp,
>>>>     ??????????? X_BAND='1',
>>>>     ??????????? Y_BAND='1',
>>>>     ??????????? PIXEL_OFFSET='0',
>>>>     ??????????? LINE_OFFSET='0',
>>>>     ??????????? PIXEL_STEP='1',
>>>>     ??????????? LINE_STEP='1'
>>>>     ??????? ),
>>>>     ??????? 'GEOLOCATION'
>>>>     ??? )del ds
>>>>
>>>>     ??? # warp from geolocation arrays and read the result
>>>>     ??? gdal.Warp(p_data_mapgeo_vrt, p_data_vrt, format='VRT',
>>>>     geoloc=True,
>>>>     ????????????? srcSRS=wgs84_wkt, dstSRS=utm_wkt)
>>>>     ??? data_mapgeo = gdal.Open(p_data_mapgeo_vrt).ReadAsArray()
>>>>
>>>>     # visualize input and output data
>>>>     fig, axes = plt.subplots(1, 4)
>>>>     for i, (arr, title) in enumerate(zip((swath_data, lons, lats,
>>>>     data_mapgeo),
>>>>     ????????????????????????????????? ('swath data', 'lons',
>>>>     'lats', 'projected data'))):
>>>>     ??? axes[i].imshow(arr, cmap='gray')
>>>>     ??? axes[i].set_title(title)
>>>>     plt.tight_layout()
>>>>     plt.show()
>>>>
>>>>
>>>> Any help would be highly appreciated!
>>>>
>>>> Best,
>>>>
>>>> Daniel Scheffler
>>>>
>>>>
>>>> -- 
>>>>
>>>> M.Sc. Geogr. Daniel Scheffler
>>>>
>>>> Helmholtz Centre Potsdam
>>>> GFZ German Research Centre For Geosciences
>>>> Department 1 - Geodesy and Remote Sensing
>>>> Section 1.4  - Remote Sensing
>>>> Telegrafenberg, 14473 Potsdam, Germany
>>>>
>>>> Phone:  +49 (0)331/288-1198
>>>> e-mail:daniel.scheffler at gfz-potsdam.de
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>> -- 
>>> http://www.spatialys.com
>>> My software is free, but my time generally not.
>>
>> -- 
>>
>> M.Sc. Geogr. Daniel Scheffler
>>
>> Helmholtz Centre Potsdam
>> GFZ German Research Centre For Geosciences
>> Department 1 - Geodesy and Remote Sensing
>> Section 1.4  - Remote Sensing
>> Telegrafenberg, 14473 Potsdam, Germany
>>
>> Phone:  +49 (0)331/288-1198
>> e-mail:daniel.scheffler at gfz-potsdam.de
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 

M.Sc. Geogr. Daniel Scheffler

Helmholtz Centre Potsdam
GFZ German Research Centre For Geosciences
Department 1 - Geodesy and Remote Sensing
Section 1.4  - Remote Sensing
Telegrafenberg, 14473 Potsdam, Germany

Phone:  +49 (0)331/288-1198
e-mail:daniel.scheffler at gfz-potsdam.de
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/b9aa3adb/attachment-0001.html>

From j1 at jimenezshaw.com  Tue Nov 30 07:33:28 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 30 Nov 2021 16:33:28 +0100
Subject: [gdal-dev] Cancel DXF writing
Message-ID: <CADRrdKs4cFV2+wB0_XM+ixBAu=LNcvWEH4DU-4kysx6gGp9egw@mail.gmail.com>

Hi

I want to cancel the writing of a DXF file. It has, let's say, a million
points. Before adding each point I check if the user canceled the task.
I have noticed that while I am writing point by point, the actual file in
the disk that is growing is called "file.dxf.tmp", and only when I close
the dataset it really writes "file.dxf", deleting the tmp one.

When the user cancels the process, I want to top writing and delete the
file. I am calling the method MarkSuppressOnClose() , but I see that still
the "file.dxf" is created... and then removed. This final step may take a
long time, that is not needed at all.

Is there a way to cancel efficiently that process?

Thanks.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/c278c0d9/attachment.html>

From even.rouault at spatialys.com  Tue Nov 30 08:28:22 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 Nov 2021 17:28:22 +0100
Subject: [gdal-dev] Cancel DXF writing
In-Reply-To: <CADRrdKs4cFV2+wB0_XM+ixBAu=LNcvWEH4DU-4kysx6gGp9egw@mail.gmail.com>
References: <CADRrdKs4cFV2+wB0_XM+ixBAu=LNcvWEH4DU-4kysx6gGp9egw@mail.gmail.com>
Message-ID: <b66ffbd9-7b0b-c481-484c-a08193778892@spatialys.com>


Le 30/11/2021 ? 16:33, Javier Jimenez Shaw a ?crit?:
> Hi
>
> I want to cancel the writing of a DXF file. It has, let's say, a 
> million points. Before adding each point I check if the user canceled 
> the task.
> I have noticed that while I am writing point by point, the actual file 
> in the disk that is growing is called "file.dxf.tmp", and only when I 
> close the dataset it really writes "file.dxf", deleting the tmp one.
>
> When the user cancels the process, I want to top writing and delete 
> the file. I am calling the method MarkSuppressOnClose() , but I see 
> that still the "file.dxf" is created... and then removed. This final 
> step may take a long time, that is not needed at all.
I haven't looked at the details of the driver, but it seems to be you 
would need to modify the driver so he looks at the flag and does the 
needed cleanup and not try to write the final file. Pull request welcome
>
> Is there a way to cancel efficiently that process?
>
> Thanks.
> .___ ._ ..._ .. . ._. .___ .. __ . _. . __..? ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/d5bdcda7/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov 30 10:29:06 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 30 Nov 2021 18:29:06 +0000
Subject: [gdal-dev] Should we make also GTiff to use TILED=YES as
 default?
Message-ID: <49c7fe230ad245778614e4d4bfcd8ff8@maanmittauslaitos.fi>

Hi,

On the other hand those QGIS users pay the price every time when they zoom close to the same image because then QGIS must read many super wide rows of data instead of just the tiles that intersect the view. Not even overviews which are created on top of striped image do not help when user hit the native resolution. But perhaps it is not so important what is the default, experienced users maybe know what they want.

-Jukka Rahkonen-

L?hett?j?: Javier Jimenez Shaw <j1 at jimenezshaw.com>
L?hetetty: tiistai 30. marraskuuta 2021 11.09
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] Should we make also GTiff to use TILED=YES as default?

Hi Jukka

I don't think it is a good option.
TL;DR: tiled without overviews is extremely slow for a global view.

If you have a (big) image with TILED=YES but without overviews, it is really really slow in QGIS (from seconds to many minutes).
The reason (I guess) is that QGIS is by default sub-sampling the image using nearest neighbor. If the image is not tiled, then it has to read only every nth line. However, when tiled, at the end has to read the full image from file.
The bigger the zoom level, the faster it goes. But waiting 5 minutes to see the global view of your image to know where to zoom in... you close QGIS and blame somebody.

That changes dramatically if there are (proper) overviews available, of course.

Cheers
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.


On Tue, 30 Nov 2021 at 08:04, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

There are loads of questions in the stack.exchange site where users have problems with performance when they do something with reading and writing very large image files. Big files have obviously become much more common now due to clouds. Users try to solve the problem by increasing GDAL_CACHEMAX and using multithreading etc. but they use the default GeoTIFF settings and keep on writing huge striped TIFFs. I wonder if we should make tiling the default also for the GTiff driver like it is in the COG driver.

-Jukka Rahkonen-
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/dffa4153/attachment.html>

From j1 at jimenezshaw.com  Tue Nov 30 10:43:56 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 30 Nov 2021 19:43:56 +0100
Subject: [gdal-dev] Should we make also GTiff to use TILED=YES as
 default?
In-Reply-To: <49c7fe230ad245778614e4d4bfcd8ff8@maanmittauslaitos.fi>
References: <49c7fe230ad245778614e4d4bfcd8ff8@maanmittauslaitos.fi>
Message-ID: <CADRrdKteUFnPVyKtufN-MMwZJ=qkkyT5gW_xmr9GT+JFg3m7vA@mail.gmail.com>

Yes, that is true. It happened to me once.
What I mean is that the plain vanilla without all defaults (no overviews,
no tiles) is currently manageable. Changing only the "tiled" default would
make the vanilla case unmanageable. And some not expert users will complain.

Maybe it is good to document that behavior.

Btw, how spread is the support for tiled TIFFs among other viewers?

Cheers

El mar., 30 nov. 2021 19:29, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> escribi?:

> Hi,
>
>
>
> On the other hand those QGIS users pay the price every time when they zoom
> close to the same image because then QGIS must read many super wide rows of
> data instead of just the tiles that intersect the view. Not even overviews
> which are created on top of striped image do not help when user hit the
> native resolution. But perhaps it is not so important what is the default,
> experienced users maybe know what they want.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *L?hetetty:* tiistai 30. marraskuuta 2021 11.09
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] Should we make also GTiff to use TILED=YES as
> default?
>
>
>
> Hi Jukka
>
>
>
> I don't think it is a good option.
>
> TL;DR: tiled without overviews is extremely slow for a global view.
>
>
>
> If you have a (big) image with TILED=YES but without overviews, it is
> really really slow in QGIS (from seconds to many minutes).
>
> The reason (I guess) is that QGIS is by default sub-sampling the image
> using nearest neighbor. If the image is not tiled, then it has to read only
> every nth line. However, when tiled, at the end has to read the full image
> from file.
>
> The bigger the zoom level, the faster it goes. But waiting 5 minutes to
> see the global view of your image to know where to zoom in... you close
> QGIS and blame somebody.
>
>
>
> That changes dramatically if there are (proper) overviews available, of
> course.
>
>
>
> Cheers
>
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
>
>
> On Tue, 30 Nov 2021 at 08:04, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> There are loads of questions in the stack.exchange site where users have
> problems with performance when they do something with reading and writing
> very large image files. Big files have obviously become much more common
> now due to clouds. Users try to solve the problem by increasing
> GDAL_CACHEMAX and using multithreading etc. but they use the default
> GeoTIFF settings and keep on writing huge striped TIFFs. I wonder if we
> should make tiling the default also for the GTiff driver like it is in the
> COG driver.
>
>
>
> -Jukka Rahkonen-
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211130/4dd18838/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Nov 30 13:08:52 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 30 Nov 2021 21:08:52 +0000
Subject: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)
Message-ID: <964d06f834aa4b24bf9ad34ecaf2dbcb@maanmittauslaitos.fi>

Hi,

Would you mind to include your whole ogr2ogr command (no passwords etc.) and if possible, link to some small shapefile? And confirm that your aim is to save shapefiles with Latin1 encoding into PostGIS database that is using UTF-8 encoding.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: matteo <matteo.ghetta at gmail.com> 
L?hetetty: tiistai 30. marraskuuta 2021 13.05
Vastaanottaja: Even Rouault <even.rouault at spatialys.com>; Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] PGCLIENTENCODING in ogr2ogr (and QGIS)

Hi Rahkonen and Even,

thanks for the answers. If I add -oo PRELUDE_STATEMENTS="SET client_encoding TO LATIN1" the I get this error:

Warning 6: driver ESRI Shapefile does not support open option PRELUDE_STATEMENTS

and I think it that makes sense because I want to put in a UTF8 DB some
LATIN1 shapefiles.

BTW: the shapefiles have been created with ogr2ogr from within QGIS (on a Linux computer), opened and edited on QGIS on Windows machines.

Other ideas are more than welcome!

Cheers!

Matteo

