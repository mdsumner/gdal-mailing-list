From even.rouault at spatialys.com  Wed May  3 08:53:54 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 03 May 2017 17:53:54 +0200
Subject: [gdal-dev] Fwd: [Geopackage] Good News and Bad News from the OAB
	RE: GeoPackage 1.2
Message-ID: <1527799.tR7pbzGm9A@even-i700>

Hi,

FYI. summary: the elevation extension of GeoPackage 1.2 (implemented in GDAL 2.2) will be 
delayed and perhaps subject to further changes.

I'm going to add a note in the GDAL GeoPackage driver page about that.

Even

----------  Forwarded Message  ----------

Subject: [Geopackage] Good News and Bad News from the OAB RE: GeoPackage 1.2
Date: mercredi 3 mai 2017, 09:38:30 CEST
From: Jeff Yutzler via Geopackage <geopackage at lists.opengeospatial.org>
To: geopackage at lists.opengeospatial.org

See my blog posting:
http://geopackage.blogspot.com/2017/05/good-news-bad-news.html

-- 
Jeff Yutzler
Image Matters LLC <http://www.imagemattersllc.com/>
Mobile: (703) 981-8753

-----------------------------------------
-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170503/892f6554/attachment.html>

From Liam.Candy at angloamerican.com  Thu May  4 00:58:57 2017
From: Liam.Candy at angloamerican.com (Candy, Liam)
Date: Thu, 4 May 2017 07:58:57 +0000
Subject: [gdal-dev] GDAL 2.1.3 with ECW support compile fails
Message-ID: <DB5PR03MB149687971A253BBA6FABA13596EA0@DB5PR03MB1496.eurprd03.prod.outlook.com>

Hi,

I'm hoping someone can help me. I'm trying to build the GDAL 2.1.3 with ECW support (using the Hexagon ERDAS ECW read only SDK v5.3.0).

I'm building on Windows with Visual Studio 2015 v14.0.

I'm getting the following type conversion errors that are breaking the build:

...\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(68): error C2440: 'initializing': cannot convert from 'NCS::CString' to 'char *'
...\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(68): note: No user-defined-conversion operator available that can perform this conversion, or the operator cannot be called
...\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1425): error C2664: 'NCSError NCSReadEditInfo(const wchar_t *,NCSEditInfo **)': cannot convert argument 1 from 'char *' to 'const wchar_t *'
...\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1425): note: Types pointed to are unrelated; conversion requires reinterpret_cast, C-style cast or function-style cast
...\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1485): error C2664: 'NCSError NCSWriteEditInfo(const wchar_t *,NCSEditInfo *,void (__cdecl *)(UINT64,UINT64,void *),BOOLEAN (__cdecl *)(void *),void *)': cannot convert argument 1 from 'char *' to 'const wchar_t *'
...\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1485): note: Types pointed to are unrelated; conversion requires reinterpret_cast, C-style cast or function-style cast

Not sure what I'm doing wrong. Any help would be greatly appreciated.

Thanks in advance,
Liam.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170504/f5472eca/attachment.html>

From Roger.Bivand at nhh.no  Thu May  4 01:25:36 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 4 May 2017 10:25:36 +0200
Subject: [gdal-dev] Issue building static only on OSX resolved in 2.2.0RC1
Message-ID: <alpine.LFD.2.20.1705041007190.3680@reclus.nhh.no>

Hi,

The R-core member working hard to keep up with OSX found issues building 
GDAL static for the rgdal and sf R packages with GDAL 2.1.3 on El Capitan, 
but reports success with GDAL 2.2.0RC1. I can't see the relevant line in 
the NEWS file in 2.2.0RC1, so I'm posting this to keep his experiences on 
the record - probably only a few downstream users need to build strictly 
static.

Roger

The report:

"Two issues with --disable-shared --enable-static --with-pic that I 
recall:

1) the default build fails due to an issue in the libtool linking
2) I got it to build by using --without-libtool
3) despite --disable-shared the result builds shared libgdal and links all
binaries against it (moreover the id path in the dylib is wrong)

so I don't have a fix, I have simply manually created libgdal.a, removed 
.dylib so it won't be used and re-pointed the binaries into a versioned 
path that is not used during linking phases. That'll all just a hack, it 
doesn't "fix" it in the sources.

The details for 2.1.3:

if you want to raise this with GDAL -- the details:

## "regular" build
configure --with-pic --disable-shared --enable-static
--with-static-proj4=/usr/local/lib/libproj.a --with-liblzma

fails with

/Applications/Xcode.app/Contents/Developer/usr/bin/make libgdal.la
/bin/sh /Builds/unix/recipes/build/gdal-2.1.3-obj/libtool --mode=link
clang++    -L/usr/local/lib/libproj.a/lib -lproj  -lsqlite3 -lexpat
-L/usr/local/lib -lnetcdf -lhdf5_hl -lhdf5 -ldl -lm -lz -lcurl -lhdf5 
-ljpeg
-lpng -llzma -lz -lpthread -ldl  -lpcre   -lcurl           -liconv  -lxml2
-lz -lpthread -licucore -lm    -o libgdal.la
/Builds/unix/recipes/build/gdal-2.1.3-obj/frmts/o/*.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/gcore/*.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/port/*.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/alg/*.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/commonutils.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/gdalinfo_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/gdal_translate_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/gdalwarp_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/ogr2ogr_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/gdaldem_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/nearblack_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/gdal_grid_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/gdal_rasterize_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/apps/gdalbuildvrt_lib.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/ogr/ogrsf_frmts/o/*.lo
./ogr/ogrgeometryfactory.lo ./ogr/ogrpoint.lo ./ogr/ogrcurve.lo
./ogr/ogrlinestring.lo ./ogr/ogrlinearring.lo ./ogr/ogrpolygon.lo
./ogr/ogrutils.lo ./ogr/ogrgeometry.lo ./ogr/ogrgeometrycollection.lo
./ogr/ogrmultipolygon.lo ./ogr/ogrsurface.lo ./ogr/ogrmultipoint.lo
./ogr/ogrmultilinestring.lo ./ogr/ogrcircularstring.lo
./ogr/ogrcompoundcurve.lo ./ogr/ogrcurvepolygon.lo
./ogr/ogrcurvecollection.lo ./ogr/ogrmulticurve.lo 
./ogr/ogrmultisurface.lo
./ogr/ogr_api.lo ./ogr/ogrfeature.lo ./ogr/ogrfeaturedefn.lo
./ogr/ogrfeaturequery.lo ./ogr/ogrfeaturestyle.lo ./ogr/ogrfielddefn.lo
./ogr/ogrspatialreference.lo ./ogr/ogr_srsnode.lo ./ogr/ogr_srs_proj4.lo
./ogr/ogr_fromepsg.lo ./ogr/ogrct.lo ./ogr/ogr_opt.lo 
./ogr/ogr_srs_esri.lo
./ogr/ogr_srs_pci.lo ./ogr/ogr_srs_usgs.lo ./ogr/ogr_srs_dict.lo
./ogr/ogr_srs_panorama.lo ./ogr/ogr_srs_ozi.lo ./ogr/ogr_srs_erm.lo
./ogr/swq.lo ./ogr/swq_expr_node.lo ./ogr/swq_parser.lo 
./ogr/swq_select.lo
./ogr/swq_op_registrar.lo ./ogr/swq_op_general.lo 
./ogr/ogr_srs_validate.lo
./ogr/ogr_srs_xml.lo ./ogr/ograssemblepolygon.lo ./ogr/ogr2gmlgeometry.lo
./ogr/gml2ogrgeometry.lo ./ogr/ogr_expat.lo ./ogr/ogrpgeogeometry.lo
./ogr/ogrgeomediageometry.lo ./ogr/ogr_geocoding.lo ./ogr/osr_cs_wkt.lo
./ogr/osr_cs_wkt_parser.lo ./ogr/ogrgeomfielddefn.lo ./ogr/ograpispy.lo \
             -rpath /usr/local/lib \
             -no-undefined \
             -version-info 21:3:1
libtool: link:
`/Builds/unix/recipes/build/gdal-2.1.3-obj/frmts/o/BitMask.lo' is not a
valid libtool object
make[2]: *** [libgdal.la] Error 1
make[1]: *** [check-lib] Error 2
make: *** [gdal-2.1.3-dst] Error 2

$ file /Builds/unix/recipes/build/gdal-2.1.3-obj/frmts/o/BitMask.lo
/Builds/unix/recipes/build/gdal-2.1.3-obj/frmts/o/BitMask.lo: Mach-O 
64-bit
object x86_64


##
configure --with-pic --disable-shared --enable-static
--with-static-proj4=/usr/local/lib/libproj.a --with-liblzma
--without-libtool

still creates a dylib and links all binaries against it:

clang++ -dynamiclib  ... -o
/Builds/unix/recipes/build/gdal-2.1.3-obj/libgdal.dylib

$ otool -L gdal-2.1.3-dst/usr/local/bin/gdal_grid
gdal-2.1.3-dst/usr/local/bin/gdal_grid:
         /Builds/unix/recipes/build/gdal-2.1.3-obj/libgdal.dylib
(compatibility version 0.0.0, current version 0.0.0)
         /usr/lib/libsqlite3.dylib (compatibility version 9.0.0, current
version 216.4.0)

and anyway the ID is invalid (it's the build location, not the target)."



-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From even.rouault at spatialys.com  Thu May  4 02:36:25 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 04 May 2017 11:36:25 +0200
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
Message-ID: <4475580.g48Zu0Nnsh@even-i700>

Hi,

No critical issues have been raised on RC1, so

-------

Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final release.

-------

My vote: +1


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170504/352a6f8d/attachment.html>

From sebastic at xs4all.nl  Thu May  4 02:39:26 2017
From: sebastic at xs4all.nl (Bas Couwenberg)
Date: Thu, 04 May 2017 11:39:26 +0200
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <4475580.g48Zu0Nnsh@even-i700>
References: <4475580.g48Zu0Nnsh@even-i700>
Message-ID: <a8a6ce43d213a768efe8bbce5c39f70f@xs4all.nl>

On 2017-05-04 11:36, Even Rouault wrote:
> No critical issues have been raised on RC1, so

It's probably safe to do, although I didn't have time to rebuild the 
reverse dependencies after beta1 again.

There may be other projects affected by the hidden shapelib symbols. 
We'll deal with those when we find them.

Kind Regards,

Bas

From jmckenna at gatewaygeomatics.com  Thu May  4 04:52:15 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 4 May 2017 07:52:15 -0400
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <4475580.g48Zu0Nnsh@even-i700>
References: <4475580.g48Zu0Nnsh@even-i700>
Message-ID: <cb02f002-3e1a-27e9-2ea5-2a54b79d583e@gatewaygeomatics.com>

+1 jeff




On 2017-05-04 5:36 AM, Even Rouault wrote:
> Hi,
>
>
>
> No critical issues have been raised on RC1, so
>
>
>
> -------
>
>
>
> Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final
> release.
>
>
>
> -------
>
>
>
> My vote: +1
>
>
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
>
>

From howard at hobu.co  Thu May  4 05:33:27 2017
From: howard at hobu.co (Howard Butler)
Date: Thu, 4 May 2017 07:33:27 -0500
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <4475580.g48Zu0Nnsh@even-i700>
References: <4475580.g48Zu0Nnsh@even-i700>
Message-ID: <62E141EF-F2C6-46B8-811A-E7E22021B4DA@hobu.co>


> On May 4, 2017, at 4:36 AM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> Hi,
>  
> No critical issues have been raised on RC1, so
>  
> -------
>  
> Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final release.
>  
> -------
>  
> My vote: +1

+1 

Howard


From jukka.rahkonen at maanmittauslaitos.fi  Thu May  4 05:37:56 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 4 May 2017 05:37:56 -0700 (MST)
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <4475580.g48Zu0Nnsh@even-i700>
References: <4475580.g48Zu0Nnsh@even-i700>
Message-ID: <1493901476481-5319380.post@n6.nabble.com>

+1

-Jukka Rahkonen-


Even Rouault-2 wrote
> Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final
> release.
> 
> -------
> 
> My vote: +1





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Motion-Promote-GDAL-2-2-0-RC1-for-release-tp5319362p5319380.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jmckenna at gatewaygeomatics.com  Thu May  4 06:10:43 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 4 May 2017 09:10:43 -0400
Subject: [gdal-dev] GDAL 2.1.3 with ECW support compile fails
In-Reply-To: <DB5PR03MB149687971A253BBA6FABA13596EA0@DB5PR03MB1496.eurprd03.prod.outlook.com>
References: <DB5PR03MB149687971A253BBA6FABA13596EA0@DB5PR03MB1496.eurprd03.prod.outlook.com>
Message-ID: <be818d5e-b55f-b822-8838-272ef6dcbf9e@gatewaygeomatics.com>

On 2017-05-04 3:58 AM, Candy, Liam wrote:
> Hi,
>
>
>
> I’m hoping someone can help me. I’m trying to build the GDAL 2.1.3 with
> ECW support (using the Hexagon ERDAS ECW read only SDK v5.3.0).
>
>
>
> I’m building on Windows with Visual Studio 2015 v14.0.
>
>
>
> I’m getting the following type conversion errors that are breaking the
> build:
>
>
>
> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(68): error C2440: 'initializing':
> cannot convert from 'NCS::CString' to 'char *'
>
> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(68): note: No
> user-defined-conversion operator available that can perform this
> conversion, or the operator cannot be called
>
> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1425): error C2664: 'NCSError
> NCSReadEditInfo(const wchar_t *,NCSEditInfo **)': cannot convert
> argument 1 from 'char *' to 'const wchar_t *'
>
> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1425): note: Types pointed to are
> unrelated; conversion requires reinterpret_cast, C-style cast or
> function-style cast
>
> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1485): error C2664: 'NCSError
> NCSWriteEditInfo(const wchar_t *,NCSEditInfo *,void (__cdecl
> *)(UINT64,UINT64,void *),BOOLEAN (__cdecl *)(void *),void *)': cannot
> convert argument 1 from 'char *' to 'const wchar_t *'
>
> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1485): note: Types pointed to are
> unrelated; conversion requires reinterpret_cast, C-style cast or
> function-style cast
>
>
>
> Not sure what I’m doing wrong. Any help would be greatly appreciated.
>
>
>
> Thanks in advance,
>
> Liam.
>

Hi Liam,

I often build MS4W now with ECW support using Visual Studio 2015, mostly 
using the old version 3.3 (read/write) SDK, but also sometimes with the 
4.x read-only SDK (and I keep my build notes updated at 
https://trac.osgeo.org/gdal/wiki/ECW).  I may not have hit your exact 
issue (and version yet), but it would be great if you could also post 
your notes (and gotchyas) on that page as well, so the next person 
coming along doesn't hit your same issue, or at least that the issue is 
known.  thanks!

-jeff





-- 
Jeff McKenna
MapServer Consulting and Training Services
http://www.gatewaygeomatics.com/





From even.rouault at spatialys.com  Thu May  4 06:21:47 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 04 May 2017 15:21:47 +0200
Subject: [gdal-dev] GDAL 2.1.3 with ECW support compile fails
In-Reply-To: <be818d5e-b55f-b822-8838-272ef6dcbf9e@gatewaygeomatics.com>
References: <DB5PR03MB149687971A253BBA6FABA13596EA0@DB5PR03MB1496.eurprd03.prod.outlook.com>
 <be818d5e-b55f-b822-8838-272ef6dcbf9e@gatewaygeomatics.com>
Message-ID: <249013495.Q93gcZGvNy@even-i700>

Liam,

> > 
> > …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(68): error C2440: 'initializing':
> > cannot convert from 'NCS::CString' to 'char *'

--> this line shouldn't be compiled when building against SDK >= 5.0. Check in 
your nmake settings that -DECWSDK_VERSION=53 is defined

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170504/ff677d9e/attachment.html>

From dmorissette at mapgears.com  Thu May  4 07:19:04 2017
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Thu, 4 May 2017 10:19:04 -0400
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <4475580.g48Zu0Nnsh@even-i700>
References: <4475580.g48Zu0Nnsh@even-i700>
Message-ID: <e8a661ae-db28-5e00-b122-c0350f0dfe70@mapgears.com>

+1

Daniel

On 2017-05-04 5:36 AM, Even Rouault wrote:
> Hi,
>
>
>
> No critical issues have been raised on RC1, so
>
>
>
> -------
>
>
>
> Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final
> release.
>
>
>
> -------
>
>
>
> My vote: +1
>
>
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From Andre.Vautour at Teledyne.com  Thu May  4 13:07:47 2017
From: Andre.Vautour at Teledyne.com (=?iso-8859-1?Q?Vautour=2C_Andr=E9_=28INT=29?=)
Date: Thu, 4 May 2017 20:07:47 +0000
Subject: [gdal-dev] Slow OGROCITableLayer::GetExtent() query
Message-ID: <8FD06BD4C598D8419F88B9DC4CD35FB2FBA031@CA1-VPMSG-MBX02.TDY.Teledyne.com>

Hi all,

Currently OGROCITableLayer::GetExtent() calculates the cover by basically iterating over all of the features, either by using the min/max aggregate functions in the database, or by doing it with the features themselves.

The query being done currently looks like the following:

SELECT
    MIN(SDO_GEOM.SDO_MIN_MBR_ORDINATE(t.SomeGeometryColumn ,m.DIMINFO,1)) AS MINX,
    MIN(SDO_GEOM.SDO_MIN_MBR_ORDINATE(t.SomeGeometryColumn, m.DIMINFO,2)) AS MINY,
    MAX(SDO_GEOM.SDO_MAX_MBR_ORDINATE(t.SomeGeometryColumn, m.DIMINFO,1)) AS MAXX,
    MAX(SDO_GEOM.SDO_MAX_MBR_ORDINATE(t.SomeGeometryColumn, m.DIMINFO,2)) AS MAXY
FROM ALL_SDO_GEOM_METADATA m, SomeOwner.SomeTable t
WHERE m.TABLE_NAME = UPPER('SomeTable')
    AND m.COLUMN_NAME = UPPER('SomeGeometryColumn')
    AND OWNER = UPPER('SomeOwner');

I am trying to connect to a table that has around 50,000 rows, and that query with that particular table takes around 35 secs.

Given that the table has a spatial tree index, would it make more sense to simply get the root MBR of the spatial index:

SELECT
    SDO_GEOM.SDO_MIN_MBR_ORDINATE(m.SDO_ROOT_MBR, 1) AS MINX,
    SDO_GEOM.SDO_MIN_MBR_ORDINATE(m.SDO_ROOT_MBR, 2) AS MINY,
    SDO_GEOM.SDO_MAX_MBR_ORDINATE(m.SDO_ROOT_MBR, 1) AS MAXX,
    SDO_GEOM.SDO_MAX_MBR_ORDINATE(m.SDO_ROOT_MBR, 2) AS MAXY
FROM ALL_SDO_INDEX_METADATA m, ALL_SDO_INDEX_INFO i
WHERE i.INDEX_NAME = m.SDO_INDEX_NAME
    AND i.SDO_INDEX_OWNER = m.SDO_INDEX_OWNER
    AND i.TABLE_NAME = UPPER('SomeTable')
    AND i.COLUMN_NAME = UPPER('SomeGeometryColumn')
    AND i.TABLE_OWNER = UPPER('SomeOwner');

That query is pretty much instantaneous and gives me the same exact result.

The main issue that I see is that there isn't any guarantee that the spatial index is completely up-to-date, so it could not give the same result. One option would be to do the same as the PostgreSQL driver and only do the quick query if force is set to false. I'd also would be open to adding a configuration option to use the root MBR instead of the current behavior.

Thoughts?
Andre

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170504/035202de/attachment.html>

From even.rouault at spatialys.com  Thu May  4 13:49:40 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 04 May 2017 22:49:40 +0200
Subject: [gdal-dev] Automating code style enforcement ?
Message-ID: <9989017.KjT1pDNV7P@even-i700>

Hi,

I've observed Kurt's continued efforts, over several months if not years, to set a consistant 
style to the code base and this is a much appreciated initiative. Now, as this touches the 
whole code base, I think this should be formalized, probably under the form of a RFC, so that 
this is shared among all developers. Currently as there's no automation, basically every 
committer will probably unconsciously "break" files that have been already reformatted, 
which is a waste of time that could be avoided (and on a minor note we could save extra 
reformatting commits that are noise in the history, and extra bits to parse for the human 
preparing a changelog)

I've seen in other projects, like QGIS, a script (in QGIS, they rely on astyle ultimately. not 
saying we should necessary use astyle) that takes care of reformatting automatically the files 
to be committed given the rules. That way the effort is spread on all contributors (and it is 
not a big deal to run this script). We could also have in Travis-CI a check so that pull requests 
are verified to respect the style (currently, we have already a very adhoc scripts/
detect_tabulations.sh to check that no tabulation characters are used)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170504/69a49ce1/attachment.html>

From schwehr at gmail.com  Thu May  4 13:55:53 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Thu, 4 May 2017 13:55:53 -0700
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <9989017.KjT1pDNV7P@even-i700>
References: <9989017.KjT1pDNV7P@even-i700>
Message-ID: <CACmBxytBo68tAwTj2Pk4HQ5GXwu0k_5_wydsNcCN9-d2HxBigw@mail.gmail.com>

Mateusz just created
https://trac.osgeo.org/gdal/wiki/rfc69_cplusplus_formatting and I'll be
cloning his https://trac.osgeo.org/geos/wiki/RFC4 with changes for GDAL.

On Thu, May 4, 2017 at 1:49 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
>
>
> I've observed Kurt's continued efforts, over several months if not years,
> to set a consistant style to the code base and this is a much appreciated
> initiative. Now, as this touches the whole code base, I think this should
> be formalized, probably under the form of a RFC, so that this is shared
> among all developers. Currently as there's no automation, basically every
> committer will probably unconsciously "break" files that have been already
> reformatted, which is a waste of time that could be avoided (and on a minor
> note we could save extra reformatting commits that are noise in the
> history, and extra bits to parse for the human preparing a changelog)
>
>
>
> I've seen in other projects, like QGIS, a script (in QGIS, they rely on
> astyle ultimately. not saying we should necessary use astyle) that takes
> care of reformatting automatically the files to be committed given the
> rules. That way the effort is spread on all contributors (and it is not a
> big deal to run this script). We could also have in Travis-CI a check so
> that pull requests are verified to respect the style (currently, we have
> already a very adhoc scripts/detect_tabulations.sh to check that no
> tabulation characters are used)
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170504/8c3b0dec/attachment.html>

From mateusz at loskot.net  Thu May  4 14:05:58 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 4 May 2017 23:05:58 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <9989017.KjT1pDNV7P@even-i700>
References: <9989017.KjT1pDNV7P@even-i700>
Message-ID: <CABUeae-5Q=9Co35tQSPAUx0XWo+31+N11yi-vx8cwaeop-KNHA@mail.gmail.com>

On 4 May 2017 at 22:49, Even Rouault <even.rouault at spatialys.com> wrote:
> Hi,
>
> I've observed Kurt's continued efforts, over several months if not years, to
> set a consistant style to the code base and this is a much appreciated
> initiative. Now, as this touches the whole code base, I think this should be
> formalized, probably under the form of a RFC, so that this is shared among
> all developers.

Even,

Yes, it is good time.
I've encouraged Kurt to take a step towards formal motion and
we are working on that.

> I've seen in other projects, like QGIS, a script (in QGIS, they rely on
> astyle ultimately. not saying we should necessary use astyle)

Please, let's forget about astyle.

> that takes care of reformatting automatically the files to be committed given the
> rules. That way the effort is spread on all contributors (and it is not a
> big deal to run this script). We could also have in Travis-CI a check so
> that pull requests are verified to respect the style (currently, we have
> already a very adhoc scripts/detect_tabulations.sh to check that no
> tabulation characters are used)

FYI, I prepared GEOS <https://trac.osgeo.org/geos/wiki/RFC4> proposal,
in major part, based on the MongoDB story.
There are references linked with details on
how MongoDB implemented such automated utilities.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From jgreenberg at unr.edu  Thu May  4 15:53:47 2017
From: jgreenberg at unr.edu (Jonathan Greenberg)
Date: Thu, 4 May 2017 22:53:47 +0000
Subject: [gdal-dev] Hacking the new Landsat pixel_qa help...
Message-ID: <CABG0rfth_WiL6f0Fm9ep=H1NEDLb9cR=F54mtOG3wVZAjLF_7A@mail.gmail.com>

Folks:

USGS, in their infinite wisdom, decided to embed what is effectively a
1-bit, 16-band byte-interleaved-by-pixel image into a 16-bit, single-band
geotiff for the Landsat quality mask.  I could write some crazy translation
program that "reverse engineers" the data, but I was wondering if there is
some way to "hack" or translate the file by simply redefining the "header"
(change the number type to 1-bit, number of layers to 16, interleave to
BIP).  Any suggestions for how to do this?

I dropped an example file here:

https://nevada.box.com/s/1xcqrnyyaym4fbzz3r9pjiv79qh5wblj

To be clear, the "displayed" number has no real meaning, the information is
embedded into the set of individual bits in each of the 16 positions.

--j
-- 
-- 
Jonathan A. Greenberg, PhD
Randall Endowed Professor and Associate Professor of Remote Sensing
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Natural Resources & Environmental Science
University of Nevada, Reno
1664 N Virginia St MS/0186
Reno, NV 89557
Phone: 415-763-5476
http://www.unr.edu/nres
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170504/e12fee08/attachment-0001.html>

From even.rouault at spatialys.com  Fri May  5 00:22:04 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 May 2017 09:22:04 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <CABUeae-5Q=9Co35tQSPAUx0XWo+31+N11yi-vx8cwaeop-KNHA@mail.gmail.com>
References: <9989017.KjT1pDNV7P@even-i700>
 <CABUeae-5Q=9Co35tQSPAUx0XWo+31+N11yi-vx8cwaeop-KNHA@mail.gmail.com>
Message-ID: <2750732.PqjfdZNECM@even-i700>

Hi Mateusz,

> Please, let's forget about astyle.

Because you consider it more limited feature-wise than clang-format ?
(https://trac.osgeo.org/geos/wiki/RFC4 : "wrapping long lines whether of code, strings, 
arrays - something which AStyle has no way of doing")

I'm wondering what you mean by "No automation of code reformatting is proposed. It would 
be treating the symptomps, no cause: developers not following the code formatting 
standard. "

I'd really want a script to fix edited files and fix them. From a quick look, it isn't obvious that 
my favorite text editor (kate) could ingest a .clang-format file to enforce the style when I'm 
editing. And honestly I don't even want to learn the rules of the style we would apply. We 
*need* something to fix it easily like scripts/prepare-commit[.sh/.py] that will check svn/git 
edited files and run them through the reformatter.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/8af9aaf4/attachment.html>

From kassies at gmail.com  Fri May  5 01:37:53 2017
From: kassies at gmail.com (Rutger)
Date: Fri, 5 May 2017 01:37:53 -0700 (MST)
Subject: [gdal-dev] Hacking the new Landsat pixel_qa help...
In-Reply-To: <CABG0rfth_WiL6f0Fm9ep=H1NEDLb9cR=F54mtOG3wVZAjLF_7A@mail.gmail.com>
References: <CABG0rfth_WiL6f0Fm9ep=H1NEDLb9cR=F54mtOG3wVZAjLF_7A@mail.gmail.com>
Message-ID: <1493973473805-5319456.post@n6.nabble.com>

Jonathan Greenberg-4 wrote
> Folks:
> 
> USGS, in their infinite wisdom, decided to embed what is effectively a
> 1-bit, 16-band byte-interleaved-by-pixel image into a 16-bit, single-band
> geotiff for the Landsat quality mask.  I could write some crazy
> translation
> program that "reverse engineers" the data, but I was wondering if there is
> some way to "hack" or translate the file by simply redefining the "header"
> (change the number type to 1-bit, number of layers to 16, interleave to
> BIP).  Any suggestions for how to do this?

Hey Jonathan,

I personally think storing it in a single band is not that bad, because you
can use bitwise operations to test many flags in a single operation, which
is very efficient.

The new Python VRT pixel functions, which are available in 2.2 should be
able to do this. I haven't had a change to test it. But creating a VRT
calling some sort of 'bitcheck' function can be specified with a different
bit to check for each band. 

Modifying the example from the VRT tutorial on gdal.org, it might look
something like this (completely untested):

<VRTDataset rasterXSize="20" rasterYSize="20">
  <VRTRasterBand dataType="Byte" band="1" subClass="VRTDerivedRasterBand">
    <PixelFunctionType>bitcheck</PixelFunctionType>
    <PixelFunctionLanguage>Python</PixelFunctionLanguage>
    <PixelFunctionArguments check_bit="5"/>
    <PixelFunctionCode>
    </PixelFunctionCode>
    <SimpleSource>
      <SourceFilename
relativeToVRT="1">landsat_bqa_band.tif</SourceFilename>
    </SimpleSource>
  </VRTRasterBand>
</VRTDataset>

For multiple output bands it would be better to store the function in a
separate file somewhere, instead of repeating the code for each derived
band.

Since Landsat also combines bits (for the low/med/high ones), the function
would need to be changed a little, this is just to get an idea.  

I'm not convinced this is more better/preferable than doing the bit-checking
at the point where you would do something else with the data. Although maybe
for 'direct' visualization in QGIS for example it might be nice. 

The new VRT pixel functions open up a lot of possibilities, especially in
combination with Numba, its exciting to see where this is heading.


Regards,
Rutger
 




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Hacking-the-new-Landsat-pixel-qa-help-tp5319426p5319456.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From mateusz at loskot.net  Fri May  5 01:45:33 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 5 May 2017 10:45:33 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <2750732.PqjfdZNECM@even-i700>
References: <9989017.KjT1pDNV7P@even-i700>
 <CABUeae-5Q=9Co35tQSPAUx0XWo+31+N11yi-vx8cwaeop-KNHA@mail.gmail.com>
 <2750732.PqjfdZNECM@even-i700>
Message-ID: <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>

On 5 May 2017 at 09:22, Even Rouault <even.rouault at spatialys.com> wrote:
>> Please, let's forget about astyle.
>
> Because you consider it more limited feature-wise than clang-format ?

Because, clang-format is based on the same tooling as LLVM/clang,
at least the same tokenizer/lexer, so it can process complex and
convoluted C++ constructs within context; whenever
those tools are applied to LLVM or clang compiler itself,
libformat/clang-format update too.

> I'm wondering what you mean by "No automation of code reformatting is
> proposed. It would be treating the symptomps, no cause: developers not
> following the code formatting standard. "

Please, keep in mind that this draft was prepared and proposed for GEOS.
Kurt has copied it and, AFAIK, is going to review it applying changes
required by GDAL, based on feedback.

I made (or copied and agreed with) the statement that the best way to
reliably maintain consistent code formatting is to learn how to write
properly formatted code and ensure (eg. via code review) all developers
learn it too.
Certainly, tools like `git cl format` would be very handy to let developers
ensure their commits are properly formatted.
Finally, CI build as safety valve is necessary to notify about any style
drifting away from the agreed convention.
A pre-commit hook rejecting incompatible styles are just a stricter variation.

Automated styling of commits would just allow developers to ignore style
completely and commit any garbage with hope the magic will happen automatically.
That would be what is called treating the symptoms.


> I'd really want a script to fix edited files and fix them. From a quick
> look, it isn't obvious that my favorite text editor (kate) could ingest a
> .clang-format file to enforce the style when I'm editing.

Any change you are confusing .editorconfig?

> And honestly I don't even want to learn the rules of the style we would apply.

As per the proposal I made for GEOS, as long as you don't forget to run
clang-format tool before committing, you don't need to learn.

However, I do assume that becoming a project developer and committer,
one agrees to learn how to write code that is expected and accepted by
a project.

> We *need*
> something to fix it easily like scripts/prepare-commit[.sh/.py] that will
> check svn/git edited files and run them through the reformatter.

As I pointed in the RFC, such convenient tools are available:
git cl format from Chromium or the python script
or even running clang-format.

I'm fairly certain there is clang-format integration for Kate-based editors
that allow to run clang-format with shortcut.

Anyhow, I only meant to explain points of my original proposal for GEOS.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From even.rouault at spatialys.com  Fri May  5 04:11:30 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 May 2017 13:11:30 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
References: <9989017.KjT1pDNV7P@even-i700> <2750732.PqjfdZNECM@even-i700>
 <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
Message-ID: <2310367.O1zZohUDuC@even-i700>

> I made (or copied and agreed with) the statement that the best way to
> reliably maintain consistent code formatting is to learn how to write
> properly formatted code and ensure (eg. via code review) all developers
> learn it too.
> Certainly, tools like `git cl format` would be very handy to let developers
> ensure their commits are properly formatted.

For now, we are still on svn, so a relatively SCM-independant solution would be better.

By the way, git cl format doesn't seem available out-of-the-box on my Ubuntu 16.04. Perhaps 
there's an additional package to install ?

> Finally, CI build as safety valve is necessary to notify about any style
> drifting away from the agreed convention.

> A pre-commit hook rejecting incompatible styles are just a stricter
> variation.

Yes, but I'm not sure we want to depend on SVN pre-commit hooks, so as to be more future 
proof. I'd rather see it as a check as part as one of the Travis-CI builds.

> 
> Automated styling of commits would just allow developers to ignore style
> completely and commit any garbage with hope the magic will happen
> automatically. That would be what is called treating the symptoms.
> 
> > I'd really want a script to fix edited files and fix them. From a quick
> > look, it isn't obvious that my favorite text editor (kate) could ingest a
> > .clang-format file to enforce the style when I'm editing.
> 
> Any change you are confusing .editorconfig?

Perhaps. I'm not familiar with it either.

> 
> > And honestly I don't even want to learn the rules of the style we would
> > apply.
> As per the proposal I made for GEOS, as long as you don't forget to run
> clang-format tool before committing, you don't need to learn.

But you must remember to run it on every file you touched, which you can easily forget at 
some point. Some tiny wrapping on top of that to iterate over all modified files would be 
convenient (hint: what does QGIS' scripts/prepare-commit.sh)

> 
> However, I do assume that becoming a project developer and committer,
> one agrees to learn how to write code that is expected and accepted by
> a project.

As soon as you are involved in several projects, there will be different code styles applied, so 
don't expect people (at least me) to know the precise code style to apply for a particular one.

Honestly I don't care about if spaces are put before or after parentheses (I'm pretty sure I'm 
not self-consistent regarding that. Depends on my mood of the day), or such details.  Mostly 
consistant indentation is needed for readability. Other people are more sensitive to that, and 
I'm fine with that. But we should really make it easy to everybody to ultimately have a way to 
submit compliant code, either in their editor, or as a pre-commit action. The later is even 
more true for casual contributors.

> 
> > We *need*
> > something to fix it easily like scripts/prepare-commit[.sh/.py] that will
> > check svn/git edited files and run them through the reformatter.
> 
> As I pointed in the RFC, such convenient tools are available:
> git cl format from Chromium or the python script

https://github.com/mongodb/mongo/blob/master/buildscripts/clang_format.py you mean ? 
Seems to be git only.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/287a069f/attachment-0001.html>

From sebastic at xs4all.nl  Fri May  5 04:26:39 2017
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Fri, 5 May 2017 13:26:39 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <2310367.O1zZohUDuC@even-i700>
References: <9989017.KjT1pDNV7P@even-i700> <2750732.PqjfdZNECM@even-i700>
 <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
 <2310367.O1zZohUDuC@even-i700>
Message-ID: <bd91bd77-8094-f21c-652c-495be2c6f31f@xs4all.nl>

On 05/05/2017 01:11 PM, Even Rouault wrote:
> By the way, git cl format doesn't seem available out-of-the-box on my Ubuntu 16.04. Perhaps 
> there's an additional package to install ?

There is git2cl, but that only supports the GNU ChangeLog format.

IIRC git-cl is part of clang-format, but I don't think that's included
in the Debian package.

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From even.rouault at spatialys.com  Fri May  5 04:35:51 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 May 2017 13:35:51 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
References: <9989017.KjT1pDNV7P@even-i700> <2750732.PqjfdZNECM@even-i700>
 <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
Message-ID: <4359866.9PkYpkHxY2@even-i700>

On vendredi 5 mai 2017 10:45:33 CEST Mateusz Loskot wrote:
> On 5 May 2017 at 09:22, Even Rouault <even.rouault at spatialys.com> wrote:
> >> Please, let's forget about astyle.
> > 
> > Because you consider it more limited feature-wise than clang-format ?
> 
> Because, clang-format is based on the same tooling as LLVM/clang,
> at least the same tokenizer/lexer, so it can process complex and
> convoluted C++ constructs within context; whenever
> those tools are applied to LLVM or clang compiler itself,
> libformat/clang-format update too.
> 

In case we want to have a policy regarding braces around single statements, one finding 
coming from the openjpeg discussion I mentionned :
"""
Moreover, concerning braces around single statements, it seems astyle does this with the 
add-braces option: http://astyle.sourceforge.net/astyle.html#_add-braces[1]

"""

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

--------
[1] http://astyle.sourceforge.net/astyle.html#_add-braces
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/0cd937ae/attachment.html>

From mateusz at loskot.net  Fri May  5 04:39:26 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 5 May 2017 13:39:26 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <2310367.O1zZohUDuC@even-i700>
References: <9989017.KjT1pDNV7P@even-i700> <2750732.PqjfdZNECM@even-i700>
 <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
 <2310367.O1zZohUDuC@even-i700>
Message-ID: <CABUeae8r+HMHy=ugqCEYKTpvsT_JTtJbVAKWcA+inDPPGk162w@mail.gmail.com>

On 5 May 2017 at 13:11, Even Rouault <even.rouault at spatialys.com> wrote:
>> I made (or copied and agreed with) the statement that the best way to
>> reliably maintain consistent code formatting is to learn how to write
>> properly formatted code and ensure (eg. via code review) all developers
>> learn it too.
>
>> Certainly, tools like `git cl format` would be very handy to let
>> developers
>> ensure their commits are properly formatted.
>
> For now, we are still on svn, so a relatively SCM-independant solution would
> be better.
> By the way, git cl format doesn't seem available out-of-the-box on my Ubuntu
> 16.04. Perhaps there's an additional package to install ?

As mentioned in RFC too, it is just an example of an integration
https://chromium.googlesource.com/chromium/src/+/master/docs/clang_format.md

Doesn't matter how one integrates the same or similar tool, shell command,
whatever.

>> Finally, CI build as safety valve is necessary to notify about any style
>> drifting away from the agreed convention.
>> A pre-commit hook rejecting incompatible styles are just a stricter
>> variation.
>
>
>
> Yes, but I'm not sure we want to depend on SVN pre-commit hooks, so as to be
> more future proof. I'd rather see it as a check as part as one of the
> Travis-CI builds.


Yes, indeed. I agree, that is why I suggested developers should become
somewhat familar
with the coding style and conventions, integrate necessary tools into their IDEs
and use it locally, before committing. Some minimal effort is unavoidable.

>> Any change you are confusing .editorconfig?
>
> Perhaps. I'm not familiar with it either.

No need to become.
My RFC gives an overview of .editorconfig but it is not necessary at all.
However, it might be convenient for some developers to automate
basic traits of text encoding like utf-8, indent with spaces only,
remove trailing whitespaces, etc.

.editorconfig might interfere with git eol settings though,
eg. GEOS decided to force LF for all sources in all development environments,
while git can handle it already, of course (see GitHub recommendations)
Unix use LF
Windows users stick to CRLF
and repo receives unified EOLs, eg. LF.

>> > And honestly I don't even want to learn the rules of the style we would
>> > apply.
>> As per the proposal I made for GEOS, as long as you don't forget to run
>> clang-format tool before committing, you don't need to learn.
>
> But you must remember to run it on every file you touched, which you can
> easily forget at some point. Some tiny wrapping on top of that to iterate
> over all modified files would be convenient (hint: what does QGIS'
> scripts/prepare-commit.sh)

AFAIU, it is local hook, then it is fine.
It fits in the local development environment integrations,
You can integrate, script out, automate however one likes.
clang-format is a command line tool. I see no difference to astyle
in terms of usability.

>> However, I do assume that becoming a project developer and committer,
>> one agrees to learn how to write code that is expected and accepted by
>> a project.
>
> As soon as you are involved in several projects, there will be different
> code styles applied, so don't expect people (at least me) to know the
> precise code style to apply for a particular one.

Sure, and I don't expect anyone memorising any rules, if a projects says:
we use clang-format, here is .clang-format config file, you are free to use
whatever you like to ensure your commits follow that config.

> Honestly I don't care about if spaces are put before or after parentheses
> (I'm pretty sure I'm not self-consistent regarding that. Depends on my mood
> of the day), or such details. Mostly consistant indentation is needed for
> readability.

I agree.
As long as code is consistent, particular style does not matter.

I proposed reformatting for GEOS because its source code
formatting is pretty bad and messy, and you can see several
styles, tabs/spaces and others mixture in a single file.

Although GDAL code is in good shape, Kurt has been applying corrections
wherever needed, so I suggested to simplify the task with clang-format.

> Other people are more sensitive to that, and I'm fine with
> that. But we should really make it easy to everybody to ultimately have a
> way to submit compliant code, either in their editor, or as a pre-commit
> action. The later is even more true for casual contributors.

I believe I have addressed that earlier.

>> > We *need*
>> > something to fix it easily like scripts/prepare-commit[.sh/.py] that
>> > will
>> > check svn/git edited files and run them through the reformatter.
>>
>> As I pointed in the RFC, such convenient tools are available:
>> git cl format from Chromium or the python script
>
> https://github.com/mongodb/mongo/blob/master/buildscripts/clang_format.py
> you mean ? Seems to be git only.

It is just an example.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From jmckenna at gatewaygeomatics.com  Fri May  5 04:40:45 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Fri, 5 May 2017 07:40:45 -0400
Subject: [gdal-dev] GDAL 2.1.3 with ECW support compile fails
In-Reply-To: <DB5PR03MB1496E5434C457C58B8B220BF96EB0@DB5PR03MB1496.eurprd03.prod.outlook.com>
References: <DB5PR03MB149687971A253BBA6FABA13596EA0@DB5PR03MB1496.eurprd03.prod.outlook.com>
 <be818d5e-b55f-b822-8838-272ef6dcbf9e@gatewaygeomatics.com>
 <DB5PR03MB1496E5434C457C58B8B220BF96EB0@DB5PR03MB1496.eurprd03.prod.outlook.com>
Message-ID: <2f1e079c-5b9a-9c37-3bee-cc3efa7f4af4@gatewaygeomatics.com>

great, thanks for updating the wiki!   This is great for your karma, and 
really helps the next person hitting your issue.

Please always reply to the mailing list.  Have a nice weekend,

-jeff



On 2017-05-05 6:06 AM, Candy, Liam wrote:
> Hi Jeff,
>
>
>
> I was going to update the wiki, but have issues logging in. Anyway, the
> problem was resolved by
>
>
>
> ECWDIR  =   C:\Users\Blah\AppData\Local\Hexagon\ERDAS_ECW_JPEG_2000_SDK_53
> ECWFLAGS = -DECWSDK_VERSION=53 \
>       -I$(ECWDIR)\include \
>       -I$(ECWDIR)\include/NCSECW/api -I$(ECWDIR)\include/NCSECW/jp2 \
>       -I$(ECWDIR)\include/NCSECW/ecw
> ECWLIB  =  $(ECWDIR)\lib\vc120\Win32\NCSEcw.lib
>
>
>
> The main issue was in the DECWSDK_VERSION that I hadn’t configured
> correctly. The ECWLIB also changed for 5.3 vs 4.1
>
>
>
> I then ran into a linking error using VS 2015. The 5.3 SDK appears to
> have been built with an older version of VS, so the linker gives the
> following error;
>
>
>
> odbccp32.lib(dllload.obj) : error LNK2019: unresolved external symbol
> __vsnwprintf_s referenced in function _StringCchPrintfW
>
>
>
> This is resolved by including the legacy_stdio_definitions.lib library
> as an external library in the build. Full resolution to this issue is here;
>
>
>
> https://connect.microsoft.com/VisualStudio/feedback/details/1039102
>
>
>
> Best regards,
>
> Liam.
>
>
>
> Liam Candy D +27 11 638 2078 M +27 11 282 8658 Ext 8113 2078
>
>
>
> *From:*gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] *On Behalf Of
> *Jeff McKenna
> *Sent:* Thursday, May 4, 2017 3:11 PM
> *To:* gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] GDAL 2.1.3 with ECW support compile fails
>
>
>
> This message originated outside Anglo American
>
> On 2017-05-04 3:58 AM, Candy, Liam wrote:
>> Hi,
>>
>>
>>
>> I’m hoping someone can help me. I’m trying to build the GDAL 2.1.3 with
>> ECW support (using the Hexagon ERDAS ECW read only SDK v5.3.0).
>>
>>
>>
>> I’m building on Windows with Visual Studio 2015 v14.0.
>>
>>
>>
>> I’m getting the following type conversion errors that are breaking the
>> build:
>>
>>
>>
>> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(68): error C2440: 'initializing':
>> cannot convert from 'NCS::CString' to 'char *'
>>
>> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(68): note: No
>> user-defined-conversion operator available that can perform this
>> conversion, or the operator cannot be called
>>
>> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1425): error C2664: 'NCSError
>> NCSReadEditInfo(const wchar_t *,NCSEditInfo **)': cannot convert
>> argument 1 from 'char *' to 'const wchar_t *'
>>
>> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1425): note: Types pointed to are
>> unrelated; conversion requires reinterpret_cast, C-style cast or
>> function-style cast
>>
>> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1485): error C2664: 'NCSError
>> NCSWriteEditInfo(const wchar_t *,NCSEditInfo *,void (__cdecl
>> *)(UINT64,UINT64,void *),BOOLEAN (__cdecl *)(void *),void *)': cannot
>> convert argument 1 from 'char *' to 'const wchar_t *'
>>
>> …\gdal-2.1.3\frmts\ecw\ecwdataset.cpp(1485): note: Types pointed to are
>> unrelated; conversion requires reinterpret_cast, C-style cast or
>> function-style cast
>>
>>
>>
>> Not sure what I’m doing wrong. Any help would be greatly appreciated.
>>
>>
>>
>> Thanks in advance,
>>
>> Liam.
>>
>
> Hi Liam,
>
> I often build MS4W now with ECW support using Visual Studio 2015, mostly
> using the old version 3.3 (read/write) SDK, but also sometimes with the
> 4.x read-only SDK (and I keep my build notes updated at
> https://trac.osgeo.org/gdal/wiki/ECW). I may not have hit your exact
> issue (and version yet), but it would be great if you could also post
> your notes (and gotchyas) on that page as well, so the next person
> coming along doesn't hit your same issue, or at least that the issue is
> known. thanks!
>
> -jeff
>
>
>
>
>

From mateusz at loskot.net  Fri May  5 04:46:56 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 5 May 2017 13:46:56 +0200
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <4359866.9PkYpkHxY2@even-i700>
References: <9989017.KjT1pDNV7P@even-i700> <2750732.PqjfdZNECM@even-i700>
 <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
 <4359866.9PkYpkHxY2@even-i700>
Message-ID: <CABUeae9Nz0hb1J_xCWx7+d_5SE5SewRqr=vW1c1zbq87Ue6xqw@mail.gmail.com>

On 5 May 2017 at 13:35, Even Rouault <even.rouault at spatialys.com> wrote:
>
> In case we want to have a policy regarding braces around single statements,
> one finding coming from the openjpeg discussion I mentionned :
>
> """
> Moreover, concerning braces around single statements, it seems astyle does
> this with the add-braces option:
> http://astyle.sourceforge.net/astyle.html#_add-braces
> As far as I understood, clang-format does not, and requires another tool
> (clang-tidy) to deal with these cases. So one more point for astyle.
> """

Rather, it is a separation of concerns: linting vs formatting
AFAIU, clang-format does not modify any code (ie. add tokens).

I'm not clang-format advocate. I'll repeat myself:
My personal preference is to use clang-format.
I proposed it to GEOS via GEOS RFC.
Kurt found the RFC useful and is using it as a template
to prepare one for GDAL.
IMHO, at the end of the day, tool does not matter as long as proposed
goals are achieved.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From hugues.francois at irstea.fr  Fri May  5 08:09:30 2017
From: hugues.francois at irstea.fr (hugfr)
Date: Fri, 5 May 2017 08:09:30 -0700 (MST)
Subject: [gdal-dev] WMTS "No zoom level found"
Message-ID: <1493996970322-5319529.post@n6.nabble.com>

Hello,

I try to create an xml file suitable for gdal wmts but I got this error "no
zoom level found" (when I try a gdalinfo) and I don't understand where does
the problem come from. I found this post about zoom level management :
http://osgeo-org.1560.x6.nabble.com/WMTS-Need-TileLevel-option-Servers-responding-with-bad-capabilities-td5298089.html

I tried the xml with gdalinfo and it runs perfectly. I compared with mine
and I didn't noticed major differences. I also took a comparative look at
servers capabilities which seems similars. The main difference lays in the
TileMatrix content.

Here is "mine":
<TileMatrixSetLimits>
<TileMatrixLimits>
<TileMatrix>10</TileMatrix>
<MinTileRow>340</MinTileRow>
<MaxTileRow>400</MaxTileRow>
<MinTileCol>493</MinTileCol>
<MaxTileCol>546</MaxTileCol>
</TileMatrixLimits>

Here is the one from
https://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefOnly/MapServer/WMTS/1.0.0/WMTSCapabilities.xml
:
<TileMatrix>
<ows:Identifier>10</ows:Identifier>
<ScaleDenominator>545978.7734656851</ScaleDenominator>
<TopLeftCorner>-2.0037508342787E7 2.0037508342787E7</TopLeftCorner>
<TileWidth>256</TileWidth>
<TileHeight>256</TileHeight>
<MatrixWidth>1025</MatrixWidth>
<MatrixHeight>1285</MatrixHeight>
</TileMatrix>

Does that mean "my" WMTS server can't be accessed using the gdal WMTS driver
or did I miss something ? As far as I understand "my" wmts server is only
accessible using TILEROW and TILECOL arguments, not a BBox, isn't it ?

Below, I have also copied the content of my xml file.

Regards,
Hug


<GDAL_WMTS>
 
<GetCapabilitiesUrl>http://wxs.ign.fr/KEY/geoportail/wmts?SERVICE=WMTS&amp;REQUEST=GetCapabilities</GetCapabilitiesUrl>
  <Layer>GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.STANDARD</Layer>
  
  <TileMatrixSet>PM</TileMatrixSet>
  <TileMatrix>15</TileMatrix>
  <ZoomLevel>15</ZoomLevel>
  <Format>image/jpeg</Format>
  <DataWindow>
          <UpperLeftX>666947.416653756</UpperLeftX>
          <UpperLeftY>5666660.80226639</UpperLeftY>
          <LowerRightX>674402.416653756</LowerRightX>
          <LowerRightY>5658330.40226639</LowerRightY>
  </DataWindow>
  <BandsCount>4</BandsCount>
  <Cache />
  <UnsafeSSL>true</UnsafeSSL>
  <ZeroBlockHttpCodes>404</ZeroBlockHttpCodes>
  <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
  </GDAL_WMTS>




--
View this message in context: http://osgeo-org.1560.x6.nabble.com/WMTS-No-zoom-level-found-tp5319529.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Fri May  5 08:19:27 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 May 2017 17:19:27 +0200
Subject: [gdal-dev] WMTS "No zoom level found"
In-Reply-To: <1493996970322-5319529.post@n6.nabble.com>
References: <1493996970322-5319529.post@n6.nabble.com>
Message-ID: <8715510.UvQXVCh3If@even-i700>

On vendredi 5 mai 2017 08:09:30 CEST hugfr wrote:
> Hello,
> 
> I try to create an xml file suitable for gdal wmts but I got this error "no
> zoom level found" (when I try a gdalinfo) and I don't understand where does
> the problem come from. I found this post about zoom level management :
> http://osgeo-org.1560.x6.nabble.com/WMTS-Need-TileLevel-option-Servers-respo
> nding-with-bad-capabilities-td5298089.html
> 
> I tried the xml with gdalinfo and it runs perfectly. I compared with mine
> and I didn't noticed major differences. I also took a comparative look at
> servers capabilities which seems similars. The main difference lays in the
> TileMatrix content.
> 
> Here is "mine":
> <TileMatrixSetLimits>
> <TileMatrixLimits>
> <TileMatrix>10</TileMatrix>
> <MinTileRow>340</MinTileRow>
> <MaxTileRow>400</MaxTileRow>
> <MinTileCol>493</MinTileCol>
> <MaxTileCol>546</MaxTileCol>
> </TileMatrixLimits>

Did you just try
gdalinfo "WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabilities"

If it does not, then attaching the response to this GetCapabilities request
might help investigating the issue.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/c4b9a6a7/attachment.html>

From perrygeo at gmail.com  Fri May  5 09:18:53 2017
From: perrygeo at gmail.com (Matt Perry)
Date: Fri, 5 May 2017 10:18:53 -0600
Subject: [gdal-dev] Hacking the new Landsat pixel_qa help...
In-Reply-To: <CABG0rfth_WiL6f0Fm9ep=H1NEDLb9cR=F54mtOG3wVZAjLF_7A@mail.gmail.com>
References: <CABG0rfth_WiL6f0Fm9ep=H1NEDLb9cR=F54mtOG3wVZAjLF_7A@mail.gmail.com>
Message-ID: <CAG-GLBPHUTyQP9=P4wR2xEt0px59ccnP5P0oU=cyv-1SRB_PmA@mail.gmail.com>

Hi Jonathan,

Jonathan Greenberg-4 wrote
> USGS, in their infinite wisdom, decided to embed what is effectively a
> 1-bit, 16-band byte-interleaved-by-pixel image into a 16-bit, single-band
> geotiff for the Landsat quality mask.  I could write some crazy
> translation
> program that "reverse engineers" the data, but I was wondering if there is
> some way to "hack" or translate the file by simply redefining the "header"
> (change the number type to 1-bit, number of layers to 16, interleave to
> BIP).  Any suggestions for how to do this?

https://github.com/mapbox/rio-l8qa might be what you're looking for;
provides a python API and CLI for extracting arrays out of the Landsat QA
band, both the pre-Collection and collection format. It's at version 0.1 so
caveat emptor but could be useful. Let me know how it works for you.

Matt Perry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/8df57ba0/attachment.html>

From Andre.Vautour at Teledyne.com  Fri May  5 09:18:46 2017
From: Andre.Vautour at Teledyne.com (=?utf-8?B?VmF1dG91ciwgQW5kcsOpIChJTlQp?=)
Date: Fri, 5 May 2017 16:18:46 +0000
Subject: [gdal-dev] WMTS "No zoom level found"
In-Reply-To: <1493996970322-5319529.post@n6.nabble.com>
References: <1493996970322-5319529.post@n6.nabble.com>
Message-ID: <8FD06BD4C598D8419F88B9DC4CD35FB2FBB410@CA1-VPMSG-MBX02.TDY.Teledyne.com>

> -----Original Message-----
> From: gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] On Behalf Of
> hugfr
> Sent: Friday, May 5, 2017 12:10
> To: gdal-dev at lists.osgeo.org
> Subject: [gdal-dev] WMTS "No zoom level found"
> 
> Hello,
> 
> I try to create an xml file suitable for gdal wmts but I got this error "no zoom
> level found" (when I try a gdalinfo) and I don't understand where does the
> problem come from. I found this post about zoom level management :
> http://osgeo-org.1560.x6.nabble.com/WMTS-Need-TileLevel-option-
> Servers-responding-with-bad-capabilities-td5298089.html
> 
> I tried the xml with gdalinfo and it runs perfectly. I compared with mine and I
> didn't noticed major differences. I also took a comparative look at servers
> capabilities which seems similars. The main difference lays in the TileMatrix
> content.
> 
> Here is "mine":
> <TileMatrixSetLimits>
> <TileMatrixLimits>
> <TileMatrix>10</TileMatrix>
> <MinTileRow>340</MinTileRow>
> <MaxTileRow>400</MaxTileRow>
> <MinTileCol>493</MinTileCol>
> <MaxTileCol>546</MaxTileCol>
> </TileMatrixLimits>
> 
> Here is the one from
> https://basemap.nationalmap.gov/arcgis/rest/services/USGSShadedReliefO
> nly/MapServer/WMTS/1.0.0/WMTSCapabilities.xml
> :
> <TileMatrix>
> <ows:Identifier>10</ows:Identifier>
> <ScaleDenominator>545978.7734656851</ScaleDenominator>
> <TopLeftCorner>-2.0037508342787E7 2.0037508342787E7</TopLeftCorner>
> <TileWidth>256</TileWidth> <TileHeight>256</TileHeight>
> <MatrixWidth>1025</MatrixWidth> <MatrixHeight>1285</MatrixHeight>
> </TileMatrix>

You are comparing apples to oranges. TileMatrixSetLimits/TileMatrixLimits and TileMatrixSet/TileMatrix are not the same thing. The TileMatrix describes a given tile level of the TileMatrixSet. The TileMatrixLimits tell you which part of the TileMatrixSet actually contains data. For instance, the TileMatrixSet might cover the entire world, yet the actually data is only in New Zealand.

> 
> Does that mean "my" WMTS server can't be accessed using the gdal WMTS
> driver or did I miss something ? As far as I understand "my" wmts server is
> only accessible using TILEROW and TILECOL arguments, not a BBox, isn't it ?

WMTS uses zoom level (TileMatrix identifier), x (col), y (row) to access tiles. How that relates to a BBox is calculated from the TileMatrix of the given zoom level.

André

> 
> Below, I have also copied the content of my xml file.
> 
> Regards,
> Hug
> 
> 
> <GDAL_WMTS>
> 
> <GetCapabilitiesUrl>http://wxs.ign.fr/KEY/geoportail/wmts?SERVICE=WMTS
> &amp;REQUEST=GetCapabilities</GetCapabilitiesUrl>
>   <Layer>GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-
> EXPRESS.STANDARD</Layer>
> 
>   <TileMatrixSet>PM</TileMatrixSet>
>   <TileMatrix>15</TileMatrix>
>   <ZoomLevel>15</ZoomLevel>
>   <Format>image/jpeg</Format>
>   <DataWindow>
>           <UpperLeftX>666947.416653756</UpperLeftX>
>           <UpperLeftY>5666660.80226639</UpperLeftY>
>           <LowerRightX>674402.416653756</LowerRightX>
>           <LowerRightY>5658330.40226639</LowerRightY>
>   </DataWindow>
>   <BandsCount>4</BandsCount>
>   <Cache />
>   <UnsafeSSL>true</UnsafeSSL>
>   <ZeroBlockHttpCodes>404</ZeroBlockHttpCodes>
>   <ZeroBlockOnServerException>true</ZeroBlockOnServerException>
>   </GDAL_WMTS>
> 
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/WMTS-
> No-zoom-level-found-tp5319529.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From hugues.francois at irstea.fr  Fri May  5 09:18:54 2017
From: hugues.francois at irstea.fr (Hugues =?utf-8?Q?Fran=C3=A7ois?=)
Date: Fri, 5 May 2017 18:18:54 +0200 (CEST)
Subject: [gdal-dev] WMTS "No zoom level found"
In-Reply-To: <8715510.UvQXVCh3If@even-i700>
References: <1493996970322-5319529.post@n6.nabble.com>
 <8715510.UvQXVCh3If@even-i700>
Message-ID: <1780151814.11966430.1494001134568.JavaMail.zimbra@irstea.fr>


Hi,
Thanks for your quick reply. No, I did'nt try this simple command.
Here is the output (I removed some of them, keeping just the one I want to use but the whole output is attached to the message)
Regards,
Hug

gdalinfo "WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabilities"Driver: WMTS/OGC Web Mab Tile ServiceFiles: none associatedSize is 512, 512Coordinate System is `'Origin = (0.000000000000000,0.000000000000000)Pixel Size = (1.000000000000000,1.000000000000000)Subdatasets:  SUBDATASET_89_NAME=WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabilities,layer=GEOGRAPHICALGRIDSYST                  SUBDATASET_89_DESC=Layer PYRAMIDE SCANEXPRESS STANDARDCorner Coordinates:Upper Left  (   0.0000000,   0.0000000)Lower Left  (       0.000,     512.000)Upper Right (     512.000,       0.000)Lower Right (     512.000,     512.000)Center      (     256.000,     256.000)
----- Mail d'origine -----
De: Even Rouault <even.rouault at spatialys.com>
À: gdal-dev at lists.osgeo.org
Cc: hugfr <hugues.francois at irstea.fr>
Envoyé: Fri, 05 May 2017 17:19:27 +0200 (CEST)
Objet: Re: [gdal-dev] WMTS "No zoom level found"



p, li { white-space: pre-wrap; }
On vendredi 5 mai 2017 08:09:30 CEST hugfr wrote:> Hello,>> I try to create an xml file suitable for gdal wmts but I got this error "no> zoom level found" (when I try a gdalinfo) and I don't understand where does> the problem come from. I found this post about zoom level management :> http://osgeo-org.1560.x6.nabble.com/WMTS-Need-TileLevel-option-Servers-respo> nding-with-bad-capabilities-td5298089.html>> I tried the xml with gdalinfo and it runs perfectly. I compared with mine> and I didn't noticed major differences. I also took a comparative look at> servers capabilities which seems similars. The main difference lays in the> TileMatrix content.>> Here is "mine":> <TileMatrixSetLimits>> <TileMatrixLimits>> <TileMatrix>10</TileMatrix>> <MinTileRow>340</MinTileRow>> <MaxTileRow>400</MaxTileRow>> <MinTileCol>493</MinTileCol>> <MaxTileCol>546</MaxTileCol>> </TileMatrixLimits> Did you just trygdalinfo "WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabilities" If it does not, then attaching the response to this GetCapabilities requestmight help investigating the issue. Even --Spatialys - Geospatial professional serviceshttp://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/136e21cf/attachment-0001.html>

From even.rouault at spatialys.com  Fri May  5 09:27:27 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 May 2017 18:27:27 +0200
Subject: [gdal-dev] WMTS "No zoom level found"
In-Reply-To: <1780151814.11966430.1494001134568.JavaMail.zimbra@irstea.fr>
References: <1493996970322-5319529.post@n6.nabble.com>
 <8715510.UvQXVCh3If@even-i700>
 <1780151814.11966430.1494001134568.JavaMail.zimbra@irstea.fr>
Message-ID: <1869381.n1aRVDELRP@even-i700>

On vendredi 5 mai 2017 18:18:54 CEST Hugues François wrote:
> WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabil
> ities,layer=GEOGRAPHICALGRIDSYST

OK, so now try

gdalinfo "WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabilities,layer=GEOGRAPHICALGRIDSYST"

as suggested by the subdataset name.


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/cd1e0875/attachment.html>

From schwehr at gmail.com  Fri May  5 11:04:24 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 5 May 2017 11:04:24 -0700
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <CABUeae9Nz0hb1J_xCWx7+d_5SE5SewRqr=vW1c1zbq87Ue6xqw@mail.gmail.com>
References: <9989017.KjT1pDNV7P@even-i700> <2750732.PqjfdZNECM@even-i700>
 <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
 <4359866.9PkYpkHxY2@even-i700>
 <CABUeae9Nz0hb1J_xCWx7+d_5SE5SewRqr=vW1c1zbq87Ue6xqw@mail.gmail.com>
Message-ID: <CACmBxyuXPAxJd8EiUjZWRtqRJqTioVEUD0LY7m1Png1bvczXhA@mail.gmail.com>

astyle would certainly work too.

I find clang-format more robust than almost all other formatting tools as
Mateusz described.  As for workflow, there are multiple possible routes as
to how to go about this.  I personally write pretty messy code when I'm
working and then just do a format pass before submitting.  If the editor
I'm using supports formatting, great.  However, the command line is super
easy.  I also know a number of people who work on code only after applying
their own person clang format style to code and then transform back before
submitting.  And there is the critical ability to shut off the formatter
for sections of code where the formatter will do something seriously
wrong... the classic example is matrices in test files.

Alternatively, we could easily have astyle as a first pass to add braces
before clang-format if someone wanted to implement that.  But there
clang-tidy as Mateusz said with:

https://clang.llvm.org/extra/clang-tidy/checks/readability-braces-around-statements.html

with lots of other check....

https://clang.llvm.org/extra/clang-tidy/checks/list.html

On Fri, May 5, 2017 at 4:46 AM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 5 May 2017 at 13:35, Even Rouault <even.rouault at spatialys.com> wrote:
> >
> > In case we want to have a policy regarding braces around single
> statements,
> > one finding coming from the openjpeg discussion I mentionned :
> >
> > """
> > Moreover, concerning braces around single statements, it seems astyle
> does
> > this with the add-braces option:
> > http://astyle.sourceforge.net/astyle.html#_add-braces
> > As far as I understood, clang-format does not, and requires another tool
> > (clang-tidy) to deal with these cases. So one more point for astyle.
> > """
>
> Rather, it is a separation of concerns: linting vs formatting
> AFAIU, clang-format does not modify any code (ie. add tokens).
>
> I'm not clang-format advocate. I'll repeat myself:
> My personal preference is to use clang-format.
> I proposed it to GEOS via GEOS RFC.
> Kurt found the RFC useful and is using it as a template
> to prepare one for GDAL.
> IMHO, at the end of the day, tool does not matter as long as proposed
> goals are achieved.
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/60f3e828/attachment.html>

From hugues.francois at irstea.fr  Fri May  5 11:09:17 2017
From: hugues.francois at irstea.fr (Hugues =?utf-8?Q?Fran=C3=A7ois?=)
Date: Fri, 5 May 2017 20:09:17 +0200 (CEST)
Subject: [gdal-dev] WMTS "No zoom level found"
In-Reply-To: <1869381.n1aRVDELRP@even-i700>
References: <1493996970322-5319529.post@n6.nabble.com>
 <8715510.UvQXVCh3If@even-i700>
 <1780151814.11966430.1494001134568.JavaMail.zimbra@irstea.fr>
 <1869381.n1aRVDELRP@even-i700>
Message-ID: <780702300.12485648.1494007757280.JavaMail.zimbra@irstea.fr>

Sorry, it took me sometimes to answer. I don't know what happenned with the copy/paste from terminal but the url was truncated. 

However, it ran the gdalinfo with the right layer name and it is after this text. 

Regards, 

Hug 


gdalinfo "WMTS:http://wxs.ign.fr/an7nvfzojv5wa96dsga5nk8w/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabilities,layer=GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.STANDARD" 
Driver: WMTS/OGC Web Mab Tile Service 
Files: none associated 
Size is 7168, 7835 
Coordinate System is: 
PROJCS["WGS 84 / Pseudo-Mercator", 
GEOGCS["WGS 84", 
DATUM["WGS_1984", 
SPHEROID["WGS 84",6378137,298.257223563, 
AUTHORITY["EPSG","7030"]], 
AUTHORITY["EPSG","6326"]], 
PRIMEM["Greenwich",0, 
AUTHORITY["EPSG","8901"]], 
UNIT["degree",0.0174532925199433, 
AUTHORITY["EPSG","9122"]], 
AUTHORITY["EPSG","4326"]], 
PROJECTION["Mercator_1SP"], 
PARAMETER["central_meridian",0], 
PARAMETER["scale_factor",1], 
PARAMETER["false_easting",0], 
PARAMETER["false_northing",0], 
UNIT["metre",1, 
AUTHORITY["EPSG","9001"]], 
AXIS["X",EAST], 
AXIS["Y",NORTH], 
EXTENSION["PROJ4","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"], 
AUTHORITY["EPSG","3857"]] 
Origin = (-782715.169640224426985,6700469.899478564038873) 
Pixel Size = (305.748113140704788,-305.748113140704788) 
Metadata: 
ABSTRACT=Cartographie topographique multi-échelles du territoire français issue des bases de données vecteur de l’IGN –réalisée selon un processus cartographique innovant fortement automatisé. 
TITLE=PYRAMIDE SCANEXPRESS STANDARD 
Image Structure Metadata: 
INTERLEAVE=PIXEL 
Corner Coordinates: 
Upper Left ( -782715.170, 6700469.899) ( 7d 1'52.50"W, 51d26'43.61"N) 
Lower Left ( -782715.170, 4304933.433) ( 7d 1'52.50"W, 36d 1'52.79"N) 
Upper Right ( 1408887.305, 6700469.899) ( 12d39'22.50"E, 51d26'43.61"N) 
Lower Right ( 1408887.305, 4304933.433) ( 12d39'22.50"E, 36d 1'52.79"N) 
Center ( 313086.068, 5502701.666) ( 2d48'45.00"E, 44d14'25.01"N) 
Band 1 Block=128x128 Type=Byte, ColorInterp=Red 
Overviews: 3584x3917, 1792x1959, 896x979, 448x490, 224x245 
Mask Flags: PER_DATASET ALPHA 
Overviews of mask band: 3584x3917, 1792x1959, 896x979, 448x490, 224x245 
Band 2 Block=128x128 Type=Byte, ColorInterp=Green 
Overviews: 3584x3917, 1792x1959, 896x979, 448x490, 224x245 
Mask Flags: PER_DATASET ALPHA 
Overviews of mask band: 3584x3917, 1792x1959, 896x979, 448x490, 224x245 
Band 3 Block=128x128 Type=Byte, ColorInterp=Blue 
Overviews: 3584x3917, 1792x1959, 896x979, 448x490, 224x245 
Mask Flags: PER_DATASET ALPHA 
Overviews of mask band: 3584x3917, 1792x1959, 896x979, 448x490, 224x245 
Band 4 Block=128x128 Type=Byte, ColorInterp=Alpha 
Overviews: 3584x3917, 1792x1959, 896x979, 448x490, 224x245 


De: "Even Rouault" <even.rouault at spatialys.com> 
À: "Hugues François" <hugues.francois at irstea.fr> 
Cc: gdal-dev at lists.osgeo.org 
Envoyé: Vendredi 5 Mai 2017 18:27:27 
Objet: Re: [gdal-dev] WMTS "No zoom level found" 



On vendredi 5 mai 2017 18:18:54 CEST Hugues François wrote: 

> WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabil 

> ities,layer=GEOGRAPHICALGRIDSYST 



OK, so now try 



gdalinfo "WMTS:http://wxs.ign.fr/{KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetCapabilities,layer=GEOGRAPHICALGRIDSYST" 



as suggested by the subdataset name. 





-- 

Spatialys - Geospatial professional services 

http://www.spatialys.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/2e6a1779/attachment-0001.html>

From flippmoke at gmail.com  Fri May  5 11:19:29 2017
From: flippmoke at gmail.com (Blake Thompson)
Date: Fri, 5 May 2017 13:19:29 -0500
Subject: [gdal-dev] Automating code style enforcement ?
In-Reply-To: <CACmBxyuXPAxJd8EiUjZWRtqRJqTioVEUD0LY7m1Png1bvczXhA@mail.gmail.com>
References: <9989017.KjT1pDNV7P@even-i700> <2750732.PqjfdZNECM@even-i700>
 <CABUeae9hiFN7ONDWYwjPm=2BMMUERekp3WcPz4YG_18So9s0XQ@mail.gmail.com>
 <4359866.9PkYpkHxY2@even-i700>
 <CABUeae9Nz0hb1J_xCWx7+d_5SE5SewRqr=vW1c1zbq87Ue6xqw@mail.gmail.com>
 <CACmBxyuXPAxJd8EiUjZWRtqRJqTioVEUD0LY7m1Png1bvczXhA@mail.gmail.com>
Message-ID: <CAPxHBh-ytTXA5QPpchwc0tPnYCDFzRJDUHwhsBJNuJm-_3ZKqw@mail.gmail.com>

All,

Just wanted to contribute some experiences we have gained at Mapbox while
doing our C++ work on attempting to work towards a common format on some
libraries. We have found that clang format is very helpful, but it is still
also very good if you have written documentation on how to follow the style
at some location. RFC seems to be the right track to gather thoughts.

The best way we have found so far to use clang format has been to check in
a ".clang-format" file with each repository. Once this is done, we put in a
script in our makefile to automate the updating process
https://github.com/mapbox/wagyu/blob/master/Makefile#L95-L96 as an example.

A couple thing we have realized:

- Even experienced with a style often make mistakes as we are often
shifting between projects (as they have different styles)
- A `make indent` (clang format) is a simple way to fix problems and check
them in on occasion (such as after big changes or before releases)
- Optimize the style for reading now for writing of the code
- If you want to be really strict you can have style checked as part of
testing (I am not personally a huge fan of this).

Thanks,

Blake Thompson


On Fri, May 5, 2017 at 1:04 PM, Kurt Schwehr <schwehr at gmail.com> wrote:

> astyle would certainly work too.
>
> I find clang-format more robust than almost all other formatting tools as
> Mateusz described.  As for workflow, there are multiple possible routes as
> to how to go about this.  I personally write pretty messy code when I'm
> working and then just do a format pass before submitting.  If the editor
> I'm using supports formatting, great.  However, the command line is super
> easy.  I also know a number of people who work on code only after applying
> their own person clang format style to code and then transform back before
> submitting.  And there is the critical ability to shut off the formatter
> for sections of code where the formatter will do something seriously
> wrong... the classic example is matrices in test files.
>
> Alternatively, we could easily have astyle as a first pass to add braces
> before clang-format if someone wanted to implement that.  But there
> clang-tidy as Mateusz said with:
>
> https://clang.llvm.org/extra/clang-tidy/checks/readability-
> braces-around-statements.html
>
> with lots of other check....
>
> https://clang.llvm.org/extra/clang-tidy/checks/list.html
>
> On Fri, May 5, 2017 at 4:46 AM, Mateusz Loskot <mateusz at loskot.net> wrote:
>
>> On 5 May 2017 at 13:35, Even Rouault <even.rouault at spatialys.com> wrote:
>> >
>> > In case we want to have a policy regarding braces around single
>> statements,
>> > one finding coming from the openjpeg discussion I mentionned :
>> >
>> > """
>> > Moreover, concerning braces around single statements, it seems astyle
>> does
>> > this with the add-braces option:
>> > http://astyle.sourceforge.net/astyle.html#_add-braces
>> > As far as I understood, clang-format does not, and requires another tool
>> > (clang-tidy) to deal with these cases. So one more point for astyle.
>> > """
>>
>> Rather, it is a separation of concerns: linting vs formatting
>> AFAIU, clang-format does not modify any code (ie. add tokens).
>>
>> I'm not clang-format advocate. I'll repeat myself:
>> My personal preference is to use clang-format.
>> I proposed it to GEOS via GEOS RFC.
>> Kurt found the RFC useful and is using it as a template
>> to prepare one for GDAL.
>> IMHO, at the end of the day, tool does not matter as long as proposed
>> goals are achieved.
>>
>> Best regards,
>> --
>> Mateusz Loskot, http://mateusz.loskot.net
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
>
> --
> --
> http://schwehr.org
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/8bef5876/attachment.html>

From Stefan.Blumentrath at nina.no  Fri May  5 09:17:18 2017
From: Stefan.Blumentrath at nina.no (Blumentrath, Stefan)
Date: Fri, 5 May 2017 16:17:18 +0000
Subject: [gdal-dev] Hacking the new Landsat pixel_qa help...
In-Reply-To: <1493973473805-5319456.post@n6.nabble.com>
References: <CABG0rfth_WiL6f0Fm9ep=H1NEDLb9cR=F54mtOG3wVZAjLF_7A@mail.gmail.com>,
 <1493973473805-5319456.post@n6.nabble.com>
Message-ID: <3d8aeb1cbdd64649954812cc60a49eb6@NINSRV23.nina.no>

Hi, 

If you don't mind some advertising of own work, have a look at:
https://grass.osgeo.org/grass72/manuals/addons/i.landsat8.qc.html

If you want to do this using gdal,  the python code might be a source of inspiration... 

Cheers, 
Stefan
________________________________________
Von: gdal-dev [gdal-dev-bounces at lists.osgeo.org] im Auftrag von Rutger [kassies at gmail.com]
Gesendet: Freitag, 5. Mai 2017 10:37
An: gdal-dev at lists.osgeo.org
Betreff: Re: [gdal-dev] Hacking the new Landsat pixel_qa help...

Jonathan Greenberg-4 wrote
> Folks:
>
> USGS, in their infinite wisdom, decided to embed what is effectively a
> 1-bit, 16-band byte-interleaved-by-pixel image into a 16-bit, single-band
> geotiff for the Landsat quality mask.  I could write some crazy
> translation
> program that "reverse engineers" the data, but I was wondering if there is
> some way to "hack" or translate the file by simply redefining the "header"
> (change the number type to 1-bit, number of layers to 16, interleave to
> BIP).  Any suggestions for how to do this?

Hey Jonathan,

I personally think storing it in a single band is not that bad, because you
can use bitwise operations to test many flags in a single operation, which
is very efficient.

The new Python VRT pixel functions, which are available in 2.2 should be
able to do this. I haven't had a change to test it. But creating a VRT
calling some sort of 'bitcheck' function can be specified with a different
bit to check for each band.

Modifying the example from the VRT tutorial on gdal.org, it might look
something like this (completely untested):

<VRTDataset rasterXSize="20" rasterYSize="20">
  <VRTRasterBand dataType="Byte" band="1" subClass="VRTDerivedRasterBand">
    <PixelFunctionType>bitcheck</PixelFunctionType>
    <PixelFunctionLanguage>Python</PixelFunctionLanguage>
    <PixelFunctionArguments check_bit="5"/>
    <PixelFunctionCode>
    </PixelFunctionCode>
    <SimpleSource>
      <SourceFilename
relativeToVRT="1">landsat_bqa_band.tif</SourceFilename>
    </SimpleSource>
  </VRTRasterBand>
</VRTDataset>

For multiple output bands it would be better to store the function in a
separate file somewhere, instead of repeating the code for each derived
band.

Since Landsat also combines bits (for the low/med/high ones), the function
would need to be changed a little, this is just to get an idea.

I'm not convinced this is more better/preferable than doing the bit-checking
at the point where you would do something else with the data. Although maybe
for 'direct' visualization in QGIS for example it might be nice.

The new VRT pixel functions open up a lot of possibilities, especially in
combination with Numba, its exciting to see where this is heading.


Regards,
Rutger





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-Hacking-the-new-Landsat-pixel-qa-help-tp5319426p5319456.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Fri May  5 11:56:30 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 May 2017 20:56:30 +0200
Subject: [gdal-dev] WMTS "No zoom level found"
In-Reply-To: <780702300.12485648.1494007757280.JavaMail.zimbra@irstea.fr>
References: <1493996970322-5319529.post@n6.nabble.com>
 <1869381.n1aRVDELRP@even-i700>
 <780702300.12485648.1494007757280.JavaMail.zimbra@irstea.fr>
Message-ID: <1702502.Wf8kLdpXFO@even-i700>

On vendredi 5 mai 2017 20:09:17 CEST Hugues François wrote:
> Sorry, it took me sometimes to answer. I don't know what happenned with the
> copy/paste from terminal but the url was truncated.
> 
> However, it ran the gdalinfo with the right layer name and it is after this
> text.

So it looks like there's no issue with the server. The issue was likely in your XML 
file but you don't necessarily need it. You can use the WMTS:.... name for 
gdal_translate or gdalwarp operations.
If you want to try fixing your XML file, perhaps try removing the <DataWindow> 
to see if that has an effect, or check the TileMatrixSet name, or ...

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170505/e789ec54/attachment-0001.html>

From even.rouault at spatialys.com  Sat May  6 04:58:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 06 May 2017 13:58:06 +0200
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
Message-ID: <3746074.miyZCyX2zc@even-i700>

Hi,

Currently the default mode of linking GDAL with proj.4 is to use dynamic loading mechanism 
(dlopen on Unix, LoadLibary on Windows). I believe the reason for that was that it could have 
make it easier to use an alternate projection engine, but apparently nobody cared enough to 
plug a new one, and it could be done with standard linking. One downside of the current 
mechanism (besides code complication) is that it requires to list the exact library name of 
proj4 in GDAL source code, which can change depending on the soname of proj4. And this can 
cause subtle issues like
https://trac.osgeo.org/gdal/ticket/6881

So I'd suggest just keeping standard linking mechanism, and renaming the current --with-
static-proj4 configure flag as --with-proj4, as the current name is confusing, and making it the 
default behaviour.

Any thoughts ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/8821cc95/attachment.html>

From schwehr at gmail.com  Sat May  6 08:20:34 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sat, 6 May 2017 08:20:34 -0700
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <3746074.miyZCyX2zc@even-i700>
References: <3746074.miyZCyX2zc@even-i700>
Message-ID: <CACmBxysJ3-RbLj7seayff=RO9TWzh6j4TS3mTWw6OX9am1bjOQ@mail.gmail.com>

+1

On May 6, 2017 4:58 AM, "Even Rouault" <even.rouault at spatialys.com> wrote:

> Hi,
>
>
>
> Currently the default mode of linking GDAL with proj.4 is to use dynamic
> loading mechanism (dlopen on Unix, LoadLibary on Windows). I believe the
> reason for that was that it could have make it easier to use an alternate
> projection engine, but apparently nobody cared enough to plug a new one,
> and it could be done with standard linking. One downside of the current
> mechanism (besides code complication) is that it requires to list the exact
> library name of proj4 in GDAL source code, which can change depending on
> the soname of proj4. And this can cause subtle issues like
>
> https://trac.osgeo.org/gdal/ticket/6881
>
>
>
> So I'd suggest just keeping standard linking mechanism, and renaming the
> current --with-static-proj4 configure flag as --with-proj4, as the current
> name is confusing, and making it the default behaviour.
>
>
>
> Any thoughts ?
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/18dfdbda/attachment.html>

From even.rouault at spatialys.com  Sat May  6 09:52:18 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 06 May 2017 18:52:18 +0200
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <3746074.miyZCyX2zc@even-i700>
References: <3746074.miyZCyX2zc@even-i700>
Message-ID: <5820522.IAUbASQfYA@even-i700>

On samedi 6 mai 2017 13:58:06 CEST Even Rouault wrote:
> Hi,
> 
> Currently the default mode of linking GDAL with proj.4 is to use dynamic
> loading mechanism (dlopen on Unix, LoadLibary on Windows). I believe the
> reason for that was that it could have make it easier to use an alternate
> projection engine, but apparently nobody cared enough to plug a new one,
> and it could be done with standard linking. One downside of the current
> mechanism (besides code complication) is that it requires to list the exact
> library name of proj4 in GDAL source code, which can change depending on
> the soname of proj4. And this can cause subtle issues like
> https://trac.osgeo.org/gdal/ticket/6881
> 
> So I'd suggest just keeping standard linking mechanism, and renaming the
> current --with- static-proj4 configure flag as --with-proj4, as the current
> name is confusing, and making it the default behaviour.
> 
> Any thoughts ?

I'm intending to drop support for proj.4 < 4.8 too to do some cleanups

> 
> Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/713c995b/attachment.html>

From zac at weatherwary.com  Sat May  6 09:54:12 2017
From: zac at weatherwary.com (Zachary Flamig)
Date: Sat, 6 May 2017 11:54:12 -0500
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <CACmBxysJ3-RbLj7seayff=RO9TWzh6j4TS3mTWw6OX9am1bjOQ@mail.gmail.com>
References: <3746074.miyZCyX2zc@even-i700>
 <CACmBxysJ3-RbLj7seayff=RO9TWzh6j4TS3mTWw6OX9am1bjOQ@mail.gmail.com>
Message-ID: <AD4D90D1-237E-4A2E-9361-02E71CCD4BF8@weatherwary.com>

+1

I’ve been tricked by this several times where I think I have gdal successfully compiled and then go to reproject something only to find out it can’t :-(

Zac


> On May 6, 2017, at 10:20 AM, Kurt Schwehr <schwehr at gmail.com> wrote:
> 
> +1
> 
> On May 6, 2017 4:58 AM, "Even Rouault" <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>> wrote:
> Hi,
>  
> Currently the default mode of linking GDAL with proj.4 is to use dynamic loading mechanism (dlopen on Unix, LoadLibary on Windows). I believe the reason for that was that it could have make it easier to use an alternate projection engine, but apparently nobody cared enough to plug a new one, and it could be done with standard linking. One downside of the current mechanism (besides code complication) is that it requires to list the exact library name of proj4 in GDAL source code, which can change depending on the soname of proj4. And this can cause subtle issues like
> https://trac.osgeo.org/gdal/ticket/6881 <https://trac.osgeo.org/gdal/ticket/6881>
>  
> So I'd suggest just keeping standard linking mechanism, and renaming the current --with-static-proj4 configure flag as --with-proj4, as the current name is confusing, and making it the default behaviour.
>  
> Any thoughts ?
>  
> Even
>  
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com <http://www.spatialys.com/>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/7e5e4be8/attachment-0001.html>

From even.rouault at spatialys.com  Sat May  6 10:35:18 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 06 May 2017 19:35:18 +0200
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <MWHPR19MB13283B691A86255C920203BAF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>
References: <3746074.miyZCyX2zc@even-i700>
 <CACmBxysJ3-RbLj7seayff=RO9TWzh6j4TS3mTWw6OX9am1bjOQ@mail.gmail.com>
 <MWHPR19MB13283B691A86255C920203BAF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>
Message-ID: <4168237.jFpgmP2sQ8@even-i700>

On samedi 6 mai 2017 17:04:33 CEST Ivan Lucena wrote:
> -1
> 
> 
> We have the options to build drivers against static and dynamic libraries of
> its SDKs, like HDF4,5 and openjpeg for example, using the same
> "--with-driver-name"
> 
> 
> Why not keep that same option for proj4?

I think you are confusing things. For a good reason since the --with-static-proj4 name is 
confusing. --with-static-proj4 can link against libproj.a or libproj.so depending on which is 
available, which is classic build time linking. My suggestion is to keep this as the only option 
to use proj.4, and rename it --with-proj4 for more clarity and consistency

When this option is not specified, proj4 is optionaly loaded through dlopen()/LoadLibrary(), 
which is runtime linking and what I'm proposing to drop for simplicity.

HDF4, 5, openjpeg are only supported through build time linking. 

> 
> 
> --with-proj4=<static or dynamic>-library-path
> 
> 
> I have projects where I let user to decide if they want to download and
> install proj4 while using GDAL and I would prefer to keep that option.
> 

Well, that seem to be a rather particular use case. Given the small size of libproj regarding 
libgdal, you could always build against proj.

After my cleanup and removal of pre-4.8 support, ogrct.cpp is now down to 1110 lines 
against 1311 before, and much easier to follow. And that save testing behaviour in --with-
static-proj4 and --without-static-proj4 cases

> 
> Maybe with a compiler option we can basically "remove" the dynamic load when
> static linked proj4 was used.

That's already the case. If currently you use --with-static-proj4, dynamic loading at runtime is 
disabled.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/eb4c6f54/attachment.html>

From even.rouault at spatialys.com  Sat May  6 12:09:42 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 06 May 2017 21:09:42 +0200
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <MWHPR19MB13283EA8D06216C7FE3C5FDFF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>
References: <3746074.miyZCyX2zc@even-i700> <4168237.jFpgmP2sQ8@even-i700>
 <MWHPR19MB13283EA8D06216C7FE3C5FDFF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>
Message-ID: <2307066.NY6f8sqCP9@even-i700>

Ivan,

> I understand the good intention of cleaning up code but that should not
> remove functionality. You are breaking backward compatibility. What if
> someone updates GDAL in some installation, proj4 is there and it will not
> going to be used?

Well that would be documented in the release notes... There are a number of breaks in each 
new release. That's not really different. And the way of solving in the case you mention is 
rather simple.

> I my case, I *cannot* distribute proj4 into my GDAL build

I've the feeling you're abusing -1 for a reason which you mentionned privately to me but in 
my opinion isn't really valid for the rest of the community. But this is not an important 
enough topic for me to fight about and create useless tensions among contributors.

So I'm dropping the ball on this. For posterity, my patch is at:
https://trac.osgeo.org/gdal/ticket/6882


Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/56f535af/attachment.html>

From lucena_ivan at hotmail.com  Sat May  6 10:53:15 2017
From: lucena_ivan at hotmail.com (Ivan Lucena)
Date: Sat, 6 May 2017 17:53:15 +0000
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <4168237.jFpgmP2sQ8@even-i700>
References: <3746074.miyZCyX2zc@even-i700>
 <CACmBxysJ3-RbLj7seayff=RO9TWzh6j4TS3mTWw6OX9am1bjOQ@mail.gmail.com>
 <MWHPR19MB13283B691A86255C920203BAF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>,
 <4168237.jFpgmP2sQ8@even-i700>
Message-ID: <MWHPR19MB13283EA8D06216C7FE3C5FDFF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>

HI Even,


I understand the good intention of cleaning up code but that should not remove functionality. You are breaking backward compatibility. What if someone updates GDAL in some installation, proj4 is there and it will not going to be used?


I my case, I *cannot* distribute proj4 into my GDAL build and I *need* to have the options to let the user decided if they want to add proj4 shared libraries.


Regards,

Ivan





________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Saturday, May 6, 2017 1:35:18 PM
To: Ivan Lucena
Cc: Kurt Schwehr; gdal dev
Subject: Re: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?


On samedi 6 mai 2017 17:04:33 CEST Ivan Lucena wrote:

> -1

>

>

> We have the options to build drivers against static and dynamic libraries of

> its SDKs, like HDF4,5 and openjpeg for example, using the same

> "--with-driver-name"

>

>

> Why not keep that same option for proj4?



I think you are confusing things. For a good reason since the --with-static-proj4 name is confusing. --with-static-proj4 can link against libproj.a or libproj.so depending on which is available, which is classic build time linking. My suggestion is to keep this as the only option to use proj.4, and rename it --with-proj4 for more clarity and consistency



When this option is not specified, proj4 is optionaly loaded through dlopen()/LoadLibrary(), which is runtime linking and what I'm proposing to drop for simplicity.



HDF4, 5, openjpeg are only supported through build time linking.



>

>

> --with-proj4=<static or dynamic>-library-path

>

>

> I have projects where I let user to decide if they want to download and

> install proj4 while using GDAL and I would prefer to keep that option.

>



Well, that seem to be a rather particular use case. Given the small size of libproj regarding libgdal, you could always build against proj.



After my cleanup and removal of pre-4.8 support, ogrct.cpp is now down to 1110 lines against 1311 before, and much easier to follow. And that save testing behaviour in --with-static-proj4 and --without-static-proj4 cases



>

> Maybe with a compiler option we can basically "remove" the dynamic load when

> static linked proj4 was used.



That's already the case. If currently you use --with-static-proj4, dynamic loading at runtime is disabled.



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/aacbde3d/attachment.html>

From andrew at aitchison.me.uk  Sat May  6 22:07:58 2017
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sun, 7 May 2017 06:07:58 +0100 (BST)
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <5820522.IAUbASQfYA@even-i700>
References: <3746074.miyZCyX2zc@even-i700> <5820522.IAUbASQfYA@even-i700>
Message-ID: <alpine.LRH.2.20.1705070602090.15640@warden.aitchison.me.uk>

On Sat, 6 May 2017, Even Rouault wrote:

> I'm intending to drop support for proj.4 < 4.8 too to do some cleanups

Red Hat / Centos / Scientific Linux 6 use proj4 v4.8.x
so I have no problem with this.

-- 
Andrew C. Aitchison					Cambridge, UK
 			andrew at aitchison.me.uk



From lucena_ivan at hotmail.com  Sat May  6 10:04:33 2017
From: lucena_ivan at hotmail.com (Ivan Lucena)
Date: Sat, 6 May 2017 17:04:33 +0000
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <CACmBxysJ3-RbLj7seayff=RO9TWzh6j4TS3mTWw6OX9am1bjOQ@mail.gmail.com>
References: <3746074.miyZCyX2zc@even-i700>,
 <CACmBxysJ3-RbLj7seayff=RO9TWzh6j4TS3mTWw6OX9am1bjOQ@mail.gmail.com>
Message-ID: <MWHPR19MB13283B691A86255C920203BAF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>

-1


We have the options to build drivers against static and dynamic libraries of its SDKs, like HDF4,5 and openjpeg for example, using the same "--with-driver-name"


Why not keep that same option for proj4?


--with-proj4=<static or dynamic>-library-path


I have projects where I let user to decide if they want to download and install proj4 while using GDAL and I would prefer to keep that option.


Maybe with a compiler option we can basically "remove" the dynamic load when static linked proj4 was used. Config can translate the --with-proj4 into a C++ define, right?


Regards,

Ivan


________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Kurt Schwehr <schwehr at gmail.com>
Sent: Saturday, May 6, 2017 11:20:34 AM
To: Even Rouault
Cc: gdal dev
Subject: Re: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?

+1

On May 6, 2017 4:58 AM, "Even Rouault" <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:

Hi,



Currently the default mode of linking GDAL with proj.4 is to use dynamic loading mechanism (dlopen on Unix, LoadLibary on Windows). I believe the reason for that was that it could have make it easier to use an alternate projection engine, but apparently nobody cared enough to plug a new one, and it could be done with standard linking. One downside of the current mechanism (besides code complication) is that it requires to list the exact library name of proj4 in GDAL source code, which can change depending on the soname of proj4. And this can cause subtle issues like

https://trac.osgeo.org/gdal/ticket/6881



So I'd suggest just keeping standard linking mechanism, and renaming the current --with-static-proj4 configure flag as --with-proj4, as the current name is confusing, and making it the default behaviour.



Any thoughts ?



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170506/d4192fbf/attachment-0001.html>

From warmerdam at pobox.com  Sun May  7 01:01:40 2017
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Sun, 7 May 2017 01:01:40 -0700
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <2307066.NY6f8sqCP9@even-i700>
References: <3746074.miyZCyX2zc@even-i700> <4168237.jFpgmP2sQ8@even-i700>
 <MWHPR19MB13283EA8D06216C7FE3C5FDFF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>
 <2307066.NY6f8sqCP9@even-i700>
Message-ID: <CA+YzLBfPODE=XkN7MfSdFT6Ze5-PVkAf9n428=SG4YjAaQEa9w@mail.gmail.com>

Even,

I'm +0 on this change.

On the one hand, I *like* the fact that the dlopen() approach means
that adding libproj.so after the fact means that GDAL starts
supporting coordinate system conversion without a rebuild.  On the
other hand, it isn't clear why we do this only for libproj.

I have some appreciation for Ivan's stated concerns with regard to
regression, but I don't think that should hold back cleanup in major
new versions.

Best regards,
Frank


On Sat, May 6, 2017 at 12:09 PM, Even Rouault
<even.rouault at spatialys.com> wrote:
> Ivan,
>
>
>
>> I understand the good intention of cleaning up code but that should not
>
>> remove functionality. You are breaking backward compatibility. What if
>
>> someone updates GDAL in some installation, proj4 is there and it will not
>
>> going to be used?
>
>
>
> Well that would be documented in the release notes... There are a number of
> breaks in each new release. That's not really different. And the way of
> solving in the case you mention is rather simple.
>
>
>
>> I my case, I *cannot* distribute proj4 into my GDAL build
>
>
>
> I've the feeling you're abusing -1 for a reason which you mentionned
> privately to me but in my opinion isn't really valid for the rest of the
> community. But this is not an important enough topic for me to fight about
> and create useless tensions among contributors.
>
>
>
> So I'm dropping the ball on this. For posterity, my patch is at:
>
> https://trac.osgeo.org/gdal/ticket/6882
>
>
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
light and sound - activate the windows |
and watch the world go round - Rush    | Geospatial Software Developer

From howard at hobu.co  Sun May  7 06:47:26 2017
From: howard at hobu.co (Howard Butler)
Date: Sun, 7 May 2017 08:47:26 -0500
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <CA+YzLBfPODE=XkN7MfSdFT6Ze5-PVkAf9n428=SG4YjAaQEa9w@mail.gmail.com>
References: <3746074.miyZCyX2zc@even-i700> <4168237.jFpgmP2sQ8@even-i700>
 <MWHPR19MB13283EA8D06216C7FE3C5FDFF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>
 <2307066.NY6f8sqCP9@even-i700>
 <CA+YzLBfPODE=XkN7MfSdFT6Ze5-PVkAf9n428=SG4YjAaQEa9w@mail.gmail.com>
Message-ID: <209F4F3A-6FF3-4BFA-A1A1-90DAAF0A2285@hobu.co>

I'm +1 on this. I too found it confusing that Proj.4 worked in this way and no other libraries did in GDAL.


> I my case, I *cannot* distribute proj4 into my GDAL build and I *need* to have the options to let the user decided if they want to add proj4 shared libraries.

Ivan,

I don't understand the scenario here. It isn't a licensing thing to prevent you from distributing Proj.4, and what do you do in the case of all of the other shared libraries that are linked at compile time that GDAL uses?

Howard

> 
> On May 7, 2017, at 3:01 AM, Frank Warmerdam <warmerdam at pobox.com> wrote:
> 
> Even,
> 
> I'm +0 on this change.
> 
> On the one hand, I *like* the fact that the dlopen() approach means
> that adding libproj.so after the fact means that GDAL starts
> supporting coordinate system conversion without a rebuild.  On the
> other hand, it isn't clear why we do this only for libproj.
> 
> I have some appreciation for Ivan's stated concerns with regard to
> regression, but I don't think that should hold back cleanup in major
> new versions.
> 
> Best regards,
> Frank
> 
> 
> On Sat, May 6, 2017 at 12:09 PM, Even Rouault
> <even.rouault at spatialys.com> wrote:
>> Ivan,
>> 
>> 
>> 
>>> I understand the good intention of cleaning up code but that should not
>> 
>>> remove functionality. You are breaking backward compatibility. What if
>> 
>>> someone updates GDAL in some installation, proj4 is there and it will not
>> 
>>> going to be used?
>> 
>> 
>> 
>> Well that would be documented in the release notes... There are a number of
>> breaks in each new release. That's not really different. And the way of
>> solving in the case you mention is rather simple.
>> 
>> 
>> 
>>> I my case, I *cannot* distribute proj4 into my GDAL build
>> 
>> 
>> 
>> I've the feeling you're abusing -1 for a reason which you mentionned
>> privately to me but in my opinion isn't really valid for the rest of the
>> community. But this is not an important enough topic for me to fight about
>> and create useless tensions among contributors.
>> 
>> 
>> 
>> So I'm dropping the ball on this. For posterity, my patch is at:
>> 
>> https://trac.osgeo.org/gdal/ticket/6882
>> 
>> 
>> 
>> 
>> 
>> Even
>> 
>> 
>> 
>> --
>> 
>> Spatialys - Geospatial professional services
>> 
>> http://www.spatialys.com
>> 
>> 
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> 
> -- 
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
> light and sound - activate the windows |
> and watch the world go round - Rush    | Geospatial Software Developer
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From johan.vandewauw at gmail.com  Mon May  8 04:40:21 2017
From: johan.vandewauw at gmail.com (Johan Van de Wauw)
Date: Mon, 8 May 2017 13:40:21 +0200
Subject: [gdal-dev] Binary of the latest released GDAL for travis?
In-Reply-To: <84117854-a9b7-161f-787a-8036691136c4@gmail.com>
References: <687680c4-bd24-2729-942c-81e5ef8b01a4@gmail.com>
 <d0c382f9bd2f96f8ec22d2b5df5a9f31@xs4all.nl>
 <4723b83d-fc99-e19b-1c84-7859f575151c@gmail.com>
 <3edc65ff-439c-2db8-b769-363aaf970801@gmail.com>
 <e767fe77-8f55-323b-9c94-6a87ce7f14c9@gmail.com>
 <747e351433ac6896b9a0bb85c38df781@xs4all.nl>
 <84117854-a9b7-161f-787a-8036691136c4@gmail.com>
Message-ID: <CAJOp35=-BVFbjX1-AvS1+p34+KYr9Phbco733jwfVr1=FdNypw@mail.gmail.com>

Ari,

I had similar problems. The problem is that an old version of gdal is
installed by travis by default (!)
adding
before-install:
- sudo apt-get remove -y libgdal1

fixed this for me on trusty (and on precise, but you will still not
get the latest version).

Kind Regards,
Johan

On Tue, Apr 11, 2017 at 12:48 PM, Ari Jolma <ari.jolma at gmail.com> wrote:
> 11.04.2017, 13:28, Bas Couwenberg kirjoitti:
>>
>> On 2017-04-11 12:22, Ari Jolma wrote:
>>>
>>> 11.04.2017, 13:05, Angelos Tzotsos kirjoitti:
>>>>
>>>> Hi Ari,
>>>>
>>>> sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
>>>> sudo apt-get update
>>>> sudo apt-get install libgdal-dev
>>>>
>>>> This should do it.
>>>
>>>
>>> No. I tried that before (found it in my .travis.yml file...) and it
>>> pulls in older version 1.10.0.
>>
>>
>> You can install the 2.1.3 version explicitly with:
>>
>>  sudo apt-get install libgdal-dev=2.1.3+dfsg-1~xenial2
>
>
> It seems it did not even try this. Probably because it is precise?
>
>>
>> But this will fail when the version is updated in the PPA.
>>
>> Is the travis environment using Ubuntu xenial, and not an older LTS like
>> trusty or precise? It's probably trusty since that ships with GDAL 1.10.1.
>
>
> It is precise. Trusty build environment is in beta.
>
>
>>
>> For those older LTS releases the UbuntuGIS packages haven't been updated
>> yet. Depending on manpower and motivation we may be able to updated the
>> trusty packages in the near future.
>
>
> It would save a lot of build time at least for me.
>
> The reason for me is that many of my project use the GDAL Perl bindings and
> for the tests I pull in the latest from CPAN, which is based on the latest
> released GDAL.
>
>>
>> Ideally the travis environment is upgraded to xenial for which the best
>> support is available and the default packages in Ubuntu itself are much more
>> current.
>
>
> ok
>
> Thanks,
>
> Ari
>
>
>>
>> Kind Regards,
>>
>> Bas
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From lucena_ivan at hotmail.com  Sun May  7 22:25:12 2017
From: lucena_ivan at hotmail.com (Ivan Lucena)
Date: Mon, 8 May 2017 05:25:12 +0000
Subject: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?
In-Reply-To: <209F4F3A-6FF3-4BFA-A1A1-90DAAF0A2285@hobu.co>
References: <3746074.miyZCyX2zc@even-i700> <4168237.jFpgmP2sQ8@even-i700>
 <MWHPR19MB13283EA8D06216C7FE3C5FDFF2E80@MWHPR19MB1328.namprd19.prod.outlook.com>
 <2307066.NY6f8sqCP9@even-i700>
 <CA+YzLBfPODE=XkN7MfSdFT6Ze5-PVkAf9n428=SG4YjAaQEa9w@mail.gmail.com>,
 <209F4F3A-6FF3-4BFA-A1A1-90DAAF0A2285@hobu.co>
Message-ID: <MWHPR19MB13285482B9A656EED915B9A4F2EE0@MWHPR19MB1328.namprd19.prod.outlook.com>

Hi Howard,


Yep. It is a license issue but I am not going to get into the details.


But apart from that, lets think about other scenarios:


An application is using GDAL and Proj4 and someone decide to update GDAL to get some bug fixes.


But GDAL is build *without* static Proj4 and therefore is blind to the presence of Proj4 shared library.


That would be a problem. Right?


Anyway. If the change makes sense and it is for the better. And it is for a new release (no backport).


+0 ( I can't vote anyway)


Best regards,


Ivan



________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Howard Butler <howard at hobu.co>
Sent: Sunday, May 7, 2017 9:47:26 AM
To: Frank Warmerdam
Cc: gdal dev
Subject: Re: [gdal-dev] Dropping dlopen/LoadLibrary loading of proj.4 ?

I'm +1 on this. I too found it confusing that Proj.4 worked in this way and no other libraries did in GDAL.


> I my case, I *cannot* distribute proj4 into my GDAL build and I *need* to have the options to let the user decided if they want to add proj4 shared libraries.

Ivan,

I don't understand the scenario here. It isn't a licensing thing to prevent you from distributing Proj.4, and what do you do in the case of all of the other shared libraries that are linked at compile time that GDAL uses?

Howard

>
> On May 7, 2017, at 3:01 AM, Frank Warmerdam <warmerdam at pobox.com> wrote:
>
> Even,
>
> I'm +0 on this change.
>
> On the one hand, I *like* the fact that the dlopen() approach means
> that adding libproj.so after the fact means that GDAL starts
> supporting coordinate system conversion without a rebuild.  On the
> other hand, it isn't clear why we do this only for libproj.
>
> I have some appreciation for Ivan's stated concerns with regard to
> regression, but I don't think that should hold back cleanup in major
> new versions.
>
> Best regards,
> Frank
>
>
> On Sat, May 6, 2017 at 12:09 PM, Even Rouault
> <even.rouault at spatialys.com> wrote:
>> Ivan,
>>
>>
>>
>>> I understand the good intention of cleaning up code but that should not
>>
>>> remove functionality. You are breaking backward compatibility. What if
>>
>>> someone updates GDAL in some installation, proj4 is there and it will not
>>
>>> going to be used?
>>
>>
>>
>> Well that would be documented in the release notes... There are a number of
>> breaks in each new release. That's not really different. And the way of
>> solving in the case you mention is rather simple.
>>
>>
>>
>>> I my case, I *cannot* distribute proj4 into my GDAL build
>>
>>
>>
>> I've the feeling you're abusing -1 for a reason which you mentionned
>> privately to me but in my opinion isn't really valid for the rest of the
>> community. But this is not an important enough topic for me to fight about
>> and create useless tensions among contributors.
>>
>>
>>
>> So I'm dropping the ball on this. For posterity, my patch is at:
>>
>> https://trac.osgeo.org/gdal/ticket/6882
>>
>>
>>
>>
>>
>> Even
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> --
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam at pobox.com
> light and sound - activate the windows |
> and watch the world go round - Rush    | Geospatial Software Developer
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170508/66605527/attachment.html>

From jbe at geo6.be  Mon May  8 06:39:35 2017
From: jbe at geo6.be (=?iso-8859-1?Q?Jonathan_Beli=EBn?=)
Date: Mon, 8 May 2017 15:39:35 +0200
Subject: [gdal-dev] ogr2ogr mapinfo reporjection
Message-ID: <01e401d2c800$89abf970$9d03ec50$@geo6.be>

Hello everyone, 

 

I struggle to reproject GeoJSON file to TAB (or MIF) file.

The source projection is EPSG:4326 and the destination projection is
EPSG:31370 (Belge 1972 / Belgian Lambert 72  Belgium :
http://epsg.io/31370)

 

I searched forums and mailing lists and saw that there was some issues with
reprojection using Mitab but that it is supposed to be fixed.

 

When I try the following command, the coordinates seems to be transformed
but the « coordsys » header in the TAB (or MIF) file is wrong (WGS84  Non
Earth)

 

ogr2ogr test.mif test.json -f "MapInfo File" -dsco FORMAT=MIF -s_srs
EPSG:4326 -t_srs EPSG:31370

 

If I understood correctly what I read on the Internet, thats because Mitab
does not recognise « EPSG:31370 » ;

I tried to replace « -t_srs EPSG:31370 » by « -t_srs "31370.txt" » where «
31370.txt » contained the WKT definition of EPSG:31370 ;

I saw in the ogr2ogr documentation that there is a « MITAB_BOUNDS_FILE »
parameter but did not find out how to use it
(http://www.gdal.org/drv_mitab.html) ;

 

I also searched in « /ogr/ogrsf_frmts/mitab/mitab_spatialref.cpp » to see if
« Belgian Lambert 1972 » existed and it does :

 

{ 0,    1019,"Belgian 1972 7 Parameter",   4, -99.059, 53.322, -112.486,
-0.419, 0.83, -1.885, 0.999999, 0},

 

So I suppose it should be possible to create a MapInfo file projected in «
Belgiam Lambert 1972 » but I do not understand how ?!

 

Any help or idea is welcome !
Thanks a lot !

 

Jonathan Beliën

GEO-6

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170508/89f225e5/attachment-0001.html>

From jlmcgraw at gmail.com  Mon May  8 11:46:45 2017
From: jlmcgraw at gmail.com (Jesse McGraw)
Date: Mon, 8 May 2017 14:46:45 -0400
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
Message-ID: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>

I think the gdal suite would be a perfect candidate for this project from google.  Is anyone interested in trying to integrate gdal into it?

https://opensource.googleblog.com/2017/05/oss-fuzz-five-months-later-and.html?m=1

From schwehr at gmail.com  Mon May  8 11:58:06 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 8 May 2017 11:58:06 -0700
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
In-Reply-To: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
References: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
Message-ID: <CACmBxyu_ON1NWZ5hmNtobjKVu1xwWH2gDPtF_H9A_g4h1PfuNg@mail.gmail.com>

Yup... https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046495.html

I'd be happy if anyone else wanted to take lead on it.

I've created https://trac.osgeo.org/gdal/ticket/6883

Since I'm internal to google, I've been running some fuzzer targets against
gdal behind the scenes and used the results to fix a number of bugs.  I've
added a number of fuzz targets to
https://github.com/schwehr/gdal-autotest2/tree/master/cpp and modified GDAL
to make fuzzing more productive... e.g.

https://trac.osgeo.org/gdal/changeset/37592/
adds FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION to a driver
https://trac.osgeo.org/gdal/changeset/37909 example fix

I have ~50 bugs that I haven't gotten to.

On Mon, May 8, 2017 at 11:46 AM, Jesse McGraw <jlmcgraw at gmail.com> wrote:

> I think the gdal suite would be a perfect candidate for this project from
> google.  Is anyone interested in trying to integrate gdal into it?
>
> https://opensource.googleblog.com/2017/05/oss-fuzz-five-
> months-later-and.html?m=1
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev




-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170508/ef2948ad/attachment.html>

From jlmcgraw at gmail.com  Mon May  8 12:43:12 2017
From: jlmcgraw at gmail.com (Jesse McGraw)
Date: Mon, 8 May 2017 15:43:12 -0400
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
In-Reply-To: <CACmBxyu_ON1NWZ5hmNtobjKVu1xwWH2gDPtF_H9A_g4h1PfuNg@mail.gmail.com>
References: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
 <CACmBxyu_ON1NWZ5hmNtobjKVu1xwWH2gDPtF_H9A_g4h1PfuNg@mail.gmail.com>
Message-ID: <43D2E5DA-F69C-404C-9730-6BA37DDC1E5D@gmail.com>

Nice to see that I'm only 3 weeks behind the curve!

> On May 8, 2017, at 2:58 PM, Kurt Schwehr <schwehr at gmail.com> wrote:
> 
> Yup... https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046495.html
> 
> I'd be happy if anyone else wanted to take lead on it.
> 
> I've created https://trac.osgeo.org/gdal/ticket/6883
> 
> Since I'm internal to google, I've been running some fuzzer targets against gdal behind the scenes and used the results to fix a number of bugs.  I've added a number of fuzz targets to https://github.com/schwehr/gdal-autotest2/tree/master/cpp and modified GDAL to make fuzzing more productive... e.g. 
> 
> https://trac.osgeo.org/gdal/changeset/37592/ adds FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION to a driver
> https://trac.osgeo.org/gdal/changeset/37909 example fix
> 
> I have ~50 bugs that I haven't gotten to.
> 
>> On Mon, May 8, 2017 at 11:46 AM, Jesse McGraw <jlmcgraw at gmail.com> wrote:
>> I think the gdal suite would be a perfect candidate for this project from google.  Is anyone interested in trying to integrate gdal into it?
>> 
>> https://opensource.googleblog.com/2017/05/oss-fuzz-five-months-later-and.html?m=1
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> 
> -- 
> --
> http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170508/4284a496/attachment.html>

From richard.greenwood at gmail.com  Mon May  8 16:32:27 2017
From: richard.greenwood at gmail.com (Richard Greenwood)
Date: Mon, 8 May 2017 17:32:27 -0600
Subject: [gdal-dev] ogr2ogr mapinfo reporjection
In-Reply-To: <01e401d2c800$89abf970$9d03ec50$@geo6.be>
References: <01e401d2c800$89abf970$9d03ec50$@geo6.be>
Message-ID: <CAHBySPZOM5PGG-doVfqgATjutj7qnborSHDDKHHUov-V8Vyo0w@mail.gmail.com>

When you say that the coordsys header is wrong, are you looking at it in
MapInfo or in a text editor? If you look at the MIF file coordinates in a
text editor do they look like they have been correctly transformed, and it
is just the header that is wrong?

On Mon, May 8, 2017 at 7:39 AM, Jonathan Beliën <jbe at geo6.be> wrote:

> Hello everyone,
>
>
>
> I struggle to reproject GeoJSON file to TAB (or MIF) file.
>
> The source projection is EPSG:4326 and the destination projection is
> EPSG:31370 (Belge 1972 / Belgian Lambert 72 – Belgium :
> http://epsg.io/31370)
>
>
>
> I searched forums and mailing lists and saw that there was some issues
> with reprojection using Mitab but that it is supposed to be fixed.
>
>
>
> When I try the following command, the coordinates seems to be transformed
> but the « coordsys » header in the TAB (or MIF) file is wrong (WGS84 –
> Non Earth)
>
>
>
> ogr2ogr test.mif test.json -f "MapInfo File" -dsco FORMAT=MIF -s_srs
> EPSG:4326 -t_srs EPSG:31370
>
>
>
> If I understood correctly what I read on the Internet, that’s because
> Mitab does not recognise « EPSG:31370 » ;
>
> I tried to replace « -t_srs EPSG:31370 » by « -t_srs "31370.txt" » where
> « 31370.txt » contained the WKT definition of EPSG:31370 ;
>
> I saw in the ogr2ogr documentation that there is a « MITAB_BOUNDS_FILE »
> parameter but did not find out how to use it (http://www.gdal.org/drv_
> mitab.html) ;
>
>
>
> I also searched in « /ogr/ogrsf_frmts/mitab/mitab_spatialref.cpp » to see
> if « Belgian Lambert 1972 » existed and it does :
>
>
>
> { 0,    1019,"Belgian 1972 7 Parameter",   4, -99.059, 53.322, -112.486,
> -0.419, 0.83, -1.885, 0.999999, 0},
>
>
>
> So I suppose it should be possible to create a MapInfo file projected in
> « Belgiam Lambert 1972 » but I do not understand how ?!
>
>
>
> Any help or idea is welcome !
> Thanks a lot !
>
>
>
> Jonathan Beliën
>
> GEO-6
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Richard W. Greenwood, PLS
www.greenwoodmap.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170508/d673c648/attachment.html>

From even.rouault at spatialys.com  Tue May  9 01:09:05 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 09 May 2017 10:09:05 +0200
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <4475580.g48Zu0Nnsh@even-i700>
References: <4475580.g48Zu0Nnsh@even-i700>
Message-ID: <2037969.kTY1f3RDOp@even-i700>

> 
> Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final
> release.
> 

I declare this motion passed with +1 from PSC members HowardB, JukkaR, 
DanielM and myself.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/410cfa50/attachment.html>

From osahon.gis at gmail.com  Tue May  9 01:15:49 2017
From: osahon.gis at gmail.com (Osahon Oduware)
Date: Tue, 9 May 2017 09:15:49 +0100
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <2037969.kTY1f3RDOp@even-i700>
References: <4475580.g48Zu0Nnsh@even-i700> <2037969.kTY1f3RDOp@even-i700>
Message-ID: <CAGpiUSguO6d4ZXbb681rk-7CFM6G7=fP5bmsZgxMUDGE64XPbw@mail.gmail.com>

Does GDAL now support PostGIS Out-DB Rasters as described in the forwarded
mail below?

---------- Forwarded message ----------
From: Osahon Oduware <osahon.gis at gmail.com>
Date: Fri, Apr 28, 2017 at 3:10 PM
Subject: GDAL OUT-DB RASTER SUPPORT
To: PostGIS Users Discussion <postgis-users at lists.osgeo.org>

Hi All,

I am getting a black image when I try to display PostGIS out-db rasters. I
discovered that it has to do with GDAL support for out-db rasters as stated
in the link below for a similar issue (over 1 year back):
https://hub.qgis.org/issues/12133

The last comment by Jürgen Fischer states "... only black images. So it's a
dependency issue (GDAL complains ERROR 1: This raster has outdb storage.
This feature isn't still available)."

I have also been told in the link below that "out-db support is not
implemented yet in the GDAL PostGISRaster driver.":
https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046512.html

I would like to know how to solve this issue of displaying postgis out-db
rasters in QGIS?


On Tue, May 9, 2017 at 9:09 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> >
>
> > Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final
>
> > release.
>
> >
>
>
>
> I declare this motion passed with +1 from PSC members HowardB, JukkaR,
> DanielM and myself.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/d84a7bfc/attachment-0001.html>

From even.rouault at spatialys.com  Tue May  9 01:42:47 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 09 May 2017 10:42:47 +0200
Subject: [gdal-dev] Motion: Promote GDAL 2.2.0 RC1 for release
In-Reply-To: <CAGpiUSguO6d4ZXbb681rk-7CFM6G7=fP5bmsZgxMUDGE64XPbw@mail.gmail.com>
References: <4475580.g48Zu0Nnsh@even-i700> <2037969.kTY1f3RDOp@even-i700>
 <CAGpiUSguO6d4ZXbb681rk-7CFM6G7=fP5bmsZgxMUDGE64XPbw@mail.gmail.com>
Message-ID: <3851266.6DCTDfWpx9@even-i700>

On mardi 9 mai 2017 09:15:49 CEST Osahon Oduware wrote:
> Does GDAL now support PostGIS Out-DB Rasters as described in the forwarded
> mail below?

Osahon,

No, I think you might want have a look at
https://nyalldawson.net/2016/08/how-to-effectively-get-things-changed-in-qgis/
This talks about QGIS but this pretty much applies to all open source projects.

Best regards,

Even

> 
> ---------- Forwarded message ----------
> From: Osahon Oduware <osahon.gis at gmail.com>
> Date: Fri, Apr 28, 2017 at 3:10 PM
> Subject: GDAL OUT-DB RASTER SUPPORT
> To: PostGIS Users Discussion <postgis-users at lists.osgeo.org>
> 
> Hi All,
> 
> I am getting a black image when I try to display PostGIS out-db rasters. I
> discovered that it has to do with GDAL support for out-db rasters as stated
> in the link below for a similar issue (over 1 year back):
> https://hub.qgis.org/issues/12133
> 
> The last comment by Jürgen Fischer states "... only black images. So it's a
> dependency issue (GDAL complains ERROR 1: This raster has outdb storage.
> This feature isn't still available)."
> 
> I have also been told in the link below that "out-db support is not
> implemented yet in the GDAL PostGISRaster driver.":
> https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046512.html
> 
> I would like to know how to solve this issue of displaying postgis out-db
> rasters in QGIS?
> 
> 
> On Tue, May 9, 2017 at 9:09 AM, Even Rouault <even.rouault at spatialys.com>
> 
> wrote:
> > > Motion: GDAL/OGR 2.2.0 RC1 is promoted to be the official 2.2.0 final
> > > 
> > > release.
> > 
> > I declare this motion passed with +1 from PSC members HowardB, JukkaR,
> > DanielM and myself.
> > 
> > 
> > 
> > Even
> > 
> > 
> > 
> > --
> > 
> > Spatialys - Geospatial professional services
> > 
> > http://www.spatialys.com
> > 
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/3a7fba19/attachment.html>

From kassies at gmail.com  Tue May  9 01:46:00 2017
From: kassies at gmail.com (Rutger)
Date: Tue, 9 May 2017 01:46:00 -0700 (MST)
Subject: [gdal-dev] Handling PostGIS's geojson output with a Z dimensions
Message-ID: <1494319560840-5319840.post@n6.nabble.com>

Dear all,

I have a Python script rasterizing polygons which are imported with OGR from
GeoJSON. The GeoJSON is created by PostGIS and send over the network (direct
connection to the db is not possible).

This has worked very well until it started to crash the Python interpreter,
a hard crash with no traceback/error whatsoever. Which made it hard to
debug, but after isolating the specific case i noticed it crashed on an
empty polygon with a Z dimension. Rasterizing an empty polygon with GDAL is
useless, but normally works fine.

If you convert an empty 2D MultiPolgon in PostGIS to GeoJSON it looks like:
'{"type": "MultiPolygon", "coordinates": []}'

The above is handled very well, ogr.CreateGeometryFromJson() converts this
into a proper geom, and its IsEmpty() method returns True. 

Now an empty 25D MultiPolygon from PostGIS looks like:
'{"type": "MultiPolygon", "coordinates": [[[]]]}'

Which ogr converts to a geom, but the IsEmpty() method retuns False now,
which is why it slipped through and ended up in my gdal.Rasterize call.
Exporting this geom to WKT shows 'MULTIPOLYGON EMPTY' as you would expect. 

Passing this to gdal.Rasterize causes the crash, whereas it properly
rasterizes the 2D empty polygon.

A few resulting questions; 
Is the output from PostGIS valid GeoJSON? I briefly skimmed the geojson
spec, but couldnt find something about nested empty arrays. If its valid,
should gdal.Rasterize handle this without crashing? Or if I as an end user
have to handle this, what is the appropriate way? Since IsEmpty() doesnt
catch it, a workaround might be to use an additional Export/Import step
running it through wkt for example:
geom = ogr.CreateGeometryFromJson('{"type": "MultiPolygon", "coordinates":
[[]]}')
geom = ogr.CreateGeometryFromWkt(geom.ExportToWkt())

I don't have full control over the PostGIS queries on the back-end, so even
though ST_FORCE2D() would also work, i would rather catch this on the
front-end as well. 

Here is a notebook replicating the case:
http://nbviewer.jupyter.org/gist/RutgerK/47412685882ed3f518c70fd09f57691c


Regards,
Rutger







--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Handling-PostGIS-s-geojson-output-with-a-Z-dimensions-tp5319840.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Tue May  9 01:54:24 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 09 May 2017 10:54:24 +0200
Subject: [gdal-dev] GDAL 2.2.0 is released
Message-ID: <7111563.iebIWHITCE@even-i700>

Hi,

On behalf of the GDAL/OGR development team and community, I am pleased to
announce the release of GDAL/OGR 2.2.0.  GDAL/OGR is a C++ geospatial
data access library for raster and vector file formats, databases and
web services.  It includes bindings for several languages, and a variety
of command line tools.

   http://www.gdal.org/

The 2.2.0 release is a major new feature release with the following 
highlights:

* New GDAL/raster drivers:
 - DERIVED driver: read-support. Expose subdatasets in a a new metadata domain, called 
DERIVED_SUBDATASETS
 - JP2Lura driver: read/create support for JPEG-2000 images using Luratech JP2 Library
 - PRF: add read-only support for PHOTOMOD PRF file format driver (github #173)
 - RRASTER driver: read-support .grd/.gri files handled by the R 'raster' package (#6249)
* New OGR/vector drivers:
 - CAD driver: read support for DWG R2000 files (GSoC 2016 project)
 - DGNv8 driver: read-write support for DGN 8.0 format (using Teigha ODA libraries)
 - GMLAS driver: read-write support. XML/GML driver driven by Application Schemas.
* New utility script: ogrmerge.py to merge several vector datasets into a single one
* New /vsigs/ and /vsigs_streaming/ virtual file systems to read Google Cloud Storage non-
public files
* Significantly improved drivers:
 - NWT_GRD: write support (#6533)
 - FileGDB/OpenFileGDB: add support to read curve geometries (#5890)
 - VRT derived band: add the capability to define pixel functions in Python
 - Add read support for RasterLite2 coverages in SQLite driver
 - GPKG: implement tiled gridded elevation data extension
 - ISIS3: add write support and improve read support

* RFC 63: Add GDALRasterBand::GetDataCoverageStatus() and implement it in GTiff and 
VRT drivers
        https://trac.osgeo.org/gdal/wiki/rfc63_sparse_datasets_improvements
* RFC 64: Triangle, Polyhedral surface and TIN
        https://trac.osgeo.org/gdal/wiki/rfc64_triangle_polyhedralsurface_tin
    ==> this RFC introduces potential backward incompatible behaviour.
        Consult MIGRATION_GUIDE.txt
* RFC 66: OGR random layer read/write capabilities
        https://trac.osgeo.org/gdal/wiki/rfc66_randomlayerreadwrite
* RFC 67: add null field state for OGR features, in addition to unset fields
        https://trac.osgeo.org/gdal/wiki/rfc67_nullfieldvalues
    ==> this RFC introduces potential backward incompatible behaviour.
        Consult MIGRATION_GUIDE.txt
* Upgrade to EPSG database v9.0 (#6772)
* Python bindings: Global Interpreter Lock (GIL) released before entering GDAL native code 
(for all, in GDAL module and a few ones in ogr like ogr.Open())
* Continued major efforts on sanitization of code base
* Remove bridge and vb6 bindings (#6640)
* GNM built by default

More complete information on the new features and fixes in the 2.2.0
release can be found at:

  http://trac.osgeo.org/gdal/wiki/Release/2.2.0-News

The release can be downloaded from:
  * http://download.osgeo.org/gdal/2.2.0/gdal220.zip - source as a zip
  * http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0.tar.gz - source as 
.tar.gz
  * http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0.tar.xz - source as 
.tar.xz
  * http://download.osgeo.org/gdal/2.2.0/gdal-grass-2.2.0.tar.gz - GDAL-GRASS plugin
  * http://download.osgeo.org/gdal/2.2.0/gdalautotest-2.2.0.tar.gz - test 
suite
  * http://download.osgeo.org/gdal/2.2.0/gdal220doc.zip - documentation / 
website

The migration guide can be found at  :
      https://svn.osgeo.org/gdal/branches/2.2/gdal/MIGRATION_GUIDE.TXT

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/4917fb30/attachment-0001.html>

From even.rouault at spatialys.com  Tue May  9 03:42:07 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 09 May 2017 12:42:07 +0200
Subject: [gdal-dev] Handling PostGIS's geojson output with a Z dimensions
In-Reply-To: <1494319560840-5319840.post@n6.nabble.com>
References: <1494319560840-5319840.post@n6.nabble.com>
Message-ID: <11862971.4cT7AVg53c@even-i700>

On mardi 9 mai 2017 01:46:00 CEST Rutger wrote:
> Dear all,
> 
> I have a Python script rasterizing polygons which are imported with OGR from
> GeoJSON. The GeoJSON is created by PostGIS and send over the network
> (direct connection to the db is not possible).
> 
> This has worked very well until it started to crash the Python interpreter,
> a hard crash with no traceback/error whatsoever. Which made it hard to
> debug, but after isolating the specific case i noticed it crashed on an
> empty polygon with a Z dimension. Rasterizing an empty polygon with GDAL is
> useless, but normally works fine.

This sounds pretty much like
https://trac.osgeo.org/gdal/ticket/6844
Fixed in 2.2.0 and in 2.1 branch (post 2.1.3)

Your workaround of exporting to WKT and re-importing from it is a good one.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/a67691b4/attachment.html>

From kassies at gmail.com  Tue May  9 04:28:25 2017
From: kassies at gmail.com (Rutger)
Date: Tue, 9 May 2017 04:28:25 -0700 (MST)
Subject: [gdal-dev] Handling PostGIS's geojson output with a Z dimensions
In-Reply-To: <11862971.4cT7AVg53c@even-i700>
References: <1494319560840-5319840.post@n6.nabble.com>
 <11862971.4cT7AVg53c@even-i700>
Message-ID: <1494329305296-5319865.post@n6.nabble.com>

Even,

It does indeed, thanks for pointing that out. I guess i should have read the
release notes before posting this. :)

I'll test it as soon as "conda-forge" has a GDAL build of 2.2 to confirm. 

Congratulations on the release btw, lots of good features! 


Regards,
Rutger



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Handling-PostGIS-s-geojson-output-with-a-Z-dimensions-tp5319840p5319865.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From jbe at geo6.be  Tue May  9 01:20:32 2017
From: jbe at geo6.be (=?utf-8?Q?Jonathan_Beli=C3=ABn?=)
Date: Tue, 9 May 2017 10:20:32 +0200
Subject: [gdal-dev] ogr2ogr mapinfo reporjection
In-Reply-To: <CAHBySPZOM5PGG-doVfqgATjutj7qnborSHDDKHHUov-V8Vyo0w@mail.gmail.com>
References: <01e401d2c800$89abf970$9d03ec50$@geo6.be>
 <CAHBySPZOM5PGG-doVfqgATjutj7qnborSHDDKHHUov-V8Vyo0w@mail.gmail.com>
Message-ID: <007001d2c89d$23bf5c90$6b3e15b0$@geo6.be>

Hello Richard,

 

When I look at the resulting MIF file in a text editor, the coordinates are indeed correctly transformed but the header is 

 

CoordSys Earth Projection 3, 104, "m", 4.36748666666667, 90, 51.1666672333333, 49.8333339, 150000.013, 5400088.438

 

instead of

 

CoordSys Earth Projection 3, 1019, "m", 4.3674866667, 90, 49.8333339, 51.1666672333, 150000.01300000001, 5400088.4380000001 Bounds (0, 0) (300000, 300000)

 

Thanks for your help !

 

Jonathan Beliën

GEO-6

 

De : Richard Greenwood [mailto:richard.greenwood at gmail.com] 
Envoyé : mardi 9 mai 2017 01:32
À : Jonathan Beliën <jbe at geo6.be>
Cc : mitab at egroups.com; GDAL List <gdal-dev at lists.osgeo.org>; Hellemans, Philippe <phe at geo6.be>
Objet : Re: [gdal-dev] ogr2ogr mapinfo reporjection

 

When you say that the coordsys header is wrong, are you looking at it in MapInfo or in a text editor? If you look at the MIF file coordinates in a text editor do they look like they have been correctly transformed, and it is just the header that is wrong?

 

On Mon, May 8, 2017 at 7:39 AM, Jonathan Beliën <jbe at geo6.be <mailto:jbe at geo6.be> > wrote:

Hello everyone, 

 

I struggle to reproject GeoJSON file to TAB (or MIF) file.

The source projection is EPSG:4326 and the destination projection is EPSG:31370 (Belge 1972 / Belgian Lambert 72 – Belgium : http://epsg.io/31370)

 

I searched forums and mailing lists and saw that there was some issues with reprojection using Mitab but that it is supposed to be fixed.

 

When I try the following command, the coordinates seems to be transformed but the « coordsys » header in the TAB (or MIF) file is wrong (WGS84 – Non Earth)

 

ogr2ogr test.mif test.json -f "MapInfo File" -dsco FORMAT=MIF -s_srs EPSG:4326 -t_srs EPSG:31370

 

If I understood correctly what I read on the Internet, that’s because Mitab does not recognise « EPSG:31370 » ;

I tried to replace « -t_srs EPSG:31370 » by « -t_srs "31370.txt" » where « 31370.txt » contained the WKT definition of EPSG:31370 ;

I saw in the ogr2ogr documentation that there is a « MITAB_BOUNDS_FILE » parameter but did not find out how to use it (http://www.gdal.org/drv_mitab.html) ;

 

I also searched in « /ogr/ogrsf_frmts/mitab/mitab_spatialref.cpp » to see if « Belgian Lambert 1972 » existed and it does :

 

{ 0,    1019,"Belgian 1972 7 Parameter",   4, -99.059, 53.322, -112.486, -0.419, 0.83, -1.885, 0.999999, 0},

 

So I suppose it should be possible to create a MapInfo file projected in « Belgiam Lambert 1972 » but I do not understand how ?!

 

Any help or idea is welcome !
Thanks a lot !

 

Jonathan Beliën

GEO-6

 


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org> 
https://lists.osgeo.org/mailman/listinfo/gdal-dev





 

-- 

Richard W. Greenwood, PLS
www.greenwoodmap.com <http://www.greenwoodmap.com> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/d06c6d97/attachment.html>

From bontepaarden at gmail.com  Tue May  9 05:25:58 2017
From: bontepaarden at gmail.com (Paul Meems)
Date: Tue, 9 May 2017 14:25:58 +0200
Subject: [gdal-dev] Convert false-color single band tiff to png
Message-ID: <CAHNf2YSbDhBJR_HHRpVhONMAF9vRPheFmbW8CxJGj+rnwBvsMg@mail.gmail.com>

I'm having trouble converting a false-color single band tiff to png.

Most of my tiff-files I can convert using GdalDem and a color table, this
works great.
But some tiff-files are pre-processed and I need to convert them as is.

This is the tiff:
[image: Inline afbeelding 1]

I tried with gdal_translate:
gdal_translate -of PNG my.tif my.png
But then I get a mostly white png. I also tried several other options.
The range of the tiff-file is from 1842 - 2636.
Does this mean I'm bound to use a color table file and use GdalDem or is
another solution possible?

The tiff-files are send to my from an outside source I have no control
about them.
I need the png-files because I'm showing the files in OpenLayers.

How can I do the conversion properly?

Thanks,

Paul Meems
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/e0bdd55c/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 9511 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/e0bdd55c/attachment-0001.png>

From even.rouault at spatialys.com  Tue May  9 05:28:31 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 09 May 2017 14:28:31 +0200
Subject: [gdal-dev] Convert false-color single band tiff to png
In-Reply-To: <CAHNf2YSbDhBJR_HHRpVhONMAF9vRPheFmbW8CxJGj+rnwBvsMg@mail.gmail.com>
References: <CAHNf2YSbDhBJR_HHRpVhONMAF9vRPheFmbW8CxJGj+rnwBvsMg@mail.gmail.com>
Message-ID: <4854967.bnUIXGgTH6@even-i700>

On mardi 9 mai 2017 14:25:58 CEST Paul Meems wrote:
> I'm having trouble converting a false-color single band tiff to png.
> 
> Most of my tiff-files I can convert using GdalDem and a color table, this
> works great.
> But some tiff-files are pre-processed and I need to convert them as is.
> 
> This is the tiff:
> [image: Inline afbeelding 1]
> 
> I tried with gdal_translate:
> gdal_translate -of PNG my.tif my.png
> But then I get a mostly white png. I also tried several other options.
> The range of the tiff-file is from 1842 - 2636.
> Does this mean I'm bound to use a color table file and use GdalDem or is
> another solution possible?

Look at the -scale switch of gdal_translate

> 
> The tiff-files are send to my from an outside source I have no control
> about them.
> I need the png-files because I'm showing the files in OpenLayers.
> 
> How can I do the conversion properly?
> 
> Thanks,
> 
> Paul Meems


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/99131a44/attachment.html>

From bontepaarden at gmail.com  Tue May  9 05:56:29 2017
From: bontepaarden at gmail.com (Paul Meems)
Date: Tue, 9 May 2017 14:56:29 +0200
Subject: [gdal-dev] Convert false-color single band tiff to png
In-Reply-To: <4854967.bnUIXGgTH6@even-i700>
References: <CAHNf2YSbDhBJR_HHRpVhONMAF9vRPheFmbW8CxJGj+rnwBvsMg@mail.gmail.com>
 <4854967.bnUIXGgTH6@even-i700>
Message-ID: <CAHNf2YSdD==T_F6GbsotxGMru0qrQFTy06Crbvg_rzX+zVt-Qw@mail.gmail.com>

Thanks Even,

I did look at the -scale switch but probably not correct.
This is working:
gdal_translate -of PNG -ot Byte -scale my.tif my.png

Regards,

Paul

2017-05-09 14:28 GMT+02:00 Even Rouault <even.rouault at spatialys.com>:

> On mardi 9 mai 2017 14:25:58 CEST Paul Meems wrote:
>
> > I'm having trouble converting a false-color single band tiff to png.
>
> >
>
> > Most of my tiff-files I can convert using GdalDem and a color table, this
>
> > works great.
>
> > But some tiff-files are pre-processed and I need to convert them as is.
>
> >
>
> > This is the tiff:
>
> > [image: Inline afbeelding 1]
>
> >
>
> > I tried with gdal_translate:
>
> > gdal_translate -of PNG my.tif my.png
>
> > But then I get a mostly white png. I also tried several other options.
>
> > The range of the tiff-file is from 1842 - 2636.
>
> > Does this mean I'm bound to use a color table file and use GdalDem or is
>
> > another solution possible?
>
>
>
> Look at the -scale switch of gdal_translate
>
>
>
> >
>
> > The tiff-files are send to my from an outside source I have no control
>
> > about them.
>
> > I need the png-files because I'm showing the files in OpenLayers.
>
> >
>
> > How can I do the conversion properly?
>
> >
>
> > Thanks,
>
> >
>
> > Paul Meems
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/f4d35ba5/attachment.html>

From gane.prog at gmail.com  Tue May  9 06:01:40 2017
From: gane.prog at gmail.com (Gane R)
Date: Tue, 9 May 2017 18:31:40 +0530
Subject: [gdal-dev] Build PDFium with GDAL
Message-ID: <CALMrLdCZfzjLh+kgvPFQsLBB6DQvNn6+TUxbo99xoksa9uGv6A@mail.gmail.com>

Hi all,
I am trying to build GDAL with PDFium

I saw the link
https://github.com/rouault/pdfium/tree/build

I tried to use the linux script and the pdfium static lib to build. *pdfium
build succeed.*

I have few Questions:

Q1: I see some 3rdpary dependency for PDFium, I don't see those LICENSES
included, does overall including the 3rparty dependency, PDFium library
comes to point like similar to MIT license ?.

Q2. Can we do a cross compile with for PDFium, or any one tried.

Q3. Has any one got an error like this (error message follows in next few
lines) ? or I have gone wrong in build steps.

I started to build GDAL gdal-2.2.0 with pdfium

./configure --with-pdfium=/home/pdfium/install

libtool: link: g++ .libs/gdalinfo_bin.o -o .libs/gdalinfo
/home/works/gdal_fresh/gdal-2.2.0/.libs/libgdal.so -L/home/pdfium/install
-L/home/pdfium/install/lib/pdfium -lpdfium -lfpdfapi -lfpdftext
-lformfiller -lpdfwindow -lfxedit -lfpdfdoc -lfxcodec -lfx_libopenjpeg
-lfx_lcms2 -lfx_libjpeg -lfx_zlib -lfdrm -lfxge -lfreetype -lfx_agg -lfxcrt
-lbigint -lz -lpthread -lrt -ldl
/usr/bin/ld: .libs/gdalinfo: hidden symbol
`_ZN13CFDF_Document12CreateNewDocEv' in
/home/pdfium/install/lib/pdfium/libfpdfapi.a(fpdf_parser_fdf.o) is
referenced by DSO
/usr/bin/ld: final link failed: Bad value
collect2: error: ld returned 1 exit status
GNUmakefile:82: recipe for target 'gdalinfo' failed
make[1]: *** [gdalinfo] Error 1
make[1]: Leaving directory '/home/works/gdal_fresh/gdal-2.2.0/apps'
GNUmakefile:93: recipe for target 'apps-target' failed
make: *** [apps-target] Error 2

Thanks
Gane R
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/c7e17fb7/attachment.html>

From mateusz at loskot.net  Tue May  9 13:21:45 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 9 May 2017 22:21:45 +0200
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
In-Reply-To: <CACmBxyu_ON1NWZ5hmNtobjKVu1xwWH2gDPtF_H9A_g4h1PfuNg@mail.gmail.com>
References: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
 <CACmBxyu_ON1NWZ5hmNtobjKVu1xwWH2gDPtF_H9A_g4h1PfuNg@mail.gmail.com>
Message-ID: <CABUeae_C_QY4MPfy-qEmjg0wZsiYBzy8kNLi1dpviC7WgFO0Vg@mail.gmail.com>

On 8 May 2017 at 20:58, Kurt Schwehr <schwehr at gmail.com> wrote:
> Yup... https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046495.html
>
> I'd be happy if anyone else wanted to take lead on it.

I'd really like to, but due to newborn & family duties I'm not going
to promise anything.

> I've added a number of fuzz targets to
> https://github.com/schwehr/gdal-autotest2/tree/master/cpp and modified GDAL
> to make fuzzing more productive... e.g.
>
> https://trac.osgeo.org/gdal/changeset/37592/ adds
> FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION to a driver
> https://trac.osgeo.org/gdal/changeset/37909 example fix

The autotest2 efforts are awesome, but huge'ish and without RFC(s)
and lots of work, they won't make it into GDAL any time soon, I suspect.

So, wonder if we could integrate with oss-fuzz at smaller scale:
- create /fuzzer direcotry (next to /gdal  and /autotest)
- port fuzz targets only from Kurt's
https://github.com/schwehr/gdal-autotest2/blob/master/cpp/
- add minimal integration with GDAL build config for Unix

and basically follow
https://github.com/google/oss-fuzz/blob/master/docs/ideal_integration.md

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From schwehr at gmail.com  Tue May  9 14:13:13 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 9 May 2017 14:13:13 -0700
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
In-Reply-To: <CABUeae_C_QY4MPfy-qEmjg0wZsiYBzy8kNLi1dpviC7WgFO0Vg@mail.gmail.com>
References: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
 <CACmBxyu_ON1NWZ5hmNtobjKVu1xwWH2gDPtF_H9A_g4h1PfuNg@mail.gmail.com>
 <CABUeae_C_QY4MPfy-qEmjg0wZsiYBzy8kNLi1dpviC7WgFO0Vg@mail.gmail.com>
Message-ID: <CACmBxyvHJ+iqwP=tcE8TEMRhztO6QTds9_LC1NvngLe0+DbyDw@mail.gmail.com>

My suggestion is to just cherry pick or use as examples the fuzzer targets
in autotest2.  Google is okay with them being contributed the core GDAL
code base under the GDAL license.  The LLVMFuzzerTestOneInput functions are
super simple for drivers and calls that support vsimem.

As for autotest2...

I make assumptions in autotest2 that are just not valid (yet or anytime
soon) in GDAL... especially C++11 support and a lot of Google's opensource
libraries (e.g. gunit, gmock, logging, absl, bazel, etc.).  I haven't been
able to see a near term path of getting autotest2 into mainline GDAL, so
I've just not worried about it.  It's such a massive win for me, that it's
okay for me now if it's stand alone.  People are welcome to use that code
in their projects or as examples of API use as it's all Apache 2.0
licensed.  But if there is desire in the community, I'm definitely open to
(and would prefer) if autotest2 was eventually a part of GDAL itself.

And if there are any parts of autotest2 that people want moved into GDAL,
I'd be happy to commit them as a contribution to GDAL (it would then be
under the GDAL license).  e.g. I find VsiMemTempWrapper and
WithQuietHandler super handy for testing and the CHECK's could be ported to
GDAL, replaced with something from GDAL, or the class could be changed to
expose error reporting.

On Tue, May 9, 2017 at 1:21 PM, Mateusz Loskot <mateusz at loskot.net> wrote:

> On 8 May 2017 at 20:58, Kurt Schwehr <schwehr at gmail.com> wrote:
> > Yup... https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046495.html
> >
> > I'd be happy if anyone else wanted to take lead on it.
>
> I'd really like to, but due to newborn & family duties I'm not going
> to promise anything.
>
> > I've added a number of fuzz targets to
> > https://github.com/schwehr/gdal-autotest2/tree/master/cpp and modified
> GDAL
> > to make fuzzing more productive... e.g.
> >
> > https://trac.osgeo.org/gdal/changeset/37592/ adds
> > FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION to a driver
> > https://trac.osgeo.org/gdal/changeset/37909 example fix
>
> The autotest2 efforts are awesome, but huge'ish and without RFC(s)
> and lots of work, they won't make it into GDAL any time soon, I suspect.
>
> So, wonder if we could integrate with oss-fuzz at smaller scale:
> - create /fuzzer direcotry (next to /gdal  and /autotest)
> - port fuzz targets only from Kurt's
> https://github.com/schwehr/gdal-autotest2/blob/master/cpp/
> - add minimal integration with GDAL build config for Unix
>
> and basically follow
> https://github.com/google/oss-fuzz/blob/master/docs/ideal_integration.md
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/7197d7c8/attachment.html>

From schwehr at gmail.com  Tue May  9 14:19:24 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 9 May 2017 14:19:24 -0700
Subject: [gdal-dev] question on r37621: CSVCompare
Message-ID: <CACmBxytOxc487wc5g=UWmZ21ANJKu2Ubxqa9vnGgE7gFFcQXVg@mail.gmail.com>

Hi Even,

A question on https://trac.osgeo.org/gdal/changeset/37621

Why did you switch the order of the 1st two args with the CSVCompare?
Looking at the code, it appears to not matter which arg is first.

Thanks,
-kurt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/9ed28fec/attachment.html>

From even.rouault at spatialys.com  Tue May  9 14:47:43 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 09 May 2017 23:47:43 +0200
Subject: [gdal-dev] question on r37621: CSVCompare
In-Reply-To: <CACmBxytOxc487wc5g=UWmZ21ANJKu2Ubxqa9vnGgE7gFFcQXVg@mail.gmail.com>
References: <CACmBxytOxc487wc5g=UWmZ21ANJKu2Ubxqa9vnGgE7gFFcQXVg@mail.gmail.com>
Message-ID: <1748992.PtnSgiAEjQ@even-i700>

On mardi 9 mai 2017 14:19:24 CEST Kurt Schwehr wrote:
> Hi Even,
> 
> A question on https://trac.osgeo.org/gdal/changeset/37621
> 
> Why did you switch the order of the 1st two args with the CSVCompare?
> Looking at the code, it appears to not matter which arg is first.

It does in that case :

    else if( eCriteria == CC_Integer )
    {
        return( CPLGetValueType(pszFieldValue) == CPL_VALUE_INTEGER &&
                atoi(pszFieldValue) == atoi(pszTarget) );
    }

Perhaps we could also test CPLGetValueType(pszTarget) == CPL_VALUE_INTEGER as well for 
symetry (this is assumed that pszTarget is actually a integer when eCriteria == CC_Integer )

> 
> Thanks,
> -kurt


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170509/324b33f9/attachment.html>

From gane.prog at gmail.com  Wed May 10 05:46:51 2017
From: gane.prog at gmail.com (Gane R)
Date: Wed, 10 May 2017 18:16:51 +0530
Subject: [gdal-dev] Building GDAL on linux with minimal drivers
In-Reply-To: <CALMrLdB9F82YsffMrAKp0jUcUk+Nxc4bNeGA1LfK9AKNjqb=wg@mail.gmail.com>
References: <CALMrLdB9F82YsffMrAKp0jUcUk+Nxc4bNeGA1LfK9AKNjqb=wg@mail.gmail.com>
Message-ID: <CALMrLdBayuiscH_De+pFPRGBs4y4Zkb3Gf7vJQk4OU36gR0REg@mail.gmail.com>

I got it working, I saw the post Handling pdfium build / integration and
fixed it.

On Wed, Mar 29, 2017 at 2:47 PM, Gane R <gane.prog at gmail.com> wrote:

> Hi all,
>
> I am looking for building gdal with minimal set of drivers like gdal with
> geotiff, jpg, png and sqlite gpkg
>
> so it should do basic warp geotiff and work with geopkg raster. I don't
> need OGR part I need the core, alg and raster tif, gpkg, jpg and png alone
> is enought.
> the problem is I get a fat static lib. I want to reduce its size.
>
> I tried to follow the post https://trac.osgeo.org/gdal/wiki/
> BuildingOnUnixWithMinimizedDrivers It seems it is old.
>
> When I build i get error during building the apps like gdalinfo, gdalwarp
> ....
>
> Any suggestions
>
> my ogr/ogrsf_frmts/GNUmakefile  is
> like
>
> include ../../GDALmake.opt
>
> SUBDIRS-yes    := \
>     generic rec shape
>
> SUBDIRS-$(HAVE_DODS)    += dods
> SUBDIRS-$(HAVE_DWGDIRECT) += dxfdwg
> SUBDIRS-$(HAVE_FME)    += fme
> SUBDIRS-$(HAVE_GRASS)    += grass
> SUBDIRS-$(HAVE_IDB)    += idb
>
> I get the following error
>
> /home/user/home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference
> to `TABINDFile::~TABINDFile()'
> /home/user/home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference
> to `TABINDFile::FindNext(int, unsigned char*)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_object_add'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `TABINDFile::Open(char const, char const, int)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::CreateField(OGRFieldDefn*, int)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_to_file'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `MITABSpatialRef2CoordSys(OGRSpatialReference*)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_tokener_free'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_new_int64'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_get_string'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::GetFeatureCount(int)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `TABINDFile::BuildKey(int, int)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_array_add'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_new_object'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRXPlane_ExtendPosition(double, double, double, double, double*,
> double*)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::SetNextByIndex(long long)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::CreateGeomField(OGRGeomFieldDefn*, int)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::ResetReading()'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::ICreateFeature(OGRFeature*)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRXPlane_Distance(double, double, double, double)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `TABINDFile::AddEntry(int, unsigned char*, int)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_put'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `json_object_new_double_with_precision'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::TestCapability(char const*)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::DeleteFeature(long long)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_new_int'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `TABINDFile::Close()'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_get_type'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::GetNextFeature()'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `OGRMemLayer::OGRMemLayer(char const, OGRSpatialReference,
> OGRwkbGeometryType)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `TABINDFile::BuildKey(int, char const*)'
> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
> `gdal_json_object_from_file'
>
> Thanks
> Gane
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170510/7cb40b91/attachment-0001.html>

From gane.prog at gmail.com  Wed May 10 05:48:05 2017
From: gane.prog at gmail.com (Gane R)
Date: Wed, 10 May 2017 18:18:05 +0530
Subject: [gdal-dev] Building GDAL on linux with minimal drivers
In-Reply-To: <CALMrLdBayuiscH_De+pFPRGBs4y4Zkb3Gf7vJQk4OU36gR0REg@mail.gmail.com>
References: <CALMrLdB9F82YsffMrAKp0jUcUk+Nxc4bNeGA1LfK9AKNjqb=wg@mail.gmail.com>
 <CALMrLdBayuiscH_De+pFPRGBs4y4Zkb3Gf7vJQk4OU36gR0REg@mail.gmail.com>
Message-ID: <CALMrLdD03ZLXi771G3+=ePJJaadJWF+kO7CP=VyuE0707=t3zQ@mail.gmail.com>

sorry wrong post ..

On Wed, May 10, 2017 at 6:16 PM, Gane R <gane.prog at gmail.com> wrote:

> I got it working, I saw the post Handling pdfium build / integration and
> fixed it.
>
> On Wed, Mar 29, 2017 at 2:47 PM, Gane R <gane.prog at gmail.com> wrote:
>
>> Hi all,
>>
>> I am looking for building gdal with minimal set of drivers like gdal with
>> geotiff, jpg, png and sqlite gpkg
>>
>> so it should do basic warp geotiff and work with geopkg raster. I don't
>> need OGR part I need the core, alg and raster tif, gpkg, jpg and png alone
>> is enought.
>> the problem is I get a fat static lib. I want to reduce its size.
>>
>> I tried to follow the post https://trac.osgeo.org/gdal/wi
>> ki/BuildingOnUnixWithMinimizedDrivers It seems it is old.
>>
>> When I build i get error during building the apps like gdalinfo, gdalwarp
>> ....
>>
>> Any suggestions
>>
>> my ogr/ogrsf_frmts/GNUmakefile  is
>> like
>>
>> include ../../GDALmake.opt
>>
>> SUBDIRS-yes    := \
>>     generic rec shape
>>
>> SUBDIRS-$(HAVE_DODS)    += dods
>> SUBDIRS-$(HAVE_DWGDIRECT) += dxfdwg
>> SUBDIRS-$(HAVE_FME)    += fme
>> SUBDIRS-$(HAVE_GRASS)    += grass
>> SUBDIRS-$(HAVE_IDB)    += idb
>>
>> I get the following error
>>
>> /home/user/home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined
>> reference to `TABINDFile::~TABINDFile()'
>> /home/user/home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined
>> reference to `TABINDFile::FindNext(int, unsigned char*)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_object_add'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `TABINDFile::Open(char const, char const, int)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::CreateField(OGRFieldDefn*, int)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_to_file'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `MITABSpatialRef2CoordSys(OGRSpatialReference*)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_tokener_free'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_new_int64'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_get_string'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::GetFeatureCount(int)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `TABINDFile::BuildKey(int, int)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_array_add'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_new_object'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRXPlane_ExtendPosition(double, double, double, double, double*,
>> double*)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::SetNextByIndex(long long)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::CreateGeomField(OGRGeomFieldDefn*, int)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::ResetReading()'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::ICreateFeature(OGRFeature*)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRXPlane_Distance(double, double, double, double)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `TABINDFile::AddEntry(int, unsigned char*, int)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_put'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `json_object_new_double_with_precision'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::TestCapability(char const*)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::DeleteFeature(long long)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_new_int'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `TABINDFile::Close()'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_get_type'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::GetNextFeature()'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `OGRMemLayer::OGRMemLayer(char const, OGRSpatialReference,
>> OGRwkbGeometryType)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `TABINDFile::BuildKey(int, char const*)'
>> /home/user/x64/gdal-2.1.0/.libs/libgdal.so: undefined reference to
>> `gdal_json_object_from_file'
>>
>> Thanks
>> Gane
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170510/a51ae4e0/attachment.html>

From gane.prog at gmail.com  Wed May 10 05:48:19 2017
From: gane.prog at gmail.com (Gane R)
Date: Wed, 10 May 2017 18:18:19 +0530
Subject: [gdal-dev] Build PDFium with GDAL
In-Reply-To: <CALMrLdCZfzjLh+kgvPFQsLBB6DQvNn6+TUxbo99xoksa9uGv6A@mail.gmail.com>
References: <CALMrLdCZfzjLh+kgvPFQsLBB6DQvNn6+TUxbo99xoksa9uGv6A@mail.gmail.com>
Message-ID: <CALMrLdB17qpGBJog0evLjmHERk9wW+2s7PBMrvfGYdM7yjyCUg@mail.gmail.com>

I got it working, I saw the post Handling pdfium build / integration and
fixed it.

On Tue, May 9, 2017 at 6:31 PM, Gane R <gane.prog at gmail.com> wrote:

> Hi all,
> I am trying to build GDAL with PDFium
>
> I saw the link
> https://github.com/rouault/pdfium/tree/build
>
> I tried to use the linux script and the pdfium static lib to build. *pdfium
> build succeed.*
>
> I have few Questions:
>
> Q1: I see some 3rdpary dependency for PDFium, I don't see those LICENSES
> included, does overall including the 3rparty dependency, PDFium library
> comes to point like similar to MIT license ?.
>
> Q2. Can we do a cross compile with for PDFium, or any one tried.
>
> Q3. Has any one got an error like this (error message follows in next few
> lines) ? or I have gone wrong in build steps.
>
> I started to build GDAL gdal-2.2.0 with pdfium
>
> ./configure --with-pdfium=/home/pdfium/install
>
> libtool: link: g++ .libs/gdalinfo_bin.o -o .libs/gdalinfo
> /home/works/gdal_fresh/gdal-2.2.0/.libs/libgdal.so -L/home/pdfium/install
> -L/home/pdfium/install/lib/pdfium -lpdfium -lfpdfapi -lfpdftext
> -lformfiller -lpdfwindow -lfxedit -lfpdfdoc -lfxcodec -lfx_libopenjpeg
> -lfx_lcms2 -lfx_libjpeg -lfx_zlib -lfdrm -lfxge -lfreetype -lfx_agg -lfxcrt
> -lbigint -lz -lpthread -lrt -ldl
> /usr/bin/ld: .libs/gdalinfo: hidden symbol `_ZN13CFDF_Document12CreateNewDocEv'
> in /home/pdfium/install/lib/pdfium/libfpdfapi.a(fpdf_parser_fdf.o) is
> referenced by DSO
> /usr/bin/ld: final link failed: Bad value
> collect2: error: ld returned 1 exit status
> GNUmakefile:82: recipe for target 'gdalinfo' failed
> make[1]: *** [gdalinfo] Error 1
> make[1]: Leaving directory '/home/works/gdal_fresh/gdal-2.2.0/apps'
> GNUmakefile:93: recipe for target 'apps-target' failed
> make: *** [apps-target] Error 2
>
> Thanks
> Gane R
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170510/5fdf4301/attachment.html>

From even.rouault at spatialys.com  Wed May 10 05:55:20 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 10 May 2017 14:55:20 +0200
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
In-Reply-To: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
References: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
Message-ID: <1913992.Nz6xxYYX0J@even-i700>

On lundi 8 mai 2017 14:46:45 CEST Jesse McGraw wrote:
> I think the gdal suite would be a perfect candidate for this project 
from
> google.  Is anyone interested in trying to integrate gdal into it?

First steps done per
https://trac.osgeo.org/gdal/ticket/6883

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170510/3bab120a/attachment.html>

From pschmitt at gmail.com  Wed May 10 13:41:44 2017
From: pschmitt at gmail.com (Peter Schmitt)
Date: Wed, 10 May 2017 14:41:44 -0600
Subject: [gdal-dev] Creating Cloud Optimized GeoTIFFs
Message-ID: <CACkcqcUzFPHeZHfO3-d2f6aL4xaxMbTTd6LCf2b+2g_0A=7H8w@mail.gmail.com>

Hi,

I ran into something confusing when using gdal-2.2.0 to generate Cloud
Optimized GeoTIFFs following the instructions at:
https://trac.osgeo.org/gdal/wiki/CloudOptimizedGeoTIFF

Here's what I did:

1. Fetch an image:
env CPL_VSIL_CURL_ALLOWED_EXTENSIONS=tif GDAL_DISABLE_READDIR_ON_OPEN=YES
VSI_CACHE=TRUE gdal_translate
https://github.com/mapbox/rasterio/raw/master/tests/data/RGB.byte.tif
rgb_byte_jpg.tif -co TILED=YES -co COMPRESS=JPEG -co PHOTOMETRIC=YCBCR

Not a cloud-optimized GeoTIFF as expected:

validate_cloud_optimized_geotiff.py  rgb_byte_jpg.tif
rgb_byte_jpg.tif is NOT a valid cloud optimized GeoTIFF : The file should
have overviews


2. Add internal overviews:
gdaladdo -r average rgb_byte_jpg.tif 2 4 8 16 32

validate_cloud_optimized_geotiff.py  rgb_byte_jpg.tif

rgb_byte_jpg.tif is NOT a valid cloud optimized GeoTIFF : The offset of the
first block of overview of index 3 should be after the one of the overview
of index 4


3.  Translate the image again copying source overviews added above.

gdal_translate rgb_byte_jpg.tif rgb_byte_jpg_trans.tif -co TILED=YES -co
COMPRESS=JPEG -co PHOTOMETRIC=YCBCR -co COPY_SRC_OVERVIEWS=YES

Now the image _is_ cloud-optimized.

validate_cloud_optimized_geotiff.py  rgb_byte_jpg_trans.tif
rgb_byte_jpg_trans.tif is a valid cloud optimized GeoTIFF


I expected the image to be "cloud optimized" at step 2.  Why do I need an
additional translate?


Notes:

* I see similar behavior for COMPRESS=DEFLATE.
* Thinking that the default block size (256) was too big for the tiny 25x23
overview, I set this on the initial translate, but I see the same behavior:
 -co BLOCKXSIZE=16 -co BLOCKYSIZE=16 --config GDAL_TIFF_OVR_BLOCKSIZE 16
* gdal-2.2.0 configured with "--with-libtiff=internal"
* Compiler::
Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr
--with-gxx-include-dir=/usr/include/c++/4.2.1
Apple LLVM version 8.1.0 (clang-802.0.42)
Target: x86_64-apple-darwin16.5.0
Thread model: posix
InstalledDir:
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin

Thanks,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170510/56c032be/attachment.html>

From even.rouault at spatialys.com  Wed May 10 13:53:02 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 10 May 2017 22:53:02 +0200
Subject: [gdal-dev] Creating Cloud Optimized GeoTIFFs
In-Reply-To: <CACkcqcUzFPHeZHfO3-d2f6aL4xaxMbTTd6LCf2b+2g_0A=7H8w@mail.gmail.com>
References: <CACkcqcUzFPHeZHfO3-d2f6aL4xaxMbTTd6LCf2b+2g_0A=7H8w@mail.gmail.com>
Message-ID: <37364207.nlYVYg3d7h@even-i700>

On mercredi 10 mai 2017 14:41:44 CEST Peter Schmitt wrote:
> Hi,
> 
> I ran into something confusing when using gdal-2.2.0 to generate Cloud
> Optimized GeoTIFFs following the instructions at:
> https://trac.osgeo.org/gdal/wiki/CloudOptimizedGeoTIFF
> 
> Here's what I did:
> 
> 1. Fetch an image:
> env CPL_VSIL_CURL_ALLOWED_EXTENSIONS=tif 
GDAL_DISABLE_READDIR_ON_OPEN=YES
> VSI_CACHE=TRUE gdal_translate
> https://github.com/mapbox/rasterio/raw/master/tests/data/RGB.byte.tif
> rgb_byte_jpg.tif -co TILED=YES -co COMPRESS=JPEG -co PHOTOMETRIC=YCBCR
> 
> Not a cloud-optimized GeoTIFF as expected:
> 
> validate_cloud_optimized_geotiff.py  rgb_byte_jpg.tif
> rgb_byte_jpg.tif is NOT a valid cloud optimized GeoTIFF : The file should
> have overviews
> 
> 
> 2. Add internal overviews:
> gdaladdo -r average rgb_byte_jpg.tif 2 4 8 16 32
> 
> validate_cloud_optimized_geotiff.py  rgb_byte_jpg.tif
> 
> rgb_byte_jpg.tif is NOT a valid cloud optimized GeoTIFF : The offset of the
> first block of overview of index 3 should be after the one of the overview
> of index 4
> 
> 
> 3.  Translate the image again copying source overviews added above.
> 
> gdal_translate rgb_byte_jpg.tif rgb_byte_jpg_trans.tif -co TILED=YES -co
> COMPRESS=JPEG -co PHOTOMETRIC=YCBCR -co COPY_SRC_OVERVIEWS=YES
> 
> Now the image _is_ cloud-optimized.
> 
> validate_cloud_optimized_geotiff.py  rgb_byte_jpg_trans.tif
> rgb_byte_jpg_trans.tif is a valid cloud optimized GeoTIFF
> 
> 
> I expected the image to be "cloud optimized" at step 2.  Why do I need an
> additional translate?

Peter,

Because gdaladdo will add the overview IFD at the end of the file, whereas in the definition 
of cloud optimized GeoTIFF, they must be all at the beginning of the file so as to be 
efficiently fetchable. And that can only be done with gdal_translate  -co 
COPY_SRC_OVERVIEWS=YES
To avoid quality loss you should only use JPEG compression for the final gdal_translate stage.

Even



-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170510/5ee09b23/attachment.html>

From philippe.ghesquiere at airbus.com  Thu May 11 05:04:46 2017
From: philippe.ghesquiere at airbus.com (Bugbuster)
Date: Thu, 11 May 2017 05:04:46 -0700 (MST)
Subject: [gdal-dev] KML : some vectors are not seen by GDAL
Message-ID: <1494504286608-5320170.post@n6.nabble.com>

Dear all,When I try to export some vector data in KML, I sometimes "lose"
some vectors.It depends on the way layers are created :case #1 : no  tags
are created. All vectors are considered "at the top level". Everything is
finecase #2 : vectors all belong to a specific layer, using one or several 
tags. Everything is still finecase #3 : some vectors do not belong to a
specific layer. Others belong to specific layers.The "top level" vectors are
not seen by GDAL (not displayed in QGIS either). However, they are displayed
in Google Earth.The KML file looks like :      snafu    ...       <-- Not
seen by ogrinfo          ...     <-- OK    My environment : Windows 8 64
bits, Gdal 2.0.2, using LIBKML plugin.Do you have any ideas ?ThanksPhilippe



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/KML-some-vectors-are-not-seen-by-GDAL-tp5320170.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170511/a81b465b/attachment.html>

From philippe.ghesquiere at airbus.com  Thu May 11 05:11:09 2017
From: philippe.ghesquiere at airbus.com (Bugbuster)
Date: Thu, 11 May 2017 05:11:09 -0700 (MST)
Subject: [gdal-dev] KML : some vectors are not seen by GDAL
Message-ID: <1494504669550-5320171.post@n6.nabble.com>

Dear all,
When I try to export some vector data in KML, I sometimes "lose" some
vectors. It depends on the way layers are created :
case #1 : no tags are created. All vectors are considered "at the top
level". Everything is fine
case #2 : vectors all belong to a specific layer, using one or several tags.
Everything is still fine
case #3 : some vectors do not belong to a specific layer. Others belong to
specific layers. The "top level" vectors are not seen by GDAL (not displayed
in QGIS either). However, they are displayed in Google Earth.

The KML file looks like :
<kml>
  <Document>
    <name>snafu</name>
    <Placemark>...</Placemark>    <-- Not "seen" by ogrinfo
    <Folder id="123456"">
      <Placemark>...</Placemark>  <-- OK
    </Folder
  </Document>
</kml>


My environment : Windows 8 64 bits, Gdal 2.0.2, using LIBKML plugin.

Do you have any ideas ?
Thanks
Philippe  testFolders.kml
<http://osgeo-org.1560.x6.nabble.com/file/n5320171/testFolders.kml>  



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/KML-some-vectors-are-not-seen-by-GDAL-tp5320171.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From Liam.Candy at angloamerican.com  Thu May 11 07:20:57 2017
From: Liam.Candy at angloamerican.com (Candy, Liam)
Date: Thu, 11 May 2017 14:20:57 +0000
Subject: [gdal-dev] GDAL Linking issues VS2015 64-bit
Message-ID: <DB5PR03MB1496C8A5C359D9264D7FD6BD96ED0@DB5PR03MB1496.eurprd03.prod.outlook.com>

Hi all,

I managed to get the GDAL library with ECW support to compile and link for 32-bit, but realized I need to get the 64-bit library working. I'm having linking issues with this.

I'm running Windows 10, VS2015 command line tools, and trying to build GDAL 2.1.3 with support for ERDAS ECW 5.3. The relevant (I believe) parts of my nmake.opt file are;

WIN64=YES


# Uncomment the following and update to enable ECW read support with the
# 4.1+ readonly SDK
ECWDIR  =  ...\Hexagon\ERDAS_ECW_JPEG_2000_SDK_53
ECWFLAGS = -DECWSDK_VERSION=53 \
       -I$(ECWDIR)\include \
       -I$(ECWDIR)\include/NCSECW/api -I$(ECWDIR)\include/NCSECW/jp2 \
       -I$(ECWDIR)\include/NCSECW/ecw
ECWLIB  =  $(ECWDIR)\lib\vc110\x64\NCSEcw.lib


SYM_PREFIX=


(I've tried SYM_PREFIX=_) as well.




The output I get is;

Generating Code...
        cd ..
        if exist gdal.lib del gdal.lib
        lib /nologo /out:gdal.lib port\*.obj gcore\*.obj alg\*.obj frmts\o\*.obj ogr\ogrsf_frmts\ogrsf_frmts.lib ogr\ogr.lib gnm\*.obj gnm\gnm_frmts\o\*.obj   apps\commonutils.obj apps\gdalinfo_lib.obj apps\gdal_translate_lib.obj apps\gdalwarp_lib.obj apps\ogr2ogr_lib.obj  apps\gdaldem_lib.obj apps\nearblack_lib.obj apps\gdal_grid_lib.obj apps\gdal_rasterize_lib.obj apps\gdalbuildvrt_lib.obj
ogrsf_frmts.lib(ogrjmllayer.obj) : warning LNK4221: This object file does not define any previously undefined public symbols, so it will not be used by any link operation that consumes this library
ogr.lib(ograpispy.obj) : warning LNK4221: This object file does not define any previously undefined public symbols, so it will not be used by any link operation that consumes this library
nitf_gcprpc.obj : warning LNK4221: This object file does not define any previously undefined public symbols, so it will not be used by any link operation that consumes this library
ecwcreatecopy.obj : warning LNK4221: This object file does not define any previously undefined public symbols, so it will not be used by any link operation that consumes this library
cpl_recode_iconv.obj : warning LNK4221: This object file does not define any previously undefined public symbols, so it will not be used by any link operation that consumes this library
        link /nologo /dll /INCLUDE:OSRValidate  /INCLUDE:OPTGetProjectionMethods  /INCLUDE:OGR_G_GetPointCount  /INCLUDE:OGRRegisterAll /INCLUDE:GDALSimpleImageWarp  /INCLUDE:GDALReprojectImage  /INCLUDE:GDALComputeMedianCutPCT  /INCLUDE:GDALDitherRGB2PCT  /INCLUDE:OCTNewCoordinateTransformation port\*.obj gcore\*.obj alg\*.obj frmts\o\*.obj ogr\ogrsf_frmts\ogrsf_frmts.lib ogr\ogr.lib gnm\*.obj gnm\gnm_frmts\o\*.obj   apps\commonutils.obj apps\gdalinfo_lib.obj apps\gdal_translate_lib.obj apps\gdalwarp_lib.obj apps\ogr2ogr_lib.obj  apps\gdaldem_lib.obj apps\nearblack_lib.obj apps\gdal_grid_lib.obj apps\gdal_rasterize_lib.obj apps\gdalbuildvrt_lib.obj        D:\Users\LCandy\AppData\Local\Hexagon\ERDAS_ECW_JPEG_2000_SDK_53\lib\vc110\x64\NCSEcw.lib                                                    gcore\Version.res  /out:gdal201.dll /implib:gdal_i.lib
   Creating library gdal_i.lib and object gdal_i.exp
LINK : error LNK2001: unresolved external symbol OSRValidate
LINK : error LNK2001: unresolved external symbol OPTGetProjectionMethods
LINK : error LNK2001: unresolved external symbol OGR_G_GetPointCount
LINK : error LNK2001: unresolved external symbol OGRRegisterAll
LINK : error LNK2001: unresolved external symbol GDALSimpleImageWarp
LINK : error LNK2001: unresolved external symbol GDALReprojectImage
LINK : error LNK2001: unresolved external symbol GDALComputeMedianCutPCT
LINK : error LNK2001: unresolved external symbol GDALDitherRGB2PCT
LINK : error LNK2001: unresolved external symbol OCTNewCoordinateTransformation

Followed by a string of 'unresolved external symbol' errors.

And, to confirm that I'm using the 64-bit compiler / linker from VS, the final line of the output is:

gdal201.dll : fatal error LNK1120: 247 unresolved externals
NMAKE : fatal error U1077: '"D:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\BIN\amd64_x86\link.EXE"' : return code '0x460'
Stop.

I've been struggling with this for two days, so any help at all would be greatly appreciated.

Best regards,
Liam.

Liam Candy D +27 11 638 2078 M +27 11 282 8658 Ext 8113 2078



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170511/806a0c36/attachment-0001.html>

From even.rouault at spatialys.com  Thu May 11 07:41:17 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 11 May 2017 16:41:17 +0200
Subject: [gdal-dev] GDAL Linking issues VS2015 64-bit
In-Reply-To: <DB5PR03MB1496C8A5C359D9264D7FD6BD96ED0@DB5PR03MB1496.eurprd03.prod.outlook.com>
References: <DB5PR03MB1496C8A5C359D9264D7FD6BD96ED0@DB5PR03MB1496.eurprd03.prod.outlook.com>
Message-ID: <2295166.gAxbxhfSiT@even-i700>

Liam,

> 
> SYM_PREFIX=
--> You don't need to touch that one. Correct behaviour is determined by WIN64 setting
> 

> LINK : error LNK2001: unresolved external symbol OSRValidate
> LINK : error LNK2001: unresolved external symbol OPTGetProjectionMethods
> LINK : error LNK2001: unresolved external symbol OGR_G_GetPointCount
> LINK : error LNK2001: unresolved external symbol OGRRegisterAll
> LINK : error LNK2001: unresolved external symbol GDALSimpleImageWarp
> LINK : error LNK2001: unresolved external symbol GDALReprojectImage
> LINK : error LNK2001: unresolved external symbol GDALComputeMedianCutPCT
> LINK : error LNK2001: unresolved external symbol GDALDitherRGB2PCT
> LINK : error LNK2001: unresolved external symbol
> OCTNewCoordinateTransformation

Did you issue a "nmake /f makefile.vc clean" before rebuilding ? (in case you compiled the 
tree initially with the 32 bit compiler, which is the only error cause I can think of given the 
other elements you mentionned)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170511/e3f7acee/attachment.html>

From damian.dixon at gmail.com  Thu May 11 07:46:18 2017
From: damian.dixon at gmail.com (Damian Dixon)
Date: Thu, 11 May 2017 15:46:18 +0100
Subject: [gdal-dev] GDAL Linking issues VS2015 64-bit
In-Reply-To: <2295166.gAxbxhfSiT@even-i700>
References: <DB5PR03MB1496C8A5C359D9264D7FD6BD96ED0@DB5PR03MB1496.eurprd03.prod.outlook.com>
 <2295166.gAxbxhfSiT@even-i700>
Message-ID: <CAJjdW1xY8_saukvEtgOmXW5aAO+ybYqTC2MD8tq0f43xMm3H_A@mail.gmail.com>

We also do the following:

FOR /R gdal %%F IN (*.res) DO DEL /F /S "%%F" > nul
FOR /R gdal %%F IN (*.obj) DO DEL /F /S "%%F" > nul
FOR /R gdal %%F IN (*.pdb) DO DEL /F /S "%%F" > nul
FOR /R gdal %%F IN (*.dll) DO DEL /F /S "%%F" > nul
FOR /R gdal %%F IN (*.lib) DO DEL /F /S "%%F" > nul
FOR /R gdal %%F IN (*.exp) DO DEL /F /S "%%F" > nul


Where gdal is the directory containing the gdal 'source code'/build.



On 11 May 2017 at 15:41, Even Rouault <even.rouault at spatialys.com> wrote:

> Liam,
>
>
>
> >
>
> > SYM_PREFIX=
>
> --> You don't need to touch that one. Correct behaviour is determined by
> WIN64 setting
>
> >
>
>
>
> > LINK : error LNK2001: unresolved external symbol OSRValidate
>
> > LINK : error LNK2001: unresolved external symbol OPTGetProjectionMethods
>
> > LINK : error LNK2001: unresolved external symbol OGR_G_GetPointCount
>
> > LINK : error LNK2001: unresolved external symbol OGRRegisterAll
>
> > LINK : error LNK2001: unresolved external symbol GDALSimpleImageWarp
>
> > LINK : error LNK2001: unresolved external symbol GDALReprojectImage
>
> > LINK : error LNK2001: unresolved external symbol GDALComputeMedianCutPCT
>
> > LINK : error LNK2001: unresolved external symbol GDALDitherRGB2PCT
>
> > LINK : error LNK2001: unresolved external symbol
>
> > OCTNewCoordinateTransformation
>
>
>
> Did you issue a "nmake /f makefile.vc clean" before rebuilding ? (in case
> you compiled the tree initially with the 32 bit compiler, which is the only
> error cause I can think of given the other elements you mentionned)
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170511/80e426b0/attachment.html>

From janelle.archer5 at gmail.com  Thu May 11 10:17:57 2017
From: janelle.archer5 at gmail.com (Janelle Archer)
Date: Thu, 11 May 2017 13:17:57 -0400
Subject: [gdal-dev] Issue getting correct GeoTransform
Message-ID: <CAJcQ6DsoJEN1-Yr-S_ANi4_RcwSguZOo7+yRW5mLE5E6eMWYUg@mail.gmail.com>

I am creating a data set in virtual memory and then copying over to a DTED
driver.
I have verified that when I setGeoTransform, I am able to get the same
values back.

(*i).tempMemDS = tempMemDriver->Create ("", (int) xSize, (int) ySize, 1,
GDT_Float32, NULL
(*i).dtedDS = dtedDriver->CreateCopy (szFilename,(*i).tempMemDS, TRUE,
NULL, NULL, NULL);

My issue arises when I try and getGeoTransform form the dted dataset. The
aux.xml returns shows the correct data, however every time I look at the
value from getGeoTransform it is the same incorrect values.

I am wondering if there is some sort of formatting issue that I am doing
incorrectly.

Thank you in advance, it is greatly appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170511/d43abbd5/attachment.html>

From matt.gregory at oregonstate.edu  Thu May 11 16:29:15 2017
From: matt.gregory at oregonstate.edu (Gregory, Matthew)
Date: Thu, 11 May 2017 23:29:15 +0000
Subject: [gdal-dev] error reading AIG blocks
Message-ID: <7C48E40C135D314BA03D6471A6E38978F21CC01C@EX1.oregonstate.edu>

Hi all,

I think this is a bug, but wanted to make sure I wasn't doing something stupid before I posted it as such.

At r32878 (git 1eb605a), Even added new logic for dealing with raw 32-bit AIG blocks.  I've got an AIG raster that has a few blocks where valid data is getting set to the min Int32 value (-2147483648) when doing a gdal_translate to GeoTiff.  

  gdal_translate -of GTiff ai_bug ai_bug.tif

Note the "old" way of getting these values was providing the correct values in this case:

  panData[i] = pabyCur[0] * 256 * 256 * 256
      + pabyCur[1] * 256 * 256
      + pabyCur[2] * 256
      + pabyCur[3] + nMin;  

Note that this is only affecting selected blocks within the raster.  Other blocks seem to be just fine.

Test raster posted here:

  ftp://ftp.fsl.orst.edu/pub/gregorym/gdal/ai_bug.7z (1MB)

>From my testing, <= 2.0 is OK, >= 2.1 is affected.  Tested on Windows 10 64-bit.
  
thanks, matt


 

From gane.prog at gmail.com  Fri May 12 02:51:17 2017
From: gane.prog at gmail.com (Gane R)
Date: Fri, 12 May 2017 15:21:17 +0530
Subject: [gdal-dev] Build PDFium with GDAL
In-Reply-To: <CALMrLdB17qpGBJog0evLjmHERk9wW+2s7PBMrvfGYdM7yjyCUg@mail.gmail.com>
References: <CALMrLdCZfzjLh+kgvPFQsLBB6DQvNn6+TUxbo99xoksa9uGv6A@mail.gmail.com>
 <CALMrLdB17qpGBJog0evLjmHERk9wW+2s7PBMrvfGYdM7yjyCUg@mail.gmail.com>
Message-ID: <CALMrLdAV-cEYkv-7_udGgkBCGUg_GhKyr=qDg_9_+HHQnXPpUA@mail.gmail.com>

Hi all,
I am trying to build GDAL with PDFium

I have used the link to get build script for linux
https://github.com/rouault/pdfium/tree/build

only change in standalone.gypi was removal of -fvisibility=hidden in
standalone.gypi
I got a GDAL build with pdfium build was success,
But gdalinfo for a Geospatial PDF crashes
at version gdal-2.2.0

Has anybody tried to build GDAL with PDFium recently, or there was a change
in the PDFium source ?
Gane R

On Wed, May 10, 2017 at 6:18 PM, Gane R <gane.prog at gmail.com> wrote:

> I got it working, I saw the post Handling pdfium build / integration and
> fixed it.
>
> On Tue, May 9, 2017 at 6:31 PM, Gane R <gane.prog at gmail.com> wrote:
>
>> Hi all,
>> I am trying to build GDAL with PDFium
>>
>> I saw the link
>> https://github.com/rouault/pdfium/tree/build
>>
>> I tried to use the linux script and the pdfium static lib to build. *pdfium
>> build succeed.*
>>
>> I have few Questions:
>>
>> Q1: I see some 3rdpary dependency for PDFium, I don't see those LICENSES
>> included, does overall including the 3rparty dependency, PDFium library
>> comes to point like similar to MIT license ?.
>>
>> Q2. Can we do a cross compile with for PDFium, or any one tried.
>>
>> Q3. Has any one got an error like this (error message follows in next few
>> lines) ? or I have gone wrong in build steps.
>>
>> I started to build GDAL gdal-2.2.0 with pdfium
>>
>> ./configure --with-pdfium=/home/pdfium/install
>>
>> libtool: link: g++ .libs/gdalinfo_bin.o -o .libs/gdalinfo
>> /home/works/gdal_fresh/gdal-2.2.0/.libs/libgdal.so
>> -L/home/pdfium/install -L/home/pdfium/install/lib/pdfium -lpdfium
>> -lfpdfapi -lfpdftext -lformfiller -lpdfwindow -lfxedit -lfpdfdoc -lfxcodec
>> -lfx_libopenjpeg -lfx_lcms2 -lfx_libjpeg -lfx_zlib -lfdrm -lfxge -lfreetype
>> -lfx_agg -lfxcrt -lbigint -lz -lpthread -lrt -ldl
>> /usr/bin/ld: .libs/gdalinfo: hidden symbol `_ZN13CFDF_Document12CreateNewDocEv'
>> in /home/pdfium/install/lib/pdfium/libfpdfapi.a(fpdf_parser_fdf.o) is
>> referenced by DSO
>> /usr/bin/ld: final link failed: Bad value
>> collect2: error: ld returned 1 exit status
>> GNUmakefile:82: recipe for target 'gdalinfo' failed
>> make[1]: *** [gdalinfo] Error 1
>> make[1]: Leaving directory '/home/works/gdal_fresh/gdal-2.2.0/apps'
>> GNUmakefile:93: recipe for target 'apps-target' failed
>> make: *** [apps-target] Error 2
>>
>> Thanks
>> Gane R
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170512/b663a5a4/attachment.html>

From even.rouault at spatialys.com  Fri May 12 09:34:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 12 May 2017 18:34:06 +0200
Subject: [gdal-dev] error reading AIG blocks
In-Reply-To: <7C48E40C135D314BA03D6471A6E38978F21CC01C@EX1.oregonstate.edu>
References: <7C48E40C135D314BA03D6471A6E38978F21CC01C@EX1.oregonstate.edu>
Message-ID: <5457737.juScnyIzbL@even-i700>

On jeudi 11 mai 2017 23:29:15 CEST Gregory, Matthew wrote:
> Hi all,
> 
> I think this is a bug, but wanted to make sure I wasn't doing something
> stupid before I posted it as such.
> 
> At r32878 (git 1eb605a), Even added new logic for dealing with raw 32-bit
> AIG blocks.  I've got an AIG raster that has a few blocks where valid data
> is getting set to the min Int32 value (-2147483648) when doing a
> gdal_translate to GeoTiff.
> 
>   gdal_translate -of GTiff ai_bug ai_bug.tif
> 
> Note the "old" way of getting these values was providing the correct values
> in this case:
> 
>   panData[i] = pabyCur[0] * 256 * 256 * 256
>       + pabyCur[1] * 256 * 256
>       + pabyCur[2] * 256
>       + pabyCur[3] + nMin;
> 
> Note that this is only affecting selected blocks within the raster.  Other
> blocks seem to be just fine.
> 
> Test raster posted here:
> 
>   ftp://ftp.fsl.orst.edu/pub/gregorym/gdal/ai_bug.7z (1MB)
> 
> From my testing, <= 2.0 is OK, >= 2.1 is affected.  Tested on Windows 10
> 64-bit.

Matt

Thanks for the report. I've fixed the issue per 
https://trac.osgeo.org/gdal/ticket/6886

AIG relies on rollover on addition of big negative values, which is undefined behaviour in C. 
Interesting...

Can the test dataset be integrated in the GDAL test suite ? (probably in http://
download.osgeo.org/gdal/data/aig/ )

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170512/78cea682/attachment.html>

From matt.gregory at oregonstate.edu  Fri May 12 09:57:51 2017
From: matt.gregory at oregonstate.edu (Gregory, Matthew)
Date: Fri, 12 May 2017 16:57:51 +0000
Subject: [gdal-dev] error reading AIG blocks
In-Reply-To: <5457737.juScnyIzbL@even-i700>
References: <7C48E40C135D314BA03D6471A6E38978F21CC01C@EX1.oregonstate.edu>
 <5457737.juScnyIzbL@even-i700>
Message-ID: <7C48E40C135D314BA03D6471A6E38978F21CD096@EX1.oregonstate.edu>

Even Rouault wrote:
> Thanks for the report. I've fixed the issue per 
> https://trac.osgeo.org/gdal/ticket/6886
>  
> AIG relies on rollover on addition of big negative values,
> which is undefined behaviour in C. Interesting...
>  
> Can the test dataset be integrated in the GDAL test suite ?
> (probably in http://download.osgeo.org/gdal/data/aig/ )
 
Even,

Thanks for the very fast fix.  Please feel free to use the dataset in the test suite.  

thanks, matt

From ruedi.boesch at wsl.ch  Fri May 12 14:01:16 2017
From: ruedi.boesch at wsl.ch (Ruedi Boesch)
Date: Fri, 12 May 2017 14:01:16 -0700 (MST)
Subject: [gdal-dev] GDAL 2.2.0 Compilation error with OSX 10.12
Message-ID: <1494622876397-5320401.post@n6.nabble.com>

with http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0.tar.gz
==>
==> no member named 'back' in 'CPLString'
==>
configure ... --enable-pdf-plugin ...

Compiling with macos 10.12 (toolchain XCode 8.3 (Apple LLVM version 8.1.0
(clang-802.0.42))) fails in 
gdal-2.2.0/frmts/pdf/pdfcreatecopy.cpp:2342

PROBLEM: configure defines HAVE_CXX11, but emits
libtool: compile:  g++ -std=gnu++11 ...

(c++11 supports std:string::back(), but gnu++11 not ??)

==> WORKAROUND:
In
gdal-2.2.0/port/cpl_string.h:383 

change

#ifndef HAVE_CXX11

to

// Note: This is standard in C++11.
#if defined (__APPLE__) || !defined (HAVE_CXX11)
    /** Return last character (undefined behaviour if string is empty) */
    const char& back() const { return operator[](size()-1); }
    /** Return last character (undefined behaviour if string is empty) */
    char& back() { return operator[](size()-1); }
#endif

Ruedi








--
View this message in context: http://osgeo-org.1560.x6.nabble.com/GDAL-2-2-0-Compilation-error-with-OSX-10-12-tp5320401.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Fri May 12 14:15:29 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 12 May 2017 23:15:29 +0200
Subject: [gdal-dev] GDAL 2.2.0 Compilation error with OSX 10.12
In-Reply-To: <1494622876397-5320401.post@n6.nabble.com>
References: <1494622876397-5320401.post@n6.nabble.com>
Message-ID: <1576256.QQLa1cYyrR@even-i700>

On vendredi 12 mai 2017 14:01:16 CEST Ruedi Boesch wrote:
> with http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0.tar.gz
> ==>
> ==> no member named 'back' in 'CPLString'
> ==>
> configure ... --enable-pdf-plugin ...
> 
> Compiling with macos 10.12 (toolchain XCode 8.3 (Apple LLVM version 8.1.0
> (clang-802.0.42))) fails in
> gdal-2.2.0/frmts/pdf/pdfcreatecopy.cpp:2342
> 
> PROBLEM: configure defines HAVE_CXX11, but emits
> libtool: compile:  g++ -std=gnu++11 ...

And what if you modify GDALmake.opt (after configure stage) to replace
-std=gnu++11 with -std=c++11 ?

> 
> (c++11 supports std:string::back(), but gnu++11 not ??)
> 
> ==> WORKAROUND:
> In
> gdal-2.2.0/port/cpl_string.h:383
> 
> change
> 
> #ifndef HAVE_CXX11
> 
> to
> 
> // Note: This is standard in C++11.
> #if defined (__APPLE__) || !defined (HAVE_CXX11)
>     /** Return last character (undefined behaviour if string is empty) */
>     const char& back() const { return operator[](size()-1); }
>     /** Return last character (undefined behaviour if string is empty) */
>     char& back() { return operator[](size()-1); }
> #endif
> 
> Ruedi
> 
> 
> 
> 
> 
> 
> 
> 
> --
> View this message in context:
> http://osgeo-org.1560.x6.nabble.com/GDAL-2-2-0-Compilation-error-with-OSX-1
> 0-12-tp5320401.html Sent from the GDAL - Dev mailing list archive at
> Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170512/516fd214/attachment.html>

From even.rouault at spatialys.com  Sat May 13 02:36:18 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 13 May 2017 11:36:18 +0200
Subject: [gdal-dev] GDAL 2.2.0 Compilation error with OSX 10.12
In-Reply-To: <061CA471-3DE6-4C80-9388-ACE95DC76DD1@wsl.ch>
References: <1494622876397-5320401.post@n6.nabble.com>
 <1576256.QQLa1cYyrR@even-i700> <061CA471-3DE6-4C80-9388-ACE95DC76DD1@wsl.ch>
Message-ID: <2078896.XKMkJG5Tcp@even-i700>

On samedi 13 mai 2017 10:58:01 CEST Ruedi Boesch wrote:
> with GDALmake.opt:
> ...
> CC	=	$(LIBTOOL_COMPILE_CC) gcc
> CXX	=	$(LIBTOOL_COMPILE_CXX) g++ -std=c++11
> LD	=	$(LIBTOOL_LINK)	g++ -std=gnu++11
> ...
> 
> I get:
> 
> libtool: compile:  g++ -std=c++11 -DHAVE_AVX_AT_COMPILE_TIME
> -DHAVE_SSSE3_AT_COMPILE_TIME -DHAVE_SSE_AT_COMPILE_TIME -g -O2 -Wall ....
> 
> pdfcreatecopy.cpp:2342:37: error: no member named 'back' in 'CPLString'
>                         osLabelText.back() == '}' )
>                         ~~~~~~~~~~~ ^
> 1 error generated.

OK. No better. I guess then that you should try the solution exposed in
https://lists.osgeo.org/pipermail/gdal-dev/2017-April/046531.html



> 
> Ruedi
> 
> > Am 12.05.2017 um 23:15 schrieb Even Rouault <even.rouault at spatialys.com>:
> > 
> > On vendredi 12 mai 2017 14:01:16 CEST Ruedi Boesch wrote:
> > > with http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0.tar.gz
> > > <http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0.tar.gz> ==>
> > > ==> no member named 'back' in 'CPLString'
> > > ==>
> > > configure ... --enable-pdf-plugin ...
> > > 
> > > Compiling with macos 10.12 (toolchain XCode 8.3 (Apple LLVM version
> > > 8.1.0
> > > (clang-802.0.42))) fails in
> > > gdal-2.2.0/frmts/pdf/pdfcreatecopy.cpp:2342
> > > 
> > > PROBLEM: configure defines HAVE_CXX11, but emits
> > > libtool: compile:  g++ -std=gnu++11 ...
> > 
> > And what if you modify GDALmake.opt (after configure stage) to replace
> > -std=gnu++11 with -std=c++11 ?
> > 
> > > (c++11 supports std:string::back(), but gnu++11 not ??)
> > > 
> > > ==> WORKAROUND:
> > > In
> > > gdal-2.2.0/port/cpl_string.h:383
> > > 
> > > change
> > > 
> > > #ifndef HAVE_CXX11
> > > 
> > > to
> > > 
> > > // Note: This is standard in C++11.
> > > #if defined (__APPLE__) || !defined (HAVE_CXX11)
> > > 
> > >     /** Return last character (undefined behaviour if string is empty)
> > >     */
> > >     const char& back() const { return operator[](size()-1); }
> > >     /** Return last character (undefined behaviour if string is empty)
> > >     */
> > >     char& back() { return operator[](size()-1); }
> > > 
> > > #endif
> > > 
> > > Ruedi
> > > 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > --
> > > View this message in context:
> > > http://osgeo-org.1560.x6.nabble.com/GDAL-2-2-0-Compilation-error-with-OS
> > > X-1
> > > <http://osgeo-org.1560.x6.nabble.com/GDAL-2-2-0-Compilation-error-with-> > > OSX-1> 0-12-tp5320401.html Sent from the GDAL - Dev mailing list archive
> > > at Nabble.com <http://nabble.com/>.
> > > _______________________________________________
> > > gdal-dev mailing list
> > > gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
> > > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> > > <https://lists.osgeo.org/mailman/listinfo/gdal-dev>


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170513/11de0e97/attachment-0001.html>

From schwehr at gmail.com  Sat May 13 15:42:49 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sat, 13 May 2017 15:42:49 -0700
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
In-Reply-To: <1913992.Nz6xxYYX0J@even-i700>
References: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
 <1913992.Nz6xxYYX0J@even-i700>
Message-ID: <CACmBxytgh8ByR61q44wbD9ozKM44y=EJRQxJPDA0XrX-dDQkvg@mail.gmail.com>

Even and Mateusz,

OMG!  So many fixes... Awesome!

-kurt



On Wed, May 10, 2017 at 5:55 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On lundi 8 mai 2017 14:46:45 CEST Jesse McGraw wrote:
>
> > I think the gdal suite would be a perfect candidate for this project from
>
> > google. Is anyone interested in trying to integrate gdal into it?
>
>
>
> First steps done per
>
> https://trac.osgeo.org/gdal/ticket/6883
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170513/8f33b491/attachment.html>

From mateusz at loskot.net  Sun May 14 01:56:26 2017
From: mateusz at loskot.net (Mateusz Loskot)
Date: Sun, 14 May 2017 10:56:26 +0200
Subject: [gdal-dev] Gdal and Google's OSS Fuzzing project
In-Reply-To: <CACmBxytgh8ByR61q44wbD9ozKM44y=EJRQxJPDA0XrX-dDQkvg@mail.gmail.com>
References: <3AA2F6BF-0F5E-4707-AF48-5284C779D235@gmail.com>
 <1913992.Nz6xxYYX0J@even-i700>
 <CACmBxytgh8ByR61q44wbD9ozKM44y=EJRQxJPDA0XrX-dDQkvg@mail.gmail.com>
Message-ID: <CABUeae9W1rdnNo=CVBqSUQKynsg5TcDFFXr=k3Xuu_jgMuC7mA@mail.gmail.com>

I only fixed one so far, bug-security though.

Even is on rage! Incredible :D

Mateusz

On 14 May 2017 00:42, "Kurt Schwehr" <schwehr at gmail.com> wrote:

> Even and Mateusz,
>
> OMG!  So many fixes... Awesome!
>
> -kurt
>
>
>
> On Wed, May 10, 2017 at 5:55 AM, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> On lundi 8 mai 2017 14:46:45 CEST Jesse McGraw wrote:
>>
>> > I think the gdal suite would be a perfect candidate for this project
>> from
>>
>> > google. Is anyone interested in trying to integrate gdal into it?
>>
>>
>>
>> First steps done per
>>
>> https://trac.osgeo.org/gdal/ticket/6883
>>
>>
>>
>> Even
>>
>>
>>
>> --
>>
>> Spatialys - Geospatial professional services
>>
>> http://www.spatialys.com
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
>
> --
> --
> http://schwehr.org
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170514/a46c900f/attachment.html>

From schwehr at gmail.com  Sun May 14 15:43:32 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sun, 14 May 2017 15:43:32 -0700
Subject: [gdal-dev] Review of r38344 - CPLConfigOptionSetter
Message-ID: <CACmBxyv-hoZJT4-0MUhvwQctxeXrXX0Aahtn2P1oqQmsskUEkQ@mail.gmail.com>

Even,

w.r.t. https://trac.osgeo.org/gdal/changeset/38344

It might be a good time to ask you a couple of style questions.  It would
be good to have an explanation of why you chose to implement it the way you
did.  I aim for code that is of the same style for chunks that are both
small and large...  So some of these things might seem a little strange
only in the context of this commit.

1) C char * string vrs std::string vrs CPLString

Why did you choose a char *?  This function is trivial a C++ style string
would add little overhead to GDAL overall.  C strings are inherently touchy
things and using them means you must be careful with the destructor.  The
reader must also read the dtor to check if you did it right.  Bare allocs
(CPLStrdup in this case) are giant red flags for readers like me.  If you
used std::string for m_pszKey and m_pszOldValue, you can always use c_str()
to get a short term C const char * string.

I'm not a fan of CPLString, so I'm glad you didn't use that.  But all over
the code I see the use of CPLString when a std::string would work just
fine.  And if I remember correctly, I've seen you do this before.  Why
didn't you use a CPLString here?

We could always add helper functions to provide all of the CPLString
functionality without having to derive a new class on top of std::string.

http://stackoverflow.com/questions/6006860/why-should-one-not-derive-from-c-std-string-class


It's probably not worth discussing CPLString at the moment.

2) Why not put it all in the header so that the compiler can inline it all
as it is so small?



So something like this is pretty compact and has no bare allocs/news or
free/deletes.  It does call CPLGetConfigOption twice, which is a bummer.

https://gist.github.com/schwehr/a51330a3634dbb4d64a53a08673f0dd4

// Totally untested.

class CPL_DLL CPLConfigOptionSetter
{
  public:
    CPLConfigOptionSetter(const std::string& pszKey, const std::string&
osValue,
                          bool bSetOnlyIfUndefined) :
        m_osKey(osKey),
        m_osOldValue(CPLGetConfigOption(osKey.c_str(), "")),
        m_bRestoreOldValue(false)
    {
        if( (bSetOnlyIfUndefined &&
             CPLGetConfigOption(osKey.c_str(), NULL) == NULL) ||
            !bSetOnlyIfUndefined )
        {
            m_bRestoreOldValue = true;
            CPLSetThreadLocalConfigOption(osKey.c_str(), osValue.c_str());
        }
    }
    ~CPLConfigOptionSetter()
    {
        if( !m_bRestoreOldValue ) return;

        CPLSetThreadLocalConfigOption(m_osKey.c_str(),
m_osOldValue.c_str());
    }

  private:
    const std::string m_osKey;
    const std::string m_osOldValue;
    bool m_bRestoreOldValue;

#if HAVE_CXX11
    CPLConfigOptionSetter(const CPLConfigOptionSetter&) = delete;
    CPLConfigOptionSetter& operator=(const CPLConfigOptionSetter&) = delete;
#else
    CPLConfigOptionSetter(const CPLConfigOptionSetter&);
    CPLConfigOptionSetter& operator=(const CPLConfigOptionSetter&);
#endif
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170514/c55ba38d/attachment.html>

From even.rouault at spatialys.com  Sun May 14 16:05:33 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 May 2017 01:05:33 +0200
Subject: [gdal-dev] Review of r38344 - CPLConfigOptionSetter
In-Reply-To: <CACmBxyv-hoZJT4-0MUhvwQctxeXrXX0Aahtn2P1oqQmsskUEkQ@mail.gmail.com>
References: <CACmBxyv-hoZJT4-0MUhvwQctxeXrXX0Aahtn2P1oqQmsskUEkQ@mail.gmail.com>
Message-ID: <3412909.vOeKF3JTrN@even-i700>

Kurt,

> 1) C char * string vrs std::string vrs CPLString

> I'm not a fan of CPLString, so I'm glad you didn't use that.  But all over
> the code I see the use of CPLString when a std::string would work just
> fine.  And if I remember correctly, I've seen you do this before.  Why
> didn't you use a CPLString here?

This header doesn't include cpl_string.h, so CPLString isn't available. And there might be a 
subtle difference of behaviour between NULL and empty string in the previous value of the 
config option, that would be less convenient to take into account with std::string / CPLString
> 
> 2) Why not put it all in the header so that the compiler can inline it all
> as it is so small?
> 
> 

I didn't see this performance critical to be really worth inlining.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170515/63e0f41a/attachment.html>

From Liam.Candy at angloamerican.com  Mon May 15 05:55:29 2017
From: Liam.Candy at angloamerican.com (Candy, Liam)
Date: Mon, 15 May 2017 12:55:29 +0000
Subject: [gdal-dev] Help with getting gdal python module working
Message-ID: <DB5PR03MB14966467FB0EBCE0A4BB0D7D96E10@DB5PR03MB1496.eurprd03.prod.outlook.com>

Hi,

I've managed to get GDAL 2.1.3 to build with ECW 5.3 support on my 64-bit system. The last hurdle I'm struggling with is getting the python module to install and work. The lines in my nmake.opt file relating to python are;

!IFNDEF PYDIR
PYDIR = "... \AppData\Local\Programs\Python\Python36"
!ENDIF


HAVE_NUMPY=1

But the python module does not install.
I've tried going into the gdal-2.1.3\swig\python folder and installing manually with "python setup.py install", but when I try to import gdal in a script with "from osgeo import gdal" I get the error

Traceback (most recent call last):
  File "...\AppData\Local\Programs\Python\Python36\lib\site-packages\IPython\core\interactiveshell.py", line 2881, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-3-a04b80bf4e65>", line 1, in <module>
    from osgeo import gdal
  File "D:\Program Files (x86)\JetBrains\PyCharm Community Edition 2016.3.2\helpers\pydev\_pydev_bundle\pydev_import_hook.py", line 21, in do_import
    module = self._system_import(name, *args, **kwargs)
  File "...\Local\Programs\Python\Python36\lib\site-packages\gdal-2.1.3-py3.6-win-amd64.egg\osgeo\__init__.py", line 21, in <module>
    _gdal = swig_import_helper()
  File "...\Local\Programs\Python\Python36\lib\site-packages\gdal-2.1.3-py3.6-win-amd64.egg\osgeo\__init__.py", line 17, in swig_import_helper
    _mod = imp.load_module('_gdal', fp, pathname, description)
  File "...\Local\Programs\Python\Python36\Lib\imp.py", line 242, in load_module
    return load_dynamic(name, filename, file)
  File "...\Local\Programs\Python\Python36\Lib\imp.py", line 342, in load_dynamic
    return _load(spec)
ImportError: DLL load failed: The specified module could not be found.

Which I'm assuming is because the GDAL scripts can't find the relevant GDAL dlls.

Any idea on how to fix this ?

Best regards,
Liam.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170515/6a64abf9/attachment-0001.html>

From woodbri at swoodbridge.com  Mon May 15 15:15:01 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Mon, 15 May 2017 18:15:01 -0400
Subject: [gdal-dev] ogr2ogr PROMOTE_TO_MULTI with linestrings?
Message-ID: <a35ea453-ddac-d77a-63ba-835e28101453@swoodbridge.com>

Hi,

I'm trying to load both polygons and linestrings and would like 
PROMOTE_TO_MULTI to work for both, but it appears to define Multipolygon 
type and does not work for linestrings/multilinestrings.

Maybe it would make more sense to have:

PROMOTE_TO_MULTI - work for either polygon or linestring depending on 
what the first object is

or have two options like:

PROMOTE_POLY_TO_MULTI
PROMOTE_LINE_TO_MULTI

Or maybe, I'm totally missing something in the docs.

-Steve

---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From bishop.dev at gmail.com  Mon May 15 15:27:15 2017
From: bishop.dev at gmail.com (Dmitry Baryshnikov)
Date: Tue, 16 May 2017 01:27:15 +0300
Subject: [gdal-dev] GDAL build without big tiff support
Message-ID: <eef88cd6-85d1-98b1-5e69-47019d4905d6@gmail.com>

Hi,

it seem to me there is misprint here:

https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L16195
instead of

 > else if( nCompression == COMPRESSION_JPEG

should be

 > else if( l_nCompression == COMPRESSION_JPEG


Without this fix I get such error in build without BIG TIFF Support: 
error C2597: illegal reference to non-static member 
'GTiffDataset::nCompression'

-- 
Best regards,
     Dmitry


From woodbri at swoodbridge.com  Mon May 15 17:25:39 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Mon, 15 May 2017 20:25:39 -0400
Subject: [gdal-dev] ogr2ogr PROMOTE_TO_MULTI with linestrings?
In-Reply-To: <a35ea453-ddac-d77a-63ba-835e28101453@swoodbridge.com>
References: <a35ea453-ddac-d77a-63ba-835e28101453@swoodbridge.com>
Message-ID: <26437d17-8e29-cf7a-f6af-b4512e246462@swoodbridge.com>

On 5/15/2017 6:15 PM, Stephen Woodbridge wrote:
> Hi,
> 
> I'm trying to load both polygons and linestrings and would like 
> PROMOTE_TO_MULTI to work for both, but it appears to define Multipolygon 
> type and does not work for linestrings/multilinestrings.
> 
> Maybe it would make more sense to have:
> 
> PROMOTE_TO_MULTI - work for either polygon or linestring depending on 
> what the first object is
> 
> or have two options like:
> 
> PROMOTE_POLY_TO_MULTI
> PROMOTE_LINE_TO_MULTI
> 
> Or maybe, I'm totally missing something in the docs.

Sorry, forgot to add:

ogrinfo --version
GDAL 2.1.0, released 2016/04/25

ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f 
PostgreSQL -append PG:dbname=buildings host=localhost port=5432 
user=postgres active_schema=census 
/u/ror/buildings/data/census/tmp-11/tl_2016_06061_roads.shp
Warning 1: Geometry to be inserted is of type Multi Line String, whereas 
the layer geometry type is Multi Polygon.
Insertion is likely to fail
ERROR 1: ERROR:  Geometry type (MultiLineString) does not match column 
type (MultiPolygon)


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From jukka.rahkonen at maanmittauslaitos.fi  Mon May 15 23:58:33 2017
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 15 May 2017 23:58:33 -0700 (MST)
Subject: [gdal-dev] ogr2ogr PROMOTE_TO_MULTI with linestrings?
In-Reply-To: <26437d17-8e29-cf7a-f6af-b4512e246462@swoodbridge.com>
References: <a35ea453-ddac-d77a-63ba-835e28101453@swoodbridge.com>
 <26437d17-8e29-cf7a-f6af-b4512e246462@swoodbridge.com>
Message-ID: <1494917913160-5320626.post@n6.nabble.com>

Stephen Woodbridge wrote
> On 5/15/2017 6:15 PM, Stephen Woodbridge wrote:
>> Hi,
>> 
>> I'm trying to load both polygons and linestrings and would like 
>> PROMOTE_TO_MULTI to work for both, but it appears to define Multipolygon 
>> type and does not work for linestrings/multilinestrings.
>> 
>> Maybe it would make more sense to have:
>> 
>> PROMOTE_TO_MULTI - work for either polygon or linestring depending on 
>> what the first object is
>> 
>> or have two options like:
>> 
>> PROMOTE_POLY_TO_MULTI
>> PROMOTE_LINE_TO_MULTI
>> 
>> Or maybe, I'm totally missing something in the docs.
> 
> Sorry, forgot to add:
> 
> ogrinfo --version
> GDAL 2.1.0, released 2016/04/25
> 
> ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f 
> PostgreSQL -append PG:dbname=buildings host=localhost port=5432 
> user=postgres active_schema=census 
> /u/ror/buildings/data/census/tmp-11/tl_2016_06061_roads.shp
> Warning 1: Geometry to be inserted is of type Multi Line String, whereas 
> the layer geometry type is Multi Polygon.
> Insertion is likely to fail
> ERROR 1: ERROR:  Geometry type (MultiLineString) does not match column 
> type (MultiPolygon)

Hi,

Please tell more details about what you plan to do. Shapefile can't contain
a mixture of lines and polygons so the error you get must mean that PostGIS
table "census.roads" already exists and it has been created as MultiPolygon.
Did you convert some polygons from another shapefile into the same table
before? Anyway the restriction is at this stage set by PostGIS which
requires multipolygons and you just can't  convert your lines into
multipolygons.

Drop your table and start again by using -nlt GEOMETRY and you should be
fine. That makes the PostGIS table to accept any kind of geometries. If you
definitely need a mixture of MULTIpolygons and MULTIlinestrins we must add
casts somewhere but perhaps that is not what you really want.

-Jukka Rahkonen-






--
View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-ogr2ogr-PROMOTE-TO-MULTI-with-linestrings-tp5320602p5320626.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From 24dakenlo at gmail.com  Tue May 16 00:16:59 2017
From: 24dakenlo at gmail.com (NASAHARA Kenlo)
Date: Tue, 16 May 2017 16:16:59 +0900
Subject: [gdal-dev] mapping of shadows casted by other slopes
Message-ID: <20170516161659.caf2ef0c00bbc86713177391@gmail.com>

Dear GDAL people:

Using DSM, I want a "shadow map" not only by the slope 
itself but also by the other slopes. I mean, if a tall and
steep peak exists, and if it is illuminated by the sun from 
near the horizon, the shadow of the peak falls on a wide
area of the foot of the mountain. Such shadow is normally
not estimated by a simple "hillsahde" algorithm, which 
includes the "gdaldem" command. I want to map such 
shadows as well as the normal "hillshade" shadows.

If you know a library or command to help it, please let 
me know!!

-- 
Kenlo Nishida Nasahara
Faculty of Life and Environmental Sciences
University of Tsukuba, Japan 305-8572
24dakenlo at gmail.com

From even.rouault at spatialys.com  Tue May 16 00:30:14 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2017 09:30:14 +0200
Subject: [gdal-dev] GDAL build without big tiff support
In-Reply-To: <eef88cd6-85d1-98b1-5e69-47019d4905d6@gmail.com>
References: <eef88cd6-85d1-98b1-5e69-47019d4905d6@gmail.com>
Message-ID: <1691844.lqWCrhh7CE@even-i700>

On mardi 16 mai 2017 01:27:15 CEST Dmitry Baryshnikov wrote:
> Hi,
> 
> it seem to me there is misprint here:
> 
> https://github.com/OSGeo/gdal/blob/trunk/gdal/frmts/gtiff/geotiff.cpp#L16195
> instead of
> 
>  > else if( nCompression == COMPRESSION_JPEG
> 
> should be
> 
>  > else if( l_nCompression == COMPRESSION_JPEG
> 
> 
Indeed. Fixed per https://trac.osgeo.org/gdal/ticket/6890

As you may guess, this configuration hasn't been tested in a while at runtime too.

Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/b72737fa/attachment.html>

From doug_newcomb at fws.gov  Tue May 16 01:22:23 2017
From: doug_newcomb at fws.gov (Newcomb, Doug)
Date: Tue, 16 May 2017 04:22:23 -0400
Subject: [gdal-dev] mapping of shadows casted by other slopes
In-Reply-To: <20170516161659.caf2ef0c00bbc86713177391@gmail.com>
References: <20170516161659.caf2ef0c00bbc86713177391@gmail.com>
Message-ID: <CALQGVr1v7cy3XFY9R9XEKGPitx40SAKixn4WfGvta0Dr0CwmqA@mail.gmail.com>

Kenlo,
Suggest you look at  GRASS GIS r.sun ,
https://grass.osgeo.org/grass72/manuals/r.sun.html.

Doug

On Tue, May 16, 2017 at 3:16 AM, NASAHARA Kenlo <24dakenlo at gmail.com> wrote:

> Dear GDAL people:
>
> Using DSM, I want a "shadow map" not only by the slope
> itself but also by the other slopes. I mean, if a tall and
> steep peak exists, and if it is illuminated by the sun from
> near the horizon, the shadow of the peak falls on a wide
> area of the foot of the mountain. Such shadow is normally
> not estimated by a simple "hillsahde" algorithm, which
> includes the "gdaldem" command. I want to map such
> shadows as well as the normal "hillshade" shadows.
>
> If you know a library or command to help it, please let
> me know!!
>
> --
> Kenlo Nishida Nasahara
> Faculty of Life and Environmental Sciences
> University of Tsukuba, Japan 305-8572
> 24dakenlo at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev




-- 
Doug Newcomb
USFWS
551F Pylon Dr
Raleigh, NC
919-856-4520 ext. 14 doug_newcomb at fws.gov
---------------------------------------------------------------------------------------------------------
The opinions I express are my own and are not representative of the
official policy of the U.S.Fish and Wildlife Service or Dept. of the
Interior.   Life is too short for undocumented, proprietary data formats.
*NOTE: This email correspondence and any attachments to and from this
sender is subject to the Freedom of Information Act (FOIA) and may be
disclosed to third parties.*​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/c7d1ebcb/attachment-0001.html>

From Volker.Wichmann at uibk.ac.at  Tue May 16 01:43:57 2017
From: Volker.Wichmann at uibk.ac.at (Volker Wichmann)
Date: Tue, 16 May 2017 10:43:57 +0200
Subject: [gdal-dev] mapping of shadows casted by other slopes
In-Reply-To: <CALQGVr1v7cy3XFY9R9XEKGPitx40SAKixn4WfGvta0Dr0CwmqA@mail.gmail.com>
References: <20170516161659.caf2ef0c00bbc86713177391@gmail.com>
 <CALQGVr1v7cy3XFY9R9XEKGPitx40SAKixn4WfGvta0Dr0CwmqA@mail.gmail.com>
Message-ID: <7ed84d72-3434-1513-618e-a6dd3362d5f3@uibk.ac.at>

Hi,

another, may be simpler option is SAGA GIS, its analytical hillshading 
tool includes a ray tracing option:

http://www.saga-gis.org/saga_tool_doc/4.1.0/ta_lighting_0.html

Volker


On 05/16/2017 10:22 AM, Newcomb, Doug wrote:
> Kenlo,
> Suggest you look at  GRASS GIS r.sun , 
> https://grass.osgeo.org/grass72/manuals/r.sun.html.
> 
> Doug
> 
> On Tue, May 16, 2017 at 3:16 AM, NASAHARA Kenlo <24dakenlo at gmail.com 
> <mailto:24dakenlo at gmail.com>> wrote:
> 
>     Dear GDAL people:
> 
>     Using DSM, I want a "shadow map" not only by the slope
>     itself but also by the other slopes. I mean, if a tall and
>     steep peak exists, and if it is illuminated by the sun from
>     near the horizon, the shadow of the peak falls on a wide
>     area of the foot of the mountain. Such shadow is normally
>     not estimated by a simple "hillsahde" algorithm, which
>     includes the "gdaldem" command. I want to map such
>     shadows as well as the normal "hillshade" shadows.
> 
>     If you know a library or command to help it, please let
>     me know!!
> 
>     --
>     Kenlo Nishida Nasahara
>     Faculty of Life and Environmental Sciences
>     University of Tsukuba, Japan 305-8572
>     24dakenlo at gmail.com <mailto:24dakenlo at gmail.com>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> 
> 
> 
> 
> -- 
> Doug Newcomb
> USFWS
> 551F Pylon Dr
> Raleigh, NC
> 919-856-4520 ext. 14 doug_newcomb at fws.gov <mailto:doug_newcomb at fws.gov>
> ---------------------------------------------------------------------------------------------------------
> The opinions I express are my own and are not representative of the 
> official policy of the U.S.Fish and Wildlife Service or Dept. of the 
> Interior.   Life is too short for undocumented, proprietary data formats.
> */NOTE: This email correspondence and any attachments to and from this 
> sender is subject to the Freedom of Information Act (FOIA) and may be 
> disclosed to third parties./*​
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


From richard.greenwood at gmail.com  Tue May 16 05:56:38 2017
From: richard.greenwood at gmail.com (Richard Greenwood)
Date: Tue, 16 May 2017 06:56:38 -0600
Subject: [gdal-dev] ogr2ogr PROMOTE_TO_MULTI with linestrings?
In-Reply-To: <26437d17-8e29-cf7a-f6af-b4512e246462@swoodbridge.com>
References: <a35ea453-ddac-d77a-63ba-835e28101453@swoodbridge.com>
 <26437d17-8e29-cf7a-f6af-b4512e246462@swoodbridge.com>
Message-ID: <CAHBySPbNrot95-wr0mF6XGLPJ71oAE6TiP8mvcHyQ=qps1VYPg@mail.gmail.com>

You could use -nlt geometry but that won't convert simple objects to multi
objects.
You could do it in steps:

   1. use -where to get lines and -nlt MultiLine
   2. use -where to get polys with -nlt MutliPolygon
   3. combine the two tables into a single Geometry table

Rich


On Mon, May 15, 2017 at 6:25 PM, Stephen Woodbridge <woodbri at swoodbridge.com
> wrote:

> On 5/15/2017 6:15 PM, Stephen Woodbridge wrote:
>
>> Hi,
>>
>> I'm trying to load both polygons and linestrings and would like
>> PROMOTE_TO_MULTI to work for both, but it appears to define Multipolygon
>> type and does not work for linestrings/multilinestrings.
>>
>> Maybe it would make more sense to have:
>>
>> PROMOTE_TO_MULTI - work for either polygon or linestring depending on
>> what the first object is
>>
>> or have two options like:
>>
>> PROMOTE_POLY_TO_MULTI
>> PROMOTE_LINE_TO_MULTI
>>
>> Or maybe, I'm totally missing something in the docs.
>>
>
> Sorry, forgot to add:
>
> ogrinfo --version
> GDAL 2.1.0, released 2016/04/25
>
> ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f
> PostgreSQL -append PG:dbname=buildings host=localhost port=5432
> user=postgres active_schema=census /u/ror/buildings/data/census/t
> mp-11/tl_2016_06061_roads.shp
> Warning 1: Geometry to be inserted is of type Multi Line String, whereas
> the layer geometry type is Multi Polygon.
> Insertion is likely to fail
> ERROR 1: ERROR:  Geometry type (MultiLineString) does not match column
> type (MultiPolygon)
>
>
>
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Richard W. Greenwood, PLS
www.greenwoodmap.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/09a348df/attachment.html>

From woodbri at swoodbridge.com  Tue May 16 06:21:06 2017
From: woodbri at swoodbridge.com (Stephen Woodbridge)
Date: Tue, 16 May 2017 09:21:06 -0400
Subject: [gdal-dev] ogr2ogr PROMOTE_TO_MULTI with linestrings?
In-Reply-To: <1494917913160-5320626.post@n6.nabble.com>
References: <a35ea453-ddac-d77a-63ba-835e28101453@swoodbridge.com>
 <26437d17-8e29-cf7a-f6af-b4512e246462@swoodbridge.com>
 <1494917913160-5320626.post@n6.nabble.com>
Message-ID: <7dcf5730-bbb9-d50b-ccff-bd1fe3f31db4@swoodbridge.com>

I'm just trying to load the census roads data. I think what happened is 
that when the table was created using -nlt PROMOTE_TO_MULTI it was 
created as polygon geometry. then the subsequent insert failed. I change 
the script to -nlt MULTILINESTRING and it loaded all the data. I found a 
post from Even circa 2012 IIRC that indicated PROMOTE_TO_MULTI should 
work for both polygons and linestrings.

I just checked the log file and the table was created with:

ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f 
PostgreSQL -overwrite -lco OVERWRITE=YES -lco PRECISION=NO -lco 
GEOMETRY_NAME=geom -lco FID=gid "PG:dbname=buildings host=localhost 
port=5432 user=postgres active_schema=census" 
/u/ror/buildings/data/census/tmp-11/tl_2016_us_county.shp

and then failed on the first insert:

ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f 
PostgreSQL -append "PG:dbname=buildings host=localhost port=5432 
user=postgres active_schema=census" 
/u/ror/buildings/data/census/tmp-11/tl_2016_06001_roads.shp
Warning 1: Geometry to be inserted is of type Multi Line String, whereas 
the layer geometry type is Multi Polygon.
Insertion is likely to fail
ERROR 1: ERROR:  Geometry type (MultiLineString) does not match column 
type (MultiPolygon)

ERROR 1: INSERT command for new feature failed.

When I changed, PROMOTE_TO_MULTI to MULTILINESTRING, everything worked 
fine. I only loaded one state (CA), but I do know for a fact that some 
of the Census roads data has a mix of Linestring and MultiLinestring 
features, which is why I used PROMOTE_TO_MULTI in the first place.

-Steve

On 5/16/2017 2:58 AM, jratike80 wrote:
> Stephen Woodbridge wrote
>> On 5/15/2017 6:15 PM, Stephen Woodbridge wrote:
>>> Hi,
>>>
>>> I'm trying to load both polygons and linestrings and would like
>>> PROMOTE_TO_MULTI to work for both, but it appears to define Multipolygon
>>> type and does not work for linestrings/multilinestrings.
>>>
>>> Maybe it would make more sense to have:
>>>
>>> PROMOTE_TO_MULTI - work for either polygon or linestring depending on
>>> what the first object is
>>>
>>> or have two options like:
>>>
>>> PROMOTE_POLY_TO_MULTI
>>> PROMOTE_LINE_TO_MULTI
>>>
>>> Or maybe, I'm totally missing something in the docs.
>>
>> Sorry, forgot to add:
>>
>> ogrinfo --version
>> GDAL 2.1.0, released 2016/04/25
>>
>> ogr2ogr -t_srs EPSG:4326 -nln census.roads -nlt PROMOTE_TO_MULTI -f
>> PostgreSQL -append PG:dbname=buildings host=localhost port=5432
>> user=postgres active_schema=census
>> /u/ror/buildings/data/census/tmp-11/tl_2016_06061_roads.shp
>> Warning 1: Geometry to be inserted is of type Multi Line String, whereas
>> the layer geometry type is Multi Polygon.
>> Insertion is likely to fail
>> ERROR 1: ERROR:  Geometry type (MultiLineString) does not match column
>> type (MultiPolygon)
> 
> Hi,
> 
> Please tell more details about what you plan to do. Shapefile can't contain
> a mixture of lines and polygons so the error you get must mean that PostGIS
> table "census.roads" already exists and it has been created as MultiPolygon.
> Did you convert some polygons from another shapefile into the same table
> before? Anyway the restriction is at this stage set by PostGIS which
> requires multipolygons and you just can't  convert your lines into
> multipolygons.
> 
> Drop your table and start again by using -nlt GEOMETRY and you should be
> fine. That makes the PostGIS table to accept any kind of geometries. If you
> definitely need a mixture of MULTIpolygons and MULTIlinestrins we must add
> casts somewhere but perhaps that is not what you really want.
> 
> -Jukka Rahkonen-
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://osgeo-org.1560.x6.nabble.com/gdal-dev-ogr2ogr-PROMOTE-TO-MULTI-with-linestrings-tp5320602p5320626.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From even.rouault at spatialys.com  Tue May 16 06:53:16 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2017 15:53:16 +0200
Subject: [gdal-dev] ogr2ogr PROMOTE_TO_MULTI with linestrings?
In-Reply-To: <7dcf5730-bbb9-d50b-ccff-bd1fe3f31db4@swoodbridge.com>
References: <a35ea453-ddac-d77a-63ba-835e28101453@swoodbridge.com>
 <1494917913160-5320626.post@n6.nabble.com>
 <7dcf5730-bbb9-d50b-ccff-bd1fe3f31db4@swoodbridge.com>
Message-ID: <1547032.JaecoIDzDg@even-i700>

On mardi 16 mai 2017 09:21:06 CEST Stephen Woodbridge wrote:
> I'm just trying to load the census roads data. I think what happened is
> that when the table was created using -nlt PROMOTE_TO_MULTI it was
> created as polygon geometry. then the subsequent insert failed. I change
> the script to -nlt MULTILINESTRING and it loaded all the data. I found a
> post from Even circa 2012 IIRC that indicated PROMOTE_TO_MULTI should
> work for both polygons and linestrings.

It does, but it promotes the layer geometry type  *source* to the corresponding 
multi geometry type. It doesn't take into account the target layer geometry type. 
We should perhaps have a a-nlt DST_GEOMETRY_TYPE for that.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/1348e647/attachment.html>

From schwehr at gmail.com  Tue May 16 07:01:53 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 16 May 2017 07:01:53 -0700
Subject: [gdal-dev] Resizing CPLErrorContext?
Message-ID: <CACmBxytZ+obGivU9X8YKtOvy6Nwzbrkndru8G3M15NRU1s+rmw@mail.gmail.com>

w.r.t. https://trac.osgeo.org/gdal/changeset/38405

Exactly why is it okay to resize this fixed size structure?

typedef struct {
    CPLErrorNum nLastErrNo;
    CPLErr  eLastErrType;
    CPLErrorHandlerNode *psHandlerStack;
    int     nLastErrMsgMax;
    int     nFailureIntoWarning;
    char    szLastErrMsg[DEFAULT_LAST_ERR_MSG_SIZE];
    // Do not add anything here. szLastErrMsg must be the last field.
    // See CPLRealloc() below.
} CPLErrorContext;

Your comment is:

CPLErrorSetState(): Workaround clang -fsanitize=undefined behaviour that
doesn't like dereferencing szLastErrMsg[i>=DEFAULT_LAST_ERR_MSG_SIZE] even
when structure has been properly resize. Fixes ​
https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=1628. Credit to OSS
Fuz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/fa1bfffb/attachment.html>

From even.rouault at spatialys.com  Tue May 16 07:35:19 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2017 16:35:19 +0200
Subject: [gdal-dev] Resizing CPLErrorContext?
In-Reply-To: <CACmBxytZ+obGivU9X8YKtOvy6Nwzbrkndru8G3M15NRU1s+rmw@mail.gmail.com>
References: <CACmBxytZ+obGivU9X8YKtOvy6Nwzbrkndru8G3M15NRU1s+rmw@mail.gmail.com>
Message-ID: <3631178.8Dg76kHKjR@even-i700>

On mardi 16 mai 2017 07:01:53 CEST Kurt Schwehr wrote:
> w.r.t. https://trac.osgeo.org/gdal/changeset/38405
> 
> Exactly why is it okay to resize this fixed size structure?

Well, this is a good old trick of grey-beard C programmers, isn't it ? Not sure 
what the C/C++ standards says about that, but it works pretty well in 
practice.

Some explanations at:
http://stackoverflow.com/a/3123792

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/c0971268/attachment-0001.html>

From mchapman at hyperacktive.com  Tue May 16 09:13:52 2017
From: mchapman at hyperacktive.com (Martin Chapman)
Date: Tue, 16 May 2017 10:13:52 -0600
Subject: [gdal-dev] MrSID Color Spaces
Message-ID: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>

Even or Frank or whoever it may concern,

 

Not a big deal but I was trying to open a JP2 file using the MrSID driver
and noticed that the mrsiddataset.cpp does not identify the color spaces
MRSID_LTI_COLORSPACE_GRAYSCALEA and MRSID_LTI_COLORSPACE_GRAYSCALEA_PM
configurations in the MrSIDRasterBand() constructor.  I happen to have a two
band JP2 that is a grayscale image with an alpha channel.   The color
interpretation comes back as GCI_undefined.  Not that important but if you
ever feel like fixing it, that would be nice.

 

The fix would go somewhere close to line 485 in mrsiddataset.cpp.  Basically
just need to add a couple of more case statements in the switch statement.

 

FYI, it does however correctly identify the color interpretation when the
jp2 file is RGBA.

 

Best regards,

Martin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/ae8faaff/attachment.html>

From even.rouault at spatialys.com  Tue May 16 09:28:01 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2017 18:28:01 +0200
Subject: [gdal-dev] MrSID Color Spaces
In-Reply-To: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
References: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
Message-ID: <87941027.MLZxqyMhZO@even-i700>

On mardi 16 mai 2017 10:13:52 CEST Martin Chapman wrote:
> Even or Frank or whoever it may concern,
> 
> 
> 
> Not a big deal but I was trying to open a JP2 file using the MrSID driver
> and noticed that the mrsiddataset.cpp does not identify the color spaces
> MRSID_LTI_COLORSPACE_GRAYSCALEA and MRSID_LTI_COLORSPACE_GRAYSCALEA_PM
> configurations in the MrSIDRasterBand() constructor.  I happen to have a two
> band JP2 that is a grayscale image with an alpha channel.   The color
> interpretation comes back as GCI_undefined.  Not that important but if you
> ever feel like fixing it, that would be nice.
> 
> 
> 
> The fix would go somewhere close to line 485 in mrsiddataset.cpp.  Basically
> just need to add a couple of more case statements in the switch statement.

Martin,

Seems you are closed to a patch. Can you provide it ?

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/4263acb9/attachment.html>

From schwehr at gmail.com  Tue May 16 10:26:09 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 16 May 2017 10:26:09 -0700
Subject: [gdal-dev] Resizing CPLErrorContext?
In-Reply-To: <3631178.8Dg76kHKjR@even-i700>
References: <CACmBxytZ+obGivU9X8YKtOvy6Nwzbrkndru8G3M15NRU1s+rmw@mail.gmail.com>
 <3631178.8Dg76kHKjR@even-i700>
Message-ID: <CACmBxyuR1sgLV_kXAWR1h-ODdwOGfPiw9Dq7P+iCVoTpJ7Ju8A@mail.gmail.com>

I now know this is referred to as the "struct hack."

This really is undefined behavior in the C++11 standard...  there was a
proposal to make the struct hack valid for C++11:

http://www.open-std.org/jtc1/sc22/wg14/www/docs/n791.htm
<https://www.google.com/url?sa=D&q=http%3A%2F%2Fwww.open-std.org%2Fjtc1%2Fsc22%2Fwg14%2Fwww%2Fdocs%2Fn791.htm>

>From another google engineer:

5.2.1 tells you that x[y] is identical to *(x + y).
5.7.5 tells you that x + y has undefined behavior if the result points
outside of the array.

>From the C++11 standard:

5.2.1 Subscripting [expr.sub]
1 A postfix expression followed by an expression in square brackets is a
postfix expression. One of the expressions
shall have the type “pointer to T” and the other shall have unscoped
enumeration or integral type.
The result is an lvalue of type “T.” The type “T” shall be a
completely-defined object type.62 The expression
E1[E2] is identical (by definition) to *((E1)+(E2)) [ Note: see 5.3 and 5.7
for details of * and + and 8.3.4
for details of arrays. — end note ]

5.7 Additive operators
...

5.7.5 When an expression that has integral type is added to or subtracted
from a pointer, the result has the type
of the pointer operand. If the pointer operand points to an element of an
array object, and the array is
large enough, the result points to an element offset from the original
element such that the difference of
the subscripts of the resulting and original array elements equals the
integral expression. In other words, if
the expression P points to the i-th element of an array object, the
expressions (P)+N (equivalently, N+(P))
and (P)-N (where N has the value n) point to, respectively, the i + n-th
and i − n-th elements of the array
object, provided they exist. Moreover, if the expression P points to the
last element of an array object,
the expression (P)+1 points one past the last element of the array object,
and if the expression Q points
one past the last element of an array object, the expression (Q)-1 points
to the last element of the array
object. If both the pointer operand and the result point to elements of the
same array object, or one past
the last element of the array object, the evaluation shall not produce an
overflow; otherwise, the behavior is
undefined.



On Tue, May 16, 2017 at 7:35 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 16 mai 2017 07:01:53 CEST Kurt Schwehr wrote:
>
> > w.r.t. https://trac.osgeo.org/gdal/changeset/38405
>
> >
>
> > Exactly why is it okay to resize this fixed size structure?
>
>
>
> Well, this is a good old trick of grey-beard C programmers, isn't it ? Not
> sure what the C/C++ standards says about that, but it works pretty well in
> practice.
>
>
>
> Some explanations at:
>
> http://stackoverflow.com/a/3123792
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/9c658766/attachment.html>

From even.rouault at spatialys.com  Tue May 16 11:01:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2017 20:01:06 +0200
Subject: [gdal-dev] Resizing CPLErrorContext?
In-Reply-To: <CACmBxyuR1sgLV_kXAWR1h-ODdwOGfPiw9Dq7P+iCVoTpJ7Ju8A@mail.gmail.com>
References: <CACmBxytZ+obGivU9X8YKtOvy6Nwzbrkndru8G3M15NRU1s+rmw@mail.gmail.com>
 <3631178.8Dg76kHKjR@even-i700>
 <CACmBxyuR1sgLV_kXAWR1h-ODdwOGfPiw9Dq7P+iCVoTpJ7Ju8A@mail.gmail.com>
Message-ID: <1825789.9mvPAALuII@even-i700>

On mardi 16 mai 2017 10:26:09 CEST Kurt Schwehr wrote:
> I now know this is referred to as the "struct hack."
> 
> This really is undefined behavior in the C++11 standard...  

Well, I don't think the hack is really needed and char szLastErrorMsg[] could be 
replaces by a char* pszLastErrorMsg that would be malloc'ated.
The current situation comes from the fact that originally no custom free function 
could be associated with a TLS member, but now that we have a
CPLSetTLSWithFreeFunc() we could use it to free the pszLastErrorMsg member 
before freeing the context.

(or use std::string if you prefer, but this code portion can be run under very low 
memory conditions, so great care is needed)

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/c1475aa5/attachment-0001.html>

From vladimir.sandoval at yandex.com  Tue May 16 11:39:03 2017
From: vladimir.sandoval at yandex.com (Vlad)
Date: Tue, 16 May 2017 11:39:03 -0700 (MST)
Subject: [gdal-dev] Looking for a "surefire" way to get valid output formats.
Message-ID: <1494959943422-5320711.post@n6.nabble.com>

Basically trying to keep users from selecting an invalid -of parameter in
translate and warp.

Looking at gdalinfo --formats I see this for PNG..

 PNG -raster- (rwv): Portable Network Graphics

and gdalinfo --format png, I get...

 Supports: Open() - Open existing dataset.
 Supports: CreateCopy() - Create dataset by copying another.
 Supports: Virtual IO - eg. /vsimem/

HOWEVER, the key/value pairs in the PNG driver metadata map give me...
"DCAP_CREATECOPY"=YES

and no "DCAP_CREATE". 

For a BMP I get a "DCAP_CREATE" = YES, and there is no "DCAP_CREATECOPY",
however I know translate will work with -of png or -of bmp.

What should I be looking at to see if a driver short name is a supported
output type?





--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Looking-for-a-surefire-way-to-get-valid-output-formats-tp5320711.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From even.rouault at spatialys.com  Tue May 16 12:18:07 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2017 21:18:07 +0200
Subject: [gdal-dev] Looking for a "surefire" way to get valid output
	formats.
In-Reply-To: <1494959943422-5320711.post@n6.nabble.com>
References: <1494959943422-5320711.post@n6.nabble.com>
Message-ID: <10914803.6RCpaR3I7b@even-i700>

On mardi 16 mai 2017 11:39:03 CEST Vlad wrote:
> Basically trying to keep users from selecting an invalid -of parameter in
> translate and warp.
> 
> Looking at gdalinfo --formats I see this for PNG..
> 
>  PNG -raster- (rwv): Portable Network Graphics
> 
> and gdalinfo --format png, I get...
> 
>  Supports: Open() - Open existing dataset.
>  Supports: CreateCopy() - Create dataset by copying another.
>  Supports: Virtual IO - eg. /vsimem/
> 
> HOWEVER, the key/value pairs in the PNG driver metadata map give me...
> "DCAP_CREATECOPY"=YES
> 
> and no "DCAP_CREATE".
> 
> For a BMP I get a "DCAP_CREATE" = YES, and there is no "DCAP_CREATECOPY",
> however I know translate will work with -of png or -of bmp.
> 
> What should I be looking at to see if a driver short name is a supported
> output type?

I've just improved the doc regarding those aspects. 

Extract:


/** Capability set by a driver that implements the Create() API.
 * 
 * If GDAL_DCAP_CREATE is set, but GDAL_DCAP_CREATECOPY not, a generic
 * CreateCopy() implementation is available and will use the Create() API of
 * the driver.
 * So to test if some CreateCopy() implementation is available, generic or
 * specialize, test for both GDAL_DCAP_CREATE and GDAL_DCAP_CREATECOPY.
 */
#define GDAL_DCAP_CREATE     "DCAP_CREATE"

/** Capability set by a driver that implements the CreateCopy() API. 
 * 
 * If GDAL_DCAP_CREATECOPY is not defined, but GDAL_DCAP_CREATE is set, a generic
 * CreateCopy() implementation is available and will use the Create() API of
 * the driver.
 * So to test if some CreateCopy() implementation is available, generic or
 * specialize, test for both GDAL_DCAP_CREATE and GDAL_DCAP_CREATECOPY.
 */
#define GDAL_DCAP_CREATECOPY "DCAP_CREATECOPY"


/**
 * \brief Create a copy of a dataset.
 *
 * This method will attempt to create a copy of a raster dataset with the
 * indicated filename, and in this drivers format.  Band number, size,
 * type, projection, geotransform and so forth are all to be copied from
 * the provided template dataset.
 *
 * Note that many sequential write once formats (such as JPEG and PNG) don't
 * implement the Create() method but do implement this CreateCopy() method.
 * If the driver doesn't implement CreateCopy(), but does implement Create()
 * then the default CreateCopy() mechanism built on calling Create() will
 * be used.
 * So to test if CreateCopy() is available, you can test if GDAL_DCAP_CREATECOPY
 * or GDAL_DCAP_CREATE is set in the GDAL metadata.
 *
 * It is intended that CreateCopy() will often be used with a source dataset
 * which is a virtual dataset allowing configuration of band types, and other
 * information without actually duplicating raster data (see the VRT driver).
 * This is what is done by the gdal_translate utility for example.
 *
 * That function will try to validate the creation option list passed to the
 * driver with the GDALValidateCreationOptions() method. This check can be
 * disabled by defining the configuration option
 * GDAL_VALIDATE_CREATION_OPTIONS=NO.
 *
 * After you have finished working with the returned dataset, it is
 * <b>required</b> to close it with GDALClose(). This does not only close the
 * file handle, but also ensures that all the data and metadata has been written
 * to the dataset (GDALFlushCache() is not sufficient for that purpose).
 *
 * In some situations, the new dataset can be created in another process through
 * the \ref gdal_api_proxy mechanism.
 *
 * @param pszFilename the name for the new dataset.  UTF-8 encoded.
 * @param poSrcDS the dataset being duplicated.
 * @param bStrict TRUE if the copy must be strictly equivalent, or more
 * normally FALSE indicating that the copy may adapt as needed for the
 * output format.
 * @param papszOptions additional format dependent options controlling
 * creation of the output file. The APPEND_SUBDATASET=YES option can be
 * specified to avoid prior destruction of existing dataset.
 * @param pfnProgress a function to be used to report progress of the copy.
 * @param pProgressData application data passed into progress function.
 *
 * @return a pointer to the newly created dataset (may be read-only access).
 */

GDALDataset *GDALDriver::CreateCopy( const char * pszFilename,
                                     GDALDataset * poSrcDS,
                                     int bStrict, char ** papszOptions,
                                     GDALProgressFunc pfnProgress,
                                     void * pProgressData );

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/d29b6661/attachment.html>

From schwehr at gmail.com  Tue May 16 12:40:20 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Tue, 16 May 2017 12:40:20 -0700
Subject: [gdal-dev] Resizing CPLErrorContext?
In-Reply-To: <1825789.9mvPAALuII@even-i700>
References: <CACmBxytZ+obGivU9X8YKtOvy6Nwzbrkndru8G3M15NRU1s+rmw@mail.gmail.com>
 <3631178.8Dg76kHKjR@even-i700>
 <CACmBxyuR1sgLV_kXAWR1h-ODdwOGfPiw9Dq7P+iCVoTpJ7Ju8A@mail.gmail.com>
 <1825789.9mvPAALuII@even-i700>
Message-ID: <CACmBxysCjDuQhAUKrRqKWuK0APFbgtyrvJYaUN0g118pSEjORA@mail.gmail.com>

I would strongly lean towards std::string if possible.

I'm not sure how a realloc on the heap is any less safe than a std::string
and strings can have memory reserved at construction time (or
::reserve()).  Or in crazy cases, a custom allocator can be used that has a
preallocated pool of memory available for when the system is OOM.

A related question... any idea what the '0' char is for?  It looks like you
introduced the zero char after \n in
https://trac.osgeo.org/gdal/changeset/14601  and I don't see '0' in
https://trac.osgeo.org/gdal/browser/trunk/gdal/port/cpl_error.cpp?annotate=blame&rev=14600

On Tue, May 16, 2017 at 11:01 AM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On mardi 16 mai 2017 10:26:09 CEST Kurt Schwehr wrote:
>
> > I now know this is referred to as the "struct hack."
>
> >
>
> > This really is undefined behavior in the C++11 standard...
>
>
>
> Well, I don't think the hack is really needed and char szLastErrorMsg[]
> could be replaces by a char* pszLastErrorMsg that would be malloc'ated.
>
> The current situation comes from the fact that originally no custom free
> function could be associated with a TLS member, but now that we have a
>
> CPLSetTLSWithFreeFunc() we could use it to free the pszLastErrorMsg member
> before freeing the context.
>
>
>
> (or use std::string if you prefer, but this code portion can be run under
> very low memory conditions, so great care is needed)
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/53a99b78/attachment-0001.html>

From even.rouault at spatialys.com  Tue May 16 13:00:42 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 May 2017 22:00:42 +0200
Subject: [gdal-dev] Resizing CPLErrorContext?
In-Reply-To: <CACmBxysCjDuQhAUKrRqKWuK0APFbgtyrvJYaUN0g118pSEjORA@mail.gmail.com>
References: <CACmBxytZ+obGivU9X8YKtOvy6Nwzbrkndru8G3M15NRU1s+rmw@mail.gmail.com>
 <1825789.9mvPAALuII@even-i700>
 <CACmBxysCjDuQhAUKrRqKWuK0APFbgtyrvJYaUN0g118pSEjORA@mail.gmail.com>
Message-ID: <14659188.XMVKusKJ88@even-i700>

> 
> A related question... any idea what the '0' char is for?  It looks like you
> introduced the zero char after \n in
> https://trac.osgeo.org/gdal/changeset/14601  and I don't see '0' in
> https://trac.osgeo.org/gdal/browser/trunk/gdal/port/cpl_error.cpp?
annotate=b
> lame&rev=14600

Should have been '\0' indeed. Fixed. This has no practical consequence 
since this character is just overwritten by the CPLvsnprintf() call a few 
lines after.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/6e3dacfd/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue May 16 13:54:14 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 16 May 2017 20:54:14 +0000
Subject: [gdal-dev] ogr2ogr PROMOTE_TO_MULTI with linestrings?
Message-ID: <1494968058220.78113@maanmittauslaitos.fi>

Hi,

Could you have a try with attached data that contains 2 linestrings?

ogr2ogr -f Postgresql PG:"dbname=gis host=localhost port=5432 user=user password=password" -overwrite -nln linetest -nlt promote_to_multi lines.shp --debug on

ogr2ogr -f Postgresql PG:"dbname=gis host=localhost port=5432 user=user password=password" -append -nln linetest -nlt promote_to_multi lines.shp --debug on

For me the result is a table named as "linetest" that contains 4 multilinestring geometries. I tried to fool ogr2ogr by creating first "linetest" with multipolygon geometries but it cleared the test and -overwrite changed the table into multilinestring just fine. I tested also with a polygon shapefile and I can tell that for me PROMOTE_TO_MULTI does work for both lines and polygons.

The SQL create statement captured from the database for the multilinestring case is

-- Table: public.linetest

-- DROP TABLE public.linetest;

CREATE TABLE public.linetest
(
  ogc_fid integer NOT NULL DEFAULT nextval('linetest_ogc_fid_seq'::regclass),
  wkb_geometry geometry(MultiLineString),
  CONSTRAINT linetest_pkey PRIMARY KEY (ogc_fid)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE public.linetest
  OWNER TO xxxx;

-- Index: public.linetest_wkb_geometry_geom_idx

-- DROP INDEX public.linetest_wkb_geometry_geom_idx;

CREATE INDEX linetest_wkb_geometry_geom_idx
  ON public.linetest
  USING gist
  (wkb_geometry);

Please check what you have in your first shapefile "tl_2016_us_county.shp ". Could it be that it contains polygon(s)? If it does it explains everything.

-Jukka Rahkonen-
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lines.zip
Type: application/x-zip-compressed
Size: 445 bytes
Desc: lines.zip
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170516/6849ab0d/attachment.bin>

From nicolas.simon at spw.wallonie.be  Wed May 17 03:40:32 2017
From: nicolas.simon at spw.wallonie.be (SIMON Nicolas)
Date: Wed, 17 May 2017 10:40:32 +0000
Subject: [gdal-dev] MrSID Color Spaces
In-Reply-To: <87941027.MLZxqyMhZO@even-i700>
References: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
 <87941027.MLZxqyMhZO@even-i700>
Message-ID: <F02D54DF5576D84C86C23A39A792DC7EAE1C9F1F@SE0005V.wallonie.intra>

Martin,
Could you test this patch ?
Nicolas

De : gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] De la part de Even Rouault
Envoyé : mardi 16 mai 2017 18:28
À : Martin Chapman
Cc : gdal-dev at lists.osgeo.org
Objet : Re: [gdal-dev] MrSID Color Spaces


On mardi 16 mai 2017 10:13:52 CEST Martin Chapman wrote:

> Even or Frank or whoever it may concern,

>

>

>

> Not a big deal but I was trying to open a JP2 file using the MrSID driver

> and noticed that the mrsiddataset.cpp does not identify the color spaces

> MRSID_LTI_COLORSPACE_GRAYSCALEA and MRSID_LTI_COLORSPACE_GRAYSCALEA_PM

> configurations in the MrSIDRasterBand() constructor. I happen to have a two

> band JP2 that is a grayscale image with an alpha channel. The color

> interpretation comes back as GCI_undefined. Not that important but if you

> ever feel like fixing it, that would be nice.

>

>

>

> The fix would go somewhere close to line 485 in mrsiddataset.cpp. Basically

> just need to add a couple of more case statements in the switch statement.



Martin,



Seems you are closed to a patch. Can you provide it ?



Even



--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/f3c56bd8/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mrsiddataset.cpp.patch
Type: application/octet-stream
Size: 1006 bytes
Desc: mrsiddataset.cpp.patch
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/f3c56bd8/attachment.obj>

From schwehr at gmail.com  Wed May 17 07:13:39 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 17 May 2017 07:13:39 -0700
Subject: [gdal-dev] What warnings in r38007 require casting int const to
	double?
In-Reply-To: <CACmBxys=GBZm-QSFQm6DDTNSQW3=HL=q7_OYnZufFyVJOcy_hA@mail.gmail.com>
References: <CACmBxys=GBZm-QSFQm6DDTNSQW3=HL=q7_OYnZufFyVJOcy_hA@mail.gmail.com>
Message-ID: <CACmBxytvEaPV9QyAZ9nw=aUTy=uXBVkNuDzdVDjFuuF5HX45ng@mail.gmail.com>

+gdal-dev

On Wed, May 17, 2017 at 7:12 AM, Kurt Schwehr <schwehr at gmail.com> wrote:

> Hi Even,
>
> Do you remember what warning by which compiler with this changeset?
>
> Thanks,
> -kurt
>
> https://trac.osgeo.org/gdal/changeset/38007
> "Message: Fix warnings about alteration of constant value"
>
>           if( dfDoubleRet > static_cast<double>(
>                                             std::numeric_limits<int>::max())
> ||
>               dfDoubleRet < static_cast<double>(
>                                             std::numeric_limits<int>::min())
> ||
>
>


-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/ef95f64e/attachment-0001.html>

From mchapman at hyperacktive.com  Wed May 17 07:26:00 2017
From: mchapman at hyperacktive.com (Martin Chapman)
Date: Wed, 17 May 2017 08:26:00 -0600
Subject: [gdal-dev] MrSID Color Spaces
In-Reply-To: <F02D54DF5576D84C86C23A39A792DC7EAE1C9F1F@SE0005V.wallonie.intra>
References: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
 <87941027.MLZxqyMhZO@even-i700>
 <F02D54DF5576D84C86C23A39A792DC7EAE1C9F1F@SE0005V.wallonie.intra>
Message-ID: <000f01d2cf19$826d7830$87486890$@hyperacktive.com>

Nicolas,

 

Looks good bud!  Thanks!

 

Best regards,

Martin

 

From: SIMON Nicolas [mailto:nicolas.simon at spw.wallonie.be] 
Sent: Wednesday, May 17, 2017 4:41 AM
To: Martin Chapman
Cc: gdal-dev at lists.osgeo.org; Even Rouault
Subject: RE: [gdal-dev] MrSID Color Spaces

 

Martin,

Could you test this patch ?

Nicolas

 

De : gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] De la part de Even
Rouault
Envoyé : mardi 16 mai 2017 18:28
À : Martin Chapman
Cc : gdal-dev at lists.osgeo.org
Objet : Re: [gdal-dev] MrSID Color Spaces

 

On mardi 16 mai 2017 10:13:52 CEST Martin Chapman wrote:

> Even or Frank or whoever it may concern,

> 

> 

> 

> Not a big deal but I was trying to open a JP2 file using the MrSID driver

> and noticed that the mrsiddataset.cpp does not identify the color spaces

> MRSID_LTI_COLORSPACE_GRAYSCALEA and MRSID_LTI_COLORSPACE_GRAYSCALEA_PM

> configurations in the MrSIDRasterBand() constructor. I happen to have a
two

> band JP2 that is a grayscale image with an alpha channel. The color

> interpretation comes back as GCI_undefined. Not that important but if you

> ever feel like fixing it, that would be nice.

> 

> 

> 

> The fix would go somewhere close to line 485 in mrsiddataset.cpp.
Basically

> just need to add a couple of more case statements in the switch statement.

 

Martin,

 

Seems you are closed to a patch. Can you provide it ?

 

Even

 

-- 

Spatialys - Geospatial professional services

http://www.spatialys.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/278b1443/attachment.html>

From even.rouault at spatialys.com  Wed May 17 07:34:22 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 May 2017 16:34:22 +0200
Subject: [gdal-dev] What warnings in r38007 require casting int const to
	double?
In-Reply-To: <CACmBxytvEaPV9QyAZ9nw=aUTy=uXBVkNuDzdVDjFuuF5HX45ng@mail.gmail.com>
References: <CACmBxys=GBZm-QSFQm6DDTNSQW3=HL=q7_OYnZufFyVJOcy_hA@mail.gmail.com>
 <CACmBxytvEaPV9QyAZ9nw=aUTy=uXBVkNuDzdVDjFuuF5HX45ng@mail.gmail.com>
Message-ID: <3288453.WIW2CDf5nJ@even-i700>

On mercredi 17 mai 2017 07:13:39 CEST Kurt Schwehr wrote:
> +gdal-dev
> 
> On Wed, May 17, 2017 at 7:12 AM, Kurt Schwehr <schwehr at gmail.com> wrote:
> > Hi Even,
> > 
> > Do you remember what warning by which compiler with this changeset?

Hum of course not :-) It might be some older compiler/distribution I tested before releasing 
2.2.

I don't see indeed in the part you quote below why a compiler would complain.

But in the changeset the change related to GUIntBig is legitimate since big values of 64 bit 
integers cannot be exactly represented as a 64 bit double.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/0720c8ad/attachment.html>

From even.rouault at spatialys.com  Wed May 17 07:38:32 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 May 2017 16:38:32 +0200
Subject: [gdal-dev] MrSID Color Spaces
In-Reply-To: <000f01d2cf19$826d7830$87486890$@hyperacktive.com>
References: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
 <F02D54DF5576D84C86C23A39A792DC7EAE1C9F1F@SE0005V.wallonie.intra>
 <000f01d2cf19$826d7830$87486890$@hyperacktive.com>
Message-ID: <1941751.FiM81Idu44@even-i700>

On mercredi 17 mai 2017 08:26:00 CEST Martin Chapman wrote:
> Nicolas,
> 
> 
> 
> Looks good bud!  Thanks!

I've just applied it to trunk, but couldn't really test it since it seems my MrSID version doesn't 
have those #define

Even

> 
> 
> 
> Best regards,
> 
> Martin
> 
> 
> 
> From: SIMON Nicolas [mailto:nicolas.simon at spw.wallonie.be]
> Sent: Wednesday, May 17, 2017 4:41 AM
> To: Martin Chapman
> Cc: gdal-dev at lists.osgeo.org; Even Rouault
> Subject: RE: [gdal-dev] MrSID Color Spaces
> 
> 
> 
> Martin,
> 
> Could you test this patch ?
> 
> Nicolas
> 
> 
> 
> De : gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] De la part de Even
> Rouault
> Envoyé : mardi 16 mai 2017 18:28
> À : Martin Chapman
> Cc : gdal-dev at lists.osgeo.org
> Objet : Re: [gdal-dev] MrSID Color Spaces
> 
> On mardi 16 mai 2017 10:13:52 CEST Martin Chapman wrote:
> > Even or Frank or whoever it may concern,
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > Not a big deal but I was trying to open a JP2 file using the MrSID driver
> > 
> > and noticed that the mrsiddataset.cpp does not identify the color spaces
> > 
> > MRSID_LTI_COLORSPACE_GRAYSCALEA and MRSID_LTI_COLORSPACE_GRAYSCALEA_PM
> > 
> > configurations in the MrSIDRasterBand() constructor. I happen to have a
> 
> two
> 
> > band JP2 that is a grayscale image with an alpha channel. The color
> > 
> > interpretation comes back as GCI_undefined. Not that important but if you
> > 
> > ever feel like fixing it, that would be nice.
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > The fix would go somewhere close to line 485 in mrsiddataset.cpp.
> 
> Basically
> 
> > just need to add a couple of more case statements in the switch statement.
> 
> Martin,
> 
> 
> 
> Seems you are closed to a patch. Can you provide it ?
> 
> 
> 
> Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/bb522789/attachment-0001.html>

From schwehr at gmail.com  Wed May 17 07:50:23 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Wed, 17 May 2017 07:50:23 -0700
Subject: [gdal-dev] What warnings in r38007 require casting int const to
	double?
In-Reply-To: <3288453.WIW2CDf5nJ@even-i700>
References: <CACmBxys=GBZm-QSFQm6DDTNSQW3=HL=q7_OYnZufFyVJOcy_hA@mail.gmail.com>
 <CACmBxytvEaPV9QyAZ9nw=aUTy=uXBVkNuDzdVDjFuuF5HX45ng@mail.gmail.com>
 <3288453.WIW2CDf5nJ@even-i700>
Message-ID: <CACmBxyvFHJYA0tayUo6c96q=iBxMTZyKkXKghP5jyb7roCDxkw@mail.gmail.com>

Ok. I will try reverting just those casts today and if it break travis, I
will put them back with a comment as to why

On May 17, 2017 7:34 AM, "Even Rouault" <even.rouault at spatialys.com> wrote:

> On mercredi 17 mai 2017 07:13:39 CEST Kurt Schwehr wrote:
>
> > +gdal-dev
>
> >
>
> > On Wed, May 17, 2017 at 7:12 AM, Kurt Schwehr <schwehr at gmail.com> wrote:
>
> > > Hi Even,
>
> > >
>
> > > Do you remember what warning by which compiler with this changeset?
>
>
>
> Hum of course not :-) It might be some older compiler/distribution I
> tested before releasing 2.2.
>
>
>
> I don't see indeed in the part you quote below why a compiler would
> complain.
>
>
>
> But in the changeset the change related to GUIntBig is legitimate since
> big values of 64 bit integers cannot be exactly represented as a 64 bit
> double.
>
>
>
> Even
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/a8f349c9/attachment.html>

From even.rouault at spatialys.com  Wed May 17 08:06:53 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 May 2017 17:06:53 +0200
Subject: [gdal-dev] What warnings in r38007 require casting int const to
	double?
In-Reply-To: <CACmBxyvFHJYA0tayUo6c96q=iBxMTZyKkXKghP5jyb7roCDxkw@mail.gmail.com>
References: <CACmBxys=GBZm-QSFQm6DDTNSQW3=HL=q7_OYnZufFyVJOcy_hA@mail.gmail.com>
 <3288453.WIW2CDf5nJ@even-i700>
 <CACmBxyvFHJYA0tayUo6c96q=iBxMTZyKkXKghP5jyb7roCDxkw@mail.gmail.com>
Message-ID: <6446780.OnUFGkHAIs@even-i700>

On mercredi 17 mai 2017 07:50:23 CEST Kurt Schwehr wrote:
> Ok. I will try reverting just those casts today and if it break travis, I
> will put them back with a comment as to why

I don't think this will break Travis since that comes from changesets you introduced days/
weeks before, so we would have noticed. I likely noticed when compiling in some VM. I should 
have noted the compiler. I don't think this was a compilation error, but just a warning about 
loss of precision.

> 
> On May 17, 2017 7:34 AM, "Even Rouault" <even.rouault at spatialys.com> wrote:
> > On mercredi 17 mai 2017 07:13:39 CEST Kurt Schwehr wrote:
> > > +gdal-dev
> > > 
> > > On Wed, May 17, 2017 at 7:12 AM, Kurt Schwehr <schwehr at gmail.com> wrote:
> > > > Hi Even,
> > > > 
> > > > 
> > > > 
> > > > Do you remember what warning by which compiler with this changeset?
> > 
> > Hum of course not :-) It might be some older compiler/distribution I
> > tested before releasing 2.2.
> > 
> > 
> > 
> > I don't see indeed in the part you quote below why a compiler would
> > complain.
> > 
> > 
> > 
> > But in the changeset the change related to GUIntBig is legitimate since
> > big values of 64 bit integers cannot be exactly represented as a 64 bit
> > double.
> > 
> > 
> > 
> > Even
> > 
> > 
> > 
> > --
> > 
> > Spatialys - Geospatial professional services
> > 
> > http://www.spatialys.com


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/af71489c/attachment.html>

From mchapman at hyperacktive.com  Wed May 17 08:10:42 2017
From: mchapman at hyperacktive.com (Martin Chapman)
Date: Wed, 17 May 2017 09:10:42 -0600
Subject: [gdal-dev] MrSID Color Spaces
In-Reply-To: <1941751.FiM81Idu44@even-i700>
References: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
 <F02D54DF5576D84C86C23A39A792DC7EAE1C9F1F@SE0005V.wallonie.intra>
 <000f01d2cf19$826d7830$87486890$@hyperacktive.com>
 <1941751.FiM81Idu44@even-i700>
Message-ID: <002301d2cf1f$c0d201d0$42760570$@hyperacktive.com>

Its an enum value defined in at least version 8.0 and greater.  Maybe in
earlier versions but I am using version 9.1.

 

Martin

 

From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: Wednesday, May 17, 2017 8:39 AM
To: Martin Chapman
Cc: 'SIMON Nicolas'; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] MrSID Color Spaces

 

On mercredi 17 mai 2017 08:26:00 CEST Martin Chapman wrote:

> Nicolas,

> 

> 

> 

> Looks good bud! Thanks!

 

I've just applied it to trunk, but couldn't really test it since it seems my
MrSID version doesn't have those #define

 

Even

 

> 

> 

> 

> Best regards,

> 

> Martin

> 

> 

> 

> From: SIMON Nicolas [mailto:nicolas.simon at spw.wallonie.be]

> Sent: Wednesday, May 17, 2017 4:41 AM

> To: Martin Chapman

> Cc: gdal-dev at lists.osgeo.org; Even Rouault

> Subject: RE: [gdal-dev] MrSID Color Spaces

> 

> 

> 

> Martin,

> 

> Could you test this patch ?

> 

> Nicolas

> 

> 

> 

> De : gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] De la part de Even

> Rouault

> Envoyé : mardi 16 mai 2017 18:28

> À : Martin Chapman

> Cc : gdal-dev at lists.osgeo.org

> Objet : Re: [gdal-dev] MrSID Color Spaces

> 

> On mardi 16 mai 2017 10:13:52 CEST Martin Chapman wrote:

> > Even or Frank or whoever it may concern,

> > 

> > 

> > 

> > 

> > 

> > 

> > 

> > Not a big deal but I was trying to open a JP2 file using the MrSID
driver

> > 

> > and noticed that the mrsiddataset.cpp does not identify the color spaces

> > 

> > MRSID_LTI_COLORSPACE_GRAYSCALEA and MRSID_LTI_COLORSPACE_GRAYSCALEA_PM

> > 

> > configurations in the MrSIDRasterBand() constructor. I happen to have a

> 

> two

> 

> > band JP2 that is a grayscale image with an alpha channel. The color

> > 

> > interpretation comes back as GCI_undefined. Not that important but if
you

> > 

> > ever feel like fixing it, that would be nice.

> > 

> > 

> > 

> > 

> > 

> > 

> > 

> > The fix would go somewhere close to line 485 in mrsiddataset.cpp.

> 

> Basically

> 

> > just need to add a couple of more case statements in the switch
statement.

> 

> Martin,

> 

> 

> 

> Seems you are closed to a patch. Can you provide it ?

> 

> 

> 

> Even

 

 

-- 

Spatialys - Geospatial professional services

http://www.spatialys.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/a893be2b/attachment-0001.html>

From even.rouault at spatialys.com  Wed May 17 08:31:20 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 May 2017 17:31:20 +0200
Subject: [gdal-dev] MrSID Color Spaces
In-Reply-To: <002301d2cf1f$c0d201d0$42760570$@hyperacktive.com>
References: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
 <1941751.FiM81Idu44@even-i700>
 <002301d2cf1f$c0d201d0$42760570$@hyperacktive.com>
Message-ID: <1996050.kaZDx5jGH4@even-i700>

On mercredi 17 mai 2017 09:10:42 CEST Martin Chapman wrote:
> Its an enum value defined in at least version 8.0 and greater.  Maybe in
> earlier versions but I am using version 9.1.
> 

Indeed, that's an *enum value*, not a #define !

typedef enum LTIColorSpace
{
[...]
  LTI_COLORSPACE_GRAYSCALEA = LTI_COLORSPACE_GRAYSCALE | 
LTI_COLORSPACE_MASK_ALPHA,
  LTI_COLORSPACE_GRAYSCALEA_PM = LTI_COLORSPACE_GRAYSCALEA | 
LTI_COLORSPACE_MASK_ALPHA_PRE_MULTIPLIED,


I interpreted your "Looks good" as "applied and successfully tested"...

I do have SDK 8 indeed, so I replaced the conditional test with:

#if defined(LTI_SDK_MAJOR) && LTI_SDK_MAJOR >= 8

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/bdd244e5/attachment.html>

From mchapman at hyperacktive.com  Wed May 17 08:50:40 2017
From: mchapman at hyperacktive.com (Martin Chapman)
Date: Wed, 17 May 2017 09:50:40 -0600
Subject: [gdal-dev] MrSID Color Spaces
In-Reply-To: <1996050.kaZDx5jGH4@even-i700>
References: <002701d2ce5f$69d2e6d0$3d78b470$@hyperacktive.com>
 <1941751.FiM81Idu44@even-i700>
 <002301d2cf1f$c0d201d0$42760570$@hyperacktive.com>
 <1996050.kaZDx5jGH4@even-i700>
Message-ID: <003d01d2cf25$568d0df0$03a729d0$@hyperacktive.com>

Even,

 

That's correct, I did not actually build it.  Our third party libraries are
built by another person on the team and it doesn't happen quick.  I thought
he was asking me whether it looks correct.  I apologize for the
mis-communication.

 

Best regards,

Martin

 

From: Even Rouault [mailto:even.rouault at spatialys.com] 
Sent: Wednesday, May 17, 2017 9:31 AM
To: Martin Chapman
Cc: 'SIMON Nicolas'; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] MrSID Color Spaces

 

On mercredi 17 mai 2017 09:10:42 CEST Martin Chapman wrote:

> It's an enum value defined in at least version 8.0 and greater. Maybe in

> earlier versions but I am using version 9.1.

> 

 

Indeed, that's an *enum value*, not a #define !

 

typedef enum LTIColorSpace

{

[...]

LTI_COLORSPACE_GRAYSCALEA = LTI_COLORSPACE_GRAYSCALE |
LTI_COLORSPACE_MASK_ALPHA,

LTI_COLORSPACE_GRAYSCALEA_PM = LTI_COLORSPACE_GRAYSCALEA |
LTI_COLORSPACE_MASK_ALPHA_PRE_MULTIPLIED,

 

 

I interpreted your "Looks good" as "applied and successfully tested"...

 

I do have SDK 8 indeed, so I replaced the conditional test with:

 

#if defined(LTI_SDK_MAJOR) && LTI_SDK_MAJOR >= 8

 

-- 

Spatialys - Geospatial professional services

http://www.spatialys.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170517/e8deadf7/attachment.html>

From JPalmer at linz.govt.nz  Thu May 18 01:39:19 2017
From: JPalmer at linz.govt.nz (Jeremy Palmer)
Date: Thu, 18 May 2017 20:39:19 +1200
Subject: [gdal-dev] Write overviews directly to S3
Message-ID: <11FFE394-8953-4771-9EB3-02FA80342E8B@linz.govt.nz>

Hi All,

Is is possible to directly write external overview to a S3 bucket? With GDAL 2.1.2 I get an error reporting that seek is not supported when writing to vsis3:

gdaladdo /vsis3/my-bucket/data/1000.tif 2
ERROR 6: Seek not supported on writable /vsis3 files
ERROR 1: _tiffSeekProc:Resource temporarily unavailable
ERROR 1: _tiffWriteProc:Resource temporarily unavailable
ERROR 1: /vsis3/my-bucket/data/1000.tif.ovr:Error writing TIFF header
ERROR 6: Seek not supported on writable /vsis3 files
ERROR 1: _tiffSeekProc:Resource temporarily unavailable
ERROR 1: TIFFAdvanceDirectory:/vsis3/my-bucket/data/1000.tif.ovr: Error fetching directory count
ERROR 6: Seek not supported on writable /vsis3 files
ERROR 1: _tiffSeekProc:Resource temporarily unavailable
ERROR 1: TIFFAdvanceDirectory:/vsis3/my-bucket/data/1000.tif.ovr: Error fetching directory count
ERROR 6: Seek not supported on writable /vsis3 files
ERROR 1: _tiffSeekProc:Resource temporarily unavailable
ERROR 1: TIFFLinkDirectory:Error fetching directory count
ERROR 1: Only read-only mode is supported for /vsicurl
Overview building failed.

I have both read and write access to this bucket and gdalinfo works on the source S3 file.

Cheers
Jeremy

This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.

From even.rouault at spatialys.com  Thu May 18 02:12:12 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 May 2017 11:12:12 +0200
Subject: [gdal-dev] Write overviews directly to S3
In-Reply-To: <11FFE394-8953-4771-9EB3-02FA80342E8B@linz.govt.nz>
References: <11FFE394-8953-4771-9EB3-02FA80342E8B@linz.govt.nz>
Message-ID: <2257720.d3CRVjdWra@even-i700>

Hi Jeremy,

> 
> Is is possible to directly write external overview to a S3 bucket? With GDAL
> 2.1.2 I get an error reporting that seek is not supported when writing to
> vsis3:

No, /vsis3/ only supports sequential writing in files (the original use case was to generate and 
upload a huge CSV file on the fly). I don't have all the details in mind but random writing 
might not be possible given the S3 API constraints, at least with the multipart upload API 
which is used currently.

And another constraint of the current implementation is that a /vsis3/ file is either read-only 
or write-only, but not a mix of both, which would be needed for gdaladdo internal overviews. 
Perhaps external overview would work, but I'm not completely sure as creating a TIFF file 
might require seeking.

Perhaps a fully fledged read-write-update file system would be possible, but that wasn't in 
my initial design constraints.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170518/995bbb1a/attachment.html>

From JPalmer at linz.govt.nz  Thu May 18 02:14:48 2017
From: JPalmer at linz.govt.nz (Jeremy Palmer)
Date: Thu, 18 May 2017 21:14:48 +1200
Subject: [gdal-dev] Write overviews directly to S3
In-Reply-To: <2257720.d3CRVjdWra@even-i700>
References: <11FFE394-8953-4771-9EB3-02FA80342E8B@linz.govt.nz>
 <2257720.d3CRVjdWra@even-i700>
Message-ID: <8E2ED379-647C-49B7-A391-B60F586E66DA@linz.govt.nz>

Hi Even,

On 18/05/2017, at 9:12 PM, Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:
>
> Is is possible to directly write external overview to a S3 bucket? With GDAL
> 2.1.2 I get an error reporting that seek is not supported when writing to
> vsis3:



No, /vsis3/ only supports sequential writing in files (the original use case was to generate and upload a huge CSV file on the fly). I don't have all the details in mind but random writing might not be possible given the S3 API constraints, at least with the multipart upload API which is used currently.

OK thanks for clarifying the situation.




And another constraint of the current implementation is that a /vsis3/ file is either read-only or write-only, but not a mix of both, which would be needed for gdaladdo internal overviews. Perhaps external overview would work, but I'm not completely sure as creating a TIFF file might require seeking.



Perhaps a fully fledged read-write-update file system would be possible, but that wasn't in my initial design constraints.

For now we will work around the issue.

Thank for your help.

Cheers,
Jeremy


________________________________
This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170518/e16deef3/attachment.html>

From klaus.schneider-zapp at pix4d.com  Thu May 18 05:56:09 2017
From: klaus.schneider-zapp at pix4d.com (Klaus Schneider-Zapp)
Date: Thu, 18 May 2017 14:56:09 +0200
Subject: [gdal-dev] Copy metadata
Message-ID: <2715078.59FH4taMSV@eagle>

Hi all,

I would like to copy Exif and XMP data with GDAL. Minimal example:

namespace std
{
    template <>
    struct default_delete<GDALDataset>
    {
        void operator()(GDALDataset* dataset) const
        {
            GDALClose(static_cast<GDALDatasetH>(dataset));
        }
    };
}

bool copyMetadata(const std::string& inputPath, const std::string& outputPath)
{
    std::unique_ptr<GDALDataset> inputDataset(static_cast<GDALDataset*>(
                              GDALOpenEx(inputPath.c_str(), GDAL_OF_RASTER | 
GDAL_OF_READONLY, nullptr, nullptr, nullptr)));
    std::unique_ptr<GDALDataset> outputDataset(static_cast<GDALDataset*>(
                               GDALOpenEx(outputPath.c_str(), GDAL_OF_RASTER | 
GDAL_OF_UPDATE, nullptr, nullptr, nullptr)));

    if (inputDataset == nullptr || outputDataset == nullptr)
    {
        return false;
    }

    const std::array<const char*, 2> domainList = {{"EXIF", "xml:XMP"}};
    for (const auto& domain : domainList)
    {
        char** metadata = inputDataset->GetMetadata(domain);
        const auto err = outputDataset->SetMetadata(metadata, domain);
        if (err != CE_None && err != CE_Warning)
        {
            return false;
        }
    }
    return true;
}

I can call this function with success (returns true), but the metadata of the 
output image still does not change. What am I doing wrong?

Thanks,
Klaus


From even.rouault at spatialys.com  Thu May 18 06:16:21 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 May 2017 15:16:21 +0200
Subject: [gdal-dev] Copy metadata
In-Reply-To: <2715078.59FH4taMSV@eagle>
References: <2715078.59FH4taMSV@eagle>
Message-ID: <1583128.n1GvRIe6MJ@even-i700>

Kkaus,

> I can call this function with success (returns true), but the metadata of
> the output image still does not change. What am I doing wrong?

Nothing. By the way, you didn't specify which output format you tried as it can 
make a difference. But most drivers will ignore metadata domains other than the 
main one, and even if they do take into account (for example the GeoTIFF driver), 
they will copy the metadata in a generic form, and do not encode it regarding the 
EXIF or XMP standards, which is probably what you want.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170518/d9722de0/attachment-0001.html>

From jmckenna at gatewaygeomatics.com  Thu May 18 07:26:18 2017
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 18 May 2017 11:26:18 -0300
Subject: [gdal-dev] Join the OSGeo Code Sprint Saturday 22 July 2017
In-Reply-To: <4e2078b90c220b5941542949e45c8ed2@osgeo.org>
References: <4e2078b90c220b5941542949e45c8ed2@osgeo.org>
Message-ID: <71ca8a4e-9b36-a720-21c6-ab3e5ece24f8@gatewaygeomatics.com>

Hi all,

Please join the OSGeo Code Sprint at FOSS4G Europe on Saturday 22 July 2017!

There’s always plenty to do – it’s not all about programming: 
translation, documentation, packaging, feedback, discussions, 
testing...it's all super important for a project!

If you are interested in participating, please add your project/name in 
this wiki page :

https://wiki.osgeo.org/wiki/FOSS4G-Europe_2017_Code_sprint


If you have questions/comments/ideas please let us know, by contacting 
the Code Sprint Committee at europe-foss4g (at) osgeo (dot) org

The Code Sprint Organizing Team is looking forward to see you!












From pschmitt at gmail.com  Thu May 18 09:38:56 2017
From: pschmitt at gmail.com (Peter Schmitt)
Date: Thu, 18 May 2017 10:38:56 -0600
Subject: [gdal-dev] Write overviews directly to S3
In-Reply-To: <8E2ED379-647C-49B7-A391-B60F586E66DA@linz.govt.nz>
References: <11FFE394-8953-4771-9EB3-02FA80342E8B@linz.govt.nz>
 <2257720.d3CRVjdWra@even-i700>
 <8E2ED379-647C-49B7-A391-B60F586E66DA@linz.govt.nz>
Message-ID: <CACkcqcX9e1j78pd=yUqyJro_n_p40wUj6v=OT1P7n5DrRPx=4A@mail.gmail.com>

Hi Jeremy,

We have come up with one technique to read/write directly to/from s3 using
/vsis3/ and a simple file writer class a colleague wrote:
https://gist.github.com/pedros007/55c6e33224596fb4d8e9e6b68b24ed9b  In
fact, I used this last week to add internal overviews to some of our images
in S3.  Here's a high-level overview of my Python implementation using
gdal-2.2.0:

# Open the image as a /vsimem/ file:
vsi_file = '/vsimem/image.tif'
ds = gdal.Translate('/vsis3/bucket/prefix.tif', vsi_file)

# Add overviews
err = ds.BuildOverviews('AVERAGE', [2,4,8,16,32,64])
if err != 0:
raise BuildOverviewsError('Failed to build overviews for %s' % vsi_file)
# Some overview levels wouldn't get written unless we flush & close the
data set.
ds.FlushCache()
ds = None
# even though the dataset is gone, the vsi_file still exists in memory.

# Write the data back to s3 using a class my colleague wrote.
try:
  vsimem_file = gdalutil.SimpleVSIMEMFile(vsi_file)
    s3 = boto3.resource('s3')
    obj = s3.Object(bucket_name='bucket', key='prefix.tif')
    # the Object#put API needs a file-like object:
http://boto3.readthedocs.io/en/latest/reference/services/s3.html#S3.Object.put
    # the SimpleVSIMemFile implements a file-like object that uses the VSI
API to read a /vsimem/ file.
    obj.put(Body=vsimem_file)
finally:
    vsimem_file = None

# Remove the /vsimem/ file. (you probably want this in a try/finally block
to ensure it gets deleted)
gdal.Unlink(vsi_file)

The above process will be memory constrained.  Make sure your instance is
appropriately sized!  You probably want to run this on an EC2 instance in
the same region as the data sitting in s3.


Even - I found methods to check for VSI errors:
https://gist.github.com/pedros007/55c6e33224596fb4d8e9e6b68b24ed9b#file-simplevsimemfile-py-L73-L74

Are these intended for public consumption?  When reading from a
/vsimem/foo.shp with gdal-2.2.0, gdal.VSIGetLastErrorMsg() reported an
error "No such file or directory".   The VSI reader actually works
regardless if it's a /vsimem/ file or local path.  A colleague used a local
path and the error reported was a little more verbose:  It printed
something like "/mnt/data/foo.sbn: No such file or directory".  I did not
see that error gdal-2.1.3.  We don't need the sbn file (we're building a
qix file instead). I was surprised that the VSI system flagged this as an
error.  Seems like it should be more of a warning.  My motivation for using
adding error checking:  sometimes the command-line gdal_translate with
/vsis3/ paths would yield IFD read errors (I don't have the exact error
message handy).  Repeating the command would result in successful
translates.  I always assumed it was some transient packet loss/network
error.

Cheers,
Pete

On Thu, May 18, 2017 at 3:14 AM, Jeremy Palmer <JPalmer at linz.govt.nz> wrote:

> Hi Even,
>
> On 18/05/2017, at 9:12 PM, Even Rouault <even.rouault at spatialys.com>
> wrote:
> >
> > Is is possible to directly write external overview to a S3 bucket? With
> GDAL
> > 2.1.2 I get an error reporting that seek is not supported when writing to
> > vsis3:
>
>
> No, /vsis3/ only supports sequential writing in files (the original use
> case was to generate and upload a huge CSV file on the fly). I don't have
> all the details in mind but random writing might not be possible given the
> S3 API constraints, at least with the multipart upload API which is used
> currently.
>
>
> OK thanks for clarifying the situation.
>
>
> And another constraint of the current implementation is that a /vsis3/
> file is either read-only or write-only, but not a mix of both, which would
> be needed for gdaladdo internal overviews. Perhaps external overview would
> work, but I'm not completely sure as creating a TIFF file might require
> seeking.
>
>
> Perhaps a fully fledged read-write-update file system would be possible,
> but that wasn't in my initial design constraints.
>
>
> For now we will work around the issue.
>
> Thank for your help.
>
> Cheers,
> Jeremy
>
>
> ------------------------------
> This message contains information, which may be in confidence and may be
> subject to legal privilege. If you are not the intended recipient, you must
> not peruse, use, disseminate, distribute or copy this message. If you have
> received this message in error, please notify us immediately (Phone 0800
> 665 463 or info at linz.govt.nz) and destroy the original message. LINZ
> accepts no responsibility for changes to this email, or for any
> attachments, after its transmission from LINZ. Thank You.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170518/ef02a771/attachment.html>

From even.rouault at spatialys.com  Thu May 18 09:50:06 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 May 2017 18:50:06 +0200
Subject: [gdal-dev] Write overviews directly to S3
In-Reply-To: <CACkcqcX9e1j78pd=yUqyJro_n_p40wUj6v=OT1P7n5DrRPx=4A@mail.gmail.com>
References: <11FFE394-8953-4771-9EB3-02FA80342E8B@linz.govt.nz>
 <8E2ED379-647C-49B7-A391-B60F586E66DA@linz.govt.nz>
 <CACkcqcX9e1j78pd=yUqyJro_n_p40wUj6v=OT1P7n5DrRPx=4A@mail.gmail.com>
Message-ID: <2839721.hutJHirDee@even-i700>

> 
> Even - I found methods to check for VSI errors:
> https://gist.github.com/pedros007/55c6e33224596fb4d8e9e6b68b24ed9b#file-simp
> levsimemfile-py-L73-L74
> 
> Are these intended for public consumption? 

With care...

> When reading from a
> /vsimem/foo.shp with gdal-2.2.0, gdal.VSIGetLastErrorMsg() reported an
> error "No such file or directory". 

Probably because the shapefile driver probed a side-car file that didn't exist (the .sbn you 
mention below) but wasn't required. VSIGetLastErrorMsg() is mostly for internal use by 
GDALOpen() (at least it was designed for that). Users will normally call 
gdal.GetLastErrorMsg() or gdal.UseExceptions() to have exceptions for user-visible errors.

Rule of thumb:
- gdal.VSIGetLastErrorMsg() can be used if you use low-level API like gdal.VSIFOpenL() that 
aren't verbose normally.
- for higher level like gdal.Open(), use gdal.GetLastErrorMsg() or gdal.UseExceptions()

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170518/599370ec/attachment.html>

From JPalmer at linz.govt.nz  Thu May 18 12:36:00 2017
From: JPalmer at linz.govt.nz (Jeremy Palmer)
Date: Fri, 19 May 2017 07:36:00 +1200
Subject: [gdal-dev] Write overviews directly to S3
In-Reply-To: <CACkcqcX9e1j78pd=yUqyJro_n_p40wUj6v=OT1P7n5DrRPx=4A@mail.gmail.com>
References: <11FFE394-8953-4771-9EB3-02FA80342E8B@linz.govt.nz>
 <2257720.d3CRVjdWra@even-i700>
 <8E2ED379-647C-49B7-A391-B60F586E66DA@linz.govt.nz>
 <CACkcqcX9e1j78pd=yUqyJro_n_p40wUj6v=OT1P7n5DrRPx=4A@mail.gmail.com>
Message-ID: <696BC8C2-3320-48AC-8D35-4DB5CD39AE44@linz.govt.nz>

Hi Peter,

On 19/05/2017, at 4:38 AM, Peter Schmitt <pschmitt at gmail.com<mailto:pschmitt at gmail.com>> wrote:

We have come up with one technique to read/write directly to/from s3 using /vsis3/ and a simple file writer class a colleague wrote: https://gist.github.com/pedros007/55c6e33224596fb4d8e9e6b68b24ed9b  In fact, I used this last week to add internal overviews to some of our images in S3.  Here's a high-level overview of my Python implementation using gdal-2.2.0:

Thanks! We will look at this.

Cheers
Jeremy


________________________________
This message contains information, which may be in confidence and may be subject to legal privilege. If you are not the intended recipient, you must not peruse, use, disseminate, distribute or copy this message. If you have received this message in error, please notify us immediately (Phone 0800 665 463 or info at linz.govt.nz) and destroy the original message. LINZ accepts no responsibility for changes to this email, or for any attachments, after its transmission from LINZ. Thank You.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170519/e0464f2e/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 19 08:15:02 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 19 May 2017 15:15:02 +0000
Subject: [gdal-dev] Ogr2ogr,
	PostGIS and  numeric field overflow with a shapefile
Message-ID: <a211f6b5ada74ddf9079307d36c85563@C119S212VM022.msvyvi.vaha.local>

Hi,

See this gis.stackexchange question https://gis.stackexchange.com/questions/240900/shp2pgsql-segmentation-fault.

I have confirmed that Europe_coastline.shp from this zip https://www.eea.europa.eu/data-and-maps/data/eea-coastline-for-analysis-1/gis-data/europe-coastline-shapefile/at_download/file can't be saved into PostGIS with ogr2ogr.  The error message is exactly this

ERROR 1: COPY statement failed. ERROR:  numeric field overflow
DETAIL:  A field with precision 19, scale 11 must round to an absolute value less than 10^8.
CONTEXT:  COPY coastline, line 1, column shape_leng: "275736334.13200003000"

The error seems to happen in PostGIS which creates a field for "shape_leng" as NUMERIC(19,11) and then insertion of value 275736334.13200003000 fails. If GDAL user gets this kind of (invalid?) shapefile, what can they do? I had a try with -oo ADJUST_TYPE=YES but with no luck. Opening the shapefile and saving a copy with OpenJUMP indeed works because OpenJUMP is changing the field definition from Shape_Leng: Real (19.11) into Shape_Leng: Real (33.16).

-Jukka Rahkonen-


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170519/3a32e95b/attachment.html>

From even.rouault at spatialys.com  Fri May 19 08:21:43 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 19 May 2017 17:21:43 +0200
Subject: [gdal-dev] Ogr2ogr,
	PostGIS and  numeric field overflow with a shapefile
In-Reply-To: <a211f6b5ada74ddf9079307d36c85563@C119S212VM022.msvyvi.vaha.local>
References: <a211f6b5ada74ddf9079307d36c85563@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1534644.ad2i916nNg@even-i700>

On vendredi 19 mai 2017 15:15:02 CEST Rahkonen Jukka (MML) wrote:
> Hi,
> 
> See this gis.stackexchange question
> https://gis.stackexchange.com/questions/240900/shp2pgsql-segmentation-fault
> .
> 
> I have confirmed that Europe_coastline.shp from this zip
> https://www.eea.europa.eu/data-and-maps/data/eea-coastline-for-analysis-1/g
> is-data/europe-coastline-shapefile/at_download/file can't be saved into
> PostGIS with ogr2ogr.  The error message is exactly this
> 
> ERROR 1: COPY statement failed. ERROR:  numeric field overflow
> DETAIL:  A field with precision 19, scale 11 must round to an absolute value
> less than 10^8. CONTEXT:  COPY coastline, line 1, column shape_leng:
> "275736334.13200003000"
> 
> The error seems to happen in PostGIS which creates a field for "shape_leng"
> as NUMERIC(19,11) and then insertion of value 275736334.13200003000 fails.
> If GDAL user gets this kind of (invalid?) shapefile, what can they do? I
> had a try with -oo ADJUST_TYPE=YES but with no luck. Opening the shapefile
> and saving a copy with OpenJUMP indeed works because OpenJUMP is changing
> the field definition from Shape_Leng: Real (19.11) into Shape_Leng: Real
> (33.16).

Use -lco PRECISION=NO (PostGIS driver option) to create the field as FLOAT8 instead.

> 
> -Jukka Rahkonen-


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170519/12b00c60/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 19 08:32:18 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 19 May 2017 15:32:18 +0000
Subject: [gdal-dev] Ogr2ogr,
 PostGIS and  numeric field overflow with a shapefile
Message-ID: <b8677aacd9ae406283f752f04ebe3f90@C119S212VM022.msvyvi.vaha.local>

Hi,

That's it. I think I should have known to read carefully the PG driver manual http://www.gdal.org/drv_pg.html.

-Jukka-

Even Rouault wrote:

Re: [gdal-dev] Ogr2ogr, PostGIS and numeric field overflow with a shapefile


On vendredi 19 mai 2017 15:15:02 CEST Rahkonen Jukka (MML) wrote:

> Hi,

>

> See this gis.stackexchange question

> https://gis.stackexchange.com/questions/240900/shp2pgsql-segmentation-fault

> .

>

> I have confirmed that Europe_coastline.shp from this zip

> https://www.eea.europa.eu/data-and-maps/data/eea-coastline-for-analysis-1/g

> is-data/europe-coastline-shapefile/at_download/file can't be saved into

> PostGIS with ogr2ogr. The error message is exactly this

>

> ERROR 1: COPY statement failed. ERROR: numeric field overflow

> DETAIL: A field with precision 19, scale 11 must round to an absolute value

> less than 10^8. CONTEXT: COPY coastline, line 1, column shape_leng:

> "275736334.13200003000"

>

> The error seems to happen in PostGIS which creates a field for "shape_leng"

> as NUMERIC(19,11) and then insertion of value 275736334.13200003000 fails.

> If GDAL user gets this kind of (invalid?) shapefile, what can they do? I

> had a try with -oo ADJUST_TYPE=YES but with no luck. Opening the shapefile

> and saving a copy with OpenJUMP indeed works because OpenJUMP is changing

> the field definition from Shape_Leng: Real (19.11) into Shape_Leng: Real

> (33.16).



Use -lco PRECISION=NO (PostGIS driver option) to create the field as FLOAT8 instead.



>

> -Jukka Rahkonen-





--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170519/576684e7/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 19 08:54:03 2017
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 19 May 2017 15:54:03 +0000
Subject: [gdal-dev] Ogr2ogr,
 PostGIS and  numeric field overflow with a shapefile
Message-ID: <ab0a9c42d27b4bddb7445c85089a42bc@C119S212VM022.msvyvi.vaha.local>

Hmm, but how about other formats? Is there some general workaround? For example conversion into shapefiles fails because of this error while geopackage seems to be OK.

-Jukka-


Lähettäjä: Rahkonen Jukka (MML)
Lähetetty: 19. toukokuuta 2017 18:32
Vastaanottaja: 'Even Rouault' <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] Ogr2ogr, PostGIS and numeric field overflow with a shapefile

Hi,

That's it. I think I should have known to read carefully the PG driver manual http://www.gdal.org/drv_pg.html.

-Jukka-

Even Rouault wrote:

Re: [gdal-dev] Ogr2ogr, PostGIS and numeric field overflow with a shapefile


On vendredi 19 mai 2017 15:15:02 CEST Rahkonen Jukka (MML) wrote:

> Hi,

>

> See this gis.stackexchange question

> https://gis.stackexchange.com/questions/240900/shp2pgsql-segmentation-fault

> .

>

> I have confirmed that Europe_coastline.shp from this zip

> https://www.eea.europa.eu/data-and-maps/data/eea-coastline-for-analysis-1/g

> is-data/europe-coastline-shapefile/at_download/file can't be saved into

> PostGIS with ogr2ogr. The error message is exactly this

>

> ERROR 1: COPY statement failed. ERROR: numeric field overflow

> DETAIL: A field with precision 19, scale 11 must round to an absolute value

> less than 10^8. CONTEXT: COPY coastline, line 1, column shape_leng:

> "275736334.13200003000"

>

> The error seems to happen in PostGIS which creates a field for "shape_leng"

> as NUMERIC(19,11) and then insertion of value 275736334.13200003000 fails.

> If GDAL user gets this kind of (invalid?) shapefile, what can they do? I

> had a try with -oo ADJUST_TYPE=YES but with no luck. Opening the shapefile

> and saving a copy with OpenJUMP indeed works because OpenJUMP is changing

> the field definition from Shape_Leng: Real (19.11) into Shape_Leng: Real

> (33.16).



Use -lco PRECISION=NO (PostGIS driver option) to create the field as FLOAT8 instead.



>

> -Jukka Rahkonen-





--

Spatialys - Geospatial professional services

http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170519/345223c8/attachment.html>

From even.rouault at spatialys.com  Fri May 19 11:41:28 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 19 May 2017 20:41:28 +0200
Subject: [gdal-dev] Ogr2ogr,
	PostGIS and  numeric field overflow with a shapefile
In-Reply-To: <ab0a9c42d27b4bddb7445c85089a42bc@C119S212VM022.msvyvi.vaha.local>
References: <ab0a9c42d27b4bddb7445c85089a42bc@C119S212VM022.msvyvi.vaha.local>
Message-ID: <1801971.JqKTNUEF3H@even-i700>

On vendredi 19 mai 2017 15:54:03 CEST Rahkonen Jukka (MML) wrote:
> Hmm, but how about other formats? Is there some general workaround? For
> example conversion into shapefiles fails because of this error while
> geopackage seems to be OK.

ogr2ogr -unsetFieldWidth


> 
> -Jukka-
> 
> 
> Lähettäjä: Rahkonen Jukka (MML)
> Lähetetty: 19. toukokuuta 2017 18:32
> Vastaanottaja: 'Even Rouault' <even.rouault at spatialys.com>;
> gdal-dev at lists.osgeo.org Aihe: Re: [gdal-dev] Ogr2ogr, PostGIS and numeric
> field overflow with a shapefile
> 
> Hi,
> 
> That's it. I think I should have known to read carefully the PG driver
> manual http://www.gdal.org/drv_pg.html.
> 
> -Jukka-
> 
> Even Rouault wrote:
> 
> Re: [gdal-dev] Ogr2ogr, PostGIS and numeric field overflow with a shapefile
> 
> On vendredi 19 mai 2017 15:15:02 CEST Rahkonen Jukka (MML) wrote:
> > Hi,
> > 
> > 
> > 
> > See this gis.stackexchange question
> > 
> > https://gis.stackexchange.com/questions/240900/shp2pgsql-segmentation-faul
> > t
> > 
> > .
> > 
> > 
> > 
> > I have confirmed that Europe_coastline.shp from this zip
> > 
> > https://www.eea.europa.eu/data-and-maps/data/eea-coastline-for-analysis-1/
> > g
> > 
> > is-data/europe-coastline-shapefile/at_download/file can't be saved into
> > 
> > PostGIS with ogr2ogr. The error message is exactly this
> > 
> > 
> > 
> > ERROR 1: COPY statement failed. ERROR: numeric field overflow
> > 
> > DETAIL: A field with precision 19, scale 11 must round to an absolute
> > value
> > 
> > less than 10^8. CONTEXT: COPY coastline, line 1, column shape_leng:
> > 
> > "275736334.13200003000"
> > 
> > 
> > 
> > The error seems to happen in PostGIS which creates a field for
> > "shape_leng"
> > 
> > as NUMERIC(19,11) and then insertion of value 275736334.13200003000 fails.
> > 
> > If GDAL user gets this kind of (invalid?) shapefile, what can they do? I
> > 
> > had a try with -oo ADJUST_TYPE=YES but with no luck. Opening the shapefile
> > 
> > and saving a copy with OpenJUMP indeed works because OpenJUMP is changing
> > 
> > the field definition from Shape_Leng: Real (19.11) into Shape_Leng: Real
> > 
> > (33.16).
> 
> Use -lco PRECISION=NO (PostGIS driver option) to create the field as FLOAT8
> instead.
> > -Jukka Rahkonen-
> 
> --
> 
> Spatialys - Geospatial professional services
> 
> http://www.spatialys.com


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170519/909d25ce/attachment-0001.html>

From schwehr at gmail.com  Fri May 19 14:05:51 2017
From: schwehr at gmail.com (Kurt Schwehr)
Date: Fri, 19 May 2017 14:05:51 -0700
Subject: [gdal-dev] [gdal-commits] r38502 - trunk/gdal/gcore
In-Reply-To: <13976757.GlqAYBoax9@even-i700>
References: <20170519200708.9B59E3900EF@trac.osgeo.org>
 <13976757.GlqAYBoax9@even-i700>
Message-ID: <CACmBxytF=71nLqZ5QQXHfpokHDe-X-yLFY4ndZaPEhG66Fkiag@mail.gmail.com>

Arg... what are those config options doing down in ogr/GNUMakefile?!?!?!?

The ifeq checks seem reasonable, everything else, not so much.

find . -name GNUmakefile | xargs grep HAVE_XERCES
./ogrsf_frmts/gmlas/GNUmakefile:CPPFLAGS := -I../mem -I../geojson
$(JSON_INCLUDE) -I.. -I../.. -I../pgdump -DHAVE_XERCES=1 \
./ogrsf_frmts/ili/GNUmakefile:CPPFLAGS := -I.. -I../.. -DHAVE_XERCES
$(XERCES_INCLUDE) $(CPPFLAGS)
./ogrsf_frmts/nas/GNUmakefile:CPPFLAGS := -I../gml -I.. -I../..
-DHAVE_XERCES=1 \
./ogrsf_frmts/GNUmakefile:SUBDIRS-$(HAVE_XERCES) += ili
./ogrsf_frmts/GNUmakefile:SUBDIRS-$(HAVE_XERCES) += gmlas
./ogrsf_frmts/generic/GNUmakefile:ifeq ($(HAVE_XERCES),yes)
./ogrsf_frmts/generic/GNUmakefile:ifeq ($(HAVE_XERCES),yes)
./ogrsf_frmts/gml/GNUmakefile:ifeq ($(HAVE_XERCES),yes)
./ogrsf_frmts/gml/GNUmakefile:CPPFLAGS +=  -DHAVE_XERCES
./GNUmakefile:ifeq ($(HAVE_XERCES),yes)
./GNUmakefile:CPPFLAGS := -DHAVE_XERCES $(XERCES_INCLUDE) $(CPPFLAGS)

This is so not cool:

gmlas/GNUmakefile

# Booby trap....
CPPFLAGS := -I../mem -I../geojson $(JSON_INCLUDE) -I.. -I../.. -I../pgdump
-DHAVE_XERCES=1 \
$(XERCES_INCLUDE) $(CPPFLAGS)



On Fri, May 19, 2017 at 1:55 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> On vendredi 19 mai 2017 13:07:08 CEST svn_gdal at osgeo.org wrote:
>
> > Author: goatbar
>
> > Date: 2017-05-19 13:07:08 -0700 (Fri, 19 May 2017)
>
> > New Revision: 38502
>
> >
>
> > Modified:
>
> > trunk/gdal/gcore/gdaldrivermanager.cpp
>
> > Log:
>
> > gdaldrivermanager.cpp: Only call OGRCleanupXercesMutex() if HAVE_XERCES
> is
>
> > set.
>
> >
>
>
>
> HAVE_XERCES is never defined by port/GNUmakefile nor port/makefile.vc
>
>
>
>
>
> $ valgrind --leak-check=full --show-reachable=yes ogrinfo poly.gml
> --config GML_PARSER XERCES --debug on -al -q
>
>
>
>
>
> ==7085== 64 bytes in 1 blocks are still reachable in loss record 4 of 13
>
> ==7085== at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_
> memcheck-amd64-linux.so)
>
> ==7085== by 0x5C588E3: CPLCreateMutexInternal(bool, int)
> (cpl_multiproc.cpp:1476)
>
> ==7085== by 0x5C5864A: CPLCreateOrAcquireMutexEx (cpl_multiproc.cpp:1344)
>
> ==7085== by 0x5C583C1: CPLMutexHolder::CPLMutexHolder(_CPLMutex**,
> double, char const*, int, int) (cpl_multiproc.cpp:167)
>
> ==7085== by 0x64F51C2: OGRInitializeXerces() (ogr_xerces.cpp:56)
>
> ==7085== by 0x5E677A1: GMLReader::SetupParserXerces() (gmlreader.cpp:292)
>
> ==7085== by 0x5E676AC: GMLReader::SetupParser() (gmlreader.cpp:262)
>
> ==7085== by 0x5E681BC: GMLReader::NextFeatureXerces() (gmlreader.cpp:516)
>
> ==7085== by 0x5E68748: GMLReader::NextFeature() (gmlreader.cpp:629)
>
> ==7085== by 0x60FFC13: OGRGMLLayer::GetNextFeature() (ogrgmllayer.cpp:157)
>
> ==7085== by 0x4072E4: ReportOnLayer(OGRLayer*, char const*, char const*,
> OGRGeometry*, int, int, char**, int, int) (ogrinfo.cpp:793)
>
> ==7085== by 0x40660A: main (ogrinfo.cpp:530)
>
> ==7085==
>
>
>
>
>
> >
>
> >
>
> > Modified: trunk/gdal/gcore/gdaldrivermanager.cpp
>
> > ===================================================================
>
> > --- trunk/gdal/gcore/gdaldrivermanager.cpp 2017-05-19 19:22:19 UTC (rev
>
> > 38501) +++ trunk/gdal/gcore/gdaldrivermanager.cpp 2017-05-19 20:07:08
> UTC
>
> > (rev 38502) @@ -248,7 +248,9 @@
>
> > /* --------------------------------------------------------------------
> */
>
> > OSRCleanup();
>
> >
>
> > +#ifdef HAVE_XERCES
>
> > OGRCleanupXercesMutex();
>
> > +#endif
>
> >
>
> > /* --------------------------------------------------------------------
> */
>
> > /* Cleanup VSIFileManager. */
>
> >
>
> > _______________________________________________
>
> > gdal-commits mailing list
>
> > gdal-commits at lists.osgeo.org
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-commits
>
>
>
>
>
> --
>
> Spatialys - Geospatial professional services
>
> http://www.spatialys.com
>



-- 
--
http://schwehr.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170519/5449b202/attachment.html>

From andrew at aitchison.me.uk  Tue May 23 03:40:08 2017
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 23 May 2017 11:40:08 +0100 (BST)
Subject: [gdal-dev] Casting poDS, in IReadBlock and similar places
Message-ID: <alpine.LRH.2.20.1705231110080.31816@warden.aitchison.me.uk>


I see that in http://www.gdal.org/gdal_drivertut.html the function
JDEMRasterBand::IReadBlock has
      JDEMDataset *poGDS = static_cast<JDEMDataset *>(poDS);
(this is a change from gdal-2.1.3 and earlier where
frmts/jdem/jdemdataset.cpp has
             JDEMDataset *poGDS = (JDEMDataset *) poDS;
).

However, I see that amongst other 2.2.0 drivers, reinterpret_cast
is more common than static_cast and the dods driver has dynamic_cast:

egrep -l "_cast<" ~/gdal2.2.0/gdal-2.2.0/frmts/*/*cpp |\
  xargs grep -A10 ::IReadBlock | egrep "_cast<.*Dataset \*>.*poDS *\);" |\
  sed -e 's=/home/werdna/gdal2.2.0/gdal-2.2.0/frmts/==' | sort -t= -k2

dods/dodsdataset2.cpp-    DODSDataset *poDODS = dynamic_cast<DODSDataset *>(poDS);

blx/blxdataset.cpp-    BLXDataset *poGDS = reinterpret_cast<BLXDataset *>(poDS);
raw/cpgdataset.cpp-    CPGDataset *poGDS = reinterpret_cast<CPGDataset *>( poDS );
raw/cpgdataset.cpp-    CPGDataset *poGDS = reinterpret_cast<CPGDataset *>( poDS );
raw/genbindataset.cpp-    GenBinDataset *poGDS = reinterpret_cast<GenBinDataset *>( poDS );
gsg/gsbgdataset.cpp-    GSBGDataset *poGDS = reinterpret_cast<GSBGDataset *>(poDS);
hdf4/hdf4imagedataset.cpp-    HDF4ImageDataset *poGDS = reinterpret_cast<HDF4ImageDataset *>( poDS );
jp2lura/jp2lurarasterband.cpp-    JP2LuraDataset *poGDS = reinterpret_cast<JP2LuraDataset *>(poDS);
raw/landataset.cpp-    LANDataset *poLAN_DS = reinterpret_cast<LANDataset *>( poDS );
leveller/levellerdataset.cpp-    LevellerDataset *poGDS = reinterpret_cast<LevellerDataset *>( poDS );
ngsgeoid/ngsgeoiddataset.cpp-    NGSGEOIDDataset *poGDS = reinterpret_cast<NGSGEOIDDataset *>( poDS );
nitf/nitfrasterband.cpp-    NITFDataset *poGDS = reinterpret_cast<NITFDataset *>( poDS );
northwood/grcdataset.cpp-    NWT_GRCDataset *poGDS = reinterpret_cast<NWT_GRCDataset *>( poDS );
northwood/grddataset.cpp-    NWT_GRDDataset *poGDS = reinterpret_cast<NWT_GRDDataset *>(poDS);
ozi/ozidataset.cpp-    OZIDataset *poGDS = reinterpret_cast<OZIDataset *>( poDS );
plmosaic/plmosaicdataset.cpp-    PLMosaicDataset* poMOSDS = reinterpret_cast<PLMosaicDataset *>( poDS );
png/pngdataset.cpp-    PNGDataset *poGDS = reinterpret_cast<PNGDataset *>( poDS );
rasterlite/rasterlitedataset.cpp-    RasterliteDataset* poGDS = reinterpret_cast<RasterliteDataset *>( poDS );
rik/rikdataset.cpp-    RIKDataset *poRDS = reinterpret_cast<RIKDataset *>( poDS );
rmf/rmfdataset.cpp-    RMFDataset  *poGDS = reinterpret_cast<RMFDataset *>( poDS );
sgi/sgidataset.cpp-    SGIDataset* poGDS = reinterpret_cast<SGIDataset *>( poDS );
srtmhgt/srtmhgtdataset.cpp-  SRTMHGTDataset* poGDS = reinterpret_cast<SRTMHGTDataset *>( poDS );
terragen/terragendataset.cpp-    TerragenDataset& ds = *reinterpret_cast<TerragenDataset *>( poDS );
usgsdem/usgsdemdataset.cpp-    USGSDEMDataset *poGDS = reinterpret_cast<USGSDEMDataset *>( poDS );
vrt/vrtwarped.cpp-    VRTWarpedDataset *poWDS = reinterpret_cast<VRTWarpedDataset *>( poDS );
webp/webpdataset.cpp-    WEBPDataset* poGDS = reinterpret_cast<WEBPDataset *>( poDS );
xyz/xyzdataset.cpp-    XYZDataset *poGDS = reinterpret_cast<XYZDataset *>( poDS );
zmap/zmapdataset.cpp-    ZMapDataset *poGDS = reinterpret_cast<ZMapDataset *>( poDS );

aaigrid/aaigriddataset.cpp-    AAIGDataset *poODS = static_cast<AAIGDataset *>(poDS);
hdf5/hdf5imagedataset.cpp-    HDF5ImageDataset *poGDS = static_cast<HDF5ImageDataset *>(poDS);
iris/irisdataset.cpp-    IRISDataset *poGDS = static_cast<IRISDataset *>(poDS);
jdem/jdemdataset.cpp-    JDEMDataset *poGDS = static_cast<JDEMDataset *>(poDS);
jpeg/jpgdataset.cpp-    JPGDataset *poJDS = static_cast<JPGDataset *>(poDS);
saga/sagadataset.cpp-    SAGADataset *poGDS = static_cast<SAGADataset *>( poDS );

My C++ is 25 years old and self taught, so I am still learning when to
use static_cast, dynamic_cast and reinterpret_cast (and const_cast).

Can anyone more familiar with modern C++ guide me ?

Thanks,

Andrew C Aitchison



From even.rouault at spatialys.com  Tue May 23 04:28:56 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 23 May 2017 13:28:56 +0200
Subject: [gdal-dev] Casting poDS, in IReadBlock and similar places
In-Reply-To: <alpine.LRH.2.20.1705231110080.31816@warden.aitchison.me.uk>
References: <alpine.LRH.2.20.1705231110080.31816@warden.aitchison.me.uk>
Message-ID: <3171184.eUUUa9Wu2N@even-i700>

On mardi 23 mai 2017 11:40:08 CEST Andrew C Aitchison wrote:
> I see that in http://www.gdal.org/gdal_drivertut.html the function
> JDEMRasterBand::IReadBlock has
>       JDEMDataset *poGDS = static_cast<JDEMDataset *>(poDS);
> (this is a change from gdal-2.1.3 and earlier where
> frmts/jdem/jdemdataset.cpp has
>              JDEMDataset *poGDS = (JDEMDataset *) poDS;
> ).
> 
> However, I see that amongst other 2.2.0 drivers, reinterpret_cast
> is more common than static_cast and the dods driver has dynamic_cast:
> 
> My C++ is 25 years old and self taught, so I am still learning when to
> use static_cast, dynamic_cast and reinterpret_cast (and const_cast).
> 
> Can anyone more familiar with modern C++ guide me ?

In all those cases static_cast can be used. There have been a first pass of conversion from C 
style cast to C++ one using reinterpret_cast which is the equivalent of C style cast (it allows 
to cast virtually anything to anything). But we realized later it was a bit too lax and static_cast 
is a better fit when casting from parent to derived class. Both will result in the same code as 
there's no multiple inheritance in dataset class hierarchy (using reinterpret_cast would lead 
to runtime crashes in that case). So static_cast is always safer in those cases.

We could also use dynamic_cast but as we are sure about the target type of cast, this is a bit 
overkill. The occurence in DODS could/should be replaced by a static_cast.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170523/5481fcef/attachment.html>

From a09550 at gmail.com  Tue May 23 06:05:34 2017
From: a09550 at gmail.com (yuchan)
Date: Tue, 23 May 2017 06:05:34 -0700 (MST)
Subject: [gdal-dev] Cannot load Java GDAL native library in web application
 with error in link library?
Message-ID: <1495544734540-5321448.post@n6.nabble.com>

Hello,

I'm using GDAL library java as a dependency in Java web application with
Maven dependency:

    <dependency>
        <groupId>org.gdal</groupId>
        <artifactId>gdal</artifactId>
        <version>1.11.1</version>
    </dependency>

It contains a jar file and runs the native codes in C++ underneath which I
had to install from packages in Centos. All these shared libraries are
installed in

ls -l /usr/lib/java/gdal/
total 1380
-rwxr-xr-x 3 root root  23288 Feb 14  2016 libgdalconstjni.so
-rwxr-xr-x 3 root root  23288 Feb 14  2016 libgdalconstjni.so.1
-rwxr-xr-x 3 root root  23288 Feb 14  2016 libgdalconstjni.so.1.18.4
-rwxr-xr-x 3 root root 226696 Feb 14  2016 libgdaljni.so
-rwxr-xr-x 3 root root 226696 Feb 14  2016 libgdaljni.so.1
-rwxr-xr-x 3 root root 226696 Feb 14  2016 libgdaljni.so.1.18.4
-rwxr-xr-x 3 root root 136760 Feb 14  2016 libogrjni.so
-rwxr-xr-x 3 root root 136760 Feb 14  2016 libogrjni.so.1
-rwxr-xr-x 3 root root 136760 Feb 14  2016 libogrjni.so.1.18.4
-rwxr-xr-x 3 root root  73816 Feb 14  2016 libosrjni.so
-rwxr-xr-x 3 root root  73816 Feb 14  2016 libosrjni.so.1
-rwxr-xr-x 3 root root  73816 Feb 14  2016 libosrjni.so.1.18.4
However, the web application cannot link as it has a problem to link
libraries, although what I can see from class loader of Java is:

System.out.println(System.getProperty("java.library.path"));
/opt/jdk1.8.0_25/jre/lib/amd64:/opt/jdk1.8.0_25/jre/lib/i386::/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
which contains the /usr/lib folder.

The error from the GDAL java when I invoke a GDAL API (it does not have
error if I don't invoke GDAL's methods so other methods still work, Web
application can run normally) is:

*Caused by: java.lang.UnsatisfiedLinkError:
org.gdal.osr.osrJNI.new_SpatialReference__SWIG_1()J
at org.gdal.osr.osrJNI.new_SpatialReference__SWIG_1(Native Method)
~[gdal-1.11.1.jar:na]
at org.gdal.osr.SpatialReference.<init>(SpatialReference.java:117)
~[gdal-1.11.1.jar:na]*

I don't know how to solve this problem, tried to find lots of resources but
no help as I want to deploy this as a Web application in Tomcat server. I
could make it work when setting in NetBeans IDE with JVM option

-Djava.library.path="/usr/lib/java/gdal/"
but I know this is not what web application can run.

Thanks,



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Cannot-load-Java-GDAL-native-library-in-web-application-with-error-in-link-library-tp5321448.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From ijturton at gmail.com  Tue May 23 06:15:51 2017
From: ijturton at gmail.com (Ian Turton)
Date: Tue, 23 May 2017 14:15:51 +0100
Subject: [gdal-dev] Cannot load Java GDAL native library in web
 application with error in link library?
In-Reply-To: <1495544734540-5321448.post@n6.nabble.com>
References: <1495544734540-5321448.post@n6.nabble.com>
Message-ID: <CA+=cGJnJcoY-zJ8Vxy5h1V-oyJ7C2Pxvy7tCzMnOU-NzJjo0MA@mail.gmail.com>

Simply add -Djava.library.path="/usr/lib/java/gdal/" to the Tomcat startup
args in /usr/share/tomcat7/bin/catalina.sh or add /usr/lib/java/gdal/ to
your LD_LIBRARY_PATH (and restart tomcat).

Ian

On 23 May 2017 at 14:05, yuchan <a09550 at gmail.com> wrote:

> Hello,
>
> I'm using GDAL library java as a dependency in Java web application with
> Maven dependency:
>
>     <dependency>
>         <groupId>org.gdal</groupId>
>         <artifactId>gdal</artifactId>
>         <version>1.11.1</version>
>     </dependency>
>
> It contains a jar file and runs the native codes in C++ underneath which I
> had to install from packages in Centos. All these shared libraries are
> installed in
>
> ls -l /usr/lib/java/gdal/
> total 1380
> -rwxr-xr-x 3 root root  23288 Feb 14  2016 libgdalconstjni.so
> -rwxr-xr-x 3 root root  23288 Feb 14  2016 libgdalconstjni.so.1
> -rwxr-xr-x 3 root root  23288 Feb 14  2016 libgdalconstjni.so.1.18.4
> -rwxr-xr-x 3 root root 226696 Feb 14  2016 libgdaljni.so
> -rwxr-xr-x 3 root root 226696 Feb 14  2016 libgdaljni.so.1
> -rwxr-xr-x 3 root root 226696 Feb 14  2016 libgdaljni.so.1.18.4
> -rwxr-xr-x 3 root root 136760 Feb 14  2016 libogrjni.so
> -rwxr-xr-x 3 root root 136760 Feb 14  2016 libogrjni.so.1
> -rwxr-xr-x 3 root root 136760 Feb 14  2016 libogrjni.so.1.18.4
> -rwxr-xr-x 3 root root  73816 Feb 14  2016 libosrjni.so
> -rwxr-xr-x 3 root root  73816 Feb 14  2016 libosrjni.so.1
> -rwxr-xr-x 3 root root  73816 Feb 14  2016 libosrjni.so.1.18.4
> However, the web application cannot link as it has a problem to link
> libraries, although what I can see from class loader of Java is:
>
> System.out.println(System.getProperty("java.library.path"));
> /opt/jdk1.8.0_25/jre/lib/amd64:/opt/jdk1.8.0_25/jre/
> lib/i386::/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
> which contains the /usr/lib folder.
>
> The error from the GDAL java when I invoke a GDAL API (it does not have
> error if I don't invoke GDAL's methods so other methods still work, Web
> application can run normally) is:
>
> *Caused by: java.lang.UnsatisfiedLinkError:
> org.gdal.osr.osrJNI.new_SpatialReference__SWIG_1()J
> at org.gdal.osr.osrJNI.new_SpatialReference__SWIG_1(Native Method)
> ~[gdal-1.11.1.jar:na]
> at org.gdal.osr.SpatialReference.<init>(SpatialReference.java:117)
> ~[gdal-1.11.1.jar:na]*
>
> I don't know how to solve this problem, tried to find lots of resources but
> no help as I want to deploy this as a Web application in Tomcat server. I
> could make it work when setting in NetBeans IDE with JVM option
>
> -Djava.library.path="/usr/lib/java/gdal/"
> but I know this is not what web application can run.
>
> Thanks,
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.
> nabble.com/Cannot-load-Java-GDAL-native-library-in-web-
> application-with-error-in-link-library-tp5321448.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev




-- 
Ian Turton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170523/4963cbb8/attachment.html>

From a09550 at gmail.com  Tue May 23 06:22:26 2017
From: a09550 at gmail.com (yuchan)
Date: Tue, 23 May 2017 06:22:26 -0700 (MST)
Subject: [gdal-dev] Cannot load Java GDAL native library in web
 application with error in link library?
In-Reply-To: <CA+=cGJnJcoY-zJ8Vxy5h1V-oyJ7C2Pxvy7tCzMnOU-NzJjo0MA@mail.gmail.com>
References: <1495544734540-5321448.post@n6.nabble.com>
 <CA+=cGJnJcoY-zJ8Vxy5h1V-oyJ7C2Pxvy7tCzMnOU-NzJjo0MA@mail.gmail.com>
Message-ID: <1495545746290-5321455.post@n6.nabble.com>

Thanks Ian,

However, we want to deploy this application in other kinds of web
application not only Tomcat so it is really complicated to have to modify
Tomcat.

I also tried to set LD_LIBRARY_PATH=/usr/lib/java/gdal/:$LD_LIBRARY_PATH in
~/.bashrc and then execute it with source ~/.bashrc where I can see the
LIBRARY_PATH environment variable in console, restart Tomcat 7 and it still
shows the error

Handler dispatch failed; nested exception is java.lang.UnsatisfiedLinkError:
org.gdal.osr.osrJNI.new_SpatialReference__SWIG_1()J. Please check the log
for the detail error.



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Cannot-load-Java-GDAL-native-library-in-web-application-with-error-in-link-library-tp5321448p5321455.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From ijturton at gmail.com  Tue May 23 06:24:16 2017
From: ijturton at gmail.com (Ian Turton)
Date: Tue, 23 May 2017 14:24:16 +0100
Subject: [gdal-dev] Cannot load Java GDAL native library in web
 application with error in link library?
In-Reply-To: <1495545746290-5321455.post@n6.nabble.com>
References: <1495544734540-5321448.post@n6.nabble.com>
 <CA+=cGJnJcoY-zJ8Vxy5h1V-oyJ7C2Pxvy7tCzMnOU-NzJjo0MA@mail.gmail.com>
 <1495545746290-5321455.post@n6.nabble.com>
Message-ID: <CA+=cGJmoZV6YQHrftaO7rUY5-tUP_WtBmrkojPD-5rYWW8_g0Q@mail.gmail.com>

I suspect that tomcat is running as a different user than you - so you need
to change it for that user. I'd still go for changing the container setup
as it is more controlled.

Ian

On 23 May 2017 at 14:22, yuchan <a09550 at gmail.com> wrote:

> Thanks Ian,
>
> However, we want to deploy this application in other kinds of web
> application not only Tomcat so it is really complicated to have to modify
> Tomcat.
>
> I also tried to set LD_LIBRARY_PATH=/usr/lib/java/gdal/:$LD_LIBRARY_PATH
> in
> ~/.bashrc and then execute it with source ~/.bashrc where I can see the
> LIBRARY_PATH environment variable in console, restart Tomcat 7 and it still
> shows the error
>
> Handler dispatch failed; nested exception is java.lang.
> UnsatisfiedLinkError:
> org.gdal.osr.osrJNI.new_SpatialReference__SWIG_1()J. Please check the log
> for the detail error.
>
>
>
> --
> View this message in context: http://osgeo-org.1560.x6.
> nabble.com/Cannot-load-Java-GDAL-native-library-in-web-
> application-with-error-in-link-library-tp5321448p5321455.html
> Sent from the GDAL - Dev mailing list archive at Nabble.com.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Ian Turton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170523/daa08168/attachment.html>

From a09550 at gmail.com  Tue May 23 06:46:41 2017
From: a09550 at gmail.com (yuchan)
Date: Tue, 23 May 2017 06:46:41 -0700 (MST)
Subject: [gdal-dev] Cannot load Java GDAL native library in web
 application with error in link library?
In-Reply-To: <CA+=cGJmoZV6YQHrftaO7rUY5-tUP_WtBmrkojPD-5rYWW8_g0Q@mail.gmail.com>
References: <1495544734540-5321448.post@n6.nabble.com>
 <CA+=cGJnJcoY-zJ8Vxy5h1V-oyJ7C2Pxvy7tCzMnOU-NzJjo0MA@mail.gmail.com>
 <1495545746290-5321455.post@n6.nabble.com>
 <CA+=cGJmoZV6YQHrftaO7rUY5-tUP_WtBmrkojPD-5rYWW8_g0Q@mail.gmail.com>
Message-ID: <1495547201600-5321462.post@n6.nabble.com>

Unfortunately, Tomcat runs in same computer, user which I set the environment
variable, so I still need to find out a way for making GDAL can run in web
application in Java. 



--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Cannot-load-Java-GDAL-native-library-in-web-application-with-error-in-link-library-tp5321448p5321462.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From a09550 at gmail.com  Tue May 23 07:22:40 2017
From: a09550 at gmail.com (yuchan)
Date: Tue, 23 May 2017 07:22:40 -0700 (MST)
Subject: [gdal-dev] Cannot load Java GDAL native library in web
 application with error in link library?
In-Reply-To: <1495547201600-5321462.post@n6.nabble.com>
References: <1495544734540-5321448.post@n6.nabble.com>
 <CA+=cGJnJcoY-zJ8Vxy5h1V-oyJ7C2Pxvy7tCzMnOU-NzJjo0MA@mail.gmail.com>
 <1495545746290-5321455.post@n6.nabble.com>
 <CA+=cGJmoZV6YQHrftaO7rUY5-tUP_WtBmrkojPD-5rYWW8_g0Q@mail.gmail.com>
 <1495547201600-5321462.post@n6.nabble.com>
Message-ID: <1495549360151-5321471.post@n6.nabble.com>

for anyone has same problem as me, you can see the answer here:
http://fahdshariff.blogspot.de/2011/08/changing-java-library-path-at-runtime.html
for the option 2 with the change directly in code and you need to put the
gdal library folder as input.

Option 2: Add path to usr_paths
Instead of having to re-evaluate the entire java.library.path and
sun.boot.library.path as in Option 1, you can instead append your path to
the usr_paths array. This is shown in the following code:
/**
* Adds the specified path to the java library path
*
* @param pathToAdd the path to add
* @throws Exception
*/
public static void addLibraryPath(String pathToAdd) throws Exception{
    final Field usrPathsField =
ClassLoader.class.getDeclaredField("usr_paths");
    usrPathsField.setAccessible(true);
 
    //get array of paths
    final String[] paths = (String[])usrPathsField.get(null);
 
    //check if the path to add is already present
    for(String path : paths) {
        if(path.equals(pathToAdd)) {
            return;
        }
    }
 
    //add the new path
    final String[] newPaths = Arrays.copyOf(paths, paths.length + 1);
    newPaths[newPaths.length-1] = pathToAdd;
    usrPathsField.set(null, newPaths);
}






--
View this message in context: http://osgeo-org.1560.x6.nabble.com/Cannot-load-Java-GDAL-native-library-in-web-application-with-error-in-link-library-tp5321448p5321471.html
Sent from the GDAL - Dev mailing list archive at Nabble.com.

From aron.olsen at sweco.dk  Wed May 24 21:42:40 2017
From: aron.olsen at sweco.dk (Olsen Aron)
Date: Thu, 25 May 2017 04:42:40 +0000
Subject: [gdal-dev] Problem with arbitrary MSSQL-select via VRT-source for
 producing GeoPdf.
Message-ID: <AM3PR07MB055176D44737927518BA6211F1FF0@AM3PR07MB0551.eurprd07.prod.outlook.com>

We are using a .VRT for fetching rows from an MSSQL in order to have a GeoPdf created.

We are able to perform such using a <SrcSQL> like:

select <tablename>.*, 'bla bla bla' as OGR_STYLE from <tablename>

and to have that perfectly handled into a GeoPdf when using a PostGis end-point/source.
We are yet to have it work for an MSSQL end-point as well.

With CPL_DEBUG=ON one can see, that gdal_translate fetches the proper rows from the DB (MSSQL) but nothing gets collected into the resulting PDF-vector layer.
We suspect that the MSSQL-layer in GDAL is not recognizing the one and only geometry-type column in the result-set of the "select star..." statement, but we are uncertain about this.

I have had a look into the CPP code, but I have not been able to spot, where the actual "get-value-of-geometry-column-in-result-set" is actually being performed.

Please help.

Thanks!

Aron Olsen



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170525/ddbbffde/attachment.html>

From jbe at geo6.be  Mon May 29 01:35:36 2017
From: jbe at geo6.be (=?utf-8?Q?Jonathan_Beli=C3=ABn?=)
Date: Mon, 29 May 2017 10:35:36 +0200
Subject: [gdal-dev] ogr2ogr mapinfo reporjection
In-Reply-To: <007001d2c89d$23bf5c90$6b3e15b0$@geo6.be>
References: <01e401d2c800$89abf970$9d03ec50$@geo6.be>
 <CAHBySPZOM5PGG-doVfqgATjutj7qnborSHDDKHHUov-V8Vyo0w@mail.gmail.com>
 <007001d2c89d$23bf5c90$6b3e15b0$@geo6.be>
Message-ID: <025a01d2d856$8c3a6530$a4af2f90$@geo6.be>

Any idea about this topic ?

 

Thanks ! :)

 

Jonathan Beliën

GEO-6

 

De : gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] De la part de Jonathan Beliën
Envoyé : mardi 9 mai 2017 10:21
À : 'GDAL List' <gdal-dev at lists.osgeo.org>
Cc : mitab at egroups.com; 'Hellemans, Philippe' <phe at geo6.be>
Objet : Re: [gdal-dev] ogr2ogr mapinfo reporjection

 

Hello Richard,

 

When I look at the resulting MIF file in a text editor, the coordinates are indeed correctly transformed but the header is 

 

CoordSys Earth Projection 3, 104, "m", 4.36748666666667, 90, 51.1666672333333, 49.8333339, 150000.013, 5400088.438

 

instead of

 

CoordSys Earth Projection 3, 1019, "m", 4.3674866667, 90, 49.8333339, 51.1666672333, 150000.01300000001, 5400088.4380000001 Bounds (0, 0) (300000, 300000)

 

Thanks for your help !

 

Jonathan Beliën

GEO-6

 

De : Richard Greenwood [mailto:richard.greenwood at gmail.com] 
Envoyé : mardi 9 mai 2017 01:32
À : Jonathan Beliën <jbe at geo6.be <mailto:jbe at geo6.be> >
Cc : mitab at egroups.com <mailto:mitab at egroups.com> ; GDAL List <gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org> >; Hellemans, Philippe <phe at geo6.be <mailto:phe at geo6.be> >
Objet : Re: [gdal-dev] ogr2ogr mapinfo reporjection

 

When you say that the coordsys header is wrong, are you looking at it in MapInfo or in a text editor? If you look at the MIF file coordinates in a text editor do they look like they have been correctly transformed, and it is just the header that is wrong?

 

On Mon, May 8, 2017 at 7:39 AM, Jonathan Beliën <jbe at geo6.be <mailto:jbe at geo6.be> > wrote:

Hello everyone, 

 

I struggle to reproject GeoJSON file to TAB (or MIF) file.

The source projection is EPSG:4326 and the destination projection is EPSG:31370 (Belge 1972 / Belgian Lambert 72 – Belgium : http://epsg.io/31370)

 

I searched forums and mailing lists and saw that there was some issues with reprojection using Mitab but that it is supposed to be fixed.

 

When I try the following command, the coordinates seems to be transformed but the « coordsys » header in the TAB (or MIF) file is wrong (WGS84 – Non Earth)

 

ogr2ogr test.mif test.json -f "MapInfo File" -dsco FORMAT=MIF -s_srs EPSG:4326 -t_srs EPSG:31370

 

If I understood correctly what I read on the Internet, that’s because Mitab does not recognise « EPSG:31370 » ;

I tried to replace « -t_srs EPSG:31370 » by « -t_srs "31370.txt" » where « 31370.txt » contained the WKT definition of EPSG:31370 ;

I saw in the ogr2ogr documentation that there is a « MITAB_BOUNDS_FILE » parameter but did not find out how to use it (http://www.gdal.org/drv_mitab.html) ;

 

I also searched in « /ogr/ogrsf_frmts/mitab/mitab_spatialref.cpp » to see if « Belgian Lambert 1972 » existed and it does :

 

{ 0,    1019,"Belgian 1972 7 Parameter",   4, -99.059, 53.322, -112.486, -0.419, 0.83, -1.885, 0.999999, 0},

 

So I suppose it should be possible to create a MapInfo file projected in « Belgiam Lambert 1972 » but I do not understand how ?!

 

Any help or idea is welcome !
Thanks a lot !

 

Jonathan Beliën

GEO-6

 


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org> 
https://lists.osgeo.org/mailman/listinfo/gdal-dev





 

-- 

Richard W. Greenwood, PLS
www.greenwoodmap.com <http://www.greenwoodmap.com> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170529/d671769a/attachment.html>

From ozdogan at wisc.edu  Tue May 30 10:44:18 2017
From: ozdogan at wisc.edu (MUTLU OZDOGAN)
Date: Tue, 30 May 2017 17:44:18 +0000
Subject: [gdal-dev] compressed GTiff large file size?
Message-ID: <C283EA03-8D9B-40D6-B516-C9D8373FC1D5@wisc.edu>

Dear Developers

I have two multi-band geotiff files (each about 2 GB in size uncompressed) that I would like to mosaic using gdal_merge.py.  These files make up two halves of a single Landsat footprint so when joined should create a single mosaicked image.  I checked the corner coordinates and they seem correct.  However, when I use the gdal_merge.py command with the -co “COMPRESS=LZW” option, the final file size ends up being a ~100 GB which does not make any sense.  Any ideas about what is going on?  I checked the image dimensions and they seem to be correct and should result in a file that is about 4.5 GB in size uncompressed so the compressed version should be at least this size if not smaller.

Thank you

Mutlu...





From even.rouault at spatialys.com  Tue May 30 11:52:55 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 May 2017 20:52:55 +0200
Subject: [gdal-dev] compressed GTiff large file size?
In-Reply-To: <C283EA03-8D9B-40D6-B516-C9D8373FC1D5@wisc.edu>
References: <C283EA03-8D9B-40D6-B516-C9D8373FC1D5@wisc.edu>
Message-ID: <2551894.jPYlQT46Fa@even-i700>

On mardi 30 mai 2017 17:44:18 CEST MUTLU OZDOGAN wrote:
> Dear Developers
> 
> I have two multi-band geotiff files (each about 2 GB in size uncompressed)
> that I would like to mosaic using gdal_merge.py.  These files make up two
> halves of a single Landsat footprint so when joined should create a single
> mosaicked image.  I checked the corner coordinates and they seem correct. 
> However, when I use the gdal_merge.py command with the -co “COMPRESS=LZW”
> option, the final file size ends up being a ~100 GB which does not make any
> sense.  Any ideas about what is going on?  I checked the image dimensions
> and they seem to be correct and should result in a file that is about 4.5
> GB in size uncompressed so the compressed version should be at least this
> size if not smaller.

Mutlu,

Asy you noticed, gdal_merge.py strategy is not necessarily optimal regarding minimizing file 
size in case of compression

So I'd recommend using a workflow like :

gdalbuildvrt tmp.vrt landsat1 landsat2
gdal_translate tmp.vrt merged.tif -co COMPRESS=LZW -co TILED=YES


Even


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170530/ae85cfc3/attachment.html>

From richard.greenwood at gmail.com  Tue May 30 14:36:17 2017
From: richard.greenwood at gmail.com (Richard Greenwood)
Date: Tue, 30 May 2017 15:36:17 -0600
Subject: [gdal-dev] ogr2ogr mapinfo reporjection
In-Reply-To: <025a01d2d856$8c3a6530$a4af2f90$@geo6.be>
References: <01e401d2c800$89abf970$9d03ec50$@geo6.be>
 <CAHBySPZOM5PGG-doVfqgATjutj7qnborSHDDKHHUov-V8Vyo0w@mail.gmail.com>
 <007001d2c89d$23bf5c90$6b3e15b0$@geo6.be>
 <025a01d2d856$8c3a6530$a4af2f90$@geo6.be>
Message-ID: <CAHBySPaNJOM0mkwSNf4PaMhFrpeUW_O6+jxZ-czrVy6DMxhB0w@mail.gmail.com>

So ogr2ogr is doing the reprojection correctly, but writing the wrong
coordinate system string to the resulting MapInfo file. Is that correct?
I'm not a developer and I have not looked at the source code, so I am
guessing, but there might be a look up table defining the MapInfo
coordinate system string for a matching proj4text string. You might look in
the source code for that, or you might want to file a ticket.

Best regards,
Rich


On Mon, May 29, 2017 at 2:35 AM, Jonathan Beliën <jbe at geo6.be> wrote:

> Any idea about this topic ?
>
>
>
> Thanks ! :)
>
>
>
> Jonathan Beliën
>
> GEO-6
>
>
>
> *De :* gdal-dev [mailto:gdal-dev-bounces at lists.osgeo.org] *De la part de*
> Jonathan Beliën
> *Envoyé :* mardi 9 mai 2017 10:21
> *À :* 'GDAL List' <gdal-dev at lists.osgeo.org>
> *Cc :* mitab at egroups.com; 'Hellemans, Philippe' <phe at geo6.be>
>
> *Objet :* Re: [gdal-dev] ogr2ogr mapinfo reporjection
>
>
>
> Hello Richard,
>
>
>
> When I look at the resulting MIF file in a text editor, the coordinates
> are indeed correctly transformed but the header is
>
>
>
> *CoordSys Earth Projection 3, 104, "m", 4.36748666666667, 90,
> 51.1666672333333, 49.8333339, 150000.013, 5400088.438*
>
>
>
> instead of
>
>
>
> *CoordSys Earth Projection 3, 1019, "m", 4.3674866667, 90, 49.8333339,
> 51.1666672333, 150000.01300000001, 5400088.4380000001 Bounds (0, 0)
> (300000, 300000)*
>
>
>
> Thanks for your help !
>
>
>
> Jonathan Beliën
>
> GEO-6
>
>
>
> *De :* Richard Greenwood [mailto:richard.greenwood at gmail.com
> <richard.greenwood at gmail.com>]
> *Envoyé :* mardi 9 mai 2017 01:32
> *À :* Jonathan Beliën <jbe at geo6.be>
> *Cc :* mitab at egroups.com; GDAL List <gdal-dev at lists.osgeo.org>;
> Hellemans, Philippe <phe at geo6.be>
> *Objet :* Re: [gdal-dev] ogr2ogr mapinfo reporjection
>
>
>
> When you say that the coordsys header is wrong, are you looking at it in
> MapInfo or in a text editor? If you look at the MIF file coordinates in a
> text editor do they look like they have been correctly transformed, and it
> is just the header that is wrong?
>
>
>
> On Mon, May 8, 2017 at 7:39 AM, Jonathan Beliën <jbe at geo6.be> wrote:
>
> Hello everyone,
>
>
>
> I struggle to reproject GeoJSON file to TAB (or MIF) file.
>
> The source projection is EPSG:4326 and the destination projection is
> EPSG:31370 (Belge 1972 / Belgian Lambert 72 – Belgium :
> http://epsg.io/31370)
>
>
>
> I searched forums and mailing lists and saw that there was some issues
> with reprojection using Mitab but that it is supposed to be fixed.
>
>
>
> When I try the following command, the coordinates seems to be transformed
> but the « coordsys » header in the TAB (or MIF) file is wrong (WGS84 –
> Non Earth)
>
>
>
> ogr2ogr test.mif test.json -f "MapInfo File" -dsco FORMAT=MIF -s_srs
> EPSG:4326 -t_srs EPSG:31370
>
>
>
> If I understood correctly what I read on the Internet, that’s because
> Mitab does not recognise « EPSG:31370 » ;
>
> I tried to replace « -t_srs EPSG:31370 » by « -t_srs "31370.txt" » where
> « 31370.txt » contained the WKT definition of EPSG:31370 ;
>
> I saw in the ogr2ogr documentation that there is a « MITAB_BOUNDS_FILE »
> parameter but did not find out how to use it (http://www.gdal.org/drv_
> mitab.html) ;
>
>
>
> I also searched in « /ogr/ogrsf_frmts/mitab/mitab_spatialref.cpp » to see
> if « Belgian Lambert 1972 » existed and it does :
>
>
>
> { 0,    1019,"Belgian 1972 7 Parameter",   4, -99.059, 53.322, -112.486,
> -0.419, 0.83, -1.885, 0.999999, 0},
>
>
>
> So I suppose it should be possible to create a MapInfo file projected in
> « Belgiam Lambert 1972 » but I do not understand how ?!
>
>
>
> Any help or idea is welcome !
> Thanks a lot !
>
>
>
> Jonathan Beliën
>
> GEO-6
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
>
> Richard W. Greenwood, PLS
> www.greenwoodmap.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>



-- 
Richard W. Greenwood, PLS
www.greenwoodmap.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170530/149ebd8a/attachment.html>

From even.rouault at spatialys.com  Tue May 30 14:50:31 2017
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 30 May 2017 23:50:31 +0200
Subject: [gdal-dev] ogr2ogr mapinfo reporjection
In-Reply-To: <025a01d2d856$8c3a6530$a4af2f90$@geo6.be>
References: <01e401d2c800$89abf970$9d03ec50$@geo6.be>
 <007001d2c89d$23bf5c90$6b3e15b0$@geo6.be>
 <025a01d2d856$8c3a6530$a4af2f90$@geo6.be>
Message-ID: <1892169.8ZQpUqZQeq@even-i700>

On lundi 29 mai 2017 10:35:36 CEST Jonathan Beliën wrote:
> Any idea about this topic ?
> 

I've just fixed the issue per
https://trac.osgeo.org/gdal/ticket/6903
where -t_srs EPSG:31370 will now work.

You can workaround the issue by using -t_srs belgian72.txt

with belgian72.txt content being:

PROJCS["Belge 1972 / Belgian Lambert 72",
    GEOGCS["Belge 1972",
        DATUM["Belgian 1972 7 Parameter",
            SPHEROID["International 1924",6378388,297,
                AUTHORITY["EPSG","7022"]],
            TOWGS84[-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747],
            AUTHORITY["EPSG","6313"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4313"]],
    PROJECTION["Lambert_Conformal_Conic_2SP"],
    PARAMETER["standard_parallel_1",51.16666723333333],
    PARAMETER["standard_parallel_2",49.8333339],
    PARAMETER["latitude_of_origin",90],
    PARAMETER["central_meridian",4.367486666666666],
    PARAMETER["false_easting",150000.013],
    PARAMETER["false_northing",5400088.438],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["X",EAST],
    AXIS["Y",NORTH],
    AUTHORITY["EPSG","31370"]]

Which is the output of gdalsrsinfo EPSG:31370 where the DATUM name has been replaced 
with "Belgian 1972 7 Parameter" instead of the original "Reseau_National_Belge_1972" in 
EPSG.
Note that MapInfo (or at least MITAB) apparently uses slightly different TOWGS84 
coefficients that the ones picked up by GDAL in the EPSG database.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20170530/5260f831/attachment-0001.html>

