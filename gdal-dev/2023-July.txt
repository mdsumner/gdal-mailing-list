From even.rouault at spatialys.com  Sun Jul  2 06:20:22 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 2 Jul 2023 15:20:22 +0200
Subject: [gdal-dev] sozip and tile index
In-Reply-To: <AM6PR01MB49461AF6E7F00F4CE31BCCBCA127A@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
References: <AM6PR01MB49461AF6E7F00F4CE31BCCBCA127A@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
Message-ID: <cff03ced-1901-018f-1611-3b376d04e045@spatialys.com>

Hi,

ogrtindex can index any OGR supported file including through the /vsi 
virtual file systems such as /vsizip/ , /vsicurl/ or combinations of those

Even

Le 27/06/2023 ? 13:00, Andrew Terry a ?crit?:
>
> Hi,
>
> Is it possible to include a virtual file system file in a ogrtindex 
> (or alternative?) vector file index?
>
> My ideal use case is to include sozip enabled or just plain zip files.
>
> At the moment the files are one shp per zip which makes it easy to 
> swap out changed data.
>
> Thanks
>
> Andy
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230702/d6015bf3/attachment.htm>

From andrew.terry at centremaps.co.uk  Mon Jul  3 01:52:33 2023
From: andrew.terry at centremaps.co.uk (Andrew Terry)
Date: Mon, 3 Jul 2023 08:52:33 +0000
Subject: [gdal-dev] sozip and tile index
In-Reply-To: <cff03ced-1901-018f-1611-3b376d04e045@spatialys.com>
References: <AM6PR01MB49461AF6E7F00F4CE31BCCBCA127A@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>
 <cff03ced-1901-018f-1611-3b376d04e045@spatialys.com>
Message-ID: <AM6PR01MB494601C271C3B94F98C46E02A129A@AM6PR01MB4946.eurprd01.prod.exchangelabs.com>

Thanks Even, that?s great I?ll try again using those!

From: Even Rouault <even.rouault at spatialys.com>
Sent: Sunday, July 2, 2023 2:20 PM
To: Andrew Terry <andrew.terry at centremaps.co.uk>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] sozip and tile index


Hi,

ogrtindex can index any OGR supported file including through the /vsi virtual file systems such as /vsizip/ , /vsicurl/ or combinations of those

Even
Le 27/06/2023 ? 13:00, Andrew Terry a ?crit :
Hi,

Is it possible to include a virtual file system file in a ogrtindex (or alternative?) vector file index?

My ideal use case is to include sozip enabled or just plain zip files.

At the moment the files are one shp per zip which makes it easy to swap out changed data.

Thanks

Andy




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230703/bb990c0e/attachment.htm>

From even.rouault at spatialys.com  Mon Jul  3 02:10:59 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 3 Jul 2023 11:10:59 +0200
Subject: [gdal-dev] ogr2ogr sqlite dialect and fgb format
In-Reply-To: <CADXYQQ7a-5FcyapBtcb6WcW1e7613C=5uBPA5pXTeVL0VvZbTA@mail.gmail.com>
References: <CADXYQQ7a-5FcyapBtcb6WcW1e7613C=5uBPA5pXTeVL0VvZbTA@mail.gmail.com>
Message-ID: <d6cedcd8-2066-9ba9-21b4-ae9807abfca3@spatialys.com>

Hi Patrick,

blocking error fixed per https://github.com/OSGeo/gdal/pull/8040

and the one related to esriFieldTypeDate in 
https://github.com/OSGeo/gdal/pull/8039

Even

Le 28/06/2023 ? 17:18, Patrick Young a ?crit?:
> Hi,
>
> I'm playing around with the gdb dataset
>
> https://data.cityofnewyork.us/Transportation/NYC-Planimetrics/wt4d-p43d
>
> and getting errors starting with gdal 3.5 when I try to use the sqlite 
> dialect:
>
> ogr2ogr -f GeoJSONSeq -sql "select shape from roadbed where source_id 
> = 13350003311" -dialect sqlite /vsistdout/ 
> NYC_DoITT_Planimetric_OpenData.gdb.zip
>
> ERROR 6: Unsupported field type for range domain: esriFieldTypeDate
> ERROR 1: Cannot create virtual table for layer 'roadbed' : CREATE 
> VIRTUAL: invalid SQL statement : CREATE TABLE "roadbed"("SOURCE_ID" 
> FLOAT,"FEATURE_CODE" 
> INTEGER_INT16_BEGIN_DOMAIN_NAME_64526F6164626564_END_DOMAIN_NAME,"SUB_FEATURE_CODE" 
> INTEGER,"STATUS" 
> VARCHAR(16)_BEGIN_DOMAIN_NAME_645374617475735F31_END_DOMAIN_NAME,"SHAPE_Length" 
> FLOAT,"SHAPE_Area" FLOAT,OGR_STYLE VARCHAR HIDDEN,"SHAPE" 
> BLOB_MULTIPOLYGON_XY_2263, OGR_NATIVE_DATA VARCHAR, 
> OGR_NATIVE_MEDIA_TYPE VARCHAR)
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select shape from roadbed 
> where source_id = 13350003311):
> ? no such table: roadbed
>
> This command works in GDAL 3.4 (and also works with the ogr sql 
> dialect); I was wanting to use the sqlite dialect so that i can use 
> CASE statements.? Is this a bug or expected?
>
> Thanks,
> Patrick
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From cliveswan at gmail.com  Mon Jul  3 07:35:45 2023
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 3 Jul 2023 14:35:45 +0000
Subject: [gdal-dev] gdal_rasterize parameters not working
Message-ID: <CWXP123MB3959AEDFEE021E46FAF22F91A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>

I am trying to create a heatmap from a Shp Point feature.
The output is doesn?t cover the Shp??

I entered the following gdal gdal_rasterize parameters.
gdal_rasterize
-a hazard_l_1
 -te -4.822014 52.517355  1.757978  55.779307
-tr 0.1     0.1
-ts 2035 2069
"C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Shp\Coastal\Coastal_Flooding_2000.shp" "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000.tif"

It doesn?t use the field from - a hazard >> 52 to 82??
The Raster doesn?t cover the UK??
The raster should only cover the UK.

Any suggestions you would recommend to use??

Thanks
Clive
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230703/d4b4ad58/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 5879 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230703/d4b4ad58/attachment-0001.png>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jul  3 08:22:38 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 3 Jul 2023 15:22:38 +0000
Subject: [gdal-dev] gdal_rasterize parameters not working
In-Reply-To: <CWXP123MB3959AEDFEE021E46FAF22F91A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
References: <CWXP123MB3959AEDFEE021E46FAF22F91A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <AM0PR09MB32198252AF603762F7D0AD53FD29A@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

What coordinate system and extent ogrinfo reports with
ogrinfo -al -so "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Shp\Coastal\Coastal_Flooding_2000.shp"
What coordinate system and extent gdalinfo reports with
gdalinfo "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000.tif"

Did the coastal_2000.tif exist already or was it created by gdal_rasterize? Have you been thinking that the default datatype in the result is Float64 https://gdal.org/programs/gdal_rasterize.html#cmdoption-gdal_rasterize-ot and that the whole range  52 to 82 in the source data is very, very close to the black end of the target TIFF? Without LUT stretch the result looks certainly all black in image viewers.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Clive Swan
L?hetetty: maanantai 3. hein?kuuta 2023 17.36
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdal_rasterize parameters not working

I am trying to create a heatmap from a Shp Point feature.
The output is doesn't cover the Shp??

I entered the following gdal gdal_rasterize parameters.
gdal_rasterize
-a hazard_l_1
 -te -4.822014 52.517355  1.757978  55.779307
-tr 0.1     0.1
-ts 2035 2069
"C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Shp\Coastal\Coastal_Flooding_2000.shp" "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000.tif"

It doesn't use the field from - a hazard >> 52 to 82??
The Raster doesn't cover the UK??
The raster should only cover the UK.

Any suggestions you would recommend to use??

Thanks
Clive
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230703/3e7b8804/attachment.htm>

From public at postholer.com  Mon Jul  3 09:08:59 2023
From: public at postholer.com (Scott)
Date: Mon, 3 Jul 2023 09:08:59 -0700
Subject: [gdal-dev] gdal_rasterize parameters not working
In-Reply-To: <CWXP123MB3959AEDFEE021E46FAF22F91A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
References: <CWXP123MB3959AEDFEE021E46FAF22F91A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <924164f9-647d-2851-e52a-47585770a88a@postholer.com>

You're using the -tr and -ts. You can only use one or the other, not both.

On 7/3/23 07:35, Clive Swan wrote:
> I am trying to create a heatmap from a Shp Point feature.
> The output is doesn?t cover the Shp??
> 
> I entered the following gdal gdal_rasterize parameters.
> 
> gdal_rasterize
> 
> -a hazard_l_1
> 
>  ?-te -4.822014 52.517355? 1.757978? 55.779307
> 
> -tr 0.1???? 0.1
> 
> -ts 2035 2069
> 
> "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Shp\Coastal\Coastal_Flooding_2000.shp" "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000.tif"
> 
> It doesn?t use the field from -a hazard >> 52 to 82??
> 
> The Raster doesn?t cover the UK??
> The raster should only cover the UK.
> 
> Any suggestions you would recommend to use??
> 
> 
> Thanks
> Clive
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From andreaerdna at libero.it  Mon Jul  3 11:31:02 2023
From: andreaerdna at libero.it (Andrea Giudiceandrea)
Date: Mon, 3 Jul 2023 20:31:02 +0200
Subject: [gdal-dev] gdal_rasterize parameters not working
Message-ID: <2ae24fa2-61da-d91a-b668-d2624994b567@libero.it>

Il 03/07/2023 18:08, Scott ha scritto:
> You're using the -tr and -ts. You can only use one or the other, not both.

I think it would be useful if gdal_rasterize emitted a warning when the 
-tr and -ts options are used at the same time like other GDAL tools do.

Best regards.

Andrea

From cliveswan at gmail.com  Mon Jul  3 16:06:50 2023
From: cliveswan at gmail.com (Clive Swan)
Date: Mon, 3 Jul 2023 23:06:50 +0000
Subject: [gdal-dev] gdal_rasterize parameters not working
In-Reply-To: <AM0PR09MB32198252AF603762F7D0AD53FD29A@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <CWXP123MB3959AEDFEE021E46FAF22F91A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB32198252AF603762F7D0AD53FD29A@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CWXP123MB3959D0C066C95E7E8DA2A154A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>

Hi

Thanks for the information.


 The Shp file (WGS84), the aim is to export to a Heatmap.

The Shp was exported to a Tif:

coastal_2000-te.tif
coastal_2000-tr.tif

The pixel output ranges from 0-3

This doesn't produce a Heatmap.


Any options you would recommend??


Thanks

Clive



gdalinfo "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000-tr.tif"

>> 1Kb

Driver: GTiff/GeoTIFF

Files: C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000-tr.tif

Size is 1, 1

Coordinate System is:

GEOGCRS["WGS 84", ENSEMBLE["World Geodetic System 1984 ensemble",

        MEMBER["World Geodetic System 1984 (Transit)"], MEMBER["World Geodetic System 1984 (G730)"], MEMBER["World Geodetic System 1984 (G873)"], MEMBER["World Geodetic System 1984 (G1150)"],

        MEMBER["World Geodetic System 1984 (G1674)"], MEMBER["World Geodetic System 1984 (G1762)"], MEMBER["World Geodetic System 1984 (G2139)"], ELLIPSOID["WGS 84",6378137,298.257223563, LENGTHUNIT["metre",1]], ENSEMBLEACCURACY[2.0]],

    PRIMEM["Greenwich",0, ANGLEUNIT["degree",0.0174532925199433]], CS[ellipsoidal,2], AXIS["geodetic latitude (Lat)",north, ORDER[1], ANGLEUNIT["degree",0.0174532925199433]], AXIS["geodetic longitude (Lon)",east, ORDER[2], ANGLEUNIT["degree",0.0174532925199433]],

    USAGE[ SCOPE["Horizontal component of 3D system."], AREA["World."], BBOX[-90,-180,90,180]], ID["EPSG",4326]]

Data axis to CRS axis mapping: 2,1

Origin = (-8.263930151999944,60.841669081000077)

Pixel Size = (10.000000000000000,-10.000000000000000)

Metadata: AREA_OR_POINT=Area

Image Structure Metadata: INTERLEAVE=BAND

Corner Coordinates:

Upper Left  (  -8.2639302,  60.8416691) (  8d15'50.15"W, 60d50'30.01"N)

Lower Left  (  -8.2639302,  50.8416691) (  8d15'50.15"W, 50d50'30.01"N)

Upper Right (   1.7360698,  60.8416691) (  1d44' 9.85"E, 60d50'30.01"N)

Lower Right (   1.7360698,  50.8416691) (  1d44' 9.85"E, 50d50'30.01"N)

Center      (  -3.2639302,  55.8416691) (  3d15'50.15"W, 55d50'30.01"N)

Band 1 Block=1x1 Type=Float64, ColorInterp=Gray





________________________________
From: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Sent: Monday, July 3, 2023 4:22:41 pm
To: Clive Swan <cliveswan at gmail.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: gdal_rasterize parameters not working

Hi,

What coordinate system and extent ogrinfo reports with
ogrinfo -al -so "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Shp\Coastal\Coastal_Flooding_2000.shp"
What coordinate system and extent gdalinfo reports with
gdalinfo "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000.tif"

Did the coastal_2000.tif exist already or was it created by gdal_rasterize? Have you been thinking that the default datatype in the result is Float64 https://gdal.org/programs/gdal_rasterize.html#cmdoption-gdal_rasterize-ot and that the whole range  52 to 82 in the source data is very, very close to the black end of the target TIFF? Without LUT stretch the result looks certainly all black in image viewers.

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230703/9b5fcd53/attachment.htm>

From public at postholer.com  Mon Jul  3 18:26:32 2023
From: public at postholer.com (Scott)
Date: Mon, 3 Jul 2023 18:26:32 -0700
Subject: [gdal-dev] gdal_rasterize parameters not working
In-Reply-To: <CWXP123MB3959D0C066C95E7E8DA2A154A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
References: <CWXP123MB3959AEDFEE021E46FAF22F91A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
 <AM0PR09MB32198252AF603762F7D0AD53FD29A@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CWXP123MB3959D0C066C95E7E8DA2A154A029A@CWXP123MB3959.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <7c1012d6-5cf5-e85e-339b-2ec8f40e41f8@postholer.com>

gdal_grid is probably a better choice.


On 7/3/23 16:06, Clive Swan wrote:
> Hi
> 
> Thanks for the information.
> 
>  ?The Shp file (WGS84), the aim is to export to a Heatmap.
> 
> The Shp was exported to a Tif:
> 
> coastal_2000-te.tif
> coastal_2000-tr.tif
> 
> The pixel output ranges from 0-3
> 
> This doesn't produce a Heatmap.
> 
> 
> Any options you would recommend??
> 
> 
> Thanks
> 
> Clive
> 
> gdalinfo 
> "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000-tr.tif"
> 
>  >> 1Kb
> 
> Driver: GTiff/GeoTIFF
> 
> Files: 
> C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000-tr.tif
> 
> Size is 1, 1
> 
> Coordinate System is:
> 
> GEOGCRS["WGS 84", ENSEMBLE["World Geodetic System 1984 ensemble",
> 
>  ??????? MEMBER["World Geodetic System 1984 (Transit)"], MEMBER["World 
> Geodetic System 1984 (G730)"], MEMBER["World Geodetic System 1984 
> (G873)"], MEMBER["World Geodetic System 1984 (G1150)"],
> 
>  ??????? MEMBER["World Geodetic System 1984 (G1674)"], MEMBER["World 
> Geodetic System 1984 (G1762)"], MEMBER["World Geodetic System 1984 
> (G2139)"], ELLIPSOID["WGS 84",6378137,298.257223563, 
> LENGTHUNIT["metre",1]], ENSEMBLEACCURACY[2.0]],
> 
>  ??? PRIMEM["Greenwich",0, ANGLEUNIT["degree",0.0174532925199433]], 
> CS[ellipsoidal,2], AXIS["geodetic latitude (Lat)",north, ORDER[1], 
> ANGLEUNIT["degree",0.0174532925199433]], AXIS["geodetic longitude 
> (Lon)",east, ORDER[2], ANGLEUNIT["degree",0.0174532925199433]],
> 
>  ??? USAGE[ SCOPE["Horizontal component of 3D system."], AREA["World."], 
> BBOX[-90,-180,90,180]], ID["EPSG",4326]]
> 
> Data axis to CRS axis mapping: 2,1
> 
> Origin = (-8.263930151999944,60.841669081000077)
> 
> Pixel Size = (10.000000000000000,-10.000000000000000)
> 
> Metadata: AREA_OR_POINT=Area
> 
> Image Structure Metadata: INTERLEAVE=BAND
> 
> Corner Coordinates:
> 
> Upper Left? (? -8.2639302,? 60.8416691) (? 8d15'50.15"W, 60d50'30.01"N)
> 
> Lower Left? (? -8.2639302,? 50.8416691) (? 8d15'50.15"W, 50d50'30.01"N)
> 
> Upper Right (?? 1.7360698,? 60.8416691) (? 1d44' 9.85"E, 60d50'30.01"N)
> 
> Lower Right (?? 1.7360698,? 50.8416691) (? 1d44' 9.85"E, 50d50'30.01"N)
> 
> Center????? (? -3.2639302,? 55.8416691) (? 3d15'50.15"W, 55d50'30.01"N)
> 
> Band 1 Block=1x1 Type=Float64, ColorInterp=Gray
> 
> 
> 
> 
> 
> 
> ------------------------------------------------------------------------
> *From:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Sent:* Monday, July 3, 2023 4:22:41 pm
> *To:* Clive Swan <cliveswan at gmail.com>; gdal-dev at lists.osgeo.org 
> <gdal-dev at lists.osgeo.org>
> *Subject:* Re: gdal_rasterize parameters not working
> 
> Hi,
> 
> What coordinate system and extent ogrinfo reports with
> 
> ogrinfo -al -so 
> "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Shp\Coastal\Coastal_Flooding_2000.shp"
> 
> What coordinate system and extent gdalinfo reports with
> 
> gdalinfo 
> "C:\Temp\PROJECTS\CCRT\ClimateChangeFME\Modelling\UK\Maps\coastal_2000.tif"
> 
> Did the coastal_2000.tif exist already or was it created by 
> gdal_rasterize? Have you been thinking that the default datatype in the 
> result is Float64 
> https://gdal.org/programs/gdal_rasterize.html#cmdoption-gdal_rasterize-ot <https://gdal.org/programs/gdal_rasterize.html#cmdoption-gdal_rasterize-ot> and that the whole range? 52 to 82 in the source data is very, very close to the black end of the target TIFF? Without LUT stretch the result looks certainly all black in image viewers.
> 
> -Jukka Rahkonen-
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From a.pau at creaf.uab.cat  Wed Jul  5 04:17:34 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 5 Jul 2023 11:17:34 +0000
Subject: [gdal-dev] Instructions for a new writing driver?
Message-ID: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hi, following instructions about creating a new driver I found that
https://gdal.org/tutorials/vector_driver_tut.html


But I need to create a driver that can also write from any vector it's own format.
So, the inverse sense of the html I found.

There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it's own format)?

Thanks in advance!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230705/f2967f89/attachment.htm>

From lnicola at dend.ro  Wed Jul  5 04:21:44 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Wed, 05 Jul 2023 14:21:44 +0300
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>

Hi,

I think your best bet would be to take inspiration from an existing driver, like the CSV one (which shouldn't be too different from the hypothetical SPF driver in the docs).

Laurentiu

On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:
> Hi, following instructions about creating a new driver I found that  
> https://gdal.org/tutorials/vector_driver_tut.html
>  
>  
> But I need to create a driver that can also write from any vector it?s own format.
> So, the inverse sense of the html I found.
>  
> There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it?s own format)?
> 
> Thanks in advance!
>  
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230705/6b1aa8a4/attachment.htm>

From even.rouault at spatialys.com  Wed Jul  5 04:59:19 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 5 Jul 2023 13:59:19 +0200
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
Message-ID: <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>

(resending to list)

The CSV driver is actually not that simple to follow since it has tricks 
to support updates through the OGREditableLayer mechanism. The GMT one 
(ogr/ogrsf_frmts/gmt) might be a better start for a creation & append 
only driver. But basically, the only common thing with your own code 
will be the fact that you have to implement the 2 virtual methods of 
interest: OGRLayer::CreateField() ,d OGRLayer::ICreateFeature() and 
declare a few capabilities in OGRLayer::TestCapability()

Unless you want to implement update capabilities (if the format allows 
it, which is generally not the case for a text based format), it might 
be simpler to have 2 distinct OGRLayer sub-classes for read-only and 
write-only operations.

Even

Le 05/07/2023 ? 13:21, Lauren?iu Nicola via gdal-dev a ?crit?:
> Hi,
>
> I think your best bet would be to take inspiration from an existing 
> driver, like the CSV one (which shouldn't be too different from the 
> hypothetical SPF driver in the docs).
>
> Laurentiu
>
> On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:
>>
>> Hi, following instructions about creating a new driver I found that
>>
>> https://gdal.org/tutorials/vector_driver_tut.html
>>
>>
>>
>> But I need to create a driver that can also write from any vector 
>> it?s own format.
>>
>> So, the inverse sense of the html I found.
>>
>>
>> There is any other place I can follow any instructions to fill all 
>> function classes to create this part of the driver (the one that 
>> writes it?s own format)?
>>
>> Thanks in advance!
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230705/074bc099/attachment.htm>

From a.pau at creaf.uab.cat  Wed Jul  5 06:13:22 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 5 Jul 2023 13:13:22 +0000
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
Message-ID: <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Thanks you both!




De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Even Rouault
Enviado el: dimecres, 5 de juliol de 2023 13:59
Para: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Instructions for a new writing driver?


(resending to list)

The CSV driver is actually not that simple to follow since it has tricks to support updates through the OGREditableLayer mechanism. The GMT one (ogr/ogrsf_frmts/gmt) might be a better start for a creation & append only driver. But basically, the only common thing with your own code will be the fact that you have to implement the 2 virtual methods of interest: OGRLayer::CreateField() ,d OGRLayer::ICreateFeature() and declare a few capabilities in OGRLayer::TestCapability()

Unless you want to implement update capabilities (if the format allows it, which is generally not the case for a text based format), it might be simpler to have 2 distinct OGRLayer sub-classes for read-only and write-only operations.
Even
Le 05/07/2023 ? 13:21, Lauren?iu Nicola via gdal-dev a ?crit :
Hi,

I think your best bet would be to take inspiration from an existing driver, like the CSV one (which shouldn't be too different from the hypothetical SPF driver in the docs).

Laurentiu

On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:

Hi, following instructions about creating a new driver I found that

https://gdal.org/tutorials/vector_driver_tut.html





But I need to create a driver that can also write from any vector it?s own format.

So, the inverse sense of the html I found.



There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it?s own format)?

Thanks in advance!


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230705/d9ac909b/attachment-0001.htm>

From a.pau at creaf.uab.cat  Thu Jul  6 06:01:03 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Thu, 6 Jul 2023 13:01:03 +0000
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
 <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hi again.
I finally did that and I am happy.

It would be helpful for us to be able to use our C functions to read and write some parts of our format instead of passing all of them to C++.
I?d like doing that but it?s not possible for the moment convert all our code to C++.

My proposal is use a ogrmiramondatasource.cpp, a ogrmiramondriver.cpp and a ogrmiramonlayer.cpp as all of the projects that are created and add our files from C as necessary.
The main goal is adding only the necessary ones.

The question: Is this possible? Can I simply add C files and use that functions from C++ files? Or do GDAL prefer doing it in another way?
Sorry if it is written somewhere else but I couldn?t find it.

Thanks again for your kind help.

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau
Enviado el: dimecres, 5 de juliol de 2023 15:13
Para: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Instructions for a new writing driver?

Thanks you both!




De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Even Rouault
Enviado el: dimecres, 5 de juliol de 2023 13:59
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Instructions for a new writing driver?


(resending to list)

The CSV driver is actually not that simple to follow since it has tricks to support updates through the OGREditableLayer mechanism. The GMT one (ogr/ogrsf_frmts/gmt) might be a better start for a creation & append only driver. But basically, the only common thing with your own code will be the fact that you have to implement the 2 virtual methods of interest: OGRLayer::CreateField() ,d OGRLayer::ICreateFeature() and declare a few capabilities in OGRLayer::TestCapability()

Unless you want to implement update capabilities (if the format allows it, which is generally not the case for a text based format), it might be simpler to have 2 distinct OGRLayer sub-classes for read-only and write-only operations.
Even
Le 05/07/2023 ? 13:21, Lauren?iu Nicola via gdal-dev a ?crit :
Hi,

I think your best bet would be to take inspiration from an existing driver, like the CSV one (which shouldn't be too different from the hypothetical SPF driver in the docs).

Laurentiu

On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:

Hi, following instructions about creating a new driver I found that

https://gdal.org/tutorials/vector_driver_tut.html





But I need to create a driver that can also write from any vector it?s own format.

So, the inverse sense of the html I found.



There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it?s own format)?

Thanks in advance!


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230706/d1e2d0a0/attachment-0001.htm>

From lnicola at dend.ro  Thu Jul  6 06:08:08 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 06 Jul 2023 16:08:08 +0300
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
 <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <9057cabc-d57b-47b3-9aea-5a9c1fcf26ec@betaapp.fastmail.com>

Hi,

I think some existing drivers already contain some C files, AIGRID for example. Others have a sdk subdirectory with library code in there. I don't think including your code as C will be a problem.

On the other hand, offering a C API for new drivers might be an interesting idea. Using C++ makes writing drivers in other languages a bit more complicated. But I know this wouldn't be trivial, since GDAL uses inheritance.

Laurentiu

On Thu, Jul 6, 2023, at 16:01, Abel Pau wrote:
> Hi again.
> I finally did that and I am happy.
>  
> It would be helpful for us to be able to use our C functions to read and write some parts of our format instead of passing all of them to C++.
> I?d like doing that but it?s not possible for the moment convert all our code to C++.
>  
> My proposal is use a ogrmiramondatasource.cpp, a ogrmiramondriver.cpp and a ogrmiramonlayer.cpp as all of the projects that are created and add our files from C as necessary.
> The main goal is adding only the necessary ones.
>  
> The question: Is this possible? Can I simply add C files and use that functions from C++ files? Or do GDAL prefer doing it in another way?
> Sorry if it is written somewhere else but I couldn?t find it.
>  
> Thanks again for your kind help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230706/f2d6dd19/attachment.htm>

From lnicola at dend.ro  Thu Jul  6 06:10:40 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 06 Jul 2023 16:10:40 +0300
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <9057cabc-d57b-47b3-9aea-5a9c1fcf26ec@betaapp.fastmail.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
 <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <9057cabc-d57b-47b3-9aea-5a9c1fcf26ec@betaapp.fastmail.com>
Message-ID: <df6cc836-d430-4079-a67a-10da966967f1@betaapp.fastmail.com>

PS: Geoconcept might be a better example than AAIGrid, since it's a vector driver.

On Thu, Jul 6, 2023, at 16:08, Lauren?iu Nicola via gdal-dev wrote:
> Hi,
> 
> I think some existing drivers already contain some C files, AIGRID for example. Others have a sdk subdirectory with library code in there. I don't think including your code as C will be a problem.
> 
> On the other hand, offering a C API for new drivers might be an interesting idea. Using C++ makes writing drivers in other languages a bit more complicated. But I know this wouldn't be trivial, since GDAL uses inheritance.
> 
> Laurentiu
> 
> On Thu, Jul 6, 2023, at 16:01, Abel Pau wrote:
>> Hi again.
>> I finally did that and I am happy.
>>  
>> It would be helpful for us to be able to use our C functions to read and write some parts of our format instead of passing all of them to C++.
>> I?d like doing that but it?s not possible for the moment convert all our code to C++.
>>  
>> My proposal is use a ogrmiramondatasource.cpp, a ogrmiramondriver.cpp and a ogrmiramonlayer.cpp as all of the projects that are created and add our files from C as necessary.
>> The main goal is adding only the necessary ones.
>>  
>> The question: Is this possible? Can I simply add C files and use that functions from C++ files? Or do GDAL prefer doing it in another way?
>> Sorry if it is written somewhere else but I couldn?t find it.
>>  
>> Thanks again for your kind help.
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230706/121edfdf/attachment.htm>

From even.rouault at spatialys.com  Thu Jul  6 06:13:40 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 6 Jul 2023 15:13:40 +0200
Subject: [gdal-dev] GDAL 3.7.1 RC1 available
Message-ID: <cae6bbc6-5bdb-2655-c6ef-559911f0be11@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.7.1 release candidate.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.7.1/gdal-3.7.1rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.7.1/gdal-3.7.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.7.1/gdal371rc1.zip

A snapshot of the gdalautotest suite is also available:

https://download.osgeo.org/gdal/3.7.1/gdalautotest-3.7.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.7.1/gdalautotest-3.7.1rc1.zip

The NEWS file is here:

 ? https://github.com/OSGeo/gdal/blob/v3.7.1RC1/NEWS.md

I'll call for a vote promoting it to final beginning of next week if no
serious problems are reported before.

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From b.phamhuu at jacobs-university.de  Thu Jul  6 18:37:30 2023
From: b.phamhuu at jacobs-university.de (Bang Pham Huu)
Date: Fri, 7 Jul 2023 03:37:30 +0200
Subject: [gdal-dev] [AWS-S3]Access denied 403 error when requesting gdalinfo
 to usgs-landsat bucket?
Message-ID: <19e68f4c-e4cb-84a6-eb0b-f556e8ed1a04@jacobs-university.de>

Hello,

GDAL 3.4.1, released 2021/12/27 (Ubuntu 22.04)

I have this file ~/.aws/credentials? (configured by this command: aws 
configure)

[default]
aws_access_key_id = AKIAY.....
aws_secret_access_key = qc2KcpImI/....

This works fine for aws CLI command to download a Landsat-8 tiff file:

aws s3 cp --request-payer requester 
s3://usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF 
.

But gdal cannot read the file?

gdalinfo 
/vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF
Warning 1: HTTP response code on 
https://usgs-landsat.s3.amazonaws.com/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF: 
403

On https://gdal.org/user/virtual_file_systems.html, it says:

Starting with GDAL 2.3, alternate ways of providing credentials similar 
to what the "aws" command line utility or Boto3 support can be used. If 
the above mentioned environment variables are not provided, 
the|~/.aws/credentials|

|
|

|I even tried to set environmental variables, but it doesn't work either:|

|export AWS_ACCESS_KEY_ID=AKIAY5....
export AWS_SECRET_ACCESS_KEY=qc2KcpImI/....
gdalinfo 
/vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF
Warning 1: HTTP response code on 
https://usgs-landsat.s3.amazonaws.com/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF: 
403
ERROR 14: Access Denied
gdalinfo failed - unable to open 
'/vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF'.

|

Thanks,


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/eaf2085b/attachment.htm>

From even.rouault at spatialys.com  Thu Jul  6 18:52:11 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 7 Jul 2023 03:52:11 +0200
Subject: [gdal-dev] [AWS-S3]Access denied 403 error when requesting
 gdalinfo to usgs-landsat bucket?
In-Reply-To: <19e68f4c-e4cb-84a6-eb0b-f556e8ed1a04@jacobs-university.de>
References: <19e68f4c-e4cb-84a6-eb0b-f556e8ed1a04@jacobs-university.de>
Message-ID: <6a0c95d0-ee67-543b-eb2c-1786cfa8f0a1@spatialys.com>

You also need to specify: --config AWS_REQUEST_PAYER requester

Le 07/07/2023 ? 03:37, Bang Pham Huu a ?crit?:
>
> Hello,
>
> GDAL 3.4.1, released 2021/12/27 (Ubuntu 22.04)
>
> I have this file ~/.aws/credentials? (configured by this command: aws 
> configure)
>
> [default]
> aws_access_key_id = AKIAY.....
> aws_secret_access_key = qc2KcpImI/....
>
> This works fine for aws CLI command to download a Landsat-8 tiff file:
>
> aws s3 cp --request-payer requester 
> s3://usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF 
> .
>
> But gdal cannot read the file?
>
> gdalinfo 
> /vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF
> Warning 1: HTTP response code on 
> https://usgs-landsat.s3.amazonaws.com/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF: 
> 403
>
> On https://gdal.org/user/virtual_file_systems.html, it says:
>
> Starting with GDAL 2.3, alternate ways of providing credentials 
> similar to what the "aws" command line utility or Boto3 support can be 
> used. If the above mentioned environment variables are not provided, 
> the|~/.aws/credentials|
>
> |
> |
>
> |I even tried to set environmental variables, but it doesn't work either:|
>
> |export AWS_ACCESS_KEY_ID=AKIAY5....
> export AWS_SECRET_ACCESS_KEY=qc2KcpImI/....
> gdalinfo 
> /vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF
> Warning 1: HTTP response code on 
> https://usgs-landsat.s3.amazonaws.com/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF: 
> 403
> ERROR 14: Access Denied
> gdalinfo failed - unable to open 
> '/vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF'.
>
> |
>
> Thanks,
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/6d153504/attachment-0001.htm>

From b.phamhuu at jacobs-university.de  Thu Jul  6 20:19:14 2023
From: b.phamhuu at jacobs-university.de (Bang Pham Huu)
Date: Fri, 7 Jul 2023 05:19:14 +0200
Subject: [gdal-dev] [AWS-S3]Access denied 403 error when requesting
 gdalinfo to usgs-landsat bucket?
In-Reply-To: <6a0c95d0-ee67-543b-eb2c-1786cfa8f0a1@spatialys.com>
References: <19e68f4c-e4cb-84a6-eb0b-f556e8ed1a04@jacobs-university.de>
 <6a0c95d0-ee67-543b-eb2c-1786cfa8f0a1@spatialys.com>
Message-ID: <8bc5567e-2bbc-cb33-4b05-c2b9f3087f00@jacobs-university.de>

Thanks Even,

it works now with these environmental configurations:

export AWS_ACCESS_KEY_ID=AKIAY5
export AWS_SECRET_ACCESS_KEY=qc2KcpIm
export AWS_REQUEST_PAYER=requester
gdalinfo 
/vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF 



On 07.07.23 3:52 AM, Even Rouault wrote:
>
> You also need to specify: --config AWS_REQUEST_PAYER requester
>
> Le 07/07/2023 ? 03:37, Bang Pham Huu a ?crit?:
>>
>> Hello,
>>
>> GDAL 3.4.1, released 2021/12/27 (Ubuntu 22.04)
>>
>> I have this file ~/.aws/credentials? (configured by this command: aws 
>> configure)
>>
>> [default]
>> aws_access_key_id = AKIAY.....
>> aws_secret_access_key = qc2KcpImI/....
>>
>> This works fine for aws CLI command to download a Landsat-8 tiff file:
>>
>> aws s3 cp --request-payer requester 
>> s3://usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF 
>> .
>>
>> But gdal cannot read the file?
>>
>> gdalinfo 
>> /vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF
>> Warning 1: HTTP response code on 
>> https://usgs-landsat.s3.amazonaws.com/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF: 
>> 403
>>
>> On https://gdal.org/user/virtual_file_systems.html, it says:
>>
>> Starting with GDAL 2.3, alternate ways of providing credentials 
>> similar to what the "aws" command line utility or Boto3 support can 
>> be used. If the above mentioned environment variables are not 
>> provided, the|~/.aws/credentials|
>>
>> |
>> |
>>
>> |I even tried to set environmental variables, but it doesn't work 
>> either:|
>>
>> |export AWS_ACCESS_KEY_ID=AKIAY5....
>> export AWS_SECRET_ACCESS_KEY=qc2KcpImI/....
>> gdalinfo 
>> /vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF
>> Warning 1: HTTP response code on 
>> https://usgs-landsat.s3.amazonaws.com/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF: 
>> 403
>> ERROR 14: Access Denied
>> gdalinfo failed - unable to open 
>> '/vsis3/usgs-landsat/collection02/level-2/standard/oli-tirs/2023/233/245/LC08_L2SP_233245_20230510_20230518_02_T2/LC08_L2SP_233245_20230510_20230518_02_T2_SR_B1.TIF'.
>>
>> |
>>
>> Thanks,
>>
>>
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/fdbe941f/attachment.htm>

From a.pau at creaf.uab.cat  Fri Jul  7 02:33:45 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Fri, 7 Jul 2023 09:33:45 +0000
Subject: [gdal-dev] A question of eficiency
Message-ID: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hi,
I would like to know if when we use the code of GDAL to program a driver (or whatever) in vectors (so, ogr) we can assume that we can know the number of elements we are going to import in any way or it would be possible not knowing that until NextFeature is empty (or something like that). So, there is any way to obtain this number of elements without doing a while? And in case of multielements its possible to know how many parts are there in total?
I need that to write my format (I don't explain the details cause I don't get you bored :) )

If anyone know that I'd appreciate an answer. Thanks in advance.

Abel.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/4ad18773/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Jul  7 03:32:17 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 7 Jul 2023 12:32:17 +0200
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>

Abel,

At the minimum for the reading side of a vector driver, you need to 
implement GetNextFeature().

If there is an efficient way of knowing the number of features without 
iterating over the whole file (typically a field in a header giving that 
number), you may implement GetFeatureCount(). If you don't implement it, 
and code using your driver needs the feature count, the generic 
implementation of OGRLayer::GetFeatureCount() will call GetNextFeature() 
repeatdly until it returns NULL.

Not totally sure to understand your question about multielements. If you 
have an instance of OGRGeometryCollection or any deriving class, there's 
a getNumGeometries() method to get the number of parts

Even

Le 07/07/2023 ? 11:33, Abel Pau a ?crit?:
>
> Hi,
>
> I would like to know if when we use the code of GDAL to program a 
> driver (or whatever) in vectors (so, ogr) we can assume that we can 
> know the number of elements we are going to import in any way or it 
> would be possible not knowing that until NextFeature is empty (or 
> something like that). So, there is any way to obtain this number of 
> elements without doing a while? And in case of multielements its 
> possible to know how many parts are there in total?
>
> I need that to write my format (I don?t explain the details cause I 
> don?t get you bored :) )
>
> If anyone know that I?d appreciate an answer. Thanks in advance.
>
> Abel.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/46c1163e/attachment.htm>

From a.pau at creaf.uab.cat  Fri Jul  7 03:43:57 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Fri, 7 Jul 2023 10:43:57 +0000
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
Message-ID: <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hi again,

I can totally give this number in GetFeatureCount(). No problem from my driver to other.
Then I understand that in one way (efficient) or in another (no efficient) I can always get the number of features with the GetFeatureCount(). True?

About the other question imagine a multiline shape with two lines of two parts every line. I need to know the total count of individual lines (cause my driver doesn?t have multiline and I have to convert every multiline to N lines). It is 4 (2+2). Can I get this number without asking every feature how many parts it have? I doubt that, but...

Thanks for your kind anwser!

De: Even Rouault <even.rouault at spatialys.com>
Enviado el: divendres, 7 de juliol de 2023 12:32
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] A question of eficiency


Abel,

At the minimum for the reading side of a vector driver, you need to implement GetNextFeature().

If there is an efficient way of knowing the number of features without iterating over the whole file (typically a field in a header giving that number), you may implement GetFeatureCount(). If you don't implement it, and code using your driver needs the feature count, the generic implementation of OGRLayer::GetFeatureCount() will call GetNextFeature() repeatdly until it returns NULL.

Not totally sure to understand your question about multielements. If you have an instance of OGRGeometryCollection or any deriving class, there's a getNumGeometries() method to get the number of parts

Even
Le 07/07/2023 ? 11:33, Abel Pau a ?crit :
Hi,
I would like to know if when we use the code of GDAL to program a driver (or whatever) in vectors (so, ogr) we can assume that we can know the number of elements we are going to import in any way or it would be possible not knowing that until NextFeature is empty (or something like that). So, there is any way to obtain this number of elements without doing a while? And in case of multielements its possible to know how many parts are there in total?
I need that to write my format (I don?t explain the details cause I don?t get you bored :) )

If anyone know that I?d appreciate an answer. Thanks in advance.

Abel.



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/44ac99ed/attachment-0001.htm>

From nhv at meganet.net  Fri Jul  7 03:30:43 2023
From: nhv at meganet.net (Norman Vine)
Date: Fri, 7 Jul 2023 06:30:43 -0400
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <FD3F48E1-0651-43F5-9F58-E43ED1AA7F5F@meganet.net>

With some formats sizeof, fseek and ftell can be most useful 


> On Jul 7, 2023, at 5:33 AM, Abel Pau <a.pau at creaf.uab.cat> wrote:
> 
> Hi,
> I would like to know if when we use the code of GDAL to program a driver (or whatever) in vectors (so, ogr) we can assume that we can know the number of elements we are going to import in any way or it would be possible not knowing that until NextFeature is empty (or something like that). So, there is any way to obtain this number of elements without doing a while? And in case of multielements its possible to know how many parts are there in total?
> I need that to write my format (I don?t explain the details cause I don?t get you bored :) )
>  
> If anyone know that I?d appreciate an answer. Thanks in advance.
>  
> Abel.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



From Benoit.DesRochers2 at USherbrooke.ca  Fri Jul  7 10:21:00 2023
From: Benoit.DesRochers2 at USherbrooke.ca (=?iso-8859-1?Q?Beno=EEt_DesRochers?=)
Date: Fri, 7 Jul 2023 17:21:00 +0000
Subject: [gdal-dev] Viewshed potential issue?
Message-ID: <YT2PR01MB10276FA2550604BB7EE72D51BB62DA@YT2PR01MB10276.CANPRD01.PROD.OUTLOOK.COM>

Hello there,

Long story short, I'm trying to generate a viewshed for every cell in a raster and add them all up to get a new raster that would represent how many pixels can be seen from every cell. It takes a while, but it works!

The problem is that I'm using non-default observer and target height values (2m observer and 0.5m target) and the results are significantly different when I invert them (Use the target height as the observer and the observer as the target height). From what I understand, most viewshed algorithms don't compute sightlines for every cell but use a reference plane instead and I'm thinking that might be where the problem comes from but I'm not sure.

Am I doing something wrong or is that an expected outcome?

Thanks,
Beno?t
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/e25911e9/attachment.htm>

From szekerest at gmail.com  Fri Jul  7 12:17:42 2023
From: szekerest at gmail.com (Tamas Szekeres)
Date: Fri, 7 Jul 2023 21:17:42 +0200
Subject: [gdal-dev] Viewshed potential issue?
In-Reply-To: <YT2PR01MB10276FA2550604BB7EE72D51BB62DA@YT2PR01MB10276.CANPRD01.PROD.OUTLOOK.COM>
References: <YT2PR01MB10276FA2550604BB7EE72D51BB62DA@YT2PR01MB10276.CANPRD01.PROD.OUTLOOK.COM>
Message-ID: <CACALY+Tve30E0bjfQMcBymMFdiah3FjkL46=1C2_oGfhRcUQVw@mail.gmail.com>

Beno?t,

As far a I can understand - depending on the elevation model actually used
- you may get different results when changing the observer and the target
height or the observer location. I'm not sure how it would be different if
you set the target height specifically to the observer and the observer
height to the target height.

Best regards,

Tamas




Beno?t DesRochers <Benoit.DesRochers2 at usherbrooke.ca> ezt ?rta (id?pont:
2023. j?l. 7., P, 19:21):

> Hello there,
>
> Long story short, I'm trying to generate a viewshed for every cell in a
> raster and add them all up to get a new raster that would represent how
> many pixels can be seen from every cell. It takes a while, but it works!
>
> The problem is that I'm using non-default observer and target height
> values (2m observer and 0.5m target) and the results are significantly
> different when I invert them (Use the target height as the observer and the
> observer as the target height). From what I understand, most viewshed
> algorithms don't compute sightlines for every cell but use a reference
> plane instead and I'm thinking that might be where the problem comes from
> but I'm not sure.
>
> Am I doing something wrong or is that an expected outcome?
>
> Thanks,
> Beno?t
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/94a74432/attachment.htm>

From public at postholer.com  Fri Jul  7 12:28:03 2023
From: public at postholer.com (Scott)
Date: Fri, 7 Jul 2023 12:28:03 -0700
Subject: [gdal-dev] Off-topic: speaking of viewsheds....
In-Reply-To: <CACALY+Tve30E0bjfQMcBymMFdiah3FjkL46=1C2_oGfhRcUQVw@mail.gmail.com>
References: <YT2PR01MB10276FA2550604BB7EE72D51BB62DA@YT2PR01MB10276.CANPRD01.PROD.OUTLOOK.COM>
 <CACALY+Tve30E0bjfQMcBymMFdiah3FjkL46=1C2_oGfhRcUQVw@mail.gmail.com>
Message-ID: <8b717421-8b6d-87d9-cb32-eacd9c2390e2@postholer.com>

The following viewsheds were created with GDAL, one tif for every tenth 
of a mile along the 2,650 mile Pacific Crest Trail. Stitched together 
with ffmpeg:

https://youtu.be/tmY27ZIVfpA


On 7/7/23 12:17, Tamas Szekeres wrote:
> Beno?t,
> 
> As far a I can understand - depending on the elevation model actually 
> used - you may get different results when changing the observer and the 
> target height or the observer location. I'm not sure how it would be 
> different if you set the target height specifically to the observer and 
> the observer height to the target height.
> 
> Best regards,
> 
> Tamas
> 
> 
> 
> 
> Beno?t DesRochers <Benoit.DesRochers2 at usherbrooke.ca 
> <mailto:Benoit.DesRochers2 at usherbrooke.ca>> ezt ?rta (id?pont: 2023. 
> j?l. 7., P, 19:21):
> 
>     Hello there,
> 
>     Long story short, I'm trying to generate a viewshed for every cell
>     in a raster and add them all up to get a new raster that would
>     represent how many pixels can be seen from every cell. It takes a
>     while, but it works!
> 
>     The problem is that I'm using non-default observer and target height
>     values (2m observer and 0.5m target) and the results are
>     significantly different when I invert them (Use the target height as
>     the observer and the observer as the target height). From what I
>     understand, most viewshed algorithms don't compute sightlines for
>     every cell but use a reference plane instead and I'm thinking that
>     might be where the problem comes from but I'm not sure.
> 
>     Am I doing something wrong or is that an expected outcome?
> 
>     Thanks,
>     Beno?t
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Fri Jul  7 13:42:21 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 7 Jul 2023 22:42:21 +0200
Subject: [gdal-dev] gdaladdo enhancements for partial refresh of overviews
Message-ID: <6b167e70-58bc-74f7-1e0e-0a87201a35d8@spatialys.com>

Hi,

sitting in https://github.com/OSGeo/gdal/pull/8074, a few enhancements 
to gdaladdo to be able to selectively refresh only part of overviews. A 
typical use case is a VRT that mosaics a number of tiles, and where one 
updates just a few tiles after the initial .vrt.ovr has been created.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From patrick.mckendree.young at gmail.com  Fri Jul  7 19:08:54 2023
From: patrick.mckendree.young at gmail.com (Patrick Young)
Date: Fri, 7 Jul 2023 20:08:54 -0600
Subject: [gdal-dev] ogr2ogr sqlite dialect and fgb format
In-Reply-To: <d6cedcd8-2066-9ba9-21b4-ae9807abfca3@spatialys.com>
References: <CADXYQQ7a-5FcyapBtcb6WcW1e7613C=5uBPA5pXTeVL0VvZbTA@mail.gmail.com>
 <d6cedcd8-2066-9ba9-21b4-ae9807abfca3@spatialys.com>
Message-ID: <CADXYQQ7SF0V2+ewDfZNaskR2NVJn21OW-k-Lqnh4nS-qwN2awQ@mail.gmail.com>

Thanks Even!

On Mon, Jul 3, 2023, 3:11 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi Patrick,
>
> blocking error fixed per https://github.com/OSGeo/gdal/pull/8040
>
> and the one related to esriFieldTypeDate in
> https://github.com/OSGeo/gdal/pull/8039
>
> Even
>
> Le 28/06/2023 ? 17:18, Patrick Young a ?crit :
> > Hi,
> >
> > I'm playing around with the gdb dataset
> >
> > https://data.cityofnewyork.us/Transportation/NYC-Planimetrics/wt4d-p43d
> >
> > and getting errors starting with gdal 3.5 when I try to use the sqlite
> > dialect:
> >
> > ogr2ogr -f GeoJSONSeq -sql "select shape from roadbed where source_id
> > = 13350003311" -dialect sqlite /vsistdout/
> > NYC_DoITT_Planimetric_OpenData.gdb.zip
> >
> > ERROR 6: Unsupported field type for range domain: esriFieldTypeDate
> > ERROR 1: Cannot create virtual table for layer 'roadbed' : CREATE
> > VIRTUAL: invalid SQL statement : CREATE TABLE "roadbed"("SOURCE_ID"
> > FLOAT,"FEATURE_CODE"
> >
> INTEGER_INT16_BEGIN_DOMAIN_NAME_64526F6164626564_END_DOMAIN_NAME,"SUB_FEATURE_CODE"
>
> > INTEGER,"STATUS"
> >
> VARCHAR(16)_BEGIN_DOMAIN_NAME_645374617475735F31_END_DOMAIN_NAME,"SHAPE_Length"
>
> > FLOAT,"SHAPE_Area" FLOAT,OGR_STYLE VARCHAR HIDDEN,"SHAPE"
> > BLOB_MULTIPOLYGON_XY_2263, OGR_NATIVE_DATA VARCHAR,
> > OGR_NATIVE_MEDIA_TYPE VARCHAR)
> > ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select shape from roadbed
> > where source_id = 13350003311):
> >   no such table: roadbed
> >
> > This command works in GDAL 3.4 (and also works with the ogr sql
> > dialect); I was wanting to use the sqlite dialect so that i can use
> > CASE statements.  Is this a bug or expected?
> >
> > Thanks,
> > Patrick
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230707/efb8341c/attachment.htm>

From craig.destigter at koordinates.com  Sun Jul  9 23:42:29 2023
From: craig.destigter at koordinates.com (Craig de Stigter)
Date: Mon, 10 Jul 2023 18:42:29 +1200
Subject: [gdal-dev] Shapefile: Write alternative PRJ WKT format
Message-ID: <CAF1M8pebcxH+_WZ8ZctgTOsJmT_Tb0GYSKtF4w7+5DRorHxonw@mail.gmail.com>

Hi there

We export data in a variety of coordinate systems and formats. Most formats
work with most coordinate systems.

However, the SHP driver always calls MorphToESRI() on its SRS objects
before writing them as WKT to the PRJ files.

I haven't been able to find information on why it does this. It means
certain coordinate systems (geocentric, for instance) don't work with SHP
and raise an exception.

Could we add a creation option to customise this behaviour?

-- 
Regards,
Craig

Platform Engineer
Koordinates

+64 21 256 9488 <+64%2021%20256%209488> / koordinates.com / @koordinates
<https://twitter.com/koordinates>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230710/509785ab/attachment.htm>

From j1 at jimenezshaw.com  Mon Jul 10 01:06:54 2023
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 10 Jul 2023 10:06:54 +0200
Subject: [gdal-dev] Shapefile: Write alternative PRJ WKT format
In-Reply-To: <CAF1M8pebcxH+_WZ8ZctgTOsJmT_Tb0GYSKtF4w7+5DRorHxonw@mail.gmail.com>
References: <CAF1M8pebcxH+_WZ8ZctgTOsJmT_Tb0GYSKtF4w7+5DRorHxonw@mail.gmail.com>
Message-ID: <CADRrdKuO3FwprjWNGfReHe609-=X0mJCaV8mHcBWgoQA-5SghA@mail.gmail.com>

Hi Craig

Shape File is a format defined by ESRI. Therefore the .prj file is written
in ESRI "dialect", compatible with their software.
A na?ve solution to your problem (to generate you shape files using GDAL
dialect of WKT1), could be that you just create the shape files without any
specific SRS, and then add yourself the .prj file generated with your
preferred tool.
See that those files may not be supported by every software.

Cheers

On Mon, 10 Jul 2023 at 08:42, Craig de Stigter <
craig.destigter at koordinates.com> wrote:

> Hi there
>
> We export data in a variety of coordinate systems and formats. Most
> formats work with most coordinate systems.
>
> However, the SHP driver always calls MorphToESRI() on its SRS objects
> before writing them as WKT to the PRJ files.
>
> I haven't been able to find information on why it does this. It means
> certain coordinate systems (geocentric, for instance) don't work with SHP
> and raise an exception.
>
> Could we add a creation option to customise this behaviour?
>
> --
> Regards,
> Craig
>
> Platform Engineer
> Koordinates
>
> +64 21 256 9488 <+64%2021%20256%209488> / koordinates.com / @koordinates
> <https://twitter.com/koordinates>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230710/a39f53ac/attachment.htm>

From szekerest at gmail.com  Mon Jul 10 02:30:20 2023
From: szekerest at gmail.com (Tamas Szekeres)
Date: Mon, 10 Jul 2023 11:30:20 +0200
Subject: [gdal-dev] Off-topic: speaking of viewsheds....
In-Reply-To: <8b717421-8b6d-87d9-cb32-eacd9c2390e2@postholer.com>
References: <YT2PR01MB10276FA2550604BB7EE72D51BB62DA@YT2PR01MB10276.CANPRD01.PROD.OUTLOOK.COM>
 <CACALY+Tve30E0bjfQMcBymMFdiah3FjkL46=1C2_oGfhRcUQVw@mail.gmail.com>
 <8b717421-8b6d-87d9-cb32-eacd9c2390e2@postholer.com>
Message-ID: <CACALY+S081nJmXmbmq-qkEugw9SSJ0+1tCjurB2Fvsn1ctgoZw@mail.gmail.com>

That looks very nice.

Best regards,

Tamas


Scott <public at postholer.com> ezt ?rta (id?pont: 2023. j?l. 7., P, 21:28):

> The following viewsheds were created with GDAL, one tif for every tenth
> of a mile along the 2,650 mile Pacific Crest Trail. Stitched together
> with ffmpeg:
>
> https://youtu.be/tmY27ZIVfpA
>
>
> On 7/7/23 12:17, Tamas Szekeres wrote:
> > Beno?t,
> >
> > As far a I can understand - depending on the elevation model actually
> > used - you may get different results when changing the observer and the
> > target height or the observer location. I'm not sure how it would be
> > different if you set the target height specifically to the observer and
> > the observer height to the target height.
> >
> > Best regards,
> >
> > Tamas
> >
> >
> >
> >
> > Beno?t DesRochers <Benoit.DesRochers2 at usherbrooke.ca
> > <mailto:Benoit.DesRochers2 at usherbrooke.ca>> ezt ?rta (id?pont: 2023.
> > j?l. 7., P, 19:21):
> >
> >     Hello there,
> >
> >     Long story short, I'm trying to generate a viewshed for every cell
> >     in a raster and add them all up to get a new raster that would
> >     represent how many pixels can be seen from every cell. It takes a
> >     while, but it works!
> >
> >     The problem is that I'm using non-default observer and target height
> >     values (2m observer and 0.5m target) and the results are
> >     significantly different when I invert them (Use the target height as
> >     the observer and the observer as the target height). From what I
> >     understand, most viewshed algorithms don't compute sightlines for
> >     every cell but use a reference plane instead and I'm thinking that
> >     might be where the problem comes from but I'm not sure.
> >
> >     Am I doing something wrong or is that an expected outcome?
> >
> >     Thanks,
> >     Beno?t
> >     _______________________________________________
> >     gdal-dev mailing list
> >     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
> >     https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> >
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230710/1196eead/attachment.htm>

From g at elizr.com  Mon Jul 10 18:55:43 2023
From: g at elizr.com (Gary Turner)
Date: Tue, 11 Jul 2023 13:55:43 +1200
Subject: [gdal-dev] ogrinfo Unable to identify source geometry field with
 GDAL 3.7 but not 3.3?
Message-ID: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>

Hi,
Apologies if this isn't the right place to ask, but I am struggling to 
work out what's going on.
I'm setting up a new windows machine to process address data provided by 
a local agency. I've downloaded new versions of software.
I use ogr2ogr to load csv files via a vrt file into postgres. This works 
fine with my old setup, and has worked with various older versions as well.
However with the latest ogr2ogr it fails. ogrinfo --version says GDAL 
3.7.0, released 2023/05/02

P:\bin\gdal37>.\ogrinfo.exe C:\temp\addresses.vrt
INFO: Open of `C:\temp\addresses.vrt'
 ????? using driver `OGR_VRT' successful.
1: addressesERROR 1: Unable to identify source geometry field 'WKT' for 
geometry.
 ?(None)

but with an older version GDAL 3.3.1, released 2021/06/28
P:\bin\gdal33>.\ogrinfo.exe C:\temp\addresses.vrt
INFO: Open of `C:\temp\addresses.vrt'
 ????? using driver `OGR_VRT' successful.
1: addresses (Point)

I get the same failure with ogr2ogr, but ogrinfo seemed simpler and 
there's a much less complicated command-line.
I've cut this down to a one-field, one-line of csv example that does the 
same thing, if that's useful.

Is this expected?
Is there an easy work-around, that would work with both versions?
Please let me know if I'm missing something obvious or just being dumb, 
or should? ask elsewhere.

Thanks
Gary



From even.rouault at spatialys.com  Tue Jul 11 01:20:24 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 11 Jul 2023 10:20:24 +0200
Subject: [gdal-dev] ogrinfo Unable to identify source geometry field
 with GDAL 3.7 but not 3.3?
In-Reply-To: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>
References: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>
Message-ID: <7204aa0e-4f44-c21c-13b1-4132e6f7349d@spatialys.com>

Gary,

please provide a VRT and CSV that can reproduce this

Even

Le 11/07/2023 ? 03:55, Gary Turner a ?crit?:
> Hi,
> Apologies if this isn't the right place to ask, but I am struggling to 
> work out what's going on.
> I'm setting up a new windows machine to process address data provided 
> by a local agency. I've downloaded new versions of software.
> I use ogr2ogr to load csv files via a vrt file into postgres. This 
> works fine with my old setup, and has worked with various older 
> versions as well.
> However with the latest ogr2ogr it fails. ogrinfo --version says GDAL 
> 3.7.0, released 2023/05/02
>
> P:\bin\gdal37>.\ogrinfo.exe C:\temp\addresses.vrt
> INFO: Open of `C:\temp\addresses.vrt'
> ????? using driver `OGR_VRT' successful.
> 1: addressesERROR 1: Unable to identify source geometry field 'WKT' 
> for geometry.
> ?(None)
>
> but with an older version GDAL 3.3.1, released 2021/06/28
> P:\bin\gdal33>.\ogrinfo.exe C:\temp\addresses.vrt
> INFO: Open of `C:\temp\addresses.vrt'
> ????? using driver `OGR_VRT' successful.
> 1: addresses (Point)
>
> I get the same failure with ogr2ogr, but ogrinfo seemed simpler and 
> there's a much less complicated command-line.
> I've cut this down to a one-field, one-line of csv example that does 
> the same thing, if that's useful.
>
> Is this expected?
> Is there an easy work-around, that would work with both versions?
> Please let me know if I'm missing something obvious or just being 
> dumb, or should? ask elsewhere.
>
> Thanks
> Gary
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Tue Jul 11 01:53:04 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 11 Jul 2023 10:53:04 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.1RC1 as 3.7.1 release
Message-ID: <e1138dc8-bc34-007b-1c39-026150470a49@spatialys.com>

Hi,

Motion:

Adopt GDAL 3.7.1RC1 as 3.7.1 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From howard at hobu.co  Tue Jul 11 07:01:26 2023
From: howard at hobu.co (Howard Butler)
Date: Tue, 11 Jul 2023 09:01:26 -0500
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.1RC1 as 3.7.1 release
In-Reply-To: <e1138dc8-bc34-007b-1c39-026150470a49@spatialys.com>
References: <e1138dc8-bc34-007b-1c39-026150470a49@spatialys.com>
Message-ID: <EC0CF9E7-63E7-4A2E-A5FD-A4B447748A2D@hobu.co>



> On Jul 11, 2023, at 3:53 AM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> Hi,
> 
> Motion:
> 
> Adopt GDAL 3.7.1RC1 as 3.7.1 release
> 
> Starting with my +1

+1

Howard

From simon.proud at stfc.ac.uk  Tue Jul 11 12:01:47 2023
From: simon.proud at stfc.ac.uk (Simon Proud - STFC UKRI)
Date: Tue, 11 Jul 2023 19:01:47 +0000
Subject: [gdal-dev] Problem opening new format ECMWF grib files
Message-ID: <CWLP265MB2195BB49988F8065D7AC2ABCC031A@CWLP265MB2195.GBRP265.PROD.OUTLOOK.COM>

Hello,
I'm trying to open a grib format file from ECMWF. The file is generated using the ECMWF open data python library as follows:

from ecmwf.opendata import Client
client = Client()

result = client.retrieve(
    type="fc",
    param="skt",
    step="0",
    target="data.grb2",
)

This produces a grib file I can read with cfgrib and eccodes but not with gdal:
>>>gdalinfo data.grib2
??????getdrstemplate: DRS Template 5.42 not defined.
??????ERROR 4: data.grib2 is a grib file, but no raster dataset was successfully identified.
             gdalinfo failed - unable to open 'data.grib2'.


I suspect this may be due to changes in their grib format, see: https://confluence.ecmwf.int/display/COPSRV/Implementation+of+IFS+cycle+48r1+for+CAMS#ImplementationofIFScycle48r1forCAMS-DefaultpackingtypesfordatafromDisseminationandMARS


Am I correct in this assumption and, if so, is there a way around it in GDAL? Otherwise, any clues what could be the problem with this grib?

Thanks,
Simon

--
Dr Simon Proud (he/him)
Senior Remote Sensing Scientist
RAL Space | National Centre for Earth Observation
Science and Technology Facilities Council
simon.proud at stfc.ac.uk<mailto:simon.proud at stfc.ac.uk> | www.ralspace.stfc.ac.uk<https://www.ralspace.stfc.ac.uk/>
Rutherford Appleton Laboratory | Harwell Campus | Didcot
Tel: +44 1235 445620
Twitter: @simon_sat

[X]  [signature_165909100]
STFC and NCEO are part of UK Research and Innovation. www.ukri.org<https://www.ukri.org/>


-----

Due to childcare arrangements, my normal working hours may not be the same as yours. If you receive an email from me at an odd time, please do not feel the need to reply until your own normal working day.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230711/660aade3/attachment-0001.htm>

From g at elizr.com  Tue Jul 11 18:35:58 2023
From: g at elizr.com (Gary Turner)
Date: Wed, 12 Jul 2023 13:35:58 +1200
Subject: [gdal-dev] ogrinfo Unable to identify source geometry field
 with GDAL 3.7 but not 3.3?
In-Reply-To: <7204aa0e-4f44-c21c-13b1-4132e6f7349d@spatialys.com>
References: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>
 <7204aa0e-4f44-c21c-13b1-4132e6f7349d@spatialys.com>
Message-ID: <0269551a-dec1-0557-a7c7-35ff8ddd17a5@elizr.com>

As attached. I've removed some bulky documentation from the 
as-downloaded/supplied zip file.

On 11/07/2023 8:20 pm, Even Rouault wrote:
> Gary,
>
> please provide a VRT and CSV that can reproduce this
>
> Even
>
> Le 11/07/2023 ? 03:55, Gary Turner a ?crit?:
>> Hi,
>> Apologies if this isn't the right place to ask, but I am struggling 
>> to work out what's going on.
>> I'm setting up a new windows machine to process address data provided 
>> by a local agency. I've downloaded new versions of software.
>> I use ogr2ogr to load csv files via a vrt file into postgres. This 
>> works fine with my old setup, and has worked with various older 
>> versions as well.
>> However with the latest ogr2ogr it fails. ogrinfo --version says GDAL 
>> 3.7.0, released 2023/05/02
>>
>> P:\bin\gdal37>.\ogrinfo.exe C:\temp\addresses.vrt
>> INFO: Open of `C:\temp\addresses.vrt'
>> ????? using driver `OGR_VRT' successful.
>> 1: addressesERROR 1: Unable to identify source geometry field 'WKT' 
>> for geometry.
>> ?(None)
>>
>> but with an older version GDAL 3.3.1, released 2021/06/28
>> P:\bin\gdal33>.\ogrinfo.exe C:\temp\addresses.vrt
>> INFO: Open of `C:\temp\addresses.vrt'
>> ????? using driver `OGR_VRT' successful.
>> 1: addresses (Point)
>>
>> I get the same failure with ogr2ogr, but ogrinfo seemed simpler and 
>> there's a much less complicated command-line.
>> I've cut this down to a one-field, one-line of csv example that does 
>> the same thing, if that's useful.
>>
>> Is this expected?
>> Is there an easy work-around, that would work with both versions?
>> Please let me know if I'm missing something obvious or just being 
>> dumb, or should? ask elsewhere.
>>
>> Thanks
>> Gary
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lds-nz-addresses-CSV.zip
Type: application/x-zip-compressed
Size: 2700 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230712/7db34b9d/attachment.bin>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Jul 12 01:43:46 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 12 Jul 2023 08:43:46 +0000
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.1RC1 as 3.7.1 release
In-Reply-To: <e1138dc8-bc34-007b-1c39-026150470a49@spatialys.com>
References: <e1138dc8-bc34-007b-1c39-026150470a49@spatialys.com>
Message-ID: <AM0PR09MB3219D4A30C592AB840A0BD2DFD36A@AM0PR09MB3219.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: tiistai 11. hein?kuuta 2023 11.53
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: Adopt GDAL 3.7.1RC1 as 3.7.1 release

Hi,

Motion:

Adopt GDAL 3.7.1RC1 as 3.7.1 release

Starting with my +1

Even

--
http://www.spatialys.com/
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From jukka.rahkonen at maanmittauslaitos.fi  Wed Jul 12 04:58:12 2023
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 12 Jul 2023 11:58:12 +0000
Subject: [gdal-dev] ogrinfo Unable to identify source geometry field
 with GDAL 3.7 but not 3.3?
In-Reply-To: <0269551a-dec1-0557-a7c7-35ff8ddd17a5@elizr.com>
References: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>
 <7204aa0e-4f44-c21c-13b1-4132e6f7349d@spatialys.com>
 <0269551a-dec1-0557-a7c7-35ff8ddd17a5@elizr.com>
Message-ID: <AM0PR09MB32190461F291AAF05E164B9BFD36A@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

I can confirm the error with GDAL 3.7.0. But because you have both .csv and .csvt it I wonder if there is any need to use .vrt. Output from "ogrinfo nz-addresses.csv" looks correct to me.

-Jukka Rahkonen-



-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Gary Turner
L?hetetty: keskiviikko 12. hein?kuuta 2023 4.36
Vastaanottaja: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogrinfo Unable to identify source geometry field with GDAL 3.7 but not 3.3?

As attached. I've removed some bulky documentation from the as-downloaded/supplied zip file.

On 11/07/2023 8:20 pm, Even Rouault wrote:
> Gary,
>
> please provide a VRT and CSV that can reproduce this
>
> Even
>
> Le 11/07/2023 ? 03:55, Gary Turner a ?crit?:
>> Hi,
>> Apologies if this isn't the right place to ask, but I am struggling 
>> to work out what's going on.
>> I'm setting up a new windows machine to process address data provided 
>> by a local agency. I've downloaded new versions of software.
>> I use ogr2ogr to load csv files via a vrt file into postgres. This 
>> works fine with my old setup, and has worked with various older 
>> versions as well.
>> However with the latest ogr2ogr it fails. ogrinfo --version says GDAL 
>> 3.7.0, released 2023/05/02
>>
>> P:\bin\gdal37>.\ogrinfo.exe C:\temp\addresses.vrt
>> INFO: Open of `C:\temp\addresses.vrt'
>> ????? using driver `OGR_VRT' successful.
>> 1: addressesERROR 1: Unable to identify source geometry field 'WKT' 
>> for geometry.
>> ?(None)
>>
>> but with an older version GDAL 3.3.1, released 2021/06/28 
>> P:\bin\gdal33>.\ogrinfo.exe C:\temp\addresses.vrt
>> INFO: Open of `C:\temp\addresses.vrt'
>> ????? using driver `OGR_VRT' successful.
>> 1: addresses (Point)
>>
>> I get the same failure with ogr2ogr, but ogrinfo seemed simpler and 
>> there's a much less complicated command-line.
>> I've cut this down to a one-field, one-line of csv example that does 
>> the same thing, if that's useful.
>>
>> Is this expected?
>> Is there an easy work-around, that would work with both versions?
>> Please let me know if I'm missing something obvious or just being 
>> dumb, or should? ask elsewhere.
>>
>> Thanks
>> Gary
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org

From jmckenna at gatewaygeomatics.com  Wed Jul 12 05:19:41 2023
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 12 Jul 2023 09:19:41 -0300
Subject: [gdal-dev] ogrinfo Unable to identify source geometry field
 with GDAL 3.7 but not 3.3?
In-Reply-To: <AM0PR09MB32190461F291AAF05E164B9BFD36A@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>
 <7204aa0e-4f44-c21c-13b1-4132e6f7349d@spatialys.com>
 <0269551a-dec1-0557-a7c7-35ff8ddd17a5@elizr.com>
 <AM0PR09MB32190461F291AAF05E164B9BFD36A@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <b339b893-3486-8874-5574-475d8325f26f@gatewaygeomatics.com>

I also confirm the error with today's master (3.8.0dev).

Jukka is correct (same thinking as me), this works directly from CSV 
(into PostgreSQL 15.3) now...

   ogr2ogr -f "PG:dbname=nz_address port=xxx user=xxx password=xxx" 
nz-addresses.csv -oo GEOM_POSSIBLE_NAMES=WKT


-jeff



-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/




On 2023-07-12 8:58 a.m., Rahkonen Jukka wrote:
> Hi,
> 
> I can confirm the error with GDAL 3.7.0. But because you have both .csv and .csvt it I wonder if there is any need to use .vrt. Output from "ogrinfo nz-addresses.csv" looks correct to me.
> 
> -Jukka Rahkonen-
> 
> 
> 
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Gary Turner
> L?hetetty: keskiviikko 12. hein?kuuta 2023 4.36
> Vastaanottaja: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> Aihe: Re: [gdal-dev] ogrinfo Unable to identify source geometry field with GDAL 3.7 but not 3.3?
> 
> As attached. I've removed some bulky documentation from the as-downloaded/supplied zip file.
> 
> On 11/07/2023 8:20 pm, Even Rouault wrote:
>> Gary,
>>
>> please provide a VRT and CSV that can reproduce this
>>
>> Even
>>
>> Le 11/07/2023 ? 03:55, Gary Turner a ?crit?:
>>> Hi,
>>> Apologies if this isn't the right place to ask, but I am struggling
>>> to work out what's going on.
>>> I'm setting up a new windows machine to process address data provided
>>> by a local agency. I've downloaded new versions of software.
>>> I use ogr2ogr to load csv files via a vrt file into postgres. This
>>> works fine with my old setup, and has worked with various older
>>> versions as well.
>>> However with the latest ogr2ogr it fails. ogrinfo --version says GDAL
>>> 3.7.0, released 2023/05/02
>>>
>>> P:\bin\gdal37>.\ogrinfo.exe C:\temp\addresses.vrt
>>> INFO: Open of `C:\temp\addresses.vrt'
>>>  ????? using driver `OGR_VRT' successful.
>>> 1: addressesERROR 1: Unable to identify source geometry field 'WKT'
>>> for geometry.
>>>  ?(None)
>>>
>>> but with an older version GDAL 3.3.1, released 2021/06/28
>>> P:\bin\gdal33>.\ogrinfo.exe C:\temp\addresses.vrt
>>> INFO: Open of `C:\temp\addresses.vrt'
>>>  ????? using driver `OGR_VRT' successful.
>>> 1: addresses (Point)
>>>
>>> I get the same failure with ogr2ogr, but ogrinfo seemed simpler and
>>> there's a much less complicated command-line.
>>> I've cut this down to a one-field, one-line of csv example that does
>>> the same thing, if that's useful.
>>>
>>> Is this expected?
>>> Is there an easy work-around, that would work with both versions?
>>> Please let me know if I'm missing something obvious or just being
>>> dumb, or should? ask elsewhere.
>>>
>>> Thanks
>>> Gary
>>>
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


From jmckenna at gatewaygeomatics.com  Wed Jul 12 05:21:24 2023
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 12 Jul 2023 09:21:24 -0300
Subject: [gdal-dev] ogrinfo Unable to identify source geometry field
 with GDAL 3.7 but not 3.3?
In-Reply-To: <b339b893-3486-8874-5574-475d8325f26f@gatewaygeomatics.com>
References: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>
 <7204aa0e-4f44-c21c-13b1-4132e6f7349d@spatialys.com>
 <0269551a-dec1-0557-a7c7-35ff8ddd17a5@elizr.com>
 <AM0PR09MB32190461F291AAF05E164B9BFD36A@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <b339b893-3486-8874-5574-475d8325f26f@gatewaygeomatics.com>
Message-ID: <62ac3a5d-4be2-6882-a5b6-0f597c80ee49@gatewaygeomatics.com>

oops, the command was:

   ogr2ogr -f PostgreSQL "PG:dbname=nz_address port=xxx user=xxx 
password=xxx" nz-addresses.csv -oo GEOM_POSSIBLE_NAMES=WKT



-jeff



On 2023-07-12 9:19 a.m., Jeff McKenna wrote:
> ogr2ogr -f "PG:dbname=nz_address port=xxx user=xxx password=xxx" 
> nz-addresses.csv -oo GEOM_POSSIBLE_NAMES=WKT

-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/


From even.rouault at spatialys.com  Wed Jul 12 05:57:18 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 12 Jul 2023 14:57:18 +0200
Subject: [gdal-dev] ogrinfo Unable to identify source geometry field
 with GDAL 3.7 but not 3.3?
In-Reply-To: <0269551a-dec1-0557-a7c7-35ff8ddd17a5@elizr.com>
References: <2f7ddd83-614f-f45d-773e-e283a6dd4021@elizr.com>
 <7204aa0e-4f44-c21c-13b1-4132e6f7349d@spatialys.com>
 <0269551a-dec1-0557-a7c7-35ff8ddd17a5@elizr.com>
Message-ID: <426e15e0-b28b-fc0b-ffc9-e6ee31e738e2@spatialys.com>

Gary,

This is very likely due to commit 
https://github.com/OSGeo/gdal/commit/d60e71154c02b84b4c59cd61d3c21eb150f0b42a 
: "when the .csvt indicates WKT and in default KEEP_GEOM_COLUMNS=YES 
mode, prefix the geometry field name with 'geom_'" which was done to 
avoid to have both a regular attribute field and a geometry field with 
the same name, "WKT". Now the geometry column is called "geom_WKT"

3 possible ways of fixing this:

- likely slightly most performant one to switch to using the geometry 
column: change <GeometryField field="WKT" reportSrcColumn="FALSE"> to 
<GeometryField field="geom_WKT" reportSrcColumn="FALSE">

- or change <GeometryField field="WKT" reportSrcColumn="FALSE"> to 
<GeometryField field="WKT" reportSrcColumn="FALSE" encoding="WKT">? to 
ask to use the regular field WKT and interpret it as containing WKT 
geometries

- or add <OpenOptions><OOI 
key="KEEP_GEOM_COLUMNS">NO</OOI></OpenOptions> , for example after the 
<SrcDataSource> element, so that the regular WKT field is not exposed by 
the CSV driver, and thus only a geometry field WKT is exposed

The 2 later ones should likely be compatible with older GDAL versions too

Even


Le 12/07/2023 ? 03:35, Gary Turner a ?crit?:
> As attached. I've removed some bulky documentation from the 
> as-downloaded/supplied zip file.
>
> On 11/07/2023 8:20 pm, Even Rouault wrote:
>> Gary,
>>
>> please provide a VRT and CSV that can reproduce this
>>
>> Even
>>
>> Le 11/07/2023 ? 03:55, Gary Turner a ?crit?:
>>> Hi,
>>> Apologies if this isn't the right place to ask, but I am struggling 
>>> to work out what's going on.
>>> I'm setting up a new windows machine to process address data 
>>> provided by a local agency. I've downloaded new versions of software.
>>> I use ogr2ogr to load csv files via a vrt file into postgres. This 
>>> works fine with my old setup, and has worked with various older 
>>> versions as well.
>>> However with the latest ogr2ogr it fails. ogrinfo --version says 
>>> GDAL 3.7.0, released 2023/05/02
>>>
>>> P:\bin\gdal37>.\ogrinfo.exe C:\temp\addresses.vrt
>>> INFO: Open of `C:\temp\addresses.vrt'
>>> ????? using driver `OGR_VRT' successful.
>>> 1: addressesERROR 1: Unable to identify source geometry field 'WKT' 
>>> for geometry.
>>> ?(None)
>>>
>>> but with an older version GDAL 3.3.1, released 2021/06/28
>>> P:\bin\gdal33>.\ogrinfo.exe C:\temp\addresses.vrt
>>> INFO: Open of `C:\temp\addresses.vrt'
>>> ????? using driver `OGR_VRT' successful.
>>> 1: addresses (Point)
>>>
>>> I get the same failure with ogr2ogr, but ogrinfo seemed simpler and 
>>> there's a much less complicated command-line.
>>> I've cut this down to a one-field, one-line of csv example that does 
>>> the same thing, if that's useful.
>>>
>>> Is this expected?
>>> Is there an easy work-around, that would work with both versions?
>>> Please let me know if I'm missing something obvious or just being 
>>> dumb, or should? ask elsewhere.
>>>
>>> Thanks
>>> Gary
>>>
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Jul 12 06:02:30 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 12 Jul 2023 15:02:30 +0200
Subject: [gdal-dev] Problem opening new format ECMWF grib files
In-Reply-To: <CWLP265MB2195BB49988F8065D7AC2ABCC031A@CWLP265MB2195.GBRP265.PROD.OUTLOOK.COM>
References: <CWLP265MB2195BB49988F8065D7AC2ABCC031A@CWLP265MB2195.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <981b0bd6-0a98-a3b4-9155-ada430203168@spatialys.com>

Simon,


please find an issue about that to 
https://github.com/OSGeo/gdal/issues/new and attach a dataset 
reproducing the issue or a convenient link to such a dataset


Even


Le 11/07/2023 ? 21:01, Simon Proud - STFC UKRI via gdal-dev a ?crit?:
> Hello,
> I'm trying to open a grib format file from ECMWF. The file is 
> generated using the ECMWF open data python library as follows:
>
> from ecmwf.opendata import Client
> client = Client()
>
> result = client.retrieve(
> ? ? type="fc",
> ? ? param="skt",
> ? ? step="0",
> ? ? target="data.grb2",
> )
>
> This produces a grib file I can read with cfgrib and eccodes but not 
> with gdal:
> >>>gdalinfo data.grib2
> ??????getdrstemplate: DRS Template 5.42 not defined.
> ??????ERROR 4: data.grib2 is a grib file, but no raster dataset was 
> successfully identified.
> ? ? ? ? ? ? ?gdalinfo failed - unable to open 'data.grib2'.
>
>
> I suspect this may be due to changes in their grib format, see: 
> https://confluence.ecmwf.int/display/COPSRV/Implementation+of+IFS+cycle+48r1+for+CAMS#ImplementationofIFScycle48r1forCAMS-DefaultpackingtypesfordatafromDisseminationandMARS
>
>
> Am I correct in this assumption and, if so, is there a way around it 
> in GDAL? Otherwise, any clues what could be the problem with this grib?
>
> Thanks,
> Simon
>
> --
>
> *Dr Simon Proud (he/him)*
>
> *Senior Remote Sensing Scientist*
>
> RAL Space | National Centre for Earth Observation
> Science and Technology?Facilities Council
>
> simon.proud at stfc.ac.uk<mailto:simon.proud at stfc.ac.uk>?| 
> www.ralspace.stfc.ac.uk<https://www.ralspace.stfc.ac.uk/>
> Rutherford Appleton?Laboratory | Harwell Campus | Didcot
>
> Tel: +44 1235 445620
>
> Twitter: @simon_sat
>
> signature_165909100
> STFC and NCEO are part of UK Research and?Innovation. 
> www.ukri.org<https://www.ukri.org/>
>
> -----
>
> Due to childcare arrangements, my normal working hours may not be the 
> same as yours. If you receive an email from me at an odd time, please 
> do not feel the need to reply until your own normal working day.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230712/fb5b7122/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Jul 13 09:58:59 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 13 Jul 2023 18:58:59 +0200
Subject: [gdal-dev] Motion: Adopt GDAL 3.7.1RC1 as 3.7.1 release
In-Reply-To: <e1138dc8-bc34-007b-1c39-026150470a49@spatialys.com>
References: <e1138dc8-bc34-007b-1c39-026150470a49@spatialys.com>
Message-ID: <ea75d705-daa7-4f06-95ec-6bf09d2877d2@spatialys.com>

Hi,

Motion passed with +1 from PSC members HowardB, JukkaR and me

Even

Le 11/07/2023 ? 10:53, Even Rouault a ?crit?:
> Hi,
>
> Motion:
>
> Adopt GDAL 3.7.1RC1 as 3.7.1 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Jul 13 10:20:05 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 13 Jul 2023 19:20:05 +0200
Subject: [gdal-dev] GDAL 3.7.1 is released
Message-ID: <35b1f8a6-298a-c68c-1e25-0f43cccaaced@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the 
release of the GDAL/OGR 3.7.1 bug fix version.

Consult the release notes for the list of issues addressed:
 ? https://github.com/OSGeo/gdal/blob/v3.7.1/NEWS.md

The sources are available at:

 ??? https://download.osgeo.org/gdal/3.7.1/gdal-3.7.1.tar.xz
 ??? https://download.osgeo.org/gdal/3.7.1/gdal-3.7.1.tar.gz
 ??? https://download.osgeo.org/gdal/3.7.1/gdal371.zip

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From fwschenck at gmail.com  Fri Jul 14 08:36:39 2023
From: fwschenck at gmail.com (Ferdinand)
Date: Fri, 14 Jul 2023 17:36:39 +0200
Subject: [gdal-dev] PNeo pan-sharpening post 3.7.0
Message-ID: <CAAYM6-8JmE8WcX9nGj25rhFvq1ZUPw1pQm16tViQSnC8d2-s6A@mail.gmail.com>

Hi all,

We do stereo photogrammetry on Pleiades/PNeo images, and in one case we run
our algorithms on pansharpened images.

Our workflow therefore was that we would pan-sharpen the images and then
run our stereo processing (using the panchromatic RPC model for the
pansharpened image).

However, with the change in this PR:
https://github.com/OSGeo/gdal/pull/7373 which
was integrated into release 3.7.0, this is no longer possible.
gdal_pansharpen.py now gives: `RuntimeError: Panchromatic band has no
associated geotransform`.

What is the recommended workflow for this now? We can't orthorectify the
images first, as we need the raw row/column information in the image in
order for the photogrammetry processing to work.

Is there some other way to add a geotransform that does not require warping
the image?


Cheers,

Ferdi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230714/0a8706fc/attachment.htm>

From even.rouault at spatialys.com  Fri Jul 14 13:50:00 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 14 Jul 2023 22:50:00 +0200
Subject: [gdal-dev] PNeo pan-sharpening post 3.7.0
In-Reply-To: <CAAYM6-8JmE8WcX9nGj25rhFvq1ZUPw1pQm16tViQSnC8d2-s6A@mail.gmail.com>
References: <CAAYM6-8JmE8WcX9nGj25rhFvq1ZUPw1pQm16tViQSnC8d2-s6A@mail.gmail.com>
Message-ID: <b74c718f-1c85-59b7-7429-3b828d7ffae5@spatialys.com>

Ferdinand,

you can for example use "gdal_edit.py -ro -a_ullr X1 Y1 X2 Y2 your.tif" 
to create a geotransform in a sidecar .aux.xml file.? If the pan and ms 
images have the same extent, you could possibly just use -a_ullr 0 0 1 
-1 (untested though). This hypothesis is not totally true as there's 
some subpixel shift for those products between the pan and ms bands if I 
remember well, so you might need to tune that a bit to get optimal 
results, but generally assuming same extent should give you already a 
decent result.

Even

Le 14/07/2023 ? 17:36, Ferdinand a ?crit?:
> Hi all,
>
> We do stereo photogrammetry on Pleiades/PNeo images, and in one case 
> we run our algorithms on pansharpened images.
>
> Our workflow therefore was that we would pan-sharpen the images and 
> then run our stereo processing (using the panchromatic RPC model for 
> the pansharpened image).
>
> However, with the change?in this PR: 
> https://github.com/OSGeo/gdal/pull/7373?which was integrated into 
> release 3.7.0, this is no longer possible. gdal_pansharpen.py now 
> gives: `RuntimeError: Panchromatic band has no associated geotransform`.
>
> What is the recommended?workflow for this now? We can't orthorectify 
> the images first, as we need the raw row/column information in the 
> image in order for the photogrammetry processing to work.
>
> Is there some other way to add a geotransform that does not require 
> warping the image?
>
>
> Cheers,
>
> Ferdi
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230714/5556d2a6/attachment.htm>

From fwschenck at gmail.com  Sat Jul 15 07:13:06 2023
From: fwschenck at gmail.com (Ferdinand)
Date: Sat, 15 Jul 2023 16:13:06 +0200
Subject: [gdal-dev] PNeo pan-sharpening post 3.7.0
In-Reply-To: <b74c718f-1c85-59b7-7429-3b828d7ffae5@spatialys.com>
References: <CAAYM6-8JmE8WcX9nGj25rhFvq1ZUPw1pQm16tViQSnC8d2-s6A@mail.gmail.com>
 <b74c718f-1c85-59b7-7429-3b828d7ffae5@spatialys.com>
Message-ID: <CAAYM6-9=XFJL7yv9fyUQpJpKmEP71dP-qqM16FkAPn67YQCTEA@mail.gmail.com>

Hi Evan,

Thanks for the response, I'll give it a go.
As you are on the ticket I mentioned, I assume the rationale behind the
change was to remove the implicit assumption of overlap?
Was there also a subpixel shift then when doing it the "old" way?

Cheers,

Ferdi

On Fri, Jul 14, 2023 at 10:50?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Ferdinand,
>
> you can for example use "gdal_edit.py -ro -a_ullr X1 Y1 X2 Y2 your.tif" to
> create a geotransform in a sidecar .aux.xml file.  If the pan and ms images
> have the same extent, you could possibly just use -a_ullr 0 0 1 -1
> (untested though). This hypothesis is not totally true as there's some
> subpixel shift for those products between the pan and ms bands if I
> remember well, so you might need to tune that a bit to get optimal results,
> but generally assuming same extent should give you already a decent result.
>
> Even
> Le 14/07/2023 ? 17:36, Ferdinand a ?crit :
>
> Hi all,
>
> We do stereo photogrammetry on Pleiades/PNeo images, and in one case we
> run our algorithms on pansharpened images.
>
> Our workflow therefore was that we would pan-sharpen the images and then
> run our stereo processing (using the panchromatic RPC model for the
> pansharpened image).
>
> However, with the change in this PR:
> https://github.com/OSGeo/gdal/pull/7373 which was integrated into release
> 3.7.0, this is no longer possible. gdal_pansharpen.py now gives: `RuntimeError:
> Panchromatic band has no associated geotransform`.
>
> What is the recommended workflow for this now? We can't orthorectify the
> images first, as we need the raw row/column information in the image in
> order for the photogrammetry processing to work.
>
> Is there some other way to add a geotransform that does not require
> warping the image?
>
>
> Cheers,
>
> Ferdi
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230715/4ec307aa/attachment.htm>

From even.rouault at spatialys.com  Sat Jul 15 10:01:44 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 15 Jul 2023 19:01:44 +0200
Subject: [gdal-dev] PNeo pan-sharpening post 3.7.0
In-Reply-To: <CAAYM6-9=XFJL7yv9fyUQpJpKmEP71dP-qqM16FkAPn67YQCTEA@mail.gmail.com>
References: <CAAYM6-8JmE8WcX9nGj25rhFvq1ZUPw1pQm16tViQSnC8d2-s6A@mail.gmail.com>
 <b74c718f-1c85-59b7-7429-3b828d7ffae5@spatialys.com>
 <CAAYM6-9=XFJL7yv9fyUQpJpKmEP71dP-qqM16FkAPn67YQCTEA@mail.gmail.com>
Message-ID: <3587ac57-dcb7-6e98-b95e-89d555315b0c@spatialys.com>

There's a whole discussion starting at comment 
https://github.com/OSGeo/gdal/pull/7256#issuecomment-1433318699 about 
how the old approach implicitly assuming same georeferencing for MS and 
PAN bands could be wrong for some data products, which could lead to 
increasing errors on right and bottom edges of images. It was decided 
that it was better for pansharpening to require having explicit 
geotransform in its inputs rather than making possibly incorrect guesses.

Even

Le 15/07/2023 ? 16:13, Ferdinand a ?crit?:
> Hi Evan,
>
> Thanks for the response, I'll give it a go.
> As you are on the ticket I mentioned, I assume the rationale behind 
> the change was to remove the implicit assumption of overlap?
> Was there also a subpixel shift then when doing it the "old" way?
>
> Cheers,
>
> Ferdi
>
> On Fri, Jul 14, 2023 at 10:50?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Ferdinand,
>
>     you can for example use "gdal_edit.py -ro -a_ullr X1 Y1 X2 Y2
>     your.tif" to create a geotransform in a sidecar .aux.xml file.? If
>     the pan and ms images have the same extent, you could possibly
>     just use -a_ullr 0 0 1 -1 (untested though). This hypothesis is
>     not totally true as there's some subpixel shift for those products
>     between the pan and ms bands if I remember well, so you might need
>     to tune that a bit to get optimal results, but generally assuming
>     same extent should give you already a decent result.
>
>     Even
>
>     Le 14/07/2023 ? 17:36, Ferdinand a ?crit?:
>>     Hi all,
>>
>>     We do stereo photogrammetry on Pleiades/PNeo images, and in one
>>     case we run our algorithms on pansharpened images.
>>
>>     Our workflow therefore was that we would pan-sharpen the images
>>     and then run our stereo processing (using the panchromatic RPC
>>     model for the pansharpened image).
>>
>>     However, with the change?in this PR:
>>     https://github.com/OSGeo/gdal/pull/7373?which was integrated into
>>     release 3.7.0, this is no longer possible. gdal_pansharpen.py now
>>     gives: `RuntimeError: Panchromatic band has no associated
>>     geotransform`.
>>
>>     What is the recommended?workflow for this now? We can't
>>     orthorectify the images first, as we need the raw row/column
>>     information in the image in order for the photogrammetry
>>     processing to work.
>>
>>     Is there some other way to add a geotransform that does not
>>     require warping the image?
>>
>>
>>     Cheers,
>>
>>     Ferdi
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230715/9d8fa2a0/attachment.htm>

From public at postholer.com  Sat Jul 15 15:27:26 2023
From: public at postholer.com (Scott)
Date: Sat, 15 Jul 2023 15:27:26 -0700
Subject: [gdal-dev] Rotating a raster?
In-Reply-To: <35b1f8a6-298a-c68c-1e25-0f43cccaaced@spatialys.com>
References: <35b1f8a6-298a-c68c-1e25-0f43cccaaced@spatialys.com>
Message-ID: <5511ffd3-b2df-96ac-4482-a65e38729ffd@postholer.com>

Someone over on reddit.com/r/gis asked a seemingly simple question, "How 
to rotate a raster by some value using xmin/ymax as the center of rotation?"

The poster was trying to do this using C++, GDAL libs. Any thoughts on 
how to do this with code or gdal utils?

Thanks!


From eric at knudstrup.org  Sun Jul 16 16:01:35 2023
From: eric at knudstrup.org (Eric Knudstrup)
Date: Sun, 16 Jul 2023 16:01:35 -0700
Subject: [gdal-dev] Setting up bash completions on Ubunto 18
Message-ID: <9c387bcd-8785-44b1-e38b-211b7006b266@knudstrup.org>

I have built and installed GDAL 3.7.1 on Ubuntu 18, except I'm having 
trouble getting it to recognize the bash completions.

Probably related, it tells me to install python-gdal:

$ gdal2tiles.py

Command 'gdal2tiles.py' not found, but can be installed with:

apt install python-gdal
Please ask your administrator.

I don't know how to remove that message.


From public at postholer.com  Sun Jul 16 16:17:49 2023
From: public at postholer.com (Scott)
Date: Sun, 16 Jul 2023 16:17:49 -0700
Subject: [gdal-dev] Setting up bash completions on Ubunto 18
In-Reply-To: <9c387bcd-8785-44b1-e38b-211b7006b266@knudstrup.org>
References: <9c387bcd-8785-44b1-e38b-211b7006b266@knudstrup.org>
Message-ID: <e3e451f3-cc1d-a921-4d67-caef17255171@postholer.com>

It looks like it's not in your path. If you built gdal with the default 
install prefix it should be in /usr/local/bin. Make sure that's in your 
path:

export PATH=$PATH:/usr/local/bin

It seems odd that it's not in your path, though.

On 7/16/23 16:01, Eric Knudstrup via gdal-dev wrote:
> I have built and installed GDAL 3.7.1 on Ubuntu 18, except I'm having 
> trouble getting it to recognize the bash completions.
> 
> Probably related, it tells me to install python-gdal:
> 
> $ gdal2tiles.py
> 
> Command 'gdal2tiles.py' not found, but can be installed with:
> 
> apt install python-gdal
> Please ask your administrator.
> 
> I don't know how to remove that message.
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From eric at knudstrup.org  Sun Jul 16 16:58:16 2023
From: eric at knudstrup.org (Eric Knudstrup)
Date: Sun, 16 Jul 2023 16:58:16 -0700
Subject: [gdal-dev] Setting up bash completions on Ubunto 18
In-Reply-To: <e3e451f3-cc1d-a921-4d67-caef17255171@postholer.com>
References: <9c387bcd-8785-44b1-e38b-211b7006b266@knudstrup.org>
 <e3e451f3-cc1d-a921-4d67-caef17255171@postholer.com>
Message-ID: <5fdd402b-0f68-ee84-4241-2c9f54424ffc@knudstrup.org>


On 7/16/23 4:17 PM, Scott wrote:
> It looks like it's not in your path. If you built gdal with the 
> default install prefix it should be in /usr/local/bin. Make sure 
> that's in your path:
>
Ah, thanks.? The build doc didn't say I had to use pip3 to install the 
Python tools.

From ujaval at spatialthoughts.com  Mon Jul 17 04:26:09 2023
From: ujaval at spatialthoughts.com (Ujaval Gandhi)
Date: Mon, 17 Jul 2023 11:26:09 +0000
Subject: [gdal-dev] Rotating a raster?
In-Reply-To: <5511ffd3-b2df-96ac-4482-a65e38729ffd@postholer.com>
References: <35b1f8a6-298a-c68c-1e25-0f43cccaaced@spatialys.com>
 <5511ffd3-b2df-96ac-4482-a65e38729ffd@postholer.com>
Message-ID: <e0f5ffa2-fb75-01dc-d658-cae8824662bf@spatialthoughts.com>

You can do this using an Affine transform. GDAL Python API solution is at?
https://gis.stackexchange.com/questions/408386/rotating-raster-using-python
[https://mailtrack.io/trace/link/3421685d0fc5341428d4aec3575450a45132f703?url=https%3A%2F%2Fgis.stackexchange.com%2Fquestions%2F408386%2Frotating-raster-using-python&userId=8747767&signature=ad33731e269a50d0]

---
Ujaval Gandhi
Spatial Thoughts
www.spatialthoughts.com
[https://mailtrack.io/trace/link/8a3e8e7a8c5d14be3dd980b240946403e1f8024c?url=http%3A%2F%2Fwww.spatialthoughts.com&userId=8747767&signature=9b2a49a0cd6960e4]




[data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=3D]
On Sun, Jul 16, 2023 at 3:57?AM Scott <public at postholer.com> wrote:


> Someone over on reddit.com/r/gis [http://reddit.com/r/gis] asked a seemingly
> simple question, "How
> to rotate a raster by some value using xmin/ymax as the center of rotation?"
> 
> The poster was trying to do this using C++, GDAL libs. Any thoughts on
> how to do this with code or gdal utils?
> 
> Thanks!
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org [gdal-dev at lists.osgeo.org]
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> [https://lists.osgeo.org/mailman/listinfo/gdal-dev]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230717/d9cce5a2/attachment.htm>

From public at postholer.com  Mon Jul 17 07:42:15 2023
From: public at postholer.com (Scott)
Date: Mon, 17 Jul 2023 07:42:15 -0700
Subject: [gdal-dev] Rotating a raster?
In-Reply-To: <e0f5ffa2-fb75-01dc-d658-cae8824662bf@spatialthoughts.com>
References: <35b1f8a6-298a-c68c-1e25-0f43cccaaced@spatialys.com>
 <5511ffd3-b2df-96ac-4482-a65e38729ffd@postholer.com>
 <e0f5ffa2-fb75-01dc-d658-cae8824662bf@spatialthoughts.com>
Message-ID: <f9bb1b4f-e13c-b500-aefb-1f6ae4c1f708@postholer.com>

Thanks! I'll pass that along.

On 7/17/23 04:26, Ujaval Gandhi wrote:
> You can do this using an Affine transform. GDAL Python API solution is at
> https://gis.stackexchange.com/questions/408386/rotating-raster-using-python <https://mailtrack.io/trace/link/3421685d0fc5341428d4aec3575450a45132f703?w=cHVibGljQHBvc3Rob2xlci5jb20&url=https%3A%2F%2Fgis.stackexchange.com%2Fquestions%2F408386%2Frotating-raster-using-python&userId=8747767&signature=ad33731e269a50d0>
> ---
> Ujaval Gandhi
> Spatial Thoughts
> www.spatialthoughts.com 
> <https://mailtrack.io/trace/link/8a3e8e7a8c5d14be3dd980b240946403e1f8024c?w=cHVibGljQHBvc3Rob2xlci5jb20&url=http%3A%2F%2Fwww.spatialthoughts.com&userId=8747767&signature=9b2a49a0cd6960e4>
> 
> 
> 
> On Sun, Jul 16, 2023 at 3:57?AM Scott <public at postholer.com> wrote:
> 
>     Someone over on reddit.com/r/gis <http://reddit.com/r/gis> asked a
>     seemingly simple question, "How
>     to rotate a raster by some value using xmin/ymax as the center of
>     rotation?"
> 
>     The poster was trying to do this using C++, GDAL libs. Any thoughts on
>     how to do this with code or gdal utils?
> 
>     Thanks!
> 
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> 

From woklist at kyngchaos.com  Tue Jul 18 14:19:38 2023
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Tue, 18 Jul 2023 16:19:38 -0500
Subject: [gdal-dev] reading rat values from GDB raster
Message-ID: <A6B73E34-50E5-43E4-8AD4-0758A753A455@kyngchaos.com>

I would like to convert a GDB raster with a multi column rat by writing out one of the columns. I can see the rat with gdalinfo but I can't figure out how to read values from the rat (other than the cell value) so they can be written to a new raster. 

-----
William Kyngesburye
<kyngchaos*at*kyngchaos*dot*com>
<https://www.kyngchaos.com>

Don't Panic

From even.rouault at spatialys.com  Tue Jul 18 15:23:59 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 19 Jul 2023 00:23:59 +0200
Subject: [gdal-dev] gdalinfo on large vrt takes a long time
In-Reply-To: <4F774876-6FAA-482A-85C6-59C5A4CF1186@kyngchaos.com>
References: <4F774876-6FAA-482A-85C6-59C5A4CF1186@kyngchaos.com>
Message-ID: <957d08de-a8db-53e7-bc86-889e07e0f0e1@spatialys.com>

Can you run under gdb and break when it takes a long time and display 
the stack trace ?

Something along (best with a debug build):

gdb --args gdalinfo your.vrt

run

hit ctrl-c when it takes some time

bt


Le 19/07/2023 ? 00:17, William Kyngesburye a ?crit?:
> ??(sorry, my email sorting rules missed your reply somehow, just found it)
>
> The env var didn't help, and the vrt does have statistics.
>
> Pathnames in the vrt are relative to the vrt, if that might be a problem in this situation.
>
> I turned on CPL_DEBUG.  gdalinfo is doing whatever is taking time after GDALDefaultOverviews::OverviewScan().  The next output that appears when that's done is the list of files.  The individual files do not have overviews, and the vrt has no overviews.  When I add the vrt overviews (I disable them most of the time by renaming the over file because they're out of date), I get the overview scan message, a list of overviews with no delay, then another overview scan message that has the long processing time again, then the file list.
>
> -----
> William Kyngesburye
> <kyngchaos*at*kyngchaos*dot*com>
> <https://www.kyngchaos.com>
>
> Don't Panic
>
>> On Jun 8, 2023, at 6:18 PM, Even Rouault <even.rouault at spatialys.com> wrote:
>> ?William,
>>
>> it might be perhaps related to the GetMinimum() call done by gdalinfo. Cf https://trac.osgeo.org/gdal/ticket/5444
>>
>> But normally it should only try to open the first source, and not all of them. At least that's what I could confirm on a quick testing. But I do see that the CanUseSourcesMinMaxImplementations() method will stat() sources whose filename looks like a local file (obviously if that's a mounted file system / vpn thing, it will not realize it is remote).
>>
>> Try setting the VRT_MIN_MAX_FROM_SOURCES=NO environment variable / configuration option to see if that makes a difference. If it does, the CanUseSourcesMinMaxImplementations() logic should be modified to avoid doing those stat's().
>>
>> If that's confirmed to be linked to GetMinmum(), you may also workaround the issue by doing a "gdalinfo -stats the.vrt" (from the server) to have statistics incorporated in the VRT, then GetMinimum() should be instant
>>
>> Even
>>
>> Le 09/06/2023 ? 00:43, William Kyngesburye a ?crit :
>>> I'm writing a script that needs some info from a vrt raster, and one has thousands of files. When reading the vrt over the internet (vpn to our server) it takes a long time. I think it's looking at every file of the vrt.  What is gdal reading from the files that's not in the vrt itself? I used all the -no options and I'm not adding any other info options like checksums or stats. I just need basic info from the vrt that's in the vrt file.
>>>
>>> -----
>>> William Kyngesburye
>>> <kyngchaos*at*kyngchaos*dot*com>
>>> <https://www.kyngchaos.com>
>>>
>>> Don't Panic
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> -- 
>> http://www.spatialys.com
>> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From woklist at kyngchaos.com  Tue Jul 18 15:17:27 2023
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Tue, 18 Jul 2023 17:17:27 -0500
Subject: [gdal-dev] gdalinfo on large vrt takes a long time
Message-ID: <4F774876-6FAA-482A-85C6-59C5A4CF1186@kyngchaos.com>

??(sorry, my email sorting rules missed your reply somehow, just found it)

The env var didn't help, and the vrt does have statistics.

Pathnames in the vrt are relative to the vrt, if that might be a problem in this situation.

I turned on CPL_DEBUG.  gdalinfo is doing whatever is taking time after GDALDefaultOverviews::OverviewScan().  The next output that appears when that's done is the list of files.  The individual files do not have overviews, and the vrt has no overviews.  When I add the vrt overviews (I disable them most of the time by renaming the over file because they're out of date), I get the overview scan message, a list of overviews with no delay, then another overview scan message that has the long processing time again, then the file list.

-----
William Kyngesburye
<kyngchaos*at*kyngchaos*dot*com>
<https://www.kyngchaos.com>

Don't Panic

> On Jun 8, 2023, at 6:18 PM, Even Rouault <even.rouault at spatialys.com> wrote:
> ?William,
> 
> it might be perhaps related to the GetMinimum() call done by gdalinfo. Cf https://trac.osgeo.org/gdal/ticket/5444
> 
> But normally it should only try to open the first source, and not all of them. At least that's what I could confirm on a quick testing. But I do see that the CanUseSourcesMinMaxImplementations() method will stat() sources whose filename looks like a local file (obviously if that's a mounted file system / vpn thing, it will not realize it is remote).
> 
> Try setting the VRT_MIN_MAX_FROM_SOURCES=NO environment variable / configuration option to see if that makes a difference. If it does, the CanUseSourcesMinMaxImplementations() logic should be modified to avoid doing those stat's().
> 
> If that's confirmed to be linked to GetMinmum(), you may also workaround the issue by doing a "gdalinfo -stats the.vrt" (from the server) to have statistics incorporated in the VRT, then GetMinimum() should be instant
> 
> Even
> 
> Le 09/06/2023 ? 00:43, William Kyngesburye a ?crit :
>> I'm writing a script that needs some info from a vrt raster, and one has thousands of files. When reading the vrt over the internet (vpn to our server) it takes a long time. I think it's looking at every file of the vrt.  What is gdal reading from the files that's not in the vrt itself? I used all the -no options and I'm not adding any other info options like checksums or stats. I just need basic info from the vrt that's in the vrt file.
>> 
>> -----
>> William Kyngesburye
>> <kyngchaos*at*kyngchaos*dot*com>
>> <https://www.kyngchaos.com>
>> 
>> Don't Panic
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

From even.rouault at spatialys.com  Tue Jul 18 15:30:45 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 19 Jul 2023 00:30:45 +0200
Subject: [gdal-dev] reading rat values from GDB raster
In-Reply-To: <A6B73E34-50E5-43E4-8AD4-0758A753A455@kyngchaos.com>
References: <A6B73E34-50E5-43E4-8AD4-0758A753A455@kyngchaos.com>
Message-ID: <ac3c2a88-c628-17f2-eaa3-db25b7949362@spatialys.com>

William,

if you gdal_translate / CreateCopy() to a TIF, the RAT will be written 
in the side car .aux.xml file. You can either use your favorite XML 
edition tool to remove all columns but the one you are interested in, or 
use the C/C++/Python GDALRasterAttributeTable API to create a new RAT 
and copy values from the original one. 
https://github.com/OSGeo/gdal/blob/master/autotest/gcore/rat.py might 
serve as a starting point to get some sense of the API

Even

Le 18/07/2023 ? 23:19, William Kyngesburye a ?crit?:
> I would like to convert a GDB raster with a multi column rat by writing out one of the columns. I can see the rat with gdalinfo but I can't figure out how to read values from the rat (other than the cell value) so they can be written to a new raster.
>
> -----
> William Kyngesburye
> <kyngchaos*at*kyngchaos*dot*com>
> <https://www.kyngchaos.com>
>
> Don't Panic
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From a.pau at creaf.uab.cat  Wed Jul 19 01:30:42 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 19 Jul 2023 08:30:42 +0000
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
 <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <AS8PR07MB8168E573C0F87CB28AF225D7A239A@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hi again,

I have a .c file in the makefile added as follow:
# depends from frmts/aigrid, avc
add_gdal_driver(
  TARGET ogr_MiraMon
  SOURCES ogrmiramondatasource.cpp ogrmiramondriver.cpp ogrmiramonlayer.cpp mmwrlayr.c
  BUILTIN)
gdal_standard_includes(ogr_MiraMon)
target_include_directories(ogr_MiraMon PRIVATE $<TARGET_PROPERTY:ogrsf_generic,SOURCE_DIR>)


It makes the .c file appears at the project i VS:

[cid:image002.png at 01D9BA2B.C422DF00]

Then I use a function MMReadHeader() in ogrmiramonlayer.cpp but when I try to build an error appears:

ogrmiramonlayer.obj : error LNK2019: unresolved external symbol "int __cdecl MMReadHeader(struct VSIVirtualHandle *,str
uct MiraMonLayerInfo *,struct MM_TH *)" (?MMReadHeader@@YAHPEAUVSIVirtualHandle@@PEAUMiraMonLayerInfo@@PEAUMM_TH@@@Z) r
eferenced in function "public: __cdecl OGRMiraMonLayer::OGRMiraMonLayer(char const *,struct VSIVirtualHandle *,class OG
RSpatialReference const *,int)" (??0OGRMiraMonLayer@@QEAA at PEBDPEAUVSIVirtualHandle@@PEBVOGRSpatialReference@@H at Z) [D:\G
itHub-repository\GDAL\build\GDAL.vcxproj]
    Hint on symbols that are defined and could potentially match:
      MMReadHeader
D:\GitHub-repository\GDAL\build\Debug\gdald.dll : fatal error LNK1120: 1 unresolved externals [D:\GitHub-repository\GDA
L\build\GDAL.vcxproj]

I understand that I have to add the .c file un a library and I try to do it in the makefile:

# miramonlib
if (GDAL_USE_MIRAMONLIB_INTERNAL)
  # ogrmiramon.h miramonfil.h mmwrlayr.c
  add_library(miramonlib OBJECT mmwrlayr.c)
  gdal_standard_includes(miramonlib)
  target_compile_definitions(miramonlib PUBLIC -DSAOffset=vsi_l_offset)
  target_compile_options(miramonlib PRIVATE ${GDAL_C_WARNING_FLAGS})
  if (RENAME_INTERNAL_MIRAMONLIB_SYMBOLS)
    target_compile_definitions(miramonlib PUBLIC -DRENAME_INTERNAL_MIRAMONLIB_SYMBOLS -DSHPAPI_CALL=)
  endif ()
  target_compile_definitions(miramonlib PUBLIC -DUSE_CPL)
  set_property(TARGET miramonlib PROPERTY POSITION_INDEPENDENT_CODE ${GDAL_OBJECT_LIBRARIES_POSITION_INDEPENDENT_CODE})
  target_sources(${GDAL_LIB_TARGET_NAME} PRIVATE $<TARGET_OBJECTS:miramonlib>)
  gdal_add_vendored_lib(ogr_MiraMon miramonlib)
elseif (HAVE_MIRAMONLIB)
  gdal_target_link_libraries(ogr_MiraMon PRIVATE MIRAMONLIB::miramon)
endif ()


I think that this miramonlib is not included and I don?t know how to do that (cause I thought that in had to be done in the makefile).

Can anyone tell me how to add this .c file to use the functions in it in the .cpp files?
THANKS ins advance!


De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau
Enviado el: dijous, 6 de juliol de 2023 15:01
Para: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Instructions for a new writing driver?

Hi again.
I finally did that and I am happy.

It would be helpful for us to be able to use our C functions to read and write some parts of our format instead of passing all of them to C++.
I?d like doing that but it?s not possible for the moment convert all our code to C++.

My proposal is use a ogrmiramondatasource.cpp, a ogrmiramondriver.cpp and a ogrmiramonlayer.cpp as all of the projects that are created and add our files from C as necessary.
The main goal is adding only the necessary ones.

The question: Is this possible? Can I simply add C files and use that functions from C++ files? Or do GDAL prefer doing it in another way?
Sorry if it is written somewhere else but I couldn?t find it.

Thanks again for your kind help.

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau
Enviado el: dimecres, 5 de juliol de 2023 15:13
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Instructions for a new writing driver?

Thanks you both!




De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Even Rouault
Enviado el: dimecres, 5 de juliol de 2023 13:59
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Instructions for a new writing driver?


(resending to list)

The CSV driver is actually not that simple to follow since it has tricks to support updates through the OGREditableLayer mechanism. The GMT one (ogr/ogrsf_frmts/gmt) might be a better start for a creation & append only driver. But basically, the only common thing with your own code will be the fact that you have to implement the 2 virtual methods of interest: OGRLayer::CreateField() ,d OGRLayer::ICreateFeature() and declare a few capabilities in OGRLayer::TestCapability()

Unless you want to implement update capabilities (if the format allows it, which is generally not the case for a text based format), it might be simpler to have 2 distinct OGRLayer sub-classes for read-only and write-only operations.
Even
Le 05/07/2023 ? 13:21, Lauren?iu Nicola via gdal-dev a ?crit :
Hi,

I think your best bet would be to take inspiration from an existing driver, like the CSV one (which shouldn't be too different from the hypothetical SPF driver in the docs).

Laurentiu

On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:

Hi, following instructions about creating a new driver I found that

https://gdal.org/tutorials/vector_driver_tut.html





But I need to create a driver that can also write from any vector it?s own format.

So, the inverse sense of the html I found.



There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it?s own format)?

Thanks in advance!


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230719/bc1b5ff9/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 6645 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230719/bc1b5ff9/attachment-0001.png>

From mniemyjski at cloudferro.com  Wed Jul 19 02:01:44 2023
From: mniemyjski at cloudferro.com (Marcin Niemyjski)
Date: Wed, 19 Jul 2023 09:01:44 +0000
Subject: [gdal-dev] Multiple processing options related to Cloud Masking in
 one VRT
Message-ID: <AS1PR03MB8149BA3B9C24E504D1B32B7DA839A@AS1PR03MB8149.eurprd03.prod.outlook.com>

Hello,

What I am trying to do is to generate a VRT file suitable for composing an RGB satellite image along with a cloud mask for that composition.

I would like to include the following information in one VRT file
:

  1.  Information about the path to the RGB image file
  2.  Information about the path to the cloud mask file
  3.  Marking/reclassifying pixels with a specified cloud value as "no data" (for the mask file, so that GDAL can properly mask them in the RGB composition)
  4.  Indicating the cloud mask file as the alpha channel.

Is this possible? Currently, I'm attempting the following:

(python3.10) ubuntu at janek-test:~$ gdalbuildvrt /home/ubuntu/Desktop/alpha.vrt /eodata/Sentinel-2/MSI/L2A/2022/06/05/S2B_MSIL2A_20220605T083559_N0400_R064_T37TCN_20220605T103839.SAFE/GRANULE/L2A_T37TCN_A027403_20220605T083716/IMG_DATA/R60m/T37TCN_20220605T083559_TCI_60m.jp2 -addalpha /eodata/Sentinel-2/MSI/L2A/2022/06/05/S2B_MSIL2A_20220605T083559_N0400_R064_T37TCN_20220605T103839.SAFE/GRANULE/L2A_T37TCN_A027403_20220605T083716/IMG_DATA/R60m/T37TCN_20220605T083559_SCL_60m.jp2 0...10...20...30...40...50...60...70...80...90...100 - done. Warning 1: gdalbuildvrt does not support heterogeneous band numbers: expected 3, got 1. Skipping /eodata/Sentinel-2/MSI/L2A/2022/06/05/S2B_MSIL2A_20220605T083559_N0400_R064_T37TCN_20220605T103839.SAFE/GRANULE/L2A_T37TCN_A027403_20220605T083716/IMG_DATA/R60m/T37TCN_20220605T083559_SCL_60m.jp2

with visible poor results :(

I would be very grateful for any advice or recommendation.
Best,

Marcin



Marcin Niemyjski
Junior Data Scientist
CloudFerro sp z o.o.
office: Fabryczna 5 ?????    m: +48 695 831 753
00-446 Warszawa, Poland ???e: mniemyjski at cloudferro.com
[https://i.imgur.com/jlLouj5.png]<https://cloudferro.com/>
[cid:48964d15-1c33-49b0-9330-d5379abfbdf5]<https://outlook.office.com/bookwithme/user/6347c7def05a478ba013ae948648789d at cloudferro.com?anonymous&ep=signature>           Book time to meet with me<https://outlook.office.com/bookwithme/user/6347c7def05a478ba013ae948648789d at cloudferro.com?anonymous&ep=signature>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230719/f048e301/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Outlook-xs0nzd04.png
Type: image/png
Size: 528 bytes
Desc: Outlook-xs0nzd04.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230719/f048e301/attachment.png>

From woklist at kyngchaos.com  Wed Jul 19 06:47:58 2023
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Wed, 19 Jul 2023 08:47:58 -0500
Subject: [gdal-dev] gdalinfo on large vrt takes a long time
In-Reply-To: <957d08de-a8db-53e7-bc86-889e07e0f0e1@spatialys.com>
References: <957d08de-a8db-53e7-bc86-889e07e0f0e1@spatialys.com>
Message-ID: <34248BC5-AFF4-41ED-8284-594F49957FA2@kyngchaos.com>

macos has lldb, once I figured that out, I got:

* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP
  * frame #0: 0x00007ff81eefdeb2 libsystem_kernel.dylib`stat$INODE64 + 10
    frame #1: 0x000000010140c669 GDAL`VSIStatExL + 96
    frame #2: 0x0000000101699994 GDAL`VRTSimpleSource::GetFileList(char***, int*, int*, _CPLHashSet*) + 118
    frame #3: 0x000000010169709b GDAL`VRTSourcedRasterBand::GetFileList(char***, int*, int*, _CPLHashSet*) + 71
    frame #4: 0x00000001016a603c GDAL`VRTDataset::GetFileList() + 114
    frame #5: 0x0000000101ee40df GDAL`GDALInfo + 543
    frame #6: 0x0000000100003911 gdalinfo`main + 914
    frame #7: 0x000000010001552e dyld`start + 462

It looks like just getting the file list touches the files to make sure they exist?

-----
William Kyngesburye
<kyngchaos*at*kyngchaos*dot*com>
<https://www.kyngchaos.com>

Don't Panic

> On Jul 18, 2023, at 5:24 PM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> ?Can you run under gdb and break when it takes a long time and display the stack trace ?
> 
> Something along (best with a debug build):
> 
> gdb --args gdalinfo your.vrt
> 
> run
> 
> hit ctrl-c when it takes some time
> 
> bt
> 
> 
>> Le 19/07/2023 ? 00:17, William Kyngesburye a ?crit :
>> ??(sorry, my email sorting rules missed your reply somehow, just found it)
>> 
>> The env var didn't help, and the vrt does have statistics.
>> 
>> Pathnames in the vrt are relative to the vrt, if that might be a problem in this situation.
>> 
>> I turned on CPL_DEBUG.  gdalinfo is doing whatever is taking time after GDALDefaultOverviews::OverviewScan().  The next output that appears when that's done is the list of files.  The individual files do not have overviews, and the vrt has no overviews.  When I add the vrt overviews (I disable them most of the time by renaming the over file because they're out of date), I get the overview scan message, a list of overviews with no delay, then another overview scan message that has the long processing time again, then the file list.
>> 
>> -----
>> William Kyngesburye
>> <kyngchaos*at*kyngchaos*dot*com>
>> <https://www.kyngchaos.com>
>> 
>> Don't Panic
>> 
>>>> On Jun 8, 2023, at 6:18 PM, Even Rouault <even.rouault at spatialys.com> wrote:
>>> ?William,
>>> 
>>> it might be perhaps related to the GetMinimum() call done by gdalinfo. Cf https://trac.osgeo.org/gdal/ticket/5444
>>> 
>>> But normally it should only try to open the first source, and not all of them. At least that's what I could confirm on a quick testing. But I do see that the CanUseSourcesMinMaxImplementations() method will stat() sources whose filename looks like a local file (obviously if that's a mounted file system / vpn thing, it will not realize it is remote).
>>> 
>>> Try setting the VRT_MIN_MAX_FROM_SOURCES=NO environment variable / configuration option to see if that makes a difference. If it does, the CanUseSourcesMinMaxImplementations() logic should be modified to avoid doing those stat's().
>>> 
>>> If that's confirmed to be linked to GetMinmum(), you may also workaround the issue by doing a "gdalinfo -stats the.vrt" (from the server) to have statistics incorporated in the VRT, then GetMinimum() should be instant
>>> 
>>> Even
>>> 
>>> Le 09/06/2023 ? 00:43, William Kyngesburye a ?crit :
>>>> I'm writing a script that needs some info from a vrt raster, and one has thousands of files. When reading the vrt over the internet (vpn to our server) it takes a long time. I think it's looking at every file of the vrt.  What is gdal reading from the files that's not in the vrt itself? I used all the -no options and I'm not adding any other info options like checksums or stats. I just need basic info from the vrt that's in the vrt file.
>>>> 
>>>> -----
>>>> William Kyngesburye
>>>> <kyngchaos*at*kyngchaos*dot*com>
>>>> <https://www.kyngchaos.com>
>>>> 
>>>> Don't Panic
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>> -- 
>>> http://www.spatialys.com
>>> My software is free, but my time generally not.
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
> 

From a.pau at creaf.uab.cat  Wed Jul 19 07:23:29 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 19 Jul 2023 14:23:29 +0000
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <AS8PR07MB8168E573C0F87CB28AF225D7A239A@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
 <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168E573C0F87CB28AF225D7A239A@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <AS8PR07MB8168B5023F2F41FCEA0F63BDA239A@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hi,
finally I?ve discovered that the file mmwrlayr.c have to be included as cpp (internally is a C) but the extension is a cpp file.

I don?t understand why so the questions remains open.
In shape driver I see .c and all works but I don?t understand the difference.

Thanks!

De: Abel Pau <a.pau at creaf.uab.cat>
Enviado el: dimecres, 19 de juliol de 2023 10:31
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: RE: [gdal-dev] Instructions for a new writing driver?

Hi again,

I have a .c file in the makefile added as follow:
# depends from frmts/aigrid, avc
add_gdal_driver(
  TARGET ogr_MiraMon
  SOURCES ogrmiramondatasource.cpp ogrmiramondriver.cpp ogrmiramonlayer.cpp mmwrlayr.c
  BUILTIN)
gdal_standard_includes(ogr_MiraMon)
target_include_directories(ogr_MiraMon PRIVATE $<TARGET_PROPERTY:ogrsf_generic,SOURCE_DIR>)


It makes the .c file appears at the project i VS:

[cid:image001.png at 01D9BA5D.5997B660]

Then I use a function MMReadHeader() in ogrmiramonlayer.cpp but when I try to build an error appears:

ogrmiramonlayer.obj : error LNK2019: unresolved external symbol "int __cdecl MMReadHeader(struct VSIVirtualHandle *,str
uct MiraMonLayerInfo *,struct MM_TH *)" (?MMReadHeader@@YAHPEAUVSIVirtualHandle@@PEAUMiraMonLayerInfo@@PEAUMM_TH@@@Z) r
eferenced in function "public: __cdecl OGRMiraMonLayer::OGRMiraMonLayer(char const *,struct VSIVirtualHandle *,class OG
RSpatialReference const *,int)" (??0OGRMiraMonLayer@@QEAA at PEBDPEAUVSIVirtualHandle@@PEBVOGRSpatialReference@@H at Z) [D:\G
itHub-repository\GDAL\build\GDAL.vcxproj]
    Hint on symbols that are defined and could potentially match:
      MMReadHeader
D:\GitHub-repository\GDAL\build\Debug\gdald.dll : fatal error LNK1120: 1 unresolved externals [D:\GitHub-repository\GDA
L\build\GDAL.vcxproj]

I understand that I have to add the .c file un a library and I try to do it in the makefile:

# miramonlib
if (GDAL_USE_MIRAMONLIB_INTERNAL)
  # ogrmiramon.h miramonfil.h mmwrlayr.c
  add_library(miramonlib OBJECT mmwrlayr.c)
  gdal_standard_includes(miramonlib)
  target_compile_definitions(miramonlib PUBLIC -DSAOffset=vsi_l_offset)
  target_compile_options(miramonlib PRIVATE ${GDAL_C_WARNING_FLAGS})
  if (RENAME_INTERNAL_MIRAMONLIB_SYMBOLS)
    target_compile_definitions(miramonlib PUBLIC -DRENAME_INTERNAL_MIRAMONLIB_SYMBOLS -DSHPAPI_CALL=)
  endif ()
  target_compile_definitions(miramonlib PUBLIC -DUSE_CPL)
  set_property(TARGET miramonlib PROPERTY POSITION_INDEPENDENT_CODE ${GDAL_OBJECT_LIBRARIES_POSITION_INDEPENDENT_CODE})
  target_sources(${GDAL_LIB_TARGET_NAME} PRIVATE $<TARGET_OBJECTS:miramonlib>)
  gdal_add_vendored_lib(ogr_MiraMon miramonlib)
elseif (HAVE_MIRAMONLIB)
  gdal_target_link_libraries(ogr_MiraMon PRIVATE MIRAMONLIB::miramon)
endif ()


I think that this miramonlib is not included and I don?t know how to do that (cause I thought that in had to be done in the makefile).

Can anyone tell me how to add this .c file to use the functions in it in the .cpp files?
THANKS ins advance!


De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau
Enviado el: dijous, 6 de juliol de 2023 15:01
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Instructions for a new writing driver?

Hi again.
I finally did that and I am happy.

It would be helpful for us to be able to use our C functions to read and write some parts of our format instead of passing all of them to C++.
I?d like doing that but it?s not possible for the moment convert all our code to C++.

My proposal is use a ogrmiramondatasource.cpp, a ogrmiramondriver.cpp and a ogrmiramonlayer.cpp as all of the projects that are created and add our files from C as necessary.
The main goal is adding only the necessary ones.

The question: Is this possible? Can I simply add C files and use that functions from C++ files? Or do GDAL prefer doing it in another way?
Sorry if it is written somewhere else but I couldn?t find it.

Thanks again for your kind help.

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau
Enviado el: dimecres, 5 de juliol de 2023 15:13
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Instructions for a new writing driver?

Thanks you both!




De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Even Rouault
Enviado el: dimecres, 5 de juliol de 2023 13:59
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Instructions for a new writing driver?


(resending to list)

The CSV driver is actually not that simple to follow since it has tricks to support updates through the OGREditableLayer mechanism. The GMT one (ogr/ogrsf_frmts/gmt) might be a better start for a creation & append only driver. But basically, the only common thing with your own code will be the fact that you have to implement the 2 virtual methods of interest: OGRLayer::CreateField() ,d OGRLayer::ICreateFeature() and declare a few capabilities in OGRLayer::TestCapability()

Unless you want to implement update capabilities (if the format allows it, which is generally not the case for a text based format), it might be simpler to have 2 distinct OGRLayer sub-classes for read-only and write-only operations.
Even
Le 05/07/2023 ? 13:21, Lauren?iu Nicola via gdal-dev a ?crit :
Hi,

I think your best bet would be to take inspiration from an existing driver, like the CSV one (which shouldn't be too different from the hypothetical SPF driver in the docs).

Laurentiu

On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:

Hi, following instructions about creating a new driver I found that

https://gdal.org/tutorials/vector_driver_tut.html





But I need to create a driver that can also write from any vector it?s own format.

So, the inverse sense of the html I found.



There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it?s own format)?

Thanks in advance!


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230719/a0586e93/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 6645 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230719/a0586e93/attachment-0001.png>

From woklist at kyngchaos.com  Wed Jul 19 07:26:45 2023
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Wed, 19 Jul 2023 09:26:45 -0500
Subject: [gdal-dev] reading rat values from GDB raster
In-Reply-To: <ac3c2a88-c628-17f2-eaa3-db25b7949362@spatialys.com>
References: <ac3c2a88-c628-17f2-eaa3-db25b7949362@spatialys.com>
Message-ID: <3A12926B-C33D-4C25-AC0B-7899057807C8@kyngchaos.com>

Ah, that works to get the xml rat.  I had converted to tif with Arc before I remembered that GDAL can read gdb rasters now, and got a dbf rat.

I can trim the xml rat down, but I need to leave the value field so it has some way to lookup a cell value in the rat, but identifying a cell (QGIS or gdallocationinfo) still only gives me the cell value not the rat lookup value.

Is there something else I need to do with the rat config?  What about the tableType attribute to GDALRasterAttributeTable? The conversion set "thematic". I tried removing it (like the example in the vrt help page) but that didn't help.

Here is the trimmed down xml rat header and first value:

<PAMDataset>
  <PAMRasterBand band="1">
    <GDALRasterAttributeTable tableType="thematic">
      <FieldDefn index="0">
        <Name>Value</Name>
        <Type>0</Type>
        <Usage>5</Usage>
      </FieldDefn>
      <FieldDefn index="1">
        <Name>World_Landform_Class</Name>
        <Type>1</Type>
        <Usage>0</Usage>
      </FieldDefn>
      <Row index="0">
        <F>1005</F>
        <F>1</F>
      </Row>
...

-----
William Kyngesburye
<kyngchaos*at*kyngchaos*dot*com>
<https://www.kyngchaos.com>

Don't Panic

> On Jul 18, 2023, at 5:31 PM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> ?William,
> 
> if you gdal_translate / CreateCopy() to a TIF, the RAT will be written in the side car .aux.xml file. You can either use your favorite XML edition tool to remove all columns but the one you are interested in, or use the C/C++/Python GDALRasterAttributeTable API to create a new RAT and copy values from the original one. https://github.com/OSGeo/gdal/blob/master/autotest/gcore/rat.py might serve as a starting point to get some sense of the API
> 
> Even
> 
>> Le 18/07/2023 ? 23:19, William Kyngesburye a ?crit :
>> I would like to convert a GDB raster with a multi column rat by writing out one of the columns. I can see the rat with gdalinfo but I can't figure out how to read values from the rat (other than the cell value) so they can be written to a new raster.
>> 
>> -----
>> William Kyngesburye
>> <kyngchaos*at*kyngchaos*dot*com>
>> <https://www.kyngchaos.com>
>> 
>> Don't Panic
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
> 

From andrew at aitchison.me.uk  Wed Jul 19 07:32:48 2023
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 19 Jul 2023 15:32:48 +0100 (BST)
Subject: [gdal-dev] GDAL driver plugins on github ?
Message-ID: <32d6a0e3-83e5-d219-98cb-31d421328e2c@aitchison.me.uk>


I would like to put a gdal driver on github *as a plugin*.
Are there any existing gdal drivers, or other projects that
depend upon gdal, already separately in github that I could
use as a starting point ?

Any other suggestions as how to do this would be welcomed,
bearing in mind that if mine is the first, it may be copied
by future plugins.

* I have offered another driver as a pull request,
but Evan found reviewing my code to be overwhelming.

Thanks,

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From andrew at aitchison.me.uk  Wed Jul 19 07:48:20 2023
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 19 Jul 2023 15:48:20 +0100 (BST)
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <AS8PR07MB8168B5023F2F41FCEA0F63BDA239A@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
 <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168E573C0F87CB28AF225D7A239A@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168B5023F2F41FCEA0F63BDA239A@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <5495ac10-4eb7-2433-3e6f-289595c21331@aitchison.me.uk>

On Wed, 19 Jul 2023, Abel Pau wrote:

> Hi,
> finally I?ve discovered that the file mmwrlayr.c have to be included as cpp (internally is a C) but the extension is a cpp file.
>
> I don?t understand why so the questions remains open.
> In shape driver I see .c and all works but I don?t understand the difference.

When I use C code in my gdal drivers I use the CPL_C_START and CPL_C_END
macros, which are defined in port/cpl_port.h

> Thanks!
>
> De: Abel Pau <a.pau at creaf.uab.cat>
> Enviado el: dimecres, 19 de juliol de 2023 10:31
> Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> Asunto: RE: [gdal-dev] Instructions for a new writing driver?
>
> Hi again,
>
> I have a .c file in the makefile added as follow:
> # depends from frmts/aigrid, avc
> add_gdal_driver(
>  TARGET ogr_MiraMon
>  SOURCES ogrmiramondatasource.cpp ogrmiramondriver.cpp ogrmiramonlayer.cpp mmwrlayr.c
>  BUILTIN)
> gdal_standard_includes(ogr_MiraMon)
> target_include_directories(ogr_MiraMon PRIVATE $<TARGET_PROPERTY:ogrsf_generic,SOURCE_DIR>)
>
>
> It makes the .c file appears at the project i VS:
>
> [cid:image001.png at 01D9BA5D.5997B660]
>
> Then I use a function MMReadHeader() in ogrmiramonlayer.cpp but when I try to build an error appears:
>
> ogrmiramonlayer.obj : error LNK2019: unresolved external symbol "int __cdecl MMReadHeader(struct VSIVirtualHandle *,str
> uct MiraMonLayerInfo *,struct MM_TH *)" (?MMReadHeader@@YAHPEAUVSIVirtualHandle@@PEAUMiraMonLayerInfo@@PEAUMM_TH@@@Z) r
> eferenced in function "public: __cdecl OGRMiraMonLayer::OGRMiraMonLayer(char const *,struct VSIVirtualHandle *,class OG
> RSpatialReference const *,int)" (??0OGRMiraMonLayer@@QEAA at PEBDPEAUVSIVirtualHandle@@PEBVOGRSpatialReference@@H at Z) [D:\G
> itHub-repository\GDAL\build\GDAL.vcxproj]
>    Hint on symbols that are defined and could potentially match:
>      MMReadHeader
> D:\GitHub-repository\GDAL\build\Debug\gdald.dll : fatal error LNK1120: 1 unresolved externals [D:\GitHub-repository\GDA
> L\build\GDAL.vcxproj]
>
> I understand that I have to add the .c file un a library and I try to do it in the makefile:
>
> # miramonlib
> if (GDAL_USE_MIRAMONLIB_INTERNAL)
>  # ogrmiramon.h miramonfil.h mmwrlayr.c
>  add_library(miramonlib OBJECT mmwrlayr.c)
>  gdal_standard_includes(miramonlib)
>  target_compile_definitions(miramonlib PUBLIC -DSAOffset=vsi_l_offset)
>  target_compile_options(miramonlib PRIVATE ${GDAL_C_WARNING_FLAGS})
>  if (RENAME_INTERNAL_MIRAMONLIB_SYMBOLS)
>    target_compile_definitions(miramonlib PUBLIC -DRENAME_INTERNAL_MIRAMONLIB_SYMBOLS -DSHPAPI_CALL=)
>  endif ()
>  target_compile_definitions(miramonlib PUBLIC -DUSE_CPL)
>  set_property(TARGET miramonlib PROPERTY POSITION_INDEPENDENT_CODE ${GDAL_OBJECT_LIBRARIES_POSITION_INDEPENDENT_CODE})
>  target_sources(${GDAL_LIB_TARGET_NAME} PRIVATE $<TARGET_OBJECTS:miramonlib>)
>  gdal_add_vendored_lib(ogr_MiraMon miramonlib)
> elseif (HAVE_MIRAMONLIB)
>  gdal_target_link_libraries(ogr_MiraMon PRIVATE MIRAMONLIB::miramon)
> endif ()
>
>
> I think that this miramonlib is not included and I don?t know how to do that (cause I thought that in had to be done in the makefile).
>
> Can anyone tell me how to add this .c file to use the functions in it in the .cpp files?
> THANKS ins advance!
>
>
> De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau
> Enviado el: dijous, 6 de juliol de 2023 15:01
> Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> Asunto: Re: [gdal-dev] Instructions for a new writing driver?
>
> Hi again.
> I finally did that and I am happy.
>
> It would be helpful for us to be able to use our C functions to read and write some parts of our format instead of passing all of them to C++.
> I?d like doing that but it?s not possible for the moment convert all our code to C++.
>
> My proposal is use a ogrmiramondatasource.cpp, a ogrmiramondriver.cpp and a ogrmiramonlayer.cpp as all of the projects that are created and add our files from C as necessary.
> The main goal is adding only the necessary ones.
>
> The question: Is this possible? Can I simply add C files and use that functions from C++ files? Or do GDAL prefer doing it in another way?
> Sorry if it is written somewhere else but I couldn?t find it.
>
> Thanks again for your kind help.
>
> De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau
> Enviado el: dimecres, 5 de juliol de 2023 15:13
> Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> Asunto: Re: [gdal-dev] Instructions for a new writing driver?
>
> Thanks you both!
>
>
>
>
> De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Even Rouault
> Enviado el: dimecres, 5 de juliol de 2023 13:59
> Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> Asunto: Re: [gdal-dev] Instructions for a new writing driver?
>
>
> (resending to list)
>
> The CSV driver is actually not that simple to follow since it has tricks to support updates through the OGREditableLayer mechanism. The GMT one (ogr/ogrsf_frmts/gmt) might be a better start for a creation & append only driver. But basically, the only common thing with your own code will be the fact that you have to implement the 2 virtual methods of interest: OGRLayer::CreateField() ,d OGRLayer::ICreateFeature() and declare a few capabilities in OGRLayer::TestCapability()
>
> Unless you want to implement update capabilities (if the format allows it, which is generally not the case for a text based format), it might be simpler to have 2 distinct OGRLayer sub-classes for read-only and write-only operations.
> Even
> Le 05/07/2023 ? 13:21, Lauren?iu Nicola via gdal-dev a ?crit :
> Hi,
>
> I think your best bet would be to take inspiration from an existing driver, like the CSV one (which shouldn't be too different from the hypothetical SPF driver in the docs).
>
> Laurentiu
>
> On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:
>
> Hi, following instructions about creating a new driver I found that
>
> https://gdal.org/tutorials/vector_driver_tut.html
>
>
>
>
>
> But I need to create a driver that can also write from any vector it?s own format.
>
> So, the inverse sense of the html I found.
>
>
>
> There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it?s own format)?
>
> Thanks in advance!
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From neteler at osgeo.org  Wed Jul 19 08:09:00 2023
From: neteler at osgeo.org (Markus Neteler)
Date: Wed, 19 Jul 2023 17:09:00 +0200
Subject: [gdal-dev] GDAL driver plugins on github ?
In-Reply-To: <32d6a0e3-83e5-d219-98cb-31d421328e2c@aitchison.me.uk>
References: <32d6a0e3-83e5-d219-98cb-31d421328e2c@aitchison.me.uk>
Message-ID: <CALFmHhsNMwmyyYrV+u1rvXmHNgdyjtPggeTooXUUY-SaFU6iRw@mail.gmail.com>

Andrew,

On Wed, Jul 19, 2023 at 4:33?PM Andrew C Aitchison
<andrew at aitchison.me.uk> wrote:
> I would like to put a gdal driver on github *as a plugin*.
> Are there any existing gdal drivers, or other projects that
> depend upon gdal, already separately in github that I could
> use as a starting point ?

You may take a look at the GDAL-GRASS GIS driver
(https://gdal.org/drivers/raster/grass.html and
https://gdal.org/drivers/vector/grass.html)

which was moved out of the main GDAL tree some time ago and is managed here:
https://github.com/OSGeo/gdal-grass

Best,
Markus

-- 
Markus Neteler, PhD
https://www.mundialis.de - free data with free software
https://grass.osgeo.org
https://courses.neteler.org/blog

From andrew at aitchison.me.uk  Wed Jul 19 08:55:39 2023
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 19 Jul 2023 16:55:39 +0100 (BST)
Subject: [gdal-dev] GDAL driver plugins on github ?
In-Reply-To: <CALFmHhsNMwmyyYrV+u1rvXmHNgdyjtPggeTooXUUY-SaFU6iRw@mail.gmail.com>
References: <32d6a0e3-83e5-d219-98cb-31d421328e2c@aitchison.me.uk>
 <CALFmHhsNMwmyyYrV+u1rvXmHNgdyjtPggeTooXUUY-SaFU6iRw@mail.gmail.com>
Message-ID: <70d849cc-6ca7-c286-6dc7-64884fd82d64@aitchison.me.uk>

On Wed, 19 Jul 2023, Markus Neteler wrote:

> Andrew,
>
> On Wed, Jul 19, 2023 at 4:33?PM Andrew C Aitchison
> <andrew at aitchison.me.uk> wrote:
>> I would like to put a gdal driver on github *as a plugin*.
>> Are there any existing gdal drivers, or other projects that
>> depend upon gdal, already separately in github that I could
>> use as a starting point ?
>
> You may take a look at the GDAL-GRASS GIS driver
> (https://gdal.org/drivers/raster/grass.html and
> https://gdal.org/drivers/vector/grass.html)
>
> which was moved out of the main GDAL tree some time ago and is managed here:
> https://github.com/OSGeo/gdal-grass

Thanks.

That is a start, though it looks as if it is unix only.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From even.rouault at spatialys.com  Wed Jul 19 09:29:33 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 19 Jul 2023 18:29:33 +0200
Subject: [gdal-dev] GDAL driver plugins on github ?
In-Reply-To: <32d6a0e3-83e5-d219-98cb-31d421328e2c@aitchison.me.uk>
References: <32d6a0e3-83e5-d219-98cb-31d421328e2c@aitchison.me.uk>
Message-ID: <bea05dd2-88b6-9354-3d0f-d1731212e286@spatialys.com>


Le 19/07/2023 ? 16:32, Andrew C Aitchison a ?crit?:
>
> I would like to put a gdal driver on github *as a plugin*.
> Are there any existing gdal drivers, or other projects that
> depend upon gdal, already separately in github that I could
> use as a starting point ?
>
> Any other suggestions as how to do this would be welcomed,
> bearing in mind that if mine is the first, it may be copied
> by future plugins.
Not necessarily meant to be a reference, but 
https://github.com/OSGeo/gdal-extra-drivers/ has a CMake integration for 
plugin drivers
>
> * I have offered another driver as a pull request,
> but Evan found reviewing my code to be overwhelming.

Ah ah, apparently those were my own words, seeing 
https://github.com/OSGeo/gdal/pull/4092 . Well, reviewing a new driver 
for a format you're not familiar with is obviously a significant task, 
that said I did an initial review of it and gave some hints to make it 
progress. For major contributions, some tenacity might be necessary to 
convince grumpy maintainers :-)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Jul 19 10:34:06 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 19 Jul 2023 19:34:06 +0200
Subject: [gdal-dev] reading rat values from GDB raster
In-Reply-To: <3A12926B-C33D-4C25-AC0B-7899057807C8@kyngchaos.com>
References: <ac3c2a88-c628-17f2-eaa3-db25b7949362@spatialys.com>
 <3A12926B-C33D-4C25-AC0B-7899057807C8@kyngchaos.com>
Message-ID: <525abbf8-303f-91db-9dfe-5906ea50fa55@spatialys.com>


Le 19/07/2023 ? 16:26, William Kyngesburye a ?crit?:
> Ah, that works to get the xml rat.  I had converted to tif with Arc before I remembered that GDAL can read gdb rasters now, and got a dbf rat.
>
> I can trim the xml rat down, but I need to leave the value field so it has some way to lookup a cell value in the rat, but identifying a cell (QGIS or gdallocationinfo) still only gives me the cell value not the rat lookup value.

gdallocationinfo doesn't make use of RAT (would be a reasonable 
enhancement). You have to use the API to connect cell values to the 
corresponding entries in the RAT

Recent QGIS versions can use GDAL RAT, but I'm not sure if that's 
connected with the identification functionality

>
> Is there something else I need to do with the rat config?  What about the tableType attribute to GDALRasterAttributeTable? The conversion set "thematic". I tried removing it (like the example in the vrt help page) but that didn't help.

That's just a minor hint about the nature of the RAT, only used by the 
HFA Imagine and KEA drivers


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Jul 19 10:43:01 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 19 Jul 2023 19:43:01 +0200
Subject: [gdal-dev] gdalinfo on large vrt takes a long time
In-Reply-To: <34248BC5-AFF4-41ED-8284-594F49957FA2@kyngchaos.com>
References: <957d08de-a8db-53e7-bc86-889e07e0f0e1@spatialys.com>
 <34248BC5-AFF4-41ED-8284-594F49957FA2@kyngchaos.com>
Message-ID: <76301a42-0b8c-1b42-e913-d5350e12daf2@spatialys.com>


Le 19/07/2023 ? 15:47, William Kyngesburye a ?crit?:
> macos has lldb, once I figured that out, I got:
>
> * thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP
>    * frame #0: 0x00007ff81eefdeb2 libsystem_kernel.dylib`stat$INODE64 + 10
>      frame #1: 0x000000010140c669 GDAL`VSIStatExL + 96
>      frame #2: 0x0000000101699994 GDAL`VRTSimpleSource::GetFileList(char***, int*, int*, _CPLHashSet*) + 118
>      frame #3: 0x000000010169709b GDAL`VRTSourcedRasterBand::GetFileList(char***, int*, int*, _CPLHashSet*) + 71
>      frame #4: 0x00000001016a603c GDAL`VRTDataset::GetFileList() + 114
>      frame #5: 0x0000000101ee40df GDAL`GDALInfo + 543
>      frame #6: 0x0000000100003911 gdalinfo`main + 914
>      frame #7: 0x000000010001552e dyld`start + 462
>
> It looks like just getting the file list touches the files to make sure they exist?

Indeed. I assume the rationale is to distinguish real file names from 
subdataset names which aren't files. I've captured this in 
https://github.com/OSGeo/gdal/issues/7261#issuecomment-1642494885

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Jul 19 11:28:19 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 19 Jul 2023 20:28:19 +0200
Subject: [gdal-dev] Fwd: [Qgis-psc] European CRA and its implications
In-Reply-To: <CAB2ZMRCjxBVm-_ziXTPXx-VUvMdNiuHqgKbTLYE9EeqANhYpXw@mail.gmail.com>
References: <CAB2ZMRCjxBVm-_ziXTPXx-VUvMdNiuHqgKbTLYE9EeqANhYpXw@mail.gmail.com>
Message-ID: <9d0de89d-7ddb-ad2d-4a0e-bd8799ebad35@spatialys.com>

Hi,

FYI: relaying the following exchanges about the topic of the Cyber 
Resilience Act which is in development in the EU and has strong and 
worrying implications for all open source software distributed in Europe 
and/or with European contributors. Cf 
https://en.wikipedia.org/wiki/Cyber_Resilience_Act for an intro on the topic

Even


-------- Message transf?r? --------
Sujet?: 	Re: [Qgis-psc] European CRA and its implications
Date?: 	Wed, 19 Jul 2023 10:40:12 +0200
De?: 	Marco Bernasocchi via QGIS-PSC <qgis-psc at lists.osgeo.org>
R?pondre ??: 	Marco Bernasocchi <marco at qgis.org>
Pour?: 	Andreas Neumann <andreas at qgis.org>
Copie ??: 	QGIS PSC List <qgis-psc at lists.osgeo.org>



Hi Andreas, I understand that sentence also for paid developments. If a 
client asks OPENGIS.ch (or any other company) to add an new QGIS 
feature, for us it is a commercial activity. so that formulation is 
really tricky.

I escalated already to OSGeo.

Marco Bernasocchi

QGIS.org Chair
OSGeo.org Board member
OPENGIS.ch CEO

On Wed, 19 Jul 2023, 10:32 Andreas Neumann, <andreas at qgis.org> wrote:

    Hi again,

    Here is an excerpt from the proposed regulation (source
    https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:52022PC0454 ):

    /*(10) " In order not to hamper innovation or research, free and
    open-source software developed or supplied outside the course of a
    commercial activityshould not be covered by this Regulation. This
    isin particular the case for software, including its source code and
    modified versions, that is openly shared and freely accessible,
    usable, modifiable and redistributable. In the context of software,
    a commercial activity might be characterized not only by charging a
    price for a product, but also by charging a price for technical
    support services, by providing a software platform through which the
    manufacturer monetises other services, orby the use of personal data
    for reasons other than exclusively for improving the security,
    compatibility or interoperability of the software." */

    So it seems to be primarily an issue for companies selling
    "technical support" around Open Source software - and not so much
    for the project itself.

    Of course, these companies are very important for the QGIS and OSGeo
    ecosystem - and therefore PSC should make an effort here as well.

    Andreas


    On Wed, 19 Jul 2023 at 10:25, Andreas Neumann <andreas at qgis.org> wrote:

        Hi,

        I wasn't aware about it - ideally, our umbrella organizations
        (OSGeo, FOSSGIS e.V. or counterparts in other countries, in
        Switzerland maybe CH-Open) could react - and not all of the
        individual projects separately.

        Of course, we can do our part to support the umbrella
        organization - and maybe the more "user visible" and popular
        projects (like QGIS, PostGIS, GeoServer, MapServer, OpenLayers,
        etc.) could use their visibility to support the efforts of the
        umbrella organizations - but it should be somehow coordinated.

        You, Marco, can discuss this with OSGeo - this is the link to
        the "steering committee" of FOSSGIS:
        https://fossgis.de/verein/vorstand/

        Andreas

        On Wed, 19 Jul 2023 at 10:06, Marco Bernasocchi via QGIS-PSC
        <qgis-psc at lists.osgeo.org> wrote:

            Hi Vincent,
            thanks a lot for the link. I had honestly missed this.

            does not look good at all.
            I ve also shared thid with the OSGeo board.

            and will discuss with the psc what we?can do.

            cheers

            Marco Bernasocchi

            QGIS.org Chair
            OSGeo.org Board member
            OPENGIS.ch CEO

            On Wed, 19 Jul 2023, 09:45 Vincent Picavet (ml) via
            QGIS-PSC, <qgis-psc at lists.osgeo.org> wrote:

                Hi PSC,

                Should you not be aware already, there is an existential
                and urgent risk on the OpenSource ecosystem coming from
                the European commission, through the CRA text :

                https://eclipse-foundation.blog/2023/02/23/cyber-resilience-act-good-intentions-and-unintended-consequences/

                Mozilla has already taken action, and publicly reacted
                also. So did a few other opensource organizations.

                Given the strong impact it may have on the OpenSource
                world, I think QGIS.org should :
                - make a public announcement / blog article / press release
                - directly contact MEPs to communicate about the
                problems raised by the current version of the text
                - coordinate with other OpenSource organization for actions
                - optionnaly, make some stronger actions ( e.g. close
                QGIS downloads as filezilla does, display a message on
                the web site, display a message on QGIS start window...)

                The ITRE commission is supposed to meet today, this is
                therefore an urgent matter. The longer we wait, the more
                difficult it will be to reestablish the text to an
                acceptable version.

                Best regards,

                Vincent
                _______________________________________________
                QGIS-PSC mailing list
                QGIS-PSC at lists.osgeo.org
                https://lists.osgeo.org/mailman/listinfo/qgis-psc

            _______________________________________________
            QGIS-PSC mailing list
            QGIS-PSC at lists.osgeo.org
            https://lists.osgeo.org/mailman/listinfo/qgis-psc



        -- 

        --
        Andreas Neumann
        QGIS.ORG <http://QGIS.ORG> board member (treasurer)



    -- 

    --
    Andreas Neumann
    QGIS.ORG <http://QGIS.ORG> board member (treasurer)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230719/d203b6cf/attachment.htm>
-------------- next part --------------
_______________________________________________
QGIS-PSC mailing list
QGIS-PSC at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/qgis-psc


From andrew at aitchison.me.uk  Wed Jul 19 12:15:08 2023
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 19 Jul 2023 20:15:08 +0100 (BST)
Subject: [gdal-dev] GDAL driver plugins on github ?
In-Reply-To: <bea05dd2-88b6-9354-3d0f-d1731212e286@spatialys.com>
References: <32d6a0e3-83e5-d219-98cb-31d421328e2c@aitchison.me.uk>
 <bea05dd2-88b6-9354-3d0f-d1731212e286@spatialys.com>
Message-ID: <acfabcb9-d5f7-1f28-01f5-618efaa1b77a@aitchison.me.uk>

On Wed, 19 Jul 2023, Even Rouault wrote:


> Le 19/07/2023 ? 16:32, Andrew C Aitchison a ?crit?:
>> * I have offered another driver as a pull request,
>> but Evan found reviewing my code to be overwhelming.
>
> Ah ah, apparently those were my own words, seeing 
> https://github.com/OSGeo/gdal/pull/4092 . Well, reviewing a new driver for a 
> format you're not familiar with is obviously a significant task, that said I 
> did an initial review of it and gave some hints to make it progress. For 
> major contributions, some tenacity might be necessary to convince grumpy 
> maintainers :-)

Evan,

*All* your comments were fair and accurate.

Given that the driver is now available on github and the format is
no longer in active use, I felt that the time you would spend reviewing
the code could probably be better spent elsewhere, at least unless and
until I think my code is better quality.

Thank you for the original review.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From a.pau at creaf.uab.cat  Wed Jul 19 23:57:17 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Thu, 20 Jul 2023 06:57:17 +0000
Subject: [gdal-dev] Instructions for a new writing driver?
In-Reply-To: <5495ac10-4eb7-2433-3e6f-289595c21331@aitchison.me.uk>
References: <AS8PR07MB81686ED696A2E01411B1B370A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3317f566-5dd8-4529-84fb-1bdafa876cda@betaapp.fastmail.com>
 <d40513fe-7cd2-79d8-92ac-ebe95a228c3b@spatialys.com>
 <AS8PR07MB81683376589FAAA49E06F1E8A22FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168A1CC15F6151DFC05747DA22CA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168E573C0F87CB28AF225D7A239A@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168B5023F2F41FCEA0F63BDA239A@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <5495ac10-4eb7-2433-3e6f-289595c21331@aitchison.me.uk>
Message-ID: <AS8PR07MB8168072894B39F91ADEE199CA23EA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Thanks Andrew, it worked!

Now it compiles and org2org project also compiles.
Thanks a lot!

-----Mensaje original-----
De: Andrew C Aitchison <andrew at aitchison.me.uk> 
Enviado el: dimecres, 19 de juliol de 2023 16:48
Para: Abel Pau <a.pau at creaf.uab.cat>
CC: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Instructions for a new writing driver?

On Wed, 19 Jul 2023, Abel Pau wrote:

> Hi,
> finally I?ve discovered that the file mmwrlayr.c have to be included as cpp (internally is a C) but the extension is a cpp file.
>
> I don?t understand why so the questions remains open.
> In shape driver I see .c and all works but I don?t understand the difference.

When I use C code in my gdal drivers I use the CPL_C_START and CPL_C_END macros, which are defined in port/cpl_port.h

> Thanks!
>
> De: Abel Pau <a.pau at creaf.uab.cat>
> Enviado el: dimecres, 19 de juliol de 2023 10:31
> Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> Asunto: RE: [gdal-dev] Instructions for a new writing driver?
>
> Hi again,
>
> I have a .c file in the makefile added as follow:
> # depends from frmts/aigrid, avc
> add_gdal_driver(
>  TARGET ogr_MiraMon
>  SOURCES ogrmiramondatasource.cpp ogrmiramondriver.cpp 
> ogrmiramonlayer.cpp mmwrlayr.c
>  BUILTIN)
> gdal_standard_includes(ogr_MiraMon)
> target_include_directories(ogr_MiraMon PRIVATE 
> $<TARGET_PROPERTY:ogrsf_generic,SOURCE_DIR>)
>
>
> It makes the .c file appears at the project i VS:
>
> [cid:image001.png at 01D9BA5D.5997B660]
>
> Then I use a function MMReadHeader() in ogrmiramonlayer.cpp but when I try to build an error appears:
>
> ogrmiramonlayer.obj : error LNK2019: unresolved external symbol "int 
> __cdecl MMReadHeader(struct VSIVirtualHandle *,str uct 
> MiraMonLayerInfo *,struct MM_TH *)" 
> (?MMReadHeader@@YAHPEAUVSIVirtualHandle@@PEAUMiraMonLayerInfo@@PEAUMM_
> TH@@@Z) r eferenced in function "public: __cdecl OGRMiraMonLayer::OGRMiraMonLayer(char const *,struct VSIVirtualHandle *,class OG RSpatialReference const *,int)" (??0OGRMiraMonLayer@@QEAA at PEBDPEAUVSIVirtualHandle@@PEBVOGRSpatialReference@@H at Z) [D:\G itHub-repository\GDAL\build\GDAL.vcxproj]
>    Hint on symbols that are defined and could potentially match:
>      MMReadHeader
> D:\GitHub-repository\GDAL\build\Debug\gdald.dll : fatal error LNK1120: 
> 1 unresolved externals [D:\GitHub-repository\GDA L\build\GDAL.vcxproj]
>
> I understand that I have to add the .c file un a library and I try to do it in the makefile:
>
> # miramonlib
> if (GDAL_USE_MIRAMONLIB_INTERNAL)
>  # ogrmiramon.h miramonfil.h mmwrlayr.c  add_library(miramonlib OBJECT 
> mmwrlayr.c)
>  gdal_standard_includes(miramonlib)
>  target_compile_definitions(miramonlib PUBLIC -DSAOffset=vsi_l_offset)  
> target_compile_options(miramonlib PRIVATE ${GDAL_C_WARNING_FLAGS})  if 
> (RENAME_INTERNAL_MIRAMONLIB_SYMBOLS)
>    target_compile_definitions(miramonlib PUBLIC 
> -DRENAME_INTERNAL_MIRAMONLIB_SYMBOLS -DSHPAPI_CALL=)  endif ()  
> target_compile_definitions(miramonlib PUBLIC -DUSE_CPL)  
> set_property(TARGET miramonlib PROPERTY POSITION_INDEPENDENT_CODE 
> ${GDAL_OBJECT_LIBRARIES_POSITION_INDEPENDENT_CODE})
>  target_sources(${GDAL_LIB_TARGET_NAME} PRIVATE 
> $<TARGET_OBJECTS:miramonlib>)  gdal_add_vendored_lib(ogr_MiraMon 
> miramonlib) elseif (HAVE_MIRAMONLIB)  
> gdal_target_link_libraries(ogr_MiraMon PRIVATE MIRAMONLIB::miramon) 
> endif ()
>
>
> I think that this miramonlib is not included and I don?t know how to do that (cause I thought that in had to be done in the makefile).
>
> Can anyone tell me how to add this .c file to use the functions in it in the .cpp files?
> THANKS ins advance!
>
>
> De: gdal-dev 
> <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.
> org>> En nombre de Abel Pau Enviado el: dijous, 6 de juliol de 2023 
> 15:01
> Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> Asunto: Re: [gdal-dev] Instructions for a new writing driver?
>
> Hi again.
> I finally did that and I am happy.
>
> It would be helpful for us to be able to use our C functions to read and write some parts of our format instead of passing all of them to C++.
> I?d like doing that but it?s not possible for the moment convert all our code to C++.
>
> My proposal is use a ogrmiramondatasource.cpp, a ogrmiramondriver.cpp and a ogrmiramonlayer.cpp as all of the projects that are created and add our files from C as necessary.
> The main goal is adding only the necessary ones.
>
> The question: Is this possible? Can I simply add C files and use that functions from C++ files? Or do GDAL prefer doing it in another way?
> Sorry if it is written somewhere else but I couldn?t find it.
>
> Thanks again for your kind help.
>
> De: gdal-dev 
> <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.
> org>> En nombre de Abel Pau Enviado el: dimecres, 5 de juliol de 2023 
> 15:13
> Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> Asunto: Re: [gdal-dev] Instructions for a new writing driver?
>
> Thanks you both!
>
>
>
>
> De: gdal-dev 
> <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.
> org>> En nombre de Even Rouault Enviado el: dimecres, 5 de juliol de 
> 2023 13:59
> Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> Asunto: Re: [gdal-dev] Instructions for a new writing driver?
>
>
> (resending to list)
>
> The CSV driver is actually not that simple to follow since it has 
> tricks to support updates through the OGREditableLayer mechanism. The 
> GMT one (ogr/ogrsf_frmts/gmt) might be a better start for a creation & 
> append only driver. But basically, the only common thing with your own 
> code will be the fact that you have to implement the 2 virtual methods 
> of interest: OGRLayer::CreateField() ,d OGRLayer::ICreateFeature() and 
> declare a few capabilities in OGRLayer::TestCapability()
>
> Unless you want to implement update capabilities (if the format allows it, which is generally not the case for a text based format), it might be simpler to have 2 distinct OGRLayer sub-classes for read-only and write-only operations.
> Even
> Le 05/07/2023 ? 13:21, Lauren?iu Nicola via gdal-dev a ?crit :
> Hi,
>
> I think your best bet would be to take inspiration from an existing driver, like the CSV one (which shouldn't be too different from the hypothetical SPF driver in the docs).
>
> Laurentiu
>
> On Wed, Jul 5, 2023, at 14:17, Abel Pau wrote:
>
> Hi, following instructions about creating a new driver I found that
>
> https://gdal.org/tutorials/vector_driver_tut.html
>
>
>
>
>
> But I need to create a driver that can also write from any vector it?s own format.
>
> So, the inverse sense of the html I found.
>
>
>
> There is any other place I can follow any instructions to fill all function classes to create this part of the driver (the one that writes it?s own format)?
>
> Thanks in advance!
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From b.coerver at mailbox.org  Thu Jul 20 00:59:58 2023
From: b.coerver at mailbox.org (b.coerver at mailbox.org)
Date: Thu, 20 Jul 2023 09:59:58 +0200
Subject: [gdal-dev] /vsis3/ on NetCDF from Earthdata
Message-ID: <69C83C86-2257-5245-94C6-FF0C220C778E@hxcore.ol>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230720/14246549/attachment-0001.htm>

From breuil at craig.fr  Thu Jul 20 01:43:38 2023
From: breuil at craig.fr (Landry Breuil)
Date: Thu, 20 Jul 2023 10:43:38 +0200
Subject: [gdal-dev] libgdaljni.so installed in the wrong dir by default?
Message-ID: <fb2bb590-f8df-3c65-fe66-db231be7d292@craig.fr>

Hi,

working on debian and trying to reenable the libgdal-java package for 
geoserver needs, i've figured out that since the switch to cmake, the 
jars and the libgdalalljni.so files are now all installed in 
GDAL_JAVA_INSTALL_DIR (which defaults to /usr/share/java).

previously with the autoconf-based builds, the jars went to 
usr/share/java, and the libgdal*jni.so to usr/lib (then moved to 
usr/lib/jni on debian).

was it an oversight ? it feels 'wrong' to have shared libs in 
usr/share/java..

-- 
Landry Breuil

From sebastic at xs4all.nl  Thu Jul 20 01:55:36 2023
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Thu, 20 Jul 2023 10:55:36 +0200
Subject: [gdal-dev] libgdaljni.so installed in the wrong dir by default?
In-Reply-To: <fb2bb590-f8df-3c65-fe66-db231be7d292@craig.fr>
References: <fb2bb590-f8df-3c65-fe66-db231be7d292@craig.fr>
Message-ID: <c9b0db4b-729b-17dd-3cf4-b1324d8d2a1d@xs4all.nl>

The Debian package moved the files to their policy compliant paths:

 
https://salsa.debian.org/debian-gis-team/gdal/-/commit/936e50e1a9e5eb3d1bd10147b5d5c25476845b23#8756c63497c8dc39f7773438edf53b220c773f67_198_195

Kind Regards,

Bas

-- 
  GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1


From even.rouault at spatialys.com  Thu Jul 20 02:43:59 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 20 Jul 2023 11:43:59 +0200
Subject: [gdal-dev] /vsis3/ on NetCDF from Earthdata
In-Reply-To: <69C83C86-2257-5245-94C6-FF0C220C778E@hxcore.ol>
References: <69C83C86-2257-5245-94C6-FF0C220C778E@hxcore.ol>
Message-ID: <5ee6ff23-9368-0854-f818-3c113dea0380@spatialys.com>

Bert,

Also set the GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR config option, 
otherwise the generic open mechanism of GDAL tries to list the content 
of the VNP02IMG/ directory and it seems there are tons of files there

When doing that, I get a result within a few seconds

Even

Le 20/07/2023 ? 09:59, b.coerver--- via gdal-dev a ?crit?:
>
> Hello,
>
> I'm trying to access data from NASA's Earthdata S3 buckets, but I get 
> a `"<filename> does not exist in the file system, and is not 
> recognized as a supported dataset name."` error after waiting a long 
> time (? 50 minutes, the process is downloading some data the whole 
> time) doing the following:
>
> from osgeo import gdal
>
> gdal_config_options = {
>
> "AWS_ACCESS_KEY_ID": creds["accessKeyId"],
>
> "AWS_SESSION_TOKEN":? creds["sessionToken"],
>
> "AWS_SECRET_ACCESS_KEY": creds["secretAccessKey"],
>
> "AWS_REGION": "us-west-2",
>
> }
>
> url = 
> "/vsis3/prod-lads/VNP02IMG/VNP02IMG.A2023193.1942.002.2023194025636.nc"
>
> for k, v in gdal_config_options.items():
>
> gdal.SetConfigOption(k, v)
>
> out =gdal.Info(url)
>
> The `creds` variable is a dictionary with temporary credential 
> information that I get from 
> [here](https://data.laadsdaac.earthdatacloud.nasa.gov/s3credentials 
> <https://data.laadsdaac.earthdatacloud.nasa.gov/s3credentials>), you 
> need a free account to get them.
>
> When I introduce an error in one of the keys/tokens (e.g. 
> `"AWS_ACCESS_KEY_ID": creds["accessKeyId"] + "x"`, I do get a message 
> immediately saying my credentials are unknown. So I do think they are 
> being ingested correctly. I?m using GDAL version 3.7.1.
>
> I also managed to download the entire file using `boto3`, by doing the 
> following:
>
> import boto3
>
> client = boto3.client(
>
> 's3',
>
> aws_access_key_id=creds["accessKeyId"],
>
> aws_secret_access_key=creds["secretAccessKey"],
>
> aws_session_token=creds["sessionToken"]
>
> )
>
> ????client.download_file('prod-lads', 
> 'VNP02IMG/VNP02IMG.A2023193.1942.002.2023194025636.nc', 'test.nc')
>
> Any ideas what I'm doing wrong or how to make this work? In the end 
> I'm interested in accessing the files metadata without downloading the 
> entire file.
>
> Regards,
>
> Bert
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230720/48f31f28/attachment.htm>

From b.coerver at mailbox.org  Thu Jul 20 02:51:04 2023
From: b.coerver at mailbox.org (b.coerver at mailbox.org)
Date: Thu, 20 Jul 2023 11:51:04 +0200
Subject: [gdal-dev] /vsis3/ on NetCDF from Earthdata
In-Reply-To: <5ee6ff23-9368-0854-f818-3c113dea0380@spatialys.com>
References: <69C83C86-2257-5245-94C6-FF0C220C778E@hxcore.ol>,
 <5ee6ff23-9368-0854-f818-3c113dea0380@spatialys.com>
Message-ID: <5B40B60E-3E34-4340-87F8-FFF85590E206@hxcore.ol>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230720/03801811/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Jul 20 03:15:18 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 20 Jul 2023 12:15:18 +0200
Subject: [gdal-dev] libgdaljni.so installed in the wrong dir by default?
In-Reply-To: <fb2bb590-f8df-3c65-fe66-db231be7d292@craig.fr>
References: <fb2bb590-f8df-3c65-fe66-db231be7d292@craig.fr>
Message-ID: <181dea8c-2b3b-6114-8560-3d3426ef0d8b@spatialys.com>

Hi,

Proposed change: https://github.com/OSGeo/gdal/pull/8125

Even

Le 20/07/2023 ? 10:43, Landry Breuil a ?crit?:
> Hi,
>
> working on debian and trying to reenable the libgdal-java package for 
> geoserver needs, i've figured out that since the switch to cmake, the 
> jars and the libgdalalljni.so files are now all installed in 
> GDAL_JAVA_INSTALL_DIR (which defaults to /usr/share/java).
>
> previously with the autoconf-based builds, the jars went to 
> usr/share/java, and the libgdal*jni.so to usr/lib (then moved to 
> usr/lib/jni on debian).
>
> was it an oversight ? it feels 'wrong' to have shared libs in 
> usr/share/java..
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From aborruso at gmail.com  Thu Jul 20 04:09:05 2023
From: aborruso at gmail.com (andy)
Date: Thu, 20 Jul 2023 13:09:05 +0200
Subject: [gdal-dev] Is there a native gdal way to download stac items from
 Microsoft planetary
Message-ID: <CAHEdGZOthrp-Gfd36pcUN=2jMp5mV0UZbU1Th2aYL7Khc0OLwQ@mail.gmail.com>

Hi,
I would like to download this stac item
<https://planetarycomputer.microsoft.com/api/stac/v1/collections/ms-buildings/items/KingdomofSaudiArabia_123022032_2023-04-25>
.

The Azure Blob File System href is
"abfs://footprints/delta/2023-04-25/ml-buildings.parquet/RegionName=KingdomofSaudiArabia/quadkey=123022032",
but I do not understand if it's possible to download it, using GDAL and if
yes, how to do it?

I have read this related discussion
<https://github.com/opengeospatial/geoparquet/discussions/101>, but i don't
find the way for how to use it for my task.

Do you have any suggestions?

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230720/cb9e3544/attachment.htm>

From steve.nigus at flightsafety.com  Thu Jul 20 09:18:28 2023
From: steve.nigus at flightsafety.com (Nigus, Steve)
Date: Thu, 20 Jul 2023 16:18:28 +0000
Subject: [gdal-dev] NITF geotransform data erratic
Message-ID: <SJ0PR09MB95714122200B65A3687E5026883EA@SJ0PR09MB9571.namprd09.prod.outlook.com>

I am doing a real-time SAR spot simulation where the SAR orbits a target point and saves a series of the georeferenced spot image files.  My initial implementation generated non-GDAL GeoTIFF or JPEG files.  I use a least-squares algorithm to develop the 6 affine geotransform values.  This all works fine, and the files display nicely in my GIS viewer.   I have since brought in GDAL 2.2.3 to create NITF files.  Unfortunately, over 30% of the NITF files lose the geotransform info.  Rather, they show generic GCPs.  The "good" NITF files display OK in my GIS viewer.  As a sanity test, I took a series of non-GDAL GeoTIFF files and ran them through gdal_translate to NITF.  Interestingly, around 30% of the NITF files again dropped the geotransform data.  I've attached below gdalinfo reports of a gdal_translate input GeoTIFF file and the output NITF file for a failing example.  My geotransform data appears to be well-behaved.  Question:  What could cause geotransform data to be rejected?  Thanks.....


Non-GDAL gdal_translate input GeoTIFF file:

$ gdalinfo sar2023071722525322.tif
Driver: GTiff/GeoTIFF
Files: sar2023071722525322.tif
Size is 1024, 1024
Coordinate System is:
PROJCS["VITAL SAR Simulation",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0],
        UNIT["degree",0.0174532925199433],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",-81],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]]]
GeoTransform =
  586659.1336352756, -0.2027675805429681, -0.2274441341933198
  2969181.096499263, -0.2274441341933198, 0.2027675805429681
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (  586659.134, 2969181.096) ( 80d 7'40.06"W, 26d50'29.50"N)
Lower Left  (  586426.231, 2969388.731) ( 80d 7'48.44"W, 26d50'36.30"N)
Upper Right (  586451.500, 2968948.194) ( 80d 7'47.64"W, 26d50'21.98"N)
Lower Right (  586218.597, 2969155.828) ( 80d 7'56.02"W, 26d50'28.78"N)
Center      (  586438.865, 2969168.462) ( 80d 7'48.04"W, 26d50'29.14"N)
Band 1 Block=1024x8 Type=Byte, ColorInterp=Gray

gdal_translate output NITF file:

$ gdalinfo sar2023071722525322.nitf
Driver: NITF/National Imagery Transmission Format
Files: sar2023071722525322.nitf
Size is 1024, 1024
Coordinate System is `'
GCP Projection =
PROJCS["UTM Zone 17, Northern Hemisphere",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",-81],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["Meter",1]]
GCP[  0]: Id=UpperLeft, Info=
          (0.5,0.5) -> (586659,2969181,0)
GCP[  1]: Id=UpperRight, Info=
          (1023.5,0.5) -> (586451,2968948,0)
GCP[  2]: Id=LowerRight, Info=
          (1023.5,1023.5) -> (586219,2969156,0)
GCP[  3]: Id=LowerLeft, Info=
          (0.5,1023.5) -> (586426,2969389,0)
Metadata:
  NITF_ABPP=08
  NITF_CCS_COLUMN=0
  NITF_CCS_ROW=0
  NITF_CLEVEL=03
  NITF_ENCRYP=0
  NITF_FBKGC=  0,  0,  0
  NITF_FDT=20021216151629
  NITF_FHDR=NITF02.10
  NITF_FSCATP=
  NITF_FSCAUT=
  NITF_FSCLAS=U
  NITF_FSCLSY=
  NITF_FSCLTX=
  NITF_FSCODE=
  NITF_FSCOP=00000
  NITF_FSCPYS=00000
  NITF_FSCRSN=
  NITF_FSCTLH=
  NITF_FSCTLN=
  NITF_FSDCDT=
  NITF_FSDCTP=
  NITF_FSDCXM=
  NITF_FSDG=
NITF_FSDGDT=
  NITF_FSREL=
  NITF_FSSRDT=
  NITF_FTITLE=
  NITF_IALVL=0
  NITF_IC=NC
  NITF_ICAT=VIS
  NITF_ICORDS=N
  NITF_IDATIM=20021216151629
  NITF_IDLVL=1
  NITF_IGEOLO=175866592969181175864512968948175862192969156175864262969389
  NITF_IID1=Missing
  NITF_IID2=
  NITF_ILOC_COLUMN=0
  NITF_ILOC_ROW=0
  NITF_IMAG=1.0
  NITF_IMODE=B
  NITF_IREP=MONO
  NITF_ISCATP=
  NITF_ISCAUT=
  NITF_ISCLAS=U
  NITF_ISCLSY=
  NITF_ISCLTX=
  NITF_ISCODE=
  NITF_ISCRSN=
  NITF_ISCTLH=
  NITF_ISCTLN=
  NITF_ISDCDT=
  NITF_ISDCTP=
  NITF_ISDCXM=
  NITF_ISDG=
  NITF_ISDGDT=
  NITF_ISORCE=Unknown
  NITF_ISREL=
  NITF_ISSRDT=
  NITF_ONAME=
  NITF_OPHONE=
  NITF_OSTAID=GDAL
  NITF_PJUST=R
  NITF_PVTYPE=INT
  NITF_STYPE=BF01
  NITF_TGTID=
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0, 1024.0)
Upper Right ( 1024.0,    0.0)
Lower Right ( 1024.0, 1024.0)
Center      (  512.0,  512.0)
Band 1 Block=1024x1 Type=Byte, ColorInterp=Gray


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230720/b9a8dc52/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Jul 20 09:45:25 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 20 Jul 2023 18:45:25 +0200
Subject: [gdal-dev] NITF geotransform data erratic
In-Reply-To: <SJ0PR09MB95714122200B65A3687E5026883EA@SJ0PR09MB9571.namprd09.prod.outlook.com>
References: <SJ0PR09MB95714122200B65A3687E5026883EA@SJ0PR09MB9571.namprd09.prod.outlook.com>
Message-ID: <56fd553a-109c-c60b-2145-c745546b056d@spatialys.com>

NITF base georeferencing using the IGEOLO field sucks because there's 
not enough decimal digits to compute the full accuracy of a 
geotransform, and thus when GDAL tries to reconstruct the geotransform 
from the 4 corners (that's how georeferencing is stored), the threshold 
to detect if the computed affine geotransform isn't always met.

I thought that a workaround would be to write the SDE TREs 
(GEOPSB/PRJPSB and MAPLOB). There's a SDE_TRE=YES creation option for 
that, but its implementation on the writing side is limited to 
geographic coordinates, not projected ones (could potentially be 
extended). So if you want to go with that route, you'll have to compose 
the content of the TREs by yourself from the NITF spec, which is a non 
trivial exercice. But actually, I'm wrong. MAPLOB cannot capture 
rotating terms of a geotransform.

On the reading side, you can try to set the 
GDAL_GCPS_TO_GEOTRANSFORM_APPROX_OK config option to a value larger than 
the 0.25 pixel default value. cf 
https://gdal.org/api/raster_c_api.html#_CPPv422GDALGCPsToGeoTransformiPK8GDAL_GCPPdi

Even

Le 20/07/2023 ? 18:18, Nigus, Steve a ?crit?:
>
> I am doing a real-time SAR spot simulation where the SAR orbits a 
> target point and saves a series of the georeferenced spot image 
> files.? My initial implementation generated non-GDAL GeoTIFF or JPEG 
> files.? I use a least-squares algorithm to develop the 6 affine 
> geotransform values.? This all works fine, and the files display 
> nicely in my GIS viewer. ??I have since brought in GDAL 2.2.3 to 
> create NITF files.? Unfortunately, over 30% of the NITF files lose the 
> geotransform info.? Rather, they show generic GCPs.? The ?good? NITF 
> files display OK in my GIS viewer.? As a sanity test, I took a series 
> of non-GDAL GeoTIFF files and ran them through gdal_translate to 
> NITF.? Interestingly, around 30% of the NITF files again dropped the 
> geotransform data.? I?ve attached below gdalinfo reports of a 
> gdal_translate input GeoTIFF file and the output NITF file for a 
> failing example. My geotransform data appears to be well-behaved.? 
> Question: What could cause geotransform data to be rejected?? Thanks?..
>
> Non-GDAL gdal_translate input GeoTIFF file:
>
> $ gdalinfo sar2023071722525322.tif
>
> Driver: GTiff/GeoTIFF
>
> Files: sar2023071722525322.tif
>
> Size is 1024, 1024
>
> Coordinate System is:
>
> PROJCS["VITAL SAR Simulation",
>
> ??? GEOGCS["WGS 84",
>
> DATUM["WGS_1984",
>
> SPHEROID["WGS 84",6378137,298.257223563,
>
> AUTHORITY["EPSG","7030"]],
>
> AUTHORITY["EPSG","6326"]],
>
> PRIMEM["Greenwich",0],
>
> UNIT["degree",0.0174532925199433],
>
> AUTHORITY["EPSG","4326"]],
>
> PROJECTION["Transverse_Mercator"],
>
> PARAMETER["latitude_of_origin",0],
>
> PARAMETER["central_meridian",-81],
>
> PARAMETER["scale_factor",0.9996],
>
> PARAMETER["false_easting",500000],
>
> PARAMETER["false_northing",0],
>
> UNIT["metre",1,
>
> AUTHORITY["EPSG","9001"]]]
>
> GeoTransform =
>
> 586659.1336352756, -0.2027675805429681, -0.2274441341933198
>
> 2969181.096499263, -0.2274441341933198, 0.2027675805429681
>
> Metadata:
>
> AREA_OR_POINT=Area
>
> Image Structure Metadata:
>
> INTERLEAVE=BAND
>
> Corner Coordinates:
>
> Upper Left? ( 586659.134, 2969181.096) ( 80d 7'40.06"W, 26d50'29.50"N)
>
> Lower Left? ( 586426.231, 2969388.731) ( 80d 7'48.44"W, 26d50'36.30"N)
>
> Upper Right ( 586451.500, 2968948.194) ( 80d 7'47.64"W, 26d50'21.98"N)
>
> Lower Right ( 586218.597, 2969155.828) ( 80d 7'56.02"W, 26d50'28.78"N)
>
> Center????? ( 586438.865, 2969168.462) ( 80d 7'48.04"W, 26d50'29.14"N)
>
> Band 1 Block=1024x8 Type=Byte, ColorInterp=Gray
>
> gdal_translate output NITF file:
>
> $ gdalinfo sar2023071722525322.nitf
>
> Driver: NITF/National Imagery Transmission Format
>
> Files: sar2023071722525322.nitf
>
> Size is 1024, 1024
>
> Coordinate System is `'
>
> GCP Projection =
>
> PROJCS["UTM Zone 17, Northern Hemisphere",
>
> ??? GEOGCS["WGS 84",
>
> DATUM["WGS_1984",
>
> SPHEROID["WGS 84",6378137,298.257223563,
>
> AUTHORITY["EPSG","7030"]],
>
> AUTHORITY["EPSG","6326"]],
>
> PRIMEM["Greenwich",0,
>
> AUTHORITY["EPSG","8901"]],
>
> UNIT["degree",0.0174532925199433,
>
> AUTHORITY["EPSG","9122"]],
>
> AUTHORITY["EPSG","4326"]],
>
> PROJECTION["Transverse_Mercator"],
>
> PARAMETER["latitude_of_origin",0],
>
> PARAMETER["central_meridian",-81],
>
> PARAMETER["scale_factor",0.9996],
>
> PARAMETER["false_easting",500000],
>
> PARAMETER["false_northing",0],
>
> UNIT["Meter",1]]
>
> GCP[? 0]: Id=UpperLeft, Info=
>
> (0.5,0.5) -> (586659,2969181,0)
>
> GCP[? 1]: Id=UpperRight, Info=
>
> (1023.5,0.5) -> (586451,2968948,0)
>
> GCP[? 2]: Id=LowerRight, Info=
>
> (1023.5,1023.5) -> (586219,2969156,0)
>
> GCP[? 3]: Id=LowerLeft, Info=
>
> (0.5,1023.5) -> (586426,2969389,0)
>
> Metadata:
>
> ? NITF_ABPP=08
>
> NITF_CCS_COLUMN=0
>
> NITF_CCS_ROW=0
>
> NITF_CLEVEL=03
>
> ? NITF_ENCRYP=0
>
> ? NITF_FBKGC= 0,? 0,? 0
>
> NITF_FDT=20021216151629
>
> NITF_FHDR=NITF02.10
>
> ? NITF_FSCATP=
>
> ? NITF_FSCAUT=
>
> ? NITF_FSCLAS=U
>
> ? NITF_FSCLSY=
>
> ? NITF_FSCLTX=
>
> ? NITF_FSCODE=
>
> NITF_FSCOP=00000
>
> NITF_FSCPYS=00000
>
> ? NITF_FSCRSN=
>
> ? NITF_FSCTLH=
>
> ? NITF_FSCTLN=
>
> ? NITF_FSDCDT=
>
> ? NITF_FSDCTP=
>
> ? NITF_FSDCXM=
>
> ? NITF_FSDG=
>
> NITF_FSDGDT=
>
> ? NITF_FSREL=
>
> ? NITF_FSSRDT=
>
> ? NITF_FTITLE=
>
> ? NITF_IALVL=0
>
> ? NITF_IC=NC
>
> ? NITF_ICAT=VIS
>
> ? NITF_ICORDS=N
>
> NITF_IDATIM=20021216151629
>
> ? NITF_IDLVL=1
>
> NITF_IGEOLO=175866592969181175864512968948175862192969156175864262969389
>
> NITF_IID1=Missing
>
> ? NITF_IID2=
>
> NITF_ILOC_COLUMN=0
>
> NITF_ILOC_ROW=0
>
> ? NITF_IMAG=1.0
>
> ? NITF_IMODE=B
>
> NITF_IREP=MONO
>
> ? NITF_ISCATP=
>
> ? NITF_ISCAUT=
>
> ? NITF_ISCLAS=U
>
> ? NITF_ISCLSY=
>
> ? NITF_ISCLTX=
>
> ? NITF_ISCODE=
>
> ? NITF_ISCRSN=
>
> ? NITF_ISCTLH=
>
> ? NITF_ISCTLN=
>
> ? NITF_ISDCDT=
>
> ? NITF_ISDCTP=
>
> ? NITF_ISDCXM=
>
> ? NITF_ISDG=
>
> ? NITF_ISDGDT=
>
> NITF_ISORCE=Unknown
>
> ? NITF_ISREL=
>
> ? NITF_ISSRDT=
>
> ? NITF_ONAME=
>
> ? NITF_OPHONE=
>
> NITF_OSTAID=GDAL
>
> ? NITF_PJUST=R
>
> NITF_PVTYPE=INT
>
> NITF_STYPE=BF01
>
> ? NITF_TGTID=
>
> Corner Coordinates:
>
> Upper Left (??? 0.0,??? 0.0)
>
> Lower Left? ( ???0.0, 1024.0)
>
> Upper Right ( 1024.0,??? 0.0)
>
> Lower Right ( 1024.0, 1024.0)
>
> Center????? ( 512.0,? 512.0)
>
> Band 1 Block=1024x1 Type=Byte, ColorInterp=Gray
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230720/bf1a3681/attachment-0001.htm>

From steve.nigus at flightsafety.com  Thu Jul 20 13:00:51 2023
From: steve.nigus at flightsafety.com (Nigus, Steve)
Date: Thu, 20 Jul 2023 20:00:51 +0000
Subject: [gdal-dev] NITF geotransform data erratic
In-Reply-To: <56fd553a-109c-c60b-2145-c745546b056d@spatialys.com>
References: <SJ0PR09MB95714122200B65A3687E5026883EA@SJ0PR09MB9571.namprd09.prod.outlook.com>
 <56fd553a-109c-c60b-2145-c745546b056d@spatialys.com>
Message-ID: <SJ0PR09MB9571B57760FA6BE7F6129E1F883EA@SJ0PR09MB9571.namprd09.prod.outlook.com>

Thank you for the quick, helpful response.  Sounds like I need to dig into the NITF spec to determine how to best use the available precision.  Thanks again.

From: Even Rouault <even.rouault at spatialys.com>
Sent: Thursday, July 20, 2023 11:45 AM
To: Nigus, Steve <steve.nigus at flightsafety.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] NITF geotransform data erratic

CAUTION EXTERNAL EMAIL: Verify sender, links, and attachments are safe before taking action.



NITF base georeferencing using the IGEOLO field sucks because there's not enough decimal digits to compute the full accuracy of a geotransform, and thus when GDAL tries to reconstruct the geotransform from the 4 corners (that's how georeferencing is stored), the threshold to detect if the computed affine geotransform isn't always met.

I thought that a workaround would be to write the SDE TREs (GEOPSB/PRJPSB and MAPLOB). There's a SDE_TRE=YES creation option for that, but its implementation on the writing side is limited to geographic coordinates, not projected ones (could potentially be extended). So if you want to go with that route, you'll have to compose the content of the TREs by yourself from the NITF spec, which is a non trivial exercice. But actually, I'm wrong. MAPLOB cannot capture rotating terms of a geotransform.

On the reading side, you can try to set the GDAL_GCPS_TO_GEOTRANSFORM_APPROX_OK config option to a value larger than the 0.25 pixel default value. cf https://gdal.org/api/raster_c_api.html#_CPPv422GDALGCPsToGeoTransformiPK8GDAL_GCPPdi

Even
Le 20/07/2023 ? 18:18, Nigus, Steve a ?crit :
I am doing a real-time SAR spot simulation where the SAR orbits a target point and saves a series of the georeferenced spot image files.  My initial implementation generated non-GDAL GeoTIFF or JPEG files.  I use a least-squares algorithm to develop the 6 affine geotransform values.  This all works fine, and the files display nicely in my GIS viewer.   I have since brought in GDAL 2.2.3 to create NITF files.  Unfortunately, over 30% of the NITF files lose the geotransform info.  Rather, they show generic GCPs.  The ?good? NITF files display OK in my GIS viewer.  As a sanity test, I took a series of non-GDAL GeoTIFF files and ran them through gdal_translate to NITF.  Interestingly, around 30% of the NITF files again dropped the geotransform data.  I?ve attached below gdalinfo reports of a gdal_translate input GeoTIFF file and the output NITF file for a failing example.  My geotransform data appears to be well-behaved.  Question:  What could cause geotransform data to be rejected?  Thanks?..


Non-GDAL gdal_translate input GeoTIFF file:

$ gdalinfo sar2023071722525322.tif
Driver: GTiff/GeoTIFF
Files: sar2023071722525322.tif
Size is 1024, 1024
Coordinate System is:
PROJCS["VITAL SAR Simulation",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0],
        UNIT["degree",0.0174532925199433],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",-81],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]]]
GeoTransform =
  586659.1336352756, -0.2027675805429681, -0.2274441341933198
  2969181.096499263, -0.2274441341933198, 0.2027675805429681
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (  586659.134, 2969181.096) ( 80d 7'40.06"W, 26d50'29.50"N)
Lower Left  (  586426.231, 2969388.731) ( 80d 7'48.44"W, 26d50'36.30"N)
Upper Right (  586451.500, 2968948.194) ( 80d 7'47.64"W, 26d50'21.98"N)
Lower Right (  586218.597, 2969155.828) ( 80d 7'56.02"W, 26d50'28.78"N)
Center      (  586438.865, 2969168.462) ( 80d 7'48.04"W, 26d50'29.14"N)
Band 1 Block=1024x8 Type=Byte, ColorInterp=Gray

gdal_translate output NITF file:

$ gdalinfo sar2023071722525322.nitf
Driver: NITF/National Imagery Transmission Format
Files: sar2023071722525322.nitf
Size is 1024, 1024
Coordinate System is `'
GCP Projection =
PROJCS["UTM Zone 17, Northern Hemisphere",
    GEOGCS["WGS 84",
        DATUM["WGS_1984",
            SPHEROID["WGS 84",6378137,298.257223563,
                AUTHORITY["EPSG","7030"]],
            AUTHORITY["EPSG","6326"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4326"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",-81],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["Meter",1]]
GCP[  0]: Id=UpperLeft, Info=
          (0.5,0.5) -> (586659,2969181,0)
GCP[  1]: Id=UpperRight, Info=
          (1023.5,0.5) -> (586451,2968948,0)
GCP[  2]: Id=LowerRight, Info=
          (1023.5,1023.5) -> (586219,2969156,0)
GCP[  3]: Id=LowerLeft, Info=
          (0.5,1023.5) -> (586426,2969389,0)
Metadata:
  NITF_ABPP=08
  NITF_CCS_COLUMN=0
  NITF_CCS_ROW=0
  NITF_CLEVEL=03
  NITF_ENCRYP=0
  NITF_FBKGC=  0,  0,  0
  NITF_FDT=20021216151629
  NITF_FHDR=NITF02.10
  NITF_FSCATP=
  NITF_FSCAUT=
  NITF_FSCLAS=U
  NITF_FSCLSY=
  NITF_FSCLTX=
  NITF_FSCODE=
  NITF_FSCOP=00000
  NITF_FSCPYS=00000
  NITF_FSCRSN=
  NITF_FSCTLH=
  NITF_FSCTLN=
  NITF_FSDCDT=
  NITF_FSDCTP=
  NITF_FSDCXM=
  NITF_FSDG=
NITF_FSDGDT=
  NITF_FSREL=
  NITF_FSSRDT=
  NITF_FTITLE=
  NITF_IALVL=0
  NITF_IC=NC
  NITF_ICAT=VIS
  NITF_ICORDS=N
  NITF_IDATIM=20021216151629
  NITF_IDLVL=1
  NITF_IGEOLO=175866592969181175864512968948175862192969156175864262969389
  NITF_IID1=Missing
  NITF_IID2=
  NITF_ILOC_COLUMN=0
  NITF_ILOC_ROW=0
  NITF_IMAG=1.0
  NITF_IMODE=B
  NITF_IREP=MONO
  NITF_ISCATP=
  NITF_ISCAUT=
  NITF_ISCLAS=U
  NITF_ISCLSY=
  NITF_ISCLTX=
  NITF_ISCODE=
  NITF_ISCRSN=
  NITF_ISCTLH=
  NITF_ISCTLN=
  NITF_ISDCDT=
  NITF_ISDCTP=
  NITF_ISDCXM=
  NITF_ISDG=
  NITF_ISDGDT=
  NITF_ISORCE=Unknown
  NITF_ISREL=
  NITF_ISSRDT=
  NITF_ONAME=
  NITF_OPHONE=
  NITF_OSTAID=GDAL
  NITF_PJUST=R
  NITF_PVTYPE=INT
  NITF_STYPE=BF01
  NITF_TGTID=
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0, 1024.0)
Upper Right ( 1024.0,    0.0)
Lower Right ( 1024.0, 1024.0)
Center      (  512.0,  512.0)
Band 1 Block=1024x1 Type=Byte, ColorInterp=Gray





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230720/4cff262a/attachment-0001.htm>

From b.coerver at mailbox.org  Fri Jul 21 02:46:42 2023
From: b.coerver at mailbox.org (b.coerver at mailbox.org)
Date: Fri, 21 Jul 2023 11:46:42 +0200
Subject: [gdal-dev] /vsis3/ on NetCDF from Earthdata
In-Reply-To: <5B40B60E-3E34-4340-87F8-FFF85590E206@hxcore.ol>
References: <69C83C86-2257-5245-94C6-FF0C220C778E@hxcore.ol>,
 <5ee6ff23-9368-0854-f818-3c113dea0380@spatialys.com>,
 <5B40B60E-3E34-4340-87F8-FFF85590E206@hxcore.ol>
Message-ID: <12D59BA3-9307-D14D-9AB1-CD944DFE72EE@hxcore.ol>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/14ed4b70/attachment.htm>

From even.rouault at spatialys.com  Fri Jul 21 06:43:42 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 21 Jul 2023 15:43:42 +0200
Subject: [gdal-dev] /vsis3/ on NetCDF from Earthdata
In-Reply-To: <12D59BA3-9307-D14D-9AB1-CD944DFE72EE@hxcore.ol>
References: <69C83C86-2257-5245-94C6-FF0C220C778E@hxcore.ol>
 <5ee6ff23-9368-0854-f818-3c113dea0380@spatialys.com>
 <5B40B60E-3E34-4340-87F8-FFF85590E206@hxcore.ol>
 <12D59BA3-9307-D14D-9AB1-CD944DFE72EE@hxcore.ol>
Message-ID: <eddd873a-ca44-ed36-a411-237c5a0bf62e@spatialys.com>


Le 21/07/2023 ? 11:46, b.coerver at mailbox.org a ?crit?:
>
> One more follow-up question:
>
> The datasets that I?m interested in contains subdatasets. I can get 
> the info of a subdataset like this:
>
> ??? sub_ds_path= 
> 'HDF5:"/vsis3/prod-lads/VNP02IMG/VNP02IMG.A2021064.2342.002.2021128145323.nc"://observation_data/I04'
>
> ??? info = gdal.Info(sub_ds_path)
>
> This works fine and finishes in a few seconds. However, when I do the 
> same thing for a different dataset (which contains the geolocation of 
> the dataset above):
>
> sub_ds_path = 
> 'HDF5:"/vsis3/prod-lads/VNP03IMG/VNP03IMG.A2021065.2324.002.2021127011303.nc"://geolocation_data/latitude'
>
> info = gdal.Info(sub_ds_path)
>
> This takes about 2.5 minutes and I can see on my network that Python 
> is downloading data at about 1MB/s the whole time. The info from this 
> subdataset contains a lot of ground-control-points, so I tried setting 
> ?showGCPs=False?, but that doesn?t solve it. I?m not sure if it?s 
> really the GCPs that?s causing this (when I save the info as a json, 
> it is about 750kb in size).
>
The second product has georeferencing information, and upon opening of 
one of its subsdataset, GDAL samples the latitude and longitude arrays 
to expose ground control points, hence it reads those arrays.

> Any ideas what else can cause this difference in execution time?
>
> Regards,
>
> Bert
>
> *From: *gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of 
> b.coerver--- via gdal-dev <gdal-dev at lists.osgeo.org>
> *Date: *Thursday, 20 July 2023 at 11:51
> *To: *Even Rouault <even.rouault at spatialys.com>, 
> gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
> *Subject: *Re: [gdal-dev] /vsis3/ on NetCDF from Earthdata
>
> That does it, thank you so much!
>
> *From: *Even Rouault <even.rouault at spatialys.com>
> *Date: *Thursday, 20 July 2023 at 11:44
> *To: *bcoerver at mailbox.org <b.coerver at mailbox.org>, 
> gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
> *Subject: *Re: [gdal-dev] /vsis3/ on NetCDF from Earthdata
>
> Bert,
>
> Also set the GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR config option, 
> otherwise the generic open mechanism of GDAL tries to list the content 
> of the VNP02IMG/ directory and it seems there are tons of files there
>
> When doing that, I get a result within a few seconds
>
> Even
>
> Le 20/07/2023 ? 09:59, b.coerver--- via gdal-dev a ?crit?:
>
>     Hello,
>
>     I'm trying to access data from NASA's Earthdata S3 buckets, but I
>     get a `"<filename> does not exist in the file system, and is not
>     recognized as a supported dataset name."` error after waiting a
>     long time (? 50 minutes, the process is downloading some data the
>     whole time) doing the following:
>
>     from osgeo import gdal
>
>     gdal_config_options = {
>
>     ??? "AWS_ACCESS_KEY_ID": creds["accessKeyId"],
>
>     ??? "AWS_SESSION_TOKEN": creds["sessionToken"],
>
>     ??? "AWS_SECRET_ACCESS_KEY": creds["secretAccessKey"],
>
>     ??? "AWS_REGION": "us-west-2",
>
>     }
>
>     url =
>     "/vsis3/prod-lads/VNP02IMG/VNP02IMG.A2023193.1942.0022023194025636.nc"
>
>     for k, v in gdal_config_options.items():
>
>     ??? gdal.SetConfigOption(k, v)
>
>     out =gdal.Info(url)
>
>     The `creds` variable is a dictionary with temporary credential
>     information that I get from
>     [here](https://data.laadsdaac.earthdatacloud.nasa.gov/s3credentials
>     <https://data.laadsdaac.earthdatacloud.nasa.gov/s3credentials>),
>     you need a free account to get them.
>
>     When I introduce an error in one of the keys/tokens (e.g.
>     `"AWS_ACCESS_KEY_ID": creds["accessKeyId"] + "x"`, I do get a
>     message immediately saying my credentials are unknown. So I do
>     think they are being ingested correctly. I?m using GDAL version 3.7.1.
>
>     I also managed to download the entire file using `boto3`, by doing
>     the following:
>
>     ??? import boto3
>
>     ??? client = boto3.client(
>
>     ??????? 's3',
>
>     aws_access_key_id=creds["accessKeyId"],
>
>     aws_secret_access_key=creds["secretAccessKey"],
>
>     aws_session_token=creds["sessionToken"]
>
>     ??? )
>
>     ????client.download_file('prod-lads',
>     'VNP02IMG/VNP02IMG.A2023193.1942.002.2023194025636.nc', 'test.nc')
>
>     Any ideas what I'm doing wrong or how to make this work? In the
>     end I'm interested in accessing the files metadata without
>     downloading the entire file
>
>     Regards,
>
>     Bert
>
>     _______________________________________________
>
>     gdal-dev mailing list
>
>     gdal-dev at lists.osgeo.org
>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/cdb0a7cb/attachment-0001.htm>

From a.pau at creaf.uab.cat  Fri Jul 21 10:23:46 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Fri, 21 Jul 2023 17:23:46 +0000
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
 <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <AS8PR07MB8168D50BCEE675AC35183853A23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hello!

I?ve been trying to use the OGRLayer::GetFeatureCount() when I am reading another format inside the ICreateFeature() but I think it?s impossible. At this point I don?t have access to the layer info, so to the GetFeatureCount().
In fact I don?t mind where to call this function but I need to call it in order to write our format efficiently (at least in most of cases).

So the question is, in my driver, when I read a format I get some information about the layer but I can?t acces to the count of the features of the layer. I am right? If not, how I do that?

Thanks but before sending this mail I?ve been like hours trying to find it out debbuging and consulting the call stack from all points and nothing seems to indicate I can do that. But perhaps I am wrong.

It would be very helpful knowing that information. I not my writting strategy with change radically. Thankssssss!

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau
Enviado el: divendres, 7 de juliol de 2023 12:44
Para: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] A question of eficiency

Hi again,

I can totally give this number in GetFeatureCount(). No problem from my driver to other.
Then I understand that in one way (efficient) or in another (no efficient) I can always get the number of features with the GetFeatureCount(). True?

About the other question imagine a multiline shape with two lines of two parts every line. I need to know the total count of individual lines (cause my driver doesn?t have multiline and I have to convert every multiline to N lines). It is 4 (2+2). Can I get this number without asking every feature how many parts it have? I doubt that, but...

Thanks for your kind anwser!

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: divendres, 7 de juliol de 2023 12:32
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] A question of eficiency


Abel,

At the minimum for the reading side of a vector driver, you need to implement GetNextFeature().

If there is an efficient way of knowing the number of features without iterating over the whole file (typically a field in a header giving that number), you may implement GetFeatureCount(). If you don't implement it, and code using your driver needs the feature count, the generic implementation of OGRLayer::GetFeatureCount() will call GetNextFeature() repeatdly until it returns NULL.

Not totally sure to understand your question about multielements. If you have an instance of OGRGeometryCollection or any deriving class, there's a getNumGeometries() method to get the number of parts

Even
Le 07/07/2023 ? 11:33, Abel Pau a ?crit :
Hi,
I would like to know if when we use the code of GDAL to program a driver (or whatever) in vectors (so, ogr) we can assume that we can know the number of elements we are going to import in any way or it would be possible not knowing that until NextFeature is empty (or something like that). So, there is any way to obtain this number of elements without doing a while? And in case of multielements its possible to know how many parts are there in total?
I need that to write my format (I don?t explain the details cause I don?t get you bored :) )

If anyone know that I?d appreciate an answer. Thanks in advance.

Abel.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/a11dfa47/attachment.htm>

From even.rouault at spatialys.com  Fri Jul 21 10:32:19 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 21 Jul 2023 19:32:19 +0200
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <AS8PR07MB8168D50BCEE675AC35183853A23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
 <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168D50BCEE675AC35183853A23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <cf6af5e1-bd79-4d82-ef2b-2f227b1ec71c@spatialys.com>

Abel,

OK, I now better understand what you meant. Well, no, there's no way for 
the writing part of a driver to know how many features there are in the 
source layer, because in the general case, there is no source layer... 
Users could potentially call CreateFeature() without any source layer 
and without knowing in advance how many features they are going to 
write. Ideally your driver wouldn't need to know that, but I don't know 
the specificities of your format. If you really need to know the number 
of features before being able to write the file, the strategy would be 
that the ICreateFeature() method of your driver actually delegates 
writing those features to another GDAL driver (e.g GeoPackage) in a 
temporary file, and upon layer closing, you read back that temporary 
file to actually write your own file.

In some cases, ogr2ogr could potentially know in advance the number of 
features to be written and pass them to the output driver(as well as the 
extent typically), but:

- knowing the number of features can be a pretty slow operation for some 
input drivers , or when using a SQL statement

- and there's no such infrastructure currently

Even

Le 21/07/2023 ? 19:23, Abel Pau a ?crit?:
>
> Hello!
>
> I?ve been trying to use the OGRLayer::GetFeatureCount() when I am 
> reading another format inside the ICreateFeature() but I think it?s 
> impossible. At this point I don?t have access to the layer info, so to 
> the GetFeatureCount().
>
> In fact I don?t mind where to call this function but I need to call it 
> in order to write our format efficiently (at least in most of cases).
>
> So the question is, in my driver, when I read a format I get some 
> information about the layer but I can?t acces to the count of the 
> features of the layer. I am right? If not, how I do that?
>
> Thanks but before sending this mail I?ve been like hours trying to 
> find it out debbuging and consulting the call stack from all points 
> and nothing seems to indicate I can do that. But perhaps I am wrong.
>
> It would be very helpful knowing that information. I not my writting 
> strategy with change radically. Thankssssss!
>
> *De:*gdal-dev <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau
> *Enviado el:* divendres, 7 de juliol de 2023 12:44
> *Para:* Even Rouault <even.rouault at spatialys.com>; 
> gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] A question of eficiency
>
> Hi again,
>
> I can totally give this number in GetFeatureCount(). No problem from 
> my driver to other.
>
> Then I understand that in one way (efficient) or in another (no 
> efficient) I can always get the number of features with the 
> GetFeatureCount(). True?
>
> About the other question imagine a multiline shape with two lines of 
> two parts every line. I need to know the total count of individual 
> lines (cause my driver doesn?t have multiline and I have to convert 
> every multiline to N lines). It is 4 (2+2). Can I get this number 
> without asking every feature how many parts it have? I doubt that, but...
>
> Thanks for your kind anwser!
>
> *De:*Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* divendres, 7 de juliol de 2023 12:32
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] A question of eficiency
>
> Abel,
>
> At the minimum for the reading side of a vector driver, you need to 
> implement GetNextFeature().
>
> If there is an efficient way of knowing the number of features without 
> iterating over the whole file (typically a field in a header giving 
> that number), you may implement GetFeatureCount(). If you don't 
> implement it, and code using your driver needs the feature count, the 
> generic implementation of OGRLayer::GetFeatureCount() will call 
> GetNextFeature() repeatdly until it returns NULL.
>
> Not totally sure to understand your question about multielements. If 
> you have an instance of OGRGeometryCollection or any deriving class, 
> there's a getNumGeometries() method to get the number of parts
>
> Even
>
> Le 07/07/2023 ? 11:33, Abel Pau a ?crit?:
>
>     Hi,
>
>     I would like to know if when we use the code of GDAL to program a
>     driver (or whatever) in vectors (so, ogr) we can assume that we
>     can know the number of elements we are going to import in any way
>     or it would be possible not knowing that until NextFeature is
>     empty (or something like that). So, there is any way to obtain
>     this number of elements without doing a while? And in case of
>     multielements its possible to know how many parts are there in total?
>
>     I need that to write my format (I don?t explain the details cause
>     I don?t get you bored :) )
>
>     If anyone know that I?d appreciate an answer. Thanks in advance.
>
>     Abel.
>
>     _______________________________________________
>
>     gdal-dev mailing list
>
>     gdal-dev at lists.osgeo.org
>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b2f8e42b/attachment-0001.htm>

From a.pau at creaf.uab.cat  Fri Jul 21 10:37:42 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Fri, 21 Jul 2023 17:37:42 +0000
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <cf6af5e1-bd79-4d82-ef2b-2f227b1ec71c@spatialys.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
 <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168D50BCEE675AC35183853A23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <cf6af5e1-bd79-4d82-ef2b-2f227b1ec71c@spatialys.com>
Message-ID: <AS8PR07MB8168280C7E4BB862BAA2583DA23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>

Ok,
It?s just what happened when I programmed the read-from-Spatial-Oracle and write-in-our-format.
Our format have a main header, one header for every feature (so, as many as features in the layer) and after that have the geometric information.
In other files have the other information that comes from Fields. No prblem in that one.

I can use a not efficient but simple strategy: write every part in separate files and put all together on the correct place after finishing.

Thanks a lot for answering!


Abel Pau Garcia
T?cnic en SIG
[cid:image010.png at 01D740ED.86C01100]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Tel. +34 935814277
[cid:image011.png at 01D740ED.86C01100]

[cid:image012.png at 01D740ED.86C01100]<https://www.facebook.com/CREAFecologia/>[cid:image013.png at 01D740ED.86C01100]<https://twitter.com/CREAF_ecologia>[cid:image014.png at 01D740ED.86C01100]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[cid:image015.png at 01D740ED.86C01100]<https://www.youtube.com/c/creafecologia>[cid:image016.png at 01D740ED.86C01100]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[cid:image017.png at 01D740ED.86C01100]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Abans d'imprimir aquest missatge electr?nic penseu en el medi ambient.



De: Even Rouault<mailto:even.rouault at spatialys.com>
Enviat: divendres, 21 de juliol de 2023 19:32
Per a: Abel Pau<mailto:a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Tema: Re: [gdal-dev] A question of eficiency


Abel,

OK, I now better understand what you meant. Well, no, there's no way for the writing part of a driver to know how many features there are in the source layer, because in the general case, there is no source layer... Users could potentially call CreateFeature() without any source layer and without knowing in advance how many features they are going to write. Ideally your driver wouldn't need to know that, but I don't know the specificities of your format. If you really need to know the number of features before being able to write the file, the strategy would be that the ICreateFeature() method of your driver actually delegates writing those features to another GDAL driver (e.g GeoPackage) in a temporary file, and upon layer closing, you read back that temporary file to actually write your own file.

In some cases, ogr2ogr could potentially know in advance the number of features to be written and pass them to the output driver(as well as the extent typically), but:

- knowing the number of features can be a pretty slow operation for some input drivers , or when using a SQL statement

- and there's no such infrastructure currently

Even
Le 21/07/2023 ? 19:23, Abel Pau a ?crit :
Hello!

I?ve been trying to use the OGRLayer::GetFeatureCount() when I am reading another format inside the ICreateFeature() but I think it?s impossible. At this point I don?t have access to the layer info, so to the GetFeatureCount().
In fact I don?t mind where to call this function but I need to call it in order to write our format efficiently (at least in most of cases).

So the question is, in my driver, when I read a format I get some information about the layer but I can?t acces to the count of the features of the layer. I am right? If not, how I do that?

Thanks but before sending this mail I?ve been like hours trying to find it out debbuging and consulting the call stack from all points and nothing seems to indicate I can do that. But perhaps I am wrong.

It would be very helpful knowing that information. I not my writting strategy with change radically. Thankssssss!

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau
Enviado el: divendres, 7 de juliol de 2023 12:44
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] A question of eficiency

Hi again,

I can totally give this number in GetFeatureCount(). No problem from my driver to other.
Then I understand that in one way (efficient) or in another (no efficient) I can always get the number of features with the GetFeatureCount(). True?

About the other question imagine a multiline shape with two lines of two parts every line. I need to know the total count of individual lines (cause my driver doesn?t have multiline and I have to convert every multiline to N lines). It is 4 (2+2). Can I get this number without asking every feature how many parts it have? I doubt that, but...

Thanks for your kind anwser!

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: divendres, 7 de juliol de 2023 12:32
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] A question of eficiency


Abel,

At the minimum for the reading side of a vector driver, you need to implement GetNextFeature().

If there is an efficient way of knowing the number of features without iterating over the whole file (typically a field in a header giving that number), you may implement GetFeatureCount(). If you don't implement it, and code using your driver needs the feature count, the generic implementation of OGRLayer::GetFeatureCount() will call GetNextFeature() repeatdly until it returns NULL.

Not totally sure to understand your question about multielements. If you have an instance of OGRGeometryCollection or any deriving class, there's a getNumGeometries() method to get the number of parts

Even
Le 07/07/2023 ? 11:33, Abel Pau a ?crit :
Hi,
I would like to know if when we use the code of GDAL to program a driver (or whatever) in vectors (so, ogr) we can assume that we can know the number of elements we are going to import in any way or it would be possible not knowing that until NextFeature is empty (or something like that). So, there is any way to obtain this number of elements without doing a while? And in case of multielements its possible to know how many parts are there in total?
I need that to write my format (I don?t explain the details cause I don?t get you bored :) )

If anyone know that I?d appreciate an answer. Thanks in advance.

Abel.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0829C36EF5094B038A5550947359A8A3[3370034].png
Type: image/png
Size: 3936 bytes
Desc: 0829C36EF5094B038A5550947359A8A3[3370034].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: AFB2D939202140B1A66CD97C55BA07F0[3370035].png
Type: image/png
Size: 4488 bytes
Desc: AFB2D939202140B1A66CD97C55BA07F0[3370035].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 77F1D63BF16849EF8905B4E996CCDC7D[3370036].png
Type: image/png
Size: 940 bytes
Desc: 77F1D63BF16849EF8905B4E996CCDC7D[3370036].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0B23853F311F49F498CBC28D2206E251[3370037].png
Type: image/png
Size: 930 bytes
Desc: 0B23853F311F49F498CBC28D2206E251[3370037].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 5F72F8A7690D45638326CB3CFC331A3A[3370038].png
Type: image/png
Size: 936 bytes
Desc: 5F72F8A7690D45638326CB3CFC331A3A[3370038].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0012.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: D1AD5E45B4D640BAAE3DCD090B1CF0C7[3370039].png
Type: image/png
Size: 980 bytes
Desc: D1AD5E45B4D640BAAE3DCD090B1CF0C7[3370039].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0013.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 035E57EF07824665997D96FD07A833CC[3370040].png
Type: image/png
Size: 1053 bytes
Desc: 035E57EF07824665997D96FD07A833CC[3370040].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0014.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 149ADE8446C8407A855709F762EA8AAC[3370041].png
Type: image/png
Size: 239 bytes
Desc: 149ADE8446C8407A855709F762EA8AAC[3370041].png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0015.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 8467D83278924230A35A48263882DC19[3370042].gif
Type: image/gif
Size: 1185 bytes
Desc: 8467D83278924230A35A48263882DC19[3370042].gif
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/b297af70/attachment-0001.gif>

From simon.eves at heavy.ai  Fri Jul 21 15:27:04 2023
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 21 Jul 2023 15:27:04 -0700
Subject: [gdal-dev] Issue with sub-dataset suffix
Message-ID: <CAJf0KTThQJiO+b_EschV8DAjcOT2kMM0hJ=0OSfRR6V6W4aCDw@mail.gmail.com>

We are dealing with some netCDF files on S3 which have multiple
sub-datasets.

Trying to do a simple gdalinfo using VSI paths.

Note you may need to have AWS_NO_SIGN_REQUEST=YES to access the file below.

This works, and gives a summary dump...

$ gdalinfo /vsis3/noaa-nwm-pds/nwm.20230720/short_range/
nwm.t00z.short_range.land.f001.conus.nc

This fails...

$ gdalinfo
/vsis3/noaa-nwm-pds/nwm.20230720/short_range/nwm.t00z.short_range.land.f001.conus.nc:
SOILSAT_TOP
ERROR 4:
`/vsis3/noaa-nwm-pds/nwm.20230720/short_range/nwm.t00z.short_range.land.f001.conus.nc:SOILSAT_TOP'
does not exist in the file system, and is not recognized as a supported
dataset name.
gdalinfo failed - unable to open
'/vsis3/noaa-nwm-pds/nwm.20230720/short_range/nwm.t00z.short_range.land.f001.conus.nc:
SOILSAT_TOP'.

If you ALSO specify the file type hint on the front of the path, it works...

$ gdalinfo
NETCDF:/vsis3/noaa-nwm-pds/nwm.20230720/short_range/nwm.t00z.short_range.land.f001.conus.nc:
SOILSAT_TOP

This seems like a bug. It should still be able to recognize and open the
file without the type hint, whether or not you provide a sub-dataset suffix.

Our system generally relies heavily on GDAL's usually-reliable ability to
recognize file types and load anything without such hints, so having to
provide that as well will be undesirable.

-- 
Simon Eves
Senior Rendering Engineer
+1 (415) 902-1996
simon.eves at heavy.ai

<http://www.heavy.ai>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/9074c5dc/attachment.htm>

From even.rouault at spatialys.com  Fri Jul 21 15:35:20 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 22 Jul 2023 00:35:20 +0200
Subject: [gdal-dev] Issue with sub-dataset suffix
In-Reply-To: <CAJf0KTThQJiO+b_EschV8DAjcOT2kMM0hJ=0OSfRR6V6W4aCDw@mail.gmail.com>
References: <CAJf0KTThQJiO+b_EschV8DAjcOT2kMM0hJ=0OSfRR6V6W4aCDw@mail.gmail.com>
Message-ID: <2c14b4ae-f953-4560-35d7-909cac255c6d@spatialys.com>


>
> This seems like a bug. It should still be able to recognize and open 
> the file without the type hint, whether or not you provide a 
> sub-dataset suffix.
This is not a bug. This is intended. Subdatasets have a specific syntax. 
Valid subdataset names are the ones reported under the SUBDATASET 
metadata domain.
>
> Our system generally relies heavily on GDAL's usually-reliable ability 
> to recognize file types and load anything without such hints, so 
> having to provide that as well will be undesirable.
This is generally true for the first level of access to a file, but once 
you want a specific part (name it "variable", etc), you have to comply 
with the nomenclature of each driver.
>
> -- 
> Simon Eves
> Senior Rendering Engineer
> +1 (415) 902-1996
> simon.eves at heavy.ai
>
> <http://www.heavy.ai>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230722/b32ca4bf/attachment.htm>

From simon.eves at heavy.ai  Fri Jul 21 15:56:54 2023
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 21 Jul 2023 15:56:54 -0700
Subject: [gdal-dev] Issue with sub-dataset suffix
In-Reply-To: <2c14b4ae-f953-4560-35d7-909cac255c6d@spatialys.com>
References: <CAJf0KTThQJiO+b_EschV8DAjcOT2kMM0hJ=0OSfRR6V6W4aCDw@mail.gmail.com>
 <2c14b4ae-f953-4560-35d7-909cac255c6d@spatialys.com>
Message-ID: <CAJf0KTRU=7P_gdGAbrz-6eZ-tyLPuyQFtgE76jqXmweMW4Q-xQ@mail.gmail.com>

OK, I get it now.

So the "filename" to open is the exact SUBDATASET_X_NAME string from the
metadata. It seems you can safely omit the quotes (at least in the case of
this file), which is perhaps part of my confusion.

Sorry, that makes sense in hindsight.

Thank you, as ever, for your prompt assistance!

Simon



On Fri, Jul 21, 2023 at 3:35?PM Even Rouault <even.rouault at spatialys.com>
wrote:

>
>
> This seems like a bug. It should still be able to recognize and open the
> file without the type hint, whether or not you provide a sub-dataset suffix.
>
> This is not a bug. This is intended. Subdatasets have a specific syntax.
> Valid subdataset names are the ones reported under the SUBDATASET metadata
> domain.
>
>
> Our system generally relies heavily on GDAL's usually-reliable ability to
> recognize file types and load anything without such hints, so having to
> provide that as well will be undesirable.
>
> This is generally true for the first level of access to a file, but once
> you want a specific part (name it "variable", etc), you have to comply with
> the nomenclature of each driver.
>
>
> --
> Simon Eves
> Senior Rendering Engineer
> +1 (415) 902-1996
> simon.eves at heavy.ai
>
> <http://www.heavy.ai>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230721/4ac591ee/attachment.htm>

From vijay.kurhade at gmail.com  Mon Jul 24 02:53:44 2023
From: vijay.kurhade at gmail.com (Vijay Kurhade)
Date: Mon, 24 Jul 2023 15:23:44 +0530
Subject: [gdal-dev] how do you install and configure ogr2ogr on windows with
 anaconda3
Message-ID: <CAEcx6ha+xTm7yAFUoRdevc2LTgATXaLQ4XtMFEA1f5bWW2oDtg@mail.gmail.com>

Hi;

i have anaconda3 on my windows system;  after installing gdal i can check
from command prompt ogr2ogr --version and it returns

ogr2ogr --version
GDAL 3.6.2, released 2023/01/02

But when i try to run it on my intended dxf file I get following errors

ERROR 1: PROJ: proj_create_from_database: Cannot find proj.db
ERROR 1: Failed to process SRS definition: EPSG:4326

Am I missing setting any system variables for proj.db? Where do I find it?


Thanks in advance.

Regds-
vijay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230724/1a38b0c2/attachment.htm>

From even.rouault at spatialys.com  Mon Jul 24 06:36:41 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 24 Jul 2023 15:36:41 +0200
Subject: [gdal-dev] how do you install and configure ogr2ogr on windows
 with anaconda3
In-Reply-To: <CAEcx6ha+xTm7yAFUoRdevc2LTgATXaLQ4XtMFEA1f5bWW2oDtg@mail.gmail.com>
References: <CAEcx6ha+xTm7yAFUoRdevc2LTgATXaLQ4XtMFEA1f5bWW2oDtg@mail.gmail.com>
Message-ID: <8897b8ac-8dd3-8fdc-abea-f2ec3c718d4c@spatialys.com>


Le 24/07/2023 ? 11:53, Vijay Kurhade a ?crit?:
> Hi;
>
> i have anaconda3 on my windows system;? after installing?gdal i can 
> check from command prompt ogr2ogr --version and it returns
>
> ogr2ogr --version
> GDAL 3.6.2, released 2023/01/02
>
> But when i try to run it on my intended dxf file I get following errors
>
> ERROR 1: PROJ: proj_create_from_database: Cannot find proj.db
> ERROR 1: Failed to process SRS definition: EPSG:4326
>
> Am I missing setting any system variables?for proj.db? Where do I find it?

Maybe your environment is a bit messed up. Normally the PROJ_LIB / 
PROJ_DATA environment variable should be automatically set up.

Perhaps recreate a fresh Conda environment and install GDAL in it

Even

>
>
> Thanks in advance.
>
> Regds-
> vijay
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From fwschenck at gmail.com  Mon Jul 24 09:59:39 2023
From: fwschenck at gmail.com (Ferdinand)
Date: Mon, 24 Jul 2023 18:59:39 +0200
Subject: [gdal-dev] Non-zero FIRST_COL,
 FIRST_ROW for PNeo ImagetoGround_Validity_Domain
Message-ID: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>

Hi All,

We're seeing some major geolocation offsets in PNeo images (order of 1000m,
depending on specific image).

I think I have tracked it down to having something to do with the validity
domain.
In the cases where I see the offset, I often have metadata that looks like:

<ImagetoGround_Validity_Domain>
>   <FIRST_COL>-531</FIRST_COL>
>   <FIRST_ROW>-3182</FIRST_ROW>
>   <LAST_COL>33374</LAST_COL>
>   <LAST_ROW>27699</LAST_ROW>
> </ImagetoGround_Validity_Domain>
>


>From what I can grok from the code, it's an assumption that FIRST_COL and
FIRST_ROW be 0 for PNeo, as discussed here:
https://github.com/OSGeo/gdal/issues/5716

In an earlier version (than 3.7.1), FIRST_COL was manually subtracted from
the line offset shift (https://github.com/OSGeo/gdal/pull/5725/files), but
that was reverted later, with the topLeftOffset manually set to 1 for PNeo:
https://github.com/OSGeo/gdal/pull/7653/files

Can it be that this shift is not accounted for?

Basically, we create tifs by running gdal_translate on the DIM XML file,
resulting in a tif with the RPC info inside.

Doing so on the same image for gdal 3.7.0 and 3.7.1 results in a diff of:

> 89c88
> <   LINE_OFF=12836
> ---
> >   LINE_OFF=12305
> 95c94
> <   SAMP_OFF=16819.5
> ---
> >   SAMP_OFF=16288.5
> 104,105d102
>

in the header.

The LINE_OFF gets shifted by 531 pixels, which is to be expected, but the
SAMP_OFF also gets shifted by 531 pixels, which should not happen, right?

Validating  in QGIS, the distance between Google Satellite and the one
tower is 777m, at 30cm = 2590 pixels.
2590 + 531 = 3121, so within a misclick of 3182


Doing something a bit atrocious I subtracted FIRST_ROW from the LINE_OFF (
https://github.com/fnands/rpcm/blob/1d4205d967985cfcc2426c3fd881352ce5b5ac46/rpcm/rpc_file_readers.py#L235),
as well as adding FIRST COL to both, and then overwriting the RPC info.
 This gets me pretty close, as least by visual inspection.

The diff between the manual one and the raster created with 3.7.1 is:

> 88c89
> <   LINE_OFF=12305
> ---
> >   LINE_OFF=14955
> 94c95
> <   SAMP_OFF=16288.5
> ---
> >   SAMP_OFF=15756.5
> 102c103
>


I feel like I am missing something here, and I am just throwing things at
the wall and seeing what sticks.
If someone can help me get a more fundamental understanding of what is
going wrong here I would greatly appreciate it.
Is this offset taken into account somewhere else?

Importantly, this is DIMAP v3, so not sure if that breaks anything. Waiting
on our provider to send me some docs, as the latest ones I have for the RPC
reference v2.


Cheers,

Ferdi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230724/fc516006/attachment.htm>

From howard at hobu.co  Tue Jul 25 06:45:56 2023
From: howard at hobu.co (Howard Butler)
Date: Tue, 25 Jul 2023 08:45:56 -0500
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
Message-ID: <F7D7FAF6-0A40-4486-AD49-4315982ADF07@hobu.co>

Howard Butler, Even Rouault, Dan Baston, and Alessandro Pasotti canceled the monthly GDAL Maintainers Meeting that was to be held on 07/27/2023 due to vacation conflicts. Maintainers instead provided text updates which I am relaying as our monthly report.

Fundraising update
----------------------------

Obtaining sponsorship renewals has been challenging. One gold sponsor and two bronze level sponsors have declined to renew their sponsorship for 2023-2024. This will take away $70,000 of sponsorship funding for the next year. If your corporate organization values the efforts of the GDAL sponsorship program and are willing to step forward to continue support of these activities, please contact me privately and I will be happy to route you through NumFOCUS to help us backfill the hole.

Maintenance activities update
------------------------------------------

* Dan continued enhancement and usability refinement of the Python bindings to allow using dictionaries to pass options, added a GetConfigOptions to report a dictionary of currently applicable options, and fixed a bug in gdal.config_option's context manager that caused options to persist after exit in rare cases.

* Dan continued the effort to document undocumented configuration options

* Dan began modifying GDAL's test suite so tests can run independently in any order. This effort is a heavy lift that will ultimately touch just about every file in the test suite. Dan is taking the opportunity to clean up old syntax and usages while hardening them.

* Alessandro created regression tests for OGCAPI drivers and processed bugs which became apparent as a result of writing these tests. 

* Alessandro completed PR reviews for Even and started development of API subsdataset information manipulation.

* Even processed ~80 items of bug fixes, PR reviews, and issue tracker triaging. An area of emphasis was review and support of a PR from Barry DeZonia to make the multidimensional API usable from the Java bindings

* Even merged gdal_footprint, which is available in the Docker -latest images and will be released in the upcoming GDAL 3.8.0 major release.

* Even coordinated the release of GDAL 3.7.1. Release notes can be found at https://github.com/OSGeo/gdal/blob/v3.7.1/NEWS.md

* Even coordinated updating PROJ to the latest EPSG 10.093 database release. 

* A coverage CI configuration now runs line coverage testing of pull requests and push to master. It is documented at https://gdal.org/development/testing.html#test-coverage-reports 

The next GDAL Maintainers Meeting is 08/24/2023 at 9:00 EDT. Any PSC members are welcome to join by reaching out to me for an invite.

Howard

From thomas.bonfort at gmail.com  Wed Jul 26 05:56:13 2023
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Wed, 26 Jul 2023 14:56:13 +0200
Subject: [gdal-dev] Non-zero FIRST_COL,
 FIRST_ROW for PNeo ImagetoGround_Validity_Domain
In-Reply-To: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
References: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
Message-ID: <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>

Ferdinand,
(re-adding gdal-dev after having exchanged off-list)
For your image with FIRST_COL set, you MUST use a gdal with
https://github.com/OSGeo/gdal/pull/7653 included. The initial
implementation in 5725 was incorrect in two ways: firstly
ImagetoGround_Validity_Domain.* is informative only, and should never be
used when applying RPCs. Secondly, as you noticed, that implementation only
read FIRST_COL and applied it to both SAMP_OFFSET and LINE_OFFSET.
Concerning your particular product there was an error that occurred during
the image production, and you should reach out to airbus's customer care
for support.

best regards,
Thomas

On Mon, Jul 24, 2023 at 7:00?PM Ferdinand <fwschenck at gmail.com> wrote:

> Hi All,
>
> We're seeing some major geolocation offsets in PNeo images (order of
> 1000m, depending on specific image).
>
> I think I have tracked it down to having something to do with the validity
> domain.
> In the cases where I see the offset, I often have metadata that looks
> like:
>
> <ImagetoGround_Validity_Domain>
>>   <FIRST_COL>-531</FIRST_COL>
>>   <FIRST_ROW>-3182</FIRST_ROW>
>>   <LAST_COL>33374</LAST_COL>
>>   <LAST_ROW>27699</LAST_ROW>
>> </ImagetoGround_Validity_Domain>
>>
>
>
> From what I can grok from the code, it's an assumption that FIRST_COL and
> FIRST_ROW be 0 for PNeo, as discussed here:
> https://github.com/OSGeo/gdal/issues/5716
>
> In an earlier version (than 3.7.1), FIRST_COL was manually subtracted from
> the line offset shift (https://github.com/OSGeo/gdal/pull/5725/files),
> but that was reverted later, with the topLeftOffset manually set to 1 for
> PNeo: https://github.com/OSGeo/gdal/pull/7653/files
>
> Can it be that this shift is not accounted for?
>
> Basically, we create tifs by running gdal_translate on the DIM XML file,
> resulting in a tif with the RPC info inside.
>
> Doing so on the same image for gdal 3.7.0 and 3.7.1 results in a diff of:
>
>> 89c88
>> <   LINE_OFF=12836
>> ---
>> >   LINE_OFF=12305
>> 95c94
>> <   SAMP_OFF=16819.5
>> ---
>> >   SAMP_OFF=16288.5
>> 104,105d102
>>
>
> in the header.
>
> The LINE_OFF gets shifted by 531 pixels, which is to be expected, but the
> SAMP_OFF also gets shifted by 531 pixels, which should not happen, right?
>
> Validating  in QGIS, the distance between Google Satellite and the one
> tower is 777m, at 30cm = 2590 pixels.
> 2590 + 531 = 3121, so within a misclick of 3182
>
>
> Doing something a bit atrocious I subtracted FIRST_ROW from the LINE_OFF (
> https://github.com/fnands/rpcm/blob/1d4205d967985cfcc2426c3fd881352ce5b5ac46/rpcm/rpc_file_readers.py#L235),
> as well as adding FIRST COL to both, and then overwriting the RPC info.
>  This gets me pretty close, as least by visual inspection.
>
> The diff between the manual one and the raster created with 3.7.1 is:
>
>> 88c89
>> <   LINE_OFF=12305
>> ---
>> >   LINE_OFF=14955
>> 94c95
>> <   SAMP_OFF=16288.5
>> ---
>> >   SAMP_OFF=15756.5
>> 102c103
>>
>
>
> I feel like I am missing something here, and I am just throwing things at
> the wall and seeing what sticks.
> If someone can help me get a more fundamental understanding of what is
> going wrong here I would greatly appreciate it.
> Is this offset taken into account somewhere else?
>
> Importantly, this is DIMAP v3, so not sure if that breaks anything.
> Waiting on our provider to send me some docs, as the latest ones I have for
> the RPC reference v2.
>
>
> Cheers,
>
> Ferdi
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230726/b254bbd8/attachment.htm>

From public at postholer.com  Wed Jul 26 12:17:07 2023
From: public at postholer.com (Scott)
Date: Wed, 26 Jul 2023 12:17:07 -0700
Subject: [gdal-dev] Installing Arrow/Parquet
In-Reply-To: <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>
References: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
 <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>
Message-ID: <61117c09-cd9b-8ede-41e7-39011141ec31@postholer.com>

I'm having a difficult time building gdal with Arrow/Parquet drivers on 
debian. Could someone show me exactly what cmake -D switches, paths and 
sources I need?

I've cloned github.com/apache/arrow, and added it to my paths. Clearly, 
I'm missing something.

Thanks!


From even.rouault at spatialys.com  Wed Jul 26 13:21:07 2023
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 26 Jul 2023 22:21:07 +0200
Subject: [gdal-dev] Installing Arrow/Parquet
In-Reply-To: <61117c09-cd9b-8ede-41e7-39011141ec31@postholer.com>
References: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
 <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>
 <61117c09-cd9b-8ede-41e7-39011141ec31@postholer.com>
Message-ID: <4a425ede-555a-d10a-f434-86d85fba0fe1@spatialys.com>

You would need to build arrow-cpp and install it. If you install it in 
the /usr prefix, GDAL CMake will autodetect it. Otherwise you'll have to 
pass -DArrow_DIR=${install_prefix}/lib/cmake/Arrow

you may also install a prebuilt arrow-cpp package: cf 
https://arrow.apache.org/install/? and GDAL CMake will autodetect it

Le 26/07/2023 ? 21:17, Scott a ?crit?:
> I'm having a difficult time building gdal with Arrow/Parquet drivers 
> on debian. Could someone show me exactly what cmake -D switches, paths 
> and sources I need?
>
> I've cloned github.com/apache/arrow, and added it to my paths. 
> Clearly, I'm missing something.
>
> Thanks!
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From public at postholer.com  Wed Jul 26 17:45:54 2023
From: public at postholer.com (Scott)
Date: Wed, 26 Jul 2023 17:45:54 -0700
Subject: [gdal-dev] Installing Arrow/Parquet
In-Reply-To: <4a425ede-555a-d10a-f434-86d85fba0fe1@spatialys.com>
References: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
 <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>
 <61117c09-cd9b-8ede-41e7-39011141ec31@postholer.com>
 <4a425ede-555a-d10a-f434-86d85fba0fe1@spatialys.com>
Message-ID: <c10f830c-5e7f-c66b-9757-e2f9a987b70d@postholer.com>

I built arrow 12.0.1. When rebuilding GDAL it auto-detected it and all 
is well. I probably should have just done that in the first place.

Thanks for the help Even!

On 7/26/23 13:21, Even Rouault wrote:
> You would need to build arrow-cpp and install it. If you install it in 
> the /usr prefix, GDAL CMake will autodetect it. Otherwise you'll have to 
> pass -DArrow_DIR=${install_prefix}/lib/cmake/Arrow
> 
> you may also install a prebuilt arrow-cpp package: cf 
> https://arrow.apache.org/install/? and GDAL CMake will autodetect it
> 
> Le 26/07/2023 ? 21:17, Scott a ?crit?:
>> I'm having a difficult time building gdal with Arrow/Parquet drivers 
>> on debian. Could someone show me exactly what cmake -D switches, paths 
>> and sources I need?
>>
>> I've cloned github.com/apache/arrow, and added it to my paths. 
>> Clearly, I'm missing something.
>>
>> Thanks!
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 

From public at postholer.com  Thu Jul 27 14:51:01 2023
From: public at postholer.com (Scott)
Date: Thu, 27 Jul 2023 14:51:01 -0700
Subject: [gdal-dev] Parquet and nest structures (JSON)
In-Reply-To: <c10f830c-5e7f-c66b-9757-e2f9a987b70d@postholer.com>
References: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
 <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>
 <61117c09-cd9b-8ede-41e7-39011141ec31@postholer.com>
 <4a425ede-555a-d10a-f434-86d85fba0fe1@spatialys.com>
 <c10f830c-5e7f-c66b-9757-e2f9a987b70d@postholer.com>
Message-ID: <81c772af-9a37-23f9-3da6-b2c268f22baa@postholer.com>

ogr2ogr'ing parquet data to GeoPackage I'm getting the following warnings:

Warning 1: Field names of unhandled type map<string, list<array_element: 
map<string, string ('array_element')>> ('names')> ignored
Warning 1: Field sources of unhandled type list<array_element: 
map<string, string ('array_element')>> ignored

...using command:
ogr2ogr -limit 10 -where "adminlevel = 2 and theme = 'admins'" -nln 
admin -overwrite admin.gpkg 
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0

It would be nice to save these JSON structures in the .gpkg, but I'm not 
sure how to go about it.

Any help would be greatly appreciated!
Scott


From ahmed.aredah at gmail.com  Fri Jul 28 07:15:31 2023
From: ahmed.aredah at gmail.com (Aredah, Ahmed)
Date: Fri, 28 Jul 2023 10:15:31 -0400
Subject: [gdal-dev] GDAL on Windows C++ application
In-Reply-To: <6BF04B90-6C9D-43EB-98B5-BBD212592186@hxcore.ol>
References: <6BF04B90-6C9D-43EB-98B5-BBD212592186@hxcore.ol>
Message-ID: <72FF6ECD-E31F-40A3-B6E2-4B379FAF86D0@hxcore.ol>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230728/289b45ba/attachment.htm>

From pramsey at cleverelephant.ca  Fri Jul 28 14:46:21 2023
From: pramsey at cleverelephant.ca (Paul Ramsey)
Date: Fri, 28 Jul 2023 14:46:21 -0700
Subject: [gdal-dev] Parquet and nest structures (JSON)
In-Reply-To: <81c772af-9a37-23f9-3da6-b2c268f22baa@postholer.com>
References: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
 <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>
 <61117c09-cd9b-8ede-41e7-39011141ec31@postholer.com>
 <4a425ede-555a-d10a-f434-86d85fba0fe1@spatialys.com>
 <c10f830c-5e7f-c66b-9757-e2f9a987b70d@postholer.com>
 <81c772af-9a37-23f9-3da6-b2c268f22baa@postholer.com>
Message-ID: <CACowWR1a4cexbO+dVEQUHB62a2Hcw4AF5mBEsYSbF+V+yv6fEg@mail.gmail.com>

You are playing with Overture data, yes? I am also poking around
there. That error message seems to be on the Parquet read side rather
than the GeoPKG write.

AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/20230725_211237_00132_5p54t_6194f239-f53a-4f7a-a18d-844d65743ec5
Warning 1: Field names of unhandled type map<string,
list<array_element: map<string, string ('array_element')>> ('names')>
ignored
Warning 1: Field sources of unhandled type list<array_element:
map<string, string ('array_element')>> ignored
INFO: Open of `/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/20230725_211237_00132_5p54t_6194f239-f53a-4f7a-a18d-844d65743ec5'
      using driver `Parquet' successful.
1: 20230725_211237_00132_5p54t_6194f239-f53a-4f7a-a18d-844d65743ec5

OGR does have StringList and IntegerList types, so we could probably
get some of those fields through to output formats that support it
(like Postgres). It doesn't look like SQLite supports a varchar[] or
integer[] type.

P

On Thu, Jul 27, 2023 at 2:51?PM Scott <public at postholer.com> wrote:
>
> ogr2ogr'ing parquet data to GeoPackage I'm getting the following warnings:
>
> Warning 1: Field names of unhandled type map<string, list<array_element:
> map<string, string ('array_element')>> ('names')> ignored
> Warning 1: Field sources of unhandled type list<array_element:
> map<string, string ('array_element')>> ignored
>
> ...using command:
> ogr2ogr -limit 10 -where "adminlevel = 2 and theme = 'admins'" -nln
> admin -overwrite admin.gpkg
> /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0
>
> It would be nice to save these JSON structures in the .gpkg, but I'm not
> sure how to go about it.
>
> Any help would be greatly appreciated!
> Scott
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From pramsey at cleverelephant.ca  Fri Jul 28 14:49:57 2023
From: pramsey at cleverelephant.ca (Paul Ramsey)
Date: Fri, 28 Jul 2023 14:49:57 -0700
Subject: [gdal-dev] Directories and Parquet
Message-ID: <CACowWR08x=JwcvcV1qq3vG+cUKfXxY-1xx27fdccSgUDA+10cA@mail.gmail.com>

I am playing with accessing the Overture data dump, which is multiple
files in each S3 bucket. The doco says that as of 3.6 (check!), with
the libarrow_dataset build (check) I should be able to read directory
collections as layers, but no luck thus far:

AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/
AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/

ogrinfo failed - unable to open
'/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/'.

If I pick one of the constituent files in that directory, ogr can open
it up just fine, and we just have the array/map/list type issue that
Scott has raised in another thread. Is this expected, a result of the
access being via S3 rather than an actual filesystem directory?
Something else?

Thx,
P

From simon.eves at heavy.ai  Fri Jul 28 14:50:33 2023
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 28 Jul 2023 14:50:33 -0700
Subject: [gdal-dev] netCDF geo file problems
Message-ID: <CAJf0KTR+b4Wa2RHtT3+k0BkLz2N82_DX6zi+0GpM8oN0nrMLqg@mail.gmail.com>

Dear List,

We are struggling with the following netCDF file, which appears to be quite
old (CF-1.6) and allegedly contains a few layers (one of which is called
"inflow". with point data).

https://drive.google.com/file/d/1FRt0L4idunewwjgKQmZQ7Ny_KGnuTL2X/view?usp=sharing

The only reason we know about the layers is from the docs on the web
service it was obtained from, and also we have managed to open the file
with some Python code using a netCDF4 module, which is able to enumerate
the layers (although it apparently calls them "variables").

I have been unable to get any of the GDAL/OGR tools to access the data in
this file. If you just provide the bare filename, then *OpenEx* with
*OF_VECTOR* just fails. If you specify the layer name like a subdataset
(netCDF:"filename":inflow) then *ogrinfo* will dump more specific stuff
about that layer, but you always get the following message also:

*Warning 1: The dataset has several variables that could be identified as
vector fields, but not all share the same primary dimension. Consequently
they will be ignored.*

*ogr2ogr* tries to copy the layer if also specified in full, but throws the
warning, and the output is empty.

Our geo import code supports multi-layer files (e.g. FileGDB) but we don't
get as far as being able to call *GetLayers()* on the DS. If they do
require specific opening with the full SDS name (like with raster) then I
would expect *ogrinfo* to at least dump the SDS names.

Please advise, thanks!

-- 
Simon Eves
Senior Rendering Engineer
+1 (415) 902-1996
simon.eves at heavy.ai

<http://www.heavy.ai>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230728/d14576d8/attachment.htm>

From michael.smith.erdc at gmail.com  Fri Jul 28 15:05:29 2023
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Fri, 28 Jul 2023 18:05:29 -0400
Subject: [gdal-dev] Directories and Parquet
In-Reply-To: <CACowWR08x=JwcvcV1qq3vG+cUKfXxY-1xx27fdccSgUDA+10cA@mail.gmail.com>
References: <CACowWR08x=JwcvcV1qq3vG+cUKfXxY-1xx27fdccSgUDA+10cA@mail.gmail.com>
Message-ID: <BB17B337-4204-46BA-9367-3F8BA025C751@gmail.com>

Paul,

I had to use 3.7.1 to have it read the geometry properly, 3.7.0 would read the directories.

docker run --rm -it ghcr.io/osgeo/gdal:ubuntu-full-latest ogrinfo /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins   -al -so
Warning 1: Field names of unhandled type map<string, list<array_element: map<string, string ('array_element')>> ('names')> ignored
Warning 1: Field sources of unhandled type list<array_element: map<string, string ('array_element')>> ignored
INFO: Open of `/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins'
      using driver `Parquet' successful.

Layer name: theme=admins
Geometry: Unknown (any)
Feature Count: 99403
Extent: (-180.000000, -89.999900) - (180.000000, 89.999900)
Layer SRS WKT:
(unknown)
Geometry Column = geometry
id: String (0.0)
updatetime: String (0.0)
version: Integer (0.0)
adminlevel: Integer (0.0)
maritime: String (0.0)
subtype: String (0.0)
localitytype: String (0.0)
context: String (0.0)
isocountrycodealpha2: String (0.0)
isosubcountrycode: String (0.0)
defaultlanugage: String (0.0)
drivingside: String (0.0)
bbox.minx: Real (0.0)
bbox.maxx: Real (0.0)
bbox.miny: Real (0.0)
bbox.maxy: Real (0.0)
type: String (0.0)

Mike


-- 

Michael Smith 
Remote Sensing/GIS Center 
US Army Corps of Engineers 






?On 7/28/23, 5:50 PM, "gdal-dev on behalf of Paul Ramsey" <gdal-dev-bounces at lists.osgeo.org <mailto:gdal-dev-bounces at lists.osgeo.org> on behalf of pramsey at cleverelephant.ca <mailto:pramsey at cleverelephant.ca>> wrote:


I am playing with accessing the Overture data dump, which is multiple
files in each S3 bucket. The doco says that as of 3.6 (check!), with
the libarrow_dataset build (check) I should be able to read directory
collections as layers, but no luck thus far:


AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/
AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/


ogrinfo failed - unable to open
'/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/'.


If I pick one of the constituent files in that directory, ogr can open
it up just fine, and we just have the array/map/list type issue that
Scott has raised in another thread. Is this expected, a result of the
access being via S3 rather than an actual filesystem directory?
Something else?


Thx,
P
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev>





From public at postholer.com  Fri Jul 28 15:10:01 2023
From: public at postholer.com (Scott)
Date: Fri, 28 Jul 2023 15:10:01 -0700
Subject: [gdal-dev] Parquet and nest structures (JSON)
In-Reply-To: <CACowWR1a4cexbO+dVEQUHB62a2Hcw4AF5mBEsYSbF+V+yv6fEg@mail.gmail.com>
References: <CAAYM6--UghBQnVC4ZxyhDSi9cfUg9sXkuUqtNq_ums+cxECmRA@mail.gmail.com>
 <CAOM3y2j1qck3F1ChJzN4=6Sf7UL9peU_DmqyN17ugqx+dTw0qw@mail.gmail.com>
 <61117c09-cd9b-8ede-41e7-39011141ec31@postholer.com>
 <4a425ede-555a-d10a-f434-86d85fba0fe1@spatialys.com>
 <c10f830c-5e7f-c66b-9757-e2f9a987b70d@postholer.com>
 <81c772af-9a37-23f9-3da6-b2c268f22baa@postholer.com>
 <CACowWR1a4cexbO+dVEQUHB62a2Hcw4AF5mBEsYSbF+V+yv6fEg@mail.gmail.com>
Message-ID: <35239b28-6789-cc6e-b756-f510784f3485@postholer.com>

Thanks for the response Paul!

Yes, it's overture. I never considered the sqlite data types. Thanks for 
the tip, I'll keep poking around.


On 7/28/23 14:46, Paul Ramsey wrote:
> You are playing with Overture data, yes? I am also poking around
> there. That error message seems to be on the Parquet read side rather
> than the GeoPKG write.
> 
> AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
> /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/20230725_211237_00132_5p54t_6194f239-f53a-4f7a-a18d-844d65743ec5
> Warning 1: Field names of unhandled type map<string,
> list<array_element: map<string, string ('array_element')>> ('names')>
> ignored
> Warning 1: Field sources of unhandled type list<array_element:
> map<string, string ('array_element')>> ignored
> INFO: Open of `/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/20230725_211237_00132_5p54t_6194f239-f53a-4f7a-a18d-844d65743ec5'
>        using driver `Parquet' successful.
> 1: 20230725_211237_00132_5p54t_6194f239-f53a-4f7a-a18d-844d65743ec5
> 
> OGR does have StringList and IntegerList types, so we could probably
> get some of those fields through to output formats that support it
> (like Postgres). It doesn't look like SQLite supports a varchar[] or
> integer[] type.
> 
> P
> 
> On Thu, Jul 27, 2023 at 2:51?PM Scott <public at postholer.com> wrote:
>>
>> ogr2ogr'ing parquet data to GeoPackage I'm getting the following warnings:
>>
>> Warning 1: Field names of unhandled type map<string, list<array_element:
>> map<string, string ('array_element')>> ('names')> ignored
>> Warning 1: Field sources of unhandled type list<array_element:
>> map<string, string ('array_element')>> ignored
>>
>> ...using command:
>> ogr2ogr -limit 10 -where "adminlevel = 2 and theme = 'admins'" -nln
>> admin -overwrite admin.gpkg
>> /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0
>>
>> It would be nice to save these JSON structures in the .gpkg, but I'm not
>> sure how to go about it.
>>
>> Any help would be greatly appreciated!
>> Scott
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From michael.smith.erdc at gmail.com  Fri Jul 28 15:14:01 2023
From: michael.smith.erdc at gmail.com (Michael Smith)
Date: Fri, 28 Jul 2023 18:14:01 -0400
Subject: [gdal-dev] Directories and Parquet
In-Reply-To: <B762B2C7-A2AD-45C5-A461-FD4C89B8F8AF@gmail.com>
References: <CACowWR08x=JwcvcV1qq3vG+cUKfXxY-1xx27fdccSgUDA+10cA@mail.gmail.com>
 <B762B2C7-A2AD-45C5-A461-FD4C89B8F8AF@gmail.com>
Message-ID: <C45B54A8-FEF6-4019-BE1F-7B3D3DB22AE6@gmail.com>

Here's fetching the first admin boundary:

docker run --rm -it ghcr.io/osgeo/gdal:ubuntu-full-latest ogrinfo /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/  -where "type='administrativeBoundary'" -al  -fid 1
Warning 1: Field names of unhandled type map<string, list<array_element: map<string, string ('array_element')>> ('names')> ignored
Warning 1: Field sources of unhandled type list<array_element: map<string, string ('array_element')>> ignored
INFO: Open of `/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/'
      using driver `Parquet' successful.

Layer name: theme=admins
Geometry: Unknown (any)
Feature Count: 96455
Extent: (-180.000000, -89.999900) - (180.000000, 89.999900)
Layer SRS WKT:
(unknown)
Geometry Column = geometry
id: String (0.0)
updatetime: String (0.0)
version: Integer (0.0)
adminlevel: Integer (0.0)
maritime: String (0.0)
subtype: String (0.0)
localitytype: String (0.0)
context: String (0.0)
isocountrycodealpha2: String (0.0)
isosubcountrycode: String (0.0)
defaultlanugage: String (0.0)
drivingside: String (0.0)
bbox.minx: Real (0.0)
bbox.maxx: Real (0.0)
bbox.miny: Real (0.0)
bbox.maxy: Real (0.0)
type: String (0.0)
OGRFeature(theme=admins):1
  id (String) = 85186a93fffffff1100000000000007
  updatetime (String) = 2023-05-28T00:18:08.062Z
  version (Integer) = 0
  adminlevel (Integer) = 4
  maritime (String) = (null)
  subtype (String) = (null)
  localitytype (String) = (null)
  context (String) = (null)
  isocountrycodealpha2 (String) = (null)
  isosubcountrycode (String) = (null)
  defaultlanugage (String) = (null)
  drivingside (String) = (null)
  bbox.minx (Real) = -0.6814001
  bbox.maxx (Real) = -0.6561592
  bbox.miny (Real) = 46.686869
  bbox.maxy (Real) = 46.7005651
  type (String) = administrativeBoundary
  LINESTRING (-0.6561592 46.7005651,-0.6576952 46.7001611,-0.6596517 46.6992552,-0.6607547 46.6986231,-0.661421 46.6981174,-0.6642916 46.6959388,-0.6664351 46.6949608,-0.6700295 46.6934809,-0.670524 46.6932773,-0.6719283 46.6922006,-0.6738641 46.6916239,-0.6749166 46.6910205,-0.6764343 46.6894853,-0.6767317 46.6893071,-0.6784728 46.688264,-0.6797574 46.6881753,-0.6807998 46.6873219,-0.6811768 46.6870573,-0.6814001 46.686869)


Mike


?On 7/28/23, 6:05 PM, "Michael Smith" <michael.smith.erdc at gmail.com <mailto:michael.smith.erdc at gmail.com>> wrote:


Paul,


I had to use 3.7.1 to have it read the geometry properly, 3.7.0 would read the directories.


docker run --rm -it ghcr.io/osgeo/gdal:ubuntu-full-latest ogrinfo /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins -al -so
Warning 1: Field names of unhandled type map<string, list<array_element: map<string, string ('array_element')>> ('names')> ignored
Warning 1: Field sources of unhandled type list<array_element: map<string, string ('array_element')>> ignored
INFO: Open of `/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins'
using driver `Parquet' successful.


Layer name: theme=admins
Geometry: Unknown (any)
Feature Count: 99403
Extent: (-180.000000, -89.999900) - (180.000000, 89.999900)
Layer SRS WKT:
(unknown)
Geometry Column = geometry
id: String (0.0)
updatetime: String (0.0)
version: Integer (0.0)
adminlevel: Integer (0.0)
maritime: String (0.0)
subtype: String (0.0)
localitytype: String (0.0)
context: String (0.0)
isocountrycodealpha2: String (0.0)
isosubcountrycode: String (0.0)
defaultlanugage: String (0.0)
drivingside: String (0.0)
bbox.minx: Real (0.0)
bbox.maxx: Real (0.0)
bbox.miny: Real (0.0)
bbox.maxy: Real (0.0)
type: String (0.0)


Mike




-- 


Michael Smith 
Remote Sensing/GIS Center 
US Army Corps of Engineers 












?On 7/28/23, 5:50 PM, "gdal-dev on behalf of Paul Ramsey" <gdal-dev-bounces at lists.osgeo.org <mailto:gdal-dev-bounces at lists.osgeo.org> <mailto:gdal-dev-bounces at lists.osgeo.org <mailto:gdal-dev-bounces at lists.osgeo.org>> on behalf of pramsey at cleverelephant.ca <mailto:pramsey at cleverelephant.ca> <mailto:pramsey at cleverelephant.ca <mailto:pramsey at cleverelephant.ca>>> wrote:




I am playing with accessing the Overture data dump, which is multiple
files in each S3 bucket. The doco says that as of 3.6 (check!), with
the libarrow_dataset build (check) I should be able to read directory
collections as layers, but no luck thus far:




AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/
AWS_REGION=us-west-2 AWS_NO_SIGN_REQUEST=YES ./ogrinfo
/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/




ogrinfo failed - unable to open
'/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/type=administrativeBoundary/'.




If I pick one of the constituent files in that directory, ogr can open
it up just fine, and we just have the array/map/list type issue that
Scott has raised in another thread. Is this expected, a result of the
access being via S3 rather than an actual filesystem directory?
Something else?




Thx,
P
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org> <mailto:gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>>
https://lists.osgeo.org/mailman/listinfo/gdal-dev <https://lists.osgeo.org/mailman/listinfo/gdal-dev> <https://lists.osgeo.org/mailman/listinfo/gdal-dev> <https://lists.osgeo.org/mailman/listinfo/gdal-dev&gt;>









From public at postholer.com  Fri Jul 28 15:19:09 2023
From: public at postholer.com (Scott)
Date: Fri, 28 Jul 2023 15:19:09 -0700
Subject: [gdal-dev] Directories and Parquet
In-Reply-To: <C45B54A8-FEF6-4019-BE1F-7B3D3DB22AE6@gmail.com>
References: <CACowWR08x=JwcvcV1qq3vG+cUKfXxY-1xx27fdccSgUDA+10cA@mail.gmail.com>
 <B762B2C7-A2AD-45C5-A461-FD4C89B8F8AF@gmail.com>
 <C45B54A8-FEF6-4019-BE1F-7B3D3DB22AE6@gmail.com>
Message-ID: <64668e13-b303-4692-4bec-1d52892afd9e@postholer.com>

For what it's worth, this is as far as I've gotten and it works:

ogr2ogr -dialect sqlite -sql @admins.sql -nln over -overwrite 
admins.gpkg /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0

I've got a cheat sheet set up with the sql at:
https://www.postholer.com/articles/Overature-Cheat-Sheet

On 7/28/23 15:14, Michael Smith wrote:
> Here's fetching the first admin boundary:
> 
> docker run --rm -it ghcr.io/osgeo/gdal:ubuntu-full-latest ogrinfo /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/  -where "type='administrativeBoundary'" -al  -fid 1
> Warning 1: Field names of unhandled type map<string, list<array_element: map<string, string ('array_element')>> ('names')> ignored
> Warning 1: Field sources of unhandled type list<array_element: map<string, string ('array_element')>> ignored
> INFO: Open of `/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins/'
>        using driver `Parquet' successful.
> 
> Layer name: theme=admins
> Geometry: Unknown (any)
> Feature Count: 96455
> Extent: (-180.000000, -89.999900) - (180.000000, 89.999900)
> Layer SRS WKT:
> (unknown)
> Geometry Column = geometry
> id: String (0.0)
> updatetime: String (0.0)
> version: Integer (0.0)
> adminlevel: Integer (0.0)
> maritime: String (0.0)
> subtype: String (0.0)
> localitytype: String (0.0)
> context: String (0.0)
> isocountrycodealpha2: String (0.0)
> isosubcountrycode: String (0.0)
> defaultlanugage: String (0.0)
> drivingside: String (0.0)
> bbox.minx: Real (0.0)
> bbox.maxx: Real (0.0)
> bbox.miny: Real (0.0)
> bbox.maxy: Real (0.0)
> type: String (0.0)
> OGRFeature(theme=admins):1
>    id (String) = 85186a93fffffff1100000000000007
>    updatetime (String) = 2023-05-28T00:18:08.062Z
>    version (Integer) = 0
>    adminlevel (Integer) = 4
>    maritime (String) = (null)
>    subtype (String) = (null)
>    localitytype (String) = (null)
>    context (String) = (null)
>    isocountrycodealpha2 (String) = (null)
>    isosubcountrycode (String) = (null)
>    defaultlanugage (String) = (null)
>    drivingside (String) = (null)
>    bbox.minx (Real) = -0.6814001
>    bbox.maxx (Real) = -0.6561592
>    bbox.miny (Real) = 46.686869
>    bbox.maxy (Real) = 46.7005651
>    type (String) = administrativeBoundary
>    LINESTRING (-0.6561592 46.7005651,-0.6576952 46.7001611,-0.6596517 46.6992552,-0.6607547 46.6986231,-0.661421 46.6981174,-0.6642916 46.6959388,-0.6664351 46.6949608,-0.6700295 46.6934809,-0.670524 46.6932773,-0.6719283 46.6922006,-0.6738641 46.6916239,-0.6749166 46.6910205,-0.6764343 46.6894853,-0.6767317 46.6893071,-0.6784728 46.688264,-0.6797574 46.6881753,-0.6807998 46.6873219,-0.6811768 46.6870573,-0.6814001 46.686869)
> 
> 
> Mike
> 
> 
> ?On 7/28/23, 6:05 PM, "Michael Smith" <michael.smith.erdc at gmail.com <mailto:michael.smith.erdc at gmail.com>> wrote:
> 
> 
> Paul,
> 
> 
> I had to use 3.7.1 to have it read the geometry properly, 3.7.0 would read the directories.
> 
> 
> docker run --rm -it ghcr.io/osgeo/gdal:ubuntu-full-latest ogrinfo /vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins -al -so
> Warning 1: Field names of unhandled type map<string, list<array_element: map<string, string ('array_element')>> ('names')> ignored
> Warning 1: Field sources of unhandled type list<array_element: map<string, string ('array_element')>> ignored
> INFO: Open of `/vsis3/overturemaps-us-west-2/release/2023-07-26-alpha.0/theme=admins'
> using driver `Parquet' successful.
> 
> 
> Layer name: theme=admins
> Geometry: Unknown (any)
> Feature Count: 99403
> Extent: (-180.000000, -89.999900) - (180.000000, 89.999900)
> Layer SRS WKT:
> (unknown)
> Geometry Column = geometry
> id: String (0.0)
> updatetime: String (0.0)
> version: Integer (0.0)
> adminlevel: Integer (0.0)
> maritime: String (0.0)
> subtype: String (0.0)
> localitytype: String (0.0)
> context: String (0.0)
> isocountrycodealpha2: String (0.0)
> isosubcountrycode: String (0.0)
> defaultlanugage: String (0.0)
> drivingside: String (0.0)
> bbox.minx: Real (0.0)
> bbox.maxx: Real (0.0)
> bbox.miny: Real (0.0)
> bbox.maxy: Real (0.0)
> type: String (0.0)
> 
> 
> Mike
> 
> 
> 
> 

From a.pau at creaf.uab.cat  Mon Jul 31 04:48:17 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 31 Jul 2023 11:48:17 +0000
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <AS8PR07MB8168280C7E4BB862BAA2583DA23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
 <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168D50BCEE675AC35183853A23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <cf6af5e1-bd79-4d82-ef2b-2f227b1ec71c@spatialys.com>
 <AS8PR07MB8168280C7E4BB862BAA2583DA23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <AS8PR07MB816818F4D1486E9B3A640A8DA205A@AS8PR07MB8168.eurprd07.prod.outlook.com>

Hi, here I am again.
Then, after all that information I have the next doubt: for what GetFeatureCount() is used for??
Thanks!

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau
Enviado el: divendres, 21 de juliol de 2023 19:38
Para: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] A question of eficiency

Ok,
It's just what happened when I programmed the read-from-Spatial-Oracle and write-in-our-format.
Our format have a main header, one header for every feature (so, as many as features in the layer) and after that have the geometric information.
In other files have the other information that comes from Fields. No prblem in that one.

I can use a not efficient but simple strategy: write every part in separate files and put all together on the correct place after finishing.

Thanks a lot for answering!


Abel Pau Garcia
T?cnic en SIG
[cid:image001.png at 01D9C3B5.AD279690]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Tel. +34 935814277
[cid:image002.png at 01D9C3B5.AD279690]

[cid:image003.png at 01D9C3B5.AD279690]<https://www.facebook.com/CREAFecologia/>[cid:image004.png at 01D9C3B5.AD279690]<https://twitter.com/CREAF_ecologia>[cid:image005.png at 01D9C3B5.AD279690]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[cid:image006.png at 01D9C3B5.AD279690]<https://www.youtube.com/c/creafecologia>[cid:image007.png at 01D9C3B5.AD279690]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[cid:image008.png at 01D9C3B5.AD279690]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Abans d'imprimir aquest missatge electr?nic penseu en el medi ambient.



De: Even Rouault<mailto:even.rouault at spatialys.com>
Enviat: divendres, 21 de juliol de 2023 19:32
Per a: Abel Pau<mailto:a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Tema: Re: [gdal-dev] A question of eficiency


Abel,

OK, I now better understand what you meant. Well, no, there's no way for the writing part of a driver to know how many features there are in the source layer, because in the general case, there is no source layer... Users could potentially call CreateFeature() without any source layer and without knowing in advance how many features they are going to write. Ideally your driver wouldn't need to know that, but I don't know the specificities of your format. If you really need to know the number of features before being able to write the file, the strategy would be that the ICreateFeature() method of your driver actually delegates writing those features to another GDAL driver (e.g GeoPackage) in a temporary file, and upon layer closing, you read back that temporary file to actually write your own file.

In some cases, ogr2ogr could potentially know in advance the number of features to be written and pass them to the output driver(as well as the extent typically), but:

- knowing the number of features can be a pretty slow operation for some input drivers , or when using a SQL statement

- and there's no such infrastructure currently

Even
Le 21/07/2023 ? 19:23, Abel Pau a ?crit :
Hello!

I've been trying to use the OGRLayer::GetFeatureCount() when I am reading another format inside the ICreateFeature() but I think it's impossible. At this point I don't have access to the layer info, so to the GetFeatureCount().
In fact I don't mind where to call this function but I need to call it in order to write our format efficiently (at least in most of cases).

So the question is, in my driver, when I read a format I get some information about the layer but I can't acces to the count of the features of the layer. I am right? If not, how I do that?

Thanks but before sending this mail I've been like hours trying to find it out debbuging and consulting the call stack from all points and nothing seems to indicate I can do that. But perhaps I am wrong.

It would be very helpful knowing that information. I not my writting strategy with change radically. Thankssssss!

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau
Enviado el: divendres, 7 de juliol de 2023 12:44
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] A question of eficiency

Hi again,

I can totally give this number in GetFeatureCount(). No problem from my driver to other.
Then I understand that in one way (efficient) or in another (no efficient) I can always get the number of features with the GetFeatureCount(). True?

About the other question imagine a multiline shape with two lines of two parts every line. I need to know the total count of individual lines (cause my driver doesn't have multiline and I have to convert every multiline to N lines). It is 4 (2+2). Can I get this number without asking every feature how many parts it have? I doubt that, but...

Thanks for your kind anwser!

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: divendres, 7 de juliol de 2023 12:32
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] A question of eficiency


Abel,

At the minimum for the reading side of a vector driver, you need to implement GetNextFeature().

If there is an efficient way of knowing the number of features without iterating over the whole file (typically a field in a header giving that number), you may implement GetFeatureCount(). If you don't implement it, and code using your driver needs the feature count, the generic implementation of OGRLayer::GetFeatureCount() will call GetNextFeature() repeatdly until it returns NULL.

Not totally sure to understand your question about multielements. If you have an instance of OGRGeometryCollection or any deriving class, there's a getNumGeometries() method to get the number of parts

Even
Le 07/07/2023 ? 11:33, Abel Pau a ?crit :
Hi,
I would like to know if when we use the code of GDAL to program a driver (or whatever) in vectors (so, ogr) we can assume that we can know the number of elements we are going to import in any way or it would be possible not knowing that until NextFeature is empty (or something like that). So, there is any way to obtain this number of elements without doing a while? And in case of multielements its possible to know how many parts are there in total?
I need that to write my format (I don't explain the details cause I don't get you bored :) )

If anyone know that I'd appreciate an answer. Thanks in advance.

Abel.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3936 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 4488 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 940 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 930 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 936 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0012.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 980 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0013.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.png
Type: image/png
Size: 1053 bytes
Desc: image007.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0014.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.png
Type: image/png
Size: 239 bytes
Desc: image008.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0015.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image009.gif
Type: image/gif
Size: 1185 bytes
Desc: image009.gif
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4def876f/attachment-0001.gif>

From lnicola at dend.ro  Mon Jul 31 06:24:19 2023
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Mon, 31 Jul 2023 16:24:19 +0300
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <AS8PR07MB816818F4D1486E9B3A640A8DA205A@AS8PR07MB8168.eurprd07.prod.outlook.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
 <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168D50BCEE675AC35183853A23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <cf6af5e1-bd79-4d82-ef2b-2f227b1ec71c@spatialys.com>
 <AS8PR07MB8168280C7E4BB862BAA2583DA23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB816818F4D1486E9B3A640A8DA205A@AS8PR07MB8168.eurprd07.prod.outlook.com>
Message-ID: <88da5a63-3dc7-41ca-a0e7-4754b7cb4b21@betaapp.fastmail.com>

Hi,

GetFeatureCount() exists for GDAL users, not for driver writers. For example, in QGIS, you can right-click on a layer, choose "Show Feature Count" and you'll see the number of features next to the layer name.

Or, to give another example, a hypothetical application could use it to display a progress bar during its execution (e.g. "processed 1500 out of 50 000 features").

Laurentiu

On Mon, Jul 31, 2023, at 14:48, Abel Pau wrote:
> Hi, here I am again.
> Then, after all that information I have the next doubt: for what GetFeatureCount() is used for??
> Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/4ba3f349/attachment.htm>

From a.pau at creaf.uab.cat  Mon Jul 31 06:37:47 2023
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 31 Jul 2023 13:37:47 +0000
Subject: [gdal-dev] A question of eficiency
In-Reply-To: <88da5a63-3dc7-41ca-a0e7-4754b7cb4b21@betaapp.fastmail.com>
References: <AS8PR07MB8168B3DB9A4C742DB424EAC6A22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <3cde0824-545e-1598-615e-8a418843b337@spatialys.com>
 <AS8PR07MB8168F60EF1AC0BA09A11F79BA22DA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB8168D50BCEE675AC35183853A23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <cf6af5e1-bd79-4d82-ef2b-2f227b1ec71c@spatialys.com>
 <AS8PR07MB8168280C7E4BB862BAA2583DA23FA@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <AS8PR07MB816818F4D1486E9B3A640A8DA205A@AS8PR07MB8168.eurprd07.prod.outlook.com>
 <88da5a63-3dc7-41ca-a0e7-4754b7cb4b21@betaapp.fastmail.com>
Message-ID: <AS8PR07MB81689364857A9BE4061B7A47A205A@AS8PR07MB8168.eurprd07.prod.outlook.com>

OOh, ok!!! Thanks!!

De: Lauren?iu Nicola <lnicola at dend.ro>
Enviado el: dilluns, 31 de juliol de 2023 15:24
Para: Abel Pau <a.pau at creaf.uab.cat>
CC: gdal-dev at lists.osgeo.org, <gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] A question of eficiency

Hi,

GetFeatureCount() exists for GDAL users, not for driver writers. For example, in QGIS, you can right-click on a layer, choose "Show Feature Count" and you'll see the number of features next to the layer name.

Or, to give another example, a hypothetical application could use it to display a progress bar during its execution (e.g. "processed 1500 out of 50 000 features").

Laurentiu

On Mon, Jul 31, 2023, at 14:48, Abel Pau wrote:

Hi, here I am again.

Then, after all that information I have the next doubt: for what GetFeatureCount() is used for??

Thanks!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20230731/b8e0ce27/attachment.htm>

