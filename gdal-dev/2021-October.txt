From even.rouault at spatialys.com  Fri Oct  1 03:09:04 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 1 Oct 2021 12:09:04 +0200
Subject: [gdal-dev] Problem accessing NASA Cloud Optimized GeoTIFF data
In-Reply-To: <CAHAWBU4hERm-CGoN47ZPDaM6AT6D+eZMXq7rOLKLwdiyq+6L9A@mail.gmail.com>
References: <CAHAWBU4hERm-CGoN47ZPDaM6AT6D+eZMXq7rOLKLwdiyq+6L9A@mail.gmail.com>
Message-ID: <1cbc0ee1-2143-278e-99fa-c556ded14698@spatialys.com>

Aaron,

I see a suspicious "* WARNING: failed to save cookies in ~/cookies.txt: 
Failed writing received data to disk/application" that comes from curl. 
I'm not sure if it is due to the ~/ not being expanded or something 
else. This might be dependent of your curl version.

Using --config CPL_VSIL_CURL_USE_HEAD FALSE is also needed for me with 
GDAL master on Ubuntu 20.04 / curl 7.68.0 to make your request work. The 
behavior of the HEAD request with CloudFront is quite strange (returning 
a 206 code)

If you use the very latest curl 7.79.0, you need to use GDAL master (or 
top of release/3.3 branch) to get 
https://github.com/OSGeo/gdal/pull/4502 , but while testing your use 
case, I realized this fix caused an issue with the 
CPL_VSIL_CURL_USE_HEAD=FALSE case, which is going to be fixed per 
https://github.com/OSGeo/gdal/pull/4578.

Even

Le 30/09/2021 ? 23:20, Aaron Friesz a ?crit?:
> Hi,
>
> I was recently updating the HLS tutorial to access version 2.0 and 
> discovered that the tutorial is no longer able to access the HLS data 
> in the cloud from a local Python environment. I've been trying to 
> troubleshoot for a couple days now with no positive results. The 
> failure can be boiled down to just accessing an HLS COG file using 
> rasterio in Python (note, a .netrc file with Earthdata login 
> credentials is needed to access data).
>
> ```
> import rasterio as rio
> import os
>
> s30_url = 
> 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSS30.020/HLS.S30.T13TEK.2021261T175011.v2.0/HLS.S30.T13TEK.2021261T175011.v2.0.B04.tif 
> <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSS30.020/HLS.S30.T13TEK.2021261T175011.v2.0/HLS.S30.T13TEK.2021261T175011.v2.0.B04.tif>'
>
> rio_env = rio.Env(GDAL_DISABLE_READDIR_ON_OPEN='EMPTY_DIR',
> ? ? ? ? ? ? ? ? ? #CPL_VSIL_CURL_ALLOWED_EXTENSIONS='tif',
> ? ? ? ? ? ? ? ? ? #CPL_VSIL_CURL_USE_HEAD='FALSE',
> ? ? ? ? ? ? ? ? ? CPL_DEBUG='ON',
> ? ? ? ? ? ? ? ? ? CPL_CURL_VERBOSE='ON',
> ? ? ? ? ? ? ? ? ? GDAL_HTTP_UNSAFESSL='YES',
> GDAL_HTTP_COOKIEFILE=os.path.expanduser('~/.edl_cookies'),
> GDAL_HTTP_COOKIEJAR=os.path.expanduser('~/.edl_cookies'))
>
> rio_env.__enter__()
>
> ds = rio.open(s30_url)
>
> ```
> While running a local python env (via conda) the result of the 
> rio.open() is a '206 status', which essentially fails the command. If 
> I add CPL_VSIL_CURL_USE_HEAD='FALSE' to the rio environment, I get a 
> 'file format not supported' error, which seems to be a red herring. 
> I'm curious if you've run into this type of thing before with COGs in 
> the cloud.
>
> The same behavior can be observed when just using the gdal command 
> line utilities.
> ```
> #without --config CPL_VSIL_CURL_USE_HEAD FALSE
> > gdalinfo 
> /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif 
> <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif> 
> --config GDAL_HTTP_COOKIEFILE ~/cookies.txt --config 
> GDAL_HTTP_COOKIEJAR ~/cookies.txt --config 
> GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON
>
> ...
> #output
> * Mark bundle as not supporting multiuse
> < HTTP/1.1 206 Partial Content
> < Content-Type: image/tiff
> < Content-Length: 1
> < Connection: keep-alive
> < Date: Thu, 30 Sep 2021 20:52:14 GMT
> < Last-Modified: Tue, 20 Jul 2021 20:27:33 GMT
> < ETag: "85d0b4b089083135d26188a51e187788-1"
> < x-amz-server-side-encryption: AES256
> < Accept-Ranges: bytes
> < Content-Range: bytes 0-0/14178318
> < Server: AmazonS3
> < X-Edge-Origin-Shield-Skipped: 0
> < X-Cache: Miss from cloudfront
> < Via: 1.1 130ce7c752c5865952ded89032560b33.cloudfront.net 
> <http://130ce7c752c5865952ded89032560b33.cloudfront.net> (CloudFront)
> < X-Amz-Cf-Pop: MIA3-C3
> < X-Amz-Cf-Id: qEq_2x3pF25dN5YMclkgRwhyTozXDexPdaQwOyJaI2VvIKhNnajozQ==
> <
> * Connection #1 to host d1nklfio7vscoe.cloudfront.net 
> <http://d1nklfio7vscoe.cloudfront.net> left intact
> ERROR 11: HTTP response code: 206
> gdalinfo failed - unable to open 
> '/vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif 
> <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif>'.
> ```
>
> ```
> #with --config CPL_VSIL_CURL_USE_HEAD FALSE
> > gdalinfo 
> /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif 
> <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif> 
> --config GDAL_HTTP_COOKIEFILE ~/cookies.txt --config 
> GDAL_HTTP_COOKIEJAR ~/cookies.txt --config 
> GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR? --config 
> CPL_VSIL_CURL_USE_HEAD FALSE --config CPL_CURL_VERBOSE ON
>
> ...
> #output
> * Mark bundle as not supporting multiuse
> < HTTP/1.1 200 OK
> < Content-Type: image/tiff
> < Content-Length: 14178318
> < Connection: keep-alive
> < Date: Thu, 30 Sep 2021 21:12:52 GMT
> < Last-Modified: Tue, 20 Jul 2021 20:27:33 GMT
> < ETag: "85d0b4b089083135d26188a51e187788-1"
> < x-amz-server-side-encryption: AES256
> < Accept-Ranges: bytes
> < Server: AmazonS3
> < X-Edge-Origin-Shield-Skipped: 0
> < X-Cache: Miss from cloudfront
> < Via: 1.1 8a771ca27e5a3c9e06b12b7af5d25aa4.cloudfront.net 
> <http://8a771ca27e5a3c9e06b12b7af5d25aa4.cloudfront.net> (CloudFront)
> < X-Amz-Cf-Pop: MIA3-C3
> < X-Amz-Cf-Id: Xzv3KWP6glYk68odo5d4KAPnzxsNUFjHRHe90EFXOKNGeYL3ea7jiA==
> * Failed writing header
> * Closing connection 2
> * schannel: shutting down SSL/TLS connection with 
> d1nklfio7vscoe.cloudfront.net <http://d1nklfio7vscoe.cloudfront.net> 
> port 443
> * WARNING: failed to save cookies in ~/cookies.txt: Failed writing 
> received data to disk/application
> ERROR 4: 
> `/vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif 
> <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif>' 
> not recognized as a supported file format.
> gdalinfo failed - unable to open 
> '/vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif 
> <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif>'.
> ```
>
> Strangely, I'm able to use the original rio/gdal configuration options 
> if I'm running the code in a cloud environment, that is:
>
> > gdalinfo 
> /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif 
> <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif> 
> --config GDAL_HTTP_COOKIEFILE ~/cookies.txt --config 
> GDAL_HTTP_COOKIEJAR ~/cookies.txt --config 
> GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON
>
> ...works fine in the USGS Pangeo and Openscapes 2i2c instance in 
> us-west2.? I get the failures on both Windows and MacOS, but my 
> colleagues seem to be able to run the code just fine from linux within 
> a Docker container.
>
> I've tried the gdalinfo commands using the gdal versions 3.1.4 through 
> 3.2.2. Oddly, v3.2.0 succeeds in printing out the gdalinfo content, 
> but I've been unable to create a conda environment with that version 
> of gdal.
>
> I'm talking to our NASA cloud team as well to see if there was 
> anything on the backend that changed recently just to cover that 
> angle. I'm hoping, though, that I'm missing something obvious in the 
> local configurations.
>
> Any guidance would be appreciated.
>
> -Aaron
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211001/a765c821/attachment-0001.html>

From amfriesz at gmail.com  Fri Oct  1 07:34:43 2021
From: amfriesz at gmail.com (Aaron Friesz)
Date: Fri, 1 Oct 2021 10:34:43 -0400
Subject: [gdal-dev] Problem accessing NASA Cloud Optimized GeoTIFF data
In-Reply-To: <1cbc0ee1-2143-278e-99fa-c556ded14698@spatialys.com>
References: <CAHAWBU4hERm-CGoN47ZPDaM6AT6D+eZMXq7rOLKLwdiyq+6L9A@mail.gmail.com>
 <1cbc0ee1-2143-278e-99fa-c556ded14698@spatialys.com>
Message-ID: <CAHAWBU68jTSTCd9D=_qTPe_jLDZ=U2kwhQXDJxP7PGWGPn9D1A@mail.gmail.com>

Hey Even,

Sorry, yeah, the cookies warning goes away if I add the full path. The rest
of the log stays the same though.

-Aaron

On Fri, Oct 1, 2021 at 6:09 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Aaron,
>
> I see a suspicious "* WARNING: failed to save cookies in ~/cookies.txt:
> Failed writing received data to disk/application" that comes from curl. I'm
> not sure if it is due to the ~/ not being expanded or something else. This
> might be dependent of your curl version.
>
> Using --config CPL_VSIL_CURL_USE_HEAD FALSE is also needed for me with
> GDAL master on Ubuntu 20.04 / curl 7.68.0 to make your request work. The
> behavior of the HEAD request with CloudFront is quite strange (returning a
> 206 code)
>
> If you use the very latest curl 7.79.0, you need to use GDAL master (or
> top of release/3.3 branch) to get https://github.com/OSGeo/gdal/pull/4502
> , but while testing your use case, I realized this fix caused an issue with
> the CPL_VSIL_CURL_USE_HEAD=FALSE case, which is going to be fixed per
> https://github.com/OSGeo/gdal/pull/4578.
>
> Even
> Le 30/09/2021 ? 23:20, Aaron Friesz a ?crit :
>
> Hi,
>
> I was recently updating the HLS tutorial to access version 2.0 and
> discovered that the tutorial is no longer able to access the HLS data in
> the cloud from a local Python environment. I've been trying to troubleshoot
> for a couple days now with no positive results. The failure can be boiled
> down to just accessing an HLS COG file using rasterio in Python (note, a
> .netrc file with Earthdata login credentials is needed to access data).
>
> ```
> import rasterio as rio
> import os
>
> s30_url = '
> https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSS30.020/HLS.S30.T13TEK.2021261T175011.v2.0/HLS.S30.T13TEK.2021261T175011.v2.0.B04.tif
> '
>
> rio_env = rio.Env(GDAL_DISABLE_READDIR_ON_OPEN='EMPTY_DIR',
>                   #CPL_VSIL_CURL_ALLOWED_EXTENSIONS='tif',
>                   #CPL_VSIL_CURL_USE_HEAD='FALSE',
>                   CPL_DEBUG='ON',
>                   CPL_CURL_VERBOSE='ON',
>                   GDAL_HTTP_UNSAFESSL='YES',
>
> GDAL_HTTP_COOKIEFILE=os.path.expanduser('~/.edl_cookies'),
>                   GDAL_HTTP_COOKIEJAR=os.path.expanduser('~/.edl_cookies'))
>
> rio_env.__enter__()
>
> ds = rio.open(s30_url)
>
> ```
> While running a local python env (via conda) the result of the rio.open()
> is a '206 status', which essentially fails the command. If I add
> CPL_VSIL_CURL_USE_HEAD='FALSE' to the rio environment, I get a 'file format
> not supported' error, which seems to be a red herring. I'm curious if
> you've run into this type of thing before with COGs in the cloud.
>
> The same behavior can be observed when just using the gdal command line
> utilities.
> ```
> #without --config CPL_VSIL_CURL_USE_HEAD FALSE
> > gdalinfo /vsicurl/
> https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif
> --config GDAL_HTTP_COOKIEFILE ~/cookies.txt --config GDAL_HTTP_COOKIEJAR
> ~/cookies.txt --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config
> CPL_CURL_VERBOSE ON
>
> ...
> #output
> * Mark bundle as not supporting multiuse
> < HTTP/1.1 206 Partial Content
> < Content-Type: image/tiff
> < Content-Length: 1
> < Connection: keep-alive
> < Date: Thu, 30 Sep 2021 20:52:14 GMT
> < Last-Modified: Tue, 20 Jul 2021 20:27:33 GMT
> < ETag: "85d0b4b089083135d26188a51e187788-1"
> < x-amz-server-side-encryption: AES256
> < Accept-Ranges: bytes
> < Content-Range: bytes 0-0/14178318
> < Server: AmazonS3
> < X-Edge-Origin-Shield-Skipped: 0
> < X-Cache: Miss from cloudfront
> < Via: 1.1 130ce7c752c5865952ded89032560b33.cloudfront.net (CloudFront)
> < X-Amz-Cf-Pop: MIA3-C3
> < X-Amz-Cf-Id: qEq_2x3pF25dN5YMclkgRwhyTozXDexPdaQwOyJaI2VvIKhNnajozQ==
> <
> * Connection #1 to host d1nklfio7vscoe.cloudfront.net left intact
> ERROR 11: HTTP response code: 206
> gdalinfo failed - unable to open '/vsicurl/
> https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif
> '.
> ```
>
> ```
> #with --config CPL_VSIL_CURL_USE_HEAD FALSE
> > gdalinfo /vsicurl/
> https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif
> --config GDAL_HTTP_COOKIEFILE ~/cookies.txt --config GDAL_HTTP_COOKIEJAR
> ~/cookies.txt --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR  --config
> CPL_VSIL_CURL_USE_HEAD FALSE --config CPL_CURL_VERBOSE ON
>
> ...
> #output
> * Mark bundle as not supporting multiuse
> < HTTP/1.1 200 OK
> < Content-Type: image/tiff
> < Content-Length: 14178318
> < Connection: keep-alive
> < Date: Thu, 30 Sep 2021 21:12:52 GMT
> < Last-Modified: Tue, 20 Jul 2021 20:27:33 GMT
> < ETag: "85d0b4b089083135d26188a51e187788-1"
> < x-amz-server-side-encryption: AES256
> < Accept-Ranges: bytes
> < Server: AmazonS3
> < X-Edge-Origin-Shield-Skipped: 0
> < X-Cache: Miss from cloudfront
> < Via: 1.1 8a771ca27e5a3c9e06b12b7af5d25aa4.cloudfront.net (CloudFront)
> < X-Amz-Cf-Pop: MIA3-C3
> < X-Amz-Cf-Id: Xzv3KWP6glYk68odo5d4KAPnzxsNUFjHRHe90EFXOKNGeYL3ea7jiA==
> * Failed writing header
> * Closing connection 2
> * schannel: shutting down SSL/TLS connection with
> d1nklfio7vscoe.cloudfront.net port 443
> * WARNING: failed to save cookies in ~/cookies.txt: Failed writing
> received data to disk/application
> ERROR 4: `/vsicurl/
> https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif'
> not recognized as a supported file format.
> gdalinfo failed - unable to open '/vsicurl/
> https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif
> '.
> ```
>
> Strangely, I'm able to use the original rio/gdal configuration options if
> I'm running the code in a cloud environment, that is:
>
> > gdalinfo /vsicurl/
> https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif
> --config GDAL_HTTP_COOKIEFILE ~/cookies.txt --config GDAL_HTTP_COOKIEJAR
> ~/cookies.txt --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config
> CPL_CURL_VERBOSE ON
>
> ...works fine in the USGS Pangeo and Openscapes 2i2c instance in
> us-west2.  I get the failures on both Windows and MacOS, but my colleagues
> seem to be able to run the code just fine from linux within a Docker
> container.
>
> I've tried the gdalinfo commands using the gdal versions 3.1.4 through
> 3.2.2. Oddly, v3.2.0 succeeds in printing out the gdalinfo content, but
> I've been unable to create a conda environment with that version of gdal.
>
> I'm talking to our NASA cloud team as well to see if there was anything on
> the backend that changed recently just to cover that angle. I'm hoping,
> though, that I'm missing something obvious in the local configurations.
>
> Any guidance would be appreciated.
>
> -Aaron
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211001/3a2619f1/attachment.html>

From nicholas.olsen0509 at gmail.com  Fri Oct  1 10:19:58 2021
From: nicholas.olsen0509 at gmail.com (Nicholas Olsen)
Date: Fri, 1 Oct 2021 12:19:58 -0500
Subject: [gdal-dev] osgeo/gdal Docker Container
Message-ID: <CACYhktb5DfuG_p2c2U8HhPKg5TkT7cd8TRtit29yyRKYQ5hw-A@mail.gmail.com>

Hello,
I'm trying to use the osgeo/gdal docker container and when I'm in the
container I'm unable to successfully run gdalwarp the way I would if I were
running it through OSGEO4Win or conda. It's returning this error:

gdalwarp -multi -wo NUM_THREADS=val/ALL_CPUS -t_srs EPSG:4326 DEM.tif
warped.tif

ERROR 6: Unable to load PROJ.4 library (libproj.so), creation of
OGRCoordinateTransformation failed.

I was hoping someone might have some suggestions.

Thank you very much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211001/504907ec/attachment.html>

From even.rouault at spatialys.com  Fri Oct  1 10:25:02 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 1 Oct 2021 19:25:02 +0200
Subject: [gdal-dev] osgeo/gdal Docker Container
In-Reply-To: <CACYhktb5DfuG_p2c2U8HhPKg5TkT7cd8TRtit29yyRKYQ5hw-A@mail.gmail.com>
References: <CACYhktb5DfuG_p2c2U8HhPKg5TkT7cd8TRtit29yyRKYQ5hw-A@mail.gmail.com>
Message-ID: <fb93f653-cc25-9072-bbeb-1610a248776d@spatialys.com>

This error message suggests that you're using a not super recent Docker 
image. "docker pull osgeo/gdal" to refresh it

Le 01/10/2021 ? 19:19, Nicholas Olsen a ?crit?:
> Hello,
> I'm trying to use the osgeo/gdal docker container and when I'm in the 
> container I'm unable to successfully run gdalwarp the way I would if I 
> were running it through OSGEO4Win?or conda. It's returning this error:
>
> gdalwarp -multi -wo NUM_THREADS=val/ALL_CPUS -t_srs EPSG:4326 DEM.tif 
> warped.tif
>
> ERROR 6: Unable to load PROJ.4 library (libproj.so), creation of
> OGRCoordinateTransformation failed.
>
> I was hoping someone might have some suggestions.
>
> Thank you very much.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211001/12548b03/attachment-0001.html>

From even.rouault at spatialys.com  Mon Oct  4 04:48:48 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 4 Oct 2021 13:48:48 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
Message-ID: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>

Hi,

Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that proposes:

- to develop a CMake build system, officially integrated in the source tree.

- and remove the current GNU makefiles and nmake build systems, when the 
CMake build system has matured enough and reached feature parity.

Best regards,

Een

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From runette at gmail.com  Mon Oct  4 05:41:34 2021
From: runette at gmail.com (Paul Harwood)
Date: Mon, 4 Oct 2021 13:41:34 +0100
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
Message-ID: <CAE8nN5P8WSbijsmHvxwHdGMNY0s-ZiQxQgSuXsZ3Bv38bVVKhw@mail.gmail.com>

I am not sure if I should be posting this here or on the bug - so I am
starting here.

The RFC does not mention (either positively or negatively) the SWIG
bindings.

Just for the avoidance of doubt :

- It should probably be made clear in the doc if the SWIG bindings are to
be included in the CMAKE build process, and

- I ask the question, in all innocence and without any prejudice on my
behalf or even idea of what the answer would be, since if there were to be
a better way of organising things then a major refactor of the build
process would be the correct time to implement it.

Paul

On Mon, 4 Oct 2021 at 12:49, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that
> proposes:
>
> - to develop a CMake build system, officially integrated in the source
> tree.
>
> - and remove the current GNU makefiles and nmake build systems, when the
> CMake build system has matured enough and reached feature parity.
>
> Best regards,
>
> Een
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211004/24873125/attachment.html>

From even.rouault at spatialys.com  Mon Oct  4 06:04:25 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 4 Oct 2021 15:04:25 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <CAE8nN5P8WSbijsmHvxwHdGMNY0s-ZiQxQgSuXsZ3Bv38bVVKhw@mail.gmail.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <CAE8nN5P8WSbijsmHvxwHdGMNY0s-ZiQxQgSuXsZ3Bv38bVVKhw@mail.gmail.com>
Message-ID: <e1546152-25d8-d5dc-59df-d2009025daf2@spatialys.com>

Paul,

that's a legitimate question indeed. There have indeed been discussions 
among devs if bindings would not better leave outside of the GDAL 
repository and have their own independent lives. That would conceivably 
be doable for the Java or CSharp bindings. More tricky for the Python 
bindings since we need them for the regression test suite.

Adopting a new build system is indeed the opportunity to raise several 
questions about the existing structure (folder organization, etc), but 
I'm afraid that if we try to change too many things at a times, this 
increases the risk of failure (or at least the time to achieve the 
result). My own position would be, at least in the scope of this RFC, to 
keep the bindings in the repo (excluding the Perl ones that will be 
removed in GDAL 3.5, in favor of the out-of-tree Perl FFI bindings) and 
build them through GDAL's main CMake.? CMake4GDAL has already support 
for that: 
https://github.com/miurahr/cmake4gdal/tree/master/cmakelists/gdal/swig

Even

Le 04/10/2021 ? 14:41, Paul Harwood a ?crit?:
> I am not sure if I should?be posting this here or on the bug - so I am 
> starting here.
>
> The RFC does not mention (either positively or negatively) the SWIG 
> bindings.
>
> Just for the avoidance of?doubt :
>
> - It should probably be made clear in the doc if the SWIG bindings are 
> to be included in the CMAKE build process, and
>
> - I ask the question, in all innocence and without any prejudice on my 
> behalf or even idea of what the answer would be, since if there were 
> to be a better way of organising things then a major refactor of the 
> build process would be the correct time to implement it.
>
> Paul
>
> On Mon, 4 Oct 2021 at 12:49, Even Rouault <even.rouault at spatialys.com 
> <mailto:even.rouault at spatialys.com>> wrote:
>
>     Hi,
>
>     Please find at https://github.com/OSGeo/gdal/pull/4590
>     <https://github.com/OSGeo/gdal/pull/4590> a RFC that proposes:
>
>     - to develop a CMake build system, officially integrated in the
>     source tree.
>
>     - and remove the current GNU makefiles and nmake build systems,
>     when the
>     CMake build system has matured enough and reached feature parity.
>
>     Best regards,
>
>     Een
>
>     -- 
>     http://www.spatialys.com <http://www.spatialys.com>
>     My software is free, but my time generally not.
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211004/0ec610eb/attachment.html>

From runette at gmail.com  Mon Oct  4 06:38:41 2021
From: runette at gmail.com (Paul Harwood)
Date: Mon, 4 Oct 2021 14:38:41 +0100
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <e1546152-25d8-d5dc-59df-d2009025daf2@spatialys.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <CAE8nN5P8WSbijsmHvxwHdGMNY0s-ZiQxQgSuXsZ3Bv38bVVKhw@mail.gmail.com>
 <e1546152-25d8-d5dc-59df-d2009025daf2@spatialys.com>
Message-ID: <CAE8nN5MJLKD+H-NjoGtYSXu=oL==4HJD+-NimL=rXV9JLg5rPg@mail.gmail.com>

I don't have a position - but I do think the RFC should mention which
solution it is proposing.

On Mon, 4 Oct 2021 at 14:04, Even Rouault <even.rouault at spatialys.com>
wrote:

> Paul,
>
> that's a legitimate question indeed. There have indeed been discussions
> among devs if bindings would not better leave outside of the GDAL
> repository and have their own independent lives. That would conceivably be
> doable for the Java or CSharp bindings. More tricky for the Python bindings
> since we need them for the regression test suite.
>
> Adopting a new build system is indeed the opportunity to raise several
> questions about the existing structure (folder organization, etc), but I'm
> afraid that if we try to change too many things at a times, this increases
> the risk of failure (or at least the time to achieve the result). My own
> position would be, at least in the scope of this RFC, to keep the bindings
> in the repo (excluding the Perl ones that will be removed in GDAL 3.5, in
> favor of the out-of-tree Perl FFI bindings) and build them through GDAL's
> main CMake.  CMake4GDAL has already support for that:
> https://github.com/miurahr/cmake4gdal/tree/master/cmakelists/gdal/swig
>
> Even
> Le 04/10/2021 ? 14:41, Paul Harwood a ?crit :
>
> I am not sure if I should be posting this here or on the bug - so I am
> starting here.
>
> The RFC does not mention (either positively or negatively) the SWIG
> bindings.
>
> Just for the avoidance of doubt :
>
> - It should probably be made clear in the doc if the SWIG bindings are to
> be included in the CMAKE build process, and
>
> - I ask the question, in all innocence and without any prejudice on my
> behalf or even idea of what the answer would be, since if there were to be
> a better way of organising things then a major refactor of the build
> process would be the correct time to implement it.
>
> Paul
>
> On Mon, 4 Oct 2021 at 12:49, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Hi,
>>
>> Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that
>> proposes:
>>
>> - to develop a CMake build system, officially integrated in the source
>> tree.
>>
>> - and remove the current GNU makefiles and nmake build systems, when the
>> CMake build system has matured enough and reached feature parity.
>>
>> Best regards,
>>
>> Een
>>
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211004/a4ccf5ac/attachment.html>

From even.rouault at spatialys.com  Mon Oct  4 08:30:30 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 4 Oct 2021 17:30:30 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <CAE8nN5MJLKD+H-NjoGtYSXu=oL==4HJD+-NimL=rXV9JLg5rPg@mail.gmail.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <CAE8nN5P8WSbijsmHvxwHdGMNY0s-ZiQxQgSuXsZ3Bv38bVVKhw@mail.gmail.com>
 <e1546152-25d8-d5dc-59df-d2009025daf2@spatialys.com>
 <CAE8nN5MJLKD+H-NjoGtYSXu=oL==4HJD+-NimL=rXV9JLg5rPg@mail.gmail.com>
Message-ID: <0c5a3563-d66b-4ff1-ab25-0bf22d3a740d@spatialys.com>


Le 04/10/2021 ? 15:38, Paul Harwood a ?crit?:
> I don't have a position - but I do think the RFC should mention which 
> solution?it is proposing.
I've just added one
>
> On Mon, 4 Oct 2021 at 14:04, Even Rouault <even.rouault at spatialys.com 
> <mailto:even.rouault at spatialys.com>> wrote:
>
>     Paul,
>
>     that's a legitimate question indeed. There have indeed been
>     discussions among devs if bindings would not better leave outside
>     of the GDAL repository and have their own independent lives. That
>     would conceivably be doable for the Java or CSharp bindings. More
>     tricky for the Python bindings since we need them for the
>     regression test suite.
>
>     Adopting a new build system is indeed the opportunity to raise
>     several questions about the existing structure (folder
>     organization, etc), but I'm afraid that if we try to change too
>     many things at a times, this increases the risk of failure (or at
>     least the time to achieve the result). My own position would be,
>     at least in the scope of this RFC, to keep the bindings in the
>     repo (excluding the Perl ones that will be removed in GDAL 3.5, in
>     favor of the out-of-tree Perl FFI bindings) and build them through
>     GDAL's main CMake.? CMake4GDAL has already support for that:
>     https://github.com/miurahr/cmake4gdal/tree/master/cmakelists/gdal/swig
>     <https://github.com/miurahr/cmake4gdal/tree/master/cmakelists/gdal/swig>
>
>     Even
>
>     Le 04/10/2021 ? 14:41, Paul Harwood a ?crit?:
>>     I am not sure if I should?be posting this here or on the bug - so
>>     I am starting here.
>>
>>     The RFC does not mention (either positively or negatively) the
>>     SWIG bindings.
>>
>>     Just for the avoidance of?doubt :
>>
>>     - It should probably be made clear in the doc if the SWIG
>>     bindings are to be included in the CMAKE build process, and
>>
>>     - I ask the question, in all innocence and without any prejudice
>>     on my behalf or even idea of what the answer would be, since if
>>     there were to be a better way of organising things then a major
>>     refactor of the build process would be the correct time to
>>     implement it.
>>
>>     Paul
>>
>>     On Mon, 4 Oct 2021 at 12:49, Even Rouault
>>     <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>>
>>     wrote:
>>
>>         Hi,
>>
>>         Please find at https://github.com/OSGeo/gdal/pull/4590
>>         <https://github.com/OSGeo/gdal/pull/4590> a RFC that proposes:
>>
>>         - to develop a CMake build system, officially integrated in
>>         the source tree.
>>
>>         - and remove the current GNU makefiles and nmake build
>>         systems, when the
>>         CMake build system has matured enough and reached feature parity.
>>
>>         Best regards,
>>
>>         Een
>>
>>         -- 
>>         http://www.spatialys.com <http://www.spatialys.com>
>>         My software is free, but my time generally not.
>>
>>         _______________________________________________
>>         gdal-dev mailing list
>>         gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>         <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>>
>     -- 
>     http://www.spatialys.com  <http://www.spatialys.com>
>     My software is free, but my time generally not.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211004/8f9e7af9/attachment-0001.html>

From schwehr at gmail.com  Mon Oct  4 12:28:37 2021
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 4 Oct 2021 12:28:37 -0700
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <0c5a3563-d66b-4ff1-ab25-0bf22d3a740d@spatialys.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <CAE8nN5P8WSbijsmHvxwHdGMNY0s-ZiQxQgSuXsZ3Bv38bVVKhw@mail.gmail.com>
 <e1546152-25d8-d5dc-59df-d2009025daf2@spatialys.com>
 <CAE8nN5MJLKD+H-NjoGtYSXu=oL==4HJD+-NimL=rXV9JLg5rPg@mail.gmail.com>
 <0c5a3563-d66b-4ff1-ab25-0bf22d3a740d@spatialys.com>
Message-ID: <CACmBxyugLaD0owbRAtEVFeUMoTC3UfYho5pVOngBmvvnCJpC3w@mail.gmail.com>

I am strongly in favor of CMake for GDAL with this RFC.  I was slightly
approsed in prior proposals for CMake.

Some supporting tidbits:

   - There is much support in IDEs for CMake -
   https://gitlab.kitware.com/cmake/community/-/wikis/doc/Editors
   - As a maintainer of an out-of-tree bazel based build for GDAL, I think
   that it's not a good solution for GDAL.  bazel is about build speed and
   simplicity.  It makes it hard to have large numbers of selectable options
   beyond general compiler options.  It's also fairly easy to keep my own
   bazel build.
   - The more I try to use autoconf, automake, and related, the more
   frustrated I get with them.
   - cmake + ninja on machines with larger number of cores is really
   awesomely fast

Having folks working in the core wanting to move to CMake and the PROJ,
GEOS, and others switching puts me firmly in support of this RFC.  CMake,
like every other build system, is definitely weird, but I agree that it's
one of the "least weird".

I want to say thank you to all the folks who have worked on CMake for
GDAL.  Taking a quick peek at cmake4gdal, I would suggest that a lot more
drivers should be switched from using gdal_format to gdal_optional_format.
There are folks (e.g. me!) who prefer to have the bare minimum of drivers
built.  e.g. one of my builds:

gdal_translate --formats | wc -l
21
blaze-bin/third_party/gdal/ogr2ogr --formats | wc -l
20


And really, I should make those smaller.  I know that some of the required
formats are required mostly for autotest.  I'd be be interested in working
on getting the minimum footprint down once things are switched to CMake.

On Mon, Oct 4, 2021 at 8:31 AM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 04/10/2021 ? 15:38, Paul Harwood a ?crit :
>
> I don't have a position - but I do think the RFC should mention which
> solution it is proposing.
>
> I've just added one
>
>
> On Mon, 4 Oct 2021 at 14:04, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Paul,
>>
>> that's a legitimate question indeed. There have indeed been discussions
>> among devs if bindings would not better leave outside of the GDAL
>> repository and have their own independent lives. That would conceivably be
>> doable for the Java or CSharp bindings. More tricky for the Python bindings
>> since we need them for the regression test suite.
>>
>> Adopting a new build system is indeed the opportunity to raise several
>> questions about the existing structure (folder organization, etc), but I'm
>> afraid that if we try to change too many things at a times, this increases
>> the risk of failure (or at least the time to achieve the result). My own
>> position would be, at least in the scope of this RFC, to keep the bindings
>> in the repo (excluding the Perl ones that will be removed in GDAL 3.5, in
>> favor of the out-of-tree Perl FFI bindings) and build them through GDAL's
>> main CMake.  CMake4GDAL has already support for that:
>> https://github.com/miurahr/cmake4gdal/tree/master/cmakelists/gdal/swig
>>
>> Even
>> Le 04/10/2021 ? 14:41, Paul Harwood a ?crit :
>>
>> I am not sure if I should be posting this here or on the bug - so I am
>> starting here.
>>
>> The RFC does not mention (either positively or negatively) the SWIG
>> bindings.
>>
>> Just for the avoidance of doubt :
>>
>> - It should probably be made clear in the doc if the SWIG bindings are to
>> be included in the CMAKE build process, and
>>
>> - I ask the question, in all innocence and without any prejudice on my
>> behalf or even idea of what the answer would be, since if there were to be
>> a better way of organising things then a major refactor of the build
>> process would be the correct time to implement it.
>>
>> Paul
>>
>> On Mon, 4 Oct 2021 at 12:49, Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> Hi,
>>>
>>> Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that
>>> proposes:
>>>
>>> - to develop a CMake build system, officially integrated in the source
>>> tree.
>>>
>>> - and remove the current GNU makefiles and nmake build systems, when the
>>> CMake build system has matured enough and reached feature parity.
>>>
>>> Best regards,
>>>
>>> Een
>>>
>>> --
>>> http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211004/87739335/attachment.html>

From thomas.bonfort at gmail.com  Tue Oct  5 00:29:32 2021
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Tue, 5 Oct 2021 09:29:32 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <CACmBxyugLaD0owbRAtEVFeUMoTC3UfYho5pVOngBmvvnCJpC3w@mail.gmail.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <CAE8nN5P8WSbijsmHvxwHdGMNY0s-ZiQxQgSuXsZ3Bv38bVVKhw@mail.gmail.com>
 <e1546152-25d8-d5dc-59df-d2009025daf2@spatialys.com>
 <CAE8nN5MJLKD+H-NjoGtYSXu=oL==4HJD+-NimL=rXV9JLg5rPg@mail.gmail.com>
 <0c5a3563-d66b-4ff1-ab25-0bf22d3a740d@spatialys.com>
 <CACmBxyugLaD0owbRAtEVFeUMoTC3UfYho5pVOngBmvvnCJpC3w@mail.gmail.com>
Message-ID: <CAOM3y2ib2Tq=md1BHpUPptVBcsKKHzyuNGVHXsq3iBA+BuEppA@mail.gmail.com>

> And really, I should make those smaller.  I know that some of the required formats are required mostly for autotest.  I'd be be interested in working on getting the minimum footprint down once things are switched to CMake.

The autotools build already supports minimal builds, with the list of
mandatory formats being:

gdalinfo --formats
Supported Formats:
  VRT -raster,multidimensional raster- (rw+v): Virtual Raster
  DERIVED -raster- (ro): Derived datasets using VRT pixel functions
  GTiff -raster- (rw+vs): GeoTIFF
  COG -raster- (wv): Cloud optimized GeoTIFF generator
  HFA -raster- (rw+v): Erdas Imagine Images (.img)
  JPEG -raster- (rwv): JPEG JFIF
  MEM -raster,multidimensional raster- (rw+): In Memory Raster
(JPEG could also technically be removed but I've kept it here for jpeg-in-tiff)

ogrinfo --formats
Supported Formats:
  MapInfo File -vector- (rw+v): MapInfo File
  OGR_VRT -vector- (rov): VRT - Virtual Datasource
  Memory -vector- (rw+): Memory
  KML -vector- (rw+v): Keyhole Markup Language (KML)
  GeoJSON -vector- (rw+v): GeoJSON
  GeoJSONSeq -vector- (rw+v): GeoJSON Sequence
  ESRIJSON -vector- (rov): ESRIJSON
  TopoJSON -vector- (rov): TopoJSON

From gdt at lexort.com  Tue Oct  5 05:50:56 2021
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 05 Oct 2021 08:50:56 -0400
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com> (Even
 Rouault's message of "Mon, 4 Oct 2021 13:48:48 +0200")
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
Message-ID: <rmipmsjmy8f.fsf@s1.lexort.com>


Even Rouault <even.rouault at spatialys.com> writes:

> Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that proposes:
>
> - to develop a CMake build system, officially integrated in the source tree.
>
> - and remove the current GNU makefiles and nmake build systems, when
> the CMake build system has matured enough and reached feature parity.

I added a comment that requirements should be stated and gave a first
cut at them.  My big problem with cmake from packaging is that people
write CMakefile code with OS-specific tests instead of feature tests and
then packagers have to add lots of patches that add OS names to
conditionals.  So the requireents should ban that practice in favor of
feature tests.

The other big comment is that "matured enough" is not just for what the
project can test on CI, but the entire packaging world, so I included
having a formal release with cmake where autoconf is marked deprecated
for packagers to try to make work, so those issues can be fixed before a
release without autoconf.  I get it that the project has CI for what
they have, but I don't think that requirements should be driven by what
CI exists.

I'm willing to test on alpha/beta/rc; I can create a
separate/work-in-progress package that is gdal alpha built with cmake,
to flush out these things.




-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/6532016d/attachment.sig>

From gdt at lexort.com  Tue Oct  5 06:10:56 2021
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 05 Oct 2021 09:10:56 -0400
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>
 (Javier Jimenez Shaw's message of "Tue, 5 Oct 2021 15:09:11 +0200")
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <rmipmsjmy8f.fsf@s1.lexort.com>
 <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>
Message-ID: <rmilf37mxb3.fsf@s1.lexort.com>


Javier Jimenez Shaw <j1 at jimenezshaw.com> writes:

> How would CMake behave with all those options that are defined depending on
> what is present on the compiler machine?
>
> IMHO, the libraries included should be independent on what is already
> installed on the compiler machine. The last time something/somebody
> included "zstd" in our compiler machine, and not in the executing machine,
> and we couldn't run anything. We did not need zstd, but it was there,
> breaking the execution. I know that the solution there is disable it
> "--without-zstd". What I do not like is the lack of definition, because
> what is present on the compiler machine may change.

I agree that is is best for a build to hard-require what is required and
decline to use things that are not required.   I don't think this issue
is any different autoconf vs cmake.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/cf2296d6/attachment.sig>

From j1 at jimenezshaw.com  Tue Oct  5 06:09:11 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 5 Oct 2021 15:09:11 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <rmipmsjmy8f.fsf@s1.lexort.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <rmipmsjmy8f.fsf@s1.lexort.com>
Message-ID: <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>

How would CMake behave with all those options that are defined depending on
what is present on the compiler machine?

IMHO, the libraries included should be independent on what is already
installed on the compiler machine. The last time something/somebody
included "zstd" in our compiler machine, and not in the executing machine,
and we couldn't run anything. We did not need zstd, but it was there,
breaking the execution. I know that the solution there is disable it
"--without-zstd". What I do not like is the lack of definition, because
what is present on the compiler machine may change.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Tue, 5 Oct 2021 at 14:51, Greg Troxel <gdt at lexort.com> wrote:

>
> Even Rouault <even.rouault at spatialys.com> writes:
>
> > Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that
> proposes:
> >
> > - to develop a CMake build system, officially integrated in the source
> tree.
> >
> > - and remove the current GNU makefiles and nmake build systems, when
> > the CMake build system has matured enough and reached feature parity.
>
> I added a comment that requirements should be stated and gave a first
> cut at them.  My big problem with cmake from packaging is that people
> write CMakefile code with OS-specific tests instead of feature tests and
> then packagers have to add lots of patches that add OS names to
> conditionals.  So the requireents should ban that practice in favor of
> feature tests.
>
> The other big comment is that "matured enough" is not just for what the
> project can test on CI, but the entire packaging world, so I included
> having a formal release with cmake where autoconf is marked deprecated
> for packagers to try to make work, so those issues can be fixed before a
> release without autoconf.  I get it that the project has CI for what
> they have, but I don't think that requirements should be driven by what
> CI exists.
>
> I'm willing to test on alpha/beta/rc; I can create a
> separate/work-in-progress package that is gdal alpha built with cmake,
> to flush out these things.
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/603ee9f2/attachment-0001.html>

From j1 at jimenezshaw.com  Tue Oct  5 06:24:05 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 5 Oct 2021 15:24:05 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <rmilf37mxb3.fsf@s1.lexort.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <rmipmsjmy8f.fsf@s1.lexort.com>
 <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>
 <rmilf37mxb3.fsf@s1.lexort.com>
Message-ID: <CADRrdKtEHtRj+1Sj=ShbYNxbuLO-VJRGvETYqk8Suz1PYqwv2w@mail.gmail.com>

I also accept some included by default, that can be disabled with an
option. But never silently depending on what is installed.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Tue, 5 Oct 2021 at 15:11, Greg Troxel <gdt at lexort.com> wrote:

>
> Javier Jimenez Shaw <j1 at jimenezshaw.com> writes:
>
> > How would CMake behave with all those options that are defined depending
> on
> > what is present on the compiler machine?
> >
> > IMHO, the libraries included should be independent on what is already
> > installed on the compiler machine. The last time something/somebody
> > included "zstd" in our compiler machine, and not in the executing
> machine,
> > and we couldn't run anything. We did not need zstd, but it was there,
> > breaking the execution. I know that the solution there is disable it
> > "--without-zstd". What I do not like is the lack of definition, because
> > what is present on the compiler machine may change.
>
> I agree that is is best for a build to hard-require what is required and
> decline to use things that are not required.   I don't think this issue
> is any different autoconf vs cmake.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/ed9322a6/attachment.html>

From aborruso at gmail.com  Tue Oct  5 06:42:17 2021
From: aborruso at gmail.com (andy)
Date: Tue, 5 Oct 2021 15:42:17 +0200
Subject: [gdal-dev] Not able to use gdal_translate and a TMS source
Message-ID: <CAHEdGZN4cx8PFSnkVYCedGrw1nu-pRoKqr4JnSqRX1-0PFdH=Q@mail.gmail.com>

Hi,
in QGIS I have set this XYZ source:
https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png
QGIS renders it properly.

I have created this GDAL source

<GDAL_WMS>
    <Service name="TMS">
        <ServerUrl>https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png
</ServerUrl>
    </Service>
    <DataWindow>
        <UpperLeftX>-20037508.34</UpperLeftX>
        <UpperLeftY>20037508.34</UpperLeftY>
        <LowerRightX>20037508.34</LowerRightX>
        <LowerRightY>-20037508.34</LowerRightY>
        <TileLevel>18</TileLevel>
        <TileCountX>1</TileCountX>
        <TileCountY>1</TileCountY>
        <YOrigin>top</YOrigin>
    </DataWindow>
    <Projection>EPSG:900913</Projection>
    <BlockSizeX>256</BlockSizeX>
    <BlockSizeY>256</BlockSizeY>
    <BandsCount>3</BandsCount>
    <Cache />
<ZeroBlockHttpCodes>204,404</ZeroBlockHttpCodes>
</GDAL_WMS>

But if run

gdal_translate --debug ON -of PNG -projwin 5203413 2847209 5221042 2829459
-outsize 512 512 osm-no-labels.xml openstreetmap.png

I have a black PNG.

The debug shows me a wrong HTTP call (the below one), but I do not know how
to modify my xml source to be able to run right requests.

HTTP: Request [1]
https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png/1.0.0//12/2580/1758.jpg

What's wrong in my settings?

Thank you

-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/9b8908b0/attachment.html>

From andrew at aitchison.me.uk  Tue Oct  5 06:46:12 2021
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 5 Oct 2021 14:46:12 +0100 (BST)
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
Message-ID: <c6fb659e-9995-4dec-11a6-5abb585bbb39@aitchison.me.uk>

On Mon, 4 Oct 2021, Even Rouault wrote:

> Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that proposes:
>
> - to develop a CMake build system, officially integrated in the source tree.
>
> - and remove the current GNU makefiles and nmake build systems, when the 
> CMake build system has matured enough and reached feature parity.

I guess that means that an option for builders to configuring drivers as
 	builtin / plugin / not included
is out of scope (not present in current system).
If someone is going through all the drivers it might make sense to
do this at the same time, or at least design things so that
only a central change is needed to enable it for all drivers ?

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From even.rouault at spatialys.com  Tue Oct  5 06:55:18 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 5 Oct 2021 15:55:18 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <CADRrdKtEHtRj+1Sj=ShbYNxbuLO-VJRGvETYqk8Suz1PYqwv2w@mail.gmail.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <rmipmsjmy8f.fsf@s1.lexort.com>
 <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>
 <rmilf37mxb3.fsf@s1.lexort.com>
 <CADRrdKtEHtRj+1Sj=ShbYNxbuLO-VJRGvETYqk8Suz1PYqwv2w@mail.gmail.com>
Message-ID: <381c47f8-e8e0-10e9-c988-ca567b886be0@spatialys.com>


Le 05/10/2021 ? 15:24, Javier Jimenez Shaw a ?crit?:
> I also accept some included by default, that can be disabled with an 
> option. But never silently depending on what is installed.

autoconf builds largely automatically uses installed things when they 
are in standard locations. That's the practice of most other projects, 
which is very convenient, and that should be kept. The only requirement 
for GDAL is PROJ, but if you don't have libcurl, libexpat, etc., you 
loose a lot of functionality, and requiring users to list all them would 
be painful.

For most packaging system, the set of dependencies available at build 
time is fully controlled by the package requirements. We can assume that 
whatever if available is wished to be used, and ideally a plain "cmake 
.." should automatically find what is available. And if the packager 
properly enumerates its build-time and run-time dependencies, that 
should work.

People can explicitly disable a dependency they don't want. We could 
perhaps have some option to disable everything by default, and require 
explicit activation in use cases where people want full control, but 
that shouldn't be the default behavior.


> .___ ._ ..._ .. . ._. .___ .. __ . _. . __..? ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
> On Tue, 5 Oct 2021 at 15:11, Greg Troxel <gdt at lexort.com 
> <mailto:gdt at lexort.com>> wrote:
>
>
>     Javier Jimenez Shaw <j1 at jimenezshaw.com
>     <mailto:j1 at jimenezshaw.com>> writes:
>
>     > How would CMake behave with all those options that are defined
>     depending on
>     > what is present on the compiler machine?
>     >
>     > IMHO, the libraries included should be independent on what is
>     already
>     > installed on the compiler machine. The last time something/somebody
>     > included "zstd" in our compiler machine, and not in the
>     executing machine,
>     > and we couldn't run anything. We did not need zstd, but it was
>     there,
>     > breaking the execution. I know that the solution there is disable it
>     > "--without-zstd". What I do not like is the lack of definition,
>     because
>     > what is present on the compiler machine may change.
>
>     I agree that is is best for a build to hard-require what is
>     required and
>     decline to use things that are not required.? ?I don't think this
>     issue
>     is any different autoconf vs cmake.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/d32b80ff/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Oct  5 06:57:18 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 5 Oct 2021 13:57:18 +0000
Subject: [gdal-dev] Not able to use gdal_translate and a TMS source
In-Reply-To: <CAHEdGZN4cx8PFSnkVYCedGrw1nu-pRoKqr4JnSqRX1-0PFdH=Q@mail.gmail.com>
References: <CAHEdGZN4cx8PFSnkVYCedGrw1nu-pRoKqr4JnSqRX1-0PFdH=Q@mail.gmail.com>
Message-ID: <f3ac73fcc2574b1d89fd972caa9d00ef@maanmittauslaitos.fi>

Hi,

There is not so much wrong, you should just read https://gdal.org/drivers/raster/wms.html more carefully and write server URL this way:

  <ServerUrl>https://tiles.wmflabs.org/osm-no-labels/${z}/${x}/${y}.png</ServerUrl>

-Jukka Rahkonen-




L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta andy
L?hetetty: tiistai 5. lokakuuta 2021 16.42
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Not able to use gdal_translate and a TMS source

Hi,
in QGIS I have set this XYZ source: https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png<https://tiles.wmflabs.org/osm-no-labels/%7bz%7d/%7bx%7d/%7by%7d.png>
QGIS renders it properly.

I have created this GDAL source

<GDAL_WMS>
    <Service name="TMS">
        <ServerUrl>https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png<https://tiles.wmflabs.org/osm-no-labels/%7bz%7d/%7bx%7d/%7by%7d.png></ServerUrl>
    </Service>
    <DataWindow>
        <UpperLeftX>-20037508.34</UpperLeftX>
        <UpperLeftY>20037508.34</UpperLeftY>
        <LowerRightX>20037508.34</LowerRightX>
        <LowerRightY>-20037508.34</LowerRightY>
        <TileLevel>18</TileLevel>
        <TileCountX>1</TileCountX>
        <TileCountY>1</TileCountY>
        <YOrigin>top</YOrigin>
    </DataWindow>
    <Projection>EPSG:900913</Projection>
    <BlockSizeX>256</BlockSizeX>
    <BlockSizeY>256</BlockSizeY>
    <BandsCount>3</BandsCount>
    <Cache />
<ZeroBlockHttpCodes>204,404</ZeroBlockHttpCodes>
</GDAL_WMS>

But if run

gdal_translate --debug ON -of PNG -projwin 5203413 2847209 5221042 2829459 -outsize 512 512 osm-no-labels.xml openstreetmap.png

I have a black PNG.

The debug shows me a wrong HTTP call (the below one), but I do not know how to modify my xml source to be able to run right requests.

HTTP: Request [1] https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png/1.0.0//12/2580/1758.jpg<https://tiles.wmflabs.org/osm-no-labels/%7bz%7d/%7bx%7d/%7by%7d.png/1.0.0/12/2580/1758.jpg>

What's wrong in my settings?

Thank you

--
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/4bf82aad/attachment-0001.html>

From aborruso at gmail.com  Tue Oct  5 07:00:35 2021
From: aborruso at gmail.com (andy)
Date: Tue, 5 Oct 2021 16:00:35 +0200
Subject: [gdal-dev] Not able to use gdal_translate and a TMS source
In-Reply-To: <f3ac73fcc2574b1d89fd972caa9d00ef@maanmittauslaitos.fi>
References: <CAHEdGZN4cx8PFSnkVYCedGrw1nu-pRoKqr4JnSqRX1-0PFdH=Q@mail.gmail.com>
 <f3ac73fcc2574b1d89fd972caa9d00ef@maanmittauslaitos.fi>
Message-ID: <CAHEdGZM8pBNEpAXPQay9M3JW2nuWnKVQkRox6tJUKDZ7R+zp2w@mail.gmail.com>

You are right, I don't have to drink beer in the afternoon:)

Thank you very much

On Tue, 5 Oct 2021 at 15:57, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> There is not so much wrong, you should just read
> https://gdal.org/drivers/raster/wms.html more carefully and write server
> URL this way:
>
>
>
>   <ServerUrl>https://tiles.wmflabs.org/osm-no-labels/${z}/${x}/${y}.png
> </ServerUrl>
>
>
>
> -Jukka Rahkonen-
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *andy
> *L?hetetty:* tiistai 5. lokakuuta 2021 16.42
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] Not able to use gdal_translate and a TMS source
>
>
>
> Hi,
>
> in QGIS I have set this XYZ source:
> https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png
>
> QGIS renders it properly.
>
>
>
> I have created this GDAL source
>
>
>
> <GDAL_WMS>
>     <Service name="TMS">
>         <ServerUrl>https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png
> </ServerUrl>
>     </Service>
>     <DataWindow>
>         <UpperLeftX>-20037508.34</UpperLeftX>
>         <UpperLeftY>20037508.34</UpperLeftY>
>         <LowerRightX>20037508.34</LowerRightX>
>         <LowerRightY>-20037508.34</LowerRightY>
>         <TileLevel>18</TileLevel>
>         <TileCountX>1</TileCountX>
>         <TileCountY>1</TileCountY>
>         <YOrigin>top</YOrigin>
>     </DataWindow>
>     <Projection>EPSG:900913</Projection>
>     <BlockSizeX>256</BlockSizeX>
>     <BlockSizeY>256</BlockSizeY>
>     <BandsCount>3</BandsCount>
>     <Cache />
> <ZeroBlockHttpCodes>204,404</ZeroBlockHttpCodes>
> </GDAL_WMS>
>
>
>
> But if run
>
>
>
> gdal_translate --debug ON -of PNG -projwin 5203413 2847209 5221042 2829459
> -outsize 512 512 osm-no-labels.xml openstreetmap.png
>
>
>
> I have a black PNG.
>
>
>
> The debug shows me a wrong HTTP call (the below one), but I do not know
> how to modify my xml source to be able to run right requests.
>
>
>
> HTTP: Request [1]
> https://tiles.wmflabs.org/osm-no-labels/{z}/{x}/{y}.png/1.0.0//12/2580/1758.jpg
> <https://tiles.wmflabs.org/osm-no-labels/%7bz%7d/%7bx%7d/%7by%7d.png/1.0.0/12/2580/1758.jpg>
>
>
>
> What's wrong in my settings?
>
>
>
> Thank you
>
>
>
> --
>
> ___________________
>
>
>
> Andrea Borruso
> website: https://medium.com/tantotanto
> 38? 7' 48" N, 13? 21' 9" E, EPSG:4326
> ___________________
>
> "cercare e saper riconoscere chi e cosa,
>  in mezzo all?inferno, non ? inferno,
> e farlo durare, e dargli spazio"
>
> Italo Calvino
>


-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/fcdd8c4a/attachment.html>

From even.rouault at spatialys.com  Tue Oct  5 07:04:38 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 5 Oct 2021 16:04:38 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <c6fb659e-9995-4dec-11a6-5abb585bbb39@aitchison.me.uk>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <c6fb659e-9995-4dec-11a6-5abb585bbb39@aitchison.me.uk>
Message-ID: <a7bb34cb-e8c1-ecf4-fcdb-73c374fdeb15@spatialys.com>


> I guess that means that an option for builders to configuring drivers as
> ????builtin / plugin / not included
> is out of scope (not present in current system).
> If someone is going through all the drivers it might make sense to
> do this at the same time, or at least design things so that
> only a central change is needed to enable it for all drivers ?
>
The main objective is to reach reasonable-enough feature parity, but 
that'll certainly be the oppurtunity to add new capabilities.

What you mention is something I've in mind, and cmake4gdal has already 
existing functions to control how/which drivers are built: 
https://github.com/miurahr/cmake4gdal/blob/master/helpers/GdalDriverHelper.cmake

It will certainly require some further tunings. There are also some 
complications like drivers that depend on other drivers, so it might not 
be practical for all drivers.


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From nicolas.godet at outlook.fr  Tue Oct  5 07:14:01 2021
From: nicolas.godet at outlook.fr (Nicolas Godet)
Date: Tue, 5 Oct 2021 14:14:01 +0000
Subject: [gdal-dev] gdal 3.3.3RC1
Message-ID: <PA4P190MB116653B1257F74946C6A3D238FAF9@PA4P190MB1166.EURP190.PROD.OUTLOOK.COM>

Dear GDAL developpers,



As describe in this QGIS issue (https://github.com/qgis/QGIS/issues/45293), losing network access during a QGIS instance cause a crash and can lead to a data loss.

This issue was solved in the gdal PR (https://github.com/OSGeo/gdal/pull/4561) and I wonder if it could be possible to create a release candidate of 3.3.3 version ?
3.3.3 is due by October 25 and next QGIS release 3.22.0 by October 22. So we will have to wait for QGIS 3.22.1 which for November 19.
Combined with a DELL issue on our laptop (network interruption during idle?), we increase the chance of data loss?



Regards

Nicolas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/808b0512/attachment.html>

From even.rouault at spatialys.com  Tue Oct  5 07:19:53 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 5 Oct 2021 16:19:53 +0200
Subject: [gdal-dev] gdal 3.3.3RC1
In-Reply-To: <PA4P190MB116653B1257F74946C6A3D238FAF9@PA4P190MB1166.EURP190.PROD.OUTLOOK.COM>
References: <PA4P190MB116653B1257F74946C6A3D238FAF9@PA4P190MB1166.EURP190.PROD.OUTLOOK.COM>
Message-ID: <bef171f7-e92b-90b7-66ce-ceb72e560d84@spatialys.com>

If we'd do a release each time, we fix an issue, we'd do a release each 
day :-)

Use qgis-dev + gdal-dev from OSGeo4W, or you can workaround the issue by 
removing the "set VSI_CACHE=TRUE" line from the qgis.bat launcher.

Le 05/10/2021 ? 16:14, Nicolas Godet a ?crit?:
>
> Dear GDAL developpers,
>
> As describe in this QGIS issue 
> (https://github.com/qgis/QGIS/issues/45293 
> <https://github.com/qgis/QGIS/issues/45293>), losing network access 
> during a QGIS instance cause a crash and can lead to a data loss.
>
> This issue was solved in the gdal PR 
> (https://github.com/OSGeo/gdal/pull/4561 
> <https://github.com/OSGeo/gdal/pull/4561>) and I wonder if it could be 
> possible to create a release candidate of 3.3.3 version ?
> 3.3.3 is due by October 25 and next QGIS release 3.22.0 by October 22. 
> So we will have to wait for QGIS 3.22.1 which for November 19.
> Combined with a DELL issue on our laptop (network interruption during 
> idle?), we increase the chance of data loss?
>
> Regards
>
> Nicolas
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/fd0e92a8/attachment-0001.html>

From jluis at ualg.pt  Tue Oct  5 08:11:38 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Tue, 5 Oct 2021 15:11:38 +0000
Subject: [gdal-dev] How to access remote data that requires authentication?
Message-ID: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>

Hi,

I've read a lot of the docs, tried many -co options but can't get through this mystery.

I can access the data through GMT, which uses GDAL to do this job, but can't do it with GDAL directly

gdalinfo https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
ERROR 1: HTTP error code : 401
gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.

So passing longin:password via url does not work either. But it does if indirectly used

grdinfo https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via GDAL
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration used [Cartesian grid]
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd = Import/export through GDAL
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max: 609780 x_inc: 30 name: x n_columns: 3660
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max: 4500000 y_inc: 30 name: y n_rows: 3660
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max: 0.8833 name: z
HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001 add_offset: 0 packed z-range: [-149,8833]
+proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/e60cb628/attachment.html>

From thomas.bonfort at gmail.com  Tue Oct  5 08:14:07 2021
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Tue, 5 Oct 2021 17:14:07 +0200
Subject: [gdal-dev] How to access remote data that requires
 authentication?
In-Reply-To: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <CAOM3y2h+0fydP97YC6VDXQU7KsmGh8_jiT46omKZLTHkcanR1Q@mail.gmail.com>

you need to use /vsicurl/ :

gdalinfo /vsicurl/https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif

--
thomas

On Tue, Oct 5, 2021 at 5:12 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt> wrote:
>
> Hi,
>
>
>
> I?ve read a lot of the docs, tried many -co options but can?t get through this mystery.
>
>
>
> I can access the data through GMT, which uses GDAL to do this job, but can?t do it with GDAL directly
>
>
>
> gdalinfo https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>
> ERROR 1: HTTP error code : 401
>
> gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.
>
>
>
> So passing longin:password via url does not work either. But it does if indirectly used
>
>
>
> grdinfo https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via GDAL
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration used [Cartesian grid]
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd = Import/export through GDAL
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max: 609780 x_inc: 30 name: x n_columns: 3660
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max: 4500000 y_inc: 30 name: y n_rows: 3660
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max: 0.8833 name: z
>
> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001 add_offset: 0 packed z-range: [-149,8833]
>
> +proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs
>
>
>
> Joaquim
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From sean at mapbox.com  Tue Oct  5 08:44:35 2021
From: sean at mapbox.com (Sean Gillies)
Date: Tue, 5 Oct 2021 09:44:35 -0600
Subject: [gdal-dev] HTTP range request retrying?
Message-ID: <CADPhZXz+RUKVdLWhRbUbdj64HO26xU6aGPFwNWbRdVmdz99t5w@mail.gmail.com>

Hi all,

In writing some rasterio tests I am able to get GDAL to retry head requests
for a vsicurl dataset, but am unable to trigger retries for range requests
to regions of the data. I don't recognize any tests for range request
retrying in or near
https://github.com/OSGeo/gdal/blob/master/autotest/gcore/vsicurl.py#L473.
Do we intend to support this or is it a missing feature?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/601ed7cb/attachment.html>

From even.rouault at spatialys.com  Tue Oct  5 09:09:08 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 5 Oct 2021 18:09:08 +0200
Subject: [gdal-dev] HTTP range request retrying?
In-Reply-To: <CADPhZXz+RUKVdLWhRbUbdj64HO26xU6aGPFwNWbRdVmdz99t5w@mail.gmail.com>
References: <CADPhZXz+RUKVdLWhRbUbdj64HO26xU6aGPFwNWbRdVmdz99t5w@mail.gmail.com>
Message-ID: <70c46e0d-fb05-facf-2840-7f8cec383d79@spatialys.com>

Hi Sean,

The code for retry of range requests of regions of data is at 
https://github.com/OSGeo/gdal/blob/master/gdal/port/cpl_vsil_curl.cpp#L1602 
. It indeed looks like there's no test for that. You might file an issue 
about adding one.

Side node: it might become a maintenance burden on rasterio if you test 
such low level implementation detail of GDAL, especially if you test 
like we do which exact requests are done and in which order, if we 
change at some later point how requests are done

Even

Le 05/10/2021 ? 17:44, Sean Gillies via gdal-dev a ?crit?:
> Hi all,
>
> In writing some rasterio tests I am able to get GDAL to retry head 
> requests for a vsicurl dataset, but am unable to trigger retries for 
> range requests to regions of the data. I don't recognize any tests for 
> range request retrying in or near 
> https://github.com/OSGeo/gdal/blob/master/autotest/gcore/vsicurl.py#L473 
> <https://github.com/OSGeo/gdal/blob/master/autotest/gcore/vsicurl.py#L473>. 
> Do we intend to support this or is it a missing feature?
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/f015b34d/attachment.html>

From jluis at ualg.pt  Tue Oct  5 09:20:21 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Tue, 5 Oct 2021 16:20:21 +0000
Subject: [gdal-dev] How to access remote data that requires
 authentication?
In-Reply-To: <CAOM3y2hkNA2Gc0iyPQW-8j9UAnS6sWjxsdwnhQ+dn0dCuKMBEw@mail.gmail.com>
References: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2it+uOoc9PR4x6JhnNZ8vyYHzjpnHmpxPncHjyGS0mpug@mail.gmail.com>
 <AM6PR04MB39594B87632234A277EA3C78A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2hkNA2Gc0iyPQW-8j9UAnS6sWjxsdwnhQ+dn0dCuKMBEw@mail.gmail.com>
Message-ID: <AM6PR04MB3959C81EC2E778F57FBB2A46A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>

OK, tried more things from that thread.

gdalinfo /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON --config CPL_VSIL_CURL_USE_HEAD FALSE 

* Couldn't find host data.lpdaac.earthdatacloud.nasa.gov in the _netrc file; using defaults ...
OK, right it's not there.

But latter down it says

* Couldn't find host urs.earthdata.nasa.gov in the _netrc file; using defaults

Now this is not right.

< HTTP/1.1 401 Unauthorized
...
< WWW-Authenticate: Basic realm="Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new"
...
ERROR 11: HTTP response code: 401


So I'm back to the Authentication problem. I do have an _netrc file (and .netrc btw) in my home dir as well as current dir but it does seem to find it. Is there something else that I must to in order to that file be found/used?

-----Original Message-----
From: thomas bonfort <thomas.bonfort at gmail.com> 
Sent: Tuesday, October 5, 2021 4:31 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>
Subject: Re: [gdal-dev] How to access remote data that requires authentication?

for the 206 there seems to be a similar issue posted here a few days ago, search for "Problem accessing NASA Cloud Optimized GeoTIFF data"
in the archives

On Tue, Oct 5, 2021 at 5:26 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt> wrote:
>
>
> you should also change your password, now you have posted it on a 
> public mailing list :/
>
> Shit, thanks for spotting it.
>
> But it doesn't work with /vsicur/ neither (had tried it  before). Now 
> the error is  206
>
> gdalinfo 
> /vsicurl/https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected
> /HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
> ERROR 11: HTTP response code: 206
>
>
> On Tue, Oct 5, 2021 at 5:12 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt> wrote:
> >
> > Hi,
> >
> >
> >
> > I?ve read a lot of the docs, tried many -co options but can?t get through this mystery.
> >
> >
> >
> > I can access the data through GMT, which uses GDAL to do this job, 
> > but can?t do it with GDAL directly
> >
> >
> >
> > gdalinfo
> > https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30
> > .0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
> >
> > ERROR 1: HTTP error code : 401
> >
> > gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.
> >
> >
> >
> > So passing longin:password via url does not work either. But it does 
> > if indirectly used
> >
> >
> >
> > grdinfo
> > https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30
> > .0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via 
> > GDAL
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration 
> > used [Cartesian grid]
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd = 
> > Import/export through GDAL
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max:
> > 609780 x_inc: 30 name: x n_columns: 3660
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max:
> > 4500000 y_inc: 30 name: y n_rows: 3660
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max:
> > 0.8833 name: z
> >
> > HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001
> > add_offset: 0 packed z-range: [-149,8833]
> >
> > +proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs
> >
> >
> >
> > Joaquim
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Tue Oct  5 09:32:04 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 5 Oct 2021 18:32:04 +0200
Subject: [gdal-dev] How to access remote data that requires
 authentication?
In-Reply-To: <AM6PR04MB3959C81EC2E778F57FBB2A46A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2it+uOoc9PR4x6JhnNZ8vyYHzjpnHmpxPncHjyGS0mpug@mail.gmail.com>
 <AM6PR04MB39594B87632234A277EA3C78A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2hkNA2Gc0iyPQW-8j9UAnS6sWjxsdwnhQ+dn0dCuKMBEw@mail.gmail.com>
 <AM6PR04MB3959C81EC2E778F57FBB2A46A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <4a3df08c-e83c-d7de-17fd-e817059c22e6@spatialys.com>

The mention to _netrc is weird...

Regarding authentication issues, this service is quite annoying and 
requires enabling cookies. See 
https://lists.osgeo.org/pipermail/gdal-dev/2021-October/054728.html

You need to add things like /--config GDAL_HTTP_COOKIEFILE 
/tmp/cookies.txt --config//GDAL_HTTP_COOKIEJAR /tmp/cookies.txt/

Le 05/10/2021 ? 18:20, Joaquim Manuel Freire Lu?s a ?crit?:
> OK, tried more things from that thread.
>
> gdalinfo /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON --config CPL_VSIL_CURL_USE_HEAD FALSE
>
> * Couldn't find host data.lpdaac.earthdatacloud.nasa.gov in the _netrc file; using defaults ...
> OK, right it's not there.
>
> But latter down it says
>
> * Couldn't find host urs.earthdata.nasa.gov in the _netrc file; using defaults
>
> Now this is not right.
>
> < HTTP/1.1 401 Unauthorized
> ...
> < WWW-Authenticate: Basic realm="Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new"
> ...
> ERROR 11: HTTP response code: 401
>
>
> So I'm back to the Authentication problem. I do have an _netrc file (and .netrc btw) in my home dir as well as current dir but it does seem to find it. Is there something else that I must to in order to that file be found/used?
>
> -----Original Message-----
> From: thomas bonfort <thomas.bonfort at gmail.com>
> Sent: Tuesday, October 5, 2021 4:31 PM
> To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>
> Subject: Re: [gdal-dev] How to access remote data that requires authentication?
>
> for the 206 there seems to be a similar issue posted here a few days ago, search for "Problem accessing NASA Cloud Optimized GeoTIFF data"
> in the archives
>
> On Tue, Oct 5, 2021 at 5:26 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt> wrote:
>>
>> you should also change your password, now you have posted it on a
>> public mailing list :/
>>
>> Shit, thanks for spotting it.
>>
>> But it doesn't work with /vsicur/ neither (had tried it  before). Now
>> the error is  206
>>
>> gdalinfo
>> /vsicurl/https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected
>> /HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>> ERROR 11: HTTP response code: 206
>>
>>
>> On Tue, Oct 5, 2021 at 5:12 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt> wrote:
>>> Hi,
>>>
>>>
>>>
>>> I?ve read a lot of the docs, tried many -co options but can?t get through this mystery.
>>>
>>>
>>>
>>> I can access the data through GMT, which uses GDAL to do this job,
>>> but can?t do it with GDAL directly
>>>
>>>
>>>
>>> gdalinfo
>>> https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30
>>> .0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>>>
>>> ERROR 1: HTTP error code : 401
>>>
>>> gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.
>>>
>>>
>>>
>>> So passing longin:password via url does not work either. But it does
>>> if indirectly used
>>>
>>>
>>>
>>> grdinfo
>>> https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30
>>> .0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via
>>> GDAL
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration
>>> used [Cartesian grid]
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd =
>>> Import/export through GDAL
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max:
>>> 609780 x_inc: 30 name: x n_columns: 3660
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max:
>>> 4500000 y_inc: 30 name: y n_rows: 3660
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max:
>>> 0.8833 name: z
>>>
>>> HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001
>>> add_offset: 0 packed z-range: [-149,8833]
>>>
>>> +proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs
>>>
>>>
>>>
>>> Joaquim
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/70ee1889/attachment.html>

From gdt at lexort.com  Tue Oct  5 09:48:40 2021
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 05 Oct 2021 12:48:40 -0400
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <381c47f8-e8e0-10e9-c988-ca567b886be0@spatialys.com> (Even
 Rouault's message of "Tue, 5 Oct 2021 15:55:18 +0200")
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <rmipmsjmy8f.fsf@s1.lexort.com>
 <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>
 <rmilf37mxb3.fsf@s1.lexort.com>
 <CADRrdKtEHtRj+1Sj=ShbYNxbuLO-VJRGvETYqk8Suz1PYqwv2w@mail.gmail.com>
 <381c47f8-e8e0-10e9-c988-ca567b886be0@spatialys.com>
Message-ID: <rmir1czl8nr.fsf@s1.lexort.com>


Even Rouault <even.rouault at spatialys.com> writes:

> For most packaging system, the set of dependencies available at build
> time is fully controlled by the package requirements. We can assume
> that whatever if available is wished to be used, and ideally a plain
> "cmake .." should automatically find what is available. And if the
> packager properly enumerates its build-time and run-time dependencies,
> that should work.

Generally yes, but the main mechanism is constructing include/lib paths
so that #include, -l and pkgconfig files of things that aren't declared
are not found.  So the cmake build ideally would be trying to
include/link to test if libraries are present, similar to how autoconf
does, rather than reaching out to the filesystem directly to look for
specific files.   But if there's a foo=no equivalent to --disable-foo,
it's not that hard.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/c04ac3d8/attachment.sig>

From jluis at ualg.pt  Tue Oct  5 09:59:22 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Tue, 5 Oct 2021 16:59:22 +0000
Subject: [gdal-dev] How to access remote data that requires
 authentication?
In-Reply-To: <4a3df08c-e83c-d7de-17fd-e817059c22e6@spatialys.com>
References: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2it+uOoc9PR4x6JhnNZ8vyYHzjpnHmpxPncHjyGS0mpug@mail.gmail.com>
 <AM6PR04MB39594B87632234A277EA3C78A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2hkNA2Gc0iyPQW-8j9UAnS6sWjxsdwnhQ+dn0dCuKMBEw@mail.gmail.com>
 <AM6PR04MB3959C81EC2E778F57FBB2A46A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <4a3df08c-e83c-d7de-17fd-e817059c22e6@spatialys.com>
Message-ID: <AM6PR04MB39598104D4A4A45DD61055BAA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>

>The mention to _netrc is weird...

On Windows is _netrc, not .netrc

And I finally made it (twisted). The problem was that I detest where MS decides is my home dir (and all the hidden dirs stuff that it puts there) and always have had a home at ?HOME=c:\j? and it?s there that libcurl (I presume) seeks for the netrc file.

Thanks for all the tips. But I still wonder how GMT manages to read the file without anything of this.



For the record if any other Windows user needs it

gdalinfo /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt

Driver: GTiff/GeoTIFF

Files: /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif

Size is 3660, 3660

Coordinate System is:

PROJCRS["UTM Zone 10, Northern Hemisphere",



Regarding authentication issues, this service is quite annoying and requires enabling cookies. See https://lists.osgeo.org/pipermail/gdal-dev/2021-October/054728.html

You need to add things like --config GDAL_HTTP_COOKIEFILE /tmp/cookies.txt --config GDAL_HTTP_COOKIEJAR /tmp/cookies.txt
Le 05/10/2021 ? 18:20, Joaquim Manuel Freire Lu?s a ?crit :

OK, tried more things from that thread.



gdalinfo /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON --config CPL_VSIL_CURL_USE_HEAD FALSE



* Couldn't find host data.lpdaac.earthdatacloud.nasa.gov in the _netrc file; using defaults ...

OK, right it's not there.



But latter down it says



* Couldn't find host urs.earthdata.nasa.gov in the _netrc file; using defaults



Now this is not right.



< HTTP/1.1 401 Unauthorized

...

< WWW-Authenticate: Basic realm="Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new<https://urs.earthdata.nasa.gov/users/new>"

...

ERROR 11: HTTP response code: 401





So I'm back to the Authentication problem. I do have an _netrc file (and .netrc btw) in my home dir as well as current dir but it does seem to find it. Is there something else that I must to in order to that file be found/used?



-----Original Message-----

From: thomas bonfort <thomas.bonfort at gmail.com><mailto:thomas.bonfort at gmail.com>

Sent: Tuesday, October 5, 2021 4:31 PM

To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt>

Subject: Re: [gdal-dev] How to access remote data that requires authentication?



for the 206 there seems to be a similar issue posted here a few days ago, search for "Problem accessing NASA Cloud Optimized GeoTIFF data"

in the archives



On Tue, Oct 5, 2021 at 5:26 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt> wrote:





you should also change your password, now you have posted it on a

public mailing list :/



Shit, thanks for spotting it.



But it doesn't work with /vsicur/ neither (had tried it  before). Now

the error is  206



gdalinfo

/vsicurl/https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected

/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif

ERROR 11: HTTP response code: 206





On Tue, Oct 5, 2021 at 5:12 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt> wrote:



Hi,







I?ve read a lot of the docs, tried many -co options but can?t get through this mystery.







I can access the data through GMT, which uses GDAL to do this job,

but can?t do it with GDAL directly







gdalinfo

https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30

.0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif



ERROR 1: HTTP error code : 401



gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.







So passing longin:password via url does not work either. But it does

if indirectly used







grdinfo

https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30

.0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via

GDAL



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration

used [Cartesian grid]



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd =

Import/export through GDAL



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max:

609780 x_inc: 30 name: x n_columns: 3660



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max:

4500000 y_inc: 30 name: y n_rows: 3660



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max:

0.8833 name: z



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001

add_offset: 0 packed z-range: [-149,8833]



+proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs







Joaquim



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/ef413a53/attachment-0001.html>

From jluis at ualg.pt  Tue Oct  5 12:05:04 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Tue, 5 Oct 2021 19:05:04 +0000
Subject: [gdal-dev] How to access remote data that requires
 authentication?
In-Reply-To: <AM6PR04MB39598104D4A4A45DD61055BAA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2it+uOoc9PR4x6JhnNZ8vyYHzjpnHmpxPncHjyGS0mpug@mail.gmail.com>
 <AM6PR04MB39594B87632234A277EA3C78A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2hkNA2Gc0iyPQW-8j9UAnS6sWjxsdwnhQ+dn0dCuKMBEw@mail.gmail.com>
 <AM6PR04MB3959C81EC2E778F57FBB2A46A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <4a3df08c-e83c-d7de-17fd-e817059c22e6@spatialys.com>
 <AM6PR04MB39598104D4A4A45DD61055BAA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <AM6PR04MB39597513A2D4D4EE6228881EA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>

Even, sorry to continue this.

Now is from Julia

julia> gdalinfo("/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif")
ERROR 4: `/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif' not recognized as a supported file format.

I saw a reference to VSIInstallCurlFileHandler() so I thought ?right I need this guy too? but when I try to install it

julia> GMT.Gdal.VSIInstallCurlFileHandler()
ERROR: could not load symbol "VSIInstallCurlFileHandler":
The specified procedure could not be found.

And indeed my gdal.dll has a couple of VSIInstaller symbols but not this one (nor zip, gzip and others).

Is the ?not supported file format? related to this? Shouldn?t that symbol be exported to the dll?


From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Joaquim Manuel Freire Lu?s
Sent: Tuesday, October 5, 2021 5:59 PM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] How to access remote data that requires authentication?


>The mention to _netrc is weird...

On Windows is _netrc, not .netrc

And I finally made it (twisted). The problem was that I detest where MS decides is my home dir (and all the hidden dirs stuff that it puts there) and always have had a home at ?HOME=c:\j? and it?s there that libcurl (I presume) seeks for the netrc file.

Thanks for all the tips. But I still wonder how GMT manages to read the file without anything of this.



For the record if any other Windows user needs it

gdalinfo /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt

Driver: GTiff/GeoTIFF

Files: /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif

Size is 3660, 3660

Coordinate System is:

PROJCRS["UTM Zone 10, Northern Hemisphere",



Regarding authentication issues, this service is quite annoying and requires enabling cookies. See https://lists.osgeo.org/pipermail/gdal-dev/2021-October/054728.html

You need to add things like --config GDAL_HTTP_COOKIEFILE /tmp/cookies.txt --config GDAL_HTTP_COOKIEJAR /tmp/cookies.txt
Le 05/10/2021 ? 18:20, Joaquim Manuel Freire Lu?s a ?crit :

OK, tried more things from that thread.



gdalinfo /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON --config CPL_VSIL_CURL_USE_HEAD FALSE



* Couldn't find host data.lpdaac.earthdatacloud.nasa.gov in the _netrc file; using defaults ...

OK, right it's not there.



But latter down it says



* Couldn't find host urs.earthdata.nasa.gov in the _netrc file; using defaults



Now this is not right.



< HTTP/1.1 401 Unauthorized

...

< WWW-Authenticate: Basic realm="Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new<https://urs.earthdata.nasa.gov/users/new>"

...

ERROR 11: HTTP response code: 401





So I'm back to the Authentication problem. I do have an _netrc file (and .netrc btw) in my home dir as well as current dir but it does seem to find it. Is there something else that I must to in order to that file be found/used?



-----Original Message-----

From: thomas bonfort <thomas.bonfort at gmail.com><mailto:thomas.bonfort at gmail.com>

Sent: Tuesday, October 5, 2021 4:31 PM

To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt>

Subject: Re: [gdal-dev] How to access remote data that requires authentication?



for the 206 there seems to be a similar issue posted here a few days ago, search for "Problem accessing NASA Cloud Optimized GeoTIFF data"

in the archives



On Tue, Oct 5, 2021 at 5:26 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt> wrote:





you should also change your password, now you have posted it on a

public mailing list :/



Shit, thanks for spotting it.



But it doesn't work with /vsicur/ neither (had tried it  before). Now

the error is  206



gdalinfo

/vsicurl/https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected

/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif

ERROR 11: HTTP response code: 206





On Tue, Oct 5, 2021 at 5:12 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt> wrote:



Hi,







I?ve read a lot of the docs, tried many -co options but can?t get through this mystery.







I can access the data through GMT, which uses GDAL to do this job,

but can?t do it with GDAL directly







gdalinfo

https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30

.0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif



ERROR 1: HTTP error code : 401



gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.







So passing longin:password via url does not work either. But it does

if indirectly used







grdinfo

https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30

.0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via

GDAL



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration

used [Cartesian grid]



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd =

Import/export through GDAL



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max:

609780 x_inc: 30 name: x n_columns: 3660



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max:

4500000 y_inc: 30 name: y n_rows: 3660



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max:

0.8833 name: z



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001

add_offset: 0 packed z-range: [-149,8833]



+proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs







Joaquim



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/4abcbd89/attachment-0001.html>

From even.rouault at spatialys.com  Tue Oct  5 12:10:55 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 5 Oct 2021 21:10:55 +0200
Subject: [gdal-dev] How to access remote data that requires
 authentication?
In-Reply-To: <AM6PR04MB39597513A2D4D4EE6228881EA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2it+uOoc9PR4x6JhnNZ8vyYHzjpnHmpxPncHjyGS0mpug@mail.gmail.com>
 <AM6PR04MB39594B87632234A277EA3C78A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2hkNA2Gc0iyPQW-8j9UAnS6sWjxsdwnhQ+dn0dCuKMBEw@mail.gmail.com>
 <AM6PR04MB3959C81EC2E778F57FBB2A46A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <4a3df08c-e83c-d7de-17fd-e817059c22e6@spatialys.com>
 <AM6PR04MB39598104D4A4A45DD61055BAA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <AM6PR04MB39597513A2D4D4EE6228881EA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <2863a0c0-37e2-c4d7-f1a4-9fe435c91400@spatialys.com>

There are a few historically exported VSIInstaller symbols, but 
VSIInstallCurlFileHandler is never exported. None of those symbols need 
to be explicitly called as GDAL will automatically register the 
builtin-handlers. Perhaps your gdal.dll lacks curl support ? I assumed 
you pass the needed config options / env variables for that service. 
Perhaps you could try with something simpler that doesn't require 
authentication.

Le 05/10/2021 ? 21:05, Joaquim Manuel Freire Lu?s a ?crit?:
>
> Even, sorry to continue this.
>
> Now is from Julia
>
> julia> 
> gdalinfo("/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif")
>
> ERROR 4: 
> `/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif' 
> not recognized as a supported file format.
>
> I saw a reference to VSIInstallCurlFileHandler() so I thought ?right I 
> need this guy too? but when I try to install it
>
> julia> GMT.Gdal.VSIInstallCurlFileHandler()
>
> ERROR: could not load symbol "VSIInstallCurlFileHandler":
>
> The specified procedure could not be found.
>
> And indeed my gdal.dll has a couple of VSIInstaller symbols but not 
> this one (nor zip, gzip and others).
>
> Is the ?not supported file format? related to this? Shouldn?t that 
> symbol be exported to the dll?
>
> *From:*gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of 
> *Joaquim Manuel Freire Lu?s
> *Sent:* Tuesday, October 5, 2021 5:59 PM
> *To:* Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] How to access remote data that requires 
> authentication?
>
> >The mention to _netrc is weird...
>
> On Windows is _netrc, not .netrc
>
> And I finally made it (twisted). The problem was that I detest where 
> MS decides is my home dir (and all the hidden dirs stuff that it puts 
> there) and always have had a home at ?HOME=c:\j? and it?s there that 
> libcurl (I presume) seeks for the netrc file.
>
> Thanks for all the tips. But I still wonder how GMT manages to read 
> the file without anything of this.
>
> For the record if any other Windows user needs it
>
> gdalinfo 
> /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif 
> --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config 
> CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE 
> c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt
>
> Driver: GTiff/GeoTIFF
>
> Files: 
> /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>
> Size is 3660, 3660
>
> Coordinate System is:
>
> PROJCRS["UTM Zone 10, Northern Hemisphere",
>
> Regarding authentication issues, this service is quite annoying and 
> requires enabling cookies. See 
> https://lists.osgeo.org/pipermail/gdal-dev/2021-October/054728.html 
> <https://lists.osgeo.org/pipermail/gdal-dev/2021-October/054728.html>
>
> You need to add things like /--config GDAL_HTTP_COOKIEFILE 
> /tmp/cookies.txt --config GDAL_HTTP_COOKIEJAR /tmp/cookies.txt/
>
> Le 05/10/2021 ? 18:20, Joaquim Manuel Freire Lu?s a ?crit?:
>
>     OK, tried more things from that thread.
>
>     gdalinfo /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif  <https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif>  --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON --config CPL_VSIL_CURL_USE_HEAD FALSE
>
>     * Couldn't find host data.lpdaac.earthdatacloud.nasa.gov in the _netrc file; using defaults ...
>
>     OK, right it's not there.
>
>     But latter down it says
>
>     * Couldn't find host urs.earthdata.nasa.gov in the _netrc file; using defaults
>
>     Now this is not right.
>
>     < HTTP/1.1 401 Unauthorized
>
>     ...
>
>     < WWW-Authenticate: Basic realm="Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one athttps://urs.earthdata.nasa.gov//users/new  <https://urs.earthdata.nasa.gov/users/new>"
>
>     ...
>
>     ERROR 11: HTTP response code: 401
>
>     So I'm back to the Authentication problem. I do have an _netrc file (and .netrc btw) in my home dir as well as current dir but it does seem to find it. Is there something else that I must to in order to that file be found/used?
>
>     -----Original Message-----
>
>     From: thomas bonfort<thomas.bonfort at gmail.com>  <mailto:thomas.bonfort at gmail.com>  
>
>     Sent: Tuesday, October 5, 2021 4:31 PM
>
>     To: Joaquim Manuel Freire Lu?s<jluis at ualg.pt>  <mailto:jluis at ualg.pt>
>
>     Subject: Re: [gdal-dev] How to access remote data that requires authentication?
>
>     for the 206 there seems to be a similar issue posted here a few days ago, search for "Problem accessing NASA Cloud Optimized GeoTIFF data"
>
>     in the archives
>
>     On Tue, Oct 5, 2021 at 5:26 PM Joaquim Manuel Freire Lu?s<jluis at ualg.pt>  <mailto:jluis at ualg.pt>  wrote:
>
>         you should also change your password, now you have posted it on a
>
>         public mailing list :/
>
>         Shit, thanks for spotting it.
>
>         But it doesn't work with /vsicur/ neither (had tried it? before). Now
>
>         the error is? 206
>
>         gdalinfo
>
>         /vsicurl/https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected  <https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected>
>
>         /HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>
>         ERROR 11: HTTP response code: 206
>
>         On Tue, Oct 5, 2021 at 5:12 PM Joaquim Manuel Freire Lu?s<jluis at ualg.pt>  <mailto:jluis at ualg.pt>  wrote:
>
>             Hi,
>
>             I?ve read a lot of the docs, tried many -co options but can?t get through this mystery.
>
>             I can access the data through GMT, which uses GDAL to do this job,
>
>             but can?t do it with GDAL directly
>
>             gdalinfo
>
>             https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30  <https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30>
>
>             .0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>
>             ERROR 1: HTTP error code : 401
>
>             gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif  <https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif>'.
>
>             So passing longin:password via url does not work either. But it does
>
>             if indirectly used
>
>             grdinfo
>
>             https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30  <https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30>
>
>             .0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via
>
>             GDAL
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration
>
>             used [Cartesian grid]
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd =
>
>             Import/export through GDAL
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max:
>
>             609780 x_inc: 30 name: x n_columns: 3660
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max:
>
>             4500000 y_inc: 30 name: y n_rows: 3660
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max:
>
>             0.8833 name: z
>
>             HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001
>
>             add_offset: 0 packed z-range: [-149,8833]
>
>             +proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs
>
>             Joaquim
>
>             _______________________________________________
>
>             gdal-dev mailing list
>
>             gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>
>             https://lists.osgeo.org/mailman/listinfo/gdal-dev  <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>     _______________________________________________
>
>     gdal-dev mailing list
>
>     gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev  <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
> -- 
> http://www.spatialys.com  <http://www.spatialys.com>
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/f9557574/attachment-0001.html>

From jluis at ualg.pt  Tue Oct  5 12:58:02 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Tue, 5 Oct 2021 19:58:02 +0000
Subject: [gdal-dev] How to access remote data that requires
 authentication?
In-Reply-To: <2863a0c0-37e2-c4d7-f1a4-9fe435c91400@spatialys.com>
References: <AM6PR04MB3959CC35E053B7130F1CD98AA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2it+uOoc9PR4x6JhnNZ8vyYHzjpnHmpxPncHjyGS0mpug@mail.gmail.com>
 <AM6PR04MB39594B87632234A277EA3C78A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAOM3y2hkNA2Gc0iyPQW-8j9UAnS6sWjxsdwnhQ+dn0dCuKMBEw@mail.gmail.com>
 <AM6PR04MB3959C81EC2E778F57FBB2A46A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <4a3df08c-e83c-d7de-17fd-e817059c22e6@spatialys.com>
 <AM6PR04MB39598104D4A4A45DD61055BAA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <AM6PR04MB39597513A2D4D4EE6228881EA6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <2863a0c0-37e2-c4d7-f1a4-9fe435c91400@spatialys.com>
Message-ID: <AM6PR04MB3959DBBB23735DE410124787A6AF9@AM6PR04MB3959.eurprd04.prod.outlook.com>

Hmm, very tricky situations. Apparently from Julia things remain in memory and it remembers previous errors.

From a clean Juia REPL start this works (even with authentication)

julia> set_config_option("GDAL_HTTP_COOKIEFILE", joinpath(tempdir(), "cookies.txt"))
julia> set_config_option("GDAL_HTTP_COOKIEJAR", joinpath(tempdir(), "cookies.txt"))
julia> set_config_option("GDAL_DISABLE_READDIR_ON_OPEN","YES")
julia> set_config_option("CPL_VSIL_CURL_ALLOWED_EXTENSIONS","TIF")
julia> set_config_option("CPL_VSIL_CURL_USE_HEAD","FALSE")

gdalinfo("/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif")
"Driver: GTiff/GeoTIFF\nFiles: /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif\nSize is 3660, 3660\nCoordinate System is:\nPROJCRS[\"UTM Zone 10, Northern Hemisphere\",\n    BASEGEOGCRS[\"Unknown datum based upon the WGS 84 ellipsoid\",\n        DATUM[\"Not_specified_based_on_WGS_84_spheroid\",\n ?..

However, if run the gdalinfo(?) first and set the options after, then any posterior call to gdalinfo will return that ?not supported file format? error.

In fact the errors evolve like this (after another clean start)

julia> gdalinfo("/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif")
ERROR 11: HTTP response code: 206

julia> gdalinfo("/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif")
ERROR 4: `/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif' does not exist in the file system, and is not recognized as a supported dataset name.

From: Even Rouault <even.rouault at spatialys.com>
Sent: Tuesday, October 5, 2021 8:11 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] How to access remote data that requires authentication?


There are a few historically exported VSIInstaller symbols, but VSIInstallCurlFileHandler is never exported. None of those symbols need to be explicitly called as GDAL will automatically register the builtin-handlers. Perhaps your gdal.dll lacks curl support ? I assumed you pass the needed config options / env variables for that service. Perhaps you could try with something simpler that doesn't require authentication.
Le 05/10/2021 ? 21:05, Joaquim Manuel Freire Lu?s a ?crit :
Even, sorry to continue this.

Now is from Julia

julia> gdalinfo("/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif")
ERROR 4: `/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif' not recognized as a supported file format.

I saw a reference to VSIInstallCurlFileHandler() so I thought ?right I need this guy too? but when I try to install it

julia> GMT.Gdal.VSIInstallCurlFileHandler()
ERROR: could not load symbol "VSIInstallCurlFileHandler":
The specified procedure could not be found.

And indeed my gdal.dll has a couple of VSIInstaller symbols but not this one (nor zip, gzip and others).

Is the ?not supported file format? related to this? Shouldn?t that symbol be exported to the dll?


From: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> On Behalf Of Joaquim Manuel Freire Lu?s
Sent: Tuesday, October 5, 2021 5:59 PM
To: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] How to access remote data that requires authentication?


>The mention to _netrc is weird...

On Windows is _netrc, not .netrc

And I finally made it (twisted). The problem was that I detest where MS decides is my home dir (and all the hidden dirs stuff that it puts there) and always have had a home at ?HOME=c:\j? and it?s there that libcurl (I presume) seeks for the netrc file.

Thanks for all the tips. But I still wonder how GMT manages to read the file without anything of this.



For the record if any other Windows user needs it

gdalinfo /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt

Driver: GTiff/GeoTIFF

Files: /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif

Size is 3660, 3660

Coordinate System is:

PROJCRS["UTM Zone 10, Northern Hemisphere",



Regarding authentication issues, this service is quite annoying and requires enabling cookies. See https://lists.osgeo.org/pipermail/gdal-dev/2021-October/054728.html

You need to add things like --config GDAL_HTTP_COOKIEFILE /tmp/cookies.txt --config GDAL_HTTP_COOKIEJAR /tmp/cookies.txt
Le 05/10/2021 ? 18:20, Joaquim Manuel Freire Lu?s a ?crit :

OK, tried more things from that thread.



gdalinfo /vsicurl/https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T10TEK.2021192T184511.v2.0/HLS.L30.T10TEK.2021192T184511.v2.0.B04.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_CURL_VERBOSE ON --config CPL_VSIL_CURL_USE_HEAD FALSE



* Couldn't find host data.lpdaac.earthdatacloud.nasa.gov in the _netrc file; using defaults ...

OK, right it's not there.



But latter down it says



* Couldn't find host urs.earthdata.nasa.gov in the _netrc file; using defaults



Now this is not right.



< HTTP/1.1 401 Unauthorized

...

< WWW-Authenticate: Basic realm="Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new<https://urs.earthdata.nasa.gov/users/new>"

...

ERROR 11: HTTP response code: 401





So I'm back to the Authentication problem. I do have an _netrc file (and .netrc btw) in my home dir as well as current dir but it does seem to find it. Is there something else that I must to in order to that file be found/used?



-----Original Message-----

From: thomas bonfort <thomas.bonfort at gmail.com><mailto:thomas.bonfort at gmail.com>

Sent: Tuesday, October 5, 2021 4:31 PM

To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt>

Subject: Re: [gdal-dev] How to access remote data that requires authentication?



for the 206 there seems to be a similar issue posted here a few days ago, search for "Problem accessing NASA Cloud Optimized GeoTIFF data"

in the archives



On Tue, Oct 5, 2021 at 5:26 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt> wrote:





you should also change your password, now you have posted it on a

public mailing list :/



Shit, thanks for spotting it.



But it doesn't work with /vsicur/ neither (had tried it  before). Now

the error is  206



gdalinfo

/vsicurl/https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected

/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif

ERROR 11: HTTP response code: 206





On Tue, Oct 5, 2021 at 5:12 PM Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt> wrote:



Hi,







I?ve read a lot of the docs, tried many -co options but can?t get through this mystery.







I can access the data through GMT, which uses GDAL to do this job,

but can?t do it with GDAL directly







gdalinfo

https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30

.0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif



ERROR 1: HTTP error code : 401



gdalinfo failed - unable to open 'https://jluis:abaixo0Earthdata at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.







So passing longin:password via url does not work either. But it does

if indirectly used







grdinfo

https://user:pass at lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30

.0 15/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Title: Grid imported via

GDAL



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Command:



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Remark:



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Pixel node registration

used [Cartesian grid]



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: Grid file format: gd =

Import/export through GDAL



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: x_min: 499980 x_max:

609780 x_inc: 30 name: x n_columns: 3660



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: y_min: 4390200 y_max:

4500000 y_inc: 30 name: y n_rows: 3660



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: v_min: -0.0149 v_max:

0.8833 name: z



HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif: scale_factor: 0.0001

add_offset: 0 packed z-range: [-149,8833]



+proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs







Joaquim



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/e5a44da4/attachment-0001.html>

From rlc5m8 at mail.missouri.edu  Tue Oct  5 13:13:44 2021
From: rlc5m8 at mail.missouri.edu (Chastain, Raymond Lee (MU-Student))
Date: Tue, 5 Oct 2021 20:13:44 +0000
Subject: [gdal-dev] Blue artifact dots in shadows when using GDAL to
 create mosaics
In-Reply-To: <29691311.5BNXpCuWgq@audax>
References: <CY4PR01MB24712E0E26884A7C826F0F479FA89@CY4PR01MB2471.prod.exchangelabs.com>
 <29691311.5BNXpCuWgq@audax>
Message-ID: <CY4PR01MB24714F869FBD1B5FAA133A5F9FAF9@CY4PR01MB2471.prod.exchangelabs.com>

Thanks Brad,

I didn't notice your response as my e-mail system flagged it junk email.

We'll try this and report back with our findings.

Thank you again for the help,
Raymond.
________________________________
From: Brad Hards <bradh at frogmouth.net>
Sent: Tuesday, September 28, 2021 7:21 PM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Cc: Chastain, Raymond Lee (MU-Student) <rlc5m8 at mail.missouri.edu>
Subject: Re: [gdal-dev] Blue artifact dots in shadows when using GDAL to create mosaics

WARNING: This message has originated from an External Source. This may be a phishing expedition that can result in unauthorized access to our IT System. Please use proper judgment and caution when opening attachments, clicking links, or responding to this email.

On Wednesday, 29 September 2021 9:37:57 AM AEST Chastain, Raymond Lee (MU-
Student) wrote:
> Process is very simple
>
>   1.  Take our tiles and build a virtual raster:
> gdalbuildvrt -r lanczos -resolution HIGHEST output.vrt -input_file_list
> input_file_list.txt 2.  Convert our virtual raster to a GeoTIFF:
>   3.  gdal_translate -of GTIFF ./output.vrt ./output.tif
I manually removed the NODATA part from the vrt, and it looks better. Possibly
the nodata value in the source is bad? Or you need to put something more
meaningful behind the images...

Brad




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/8c9848eb/attachment.html>

From rlc5m8 at mail.missouri.edu  Tue Oct  5 13:52:18 2021
From: rlc5m8 at mail.missouri.edu (Chastain, Raymond Lee (MU-Student))
Date: Tue, 5 Oct 2021 20:52:18 +0000
Subject: [gdal-dev] Blue artifact dots in shadows when using GDAL to
 create mosaics
In-Reply-To: <CY4PR01MB24714F869FBD1B5FAA133A5F9FAF9@CY4PR01MB2471.prod.exchangelabs.com>
References: <CY4PR01MB24712E0E26884A7C826F0F479FA89@CY4PR01MB2471.prod.exchangelabs.com>
 <29691311.5BNXpCuWgq@audax>
 <CY4PR01MB24714F869FBD1B5FAA133A5F9FAF9@CY4PR01MB2471.prod.exchangelabs.com>
Message-ID: <CY4PR01MB2471766E7E2B90DC6331FF049FAF9@CY4PR01MB2471.prod.exchangelabs.com>

Hi Brad,

We edited the VRT to remove the NODATA tags, we also tried "gdal_edit.py -unsetnodata", however we are still seeing the colored dot artifacts.

Could you please elaborate on what exactly you did that helped and if the dots were completely removed by that process?

Thanks again,
Raymond.
________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Chastain, Raymond Lee (MU-Student) <rlc5m8 at mail.missouri.edu>
Sent: Tuesday, October 5, 2021 3:13 PM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>; bradh at frogmouth.net <bradh at frogmouth.net>
Subject: Re: [gdal-dev] Blue artifact dots in shadows when using GDAL to create mosaics

Thanks Brad,

I didn't notice your response as my e-mail system flagged it junk email.

We'll try this and report back with our findings.

Thank you again for the help,
Raymond.
________________________________
From: Brad Hards <bradh at frogmouth.net>
Sent: Tuesday, September 28, 2021 7:21 PM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Cc: Chastain, Raymond Lee (MU-Student) <rlc5m8 at mail.missouri.edu>
Subject: Re: [gdal-dev] Blue artifact dots in shadows when using GDAL to create mosaics

WARNING: This message has originated from an External Source. This may be a phishing expedition that can result in unauthorized access to our IT System. Please use proper judgment and caution when opening attachments, clicking links, or responding to this email.

On Wednesday, 29 September 2021 9:37:57 AM AEST Chastain, Raymond Lee (MU-
Student) wrote:
> Process is very simple
>
>   1.  Take our tiles and build a virtual raster:
> gdalbuildvrt -r lanczos -resolution HIGHEST output.vrt -input_file_list
> input_file_list.txt 2.  Convert our virtual raster to a GeoTIFF:
>   3.  gdal_translate -of GTIFF ./output.vrt ./output.tif
I manually removed the NODATA part from the vrt, and it looks better. Possibly
the nodata value in the source is bad? Or you need to put something more
meaningful behind the images...

Brad




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/fcbe207f/attachment.html>

From pedrongvenancio at gmail.com  Tue Oct  5 14:27:15 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Tue, 5 Oct 2021 22:27:15 +0100
Subject: [gdal-dev] GDAL/OGR coordinate transformations candidate operations
 priority
Message-ID: <CAMCJChvTGy6LhEvytEnQBWHoym4-21xm2GCQW7kVMZSGpi1E+g@mail.gmail.com>

Hi all,

I'm trying to understand what is the transformation used by default by
GDAL/OGR.

For instance, the transformation from EPSG:20790 to EPSG:3763 has two
candidates on PROJ:

C:\OSGeo4W>projinfo -s EPSG:20790 -t EPSG:3763
Candidate operations found: 2
-------------------------------------
Operation No. 1:

unknown id, Inverse of Portuguese National Grid + Lisbon (Lisbon) to Lisbon
(1) + Lisbon to ETRS89 (4) + Portugual TM06, 0.1 m, Portugal - mainland -
onshore.

PROJ string:
+proj=pipeline
  +step +inv +proj=tmerc +lat_0=39.6666666666667 +lon_0=1 +k=1 +x_0=200000
        +y_0=300000 +ellps=intl +pm=lisbon
  +step +proj=hgridshift +grids=pt_dgt_DLx_ETRS89_geo.tif
  +step +proj=tmerc +lat_0=39.6682583333333 +lon_0=-8.13310833333333 +k=1
+x_0=0
        +y_0=0 +ellps=GRS80

WKT2:2019 string:
CONCATENATEDOPERATION["Inverse of Portuguese National Grid + Lisbon
(Lisbon) to Lisbon (1) + Lisbon to ETRS89 (4) + Portugual TM06",
    SOURCECRS[
        PROJCRS["Lisbon (Lisbon) / Portuguese National Grid",
            BASEGEOGCRS["Lisbon (Lisbon)",
                DATUM["Lisbon 1937 (Lisbon)",
                    ELLIPSOID["International 1924",6378388,297,
                        LENGTHUNIT["metre",1]]],
                PRIMEM["Lisbon",-9.13190611111111,
                    ANGLEUNIT["degree",0.0174532925199433]],
                ID["EPSG",4803]],
            CONVERSION["Portuguese National Grid",
                METHOD["Transverse Mercator",
                    ID["EPSG",9807]],
                PARAMETER["Latitude of natural origin",39.6666666666667,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8801]],
                PARAMETER["Longitude of natural origin",1,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8802]],
                PARAMETER["Scale factor at natural origin",1,
                    SCALEUNIT["unity",1],
                    ID["EPSG",8805]],
                PARAMETER["False easting",200000,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8806]],
                PARAMETER["False northing",300000,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8807]]],
            CS[Cartesian,2],
                AXIS["easting (X)",east,
                    ORDER[1],
                    LENGTHUNIT["metre",1]],
                AXIS["northing (Y)",north,
                    ORDER[2],
                    LENGTHUNIT["metre",1]],
            ID["EPSG",20790]]],
    TARGETCRS[
        PROJCRS["ETRS89 / Portugal TM06",
            BASEGEOGCRS["ETRS89",
                ENSEMBLE["European Terrestrial Reference System 1989
ensemble",
                    MEMBER["European Terrestrial Reference Frame 1989"],
                    MEMBER["European Terrestrial Reference Frame 1990"],
                    MEMBER["European Terrestrial Reference Frame 1991"],
                    MEMBER["European Terrestrial Reference Frame 1992"],
                    MEMBER["European Terrestrial Reference Frame 1993"],
                    MEMBER["European Terrestrial Reference Frame 1994"],
                    MEMBER["European Terrestrial Reference Frame 1996"],
                    MEMBER["European Terrestrial Reference Frame 1997"],
                    MEMBER["European Terrestrial Reference Frame 2000"],
                    MEMBER["European Terrestrial Reference Frame 2005"],
                    MEMBER["European Terrestrial Reference Frame 2014"],
                    ELLIPSOID["GRS 1980",6378137,298.257222101,
                        LENGTHUNIT["metre",1]],
                    ENSEMBLEACCURACY[0.1]],
                PRIMEM["Greenwich",0,
                    ANGLEUNIT["degree",0.0174532925199433]],
                ID["EPSG",4258]],
            CONVERSION["Portugual TM06",
                METHOD["Transverse Mercator",
                    ID["EPSG",9807]],
                PARAMETER["Latitude of natural origin",39.6682583333333,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8801]],
                PARAMETER["Longitude of natural origin",-8.13310833333333,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8802]],
                PARAMETER["Scale factor at natural origin",1,
                    SCALEUNIT["unity",1],
                    ID["EPSG",8805]],
                PARAMETER["False easting",0,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8806]],
                PARAMETER["False northing",0,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8807]]],
            CS[Cartesian,2],
                AXIS["easting (X)",east,
                    ORDER[1],
                    LENGTHUNIT["metre",1]],
                AXIS["northing (Y)",north,
                    ORDER[2],
                    LENGTHUNIT["metre",1]],
            ID["EPSG",3763]]],
    STEP[
        CONVERSION["Inverse of Portuguese National Grid",
            METHOD["Inverse of Transverse Mercator",
                ID["INVERSE(EPSG)",9807]],
            PARAMETER["Latitude of natural origin",39.6666666666667,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8801]],
            PARAMETER["Longitude of natural origin",1,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8802]],
            PARAMETER["Scale factor at natural origin",1,
                SCALEUNIT["unity",1],
                ID["EPSG",8805]],
            PARAMETER["False easting",200000,
                LENGTHUNIT["metre",1],
                ID["EPSG",8806]],
            PARAMETER["False northing",300000,
                LENGTHUNIT["metre",1],
                ID["EPSG",8807]],
            ID["INVERSE(EPSG)",19936]]],
    STEP[
        COORDINATEOPERATION["Lisbon (Lisbon) to Lisbon (1)",
            VERSION["IGC-Prt"],
            SOURCECRS[
                GEOGCRS["Lisbon (Lisbon)",
                    DATUM["Lisbon 1937 (Lisbon)",
                        ELLIPSOID["International 1924",6378388,297,
                            LENGTHUNIT["metre",1]]],
                    PRIMEM["Lisbon",-9.13190611111111,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4803]]],
            TARGETCRS[
                GEOGCRS["Lisbon",
                    DATUM["Lisbon 1937",
                        ELLIPSOID["International 1924",6378388,297,
                            LENGTHUNIT["metre",1]]],
                    PRIMEM["Greenwich",0,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4207]]],
            METHOD["Longitude rotation",
                ID["EPSG",9601]],
            PARAMETER["Longitude offset",-9.13190611111111,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8602]],
            OPERATIONACCURACY[0.0],
            ID["EPSG",1756]]],
    STEP[
        COORDINATEOPERATION["Lisbon to ETRS89 (4)",
            SOURCECRS[
                GEOGCRS["Lisbon",
                    DATUM["Lisbon 1937",
                        ELLIPSOID["International 1924",6378388,297,
                            LENGTHUNIT["metre",1]]],
                    PRIMEM["Greenwich",0,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4207]]],
            TARGETCRS[
                GEOGCRS["ETRS89",
                    ENSEMBLE["European Terrestrial Reference System 1989
ensemble",
                        MEMBER["European Terrestrial Reference Frame 1989"],
                        MEMBER["European Terrestrial Reference Frame 1990"],
                        MEMBER["European Terrestrial Reference Frame 1991"],
                        MEMBER["European Terrestrial Reference Frame 1992"],
                        MEMBER["European Terrestrial Reference Frame 1993"],
                        MEMBER["European Terrestrial Reference Frame 1994"],
                        MEMBER["European Terrestrial Reference Frame 1996"],
                        MEMBER["European Terrestrial Reference Frame 1997"],
                        MEMBER["European Terrestrial Reference Frame 2000"],
                        MEMBER["European Terrestrial Reference Frame 2005"],
                        MEMBER["European Terrestrial Reference Frame 2014"],
                        ELLIPSOID["GRS 1980",6378137,298.257222101,
                            LENGTHUNIT["metre",1]],
                        ENSEMBLEACCURACY[0.1]],
                    PRIMEM["Greenwich",0,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4258]]],
            METHOD["HORIZONTAL_SHIFT_GTIFF"],
            PARAMETERFILE["Latitude and longitude difference
file","pt_dgt_DLx_ETRS89_geo.tif"],
            OPERATIONACCURACY[0.1],
            ID["DERIVED_FROM(EPSG)",6188],
            REMARK["Derived from 1129 common stations in the national
geodetic network. Residuals at 130 further test points average 0.09m,
maximum 0.30m."]]],
    STEP[
        CONVERSION["Portugual TM06",
            METHOD["Transverse Mercator",
                ID["EPSG",9807]],
            PARAMETER["Latitude of natural origin",39.6682583333333,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8801]],
            PARAMETER["Longitude of natural origin",-8.13310833333333,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8802]],
            PARAMETER["Scale factor at natural origin",1,
                SCALEUNIT["unity",1],
                ID["EPSG",8805]],
            PARAMETER["False easting",0,
                LENGTHUNIT["metre",1],
                ID["EPSG",8806]],
            PARAMETER["False northing",0,
                LENGTHUNIT["metre",1],
                ID["EPSG",8807]],
            ID["EPSG",19853]]],
    USAGE[
        SCOPE["unknown"],
        AREA["Portugal - mainland - onshore."],
        BBOX[36.95,-9.56,42.16,-6.19]]]

-------------------------------------
Operation No. 2:

unknown id, Inverse of Portuguese National Grid + Lisbon (Lisbon) to Lisbon
(1) + Lisbon to ETRS89 (3) + Portugual TM06, 2.5 m, Portugal - mainland -
onshore.

PROJ string:
+proj=pipeline
  +step +inv +proj=tmerc +lat_0=39.6666666666667 +lon_0=1 +k=1 +x_0=200000
        +y_0=300000 +ellps=intl +pm=lisbon
  +step +proj=push +v_3
  +step +proj=cart +ellps=intl
  +step +proj=helmert +x=-303.861 +y=-60.693 +z=103.607
  +step +inv +proj=cart +ellps=GRS80
  +step +proj=pop +v_3
  +step +proj=tmerc +lat_0=39.6682583333333 +lon_0=-8.13310833333333 +k=1
+x_0=0
        +y_0=0 +ellps=GRS80

WKT2:2019 string:
CONCATENATEDOPERATION["Inverse of Portuguese National Grid + Lisbon
(Lisbon) to Lisbon (1) + Lisbon to ETRS89 (3) + Portugual TM06",
    SOURCECRS[
        PROJCRS["Lisbon (Lisbon) / Portuguese National Grid",
            BASEGEOGCRS["Lisbon (Lisbon)",
                DATUM["Lisbon 1937 (Lisbon)",
                    ELLIPSOID["International 1924",6378388,297,
                        LENGTHUNIT["metre",1]]],
                PRIMEM["Lisbon",-9.13190611111111,
                    ANGLEUNIT["degree",0.0174532925199433]],
                ID["EPSG",4803]],
            CONVERSION["Portuguese National Grid",
                METHOD["Transverse Mercator",
                    ID["EPSG",9807]],
                PARAMETER["Latitude of natural origin",39.6666666666667,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8801]],
                PARAMETER["Longitude of natural origin",1,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8802]],
                PARAMETER["Scale factor at natural origin",1,
                    SCALEUNIT["unity",1],
                    ID["EPSG",8805]],
                PARAMETER["False easting",200000,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8806]],
                PARAMETER["False northing",300000,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8807]]],
            CS[Cartesian,2],
                AXIS["easting (X)",east,
                    ORDER[1],
                    LENGTHUNIT["metre",1]],
                AXIS["northing (Y)",north,
                    ORDER[2],
                    LENGTHUNIT["metre",1]],
            ID["EPSG",20790]]],
    TARGETCRS[
        PROJCRS["ETRS89 / Portugal TM06",
            BASEGEOGCRS["ETRS89",
                ENSEMBLE["European Terrestrial Reference System 1989
ensemble",
                    MEMBER["European Terrestrial Reference Frame 1989"],
                    MEMBER["European Terrestrial Reference Frame 1990"],
                    MEMBER["European Terrestrial Reference Frame 1991"],
                    MEMBER["European Terrestrial Reference Frame 1992"],
                    MEMBER["European Terrestrial Reference Frame 1993"],
                    MEMBER["European Terrestrial Reference Frame 1994"],
                    MEMBER["European Terrestrial Reference Frame 1996"],
                    MEMBER["European Terrestrial Reference Frame 1997"],
                    MEMBER["European Terrestrial Reference Frame 2000"],
                    MEMBER["European Terrestrial Reference Frame 2005"],
                    MEMBER["European Terrestrial Reference Frame 2014"],
                    ELLIPSOID["GRS 1980",6378137,298.257222101,
                        LENGTHUNIT["metre",1]],
                    ENSEMBLEACCURACY[0.1]],
                PRIMEM["Greenwich",0,
                    ANGLEUNIT["degree",0.0174532925199433]],
                ID["EPSG",4258]],
            CONVERSION["Portugual TM06",
                METHOD["Transverse Mercator",
                    ID["EPSG",9807]],
                PARAMETER["Latitude of natural origin",39.6682583333333,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8801]],
                PARAMETER["Longitude of natural origin",-8.13310833333333,
                    ANGLEUNIT["degree",0.0174532925199433],
                    ID["EPSG",8802]],
                PARAMETER["Scale factor at natural origin",1,
                    SCALEUNIT["unity",1],
                    ID["EPSG",8805]],
                PARAMETER["False easting",0,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8806]],
                PARAMETER["False northing",0,
                    LENGTHUNIT["metre",1],
                    ID["EPSG",8807]]],
            CS[Cartesian,2],
                AXIS["easting (X)",east,
                    ORDER[1],
                    LENGTHUNIT["metre",1]],
                AXIS["northing (Y)",north,
                    ORDER[2],
                    LENGTHUNIT["metre",1]],
            ID["EPSG",3763]]],
    STEP[
        CONVERSION["Inverse of Portuguese National Grid",
            METHOD["Inverse of Transverse Mercator",
                ID["INVERSE(EPSG)",9807]],
            PARAMETER["Latitude of natural origin",39.6666666666667,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8801]],
            PARAMETER["Longitude of natural origin",1,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8802]],
            PARAMETER["Scale factor at natural origin",1,
                SCALEUNIT["unity",1],
                ID["EPSG",8805]],
            PARAMETER["False easting",200000,
                LENGTHUNIT["metre",1],
                ID["EPSG",8806]],
            PARAMETER["False northing",300000,
                LENGTHUNIT["metre",1],
                ID["EPSG",8807]],
            ID["INVERSE(EPSG)",19936]]],
    STEP[
        COORDINATEOPERATION["Lisbon (Lisbon) to Lisbon (1)",
            VERSION["IGC-Prt"],
            SOURCECRS[
                GEOGCRS["Lisbon (Lisbon)",
                    DATUM["Lisbon 1937 (Lisbon)",
                        ELLIPSOID["International 1924",6378388,297,
                            LENGTHUNIT["metre",1]]],
                    PRIMEM["Lisbon",-9.13190611111111,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4803]]],
            TARGETCRS[
                GEOGCRS["Lisbon",
                    DATUM["Lisbon 1937",
                        ELLIPSOID["International 1924",6378388,297,
                            LENGTHUNIT["metre",1]]],
                    PRIMEM["Greenwich",0,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4207]]],
            METHOD["Longitude rotation",
                ID["EPSG",9601]],
            PARAMETER["Longitude offset",-9.13190611111111,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8602]],
            OPERATIONACCURACY[0.0],
            ID["EPSG",1756]]],
    STEP[
        COORDINATEOPERATION["Lisbon to ETRS89 (3)",
            VERSION["CGC-Prt 2009 7m"],
            SOURCECRS[
                GEOGCRS["Lisbon",
                    DATUM["Lisbon 1937",
                        ELLIPSOID["International 1924",6378388,297,
                            LENGTHUNIT["metre",1]]],
                    PRIMEM["Greenwich",0,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4207]]],
            TARGETCRS[
                GEOGCRS["ETRS89",
                    ENSEMBLE["European Terrestrial Reference System 1989
ensemble",
                        MEMBER["European Terrestrial Reference Frame 1989"],
                        MEMBER["European Terrestrial Reference Frame 1990"],
                        MEMBER["European Terrestrial Reference Frame 1991"],
                        MEMBER["European Terrestrial Reference Frame 1992"],
                        MEMBER["European Terrestrial Reference Frame 1993"],
                        MEMBER["European Terrestrial Reference Frame 1994"],
                        MEMBER["European Terrestrial Reference Frame 1996"],
                        MEMBER["European Terrestrial Reference Frame 1997"],
                        MEMBER["European Terrestrial Reference Frame 2000"],
                        MEMBER["European Terrestrial Reference Frame 2005"],
                        MEMBER["European Terrestrial Reference Frame 2014"],
                        ELLIPSOID["GRS 1980",6378137,298.257222101,
                            LENGTHUNIT["metre",1]],
                        ENSEMBLEACCURACY[0.1]],
                    PRIMEM["Greenwich",0,
                        ANGLEUNIT["degree",0.0174532925199433]],
                    CS[ellipsoidal,2],
                        AXIS["geodetic latitude (Lat)",north,
                            ORDER[1],
                            ANGLEUNIT["degree",0.0174532925199433]],
                        AXIS["geodetic longitude (Lon)",east,
                            ORDER[2],
                            ANGLEUNIT["degree",0.0174532925199433]],
                    ID["EPSG",4258]]],
            METHOD["Geocentric translations (geog2D domain)",
                ID["EPSG",9603]],
            PARAMETER["X-axis translation",-303.861,
                LENGTHUNIT["metre",1],
                ID["EPSG",8605]],
            PARAMETER["Y-axis translation",-60.693,
                LENGTHUNIT["metre",1],
                ID["EPSG",8606]],
            PARAMETER["Z-axis translation",103.607,
                LENGTHUNIT["metre",1],
                ID["EPSG",8607]],
            OPERATIONACCURACY[2.5],
            ID["EPSG",5038],
            REMARK["Derived in July 2009 from 119 common stations. Average
residual at 833 test points 2.5m, maximum 7m. Info source also gives a
Position Vector tfm which is of similar accuracy. Replaces Lisbon to ETRS89
(2) (tfm code 1997)."]]],
    STEP[
        CONVERSION["Portugual TM06",
            METHOD["Transverse Mercator",
                ID["EPSG",9807]],
            PARAMETER["Latitude of natural origin",39.6682583333333,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8801]],
            PARAMETER["Longitude of natural origin",-8.13310833333333,
                ANGLEUNIT["degree",0.0174532925199433],
                ID["EPSG",8802]],
            PARAMETER["Scale factor at natural origin",1,
                SCALEUNIT["unity",1],
                ID["EPSG",8805]],
            PARAMETER["False easting",0,
                LENGTHUNIT["metre",1],
                ID["EPSG",8806]],
            PARAMETER["False northing",0,
                LENGTHUNIT["metre",1],
                ID["EPSG",8807]],
            ID["EPSG",19853]]],
    USAGE[
        SCOPE["unknown"],
        AREA["Portugal - mainland - onshore."],
        BBOX[36.95,-9.56,42.16,-6.19]]]

Operation no. 1 uses grids and has an accuracy of about 0.1 meters,
compared to operation no. 2 that uses a Molodensky transformation and has
an accuracy of 2.5 m.

So, in theory, operation no. 1 should be used by default.

However, testing with gdaltransform:

C:\OSGeo4W>gdaltransform -s_srs EPSG:20790 -t_srs EPSG:3763
Enter X Y [Z [T]] values separated by space, and press Return.
286415 431434
*86412.5265012686 131433.856093867 0*

Using the grids on QGIS and on a web application of the institution that
has produced the NTv2 grids used on PROJ, the transformation output is
*86412.426 131434.171*

The difference is not huge, but this makes me believe that operations like
gdalwarp or ogr2ogr do not use the operation no. 1 by default. Am I right?
Could this be a bug? Or is there a way to force the operation used? How is
the decision managed by GDAL/OGR?

Thank you very much!

Best regards,
Pedro Ven?ncio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211005/96f65df2/attachment-0001.html>

From even.rouault at spatialys.com  Tue Oct  5 16:05:27 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 6 Oct 2021 01:05:27 +0200
Subject: [gdal-dev] GDAL/OGR coordinate transformations candidate
 operations priority
In-Reply-To: <CAMCJChvTGy6LhEvytEnQBWHoym4-21xm2GCQW7kVMZSGpi1E+g@mail.gmail.com>
References: <CAMCJChvTGy6LhEvytEnQBWHoym4-21xm2GCQW7kVMZSGpi1E+g@mail.gmail.com>
Message-ID: <3a134d4e-afae-e253-59a6-be661a0d7cee@spatialys.com>

This is a PROJ >= 7.2 bug, related to CRS with non-Greenwich prime 
meridian. Fix in https://github.com/OSGeo/PROJ/pull/2884

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.


From pedrongvenancio at gmail.com  Tue Oct  5 16:26:49 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 6 Oct 2021 00:26:49 +0100
Subject: [gdal-dev] GDAL/OGR coordinate transformations candidate
 operations priority
In-Reply-To: <3a134d4e-afae-e253-59a6-be661a0d7cee@spatialys.com>
References: <CAMCJChvTGy6LhEvytEnQBWHoym4-21xm2GCQW7kVMZSGpi1E+g@mail.gmail.com>
 <3a134d4e-afae-e253-59a6-be661a0d7cee@spatialys.com>
Message-ID: <CAMCJChtDCmEop0Of8_ESRkTbEP1ctdHORvdH0J15wYJcre2HJg@mail.gmail.com>

What a supersonic fix Even, thank you very much!!

So, the default will be the use of the operation with better accuracy,
right?

Thanks Even!

Pedro



Even Rouault <even.rouault at spatialys.com> escreveu no dia quarta, 6/10/2021
?(s) 00:06:

> This is a PROJ >= 7.2 bug, related to CRS with non-Greenwich prime
> meridian. Fix in https://github.com/OSGeo/PROJ/pull/2884
>
> Even
>
> --
>
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211006/783f6e4c/attachment.html>

From even.rouault at spatialys.com  Tue Oct  5 16:32:44 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 6 Oct 2021 01:32:44 +0200
Subject: [gdal-dev] GDAL/OGR coordinate transformations candidate
 operations priority
In-Reply-To: <CAMCJChtDCmEop0Of8_ESRkTbEP1ctdHORvdH0J15wYJcre2HJg@mail.gmail.com>
References: <CAMCJChvTGy6LhEvytEnQBWHoym4-21xm2GCQW7kVMZSGpi1E+g@mail.gmail.com>
 <3a134d4e-afae-e253-59a6-be661a0d7cee@spatialys.com>
 <CAMCJChtDCmEop0Of8_ESRkTbEP1ctdHORvdH0J15wYJcre2HJg@mail.gmail.com>
Message-ID: <6b8365b7-0aeb-de91-db2a-fb3e9de8c66b@spatialys.com>


Le 06/10/2021 ? 01:26, Pedro Ven?ncio a ?crit?:
> What a supersonic fix Even, thank you very much!!
>
> So, the default will be the use of the operation with better accuracy, 
> right?

yes, due to the issue with the prime meridian, PROJ was confused and 
didn't find any valid operation with the appropriate area of use, and 
thus it fell back to an operation not using a grid


>
> Thanks Even!
>
> Pedro
>
>
>
> Even Rouault <even.rouault at spatialys.com 
> <mailto:even.rouault at spatialys.com>> escreveu no dia quarta, 6/10/2021 
> ?(s) 00:06:
>
>     This is a PROJ >= 7.2 bug, related to CRS with non-Greenwich prime
>     meridian. Fix in https://github.com/OSGeo/PROJ/pull/2884
>     <https://github.com/OSGeo/PROJ/pull/2884>
>
>     Even
>
>     -- 
>
>     http://www.spatialys.com <http://www.spatialys.com>
>     My software is free, but my time generally not.
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>     <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211006/1353e1c3/attachment.html>

From pedrongvenancio at gmail.com  Tue Oct  5 16:38:23 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 6 Oct 2021 00:38:23 +0100
Subject: [gdal-dev] GDAL/OGR coordinate transformations candidate
 operations priority
In-Reply-To: <6b8365b7-0aeb-de91-db2a-fb3e9de8c66b@spatialys.com>
References: <CAMCJChvTGy6LhEvytEnQBWHoym4-21xm2GCQW7kVMZSGpi1E+g@mail.gmail.com>
 <3a134d4e-afae-e253-59a6-be661a0d7cee@spatialys.com>
 <CAMCJChtDCmEop0Of8_ESRkTbEP1ctdHORvdH0J15wYJcre2HJg@mail.gmail.com>
 <6b8365b7-0aeb-de91-db2a-fb3e9de8c66b@spatialys.com>
Message-ID: <CAMCJChsnS24zger2o9fNsZMG056CUBwe7yXAUTmcs5TbzeGz8A@mail.gmail.com>

>
> So, the default will be the use of the operation with better accuracy,
> right?
>
> yes, due to the issue with the prime meridian, PROJ was confused and
> didn't find any valid operation with the appropriate area of use, and thus
> it fell back to an operation not using a grid
>
Perfect, thank you very much Even!

Pedro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211006/9ba87d48/attachment.html>

From landa.martin at gmail.com  Wed Oct  6 01:46:14 2021
From: landa.martin at gmail.com (Martin Landa)
Date: Wed, 6 Oct 2021 10:46:14 +0200
Subject: [gdal-dev] gdal 3.1.2: Unknown resampling method: 13.
Message-ID: <CA+Ei1OcwT6E2rJq44T+uWLbce63jSimuUH65rMernyr4uZXnag@mail.gmail.com>

Hi all,

we have issue with using gdalconst.GRA_Sum. Calling Warp() with
GRA_Sum leads to the error message below:

gdal.Warp(output_path, file, dstSRS='EPSG:3035',
resampleAlg=gdalconst.GRA_Sum,xRes=1000, yRes=1000)

ERROR 5: Unknown resampling method: 13.
File "/usr/lib/python3/dist-packages/osgeo/gdal.py", line 689, in Warp
return wrapper_GDALWarpDestName(destNameOrDestDS, srcDSTab, opts,
callback, callback_data)
File "/usr/lib/python3/dist-packages/osgeo/gdal.py", line 4600, in
wrapper_GDALWarpDestName
return _gdal.wrapper_GDALWarpDestName(*args)
TypeError: in method 'wrapper_GDALWarpDestName', argument 4 of type
'GDALWarpAppOptions *'

Is it a bug or feature - GRA_Sum is not supported by Warp()?

Thanks for clarification in advance, Martin

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From robert.coup at koordinates.com  Wed Oct  6 03:19:52 2021
From: robert.coup at koordinates.com (Robert Coup)
Date: Wed, 6 Oct 2021 11:19:52 +0100
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <rmipmsjmy8f.fsf@s1.lexort.com>
 <CADRrdKuvHoN1LLAyxLKSVANg3spYBgxSMqd_piMeCki7Wdhs7Q@mail.gmail.com>
Message-ID: <CAFLLRpKJr_iwg-uxaXvxWsdvox-=1PxV6rwfZMHi8nQgTAEEzw@mail.gmail.com>

(on-list)

Hi,

On Tue, 5 Oct 2021 at 14:16, Javier Jimenez Shaw <j1 at jimenezshaw.com> wrote:

> How would CMake behave with all those options that are defined depending
> on what is present on the compiler machine?
>

This is orthogonal to CMake vs Make, but the RFC does discuss cleaning up
consistency of build options cross-platform and the opt-in/out of building
drivers.

In general, for most people building I think we want the build to
automatically pick up the libraries/formats/options that are available so
it works for them with minimal effort. But we should set it up, as Kurt
mentioned, for builders to easily be able to "opt-out" of (nearly) every
driver and then selectively re-enable them (& obviously their dependency
requirements) as needed.

Different distributions have different approaches here ? some build with
basically every possible option & dependency enabled ("the kitchen sink"),
others build with limited dependencies and as a user if you want to turn on
anything else then you'll need to rebuild it yourself.

IMHO, the libraries included should be independent on what is already
> installed on the compiler machine. The last time something/somebody
> included "zstd" in our compiler machine, and not in the executing machine,
> and we couldn't run anything. We did not need zstd, but it was there,
> breaking the execution. I know that the solution there is disable it
> "--without-zstd". What I do not like is the lack of definition, because
> what is present on the compiler machine may change.
>

If you are packaging for distribution (within an org or publicly), being
careful about which dependencies/versions/etc are available is a regular
issue which projects like GDAL shouldn't try to overly control ? everything
needs to be built in an isolated environment, be it a container,
fakeroot/chroot, or something else. Downstream packagers for Linux/BSD/etc
all are very careful to do this, it's not a new problem.

Rob :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211006/616c2029/attachment-0001.html>

From even.rouault at spatialys.com  Wed Oct  6 05:00:19 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 6 Oct 2021 14:00:19 +0200
Subject: [gdal-dev] gdal 3.1.2: Unknown resampling method: 13.
In-Reply-To: <CA+Ei1OcwT6E2rJq44T+uWLbce63jSimuUH65rMernyr4uZXnag@mail.gmail.com>
References: <CA+Ei1OcwT6E2rJq44T+uWLbce63jSimuUH65rMernyr4uZXnag@mail.gmail.com>
Message-ID: <e420ec46-9a24-2697-0b6e-367c5763e6dd@spatialys.com>

Martin,

I'm even surprised gdalconst.GRA_Sum was valid in GDAL 3.1.2, as it was 
added (in the Python bindings) only in 3.3.0 per 
https://github.com/OSGeo/gdal/pull/4604

But there were other issues that prevented it to work, which will be 
fixed per https://github.com/OSGeo/gdal/pull/4604

You can workaround by using command line style:

gdal.Warp(output_path, file, options='-t_srs EPSG:3035 -r sum -tr 1000 
1000')

Even

Le 06/10/2021 ? 10:46, Martin Landa a ?crit?:
> Hi all,
>
> we have issue with using gdalconst.GRA_Sum. Calling Warp() with
> GRA_Sum leads to the error message below:
>
> gdal.Warp(output_path, file, dstSRS='EPSG:3035',
> resampleAlg=gdalconst.GRA_Sum,xRes=1000, yRes=1000)
>
> ERROR 5: Unknown resampling method: 13.
> File "/usr/lib/python3/dist-packages/osgeo/gdal.py", line 689, in Warp
> return wrapper_GDALWarpDestName(destNameOrDestDS, srcDSTab, opts,
> callback, callback_data)
> File "/usr/lib/python3/dist-packages/osgeo/gdal.py", line 4600, in
> wrapper_GDALWarpDestName
> return _gdal.wrapper_GDALWarpDestName(*args)
> TypeError: in method 'wrapper_GDALWarpDestName', argument 4 of type
> 'GDALWarpAppOptions *'
>
> Is it a bug or feature - GRA_Sum is not supported by Warp()?
>
> Thanks for clarification in advance, Martin
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From landa.martin at gmail.com  Wed Oct  6 06:53:42 2021
From: landa.martin at gmail.com (Martin Landa)
Date: Wed, 6 Oct 2021 15:53:42 +0200
Subject: [gdal-dev] gdal 3.1.2: Unknown resampling method: 13.
In-Reply-To: <e420ec46-9a24-2697-0b6e-367c5763e6dd@spatialys.com>
References: <CA+Ei1OcwT6E2rJq44T+uWLbce63jSimuUH65rMernyr4uZXnag@mail.gmail.com>
 <e420ec46-9a24-2697-0b6e-367c5763e6dd@spatialys.com>
Message-ID: <CA+Ei1OfG-J+7v8W7rR0w==r+_ueuqU7Gbu24xY7BRzXmEpOSbQ@mail.gmail.com>

Hi Even,

st 6. 10. 2021 v 14:00 odes?latel Even Rouault
<even.rouault at spatialys.com> napsal:
> I'm even surprised gdalconst.GRA_Sum was valid in GDAL 3.1.2, as it was
> added (in the Python bindings) only in 3.3.0 per
> https://github.com/OSGeo/gdal/pull/4604

sorry, I was wrong. I am running 3.3.2.

> But there were other issues that prevented it to work, which will be
> fixed per https://github.com/OSGeo/gdal/pull/4604
>
> You can workaround by using command line style:
>
> gdal.Warp(output_path, file, options='-t_srs EPSG:3035 -r sum -tr 1000
> 1000')

Great. Martin

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From matteo.ghetta at gmail.com  Wed Oct  6 08:37:33 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Wed, 6 Oct 2021 17:37:33 +0200
Subject: [gdal-dev] ogr2ogr changes field length
Message-ID: <3e9fef03-9885-8474-88a0-15bcf1869848@gmail.com>

Hi list,

I've a script that uses ogr2ogr to copy, actually overwrite, tables from 
PG to shapfiles.

The PG fields are all text (without a specified length) and the target 
shapefile that will be overwritten have all text field length equals to 254.

When overwriting the length is changes to 80. Is there any specific 
option to keep the original field length?

Cheers and thanks

Matteo

From even.rouault at spatialys.com  Wed Oct  6 08:49:23 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 6 Oct 2021 17:49:23 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <3e9fef03-9885-8474-88a0-15bcf1869848@gmail.com>
References: <3e9fef03-9885-8474-88a0-15bcf1869848@gmail.com>
Message-ID: <027b7119-a13c-fd81-5d5b-b65ae0239bdb@spatialys.com>

Matteo,

When overwriting, a fresh new file/table is creating, without keeping 
anything from the existing version.

You could probably just blank your target with

ogrinfo target.shp -sql "DELETE FROM target" -dialect SQLITE

and then ogr2ogr -append target.shp PG:....?? -nln target

Even

Le 06/10/2021 ? 17:37, matteo a ?crit?:
> Hi list,
>
> I've a script that uses ogr2ogr to copy, actually overwrite, tables 
> from PG to shapfiles.
>
> The PG fields are all text (without a specified length) and the target 
> shapefile that will be overwritten have all text field length equals 
> to 254.
>
> When overwriting the length is changes to 80. Is there any specific 
> option to keep the original field length?
>
> Cheers and thanks
>
> Matteo
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From sean at mapbox.com  Wed Oct  6 17:12:51 2021
From: sean at mapbox.com (Sean Gillies)
Date: Wed, 6 Oct 2021 18:12:51 -0600
Subject: [gdal-dev] HTTP range request retrying?
In-Reply-To: <70c46e0d-fb05-facf-2840-7f8cec383d79@spatialys.com>
References: <CADPhZXz+RUKVdLWhRbUbdj64HO26xU6aGPFwNWbRdVmdz99t5w@mail.gmail.com>
 <70c46e0d-fb05-facf-2840-7f8cec383d79@spatialys.com>
Message-ID: <CADPhZXw8xZ++m7TG2jV2+R=KJHX+eCgMOt8Rs-tg2xf1V=NnXQ@mail.gmail.com>

Hi Even,

Yes, that's a good point. What I've done at
https://github.com/mapbox/rasterio/blob/maint-1.2/tests/test_warp.py#L2022
makes the tests sensitive to the text of CPLError messages, which could
change. It's not ideal. On the other hand, I do have confirmation that
range requests can be retried. It can be a hard thing to demonstrate
reliably with production servers, which might return a 503 only one time in
a million.

On Tue, Oct 5, 2021 at 10:09 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi Sean,
>
> The code for retry of range requests of regions of data is at
> https://github.com/OSGeo/gdal/blob/master/gdal/port/cpl_vsil_curl.cpp#L1602
> . It indeed looks like there's no test for that. You might file an issue
> about adding one.
>
> Side node: it might become a maintenance burden on rasterio if you test
> such low level implementation detail of GDAL, especially if you test like
> we do which exact requests are done and in which order, if we change at
> some later point how requests are done
>
> Even
> Le 05/10/2021 ? 17:44, Sean Gillies via gdal-dev a ?crit :
>
> Hi all,
>
> In writing some rasterio tests I am able to get GDAL to retry head
> requests for a vsicurl dataset, but am unable to trigger retries for range
> requests to regions of the data. I don't recognize any tests for range
> request retrying in or near
> https://github.com/OSGeo/gdal/blob/master/autotest/gcore/vsicurl.py#L473.
> Do we intend to support this or is it a missing feature?
>
> --
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211006/2fe63746/attachment.html>

From apschwimmer at apmland.de  Thu Oct  7 00:47:52 2021
From: apschwimmer at apmland.de (APM)
Date: Thu, 7 Oct 2021 09:47:52 +0200
Subject: [gdal-dev] Compilation error gdal / git
Message-ID: <5b3c96f4-fedd-fc1e-e92b-88f4e291460b@apmland.de>

Dear List,


if I try to compile gdal, I got an error message, see below in this email.


I use Debian testing and git:


git clone https://github.com/OSGeo/gdal.git

cd gdal

git checkout master

cd gdal

./autogen.sh


configure.ac:6172: warning: AC_OUTPUT should be used without arguments.
configure.ac:6172: You should run autoupdate.


autoupdate


configure.ac:212: warning: AC_PROG_CC_C99 is obsolete; use AC_PROG_CC

configure.ac:289: warning: The preprocessor macro `STDC_HEADERS' is 
obsolete.
 ? Except in unusual embedded environments, you can safely include all
 ? ISO C90 headers unconditionally.


./configure --prefix=/home/user/apps/gdal/


make -j4

Error:

/src/gdal/gdal$ ./autogen.sh
+ aclocal -I ./m4
configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an 
AC_DEFUN'd macro
configure.ac:218: the top level
autom4te: error: /usr/bin/m4 failed with exit status: 1
aclocal: error: autom4te failed with exit status: 1
+ autoconf
configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an 
AC_DEFUN'd macro
configure.ac:218: the top level
autom4te: error: /usr/bin/m4 failed with exit status: 1


I'm not sure if I deal with gdal/git correctly.


Maybe you have a tipp?


Thank you!


Kind regards


Piet




From thomas.bonfort at gmail.com  Thu Oct  7 01:01:53 2021
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Thu, 7 Oct 2021 10:01:53 +0200
Subject: [gdal-dev] Compilation error gdal / git
In-Reply-To: <5b3c96f4-fedd-fc1e-e92b-88f4e291460b@apmland.de>
References: <5b3c96f4-fedd-fc1e-e92b-88f4e291460b@apmland.de>
Message-ID: <CAOM3y2jXm056iwXUp5wnieEo_KK2yKg2-etpEu-mrjLZfH+Zkw@mail.gmail.com>

we seem to be using deprecated autoconf macros. It should work if you
downgrade autoconf to version 2.69 on your system. I'll look into
fixing our autoconf.ac syntax in a coming PR.

regards,
Thomas

On Thu, Oct 7, 2021 at 9:53 AM APM <apschwimmer at apmland.de> wrote:
>
> Dear List,
>
>
> if I try to compile gdal, I got an error message, see below in this email.
>
>
> I use Debian testing and git:
>
>
> git clone https://github.com/OSGeo/gdal.git
>
> cd gdal
>
> git checkout master
>
> cd gdal
>
> ./autogen.sh
>
>
> configure.ac:6172: warning: AC_OUTPUT should be used without arguments.
> configure.ac:6172: You should run autoupdate.
>
>
> autoupdate
>
>
> configure.ac:212: warning: AC_PROG_CC_C99 is obsolete; use AC_PROG_CC
>
> configure.ac:289: warning: The preprocessor macro `STDC_HEADERS' is
> obsolete.
>    Except in unusual embedded environments, you can safely include all
>    ISO C90 headers unconditionally.
>
>
> ./configure --prefix=/home/user/apps/gdal/
>
>
> make -j4
>
> Error:
>
> /src/gdal/gdal$ ./autogen.sh
> + aclocal -I ./m4
> configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an
> AC_DEFUN'd macro
> configure.ac:218: the top level
> autom4te: error: /usr/bin/m4 failed with exit status: 1
> aclocal: error: autom4te failed with exit status: 1
> + autoconf
> configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an
> AC_DEFUN'd macro
> configure.ac:218: the top level
> autom4te: error: /usr/bin/m4 failed with exit status: 1
>
>
> I'm not sure if I deal with gdal/git correctly.
>
>
> Maybe you have a tipp?
>
>
> Thank you!
>
>
> Kind regards
>
>
> Piet
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From killerm250m at gmail.com  Thu Oct  7 03:21:37 2021
From: killerm250m at gmail.com (Mohammed Aljezawi)
Date: Thu, 7 Oct 2021 13:21:37 +0300
Subject: [gdal-dev] WFS driver
Message-ID: <CAKzdFWTpkPGtGEm3v2P_jAJ_5jHs6v=aXQUosMuT0ByC6Qo+0Q@mail.gmail.com>

Hi,
I am using gdal to convert from WFS to geopackge, everything is
working fine but I need to change the name of each table before or after
converting to GeoPackage, because the layer name has a special charachart
that in my application it's not working.

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211007/e2cb02d3/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Oct  7 04:46:09 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 7 Oct 2021 11:46:09 +0000
Subject: [gdal-dev] WFS driver
Message-ID: <f3ff894304e5429e90aeaa79dcad8998@maanmittauslaitos.fi>

Hi,

If you are asking the same question in gis.stackexchange please wait some minutes if somebody happens to answer you before sending mail to gdal-dev. Or vise versa. Crossposting in the long run will not help you to get answers faster.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Mohammed Aljezawi
L?hetetty: torstai 7. lokakuuta 2021 13.22
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] WFS driver

Hi,
I am using gdal to convert from WFS to geopackge, everything is working fine but I need to change the name of each table before or after converting to GeoPackage, because the layer name has a special charachart that in my application it's not working.

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211007/4a18708b/attachment.html>

From matteo.ghetta at gmail.com  Thu Oct  7 07:54:11 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Thu, 7 Oct 2021 16:54:11 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <027b7119-a13c-fd81-5d5b-b65ae0239bdb@spatialys.com>
References: <3e9fef03-9885-8474-88a0-15bcf1869848@gmail.com>
 <027b7119-a13c-fd81-5d5b-b65ae0239bdb@spatialys.com>
Message-ID: <8f97a98c-ad3f-00fc-263a-1a895fe6b548@gmail.com>

Hi Even,

thanks for the hint :) it si just an additional step

Cheers!

Matteo

From matteo.ghetta at gmail.com  Thu Oct  7 08:40:35 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Thu, 7 Oct 2021 17:40:35 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <8f97a98c-ad3f-00fc-263a-1a895fe6b548@gmail.com>
References: <3e9fef03-9885-8474-88a0-15bcf1869848@gmail.com>
 <027b7119-a13c-fd81-5d5b-b65ae0239bdb@spatialys.com>
 <8f97a98c-ad3f-00fc-263a-1a895fe6b548@gmail.com>
Message-ID: <54249618-cb48-e996-fa61-1acb8de91242@gmail.com>

Even,

still a weird issue with the command. I'm using this command

ogr2ogr -f "ESRI Shapefile" /home/matteo/myfolder "PG:dbname='mydb' 
host=myhost port=5432 user='myuser' password='mypws' sslmode=disable 
schemas='dati'" --config PG_USE_COPY YES --config PG_LIST_ALL_TABLES YES 
-progress'

so without any append or overwrite (dumping a whole schema in a folder).

I've both spatial and not spatial tables and for all of them the text 
fields are created in PG like:

CREATE TABLE mytable (
     ID SERIAL PRIMARY KEY,
     .....
     NOTE text
)

and all these fields are 80 characters long in the newly created 
shapefiles...

I don't know if I can give some more information..

Cheers and thanks

Matteo

From even.rouault at spatialys.com  Thu Oct  7 08:59:05 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 7 Oct 2021 17:59:05 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <54249618-cb48-e996-fa61-1acb8de91242@gmail.com>
References: <3e9fef03-9885-8474-88a0-15bcf1869848@gmail.com>
 <027b7119-a13c-fd81-5d5b-b65ae0239bdb@spatialys.com>
 <8f97a98c-ad3f-00fc-263a-1a895fe6b548@gmail.com>
 <54249618-cb48-e996-fa61-1acb8de91242@gmail.com>
Message-ID: <50539aab-076b-e787-15e7-5f45d6159b0f@spatialys.com>

If you add -lco RESIZE=YES fields will be resized to their minimum size. 
See https://gdal.org/drivers/vector/shapefile.html#layer-creation-options

Le 07/10/2021 ? 17:40, matteo a ?crit?:
> Even,
>
> still a weird issue with the command. I'm using this command
>
> ogr2ogr -f "ESRI Shapefile" /home/matteo/myfolder "PG:dbname='mydb' 
> host=myhost port=5432 user='myuser' password='mypws' sslmode=disable 
> schemas='dati'" --config PG_USE_COPY YES --config PG_LIST_ALL_TABLES 
> YES -progress'
>
> so without any append or overwrite (dumping a whole schema in a folder).
>
> I've both spatial and not spatial tables and for all of them the text 
> fields are created in PG like:
>
> CREATE TABLE mytable (
> ??? ID SERIAL PRIMARY KEY,
> ??? .....
> ??? NOTE text
> )
>
> and all these fields are 80 characters long in the newly created 
> shapefiles...
>
> I don't know if I can give some more information..
>
> Cheers and thanks
>
> Matteo

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From j1 at jimenezshaw.com  Thu Oct  7 09:17:02 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 7 Oct 2021 18:17:02 +0200
Subject: [gdal-dev] running PROJ-data/regenerate_index_html.py
Message-ID: <CADRrdKu663kzXRLz9o-BvQmn2-Hyu4J3B839nW8=AfbUiwqGEQ@mail.gmail.com>

Hi

On the contribution process of PROJ-data, there is a step where you should
run "regenerate_index_html.py". For that you need GDAL, and a recent enough
one.
What I do is to use a docker image: osgeo/gdal:alpine-normal-latest (so I
am sure I am up to date)

However, the script also requires "git", that is not present in that docker
image.

Could we include "git" in that GDAL docker image? Is there a better option?

Thanks
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211007/5334311e/attachment.html>

From even.rouault at spatialys.com  Thu Oct  7 09:25:18 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 7 Oct 2021 18:25:18 +0200
Subject: [gdal-dev] running PROJ-data/regenerate_index_html.py
In-Reply-To: <CADRrdKu663kzXRLz9o-BvQmn2-Hyu4J3B839nW8=AfbUiwqGEQ@mail.gmail.com>
References: <CADRrdKu663kzXRLz9o-BvQmn2-Hyu4J3B839nW8=AfbUiwqGEQ@mail.gmail.com>
Message-ID: <9fc75684-6d72-f007-6634-fb5d27eceabe@spatialys.com>

I'd like to keep those images as small as possible. You could just 
create a derived Docker image that installs git on top of it. Anyway, it 
is not critical if you submit a PR without the updated indexes. I can 
easily run the script on my end, before resyncing the CDN

Le 07/10/2021 ? 18:17, Javier Jimenez Shaw a ?crit?:
> Hi
>
> On the contribution process of PROJ-data, there is a step where you 
> should run "regenerate_index_html.py". For that you need GDAL, and a 
> recent enough one.
> What I do is to use a docker image: osgeo/gdal:alpine-normal-latest 
> (so I am sure I am up to date)
>
> However, the script also requires "git", that is not present in that 
> docker image.
>
> Could we include "git" in that GDAL docker image? Is there a better 
> option?
>
> Thanks
> .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211007/5b8950fc/attachment.html>

From kirk.waters at noaa.gov  Thu Oct  7 12:41:23 2021
From: kirk.waters at noaa.gov (Kirk Waters - NOAA Federal)
Date: Thu, 7 Oct 2021 15:41:23 -0400
Subject: [gdal-dev] GDAL 3.x and AutoCAD GeoTIFF georeferencing
Message-ID: <CADm=QrRY9UmqVHegp_sXWe=bqT0Xt9gyOg+rsPp-p5N8NkRztg@mail.gmail.com>

Hi all,
I'm finding a change in georeferencing between GDAL 2.4 and 3.x that
results in AutoCAD not being able to figure out where on earth a geotiff
should be. I don't have AutoCAD, so I'm reliant on what my downstream users
are telling me. These are elevation Tiffs, so they do have a vertical
component to the SRS and that may be where the difference lies. I know it
isn't up to GDAL to solve AutoCAD's lack of standards adoption, but I'm
wondering if anyone has come across this and if there's a way to force the
outputs that AutoCAD will read.

Two small files are included in a zip file at
ftp://ftp.coast.noaa.gov/tmp/kwaters/autocad_issues.zip. One
(Job640647_ches_coned.tif, made with GDAL 2.4) has georeferencing that
works in AutoCAD, the other was made with GDAL 3.3.1 and has georeferencing
that fails. Both were made with gdal_translate -a_srs EPSG:3582+6360 with
the difference being the version of GDAL. They are not the exact same
location on the ground.

If I look at the files with listgeo, the older version has more tags and
includes the horizontal and vertical units. With gdalsrsinfo, the newer one
shows the more complete COMPOUNDCRS that includes the vertical component.

I'm hoping I don't have to go back to GDAL 2.4 for AutoCAD users. If anyone
has come across a solution before, I'd love to hear it.

Thanks,

Kirk Waters, PhD                     | NOAA Office for Coastal Management
Applied Sciences Program      | 2234 South Hobson Ave
                                                 | Charleston, SC 29405
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211007/5893ccb0/attachment.html>

From even.rouault at spatialys.com  Thu Oct  7 12:59:24 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 7 Oct 2021 21:59:24 +0200
Subject: [gdal-dev] GDAL 3.x and AutoCAD GeoTIFF georeferencing
In-Reply-To: <CADm=QrRY9UmqVHegp_sXWe=bqT0Xt9gyOg+rsPp-p5N8NkRztg@mail.gmail.com>
References: <CADm=QrRY9UmqVHegp_sXWe=bqT0Xt9gyOg+rsPp-p5N8NkRztg@mail.gmail.com>
Message-ID: <aca9a27a-621b-7a43-d595-bdec7360f7c0@spatialys.com>

Kirk,

the download link doesn't work.

GDAL 3.3 will use geotiff 1.1 conventions by default when a compound CRS 
is used. You may try adding -co GEOTIFF_VERSION=1.0 to force GeoTIFF 1.0.

When reading a GeoTIFF 1.1 file, GDAL will report the compoundCRS. For 
GeoTIFF 1.0 files, you need to specify --config |GTIFF_REPORT_COMPD_CS 
YES (see https://gdal.org/drivers/raster/gtiff.html#configuration-options)|

Autocad users should ideally report that to their vendor so they add 
support for GeoTIFF 1.1 (or maybe the issue is not much the change of 
the version number, but that we stripped down the formulation of geokeys 
to the minimum to avoid specifying things twice and the risk of 
contradiction)

Even
||||

Le 07/10/2021 ? 21:41, Kirk Waters - NOAA Federal via gdal-dev a ?crit?:
> Hi all,
> I'm finding a change in georeferencing between GDAL 2.4 and 3.x that 
> results in AutoCAD not being able to figure out where on earth a 
> geotiff should be. I don't have AutoCAD, so I'm reliant?on what my 
> downstream users are telling me. These are elevation Tiffs, so they do 
> have a vertical component to the SRS and that may be where the 
> difference lies. I know it isn't up to GDAL to solve AutoCAD's lack of 
> standards adoption, but I'm wondering if anyone has come across this 
> and if there's a way to force the outputs that AutoCAD will read.
>
> Two small files are included in a zip file at 
> ftp://ftp.coast.noaa.gov/tmp/kwaters/autocad_issues.zip 
> <ftp://ftp.coast.noaa.gov/tmp/kwaters/autocad_issues.zip>. One 
> (Job640647_ches_coned.tif, made with GDAL 2.4) has georeferencing that 
> works in AutoCAD, the other was made with GDAL 3.3.1 and has 
> georeferencing that fails. Both were made with gdal_translate 
> -a_srs?EPSG:3582+6360 with the difference being the version of GDAL. 
> They are not the exact same location on the ground.
>
> If I look at the files with listgeo, the older version has more tags 
> and includes the horizontal and vertical units. With gdalsrsinfo, the 
> newer one shows the more complete COMPOUNDCRS that includes the 
> vertical component.
>
> I'm hoping I don't have to go back to GDAL 2.4 for AutoCAD users. If 
> anyone has come across a solution before, I'd love to hear it.
>
> Thanks,
>
> Kirk Waters, PhD ? ? ? ? ? ?| NOAA Office for Coastal Management
> Applied Sciences Program ? ?| 2234 South Hobson Ave
> ? ? ? ? ? ?| Charleston, SC 29405
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211007/b21bbca8/attachment.html>

From kirk.waters at noaa.gov  Thu Oct  7 13:03:20 2021
From: kirk.waters at noaa.gov (Kirk Waters - NOAA Federal)
Date: Thu, 7 Oct 2021 16:03:20 -0400
Subject: [gdal-dev] GDAL 3.x and AutoCAD GeoTIFF georeferencing
In-Reply-To: <aca9a27a-621b-7a43-d595-bdec7360f7c0@spatialys.com>
References: <CADm=QrRY9UmqVHegp_sXWe=bqT0Xt9gyOg+rsPp-p5N8NkRztg@mail.gmail.com>
 <aca9a27a-621b-7a43-d595-bdec7360f7c0@spatialys.com>
Message-ID: <CADm=QrS8VMNdfgSZfRPm8Z3LS=K5DmKFid_Xos9fAjaUqcxhmw@mail.gmail.com>

My apologies on typing the link and adding an 's' to the name. Should be
ftp://ftp.coast.noaa.gov/tmp/kwaters/autocad_issue.zip

Thanks for the tip on the configuration option! I agree about the ideal
solution.

Kirk


On Thu, Oct 7, 2021 at 3:59 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Kirk,
>
> the download link doesn't work.
>
> GDAL 3.3 will use geotiff 1.1 conventions by default when a compound CRS
> is used. You may try adding -co GEOTIFF_VERSION=1.0 to force GeoTIFF 1.0.
>
> When reading a GeoTIFF 1.1 file, GDAL will report the compoundCRS. For
> GeoTIFF 1.0 files, you need to specify --config GTIFF_REPORT_COMPD_CS YES
> (see https://gdal.org/drivers/raster/gtiff.html#configuration-options)
>
> Autocad users should ideally report that to their vendor so they add
> support for GeoTIFF 1.1 (or maybe the issue is not much the change of the
> version number, but that we stripped down the formulation of geokeys to the
> minimum to avoid specifying things twice and the risk of contradiction)
>
> Even
> Le 07/10/2021 ? 21:41, Kirk Waters - NOAA Federal via gdal-dev a ?crit :
>
> Hi all,
> I'm finding a change in georeferencing between GDAL 2.4 and 3.x that
> results in AutoCAD not being able to figure out where on earth a geotiff
> should be. I don't have AutoCAD, so I'm reliant on what my downstream users
> are telling me. These are elevation Tiffs, so they do have a vertical
> component to the SRS and that may be where the difference lies. I know it
> isn't up to GDAL to solve AutoCAD's lack of standards adoption, but I'm
> wondering if anyone has come across this and if there's a way to force the
> outputs that AutoCAD will read.
>
> Two small files are included in a zip file at
> ftp://ftp.coast.noaa.gov/tmp/kwaters/autocad_issues.zip. One
> (Job640647_ches_coned.tif, made with GDAL 2.4) has georeferencing that
> works in AutoCAD, the other was made with GDAL 3.3.1 and has georeferencing
> that fails. Both were made with gdal_translate -a_srs EPSG:3582+6360 with
> the difference being the version of GDAL. They are not the exact same
> location on the ground.
>
> If I look at the files with listgeo, the older version has more tags and
> includes the horizontal and vertical units. With gdalsrsinfo, the newer one
> shows the more complete COMPOUNDCRS that includes the vertical component.
>
> I'm hoping I don't have to go back to GDAL 2.4 for AutoCAD users. If
> anyone has come across a solution before, I'd love to hear it.
>
> Thanks,
>
> Kirk Waters, PhD                     | NOAA Office for Coastal Management
> Applied Sciences Program      | 2234 South Hobson Ave
>                                                  | Charleston, SC 29405
>
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211007/e96b3601/attachment.html>

From matteo.ghetta at gmail.com  Thu Oct  7 23:10:52 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Fri, 8 Oct 2021 08:10:52 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <50539aab-076b-e787-15e7-5f45d6159b0f@spatialys.com>
References: <3e9fef03-9885-8474-88a0-15bcf1869848@gmail.com>
 <027b7119-a13c-fd81-5d5b-b65ae0239bdb@spatialys.com>
 <8f97a98c-ad3f-00fc-263a-1a895fe6b548@gmail.com>
 <54249618-cb48-e996-fa61-1acb8de91242@gmail.com>
 <50539aab-076b-e787-15e7-5f45d6159b0f@spatialys.com>
Message-ID: <14b2edfe-65d6-1746-69c8-83be0bf3e3dd@gmail.com>

Hi Even,

> If you add -lco RESIZE=YES fields will be resized to their minimum size. 
> See https://gdal.org/drivers/vector/shapefile.html#layer-creation-options

yep I see. I also read

* String fields without an assigned width are treated as 80 characters

does it mean that if a field is set as TEXT in PG (without length 
definition) the conversion to shapefile is automatically set to 80 and 
what we can do is to resize the field length only to have less characters?

Cheers!

Matteo

From jukka.rahkonen at maanmittauslaitos.fi  Thu Oct  7 23:51:20 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 8 Oct 2021 06:51:20 +0000
Subject: [gdal-dev] ogr2ogr changes field length
Message-ID: <6d80651b8b5e4cf6bf62755ae224dd7c@maanmittauslaitos.fi>

Hi,

The strings fields are created by default with width 80. If there are longer strings in the data the width is automatically extended up till 255 characters that is the maximum that dBase format supports. If strings are shorter than 80 charaters it is possible to use RESIZE and shrink the width to match the longest string used in that field.

If you need better control on field widths I suppose you must create an empty shapefile for ogr2ogr to append by your own code.

# Add a new field.
    field_defn = ogr.FieldDefn('NEWFLD', ogr.OFTString)
    field_defn.SetWidth(12)

Do you have some concrete problem with field widths that you want to resolve?

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta matteo
L?hetetty: perjantai 8. lokakuuta 2021 9.11
Vastaanottaja: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogr2ogr changes field length

Hi Even,

> If you add -lco RESIZE=YES fields will be resized to their minimum size. 
> See 
> https://gdal.org/drivers/vector/shapefile.html#layer-creation-options

yep I see. I also read

* String fields without an assigned width are treated as 80 characters

does it mean that if a field is set as TEXT in PG (without length
definition) the conversion to shapefile is automatically set to 80 and what we can do is to resize the field length only to have less characters?

Cheers!

Matteo
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From thomas.bonfort at gmail.com  Fri Oct  8 00:55:46 2021
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Fri, 8 Oct 2021 09:55:46 +0200
Subject: [gdal-dev] Compilation error gdal / git
In-Reply-To: <CAOM3y2jXm056iwXUp5wnieEo_KK2yKg2-etpEu-mrjLZfH+Zkw@mail.gmail.com>
References: <5b3c96f4-fedd-fc1e-e92b-88f4e291460b@apmland.de>
 <CAOM3y2jXm056iwXUp5wnieEo_KK2yKg2-etpEu-mrjLZfH+Zkw@mail.gmail.com>
Message-ID: <CAOM3y2g4GL3J6mhbZ8J1UeToAgy2myRkY8pDuQqeKNtgaXr=cw@mail.gmail.com>

I've had a quick look at what it would take to upgrade for autoconf >=
2.70 compatibility, and it is beyond what I am ready to invest,
especially given that part of the code is on the road to be phased out
due to the switch to cmake. Your best/only option is to uninstall your
apt supplied autoconf and apt install autoconf2.69

regards,

On Thu, Oct 7, 2021 at 10:01 AM thomas bonfort <thomas.bonfort at gmail.com> wrote:
>
> we seem to be using deprecated autoconf macros. It should work if you
> downgrade autoconf to version 2.69 on your system. I'll look into
> fixing our autoconf.ac syntax in a coming PR.
>
> regards,
> Thomas
>
> On Thu, Oct 7, 2021 at 9:53 AM APM <apschwimmer at apmland.de> wrote:
> >
> > Dear List,
> >
> >
> > if I try to compile gdal, I got an error message, see below in this email.
> >
> >
> > I use Debian testing and git:
> >
> >
> > git clone https://github.com/OSGeo/gdal.git
> >
> > cd gdal
> >
> > git checkout master
> >
> > cd gdal
> >
> > ./autogen.sh
> >
> >
> > configure.ac:6172: warning: AC_OUTPUT should be used without arguments.
> > configure.ac:6172: You should run autoupdate.
> >
> >
> > autoupdate
> >
> >
> > configure.ac:212: warning: AC_PROG_CC_C99 is obsolete; use AC_PROG_CC
> >
> > configure.ac:289: warning: The preprocessor macro `STDC_HEADERS' is
> > obsolete.
> >    Except in unusual embedded environments, you can safely include all
> >    ISO C90 headers unconditionally.
> >
> >
> > ./configure --prefix=/home/user/apps/gdal/
> >
> >
> > make -j4
> >
> > Error:
> >
> > /src/gdal/gdal$ ./autogen.sh
> > + aclocal -I ./m4
> > configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an
> > AC_DEFUN'd macro
> > configure.ac:218: the top level
> > autom4te: error: /usr/bin/m4 failed with exit status: 1
> > aclocal: error: autom4te failed with exit status: 1
> > + autoconf
> > configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an
> > AC_DEFUN'd macro
> > configure.ac:218: the top level
> > autom4te: error: /usr/bin/m4 failed with exit status: 1
> >
> >
> > I'm not sure if I deal with gdal/git correctly.
> >
> >
> > Maybe you have a tipp?
> >
> >
> > Thank you!
> >
> >
> > Kind regards
> >
> >
> > Piet
> >
> >
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev

From rdmailings at duif.net  Fri Oct  8 00:58:06 2021
From: rdmailings at duif.net (Richard Duivenvoorde)
Date: Fri, 8 Oct 2021 09:58:06 +0200
Subject: [gdal-dev] WFS driver
In-Reply-To: <f3ff894304e5429e90aeaa79dcad8998@maanmittauslaitos.fi>
References: <f3ff894304e5429e90aeaa79dcad8998@maanmittauslaitos.fi>
Message-ID: <531f2bee-0452-995c-3a4c-05b95167831f@duif.net>

On 10/7/21 1:46 PM, Rahkonen Jukka (MML) wrote:
> Hi,
> 
> If you are asking the same question in gis.stackexchange please wait some minutes if somebody happens to answer you before sending mail to gdal-dev. Or vise versa. Crossposting in the long run will not help you to get answers faster.

Well, it helped to get my attention ;-) I'm not so often looking at gis.stackexchange

But this USER question (this is not a dev question) I try to answer there now with some examples:

https://gis.stackexchange.com/questions/413390/

Hope this helps.

Regards,

Richard Duivenvoorde

From matteo.ghetta at gmail.com  Fri Oct  8 01:20:18 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Fri, 8 Oct 2021 10:20:18 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <6d80651b8b5e4cf6bf62755ae224dd7c@maanmittauslaitos.fi>
References: <6d80651b8b5e4cf6bf62755ae224dd7c@maanmittauslaitos.fi>
Message-ID: <3a526b0c-39c9-83f8-2d8a-9949c8fe6653@gmail.com>

Hi Jukka,

> The strings fields are created by default with width 80. If there are longer strings in the data the width is automatically extended up till 255 characters that is the maximum that dBase format supports. If strings are shorter than 80 charaters it is possible to use RESIZE and shrink the width to match the longest string used in that field.
> 
> If you need better control on field widths I suppose you must create an empty shapefile for ogr2ogr to append by your own code.
> 
> # Add a new field.
>      field_defn = ogr.FieldDefn('NEWFLD', ogr.OFTString)
>      field_defn.SetWidth(12)
> 
> Do you have some concrete problem with field widths that you want to resolve?

I'm "dumping" empty tables of a schema to shapefile and actually yes, I 
need that the fields with unlimited text set up in PG should be the 
maximum (so 254) in the final shapefiles.

All the tables are empty so I guess this is the "problem" I have

Cheers and thanks

Matteo

From jukka.rahkonen at maanmittauslaitos.fi  Fri Oct  8 01:45:04 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 8 Oct 2021 08:45:04 +0000
Subject: [gdal-dev] ogr2ogr changes field length
Message-ID: <c9d6e8ed023a471da9b8524c7ba08ff8@maanmittauslaitos.fi>

Hi,

The best I can suggest to do by using just GDAL utilities is to run this kind of ogrinfo command for each text field that you have in the shapefile schema:

ogrinfo my_shape.shp -sql "alter table my_shape alter column STRING_1 TYPE character(254)"

(right, the max length is 254).

-Jukka Rahkonen-
 
-----Alkuper?inen viesti-----
L?hett?j?: matteo <matteo.ghetta at gmail.com> 
L?hetetty: perjantai 8. lokakuuta 2021 11.20
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogr2ogr changes field length

Hi Jukka,

> The strings fields are created by default with width 80. If there are longer strings in the data the width is automatically extended up till 255 characters that is the maximum that dBase format supports. If strings are shorter than 80 charaters it is possible to use RESIZE and shrink the width to match the longest string used in that field.
> 
> If you need better control on field widths I suppose you must create an empty shapefile for ogr2ogr to append by your own code.
> 
> # Add a new field.
>      field_defn = ogr.FieldDefn('NEWFLD', ogr.OFTString)
>      field_defn.SetWidth(12)
> 
> Do you have some concrete problem with field widths that you want to resolve?

I'm "dumping" empty tables of a schema to shapefile and actually yes, I need that the fields with unlimited text set up in PG should be the maximum (so 254) in the final shapefiles.

All the tables are empty so I guess this is the "problem" I have

Cheers and thanks

Matteo

From matteo.ghetta at gmail.com  Fri Oct  8 02:29:28 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Fri, 8 Oct 2021 11:29:28 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <c9d6e8ed023a471da9b8524c7ba08ff8@maanmittauslaitos.fi>
References: <c9d6e8ed023a471da9b8524c7ba08ff8@maanmittauslaitos.fi>
Message-ID: <f26efa1c-4ba1-39c3-cbc9-38b10a00763b@gmail.com>

Hi Jukka,

works perfectly, thanks!

so no default options to impose the field length but it is alterable after

Cheers!

Matteo

From jukka.rahkonen at maanmittauslaitos.fi  Fri Oct  8 02:53:30 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 8 Oct 2021 09:53:30 +0000
Subject: [gdal-dev] ogr2ogr changes field length
Message-ID: <229643d6bb574eab96ba79a0dbdca2b9@maanmittauslaitos.fi>

Hi,

GDAL has the internal default of 80 characters. GDAL users do not really need other options because fields are automatically expanded when longer strings are appended afterwards but if the shapefile is used in some other software it does happen that it is impossible to insert long strings because there is no room for that in the table. I suppose that you also know that by using the field width of 254 you are also maximizing the size of the .dbf file because it reserves the same fixed amount of disk space for each cell.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: matteo <matteo.ghetta at gmail.com> 
L?hetetty: perjantai 8. lokakuuta 2021 12.29
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogr2ogr changes field length

Hi Jukka,

works perfectly, thanks!

so no default options to impose the field length but it is alterable after

Cheers!

Matteo

From even.rouault at spatialys.com  Fri Oct  8 14:56:17 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 8 Oct 2021 23:56:17 +0200
Subject: [gdal-dev] Compilation error gdal / git
In-Reply-To: <5b3c96f4-fedd-fc1e-e92b-88f4e291460b@apmland.de>
References: <5b3c96f4-fedd-fc1e-e92b-88f4e291460b@apmland.de>
Message-ID: <4b6392f5-5797-1e9a-bc76-83acbbaa1ff0@spatialys.com>

Hi,

Although a bit annoying, you can probably just ignore the warnings 
emitted by ./autogen.sh with autoconf 2.71, and run ./configure right 
behind, without trying autoupdate

I've a clean up in https://github.com/OSGeo/gdal/pull/4626 that results 
in ./autogen.sh not emitting warning with autoconf 2.69 or 2.71. That's 
a bit risky material though, so this will likely only go to master / 
3.4dev, and not in 3.3 branch

Even

Le 07/10/2021 ? 09:47, APM a ?crit?:
> Dear List,
>
>
> if I try to compile gdal, I got an error message, see below in this 
> email.
>
>
> I use Debian testing and git:
>
>
> git clone https://github.com/OSGeo/gdal.git
>
> cd gdal
>
> git checkout master
>
> cd gdal
>
> ./autogen.sh
>
>
> configure.ac:6172: warning: AC_OUTPUT should be used without arguments.
> configure.ac:6172: You should run autoupdate.
>
>
> autoupdate
>
>
> configure.ac:212: warning: AC_PROG_CC_C99 is obsolete; use AC_PROG_CC
>
> configure.ac:289: warning: The preprocessor macro `STDC_HEADERS' is 
> obsolete.
> ? Except in unusual embedded environments, you can safely include all
> ? ISO C90 headers unconditionally.
>
>
> ./configure --prefix=/home/user/apps/gdal/
>
>
> make -j4
>
> Error:
>
> /src/gdal/gdal$ ./autogen.sh
> + aclocal -I ./m4
> configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an 
> AC_DEFUN'd macro
> configure.ac:218: the top level
> autom4te: error: /usr/bin/m4 failed with exit status: 1
> aclocal: error: autom4te failed with exit status: 1
> + autoconf
> configure.ac:218: error: AC_REQUIRE(): cannot be used outside of an 
> AC_DEFUN'd macro
> configure.ac:218: the top level
> autom4te: error: /usr/bin/m4 failed with exit status: 1
>
>
> I'm not sure if I deal with gdal/git correctly.
>
>
> Maybe you have a tipp?
>
>
> Thank you!
>
>
> Kind regards
>
>
> Piet
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jluis at ualg.pt  Sun Oct 10 13:26:41 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Sun, 10 Oct 2021 20:26:41 +0000
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
Message-ID: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>

Hi,

I have a Julia version of gdal_translate (that ends up calling GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not the way I wanted.
It creates a multi-subdatasets file, whilst what I wished is to write a multi-band file.

For example, the file written with this Julia function looks like below

How can I write a multi-band instead of a multi-datasets?
I've been looking at the docs of GDALDatasetRasterIOEx but can't see any way of picking one or the other.

Joaquim

gdalinfo cube_rad.nc
Driver: netCDF/Network Common Data Format
Files: cube_rad.nc
Size is 512, 512
Metadata:
  NC_GLOBAL#Conventions=CF-1.5
  NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
  NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy( cube_rad.nc, ... )
Subdatasets:
  SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
  SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
  SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
  SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
...

Saving the same data (or similar) from a Matlab code that I wrote long ago to stack grids, shows

gdalinfo evi_cube.nc
Driver: netCDF/Network Common Data Format
Files: evi_cube.nc
Size is 37, 59
Origin = (580140.000000000000000,4418550.000000000000000)
Pixel Size = (30.000000000000000,-30.000000000000000)
Metadata:
...
  latitude#actual_range={4416795,4418535}
  latitude#long_name=latitude
  latitude#units=degrees_north
  longitude#actual_range={580155,581235}
  longitude#long_name=longitude
  longitude#units=degrees_east
  NC_GLOBAL#Conventions=COARDS
  NC_GLOBAL#description=File written from Matlab
  NC_GLOBAL#node_offset=0
  NC_GLOBAL#Source_Software=Mirone
  NC_GLOBAL#title=Grid created by Mirone
  NETCDF_DIM_EXTRA={time}
  NETCDF_DIM_time_DEF={67,6}
  NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
  z#actual_range={-856.4703369140625,176.8457641601562}
  z#long_name=z
  z#units=unknown
  z#_FillValue=-nan(ind)
Corner Coordinates:
Upper Left  (  580140.000, 4418550.000)
Lower Left  (  580140.000, 4416780.000)
Upper Right (  581250.000, 4418550.000)
Lower Right (  581250.000, 4416780.000)
Center      (  580695.000, 4417665.000)
Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=1
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=2
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211010/3cf6da4a/attachment.html>

From even.rouault at spatialys.com  Sun Oct 10 14:48:12 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 10 Oct 2021 23:48:12 +0200
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
Message-ID: <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>

Joaquim,

https://github.com/OSGeo/gdal/pull/4634 should hopefully help

Even

Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit?:
>
> Hi,
>
> I have a Julia version of gdal_translate (that ends up calling 
> GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not the 
> way I wanted.
>
> It creates a multi-subdatasets file, whilst what I wished is to write 
> a multi-band file.
>
> For example, the file written with this Julia function looks like below
>
> How can I write a multi-band instead of a multi-datasets?
>
> I?ve been looking at the docs of GDALDatasetRasterIOEx but can?t see 
> any way of picking one or the other.
>
> Joaquim
>
> gdalinfo cube_rad.nc
>
> Driver: netCDF/Network Common Data Format
>
> Files: cube_rad.nc
>
> Size is 512, 512
>
> Metadata:
>
> NC_GLOBAL#Conventions=CF-1.5
>
> ? NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
>
> ? NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy( 
> cube_rad.nc, ... )
>
> Subdatasets:
>
> SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
>
> SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
>
> SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
>
> SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
>
> ?
>
> Saving the same data (or similar) from a Matlab code that I wrote long 
> ago to stack grids, shows
>
> gdalinfo evi_cube.nc
>
> Driver: netCDF/Network Common Data Format
>
> Files: evi_cube.nc
>
> Size is 37, 59
>
> Origin = (580140.000000000000000,4418550.000000000000000)
>
> Pixel Size = (30.000000000000000,-30.000000000000000)
>
> Metadata:
>
> ?
>
> latitude#actual_range={4416795,4418535}
>
> latitude#long_name=latitude
>
> latitude#units=degrees_north
>
> longitude#actual_range={580155,581235}
>
> longitude#long_name=longitude
>
> longitude#units=degrees_east
>
> NC_GLOBAL#Conventions=COARDS
>
> NC_GLOBAL#description=File written from Matlab
>
> NC_GLOBAL#node_offset=0
>
> NC_GLOBAL#Source_Software=Mirone
>
> ? NC_GLOBAL#title=Grid created by Mirone
>
> NETCDF_DIM_EXTRA={time}
>
> NETCDF_DIM_time_DEF={67,6}
>
> NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
>
> z#actual_range={-856.4703369140625,176.8457641601562}
>
> ? z#long_name=z
>
> ? z#units=unknown
>
> ? z#_FillValue=-nan(ind)
>
> Corner Coordinates:
>
> Upper Left? ( 580140.000, 4418550.000)
>
> Lower Left? ( 580140.000, 4416780.000)
>
> Upper Right ( 581250.000, 4418550.000)
>
> Lower Right ( 581250.000, 4416780.000)
>
> Center????? ( 580695.000, 4417665.000)
>
> Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
>
> ? NoData Value=nan
>
> ? Unit Type: unknown
>
> ? Metadata:
>
> actual_range={-856.4703369140625,176.8457641601562}
>
> ??? long_name=z
>
> ??? NETCDF_DIM_time=1
>
> ??? NETCDF_VARNAME=z
>
> ??? units=unknown
>
> ??? _FillValue=-nan(ind)
>
> Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
>
> ? NoData Value=nan
>
> ? Unit Type: unknown
>
> ? Metadata:
>
> actual_range={-856.4703369140625,176.8457641601562}
>
> ??? long_name=z
>
> ??? NETCDF_DIM_time=2
>
> ??? NETCDF_VARNAME=z
>
> ??? units=unknown
>
> ??? _FillValue=-nan(ind)
>
> ?
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211010/9bd1c627/attachment-0001.html>

From jluis at ualg.pt  Sun Oct 10 15:10:23 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Sun, 10 Oct 2021 22:10:23 +0000
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
Message-ID: <AM6PR04MB39596DBAA478AD14648DABD2A6B49@AM6PR04MB3959.eurprd04.prod.outlook.com>

I see thanks, will study it.
I'll end up learning some python at the force of studying it's examples

Joaquim

From: Even Rouault <even.rouault at spatialys.com>
Sent: Sunday, October 10, 2021 10:48 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets


Joaquim,

https://github.com/OSGeo/gdal/pull/4634 should hopefully help

Even
Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

I have a Julia version of gdal_translate (that ends up calling GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not the way I wanted.
It creates a multi-subdatasets file, whilst what I wished is to write a multi-band file.

For example, the file written with this Julia function looks like below

How can I write a multi-band instead of a multi-datasets?
I've been looking at the docs of GDALDatasetRasterIOEx but can't see any way of picking one or the other.

Joaquim

gdalinfo cube_rad.nc
Driver: netCDF/Network Common Data Format
Files: cube_rad.nc
Size is 512, 512
Metadata:
  NC_GLOBAL#Conventions=CF-1.5
  NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
  NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy( cube_rad.nc, ... )
Subdatasets:
  SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
  SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
  SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
  SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
...

Saving the same data (or similar) from a Matlab code that I wrote long ago to stack grids, shows

gdalinfo evi_cube.nc
Driver: netCDF/Network Common Data Format
Files: evi_cube.nc
Size is 37, 59
Origin = (580140.000000000000000,4418550.000000000000000)
Pixel Size = (30.000000000000000,-30.000000000000000)
Metadata:
...
  latitude#actual_range={4416795,4418535}
  latitude#long_name=latitude
  latitude#units=degrees_north
  longitude#actual_range={580155,581235}
  longitude#long_name=longitude
  longitude#units=degrees_east
  NC_GLOBAL#Conventions=COARDS
  NC_GLOBAL#description=File written from Matlab
  NC_GLOBAL#node_offset=0
  NC_GLOBAL#Source_Software=Mirone
  NC_GLOBAL#title=Grid created by Mirone
  NETCDF_DIM_EXTRA={time}
  NETCDF_DIM_time_DEF={67,6}
  NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
  z#actual_range={-856.4703369140625,176.8457641601562}
  z#long_name=z
  z#units=unknown
  z#_FillValue=-nan(ind)
Corner Coordinates:
Upper Left  (  580140.000, 4418550.000)
Lower Left  (  580140.000, 4416780.000)
Upper Right (  581250.000, 4418550.000)
Lower Right (  581250.000, 4416780.000)
Center      (  580695.000, 4417665.000)
Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=1
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=2
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
...



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211010/e189b80d/attachment.html>

From nextstopsun at gmail.com  Mon Oct 11 05:02:44 2021
From: nextstopsun at gmail.com (Next Stop)
Date: Mon, 11 Oct 2021 15:02:44 +0300
Subject: [gdal-dev] FEATURE_SERVER_PAGING open option doesn't work for ESRI
 FeatureServer
Message-ID: <BF034C06-18D7-483F-BAA5-7A6E5DD40FC0@gmail.com>

Hi, list!

Setting FEATURE_SERVER_PAGING open option to YES doesn?t help to retrieve all features from ESRI FeatureServer source.

Check this out:

ogrinfo -ro -so -oo FEATURE_SERVER_PAGING=YES "http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/FeatureServer/0/query?where=objectid+%3D+objectid&outfields=*&f=json? ESRIJSON

You?ll still get only first 1000 records.

From jukka.rahkonen at maanmittauslaitos.fi  Mon Oct 11 05:30:49 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 11 Oct 2021 12:30:49 +0000
Subject: [gdal-dev] FEATURE_SERVER_PAGING open option doesn't work for
 ESRI FeatureServer
Message-ID: <b0dc8d17454a438dbfcb236275834728@maanmittauslaitos.fi>

Hi,

Do you know if that sampleserver3.arcgisonline.com supports paging? I thought that this query would return one feature but it returns more

http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/FeatureServer/0/query?where=objectid+%3D+objectid&outfields=*&f=json&resultRecordCount=1

The page http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/ suggests that the server version is 10.05 and https://gdal.org/drivers/vector/esrijson.html says that paging is supported for ArcGIS servers >= 10.3.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Next Stop
L?hetetty: maanantai 11. lokakuuta 2021 15.03
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] FEATURE_SERVER_PAGING open option doesn't work for ESRI FeatureServer

Hi, list!

Setting FEATURE_SERVER_PAGING open option to YES doesn?t help to retrieve all features from ESRI FeatureServer source.

Check this out:

ogrinfo -ro -so -oo FEATURE_SERVER_PAGING=YES "http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/FeatureServer/0/query?where=objectid+%3D+objectid&outfields=*&f=json? ESRIJSON

You?ll still get only first 1000 records.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From even.rouault at spatialys.com  Mon Oct 11 05:45:36 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 11 Oct 2021 14:45:36 +0200
Subject: [gdal-dev] FEATURE_SERVER_PAGING open option doesn't work for
 ESRI FeatureServer
In-Reply-To: <b0dc8d17454a438dbfcb236275834728@maanmittauslaitos.fi>
References: <b0dc8d17454a438dbfcb236275834728@maanmittauslaitos.fi>
Message-ID: <c9004d47-cb11-36cc-8a9e-4e0f88d82e57@spatialys.com>

This service doesn't seem to support paging indeed (funny that a sample 
server for a service isn't up-to-date...). I've just updated the doc.

Googling around for "supportsPagination true", I could find a few public 
services that do work w.r.t paging

Le 11/10/2021 ? 14:30, Rahkonen Jukka (MML) a ?crit?:
> Hi,
>
> Do you know if that sampleserver3.arcgisonline.com supports paging? I thought that this query would return one feature but it returns more
>
> http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/FeatureServer/0/query?where=objectid+%3D+objectid&outfields=*&f=json&resultRecordCount=1
>
> The page http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/ suggests that the server version is 10.05 and https://gdal.org/drivers/vector/esrijson.html says that paging is supported for ArcGIS servers >= 10.3.
>
> -Jukka Rahkonen-
>
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Next Stop
> L?hetetty: maanantai 11. lokakuuta 2021 15.03
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] FEATURE_SERVER_PAGING open option doesn't work for ESRI FeatureServer
>
> Hi, list!
>
> Setting FEATURE_SERVER_PAGING open option to YES doesn?t help to retrieve all features from ESRI FeatureServer source.
>
> Check this out:
>
> ogrinfo -ro -so -oo FEATURE_SERVER_PAGING=YES "http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/FeatureServer/0/query?where=objectid+%3D+objectid&outfields=*&f=json? ESRIJSON
>
> You?ll still get only first 1000 records.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From nextstopsun at gmail.com  Mon Oct 11 06:53:45 2021
From: nextstopsun at gmail.com (Next Stop)
Date: Mon, 11 Oct 2021 16:53:45 +0300
Subject: [gdal-dev] FEATURE_SERVER_PAGING open option doesn't work for
 ESRI FeatureServer
In-Reply-To: <c9004d47-cb11-36cc-8a9e-4e0f88d82e57@spatialys.com>
References: <b0dc8d17454a438dbfcb236275834728@maanmittauslaitos.fi>
 <c9004d47-cb11-36cc-8a9e-4e0f88d82e57@spatialys.com>
Message-ID: <D88F6ECD-AEDE-45EC-9AB6-ECFC80EE7BC3@gmail.com>

I?ve found this bug when fetching from AGS 10.6 version.
Sorry, I wasn?t aware that URL is outdated, I wrote it just as an example.

> On 11 Oct 2021, at 15:45, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> This service doesn't seem to support paging indeed (funny that a sample server for a service isn't up-to-date...). I've just updated the doc.
> 
> Googling around for "supportsPagination true", I could find a few public services that do work w.r.t paging
> 
> Le 11/10/2021 ? 14:30, Rahkonen Jukka (MML) a ?crit :
>> Hi,
>> 
>> Do you know if that sampleserver3.arcgisonline.com supports paging? I thought that this query would return one feature but it returns more
>> 
>> http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/FeatureServer/0/query?where=objectid+%3D+objectid&outfields=*&f=json&resultRecordCount=1
>> 
>> The page http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/ suggests that the server version is 10.05 and https://gdal.org/drivers/vector/esrijson.html says that paging is supported for ArcGIS servers >= 10.3.
>> 
>> -Jukka Rahkonen-
>> 
>> -----Alkuper?inen viesti-----
>> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Next Stop
>> L?hetetty: maanantai 11. lokakuuta 2021 15.03
>> Vastaanottaja: gdal-dev at lists.osgeo.org
>> Aihe: [gdal-dev] FEATURE_SERVER_PAGING open option doesn't work for ESRI FeatureServer
>> 
>> Hi, list!
>> 
>> Setting FEATURE_SERVER_PAGING open option to YES doesn?t help to retrieve all features from ESRI FeatureServer source.
>> 
>> Check this out:
>> 
>> ogrinfo -ro -so -oo FEATURE_SERVER_PAGING=YES "http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/FeatureServer/0/query?where=objectid+%3D+objectid&outfields=*&f=json? ESRIJSON
>> 
>> You?ll still get only first 1000 records.
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
> 


From howard at hobu.co  Mon Oct 11 07:14:08 2021
From: howard at hobu.co (Howard Butler)
Date: Mon, 11 Oct 2021 09:14:08 -0500
Subject: [gdal-dev] Motion: RFC 84: Migrating build systems to CMake
Message-ID: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>

All,

Discussion on this topic has died down, and it appears there are no major objections, so I would like to put forward a motion to approve RFC 84. With a conservative timeline, the final outcome of this effort is GDAL will be CMake-only in May 2023.

You can view the proposal at https://github.com/OSGeo/gdal/blob/1d3c283d40f4d2145c11dfca4b537fb357f53600/gdal/doc/source/development/rfc/rfc84_cmake.rst

+1 Howard



From Daniel.Jacobs at is4s.com  Mon Oct 11 07:23:40 2021
From: Daniel.Jacobs at is4s.com (Daniel Jacobs)
Date: Mon, 11 Oct 2021 14:23:40 +0000
Subject: [gdal-dev] Use gdalwarp to convert DTM from EGM96 geoid to WGS84
 ellipsoid height
Message-ID: <BN1P110MB0708E153FAFB926D1EF68B76DBB59@BN1P110MB0708.NAMP110.PROD.OUTLOOK.COM>

I want to convert my DTM geotiff file from height above geoid to height above ellipsoid.

I've tried the following command (among numerous similar commands):

    gdalwarp -overwrite in_dem.tif out_dem.tif -s_srs EPSG:4326+5773 -t_srs EPSG:4979


I have files egm96_15.gtx? and us_nga_egma96_15.tif? in my /usr/share/proj? resource directory, and PROJ_LIB? is set to /usr/share/proj?.

This transform works:

    $gdaltransform -s_srs EPSG:4326+5773 -t_srs EPSG:4979
    Enter X Y [Z [T]] values separated by space, and press Return.
    10 20 0
    10 20 26.504430770874

But the output file of gdalwarp? is never different from the input file, no matter what I try. Is it because the file is a DTM instead of a DEM?


Thanks!

_____________________________________
The information contained in this e-mail and any attachments from Integrated Solutions for Systems may contain confidential and/or proprietary information, and is intended only for the named recipient to whom it was originally addressed. If you are not the intended recipient, any disclosure, distribution, or copying of this e-mail or its attachments is strictly prohibited. If you have received this e-mail in error, please notify the sender immediately by return e-mail and permanently delete the e-mail and any attachments.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211011/82a89f7a/attachment.html>

From even.rouault at spatialys.com  Mon Oct 11 07:48:10 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 11 Oct 2021 16:48:10 +0200
Subject: [gdal-dev] Use gdalwarp to convert DTM from EGM96 geoid to
 WGS84 ellipsoid height
In-Reply-To: <BN1P110MB0708E153FAFB926D1EF68B76DBB59@BN1P110MB0708.NAMP110.PROD.OUTLOOK.COM>
References: <BN1P110MB0708E153FAFB926D1EF68B76DBB59@BN1P110MB0708.NAMP110.PROD.OUTLOOK.COM>
Message-ID: <cc8bfafd-a3a7-4f07-9507-afe54d0cc746@spatialys.com>

Known issue. See 
https://github.com/OSGeo/gdal/issues/4566#issuecomment-930393920


Le 11/10/2021 ? 16:23, Daniel Jacobs a ?crit?:
> I want to convert my DTM geotiff file from height above geoid to height above ellipsoid.
> I've tried the following command (among numerous similar commands):
>      gdalwarp -overwrite in_dem.tif out_dem.tif -s_srs EPSG:4326+5773 -t_srs EPSG:4979
> I have files|egm96_15.gtx|? and|us_nga_egma96_15.tif|? in my|/usr/share/proj|? resource directory, and|PROJ_LIB|? is set to|/usr/share/proj|?.
> This transform works:
>      $gdaltransform -s_srs EPSG:4326+5773 -t_srs EPSG:4979
> Enter X Y [Z [T]] values separated by space, and press Return.
> 10 20 0
>      10 20 26.504430770874
> But the output file of|gdalwarp|? is never different from the input file, no matter what I try. Is it because the file is a DTM instead of a DEM?
> Thanks!
> _____________________________________
> The information contained in this e-mail and any attachments from 
> Integrated Solutions for Systems may contain confidential and/or 
> proprietary information, and is intended only for the named recipient 
> to whom it was originally addressed. If you are not the intended 
> recipient, any disclosure, distribution, or copying of this e-mail or 
> its attachments is strictly prohibited. If you have received this 
> e-mail in error, please notify the sender immediately by return e-mail 
> and permanently delete the e-mail and any attachments.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211011/63fb4ddc/attachment-0001.html>

From mateusz at loskot.net  Mon Oct 11 07:59:56 2021
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 11 Oct 2021 16:59:56 +0200
Subject: [gdal-dev] Motion: RFC 84: Migrating build systems to CMake
In-Reply-To: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
References: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
Message-ID: <CABUeae8_S86UCdqD7mpe4tsWpeCYcsgv9mQvAbKwdJmK0OCRvA@mail.gmail.com>

+1   Mateusz

Great stuff! It's been a dream for long to pull the CMake for GDAL off.

On Mon, 11 Oct 2021 at 16:14, Howard Butler <howard at hobu.co> wrote:
>
> All,
>
> Discussion on this topic has died down, and it appears there are no major objections, so I would like to put forward a motion to approve RFC 84. With a conservative timeline, the final outcome of this effort is GDAL will be CMake-only in May 2023.
>
> You can view the proposal at https://github.com/OSGeo/gdal/blob/1d3c283d40f4d2145c11dfca4b537fb357f53600/gdal/doc/source/development/rfc/rfc84_cmake.rst
>
> +1 Howard
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Mateusz Loskot, http://mateusz.loskot.net

From jukka.rahkonen at maanmittauslaitos.fi  Mon Oct 11 08:02:20 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 11 Oct 2021 15:02:20 +0000
Subject: [gdal-dev] Motion: RFC 84: Migrating build systems to CMake
Message-ID: <0e7efdaa33e34bf49cdf2f39e6352d76@maanmittauslaitos.fi>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Howard Butler
L?hetetty: maanantai 11. lokakuuta 2021 17.14
Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Motion: RFC 84: Migrating build systems to CMake

All,

Discussion on this topic has died down, and it appears there are no major objections, so I would like to put forward a motion to approve RFC 84. With a conservative timeline, the final outcome of this effort is GDAL will be CMake-only in May 2023.

You can view the proposal at https://github.com/OSGeo/gdal/blob/1d3c283d40f4d2145c11dfca4b537fb357f53600/gdal/doc/source/development/rfc/rfc84_cmake.rst

+1 Howard


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From jmckenna at gatewaygeomatics.com  Mon Oct 11 08:37:13 2021
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Mon, 11 Oct 2021 12:37:13 -0300
Subject: [gdal-dev] Motion: RFC 84: Migrating build systems to CMake
In-Reply-To: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
References: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
Message-ID: <73323ca3-c9cb-fc25-3777-606ec2101d4e@gatewaygeomatics.com>

+1  Will test on Windows systems.

-jeff



On 2021-10-11 11:14 a.m., Howard Butler wrote:
> All,
> 
> Discussion on this topic has died down, and it appears there are no major objections, so I would like to put forward a motion to approve RFC 84. With a conservative timeline, the final outcome of this effort is GDAL will be CMake-only in May 2023.
> 
> You can view the proposal at https://github.com/OSGeo/gdal/blob/1d3c283d40f4d2145c11dfca4b537fb357f53600/gdal/doc/source/development/rfc/rfc84_cmake.rst
> 
> +1 Howard
> 
> 


-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/

From schwehr at gmail.com  Mon Oct 11 10:59:07 2021
From: schwehr at gmail.com (Kurt Schwehr)
Date: Mon, 11 Oct 2021 10:59:07 -0700
Subject: [gdal-dev] Motion: RFC 84: Migrating build systems to CMake
In-Reply-To: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
References: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
Message-ID: <CACmBxys__wcbc02_etZ71gbJx4Sf-7-XzohTh5uVc4X1O4SP3Q@mail.gmail.com>

+1 KurtS

On Mon, Oct 11, 2021 at 7:15 AM Howard Butler <howard at hobu.co> wrote:

> All,
>
> Discussion on this topic has died down, and it appears there are no major
> objections, so I would like to put forward a motion to approve RFC 84. With
> a conservative timeline, the final outcome of this effort is GDAL will be
> CMake-only in May 2023.
>
> You can view the proposal at
> https://github.com/OSGeo/gdal/blob/1d3c283d40f4d2145c11dfca4b537fb357f53600/gdal/doc/source/development/rfc/rfc84_cmake.rst
>
> +1 Howard
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211011/3cbb89ac/attachment.html>

From even.rouault at spatialys.com  Mon Oct 11 14:36:05 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 11 Oct 2021 23:36:05 +0200
Subject: [gdal-dev] Custom vertical transformations
In-Reply-To: <c28e3039230e45fc93dba12cfa57c01e@sdfe.dk>
References: <d75bf232b8f347c49b858cd484786632@sdfe.dk>
 <3e9c7739-ddcb-eedf-f58f-b295a92f9737@spatialys.com>
 <89cc4e3e-73c1-5e0f-cfed-aa5d4c459dca@spatialys.com>
 <c28e3039230e45fc93dba12cfa57c01e@sdfe.dk>
Message-ID: <635d0f8c-98aa-41a7-10f9-8a608f487ed0@spatialys.com>

Kristian,

https://github.com/OSGeo/gdal/pull/4639 will allow you to use an 
arbitrary pipeline to do a vertical transformation through gdalwarp

Even

Le 23/08/2021 ? 10:50, Kristian Evers a ?crit?:
> Thanks for your insights, Even! I had a feeling I was pushing the boundaries here, good to get that confirmed.
>
> The idea of using -s_srs and a correction grid is intriguing. I assume this way will be easier to implement as well since I don't have to worry as much about the CRS and extent of my correction grid as when using gdal_calc. The correction grids I already have are in EPSG:4326 and I assume GDAL is clever enough to handle that or at least pass the responsibility over to PROJ. I'll try a few things and report back how it goes.
>
> I'll make sure to add a ticket for extending the scope of gdalwarp to the 3D-space.
>
> /Kristian
>
>> -----Original Message-----
>> From: Even Rouault <even.rouault at spatialys.com>
>> Sent: 20. august 2021 17:30
>> To: Kristian Evers <kreve at sdfe.dk>; gdal-dev at lists.osgeo.org
>> Subject: Re: [gdal-dev] Custom vertical transformations
>>
>>
>>> Regarding your immediate issue, the workaround I see would be that you
>>> use PROJ to create a regular grid that contains the vertical
>>> correction, use gdalwarp to transform it to the exact extent and
>>> resolution of the result of your 2D-only gdalwarp, and finally use
>>> gdal_calc to sum the two.
>>>
>> Well, if you actually create a vertical correction only grid, then you
>> could just use? -s_srs "+proj=longlat +ellps=...
>> +geoidgrids=your_tif_or_gtx"? (or maybe as output, or fix the sign of
>> the correction in the grid), since the workaround I give above is what
>> gdalwarp would do. But of course none of this will solve the
>> time-dependent aspect you need.
>>
>> --
>>
>> http://www.spatialys.com
>> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From nyall.dawson at gmail.com  Mon Oct 11 15:12:49 2021
From: nyall.dawson at gmail.com (Nyall Dawson)
Date: Tue, 12 Oct 2021 08:12:49 +1000
Subject: [gdal-dev] Simple features/sql-mm and bezier/elliptical curves
Message-ID: <CAB28Asg-ROP2uMmYHtZuqJ6H76Ju6tTKMTXkSWwRoDNuM3h+2Q@mail.gmail.com>

Hi list,

Slightly off-topic question (but I figure the people who would know
would be subscribed to this list):

Is anyone aware if there's been **any** talk/movement toward formally
introducing bezier and/or elliptical curve support into the SF/SQL/MM
specifications? Has anyone come across any informal approaches for
describing elliptical curves/bezier in WKT?

Thanks in advance,
Nyall

From kreve at sdfe.dk  Mon Oct 11 23:57:59 2021
From: kreve at sdfe.dk (Kristian Evers)
Date: Tue, 12 Oct 2021 06:57:59 +0000
Subject: [gdal-dev] Custom vertical transformations
In-Reply-To: <635d0f8c-98aa-41a7-10f9-8a608f487ed0@spatialys.com>
References: <d75bf232b8f347c49b858cd484786632@sdfe.dk>
 <3e9c7739-ddcb-eedf-f58f-b295a92f9737@spatialys.com>
 <89cc4e3e-73c1-5e0f-cfed-aa5d4c459dca@spatialys.com>
 <c28e3039230e45fc93dba12cfa57c01e@sdfe.dk>
 <635d0f8c-98aa-41a7-10f9-8a608f487ed0@spatialys.com>
Message-ID: <52870ae6dde14a6396d43f41843d2b48@sdfe.dk>

Very cool, Even! In the end I managed to come up with a solution that uses +geoidgrids
but this will certainly make things easier in the future. Thanks for taking the time to
implement this!

/Kristian

> -----Original Message-----
> From: Even Rouault <even.rouault at spatialys.com>
> Sent: 11. oktober 2021 23:36
> To: Kristian Evers <kreve at sdfe.dk>; gdal-dev at lists.osgeo.org
> Subject: Re: [gdal-dev] Custom vertical transformations
> 
> Kristian,
> 
> https://github.com/OSGeo/gdal/pull/4639 will allow you to use an
> arbitrary pipeline to do a vertical transformation through gdalwarp
> 
> Even
> 
> Le 23/08/2021 ? 10:50, Kristian Evers a ?crit?:
> > Thanks for your insights, Even! I had a feeling I was pushing the boundaries
> here, good to get that confirmed.
> >
> > The idea of using -s_srs and a correction grid is intriguing. I assume this way
> will be easier to implement as well since I don't have to worry as much about the
> CRS and extent of my correction grid as when using gdal_calc. The correction
> grids I already have are in EPSG:4326 and I assume GDAL is clever enough to
> handle that or at least pass the responsibility over to PROJ. I'll try a few things
> and report back how it goes.
> >
> > I'll make sure to add a ticket for extending the scope of gdalwarp to the 3D-
> space.
> >
> > /Kristian
> >
> >> -----Original Message-----
> >> From: Even Rouault <even.rouault at spatialys.com>
> >> Sent: 20. august 2021 17:30
> >> To: Kristian Evers <kreve at sdfe.dk>; gdal-dev at lists.osgeo.org
> >> Subject: Re: [gdal-dev] Custom vertical transformations
> >>
> >>
> >>> Regarding your immediate issue, the workaround I see would be that you
> >>> use PROJ to create a regular grid that contains the vertical
> >>> correction, use gdalwarp to transform it to the exact extent and
> >>> resolution of the result of your 2D-only gdalwarp, and finally use
> >>> gdal_calc to sum the two.
> >>>
> >> Well, if you actually create a vertical correction only grid, then you
> >> could just use? -s_srs "+proj=longlat +ellps=...
> >> +geoidgrids=your_tif_or_gtx"? (or maybe as output, or fix the sign of
> >> the correction in the grid), since the workaround I give above is what
> >> gdalwarp would do. But of course none of this will solve the
> >> time-dependent aspect you need.
> >>
> >> --
> >>
> >> http://www.spatialys.com
> >> My software is free, but my time generally not.
> 
> --
> http://www.spatialys.com
> My software is free, but my time generally not.


From ari.jolma at gmail.com  Tue Oct 12 02:40:10 2021
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 12 Oct 2021 12:40:10 +0300
Subject: [gdal-dev] OpenFileGDB: Error occurred in filegdbtable.cpp at line
 696
Message-ID: <448d7f70-9bce-6da4-fd07-94e306c7bec4@gmail.com>

This works:

ari at xps:~/lahde$ ogrinfo -ro /vsis3/lahde-test-test/kuviot01102021.gdb
INFO: Open of `/vsis3/lahde-test-test/kuviot01102021.gdb'
 ????? using driver `OpenFileGDB' successful.
1: kuviot (Multi Polygon)
2: invpsto_osite (None)
ari at xps:~/lahde$ ogrinfo --version
GDAL 3.3.2, released 2021/09/01

but with an older version (apt install gdal-bin in an ec2 machine)

ubuntu at ip-10-23-5-253:~$ ogrinfo -ro 
/vsis3/lahde-test-test/kuviot01102021.gdb
ERROR 1: Error occurred in filegdbtable.cpp at line 696
FAILURE:
Unable to open datasource `/vsis3/lahde-test-test/kuviot01102021.gdb' 
with the following drivers.


filegdbtable.cpp:696 is

 ?? returnErrorIf(VSIFReadL( abyHeader, 40, 1, fpTable ) != 1 );

What might be the issue?

Ari



From even.rouault at spatialys.com  Tue Oct 12 02:52:00 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 12 Oct 2021 11:52:00 +0200
Subject: [gdal-dev] Simple features/sql-mm and bezier/elliptical curves
In-Reply-To: <CAB28Asg-ROP2uMmYHtZuqJ6H76Ju6tTKMTXkSWwRoDNuM3h+2Q@mail.gmail.com>
References: <CAB28Asg-ROP2uMmYHtZuqJ6H76Ju6tTKMTXkSWwRoDNuM3h+2Q@mail.gmail.com>
Message-ID: <a82cd7fc-539f-66eb-ac0f-9b43325c1460@spatialys.com>

Hi Nyall,

 From what I'm aware of that is closely related:

- The OGC Simple Features spec has a ongoing revision in 
https://www.ogc.org/standards/requests/238?utm_source=phplist820&utm_medium=email&utm_content=HTML&utm_campaign=OGC+seeks+public+comment+on+draft+Simple+Features+2021+standard 
, but it doesn't introduce new geometry types

- The OGC Features and Geometries JSON SWG has in its scope to support 
more geometry types 
(https://www.ogc.org/projects/groups/featgeojsonswg), with this mention 
"In the future OGC Features and Geometries JSON may be extended include 
more complex geometries such as curves with non-linear interpolation"

Maybe you could raise that on 
https://lists.osgeo.org/pipermail/standards/ too

Even

Le 12/10/2021 ? 00:12, Nyall Dawson a ?crit?:
> Hi list,
>
> Slightly off-topic question (but I figure the people who would know
> would be subscribed to this list):
>
> Is anyone aware if there's been **any** talk/movement toward formally
> introducing bezier and/or elliptical curve support into the SF/SQL/MM
> specifications? Has anyone come across any informal approaches for
> describing elliptical curves/bezier in WKT?
>
> Thanks in advance,
> Nyall
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jluis at ualg.pt  Tue Oct 12 03:00:15 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Tue, 12 Oct 2021 10:00:15 +0000
Subject: [gdal-dev] HTTP response code: 303 from lpdaac.earthdata.nasa.gov
Message-ID: <AM6PR04MB3959B695F9ED259115252D4AA6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>

Hi,

This seems to be related to some service change as it was working till yesterday and then started giving a 303 error.
Note that downloading the file with a browse, works.

gdalinfo /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt
ERROR 11: HTTP response code: 303
gdalinfo failed - unable to open '/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211012/87fefb82/attachment-0001.html>

From me at komzpa.net  Tue Oct 12 03:00:53 2021
From: me at komzpa.net (=?UTF-8?Q?Darafei_=22Kom=D1=8Fpa=22_Praliaskouski?=)
Date: Tue, 12 Oct 2021 13:00:53 +0300
Subject: [gdal-dev] Simple features/sql-mm and bezier/elliptical curves
In-Reply-To: <CAB28Asg-ROP2uMmYHtZuqJ6H76Ju6tTKMTXkSWwRoDNuM3h+2Q@mail.gmail.com>
References: <CAB28Asg-ROP2uMmYHtZuqJ6H76Ju6tTKMTXkSWwRoDNuM3h+2Q@mail.gmail.com>
Message-ID: <CAC8Q8tJ6D+EcV5NtxNMmBRFtyac5vXiAUomNb0BUnR4qLDeQkQ@mail.gmail.com>

Hello,

ISO SQL/MM has chapters for NURBS and other magical geometry types. The
text is unfortunately not free - I'd love us to have a copy for the PostGIS
team at least. Last time I was touching that topic was around 2019 when I
wanted to make TINs somewhat more compatible.

OGC has a very limited subset, and sometimes may contradict ISO.


??, 12 ??? 2021, 01:13 ???????????? Nyall Dawson <nyall.dawson at gmail.com>
???????:

> Hi list,
>
> Slightly off-topic question (but I figure the people who would know
> would be subscribed to this list):
>
> Is anyone aware if there's been **any** talk/movement toward formally
> introducing bezier and/or elliptical curve support into the SF/SQL/MM
> specifications? Has anyone come across any informal approaches for
> describing elliptical curves/bezier in WKT?
>
> Thanks in advance,
> Nyall
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211012/0860c3eb/attachment.html>

From ari.jolma at gmail.com  Tue Oct 12 03:01:26 2021
From: ari.jolma at gmail.com (Ari Jolma)
Date: Tue, 12 Oct 2021 13:01:26 +0300
Subject: [gdal-dev] OpenFileGDB: Error occurred in filegdbtable.cpp at
 line 696
In-Reply-To: <448d7f70-9bce-6da4-fd07-94e306c7bec4@gmail.com>
References: <448d7f70-9bce-6da4-fd07-94e306c7bec4@gmail.com>
Message-ID: <ef879b54-e346-e971-326a-c7fb2ba463d5@gmail.com>

The problem was insufficient policy for the IAM of the EC2, it had no 
rights for the objects in the bucket.

Ari Jolma kirjoitti 12.10.2021 klo 12.40:
> This works:
>
> ari at xps:~/lahde$ ogrinfo -ro /vsis3/lahde-test-test/kuviot01102021.gdb
> INFO: Open of `/vsis3/lahde-test-test/kuviot01102021.gdb'
> ????? using driver `OpenFileGDB' successful.
> 1: kuviot (Multi Polygon)
> 2: invpsto_osite (None)
> ari at xps:~/lahde$ ogrinfo --version
> GDAL 3.3.2, released 2021/09/01
>
> but with an older version (apt install gdal-bin in an ec2 machine)
>
> ubuntu at ip-10-23-5-253:~$ ogrinfo -ro 
> /vsis3/lahde-test-test/kuviot01102021.gdb
> ERROR 1: Error occurred in filegdbtable.cpp at line 696
> FAILURE:
> Unable to open datasource `/vsis3/lahde-test-test/kuviot01102021.gdb' 
> with the following drivers.
>
>
> filegdbtable.cpp:696 is
>
> ?? returnErrorIf(VSIFReadL( abyHeader, 40, 1, fpTable ) != 1 );
>
> What might be the issue?
>
> Ari
>
>

From even.rouault at spatialys.com  Tue Oct 12 03:05:19 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 12 Oct 2021 12:05:19 +0200
Subject: [gdal-dev] HTTP response code: 303 from
 lpdaac.earthdata.nasa.gov
In-Reply-To: <AM6PR04MB3959B695F9ED259115252D4AA6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959B695F9ED259115252D4AA6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <1152ed79-d8ac-9c07-e7ad-962594415b6d@spatialys.com>

Joaquim,

FWIW, works for me with HEAD of master or 3.3 branch.

Even

Le 12/10/2021 ? 12:00, Joaquim Manuel Freire Lu?s a ?crit?:
>
> Hi,
>
> This seems to be related to some service change as it was working till 
> yesterday and then started giving a 303 error.
>
> Note that downloading the file with a browse, works.
>
> gdalinfo 
> /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif 
> --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config 
> CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE 
> c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt
>
> ERROR 11: HTTP response code: 303
>
> gdalinfo failed - unable to open 
> '/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.
>
> Joaquim
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211012/d0c0f8c9/attachment.html>

From jluis at ualg.pt  Tue Oct 12 03:31:08 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Tue, 12 Oct 2021 10:31:08 +0000
Subject: [gdal-dev] HTTP response code: 303 from
 lpdaac.earthdata.nasa.gov
In-Reply-To: <1152ed79-d8ac-9c07-e7ad-962594415b6d@spatialys.com>
References: <AM6PR04MB3959B695F9ED259115252D4AA6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <1152ed79-d8ac-9c07-e7ad-962594415b6d@spatialys.com>
Message-ID: <AM6PR04MB3959F9D7AE654C8955654631A6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>

Hmm, that was in linux with a "GDAL 3.0.4, released 2020/01/28" but I get the same error on Windows with my build (< one month) of master.
The strange thing is that I was working in a script that downloads many of those files and between two iterations of bug fixes I started receiving that error.

From: Even Rouault <even.rouault at spatialys.com>
Sent: Tuesday, October 12, 2021 11:05 AM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] HTTP response code: 303 from lpdaac.earthdata.nasa.gov


Joaquim,

FWIW, works for me with HEAD of master or 3.3 branch.

Even
Le 12/10/2021 ? 12:00, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

This seems to be related to some service change as it was working till yesterday and then started giving a 303 error.
Note that downloading the file with a browse, works.

gdalinfo /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt
ERROR 11: HTTP response code: 303
gdalinfo failed - unable to open '/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.

Joaquim



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211012/5c4afd22/attachment-0001.html>

From matteo.ghetta at gmail.com  Tue Oct 12 03:34:00 2021
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 12 Oct 2021 12:34:00 +0200
Subject: [gdal-dev] ogr2ogr changes field length
In-Reply-To: <229643d6bb574eab96ba79a0dbdca2b9@maanmittauslaitos.fi>
References: <229643d6bb574eab96ba79a0dbdca2b9@maanmittauslaitos.fi>
Message-ID: <f7135e89-752f-e2e4-5e23-ac17ae7e23ff@gmail.com>

Hi Jukka,

> GDAL has the internal default of 80 characters. GDAL users do not really need other options because fields are automatically expanded when longer strings are appended afterwards but if the shapefile is used in some other software it does happen that it is impossible to insert long strings because there is no room for that in the table. I suppose that you also know that by using the field width of 254 you are also maximizing the size of the .dbf file because it reserves the same fixed amount of disk space for each cell.

got it! Yes, I'm aware of the disk space :)

Cheers and thanks

Matteo

From pramsey at cleverelephant.ca  Tue Oct 12 09:08:36 2021
From: pramsey at cleverelephant.ca (Paul Ramsey)
Date: Tue, 12 Oct 2021 09:08:36 -0700
Subject: [gdal-dev] Simple features/sql-mm and bezier/elliptical curves
In-Reply-To: <CAC8Q8tJ6D+EcV5NtxNMmBRFtyac5vXiAUomNb0BUnR4qLDeQkQ@mail.gmail.com>
References: <CAB28Asg-ROP2uMmYHtZuqJ6H76Ju6tTKMTXkSWwRoDNuM3h+2Q@mail.gmail.com>
 <CAC8Q8tJ6D+EcV5NtxNMmBRFtyac5vXiAUomNb0BUnR4qLDeQkQ@mail.gmail.com>
Message-ID: <8975931A-326A-4AF3-8660-224BEEB60E99@cleverelephant.ca>

This would be something we could put our (PostGIS) OSGeo budget to, perhaps, in lieu of any other activities going on this year. 

P

> On Oct 12, 2021, at 3:00 AM, Darafei Kom?pa Praliaskouski <me at komzpa.net> wrote:
> 
> Hello,
> 
> ISO SQL/MM has chapters for NURBS and other magical geometry types. The text is unfortunately not free - I'd love us to have a copy for the PostGIS team at least. Last time I was touching that topic was around 2019 when I wanted to make TINs somewhat more compatible.
>  
> OGC has a very limited subset, and sometimes may contradict ISO.
> 
> 
> ??, 12 ??? 2021, 01:13 ???????????? Nyall Dawson <nyall.dawson at gmail.com> ???????:
> Hi list,
> 
> Slightly off-topic question (but I figure the people who would know
> would be subscribed to this list):
> 
> Is anyone aware if there's been **any** talk/movement toward formally
> introducing bezier and/or elliptical curve support into the SF/SQL/MM
> specifications? Has anyone come across any informal approaches for
> describing elliptical curves/bezier in WKT?
> 
> Thanks in advance,
> Nyall
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From jluis at ualg.pt  Tue Oct 12 10:24:47 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Tue, 12 Oct 2021 17:24:47 +0000
Subject: [gdal-dev] Failure to compile master
Message-ID: <AM6PR04MB3959EC494FD2FDD08D5045A9A6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>

Hi,

I'm getting this error while building master (on Windows but shouldn't matter)

C:\programs\compa_libs\gdal_GIT\gdal\ogr\ogrspatialreference.cpp(7835): error C3861: 'proj_create_conversion_pole_rotation_netcdf_cf_convention': identifier not found

Found also this PROJ PR

https://github.com/OSGeo/PROJ/pull/2835

Does it mean we need to rebuild PROJ lib in order to build GDAL?

Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211012/7debc3a6/attachment.html>

From even.rouault at spatialys.com  Tue Oct 12 10:29:14 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 12 Oct 2021 19:29:14 +0200
Subject: [gdal-dev] Failure to compile master
In-Reply-To: <AM6PR04MB3959EC494FD2FDD08D5045A9A6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959EC494FD2FDD08D5045A9A6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <f2ba0099-15bc-4eed-545f-c83f706cf147@spatialys.com>


> Does it mean we need to rebuild PROJ lib in order to build GDAL?
>
Yes, this is a symbol new in PROJ 8.2dev, so when you use PROJ master, 
you may need to rebuild GDAL if it depends on newer symbols.
>
> Joaquim
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211012/14076d2c/attachment.html>

From jluis at ualg.pt  Tue Oct 12 11:58:20 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Tue, 12 Oct 2021 18:58:20 +0000
Subject: [gdal-dev] HTTP response code: 303 from
 lpdaac.earthdata.nasa.gov
In-Reply-To: <AM6PR04MB3959F9D7AE654C8955654631A6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959B695F9ED259115252D4AA6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <1152ed79-d8ac-9c07-e7ad-962594415b6d@spatialys.com>
 <AM6PR04MB3959F9D7AE654C8955654631A6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <AM6PR04MB395937FFEEBEDA3D726BD8D1A6B69@AM6PR04MB3959.eurprd04.prod.outlook.com>

Rebuilt GDAL and now works again (but not the 3.0.4 version in the University Campus).

Probably a system reboot would have been much simpler. ?

Joaquim

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Joaquim Manuel Freire Lu?s
Sent: Tuesday, October 12, 2021 11:31 AM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] HTTP response code: 303 from lpdaac.earthdata.nasa.gov

Hmm, that was in linux with a ?GDAL 3.0.4, released 2020/01/28? but I get the same error on Windows with my build (< one month) of master.
The strange thing is that I was working in a script that downloads many of those files and between two iterations of bug fixes I started receiving that error.

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Tuesday, October 12, 2021 11:05 AM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt<mailto:jluis at ualg.pt>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] HTTP response code: 303 from lpdaac.earthdata.nasa.gov


Joaquim,

FWIW, works for me with HEAD of master or 3.3 branch.

Even
Le 12/10/2021 ? 12:00, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

This seems to be related to some service change as it was working till yesterday and then started giving a 303 error.
Note that downloading the file with a browse, works.

gdalinfo /vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif --config GDAL_DISABLE_READDIR_ON_OPEN EMPTY_DIR --config CPL_VSIL_CURL_USE_HEAD FALSE --config GDAL_HTTP_COOKIEFILE c:/TEMP/cookies.txt --config GDAL_HTTP_COOKIEJAR c:/TEMP/cookies.txt
ERROR 11: HTTP response code: 303
gdalinfo failed - unable to open '/vsicurl/https://lpdaac.earthdata.nasa.gov/lp-prod-protected/HLSS30.015/HLS.S30.T10TEK.2020273T190109.v1.5.B8A.tif'.

Joaquim


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211012/aeac5e63/attachment-0001.html>

From dmorissette at mapgears.com  Tue Oct 12 17:39:25 2021
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Tue, 12 Oct 2021 20:39:25 -0400
Subject: [gdal-dev] Motion: RFC 84: Migrating build systems to CMake
In-Reply-To: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
References: <2A0DE31A-30D8-489A-B09E-687AE8243594@hobu.co>
Message-ID: <995a8852-a53f-1de7-1791-99a04dbc4ee1@mapgears.com>

+1

Daniel


On 2021-10-11 10:14, Howard Butler wrote:
> All,
> 
> Discussion on this topic has died down, and it appears there are no major objections, so I would like to put forward a motion to approve RFC 84. With a conservative timeline, the final outcome of this effort is GDAL will be CMake-only in May 2023.
> 
> You can view the proposal at https://github.com/OSGeo/gdal/blob/1d3c283d40f4d2145c11dfca4b537fb357f53600/gdal/doc/source/development/rfc/rfc84_cmake.rst
> 
> +1 Howard
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From pedrongvenancio at gmail.com  Wed Oct 13 03:14:00 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 13 Oct 2021 11:14:00 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
Message-ID: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>

Hi all,

I'm trying to create an Anaconda environment to run arosics, a software
that performs automatic subpixel co-registration of two satellite image
datasets.

The environment seems correctly created, with GDAL working as expected on
the CLI:

(arosics) PS C:\Users\PedroVenancio> gdalinfo --versionGDAL 3.3.2,
released 2021/09/01


The problem is that when Python (versions >=3.8) calls GDAL, it gives an
error:

(arosics) PS C:\Users\PedroVenancio> pythonPython 3.8.12 | packaged by
conda-forge | (default, Oct 12 2021, 21:22:46) [MSC v.1916 64 bit
(AMD64)] on win32Type "help", "copyright", "credits" or "license" for
more information.>>> from osgeo import gdalTraceback (most recent call
last):  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 21, in swig_import_helper    return
importlib.import_module(mname)  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
line 127, in import_module    return
_bootstrap._gcd_import(name[level:], package, level)  File "<frozen
importlib._bootstrap>", line 1014, in _gcd_import  File "<frozen
importlib._bootstrap>", line 991, in _find_and_load  File "<frozen
importlib._bootstrap>", line 975, in _find_and_load_unlocked  File
"<frozen importlib._bootstrap>", line 657, in _load_unlocked  File
"<frozen importlib._bootstrap>", line 556, in module_from_spec  File
"<frozen importlib._bootstrap_external>", line 1166, in create_module
File "<frozen importlib._bootstrap>", line 219, in
_call_with_frames_removedImportError: DLL load failed while importing
_gdal: Imposs?vel localizar o procedimento especificado.During
handling of the above exception, another exception occurred:Traceback
(most recent call last):  File "<stdin>", line 1, in <module>  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 37, in <module>    _gdal = swig_import_helper()  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 33, in swig_import_helper    raise ImportError(traceback_string +
'\n' + msg)ImportError: Traceback (most recent call last):  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 21, in swig_import_helper    return
importlib.import_module(mname)  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
line 127, in import_module    return
_bootstrap._gcd_import(name[level:], package, level)  File "<frozen
importlib._bootstrap>", line 1014, in _gcd_import  File "<frozen
importlib._bootstrap>", line 991, in _find_and_load  File "<frozen
importlib._bootstrap>", line 975, in _find_and_load_unlocked  File
"<frozen importlib._bootstrap>", line 657, in _load_unlocked  File
"<frozen importlib._bootstrap>", line 556, in module_from_spec  File
"<frozen importlib._bootstrap_external>", line 1166, in create_module
File "<frozen importlib._bootstrap>", line 219, in
_call_with_frames_removedImportError: DLL load failed while importing
_gdal: Imposs?vel localizar o procedimento especificado.On Windows,
with Python >= 3.8, DLLs are no longer imported from the PATH.If
gdalXXX.dll is in the PATH, then set the USE_PATH_FOR_GDAL_PYTHON=YES
environment variableto feed the PATH into os.add_dll_directory().

I've reported this error in the arosics issue tracker (
https://git.gfz-potsdam.de/danschef/arosics/-/issues/66), but it seems to
be working as expected in some similar systems (windows 10).

So I believe it can be some kind of conflict with other installations on my
machine. I've for instance OSGeo4W and everything works fine:

C:\OSGeo4W>gdalinfo --versionGDAL 3.3.1, released
2021/06/28C:\OSGeo4W>pythonPython 3.9.5 (tags/v3.9.5:0a7dcbd, May  3
2021, 17:27:52) [MSC v.1928 64 bit (AMD64)] on win32Type "help",
"copyright", "credits" or "license" for more information.>>> from
osgeo import gdal>>> gdal<module 'osgeo.gdal' from
'C:\\OSGeo4W\\apps\\Python39\\lib\\site-packages\\osgeo\\gdal.py'>


Has anyone seen this kind of error? Any hints to overcome?

Thank you very much!

Best regards,
Pedro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/8ad16d18/attachment.html>

From even.rouault at spatialys.com  Wed Oct 13 03:43:47 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Oct 2021 12:43:47 +0200
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
Message-ID: <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>

Pedro,

Did you try to "set USE_PATH_FOR_GDAL_PYTHON=YES" environment variable a 
suggested ?

Can you check if it set in OSGeo4W shell ?? ("echo 
%USE_PATH_FOR_GDAL_PYTHON%")

Wondering if we shouldn't enable that behavior automatically... although 
that we would go against upstream Python policy

Even

Le 13/10/2021 ? 12:14, Pedro Ven?ncio a ?crit?:
> Hi all,
>
> I'm trying to create an Anaconda environment to run arosics, a 
> software that performs automatic subpixel co-registration of two 
> satellite image datasets.
>
> The environment seems correctly created, with GDAL working as expected 
> on the CLI:
> (arosics) PS C:\Users\PedroVenancio> gdalinfo --version
> GDAL 3.3.2, released 2021/09/01
>
> The problem is that when Python (versions >=3.8) calls GDAL, it gives 
> an error:
> (arosics) PS C:\Users\PedroVenancio> python
> Python 3.8.12 | packaged by conda-forge | (default, Oct 12 2021, 
> 21:22:46) [MSC v.1916 64 bit (AMD64)] on win32
> Type "help", "copyright", "credits" or "license" for more information.
>
> >>> from osgeo import gdal
> Traceback (most recent call last):
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 21, in swig_import_helper
> return importlib.import_module(mname)
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", 
> line 127, in import_module
> return _bootstrap._gcd_import(name[level:], package, level)
> File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
> File "<frozen importlib._bootstrap>", line 991, in _find_and_load
> File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
> File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
> File "<frozen importlib._bootstrap>", line 556, in module_from_spec
> File "<frozen importlib._bootstrap_external>", line 1166, in create_module
> File "<frozen importlib._bootstrap>", line 219, in 
> _call_with_frames_removed
> ImportError: DLL load failed while importing _gdal: Imposs?vel 
> localizar o procedimento especificado.
>
> During handling of the above exception, another exception occurred:
>
> Traceback (most recent call last):
> File "<stdin>", line 1, in <module>
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 37, in <module>
> _gdal = swig_import_helper()
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 33, in swig_import_helper
> raise ImportError(traceback_string + '\n' + msg)
> ImportError: Traceback (most recent call last):
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 21, in swig_import_helper
> return importlib.import_module(mname)
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", 
> line 127, in import_module
> return _bootstrap._gcd_import(name[level:], package, level)
> File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
> File "<frozen importlib._bootstrap>", line 991, in _find_and_load
> File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
> File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
> File "<frozen importlib._bootstrap>", line 556, in module_from_spec
> File "<frozen importlib._bootstrap_external>", line 1166, in create_module
> File "<frozen importlib._bootstrap>", line 219, in 
> _call_with_frames_removed
> ImportError: DLL load failed while importing _gdal: Imposs?vel 
> localizar o procedimento especificado.
>
> On Windows, with Python >= 3.8, DLLs are no longer imported from the PATH.
> If gdalXXX.dll is in the PATH, then set the 
> USE_PATH_FOR_GDAL_PYTHON=YES environment variable
> to feed the PATH into os.add_dll_directory().
> I've reported this error in the arosics issue tracker 
> (https://git.gfz-potsdam.de/danschef/arosics/-/issues/66 
> <https://git.gfz-potsdam.de/danschef/arosics/-/issues/66>), but it 
> seems to be working as expected in some similar systems (windows 10).
>
> So I believe it can be some kind of conflict with other installations 
> on my machine. I've for instance OSGeo4W and everything works fine:
> C:\OSGeo4W>gdalinfo --version
> GDAL 3.3.1, released 2021/06/28
>
> C:\OSGeo4W>python
> Python 3.9.5 (tags/v3.9.5:0a7dcbd, May 3 2021, 17:27:52) [MSC v.1928 
> 64 bit (AMD64)] on win32
> Type "help", "copyright", "credits" or "license" for more information.
>
> >>> from osgeo import gdal
> >>> gdal
> <module 'osgeo.gdal' from 
> 'C:\\OSGeo4W\\apps\\Python39\\lib\\site-packages\\osgeo\\gdal.py'>
>
> Has anyone seen this kind of error? Any hints to overcome?
>
> Thank you very much!
>
> Best regards,
> Pedro
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/e2ddc0b5/attachment-0001.html>

From pedrongvenancio at gmail.com  Wed Oct 13 05:05:25 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 13 Oct 2021 13:05:25 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
Message-ID: <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>

Hi Even,

Thanks for your help!

Yes, I've tried "set USE_PATH_FOR_GDAL_PYTHON=YES" but the behaviour does
not change.

I believe OSGeo4W shell sets the environment variables through .bat files,
and does not use system path. Am I right, Jurgen? (sorry for calling in CC)

Meanwhile I've found those issue and PR that seems related:
https://github.com/OSGeo/gdal/issues/3898
https://github.com/OSGeo/gdal/pull/3923

Following the steps to reproduce the problem I get the error message:

C:\Users\PedroVenancio\demo.py:

from osgeo import gdal

(arosics) PS C:\Users\PedroVenancio> gdalinfo --versionGDAL 3.3.2,
released 2021/09/01

(arosics) PS C:\Users\PedroVenancio> set USE_PATH_FOR_GDAL_PYTHON=YES
(arosics) PS C:\Users\PedroVenancio> python demo.py
Traceback (most recent call last):  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 21, in swig_import_helper    return
importlib.import_module(mname)  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
line 127, in import_module    return
_bootstrap._gcd_import(name[level:], package, level)  File "<frozen
importlib._bootstrap>", line 1014, in _gcd_import  File "<frozen
importlib._bootstrap>", line 991, in _find_and_load  File "<frozen
importlib._bootstrap>", line 975, in _find_and_load_unlocked  File
"<frozen importlib._bootstrap>", line 657, in _load_unlocked  File
"<frozen importlib._bootstrap>", line 556, in module_from_spec  File
"<frozen importlib._bootstrap_external>", line 1166, in create_module
File "<frozen importlib._bootstrap>", line 219, in
_call_with_frames_removedImportError: DLL load failed while importing
_gdal: Imposs?vel localizar o procedimento especificado.During
handling of the above exception, another exception occurred:Traceback
(most recent call last):  File "demo.py", line 1, in <module>    from
osgeo import gdal  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 37, in <module>    _gdal = swig_import_helper()  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 33, in swig_import_helper    raise ImportError(traceback_string +
'\n' + msg)ImportError: Traceback (most recent call last):  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 21, in swig_import_helper    return
importlib.import_module(mname)  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
line 127, in import_module    return
_bootstrap._gcd_import(name[level:], package, level)  File "<frozen
importlib._bootstrap>", line 1014, in _gcd_import  File "<frozen
importlib._bootstrap>", line 991, in _find_and_load  File "<frozen
importlib._bootstrap>", line 975, in _find_and_load_unlocked  File
"<frozen importlib._bootstrap>", line 657, in _load_unlocked  File
"<frozen importlib._bootstrap>", line 556, in module_from_spec  File
"<frozen importlib._bootstrap_external>", line 1166, in create_module
File "<frozen importlib._bootstrap>", line 219, in
_call_with_frames_removedImportError: DLL load failed while importing
_gdal: Imposs?vel localizar o procedimento especificado.On Windows,
with Python >= 3.8, DLLs are no longer imported from the PATH.If
gdalXXX.dll is in the PATH, then set the USE_PATH_FOR_GDAL_PYTHON=YES
environment variableto feed the PATH into os.add_dll_directory().


Are those ones really related?

Thanks Even and Jurgen!

Pedro


Even Rouault <even.rouault at spatialys.com> escreveu no dia quarta,
13/10/2021 ?(s) 11:43:

> Pedro,
>
> Did you try to "set USE_PATH_FOR_GDAL_PYTHON=YES" environment variable a
> suggested ?
>
> Can you check if it set in OSGeo4W shell ?  ("echo
> %USE_PATH_FOR_GDAL_PYTHON%")
>
> Wondering if we shouldn't enable that behavior automatically... although
> that we would go against upstream Python policy
>
> Even
> Le 13/10/2021 ? 12:14, Pedro Ven?ncio a ?crit :
>
> Hi all,
>
> I'm trying to create an Anaconda environment to run arosics, a software
> that performs automatic subpixel co-registration of two satellite image
> datasets.
>
> The environment seems correctly created, with GDAL working as expected on
> the CLI:
>
> (arosics) PS C:\Users\PedroVenancio> gdalinfo --versionGDAL 3.3.2, released 2021/09/01
>
>
> The problem is that when Python (versions >=3.8) calls GDAL, it gives an
> error:
>
> (arosics) PS C:\Users\PedroVenancio> pythonPython 3.8.12 | packaged by conda-forge | (default, Oct 12 2021, 21:22:46) [MSC v.1916 64 bit (AMD64)] on win32Type "help", "copyright", "credits" or "license" for more information.>>> from osgeo import gdalTraceback (most recent call last):  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper    return importlib.import_module(mname)  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module    return _bootstrap._gcd_import(name[level:], package, level)  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import  File "<frozen importlib._bootstrap>", line 991, in _find_and_load  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked  File "<frozen importlib._bootstrap>", line 657, in _load_unlocked  File "<frozen importlib._bootstrap>", line 556, in module_from_spec  File "<frozen importlib._bootstrap_external>", line 1166, in create_module  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removedImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.During handling of the above exception, another exception occurred:Traceback (most recent call last):  File "<stdin>", line 1, in <module>  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>    _gdal = swig_import_helper()  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 33, in swig_import_helper    raise ImportError(traceback_string + '\n' + msg)ImportError: Traceback (most recent call last):  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper    return importlib.import_module(mname)  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module    return _bootstrap._gcd_import(name[level:], package, level)  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import  File "<frozen importlib._bootstrap>", line 991, in _find_and_load  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked  File "<frozen importlib._bootstrap>", line 657, in _load_unlocked  File "<frozen importlib._bootstrap>", line 556, in module_from_spec  File "<frozen importlib._bootstrap_external>", line 1166, in create_module  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removedImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.On Windows, with Python >= 3.8, DLLs are no longer imported from the PATH.If gdalXXX.dll is in the PATH, then set the USE_PATH_FOR_GDAL_PYTHON=YES environment variableto feed the PATH into os.add_dll_directory().
>
> I've reported this error in the arosics issue tracker (
> https://git.gfz-potsdam.de/danschef/arosics/-/issues/66), but it seems to
> be working as expected in some similar systems (windows 10).
>
> So I believe it can be some kind of conflict with other installations on
> my machine. I've for instance OSGeo4W and everything works fine:
>
> C:\OSGeo4W>gdalinfo --versionGDAL 3.3.1, released 2021/06/28C:\OSGeo4W>pythonPython 3.9.5 (tags/v3.9.5:0a7dcbd, May  3 2021, 17:27:52) [MSC v.1928 64 bit (AMD64)] on win32Type "help", "copyright", "credits" or "license" for more information.>>> from osgeo import gdal>>> gdal<module 'osgeo.gdal' from 'C:\\OSGeo4W\\apps\\Python39\\lib\\site-packages\\osgeo\\gdal.py'>
>
>
> Has anyone seen this kind of error? Any hints to overcome?
>
> Thank you very much!
>
> Best regards,
> Pedro
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/b033db72/attachment-0001.html>

From even.rouault at spatialys.com  Wed Oct 13 05:17:11 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Oct 2021 14:17:11 +0200
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
Message-ID: <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>


Le 13/10/2021 ? 14:05, Pedro Ven?ncio a ?crit?:
> Hi Even,
>
> Thanks for your help!
>
> Yes, I've tried "set USE_PATH_FOR_GDAL_PYTHON=YES" but the behaviour 
> does not change.
>
> I believe OSGeo4W shell sets the environment variables through .bat 
> files, and does not use system path. Am I right, Jurgen? (sorry for 
> calling in CC)
I'd be curious to know if you could confirm if the OSGeo4W shell does 
set it or not
>
> Meanwhile I've found those issue and PR that seems related:
> https://github.com/OSGeo/gdal/issues/3898 
> <https://github.com/OSGeo/gdal/issues/3898>
> https://github.com/OSGeo/gdal/pull/3923 
> <https://github.com/OSGeo/gdal/pull/3923>

I don't think they are. And that fix is in 3.3.2

But I don't understand why you still get the "On Windows, with Python >= 
3.8, DLLs are no longer imported from the PATH." error message.

It shouldn't be emitted because USE_PATH_FOR_GDAL_PYTHON is set: 
https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25

Something weird happening here. Perhaps edit 
https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25 
to display os.environ

>
> Following the steps to reproduce the problem I get the error message:
>
> C:\Users\PedroVenancio\demo.py:
>
> |from osgeo import gdal |
> (arosics) PS C:\Users\PedroVenancio> gdalinfo --version GDAL 3.3.2, 
> released 2021/09/01 (arosics) PS C:\Users\PedroVenancio> set 
> USE_PATH_FOR_GDAL_PYTHON=YES
>
> (arosics) PS C:\Users\PedroVenancio> python demo.py
>
> Traceback (most recent call last):
> ? File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 21, in swig_import_helper
> ? ? return importlib.import_module(mname)
> ? File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", 
> line 127, in import_module
> ? ? return _bootstrap._gcd_import(name[level:], package, level)
> ? File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
> ? File "<frozen importlib._bootstrap>", line 991, in _find_and_load
> ? File "<frozen importlib._bootstrap>", line 975, in 
> _find_and_load_unlocked
> ? File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
> ? File "<frozen importlib._bootstrap>", line 556, in module_from_spec
> ? File "<frozen importlib._bootstrap_external>", line 1166, in 
> create_module
> ? File "<frozen importlib._bootstrap>", line 219, in 
> _call_with_frames_removed
> ImportError: DLL load failed while importing _gdal: Imposs?vel 
> localizar o procedimento especificado.
>
> During handling of the above exception, another exception occurred:
>
> Traceback (most recent call last):
> ? File "demo.py", line 1, in <module>
> ? ? from osgeo import gdal
> ? File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 37, in <module>
> ? ? _gdal = swig_import_helper()
> ? File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 33, in swig_import_helper
> ? ? raise ImportError(traceback_string + '\n' + msg)
> ImportError: Traceback (most recent call last):
> ? File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 21, in swig_import_helper
> ? ? return importlib.import_module(mname)
> ? File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", 
> line 127, in import_module
> ? ? return _bootstrap._gcd_import(name[level:], package, level)
> ? File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
> ? File "<frozen importlib._bootstrap>", line 991, in _find_and_load
> ? File "<frozen importlib._bootstrap>", line 975, in 
> _find_and_load_unlocked
> ? File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
> ? File "<frozen importlib._bootstrap>", line 556, in module_from_spec
> ? File "<frozen importlib._bootstrap_external>", line 1166, in 
> create_module
> ? File "<frozen importlib._bootstrap>", line 219, in 
> _call_with_frames_removed
> ImportError: DLL load failed while importing _gdal: Imposs?vel 
> localizar o procedimento especificado.
>
> On Windows, with Python >= 3.8, DLLs are no longer imported from the PATH.
> If gdalXXX.dll is in the PATH, then set the 
> USE_PATH_FOR_GDAL_PYTHON=YES environment variable
> to feed the PATH into os.add_dll_directory().
>
> Are those ones really related?
>
> Thanks Even and Jurgen!
>
> Pedro
>
>
> Even Rouault <even.rouault at spatialys.com 
> <mailto:even.rouault at spatialys.com>> escreveu no dia quarta, 
> 13/10/2021 ?(s) 11:43:
>
>     Pedro,
>
>     Did you try to "set USE_PATH_FOR_GDAL_PYTHON=YES" environment
>     variable a suggested ?
>
>     Can you check if it set in OSGeo4W shell ?? ("echo
>     %USE_PATH_FOR_GDAL_PYTHON%")
>
>     Wondering if we shouldn't enable that behavior automatically...
>     although that we would go against upstream Python policy
>
>     Even
>
>     Le 13/10/2021 ? 12:14, Pedro Ven?ncio a ?crit?:
>>     Hi all,
>>
>>     I'm trying to create an Anaconda environment to run arosics, a
>>     software that performs automatic subpixel co-registration of two
>>     satellite image datasets.
>>
>>     The environment seems correctly created, with GDAL working as
>>     expected on the CLI:
>>     (arosics) PS C:\Users\PedroVenancio> gdalinfo --version
>>     GDAL 3.3.2, released 2021/09/01
>>
>>     The problem is that when Python (versions >=3.8) calls GDAL, it
>>     gives an error:
>>     (arosics) PS C:\Users\PedroVenancio> python
>>     Python 3.8.12 | packaged by conda-forge | (default, Oct 12 2021,
>>     21:22:46) [MSC v.1916 64 bit (AMD64)] on win32
>>     Type "help", "copyright", "credits" or "license" for more
>>     information.
>>
>>     >>> from osgeo import gdal
>>     Traceback (most recent call last):
>>     File
>>     "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
>>     line 21, in swig_import_helper
>>     return importlib.import_module(mname)
>>     File
>>     "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
>>     line 127, in import_module
>>     return _bootstrap._gcd_import(name[level:], package, level)
>>     File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
>>     File "<frozen importlib._bootstrap>", line 991, in _find_and_load
>>     File "<frozen importlib._bootstrap>", line 975, in
>>     _find_and_load_unlocked
>>     File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
>>     File "<frozen importlib._bootstrap>", line 556, in module_from_spec
>>     File "<frozen importlib._bootstrap_external>", line 1166, in
>>     create_module
>>     File "<frozen importlib._bootstrap>", line 219, in
>>     _call_with_frames_removed
>>     ImportError: DLL load failed while importing _gdal: Imposs?vel
>>     localizar o procedimento especificado.
>>
>>     During handling of the above exception, another exception occurred:
>>
>>     Traceback (most recent call last):
>>     File "<stdin>", line 1, in <module>
>>     File
>>     "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
>>     line 37, in <module>
>>     _gdal = swig_import_helper()
>>     File
>>     "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
>>     line 33, in swig_import_helper
>>     raise ImportError(traceback_string + '\n' + msg)
>>     ImportError: Traceback (most recent call last):
>>     File
>>     "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
>>     line 21, in swig_import_helper
>>     return importlib.import_module(mname)
>>     File
>>     "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
>>     line 127, in import_module
>>     return _bootstrap._gcd_import(name[level:], package, level)
>>     File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
>>     File "<frozen importlib._bootstrap>", line 991, in _find_and_load
>>     File "<frozen importlib._bootstrap>", line 975, in
>>     _find_and_load_unlocked
>>     File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
>>     File "<frozen importlib._bootstrap>", line 556, in module_from_spec
>>     File "<frozen importlib._bootstrap_external>", line 1166, in
>>     create_module
>>     File "<frozen importlib._bootstrap>", line 219, in
>>     _call_with_frames_removed
>>     ImportError: DLL load failed while importing _gdal: Imposs?vel
>>     localizar o procedimento especificado.
>>
>>     On Windows, with Python >= 3.8, DLLs are no longer imported from
>>     the PATH.
>>     If gdalXXX.dll is in the PATH, then set the
>>     USE_PATH_FOR_GDAL_PYTHON=YES environment variable
>>     to feed the PATH into os.add_dll_directory().
>>     I've reported this error in the arosics issue tracker
>>     (https://git.gfz-potsdam.de/danschef/arosics/-/issues/66
>>     <https://git.gfz-potsdam.de/danschef/arosics/-/issues/66>), but
>>     it seems to be working as expected in some similar systems
>>     (windows 10).
>>
>>     So I believe it can be some kind of conflict with other
>>     installations on my machine. I've for instance OSGeo4W and
>>     everything works fine:
>>     C:\OSGeo4W>gdalinfo --version
>>     GDAL 3.3.1, released 2021/06/28
>>
>>     C:\OSGeo4W>python
>>     Python 3.9.5 (tags/v3.9.5:0a7dcbd, May 3 2021, 17:27:52) [MSC
>>     v.1928 64 bit (AMD64)] on win32
>>     Type "help", "copyright", "credits" or "license" for more
>>     information.
>>
>>     >>> from osgeo import gdal
>>     >>> gdal
>>     <module 'osgeo.gdal' from
>>     'C:\\OSGeo4W\\apps\\Python39\\lib\\site-packages\\osgeo\\gdal.py'>
>>
>>     Has anyone seen this kind of error? Any hints to overcome?
>>
>>     Thank you very much!
>>
>>     Best regards,
>>     Pedro
>>
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev  <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>     -- 
>     http://www.spatialys.com  <http://www.spatialys.com>
>     My software is free, but my time generally not.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/fd07385d/attachment-0001.html>

From pedrongvenancio at gmail.com  Wed Oct 13 06:20:05 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 13 Oct 2021 14:20:05 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
Message-ID: <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>

> But I don't understand why you still get the "On Windows, with Python >=
> 3.8, DLLs are no longer imported from the PATH." error message.
>
> It shouldn't be emitted because USE_PATH_FOR_GDAL_PYTHON is set:
> https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25
>
> Something weird happening here. Perhaps edit
> https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25
> to display os.environ
>

Even, I was not setting the environment variable correctly on conda. It
needs to be

conda env config vars set USE_PATH_FOR_GDAL_PYTHON=YES

and then I already get

conda env config vars listUSE_PATH_FOR_GDAL_PYTHON = YES

So, the error message had changed

python demo.pyTraceback (most recent call last):  File "demo.py", line
1, in <module>    from osgeo import gdal  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 11, in <module>    os.add_dll_directory(p)  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\os.py", line 1109,
in add_dll_directory    cookie = nt._add_dll_directory(path)OSError:
[WinError 87] O par?metro est? incorreto: '.'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/64f85839/attachment.html>

From even.rouault at spatialys.com  Wed Oct 13 06:29:39 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Oct 2021 15:29:39 +0200
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
Message-ID: <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>

Can you change in __init__.py

 ??????????????? try:
 ??????????????????? os.add_dll_directory(p)
 ??????????????? except FileNotFoundError:
 ??????????????????? continue


to

 ??????????????? try:
 ??????????????????? os.add_dll_directory(p)
 ??????????????? except (FileNotFoundError, OSError):
 ??????????????????? continue

Le 13/10/2021 ? 15:20, Pedro Ven?ncio a ?crit?:
>
>     But I don't understand why you still get the "On Windows, with
>     Python >= 3.8, DLLs are no longer imported from the PATH." error
>     message.
>
>     It shouldn't be emitted because USE_PATH_FOR_GDAL_PYTHON is set:
>     https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25
>     <https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25>
>
>     Something weird happening here. Perhaps edit
>     https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25
>     <https://github.com/OSGeo/gdal/blob/f3a83a2c2628219bdc60001580da677758015a60/gdal/swig/python/osgeo/__init__.py#L25>
>     to display os.environ
>
>
> Even, I was not setting the environment variable correctly on conda. 
> It needs to be
>
> |conda env config vars set USE_PATH_FOR_GDAL_PYTHON=YES|
>
> and then I already get
> conda env config vars list
> USE_PATH_FOR_GDAL_PYTHON = YES
> So, the error message had changed
> python demo.py
> Traceback (most recent call last):
> File "demo.py", line 1, in <module>
> from osgeo import gdal
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 11, in <module>
> os.add_dll_directory(p)
> File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\os.py", line 
> 1109, in add_dll_directory
> cookie = nt._add_dll_directory(path)
> OSError: [WinError 87] O par?metro est? incorreto: '.'
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/60bd7a9a/attachment.html>

From pedrongvenancio at gmail.com  Wed Oct 13 06:36:20 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 13 Oct 2021 14:36:20 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
Message-ID: <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>

> Can you change in __init__.py
>
>                 try:
>                     os.add_dll_directory(p)
>                 except FileNotFoundError:
>                     continue
>
>
> to
>
>                 try:
>                     os.add_dll_directory(p)
>                 except (FileNotFoundError, OSError):
>                     continue
>

Yes, here is the output:

Traceback (most recent call last):  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 21, in swig_import_helper    return
importlib.import_module(mname)  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
line 127, in import_module    return
_bootstrap._gcd_import(name[level:], package, level)  File "<frozen
importlib._bootstrap>", line 1014, in _gcd_import  File "<frozen
importlib._bootstrap>", line 991, in _find_and_load  File "<frozen
importlib._bootstrap>", line 975, in _find_and_load_unlocked  File
"<frozen importlib._bootstrap>", line 657, in _load_unlocked  File
"<frozen importlib._bootstrap>", line 556, in module_from_spec  File
"<frozen importlib._bootstrap_external>", line 1166, in create_module
File "<frozen importlib._bootstrap>", line 219, in
_call_with_frames_removedImportError: DLL load failed while importing
_gdal: Imposs?vel localizar o procedimento especificado.During
handling of the above exception, another exception occurred:Traceback
(most recent call last):  File "demo.py", line 1, in <module>    from
osgeo import gdal  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 37, in <module>    _gdal = swig_import_helper()  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
line 34, in swig_import_helper    return
importlib.import_module('_gdal')  File
"C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
line 127, in import_module    return
_bootstrap._gcd_import(name[level:], package,
level)ModuleNotFoundError: No module named '_gdal'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/15db3950/attachment.html>

From even.rouault at spatialys.com  Wed Oct 13 06:39:14 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Oct 2021 15:39:14 +0200
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
Message-ID: <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>

ok, so now you have to inspect the PATH and fix it so that the gdal DLL 
and its dependencies are in it. But all of this sounds like there's 
something weird in your environment. Perhaps a mix of GDAL versions?

Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit?:
>
>     Can you change in __init__.py
>
>     ??????????????? try:
>     ??????????????????? os.add_dll_directory(p)
>     ??????????????? except FileNotFoundError:
>     ??????????????????? continue
>
>
>     to
>
>     ??????????????? try:
>     ??????????????????? os.add_dll_directory(p)
>     ??????????????? except (FileNotFoundError, OSError):
>     ??????????????????? continue
>
>
> Yes, here is the output:
> Traceback (most recent call last):
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 21, in swig_import_helper
> return importlib.import_module(mname)
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", 
> line 127, in import_module
> return _bootstrap._gcd_import(name[level:], package, level)
> File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
> File "<frozen importlib._bootstrap>", line 991, in _find_and_load
> File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
> File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
> File "<frozen importlib._bootstrap>", line 556, in module_from_spec
> File "<frozen importlib._bootstrap_external>", line 1166, in create_module
> File "<frozen importlib._bootstrap>", line 219, in 
> _call_with_frames_removed
> ImportError: DLL load failed while importing _gdal: Imposs?vel 
> localizar o procedimento especificado.
>
> During handling of the above exception, another exception occurred:
>
> Traceback (most recent call last):
> File "demo.py", line 1, in <module>
> from osgeo import gdal
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 37, in <module>
> _gdal = swig_import_helper()
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", 
> line 34, in swig_import_helper
> return importlib.import_module('_gdal')
> File 
> "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", 
> line 127, in import_module
> return _bootstrap._gcd_import(name[level:], package, level)
> ModuleNotFoundError: No module named '_gdal'
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/19ccbff1/attachment-0001.html>

From jluis at ualg.pt  Wed Oct 13 07:24:53 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Wed, 13 Oct 2021 14:24:53 +0000
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
Message-ID: <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>

Hi,

I have a certain horror to python (that I?m trying to fight) a bit of it is because I never manage to really use it.

I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I removed and installed a new one in which I tried Pedro?s case and got exactly the same errors.

I then run a dependency analysis from within the conda shell and found two weird things


  1.  The gdal dll depends on a xerces-c_3_2.dll locate at C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but seems to not cause any problem in this case.
  2.  There is a ?red mark? on the opj_encoder_set_extra_options symbol and this alone can explain the ?ImportError: DLL load failed while importing _gdal: The specified procedure could not be found.?

Hopefully the screen capture is small enough to get through.

Joaquim

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Even Rouault
Sent: Wednesday, October 13, 2021 2:39 PM
To: Pedro Ven?ncio <pedrongvenancio at gmail.com>
Cc: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL load failed


ok, so now you have to inspect the PATH and fix it so that the gdal DLL and its dependencies are in it. But all of this sounds like there's something weird in your environment. Perhaps a mix of GDAL versions?
Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :

Can you change in __init__.py

                try:
                    os.add_dll_directory(p)
                except FileNotFoundError:
                    continue



to

                try:
                    os.add_dll_directory(p)
                except (FileNotFoundError, OSError):
                    continue

Yes, here is the output:

Traceback (most recent call last):

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper

    return importlib.import_module(mname)

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import

  File "<frozen importlib._bootstrap>", line 991, in _find_and_load

  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked

  File "<frozen importlib._bootstrap>", line 657, in _load_unlocked

  File "<frozen importlib._bootstrap>", line 556, in module_from_spec

  File "<frozen importlib._bootstrap_external>", line 1166, in create_module

  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed

ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.



During handling of the above exception, another exception occurred:



Traceback (most recent call last):

  File "demo.py", line 1, in <module>

    from osgeo import gdal

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>

    _gdal = swig_import_helper()

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper

    return importlib.import_module('_gdal')

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

ModuleNotFoundError: No module named '_gdal'


--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/3c0fb17c/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Capture-fs8.png
Type: image/png
Size: 54611 bytes
Desc: Capture-fs8.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/3c0fb17c/attachment-0001.png>

From pedrongvenancio at gmail.com  Wed Oct 13 08:04:19 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 13 Oct 2021 16:04:19 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>

Hi Joaquim,

Thanks for sharing your case. Did you manage to make it work in some way?

I've already uninstalled a test PostgreSQL/PostGIS that I supposed to be
the source of the conflict, but I keep having the same error.

I also reinstalled conda, but nothing had changed.



Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
13/10/2021 ?(s) 15:24:

> Hi,
>
>
>
> I have a certain horror to python (that I?m trying to fight) a bit of it
> is because I never manage to really use it.
>
>
>
> I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I
> removed and installed a new one in which I tried Pedro?s case and got
> exactly the same errors.
>
>
>
> I then run a dependency analysis from within the conda shell and found two
> weird things
>
>
>
>    1. The gdal dll depends on a xerces-c_3_2.dll locate at
>    C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but
>    seems to not cause any problem in this case.
>    2. There is a ?red mark? on the opj_encoder_set_extra_options symbol
>    and this alone can explain the ?ImportError: DLL load failed while
>    importing _gdal: The specified procedure could not be found.?
>
>
>
> Hopefully the screen capture is small enough to get through.
>
>
>
> Joaquim
>
>
>
> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Even
> Rouault
> *Sent:* Wednesday, October 13, 2021 2:39 PM
> *To:* Pedro Ven?ncio <pedrongvenancio at gmail.com>
> *Cc:* gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda
> - DLL load failed
>
>
>
> ok, so now you have to inspect the PATH and fix it so that the gdal DLL
> and its dependencies are in it. But all of this sounds like there's
> something weird in your environment. Perhaps a mix of GDAL versions?
>
> Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :
>
> Can you change in __init__.py
>
>                 try:
>                     os.add_dll_directory(p)
>                 except FileNotFoundError:
>                     continue
>
>
>
> to
>
>                 try:
>                     os.add_dll_directory(p)
>                 except (FileNotFoundError, OSError):
>                     continue
>
>
>
> Yes, here is the output:
>
> Traceback (most recent call last):
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper
>
>     return importlib.import_module(mname)
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>
>     return _bootstrap._gcd_import(name[level:], package, level)
>
>   File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
>
>   File "<frozen importlib._bootstrap>", line 991, in _find_and_load
>
>   File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
>
>   File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
>
>   File "<frozen importlib._bootstrap>", line 556, in module_from_spec
>
>   File "<frozen importlib._bootstrap_external>", line 1166, in create_module
>
>   File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
>
> ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.
>
>
>
> During handling of the above exception, another exception occurred:
>
>
>
> Traceback (most recent call last):
>
>   File "demo.py", line 1, in <module>
>
>     from osgeo import gdal
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>
>
>     _gdal = swig_import_helper()
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper
>
>     return importlib.import_module('_gdal')
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>
>     return _bootstrap._gcd_import(name[level:], package, level)
>
> ModuleNotFoundError: No module named '_gdal'
>
>
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/c69d46e7/attachment.html>

From jluis at ualg.pt  Wed Oct 13 08:23:40 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Wed, 13 Oct 2021 15:23:40 +0000
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
Message-ID: <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>

N?o Pedro,

When I look into my own build of the gdall dll I see no dependency on that ?opj_encoder_set_extra_options? but likely because it?s a different version (I build from master).

From my experience on this there is really nothing one can do other than rebuild the dll or replace the dependency that is missing the required symbol. Nothing we can do from a conda installation.

But ofc my analysis may be all wrong.

Joaquim

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Pedro Ven?ncio
Sent: Wednesday, October 13, 2021 4:04 PM
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL load failed

Hi Joaquim,

Thanks for sharing your case. Did you manage to make it work in some way?

I've already uninstalled a test PostgreSQL/PostGIS that I supposed to be the source of the conflict, but I keep having the same error.

I also reinstalled conda, but nothing had changed.



Joaquim Manuel Freire Lu?s <jluis at ualg.pt<mailto:jluis at ualg.pt>> escreveu no dia quarta, 13/10/2021 ?(s) 15:24:
Hi,

I have a certain horror to python (that I?m trying to fight) a bit of it is because I never manage to really use it.

I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I removed and installed a new one in which I tried Pedro?s case and got exactly the same errors.

I then run a dependency analysis from within the conda shell and found two weird things


  1.  The gdal dll depends on a xerces-c_3_2.dll locate at C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but seems to not cause any problem in this case.
  2.  There is a ?red mark? on the opj_encoder_set_extra_options symbol and this alone can explain the ?ImportError: DLL load failed while importing _gdal: The specified procedure could not be found.?

Hopefully the screen capture is small enough to get through.

Joaquim

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> On Behalf Of Even Rouault
Sent: Wednesday, October 13, 2021 2:39 PM
To: Pedro Ven?ncio <pedrongvenancio at gmail.com<mailto:pedrongvenancio at gmail.com>>
Cc: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL load failed


ok, so now you have to inspect the PATH and fix it so that the gdal DLL and its dependencies are in it. But all of this sounds like there's something weird in your environment. Perhaps a mix of GDAL versions?
Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :

Can you change in __init__.py

                try:
                    os.add_dll_directory(p)
                except FileNotFoundError:
                    continue



to

                try:
                    os.add_dll_directory(p)
                except (FileNotFoundError, OSError):
                    continue

Yes, here is the output:

Traceback (most recent call last):

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper

    return importlib.import_module(mname)

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import

  File "<frozen importlib._bootstrap>", line 991, in _find_and_load

  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked

  File "<frozen importlib._bootstrap>", line 657, in _load_unlocked

  File "<frozen importlib._bootstrap>", line 556, in module_from_spec

  File "<frozen importlib._bootstrap_external>", line 1166, in create_module

  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed

ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.



During handling of the above exception, another exception occurred:



Traceback (most recent call last):

  File "demo.py", line 1, in <module>

    from osgeo import gdal

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>

    _gdal = swig_import_helper()

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper

    return importlib.import_module('_gdal')

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

ModuleNotFoundError: No module named '_gdal'


--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/dc10ef0c/attachment-0001.html>

From pedrongvenancio at gmail.com  Wed Oct 13 09:00:49 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 13 Oct 2021 17:00:49 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
 <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <CAMCJChuz_HE5-B5Ek+aXGoRsHZgDF6rW62ug-CfQmvMrb8wegQ@mail.gmail.com>

Tried to define several environment variables, but nothing seems to work

[image: env_win10.jpg]


Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
13/10/2021 ?(s) 16:23:

> N?o Pedro,
>
>
>
> When I look into my own build of the gdall dll I see no dependency on that
> ?opj_encoder_set_extra_options? but likely because it?s a different version
> (I build from master).
>
>
>
> From my experience on this there is really nothing one can do other than
> rebuild the dll or replace the dependency that is missing the required
> symbol. Nothing we can do from a conda installation.
>
>
>
> But ofc my analysis may be all wrong.
>
>
>
> Joaquim
>
>
>
> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Pedro
> Ven?ncio
> *Sent:* Wednesday, October 13, 2021 4:04 PM
> *To:* gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda
> - DLL load failed
>
>
>
> Hi Joaquim,
>
>
>
> Thanks for sharing your case. Did you manage to make it work in some way?
>
>
>
> I've already uninstalled a test PostgreSQL/PostGIS that I supposed to be
> the source of the conflict, but I keep having the same error.
>
>
>
> I also reinstalled conda, but nothing had changed.
>
>
>
>
>
>
>
> Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
> 13/10/2021 ?(s) 15:24:
>
> Hi,
>
>
>
> I have a certain horror to python (that I?m trying to fight) a bit of it
> is because I never manage to really use it.
>
>
>
> I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I
> removed and installed a new one in which I tried Pedro?s case and got
> exactly the same errors.
>
>
>
> I then run a dependency analysis from within the conda shell and found two
> weird things
>
>
>
>    1. The gdal dll depends on a xerces-c_3_2.dll locate at
>    C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but
>    seems to not cause any problem in this case.
>    2. There is a ?red mark? on the opj_encoder_set_extra_options symbol
>    and this alone can explain the ?ImportError: DLL load failed while
>    importing _gdal: The specified procedure could not be found.?
>
>
>
> Hopefully the screen capture is small enough to get through.
>
>
>
> Joaquim
>
>
>
> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Even
> Rouault
> *Sent:* Wednesday, October 13, 2021 2:39 PM
> *To:* Pedro Ven?ncio <pedrongvenancio at gmail.com>
> *Cc:* gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda
> - DLL load failed
>
>
>
> ok, so now you have to inspect the PATH and fix it so that the gdal DLL
> and its dependencies are in it. But all of this sounds like there's
> something weird in your environment. Perhaps a mix of GDAL versions?
>
> Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :
>
> Can you change in __init__.py
>
>                 try:
>                     os.add_dll_directory(p)
>                 except FileNotFoundError:
>                     continue
>
>
>
> to
>
>                 try:
>                     os.add_dll_directory(p)
>                 except (FileNotFoundError, OSError):
>                     continue
>
>
>
> Yes, here is the output:
>
> Traceback (most recent call last):
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper
>
>     return importlib.import_module(mname)
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>
>     return _bootstrap._gcd_import(name[level:], package, level)
>
>   File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
>
>   File "<frozen importlib._bootstrap>", line 991, in _find_and_load
>
>   File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
>
>   File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
>
>   File "<frozen importlib._bootstrap>", line 556, in module_from_spec
>
>   File "<frozen importlib._bootstrap_external>", line 1166, in create_module
>
>   File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
>
> ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.
>
>
>
> During handling of the above exception, another exception occurred:
>
>
>
> Traceback (most recent call last):
>
>   File "demo.py", line 1, in <module>
>
>     from osgeo import gdal
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>
>
>     _gdal = swig_import_helper()
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper
>
>     return importlib.import_module('_gdal')
>
>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>
>     return _bootstrap._gcd_import(name[level:], package, level)
>
> ModuleNotFoundError: No module named '_gdal'
>
>
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/277e5446/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: env_win10.jpg
Type: image/jpeg
Size: 33695 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/277e5446/attachment-0001.jpg>

From pedrongvenancio at gmail.com  Wed Oct 13 09:15:02 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Wed, 13 Oct 2021 17:15:02 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChuz_HE5-B5Ek+aXGoRsHZgDF6rW62ug-CfQmvMrb8wegQ@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
 <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChuz_HE5-B5Ek+aXGoRsHZgDF6rW62ug-CfQmvMrb8wegQ@mail.gmail.com>
Message-ID: <CAMCJChs=AeoYPDT_dbCyxVu4fQzn2vgxTrRC664=SYezXctXaw@mail.gmail.com>

I will ask on GDAL conda-forge, maybe this can be some packaging problem.

Thanks!


Pedro Ven?ncio <pedrongvenancio at gmail.com> escreveu no dia quarta,
13/10/2021 ?(s) 17:00:

> Tried to define several environment variables, but nothing seems to work
>
> [image: env_win10.jpg]
>
>
> Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
> 13/10/2021 ?(s) 16:23:
>
>> N?o Pedro,
>>
>>
>>
>> When I look into my own build of the gdall dll I see no dependency on
>> that ?opj_encoder_set_extra_options? but likely because it?s a different
>> version (I build from master).
>>
>>
>>
>> From my experience on this there is really nothing one can do other than
>> rebuild the dll or replace the dependency that is missing the required
>> symbol. Nothing we can do from a conda installation.
>>
>>
>>
>> But ofc my analysis may be all wrong.
>>
>>
>>
>> Joaquim
>>
>>
>>
>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Pedro
>> Ven?ncio
>> *Sent:* Wednesday, October 13, 2021 4:04 PM
>> *To:* gdal-dev at lists.osgeo.org
>> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda
>> - DLL load failed
>>
>>
>>
>> Hi Joaquim,
>>
>>
>>
>> Thanks for sharing your case. Did you manage to make it work in some way?
>>
>>
>>
>> I've already uninstalled a test PostgreSQL/PostGIS that I supposed to be
>> the source of the conflict, but I keep having the same error.
>>
>>
>>
>> I also reinstalled conda, but nothing had changed.
>>
>>
>>
>>
>>
>>
>>
>> Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
>> 13/10/2021 ?(s) 15:24:
>>
>> Hi,
>>
>>
>>
>> I have a certain horror to python (that I?m trying to fight) a bit of it
>> is because I never manage to really use it.
>>
>>
>>
>> I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I
>> removed and installed a new one in which I tried Pedro?s case and got
>> exactly the same errors.
>>
>>
>>
>> I then run a dependency analysis from within the conda shell and found
>> two weird things
>>
>>
>>
>>    1. The gdal dll depends on a xerces-c_3_2.dll locate at
>>    C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but
>>    seems to not cause any problem in this case.
>>    2. There is a ?red mark? on the opj_encoder_set_extra_options symbol
>>    and this alone can explain the ?ImportError: DLL load failed while
>>    importing _gdal: The specified procedure could not be found.?
>>
>>
>>
>> Hopefully the screen capture is small enough to get through.
>>
>>
>>
>> Joaquim
>>
>>
>>
>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Even
>> Rouault
>> *Sent:* Wednesday, October 13, 2021 2:39 PM
>> *To:* Pedro Ven?ncio <pedrongvenancio at gmail.com>
>> *Cc:* gdal-dev at lists.osgeo.org
>> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda
>> - DLL load failed
>>
>>
>>
>> ok, so now you have to inspect the PATH and fix it so that the gdal DLL
>> and its dependencies are in it. But all of this sounds like there's
>> something weird in your environment. Perhaps a mix of GDAL versions?
>>
>> Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :
>>
>> Can you change in __init__.py
>>
>>                 try:
>>                     os.add_dll_directory(p)
>>                 except FileNotFoundError:
>>                     continue
>>
>>
>>
>> to
>>
>>                 try:
>>                     os.add_dll_directory(p)
>>                 except (FileNotFoundError, OSError):
>>                     continue
>>
>>
>>
>> Yes, here is the output:
>>
>> Traceback (most recent call last):
>>
>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper
>>
>>     return importlib.import_module(mname)
>>
>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>>
>>     return _bootstrap._gcd_import(name[level:], package, level)
>>
>>   File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
>>
>>   File "<frozen importlib._bootstrap>", line 991, in _find_and_load
>>
>>   File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
>>
>>   File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
>>
>>   File "<frozen importlib._bootstrap>", line 556, in module_from_spec
>>
>>   File "<frozen importlib._bootstrap_external>", line 1166, in create_module
>>
>>   File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
>>
>> ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.
>>
>>
>>
>> During handling of the above exception, another exception occurred:
>>
>>
>>
>> Traceback (most recent call last):
>>
>>   File "demo.py", line 1, in <module>
>>
>>     from osgeo import gdal
>>
>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>
>>
>>     _gdal = swig_import_helper()
>>
>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper
>>
>>     return importlib.import_module('_gdal')
>>
>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>>
>>     return _bootstrap._gcd_import(name[level:], package, level)
>>
>> ModuleNotFoundError: No module named '_gdal'
>>
>>
>>
>> --
>>
>> http://www.spatialys.com
>>
>> My software is free, but my time generally not.
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/8187a731/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: env_win10.jpg
Type: image/jpeg
Size: 33695 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/8187a731/attachment-0001.jpg>

From erobeck at gmail.com  Wed Oct 13 09:35:10 2021
From: erobeck at gmail.com (Eric Robeck)
Date: Wed, 13 Oct 2021 11:35:10 -0500
Subject: [gdal-dev] GeoTIFF: connection between CRS WKT and GeoKeys
Message-ID: <CAKa5cDLeMX6fPx8P59Yvdob=fTJq2npU7zCrc-Vee-Hy06uiQA@mail.gmail.com>

I have a question about which GeoTIFF tags should be used for storing CRS
information. I have two GeoTIFFs: one original and the same file saved as a
COG. Then I created gdalinfo and listgeo reports for each and compared them
for changes.

*gdalinfo*: Aside from the difference in the PROJCRS citation ("WGS 84 /
UTM zone 6N" vs. "WGS_84_UTM_zone_6N"), the only change is the COG and LZW
predictor.

*listgeo*: a large number of GeoTags were never populated by the original
GeoTIFF creators. Other ASCII citation values were replaced by the Esri
conversion tool.

A number of the listgeo-reported GeoKeys in the COG (e.g.
GeogGeodeticDatumGeoKey, GeogAngularUnitSizeGeoKey, GeogEllipsoidGeoKey,
etc.) are missing from the custom-made original GeoTIFF. The extra CRS tags
were added upon conversion to COG. Those parameters are fundamental
components of the CRS and are reported in the gdalinfo WKT as
DATUM/ELLIPSOID, ANGLEUNIT, etc.

However, the WKT reported by gdalinfo is identical in both cases. So it had
access to the full WKT components even when the corresponding GeoKeys were
missing in the GeoTIFF.

My questions are:

   1. If the GeoKeys storing that information are missing from the GeoTIFF,
   where does GDAL retrieve them from? Does it refer to the PROJ library to
   retrieve the EPSG values for the EPSG codes in ProjectedCSTypeGeoKey,
   VerticalCSTypeGeoKey, etc.?
   2. Some software, following guidance in DGIWG-108 and DGIWG-250, did not
   assign a VerticalDatumGeoKey. Prior to release of GeoTIFF 1.1, the
   "unknown" value caused problems with vertical projection in some software,
   like QT Modeler. Does GDAL now fill in or assume the missing key based on
   the VerticalCSTypeGeoKey?

Thanks in advance!

Regards,
Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/2a2603a0/attachment.html>

From even.rouault at spatialys.com  Wed Oct 13 09:45:28 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 13 Oct 2021 18:45:28 +0200
Subject: [gdal-dev] GeoTIFF: connection between CRS WKT and GeoKeys
In-Reply-To: <CAKa5cDLeMX6fPx8P59Yvdob=fTJq2npU7zCrc-Vee-Hy06uiQA@mail.gmail.com>
References: <CAKa5cDLeMX6fPx8P59Yvdob=fTJq2npU7zCrc-Vee-Hy06uiQA@mail.gmail.com>
Message-ID: <c9fc736f-48e4-f0d9-9c97-aad7d83d9001@spatialys.com>


Le 13/10/2021 ? 18:35, Eric Robeck a ?crit?:
> I have a question about which GeoTIFF tags should be used for storing 
> CRS information. I have two GeoTIFFs: one original and the same file 
> saved as a COG. Then I created gdalinfo and listgeo reports for each 
> and compared them for changes.
>
> *gdalinfo*: Aside from the difference in the PROJCRS?citation ("WGS 84 
> / UTM zone 6N" vs. "WGS_84_UTM_zone_6N"), the only change is the COG 
> and LZW predictor.
>
> *listgeo*: a large number of GeoTags were never populated by the 
> original GeoTIFF creators. Other ASCII citation values were replaced 
> by the Esri conversion tool.
>
> A number of the listgeo-reported GeoKeys in the COG (e.g. 
> GeogGeodeticDatumGeoKey, GeogAngularUnitSizeGeoKey, 
> GeogEllipsoidGeoKey, etc.) are missing from the custom-made original 
> GeoTIFF. The extra CRS tags were added upon conversion to COG. Those 
> parameters are fundamental components of the CRS and are reported in 
> the gdalinfo WKT as DATUM/ELLIPSOID, ANGLEUNIT, etc.
>
> However, the WKT reported by gdalinfo is identical in both cases. So 
> it had access to the full WKT components even when the corresponding 
> GeoKeys were missing in the GeoTIFF.
>
> My questions are:
>
>  1. If the GeoKeys storing that information are missing from the
>     GeoTIFF, where does GDAL retrieve them from? Does it refer to the
>     PROJ library to retrieve the EPSG values for the EPSG codes in
>     ProjectedCSTypeGeoKey, VerticalCSTypeGeoKey, etc.?
>
Yes, GDAL / libgeotiff uses the EPSG codes of the geokeys that contain 
some to build its CRS object by querying the PROJ database. If you've a 
ProjectedCSTypeGeoKey, then the geokeys describing the linear unit, the 
geographic CRS, datum, etc are useless. When outputing GeoTIFF 1.0, GDAL 
will write a bit more than needed. This has been restricted to the 
minimum set to avoid any contradiction when using GeoTIFF 1.1 output. 
GeoTIFF 1.0 is the default when no vertical information is available. 
GeoTIFF 1.1 when there's one. This can be controlled with the 
GEOTIFF_VERSION creation option.
>
>  1. Some software, following guidance in DGIWG-108 and DGIWG-250, did
>     not assign a VerticalDatumGeoKey. Prior to release of GeoTIFF 1.1,
>     the "unknown" value caused problems with vertical projection in
>     some software, like QT Modeler. Does GDAL now fill in or assume
>     the missing key based on the VerticalCSTypeGeoKey?
>
If VerticalCSTypeGeoKey is present and the GeoTIFF version 1.0, GDAL 
will use its rather complex heuristics to try to guess a vertical CRS, 
but will not reoprt it by default unless you define the 
GTIFF_REPORT_COMPD_CS=YES configuration option 
(https://gdal.org/drivers/raster/gtiff.html#configuration-options)

If the file is GeoTIFF 1.1, it will report the vertical information by 
default, when present in the file.

Even

||

> Thanks in advance!
>
> Regards,
> Eric
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/53aed04a/attachment.html>

From Matt.Wilkie at yukon.ca  Wed Oct 13 16:39:01 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Wed, 13 Oct 2021 23:39:01 +0000
Subject: [gdal-dev] Python gdal.Translate(...) and unicode in Band
 Descriptions.
Message-ID: <d578fa100fcd45379eb14f2b5cb13161@yukon.ca>

Hi,

The attached python script that reads from a vendor?s SPOT6 distribution archive and creates a cloud optimized geotiff. Reading and writing works, but the band description does not take properly.

Problem 1: The greek letter Mu or Micron<https://theasciicode.com.ar/extended-ascii-code/lowercase-letter-mu-micro-sign-micron-ascii-code-230.html> in description is converted to something else.

In:           Near-Infrared (0.760 ?m ? 0.890 ?m)
Gdalinfo:             Near-Infrared (0.760 ??m ??? 0.890 ??m)

I?m quite sure I?ve seen geotiff descriptions using the micron character before. It was seeing someone else do that the gave me the idea to do the same with our data. Maybe they weren?t using gdal though?

Problem 2: on close it?s trying to update the source. This fails because the source is zipped, which is good because we want to leave the source untouched. However I don?t want to rely on this to keep our house in order. What is the proper way to do this?

Example script run:

$ spot-zip-to-preview process-list-sample.csv preview 2048
/vsizip/A:\Imagery\Work\SPOT-raw\DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790.zip/DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790/PROD_SPOT6_001/VOL_SPOT6_001_A/IMG_SPOT6_MS_001_A/DIM_SPOT6_MS_202008182031259_SEN_1.XML
0.10..20...50..81..100Warning 6: driver COG does not support creation option PHOTOMETRIC
Warning 1: Unable to save auxiliary information in /vsizip/A:\Imagery\Work\SPOT-raw\DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790.zip/DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790/PROD_SPOT6_001/VOL_SPOT6_001_A/IMG_SPOT6_MS_001_A/DIM_SPOT6_MS_202008182031259_SEN_1.XML.aux.xml.

The relevant part of the script:

data_in = gdal.Open(vsipath)
#print(data_in.GetMetadata())

if "_MS_" in ds:
    data_in.GetRasterBand(1).SetColorInterpretation(gdal.GCI_RedBand)
    data_in.GetRasterBand(1).SetDescription("Red (0.625 ?m ? 0.695 ?m)")
    data_in.GetRasterBand(2).SetColorInterpretation(gdal.GCI_GreenBand)
    data_in.GetRasterBand(2).SetDescription("Green (0.530 ?m ? 0.590 ?m)")
    data_in.GetRasterBand(3).SetColorInterpretation(gdal.GCI_BlueBand)
    data_in.GetRasterBand(3).SetDescription("Blue (0.455 ?m ? 0.525 ?m)")
    #data_in.GetRasterBand(4).SetColorInterpretation("Gray")
    data_in.GetRasterBand(3).SetDescription("Near-Infrared (0.760 ?m ? 0.890 ?m)")
if "_P_" in ds:
    #data_in.GetRasterBand(1).SetColorInterpretation("Gray")
    data_in.GetRasterBand(1).SetDescription("Panchromatic")

gdal.Translate(dstname, vsipath, width=w, height=h,
    format="COG",
    noData=0,
    creationOptions=options,
    callback=progress_cb,
    callback_data='.')


Thanks in advance for your thoughts.

Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca<http://yukon.ca/>
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/ae1754ae/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SPOT-zip-to-preview.zip
Type: application/x-zip-compressed
Size: 2089 bytes
Desc: SPOT-zip-to-preview.zip
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/ae1754ae/attachment-0001.bin>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: result-info.txt
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211013/ae1754ae/attachment-0001.txt>

From senhor.neto at gmail.com  Wed Oct 13 17:25:51 2021
From: senhor.neto at gmail.com (Alexandre Neto)
Date: Thu, 14 Oct 2021 01:25:51 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChs=AeoYPDT_dbCyxVu4fQzn2vgxTrRC664=SYezXctXaw@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
 <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChuz_HE5-B5Ek+aXGoRsHZgDF6rW62ug-CfQmvMrb8wegQ@mail.gmail.com>
 <CAMCJChs=AeoYPDT_dbCyxVu4fQzn2vgxTrRC664=SYezXctXaw@mail.gmail.com>
Message-ID: <CA+H0G_Hqqb8bWdUKJ=ah2Kchd19hVgbHTrpKAWhDqU24fGPCZg@mail.gmail.com>

Hi pedro,

Are you sure you are not mixing conda channels? Normally, in the same
environment, you should stick to a single channel to avoid dependency
problems.

I also noticed that you are using anaconda. I suggest you use miniconda
instead. It comes with the bare minimal tools to install and manage the
packages you explicitly want, instead of installating Gb of packages that
unless you know them, you will never use.

Alexandre Neto

A quarta, 13/10/2021, 17:16, Pedro Ven?ncio <pedrongvenancio at gmail.com>
escreveu:

> I will ask on GDAL conda-forge, maybe this can be some packaging problem.
>
> Thanks!
>
>
> Pedro Ven?ncio <pedrongvenancio at gmail.com> escreveu no dia quarta,
> 13/10/2021 ?(s) 17:00:
>
>> Tried to define several environment variables, but nothing seems to work
>>
>> [image: env_win10.jpg]
>>
>>
>> Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
>> 13/10/2021 ?(s) 16:23:
>>
>>> N?o Pedro,
>>>
>>>
>>>
>>> When I look into my own build of the gdall dll I see no dependency on
>>> that ?opj_encoder_set_extra_options? but likely because it?s a different
>>> version (I build from master).
>>>
>>>
>>>
>>> From my experience on this there is really nothing one can do other than
>>> rebuild the dll or replace the dependency that is missing the required
>>> symbol. Nothing we can do from a conda installation.
>>>
>>>
>>>
>>> But ofc my analysis may be all wrong.
>>>
>>>
>>>
>>> Joaquim
>>>
>>>
>>>
>>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Pedro
>>> Ven?ncio
>>> *Sent:* Wednesday, October 13, 2021 4:04 PM
>>> *To:* gdal-dev at lists.osgeo.org
>>> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on
>>> Anaconda - DLL load failed
>>>
>>>
>>>
>>> Hi Joaquim,
>>>
>>>
>>>
>>> Thanks for sharing your case. Did you manage to make it work in some way?
>>>
>>>
>>>
>>> I've already uninstalled a test PostgreSQL/PostGIS that I supposed to be
>>> the source of the conflict, but I keep having the same error.
>>>
>>>
>>>
>>> I also reinstalled conda, but nothing had changed.
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
>>> 13/10/2021 ?(s) 15:24:
>>>
>>> Hi,
>>>
>>>
>>>
>>> I have a certain horror to python (that I?m trying to fight) a bit of it
>>> is because I never manage to really use it.
>>>
>>>
>>>
>>> I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I
>>> removed and installed a new one in which I tried Pedro?s case and got
>>> exactly the same errors.
>>>
>>>
>>>
>>> I then run a dependency analysis from within the conda shell and found
>>> two weird things
>>>
>>>
>>>
>>>    1. The gdal dll depends on a xerces-c_3_2.dll locate at
>>>    C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but
>>>    seems to not cause any problem in this case.
>>>    2. There is a ?red mark? on the opj_encoder_set_extra_options symbol
>>>    and this alone can explain the ?ImportError: DLL load failed while
>>>    importing _gdal: The specified procedure could not be found.?
>>>
>>>
>>>
>>> Hopefully the screen capture is small enough to get through.
>>>
>>>
>>>
>>> Joaquim
>>>
>>>
>>>
>>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Even
>>> Rouault
>>> *Sent:* Wednesday, October 13, 2021 2:39 PM
>>> *To:* Pedro Ven?ncio <pedrongvenancio at gmail.com>
>>> *Cc:* gdal-dev at lists.osgeo.org
>>> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on
>>> Anaconda - DLL load failed
>>>
>>>
>>>
>>> ok, so now you have to inspect the PATH and fix it so that the gdal DLL
>>> and its dependencies are in it. But all of this sounds like there's
>>> something weird in your environment. Perhaps a mix of GDAL versions?
>>>
>>> Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :
>>>
>>> Can you change in __init__.py
>>>
>>>                 try:
>>>                     os.add_dll_directory(p)
>>>                 except FileNotFoundError:
>>>                     continue
>>>
>>>
>>>
>>> to
>>>
>>>                 try:
>>>                     os.add_dll_directory(p)
>>>                 except (FileNotFoundError, OSError):
>>>                     continue
>>>
>>>
>>>
>>> Yes, here is the output:
>>>
>>> Traceback (most recent call last):
>>>
>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper
>>>
>>>     return importlib.import_module(mname)
>>>
>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>>>
>>>     return _bootstrap._gcd_import(name[level:], package, level)
>>>
>>>   File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
>>>
>>>   File "<frozen importlib._bootstrap>", line 991, in _find_and_load
>>>
>>>   File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
>>>
>>>   File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
>>>
>>>   File "<frozen importlib._bootstrap>", line 556, in module_from_spec
>>>
>>>   File "<frozen importlib._bootstrap_external>", line 1166, in create_module
>>>
>>>   File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
>>>
>>> ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.
>>>
>>>
>>>
>>> During handling of the above exception, another exception occurred:
>>>
>>>
>>>
>>> Traceback (most recent call last):
>>>
>>>   File "demo.py", line 1, in <module>
>>>
>>>     from osgeo import gdal
>>>
>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>
>>>
>>>     _gdal = swig_import_helper()
>>>
>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper
>>>
>>>     return importlib.import_module('_gdal')
>>>
>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>>>
>>>     return _bootstrap._gcd_import(name[level:], package, level)
>>>
>>> ModuleNotFoundError: No module named '_gdal'
>>>
>>>
>>>
>>> --
>>>
>>> http://www.spatialys.com
>>>
>>> My software is free, but my time generally not.
>>>
>>> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/91484d91/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: env_win10.jpg
Type: image/jpeg
Size: 33695 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/91484d91/attachment-0001.jpg>

From ni_hao88 at hotmail.com  Thu Oct 14 07:57:38 2021
From: ni_hao88 at hotmail.com (ni hao)
Date: Thu, 14 Oct 2021 14:57:38 +0000
Subject: [gdal-dev] polygon union
Message-ID: <DM5PR02MB3862C1436171BB1253EEAF81F1B89@DM5PR02MB3862.namprd02.prod.outlook.com>

Hi list,

I know how to union two polygons using Python's ogr.
  feat = ogr.Feature(lyr.GetLayerDefn())
  feat.SetGeometry(collection1.Union(collection2))

But I need to do this in Java or use a command line exe, and I am not familiar with Java.
What is the Java function or a command line exe ?

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/6e9cb548/attachment.html>

From Matt.Wilkie at yukon.ca  Thu Oct 14 08:54:20 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Thu, 14 Oct 2021 15:54:20 +0000
Subject: [gdal-dev] Enabling default compression for COG ?
In-Reply-To: <fa605624-b2cc-742b-f884-f577059e341f@spatialys.com>
References: <fa605624-b2cc-742b-f884-f577059e341f@spatialys.com>
Message-ID: <98986d51b9c84167978429f2678f7144@yukon.ca>

 +1 from me. I think it's a great idea.

-Matt

From Matt.Wilkie at yukon.ca  Thu Oct 14 09:03:29 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Thu, 14 Oct 2021 16:03:29 +0000
Subject: [gdal-dev] Gdal-dev mail archive search sites?
Message-ID: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>

Hi All,

Now that the gdal mail archive on Nabble is gone is what options are there for searching through historical threads?

Thanks!

Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca<http://yukon.ca/>
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/1b60e8fc/attachment.html>

From jmckenna at gatewaygeomatics.com  Thu Oct 14 09:28:23 2021
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Thu, 14 Oct 2021 13:28:23 -0300
Subject: [gdal-dev] Gdal-dev mail archive search sites?
In-Reply-To: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
References: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
Message-ID: <ef741efb-5c50-2e57-d0fa-d5351c86e34c@gatewaygeomatics.com>

Hi Matt!

I just use Google search to query the archives:
- goto https://google.ca
- in the search box enter:    site:lists.osgeo.org/pipermail/gdal-dev/ 
yoursearchterm

This may not always contain the latest archives (depending on the speed 
of Google-mothership bots), but I find it very helpful.

-jeff




-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/


On 2021-10-14 1:03 p.m., Matt.Wilkie at yukon.ca wrote:
> Hi All,
> 
> Now that the gdal mail archive on Nabble is gone is what options are 
> there for searching through historical threads?
> 
> Thanks!
> 
> *Matt Wilkie*
> 
> Geomatics Developer & Administrator
> 
> Environment | Technology, Innovation and Mapping
> 
> T 867-667-8133 | _Yukon.ca <http://yukon.ca/>_
> 
> /Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away./
> 
> 

From andrew at aitchison.me.uk  Thu Oct 14 09:24:30 2021
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Thu, 14 Oct 2021 17:24:30 +0100 (BST)
Subject: [gdal-dev] Gdal-dev mail archive search sites?
In-Reply-To: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
References: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
Message-ID: <414d984c-f0b9-668b-6abf-9c23d3a64f4b@aitchison.me.uk>

On Thu, 14 Oct 2021, Matt.Wilkie at yukon.ca wrote:

> Hi All,
>
> Now that the gdal mail archive on Nabble is gone is what options
> are there for searching through historical threads?

There is an archgive at
 	https://lists.osgeo.org/pipermail/gdal-dev/
(every mail to the list has
 	https://lists.osgeo.org/mailman/listinfo/gdal-dev
in the footer and the achives is linked from there)
but it isn't very searchable.

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From Matt.Wilkie at yukon.ca  Thu Oct 14 10:10:59 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Thu, 14 Oct 2021 17:10:59 +0000
Subject: [gdal-dev] Gdal-dev mail archive search sites?
In-Reply-To: <ef741efb-5c50-2e57-d0fa-d5351c86e34c@gatewaygeomatics.com>
References: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
 <ef741efb-5c50-2e57-d0fa-d5351c86e34c@gatewaygeomatics.com>
Message-ID: <5d3878cb11a94861abdb0d8b3d8379fc@yukon.ca>

Thanks Jeff!

Here's a bookmarkable link that pre-arms the search box:

https://www.google.ca/search?q=site:lists.osgeo.org/pipermail/gdal-dev/ 

-Matt


-----Original Message-----
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Jeff McKenna
Sent: October 14, 2021 9:28 AM
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Gdal-dev mail archive search sites?

Hi Matt!

I just use Google search to query the archives:
- goto https://google.ca
- in the search box enter:    site:lists.osgeo.org/pipermail/gdal-dev/ 
yoursearchterm

This may not always contain the latest archives (depending on the speed of Google-mothership bots), but I find it very helpful.

-jeff




--
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training co-founder of FOSS4G http://gatewaygeo.com/


On 2021-10-14 1:03 p.m., Matt.Wilkie at yukon.ca wrote:
> Hi All,
> 
> Now that the gdal mail archive on Nabble is gone is what options are 
> there for searching through historical threads?
> 
> Thanks!
> 
> *Matt Wilkie*
> 
> Geomatics Developer & Administrator
> 
> Environment | Technology, Innovation and Mapping
> 
> T 867-667-8133 | _Yukon.ca <http://yukon.ca/>_
> 
> /Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away./
> 
> 
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev


From Matt.Wilkie at yukon.ca  Thu Oct 14 11:23:21 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Thu, 14 Oct 2021 18:23:21 +0000
Subject: [gdal-dev] Python gdal.Translate(...) and unicode in Band
 Descriptions.
In-Reply-To: <4fd6f98045254fbca7c0839ae5629c11@yukon.ca>
References: <d578fa100fcd45379eb14f2b5cb13161@yukon.ca>
 <4fd6f98045254fbca7c0839ae5629c11@yukon.ca>
Message-ID: <1f5d731fa2c9483897e30d6a6f72f07e@yukon.ca>

Re: Problem 1 - Following a thread ?Unicode support in GDAL?[0] I tried adding ?ENCODING=UTF-8? but the COG driver doesn?t support it. So I?ve taken the practical route out of just spelling out micron instead of using the symbol.

For Problem 2 there?s a new wrinkle: in spite of the warning about being unable to save the .aux.xml info into the source zip sometimes it actually does. I haven?t sorted out when it can and can?t yet.

[0]: https://lists.osgeo.org/pipermail/gdal-dev/2021-August/054500.html

-Matt

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> On Behalf Of Matt.Wilkie at yukon.ca<mailto:Matt.Wilkie at yukon.ca>
Sent: October 13, 2021 4:39 PM
To: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] Python gdal.Translate(...) and unicode in Band Descriptions.

Hi,

The attached python script that reads from a vendor?s SPOT6 distribution archive and creates a cloud optimized geotiff. Reading and writing works, but the band description does not take properly.

Problem 1: The greek letter Mu or Micron<https://theasciicode.com.ar/extended-ascii-code/lowercase-letter-mu-micro-sign-micron-ascii-code-230.html> in description is converted to something else.

In: Near-Infrared (0.760 ?m ? 0.890 ?m)
Gdalinfo: Near-Infrared (0.760 ??m ??? 0.890 ??m)

I?m quite sure I?ve seen geotiff descriptions using the micron character before. It was seeing someone else do that the gave me the idea to do the same with our data. Maybe they weren?t using gdal though?

Problem 2: on close it?s trying to update the source. This fails because the source is zipped, which is good because we want to leave the source untouched. However I don?t want to rely on this to keep our house in order. What is the proper way to do this?

Example script run:

$ spot-zip-to-preview process-list-sample.csv preview 2048
/vsizip/A:\Imagery\Work\SPOT-raw\DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790.zip/DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790/PROD_SPOT6_001/VOL_SPOT6_001_A/IMG_SPOT6_MS_001_A/DIM_SPOT6_MS_202008182031259_SEN_1.XML
0.10..20...50..81..100Warning 6: driver COG does not support creation option PHOTOMETRIC
Warning 1: Unable to save auxiliary information in /vsizip/A:\Imagery\Work\SPOT-raw\DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790.zip/DS_SPOT6_202008182031259_LM1_LM1_LM1_LM1_W137N63_01790/PROD_SPOT6_001/VOL_SPOT6_001_A/IMG_SPOT6_MS_001_A/DIM_SPOT6_MS_202008182031259_SEN_1.XML.aux.xml.

The relevant part of the script:

data_in = gdal.Open(vsipath)
#print(data_in.GetMetadata())

if "_MS_" in ds:
data_in.GetRasterBand(1).SetColorInterpretation(gdal.GCI_RedBand)
data_in.GetRasterBand(1).SetDescription("Red (0.625 ?m ? 0.695 ?m)")
data_in.GetRasterBand(2).SetColorInterpretation(gdal.GCI_GreenBand)
data_in.GetRasterBand(2).SetDescription("Green (0.530 ?m ? 0.590 ?m)")
data_in.GetRasterBand(3).SetColorInterpretation(gdal.GCI_BlueBand)
data_in.GetRasterBand(3).SetDescription("Blue (0.455 ?m ? 0.525 ?m)")
#data_in.GetRasterBand(4).SetColorInterpretation("Gray")
data_in.GetRasterBand(3).SetDescription("Near-Infrared (0.760 ?m ? 0.890 ?m)")
if "_P_" in ds:
#data_in.GetRasterBand(1).SetColorInterpretation("Gray")
data_in.GetRasterBand(1).SetDescription("Panchromatic")

gdal.Translate(dstname, vsipath, width=w, height=h,
format="COG",
noData=0,
creationOptions=options,
callback=progress_cb,
callback_data='.')


Thanks in advance for your thoughts.

Matt Wilkie
Geomatics Developer & Administrator
Environment | Technology, Innovation and Mapping
T 867-667-8133 | Yukon.ca<http://yukon.ca/>
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/62d4f2e7/attachment-0001.html>

From Matt.Wilkie at yukon.ca  Thu Oct 14 11:45:37 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Thu, 14 Oct 2021 18:45:37 +0000
Subject: [gdal-dev] Python gdal.Translate(...) and unicode in Band
 Descriptions.
In-Reply-To: <69ec35b5ba0541db9db7a260c7922351@yukon.ca>
References: <d578fa100fcd45379eb14f2b5cb13161@yukon.ca>
 <4fd6f98045254fbca7c0839ae5629c11@yukon.ca>
 <69ec35b5ba0541db9db7a260c7922351@yukon.ca>
Message-ID: <5a6a9fe2119746a5bb557a4f3ce4c5e0@yukon.ca>

> For Problem 2 there?s a new wrinkle: in spite of the warning about being 
> unable to save the .aux.xml info into the source zip sometimes it actually 
> does. I haven?t sorted out when it can and can?t yet.

Solved it: the first time the script is run it saves the Color Interp and Descriptions in the .aux.xml within the zip, and the output image remains Undefined for these fields. In subsequent runs saving the aux fails, and the output image fields for Color Interp and Description are filled out. As I've been using the same input archive repeatedly while testing this sequence was being masked.

So now I'm at the crux I think: how to tell gdal.Translate() to use these metadata without applying them to `data_in.GetRasterBand(1)` and saving first?

Is there a more efficient method than:

~~~
data_in = gdal.Open(vsipath)
gdal.Translate(dstname, vsipath, width=w, height=h, ...)

data_out = gdal.Open(dstname)
    data_out.GetRasterBand(1).SetColorInterpretation(gdal.GCI_RedBand)
    data_out.GetRasterBand(1).SetDescription("Red (0.625 - 0.695 microns)")
    ...

data_in = None
data_out = None
~~~


Matt
Geomatics Developer and Administrator | Environment | T 867-667-8133 | Yukon.ca
Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.



From jluis at ualg.pt  Thu Oct 14 12:03:49 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Thu, 14 Oct 2021 19:03:49 +0000
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
Message-ID: <VI1PR04MB3966C7D9352FE47FE5F07EA2A6B89@VI1PR04MB3966.eurprd04.prod.outlook.com>

Even,

There are some issues with this way.

My draft Julia function looks like bellow  (tested with a MxNx7 array) but get this errors

julia> GMT.write_multiband(cube, "gd_cube.nc")
Warning 1: No 1D variable is indexed by dimension time
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
ERROR 1: netcdf error #-45 : NetCDF: Not a valid data type or _FillValue type mismatch .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,netCDFDataset::CreateCopy,9012)

ERROR 1: netcdf error #-49 : NetCDF: Variable not found .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,NCDFPutAttr,10454)

Warning 1: No 1D variable is indexed by dimension time

And indeed the "time" variable shows up filled with 7 zeros when I open the nc file that is nevertheless created.
Also checked with getmetadataitem(ds, "NETCDF_DIM_time_VALUES")  that the "1,2,3,4,5,6,7" info was correctly set.

I's also strange the warnings about the "-co" options also because they were in fact taken into account. Omitting them creates a classic nc file.


function write_multiband(cube, fname::AbstractString, v=nothing; dim_name::String="time")
               nbands = size(cube,3)
               ds = gmt2gd(cube)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", dim_name)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_DEF", "$(nbands),6")
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_VALUES", "1,2,3,4,5,6,7")
               Gdal.setmetadataitem(ds, dim_name * "#axis", string(dim_name[1]))
               crs = Gdal.getproj(cube, wkt=true)
               (crs != "" ) && Gdal.setproj!(ds, crs)
               Gdal.unsafe_copy(ds, filename=fname, driver=getdriver("netCDF"), options=["-co", "FORMAT=NC4", "-co", "COMPRESS=DEFLATE", "-co", "ZLEVEL=4"])
end

From: Even Rouault <even.rouault at spatialys.com>
Sent: Sunday, October 10, 2021 10:48 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets


Joaquim,

https://github.com/OSGeo/gdal/pull/4634 should hopefully help

Even
Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

I have a Julia version of gdal_translate (that ends up calling GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not the way I wanted.
It creates a multi-subdatasets file, whilst what I wished is to write a multi-band file.

For example, the file written with this Julia function looks like below

How can I write a multi-band instead of a multi-datasets?
I've been looking at the docs of GDALDatasetRasterIOEx but can't see any way of picking one or the other.

Joaquim

gdalinfo cube_rad.nc
Driver: netCDF/Network Common Data Format
Files: cube_rad.nc
Size is 512, 512
Metadata:
  NC_GLOBAL#Conventions=CF-1.5
  NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
  NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy( cube_rad.nc, ... )
Subdatasets:
  SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
  SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
  SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
  SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
...

Saving the same data (or similar) from a Matlab code that I wrote long ago to stack grids, shows

gdalinfo evi_cube.nc
Driver: netCDF/Network Common Data Format
Files: evi_cube.nc
Size is 37, 59
Origin = (580140.000000000000000,4418550.000000000000000)
Pixel Size = (30.000000000000000,-30.000000000000000)
Metadata:
...
  latitude#actual_range={4416795,4418535}
  latitude#long_name=latitude
  latitude#units=degrees_north
  longitude#actual_range={580155,581235}
  longitude#long_name=longitude
  longitude#units=degrees_east
  NC_GLOBAL#Conventions=COARDS
  NC_GLOBAL#description=File written from Matlab
  NC_GLOBAL#node_offset=0
  NC_GLOBAL#Source_Software=Mirone
  NC_GLOBAL#title=Grid created by Mirone
  NETCDF_DIM_EXTRA={time}
  NETCDF_DIM_time_DEF={67,6}
  NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
  z#actual_range={-856.4703369140625,176.8457641601562}
  z#long_name=z
  z#units=unknown
  z#_FillValue=-nan(ind)
Corner Coordinates:
Upper Left  (  580140.000, 4418550.000)
Lower Left  (  580140.000, 4416780.000)
Upper Right (  581250.000, 4418550.000)
Lower Right (  581250.000, 4416780.000)
Center      (  580695.000, 4417665.000)
Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=1
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=2
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
...



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/dc778234/attachment-0001.html>

From even.rouault at spatialys.com  Thu Oct 14 12:10:39 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 14 Oct 2021 21:10:39 +0200
Subject: [gdal-dev] Python gdal.Translate(...) and unicode in Band
 Descriptions.
In-Reply-To: <5a6a9fe2119746a5bb557a4f3ce4c5e0@yukon.ca>
References: <d578fa100fcd45379eb14f2b5cb13161@yukon.ca>
 <4fd6f98045254fbca7c0839ae5629c11@yukon.ca>
 <69ec35b5ba0541db9db7a260c7922351@yukon.ca>
 <5a6a9fe2119746a5bb557a4f3ce4c5e0@yukon.ca>
Message-ID: <38c29e7a-972c-5d62-3cfe-2d14925d6b94@spatialys.com>

you could do something along:

tmp_vrt = gdal.Translate("", src_ds, format = 'VRT')

call SetColorInterpretation() / SetDescription() on tmp_vrt

gdal.Translate(dstname, tmp_vrt, format = 'COG', ...)


Le 14/10/2021 ? 20:45, Matt.Wilkie at yukon.ca a ?crit?:
>> For Problem 2 there?s a new wrinkle: in spite of the warning about being
>> unable to save the .aux.xml info into the source zip sometimes it actually
>> does. I haven?t sorted out when it can and can?t yet.
> Solved it: the first time the script is run it saves the Color Interp and Descriptions in the .aux.xml within the zip, and the output image remains Undefined for these fields. In subsequent runs saving the aux fails, and the output image fields for Color Interp and Description are filled out. As I've been using the same input archive repeatedly while testing this sequence was being masked.
>
> So now I'm at the crux I think: how to tell gdal.Translate() to use these metadata without applying them to `data_in.GetRasterBand(1)` and saving first?
>
> Is there a more efficient method than:
>
> ~~~
> data_in = gdal.Open(vsipath)
> gdal.Translate(dstname, vsipath, width=w, height=h, ...)
>
> data_out = gdal.Open(dstname)
>      data_out.GetRasterBand(1).SetColorInterpretation(gdal.GCI_RedBand)
>      data_out.GetRasterBand(1).SetDescription("Red (0.625 - 0.695 microns)")
>      ...
>
> data_in = None
> data_out = None
> ~~~
>
>
> Matt
> Geomatics Developer and Administrator | Environment | T 867-667-8133 | Yukon.ca
> Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Oct 14 12:14:21 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 14 Oct 2021 21:14:21 +0200
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <VI1PR04MB3966C7D9352FE47FE5F07EA2A6B89@VI1PR04MB3966.eurprd04.prod.outlook.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
 <VI1PR04MB3966C7D9352FE47FE5F07EA2A6B89@VI1PR04MB3966.eurprd04.prod.outlook.com>
Message-ID: <1f81610a-d663-5cdc-4a44-9a6dd0508224@spatialys.com>


Le 14/10/2021 ? 21:03, Joaquim Manuel Freire Lu?s a ?crit?:
>
> Even,
>
> There are some issues with this way.
>
> My draft Julia function looks like bellow ?(tested with a MxNx7 array) 
> but get this errors
>
> julia> GMT.write_multiband(cube, "gd_cube.nc")
>
> Warning 1: No 1D variable is indexed by dimension time
>
> Warning 6: creation option '-co' is not formatted with the key=value 
> format
>
> Warning 6: creation option '-co' is not formatted with the key=value 
> format
>
> Warning 6: creation option '-co' is not formatted with the key=value 
> format
>
I don't know the Julia bindings, but the error message seems to suggest 
you can remove the "-co" element in your options[] array since it 
presumably must only contain the "key=value" creation options, like in 
the Python bindings
>
> ERROR 1: netcdf error #-45 : NetCDF: Not a valid data type or 
> _FillValue type mismatch .
>
> at 
> (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,netCDFDataset::CreateCopy,9012)
>
> ERROR 1: netcdf error #-49 : NetCDF: Variable not found .
>
> at 
> (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,NCDFPutAttr,10454)
>
> Warning 1: No 1D variable is indexed by dimension time
>
> And indeed the ?time? variable shows up filled with 7 zeros when I 
> open the nc file that is nevertheless created.
>
> Also checked with getmetadataitem(ds, "NETCDF_DIM_time_VALUES")? that 
> the "1,2,3,4,5,6,7" info was correctly set.
>
You need to surround the values of the _DEF and _VALUES items with { and 
} braces to indicate this is a list (this is the particular syntax 
expected by the netCDF driver)
>
> I?s also strange the warnings about the ?-co? options also because 
> they were in fact taken into account. Omitting them creates a classic 
> nc file.
>
> function write_multiband(cube, fname::AbstractString, v=nothing; 
> dim_name::String="time")
>
> ?????????????? nbands = size(cube,3)
>
> ?????????????? ds = gmt2gd(cube)
>
> Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", dim_name)
>
> ?????????????? Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * 
> "_DEF", "$(nbands),6")
>
> Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_VALUES", 
> "1,2,3,4,5,6,7")
>
> Gdal.setmetadataitem(ds, dim_name * "#axis", string(dim_name[1]))
>
> ?????????????? crs = Gdal.getproj(cube, wkt=true)
>
> ?????????????? (crs != "" ) && Gdal.setproj!(ds, crs)
>
> Gdal.unsafe_copy(ds, filename=fname, driver=getdriver("netCDF"), 
> options=["-co", "FORMAT=NC4", "-co", "COMPRESS=DEFLATE", "-co", 
> "ZLEVEL=4"])
>
> end
>
> *From:*Even Rouault <even.rouault at spatialys.com>
> *Sent:* Sunday, October 10, 2021 10:48 PM
> *To:* Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
> *Subject:* Re: [gdal-dev] Writing multi-bands vs multi-datasets
>
> Joaquim,
>
> https://github.com/OSGeo/gdal/pull/4634 
> <https://github.com/OSGeo/gdal/pull/4634> should hopefully help
>
> Even
>
> Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit?:
>
>     Hi,
>
>     I have a Julia version of gdal_translate (that ends up calling
>     GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not
>     the way I wanted.
>
>     It creates a multi-subdatasets file, whilst what I wished is to
>     write a multi-band file.
>
>     For example, the file written with this Julia function looks like
>     below
>
>     How can I write a multi-band instead of a multi-datasets?
>
>     I?ve been looking at the docs of GDALDatasetRasterIOEx but can?t
>     see any way of picking one or the other.
>
>     Joaquim
>
>     gdalinfo cube_rad.nc
>
>     Driver: netCDF/Network Common Data Format
>
>     Files: cube_rad.nc
>
>     Size is 512, 512
>
>     Metadata:
>
>     NC_GLOBAL#Conventions=CF-1.5
>
>     ? NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
>
>     NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy(
>     cube_rad.nc, ... )
>
>     Subdatasets:
>
>     SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
>
>     SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
>
>     SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
>
>     SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
>
>     ?
>
>     Saving the same data (or similar) from a Matlab code that I wrote
>     long ago to stack grids, shows
>
>     gdalinfo evi_cube.nc
>
>     Driver: netCDF/Network Common Data Format
>
>     Files: evi_cube.nc
>
>     Size is 37, 59
>
>     Origin = (580140.000000000000000,4418550.000000000000000)
>
>     Pixel Size = (30.000000000000000,-30.000000000000000)
>
>     Metadata:
>
>     ?
>
>     latitude#actual_range={4416795,4418535}
>
>     latitude#long_name=latitude
>
>     latitude#units=degrees_north
>
>     longitude#actual_range={580155,581235}
>
>     longitude#long_name=longitude
>
>     longitude#units=degrees_east
>
>     NC_GLOBAL#Conventions=COARDS
>
>     NC_GLOBAL#description=File written from Matlab
>
>     NC_GLOBAL#node_offset=0
>
>     NC_GLOBAL#Source_Software=Mirone
>
>     ? NC_GLOBAL#title=Grid created by Mirone
>
>     NETCDF_DIM_EXTRA={time}
>
>     NETCDF_DIM_time_DEF={67,6}
>
>     NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
>
>     z#actual_range={-856.4703369140625,176.8457641601562}
>
>     ? z#long_name=z
>
>     ? z#units=unknown
>
>     z#_FillValue=-nan(ind)
>
>     Corner Coordinates:
>
>     Upper Left? ( 580140.000, 4418550.000)
>
>     Lower Left? ( 580140.000, 4416780.000)
>
>     Upper Right ( 581250.000, 4418550.000)
>
>     Lower Right ( 581250.000, 4416780.000)
>
>     Center????? ( 580695.000, 4417665.000)
>
>     Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
>
>     ? NoData Value=nan
>
>     ? Unit Type: unknown
>
>     ? Metadata:
>
>     actual_range={-856.4703369140625,176.8457641601562}
>
>     ??? long_name=z
>
>     ??? NETCDF_DIM_time=1
>
>     ??? NETCDF_VARNAME=z
>
>     ??? units=unknown
>
>     _FillValue=-nan(ind)
>
>     Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
>
>     ? NoData Value=nan
>
>     ? Unit Type: unknown
>
>     ? Metadata:
>
>     actual_range={-856.4703369140625,176.8457641601562}
>
>     ??? long_name=z
>
>     ??? NETCDF_DIM_time=2
>
>     ??? NETCDF_VARNAME=z
>
>     ??? units=unknown
>
>     _FillValue=-nan(ind)
>
>     ?
>
>
>
>     _______________________________________________
>
>     gdal-dev mailing list
>
>     gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev  <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
> -- 
> http://www.spatialys.com  <http://www.spatialys.com>
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/f1d7c6f1/attachment-0001.html>

From jluis at ualg.pt  Thu Oct 14 12:41:36 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Thu, 14 Oct 2021 19:41:36 +0000
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <1f81610a-d663-5cdc-4a44-9a6dd0508224@spatialys.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
 <VI1PR04MB3966C7D9352FE47FE5F07EA2A6B89@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <1f81610a-d663-5cdc-4a44-9a6dd0508224@spatialys.com>
Message-ID: <AM6PR04MB3959839B85D5344916F51606A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>

Much better (I was confused by those curly braces thinking it was part of python syntax).
Though still get this warning

Warning 1: No 1D variable is indexed by dimension time

But otherwise gdalinfo does not complain on anything wrong

The "-co" is confusing. I had to add in other situations otherwise some options were not set.

Julia does not use bindings, it can access the exported functions in shared libraries directly
(if you are curious see https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/
and https://docs.julialang.org/en/v1/base/c/#ccall)
so passing that vector of strings should be translated automatically to a "char *string[]" and GDAL expects the "-co" (I think)

From: Even Rouault <even.rouault at spatialys.com>
Sent: Thursday, October 14, 2021 8:14 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets



Le 14/10/2021 ? 21:03, Joaquim Manuel Freire Lu?s a ?crit :
Even,

There are some issues with this way.

My draft Julia function looks like bellow  (tested with a MxNx7 array) but get this errors

julia> GMT.write_multiband(cube, "gd_cube.nc")
Warning 1: No 1D variable is indexed by dimension time
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
I don't know the Julia bindings, but the error message seems to suggest you can remove the "-co" element in your options[] array since it presumably must only contain the "key=value" creation options, like in the Python bindings

ERROR 1: netcdf error #-45 : NetCDF: Not a valid data type or _FillValue type mismatch .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,netCDFDataset::CreateCopy,9012)

ERROR 1: netcdf error #-49 : NetCDF: Variable not found .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,NCDFPutAttr,10454)

Warning 1: No 1D variable is indexed by dimension time

And indeed the "time" variable shows up filled with 7 zeros when I open the nc file that is nevertheless created.
Also checked with getmetadataitem(ds, "NETCDF_DIM_time_VALUES")  that the "1,2,3,4,5,6,7" info was correctly set.
You need to surround the values of the _DEF and _VALUES items with { and } braces to indicate this is a list (this is the particular syntax expected by the netCDF driver)


I's also strange the warnings about the "-co" options also because they were in fact taken into account. Omitting them creates a classic nc file.


function write_multiband(cube, fname::AbstractString, v=nothing; dim_name::String="time")
               nbands = size(cube,3)
               ds = gmt2gd(cube)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", dim_name)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_DEF", "$(nbands),6")
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_VALUES", "1,2,3,4,5,6,7")
               Gdal.setmetadataitem(ds, dim_name * "#axis", string(dim_name[1]))
               crs = Gdal.getproj(cube, wkt=true)
               (crs != "" ) && Gdal.setproj!(ds, crs)
               Gdal.unsafe_copy(ds, filename=fname, driver=getdriver("netCDF"), options=["-co", "FORMAT=NC4", "-co", "COMPRESS=DEFLATE", "-co", "ZLEVEL=4"])
end

From: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>
Sent: Sunday, October 10, 2021 10:48 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets


Joaquim,

https://github.com/OSGeo/gdal/pull/4634 should hopefully help

Even
Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

I have a Julia version of gdal_translate (that ends up calling GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not the way I wanted.
It creates a multi-subdatasets file, whilst what I wished is to write a multi-band file.

For example, the file written with this Julia function looks like below

How can I write a multi-band instead of a multi-datasets?
I've been looking at the docs of GDALDatasetRasterIOEx but can't see any way of picking one or the other.

Joaquim

gdalinfo cube_rad.nc
Driver: netCDF/Network Common Data Format
Files: cube_rad.nc
Size is 512, 512
Metadata:
  NC_GLOBAL#Conventions=CF-1.5
  NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
  NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy( cube_rad.nc, ... )
Subdatasets:
  SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
  SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
  SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
  SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
...

Saving the same data (or similar) from a Matlab code that I wrote long ago to stack grids, shows

gdalinfo evi_cube.nc
Driver: netCDF/Network Common Data Format
Files: evi_cube.nc
Size is 37, 59
Origin = (580140.000000000000000,4418550.000000000000000)
Pixel Size = (30.000000000000000,-30.000000000000000)
Metadata:
...
  latitude#actual_range={4416795,4418535}
  latitude#long_name=latitude
  latitude#units=degrees_north
  longitude#actual_range={580155,581235}
  longitude#long_name=longitude
  longitude#units=degrees_east
  NC_GLOBAL#Conventions=COARDS
  NC_GLOBAL#description=File written from Matlab
  NC_GLOBAL#node_offset=0
  NC_GLOBAL#Source_Software=Mirone
  NC_GLOBAL#title=Grid created by Mirone
  NETCDF_DIM_EXTRA={time}
  NETCDF_DIM_time_DEF={67,6}
  NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
  z#actual_range={-856.4703369140625,176.8457641601562}
  z#long_name=z
  z#units=unknown
  z#_FillValue=-nan(ind)
Corner Coordinates:
Upper Left  (  580140.000, 4418550.000)
Lower Left  (  580140.000, 4416780.000)
Upper Right (  581250.000, 4418550.000)
Lower Right (  581250.000, 4416780.000)
Center      (  580695.000, 4417665.000)
Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=1
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=2
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
...




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/5a4fd28f/attachment-0001.html>

From jluis at ualg.pt  Thu Oct 14 13:02:42 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Thu, 14 Oct 2021 20:02:42 +0000
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <AM6PR04MB3959839B85D5344916F51606A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
 <VI1PR04MB3966C7D9352FE47FE5F07EA2A6B89@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <1f81610a-d663-5cdc-4a44-9a6dd0508224@spatialys.com>
 <AM6PR04MB3959839B85D5344916F51606A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <AM6PR04MB39591CF8EC931EBC007A2A28A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>

On more. The warning about "No 1D variable is indexed by dimension time" turned out to be because I was calling

Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", "{time}")

(like you call '{time,Z}' in your Python example). Removing the curly braces here made that warning go away.

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Joaquim Manuel Freire Lu?s
Sent: Thursday, October 14, 2021 8:42 PM
To: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets

Much better (I was confused by those curly braces thinking it was part of python syntax).
Though still get this warning

Warning 1: No 1D variable is indexed by dimension time

But otherwise gdalinfo does not complain on anything wrong

The "-co" is confusing. I had to add in other situations otherwise some options were not set.

Julia does not use bindings, it can access the exported functions in shared libraries directly
(if you are curious see https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/
and https://docs.julialang.org/en/v1/base/c/#ccall)
so passing that vector of strings should be translated automatically to a "char *string[]" and GDAL expects the "-co" (I think)

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Thursday, October 14, 2021 8:14 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt<mailto:jluis at ualg.pt>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets



Le 14/10/2021 ? 21:03, Joaquim Manuel Freire Lu?s a ?crit :
Even,

There are some issues with this way.

My draft Julia function looks like bellow  (tested with a MxNx7 array) but get this errors

julia> GMT.write_multiband(cube, "gd_cube.nc")
Warning 1: No 1D variable is indexed by dimension time
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
I don't know the Julia bindings, but the error message seems to suggest you can remove the "-co" element in your options[] array since it presumably must only contain the "key=value" creation options, like in the Python bindings
ERROR 1: netcdf error #-45 : NetCDF: Not a valid data type or _FillValue type mismatch .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,netCDFDataset::CreateCopy,9012)

ERROR 1: netcdf error #-49 : NetCDF: Variable not found .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,NCDFPutAttr,10454)

Warning 1: No 1D variable is indexed by dimension time

And indeed the "time" variable shows up filled with 7 zeros when I open the nc file that is nevertheless created.
Also checked with getmetadataitem(ds, "NETCDF_DIM_time_VALUES")  that the "1,2,3,4,5,6,7" info was correctly set.
You need to surround the values of the _DEF and _VALUES items with { and } braces to indicate this is a list (this is the particular syntax expected by the netCDF driver)

I's also strange the warnings about the "-co" options also because they were in fact taken into account. Omitting them creates a classic nc file.


function write_multiband(cube, fname::AbstractString, v=nothing; dim_name::String="time")
               nbands = size(cube,3)
               ds = gmt2gd(cube)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", dim_name)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_DEF", "$(nbands),6")
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_VALUES", "1,2,3,4,5,6,7")
               Gdal.setmetadataitem(ds, dim_name * "#axis", string(dim_name[1]))
               crs = Gdal.getproj(cube, wkt=true)
               (crs != "" ) && Gdal.setproj!(ds, crs)
               Gdal.unsafe_copy(ds, filename=fname, driver=getdriver("netCDF"), options=["-co", "FORMAT=NC4", "-co", "COMPRESS=DEFLATE", "-co", "ZLEVEL=4"])
end

From: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>
Sent: Sunday, October 10, 2021 10:48 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets


Joaquim,

https://github.com/OSGeo/gdal/pull/4634 should hopefully help

Even
Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

I have a Julia version of gdal_translate (that ends up calling GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not the way I wanted.
It creates a multi-subdatasets file, whilst what I wished is to write a multi-band file.

For example, the file written with this Julia function looks like below

How can I write a multi-band instead of a multi-datasets?
I've been looking at the docs of GDALDatasetRasterIOEx but can't see any way of picking one or the other.

Joaquim

gdalinfo cube_rad.nc
Driver: netCDF/Network Common Data Format
Files: cube_rad.nc
Size is 512, 512
Metadata:
  NC_GLOBAL#Conventions=CF-1.5
  NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
  NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy( cube_rad.nc, ... )
Subdatasets:
  SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
  SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
  SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
  SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
...

Saving the same data (or similar) from a Matlab code that I wrote long ago to stack grids, shows

gdalinfo evi_cube.nc
Driver: netCDF/Network Common Data Format
Files: evi_cube.nc
Size is 37, 59
Origin = (580140.000000000000000,4418550.000000000000000)
Pixel Size = (30.000000000000000,-30.000000000000000)
Metadata:
...
  latitude#actual_range={4416795,4418535}
  latitude#long_name=latitude
  latitude#units=degrees_north
  longitude#actual_range={580155,581235}
  longitude#long_name=longitude
  longitude#units=degrees_east
  NC_GLOBAL#Conventions=COARDS
  NC_GLOBAL#description=File written from Matlab
  NC_GLOBAL#node_offset=0
  NC_GLOBAL#Source_Software=Mirone
  NC_GLOBAL#title=Grid created by Mirone
  NETCDF_DIM_EXTRA={time}
  NETCDF_DIM_time_DEF={67,6}
  NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
  z#actual_range={-856.4703369140625,176.8457641601562}
  z#long_name=z
  z#units=unknown
  z#_FillValue=-nan(ind)
Corner Coordinates:
Upper Left  (  580140.000, 4418550.000)
Lower Left  (  580140.000, 4416780.000)
Upper Right (  581250.000, 4418550.000)
Lower Right (  581250.000, 4416780.000)
Center      (  580695.000, 4417665.000)
Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=1
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=2
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
...



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/3d018f0c/attachment-0001.html>

From Matt.Wilkie at yukon.ca  Thu Oct 14 13:42:19 2021
From: Matt.Wilkie at yukon.ca (Matt.Wilkie at yukon.ca)
Date: Thu, 14 Oct 2021 20:42:19 +0000
Subject: [gdal-dev] Python gdal.Translate(...) and unicode in Band
 Descriptions.
In-Reply-To: <38c29e7a-972c-5d62-3cfe-2d14925d6b94@spatialys.com>
References: <d578fa100fcd45379eb14f2b5cb13161@yukon.ca>
 <4fd6f98045254fbca7c0839ae5629c11@yukon.ca>
 <69ec35b5ba0541db9db7a260c7922351@yukon.ca>
 <5a6a9fe2119746a5bb557a4f3ce4c5e0@yukon.ca>
 <38c29e7a-972c-5d62-3cfe-2d14925d6b94@spatialys.com>
Message-ID: <08f8df2f5cc241b4be3d74955976220d@yukon.ca>

> you could do something along:
>
> tmp_vrt = gdal.Translate("", src_ds, format = 'VRT')
> call SetColorInterpretation() / SetDescription() on tmp_vrt
> gdal.Translate(dstname, tmp_vrt, format = 'COG', ...)


Thanks Even, that works perfectly. It also revealed more depth on my on-again off-again troubles: In my final write I was feeding the input vsi image to Translate instead of the gdal dataset object I had applied the changes to. So:

	gdal.Translate(outdata, VSIPATH, ...)

instead of:

	gdal.Translate(outdata, DATAOBJ, ...)

The fixed and working script is attached.

-Matt


-----Original Message-----
From: Even Rouault <even.rouault at spatialys.com> 
Sent: October 14, 2021 12:11 PM
To: Matt.Wilkie <Matt.Wilkie at yukon.ca>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Python gdal.Translate(...) and unicode in Band Descriptions.

<strong>*** External email: Do not click on links or attachments except from trusted senders. *** ******************************************************************************************</strong>
<br>
<br>
you could do something along:

tmp_vrt = gdal.Translate("", src_ds, format = 'VRT')

call SetColorInterpretation() / SetDescription() on tmp_vrt

gdal.Translate(dstname, tmp_vrt, format = 'COG', ...)


Le 14/10/2021 ? 20:45, Matt.Wilkie at yukon.ca a ?crit?:
>> For Problem 2 there?s a new wrinkle: in spite of the warning about 
>> being unable to save the .aux.xml info into the source zip sometimes 
>> it actually does. I haven?t sorted out when it can and can?t yet.
> Solved it: the first time the script is run it saves the Color Interp and Descriptions in the .aux.xml within the zip, and the output image remains Undefined for these fields. In subsequent runs saving the aux fails, and the output image fields for Color Interp and Description are filled out. As I've been using the same input archive repeatedly while testing this sequence was being masked.
>
> So now I'm at the crux I think: how to tell gdal.Translate() to use these metadata without applying them to `data_in.GetRasterBand(1)` and saving first?
>
> Is there a more efficient method than:
>
> ~~~
> data_in = gdal.Open(vsipath)
> gdal.Translate(dstname, vsipath, width=w, height=h, ...)
>
> data_out = gdal.Open(dstname)
>      data_out.GetRasterBand(1).SetColorInterpretation(gdal.GCI_RedBand)
>      data_out.GetRasterBand(1).SetDescription("Red (0.625 - 0.695 microns)")
>      ...
>
> data_in = None
> data_out = None
> ~~~
>
>
> Matt
> Geomatics Developer and Administrator | Environment | T 867-667-8133 | 
> Yukon.ca
> Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

--
https://imsva91-ctp.trendmicro.com:443/wis/clicktime/v1/query?url=http%3a%2f%2fwww.spatialys.com&umid=7AF69E2A-CE54-D505-9E07-D6028B22F810&auth=c132af8ee7c9d1278d61a701569070a095ce962e-3d324fe99905db1c25d2b023d6680d9f015cf9ec
My software is free, but my time generally not.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SPOT-zip-to-preview.zip
Type: application/x-zip-compressed
Size: 2401 bytes
Desc: SPOT-zip-to-preview.zip
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/076d36f2/attachment.bin>

From me at komzpa.net  Thu Oct 14 13:58:24 2021
From: me at komzpa.net (=?UTF-8?Q?Darafei_=22Kom=D1=8Fpa=22_Praliaskouski?=)
Date: Thu, 14 Oct 2021 23:58:24 +0300
Subject: [gdal-dev] Simple features/sql-mm and bezier/elliptical curves
In-Reply-To: <8975931A-326A-4AF3-8660-224BEEB60E99@cleverelephant.ca>
References: <CAB28Asg-ROP2uMmYHtZuqJ6H76Ju6tTKMTXkSWwRoDNuM3h+2Q@mail.gmail.com>
 <CAC8Q8tJ6D+EcV5NtxNMmBRFtyac5vXiAUomNb0BUnR4qLDeQkQ@mail.gmail.com>
 <8975931A-326A-4AF3-8660-224BEEB60E99@cleverelephant.ca>
Message-ID: <CAC8Q8tLawJz3oyqjd7Z5CovPVa=Jda6zVT6wUXF4Hp7Sk8z6Hg@mail.gmail.com>

https://www.iso.org/standard/60343.html

ISO/IEC 13249-3:2016
Information technology ? Database languages ? SQL multimedia and
application packages ? Part 3: Spatial

PDF costs 198 CHF (215 USD), and I don't know how DRM'd it is. The checkout
form has weird things like "number of copies" for PDF. If we can
meaningfully use it without getting lawsuits I'd say we should get it.

Inside it has chapters on TIN (my interest) ST_EllipticalCurve and
ST_NURBScurve (Nyall's original question), there's also something
ST_SpiralCurve in the list, looking at the table of contents on the preview
website.

On Tue, Oct 12, 2021 at 7:08 PM Paul Ramsey <pramsey at cleverelephant.ca>
wrote:

> This would be something we could put our (PostGIS) OSGeo budget to,
> perhaps, in lieu of any other activities going on this year.
>
> P
>
> > On Oct 12, 2021, at 3:00 AM, Darafei Kom?pa Praliaskouski <me at komzpa.net>
> wrote:
> >
> > Hello,
> >
> > ISO SQL/MM has chapters for NURBS and other magical geometry types. The
> text is unfortunately not free - I'd love us to have a copy for the PostGIS
> team at least. Last time I was touching that topic was around 2019 when I
> wanted to make TINs somewhat more compatible.
> >
> > OGC has a very limited subset, and sometimes may contradict ISO.
> >
> >
> > ??, 12 ??? 2021, 01:13 ???????????? Nyall Dawson <nyall.dawson at gmail.com>
> ???????:
> > Hi list,
> >
> > Slightly off-topic question (but I figure the people who would know
> > would be subscribed to this list):
> >
> > Is anyone aware if there's been **any** talk/movement toward formally
> > introducing bezier and/or elliptical curve support into the SF/SQL/MM
> > specifications? Has anyone come across any informal approaches for
> > describing elliptical curves/bezier in WKT?
> >
> > Thanks in advance,
> > Nyall
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211014/4f625b8c/attachment.html>

From paulo.au15 at gmail.com  Thu Oct 14 18:07:08 2021
From: paulo.au15 at gmail.com (Paulo Petersen)
Date: Fri, 15 Oct 2021 11:07:08 +1000
Subject: [gdal-dev] Using GPU for GDAL Python
Message-ID: <CAM26XTSSGQzo2ftv+6cyVfQpz9VPjeXVbsaDx0t_TLD0-GNZXQ@mail.gmail.com>

Hi Folks, good morning!

I'm using GDAL Python for pre-processing some satellite images, currently
using CPU instances in AWS.
I'm struggling to find a way to implement it using GPUs, more specifically,
the NVIDIA V100 GPU.

Does any one achieve that and could share how you've done it?

Thanks,
Paulo Petersen.
paulo.au15 at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/4354fea2/attachment.html>

From pedrongvenancio at gmail.com  Fri Oct 15 05:05:31 2021
From: pedrongvenancio at gmail.com (=?UTF-8?Q?Pedro_Ven=C3=A2ncio?=)
Date: Fri, 15 Oct 2021 13:05:31 +0100
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CA+H0G_Hqqb8bWdUKJ=ah2Kchd19hVgbHTrpKAWhDqU24fGPCZg@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <09dd67a0-a3c5-5b83-60bd-e4858ab55720@spatialys.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
 <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChuz_HE5-B5Ek+aXGoRsHZgDF6rW62ug-CfQmvMrb8wegQ@mail.gmail.com>
 <CAMCJChs=AeoYPDT_dbCyxVu4fQzn2vgxTrRC664=SYezXctXaw@mail.gmail.com>
 <CA+H0G_Hqqb8bWdUKJ=ah2Kchd19hVgbHTrpKAWhDqU24fGPCZg@mail.gmail.com>
Message-ID: <CAMCJChurBgsCDKRYN9A1w7ABNaj0Qk27qn23jj5mYaaqRdQ4vw@mail.gmail.com>

Hi Even,

I've been trying to tackle this issue and these are my last findings:

https://github.com/conda-forge/gdal-feedstock/issues/541#issuecomment-944228747

Does this make sense to you? Do you remember any change between gdal 3.2.1
and 3.2.2 that can explain this behaviour?

Thank you very much!

Pedro

Alexandre Neto <senhor.neto at gmail.com> escreveu no dia quinta, 14/10/2021
?(s) 01:26:

> Hi pedro,
>
> Are you sure you are not mixing conda channels? Normally, in the same
> environment, you should stick to a single channel to avoid dependency
> problems.
>
> I also noticed that you are using anaconda. I suggest you use miniconda
> instead. It comes with the bare minimal tools to install and manage the
> packages you explicitly want, instead of installating Gb of packages that
> unless you know them, you will never use.
>
> Alexandre Neto
>
> A quarta, 13/10/2021, 17:16, Pedro Ven?ncio <pedrongvenancio at gmail.com>
> escreveu:
>
>> I will ask on GDAL conda-forge, maybe this can be some packaging problem.
>>
>> Thanks!
>>
>>
>> Pedro Ven?ncio <pedrongvenancio at gmail.com> escreveu no dia quarta,
>> 13/10/2021 ?(s) 17:00:
>>
>>> Tried to define several environment variables, but nothing seems to work
>>>
>>> [image: env_win10.jpg]
>>>
>>>
>>> Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
>>> 13/10/2021 ?(s) 16:23:
>>>
>>>> N?o Pedro,
>>>>
>>>>
>>>>
>>>> When I look into my own build of the gdall dll I see no dependency on
>>>> that ?opj_encoder_set_extra_options? but likely because it?s a different
>>>> version (I build from master).
>>>>
>>>>
>>>>
>>>> From my experience on this there is really nothing one can do other
>>>> than rebuild the dll or replace the dependency that is missing the required
>>>> symbol. Nothing we can do from a conda installation.
>>>>
>>>>
>>>>
>>>> But ofc my analysis may be all wrong.
>>>>
>>>>
>>>>
>>>> Joaquim
>>>>
>>>>
>>>>
>>>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Pedro
>>>> Ven?ncio
>>>> *Sent:* Wednesday, October 13, 2021 4:04 PM
>>>> *To:* gdal-dev at lists.osgeo.org
>>>> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on
>>>> Anaconda - DLL load failed
>>>>
>>>>
>>>>
>>>> Hi Joaquim,
>>>>
>>>>
>>>>
>>>> Thanks for sharing your case. Did you manage to make it work in some
>>>> way?
>>>>
>>>>
>>>>
>>>> I've already uninstalled a test PostgreSQL/PostGIS that I supposed to
>>>> be the source of the conflict, but I keep having the same error.
>>>>
>>>>
>>>>
>>>> I also reinstalled conda, but nothing had changed.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> Joaquim Manuel Freire Lu?s <jluis at ualg.pt> escreveu no dia quarta,
>>>> 13/10/2021 ?(s) 15:24:
>>>>
>>>> Hi,
>>>>
>>>>
>>>>
>>>> I have a certain horror to python (that I?m trying to fight) a bit of
>>>> it is because I never manage to really use it.
>>>>
>>>>
>>>>
>>>> I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I
>>>> removed and installed a new one in which I tried Pedro?s case and got
>>>> exactly the same errors.
>>>>
>>>>
>>>>
>>>> I then run a dependency analysis from within the conda shell and found
>>>> two weird things
>>>>
>>>>
>>>>
>>>>    1. The gdal dll depends on a xerces-c_3_2.dll locate at
>>>>    C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but
>>>>    seems to not cause any problem in this case.
>>>>    2. There is a ?red mark? on the opj_encoder_set_extra_options
>>>>    symbol and this alone can explain the ?ImportError: DLL load failed while
>>>>    importing _gdal: The specified procedure could not be found.?
>>>>
>>>>
>>>>
>>>> Hopefully the screen capture is small enough to get through.
>>>>
>>>>
>>>>
>>>> Joaquim
>>>>
>>>>
>>>>
>>>> *From:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *On Behalf Of *Even
>>>> Rouault
>>>> *Sent:* Wednesday, October 13, 2021 2:39 PM
>>>> *To:* Pedro Ven?ncio <pedrongvenancio at gmail.com>
>>>> *Cc:* gdal-dev at lists.osgeo.org
>>>> *Subject:* Re: [gdal-dev] Running GDAL through Python >= 3.8 on
>>>> Anaconda - DLL load failed
>>>>
>>>>
>>>>
>>>> ok, so now you have to inspect the PATH and fix it so that the gdal DLL
>>>> and its dependencies are in it. But all of this sounds like there's
>>>> something weird in your environment. Perhaps a mix of GDAL versions?
>>>>
>>>> Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :
>>>>
>>>> Can you change in __init__.py
>>>>
>>>>                 try:
>>>>                     os.add_dll_directory(p)
>>>>                 except FileNotFoundError:
>>>>                     continue
>>>>
>>>>
>>>>
>>>> to
>>>>
>>>>                 try:
>>>>                     os.add_dll_directory(p)
>>>>                 except (FileNotFoundError, OSError):
>>>>                     continue
>>>>
>>>>
>>>>
>>>> Yes, here is the output:
>>>>
>>>> Traceback (most recent call last):
>>>>
>>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper
>>>>
>>>>     return importlib.import_module(mname)
>>>>
>>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>>>>
>>>>     return _bootstrap._gcd_import(name[level:], package, level)
>>>>
>>>>   File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
>>>>
>>>>   File "<frozen importlib._bootstrap>", line 991, in _find_and_load
>>>>
>>>>   File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
>>>>
>>>>   File "<frozen importlib._bootstrap>", line 657, in _load_unlocked
>>>>
>>>>   File "<frozen importlib._bootstrap>", line 556, in module_from_spec
>>>>
>>>>   File "<frozen importlib._bootstrap_external>", line 1166, in create_module
>>>>
>>>>   File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
>>>>
>>>> ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.
>>>>
>>>>
>>>>
>>>> During handling of the above exception, another exception occurred:
>>>>
>>>>
>>>>
>>>> Traceback (most recent call last):
>>>>
>>>>   File "demo.py", line 1, in <module>
>>>>
>>>>     from osgeo import gdal
>>>>
>>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>
>>>>
>>>>     _gdal = swig_import_helper()
>>>>
>>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper
>>>>
>>>>     return importlib.import_module('_gdal')
>>>>
>>>>   File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module
>>>>
>>>>     return _bootstrap._gcd_import(name[level:], package, level)
>>>>
>>>> ModuleNotFoundError: No module named '_gdal'
>>>>
>>>>
>>>>
>>>> --
>>>>
>>>> http://www.spatialys.com
>>>>
>>>> My software is free, but my time generally not.
>>>>
>>>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/ea73606f/attachment-0001.html>

From even.rouault at spatialys.com  Fri Oct 15 05:38:26 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 15 Oct 2021 14:38:26 +0200
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <CAMCJChurBgsCDKRYN9A1w7ABNaj0Qk27qn23jj5mYaaqRdQ4vw@mail.gmail.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
 <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChuz_HE5-B5Ek+aXGoRsHZgDF6rW62ug-CfQmvMrb8wegQ@mail.gmail.com>
 <CAMCJChs=AeoYPDT_dbCyxVu4fQzn2vgxTrRC664=SYezXctXaw@mail.gmail.com>
 <CA+H0G_Hqqb8bWdUKJ=ah2Kchd19hVgbHTrpKAWhDqU24fGPCZg@mail.gmail.com>
 <CAMCJChurBgsCDKRYN9A1w7ABNaj0Qk27qn23jj5mYaaqRdQ4vw@mail.gmail.com>
Message-ID: <513f9d0b-c612-efae-2fa9-d64daaeae9ed@spatialys.com>


Le 15/10/2021 ? 14:05, Pedro Ven?ncio a ?crit?:
> Hi Even,
>
> I've been trying to tackle this issue and these are my last findings:
>
> https://github.com/conda-forge/gdal-feedstock/issues/541#issuecomment-944228747 
> <https://github.com/conda-forge/gdal-feedstock/issues/541#issuecomment-944228747>
>
> ||
> Does this make sense to you? Do you remember any change between|gdal 
> |3.2.1| and |||||3.2.2|||| ||| | that can explain this behaviour?
No, looking at the git diff, nothing significant in the Python bindings 
has changed between 3.2.1 and 3.2.2
>
> Thank you very much!
>
> Pedro
>
> Alexandre Neto <senhor.neto at gmail.com <mailto:senhor.neto at gmail.com>> 
> escreveu no dia quinta, 14/10/2021 ?(s) 01:26:
>
>     Hi pedro,
>
>     Are you sure you are not mixing conda channels? Normally, in the
>     same environment, you should stick to a single channel to avoid
>     dependency problems.
>
>     I also noticed that you are using anaconda. I suggest you use
>     miniconda instead. It comes with the bare minimal tools to install
>     and manage the packages you explicitly want, instead of
>     installating Gb of packages that unless you know them, you will
>     never use.
>
>     Alexandre Neto
>
>     A quarta, 13/10/2021, 17:16, Pedro Ven?ncio
>     <pedrongvenancio at gmail.com <mailto:pedrongvenancio at gmail.com>>
>     escreveu:
>
>         I will ask on GDAL conda-forge, maybe this can be some
>         packaging problem.
>
>         Thanks!
>
>
>         Pedro Ven?ncio <pedrongvenancio at gmail.com
>         <mailto:pedrongvenancio at gmail.com>> escreveu no dia quarta,
>         13/10/2021 ?(s) 17:00:
>
>             Tried to define several environment variables, but nothing
>             seems to work
>
>             env_win10.jpg
>
>
>             Joaquim Manuel Freire Lu?s <jluis at ualg.pt
>             <mailto:jluis at ualg.pt>> escreveu no dia quarta, 13/10/2021
>             ?(s) 16:23:
>
>                 N?o Pedro,
>
>                 When I look into my own build of the gdall dll I see
>                 no dependency on that ?opj_encoder_set_extra_options?
>                 but likely because it?s a different version (I build
>                 from master).
>
>                 From my experience on this there is really nothing one
>                 can do other than rebuild the dll or replace the
>                 dependency that is missing the required symbol.
>                 Nothing we can do from a conda installation.
>
>                 But ofc my analysis may be all wrong.
>
>                 Joaquim
>
>                 *From:*gdal-dev <gdal-dev-bounces at lists.osgeo.org
>                 <mailto:gdal-dev-bounces at lists.osgeo.org>> *On Behalf
>                 Of *Pedro Ven?ncio
>                 *Sent:* Wednesday, October 13, 2021 4:04 PM
>                 *To:* gdal-dev at lists.osgeo.org
>                 <mailto:gdal-dev at lists.osgeo.org>
>                 *Subject:* Re: [gdal-dev] Running GDAL through Python
>                 >= 3.8 on Anaconda - DLL load failed
>
>                 Hi Joaquim,
>
>                 Thanks for sharing your case. Did you manage to make
>                 it work in some way?
>
>                 I've already uninstalled a test PostgreSQL/PostGIS
>                 that I supposed to be the source of the conflict, but
>                 I keep having the same error.
>
>                 I also reinstalled conda, but nothing had changed.
>
>                 Joaquim Manuel Freire Lu?s <jluis at ualg.pt
>                 <mailto:jluis at ualg.pt>> escreveu no dia quarta,
>                 13/10/2021 ?(s) 15:24:
>
>                     Hi,
>
>                     I have a certain horror to python (that I?m trying
>                     to fight) a bit of it is because I never manage to
>                     really use it.
>
>                     I had and older Miniconda (Mini => 18 GB !!!!)
>                     that was so big that I removed and installed a new
>                     one in which I tried Pedro?s case and got exactly
>                     the same errors.
>
>                     I then run a dependency analysis from within the
>                     conda shell and found two weird things
>
>                      1. The gdal dll depends on a xerces-c_3_2.dll
>                         locate at C:\WINDOWS\system32. This seems
>                         quite dangerous (for dependency sakes) but
>                         seems to not cause any problem in this case.
>                      2. There is a ?red mark? on the
>                         opj_encoder_set_extra_options symbol and this
>                         alone can explain the ?ImportError: DLL load
>                         failed while importing _gdal: The specified
>                         procedure could not be found.?
>
>                     Hopefully the screen capture is small enough to
>                     get through.
>
>                     Joaquim
>
>                     *From:*gdal-dev <gdal-dev-bounces at lists.osgeo.org
>                     <mailto:gdal-dev-bounces at lists.osgeo.org>> *On
>                     Behalf Of *Even Rouault
>                     *Sent:* Wednesday, October 13, 2021 2:39 PM
>                     *To:* Pedro Ven?ncio <pedrongvenancio at gmail.com
>                     <mailto:pedrongvenancio at gmail.com>>
>                     *Cc:* gdal-dev at lists.osgeo.org
>                     <mailto:gdal-dev at lists.osgeo.org>
>                     *Subject:* Re: [gdal-dev] Running GDAL through
>                     Python >= 3.8 on Anaconda - DLL load failed
>
>                     ok, so now you have to inspect the PATH and fix it
>                     so that the gdal DLL and its dependencies are in
>                     it. But all of this sounds like there's something
>                     weird in your environment. Perhaps a mix of GDAL
>                     versions?
>
>                     Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit?:
>
>                             Can you change in __init__.py
>
>                             ??????????????? try:
>                             os.add_dll_directory(p)
>                             ??????????????? except FileNotFoundError:
>                             continue
>
>                             to
>
>                             ??????????????? try:
>                             os.add_dll_directory(p)
>                             ??????????????? except (FileNotFoundError,
>                             OSError):
>                             continue
>
>                         Yes, here is the output:
>
>                         Traceback (most recent call last):
>
>                         ? File
>                         "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
>                         line 21, in swig_import_helper
>
>                         ??? return importlib.import_module(mname)
>
>                         ? File
>                         "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
>                         line 127, in import_module
>
>                         ??? return
>                         _bootstrap._gcd_import(name[level:], package,
>                         level)
>
>                         ? File "<frozen importlib._bootstrap>", line
>                         1014, in _gcd_import
>
>                         ? File "<frozen importlib._bootstrap>", line
>                         991, in _find_and_load
>
>                         ? File "<frozen importlib._bootstrap>", line
>                         975, in _find_and_load_unlocked
>
>                         ? File "<frozen importlib._bootstrap>", line
>                         657, in _load_unlocked
>
>                         ? File "<frozen importlib._bootstrap>", line
>                         556, in module_from_spec
>
>                         ? File "<frozen
>                         importlib._bootstrap_external>", line 1166, in
>                         create_module
>
>                         ? File "<frozen importlib._bootstrap>", line
>                         219, in _call_with_frames_removed
>
>                         ImportError: DLL load failed while importing
>                         _gdal: Imposs?vel localizar o procedimento
>                         especificado.
>
>                           
>
>                         During handling of the above exception,
>                         another exception occurred:
>
>                           
>
>                         Traceback (most recent call last):
>
>                         ? File "demo.py", line 1, in <module>
>
>                         ??? from osgeo import gdal
>
>                         ? File
>                         "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
>                         line 37, in <module>
>
>                         ??? _gdal = swig_import_helper()
>
>                         ? File
>                         "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py",
>                         line 34, in swig_import_helper
>
>                         ??? return importlib.import_module('_gdal')
>
>                         ? File
>                         "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py",
>                         line 127, in import_module
>
>                         ??? return
>                         _bootstrap._gcd_import(name[level:], package,
>                         level)
>
>                         ModuleNotFoundError: No module named '_gdal'
>
>                     -- 
>
>                     http://www.spatialys.com  <http://www.spatialys.com>
>
>                     My software is free, but my time generally not.
>
>         _______________________________________________
>         gdal-dev mailing list
>         gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>         <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/8f341b9d/attachment-0001.html>

From jluis at ualg.pt  Fri Oct 15 06:50:14 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Fri, 15 Oct 2021 13:50:14 +0000
Subject: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL
 load failed
In-Reply-To: <513f9d0b-c612-efae-2fa9-d64daaeae9ed@spatialys.com>
References: <CAMCJChvGL3Wn3sx10RTfFeUCJF+KsVZG10COmpdN38bUGRDFHw@mail.gmail.com>
 <CAMCJChusEtG_0uc_wdZWCBLrnxuoE1dMpQxaMa=_-AJn1ufQBQ@mail.gmail.com>
 <2b7626c3-4aa1-7a8a-f12d-fba4a021cb03@spatialys.com>
 <CAMCJChuCya2nUXVOe+ARLvu2JeKqZo17xjovx5QzRy_Q2d9Yew@mail.gmail.com>
 <892a72df-be7f-d7e3-deab-5868cb213f57@spatialys.com>
 <CAMCJChvgyTPt=G9SXxyS-rP3d8hGBoC5Hik+OuPQ1k5V2bMc_w@mail.gmail.com>
 <cf5f5d3a-e289-592f-3a08-2c0e158f1226@spatialys.com>
 <AM6PR04MB395989FA61B101FAEFA349ECA6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChsBNq080iz5ROk4+qT7wzTs4QY3T5kO0=50Qr+oR=VcCw@mail.gmail.com>
 <AM6PR04MB3959936D3925EFE682E28FD3A6B79@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <CAMCJChuz_HE5-B5Ek+aXGoRsHZgDF6rW62ug-CfQmvMrb8wegQ@mail.gmail.com>
 <CAMCJChs=AeoYPDT_dbCyxVu4fQzn2vgxTrRC664=SYezXctXaw@mail.gmail.com>
 <CA+H0G_Hqqb8bWdUKJ=ah2Kchd19hVgbHTrpKAWhDqU24fGPCZg@mail.gmail.com>
 <CAMCJChurBgsCDKRYN9A1w7ABNaj0Qk27qn23jj5mYaaqRdQ4vw@mail.gmail.com>
 <513f9d0b-c612-efae-2fa9-d64daaeae9ed@spatialys.com>
Message-ID: <AM6PR04MB39591BBD2EA4035627059C39A6B99@AM6PR04MB3959.eurprd04.prod.outlook.com>

Found this

https://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg35514.html

So my guess is that is that the shipped OpenJPEG dll is not compatible with the gdal.dll, it misses that opj_encoder_set_extra_options() function.


From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Even Rouault
Sent: Friday, October 15, 2021 1:38 PM
To: Pedro Ven?ncio <pedrongvenancio at gmail.com>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL load failed



Le 15/10/2021 ? 14:05, Pedro Ven?ncio a ?crit :
Hi Even,

I've been trying to tackle this issue and these are my last findings:

https://github.com/conda-forge/gdal-feedstock/issues/541#issuecomment-944228747

Does this make sense to you? Do you remember any change between gdal 3.2.1 and 3.2.2 that can explain this behaviour?
No, looking at the git diff, nothing significant in the Python bindings has changed between 3.2.1 and 3.2.2


Thank you very much!

Pedro

Alexandre Neto <senhor.neto at gmail.com<mailto:senhor.neto at gmail.com>> escreveu no dia quinta, 14/10/2021 ?(s) 01:26:
Hi pedro,

Are you sure you are not mixing conda channels? Normally, in the same environment, you should stick to a single channel to avoid dependency problems.

I also noticed that you are using anaconda. I suggest you use miniconda instead. It comes with the bare minimal tools to install and manage the packages you explicitly want, instead of installating Gb of packages that unless you know them, you will never use.

Alexandre Neto

A quarta, 13/10/2021, 17:16, Pedro Ven?ncio <pedrongvenancio at gmail.com<mailto:pedrongvenancio at gmail.com>> escreveu:
I will ask on GDAL conda-forge, maybe this can be some packaging problem.

Thanks!


Pedro Ven?ncio <pedrongvenancio at gmail.com<mailto:pedrongvenancio at gmail.com>> escreveu no dia quarta, 13/10/2021 ?(s) 17:00:
Tried to define several environment variables, but nothing seems to work



Joaquim Manuel Freire Lu?s <jluis at ualg.pt<mailto:jluis at ualg.pt>> escreveu no dia quarta, 13/10/2021 ?(s) 16:23:
N?o Pedro,

When I look into my own build of the gdall dll I see no dependency on that ?opj_encoder_set_extra_options? but likely because it?s a different version (I build from master).

From my experience on this there is really nothing one can do other than rebuild the dll or replace the dependency that is missing the required symbol. Nothing we can do from a conda installation.

But ofc my analysis may be all wrong.

Joaquim

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> On Behalf Of Pedro Ven?ncio
Sent: Wednesday, October 13, 2021 4:04 PM
To: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL load failed

Hi Joaquim,

Thanks for sharing your case. Did you manage to make it work in some way?

I've already uninstalled a test PostgreSQL/PostGIS that I supposed to be the source of the conflict, but I keep having the same error.

I also reinstalled conda, but nothing had changed.



Joaquim Manuel Freire Lu?s <jluis at ualg.pt<mailto:jluis at ualg.pt>> escreveu no dia quarta, 13/10/2021 ?(s) 15:24:
Hi,

I have a certain horror to python (that I?m trying to fight) a bit of it is because I never manage to really use it.

I had and older Miniconda (Mini => 18 GB !!!!) that was so big that I removed and installed a new one in which I tried Pedro?s case and got exactly the same errors.

I then run a dependency analysis from within the conda shell and found two weird things


  1.  The gdal dll depends on a xerces-c_3_2.dll locate at C:\WINDOWS\system32. This seems quite dangerous (for dependency sakes) but seems to not cause any problem in this case.
  2.  There is a ?red mark? on the opj_encoder_set_extra_options symbol and this alone can explain the ?ImportError: DLL load failed while importing _gdal: The specified procedure could not be found.?

Hopefully the screen capture is small enough to get through.

Joaquim

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> On Behalf Of Even Rouault
Sent: Wednesday, October 13, 2021 2:39 PM
To: Pedro Ven?ncio <pedrongvenancio at gmail.com<mailto:pedrongvenancio at gmail.com>>
Cc: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Running GDAL through Python >= 3.8 on Anaconda - DLL load failed


ok, so now you have to inspect the PATH and fix it so that the gdal DLL and its dependencies are in it. But all of this sounds like there's something weird in your environment. Perhaps a mix of GDAL versions?
Le 13/10/2021 ? 15:36, Pedro Ven?ncio a ?crit :

Can you change in __init__.py

                try:
                    os.add_dll_directory(p)
                except FileNotFoundError:
                    continue



to

                try:
                    os.add_dll_directory(p)
                except (FileNotFoundError, OSError):
                    continue

Yes, here is the output:

Traceback (most recent call last):

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 21, in swig_import_helper

    return importlib.import_module(mname)

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import

  File "<frozen importlib._bootstrap>", line 991, in _find_and_load

  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked

  File "<frozen importlib._bootstrap>", line 657, in _load_unlocked

  File "<frozen importlib._bootstrap>", line 556, in module_from_spec

  File "<frozen importlib._bootstrap_external>", line 1166, in create_module

  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed

ImportError: DLL load failed while importing _gdal: Imposs?vel localizar o procedimento especificado.



During handling of the above exception, another exception occurred:



Traceback (most recent call last):

  File "demo.py", line 1, in <module>

    from osgeo import gdal

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 37, in <module>

    _gdal = swig_import_helper()

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\site-packages\osgeo\__init__.py", line 34, in swig_import_helper

    return importlib.import_module('_gdal')

  File "C:\Users\PedroVenancio\anaconda3\envs\arosics\lib\importlib\__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

ModuleNotFoundError: No module named '_gdal'


--

http://www.spatialys.com

My software is free, but my time generally not.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/a4f80f5e/attachment-0001.html>

From jluis at ualg.pt  Fri Oct 15 06:59:23 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Fri, 15 Oct 2021 13:59:23 +0000
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <AM6PR04MB39591CF8EC931EBC007A2A28A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
 <VI1PR04MB3966C7D9352FE47FE5F07EA2A6B89@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <1f81610a-d663-5cdc-4a44-9a6dd0508224@spatialys.com>
 <AM6PR04MB3959839B85D5344916F51606A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <AM6PR04MB39591CF8EC931EBC007A2A28A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <AM6PR04MB395960FB3470E68C9506A0B4A6B99@AM6PR04MB3959.eurprd04.prod.outlook.com>

Even, sorry to keep bothering you with this but found no docs on this.

The CreateCopy() solution created me a file with the coordinates system info stored in the "transverse_mercator" attribute (why?)

Metadata:
  Band1#grid_mapping=transverse_mercator
  Band1#long_name=GDAL Band Number 1
  Band1#_FillValue=65535
  NC_GLOBAL#Conventions=CF-1.5
  NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
  NC_GLOBAL#history=Thu Oct 14 20:59:24 2021: GDAL CreateCopy( gd_cube.nc, ... )
  NETCDF_DIM_EXTRA={time}
  NETCDF_DIM_time_DEF={7,6}
  NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7}
  time#axis=t
  transverse_mercator#false_easting=500000
  transverse_mercator#false_northing=0
  transverse_mercator#GeoTransform=481845 30 0 4287765 0 -30
  transverse_mercator#grid_mapping_name=transverse_mercator
  transverse_mercator#inverse_flattening=298.257223563
  transverse_mercator#latitude_of_projection_origin=0
  transverse_mercator#longitude_of_central_meridian=-9
  transverse_mercator#longitude_of_prime_meridian=0
  transverse_mercator#long_name=CRS definition
  transverse_mercator#scale_factor_at_central_meridian=0.9996
  transverse_mercator#semi_major_axis=6378137
  transverse_mercator#spatial_ref=PROJCS["unknown",GEOGCS["unknown",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-9],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]


The problem is that either GMT and Mirone look for that info in global attribute called "grid_mapping" as in

...
Metadata:
  grid_mapping#spatial_ref=PROJCS["unknown",
    GEOGCS["unknown",
        DATUM["Unknown based on WGS84 ellipsoid",
            SPHEROID["WGS 84",6378137,298.257223563,


How can I control the name of the attribute where the CRS is tored so I can find it from other programs?

Also, is there a way of setting the "actual_range" and "_Fillvalue" data attributes?

Joaquim

From: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>
Sent: Thursday, October 14, 2021 9:03 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Subject: RE: [gdal-dev] Writing multi-bands vs multi-datasets

On more. The warning about "No 1D variable is indexed by dimension time" turned out to be because I was calling

Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", "{time}")

(like you call '{time,Z}' in your Python example). Removing the curly braces here made that warning go away.

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> On Behalf Of Joaquim Manuel Freire Lu?s
Sent: Thursday, October 14, 2021 8:42 PM
To: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets

Much better (I was confused by those curly braces thinking it was part of python syntax).
Though still get this warning

Warning 1: No 1D variable is indexed by dimension time

But otherwise gdalinfo does not complain on anything wrong

The "-co" is confusing. I had to add in other situations otherwise some options were not set.

Julia does not use bindings, it can access the exported functions in shared libraries directly
(if you are curious see https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/
and https://docs.julialang.org/en/v1/base/c/#ccall)
so passing that vector of strings should be translated automatically to a "char *string[]" and GDAL expects the "-co" (I think)

From: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Sent: Thursday, October 14, 2021 8:14 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt<mailto:jluis at ualg.pt>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets



Le 14/10/2021 ? 21:03, Joaquim Manuel Freire Lu?s a ?crit :
Even,

There are some issues with this way.

My draft Julia function looks like bellow  (tested with a MxNx7 array) but get this errors

julia> GMT.write_multiband(cube, "gd_cube.nc")
Warning 1: No 1D variable is indexed by dimension time
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
Warning 6: creation option '-co' is not formatted with the key=value format
I don't know the Julia bindings, but the error message seems to suggest you can remove the "-co" element in your options[] array since it presumably must only contain the "key=value" creation options, like in the Python bindings
ERROR 1: netcdf error #-45 : NetCDF: Not a valid data type or _FillValue type mismatch .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,netCDFDataset::CreateCopy,9012)

ERROR 1: netcdf error #-49 : NetCDF: Variable not found .
at (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,NCDFPutAttr,10454)

Warning 1: No 1D variable is indexed by dimension time

And indeed the "time" variable shows up filled with 7 zeros when I open the nc file that is nevertheless created.
Also checked with getmetadataitem(ds, "NETCDF_DIM_time_VALUES")  that the "1,2,3,4,5,6,7" info was correctly set.
You need to surround the values of the _DEF and _VALUES items with { and } braces to indicate this is a list (this is the particular syntax expected by the netCDF driver)

I's also strange the warnings about the "-co" options also because they were in fact taken into account. Omitting them creates a classic nc file.


function write_multiband(cube, fname::AbstractString, v=nothing; dim_name::String="time")
               nbands = size(cube,3)
               ds = gmt2gd(cube)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", dim_name)
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_DEF", "$(nbands),6")
               Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_VALUES", "1,2,3,4,5,6,7")
               Gdal.setmetadataitem(ds, dim_name * "#axis", string(dim_name[1]))
               crs = Gdal.getproj(cube, wkt=true)
               (crs != "" ) && Gdal.setproj!(ds, crs)
               Gdal.unsafe_copy(ds, filename=fname, driver=getdriver("netCDF"), options=["-co", "FORMAT=NC4", "-co", "COMPRESS=DEFLATE", "-co", "ZLEVEL=4"])
end

From: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>
Sent: Sunday, October 10, 2021 10:48 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt><mailto:jluis at ualg.pt>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Writing multi-bands vs multi-datasets


Joaquim,

https://github.com/OSGeo/gdal/pull/4634 should hopefully help

Even
Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

I have a Julia version of gdal_translate (that ends up calling GDALDatasetRasterIOEx) that works in saving a MxNxP array, but not the way I wanted.
It creates a multi-subdatasets file, whilst what I wished is to write a multi-band file.

For example, the file written with this Julia function looks like below

How can I write a multi-band instead of a multi-datasets?
I've been looking at the docs of GDALDatasetRasterIOEx but can't see any way of picking one or the other.

Joaquim

gdalinfo cube_rad.nc
Driver: netCDF/Network Common Data Format
Files: cube_rad.nc
Size is 512, 512
Metadata:
  NC_GLOBAL#Conventions=CF-1.5
  NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
  NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy( cube_rad.nc, ... )
Subdatasets:
  SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
  SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
  SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
  SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
...

Saving the same data (or similar) from a Matlab code that I wrote long ago to stack grids, shows

gdalinfo evi_cube.nc
Driver: netCDF/Network Common Data Format
Files: evi_cube.nc
Size is 37, 59
Origin = (580140.000000000000000,4418550.000000000000000)
Pixel Size = (30.000000000000000,-30.000000000000000)
Metadata:
...
  latitude#actual_range={4416795,4418535}
  latitude#long_name=latitude
  latitude#units=degrees_north
  longitude#actual_range={580155,581235}
  longitude#long_name=longitude
  longitude#units=degrees_east
  NC_GLOBAL#Conventions=COARDS
  NC_GLOBAL#description=File written from Matlab
  NC_GLOBAL#node_offset=0
  NC_GLOBAL#Source_Software=Mirone
  NC_GLOBAL#title=Grid created by Mirone
  NETCDF_DIM_EXTRA={time}
  NETCDF_DIM_time_DEF={67,6}
  NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
  z#actual_range={-856.4703369140625,176.8457641601562}
  z#long_name=z
  z#units=unknown
  z#_FillValue=-nan(ind)
Corner Coordinates:
Upper Left  (  580140.000, 4418550.000)
Lower Left  (  580140.000, 4416780.000)
Upper Right (  581250.000, 4418550.000)
Lower Right (  581250.000, 4416780.000)
Center      (  580695.000, 4417665.000)
Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=1
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
  NoData Value=nan
  Unit Type: unknown
  Metadata:
    actual_range={-856.4703369140625,176.8457641601562}
    long_name=z
    NETCDF_DIM_time=2
    NETCDF_VARNAME=z
    units=unknown
    _FillValue=-nan(ind)
...


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/aa3d8d90/attachment-0001.html>

From even.rouault at spatialys.com  Fri Oct 15 07:16:20 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 15 Oct 2021 16:16:20 +0200
Subject: [gdal-dev] Writing multi-bands vs multi-datasets
In-Reply-To: <AM6PR04MB395960FB3470E68C9506A0B4A6B99@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <VI1PR04MB3966F137C5BCA46D7001B416A6B49@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <cfcc4aad-a9a6-575e-eb6c-7bfe3a8de2e0@spatialys.com>
 <VI1PR04MB3966C7D9352FE47FE5F07EA2A6B89@VI1PR04MB3966.eurprd04.prod.outlook.com>
 <1f81610a-d663-5cdc-4a44-9a6dd0508224@spatialys.com>
 <AM6PR04MB3959839B85D5344916F51606A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <AM6PR04MB39591CF8EC931EBC007A2A28A6B89@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <AM6PR04MB395960FB3470E68C9506A0B4A6B99@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <c5ca4f51-cff6-508a-ae61-8f193bebaa90@spatialys.com>


Le 15/10/2021 ? 15:59, Joaquim Manuel Freire Lu?s a ?crit?:
>
> Even, sorry to keep bothering you with this but found no docs on this.
>
Well, the ultimate doc is 
https://github.com/OSGeo/gdal/blob/master/gdal/frmts/netcdf/netcdfdataset.cpp
>
> The CreateCopy() solution created me a file with the coordinates 
> system info stored in the ?transverse_mercator? attribute (why?)
>
why not ? :-) This is like this before I was born.

If you look at "Example 5.6. Rotated pole grid" of 
https://cfconventions.org/Data/cf-conventions/cf-conventions-1.9/cf-conventions.html, 
you can see that the name of the variable that stores the CRS definition 
can be anything. The link to it is done through the "grid_mapping" 
attribute of the variable of interest.

>
> How can I control the name of the attribute where the CRS is tored so 
> I can find it from other programs?
>
You can't. It is set at 
https://github.com/OSGeo/gdal/blob/40d18b06d78d5b97f9c6387ef6a08a9c0142c884/gdal/frmts/netcdf/netcdfdataset.cpp#L5607 
with the same value as the #grid_mapping_name attribute of the CRS 
definition vriable.
>
> Also, is there a way of setting the ?actual_range? and ?_Fillvalue? 
> data attributes?
>
actual_range: perhaps by setting a "variable#actual_range={min,max}" 
metadata item ?

_Fillvalue: through the SetNoDataValue() method of the raster band object

> Joaquim
>
> *From:*Joaquim Manuel Freire Lu?s <jluis at ualg.pt>
> *Sent:* Thursday, October 14, 2021 9:03 PM
> *To:* Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; Even Rouault 
> <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> *Subject:* RE: [gdal-dev] Writing multi-bands vs multi-datasets
>
> On more. The warning about ?No 1D variable is indexed by dimension 
> time? turned out to be because I was calling
>
> Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", ?{time}?)
>
> (like you call ?{time,Z}? in your Python example). Removing the curly 
> braces here made that warning go away.
>
> *From:*gdal-dev <gdal-dev-bounces at lists.osgeo.org 
> <mailto:gdal-dev-bounces at lists.osgeo.org>> *On Behalf Of *Joaquim 
> Manuel Freire Lu?s
> *Sent:* Thursday, October 14, 2021 8:42 PM
> *To:* Even Rouault <even.rouault at spatialys.com 
> <mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org 
> <mailto:gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] Writing multi-bands vs multi-datasets
>
> Much better (I was confused by those curly braces thinking it was part 
> of python syntax).
>
> Though still get this warning
>
> Warning 1: No 1D variable is indexed by dimension time
>
> But otherwise gdalinfo does not complain on anything wrong
>
> The ?-co? is confusing. I had to add in other situations otherwise 
> some options were not set.
>
> Julia does not use bindings, it can access the exported functions in 
> shared libraries directly
>
> (if you are curious see 
> https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/ 
> <https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/>
>
> and https://docs.julialang.org/en/v1/base/c/#ccall 
> <https://docs.julialang.org/en/v1/base/c/#ccall>)
>
> so passing that vector of strings should be translated automatically 
> to a ?char *string[]? and GDAL expects the ?-co? (I think)
>
> *From:*Even Rouault <even.rouault at spatialys.com 
> <mailto:even.rouault at spatialys.com>>
> *Sent:* Thursday, October 14, 2021 8:14 PM
> *To:* Joaquim Manuel Freire Lu?s <jluis at ualg.pt 
> <mailto:jluis at ualg.pt>>; gdal-dev at lists.osgeo.org 
> <mailto:gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] Writing multi-bands vs multi-datasets
>
> Le 14/10/2021 ? 21:03, Joaquim Manuel Freire Lu?s a ?crit?:
>
>     Even,
>
>     There are some issues with this way.
>
>     My draft Julia function looks like bellow ?(tested with a MxNx7
>     array) but get this errors
>
>     julia> GMT.write_multiband(cube, "gd_cube.nc")
>
>     Warning 1: No 1D variable is indexed by dimension time
>
>     Warning 6: creation option '-co' is not formatted with the
>     key=value format
>
>     Warning 6: creation option '-co' is not formatted with the
>     key=value format
>
>     Warning 6: creation option '-co' is not formatted with the
>     key=value format
>
> I don't know the Julia bindings, but the error message seems to 
> suggest you can remove the "-co" element in your options[] array since 
> it presumably must only contain the "key=value" creation options, like 
> in the Python bindings
>
>     ERROR 1: netcdf error #-45 : NetCDF: Not a valid data type or
>     _FillValue type mismatch .
>
>     at
>     (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,netCDFDataset::CreateCopy,9012)
>
>     ERROR 1: netcdf error #-49 : NetCDF: Variable not found .
>
>     at
>     (C:\programs\compa_libs\gdal_GIT\gdal\frmts\netcdf\netcdfdataset.cpp,NCDFPutAttr,10454)
>
>     Warning 1: No 1D variable is indexed by dimension time
>
>     And indeed the ?time? variable shows up filled with 7 zeros when I
>     open the nc file that is nevertheless created.
>
>     Also checked with getmetadataitem(ds, "NETCDF_DIM_time_VALUES")?
>     that the "1,2,3,4,5,6,7" info was correctly set.
>
> You need to surround the values of the _DEF and _VALUES items with { 
> and } braces to indicate this is a list (this is the particular syntax 
> expected by the netCDF driver)
>
>     I?s also strange the warnings about the ?-co? options also because
>     they were in fact taken into account. Omitting them creates a
>     classic nc file.
>
>     function write_multiband(cube, fname::AbstractString, v=nothing;
>     dim_name::String="time")
>
>     ?????????????? nbands = size(cube,3)
>
>     ?????????????? ds = gmt2gd(cube)
>
>     Gdal.setmetadataitem(ds, "NETCDF_DIM_EXTRA", dim_name)
>
>     ?????????????? Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name *
>     "_DEF", "$(nbands),6")
>
>     Gdal.setmetadataitem(ds, "NETCDF_DIM_" * dim_name * "_VALUES",
>     "1,2,3,4,5,6,7")
>
>     Gdal.setmetadataitem(ds, dim_name * "#axis", string(dim_name[1]))
>
>     ?????????????? crs = Gdal.getproj(cube, wkt=true)
>
>     ?????????????? (crs != "" ) && Gdal.setproj!(ds, crs)
>
>     Gdal.unsafe_copy(ds, filename=fname, driver=getdriver("netCDF"),
>     options=["-co", "FORMAT=NC4", "-co", "COMPRESS=DEFLATE", "-co",
>     "ZLEVEL=4"])
>
>     end
>
>     *From:*Even Rouault <even.rouault at spatialys.com>
>     <mailto:even.rouault at spatialys.com>
>     *Sent:* Sunday, October 10, 2021 10:48 PM
>     *To:* Joaquim Manuel Freire Lu?s <jluis at ualg.pt>
>     <mailto:jluis at ualg.pt>; gdal-dev at lists.osgeo.org
>     <mailto:gdal-dev at lists.osgeo.org>
>     *Subject:* Re: [gdal-dev] Writing multi-bands vs multi-datasets
>
>     Joaquim,
>
>     https://github.com/OSGeo/gdal/pull/4634
>     <https://github.com/OSGeo/gdal/pull/4634> should hopefully help
>
>     Even
>
>     Le 10/10/2021 ? 22:26, Joaquim Manuel Freire Lu?s a ?crit?:
>
>         Hi,
>
>         I have a Julia version of gdal_translate (that ends up calling
>         GDALDatasetRasterIOEx) that works in saving a MxNxP array, but
>         not the way I wanted.
>
>         It creates a multi-subdatasets file, whilst what I wished is
>         to write a multi-band file.
>
>         For example, the file written with this Julia function looks
>         like below
>
>         How can I write a multi-band instead of a multi-datasets?
>
>         I?ve been looking at the docs of GDALDatasetRasterIOEx but
>         can?t see any way of picking one or the other.
>
>         Joaquim
>
>         gdalinfo cube_rad.nc
>
>         Driver: netCDF/Network Common Data Format
>
>         Files: cube_rad.nc
>
>         Size is 512, 512
>
>         Metadata:
>
>         NC_GLOBAL#Conventions=CF-1.5
>
>         NC_GLOBAL#GDAL=GDAL 3.4.0dev, released 2021/99/99
>
>         NC_GLOBAL#history=Sun Oct 10 13:01:06 2021: GDAL CreateCopy(
>         cube_rad.nc, ... )
>
>         Subdatasets:
>
>         SUBDATASET_1_NAME=NETCDF:"cube_rad.nc":Band1
>
>         SUBDATASET_1_DESC=[1567x1519] Band1 (32-bit floating-point)
>
>         SUBDATASET_2_NAME=NETCDF:"cube_rad.nc":Band2
>
>         SUBDATASET_2_DESC=[1567x1519] Band2 (32-bit floating-point)
>
>         ?
>
>         Saving the same data (or similar) from a Matlab code that I
>         wrote long ago to stack grids, shows
>
>         gdalinfo evi_cube.nc
>
>         Driver: netCDF/Network Common Data Format
>
>         Files: evi_cube.nc
>
>         Size is 37, 59
>
>         Origin = (580140.000000000000000,4418550.000000000000000)
>
>         Pixel Size = (30.000000000000000,-30.000000000000000)
>
>         Metadata:
>
>         ?
>
>         latitude#actual_range={4416795,4418535}
>
>         latitude#long_name=latitude
>
>         latitude#units=degrees_north
>
>         longitude#actual_range={580155,581235}
>
>         longitude#long_name=longitude
>
>         longitude#units=degrees_east
>
>         NC_GLOBAL#Conventions=COARDS
>
>         NC_GLOBAL#description=File written from Matlab
>
>         NC_GLOBAL#node_offset=0
>
>         NC_GLOBAL#Source_Software=Mirone
>
>         NC_GLOBAL#title=Grid created by Mirone
>
>         NETCDF_DIM_EXTRA={time}
>
>         NETCDF_DIM_time_DEF={67,6}
>
>         NETCDF_DIM_time_VALUES={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67}
>
>         z#actual_range={-856.4703369140625,176.8457641601562}
>
>         ? z#long_name=z
>
>         ? z#units=unknown
>
>         z#_FillValue=-nan(ind)
>
>         Corner Coordinates:
>
>         Upper Left? ( 580140.000, 4418550.000)
>
>         Lower Left? ( 580140.000, 4416780.000)
>
>         Upper Right ( 581250.000, 4418550.000)
>
>         Lower Right ( 581250.000, 4416780.000)
>
>         Center????? ( 580695.000, 4417665.000)
>
>         Band 1 Block=37x59 Type=Float32, ColorInterp=Undefined
>
>         ? NoData Value=nan
>
>         ? Unit Type: unknown
>
>         ? Metadata:
>
>         actual_range={-856.4703369140625,176.8457641601562}
>
>         ??? long_name=z
>
>         NETCDF_DIM_time=1
>
>         ??? NETCDF_VARNAME=z
>
>         ??? units=unknown
>
>         _FillValue=-nan(ind)
>
>         Band 2 Block=37x59 Type=Float32, ColorInterp=Undefined
>
>         ? NoData Value=nan
>
>         ? Unit Type: unknown
>
>         ? Metadata:
>
>         actual_range={-856.4703369140625,176.8457641601562}
>
>         ??? long_name=z
>
>         NETCDF_DIM_time=2
>
>         ??? NETCDF_VARNAME=z
>
>         ??? units=unknown
>
>         _FillValue=-nan(ind)
>
>         ?
>
>         _______________________________________________
>
>         gdal-dev mailing list
>
>         gdal-dev at lists.osgeo.org  <mailto:gdal-dev at lists.osgeo.org>
>
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev  <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>     -- 
>
>     http://www.spatialys.com  <http://www.spatialys.com>
>
>     My software is free, but my time generally not.
>
> -- 
> http://www.spatialys.com  <http://www.spatialys.com>
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/46cae483/attachment-0001.html>

From even.rouault at spatialys.com  Fri Oct 15 10:42:19 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 15 Oct 2021 19:42:19 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
Message-ID: <df3ea1e4-573a-3a60-ccdb-b7a2fab3c040@spatialys.com>

Hi,

Some news of the preliminary work on this.

I've initiated https://github.com/rouault/gdal/tree/import_cmake4gdal with:

- the import of the CMake configuration using the deployment script of 
https://github.com/miurahr/cmake4gdal . Again, this is really an amazing 
work from Hiroshi !

- and a reorganization of the GDAL source tree. Hiroshi's initial work 
had the top level CMakeLists at the root of the github repository, that 
set up the project and included the gdal/CMakeLists.txt and 
autotest/CMakeLists.txt. While this works fine when building from git, 
as our tarballs include just the content of gdal/, that would break. I 
presume it might have been possible to make changes to have the main 
CMakeLists.txt in gdal/, but that would be rather non-idiomatic (as it 
is already non-idiomatic for a autoconf/nmake build), so this is a good 
opportunity to use a more usual layout.

==> I've thus gone to "git mv gdal/* ." to remove the gdal/ 
subdirectory. Of course number of boring changes were needed to adapt CI 
scripts, Docker, mkgdaldist.sh, etc.? This will also impact downstream 
users building from git once that work will have landed into master. 
I'll wait for the release/3.4 branch to have been created (probably in ~ 
10 days) before merging this. A side effect is that it will slightly 
complicate the workflow for 3.5 -> 3.4 backports, but that's a temporary 
inconvenience for a longer term advantage.

Even

Le 04/10/2021 ? 13:48, Even Rouault a ?crit?:
> Hi,
>
> Please find at https://github.com/OSGeo/gdal/pull/4590 a RFC that 
> proposes:
>
> - to develop a CMake build system, officially integrated in the source 
> tree.
>
> - and remove the current GNU makefiles and nmake build systems, when 
> the CMake build system has matured enough and reached feature parity.
>
> Best regards,
>
> Een
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From gdt at lexort.com  Fri Oct 15 11:18:40 2021
From: gdt at lexort.com (Greg Troxel)
Date: Fri, 15 Oct 2021 14:18:40 -0400
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <df3ea1e4-573a-3a60-ccdb-b7a2fab3c040@spatialys.com> (Even
 Rouault's message of "Fri, 15 Oct 2021 19:42:19 +0200")
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <df3ea1e4-573a-3a60-ccdb-b7a2fab3c040@spatialys.com>
Message-ID: <rmik0ief8xr.fsf@s1.lexort.com>


Even Rouault <even.rouault at spatialys.com> writes:

> ==> I've thus gone to "git mv gdal/* ." to remove the gdal/
> subdirectory. Of course number of boring changes were needed to adapt
> CI scripts, Docker, mkgdaldist.sh, etc.? This will also impact
> downstream users building from git once that work will have landed
> into master. I'll wait for the release/3.4 branch to have been created
> (probably in ~ 10 days) before merging this. A side effect is that it
> will slightly complicate the workflow for 3.5 -> 3.4 backports, but
> that's a temporary inconvenience for a longer term advantage.

When it is time for release please start out with alpha, as from the POV
of packaging systems this is a big deal.   I would expect at least 30
days, probably >=45, from alpha to release, to allow people calendar
time to find the time to deal with transition, report issues, and get
them resolved.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/7bf48154/attachment.sig>

From even.rouault at spatialys.com  Fri Oct 15 11:23:41 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 15 Oct 2021 20:23:41 +0200
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <rmik0ief8xr.fsf@s1.lexort.com>
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <df3ea1e4-573a-3a60-ccdb-b7a2fab3c040@spatialys.com>
 <rmik0ief8xr.fsf@s1.lexort.com>
Message-ID: <a6311dd1-cdac-e105-1403-a7fb55212bf3@spatialys.com>


Le 15/10/2021 ? 20:18, Greg Troxel a ?crit?:
> Even Rouault <even.rouault at spatialys.com> writes:
>
>> ==> I've thus gone to "git mv gdal/* ." to remove the gdal/
>> subdirectory. Of course number of boring changes were needed to adapt
>> CI scripts, Docker, mkgdaldist.sh, etc.? This will also impact
>> downstream users building from git once that work will have landed
>> into master. I'll wait for the release/3.4 branch to have been created
>> (probably in ~ 10 days) before merging this. A side effect is that it
>> will slightly complicate the workflow for 3.5 -> 3.4 backports, but
>> that's a temporary inconvenience for a longer term advantage.
> When it is time for release please start out with alpha, as from the POV
> of packaging systems this is a big deal.   I would expect at least 30
> days, probably >=45, from alpha to release, to allow people calendar
> time to find the time to deal with transition, report issues, and get
> them resolved.

That git tree reorganization alone should hardly impact packagers still 
using autoconf, as the release tarball structure will be unchanged. This 
only impacts folks building from git

The full cmake transition will certainly require more time, but that 
will probably be beyond 3.5

>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From gdt at lexort.com  Fri Oct 15 11:38:04 2021
From: gdt at lexort.com (Greg Troxel)
Date: Fri, 15 Oct 2021 14:38:04 -0400
Subject: [gdal-dev] RFC 84: Migrating build systems to CMake
In-Reply-To: <a6311dd1-cdac-e105-1403-a7fb55212bf3@spatialys.com> (Even
 Rouault's message of "Fri, 15 Oct 2021 20:23:41 +0200")
References: <d99c732d-2892-11ad-83f6-ff1c8b16eb40@spatialys.com>
 <df3ea1e4-573a-3a60-ccdb-b7a2fab3c040@spatialys.com>
 <rmik0ief8xr.fsf@s1.lexort.com>
 <a6311dd1-cdac-e105-1403-a7fb55212bf3@spatialys.com>
Message-ID: <rmi35p2f81f.fsf@s1.lexort.com>


Even Rouault <even.rouault at spatialys.com> writes:

> That git tree reorganization alone should hardly impact packagers
> still using autoconf, as the release tarball structure will be
> unchanged. This only impacts folks building from git
>
> The full cmake transition will certainly require more time, but that
> will probably be beyond 3.5

Sorry, I mixed up things.  If the  next release still supports autoconf,
then indeed a reorg is no big deal.

 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211015/da47e2b4/attachment.sig>

From laburlet at gmail.com  Mon Oct 18 10:59:34 2021
From: laburlet at gmail.com (laburlet at gmail.com)
Date: Tue, 19 Oct 2021 04:59:34 +1100
Subject: [gdal-dev] ogr2ogr.exe  v3.3.1 only results in blank table
Message-ID: <024401d7c449$eaaafc90$c000f5b0$@gmail.com>

I have been using ogr2ogr.exe v2.1.0 to import SHP files to MSSQL for
several years, no problem.

Recently installed GDAL 3.3.1 and this version of ogr2ogr no longer imports
SHP, only creates empty table.

Steps to reproduce the problem.

I have tried both versions on same machine - v2.1.0 works and v 3.31 does
not

The command line for v2.1.0 is:

c:\OSGeo4w_2016\bin\ogr2ogr.exe -overwrite -progress -f "MSSQLSpatial" -lco
SCHEMA=QGIS "MSSQL:server=xxxx_17;database=DHLog;trusted_connection=yes"
"d:\temp\FRO_ELs-MLs.shp" -nln QGIS.frome_els_mls

The command line for v3.3.1 is same, other than using the new EXE

c:\OSGeo4w\bin\ogr2ogr.exe -overwrite -progress -f "MSSQLSpatial" -lco
SCHEMA=QGIS "MSSQL:server=xxxx_17;database=DHLog;trusted_connection=yes"
"d:\temp\FRO_ELs-MLs.shp" -nln QGIS.frome_els_mls

v2.1.0 imports the SHP just fine to MSSQL, but v 3.3.1 only creates the
table and then no records

Attached is the SHP file and its ancillaries

Operating system

Win 10 Pro, 64 bit

With thanks

 

Luke B

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211019/d848d0a0/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: FRO_ELs-MLs.zip
Type: application/x-zip-compressed
Size: 25507 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211019/d848d0a0/attachment-0001.bin>

From even.rouault at spatialys.com  Mon Oct 18 11:22:00 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 18 Oct 2021 20:22:00 +0200
Subject: [gdal-dev] ogr2ogr.exe v3.3.1 only results in blank table
In-Reply-To: <024401d7c449$eaaafc90$c000f5b0$@gmail.com>
References: <024401d7c449$eaaafc90$c000f5b0$@gmail.com>
Message-ID: <8818631b-e3c5-e9ff-9310-d863407aa802@spatialys.com>

Note: already reported at https://github.com/OSGeo/gdal/issues/4674


Le 18/10/2021 ? 19:59, laburlet at gmail.com a ?crit?:
>
> I have been using ogr2ogr.exe v2.1.0 to import SHP files to MSSQL for 
> several years, no problem.
>
> Recently installed GDAL 3.3.1 and this version of ogr2ogr no longer 
> imports SHP, only creates empty table.
>
> Steps to reproduce the problem.
>
> I have tried both versions on same machine - v2.1.0 works and v 3.31 
> does not
>
> The command line for v2.1.0 is:
>
> *c:\OSGeo4w_2016*\bin\ogr2ogr.exe -overwrite -progress -f 
> "MSSQLSpatial" -lco SCHEMA=QGIS 
> "MSSQL:server=xxxx_17;database=DHLog;trusted_connection=yes" 
> "d:\temp\FRO_ELs-MLs.shp" -nln QGIS.frome_els_mls
>
> The command line for v3.3.1 is same, other than using the new EXE
>
> *c:\OSGeo4w*\bin\ogr2ogr.exe -overwrite -progress -f "MSSQLSpatial" 
> -lco SCHEMA=QGIS 
> "MSSQL:server=xxxx_17;database=DHLog;trusted_connection=yes" 
> "d:\temp\FRO_ELs-MLs.shp" -nln QGIS.frome_els_mls
>
> v2.1.0 imports the SHP just fine to MSSQL, but v 3.3.1 only creates 
> the table and then no records
>
> Attached is the SHP file and its ancillaries
>
> Operating system
>
> Win 10 Pro, 64 bit
>
> With thanks
>
> Luke B
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211018/2ef4c2aa/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Oct 19 05:53:16 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 19 Oct 2021 12:53:16 +0000
Subject: [gdal-dev] GDAL does not find geometries from KML
Message-ID: <67cd0bc707b54c9f9b916b12b440ce8e@maanmittauslaitos.fi>

Hi,

I tried to convert geometries from a KML file captured with URL https://www.sedecatastro.gob.es/cartografia/fxcc/fxcc_kml.aspx?refcat=0717611VK4701F

Ogrinfo finds layers
INFO: Open of `0717611VK4701F.kml'
      using driver `LIBKML' successful.
1: 0717611VK4701F
2: PLANTA GENERAL
3: PLANTA BAJA 00

Ogrinfo finds also a POINT Z geometry from layer 0717611VK4701F. By looking at the KML file with a text editor layers PLANTA GENERAL and PLANTA BAJA 00 both contain one GeometryCollection which is made out of one or several POLYGON Z geometries. However, ogrinfo does not find those geometries. The KML file opens with Google Earth and shows a 3D model of a building. Is there perhaps something special in the structure of this KML?

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211019/715c566b/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Oct 19 06:22:13 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 19 Oct 2021 13:22:13 +0000
Subject: [gdal-dev] GDAL does not find geometries from KML
Message-ID: <6c87a39ac9c649849bc95728c4b3d325@maanmittauslaitos.fi>

Hi,

I found what is the problem. The service is sending old style KML, the current specification has this note:

Note: The <GeometryCollection> tag has been deprecated. Use <MultiGeometry> instead.

Search-replace made GDAL to find the missing  geometries.

-Jukka Rahkonen-

L?hett?j?: Rahkonen Jukka (MML)
L?hetetty: tiistai 19. lokakuuta 2021 15.53
Vastaanottaja: 'gdal-dev at lists.osgeo.org' <gdal-dev at lists.osgeo.org>
Aihe: GDAL does not find geometries from KML

Hi,

I tried to convert geometries from a KML file captured with URL https://www.sedecatastro.gob.es/cartografia/fxcc/fxcc_kml.aspx?refcat=0717611VK4701F

Ogrinfo finds layers
INFO: Open of `0717611VK4701F.kml'
      using driver `LIBKML' successful.
1: 0717611VK4701F
2: PLANTA GENERAL
3: PLANTA BAJA 00

Ogrinfo finds also a POINT Z geometry from layer 0717611VK4701F. By looking at the KML file with a text editor layers PLANTA GENERAL and PLANTA BAJA 00 both contain one GeometryCollection which is made out of one or several POLYGON Z geometries. However, ogrinfo does not find those geometries. The KML file opens with Google Earth and shows a 3D model of a building. Is there perhaps something special in the structure of this KML?

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211019/464db213/attachment.html>

From jluis at ualg.pt  Tue Oct 19 17:01:14 2021
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Wed, 20 Oct 2021 00:01:14 +0000
Subject: [gdal-dev] What's so wrong with this nc file ...
Message-ID: <AM6PR04MB3959F174B69DBFED38FECC83A6BE9@AM6PR04MB3959.eurprd04.prod.outlook.com>

That the geotransform is not detected

gdalinfo xxx.grd
Warning 1: dimension #1 (x) is not a Longitude___/X dimension.
Warning 1: dimension #0 (y) is not a Latitude/Y dimension.
Driver: netCDF/Network Common Data Format
...
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,   59.0)
Upper Right (   37.0,    0.0)
Lower Right (   37.0,   59.0)
Center      (   18.5,   29.5)

I can't get why it's complaining on "dimension #1 (x) is not a Longitude/X dimension."
Tried to check the full docs (netcdfdataset.cpp) but not even with a debugger I can understand the why.

Due to it the x,y coordinates are not fished from file, either from Julia or from GMT

NOTE: this works but does not use GDAL

grdinfo xxx.grd
xxx.grd: Title: z
xxx.grd: Command:
xxx.grd: Remark:
xxx.grd: Gridline node registration used [Cartesian grid]
xxx.grd: Grid file format: nf = GMT netCDF format (32-bit float), CF-1.7
xxx.grd: x_min: 580155 x_max: 581235 x_inc: 30 name: x n_columns: 37
xxx.grd: y_min: 4416795 y_max: 4418535 y_inc: 30 name: y n_rows: 59
xxx.grd: v_min: 0.205308780074 v_max: 0.56782335043 name: z
...

This DOES NOT WORK (it uses GDAL)

grdinfo xxx.grd=gd
Warning 1: dimension #1 (x) is not a Longitude___/X dimension.
Warning 1: dimension #0 (y) is not a Latitude/Y dimension.
xxx.grd: Title: Grid imported via GDAL
xxx.grd: Command:
xxx.grd: Remark:
xxx.grd: Gridline node registration used [Cartesian grid]
xxx.grd: Grid file format: gd = Import/export through GDAL
xxx.grd: x_min: 0.5 x_max: 36.5 x_inc: 1 name: x n_columns: 37
xxx.grd: y_min: 0.5 y_max: 58.5 y_inc: 1 name: y n_rows: 59
xxx.grd: v_min: 0.205308780074 v_max: 0.56782335043 name: z
xxx.grd: scale_factor: 1 add_offset: 0
+proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs

What's so wrong with this nc file? I have others that look similar in terms of attributes and things work fine, but for some other cases I get the terrible

Warning 1: dimension #1 (x) is not a Longitude/X dimension.
Warning 1: dimension #0 (y) is not a Latitude/Y dimension.

and I'm screwed.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211020/18c48bc4/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xxx.grd
Type: application/octet-stream
Size: 21981 bytes
Desc: xxx.grd
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211020/18c48bc4/attachment-0001.obj>

From even.rouault at spatialys.com  Wed Oct 20 02:41:01 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 20 Oct 2021 11:41:01 +0200
Subject: [gdal-dev] What's so wrong with this nc file ...
In-Reply-To: <AM6PR04MB3959F174B69DBFED38FECC83A6BE9@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959F174B69DBFED38FECC83A6BE9@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <1b90d84c-6959-6e52-5fd2-25e03a921290@spatialys.com>

See https://github.com/OSGeo/gdal/issues/4581

Le 20/10/2021 ? 02:01, Joaquim Manuel Freire Lu?s a ?crit?:
>
> That the geotransform is not detected
>
> gdalinfo xxx.grd
>
> Warning 1: dimension #1 (x) is not a Longitude___/X dimension.
>
> Warning 1: dimension #0 (y) is not a Latitude/Y dimension.
>
> Driver: netCDF/Network Common Data Format
>
> ?
>
> Corner Coordinates:
>
> Upper Left? (??? 0.0, 0.0)
>
> Lower Left? (??? 0.0, 59.0)
>
> Upper Right (?? 37.0, 0.0)
>
> Lower Right (?? 37.0, 59.0)
>
> Center????? (?? 18.5, 29.5)
>
> I can?t get why it?s complaining on ?dimension #1 (x) is not a 
> Longitude/X dimension.?
>
> Tried to check the full docs (netcdfdataset.cpp) but not even with a 
> debugger I can understand the why.
>
> Due to it the x,y coordinates are not fished from file, either from 
> Julia or from GMT
>
> NOTE: this works but does not use GDAL
>
> grdinfo xxx.grd
>
> xxx.grd: Title: z
>
> xxx.grd: Command:
>
> xxx.grd: Remark:
>
> xxx.grd: Gridline node registration used [Cartesian grid]
>
> xxx.grd: Grid file format: nf = GMT netCDF format (32-bit float), CF-1.7
>
> xxx.grd: x_min: 580155 x_max: 581235 x_inc: 30 name: x n_columns: 37
>
> xxx.grd: y_min: 4416795 y_max: 4418535 y_inc: 30 name: y n_rows: 59
>
> xxx.grd: v_min: 0.205308780074 v_max: 0.56782335043 name: z
>
> ?
>
> This DOES NOT WORK (it uses GDAL)
>
> grdinfo xxx.grd=gd
>
> Warning 1: dimension #1 (x) is not a Longitude___/X dimension.
>
> Warning 1: dimension #0 (y) is not a Latitude/Y dimension.
>
> xxx.grd: Title: Grid imported via GDAL
>
> xxx.grd: Command:
>
> xxx.grd: Remark:
>
> xxx.grd: Gridline node registration used [Cartesian grid]
>
> xxx.grd: Grid file format: gd = Import/export through GDAL
>
> xxx.grd: x_min: 0.5 x_max: 36.5 x_inc: 1 name: x n_columns: 37
>
> xxx.grd: y_min: 0.5 y_max: 58.5 y_inc: 1 name: y n_rows: 59
>
> xxx.grd: v_min: 0.205308780074 v_max: 0.56782335043 name: z
>
> xxx.grd: scale_factor: 1 add_offset: 0
>
> +proj=utm +zone=10 +ellps=WGS84 +units=m +no_defs
>
> What?s so wrong with this nc file? I have others that look similar in 
> terms of attributes and things work fine, but for some other cases I 
> get the terrible
>
> Warning 1: dimension #1 (x) is not a Longitude/X dimension.
>
> Warning 1: dimension #0 (y) is not a Latitude/Y dimension.
>
> and I?m screwed.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211020/5b1377d7/attachment.html>

From pramsey at cleverelephant.ca  Wed Oct 20 13:27:02 2021
From: pramsey at cleverelephant.ca (Paul Ramsey)
Date: Wed, 20 Oct 2021 13:27:02 -0700
Subject: [gdal-dev] GEOS 3.10.0 Released
Message-ID: <CACowWR2OQD8yuSHm7Ywg8N4q5=Rpp6rZzYnWSWiX5vnH=ee4iA@mail.gmail.com>

The GEOS PSC is somewhat amused to set the 3.10.0 release of GEOS free
to fly the skies of the digisphere, bringing valid geometries and fast
operations to entities everywhere.

https://trac.osgeo.org/geos/

Headline changes for this release include:
* Continuing performance improvements, particularly in the in-memory
STRTree, and new C-API functions for reading from / writing to GEOS
objects from in-memory buffers. Because it is a core algorithm for
other processes, the index improvement provides a speed-up to
operations across the library.
* Net-new algorithm for Validity checking that speed up testing of
validity, through a more step-wise approach with short-circuiting.
* A new algorithm for Validity enforcement that uses ring containment
logic to determine polygon area membership, for some "more reasonable"
results in complex ring overlapping cases.
* A triangulation routine for polygons, that provides attractive
constrained Delaunay triangulations.

For those with a nose for details, the full NEWS entry follows.

Thank you for using GEOS,
And your help in its development,
The Whole GEOS PSC

== NEWS ====================================

- New things:
  - CAPI: GEOSDistanceWithin, GEOSPreparedDistanceWithin
          (#1124, Sandro Santilli)
  - Output WKT using positional precision with the ryu
    library (#868, Paul Ramsey)
  - geosop CLI for GEOS (Martin Davis)
  - Full doxygen of the C-API (Paul Ramsey)
  - GeometryFixer class for validity enforcement (Martin Davis, Paul Ramsey)
  - CAPI: GEOSDensify (Brendan Ward)
  - CAPI: GEOSCoordSeq_copyFromArrays, GEOSCoordSeq_copyFromBuffer,
          GEOSCoordSeq_copyToArrays, GEOSCoordSeq_copyToBuffer (Daniel Baston)
  - CAPI: GEOSMakeValidWithParams new validity enforcement approach from
          https://github.com/locationtech/jts/pull/704, uses GeometryFixer
          (Paul Ramsey, Martin Davis)
  - CAPI: GEOSWKBWriter_getFlavor, GEOSWKBWriter_setFlavor support
          outputting ISO or Extended WKB flavors (#466, Paul Ramsey)
  - CAPI: GEOSConstrainedDelaunayTriangulation, builds a constrained
          triangulation of an input Polygon or MultiPolygon,
          returning a GeometryCollection(Polygon) of the triangles.

- Fixes/Improvements:
  - Preserve ordering of lines in overlay results (Martin Davis)
  - Check for invalid geometry before fixing polygonal result in Densifier
    and DPSimplifier (Martin Davis)
  - Fix overlay handling of flat interior lines (JTS-685, Martin Davis)
  - Fix IsValidOp to correctly report invalid nested MultiPolygons
(#1112, Martin Davis)
  - Fix BufferOp to avoid artifacts in certain polygon buffers (#1101,
Martin Davis)
  - Fix IsValidOp to correctly report certain kinds of invalid
LinearRings (Martin Davis)
  - Improve STRtree performance through TemplateSTRtree implementation
(Daniel Baston)
  - Fix DiscreteFrechetDistance to use initial points of input lines
(#1128, Martin Davis)

- Changes:
  - Autoconf build system is dropped in favour of CMake
    See README.md and INSTALL.md for examples of usage
  - Libtool is no longer used for in favour of CMake
    Therefor libgeos.la is no longer built/installed
  - #1094, #1090: Drop inlines.cpp to address duplicate symbols on
many platforms
    (Regina Obe)
  - GH475: Do not return NaN from GEOSProjectNormalized_r (Paul Ramsey)
  - GH442: BufferOp now returns unique_ptr<Geometry> result (Paul Ramsey)

From jp.perez.alcantara at gmail.com  Thu Oct 21 05:00:43 2021
From: jp.perez.alcantara at gmail.com (=?UTF-8?Q?Juan_Pedro_P=C3=A9rez_Alc=C3=A1ntara?=)
Date: Thu, 21 Oct 2021 14:00:43 +0200
Subject: [gdal-dev] Export / import from PostGIS to GRASS and primary keys
Message-ID: <CAMPpJ8hOx=2ibi39YD4mzAWhB2pHtYV2TsVKzS4q200OpVuCRg@mail.gmail.com>

Hi there,

I have some questions about the role of primary keys when importing /
exporting between PostGIS and GRASS. I've been making some tests regarding
this process and what follows are my impressions, so they may be wrong in
some points.

I fully understand that, given the disparity of data models,
simplifications needs to be taken regarding the very complex primary key
arrangements (multi column keys, for example) a Relational Database can do,
and that going through the GDAL pipeline with an integer autonumber ogc_fid
key is the sensible way to go, this is something that can be easily managed.

However, my workflow implies quite a lot of PostGIS ingested data that goes
to GRASS to perform topology cleaning and some other operations and back to
PostGIS. In this process, I've notice the following:

- GDAL ignores the primary key of the database, substituting it with an
ogc_fid, when importing into GRASS;

- when going back to PostGIS, another key comes from GRASS. I'm aware of
the FID option to rename the key.

My problem with this is that I lose in the process the original PostGIS
table PK. I'm workarounding this by making a physical copy of the PK into
another column, so when data is back, I can link original / GRASS processed
data.

Then, my question is: is there a way to keep the PK field at PostGIS into
the GDAL pipeline as a normal column, so I don't have to duplicate the
original PK as I'm doing right now?

Thank you so much, best regards,

---

Juan Pedro P?rez Alc?ntara

jp.perez.alcantara at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/51e7e408/attachment.html>

From cgodkin at gmail.com  Thu Oct 21 08:47:18 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 21 Oct 2021 08:47:18 -0700
Subject: [gdal-dev] gdallocationinfo + WCS question...
Message-ID: <CAE=8km=O5_2YSHJOW1MdzRXtUs2Vjs8F-T+GHnzcQ_zXo2r5wA@mail.gmail.com>

Hi,

I am trying to use gdallocationinfo to query point locations from a WCS
server and not having any luck. I don't see anything in the docs that says
this is unsupported but I can't make it work.

First of all, is there a better way to get an elevation from a given
lat,lon using WCS?

Here's an example query using the USGS National Map server:

gdallocationinfo "WCS:
https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation"
-wgs84 -122.086 42.948 --debug ON

This is a point in the middle of Crater Lake which I picked since it's flat
and I know what to expect.

Anyway, looking at the debug output it appears that the program is querying
for a GeoTIFF of a VERY large area and that's failing.

I actually want to do this with my own WCS server but thought it might be
mis-configured somehow so I tried the USGS server.  With my own server,
gdallocationinfo seems to be requesting a strange shape from the server (as
I can see through the debug output).

Thanks for any help,

carl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/5de32ec2/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Oct 21 11:16:48 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 21 Oct 2021 18:16:48 +0000
Subject: [gdal-dev] gdallocationinfo + WCS question...
Message-ID: <9b40f8241a0c4e6380b2d6f99a6d3a30@maanmittauslaitos.fi>

Hi,

At least it seems to work with our WCS service

gdallocationinfo WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli -wgs84 27 68
Report:
  Location: (228000P,119567L)
  Band 1:
    Value: 303.463989257812

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Carl Godkin
L?hetetty: torstai 21. lokakuuta 2021 18.47
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdallocationinfo + WCS question...

Hi,

I am trying to use gdallocationinfo to query point locations from a WCS server and not having any luck. I don't see anything in the docs that says this is unsupported but I can't make it work.

First of all, is there a better way to get an elevation from a given lat,lon using WCS?

Here's an example query using the USGS National Map server:

gdallocationinfo "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 -122.086 42.948 --debug ON

This is a point in the middle of Crater Lake which I picked since it's flat and I know what to expect.

Anyway, looking at the debug output it appears that the program is querying for a GeoTIFF of a VERY large area and that's failing.

I actually want to do this with my own WCS server but thought it might be mis-configured somehow so I tried the USGS server.  With my own server, gdallocationinfo seems to be requesting a strange shape from the server (as I can see through the debug output).

Thanks for any help,

carl

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/5ef55f55/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Oct 21 11:56:05 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 21 Oct 2021 18:56:05 +0000
Subject: [gdal-dev] gdallocationinfo + WCS question...
Message-ID: <82e8e18326bf4928af1757bf4738a9b8@maanmittauslaitos.fi>

Hi,

I wonder if the problem is in the multipart response that the nationalmap.gov server is sending. The result is not too big tiff (1023x511 pixels as revealed by <gml:high>1023 511</gml:high>) but perhaps GDAL does not know how to extract it from the multipart envelope. I do not know either. I thought that multipart was only an issue with WCS 1.1.x but obviously it can be used also with WCS 2.0. I do understand how brilliant idea multipart response is in theory but unfortunately it is a pain for the users.

This is the beginning of the response:

--wcs
Content-Type: text/xml
Content-ID: GML-Part
  <gml:boundedBy>
    <gml:Envelope srsName=http://www.opengis.net/def/crs/EPSG/0/3857 axisLabels="x y" uomLabels=" " srsDimension="2">
      <gml:lowerCorner>3005564.702644 10446506.055425</gml:lowerCorner>
      <gml:upperCorner>3006588.702633 10447018.055420</gml:upperCorner>
    </gml:Envelope>
  </gml:boundedBy>
  <gml:domainSet>
    <gml:RectifiedGrid dimension="2" gml:id="grid_Coverage1">
      <gml:limits>
        <gml:GridEnvelope>
          <gml:low>0 0</gml:low>
          <gml:high>1023 511</gml:high>
        </gml:GridEnvelope>
      </gml:limits>
      <gml:axisLabels>band_1</gml:axisLabels>
      <gml:origin>
        <gml:Point gml:id="grid_origin_Coverage1" srsName=http://www.opengis.net/def/crs/EPSG/0/3857>
          <gml:pos>3005564.702644 10446506.055425</gml:pos>
        </gml:Point>
      </gml:origin>
      <gml:offsetVector srsName=http://www.opengis.net/def/crs/EPSG/0/3857>XOFFSET1.000000XOFFSET 0 </gml:offsetVector>
      <gml:offsetVector srsName=http://www.opengis.net/def/crs/EPSG/0/3857>0 YOFFSET1.000000YOFFSET </gml:offsetVector>
    </gml:RectifiedGrid>
  </gml:domainSet>
  <gml:rangeSet>
    <gml:File>
      <gml:rangeParameters xlink:href=cid:Coverage1.tif xlink:role=http://www.opengis.net/spec/WCS_coverageencoding_geotiff/1.0/ xlink:arcrole="fileReference"/>
      <gml:fileReference>cid:Coverage1.tif</gml:fileReference<cid:Coverage1.tif%3c/gml:fileReference>>
      <gml:fileStructure/>
      <gml:mimeType>image/tiff</gml:mimeType>
    </gml:File>
  </gml:rangeSet>
  <gmlcov:rangeType>
    <swe:DataRecord>
      <swe:field name="band_1">
        <swe:Quantity>
          <swe:description>band_1</swe:description>
          <swe:uom code="unknown"/>
          <swe:constraint>
            <swe:AllowedValues>
              <swe:interval>3.4E-38 3.4E+38</swe:interval>
            </swe:AllowedValues>
          </swe:constraint>
        </swe:Quantity>
      </swe:field>
    </swe:DataRecord>
  </gmlcov:rangeType>
</gmlcov:RectifiedGridCoverage>
--wcs
Content-Type: image/tiff
Content-Description: coverage data
Content-Transfer-Encoding: binary
Content-ID: 1.tif
?

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Carl Godkin
L?hetetty: torstai 21. lokakuuta 2021 18.47
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdallocationinfo + WCS question...

Hi,

I am trying to use gdallocationinfo to query point locations from a WCS server and not having any luck. I don't see anything in the docs that says this is unsupported but I can't make it work.

First of all, is there a better way to get an elevation from a given lat,lon using WCS?

Here's an example query using the USGS National Map server:

gdallocationinfo "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 -122.086 42.948 --debug ON

This is a point in the middle of Crater Lake which I picked since it's flat and I know what to expect.

Anyway, looking at the debug output it appears that the program is querying for a GeoTIFF of a VERY large area and that's failing.

I actually want to do this with my own WCS server but thought it might be mis-configured somehow so I tried the USGS server.  With my own server, gdallocationinfo seems to be requesting a strange shape from the server (as I can see through the debug output).

Thanks for any help,

carl

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/e75238f8/attachment.html>

From ari.jolma at gmail.com  Thu Oct 21 12:08:36 2021
From: ari.jolma at gmail.com (Ari Jolma)
Date: Thu, 21 Oct 2021 22:08:36 +0300
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <82e8e18326bf4928af1757bf4738a9b8@maanmittauslaitos.fi>
References: <82e8e18326bf4928af1757bf4738a9b8@maanmittauslaitos.fi>
Message-ID: <967246d0-f3b4-128b-5087-72e6b4d7ef73@gmail.com>

I don't understand the problem :)

Maybe it's because I ran gdalinfo on the WCS first.

For the gdallocationinfo I get

gdallocationinfo 
"WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" 
-wgs84 -122.086 42.948
Report:
 ? Location: (6446955P,13504941L)
 ? Band 1:
 ??? Value: 1882.00549316406

Ari

Rahkonen Jukka (MML) kirjoitti 21.10.2021 klo 21.56:
>
> Hi,
>
> I wonder if the problem is in the multipart response that the 
> nationalmap.gov server is sending. The result is not too big tiff 
> (1023x511 pixels as revealed by <gml:high>1023 511</gml:high>) but 
> perhaps GDAL does not know how to extract it from the multipart 
> envelope. I do not know either. I thought that multipart was only an 
> issue with WCS 1.1.x but obviously it can be used also with WCS 2.0. I 
> do understand how brilliant idea multipart response is in theory but 
> unfortunately it is a pain for the users.
>
> This is the beginning of the response:
>
>
> --wcs
>
> Content-Type: text/xml
>
> Content-ID: GML-Part
>
> ? <gml:boundedBy>
>
> ??? <gml:Envelope srsName=http://www.opengis.net/def/crs/EPSG/0/3857 
> <http://www.opengis.net/def/crs/EPSG/0/3857> axisLabels="x y" 
> uomLabels=" " srsDimension="2">
>
> ????? <gml:lowerCorner>3005564.702644 10446506.055425</gml:lowerCorner>
>
> ????? <gml:upperCorner>3006588.702633 10447018.055420</gml:upperCorner>
>
> ??? </gml:Envelope>
>
> ? </gml:boundedBy>
>
> ? <gml:domainSet>
>
> ??? <gml:RectifiedGrid dimension="2" gml:id="grid_Coverage1">
>
> ????? <gml:limits>
>
> ??????? <gml:GridEnvelope>
>
> ????????? <gml:low>0 0</gml:low>
>
> ????????? <gml:high>1023 511</gml:high>
>
> ??????? </gml:GridEnvelope>
>
> ????? </gml:limits>
>
> <gml:axisLabels>band_1</gml:axisLabels>
>
> ????? <gml:origin>
>
> ??????? <gml:Point gml:id="grid_origin_Coverage1" 
> srsName=http://www.opengis.net/def/crs/EPSG/0/3857 
> <http://www.opengis.net/def/crs/EPSG/0/3857>>
>
> ????????? <gml:pos>3005564.702644 10446506.055425</gml:pos>
>
> ??????? </gml:Point>
>
> ????? </gml:origin>
>
> ????? <gml:offsetVector 
> srsName=http://www.opengis.net/def/crs/EPSG/0/3857 
> <http://www.opengis.net/def/crs/EPSG/0/3857>>XOFFSET1.000000XOFFSET 0 
> </gml:offsetVector>
>
> ????? <gml:offsetVector 
> srsName=http://www.opengis.net/def/crs/EPSG/0/3857 
> <http://www.opengis.net/def/crs/EPSG/0/3857>>0 YOFFSET1.000000YOFFSET 
> </gml:offsetVector>
>
> ??? </gml:RectifiedGrid>
>
> ? </gml:domainSet>
>
> ? <gml:rangeSet>
>
> ??? <gml:File>
>
> ????? <gml:rangeParameters xlink:href=cid:Coverage1.tif 
> <cid:Coverage1.tif> 
> xlink:role=http://www.opengis.net/spec/WCS_coverageencoding_geotiff/1.0/ 
> <http://www.opengis.net/spec/WCS_coverageencoding_geotiff/1.0/> 
> xlink:arcrole="fileReference"/>
>
> ????? <gml:fileReference>cid:Coverage1.tif</gml:fileReference 
> <cid:Coverage1.tif%3c/gml:fileReference>>
>
> ????? <gml:fileStructure/>
>
> <gml:mimeType>image/tiff</gml:mimeType>
>
> ??? </gml:File>
>
> ? </gml:rangeSet>
>
> ? <gmlcov:rangeType>
>
> ??? <swe:DataRecord>
>
> ????? <swe:field name="band_1">
>
> ??????? <swe:Quantity>
>
> <swe:description>band_1</swe:description>
>
> ????????? <swe:uom code="unknown"/>
>
> ????????? <swe:constraint>
>
> ??????????? <swe:AllowedValues>
>
> ????????????? <swe:interval>3.4E-38 3.4E+38</swe:interval>
>
> ??????????? </swe:AllowedValues>
>
> ????????? </swe:constraint>
>
> ??????? </swe:Quantity>
>
> ????? </swe:field>
>
> ??? </swe:DataRecord>
>
> ? </gmlcov:rangeType>
>
> </gmlcov:RectifiedGridCoverage>
>
> --wcs
>
> Content-Type: image/tiff
>
> Content-Description: coverage data
>
> Content-Transfer-Encoding: binary
>
> Content-ID: 1.tif
>
> ?
>
> -Jukka Rahkonen-
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Carl Godkin
> *L?hetetty:* torstai 21. lokakuuta 2021 18.47
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdallocationinfo + WCS question...
>
> Hi,
>
> I am trying to use gdallocationinfo to query point locations from a 
> WCS server and not having any luck. I don't see anything in the docs 
> that says this is unsupported but I can't make it work.
>
> First of all, is there a better way to get an elevation from a given 
> lat,lon using WCS?
>
> Here's an example query using the USGS National Map server:
>
> gdallocationinfo 
> "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation 
> <https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation>" 
> -wgs84 -122.086 42.948 --debug ON
>
> This is a point in the middle of Crater Lake which I picked since it's 
> flat and I know what to expect.
>
> Anyway, looking at the debug output it appears that the program is 
> querying for a GeoTIFF of a VERY large area and that's failing.
>
> I actually want to do this with my own WCS server but thought it might 
> be mis-configured somehow so I tried the USGS server.? With my own 
> server, gdallocationinfo seems to be requesting a strange shape from 
> the server (as I can see through the debug output).
>
> Thanks for any help,
>
> carl
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/db01fbbf/attachment.html>

From cgodkin at gmail.com  Thu Oct 21 12:24:49 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 21 Oct 2021 12:24:49 -0700
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <9b40f8241a0c4e6380b2d6f99a6d3a30@maanmittauslaitos.fi>
References: <9b40f8241a0c4e6380b2d6f99a6d3a30@maanmittauslaitos.fi>
Message-ID: <CAE=8km=e6PnkzNPra2oagTuEJMMHA4VpBaEtJtjzNjOFuBNm5g@mail.gmail.com>

Hi Jukka,

Strangely, the command you pasted doesn't work for me, at with GDAL 3.3.1
on Windows (with quotes added appropriately):

gdallocationinfo "WCS:
https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli"
-wgs84 27 68
ERROR 1: PROJ: proj_uom_get_info_from_database: unit of measure not found
Report:
  Location: (228000P,119567L)
  Band 1:
ERROR 1: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 1: IReadBlock failed
at X offset 222, Y offset 233: Returned tile does not match expected band
configuration.
Response has 1 bands while this dataset has 3 bands.

  Band 2:
ERROR 1: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 2: IReadBlock failed
at X offset 222, Y offset 233: Returned tile does not match expected band
configuration.
Response has 1 bands while this dataset has 3 bands.

  Band 3:
ERROR 1: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 3: IReadBlock failed
at X offset 222, Y offset 233: Returned tile does not match expected band
configuration.
Response has 1 bands while this dataset has 3 bands.

I find that somewhat reassuring since I get a similar error when querying
my own WCS server (that you helped me set up over the past couple of days):

gdallocationinfo "WCS:
http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid"
-wgs84 -122.086 42.948
Report:
  Location: (3498P,8465L)
  Band 1:
ERROR 1: Returned tile does not match expected configuration.
Got 4094x512 instead of 1024x512.
ERROR 1: C:\Users\carl\.gdal\wcs_cache\hcoMu.xml, band 1: IReadBlock failed
at X offset 3, Y offset 16: Returned tile does not match expected
configuration.
Got 4094x512 instead of 1024x512.

Or, with --debug ON:

gdallocationinfo "WCS:
http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid"
-wgs84 -122.086 42.948 --debug ON
GDAL: GDALOpen(WCS:
http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid,
this=00000228A4B2B970) succeeds as WCS.
Report:
  Location: (3498P,8465L)
  Band 1:
GDAL: GDAL_CACHEMAX = 6535 MB
WCS: Requesting
http://localhost:8080/wcs?service=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=SRTM_3_arc-second_grid&SUBSET=long%28-125,-121.5880315%29&SUBSET=lat%2842.749567499999998,43.176063499999998%29&Format=image/tiff
HTTP: Fetch(
http://localhost:8080/wcs?service=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=SRTM_3_arc-second_grid&SUBSET=long%28-125,-121.5880315%29&SUBSET=lat%2842.749567499999998,43.176063499999998%29&Format=image/tiff
)
HTTP: libcurl/7.78.0 Schannel zlib/1.2.11 libssh2/1.9.0
HTTP: GDAL was built against curl 7.77.0, but is running against 7.78.0.
WCS: GDALOpenResult() on content-type: image/tiff
GDAL: GDALOpen(/vsimem/wcs/00000228A4B2B970/wcsresult.dat,
this=00000228A4CEEC40) succeeds as GTiff.
ERROR 1: Returned tile does not match expected configuration.
Got 4094x512 instead of 1024x512.
GDAL: GDALClose(/vsimem/wcs/00000228A4B2B970/wcsresult.dat,
this=00000228A4CEEC40)
ERROR 1: C:\Users\carl\.gdal\wcs_cache\hcoMu.xml, band 1: IReadBlock failed
at X offset 3, Y offset 16: Returned tile does not match expected
configuration.
Got 4094x512 instead of 1024x512.
GDAL: GDALClose(C:\Users\carl\.gdal\wcs_cache\hcoMu.xml,
this=00000228A4B2B970)

Any suggestions?  If I break the above debug output down and use "curl" to
download the GeoTIFF and then use gdallocationinfo on the downloaded file,
I get a reasonable result.
I guess I could do that.  But what I find very strange is that
gdallocationinfo seems to request a rather odd-shaped patch (-125 to -121.5
in longitude, but only 42.75 to 43.18 in latitude) which cases trouble.

Thanks a lot,

carl




On Thu, Oct 21, 2021 at 11:16 AM Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> At least it seems to work with our WCS service
>
> gdallocationinfo WCS:
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli
> -wgs84 27 68
>
> Report:
>
>   Location: (228000P,119567L)
>
>   Band 1:
>
>     Value: 303.463989257812
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Carl
> Godkin
> *L?hetetty:* torstai 21. lokakuuta 2021 18.47
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdallocationinfo + WCS question...
>
>
>
> Hi,
>
>
>
> I am trying to use gdallocationinfo to query point locations from a WCS
> server and not having any luck. I don't see anything in the docs that says
> this is unsupported but I can't make it work.
>
>
>
> First of all, is there a better way to get an elevation from a given
> lat,lon using WCS?
>
>
>
> Here's an example query using the USGS National Map server:
>
>
>
> gdallocationinfo "WCS:
> https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation"
> -wgs84 -122.086 42.948 --debug ON
>
>
>
> This is a point in the middle of Crater Lake which I picked since it's
> flat and I know what to expect.
>
>
>
> Anyway, looking at the debug output it appears that the program is
> querying for a GeoTIFF of a VERY large area and that's failing.
>
>
>
> I actually want to do this with my own WCS server but thought it might be
> mis-configured somehow so I tried the USGS server.  With my own server,
> gdallocationinfo seems to be requesting a strange shape from the server (as
> I can see through the debug output).
>
>
>
> Thanks for any help,
>
>
>
> carl
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/6b69a9c7/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Oct 21 12:26:03 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 21 Oct 2021 19:26:03 +0000
Subject: [gdal-dev] gdallocationinfo + WCS question...
Message-ID: <252fa55861294ab6a1a00d133824b5df@maanmittauslaitos.fi>

Hi,

My first test was:
gdallocationinfo  "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 10 20 --debug on

Generated request was:
WCS: Requesting https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=DEP3Elevation&SUBSET=x%281112188.7215549201,1113212.7215446942%29&SUBSET=y%282272938.1370637044,2273450.1370585896%29&Format=image/tiff

Gdallocationfo showed:
    Value: 0

Maybe it is a right value, I do not know. I got zero value also with -wgs84 27 68. Now I tried with the coordinates that you used -wgs84 -122.086 42.948 but it leads into server error after GDAL sent this request with quite a large subsets:
WCS: Requesting https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=DEP3Elevation&SUBSET=x%28-20037507.0672000013,-13590403.131594259%29&SUBSET=y%285303978.1067894027,5304490.1067842878%29&Format=image/tiff

-Jukka-





L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Ari Jolma
L?hetetty: torstai 21. lokakuuta 2021 22.09
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdallocationinfo + WCS question...


I don't understand the problem :)

Maybe it's because I ran gdalinfo on the WCS first.

For the gdallocationinfo I get

gdallocationinfo "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 -122.086 42.948
Report:
  Location: (6446955P,13504941L)
  Band 1:
    Value: 1882.00549316406

Ari
Rahkonen Jukka (MML) kirjoitti 21.10.2021 klo 21.56:
Hi,

I wonder if the problem is in the multipart response that the nationalmap.gov server is sending. The result is not too big tiff (1023x511 pixels as revealed by <gml:high>1023 511</gml:high>) but perhaps GDAL does not know how to extract it from the multipart envelope. I do not know either. I thought that multipart was only an issue with WCS 1.1.x but obviously it can be used also with WCS 2.0. I do understand how brilliant idea multipart response is in theory but unfortunately it is a pain for the users.

This is the beginning of the response:

--wcs
Content-Type: text/xml
Content-ID: GML-Part
  <gml:boundedBy>
    <gml:Envelope srsName=http://www.opengis.net/def/crs/EPSG/0/3857 axisLabels="x y" uomLabels=" " srsDimension="2">
      <gml:lowerCorner>3005564.702644 10446506.055425</gml:lowerCorner>
      <gml:upperCorner>3006588.702633 10447018.055420</gml:upperCorner>
    </gml:Envelope>
  </gml:boundedBy>
  <gml:domainSet>
    <gml:RectifiedGrid dimension="2" gml:id="grid_Coverage1">
      <gml:limits>
        <gml:GridEnvelope>
          <gml:low>0 0</gml:low>
          <gml:high>1023 511</gml:high>
        </gml:GridEnvelope>
      </gml:limits>
      <gml:axisLabels>band_1</gml:axisLabels>
      <gml:origin>
        <gml:Point gml:id="grid_origin_Coverage1" srsName=http://www.opengis.net/def/crs/EPSG/0/3857>
          <gml:pos>3005564.702644 10446506.055425</gml:pos>
        </gml:Point>
      </gml:origin>
      <gml:offsetVector srsName=http://www.opengis.net/def/crs/EPSG/0/3857>XOFFSET1.000000XOFFSET 0 </gml:offsetVector>
      <gml:offsetVector srsName=http://www.opengis.net/def/crs/EPSG/0/3857>0 YOFFSET1.000000YOFFSET </gml:offsetVector>
    </gml:RectifiedGrid>
  </gml:domainSet>
  <gml:rangeSet>
    <gml:File>
      <gml:rangeParameters xlink:href=cid:Coverage1.tif xlink:role=http://www.opengis.net/spec/WCS_coverageencoding_geotiff/1.0/ xlink:arcrole="fileReference"/>
      <gml:fileReference>cid:Coverage1.tif</gml:fileReference<cid:Coverage1.tif%3c/gml:fileReference>>
      <gml:fileStructure/>
      <gml:mimeType>image/tiff</gml:mimeType>
    </gml:File>
  </gml:rangeSet>
  <gmlcov:rangeType>
    <swe:DataRecord>
      <swe:field name="band_1">
        <swe:Quantity>
          <swe:description>band_1</swe:description>
          <swe:uom code="unknown"/>
          <swe:constraint>
            <swe:AllowedValues>
              <swe:interval>3.4E-38 3.4E+38</swe:interval>
            </swe:AllowedValues>
          </swe:constraint>
        </swe:Quantity>
      </swe:field>
    </swe:DataRecord>
  </gmlcov:rangeType>
</gmlcov:RectifiedGridCoverage>
--wcs
Content-Type: image/tiff
Content-Description: coverage data
Content-Transfer-Encoding: binary
Content-ID: 1.tif
?

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> Puolesta Carl Godkin
L?hetetty: torstai 21. lokakuuta 2021 18.47
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdallocationinfo + WCS question...

Hi,

I am trying to use gdallocationinfo to query point locations from a WCS server and not having any luck. I don't see anything in the docs that says this is unsupported but I can't make it work.

First of all, is there a better way to get an elevation from a given lat,lon using WCS?

Here's an example query using the USGS National Map server:

gdallocationinfo "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 -122.086 42.948 --debug ON

This is a point in the middle of Crater Lake which I picked since it's flat and I know what to expect.

Anyway, looking at the debug output it appears that the program is querying for a GeoTIFF of a VERY large area and that's failing.

I actually want to do this with my own WCS server but thought it might be mis-configured somehow so I tried the USGS server.  With my own server, gdallocationinfo seems to be requesting a strange shape from the server (as I can see through the debug output).

Thanks for any help,

carl




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/c85bd748/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Oct 21 12:32:57 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 21 Oct 2021 19:32:57 +0000
Subject: [gdal-dev] gdallocationinfo + WCS question...
Message-ID: <1d4a34ed5fb54970b5cfcdf0db1da2fc@maanmittauslaitos.fi>

Hi,
Try to run first
gdalinfo "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1"

and repeat the test then. If it works Ari may be able to tell why.

-Jukka-


Ari may be able to explain

L?hett?j?: Carl Godkin <cgodkin at gmail.com>
L?hetetty: torstai 21. lokakuuta 2021 22.25
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdallocationinfo + WCS question...

Hi Jukka,

Strangely, the command you pasted doesn't work for me, at with GDAL 3.3.1 on Windows (with quotes added appropriately):

gdallocationinfo "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli" -wgs84 27 68
ERROR 1: PROJ: proj_uom_get_info_from_database: unit of measure not found
Report:
  Location: (228000P,119567L)
  Band 1:
ERROR 1: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 1: IReadBlock failed at X offset 222, Y offset 233: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

  Band 2:
ERROR 1: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 2: IReadBlock failed at X offset 222, Y offset 233: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

  Band 3:
ERROR 1: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 3: IReadBlock failed at X offset 222, Y offset 233: Returned tile does not match expected band configuration.
Response has 1 bands while this dataset has 3 bands.

I find that somewhat reassuring since I get a similar error when querying my own WCS server (that you helped me set up over the past couple of days):

gdallocationinfo "WCS:http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid" -wgs84 -122.086 42.948
Report:
  Location: (3498P,8465L)
  Band 1:
ERROR 1: Returned tile does not match expected configuration.
Got 4094x512 instead of 1024x512.
ERROR 1: C:\Users\carl\.gdal\wcs_cache\hcoMu.xml, band 1: IReadBlock failed at X offset 3, Y offset 16: Returned tile does not match expected configuration.
Got 4094x512 instead of 1024x512.

Or, with --debug ON:

gdallocationinfo "WCS:http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid" -wgs84 -122.086 42.948 --debug ON
GDAL: GDALOpen(WCS:http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid, this=00000228A4B2B970) succeeds as WCS.
Report:
  Location: (3498P,8465L)
  Band 1:
GDAL: GDAL_CACHEMAX = 6535 MB
WCS: Requesting http://localhost:8080/wcs?service=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=SRTM_3_arc-second_grid&SUBSET=long%28-125,-121.5880315%29&SUBSET=lat%2842.749567499999998,43.176063499999998%29&Format=image/tiff
HTTP: Fetch(http://localhost:8080/wcs?service=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=SRTM_3_arc-second_grid&SUBSET=long%28-125,-121.5880315%29&SUBSET=lat%2842.749567499999998,43.176063499999998%29&Format=image/tiff)
HTTP: libcurl/7.78.0 Schannel zlib/1.2.11 libssh2/1.9.0
HTTP: GDAL was built against curl 7.77.0, but is running against 7.78.0.
WCS: GDALOpenResult() on content-type: image/tiff
GDAL: GDALOpen(/vsimem/wcs/00000228A4B2B970/wcsresult.dat, this=00000228A4CEEC40) succeeds as GTiff.
ERROR 1: Returned tile does not match expected configuration.
Got 4094x512 instead of 1024x512.
GDAL: GDALClose(/vsimem/wcs/00000228A4B2B970/wcsresult.dat, this=00000228A4CEEC40)
ERROR 1: C:\Users\carl\.gdal\wcs_cache\hcoMu.xml, band 1: IReadBlock failed at X offset 3, Y offset 16: Returned tile does not match expected configuration.
Got 4094x512 instead of 1024x512.
GDAL: GDALClose(C:\Users\carl\.gdal\wcs_cache\hcoMu.xml, this=00000228A4B2B970)

Any suggestions?  If I break the above debug output down and use "curl" to download the GeoTIFF and then use gdallocationinfo on the downloaded file, I get a reasonable result.
I guess I could do that.  But what I find very strange is that gdallocationinfo seems to request a rather odd-shaped patch (-125 to -121.5 in longitude, but only 42.75 to 43.18 in latitude) which cases trouble.

Thanks a lot,

carl




On Thu, Oct 21, 2021 at 11:16 AM Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

At least it seems to work with our WCS service

gdallocationinfo WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli -wgs84 27 68
Report:
  Location: (228000P,119567L)
  Band 1:
    Value: 303.463989257812

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Carl Godkin
L?hetetty: torstai 21. lokakuuta 2021 18.47
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdallocationinfo + WCS question...

Hi,

I am trying to use gdallocationinfo to query point locations from a WCS server and not having any luck. I don't see anything in the docs that says this is unsupported but I can't make it work.

First of all, is there a better way to get an elevation from a given lat,lon using WCS?

Here's an example query using the USGS National Map server:

gdallocationinfo "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 -122.086 42.948 --debug ON

This is a point in the middle of Crater Lake which I picked since it's flat and I know what to expect.

Anyway, looking at the debug output it appears that the program is querying for a GeoTIFF of a VERY large area and that's failing.

I actually want to do this with my own WCS server but thought it might be mis-configured somehow so I tried the USGS server.  With my own server, gdallocationinfo seems to be requesting a strange shape from the server (as I can see through the debug output).

Thanks for any help,

carl

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/39740416/attachment-0001.html>

From even.rouault at spatialys.com  Thu Oct 21 12:49:50 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 21 Oct 2021 21:49:50 +0200
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <9b40f8241a0c4e6380b2d6f99a6d3a30@maanmittauslaitos.fi>
References: <9b40f8241a0c4e6380b2d6f99a6d3a30@maanmittauslaitos.fi>
Message-ID: <1e84a8df-473e-31c8-4693-fba099c62cac@spatialys.com>

Jukka,

I don't understand how you get a non-error on the below request on your 
WCS service:

https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=korkeusmalli__korkeusmalli&FORMAT=text/xml 
advertizes 3 bands

but the GeoTIFF returned by

https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=korkeusmalli__korkeusmalli&SUBSET=E%28498656,500704%29&SUBSET=N%287542384,7543408%29&Format=image/tiff

has just one band.

Or maybe you have in your ~/gdal/wcs_cache a previous version of the 
DescribeCoverage response that advertizes just one band ?


And for what is worth,

gdallocationinfo 
"WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation 
<https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation>" 
-wgs84 -122.086 42.948 --debug ON

returns 1882.00549316406 for me

The multipart answer doesn't seem to be an issue.


Le 21/10/2021 ? 20:16, Rahkonen Jukka (MML) a ?crit?:
>
> Hi,
>
> At least it seems to work with our WCS service
>
> gdallocationinfo 
> WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli 
> <https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli> 
> -wgs84 27 68
>
> Report:
>
> ? Location: (228000P,119567L)
>
> ? Band 1:
>
> ??? Value: 303.463989257812
>
> -Jukka Rahkonen-
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta 
> *Carl Godkin
> *L?hetetty:* torstai 21. lokakuuta 2021 18.47
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdallocationinfo + WCS question...
>
> Hi,
>
> I am trying to use gdallocationinfo to query point locations from a 
> WCS server and not having any luck. I don't see anything in the docs 
> that says this is unsupported but I can't make it work.
>
> First of all, is there a better way to get an elevation from a given 
> lat,lon using WCS?
>
> Here's an example query using the USGS National Map server:
>
> gdallocationinfo 
> "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation 
> <https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation>" 
> -wgs84 -122.086 42.948 --debug ON
>
> This is a point in the middle of Crater Lake which I picked since it's 
> flat and I know what to expect.
>
> Anyway, looking at the debug output it appears that the program is 
> querying for a GeoTIFF of a VERY large area and that's failing.
>
> I actually want to do this with my own WCS server but thought it might 
> be mis-configured somehow so I tried the USGS server.? With my own 
> server, gdallocationinfo seems to be requesting a strange shape from 
> the server (as I can see through the debug output).
>
> Thanks for any help,
>
> carl
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/b08b2fcb/attachment.html>

From cgodkin at gmail.com  Thu Oct 21 12:53:25 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 21 Oct 2021 12:53:25 -0700
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <1d4a34ed5fb54970b5cfcdf0db1da2fc@maanmittauslaitos.fi>
References: <1d4a34ed5fb54970b5cfcdf0db1da2fc@maanmittauslaitos.fi>
Message-ID: <CAE=8kmkzacc=gVRFn1G+dOEbHM3oLyOZGLka1AhKSVAUQfE+gg@mail.gmail.com>

Thanks, Ari and Jukka.

Even running gdalinfo on the WCS server ahead of gdallocationinfo does not
help for either Jukka's server or the National Map server.

Although I tried originally on Windows 10 with GDAL 3.3.1, I have also
tried all of this from an RHEL 7 system (with GDAL 3.0.2) and WSL/Ubuntu
with 3.0.2.  I even tried the GDAL 2.4.4 that came bundled with MS4W and no
joy there either.

I am pretty puzzled by this behavior.  Most of the time I install GDAL with
"conda install gdal" but I can't believe I'm getting a broken version of
GDAL there.  Oh, and the RHEL 7 system is elsewhere, so it's not some weird
filtering on my computer's connection as far as I can tell.

Thanks for the help,

carl




On Thu, Oct 21, 2021 at 12:32 PM Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
> Try to run first
> gdalinfo "WCS:
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1
> "
>
>
>
> and repeat the test then. If it works Ari may be able to tell why.
>
>
>
> -Jukka-
>
>
>
>
>
> Ari may be able to explain
>
>
>
> *L?hett?j?:* Carl Godkin <cgodkin at gmail.com>
> *L?hetetty:* torstai 21. lokakuuta 2021 22.25
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] gdallocationinfo + WCS question...
>
>
>
> Hi Jukka,
>
>
>
> Strangely, the command you pasted doesn't work for me, at with GDAL 3.3.1
> on Windows (with quotes added appropriately):
>
>
>
> gdallocationinfo "WCS:
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli"
> -wgs84 27 68
> ERROR 1: PROJ: proj_uom_get_info_from_database: unit of measure not found
> Report:
>   Location: (228000P,119567L)
>   Band 1:
> ERROR 1: Returned tile does not match expected band configuration.
> Response has 1 bands while this dataset has 3 bands.
>
> ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 1: IReadBlock
> failed at X offset 222, Y offset 233: Returned tile does not match expected
> band configuration.
> Response has 1 bands while this dataset has 3 bands.
>
>   Band 2:
> ERROR 1: Returned tile does not match expected band configuration.
> Response has 1 bands while this dataset has 3 bands.
>
> ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 2: IReadBlock
> failed at X offset 222, Y offset 233: Returned tile does not match expected
> band configuration.
> Response has 1 bands while this dataset has 3 bands.
>
>   Band 3:
> ERROR 1: Returned tile does not match expected band configuration.
> Response has 1 bands while this dataset has 3 bands.
>
> ERROR 1: C:\Users\carl\.gdal\wcs_cache\nhXWS.xml, band 3: IReadBlock
> failed at X offset 222, Y offset 233: Returned tile does not match expected
> band configuration.
> Response has 1 bands while this dataset has 3 bands.
>
>
>
> I find that somewhat reassuring since I get a similar error when querying
> my own WCS server (that you helped me set up over the past couple of days):
>
>
>
> gdallocationinfo "WCS:
> http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid"
> -wgs84 -122.086 42.948
> Report:
>   Location: (3498P,8465L)
>   Band 1:
> ERROR 1: Returned tile does not match expected configuration.
> Got 4094x512 instead of 1024x512.
> ERROR 1: C:\Users\carl\.gdal\wcs_cache\hcoMu.xml, band 1: IReadBlock
> failed at X offset 3, Y offset 16: Returned tile does not match expected
> configuration.
> Got 4094x512 instead of 1024x512.
>
>
>
> Or, with --debug ON:
>
>
>
> gdallocationinfo "WCS:
> http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid"
> -wgs84 -122.086 42.948 --debug ON
> GDAL: GDALOpen(WCS:
> http://localhost:8080/wcs?service=WCS&version=2.0.1&coverageid=SRTM_3_arc-second_grid,
> this=00000228A4B2B970) succeeds as WCS.
> Report:
>   Location: (3498P,8465L)
>   Band 1:
> GDAL: GDAL_CACHEMAX = 6535 MB
> WCS: Requesting
> http://localhost:8080/wcs?service=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=SRTM_3_arc-second_grid&SUBSET=long%28-125,-121.5880315%29&SUBSET=lat%2842.749567499999998,43.176063499999998%29&Format=image/tiff
> HTTP: Fetch(
> http://localhost:8080/wcs?service=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=SRTM_3_arc-second_grid&SUBSET=long%28-125,-121.5880315%29&SUBSET=lat%2842.749567499999998,43.176063499999998%29&Format=image/tiff
> )
> HTTP: libcurl/7.78.0 Schannel zlib/1.2.11 libssh2/1.9.0
> HTTP: GDAL was built against curl 7.77.0, but is running against 7.78.0.
> WCS: GDALOpenResult() on content-type: image/tiff
> GDAL: GDALOpen(/vsimem/wcs/00000228A4B2B970/wcsresult.dat,
> this=00000228A4CEEC40) succeeds as GTiff.
> ERROR 1: Returned tile does not match expected configuration.
> Got 4094x512 instead of 1024x512.
> GDAL: GDALClose(/vsimem/wcs/00000228A4B2B970/wcsresult.dat,
> this=00000228A4CEEC40)
> ERROR 1: C:\Users\carl\.gdal\wcs_cache\hcoMu.xml, band 1: IReadBlock
> failed at X offset 3, Y offset 16: Returned tile does not match expected
> configuration.
> Got 4094x512 instead of 1024x512.
> GDAL: GDALClose(C:\Users\carl\.gdal\wcs_cache\hcoMu.xml,
> this=00000228A4B2B970)
>
>
>
> Any suggestions?  If I break the above debug output down and use "curl" to
> download the GeoTIFF and then use gdallocationinfo on the downloaded file,
> I get a reasonable result.
>
> I guess I could do that.  But what I find very strange is that
> gdallocationinfo seems to request a rather odd-shaped patch (-125 to -121.5
> in longitude, but only 42.75 to 43.18 in latitude) which cases trouble.
>
>
>
> Thanks a lot,
>
>
>
> carl
>
>
>
>
>
>
>
>
>
> On Thu, Oct 21, 2021 at 11:16 AM Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> At least it seems to work with our WCS service
>
> gdallocationinfo WCS:
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli
> -wgs84 27 68
>
> Report:
>
>   Location: (228000P,119567L)
>
>   Band 1:
>
>     Value: 303.463989257812
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Carl
> Godkin
> *L?hetetty:* torstai 21. lokakuuta 2021 18.47
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdallocationinfo + WCS question...
>
>
>
> Hi,
>
>
>
> I am trying to use gdallocationinfo to query point locations from a WCS
> server and not having any luck. I don't see anything in the docs that says
> this is unsupported but I can't make it work.
>
>
>
> First of all, is there a better way to get an elevation from a given
> lat,lon using WCS?
>
>
>
> Here's an example query using the USGS National Map server:
>
>
>
> gdallocationinfo "WCS:
> https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation"
> -wgs84 -122.086 42.948 --debug ON
>
>
>
> This is a point in the middle of Crater Lake which I picked since it's
> flat and I know what to expect.
>
>
>
> Anyway, looking at the debug output it appears that the program is
> querying for a GeoTIFF of a VERY large area and that's failing.
>
>
>
> I actually want to do this with my own WCS server but thought it might be
> mis-configured somehow so I tried the USGS server.  With my own server,
> gdallocationinfo seems to be requesting a strange shape from the server (as
> I can see through the debug output).
>
>
>
> Thanks for any help,
>
>
>
> carl
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/eb2307d4/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Oct 21 13:32:47 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Thu, 21 Oct 2021 20:32:47 +0000
Subject: [gdal-dev] gdallocationinfo + WCS question...
Message-ID: <ae9dc713ca4846a1942c99c645699d21@maanmittauslaitos.fi>

Hi Even,

You are right, re-running the request -oo clear_cache gives me the same error about 3 bands. Obviously our server was configured right when I used it with GDAL last time. Now gdallocationinfo does not work even for me because I wiped the working configuration from my cache. We will fix the service metadata when we go from beta to official soon.

The nationalmap.gov service does not still work for me. I cleared the cache but I still get a 404 error from the server. Subsets in the reques are these
SUBSET=x(-20037507.0672000013,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)
and gdallocationinfo error is this:

Report:
  Location: (6446955P,13504941L)
  Band 1:
ERROR 1: HTTP error code : 404
ERROR 1: Failed to get coverage data:
ERROR 1: C:\Users\JRAHKONEN\.gdal\wcs_cache\QpYSX.xml, band 1: IReadBlock failed at X offset 6295, Y offset 26376: Failed to get coverage data:

-Jukka-

L?hett?j?: Even Rouault <even.rouault at spatialys.com>
L?hetetty: torstai 21. lokakuuta 2021 22.50
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>; Carl Godkin <cgodkin at gmail.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdallocationinfo + WCS question...


Jukka,

I don't understand how you get a non-error on the below request on your WCS service:

https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=korkeusmalli__korkeusmalli&FORMAT=text/xml advertizes 3 bands

but the GeoTIFF returned by

https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=korkeusmalli__korkeusmalli&SUBSET=E%28498656,500704%29&SUBSET=N%287542384,7543408%29&Format=image/tiff

has just one band.

Or maybe you have in your ~/gdal/wcs_cache a previous version of the DescribeCoverage response that advertizes just one band ?



And for what is worth,

gdallocationinfo "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 -122.086 42.948 --debug ON

returns 1882.00549316406 for me

The multipart answer doesn't seem to be an issue.


Le 21/10/2021 ? 20:16, Rahkonen Jukka (MML) a ?crit :
Hi,

At least it seems to work with our WCS service

gdallocationinfo WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli -wgs84 27 68
Report:
  Location: (228000P,119567L)
  Band 1:
    Value: 303.463989257812

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> Puolesta Carl Godkin
L?hetetty: torstai 21. lokakuuta 2021 18.47
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdallocationinfo + WCS question...

Hi,

I am trying to use gdallocationinfo to query point locations from a WCS server and not having any luck. I don't see anything in the docs that says this is unsupported but I can't make it work.

First of all, is there a better way to get an elevation from a given lat,lon using WCS?

Here's an example query using the USGS National Map server:

gdallocationinfo "WCS:https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation" -wgs84 -122.086 42.948 --debug ON

This is a point in the middle of Crater Lake which I picked since it's flat and I know what to expect.

Anyway, looking at the debug output it appears that the program is querying for a GeoTIFF of a VERY large area and that's failing.

I actually want to do this with my own WCS server but thought it might be mis-configured somehow so I tried the USGS server.  With my own server, gdallocationinfo seems to be requesting a strange shape from the server (as I can see through the debug output).

Thanks for any help,

carl




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/bde6a580/attachment.html>

From cgodkin at gmail.com  Thu Oct 21 13:47:13 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 21 Oct 2021 13:47:13 -0700
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <ae9dc713ca4846a1942c99c645699d21@maanmittauslaitos.fi>
References: <ae9dc713ca4846a1942c99c645699d21@maanmittauslaitos.fi>
Message-ID: <CAE=8kmncZ+caPTEjENd0RMkTt1dgYkgEfThdGU3iFS5Nr42APQ@mail.gmail.com>

Hi again,

Like Jukka, I get a 404 from the National Map server.  (I kept removing the
cache directory just in case that mattered.)

I just asked a colleague in Texas to try the National Map WCS command and
it's not working for him either so Ari and Even are apparently lucky!

Thanks,
carl


On Thu, Oct 21, 2021 at 1:32 PM Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi Even,
>
>
>
> You are right, re-running the request -oo clear_cache gives me the same
> error about 3 bands. Obviously our server was configured right when I used
> it with GDAL last time. Now gdallocationinfo does not work even for me
> because I wiped the working configuration from my cache. We will fix the
> service metadata when we go from beta to official soon.
>
>
>
> The nationalmap.gov service does not still work for me. I cleared the
> cache but I still get a 404 error from the server. Subsets in the reques
> are these
>
> SUBSET=x(-20037507.0672000013,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)
>
> and gdallocationinfo error is this:
>
>
>
> Report:
>
>   Location: (6446955P,13504941L)
>
>   Band 1:
>
> ERROR 1: HTTP error code : 404
>
> ERROR 1: Failed to get coverage data:
>
> ERROR 1: C:\Users\JRAHKONEN\.gdal\wcs_cache\QpYSX.xml, band 1: IReadBlock
> failed at X offset 6295, Y offset 26376: Failed to get coverage data:
>
>
>
> -Jukka-
>
>
>
> *L?hett?j?:* Even Rouault <even.rouault at spatialys.com>
> *L?hetetty:* torstai 21. lokakuuta 2021 22.50
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>;
> Carl Godkin <cgodkin at gmail.com>; gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] gdallocationinfo + WCS question...
>
>
>
> Jukka,
>
> I don't understand how you get a non-error on the below request on your
> WCS service:
>
>
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION=2.0.1&COVERAGEID=korkeusmalli__korkeusmalli&FORMAT=text/xml
> advertizes 3 bands
>
> but the GeoTIFF returned by
>
>
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?SERVICE=WCS&REQUEST=GetCoverage&VERSION=2.0.1&COVERAGEID=korkeusmalli__korkeusmalli&SUBSET=E%28498656,500704%29&SUBSET=N%287542384,7543408%29&Format=image/tiff
>
> has just one band.
>
> Or maybe you have in your ~/gdal/wcs_cache a previous version of the
> DescribeCoverage response that advertizes just one band ?
>
>
>
> And for what is worth,
>
> gdallocationinfo "WCS:
> https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation"
> -wgs84 -122.086 42.948 --debug ON
>
> returns 1882.00549316406 for me
>
> The multipart answer doesn't seem to be an issue.
>
>
>
> Le 21/10/2021 ? 20:16, Rahkonen Jukka (MML) a ?crit :
>
> Hi,
>
>
>
> At least it seems to work with our WCS service
>
> gdallocationinfo WCS:
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=korkeusmalli__korkeusmalli
> -wgs84 27 68
>
> Report:
>
>   Location: (228000P,119567L)
>
>   Band 1:
>
>     Value: 303.463989257812
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
> <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Carl Godkin
> *L?hetetty:* torstai 21. lokakuuta 2021 18.47
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdallocationinfo + WCS question...
>
>
>
> Hi,
>
>
>
> I am trying to use gdallocationinfo to query point locations from a WCS
> server and not having any luck. I don't see anything in the docs that says
> this is unsupported but I can't make it work.
>
>
>
> First of all, is there a better way to get an elevation from a given
> lat,lon using WCS?
>
>
>
> Here's an example query using the USGS National Map server:
>
>
>
> gdallocationinfo "WCS:
> https://elevation.nationalmap.gov:443/arcgis/services/3DEPElevation/ImageServer/WCSServer?version=2.0.1&coverage=DEP3Elevation"
> -wgs84 -122.086 42.948 --debug ON
>
>
>
> This is a point in the middle of Crater Lake which I picked since it's
> flat and I know what to expect.
>
>
>
> Anyway, looking at the debug output it appears that the program is
> querying for a GeoTIFF of a VERY large area and that's failing.
>
>
>
> I actually want to do this with my own WCS server but thought it might be
> mis-configured somehow so I tried the USGS server.  With my own server,
> gdallocationinfo seems to be requesting a strange shape from the server (as
> I can see through the debug output).
>
>
>
> Thanks for any help,
>
>
>
> carl
>
>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/71306c71/attachment-0001.html>

From even.rouault at spatialys.com  Thu Oct 21 13:48:58 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 21 Oct 2021 22:48:58 +0200
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <ae9dc713ca4846a1942c99c645699d21@maanmittauslaitos.fi>
References: <ae9dc713ca4846a1942c99c645699d21@maanmittauslaitos.fi>
Message-ID: <913f9009-f749-06ec-9cf3-c9d434555dcc@spatialys.com>


Le 21/10/2021 ? 22:32, Rahkonen Jukka (MML) a ?crit?:
>
> Hi Even,
>
> You are right, re-running the request -oo clear_cache gives me the 
> same error about 3 bands. Obviously our server was configured right 
> when I used it with GDAL last time. Now gdallocationinfo does not work 
> even for me because I wiped the working configuration from my cache. 
> We will fix the service metadata when we go from beta to official soon.
>
> The nationalmap.gov service does not still work for me. I cleared the 
> cache but I still get a 404 error from the server. Subsets in the 
> reques are these
> SUBSET=x(-20037507.0672000013,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)
>
The xmin value in the request you get is obviously wrong. The subset I 
get with GDAL master and head of 3.3 branch is:

SUBSET=x%(-13591427.131584032,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)

I suspect you might use a GDAL release version, that hasn't yet received 
the following recent fix that is likely related to that issue and will 
be in 3.3.3 and 3.4.0:

https://github.com/OSGeo/gdal/commit/8af67b64371c275a3770e75da1bd0d4bb7329295

(I get the same error as you with the 3.2 branch, so I strongly suspect 
the above is indeed the fix for that)

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/ec54e098/attachment.html>

From cgodkin at gmail.com  Thu Oct 21 14:00:40 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 21 Oct 2021 14:00:40 -0700
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <913f9009-f749-06ec-9cf3-c9d434555dcc@spatialys.com>
References: <ae9dc713ca4846a1942c99c645699d21@maanmittauslaitos.fi>
 <913f9009-f749-06ec-9cf3-c9d434555dcc@spatialys.com>
Message-ID: <CAE=8kmnyGn+fKvFNwkCU0XVaAgvqePG+5Dr9_DK4RQF662y1Qg@mail.gmail.com>

Thanks, Even.

That makes sense.  (Finally!)  I can wait a little bit to come back to this
so I'll either build 3.3 HEAD on my own or await the next release.

It's great that this isn't a random server load thing or something!

The weird result on my own WCS server also seemed to be caused by a bad
"xmin" value which is how I started down this road.

Thanks again,

carl




On Thu, Oct 21, 2021 at 1:49 PM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> Le 21/10/2021 ? 22:32, Rahkonen Jukka (MML) a ?crit :
>
> Hi Even,
>
>
>
> You are right, re-running the request -oo clear_cache gives me the same
> error about 3 bands. Obviously our server was configured right when I used
> it with GDAL last time. Now gdallocationinfo does not work even for me
> because I wiped the working configuration from my cache. We will fix the
> service metadata when we go from beta to official soon.
>
>
>
> The nationalmap.gov service does not still work for me. I cleared the
> cache but I still get a 404 error from the server. Subsets in the reques
> are these
>
> SUBSET=x(-20037507.0672000013,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)
>
> The xmin value in the request you get is obviously wrong. The subset I get
> with GDAL master and head of 3.3 branch is:
>
>
> SUBSET=x%(-13591427.131584032,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)
>
> I suspect you might use a GDAL release version, that hasn't yet received
> the following recent fix that is likely related to that issue and will be
> in 3.3.3 and 3.4.0:
>
>
> https://github.com/OSGeo/gdal/commit/8af67b64371c275a3770e75da1bd0d4bb7329295
>
> (I get the same error as you with the 3.2 branch, so I strongly suspect
> the above is indeed the fix for that)
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211021/192fc388/attachment.html>

From sebastien.guimmara at airbus.com  Fri Oct 22 01:22:54 2021
From: sebastien.guimmara at airbus.com (=?iso-8859-1?Q?GUIMMARA=2C_S=E9bastien?=)
Date: Fri, 22 Oct 2021 08:22:54 +0000
Subject: [gdal-dev] DIMAP driver ignores JP2 world file (J2W)
Message-ID: <659c5700e0804ba8a740b1a625bf8faa@CD1-4DDAG04-P02.cdmail.common.airbusds.corp>

Hello,

When accessing a DIMAP dataset using the DIMAP driver, the returned GeoTransform has the default values (0 1 0 0 0 1) and the image is incorrectly displayed.

However, when I access the underlying raster directly (a JP2 file),the JP2ECW driver correctly reads the GeoTransform from the associated world file (.J2W) and the image is correctly displayed.

Is this a known issue in the DIMAP driver ?

S?bastien
The information in this e-mail is confidential. The contents may not be disclosed or used by anyone other than the addressee. Access to this e-mail by anyone else is unauthorised.
If you are not the intended recipient, please notify Airbus immediately and delete this e-mail.
Airbus cannot accept any responsibility for the accuracy or completeness of this e-mail as it has been sent over public networks. If you have any concerns over the content of this message or its Accuracy or Integrity, please contact Airbus immediately.
All outgoing e-mails from Airbus are checked using regularly updated virus scanning software but you should take whatever measures you deem to be appropriate to ensure that this message and any attachments are virus free.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211022/6931bfba/attachment.html>

From thomas.bonfort at gmail.com  Fri Oct 22 02:16:17 2021
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Fri, 22 Oct 2021 11:16:17 +0200
Subject: [gdal-dev] DIMAP driver ignores JP2 world file (J2W)
In-Reply-To: <659c5700e0804ba8a740b1a625bf8faa@CD1-4DDAG04-P02.cdmail.common.airbusds.corp>
References: <659c5700e0804ba8a740b1a625bf8faa@CD1-4DDAG04-P02.cdmail.common.airbusds.corp>
Message-ID: <CAOM3y2ijAXGrA5FLP+JxtL0NMqaLCwAfch_OX=Zi4TDFHcC5pQ@mail.gmail.com>

This is mostly likely due to an issue with your dimap. The dimap
driver correctly handles the geotransform for ortho images, or RPCs
for primary images in all cases I have encountered.
regards,
thomas

On Fri, Oct 22, 2021 at 10:31 AM GUIMMARA, S?bastien via gdal-dev
<gdal-dev at lists.osgeo.org> wrote:
>
> Hello,
>
>
>
> When accessing a DIMAP dataset using the DIMAP driver, the returned GeoTransform has the default values (0 1 0 0 0 1) and the image is incorrectly displayed.
>
>
>
> However, when I access the underlying raster directly (a JP2 file),the JP2ECW driver correctly reads the GeoTransform from the associated world file (.J2W) and the image is correctly displayed.
>
>
>
> Is this a known issue in the DIMAP driver ?
>
>
>
> S?bastien
>
> The information in this e-mail is confidential. The contents may not be disclosed or used by anyone other than the addressee. Access to this e-mail by anyone else is unauthorised.
> If you are not the intended recipient, please notify Airbus immediately and delete this e-mail.
> Airbus cannot accept any responsibility for the accuracy or completeness of this e-mail as it has been sent over public networks. If you have any concerns over the content of this message or its Accuracy or Integrity, please contact Airbus immediately.
> All outgoing e-mails from Airbus are checked using regularly updated virus scanning software but you should take whatever measures you deem to be appropriate to ensure that this message and any attachments are virus free.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From neteler at osgeo.org  Fri Oct 22 12:35:29 2021
From: neteler at osgeo.org (Markus Neteler)
Date: Fri, 22 Oct 2021 21:35:29 +0200
Subject: [gdal-dev] Gdal-dev mail archive search sites?
In-Reply-To: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
References: <b1c5f55b78444ecdb57e70c6293dbfff@yukon.ca>
Message-ID: <CALFmHhsQmZnk6FDwa0r5X=no8Z87BXE3sJ+L1XKVt5me+b7Lxw@mail.gmail.com>

Hi,

<Matt.Wilkie at yukon.ca> schrieb am Do., 14. Okt. 2021, 18:03:

> Hi All,
>
> Now that the gdal mail archive on Nabble is gone is what options are there
> for searching through historical threads?
>
What about starting this archive?

https://marc.info/?q=about#Add

The GRASS GIS project's mailing lists are partially mirrored there, see e.g

https://marc.info/?l=grass-user
https://marc.info/?l=grass-dev

MapServer, OSGeo, etc. are there as well.

marc comes with some search functionality.

HTH,

Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211022/31a9a743/attachment.html>

From lve0200 at gmail.com  Sun Oct 24 08:42:52 2021
From: lve0200 at gmail.com (Hans Kurscheidt)
Date: Sun, 24 Oct 2021 17:42:52 +0200
Subject: [gdal-dev] Need code review obtaining elev data in CPP Class (GDAL
 beginner)
Message-ID: <7b25b285-d3fd-8b0e-0cd3-662975a2500d@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211024/bb1d3461/attachment.html>

From lve0200 at gmail.com  Sun Oct 24 08:59:52 2021
From: lve0200 at gmail.com (Hans Kurscheidt)
Date: Sun, 24 Oct 2021 17:59:52 +0200
Subject: [gdal-dev] Need code review obtaining elev data in CPP Class
 (GDAL beginner)
In-Reply-To: <7b25b285-d3fd-8b0e-0cd3-662975a2500d@gmail.com>
References: <7b25b285-d3fd-8b0e-0cd3-662975a2500d@gmail.com>
Message-ID: <57a3e7e5-c5a5-b6fe-6d0f-0a39fc6c4f40@gmail.com>

I came to realize that I apparently sent HTML. I try now send text only.

hk

Am 24.10.2021 um 17:42 schrieb Hans Kurscheidt:
>
> Dears, excuse in my very 1st post here, a bloody beginner's question 
> and probably behavior. I need every now and then an elevation value 
> from WGS84 coordinates _in my application_. What does
>
> gdallocationinfo -valonly -wgs84 /home/hk/eu_dem_v11_E30N20.TIF -1.0 
> 44.0? at console level.
>
> I did read the source code and large parts of the GDAL documentation 
> and the best Class initialization I was able to come up with is this: 
> (I made few vars static to avoid compiler optimization)
>
> class GDALRasterImage {
> public:
> ?? ?GDALRasterImage(const char* filename);
> ?? ?~GDALRasterImage();
> ?? ?int valueAt(double lat, double lon);
>
> private:
> ?? ?GDALDatasetH dataset;
> ?? ?GDALRasterBandH band;
> ?? ?char *pszSourceSRS = nullptr;
> ?? ?double inverseTransform[6];
> ?? ?double datasetTransform[6];
> };
> GDALRasterImage::GDALRasterImage(const char* filename) {
>
> ?? ?double llon = -1, llat = 44;??? static bool rv;
> ?? ?GDALAllRegister();
>
> ?? ?// SanitizeSRS?? to WGS84
> ?? ?CPLErrorReset();
> ?? ?OGRSpatialReferenceH hSRS = OSRNewSpatialReference(nullptr);
> ?? ?CPLFree(pszSourceSRS);
> ?? ?if (OSRSetFromUserInput(hSRS, "WGS84") == OGRERR_NONE)
> ?? ???? OSRExportToWkt(hSRS, &pszSourceSRS);
> ?? ?OSRDestroySpatialReference(hSRS);
>
> ?? ?this->dataset = GDALOpenEx(filename, GDAL_OF_RASTER, nullptr, 
> nullptr, nullptr);
> ?? ?assert(dataset != nullptr);
>
> ?? ?// Assume there is only one band in the raster source and use that
> ?? ?assert(GDALGetRasterCount(dataset) == 1);
> ?? ?this->band = GDALGetRasterBand(dataset, 1);
>
> ?? ?//???? Setup coordinate transformation
> ?? ?static OGRSpatialReferenceH hSrcSRS = nullptr, hTrgSRS = nullptr;
> ?? ?static OGRCoordinateTransformationH hCT = nullptr;
> ?? ?hSrcSRS = OSRNewSpatialReference(pszSourceSRS);
> ?? ?hTrgSRS = OSRNewSpatialReference(GDALGetProjectionRef(dataset));
>
> ?? ?hCT = OCTNewCoordinateTransformation(hSrcSRS, hTrgSRS);
> ?? ?if (hCT == nullptr)? exit(1);
> ?? ?rv= OCTTransform(hCT, 1, &llon, &llat, nullptr);
>
> ?? ?// Get the inverse geo transform to map from geo location -> pixel 
> location
> ?? ?if (GDALGetGeoTransform(dataset, datasetTransform) != CE_None) 
> exit (1);
> ?? ?if (!GDALInvGeoTransform(datasetTransform, inverseTransform)) exit(1);
> }
> The init runs w/out obvious code failures, but when I call
>
> int GDALRasterImage::valueAt(double lat, double lon) {
> ?? ?int x = static_cast<int>(floor(inverseTransform[0] + 
> inverseTransform[1] * lon + inverseTransform[2] * lat));
> ?? ?int y = static_cast<int>(floor(inverseTransform[3] + 
> inverseTransform[4] * lon + inverseTransform[5] * lat));
>
> ?? ?int32_t pixelValue;
> ?? ?GDALRasterIO(band, GF_Read, x, y, 1, 1, &pixelValue, 1, 1, 
> GDT_Int32, 0, 0);
> ?? ?return pixelValue;
> }
>
> with Lon=-1.0 and Lat=44.0 I receive a run time error:
>
> ERROR 5: /home/hk/eu_dem_v11_E30N20.TIF, band 1: Access window out of 
> range in RasterIO().? Requested
> (-120001,119998) of size 1x1 on raster of 40000x40000.
>
> I guess it has to do with the inverse transformation, but for the life 
> of me, I have not the slightest idea, where to search from here.
>
> gdalinfo /home/hk/eu_dem_v11_E30N20.TIF
> Driver: GTiff/GeoTIFF
> Files: /home/hk/eu_dem_v11_E30N20.TIF
> Size is 40000, 40000
> Coordinate System is:
> PROJCS["ETRS89_ETRS_LAEA",
> ??? GEOGCS["ETRS89",
> ??????? DATUM["European_Terrestrial_Reference_System_1989",
> ??????????? SPHEROID["GRS 1980",6378137,298.2572221010042,
> ??????????????? AUTHORITY["EPSG","7019"]],
> ??????????? AUTHORITY["EPSG","6258"]],
> ??????? PRIMEM["Greenwich",0],
> ??????? UNIT["degree",0.0174532925199433],
> ??????? AUTHORITY["EPSG","4258"]],
> ??? PROJECTION["Lambert_Azimuthal_Equal_Area"],
> ??? PARAMETER["latitude_of_center",52],
> ??? PARAMETER["longitude_of_center",10],
> ??? PARAMETER["false_easting",4321000],
> ??? PARAMETER["false_northing",3210000],
> ??? UNIT["metre",1,
> ??????? AUTHORITY["EPSG","9001"]]]
> Origin = (3000000.000000000000000,3000000.000000000000000)
> Pixel Size = (25.000000000000000,-25.000000000000000)
> Metadata:
> ? AREA_OR_POINT=Area
> ? DataType=Elevation
> Image Structure Metadata:
> ? COMPRESSION=LZW
> ? INTERLEAVE=BAND
> Corner Coordinates:
> Upper Left? ( 3000000.000, 3000000.000) (? 8d 7'39.52"W, 48d38'23.47"N)
> Lower Left? ( 3000000.000, 2000000.000) (? 5d28'46.07"W, 39d52'33.70"N)
> Upper Right ( 4000000.000, 3000000.000) (? 5d31' 4.07"E, 50d 1'26.83"N)
> Lower Right ( 4000000.000, 2000000.000) (? 6d11'52.97"E, 41d 1'36.49"N)
> Center????? ( 3500000.000, 2500000.000) (? 0d27' 3.13"W, 45d 5'35.85"N)
> Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
> ? NoData Value=-3.4028234663852886e+38
> ? Metadata:
> ??? BandName=Band_1
> ??? RepresentationType=ATHEMATIC
>
> The transformation data I have are:
>
> datasetTransform[6] contains: 3000000, 25, 0, 3000000, -25
>
> inverseTransform[6] contains: -120000, 0.04, 0, 12000, -0.04, 0
>
>
> Thanks for your help!
>
> hans
>

From j1 at jimenezshaw.com  Sun Oct 24 15:58:55 2021
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 25 Oct 2021 00:58:55 +0200
Subject: [gdal-dev] Need code review obtaining elev data in CPP Class
 (GDAL beginner)
In-Reply-To: <57a3e7e5-c5a5-b6fe-6d0f-0a39fc6c4f40@gmail.com>
References: <7b25b285-d3fd-8b0e-0cd3-662975a2500d@gmail.com>
 <57a3e7e5-c5a5-b6fe-6d0f-0a39fc6c4f40@gmail.com>
Message-ID: <CADRrdKsexgETytaTyUm=CsP0xpZ6UgS9L-m2AKOQj_rBVGTrKw@mail.gmail.com>

If I understand properly what you did... there is a missing transformation
in valueAt

You want to query with lat-lon in wgs84, but the image is in
ETRS89_ETRS_LAEA
So you need to transform the lat-lon in wgs84 to x-y in ETRS89_ETRS_LAEA,
and then to the pixel coordinates using the inverseTransform.

El dom., 24 oct. 2021 18:00, Hans Kurscheidt <lve0200 at gmail.com> escribi?:

> I came to realize that I apparently sent HTML. I try now send text only.
>
> hk
>
> Am 24.10.2021 um 17:42 schrieb Hans Kurscheidt:
> >
> > Dears, excuse in my very 1st post here, a bloody beginner's question
> > and probably behavior. I need every now and then an elevation value
> > from WGS84 coordinates _in my application_. What does
> >
> > gdallocationinfo -valonly -wgs84 /home/hk/eu_dem_v11_E30N20.TIF -1.0
> > 44.0  at console level.
> >
> > I did read the source code and large parts of the GDAL documentation
> > and the best Class initialization I was able to come up with is this:
> > (I made few vars static to avoid compiler optimization)
> >
> > class GDALRasterImage {
> > public:
> >     GDALRasterImage(const char* filename);
> >     ~GDALRasterImage();
> >     int valueAt(double lat, double lon);
> >
> > private:
> >     GDALDatasetH dataset;
> >     GDALRasterBandH band;
> >     char *pszSourceSRS = nullptr;
> >     double inverseTransform[6];
> >     double datasetTransform[6];
> > };
> > GDALRasterImage::GDALRasterImage(const char* filename) {
> >
> >     double llon = -1, llat = 44;    static bool rv;
> >     GDALAllRegister();
> >
> >     // SanitizeSRS   to WGS84
> >     CPLErrorReset();
> >     OGRSpatialReferenceH hSRS = OSRNewSpatialReference(nullptr);
> >     CPLFree(pszSourceSRS);
> >     if (OSRSetFromUserInput(hSRS, "WGS84") == OGRERR_NONE)
> >         OSRExportToWkt(hSRS, &pszSourceSRS);
> >     OSRDestroySpatialReference(hSRS);
> >
> >     this->dataset = GDALOpenEx(filename, GDAL_OF_RASTER, nullptr,
> > nullptr, nullptr);
> >     assert(dataset != nullptr);
> >
> >     // Assume there is only one band in the raster source and use that
> >     assert(GDALGetRasterCount(dataset) == 1);
> >     this->band = GDALGetRasterBand(dataset, 1);
> >
> >     //     Setup coordinate transformation
> >     static OGRSpatialReferenceH hSrcSRS = nullptr, hTrgSRS = nullptr;
> >     static OGRCoordinateTransformationH hCT = nullptr;
> >     hSrcSRS = OSRNewSpatialReference(pszSourceSRS);
> >     hTrgSRS = OSRNewSpatialReference(GDALGetProjectionRef(dataset));
> >
> >     hCT = OCTNewCoordinateTransformation(hSrcSRS, hTrgSRS);
> >     if (hCT == nullptr)  exit(1);
> >     rv= OCTTransform(hCT, 1, &llon, &llat, nullptr);
> >
> >     // Get the inverse geo transform to map from geo location -> pixel
> > location
> >     if (GDALGetGeoTransform(dataset, datasetTransform) != CE_None)
> > exit (1);
> >     if (!GDALInvGeoTransform(datasetTransform, inverseTransform))
> exit(1);
> > }
> > The init runs w/out obvious code failures, but when I call
> >
> > int GDALRasterImage::valueAt(double lat, double lon) {
> >     int x = static_cast<int>(floor(inverseTransform[0] +
> > inverseTransform[1] * lon + inverseTransform[2] * lat));
> >     int y = static_cast<int>(floor(inverseTransform[3] +
> > inverseTransform[4] * lon + inverseTransform[5] * lat));
> >
> >     int32_t pixelValue;
> >     GDALRasterIO(band, GF_Read, x, y, 1, 1, &pixelValue, 1, 1,
> > GDT_Int32, 0, 0);
> >     return pixelValue;
> > }
> >
> > with Lon=-1.0 and Lat=44.0 I receive a run time error:
> >
> > ERROR 5: /home/hk/eu_dem_v11_E30N20.TIF, band 1: Access window out of
> > range in RasterIO().  Requested
> > (-120001,119998) of size 1x1 on raster of 40000x40000.
> >
> > I guess it has to do with the inverse transformation, but for the life
> > of me, I have not the slightest idea, where to search from here.
> >
> > gdalinfo /home/hk/eu_dem_v11_E30N20.TIF
> > Driver: GTiff/GeoTIFF
> > Files: /home/hk/eu_dem_v11_E30N20.TIF
> > Size is 40000, 40000
> > Coordinate System is:
> > PROJCS["ETRS89_ETRS_LAEA",
> >     GEOGCS["ETRS89",
> >         DATUM["European_Terrestrial_Reference_System_1989",
> >             SPHEROID["GRS 1980",6378137,298.2572221010042,
> >                 AUTHORITY["EPSG","7019"]],
> >             AUTHORITY["EPSG","6258"]],
> >         PRIMEM["Greenwich",0],
> >         UNIT["degree",0.0174532925199433],
> >         AUTHORITY["EPSG","4258"]],
> >     PROJECTION["Lambert_Azimuthal_Equal_Area"],
> >     PARAMETER["latitude_of_center",52],
> >     PARAMETER["longitude_of_center",10],
> >     PARAMETER["false_easting",4321000],
> >     PARAMETER["false_northing",3210000],
> >     UNIT["metre",1,
> >         AUTHORITY["EPSG","9001"]]]
> > Origin = (3000000.000000000000000,3000000.000000000000000)
> > Pixel Size = (25.000000000000000,-25.000000000000000)
> > Metadata:
> >   AREA_OR_POINT=Area
> >   DataType=Elevation
> > Image Structure Metadata:
> >   COMPRESSION=LZW
> >   INTERLEAVE=BAND
> > Corner Coordinates:
> > Upper Left  ( 3000000.000, 3000000.000) (  8d 7'39.52"W, 48d38'23.47"N)
> > Lower Left  ( 3000000.000, 2000000.000) (  5d28'46.07"W, 39d52'33.70"N)
> > Upper Right ( 4000000.000, 3000000.000) (  5d31' 4.07"E, 50d 1'26.83"N)
> > Lower Right ( 4000000.000, 2000000.000) (  6d11'52.97"E, 41d 1'36.49"N)
> > Center      ( 3500000.000, 2500000.000) (  0d27' 3.13"W, 45d 5'35.85"N)
> > Band 1 Block=128x128 Type=Float32, ColorInterp=Gray
> >   NoData Value=-3.4028234663852886e+38
> >   Metadata:
> >     BandName=Band_1
> >     RepresentationType=ATHEMATIC
> >
> > The transformation data I have are:
> >
> > datasetTransform[6] contains: 3000000, 25, 0, 3000000, -25
> >
> > inverseTransform[6] contains: -120000, 0.04, 0, 12000, -0.04, 0
> >
> >
> > Thanks for your help!
> >
> > hans
> >
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211025/168de017/attachment.html>

From Azat.Nurgaliev at dlr.de  Mon Oct 25 05:25:44 2021
From: Azat.Nurgaliev at dlr.de (Azat.Nurgaliev at dlr.de)
Date: Mon, 25 Oct 2021 12:25:44 +0000
Subject: [gdal-dev] GDAL ConfigOptions
Message-ID: <22fd1c42f32548f1bc260a9d38775c9e@dlr.de>

Hello everyone,

I am working on optimizing a GDAL application that uses RasterIO and GeoTiff.
I am using the C++ library.

I would like to experiment with different ConfigOptions, but they have no effect on the application.
I specify them in an environment variable and directly in the code.

I am especially interested in GTIFF_DIRECT_IO.

I use blktrace I/O trace to check.
It traces all I/O operations, and through it I see that the application sends "RA" operations, which means readahead.
The readahed operations only happen when buffered I/O is enabled, and readahead operations should no longer happen when direct I/O is enabled.

Could you please help me with the correct use of ConfigOptions?

Cheers,
Azat

From even.rouault at spatialys.com  Mon Oct 25 05:37:50 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Oct 2021 14:37:50 +0200
Subject: [gdal-dev] GDAL ConfigOptions
In-Reply-To: <22fd1c42f32548f1bc260a9d38775c9e@dlr.de>
References: <22fd1c42f32548f1bc260a9d38775c9e@dlr.de>
Message-ID: <b8459088-8202-19c6-dc22-1157e12424b3@spatialys.com>


Le 25/10/2021 ? 14:25, Azat.Nurgaliev at dlr.de a ?crit?:
> Hello everyone,
>
> I am working on optimizing a GDAL application that uses RasterIO and GeoTiff.
> I am using the C++ library.
>
> I would like to experiment with different ConfigOptions, but they have no effect on the application.
> I specify them in an environment variable and directly in the code.
>
> I am especially interested in GTIFF_DIRECT_IO.
>
> I use blktrace I/O trace to check.
> It traces all I/O operations, and through it I see that the application sends "RA" operations, which means readahead.
> The readahed operations only happen when buffered I/O is enabled, and readahead operations should no longer happen when direct I/O is enabled.

That's not what GTIFF_DIRECT_IO does. It "just" bypasses libtiff and the 
GDAL block cache (when possible). But it uses the regular GDAL I/O, 
which means buffered I/O (fread() calls). Using unbuffered reads would 
probably have only a marginal effect (but maybe not ? this is left to 
the reader as an exercise :-))

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Oct 25 05:48:42 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Oct 2021 14:48:42 +0200
Subject: [gdal-dev] GDAL 3.3.3 RC1 available,
 and imminent tree reorganization in master
Message-ID: <5b6e7b5a-b9c5-adc2-e542-82a4b3d6b2ed@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.3.3 release candidate.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.3.3/gdal-3.3.3rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.3.3/gdal-3.3.3rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.3.3/gdal333rc1.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.3.3/gdalautotest-3.3.3rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.3.3/gdalautotest-3.3.3rc1.zip

GDAL-GRASS plugin:

 ? https://download.osgeo.org/gdal/3.3.3/gdal-grass-3.3.3.tar.gz

The NEWS file is here :

 ? https://github.com/OSGeo/gdal/blob/v3.3.3RC1/gdal/NEWS

I'll call for a vote promoting it to final later this week if no
serious problems are reported before.

~~~~

Other topic:? the release/3.4 branch (with RC1 to be created from it 
next week) has now been created and master is thus open for 3.5dev

As I mentioned last week, https://github.com/OSGeo/gdal/pull/4663 
contains the initial import of the cmake4gdal repository and follow-up 
improvements. It also contains a move of the gdal/ subdirectory to the 
top level directory. I plan to merge this very soon, so please speak up 
now if there are concerns.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From cgodkin at gmail.com  Mon Oct 25 08:37:21 2021
From: cgodkin at gmail.com (Carl Godkin)
Date: Mon, 25 Oct 2021 08:37:21 -0700
Subject: [gdal-dev] gdallocationinfo + WCS question...
In-Reply-To: <CAE=8kmnyGn+fKvFNwkCU0XVaAgvqePG+5Dr9_DK4RQF662y1Qg@mail.gmail.com>
References: <ae9dc713ca4846a1942c99c645699d21@maanmittauslaitos.fi>
 <913f9009-f749-06ec-9cf3-c9d434555dcc@spatialys.com>
 <CAE=8kmnyGn+fKvFNwkCU0XVaAgvqePG+5Dr9_DK4RQF662y1Qg@mail.gmail.com>
Message-ID: <CAE=8kmm-cVzU3huvkt2tt9GqAAKTibC+BF=wJ7gEDFiugOX4_w@mail.gmail.com>

Hi,

I just built GDAL 3.3.3 RC1 here on Windows with VS2019 and  PROJ 8.1.1 and
it built easily.

I retried the gdallocationinfo queries that I was having trouble with
beforehand (with 3.3.1) and both the USGS National Map and my local WCS
server queries now return the expected values.  I know others had tested
the fix Even mentioned but I wanted to try it myself.

Thanks again for the explanation and the fix,
carl

On Thu, Oct 21, 2021 at 2:00 PM Carl Godkin <cgodkin at gmail.com> wrote:

> Thanks, Even.
>
> That makes sense.  (Finally!)  I can wait a little bit to come back to
> this so I'll either build 3.3 HEAD on my own or await the next release.
>
> It's great that this isn't a random server load thing or something!
>
> The weird result on my own WCS server also seemed to be caused by a bad
> "xmin" value which is how I started down this road.
>
> Thanks again,
>
> carl
>
>
>
>
> On Thu, Oct 21, 2021 at 1:49 PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>>
>> Le 21/10/2021 ? 22:32, Rahkonen Jukka (MML) a ?crit :
>>
>> Hi Even,
>>
>>
>>
>> You are right, re-running the request -oo clear_cache gives me the same
>> error about 3 bands. Obviously our server was configured right when I used
>> it with GDAL last time. Now gdallocationinfo does not work even for me
>> because I wiped the working configuration from my cache. We will fix the
>> service metadata when we go from beta to official soon.
>>
>>
>>
>> The nationalmap.gov service does not still work for me. I cleared the
>> cache but I still get a 404 error from the server. Subsets in the reques
>> are these
>>
>> SUBSET=x(-20037507.0672000013,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)
>>
>> The xmin value in the request you get is obviously wrong. The subset I
>> get with GDAL master and head of 3.3 branch is:
>>
>>
>> SUBSET=x%(-13591427.131584032,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)
>>
>> I suspect you might use a GDAL release version, that hasn't yet received
>> the following recent fix that is likely related to that issue and will be
>> in 3.3.3 and 3.4.0:
>>
>>
>> https://github.com/OSGeo/gdal/commit/8af67b64371c275a3770e75da1bd0d4bb7329295
>>
>> (I get the same error as you with the 3.2 branch, so I strongly suspect
>> the above is indeed the fix for that)
>>
>> Even
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211025/836890bd/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Oct 25 09:43:14 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 25 Oct 2021 16:43:14 +0000
Subject: [gdal-dev] gdallocationinfo + WCS question...
Message-ID: <39358e2046244e599445f06ba96a2c69@maanmittauslaitos.fi>

Hi,

Thanks for testing and sending the results back for the community.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Carl Godkin
L?hetetty: maanantai 25. lokakuuta 2021 18.37
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdallocationinfo + WCS question...

Hi,

I just built GDAL 3.3.3 RC1 here on Windows with VS2019 and  PROJ 8.1.1 and it built easily.

I retried the gdallocationinfo queries that I was having trouble with beforehand (with 3.3.1) and both the USGS National Map and my local WCS server queries now return the expected values.  I know others had tested the fix Even mentioned but I wanted to try it myself.

Thanks again for the explanation and the fix,
carl

On Thu, Oct 21, 2021 at 2:00 PM Carl Godkin <cgodkin at gmail.com<mailto:cgodkin at gmail.com>> wrote:
Thanks, Even.

That makes sense.  (Finally!)  I can wait a little bit to come back to this so I'll either build 3.3 HEAD on my own or await the next release.

It's great that this isn't a random server load thing or something!

The weird result on my own WCS server also seemed to be caused by a bad "xmin" value which is how I started down this road.

Thanks again,

carl




On Thu, Oct 21, 2021 at 1:49 PM Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:


Le 21/10/2021 ? 22:32, Rahkonen Jukka (MML) a ?crit :
Hi Even,

You are right, re-running the request -oo clear_cache gives me the same error about 3 bands. Obviously our server was configured right when I used it with GDAL last time. Now gdallocationinfo does not work even for me because I wiped the working configuration from my cache. We will fix the service metadata when we go from beta to official soon.

The nationalmap.gov<http://nationalmap.gov> service does not still work for me. I cleared the cache but I still get a 404 error from the server. Subsets in the reques are these
SUBSET=x(-20037507.0672000013,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)

The xmin value in the request you get is obviously wrong. The subset I get with GDAL master and head of 3.3 branch is:

SUBSET=x%(-13591427.131584032,-13590403.131594259)&SUBSET=y(5303978.1067894027,5304490.1067842878)

I suspect you might use a GDAL release version, that hasn't yet received the following recent fix that is likely related to that issue and will be in 3.3.3 and 3.4.0:

https://github.com/OSGeo/gdal/commit/8af67b64371c275a3770e75da1bd0d4bb7329295

(I get the same error as you with the 3.2 branch, so I strongly suspect the above is indeed the fix for that)

Even



--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211025/ad5918d8/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Oct 25 13:51:39 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 25 Oct 2021 20:51:39 +0000
Subject: [gdal-dev] WCS: Unable to export GeoTIFF files with zero bands
Message-ID: <80164d4eac2e4c47afc586f4e41be0f0@maanmittauslaitos.fi>

Hi,

I do not understand what could be wrong with this WCS. With direct WCS 2.0.1 requests everything works fine.

GetCapabilities:
https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&AcceptVersions=2.0.1&request=GetCapabilities
DescribeCoverage:
https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&version=2.0.1&request=DescribeCoverage&coverageID=ortokuva__ortokuva
This is listing DataRecord with three fields: red band, green band, and blue band.
GetCoverage:
https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&version=2.0.1&request=GetCoverage&CoverageID=ortokuva__ortokuva&SUBSET=E(393450,393650)&SUBSET=N(7495450,7495650)&format=image/tiff
This sends a tiff file.


With GDAL:
gdalinfo -oo CLEAR_CACHE "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?"
I get the subdatasets.

gdalinfo "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=ortokuva__ortokuva"
Looks good but I am not sure what I should expect to see.

gdal_translate -projwin 393450 7495650 393650 7495450   "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=ortokuva__ortokuva" wcs.tif
This gives an error:
Input file size is 1348357, 2316500
ERROR 1: wcs.tif: Unable to export GeoTIFF files with zero bands.

I can indeed see at the end of the automatically generated XML file that the band count is interpreted to be zero:
...
<Domain>E,N</Domain>
  <Low>61254.6580619824,6623749.72946716</Low>
  <High>735433.573091962,7782000.0</High>
  <GridAxes>i,j</GridAxes>
  <NoDataValue>,,</NoDataValue>
  <BandCount>0</BandCount>
  <Format>image/tiff</Format>
...
I tried to edit the band count into 3 by hand, but GDAL is changing it back to zero.

The example from the WCS driver page https://gdal.org/drivers/raster/wcs.html that  is using the very same server and coverage does save an image even there is no fundamental difference in the command.
gdal_translate -oo CACHE=wcs_cache -oo CLEAR_CACHE -oo INTERLEAVE=PIXEL -projwin 377418 6683393.87938218 377717.879386966 6683094  -oo Subset="time(1985-01-01T00:00:00.000Z)" -outsize 60 0 "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=ortokuva__ortokuva" scaled.tiff

I am using GDAL version is 3.4.0dev from yesterday.

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211025/42c379c1/attachment.html>

From even.rouault at spatialys.com  Mon Oct 25 14:16:01 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 25 Oct 2021 23:16:01 +0200
Subject: [gdal-dev] WCS: Unable to export GeoTIFF files with zero bands
In-Reply-To: <80164d4eac2e4c47afc586f4e41be0f0@maanmittauslaitos.fi>
References: <80164d4eac2e4c47afc586f4e41be0f0@maanmittauslaitos.fi>
Message-ID: <7fa051ef-678e-1a7b-7fae-a294c10e1d8e@spatialys.com>

Jukka,

The source code was useful to figure out why BandCount was reset to 0 in 
the cache :-) So it is related to the fact that there is an extra time 
dimension, and such extra dimensions must be specified according to 
https://gdal.org/drivers/raster/wcs.html#range-and-dimension-subsetting

Adding ? -oo Subset="time(1985-12-31T00:00:00.000Z)" for example solves 
the issue

It would be nice to have some warning message though. Might be worth a 
ticket

Even

Le 25/10/2021 ? 22:51, Rahkonen Jukka (MML) a ?crit?:
>
> Hi,
>
> I do not understand what could be wrong with this WCS. With direct WCS 
> 2.0.1 requests everything works fine.
>
> GetCapabilities:
>
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&AcceptVersions=2.0.1&request=GetCapabilities 
> <https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&AcceptVersions=2.0.1&request=GetCapabilities>
>
> DescribeCoverage:
>
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&version=2.0.1&request=DescribeCoverage&coverageID=ortokuva__ortokuva 
> <https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&version=2.0.1&request=DescribeCoverage&coverageID=ortokuva__ortokuva>
>
> This is listing DataRecord with three fields: red band, green band, 
> and blue band.
>
> GetCoverage:
>
> https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&version=2.0.1&request=GetCoverage&CoverageID=ortokuva__ortokuva&SUBSET=E(393450,393650)&SUBSET=N(7495450,7495650)&format=image/tiff 
> <https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?service=WCS&version=2.0.1&request=GetCoverage&CoverageID=ortokuva__ortokuva&SUBSET=E(393450,393650)&SUBSET=N(7495450,7495650)&format=image/tiff>
>
> This sends a tiff file.
>
> With GDAL:
>
> gdalinfo -oo CLEAR_CACHE 
> "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?"
>
> I get the subdatasets.
>
> gdalinfo 
> "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=ortokuva__ortokuva"
>
> Looks good but I am not sure what I should expect to see.
>
> gdal_translate -projwin 393450 7495650 393650 7495450 
> ?"WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=ortokuva__ortokuva" 
> wcs.tif
>
> This gives an error:
>
> Input file size is 1348357, 2316500
>
> ERROR 1: wcs.tif: Unable to export GeoTIFF files with zero bands.
>
> I can indeed see at the end of the automatically generated XML file 
> that the band count is interpreted to be zero:
>
> ?
>
> <Domain>E,N</Domain>
>
> <Low>61254.6580619824,6623749.72946716</Low>
>
> <High>735433.573091962,7782000.0</High>
>
> <GridAxes>i,j</GridAxes>
>
> <NoDataValue>,,</NoDataValue>
>
> <BandCount>0</BandCount>
>
> <Format>image/tiff</Format>
>
> ?
>
> I tried to edit the band count into 3 by hand, but GDAL is changing it 
> back to zero.
>
> The example from the WCS driver page 
> https://gdal.org/drivers/raster/wcs.html 
> <https://gdal.org/drivers/raster/wcs.html> that ?is using the very 
> same server and coverage does save an image even there is no 
> fundamental difference in the command.
>
> gdal_translate -oo CACHE=wcs_cache -oo CLEAR_CACHE -oo 
> INTERLEAVE=PIXEL -projwin 377418 6683393.87938218 377717.879386966 
> 6683094 -oo Subset="time(1985-01-01T00:00:00.000Z)" -outsize 60 0 
> "WCS:https://beta-karttakuva.maanmittauslaitos.fi/wcs/service/ows?version=2.0.1&coverage=ortokuva__ortokuva" 
> scaled.tiff
>
> I am using GDAL version is 3.4.0dev from yesterday.
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211025/0089510d/attachment.html>

From even.rouault at spatialys.com  Tue Oct 26 05:03:31 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 26 Oct 2021 14:03:31 +0200
Subject: [gdal-dev] Move of gdal/ subdirectory
Message-ID: <aa8b472b-fd50-a745-a4c6-2e9f87918e03@spatialys.com>

Hi,

as announced, the content of the gdal/ subdirectory of the git 
repository has been moved to the top level. You'll have to adapt scripts 
building from git master to no longer "cd gdal"

You may also start to play with the cmake builds, but take into account 
the warning emitted at the end of the configuration phase about such 
builds not being considered production ready yet and the cmake build 
system being in development phase.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Tue Oct 26 09:15:51 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 26 Oct 2021 16:15:51 +0000
Subject: [gdal-dev] Python error in me or in gisinternals.com packages?
Message-ID: <baa35de0165b48d58277fa4d87dc000e@maanmittauslaitos.fi>

Hi,

I can use GDAL Python bindings from OSGeo4W installation but folks in gis.stackexchange have problems with the gistinternals.com binaries so I had a try too. I installed

  *   python-3.7.9-amd64
  *   gdal-303-1928-x64-core MIS installer from gisinternals
  *   GDAL-3.3.2.win-amd64-py3.7 MSI installer from gisinternals

Now I have all from above and I have adjusted paths a bit and I can get this far:

  *   Python 3.7.9 starts
  *   I can load osr with "from osgeo import osr"
But if I try "from osgeo import ogr" I get:

Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "c:/Program Files\Python37\lib\site-packages\osgeo\ogr.py", line 245, in <module>
    import osr
ModuleNotFoundError: No module named 'osr'

Same thing with "from osgeo import gdal" but this time the error in on line 1931 in gdal.py and missing module is 'ogr'.

Do the errors mean that the Python stuff is using deprecated "import osr" and "import ogr" while they should have it as "import osgeo.osr" and "import osgeo.ogr" as they seem to stand in the working OSGeo4W installation? I do not have rights to edit the files, and they have also this warning in the beginning:
# This file was automatically generated by SWIG (http://www.swig.org).
# Version 4.0.2
#
# Do not make changes to this file unless you know what you are doing--modify
# the SWIG interface file instead.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211026/f0b30260/attachment.html>

From even.rouault at spatialys.com  Tue Oct 26 09:45:57 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 26 Oct 2021 18:45:57 +0200
Subject: [gdal-dev] Python error in me or in gisinternals.com packages?
In-Reply-To: <baa35de0165b48d58277fa4d87dc000e@maanmittauslaitos.fi>
References: <baa35de0165b48d58277fa4d87dc000e@maanmittauslaitos.fi>
Message-ID: <300dd0d7-a4ef-a67d-ddc7-0427eb2655c6@spatialys.com>

Hi Jukka,

I just checked and indeed gisinternals uses SWIG 2 to generate python 
bindings, which is not Python 3 compatible. I've added a comment in 
https://github.com/gisinternals/buildsystem/issues/180#issuecomment-952121822 
about that

Even

Le 26/10/2021 ? 18:15, Rahkonen Jukka (MML) a ?crit?:
>
> Hi,
>
> I can use GDAL Python bindings from OSGeo4W installation but folks in 
> gis.stackexchange have problems with the gistinternals.com binaries so 
> I had a try too. I installed
>
>   * python-3.7.9-amd64
>   * gdal-303-1928-x64-core MIS installer from gisinternals
>   * GDAL-3.3.2.win-amd64-py3.7 MSI installer from gisinternals
>
> Now I have all from above and I have adjusted paths a bit and I can 
> get this far:
>
>   * Python 3.7.9 starts
>   * I can load osr with ?from osgeo import osr?
>
> But if I try ?from osgeo import ogr? I get:
>
> Traceback (most recent call last):
>
> ? File ?<stdin>?, line 1, in <module>
>
> ? File ?c:/Program Files\Python37\lib\site-packages\osgeo\ogr.py?, 
> line 245, in <module>
>
> ??? import osr
>
> ModuleNotFoundError: No module named ?osr?
>
> Same thing with ?from osgeo import gdal? but this time the error in on 
> line 1931 in gdal.py and missing module is ?ogr?.
>
> Do the errors mean that the Python stuff is using deprecated ?import 
> osr? and ?import ogr? while they should have it as ?import osgeo.osr? 
> and ?import osgeo.ogr? as they seem to stand in the working OSGeo4W 
> installation? I do not have rights to edit the files, and they have 
> also this warning in the beginning:
>
> # This file was automatically generated by SWIG (http://www.swig.org 
> <http://www.swig.org>).
>
> # Version 4.0.2
>
> #
>
> # Do not make changes to this file unless you know what you are 
> doing--modify
>
> # the SWIG interface file instead.
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211026/1a147a23/attachment.html>

From even.rouault at spatialys.com  Wed Oct 27 04:43:12 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 27 Oct 2021 13:43:12 +0200
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
Message-ID: <b70e7d70-5f35-94ff-ae3d-dda728799224@spatialys.com>

Hi,

Having heard no issues being reported regarding RC1

Motion:

Adopt GDAL 3.3.3 RC1 as final 3.3.3 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Wed Oct 27 04:44:13 2021
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 27 Oct 2021 11:44:13 +0000
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
Message-ID: <3a63fababac1454aaa1b6d3bd46cb40e@maanmittauslaitos.fi>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: keskiviikko 27. lokakuuta 2021 14.43
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: promote GDAL 3.3.3 RC1

Hi,

Having heard no issues being reported regarding RC1

Motion:

Adopt GDAL 3.3.3 RC1 as final 3.3.3 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From howard at hobu.co  Wed Oct 27 05:45:38 2021
From: howard at hobu.co (Howard Butler)
Date: Wed, 27 Oct 2021 07:45:38 -0500
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
In-Reply-To: <3a63fababac1454aaa1b6d3bd46cb40e@maanmittauslaitos.fi>
References: <3a63fababac1454aaa1b6d3bd46cb40e@maanmittauslaitos.fi>
Message-ID: <8D92EF56-1B14-42EE-98DD-024F7AC9D70B@hobu.co>

+1

Howard

> On Oct 27, 2021, at 6:44 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> 
> ?+1
> 
> -Jukka Rahkonen-
> 
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
> L?hetetty: keskiviikko 27. lokakuuta 2021 14.43
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
> 
> Hi,
> 
> Having heard no issues being reported regarding RC1
> 
> Motion:
> 
> Adopt GDAL 3.3.3 RC1 as final 3.3.3 release
> 
> Starting with my +1
> 
> Even
> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From mateusz at loskot.net  Wed Oct 27 11:23:04 2021
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed, 27 Oct 2021 20:23:04 +0200
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
In-Reply-To: <8D92EF56-1B14-42EE-98DD-024F7AC9D70B@hobu.co>
References: <3a63fababac1454aaa1b6d3bd46cb40e@maanmittauslaitos.fi>
 <8D92EF56-1B14-42EE-98DD-024F7AC9D70B@hobu.co>
Message-ID: <CABUeae_DPcjZ_6csG6L-XGJqCGn2+zpsK2r6rpQXiFKVaUqbXw@mail.gmail.com>

+1 Mateusz

On Wed, 27 Oct 2021 at 14:45, Howard Butler <howard at hobu.co> wrote:
>
> +1
>
> Howard
>
> > On Oct 27, 2021, at 6:44 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> >
> > ?+1
> >
> > -Jukka Rahkonen-
> >
> > -----Alkuper?inen viesti-----
> > L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
> > L?hetetty: keskiviikko 27. lokakuuta 2021 14.43
> > Vastaanottaja: gdal-dev at lists.osgeo.org
> > Aihe: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
> >
> > Hi,
> >
> > Having heard no issues being reported regarding RC1
> >
> > Motion:
> >
> > Adopt GDAL 3.3.3 RC1 as final 3.3.3 release
> >
> > Starting with my +1
> >
> > Even
> >
> > --
> > http://www.spatialys.com
> > My software is free, but my time generally not.
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Mateusz Loskot, http://mateusz.loskot.net

From dmorissette at mapgears.com  Wed Oct 27 11:25:24 2021
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Wed, 27 Oct 2021 14:25:24 -0400
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
In-Reply-To: <CABUeae_DPcjZ_6csG6L-XGJqCGn2+zpsK2r6rpQXiFKVaUqbXw@mail.gmail.com>
References: <3a63fababac1454aaa1b6d3bd46cb40e@maanmittauslaitos.fi>
 <8D92EF56-1B14-42EE-98DD-024F7AC9D70B@hobu.co>
 <CABUeae_DPcjZ_6csG6L-XGJqCGn2+zpsK2r6rpQXiFKVaUqbXw@mail.gmail.com>
Message-ID: <43f0c832-8275-7481-8ccc-4d4962bca3d9@mapgears.com>

+1

Daniel

On 2021-10-27 14:23, Mateusz Loskot wrote:
> +1 Mateusz
> 
> On Wed, 27 Oct 2021 at 14:45, Howard Butler <howard at hobu.co> wrote:
>>
>> +1
>>
>> Howard
>>
>>> On Oct 27, 2021, at 6:44 AM, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>>
>>> ?+1
>>>
>>> -Jukka Rahkonen-
>>>
>>> -----Alkuper?inen viesti-----
>>> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
>>> L?hetetty: keskiviikko 27. lokakuuta 2021 14.43
>>> Vastaanottaja: gdal-dev at lists.osgeo.org
>>> Aihe: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
>>>
>>> Hi,
>>>
>>> Having heard no issues being reported regarding RC1
>>>
>>> Motion:
>>>
>>> Adopt GDAL 3.3.3 RC1 as final 3.3.3 release
>>>
>>> Starting with my +1
>>>
>>> Even
>>>
>>> --
>>> http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From jmckenna at gatewaygeomatics.com  Wed Oct 27 16:02:04 2021
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 27 Oct 2021 20:02:04 -0300
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
In-Reply-To: <b70e7d70-5f35-94ff-ae3d-dda728799224@spatialys.com>
References: <b70e7d70-5f35-94ff-ae3d-dda728799224@spatialys.com>
Message-ID: <bfc67ffa-dd18-219d-72db-e14e51aaca0d@gatewaygeomatics.com>

No issues here with RC1 on Windows in the MS4W environment.

+1 jeff

thanks!






-- 
Jeff McKenna
GatewayGeo: Developers of MS4W, MapServer Consulting and Training
co-founder of FOSS4G
http://gatewaygeo.com/




On 2021-10-27 8:43 a.m., Even Rouault wrote:
> Hi,
> 
> Having heard no issues being reported regarding RC1
> 
> Motion:
> 
> Adopt GDAL 3.3.3 RC1 as final 3.3.3 release
> 
> Starting with my +1
> 
> Even
> 


From momtchil at momtchev.com  Fri Oct 29 04:43:14 2021
From: momtchil at momtchev.com (Momtchil Momtchev)
Date: Fri, 29 Oct 2021 13:43:14 +0200
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
In-Reply-To: <43f0c832-8275-7481-8ccc-4d4962bca3d9@mapgears.com>
References: <3a63fababac1454aaa1b6d3bd46cb40e@maanmittauslaitos.fi>
 <8D92EF56-1B14-42EE-98DD-024F7AC9D70B@hobu.co>
 <CABUeae_DPcjZ_6csG6L-XGJqCGn2+zpsK2r6rpQXiFKVaUqbXw@mail.gmail.com>
 <43f0c832-8275-7481-8ccc-4d4962bca3d9@mapgears.com>
Message-ID: <a75a77dc-5a1c-1bda-7375-642439c4ab25@momtchev.com>


+1

No issues in Node.js

On 27/10/2021 20:25, Daniel Morissette wrote:
> +1
>
> Daniel
>
> On 2021-10-27 14:23, Mateusz Loskot wrote:
>> +1 Mateusz
>>
>> On Wed, 27 Oct 2021 at 14:45, Howard Butler <howard at hobu.co> wrote:
>>>
>>> +1
>>>
>>> Howard
>>>
>>>> On Oct 27, 2021, at 6:44 AM, Rahkonen Jukka (MML) 
>>>> <jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>>>
>>>> ?+1
>>>>
>>>> -Jukka Rahkonen-
>>>>
>>>> -----Alkuper?inen viesti-----
>>>> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta 
>>>> Even Rouault
>>>> L?hetetty: keskiviikko 27. lokakuuta 2021 14.43
>>>> Vastaanottaja: gdal-dev at lists.osgeo.org
>>>> Aihe: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
>>>>
>>>> Hi,
>>>>
>>>> Having heard no issues being reported regarding RC1
>>>>
>>>> Motion:
>>>>
>>>> Adopt GDAL 3.3.3 RC1 as final 3.3.3 release
>>>>
>>>> Starting with my +1
>>>>
>>>> Even
>>>>
>>>> -- 
>>>> http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>
>
-- 
Momtchil Momtchev <momtchil at momtchev.com>


From even.rouault at spatialys.com  Fri Oct 29 04:53:47 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 29 Oct 2021 13:53:47 +0200
Subject: [gdal-dev] Motion: promote GDAL 3.3.3 RC1
In-Reply-To: <b70e7d70-5f35-94ff-ae3d-dda728799224@spatialys.com>
References: <b70e7d70-5f35-94ff-ae3d-dda728799224@spatialys.com>
Message-ID: <3756dac7-1eaf-fd96-17d1-32e97f2377ab@spatialys.com>

I declare this motion passed with +1 from PSC members JukkaR, HowardB, 
MateuszL, DanielM and me.

Even

Le 27/10/2021 ? 13:43, Even Rouault a ?crit?:
> Hi,
>
> Having heard no issues being reported regarding RC1
>
> Motion:
>
> Adopt GDAL 3.3.3 RC1 as final 3.3.3 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Fri Oct 29 05:41:02 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 29 Oct 2021 14:41:02 +0200
Subject: [gdal-dev] GDAL 3.3.3 is released
Message-ID: <0688817a-78cf-1917-7cea-75fac84d51d8@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the
release of the GDAL/OGR 3.3.3 bug fix version (which will be followed by a
release candidate of GDAL 3.4.0 next week)

Consult the release notes for the list of issues addressed :

 ? https://github.com/OSGeo/gdal/blob/v3.3.3/gdal/NEWS

The sources are available at:

 ??? https://download.osgeo.org/gdal/3.3.3/gdal-3.3.3.tar.xz
 ??? https://download.osgeo.org/gdal/3.3.3/gdal-3.3.3.tar.gz
 ??? https://download.osgeo.org/gdal/3.3.3/gdal333.zip
 ??? https://download.osgeo.org/gdal/3.3.3/gdal-grass-3.3.3.tar.gz


Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jluis at ualg.pt  Fri Oct 29 09:32:01 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Fri, 29 Oct 2021 16:32:01 +0000
Subject: [gdal-dev] ingesting .gpx files from FFI
Message-ID: <AM6PR04MB39599E72F12C3FF7EEEF0B1FA6879@AM6PR04MB3959.eurprd04.prod.outlook.com>

Hi,

Trying to read .gpx files from Julia (and I would bet, from python too but can?t test it) is showing puzzling results.
For example, with the attached gpx file I get this

julia> ds = gdalread("25708.gpx", gdataset=true);

julia> layer = getlayer(ds, 0)
Layer: waypoints (1)
  Geometry 0 (??*??): [1]
     Field 0 (ele): [Real]
     Field 1 (time): [9999]
     Field 2 (magvar): [Real]
     Field 3 (geoidheigh): [Real]
     Field 4 (name): [String]
...
Number of Fields: 23

But there are no Features in the layers, so I can?t get the data from the geometries

julia> GMT.Gdal.nfeature(layer)
0

HOWEVER, both the GDAL `ogr2ogr` command line or it?s Julia wrapper works in converting, e.g., to geopackage

julia> ogr2ogr("25708.gpx", dest="25708.gpkg")

and I can now plot "25708.gpkg" (not shown here but the plot can be seen in https://discourse.julialang.org/t/what-is-your-favorite-mapping-package/70509/22?u=joa-quim)

How is ogr2ogr able to read this file data?

Thanks

Joaquim


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211029/a06f979f/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 25708.gpx.zip
Type: application/x-zip-compressed
Size: 22325 bytes
Desc: 25708.gpx.zip
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211029/a06f979f/attachment-0001.bin>

From even.rouault at spatialys.com  Fri Oct 29 09:45:37 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 29 Oct 2021 18:45:37 +0200
Subject: [gdal-dev] draft NEWS for 3.4.0
Message-ID: <8fb5f792-7858-a829-9813-03f04ad830b0@spatialys.com>

Hi,

if you feel bored this week end, you can review and submit tweaks for 
the NEWS file:

https://github.com/OSGeo/gdal/blob/release/3.4/gdal/NEWS

@idan: I've summed up in an extremely compact way your changes in 
gdal_utils. If you feel it should be expanded, the floors is yours

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Fri Oct 29 09:50:08 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 29 Oct 2021 18:50:08 +0200
Subject: [gdal-dev] ingesting .gpx files from FFI
In-Reply-To: <AM6PR04MB39599E72F12C3FF7EEEF0B1FA6879@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB39599E72F12C3FF7EEEF0B1FA6879@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <37981e48-7f68-84f2-c0e0-0d18c4fc0353@spatialys.com>

You didn't explore completely the dataset. The waypoints layer has 0 
feature, but the tracks one has 1 and the track_points one 2469

Le 29/10/2021 ? 18:32, Joaquim Manuel Freire Lu?s a ?crit?:
>
> Hi,
>
> Trying to read .gpx files from Julia (and I would bet, from python too 
> but can?t test it) is showing puzzling results.
>
> For example, with the attached gpx file I get this
>
> julia> ds = gdalread("25708.gpx", gdataset=true);
>
> julia> layer = getlayer(ds, 0)
>
> Layer: waypoints (1)
>
> ? Geometry 0 (??*??): [1]
>
> ???? Field 0 (ele): [Real]
>
> ???? Field 1 (time): [9999]
>
> ???? Field 2 (magvar): [Real]
>
> ???? Field 3 (geoidheigh): [Real]
>
> ???? Field 4 (name): [String]
>
> ...
>
> Number of Fields: 23
>
> But there are no Features in the layers, so I can?t get the data from 
> the geometries
>
> julia> GMT.Gdal.nfeature(layer)
>
> 0
>
> HOWEVER, both the GDAL `ogr2ogr` command line or it?s Julia wrapper 
> works in converting, e.g., to geopackage
>
> julia> ogr2ogr("25708.gpx", dest="25708.gpkg")
>
> and I can now plot "25708.gpkg" (not shown here but the plot can be 
> seen in 
> https://discourse.julialang.org/t/what-is-your-favorite-mapping-package/70509/22?u=joa-quim 
> <https://discourse.julialang.org/t/what-is-your-favorite-mapping-package/70509/22?u=joa-quim>)
>
> How is ogr2ogr able to read this file data?
>
> Thanks
>
> Joaquim
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211029/c989f1c8/attachment.html>

From jluis at ualg.pt  Fri Oct 29 10:05:13 2021
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Fri, 29 Oct 2021 17:05:13 +0000
Subject: [gdal-dev] ingesting .gpx files from FFI
In-Reply-To: <37981e48-7f68-84f2-c0e0-0d18c4fc0353@spatialys.com>
References: <AM6PR04MB39599E72F12C3FF7EEEF0B1FA6879@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <37981e48-7f68-84f2-c0e0-0d18c4fc0353@spatialys.com>
Message-ID: <AM6PR04MB3959C1AF1503118F8B66C520A6879@AM6PR04MB3959.eurprd04.prod.outlook.com>

Ah, Ghrrr. Not in this simple code sample but I (thought) I did in the real implementation

https://github.com/GenericMappingTools/GMT.jl/blob/master/src/gdal_utils.jl#L197

but it only looked at the first layer

making it scan all layers produces the correct plot.

Cheers

Joaquim


From: Even Rouault <even.rouault at spatialys.com>
Sent: Friday, October 29, 2021 5:50 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] ingesting .gpx files from FFI


You didn't explore completely the dataset. The waypoints layer has 0 feature, but the tracks one has 1 and the track_points one 2469
Le 29/10/2021 ? 18:32, Joaquim Manuel Freire Lu?s a ?crit :
Hi,

Trying to read .gpx files from Julia (and I would bet, from python too but can?t test it) is showing puzzling results.
For example, with the attached gpx file I get this

julia> ds = gdalread("25708.gpx", gdataset=true);

julia> layer = getlayer(ds, 0)
Layer: waypoints (1)
  Geometry 0 (??*??): [1]
     Field 0 (ele): [Real]
     Field 1 (time): [9999]
     Field 2 (magvar): [Real]
     Field 3 (geoidheigh): [Real]
     Field 4 (name): [String]
...
Number of Fields: 23

But there are no Features in the layers, so I can?t get the data from the geometries

julia> GMT.Gdal.nfeature(layer)
0

HOWEVER, both the GDAL `ogr2ogr` command line or it?s Julia wrapper works in converting, e.g., to geopackage

julia> ogr2ogr("25708.gpx", dest="25708.gpkg")

and I can now plot "25708.gpkg" (not shown here but the plot can be seen in https://discourse.julialang.org/t/what-is-your-favorite-mapping-package/70509/22?u=joa-quim)

How is ogr2ogr able to read this file data?

Thanks

Joaquim





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211029/e9c07c9b/attachment-0001.html>

From vladimir.sandoval at yandex.com  Fri Oct 29 12:15:52 2021
From: vladimir.sandoval at yandex.com (Vladimir Sandoval)
Date: Fri, 29 Oct 2021 22:15:52 +0300
Subject: [gdal-dev] VSIS3 with Ceph S3
Message-ID: <161681635534536@mail.yandex.com>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211029/b4b30a82/attachment.html>

From even.rouault at spatialys.com  Fri Oct 29 13:19:57 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 29 Oct 2021 22:19:57 +0200
Subject: [gdal-dev] VSIS3 with Ceph S3
In-Reply-To: <161681635534536@mail.yandex.com>
References: <161681635534536@mail.yandex.com>
Message-ID: <1baea6bf-99b1-151d-43f3-5373ce81bb32@spatialys.com>


Le 29/10/2021 ? 21:15, Vladimir Sandoval a ?crit?:
> We have a Ceph S3 instance we are trying to use GDAL with. ?It only 
> provides the access key and the secret access key - no tokens or the like.
> Have been unable to get gdal to work with various calls such as:
> gdalinfo --config AWS_ACCESS_KEY_ID 'ouraccesskey' --config 
> AWS_SECRET_ACCESS_KEY 'oursecretkey' --config AWS_VIRTUAL_HOSTING 
> FALSE 
> /vsis3/https://ceph-tst-01.us.com/test-imagery/COGS/BlueMarbleJune.tif 
> <https://ceph-tst-01.us.com/test-imagery/COGS/BlueMarbleJune.tif>

you need add --config AWS_S3_ENDPOINT ceph-tst-01.us.com and just use 
/vsis3/test-imagery/... as connection string

and trying that I also see that curl complains about an issue about the 
SSL certificate of cepth-test-01.us.com

You'll have to fix it on the server or add --config GDAL_HTTP_UNSAFESSL YES

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sat Oct 30 02:34:55 2021
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 30 Oct 2021 11:34:55 +0200
Subject: [gdal-dev] draft NEWS for 3.4.0
In-Reply-To: <8fb5f792-7858-a829-9813-03f04ad830b0@spatialys.com>
References: <8fb5f792-7858-a829-9813-03f04ad830b0@spatialys.com>
Message-ID: <8fb3bbb0-2d60-4422-0705-6cc9dc63cebd@spatialys.com>

Got a suggestion to rename it to NEWS.md . With some minor reformatting:

https://github.com/OSGeo/gdal/pull/4738

Preview: 
https://github.com/OSGeo/gdal/blob/516db1dde4ad00165b259d306f9fcf1af5c63b87/gdal/NEWS.md

Le 29/10/2021 ? 18:45, Even Rouault a ?crit?:
> Hi,
>
> if you feel bored this week end, you can review and submit tweaks for 
> the NEWS file:
>
> https://github.com/OSGeo/gdal/blob/release/3.4/gdal/NEWS
>
> @idan: I've summed up in an extremely compact way your changes in 
> gdal_utils. If you feel it should be expanded, the floors is yours
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jan.heckman at gmail.com  Sat Oct 30 04:52:44 2021
From: jan.heckman at gmail.com (Jan Heckman)
Date: Sat, 30 Oct 2021 13:52:44 +0200
Subject: [gdal-dev] What's so wrong with this nc file ...
In-Reply-To: <AM6PR04MB3959F174B69DBFED38FECC83A6BE9@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB3959F174B69DBFED38FECC83A6BE9@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <CAKMUAtDMabFT9vhi4h2n3C1oXp6Xu0ZwWFKx3OEoD4LC0G5=Fg@mail.gmail.com>

Hi list,
I am working with the LVBAG driver, for which I am truly grateful, by the
way, in C++.
I have a problem with OFTStringList and the corresponding
function GetAsStringList() and/or the cast operator(s) to
std::vector<std::string>
In my code they produce an empty result.
switch (oField.GetType())
{
...
break;
case OFTStringList:
{
const std::string asString{ oField.GetAsString() };
cout << "Field type: " << oField.GetType() << ", string representation of
StringList: " << asString << endl;
const std::vector<std::string> asList{ oField };
cout << "Vector length string list: " << asList.size() << endl;
}
break;
...
}
produces
(single item list)
Field type: 5, string representation of StringList:
(1:NL.IMBAG.Pand.0518100000310601)
Vector length string list: 0
(2 item list)
Field type: 5, string representation of StringList:
(2:woonfunctie,kantoorfunctie)
Vector length string list: 0
and similar when I use oField.GetAsStringList() or any other variant using
reference etc.
The library I use is gdal-303-1928-x64-core.msi obtained from gisinternals
supportsite.

I can parse the stringlist type, the strings will in this case not contain
comma's, but I appreciate a pointer
to achieving this without additional bother.
Thanks in advance,
Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211030/c86cd335/attachment.html>

From simon.eves at omnisci.com  Sun Oct 31 16:27:45 2021
From: simon.eves at omnisci.com (Simon Eves)
Date: Sun, 31 Oct 2021 16:27:45 -0700
Subject: [gdal-dev] Multi-threading GDALRasterBand::RasterIO() ?
Message-ID: <CAJf0KTQxax+k=JTd8acqQyat=wDNh9NW=soaPHYbS7VFHg3M8Q@mail.gmail.com>

We are writing a raster importer, and finding that
GDALRasterBand::RasterIO() is unexpectedly slow for some GRIB2 files.

We have a file which is about 1800x1000 pixels, with 49 bands of type
DOUBLE. The file is about 47MB on disc.

Reading all the bands of a single scanline from this file takes about
1300ms, which is about 26ms per band, hence the entire file takes around 20
minutes to import. All the time seems to be spent in the RasterIO() call,
even though it's not doing any raster rescaling or data format conversion
(1:1 pixels, fetching as GDT_Float64).

So, I figured we'd try multi-threading it, but evidently the call is not
thread-safe. Here is just one of various stack traces it will throw.

libc.so.6!raise (Unknown Source:0)
libc.so.6!abort (Unknown Source:0)
libc.so.6![Unknown/Just-In-Time compiled code] (Unknown Source:0)
libgdal.so.28!GRIBRasterBand::UncacheData(GRIBRasterBand * const this)
(/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:948)
libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
(/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:730)
libgdal.so.28!GRIBRasterBand::LoadData(GRIBRasterBand * const this)
(/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:697)
libgdal.so.28!GRIBRasterBand::IReadBlock(GRIBRasterBand * const this, int
nBlockYOff, void * pImage)
(/build/scripts/gdal-3.2.2/frmts/grib/gribdataset.cpp:803)
libgdal.so.28!GDALRasterBand::GetLockedBlockRef(int bJustInitialize, int
nYBlockOff, int nXBlockOff, GDALRasterBand * const this)
(/build/scripts/gdal-3.2.2/gcore/gdal_priv.h:963)
libgdal.so.28!GDALRasterBand::GetLockedBlockRef(GDALRasterBand * const
this, int nXBlockOff, int nYBlockOff, int bJustInitialize)
(/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:1238)
libgdal.so.28!GDALRasterBand::IRasterIO(GDALRasterBand * const this,
GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
(/build/scripts/gdal-3.2.2/gcore/rasterio.cpp:149)
libgdal.so.28!GDALRasterBand::RasterIO(GDALRasterBand * const this,
GDALRWFlag eRWFlag, int nXOff, int nYOff, int nXSize, int nYSize, void *
pData, int nBufXSize, int nBufYSize, GDALDataType eBufType, GSpacing
nPixelSpace, GSpacing nLineSpace, GDALRasterIOExtraArg * psExtraArg)
(/build/scripts/gdal-3.2.2/gcore/gdalrasterband.cpp:372)
import_export::Importer::<lambda(size_t, int)>::operator()(size_t, int)
const(const import_export::Importer::<lambda(size_t, int)> * const
__closure, const size_t thread_id, const int y)
(/home/simon.eves/work/omniscidb-internal/ImportExport/Importer.cpp:5721)
...

All of the parameters to the call are either constant or uncontended simple
variables, and obviously there is a unique data buffer (pData) per thread.

Is there anything we can do to make this work?

I was intending to look into the lower level block-based API, in the hope
that it will be faster, but have not yet done so.

This is all with a local static build of GDAL 3.2.2 on Ubuntu 20.04 with
GCC 9.

Yours,

Simon Eves

-- 
<http://www.omnisci.com/>
Simon Eves
Senior Graphics Engineer, Rendering Group
100 Montgomery St (5th Floor), San Francisco, CA 94104, USA


Email: simon.eves at omnisci.com | Cell:  +1 (415) 902-1996
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20211031/3c11f55c/attachment.html>

