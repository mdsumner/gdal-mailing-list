From even.rouault at spatialys.com  Wed Jun  1 01:49:43 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 1 Jun 2022 10:49:43 +0200
Subject: [gdal-dev] Call for discussion on RFC 86: Column-oriented read API
 for vector layers
Message-ID: <dad722f1-3ce9-28c0-24d7-c5a9ef728d04@spatialys.com>

Hi,

I've posted in https://github.com/OSGeo/gdal/pull/5830 a new RFC to add 
a column-oriented read API for vector layers.

This RFC describes the addition of new methods to the OGRLayer class to 
retrieve batches of features
with a column-oriented memory layout, that suits formats that have that 
organization or downstream
consumers that expect data to be presented in such a way, in particular 
the Apache Arrow, Pandas / GeoPandas
ecosystem, R spatial packages, and many modern (data analytics focused) 
databases / engines which
are column oriented (eg Snowflake, Google BigQuery, ..)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From pierrechapo at gmail.com  Wed Jun  1 09:22:55 2022
From: pierrechapo at gmail.com (Pierre Chaponniere)
Date: Wed, 1 Jun 2022 18:22:55 +0200
Subject: [gdal-dev] Fwd: gdal_translate histogram conversion
In-Reply-To: <CAAKeCHadEfrdD8p_by4wDq-tn_0Sig52hAtehDcjqkPhSSrdCg@mail.gmail.com>
References: <CAAKeCHaqz3TAb=q30570WXbH_SHGe=HDN=w5YrxYZHipCqbPSg@mail.gmail.com>
 <CAAKeCHadEfrdD8p_by4wDq-tn_0Sig52hAtehDcjqkPhSSrdCg@mail.gmail.com>
Message-ID: <CAAKeCHZzWUWKmr-1_toOs-ynwwcP4979D1qFuVwv9ns-XSc6bA@mail.gmail.com>

Hello gdal community !

I'd like to submit your group a question in regards to the use of
gdal_translate function.
I am converting tif images (64bits, 6 bands multispectral) to jpg images
uint8 via the Qgis interface to operate in lot but I face issues with the
conversion of the histogram values.
It appears this gdal-translate truncate the histogram to the 255 first
values.
I therefore tried the scaling (-scale) argument using this line
-scale 0 65536 0 255

But it appears the resulting histogram is spiky (bottom plot)....compare to
the original histogram (top plot)
See image here
https://ibb.co/mGZHCR0

Any idea from your side on how to better represent histogram from this
gdal-translate conversion ?

Any help would be much appreciated !!
Thanks heaps.

Best regards,

Pierre Chaponniere
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220601/357a5f6a/attachment.htm>

From andrew at aitchison.me.uk  Wed Jun  1 12:13:06 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Wed, 1 Jun 2022 20:13:06 +0100 (BST)
Subject: [gdal-dev] Fwd: gdal_translate histogram conversion
In-Reply-To: <CAAKeCHZzWUWKmr-1_toOs-ynwwcP4979D1qFuVwv9ns-XSc6bA@mail.gmail.com>
References: <CAAKeCHaqz3TAb=q30570WXbH_SHGe=HDN=w5YrxYZHipCqbPSg@mail.gmail.com>
 <CAAKeCHadEfrdD8p_by4wDq-tn_0Sig52hAtehDcjqkPhSSrdCg@mail.gmail.com>
 <CAAKeCHZzWUWKmr-1_toOs-ynwwcP4979D1qFuVwv9ns-XSc6bA@mail.gmail.com>
Message-ID: <e2714828-9a70-fe14-67a4-d7c770ea8c3@aitchison.me.uk>

On Wed, 1 Jun 2022, Pierre Chaponniere wrote:

> Hello gdal community !
>
> I'd like to submit your group a question in regards to the use of
> gdal_translate function.
> I am converting tif images (64bits, 6 bands multispectral) to jpg images
> uint8

uint8 can only have 256 distinct values, but from the top plot it 
appears that you have more than 256 values in each band.

I am not very familiar with the details of the jpeg format, but
many jpeg applications do not support >8bit (eg 12,14, 16 or even more 
bits) values. Some jpeg libraries can support 12 or 16 bit values,
*but only when compiled specially* for such values, and may not support 
8bit images at the same time.

I also note that bande 6 has (all?most) values >30000, which suggests that
they may actually actually be *negative* 16bit values.

> via the Qgis interface to operate in lot but I face issues with the
> conversion of the histogram values.
> It appears this gdal-translate truncate the histogram to the 255 first
> values.
> I therefore tried the scaling (-scale) argument using this line
> -scale 0 65536 0 255
>
> But it appears the resulting histogram is spiky (bottom plot)....compare to
> the original histogram (top plot)
> See image here
> https://ibb.co/mGZHCR0
>
> Any idea from your side on how to better represent histogram from this
> gdal-translate conversion ?

As hinted above,
you will first need to choose a format with more bits than uint8 jpeg.

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From sault.don at gmail.com  Thu Jun  2 15:37:51 2022
From: sault.don at gmail.com (Saulteau Don)
Date: Thu, 2 Jun 2022 15:37:51 -0700
Subject: [gdal-dev] building python bindings after cmake compilation
Message-ID: <CAJo0jfNUdTdnX2t9Z9eGTN6uFj9UhyCdNoiysD-x0Lmvx_gmbw@mail.gmail.com>

I have gdal 3.5.0 built using the new cmake system.
/chroot/src/build <- cmake build directory
/chroot/src/gdal <- src directory
/chroot/src/gdal/swig/python

My cmake is ran from the /chroot directory:

> cmake -B build -S gdal \
>       -DCMAKE_BUILD_TYPE='None' \
>       -DCMAKE_INSTALL_PREFIX='/usr' \
>       -DBUILD_PYTHON_BINDINGS='OFF' \
>       -Wno-dev
> cmake --build build


Then to make the python bindings via swig:

> cd gdal/swig/python
> python setup.py build


When the `python setup.py build` is running it can't find gdal-config with
the following errors:

> running build
> running build_py
> running build_ext
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 105, in
> fetch_config
>    p = subprocess.Popen([command, args], stdout=subprocess.PIPE)
>  File "/usr/lib/python3.10/subprocess.py", line 966, in __init__
>    self._execute_child(args, executable, preexec_fn, close_fds,
>  File "/usr/lib/python3.10/subprocess.py", line 1842, in _execute_child
>    raise child_exception_type(errno_num, err_msg, err_filename)
> FileNotFoundError: [Errno 2] No such file or directory:
> '../../apps/gdal-config'
> During handling of the above exception, another exception occurred:
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 187, in
> get_gdal_config
>    return fetch_config(option, gdal_config=self.gdal_config)
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 108, in
> fetch_config
>    raise gdal_config_error(e)
> __main__.gdal_config_error: [Errno 2] No such file or directory:
> '../../apps/gdal-config'
> During handling of the above exception, another exception occurred:
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 105, in
> fetch_config
>    p = subprocess.Popen([command, args], stdout=subprocess.PIPE)
>  File "/usr/lib/python3.10/subprocess.py", line 966, in __init__
>    self._execute_child(args, executable, preexec_fn, close_fds,
>  File "/usr/lib/python3.10/subprocess.py", line 1842, in _execute_child
>    raise child_exception_type(errno_num, err_msg, err_filename)
> FileNotFoundError: [Errno 2] No such file or directory: 'gdal-config'
> During handling of the above exception, another exception occurred:
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 194, in
> get_gdal_config
>    return fetch_config(option)
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 108, in
> fetch_config
>    raise gdal_config_error(e)
> __main__.gdal_config_error: [Errno 2] No such file or directory:
> 'gdal-config'
> During handling of the above exception, another exception occurred:
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 388, in <module>
>    setup(**setup_kwargs)
>  File "/usr/lib/python3.10/site-packages/setuptools/__init__.py", line
> 155, in setup
>    return distutils.core.setup(**attrs)
>  File "/usr/lib/python3.10/site-packages/setuptools/_distutils/core.py",
> line 148, in setup
>    return run_commands(dist)
>  File "/usr/lib/python3.10/site-packages/setuptools/_distutils/core.py",
> line 163, in run_commands
>    dist.run_commands()
>  File "/usr/lib/python3.10/site-packages/setuptools/_distutils/dist.py",
> line 967, in run_commands
>    self.run_command(cmd)
>  File "/usr/lib/python3.10/site-packages/setuptools/_distutils/dist.py",
> line 986, in run_command
>    cmd_obj.run()
>  File
> "/usr/lib/python3.10/site-packages/setuptools/_distutils/command/build.py",
> line 135, in run
>    self.run_command(cmd_name)
>  File "/usr/lib/python3.10/site-packages/setuptools/_distutils/cmd.py",
> line 313, in run_command
>    self.distribution.run_command(command)
>  File "/usr/lib/python3.10/site-packages/setuptools/_distutils/dist.py",
> line 985, in run_command
>    cmd_obj.ensure_finalized()
>  File "/usr/lib/python3.10/site-packages/setuptools/_distutils/cmd.py",
> line 107, in ensure_finalized
>    self.finalize_options()
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 257, in
> finalize_options
>    self.gdaldir = self.get_gdal_config('prefix')
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 200, in
> get_gdal_config
>    raise gdal_config_error(traceback_string + '\n' + msg)
> __main__.gdal_config_error: Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 105, in
> fetch_config
>    p = subprocess.Popen([command, args], stdout=subprocess.PIPE)
>  File "/usr/lib/python3.10/subprocess.py", line 966, in __init__
>    self._execute_child(args, executable, preexec_fn, close_fds,
>  File "/usr/lib/python3.10/subprocess.py", line 1842, in _execute_child
>    raise child_exception_type(errno_num, err_msg, err_filename)
> FileNotFoundError: [Errno 2] No such file or directory:
> '../../apps/gdal-config'
> During handling of the above exception, another exception occurred:
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 187, in
> get_gdal_config
>    return fetch_config(option, gdal_config=self.gdal_config)
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 108, in
> fetch_config
>    raise gdal_config_error(e)
> gdal_config_error: [Errno 2] No such file or directory:
> '../../apps/gdal-config'
> During handling of the above exception, another exception occurred:
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 105, in
> fetch_config
>    p = subprocess.Popen([command, args], stdout=subprocess.PIPE)
>  File "/usr/lib/python3.10/subprocess.py", line 966, in __init__
>    self._execute_child(args, executable, preexec_fn, close_fds,
>  File "/usr/lib/python3.10/subprocess.py", line 1842, in _execute_child
>    raise child_exception_type(errno_num, err_msg, err_filename)
> FileNotFoundError: [Errno 2] No such file or directory: 'gdal-config'
> During handling of the above exception, another exception occurred:
> Traceback (most recent call last):
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 194, in
> get_gdal_config
>    return fetch_config(option)
>  File "/build/gdal/src/gdal/swig/python/setup.py", line 108, in
> fetch_config
>    raise gdal_config_error(e)
> gdal_config_error: [Errno 2] No such file or directory: 'gdal-config'
> Could not find gdal-config. Make sure you have installed the GDAL native
> library and development headers.


It's searching for it in ../../apps/gdal-config which is /chroot/gdal/apps
but could find it in /chroot/build/apps/gdal-config if it searched there
instead. Any way to point `python setup.py build` to look for gdal-config
in a custom path or the one that cmake built gdal in?

saultdon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220602/5c9cecf2/attachment.htm>

From gdt at lexort.com  Thu Jun  2 16:03:50 2022
From: gdt at lexort.com (Greg Troxel)
Date: Thu, 02 Jun 2022 19:03:50 -0400
Subject: [gdal-dev] building python bindings after cmake compilation
In-Reply-To: <CAJo0jfNUdTdnX2t9Z9eGTN6uFj9UhyCdNoiysD-x0Lmvx_gmbw@mail.gmail.com>
 (Saulteau Don's message of "Thu, 2 Jun 2022 15:37:51 -0700")
References: <CAJo0jfNUdTdnX2t9Z9eGTN6uFj9UhyCdNoiysD-x0Lmvx_gmbw@mail.gmail.com>
Message-ID: <rmiilpiy8fd.fsf@s1.lexort.com>


Saulteau Don <sault.don at gmail.com> writes:

> I have gdal 3.5.0 built using the new cmake system.
> /chroot/src/build <- cmake build directory
> /chroot/src/gdal <- src directory
> /chroot/src/gdal/swig/python
>
> My cmake is ran from the /chroot directory:
>
>> cmake -B build -S gdal \
>>       -DCMAKE_BUILD_TYPE='None' \
>>       -DCMAKE_INSTALL_PREFIX='/usr' \
>>       -DBUILD_PYTHON_BINDINGS='OFF' \
>>       -Wno-dev
>> cmake --build build
>
>
> Then to make the python bindings via swig:
>
>> cd gdal/swig/python
>> python setup.py build
>
>
> When the `python setup.py build` is running it can't find gdal-config with
> the following errors:

This may not be how you want to do this, but if you install the lib and
then build python as a separate step, it will probably go better.    I
am unclear on how this is supposed to work; pkgsrc builds non-python
libs and then python as separate packages.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220602/4efaf76a/attachment.sig>

From sault.don at gmail.com  Thu Jun  2 16:28:15 2022
From: sault.don at gmail.com (Saulteau Don)
Date: Thu, 2 Jun 2022 16:28:15 -0700
Subject: [gdal-dev] building python bindings after cmake compilation
In-Reply-To: <rmiilpiy8fd.fsf@s1.lexort.com>
References: <CAJo0jfNUdTdnX2t9Z9eGTN6uFj9UhyCdNoiysD-x0Lmvx_gmbw@mail.gmail.com>
 <rmiilpiy8fd.fsf@s1.lexort.com>
Message-ID: <CAJo0jfMu8sw-cr75cAfsAvOrHFSR-G_R7O_k9s0QX_2_bktZcw@mail.gmail.com>

Thanks Greg,

I'm attempting to update the gdal PKGBUILD from Arch Linux at
https://github.com/archlinux/svntogit-community/blob/packages/gdal/trunk/PKGBUILD
and making revisions as I go along.

It's a split package that breaks python-gdal apart from gdal so not sure
how to compile the python bindings separately at this moment.

I managed to patch the setup.cfg file:

> --- a/gdal/swig/python/setup.cfg        2022-06-02 16:08:22.113109320 -0700
> +++ b/gdal/swig/python/setup.cfg        2022-06-02 16:10:26.913826620 -0700
> @@ -3,8 +3,7 @@
> max-line-length=100
>
> [build_ext]
> -#include_dirs = ../../port:../../gcore:../../alg:../../ogr/
> -#library_dirs = ../../.libs:../../
> +include_dirs =
> ../../../build/port:../../../build/gcore:../../../build/alg:../../../build/ogr/
> +library_dirs = ../../.libs:../../build
> #libraries = gdal
> -gdal_config=../../apps/gdal-config
> -
> +gdal_config=../../../build/apps/gdal-config


If there's a preferred packaging way to build out the python bindings
separately then I'm all ears cause this says it can't find the header files
which are there in the paths patched:

> running build
> running build_py
> running build_ext
> building 'osgeo._gdal' extension
> building 'osgeo._gdalconst' extension
> building 'osgeo._osr' extension
> building 'osgeo._gnm' extension
> building 'osgeo._ogr' extension
> building 'osgeo._gdal_array' extension
> extensions/ogr_wrap.cpp:2838:10: fatal error: gdal.h: No such file or
> directory
> 2838 | #include "gdal.h"
>      |          ^~~~~~~~
> compilation terminated.
> extensions/osr_wrap.cpp:2879:10: fatal error: cpl_string.h: No such file
> or directory
> 2879 | #include "cpl_string.h"
>      |          ^~~~~~~~~~~~~~
> compilation terminated.
> extensions/gdal_array_wrap.cpp:2829:10: fatal error: gdal.h: No such file
> or directory
> 2829 | #include "gdal.h"
>      |          ^~~~~~~~
> compilation terminated.
> extensions/gdalconst_wrap.c:2703:10: fatal error: gdal.h: No such file or
> directory
> 2703 | #include "gdal.h"
>      |          ^~~~~~~~
> compilation terminated.
> extensions/gdal_wrap.cpp:2883:10: fatal error: cpl_port.h: No such file or
> directory
> 2883 | #include "cpl_port.h"
>      |          ^~~~~~~~~~~~
> compilation terminated.
> extensions/gnm_wrap.cpp:2820:10: fatal error: gdal.h: No such file or
> directory
> 2820 | #include "gdal.h"
>      |          ^~~~~~~~
> compilation terminated.
> error: command '/usr/bin/gcc' failed with exit code 1


saultdon

On Thu, Jun 2, 2022 at 4:03 PM Greg Troxel <gdt at lexort.com> wrote:

>
> Saulteau Don <sault.don at gmail.com> writes:
>
> > I have gdal 3.5.0 built using the new cmake system.
> > /chroot/src/build <- cmake build directory
> > /chroot/src/gdal <- src directory
> > /chroot/src/gdal/swig/python
> >
> > My cmake is ran from the /chroot directory:
> >
> >> cmake -B build -S gdal \
> >>       -DCMAKE_BUILD_TYPE='None' \
> >>       -DCMAKE_INSTALL_PREFIX='/usr' \
> >>       -DBUILD_PYTHON_BINDINGS='OFF' \
> >>       -Wno-dev
> >> cmake --build build
> >
> >
> > Then to make the python bindings via swig:
> >
> >> cd gdal/swig/python
> >> python setup.py build
> >
> >
> > When the `python setup.py build` is running it can't find gdal-config
> with
> > the following errors:
>
> This may not be how you want to do this, but if you install the lib and
> then build python as a separate step, it will probably go better.    I
> am unclear on how this is supposed to work; pkgsrc builds non-python
> libs and then python as separate packages.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220602/a3a4817d/attachment-0001.htm>

From sault.don at gmail.com  Thu Jun  2 17:55:34 2022
From: sault.don at gmail.com (Saulteau Don)
Date: Thu, 2 Jun 2022 17:55:34 -0700
Subject: [gdal-dev] building python bindings after cmake compilation
In-Reply-To: <CAJo0jfMu8sw-cr75cAfsAvOrHFSR-G_R7O_k9s0QX_2_bktZcw@mail.gmail.com>
References: <CAJo0jfNUdTdnX2t9Z9eGTN6uFj9UhyCdNoiysD-x0Lmvx_gmbw@mail.gmail.com>
 <rmiilpiy8fd.fsf@s1.lexort.com>
 <CAJo0jfMu8sw-cr75cAfsAvOrHFSR-G_R7O_k9s0QX_2_bktZcw@mail.gmail.com>
Message-ID: <CAJo0jfPWFZxJRa5JVzxGb6GYRojqXu59ZgnJ2znDggVyhgapEg@mail.gmail.com>

I've gone with using -DBUILD_PYTHON_BINDINGS='ON' option and it builds
great. The install step has an unrelated error though,  but at least
compilation is successful using cmake.

-- Installing: /build/gdal/pkg/gdal/usr/bin/gdal-config
> -- Installing: /build/gdal/pkg/gdal/usr/lib/pkgconfig/gdal.pc
> perl: warning: Setting locale failed.
> perl: warning: Please check that your locale settings:
>        LANGUAGE = (unset),
>        LC_ALL = (unset),
>        LANG = "C.UTF-8"
>    are supported and installed on your system.
> perl: warning: Falling back to the standard locale ("C").
> open: No such file or directory

elf_open: Invalid argument


 Not sure what "open:" is looking for and failing with.


saultdon


On Thu, Jun 2, 2022 at 4:28 PM Saulteau Don <sault.don at gmail.com> wrote:

> Thanks Greg,
>
> I'm attempting to update the gdal PKGBUILD from Arch Linux at
> https://github.com/archlinux/svntogit-community/blob/packages/gdal/trunk/PKGBUILD
> and making revisions as I go along.
>
> It's a split package that breaks python-gdal apart from gdal so not sure
> how to compile the python bindings separately at this moment.
>
> I managed to patch the setup.cfg file:
>
>> --- a/gdal/swig/python/setup.cfg        2022-06-02 16:08:22.113109320
>> -0700
>> +++ b/gdal/swig/python/setup.cfg        2022-06-02 16:10:26.913826620
>> -0700
>> @@ -3,8 +3,7 @@
>> max-line-length=100
>>
>> [build_ext]
>> -#include_dirs = ../../port:../../gcore:../../alg:../../ogr/
>> -#library_dirs = ../../.libs:../../
>> +include_dirs =
>> ../../../build/port:../../../build/gcore:../../../build/alg:../../../build/ogr/
>> +library_dirs = ../../.libs:../../build
>> #libraries = gdal
>> -gdal_config=../../apps/gdal-config
>> -
>> +gdal_config=../../../build/apps/gdal-config
>
>
> If there's a preferred packaging way to build out the python bindings
> separately then I'm all ears cause this says it can't find the header files
> which are there in the paths patched:
>
>> running build
>> running build_py
>> running build_ext
>> building 'osgeo._gdal' extension
>> building 'osgeo._gdalconst' extension
>> building 'osgeo._osr' extension
>> building 'osgeo._gnm' extension
>> building 'osgeo._ogr' extension
>> building 'osgeo._gdal_array' extension
>> extensions/ogr_wrap.cpp:2838:10: fatal error: gdal.h: No such file or
>> directory
>> 2838 | #include "gdal.h"
>>      |          ^~~~~~~~
>> compilation terminated.
>> extensions/osr_wrap.cpp:2879:10: fatal error: cpl_string.h: No such file
>> or directory
>> 2879 | #include "cpl_string.h"
>>      |          ^~~~~~~~~~~~~~
>> compilation terminated.
>> extensions/gdal_array_wrap.cpp:2829:10: fatal error: gdal.h: No such file
>> or directory
>> 2829 | #include "gdal.h"
>>      |          ^~~~~~~~
>> compilation terminated.
>> extensions/gdalconst_wrap.c:2703:10: fatal error: gdal.h: No such file or
>> directory
>> 2703 | #include "gdal.h"
>>      |          ^~~~~~~~
>> compilation terminated.
>> extensions/gdal_wrap.cpp:2883:10: fatal error: cpl_port.h: No such file
>> or directory
>> 2883 | #include "cpl_port.h"
>>      |          ^~~~~~~~~~~~
>> compilation terminated.
>> extensions/gnm_wrap.cpp:2820:10: fatal error: gdal.h: No such file or
>> directory
>> 2820 | #include "gdal.h"
>>      |          ^~~~~~~~
>> compilation terminated.
>> error: command '/usr/bin/gcc' failed with exit code 1
>
>
> saultdon
>
> On Thu, Jun 2, 2022 at 4:03 PM Greg Troxel <gdt at lexort.com> wrote:
>
>>
>> Saulteau Don <sault.don at gmail.com> writes:
>>
>> > I have gdal 3.5.0 built using the new cmake system.
>> > /chroot/src/build <- cmake build directory
>> > /chroot/src/gdal <- src directory
>> > /chroot/src/gdal/swig/python
>> >
>> > My cmake is ran from the /chroot directory:
>> >
>> >> cmake -B build -S gdal \
>> >>       -DCMAKE_BUILD_TYPE='None' \
>> >>       -DCMAKE_INSTALL_PREFIX='/usr' \
>> >>       -DBUILD_PYTHON_BINDINGS='OFF' \
>> >>       -Wno-dev
>> >> cmake --build build
>> >
>> >
>> > Then to make the python bindings via swig:
>> >
>> >> cd gdal/swig/python
>> >> python setup.py build
>> >
>> >
>> > When the `python setup.py build` is running it can't find gdal-config
>> with
>> > the following errors:
>>
>> This may not be how you want to do this, but if you install the lib and
>> then build python as a separate step, it will probably go better.    I
>> am unclear on how this is supposed to work; pkgsrc builds non-python
>> libs and then python as separate packages.
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220602/a2642522/attachment.htm>

From roger at beardandsandals.co.uk  Fri Jun  3 05:21:36 2022
From: roger at beardandsandals.co.uk (Roger James)
Date: Fri, 03 Jun 2022 13:21:36 +0100
Subject: [gdal-dev] gdalinfo: symbol lookup error:
 /usr/local/lib/libgdal.so.31: undefined symbol:
 _ZN3NCS9CIOStream17GetStreamCountersB5cxx11Ev
Message-ID: <18129838c80.27a8.d4b3b9aee17a85f6bc878c68b3925db6@beardandsandals.co.uk>

Hi,

I have recently built gdal-3.5.0 with cmake and with the latest ECW 5.5 
update. The build went fine and did not show any errors. However when I try 
to run gdalinfo it fails with error shown in the title shown above. I have 
seen the threads on similar ECW related problems, but nothing on this one. 
Has anyone got any ideas on this.


Thanks,

Roger
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220603/ceabc5db/attachment.htm>

From roger at beardandsandals.co.uk  Fri Jun  3 11:22:15 2022
From: roger at beardandsandals.co.uk (roger)
Date: Fri, 3 Jun 2022 19:22:15 +0100
Subject: [gdal-dev] gdalinfo: symbol lookup error:
 /usr/local/lib/libgdal.so.31: undefined symbol:
 _ZN3NCS9CIOStream17GetStreamCountersB5cxx11Ev
In-Reply-To: <18129838c80.27a8.d4b3b9aee17a85f6bc878c68b3925db6@beardandsandals.co.uk>
References: <18129838c80.27a8.d4b3b9aee17a85f6bc878c68b3925db6@beardandsandals.co.uk>
Message-ID: <2ab981f0-040f-d00b-7ee3-29e29a523312@beardandsandals.co.uk>

It is a gcc abi issue. Fixed by forcing the the compiler to use the 
cpp11abi/x64 version of the ECW library.

From sault.don at gmail.com  Fri Jun  3 12:08:58 2022
From: sault.don at gmail.com (Saulteau Don)
Date: Fri, 3 Jun 2022 12:08:58 -0700
Subject: [gdal-dev] grass plugin errors for qgis and grass
Message-ID: <CAJo0jfO-32D=BPtQ=do-58MVkzWZU8jGKVHu-qGRdGZA79ERAQ@mail.gmail.com>

I recently compiled GDAL 3.5.0.r89.gf863daba7a from git release branch
using CMAKE.

I also have gdal-grass 1.0.0 compiled from
https://github.com/OSGeo/gdal-grass

The grass plugin reports the following from console when launching QGIS:

> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol:
> GDALRegisterMe
> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol:
> GDALRegister_GRASS
> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol:
> GDALRegisterMe
> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol:
> RegisterOGRGRASS
> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol:
> GDALRegisterMe
> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol:
> GDALRegister_GRASS
> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol:
> GDALRegisterMe
> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol:
> RegisterOGRGRASS


And from GRASS it reports:

> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol:
> GDALRegisterMe
> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol:
> GDALRegister_GRASS
> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol:
> GDALRegisterMe
> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol:
> RegisterOGRGRASS



Are they safe to ignore?


saultdon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220603/163b05ab/attachment.htm>

From neteler at osgeo.org  Sun Jun  5 05:25:05 2022
From: neteler at osgeo.org (Markus Neteler)
Date: Sun, 5 Jun 2022 14:25:05 +0200
Subject: [gdal-dev] grass plugin errors for qgis and grass
In-Reply-To: <CAJo0jfO-32D=BPtQ=do-58MVkzWZU8jGKVHu-qGRdGZA79ERAQ@mail.gmail.com>
References: <CAJo0jfO-32D=BPtQ=do-58MVkzWZU8jGKVHu-qGRdGZA79ERAQ@mail.gmail.com>
Message-ID: <CALFmHhvD0eKcmNUK=sQbvbd_UMSewM3E-QKx2C8c_w1qKwhkNw@mail.gmail.com>

On Fri, Jun 3, 2022 at 9:09 PM Saulteau Don <sault.don at gmail.com> wrote:
>
> I recently compiled GDAL 3.5.0.r89.gf863daba7a from git release branch using CMAKE.
>
> I also have gdal-grass 1.0.0 compiled from https://github.com/OSGeo/gdal-grass
>
> The grass plugin reports the following from console when launching QGIS:
>>
>> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol: GDALRegisterMe
>> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol: GDALRegister_GRASS
>> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol: GDALRegisterMe
>> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol: RegisterOGRGRASS
>> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol: GDALRegisterMe
>> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol: GDALRegister_GRASS
>> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol: GDALRegisterMe
>> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol: RegisterOGRGRASS
>
>
> And from GRASS it reports:
>>
>> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol: GDALRegisterMe
>> ERROR 1: /usr/lib/gdalplugins/gdal_GRASS.so: undefined symbol: GDALRegister_GRASS
>> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol: GDALRegisterMe
>> ERROR 1: /usr/lib/gdalplugins/ogr_GRASS.so: undefined symbol: RegisterOGRGRASS
>
> Are they safe to ignore?

I don't think so.

For the record, discussion with more related info moved to
https://github.com/OSGeo/gdal-grass/issues/9

but any hint would be appreciated. Maybe a PIC problem (above is on ARCH Linux)?

Markus

From laurent.celati at gmail.com  Sun Jun  5 17:49:34 2022
From: laurent.celati at gmail.com (celati Laurent)
Date: Mon, 6 Jun 2022 02:49:34 +0200
Subject: [gdal-dev] gdal og2ogr: insert/update postgis table from SHP?
Message-ID: <CAHByMH3Jb7nHxoshK-8imMqVJnJfN6GDFmn_xhdRo4HLqru5Dw@mail.gmail.com>

Good morning,



I work with windows, Postgis and gdal (I use gdal/ogr2ogr from the command
prompt. Version of gdal available under C:\Program Files\QGIS 3.16\bin).



Up to now, within my postgis database, I was inserting new features into an
existing table

thanks to SQL queries :



>
> *    INSERT INTO SCHEMA_human.TableDestination (*
> *    "fieldXX",*
> *    "geom")*
>
> *    SELECT*
> *    "fieldXX",*
> *    "geom"*
>     *    FROM source_table*



Or features updates thanks to :



>
> *    update*
> *    set*
> *    from**    where*



It worked. But the limit of this approach is that it requires first
importing the shp into the postgis database beforehands. So my goal is to
directly insert new features/ update (from shp source file / toward postgis
destination table using gdal. In order to ovoid/skip/break free this import
of shp in the bdd beforehands.



The Source file is 1 POINTS shapefile (EPSG 2154).

The target/destination table is therefore an existing postgis table of
POINTS (EPSG 2154)

(The schema of the destination table is NOT the default public schema but
the 'human' schema.)



There seem to be 2 approaches to accomplish this task. Either use the
-append options associated with -fieldmap. (or - update for updates). Or
the approach with -sql by defining the SQL query.

I priorize the approach with -sql if possible.



Here is the structure I was thinking of for example for an insert.



>
> *    ogr2ogr - progress - append D:\XXX.shp*
> *    -f PG:"dbname='dbname' host='ipXXXXX' port='5432' user='XXXX'
> password='XXXX' active_schema='human'"*
> *    -sql*
> *    INSERT INTO human_schema.TableName (*
> *    "field1",*
> *    "field2",*
> *    "field3",*
> *    "geom")*
> *    --selection of SHP fields*
> *    SELECT*
> *    "field1",*
> *    "field2",*
> *    "field3",*
> *    "geom"*
> *    FROM*
> *    shp*

Could someone tell me if I'm wrong? Tell me where are my mistakes? With
this method, is it possible to specify the fields of the source shp within
the SQL clause? (non-geom field and geom field?). When, like me, we have a
shp input and a postgis table output, should we rather prioritize the
approach with -append -addfield (or -update) rather than the approach with
-sql?

For input shp, the name of geometry field  (that shoud be set into sql
query) is always "geom"? If not, what would be the way to find out?





Thanks a lot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220606/abd0dea1/attachment.htm>

From laurent.celati at gmail.com  Sun Jun  5 18:05:58 2022
From: laurent.celati at gmail.com (celati Laurent)
Date: Mon, 6 Jun 2022 03:05:58 +0200
Subject: [gdal-dev] gdal og2ogr: insert/update postgis table from SHP?
Message-ID: <CAHByMH1dFuMZL4EPE=QbHgkmgVPxkoXF0MvnzBgOoCSaOuxdhw@mail.gmail.com>

Good morning,

I work with windows, Postgis and gdal (I use gdal/ogr2ogr from the command
prompt. Version of gdal available under C:\Program Files\QGIS 3.16\bin).

Up to now, within my postgis database, I was inserting new features into an
existing table
thanks to SQL queries :


> *    INSERT INTO SCHEMA_human.TableDestination (*
> *    "fieldXX",*
> *    "geom")*
>
> *    SELECT*
> *    "fieldXX",*
> *    "geom"*
>     *    FROM source_table*


Or features updates thanks to


>
>
>
> * update    set    from    where*
> *    set*
> *    from**    where*


It worked. But the limit of this approach is that it requires first
importing the shp into the postgis database beforehands. So my goal is to
directly insert new features/ update (from shp source file / toward postgis
destination table using gdal. In order to ovoid/skip/break free this import
of shp in the bdd beforehands.

The Source file is 1 POINTS shapefile (EPSG 2154).
The target/destination table is therefore an existing postgis table of
POINTS (EPSG 2154)
(The schema of the destination table is NOT the default public schema but
the 'human' schema.)

There seem to be 2 approaches to accomplish this task. Either use the
-append options associated with -fieldmap. (or - update for updates). Or
the approach with -sql by defining the SQL query.
I priorize the approach with -sql if possible.

Here is the structure I was thinking of for example for an insert.

>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *    ogr2ogr - progress - append D:\XXX.shp    -f PG:"dbname='dbname'
> host='ipXXXXX' port='5432' user='XXXX' password='XXXX'
> active_schema='human'"    -sql    INSERT INTO human_schema.TableName (
> "field1",    "field2",    "field3",    "geom")        --selection of SHP
> fields    SELECT    "field1",    "field2",    "field3",    "geom"
> FROM    shp*


Could someone tell me if I'm wrong? Tell me where are my mistakes? With
this method, is it possible to specify the fields of the source shp within
the SQL clause? (non-geom field and geom field?). When, like me, we have a
shp input and a postgis table output, should we rather prioritize the
approach with -append -addfield (or -update) rather than the approach with
-sql?
For input shp, the name of geometry field  (that shoud be set into sql
query) is always "geom"? If not, what would be the way to find out?


Thanks a lot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220606/60096a14/attachment.htm>

From alexandre.gacon at gmail.com  Sun Jun  5 23:03:15 2022
From: alexandre.gacon at gmail.com (Alexandre Gacon)
Date: Mon, 6 Jun 2022 08:03:15 +0200
Subject: [gdal-dev] gdal og2ogr: insert/update postgis table from SHP?
In-Reply-To: <CAHByMH1dFuMZL4EPE=QbHgkmgVPxkoXF0MvnzBgOoCSaOuxdhw@mail.gmail.com>
References: <CAHByMH1dFuMZL4EPE=QbHgkmgVPxkoXF0MvnzBgOoCSaOuxdhw@mail.gmail.com>
Message-ID: <CAFJaAp7_9_=if=_1HcrefrJ1JKmmB95PZqCLqsV+thBhOg5CgA@mail.gmail.com>

Hi Laurent

The SQL option is executed against the source of the date (in your case the
SHP file) and not against your database. So you can use it to select the
fields of your SHP you want in your database, ogr2ogr taking care of
creating the database if needed.

For the SHP, there is no geom field, it will be automatically included in
your database, unless you say so. Have a look at the examples of the
PostgreSQL (https://gdal.org/drivers/vector/pg.html#examples).

If you don't have to filter or rename fields between the SHP and the DB,
the simplest command is :
*ogr2ogr - progress - append D:\XXX.shp    -f PG:"dbname='dbname'
host='ipXXXXX' port='5432' user='XXXX' password='XXXX'
active_schema='human'"*

If you need to include only some fields of your SHP, with or without
renaming, you can add the --sql option (more information on the default SQL
dialect : https://gdal.org/user/ogr_sql_dialect.html#ogr-sql-dialect).

Regards
Alexandre

Le lun. 6 juin 2022 ? 03:06, celati Laurent <laurent.celati at gmail.com> a
?crit :

>
> Good morning,
>
> I work with windows, Postgis and gdal (I use gdal/ogr2ogr from the command
> prompt. Version of gdal available under C:\Program Files\QGIS 3.16\bin).
>
> Up to now, within my postgis database, I was inserting new features into
> an existing table
> thanks to SQL queries :
>
>
>> *    INSERT INTO SCHEMA_human.TableDestination (*
>> *    "fieldXX",*
>> *    "geom")*
>>
>> *    SELECT*
>> *    "fieldXX",*
>> *    "geom"*
>>     *    FROM source_table*
>
>
> Or features updates thanks to
>
>
>>
>>
>>
>> * update    set    from    where*
>> *    set*
>> *    from**    where*
>
>
> It worked. But the limit of this approach is that it requires first
> importing the shp into the postgis database beforehands. So my goal is to
> directly insert new features/ update (from shp source file / toward postgis
> destination table using gdal. In order to ovoid/skip/break free this import
> of shp in the bdd beforehands.
>
> The Source file is 1 POINTS shapefile (EPSG 2154).
> The target/destination table is therefore an existing postgis table of
> POINTS (EPSG 2154)
> (The schema of the destination table is NOT the default public schema but
> the 'human' schema.)
>
> There seem to be 2 approaches to accomplish this task. Either use the
> -append options associated with -fieldmap. (or - update for updates). Or
> the approach with -sql by defining the SQL query.
> I priorize the approach with -sql if possible.
>
> Here is the structure I was thinking of for example for an insert.
>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *    ogr2ogr - progress - append D:\XXX.shp    -f PG:"dbname='dbname'
>> host='ipXXXXX' port='5432' user='XXXX' password='XXXX'
>> active_schema='human'"    -sql    INSERT INTO human_schema.TableName (
>> "field1",    "field2",    "field3",    "geom")        --selection of SHP
>> fields    SELECT    "field1",    "field2",    "field3",    "geom"
>> FROM    shp*
>
>
> Could someone tell me if I'm wrong? Tell me where are my mistakes? With
> this method, is it possible to specify the fields of the source shp within
> the SQL clause? (non-geom field and geom field?). When, like me, we have a
> shp input and a postgis table output, should we rather prioritize the
> approach with -append -addfield (or -update) rather than the approach with
> -sql?
> For input shp, the name of geometry field  (that shoud be set into sql
> query) is always "geom"? If not, what would be the way to find out?
>
>
> Thanks a lot.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Alexandre Gacon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220606/606fe022/attachment-0001.htm>

From oreilly at mbari.org  Mon Jun  6 17:02:49 2022
From: oreilly at mbari.org (Tom O'Reilly)
Date: Mon, 6 Jun 2022 17:02:49 -0700 (PDT)
Subject: [gdal-dev] Why can't find_package(GDAL CONFIG) find GDAL_LIBRARIES?
Message-ID: <1589859798.163134591.1654560169856.JavaMail.zimbra@mbari.org>

I've just built and installed GDAL 3.5.0 on ubuntu 20.04, with cmake 3.5.0 and make. It appears that 'make install' installs needed cmake config files for GDAL: 



-- Installing: /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfigVersion.cmake 
-- Installing: /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfig.cmake 



I'm building my own project that uses GDAL. The CMakelists.txt invokes find_package() and prints out resulting variables: 

BQ_BEGIN

find_package(GDAL CONFIG REQUIRED) 

if (GDAL_FOUND) 
message("GDAL Found!") 
message("GDAL_INCLUDE_DIRS: ${GDAL_INCLUDE_DIRS}") 
message("GDAL_LIBRARIES: ${GDAL_LIBRARIES}") 
message("GDAL_VERSION: ${GDAL_VERSION}") 
else() 
message("GDAL not found") 
endif() 

BQ_END

Running cmake indicates that GDAL_FOUND is true, GDAL_VERSION is set to the expected value(3.5.0), but GDAL_LIBRARIES and GDAL_INCLUDE_DIRS are empty: 

BQ_BEGIN

GDAL Found! 
GDAL_INCLUDE_DIRS: 
GDAL_LIBRARIES: 
GDAL_LIBRARY: 
GDAL_VERSION: 3.5.0 

BQ_END

Why are GDAL_LIBRARIES and GDAL_INCLUDE_DIR empty? 

Thanks 
Tom 


BQ_BEGIN



BQ_END


-------------------------------------------------- 
Thomas C. O'Reilly 
Monterey Bay Aquarium Research Institute 
7700 Sandholdt Road 
Moss Landing, California 95039-9644 
831-775-1766 (voice) 
831-775-1620 (FAX) 
oreilly at mbari.org (email) 
http://www.mbari.org (World-wide Web) 

"The machine does not isolate us from the great mysteries 
of nature, but plunges us more deeply into them." 

- ANTOINE DE SAINT-EXUPERY 
"Wind, Sand, and Stars" (1939) 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220606/eeb8aff2/attachment.htm>

From even.rouault at spatialys.com  Tue Jun  7 00:28:42 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 7 Jun 2022 09:28:42 +0200
Subject: [gdal-dev] Why can't find_package(GDAL CONFIG) find
 GDAL_LIBRARIES?
In-Reply-To: <1589859798.163134591.1654560169856.JavaMail.zimbra@mbari.org>
References: <1589859798.163134591.1654560169856.JavaMail.zimbra@mbari.org>
Message-ID: <e157ef3e-4318-a721-9703-248472eae5ff@spatialys.com>

Tom,

GDAL_LIBRARIES and GDAL_INCLUDE_DIRS are indeed not defined. You have to 
use the "GDAL::GDAL" target in a
target_link_libraries() statement which propagates both include and 
linking requirements and tends to be the modern CMake practice, although 
admitedly not very clearly documented in target_link_libraries() 
official documentation. I found 
https://schneide.blog/2016/04/08/modern-cmake-with-target_link_libraries/ 
which deal with that.

So a typical minimum CMakeLists.txt of a project using GDAL is (this is 
actually 
https://github.com/OSGeo/gdal/blob/master/autotest/postinstall/test_c/CMakeLists.txt 
used in GDAL continuous integration to test usage of GDAL from a 
third-party library/application)

"""

cmake_minimum_required(VERSION 3.0)

project(test_c C CXX) # CXX for properly linking GDAL

find_package(GDAL CONFIG REQUIRED)

add_executable(test_c test_c.c)
target_link_libraries(test_c PRIVATE GDAL::GDAL)

"""

I've created https://github.com/OSGeo/gdal/issues/5875 to track we need 
documenting that.

Note: If you really wanted to get the equivalent of GDAL_INCLUDE_DIRS 
and GDAL_LIBRARIES, you could use the following expressions:

$<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_INCLUDE_DIRECTORIES>

$<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_LINK_LIBRARIES>


Even


Le 07/06/2022 ? 02:02, Tom O'Reilly a ?crit?:
> I've just built and installed GDAL 3.5.0 on ubuntu 20.04, with cmake 
> 3.5.0 and make. It appears that 'make install' installs needed cmake 
> config files for GDAL:
>
>     -- Installing:
>     /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfigVersion.cmake
>     -- Installing:
>     /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfig.cmake
>
> I'm building my own project that uses GDAL. The CMakelists.txt invokes 
> find_package() and prints out resulting variables:
>
>     find_package(GDAL CONFIG REQUIRED)
>
>     if (GDAL_FOUND)
>     ? message("GDAL Found!")
>     ? message("GDAL_INCLUDE_DIRS: ${GDAL_INCLUDE_DIRS}")
>     ? message("GDAL_LIBRARIES: ${GDAL_LIBRARIES}")
>     ? message("GDAL_VERSION: ${GDAL_VERSION}")
>     else()
>     ? message("GDAL not found")
>     endif()
>
> Running cmake indicates that GDAL_FOUND is true, GDAL_VERSION is set 
> to the expected value(3.5.0), but GDAL_LIBRARIES and GDAL_INCLUDE_DIRS 
> are empty:
>
>     GDAL Found!
>     GDAL_INCLUDE_DIRS:
>     GDAL_LIBRARIES:
>     GDAL_LIBRARY:
>     GDAL_VERSION: 3.5.0
>
> Why are GDAL_LIBRARIES and GDAL_INCLUDE_DIR empty?
>
> Thanks
> Tom
>
>
>
> --------------------------------------------------
> Thomas C. O'Reilly
> Monterey Bay Aquarium Research Institute
> 7700 Sandholdt Road
> Moss Landing, California 95039-9644
> 831-775-1766 (voice)
> 831-775-1620 (FAX)
> oreilly at mbari.org (email)
> http://www.mbari.org (World-wide Web)
>
> "The machine does not isolate us from the great mysteries
> ?of nature, but plunges us more deeply into them."
>
> ?? - ANTOINE DE SAINT-EXUPERY
> ?? ? "Wind, Sand, and Stars" (1939)
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220607/72dfa38a/attachment-0001.htm>

From dg0yt at darc.de  Tue Jun  7 00:43:28 2022
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Tue, 7 Jun 2022 09:43:28 +0200
Subject: [gdal-dev] Why can't find_package(GDAL CONFIG) find
 GDAL_LIBRARIES?
In-Reply-To: <e157ef3e-4318-a721-9703-248472eae5ff@spatialys.com>
References: <1589859798.163134591.1654560169856.JavaMail.zimbra@mbari.org>
 <e157ef3e-4318-a721-9703-248472eae5ff@spatialys.com>
Message-ID: <75b546f3-cb65-838f-9b76-5334a5a3a467@darc.de>

Am 07.06.22 um 09:28 schrieb Even Rouault:
> Note: If you really wanted to get the equivalent of GDAL_INCLUDE_DIRS 
> and GDAL_LIBRARIES, you could use the following expressions:
>
> $<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_INCLUDE_DIRECTORIES>
>
> $<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_LINK_LIBRARIES>
>
It is not so trivial. 
$<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_LINK_LIBRARIES>
- won't carry GDAL itself
- may use generator expressions (in particular for multi-config support)
- may use targets with transitive usage requirements (in particular for 
static builds)

GDAL has code to expand the tree of link libraries during the build for 
generating `gdal.pc`:
https://github.com/OSGeo/gdal/blob/master/cmake/helpers/GdalGenerateConfig.cmake

And so you might use pkg-config support in CMake to get something 
similar to the traditional GDAL_LIBRARIES.

If you need a value for GDAL_LIBRARIES without many changes, it may be 
enough to set it GDAL::GDAL.

Kai.


From oreilly at mbari.org  Tue Jun  7 09:52:04 2022
From: oreilly at mbari.org (Tom O'Reilly)
Date: Tue, 7 Jun 2022 09:52:04 -0700 (PDT)
Subject: [gdal-dev] Why can't find_package(GDAL CONFIG) find
 GDAL_LIBRARIES?
In-Reply-To: <e157ef3e-4318-a721-9703-248472eae5ff@spatialys.com>
References: <1589859798.163134591.1654560169856.JavaMail.zimbra@mbari.org>
 <e157ef3e-4318-a721-9703-248472eae5ff@spatialys.com>
Message-ID: <1625091624.2735098.1654620724969.JavaMail.zimbra@mbari.org>

Thanks for this information Even - very useful and interesting. 

I'm still a cmake newbie, and one cmake aspect that drives me nuts is its "inconsistency" when it comes to finding packages ("Should I call find_package(X) with MODULE or CONFIG?", "Is it X_INCLUDE_DIRS or X_INCLUDES?"). So my CMakeLists.txt tend to get complex pretty quickly. 

The method you describe looks elegant and straightforward, and it works for GDAL. In general for package 'X', is the following *guaranteed* to produce a usable target of form "X::X" or exit if package X is not found? 




# Find package X 
find_package(X CONFIG REQUIRED) 



add_executable(test_c test_c.c) 
target_link_libraries(test_c PRIVATE X::X) 




If I could rely on that form, my CMakeLists.txt files would be much simpler! 

Thanks 
Tom 

-------------------------------------------------- 
Thomas C. O'Reilly 
Monterey Bay Aquarium Research Institute 
7700 Sandholdt Road 
Moss Landing, California 95039-9644 
831-775-1766 (voice) 
831-775-1620 (FAX) 
oreilly at mbari.org (email) 
http://www.mbari.org (World-wide Web) 

"The machine does not isolate us from the great mysteries 
of nature, but plunges us more deeply into them." 

- ANTOINE DE SAINT-EXUPERY 
"Wind, Sand, and Stars" (1939) 


From: "Even Rouault" <even.rouault at spatialys.com> 
To: "Tom O'Reilly" <oreilly at mbari.org>, "gdal-dev" <gdal-dev at lists.osgeo.org> 
Sent: Tuesday, June 7, 2022 12:28:42 AM 
Subject: Re: [gdal-dev] Why can't find_package(GDAL CONFIG) find GDAL_LIBRARIES? 



Tom, 

GDAL_LIBRARIES and GDAL_INCLUDE_DIRS are indeed not defined. You have to use the "GDAL::GDAL" target in a 
target_link_libraries() statement which propagates both include and linking requirements and tends to be the modern CMake practice, although admitedly not very clearly documented in target_link_libraries() official documentation. I found [ https://schneide.blog/2016/04/08/modern-cmake-with-target_link_libraries/ | https://schneide.blog/2016/04/08/modern-cmake-with-target_link_libraries/ ] which deal with that. 


So a typical minimum CMakeLists.txt of a project using GDAL is (this is actually [ https://github.com/OSGeo/gdal/blob/master/autotest/postinstall/test_c/CMakeLists.txt | https://github.com/OSGeo/gdal/blob/master/autotest/postinstall/test_c/CMakeLists.txt ] used in GDAL continuous integration to test usage of GDAL from a third-party library/application) 


""" 


cmake_minimum_required(VERSION 3.0) 

project(test_c C CXX) # CXX for properly linking GDAL 

find_package(GDAL CONFIG REQUIRED) 

add_executable(test_c test_c.c) 
target_link_libraries(test_c PRIVATE GDAL::GDAL) 

""" 

I've created [ https://github.com/OSGeo/gdal/issues/5875 | https://github.com/OSGeo/gdal/issues/5875 ] to track we need documenting that. 

Note: If you really wanted to get the equivalent of GDAL_INCLUDE_DIRS and GDAL_LIBRARIES, you could use the following expressions: 


$<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_INCLUDE_DIRECTORIES> 

$<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_LINK_LIBRARIES> 




Even 



Le 07/06/2022 ? 02:02, Tom O'Reilly a ?crit : 

BQ_BEGIN

I've just built and installed GDAL 3.5.0 on ubuntu 20.04, with cmake 3.5.0 and make. It appears that 'make install' installs needed cmake config files for GDAL: 

BQ_BEGIN

-- Installing: /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfigVersion.cmake 
-- Installing: /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfig.cmake 

BQ_END

I'm building my own project that uses GDAL. The CMakelists.txt invokes find_package() and prints out resulting variables: 

BQ_BEGIN

find_package(GDAL CONFIG REQUIRED) 

if (GDAL_FOUND) 
message("GDAL Found!") 
message("GDAL_INCLUDE_DIRS: ${GDAL_INCLUDE_DIRS}") 
message("GDAL_LIBRARIES: ${GDAL_LIBRARIES}") 
message("GDAL_VERSION: ${GDAL_VERSION}") 
else() 
message("GDAL not found") 
endif() 

BQ_END

Running cmake indicates that GDAL_FOUND is true, GDAL_VERSION is set to the expected value(3.5.0), but GDAL_LIBRARIES and GDAL_INCLUDE_DIRS are empty: 

BQ_BEGIN

GDAL Found! 
GDAL_INCLUDE_DIRS: 
GDAL_LIBRARIES: 
GDAL_LIBRARY: 
GDAL_VERSION: 3.5.0 

BQ_END

Why are GDAL_LIBRARIES and GDAL_INCLUDE_DIR empty? 

Thanks 
Tom 


BQ_BEGIN



BQ_END


-------------------------------------------------- 
Thomas C. O'Reilly 
Monterey Bay Aquarium Research Institute 
7700 Sandholdt Road 
Moss Landing, California 95039-9644 
831-775-1766 (voice) 
831-775-1620 (FAX) 
[ mailto:oreilly at mbari.org | oreilly at mbari.org ] (email) 
[ http://www.mbari.org/ | http://www.mbari.org ] (World-wide Web) 

"The machine does not isolate us from the great mysteries 
of nature, but plunges us more deeply into them." 

- ANTOINE DE SAINT-EXUPERY 
"Wind, Sand, and Stars" (1939) 

_______________________________________________
gdal-dev mailing list [ mailto:gdal-dev at lists.osgeo.org | gdal-dev at lists.osgeo.org ] [ https://lists.osgeo.org/mailman/listinfo/gdal-dev | https://lists.osgeo.org/mailman/listinfo/gdal-dev ] 

BQ_END

-- [ http://www.spatialys.com/ | http://www.spatialys.com ] My software is free, but my time generally not. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220607/6fd5658c/attachment.htm>

From even.rouault at spatialys.com  Tue Jun  7 10:10:26 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 7 Jun 2022 19:10:26 +0200
Subject: [gdal-dev] Why can't find_package(GDAL CONFIG) find
 GDAL_LIBRARIES?
In-Reply-To: <1625091624.2735098.1654620724969.JavaMail.zimbra@mbari.org>
References: <1589859798.163134591.1654560169856.JavaMail.zimbra@mbari.org>
 <e157ef3e-4318-a721-9703-248472eae5ff@spatialys.com>
 <1625091624.2735098.1654620724969.JavaMail.zimbra@mbari.org>
Message-ID: <52a4cc44-0436-0c28-f30d-ff623b44a59b@spatialys.com>

That becomes slightly out-of-topic, but CMake practices have evolved 
over time. Having depencies expressed from target name is indeed more 
elegant/powerful. There's no universal way however of knowing the X::Y 
target name for a random package. You have to consult each package's 
documentation. One good reason is that the same package can expose 
several targets (sub-components, shared vs static, etc.)

Le 07/06/2022 ? 18:52, Tom O'Reilly a ?crit?:
> Thanks for this information Even - very useful and interesting.
>
> I'm still a cmake newbie, and one cmake aspect that drives me nuts is 
> its "inconsistency" when it comes to finding packages ("Should I call 
> find_package(X) with MODULE or CONFIG?", "Is it X_INCLUDE_DIRS or 
> X_INCLUDES?"). So my CMakeLists.txt tend to get complex pretty quickly.
>
> The method you describe looks elegant and straightforward, and it 
> works for GDAL. In general for package 'X', is the following 
> *guaranteed* to produce a usable target of form "X::X" or exit if 
> package X is not found?
>
>     # Find package X
>     find_package(X CONFIG REQUIRED)
>
>     add_executable(test_c test_c.c)
>     target_link_libraries(test_c PRIVATE X::X)
>
>
> If I could rely on that form, my CMakeLists.txt files would be much 
> simpler!
>
> Thanks
> Tom
>
> --------------------------------------------------
> Thomas C. O'Reilly
> Monterey Bay Aquarium Research Institute
> 7700 Sandholdt Road
> Moss Landing, California 95039-9644
> 831-775-1766 (voice)
> 831-775-1620 (FAX)
> oreilly at mbari.org (email)
> http://www.mbari.org (World-wide Web)
>
> "The machine does not isolate us from the great mysteries
> ?of nature, but plunges us more deeply into them."
>
> ?? - ANTOINE DE SAINT-EXUPERY
> ?? ? "Wind, Sand, and Stars" (1939)
>
> ------------------------------------------------------------------------
> *From: *"Even Rouault" <even.rouault at spatialys.com>
> *To: *"Tom O'Reilly" <oreilly at mbari.org>, "gdal-dev" 
> <gdal-dev at lists.osgeo.org>
> *Sent: *Tuesday, June 7, 2022 12:28:42 AM
> *Subject: *Re: [gdal-dev] Why can't find_package(GDAL CONFIG) find 
> GDAL_LIBRARIES?
>
> Tom,
>
> GDAL_LIBRARIES and GDAL_INCLUDE_DIRS are indeed not defined. You have 
> to use the "GDAL::GDAL" target in a
> target_link_libraries() statement which propagates both include and 
> linking requirements and tends to be the modern CMake practice, 
> although admitedly not very clearly documented in 
> target_link_libraries() official documentation. I found 
> https://schneide.blog/2016/04/08/modern-cmake-with-target_link_libraries/ 
> which deal with that.
>
> So a typical minimum CMakeLists.txt of a project using GDAL is (this 
> is actually 
> https://github.com/OSGeo/gdal/blob/master/autotest/postinstall/test_c/CMakeLists.txt 
> used in GDAL continuous integration to test usage of GDAL from a 
> third-party library/application)
>
> """
>
> cmake_minimum_required(VERSION 3.0)
>
> project(test_c C CXX) # CXX for properly linking GDAL
>
> find_package(GDAL CONFIG REQUIRED)
>
> add_executable(test_c test_c.c)
> target_link_libraries(test_c PRIVATE GDAL::GDAL)
>
> """
>
> I've created https://github.com/OSGeo/gdal/issues/5875 to track we 
> need documenting that.
>
> Note: If you really wanted to get the equivalent of GDAL_INCLUDE_DIRS 
> and GDAL_LIBRARIES, you could use the following expressions:
>
> $<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_INCLUDE_DIRECTORIES>
>
> $<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_LINK_LIBRARIES>
>
>
> Even
>
>
> Le 07/06/2022 ? 02:02, Tom O'Reilly a ?crit?:
>
>     I've just built and installed GDAL 3.5.0 on ubuntu 20.04, with
>     cmake 3.5.0 and make. It appears that 'make install' installs
>     needed cmake config files for GDAL:
>
>         -- Installing:
>         /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfigVersion.cmake
>         -- Installing:
>         /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfig.cmake
>
>     I'm building my own project that uses GDAL. The CMakelists.txt
>     invokes find_package() and prints out resulting variables:
>
>         find_package(GDAL CONFIG REQUIRED)
>
>         if (GDAL_FOUND)
>         ? message("GDAL Found!")
>         ? message("GDAL_INCLUDE_DIRS: ${GDAL_INCLUDE_DIRS}")
>         ? message("GDAL_LIBRARIES: ${GDAL_LIBRARIES}")
>         ? message("GDAL_VERSION: ${GDAL_VERSION}")
>         else()
>         ? message("GDAL not found")
>         endif()
>
>     Running cmake indicates that GDAL_FOUND is true, GDAL_VERSION is
>     set to the expected value(3.5.0), but GDAL_LIBRARIES and
>     GDAL_INCLUDE_DIRS are empty:
>
>         GDAL Found!
>         GDAL_INCLUDE_DIRS:
>         GDAL_LIBRARIES:
>         GDAL_LIBRARY:
>         GDAL_VERSION: 3.5.0
>
>     Why are GDAL_LIBRARIES and GDAL_INCLUDE_DIR empty?
>
>     Thanks
>     Tom
>
>
>
>     --------------------------------------------------
>     Thomas C. O'Reilly
>     Monterey Bay Aquarium Research Institute
>     7700 Sandholdt Road
>     Moss Landing, California 95039-9644
>     831-775-1766 (voice)
>     831-775-1620 (FAX)
>     oreilly at mbari.org (email)
>     http://www.mbari.org (World-wide Web)
>
>     "The machine does not isolate us from the great mysteries
>     ?of nature, but plunges us more deeply into them."
>
>     ?? - ANTOINE DE SAINT-EXUPERY
>     ?? ? "Wind, Sand, and Stars" (1939)
>
>     _______________________________________________
>     gdal-dev mailing list
>     gdal-dev at lists.osgeo.org
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220607/fa0f7936/attachment-0001.htm>

From oreilly at mbari.org  Tue Jun  7 10:58:26 2022
From: oreilly at mbari.org (Tom O'Reilly)
Date: Tue, 7 Jun 2022 10:58:26 -0700 (PDT)
Subject: [gdal-dev] Why can't find_package(GDAL CONFIG) find
 GDAL_LIBRARIES?
In-Reply-To: <52a4cc44-0436-0c28-f30d-ff623b44a59b@spatialys.com>
References: <1589859798.163134591.1654560169856.JavaMail.zimbra@mbari.org>
 <e157ef3e-4318-a721-9703-248472eae5ff@spatialys.com>
 <1625091624.2735098.1654620724969.JavaMail.zimbra@mbari.org>
 <52a4cc44-0436-0c28-f30d-ff623b44a59b@spatialys.com>
Message-ID: <135663208.3501700.1654624706683.JavaMail.zimbra@mbari.org>

Hi Even, 

You write: 
> There's no universal way however of knowing the X::Y target name for a random package. You have to consult each package's documentation. 

Where is this typically documented? For example, where can I find GDAL package documentation? I looked in the [ https://gdal.org/gdal.pdf | main GDAL document ] but didn't find it there (I might have missed it there...) 

Thanks! 
Tom 
-------------------------------------------------- 
Thomas C. O'Reilly 
Monterey Bay Aquarium Research Institute 
7700 Sandholdt Road 
Moss Landing, California 95039-9644 
831-775-1766 (voice) 
831-775-1620 (FAX) 
oreilly at mbari.org (email) 
http://www.mbari.org (World-wide Web) 

"The machine does not isolate us from the great mysteries 
of nature, but plunges us more deeply into them." 

- ANTOINE DE SAINT-EXUPERY 
"Wind, Sand, and Stars" (1939) 


From: "Even Rouault" <even.rouault at spatialys.com> 
To: "Tom O'Reilly" <oreilly at mbari.org> 
Cc: "gdal-dev" <gdal-dev at lists.osgeo.org> 
Sent: Tuesday, June 7, 2022 10:10:26 AM 
Subject: Re: [gdal-dev] Why can't find_package(GDAL CONFIG) find GDAL_LIBRARIES? 



That becomes slightly out-of-topic, but CMake practices have evolved over time. Having depencies expressed from target name is indeed more elegant/powerful. There's no universal way however of knowing the X::Y target name for a random package. You have to consult each package's documentation. One good reason is that the same package can expose several targets (sub-components, shared vs static, etc.) 
Le 07/06/2022 ? 18:52, Tom O'Reilly a ?crit : 



Thanks for this information Even - very useful and interesting. 

I'm still a cmake newbie, and one cmake aspect that drives me nuts is its "inconsistency" when it comes to finding packages ("Should I call find_package(X) with MODULE or CONFIG?", "Is it X_INCLUDE_DIRS or X_INCLUDES?"). So my CMakeLists.txt tend to get complex pretty quickly. 

The method you describe looks elegant and straightforward, and it works for GDAL. In general for package 'X', is the following *guaranteed* to produce a usable target of form "X::X" or exit if package X is not found? 


BQ_BEGIN

# Find package X 
find_package(X CONFIG REQUIRED) 



add_executable(test_c test_c.c) 
target_link_libraries(test_c PRIVATE X::X) 




If I could rely on that form, my CMakeLists.txt files would be much simpler! 

Thanks 
Tom 

-------------------------------------------------- 
Thomas C. O'Reilly 
Monterey Bay Aquarium Research Institute 
7700 Sandholdt Road 
Moss Landing, California 95039-9644 
831-775-1766 (voice) 
831-775-1620 (FAX) 
[ mailto:oreilly at mbari.org | oreilly at mbari.org ] (email) 
[ http://www.mbari.org/ | http://www.mbari.org ] (World-wide Web) 

"The machine does not isolate us from the great mysteries 
of nature, but plunges us more deeply into them." 

- ANTOINE DE SAINT-EXUPERY 
"Wind, Sand, and Stars" (1939) 


From: "Even Rouault" [ mailto:even.rouault at spatialys.com | <even.rouault at spatialys.com> ] 
To: "Tom O'Reilly" [ mailto:oreilly at mbari.org | <oreilly at mbari.org> ] , "gdal-dev" [ mailto:gdal-dev at lists.osgeo.org | <gdal-dev at lists.osgeo.org> ] 
Sent: Tuesday, June 7, 2022 12:28:42 AM 
Subject: Re: [gdal-dev] Why can't find_package(GDAL CONFIG) find GDAL_LIBRARIES? 



Tom, 

GDAL_LIBRARIES and GDAL_INCLUDE_DIRS are indeed not defined. You have to use the "GDAL::GDAL" target in a 
target_link_libraries() statement which propagates both include and linking requirements and tends to be the modern CMake practice, although admitedly not very clearly documented in target_link_libraries() official documentation. I found [ https://schneide.blog/2016/04/08/modern-cmake-with-target_link_libraries/ | https://schneide.blog/2016/04/08/modern-cmake-with-target_link_libraries/ ] which deal with that. 


So a typical minimum CMakeLists.txt of a project using GDAL is (this is actually [ https://github.com/OSGeo/gdal/blob/master/autotest/postinstall/test_c/CMakeLists.txt | https://github.com/OSGeo/gdal/blob/master/autotest/postinstall/test_c/CMakeLists.txt ] used in GDAL continuous integration to test usage of GDAL from a third-party library/application) 


""" 


cmake_minimum_required(VERSION 3.0) 

project(test_c C CXX) # CXX for properly linking GDAL 

find_package(GDAL CONFIG REQUIRED) 

add_executable(test_c test_c.c) 
target_link_libraries(test_c PRIVATE GDAL::GDAL) 

""" 

I've created [ https://github.com/OSGeo/gdal/issues/5875 | https://github.com/OSGeo/gdal/issues/5875 ] to track we need documenting that. 

Note: If you really wanted to get the equivalent of GDAL_INCLUDE_DIRS and GDAL_LIBRARIES, you could use the following expressions: 


$<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_INCLUDE_DIRECTORIES> 

$<TARGET_PROPERTY:GDAL::GDAL,INTERFACE_LINK_LIBRARIES> 




Even 



Le 07/06/2022 ? 02:02, Tom O'Reilly a ?crit : 

BQ_BEGIN

I've just built and installed GDAL 3.5.0 on ubuntu 20.04, with cmake 3.5.0 and make. It appears that 'make install' installs needed cmake config files for GDAL: 

BQ_BEGIN

-- Installing: /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfigVersion.cmake 
-- Installing: /usr/local/lib/x86_64-linux-gnu/cmake/gdal/GDALConfig.cmake 

BQ_END

I'm building my own project that uses GDAL. The CMakelists.txt invokes find_package() and prints out resulting variables: 

BQ_BEGIN

find_package(GDAL CONFIG REQUIRED) 

if (GDAL_FOUND) 
message("GDAL Found!") 
message("GDAL_INCLUDE_DIRS: ${GDAL_INCLUDE_DIRS}") 
message("GDAL_LIBRARIES: ${GDAL_LIBRARIES}") 
message("GDAL_VERSION: ${GDAL_VERSION}") 
else() 
message("GDAL not found") 
endif() 

BQ_END

Running cmake indicates that GDAL_FOUND is true, GDAL_VERSION is set to the expected value(3.5.0), but GDAL_LIBRARIES and GDAL_INCLUDE_DIRS are empty: 

BQ_BEGIN

GDAL Found! 
GDAL_INCLUDE_DIRS: 
GDAL_LIBRARIES: 
GDAL_LIBRARY: 
GDAL_VERSION: 3.5.0 

BQ_END

Why are GDAL_LIBRARIES and GDAL_INCLUDE_DIR empty? 

Thanks 
Tom 


BQ_BEGIN



BQ_END


-------------------------------------------------- 
Thomas C. O'Reilly 
Monterey Bay Aquarium Research Institute 
7700 Sandholdt Road 
Moss Landing, California 95039-9644 
831-775-1766 (voice) 
831-775-1620 (FAX) 
[ mailto:oreilly at mbari.org | oreilly at mbari.org ] (email) 
[ http://www.mbari.org/ | http://www.mbari.org ] (World-wide Web) 

"The machine does not isolate us from the great mysteries 
of nature, but plunges us more deeply into them." 

- ANTOINE DE SAINT-EXUPERY 
"Wind, Sand, and Stars" (1939) 

_______________________________________________
gdal-dev mailing list [ mailto:gdal-dev at lists.osgeo.org | gdal-dev at lists.osgeo.org ] [ https://lists.osgeo.org/mailman/listinfo/gdal-dev | https://lists.osgeo.org/mailman/listinfo/gdal-dev ] 

BQ_END

-- [ http://www.spatialys.com/ | http://www.spatialys.com ] My software is free, but my time generally not. 


BQ_END

-- [ http://www.spatialys.com/ | http://www.spatialys.com ] My software is free, but my time generally not. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220607/75335169/attachment.htm>

From csmemoe at aquaveo.com  Wed Jun  8 00:11:32 2022
From: csmemoe at aquaveo.com (Chris Smemoe)
Date: Wed, 8 Jun 2022 01:11:32 -0600
Subject: [gdal-dev] Issue defining compound projection with a local
 projection for GeoTIFF
Message-ID: <000001d87b06$fc686570$f5393050$@aquaveo.com>

I'm not sure whether this is a bug or some issue with how I'm doing things
(like maybe my WKT is bogus), but when I try to define a compound projection
for a GeoTIFF with a local projection, the vertical projection information
does not get saved to the GeoTIFF and I get an error reported from PROJ.  I
am trying to upgrade the version of GDAL I'm using and I think this used to
work in GDAL version 2.x but no longer works in GDAL 3.x/PROJ 7.x.  What I'm
trying to do is to update the projection of a GeoTIFF from a local
projection with horizontal units only to a compound projection with both
horizontal and vertical units.  When I close the GDAL dataset, It seems like
PROJ is trying to look for an ellipsoid node for the spatial reference
object but I don't have one since I'm using a local projection.  Then when I
reopen the dataset, nothing seems to have been saved.  I'm running GDAL
3.4.2.  Here's an example of what I'm trying to do:

 

-------------------begin-------------------

python

>>> from osgeo import gdal

>>> gd = gdal.Open("C:\\temp\\grid_meter_exported.tif", gdal.GA_Update)

>>> gd

<osgeo.gdal.Dataset; proxy of <Swig Object of type 'GDALDatasetShadow *' at
0x000001B6BC578630> >

>>> gd.GetProjectionRef()

'LOCAL_CS["None",UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAS
T],AXIS["Northing",NORTH]]'

>>>
gd.SetProjection('COMPD_CS["None",LOCAL_CS["None",LOCAL_DATUM["None",32767],
UNIT["Foot_US",0.304800609601219],AXIS["None",OTHER]],VERT_CS["Local
Meter",VERT_DATUM["Local",2005],UNIT["Meter",1,AUTHORITY["EPSG","9001"]],AXI
S["Gravity-related height",UP]]]')

0

>>> gd.GetProjection()

'COMPD_CS["None",LOCAL_CS["None",LOCAL_DATUM["None",32767],UNIT["Foot_US",0.
304800609601219],AXIS["None",OTHER]],VERT_CS["Local
Meter",VERT_DATUM["Local",2005],UNIT["Meter",1,AUTHORITY["EPSG","9001"]],AXI
S["Gravity-related height",UP]]]'

>>> gd = None

ERROR 1: PROJ: proj_get_ellipsoid: CRS has no geodetic CRS

ERROR 1: PROJ: proj_get_ellipsoid: Object is not a CRS or
GeodeticReferenceFrame

ERROR 1: PROJ: proj_get_ellipsoid: CRS has no geodetic CRS

ERROR 1: PROJ: proj_get_ellipsoid: Object is not a CRS or
GeodeticReferenceFrame

ERROR 1: PROJ: proj_crs_get_geodetic_crs: CRS has no geodetic CRS

>>> gd = gdal.Open("C:\\temp\\grid_meter_exported.tif", gdal.GA_Update)

>>> gd

<osgeo.gdal.Dataset; proxy of <Swig Object of type 'GDALDatasetShadow *' at
0x000001B6BC578720> >

>>> gd.GetProjectionRef()

'LOCAL_CS["None",UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAS
T],AXIS["Northing",NORTH]]'

 

-------------------end-------------------

 

The dataset I'm working with can be downloaded here:

 

https://www.dropbox.com/s/2jn7vkcl690e90r/grid_meter_exported.tif?dl=1

 

I'd appreciate any guidance.

 

Thanks,

 

Chris

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220608/d02615b0/attachment.htm>

From even.rouault at spatialys.com  Wed Jun  8 03:23:04 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 8 Jun 2022 12:23:04 +0200
Subject: [gdal-dev] Call for discussion on RFC 86: Column-oriented read
 API for vector layers
In-Reply-To: <dad722f1-3ce9-28c0-24d7-c5a9ef728d04@spatialys.com>
References: <dad722f1-3ce9-28c0-24d7-c5a9ef728d04@spatialys.com>
Message-ID: <8fdff3ae-3c54-af9f-1e8a-e348e635a53c@spatialys.com>

Hi,

there has been positive feedback in the github pull request. Does 
someone need extra time to review before I submit this to vote ?

Even

Le 01/06/2022 ? 10:49, Even Rouault a ?crit?:
> Hi,
>
> I've posted in https://github.com/OSGeo/gdal/pull/5830 a new RFC to 
> add a column-oriented read API for vector layers.
>
> This RFC describes the addition of new methods to the OGRLayer class 
> to retrieve batches of features
> with a column-oriented memory layout, that suits formats that have 
> that organization or downstream
> consumers that expect data to be presented in such a way, in 
> particular the Apache Arrow, Pandas / GeoPandas
> ecosystem, R spatial packages, and many modern (data analytics 
> focused) databases / engines which
> are column oriented (eg Snowflake, Google BigQuery, ..)
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Wed Jun  8 03:38:45 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 8 Jun 2022 12:38:45 +0200
Subject: [gdal-dev] Issue defining compound projection with a local
 projection for GeoTIFF
In-Reply-To: <000001d87b06$fc686570$f5393050$@aquaveo.com>
References: <000001d87b06$fc686570$f5393050$@aquaveo.com>
Message-ID: <5039eb26-0e84-6c9f-bdae-35b6e454f853@spatialys.com>

Chris,

Please file a ticket about that at https://github.com/OSGeo/gdal/issues/new

Even

Le 08/06/2022 ? 09:11, Chris Smemoe via gdal-dev a ?crit?:
>
> I?m not sure whether this is a bug or some issue with how I?m doing 
> things (like maybe my WKT is bogus), but when I try to define a 
> compound projection for a GeoTIFF with a local projection, the 
> vertical projection information does not get saved to the GeoTIFF and 
> I get an error reported from PROJ.? I am trying to upgrade the version 
> of GDAL I?m using and I think this used to work in GDAL version 2.x 
> but no longer works in GDAL 3.x/PROJ 7.x.? What I?m trying to do is to 
> update the projection of a GeoTIFF from a local projection with 
> horizontal units only to a compound projection with both horizontal 
> and vertical units.? When I close the GDAL dataset, It seems like PROJ 
> is trying to look for an ellipsoid node for the spatial reference 
> object but I don?t have one since I?m using a local projection.? Then 
> when I reopen the dataset, nothing seems to have been saved.? I?m 
> running GDAL 3.4.2. Here?s an example of what I?m trying to do:
>
> -------------------begin-------------------
>
> python
>
> >>> from osgeo import gdal
>
> >>> gd = gdal.Open("C:\\temp\\grid_meter_exported.tif", gdal.GA_Update)
>
> >>> gd
>
> <osgeo.gdal.Dataset; proxy of <Swig Object of type 'GDALDatasetShadow 
> *' at 0x000001B6BC578630> >
>
> >>> gd.GetProjectionRef()
>
> 'LOCAL_CS["None",UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]'
>
> >>> 
> gd.SetProjection('COMPD_CS["None",LOCAL_CS["None",LOCAL_DATUM["None",32767],UNIT["Foot_US",0.304800609601219],AXIS["None",OTHER]],VERT_CS["Local 
> Meter",VERT_DATUM["Local",2005],UNIT["Meter",1,AUTHORITY["EPSG","9001"]],AXIS["Gravity-related 
> height",UP]]]')
>
> 0
>
> >>> gd.GetProjection()
>
> 'COMPD_CS["None",LOCAL_CS["None",LOCAL_DATUM["None",32767],UNIT["Foot_US",0.304800609601219],AXIS["None",OTHER]],VERT_CS["Local 
> Meter",VERT_DATUM["Local",2005],UNIT["Meter",1,AUTHORITY["EPSG","9001"]],AXIS["Gravity-related 
> height",UP]]]'
>
> >>> gd = None
>
> ERROR 1: PROJ: proj_get_ellipsoid: CRS has no geodetic CRS
>
> ERROR 1: PROJ: proj_get_ellipsoid: Object is not a CRS or 
> GeodeticReferenceFrame
>
> ERROR 1: PROJ: proj_get_ellipsoid: CRS has no geodetic CRS
>
> ERROR 1: PROJ: proj_get_ellipsoid: Object is not a CRS or 
> GeodeticReferenceFrame
>
> ERROR 1: PROJ: proj_crs_get_geodetic_crs: CRS has no geodetic CRS
>
> >>> gd = gdal.Open("C:\\temp\\grid_meter_exported.tif", gdal.GA_Update)
>
> >>> gd
>
> <osgeo.gdal.Dataset; proxy of <Swig Object of type 'GDALDatasetShadow 
> *' at 0x000001B6BC578720> >
>
> >>> gd.GetProjectionRef()
>
> 'LOCAL_CS["None",UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]'
>
> -------------------end-------------------
>
> The dataset I?m working with can be downloaded here:
>
> https://www.dropbox.com/s/2jn7vkcl690e90r/grid_meter_exported.tif?dl=1
>
> I?d appreciate any guidance.
>
> Thanks,
>
> Chris
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220608/cf939ca8/attachment.htm>

From hailey at foundryspatial.com  Wed Jun  8 10:13:14 2022
From: hailey at foundryspatial.com (Hailey Eckstrand)
Date: Wed, 8 Jun 2022 10:13:14 -0700
Subject: [gdal-dev] ogr2ogr -clipsrc datasource postgis?
Message-ID: <CAKWcUT3dsOYrLokBTUa43_O18TJDtEuLGZ11CArWGEjJxuMWMQ@mail.gmail.com>

Hi all,

I'm trying to import a layer from a filegeodatabase into postgis and clip
it to a separate postgis layer. Is that possible? I can successfully clip
using the clipsrc argument with a bounding box I've read that it will also
work for a shapefile, but I'd prefer to use a postgis layer as the clipsrc
datasource.


ogr2ogr \
-f "PostgreSQL" \
PG:$(DATABASE_URL_OGR) \
data/data.gdb \
-nln data.flows \
Flows \
-lco GEOMETRY_NAME=geom \
-nlt MULTILINESTRING \
-t_srs EPSG:4326 \
-clipsrc datasource \
-clipsrclayer 'select geom4326 from data.boundary' PG:$(DATABASE_URL_OGR)

This is my latest attempt but the error is:
ERROR 5: cannot load source clip geometry

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220608/4d3f5712/attachment-0001.htm>

From andreas.oxenstierna at t-kartor.com  Wed Jun  8 23:49:33 2022
From: andreas.oxenstierna at t-kartor.com (Andreas Oxenstierna)
Date: Thu, 9 Jun 2022 06:49:33 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
References: <2fdbef2d-e7eb-437b-832f-6126d7d1c9b8@Spark>
Message-ID: <4773d6df-8a07-4fd1-88b8-8a1190d2cee0@Spark>

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<http://www.t-kartor.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/d8f7fdeb/attachment.htm>

From alexandre.gacon at gmail.com  Wed Jun  8 23:59:03 2022
From: alexandre.gacon at gmail.com (Alexandre Gacon)
Date: Thu, 9 Jun 2022 08:59:03 +0200
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <4773d6df-8a07-4fd1-88b8-8a1190d2cee0@Spark>
References: <2fdbef2d-e7eb-437b-832f-6126d7d1c9b8@Spark>
 <4773d6df-8a07-4fd1-88b8-8a1190d2cee0@Spark>
Message-ID: <CAFJaAp6g8ZGTR2K=ZsRoqVDBRfVyNqp2fCXXcvZz19qJ9fqpyA@mail.gmail.com>

Hi,

If you work with a Postgres database, why don't you do this directly in the
database? It seems odd to use ogrinfo to do such updates in database.

Regards
Alexandre

Le jeu. 9 juin 2022 ? 08:50, Andreas Oxenstierna <
andreas.oxenstierna at t-kartor.com> a ?crit :

> Dear developers
>
> Ogr SQL update capabilities are really impressing but there is one major
> performance issue with update of many features, exemplified by:
> ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"
>
> This is painfully slow because ogr updates features one by one and
> furthermore updates all existing attributes incl. geometries.
> Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1
> executes in milliseconds but takes several minutes with ogr.
>
> The current ogr functionality is also not correct from a database
> transactional point of view.
>
> I found an old RFC,
> https://gdal.org/development/rfc/rfc13_createfeatures.html, requesting
> this but it was withdrawn for reasons not anymore digitally available.
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Alexandre Gacon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/6c7aa902/attachment.htm>

From andreas.oxenstierna at t-kartor.com  Thu Jun  9 00:16:54 2022
From: andreas.oxenstierna at t-kartor.com (Andreas Oxenstierna)
Date: Thu, 9 Jun 2022 07:16:54 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <CAFJaAp6g8ZGTR2K=ZsRoqVDBRfVyNqp2fCXXcvZz19qJ9fqpyA@mail.gmail.com>
References: <2fdbef2d-e7eb-437b-832f-6126d7d1c9b8@Spark>
 <4773d6df-8a07-4fd1-88b8-8a1190d2cee0@Spark>
 <CAFJaAp6g8ZGTR2K=ZsRoqVDBRfVyNqp2fCXXcvZz19qJ9fqpyA@mail.gmail.com>
Message-ID: <1cd079bc-5b57-4723-9952-82b461990e38@Spark>

Of course I normally do this directly in the database with pgAdmin or psql.

In this process scenario it is preferable if the complete process (this is the final step of approx. 10 gdal/ogr processes) can be executed in batch by a client with no psql access.
We have to use psql if there is no acceptable solution with ogr

H?lsningar

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<http://www.t-kartor.com>
On 9 Jun 2022, 08:59 +0200, Alexandre Gacon <alexandre.gacon at gmail.com>, wrote:
Hi,

If you work with a Postgres database, why don't you do this directly in the database? It seems odd to use ogrinfo to do such updates in database.

Regards
Alexandre

Le jeu. 9 juin 2022 ? 08:50, Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>> a ?crit :
Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<http://www.t-kartor.com>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
Alexandre Gacon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/2fac4c20/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Jun  9 00:46:25 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 9 Jun 2022 07:46:25 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
Message-ID: <AM0PR09MB32198DF30C14024EB2D68044FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Do not use "-dialect sqlite" if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:"<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ced60af7ce08c45c3998108da49e44745%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903542052214466%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=UNIxumUx%2BtBz8Vb7jjH3Uvnbjwo3WYvj9tsRmrFHw5g%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/2773116f/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Jun  9 01:12:32 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 9 Jun 2022 08:12:32 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
Message-ID: <AM0PR09MB3219812C6E5FC5CB0B3629A3FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi again,

It might be good to know how the SQLite dialect works. When it is used for other datasources than natively SQLite based ones then GDAL creates a virtual table into a SQLite database with a VirtualOGR system. There is some information about that in https://www.gaia-gis.it/fossil/libspatialite/wiki?name=VirtualOGR.

As Sandro writes, it is really amazing, but you should not await that it is amazingly fast in all use cases. You compare direct SQL inside PostGIS with a process that copies data from PostGIS into SQLite, updates the features, and writes them back to PostGIS. Fortunately you do not need to use that long route with PostGIS because GDAL knows how to use native PostgreSQL dialect. However, sometimes it makes sense to use "-dialect SQLite" also with PostGIS because SpatiaLite has some nice functions that PostGIS does not have https://www.gaia-gis.it/gaia-sins/spatialite-sql-latest.html.

-Jukka Rahkonen-


L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:"<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ced60af7ce08c45c3998108da49e44745%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903542052214466%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=UNIxumUx%2BtBz8Vb7jjH3Uvnbjwo3WYvj9tsRmrFHw5g%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/670db1b0/attachment-0001.htm>

From jan.heckman at gmail.com  Thu Jun  9 01:17:11 2022
From: jan.heckman at gmail.com (Jan Heckman)
Date: Thu, 9 Jun 2022 10:17:11 +0200
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <AM0PR09MB32198DF30C14024EB2D68044FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB32198DF30C14024EB2D68044FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CAKMUAtBNMFUHRjr8J-aYhPn6JLkVdTP1fJ2VuDHU0_DM6_=XWw@mail.gmail.com>

Afaik as I know, slightly more involved sql on a postgresql table requires
dialect=sqlite to work at all, e.g. (picked a random example using ogr2ogr
instead of ogrinfo)
ogr2ogr -f postgresql -dialect sqlite -append PG:"user=%user%
dbname=%dbname%" -sql "select trim(coalesce(iv1,''),';') as fidstring,
code, st_union(geometry) as multipolygon from alltogether_pruned_out group
by iv1,code" -nln %schema%.%baseout%_pruned -nlt multipolygon
alltogether_pruned_out.shp
This gives me acceptable performance, btw. It's handling a really large
dataset, so having to wait for some minutes did not bother me.
This is on version 3.4.2.
The transaction behavior in ogr2ogr can be influenced with the -gt option,
with -gt unlimited to do everything in a single transaction.
But it would be nice if this imo strange need to refer to dialect sqlite
were removed. Especially strange when you use postgis functions in the sql
statement...
Best regards,
Jan

On Thu, Jun 9, 2022 at 9:46 AM Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Do not use ?-dialect sqlite? if you play with PostgreSQL but let GDAL to
> use the native PG SQL dialect.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Andreas
> Oxenstierna
> *L?hetetty:* torstai 9. kes?kuuta 2022 9.50
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] ogrinfo UPDATE performance request
>
>
>
> Dear developers
>
> Ogr SQL update capabilities are really impressing but there is one major
> performance issue with update of many features, exemplified by:
> ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"
>
> This is painfully slow because ogr updates features one by one and
> furthermore updates all existing attributes incl. geometries.
> Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1
> executes in milliseconds but takes several minutes with ogr.
>
> The current ogr functionality is also not correct from a database
> transactional point of view.
>
> I found an old RFC,
> https://gdal.org/development/rfc/rfc13_createfeatures.html, requesting
> this but it was withdrawn for reasons not anymore digitally available.
>
>
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com
> <https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ced60af7ce08c45c3998108da49e44745%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903542052214466%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=UNIxumUx%2BtBz8Vb7jjH3Uvnbjwo3WYvj9tsRmrFHw5g%3D&reserved=0>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/fce61d6c/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Jun  9 01:57:32 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 9 Jun 2022 08:57:32 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
Message-ID: <AM0PR09MB32192A3C89D553E51B869C17FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi Jan,

I had a try with a table that I created from the "states" shapefile from the Geoserver demo data.

ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw" -sql "select trim(coalesce(state_name,state_fips),';') as fidstring, state_fips, st_union(wkb_geometry) as multipolygon from states group by state_name,state_fips"

I think that the SQL is fundamentally the same and it does work for me with the default dialect once I edited the geometry column name to the one I have in PostGIS. Are you sure that it requires SQLite dialect for you? Have you tested the SQL with psql?

-Jukka Rahkonen-


L?hett?j?: Jan Heckman <jan.heckman at gmail.com>
L?hetetty: torstai 9. kes?kuuta 2022 11.17
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogrinfo UPDATE performance request

Afaik as I know, slightly more involved sql on a postgresql table requires dialect=sqlite to work at all, e.g. (picked a random example using ogr2ogr instead of ogrinfo)
ogr2ogr -f postgresql -dialect sqlite -append PG:"user=%user% dbname=%dbname%" -sql "select trim(coalesce(iv1,''),';') as fidstring, code, st_union(geometry) as multipolygon from alltogether_pruned_out group by iv1,code" -nln %schema%.%baseout%_pruned -nlt multipolygon alltogether_pruned_out.shp
This gives me acceptable performance, btw. It's handling a really large dataset, so having to wait for some minutes did not bother me.
This is on version 3.4.2.
The transaction behavior in ogr2ogr can be influenced with the -gt option, with -gt unlimited to do everything in a single transaction.
But it would be nice if this imo strange need to refer to dialect sqlite were removed. Especially strange when you use postgis functions in the sql statement...
Best regards,
Jan

On Thu, Jun 9, 2022 at 9:46 AM Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Do not use "-dialect sqlite" if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:"<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca5ad6f614e254c2857c908da49f07cc1%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903594478569882%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=5lD3AZEeicoNPWSa4PFwpNcmqVhTPKOR9jArFnzxKkA%3D&reserved=0>, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca5ad6f614e254c2857c908da49f07cc1%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903594478569882%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=WK25LhkFBg31rJ%2Fvy09FN2ZLXrRen5zKF1cQROwj8AY%3D&reserved=0>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca5ad6f614e254c2857c908da49f07cc1%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903594478569882%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=39wIlMAl6pw9zwU3hQ3tpQ2S9BD3aVexhZZ%2FIU2gxEY%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/7c49d5cd/attachment-0001.htm>

From andreas.oxenstierna at t-kartor.com  Thu Jun  9 02:02:08 2022
From: andreas.oxenstierna at t-kartor.com (Andreas Oxenstierna)
Date: Thu, 9 Jun 2022 09:02:08 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <AM0PR09MB32198DF30C14024EB2D68044FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB32198DF30C14024EB2D68044FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <99ebc6b0-2907-4ebc-baa7-53b24018d681@Spark>

Hi

AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have not tested the native PG SQL dialect extensively though, it took some time to find the correct syntax.
And to answer one other mail, the table name needs to be written as \?<schema>.<table>\?, at least on macOS

The performance issue is mainly that ogrinfo updates one feature at a time. Even if it should pack all data, copy it into a temp SQLite, do the update and transact back, it would be vastly faster if it is done in one transaction instead of one transaction for each feature as it is done now.

However, I realised that a workaround may be to add needed attribute info to any file format (GeoPackage or shape) - need to verify the performance though.
It should be nice to be able to execute this in a pure GDAL/OGR environment - the use case is to aggregate on different values, resolutions and interpolation methods for an AI platform so we may need to test thousands of variants.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<http://www.t-kartor.com>
On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>, wrote:
Hi,

Do not use ?-dialect sqlite? if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ced60af7ce08c45c3998108da49e44745%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903542052214466%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000%7C%7C%7C&sdata=UNIxumUx%2BtBz8Vb7jjH3Uvnbjwo3WYvj9tsRmrFHw5g%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/8e1086b6/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Jun  9 02:15:47 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 9 Jun 2022 09:15:47 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
Message-ID: <AM0PR09MB321984224B04568F28AD0743FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

This updated 166000 rows in 15 seconds for me on my laptop without any workarounds:
ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw" -sql "update buildingtest set version=99"

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>
L?hetetty: torstai 9. kes?kuuta 2022 12.02
Vastaanottaja: gdal-dev at lists.osgeo.org; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: ogrinfo UPDATE performance request

Hi

AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have not tested the native PG SQL dialect extensively though, it took some time to find the correct syntax.
And to answer one other mail, the table name needs to be written as \"<schema>.<table>\", at least on macOS

The performance issue is mainly that ogrinfo updates one feature at a time. Even if it should pack all data, copy it into a temp SQLite, do the update and transact back, it would be vastly faster if it is done in one transaction instead of one transaction for each feature as it is done now.

However, I realised that a workaround may be to add needed attribute info to any file format (GeoPackage or shape) - need to verify the performance though.
It should be nice to be able to execute this in a pure GDAL/OGR environment - the use case is to aggregate on different values, resolutions and interpolation methods for an AI platform so we may need to test thousands of variants.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fOWKJE8n6lhdusAHklUPVfNqeIILJVDmszyuol6L6vs%3D&reserved=0>
On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:

Hi,

Do not use "-dialect sqlite" if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:"<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=AfWG17fsXJ1t6NaQAlAnz0b1bsgnwOwzHZJJVmfkyd4%3D&reserved=0>, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fOWKJE8n6lhdusAHklUPVfNqeIILJVDmszyuol6L6vs%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/7abb254a/attachment-0001.htm>

From andreas.oxenstierna at t-kartor.com  Thu Jun  9 02:47:36 2022
From: andreas.oxenstierna at t-kartor.com (Andreas Oxenstierna)
Date: Thu, 9 Jun 2022 09:47:36 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <AM0PR09MB321984224B04568F28AD0743FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB321984224B04568F28AD0743FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <c8306fca-4e2b-41bf-9655-bd79d71090b1@Spark>

Hi

Thanks a lot and sorry for the noise.
UPDATE do work as expected using the OGR SQL, i.e. one atomic db transaction executing in the database = vastly faster than using -dialect sqlite
.
The doc at https://gdal.org/user/ogr_sql_dialect.html needs some addition - I assume that INSERT, DELETE etc. also works
"While in theory any sort of command could be handled this way, in practice the mechanism is used to provide a subset of SQL SELECT capability to applications."

Maybe also clarify if the sqlite dialect is necessary to keep at all ...

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<http://www.t-kartor.com>
On 9 Jun 2022, 11:15 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>, wrote:
Hi,

This updated 166000 rows in 15 seconds for me on my laptop without any workarounds:
ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw" -sql "update buildingtest set version=99"

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>
L?hetetty: torstai 9. kes?kuuta 2022 12.02
Vastaanottaja: gdal-dev at lists.osgeo.org; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: ogrinfo UPDATE performance request

Hi

AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have not tested the native PG SQL dialect extensively though, it took some time to find the correct syntax.
And to answer one other mail, the table name needs to be written as \?<schema>.<table>\?, at least on macOS

The performance issue is mainly that ogrinfo updates one feature at a time. Even if it should pack all data, copy it into a temp SQLite, do the update and transact back, it would be vastly faster if it is done in one transaction instead of one transaction for each feature as it is done now.

However, I realised that a workaround may be to add needed attribute info to any file format (GeoPackage or shape) - need to verify the performance though.
It should be nice to be able to execute this in a pure GDAL/OGR environment - the use case is to aggregate on different values, resolutions and interpolation methods for an AI platform so we may need to test thousands of variants.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fOWKJE8n6lhdusAHklUPVfNqeIILJVDmszyuol6L6vs%3D&reserved=0>
On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:

Hi,

Do not use ?-dialect sqlite? if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=AfWG17fsXJ1t6NaQAlAnz0b1bsgnwOwzHZJJVmfkyd4%3D&reserved=0>, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fOWKJE8n6lhdusAHklUPVfNqeIILJVDmszyuol6L6vs%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/69525d55/attachment-0001.htm>

From jan.heckman at gmail.com  Thu Jun  9 03:02:29 2022
From: jan.heckman at gmail.com (Jan Heckman)
Date: Thu, 9 Jun 2022 12:02:29 +0200
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <AM0PR09MB32192A3C89D553E51B869C17FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB32192A3C89D553E51B869C17FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CAKMUAtAGDUT_15bGP5QyqBOHJ_hCaCc9dGDjPXPr8LeN-740GQ@mail.gmail.com>

Hi Jukka,
Not entirely sure what you mean by 'have you tested the sql with psql',
since this is an ogr2ogr process which works.
It is a remnant of a case where multiple iv (iv1, iv2 etc.) shapefile
columns were needed, so the sql used to be
like
coalesce(iv1,'')||coalesce(iv2,'')||coalesce(iv2,'')||coalesce(iv3,'')||coalesce(iv4,'')
instead of a single (useless) coalesce,
which I kept as it might come in handy later.
I am reconstructing my stuff (new update), as the idea of a good speed up
by leaving out -dialect sqlite is attractive.
So far I noticed that one postgis function requires sqlite dialect:
D:\ro_enkel\data>ogr2ogr -f postgresql -append -gt unlimited
PG:"user=postgres dbname=test sslmode=disable" -sql "select
*,substr(plangebied,9,4) as ovh_code from enkelbestemming where
ST_GeometryType(geometrie)='POLYGON'" -nlt multipolygon -nln
ro_enkel.enkelbestemming enkelbestemming.gml.gz -progress
ERROR 1: Undefined function 'ST_GeometryType' used.
(I know that I could have used -skipfailures to get rid of linestring
geometries here, but the specific geometry type selection seemed better)
I'll check my other sqlite dialect stuff as soon as I get to it, but first
I need to wait for a conversion to complete.
Hope this rings a bell about parsing the sql with postgis functions in
postgresql dialect?
Best regards,
Jan

On Thu, Jun 9, 2022 at 10:57 AM Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi Jan,
>
>
>
> I had a try with a table that I created from the ?states? shapefile from
> the Geoserver demo data.
>
>
>
> ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw"
> -sql "select trim(coalesce(state_name,state_fips),';') as fidstring,
> state_fips, st_union(wkb_geometry) as multipolygon from states group by
> state_name,state_fips"
>
>
>
> I think that the SQL is fundamentally the same and it does work for me
> with the default dialect once I edited the geometry column name to the one
> I have in PostGIS. Are you sure that it requires SQLite dialect for you?
> Have you tested the SQL with psql?
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Jan Heckman <jan.heckman at gmail.com>
> *L?hetetty:* torstai 9. kes?kuuta 2022 11.17
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogrinfo UPDATE performance request
>
>
>
> Afaik as I know, slightly more involved sql on a postgresql table requires
> dialect=sqlite to work at all, e.g. (picked a random example using ogr2ogr
> instead of ogrinfo)
>
> ogr2ogr -f postgresql -dialect sqlite -append PG:"user=%user%
> dbname=%dbname%" -sql "select trim(coalesce(iv1,''),';') as fidstring,
> code, st_union(geometry) as multipolygon from alltogether_pruned_out group
> by iv1,code" -nln %schema%.%baseout%_pruned -nlt multipolygon
> alltogether_pruned_out.shp
>
> This gives me acceptable performance, btw. It's handling a really large
> dataset, so having to wait for some minutes did not bother me.
>
> This is on version 3.4.2.
>
> The transaction behavior in ogr2ogr can be influenced with the -gt option,
> with -gt unlimited to do everything in a single transaction.
>
> But it would be nice if this imo strange need to refer to dialect sqlite
> were removed. Especially strange when you use postgis functions in the sql
> statement...
>
> Best regards,
>
> Jan
>
>
>
> On Thu, Jun 9, 2022 at 9:46 AM Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> Do not use ?-dialect sqlite? if you play with PostgreSQL but let GDAL to
> use the native PG SQL dialect.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Andreas
> Oxenstierna
> *L?hetetty:* torstai 9. kes?kuuta 2022 9.50
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] ogrinfo UPDATE performance request
>
>
>
> Dear developers
>
> Ogr SQL update capabilities are really impressing but there is one major
> performance issue with update of many features, exemplified by:
> ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"
>
> This is painfully slow because ogr updates features one by one and
> furthermore updates all existing attributes incl. geometries.
> Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1
> executes in milliseconds but takes several minutes with ogr.
>
> The current ogr functionality is also not correct from a database
> transactional point of view.
>
> I found an old RFC,
> https://gdal.org/development/rfc/rfc13_createfeatures.html
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca5ad6f614e254c2857c908da49f07cc1%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903594478569882%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=5lD3AZEeicoNPWSa4PFwpNcmqVhTPKOR9jArFnzxKkA%3D&reserved=0>,
> requesting this but it was withdrawn for reasons not anymore digitally
> available.
>
>
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com
> <https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca5ad6f614e254c2857c908da49f07cc1%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903594478569882%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=WK25LhkFBg31rJ%2Fvy09FN2ZLXrRen5zKF1cQROwj8AY%3D&reserved=0>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Ca5ad6f614e254c2857c908da49f07cc1%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903594478569882%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=39wIlMAl6pw9zwU3hQ3tpQ2S9BD3aVexhZZ%2FIU2gxEY%3D&reserved=0>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/3c285084/attachment.htm>

From even.rouault at spatialys.com  Thu Jun  9 03:16:03 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 9 Jun 2022 12:16:03 +0200
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <c8306fca-4e2b-41bf-9655-bd79d71090b1@Spark>
References: <AM0PR09MB321984224B04568F28AD0743FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <c8306fca-4e2b-41bf-9655-bd79d71090b1@Spark>
Message-ID: <8f12e612-4b0c-98b0-4a86-cd9536a1d779@spatialys.com>

For the SQLite dialect, the page to consult is 
https://gdal.org/user/sql_sqlite_dialect.html

Le 09/06/2022 ? 11:47, Andreas Oxenstierna a ?crit?:
> Hi
>
> Thanks a lot and sorry for the noise.
> UPDATE do work as expected using the OGR SQL, i.e. one atomic db 
> transaction executing in the database = vastly faster than using 
> -dialect sqlite
> .
> The doc at https://gdal.org/user/ogr_sql_dialect.html?needs some 
> addition - I assume that INSERT, DELETE etc. also works
> "While in theory any sort of command could be handled this way, in 
> practice the mechanism is used to provide a subset of SQL SELECT 
> capability to applications."
>
> Maybe also clarify if the sqlite dialect is necessary to keep at all ...
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com <http://www.t-kartor.com>
> On 9 Jun 2022, 11:15 +0200, Rahkonen Jukka 
> <jukka.rahkonen at maanmittauslaitos.fi>, wrote:
>>
>> Hi,
>>
>> This updated 166000 rows in 15 seconds for me on my laptop without 
>> any workarounds:
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user 
>> password=pw" -sql "update buildingtest set version=99"
>>
>> -Jukka Rahkonen-
>>
>> *L?hett?j?:* Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>
>> *L?hetetty:* torstai 9. kes?kuuta 2022 12.02
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org; Rahkonen Jukka 
>> <jukka.rahkonen at maanmittauslaitos.fi>
>> *Aihe:* Re: ogrinfo UPDATE performance request
>>
>> Hi
>>
>> AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have 
>> not tested the native PG SQL dialect extensively though, it took some 
>> time to find the correct syntax.
>> And to answer one other mail, the table name needs to be written as 
>> \?<schema>.<table>\?, at least on macOS
>>
>> The performance issue is mainly that ogrinfo updates one feature at a 
>> time. Even if it should pack all data, copy it into a temp SQLite, do 
>> the update and transact back, it would be vastly faster if it is done 
>> in one transaction instead of one transaction for each feature as it 
>> is done now.
>>
>> However, I realised that a workaround may be to add needed attribute 
>> info to any file format (GeoPackage or shape) - need to verify the 
>> performance though.
>> It should be nice to be able to execute this in a pure GDAL/OGR 
>> environment - the use case is to aggregate on different values, 
>> resolutions and interpolation methods for an AI platform so we may 
>> need to test thousands of variants.
>>
>> Best Regards
>>
>> Andreas Oxenstierna
>> T-Kartor Geospatial AB
>> Olof Mohlins v?g 12 Kristianstad
>> mobile: +46 733 206831
>> mailto: andreas.oxenstierna at t-kartor.com
>> www.t-kartor.com 
>> <https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fOWKJE8n6lhdusAHklUPVfNqeIILJVDmszyuol6L6vs%3D&reserved=0>
>>
>> On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka 
>> <jukka.rahkonen at maanmittauslaitos.fi>, wrote:
>>
>>     Hi,
>>
>>     Do not use ?-dialect sqlite? if you play with PostgreSQL but let
>>     GDAL to use the native PG SQL dialect.
>>
>>     -Jukka Rahkonen-
>>
>>     *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
>>     *Puolesta* Andreas Oxenstierna
>>     *L?hetetty:* torstai 9. kes?kuuta 2022 9.50
>>     *Vastaanottaja:* gdal-dev at lists.osgeo.org
>>     *Aihe:* [gdal-dev] ogrinfo UPDATE performance request
>>
>>     Dear developers
>>
>>     Ogr SQL update capabilities are really impressing but there is
>>     one major performance issue with update of many features,
>>     exemplified by:
>>     ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1"
>>     PG:?<connection>"
>>
>>     This is painfully slow because ogr updates features one by one
>>     and furthermore updates all existing attributes incl. geometries.
>>     Eg. updating 10000 features in pgAdmin/psql with UPDATE <table>
>>     SET x = 1 executes in milliseconds but takes several minutes with
>>     ogr.
>>
>>     The current ogr functionality is also not correct from a database
>>     transactional point of view.
>>
>>     I found an old RFC,
>>     https://gdal.org/development/rfc/rfc13_createfeatures.html
>>     <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=AfWG17fsXJ1t6NaQAlAnz0b1bsgnwOwzHZJJVmfkyd4%3D&reserved=0>,
>>     requesting this but it was withdrawn for reasons not anymore
>>     digitally available.
>>
>>     Best Regards
>>
>>     Andreas Oxenstierna
>>     T-Kartor Geospatial AB
>>     Olof Mohlins v?g 12 Kristianstad
>>     mobile: +46 733 206831
>>     mailto: andreas.oxenstierna at t-kartor.com
>>     www.t-kartor.com
>>     <https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cdbe5e7e115e843096f4508da49f6c062%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903621379745511%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fOWKJE8n6lhdusAHklUPVfNqeIILJVDmszyuol6L6vs%3D&reserved=0>
>>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/a7c19ec1/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Jun  9 03:18:45 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 9 Jun 2022 10:18:45 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
Message-ID: <AM0PR09MB3219D3EC7D1626ED8C4ED724FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

You are getting closer but at the bottom of the page https://gdal.org/user/ogr_sql_dialect.html there is an important paragraph:

Non-OGR SQL
All OGR drivers for database systems: MySQL, PostgreSQL / PostGIS, Oracle Spatial, SQLite / Spatialite RDBMS, ODBC RDBMS, ESRI Personal GeoDatabase, SAP HANA and MSSQLSpatial - Microsoft SQL Server Spatial Database, override the GDALDataset::ExecuteSQL() function with dedicated implementation and, by default, pass the SQL statements directly to the underlying RDBMS. In these cases the SQL syntax varies in some particulars from OGR SQL. Also, anything possible in SQL can then be accomplished for these particular databases. Only the result of SQL WHERE statements will be returned as layers.

So if you do not select SQL dialect for PostGIS you do not use the OGR SQL dialect but the native PostgreSQL one. For using OGR SQL with PostgreSQL (maybe it could make sense in some special case but I am not sure) use "-dialect OGRSQL". If you are uncertain about what dialect is in use you can make a tests with some native-only functions like -sql "select postgis_version()" or -sql "select sqlite_version".

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>
L?hetetty: torstai 9. kes?kuuta 2022 12.48
Vastaanottaja: gdal-dev at lists.osgeo.org; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: ogrinfo UPDATE performance request

Hi

Thanks a lot and sorry for the noise.
UPDATE do work as expected using the OGR SQL, i.e. one atomic db transaction executing in the database = vastly faster than using -dialect sqlite
.
The doc at https://gdal.org/user/ogr_sql_dialect.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fuser%2Fogr_sql_dialect.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638713449%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=X63CofyOIyNwpeP%2Ba605L5ZCCn7Z8qP36rt5VwQc8eE%3D&reserved=0> needs some addition - I assume that INSERT, DELETE etc. also works
"While in theory any sort of command could be handled this way, in practice the mechanism is used to provide a subset of SQL SELECT capability to applications."

Maybe also clarify if the sqlite dialect is necessary to keep at all ...

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
On 9 Jun 2022, 11:15 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:

Hi,

This updated 166000 rows in 15 seconds for me on my laptop without any workarounds:
ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw" -sql "update buildingtest set version=99"

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>>
L?hetetty: torstai 9. kes?kuuta 2022 12.02
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: ogrinfo UPDATE performance request

Hi

AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have not tested the native PG SQL dialect extensively though, it took some time to find the correct syntax.
And to answer one other mail, the table name needs to be written as \"<schema>.<table>\", at least on macOS

The performance issue is mainly that ogrinfo updates one feature at a time. Even if it should pack all data, copy it into a temp SQLite, do the update and transact back, it would be vastly faster if it is done in one transaction instead of one transaction for each feature as it is done now.

However, I realised that a workaround may be to add needed attribute info to any file format (GeoPackage or shape) - need to verify the performance though.
It should be nice to be able to execute this in a pure GDAL/OGR environment - the use case is to aggregate on different values, resolutions and interpolation methods for an AI platform so we may need to test thousands of variants.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:
Hi,

Do not use "-dialect sqlite" if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:"<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=kt57EZEaekVUQ3o1yZSAHv0pMtSQMV50HIhGKSEdues%3D&reserved=0>, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/fc8990c2/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Jun  9 03:36:06 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 9 Jun 2022 10:36:06 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
Message-ID: <AM0PR09MB3219ABF5E7576B5B653EAB92FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Sorry, I did not read well enough about what you were doing. You wrote "slightly more involved sql on a postgresql table requires dialect=sqlite to work at all" but in your example you are reading data from a shapefile "alltogether_pruned_out.shp". That you write data into PostGIS does not play any role, select is executed against the source. For shapefile there is no native SQL dialect so the alternatives are OGR SQL that is the default but does not support coalesce, and SQLite SQL that supports coalesce but must be especially selected with -dialect sqlite.

I misread that you were reading data from PostGIS and in that case coalesce is supported with the default SQL that is PostgreSQL SQL then. Suggestion to test the SQL with psql was referring to my wrong assumption about the source data.

-Jukka-

L?hett?j?: Jan Heckman <jan.heckman at gmail.com>
L?hetetty: torstai 9. kes?kuuta 2022 13.02
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogrinfo UPDATE performance request

Hi Jukka,
Not entirely sure what you mean by 'have you tested the sql with psql', since this is an ogr2ogr process which works.
It is a remnant of a case where multiple iv (iv1, iv2 etc.) shapefile columns were needed, so the sql used to be
like coalesce(iv1,'')||coalesce(iv2,'')||coalesce(iv2,'')||coalesce(iv3,'')||coalesce(iv4,'') instead of a single (useless) coalesce,
which I kept as it might come in handy later.
I am reconstructing my stuff (new update), as the idea of a good speed up by leaving out -dialect sqlite is attractive.
So far I noticed that one postgis function requires sqlite dialect:
D:\ro_enkel\data>ogr2ogr -f postgresql -append -gt unlimited PG:"user=postgres dbname=test sslmode=disable" -sql "select *,substr(plangebied,9,4) as ovh_code from enkelbestemming where ST_GeometryType(geometrie)='POLYGON'" -nlt multipolygon -nln ro_enkel.enkelbestemming enkelbestemming.gml.gz -progress
ERROR 1: Undefined function 'ST_GeometryType' used.
(I know that I could have used -skipfailures to get rid of linestring geometries here, but the specific geometry type selection seemed better)
I'll check my other sqlite dialect stuff as soon as I get to it, but first I need to wait for a conversion to complete.
Hope this rings a bell about parsing the sql with postgis functions in postgresql dialect?
Best regards,
Jan

On Thu, Jun 9, 2022 at 10:57 AM Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi Jan,

I had a try with a table that I created from the "states" shapefile from the Geoserver demo data.

ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw" -sql "select trim(coalesce(state_name,state_fips),';') as fidstring, state_fips, st_union(wkb_geometry) as multipolygon from states group by state_name,state_fips"

I think that the SQL is fundamentally the same and it does work for me with the default dialect once I edited the geometry column name to the one I have in PostGIS. Are you sure that it requires SQLite dialect for you? Have you tested the SQL with psql?

-Jukka Rahkonen-

L?hett?j?: Jan Heckman <jan.heckman at gmail.com<mailto:jan.heckman at gmail.com>>
L?hetetty: torstai 9. kes?kuuta 2022 11.17
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] ogrinfo UPDATE performance request

Afaik as I know, slightly more involved sql on a postgresql table requires dialect=sqlite to work at all, e.g. (picked a random example using ogr2ogr instead of ogrinfo)
ogr2ogr -f postgresql -dialect sqlite -append PG:"user=%user% dbname=%dbname%" -sql "select trim(coalesce(iv1,''),';') as fidstring, code, st_union(geometry) as multipolygon from alltogether_pruned_out group by iv1,code" -nln %schema%.%baseout%_pruned -nlt multipolygon alltogether_pruned_out.shp
This gives me acceptable performance, btw. It's handling a really large dataset, so having to wait for some minutes did not bother me.
This is on version 3.4.2.
The transaction behavior in ogr2ogr can be influenced with the -gt option, with -gt unlimited to do everything in a single transaction.
But it would be nice if this imo strange need to refer to dialect sqlite were removed. Especially strange when you use postgis functions in the sql statement...
Best regards,
Jan

On Thu, Jun 9, 2022 at 9:46 AM Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Do not use "-dialect sqlite" if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:"<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C9ff03396a5954105d3e408da49ff3282%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903657673321226%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=WehlZFsuwgmvdPUfyCHexruhTlcfQxd%2BvBDwuxu%2FFZE%3D&reserved=0>, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C9ff03396a5954105d3e408da49ff3282%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903657673321226%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=93%2Fl9Bg3BnXiFrVETO2tNYh1Lt1UYDltf%2B9qKHd4HOQ%3D&reserved=0>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C9ff03396a5954105d3e408da49ff3282%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903657673321226%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=0%2Bp97xy9g46eIiZbqbEd9pS9ix5Qji0LEnaqAVrHlgg%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/cb738791/attachment-0001.htm>

From andreas.oxenstierna at t-kartor.com  Thu Jun  9 03:49:34 2022
From: andreas.oxenstierna at t-kartor.com (Andreas Oxenstierna)
Date: Thu, 9 Jun 2022 10:49:34 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <AM0PR09MB3219D3EC7D1626ED8C4ED724FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB3219D3EC7D1626ED8C4ED724FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <a2f040f8-6272-4aae-9854-e048eb4be7a3@Spark>

Hi

Thanks again - that explains my confusion. So there is really three SQL dialect options with quite variable capabilities and issues.
Or four if the INDIRECT_SQLITE is an own dialect as mentioned in https://gdal.org/programs/ogrinfo.html -dialect

I assume that ?nativeSQL? is the default dialect for any RDBMS datasource and OGRSQL for all other datasources.
This is not clear in the doc what I can find/understand.

Maybe the example given last in https://gdal.org/programs/ogrinfo.html should be complemented with how an UPDATE in PG (or any RDBMS) is done using native SQL.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<http://www.t-kartor.com>
On 9 Jun 2022, 12:18 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>, wrote:
Hi,

You are getting closer but at the bottom of the page https://gdal.org/user/ogr_sql_dialect.html there is an important paragraph:

Non-OGR SQL
All OGR drivers for database systems: MySQL, PostgreSQL / PostGIS, Oracle Spatial, SQLite / Spatialite RDBMS, ODBC RDBMS, ESRI Personal GeoDatabase, SAP HANA and MSSQLSpatial - Microsoft SQL Server Spatial Database, override the GDALDataset::ExecuteSQL() function with dedicated implementation and, by default, pass the SQL statements directly to the underlying RDBMS. In these cases the SQL syntax varies in some particulars from OGR SQL. Also, anything possible in SQL can then be accomplished for these particular databases. Only the result of SQL WHERE statements will be returned as layers.

So if you do not select SQL dialect for PostGIS you do not use the OGR SQL dialect but the native PostgreSQL one. For using OGR SQL with PostgreSQL (maybe it could make sense in some special case but I am not sure) use ?-dialect OGRSQL?. If you are uncertain about what dialect is in use you can make a tests with some native-only functions like -sql "select postgis_version()" or -sql ?select sqlite_version?.

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>
L?hetetty: torstai 9. kes?kuuta 2022 12.48
Vastaanottaja: gdal-dev at lists.osgeo.org; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: ogrinfo UPDATE performance request

Hi

Thanks a lot and sorry for the noise.
UPDATE do work as expected using the OGR SQL, i.e. one atomic db transaction executing in the database = vastly faster than using -dialect sqlite
.
The doc at https://gdal.org/user/ogr_sql_dialect.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fuser%2Fogr_sql_dialect.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638713449%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=X63CofyOIyNwpeP%2Ba605L5ZCCn7Z8qP36rt5VwQc8eE%3D&reserved=0> needs some addition - I assume that INSERT, DELETE etc. also works
"While in theory any sort of command could be handled this way, in practice the mechanism is used to provide a subset of SQL SELECT capability to applications."

Maybe also clarify if the sqlite dialect is necessary to keep at all ...

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
On 9 Jun 2022, 11:15 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:

Hi,

This updated 166000 rows in 15 seconds for me on my laptop without any workarounds:
ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw" -sql "update buildingtest set version=99"

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>>
L?hetetty: torstai 9. kes?kuuta 2022 12.02
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: ogrinfo UPDATE performance request

Hi

AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have not tested the native PG SQL dialect extensively though, it took some time to find the correct syntax.
And to answer one other mail, the table name needs to be written as \?<schema>.<table>\?, at least on macOS

The performance issue is mainly that ogrinfo updates one feature at a time. Even if it should pack all data, copy it into a temp SQLite, do the update and transact back, it would be vastly faster if it is done in one transaction instead of one transaction for each feature as it is done now.

However, I realised that a workaround may be to add needed attribute info to any file format (GeoPackage or shape) - need to verify the performance though.
It should be nice to be able to execute this in a pure GDAL/OGR environment - the use case is to aggregate on different values, resolutions and interpolation methods for an AI platform so we may need to test thousands of variants.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:
Hi,

Do not use ?-dialect sqlite? if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=kt57EZEaekVUQ3o1yZSAHv0pMtSQMV50HIhGKSEdues%3D&reserved=0>, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/e87594cd/attachment-0001.htm>

From jan.heckman at gmail.com  Thu Jun  9 04:02:33 2022
From: jan.heckman at gmail.com (Jan Heckman)
Date: Thu, 9 Jun 2022 13:02:33 +0200
Subject: [gdal-dev] ogrinfo UPDATE performance request
In-Reply-To: <AM0PR09MB3219D3EC7D1626ED8C4ED724FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB3219D3EC7D1626ED8C4ED724FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CAKMUAtBO9=Mw2U0b9sWPz5NE8vQP=+uU1AFf+jRoMbQDjybnUA@mail.gmail.com>

Hi Jukka,

Thanks for all the dialect info.

Reading your last message about testing the dialect in use, I have to admit
that I did not think about native sql
(dialect) being deduced from the source type rather than from any dbms
involved.
That is clear to me now, of course.

Would it be correct, then, that, when using SQL when converting from
shapefile to postgresql/postgis,
dialect sqlite (or ogr_sql) cannot be avoided? I can live with that, of
course. Perhaps I'll start converting my
'special' geometry functions to dll's in postgresql so that I don't need to
convert and reconvert to/from shapefile.

Specifically I am working on what in arcgis is called union, which divides
overlapping polygons in constituent
parts without overlaps. This function does not seem present in postgis and
is problematic anyway when
the dataset is large enough.
(The Dutch spatial planning dataset 'Enkelbestemming' is such a dataset
with over 2.6 million entries with
overlaps both small and large, but to me, at least in terms of efficient
data access, the very essence of the idea
is that you have at most one valid geometry with attributes for each
(point)location.)

Best regards and thanks,
Jan

On Thu, Jun 9, 2022 at 12:19 PM Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> You are getting closer but at the bottom of the page
> https://gdal.org/user/ogr_sql_dialect.html there is an important
> paragraph:
>
> Non-OGR SQL
>
> All OGR drivers for database systems: MySQL, PostgreSQL / PostGIS, Oracle
> Spatial, SQLite / Spatialite RDBMS, ODBC RDBMS, ESRI Personal GeoDatabase,
> SAP HANA and MSSQLSpatial - Microsoft SQL Server Spatial Database, override
> the GDALDataset::ExecuteSQL() function with dedicated implementation and,
> by default, pass the SQL statements directly to the underlying RDBMS. In
> these cases the SQL syntax varies in some particulars from OGR SQL. Also,
> anything possible in SQL can then be accomplished for these particular
> databases. Only the result of SQL WHERE statements will be returned as
> layers.
>
>
>
> So if you do not select SQL dialect for PostGIS you do not use the OGR SQL
> dialect but the native PostgreSQL one. For using OGR SQL with PostgreSQL
> (maybe it could make sense in some special case but I am not sure) use
> ?-dialect OGRSQL?. If you are uncertain about what dialect is in use you
> can make a tests with some native-only functions like -sql "select
> postgis_version()" or -sql ?select sqlite_version?.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>
> *L?hetetty:* torstai 9. kes?kuuta 2022 12.48
> *Vastaanottaja:* gdal-dev at lists.osgeo.org; Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: ogrinfo UPDATE performance request
>
>
>
> Hi
>
> Thanks a lot and sorry for the noise.
> UPDATE do work as expected using the OGR SQL, i.e. one atomic db
> transaction executing in the database = vastly faster than using -dialect
> sqlite
> .
> The doc at https://gdal.org/user/ogr_sql_dialect.html
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fuser%2Fogr_sql_dialect.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638713449%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=X63CofyOIyNwpeP%2Ba605L5ZCCn7Z8qP36rt5VwQc8eE%3D&reserved=0> needs
> some addition - I assume that INSERT, DELETE etc. also works
> "While in theory any sort of command could be handled this way, in
> practice the mechanism is used to provide a subset of SQL SELECT capability
> to applications."
>
> Maybe also clarify if the sqlite dialect is necessary to keep at all ...
>
>
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com
> <https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
>
> On 9 Jun 2022, 11:15 +0200, Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi>, wrote:
>
> Hi,
>
>
>
> This updated 166000 rows in 15 seconds for me on my laptop without any
> workarounds:
>
> ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw"
> -sql "update buildingtest set version=99"
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>
> *L?hetetty:* torstai 9. kes?kuuta 2022 12.02
> *Vastaanottaja:* gdal-dev at lists.osgeo.org; Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: ogrinfo UPDATE performance request
>
>
>
> Hi
>
> AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have not
> tested the native PG SQL dialect extensively though, it took some time to
> find the correct syntax.
> And to answer one other mail, the table name needs to be written as
> \?<schema>.<table>\?, at least on macOS
>
> The performance issue is mainly that ogrinfo updates one feature at a
> time. Even if it should pack all data, copy it into a temp SQLite, do the
> update and transact back, it would be vastly faster if it is done in one
> transaction instead of one transaction for each feature as it is done now.
>
> However, I realised that a workaround may be to add needed attribute info
> to any file format (GeoPackage or shape) - need to verify the performance
> though.
> It should be nice to be able to execute this in a pure GDAL/OGR
> environment - the use case is to aggregate on different values, resolutions
> and interpolation methods for an AI platform so we may need to test
> thousands of variants.
>
>
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com
> <https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
>
> On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi>, wrote:
>
> Hi,
>
>
>
> Do not use ?-dialect sqlite? if you play with PostgreSQL but let GDAL to
> use the native PG SQL dialect.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta*
> Andreas Oxenstierna
> *L?hetetty:* torstai 9. kes?kuuta 2022 9.50
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] ogrinfo UPDATE performance request
>
>
>
> Dear developers
>
> Ogr SQL update capabilities are really impressing but there is one major
> performance issue with update of many features, exemplified by:
> ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:?<connection>"
>
> This is painfully slow because ogr updates features one by one and
> furthermore updates all existing attributes incl. geometries.
> Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1
> executes in milliseconds but takes several minutes with ogr.
>
> The current ogr functionality is also not correct from a database
> transactional point of view.
>
> I found an old RFC,
> https://gdal.org/development/rfc/rfc13_createfeatures.html
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=kt57EZEaekVUQ3o1yZSAHv0pMtSQMV50HIhGKSEdues%3D&reserved=0>,
> requesting this but it was withdrawn for reasons not anymore digitally
> available.
>
>
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com
> <https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C40cc50d74e814135428b08da49fd17a3%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637903648638869695%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PSddxQ5cOcxyh9rEAqWw791nqfWO%2B%2BKJbDSWGuSOOpY%3D&reserved=0>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/99c5fe93/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Jun  9 04:38:19 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 9 Jun 2022 11:38:19 +0000
Subject: [gdal-dev] ogrinfo UPDATE performance request
Message-ID: <AM0PR09MB32191FBB3C55BD0DE030D9D3FDA79@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Your dataset with overlapping polygons feels like a perfect candidate for trying these overlay tricks http://blog.cleverelephant.ca/2019/07/postgis-overlays.html. If you would like to try a desktop program OpenJUMP can do the job with two tools: Edit geometry-Convert-Planar graph and Analysis-Polygon overlay-(use the same layer as input A and input B).  I guess that OpenJUMP will fail with millions of polygons because it runs the processes totally in memory.

-Jukka Rahkonen-

L?hett?j?: Jan Heckman <jan.heckman at gmail.com>
L?hetetty: torstai 9. kes?kuuta 2022 14.03
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogrinfo UPDATE performance request

Hi Jukka,

Thanks for all the dialect info.

Reading your last message about testing the dialect in use, I have to admit that I did not think about native sql
(dialect) being deduced from the source type rather than from any dbms involved.
That is clear to me now, of course.

Would it be correct, then, that, when using SQL when converting from shapefile to postgresql/postgis,
dialect sqlite (or ogr_sql) cannot be avoided? I can live with that, of course. Perhaps I'll start converting my
'special' geometry functions to dll's in postgresql so that I don't need to convert and reconvert to/from shapefile.

Specifically I am working on what in arcgis is called union, which divides overlapping polygons in constituent
parts without overlaps. This function does not seem present in postgis and is problematic anyway when
the dataset is large enough.
(The Dutch spatial planning dataset 'Enkelbestemming' is such a dataset with over 2.6 million entries with
overlaps both small and large, but to me, at least in terms of efficient data access, the very essence of the idea
is that you have at most one valid geometry with attributes for each (point)location.)

Best regards and thanks,
Jan

On Thu, Jun 9, 2022 at 12:19 PM Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

You are getting closer but at the bottom of the page https://gdal.org/user/ogr_sql_dialect.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fuser%2Fogr_sql_dialect.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C3b414fa9917044b75a1908da4a0796d5%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903693706146529%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=%2B2EalTfEcFHbrq5glUiwTJGbpc1J9McnUnQsm2c4Drg%3D&reserved=0> there is an important paragraph:

Non-OGR SQL
All OGR drivers for database systems: MySQL, PostgreSQL / PostGIS, Oracle Spatial, SQLite / Spatialite RDBMS, ODBC RDBMS, ESRI Personal GeoDatabase, SAP HANA and MSSQLSpatial - Microsoft SQL Server Spatial Database, override the GDALDataset::ExecuteSQL() function with dedicated implementation and, by default, pass the SQL statements directly to the underlying RDBMS. In these cases the SQL syntax varies in some particulars from OGR SQL. Also, anything possible in SQL can then be accomplished for these particular databases. Only the result of SQL WHERE statements will be returned as layers.

So if you do not select SQL dialect for PostGIS you do not use the OGR SQL dialect but the native PostgreSQL one. For using OGR SQL with PostgreSQL (maybe it could make sense in some special case but I am not sure) use "-dialect OGRSQL". If you are uncertain about what dialect is in use you can make a tests with some native-only functions like -sql "select postgis_version()" or -sql "select sqlite_version".

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>>
L?hetetty: torstai 9. kes?kuuta 2022 12.48
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: ogrinfo UPDATE performance request

Hi

Thanks a lot and sorry for the noise.
UPDATE do work as expected using the OGR SQL, i.e. one atomic db transaction executing in the database = vastly faster than using -dialect sqlite
.
The doc at https://gdal.org/user/ogr_sql_dialect.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fuser%2Fogr_sql_dialect.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C3b414fa9917044b75a1908da4a0796d5%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903693706146529%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=%2B2EalTfEcFHbrq5glUiwTJGbpc1J9McnUnQsm2c4Drg%3D&reserved=0> needs some addition - I assume that INSERT, DELETE etc. also works
"While in theory any sort of command could be handled this way, in practice the mechanism is used to provide a subset of SQL SELECT capability to applications."

Maybe also clarify if the sqlite dialect is necessary to keep at all ...

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C3b414fa9917044b75a1908da4a0796d5%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903693706146529%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=%2B6M%2BWbi4rrv%2Fs0RnWSE2lrUyUehrS7lZxWoinkRdnUQ%3D&reserved=0>
On 9 Jun 2022, 11:15 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:
Hi,

This updated 166000 rows in 15 seconds for me on my laptop without any workarounds:
ogrinfo PG:"host=localhost port=5432 dbname=my_pg user=user password=pw" -sql "update buildingtest set version=99"

-Jukka Rahkonen-

L?hett?j?: Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>>
L?hetetty: torstai 9. kes?kuuta 2022 12.02
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: ogrinfo UPDATE performance request

Hi

AFAIK, UPDATE only works with ogrinfo and the sqlite dialect. We have not tested the native PG SQL dialect extensively though, it took some time to find the correct syntax.
And to answer one other mail, the table name needs to be written as \"<schema>.<table>\", at least on macOS

The performance issue is mainly that ogrinfo updates one feature at a time. Even if it should pack all data, copy it into a temp SQLite, do the update and transact back, it would be vastly faster if it is done in one transaction instead of one transaction for each feature as it is done now.

However, I realised that a workaround may be to add needed attribute info to any file format (GeoPackage or shape) - need to verify the performance though.
It should be nice to be able to execute this in a pure GDAL/OGR environment - the use case is to aggregate on different values, resolutions and interpolation methods for an AI platform so we may need to test thousands of variants.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C3b414fa9917044b75a1908da4a0796d5%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903693706146529%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=%2B6M%2BWbi4rrv%2Fs0RnWSE2lrUyUehrS7lZxWoinkRdnUQ%3D&reserved=0>
On 9 Jun 2022, 09:46 +0200, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>, wrote:
Hi,

Do not use "-dialect sqlite" if you play with PostgreSQL but let GDAL to use the native PG SQL dialect.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Andreas Oxenstierna
L?hetetty: torstai 9. kes?kuuta 2022 9.50
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] ogrinfo UPDATE performance request

Dear developers

Ogr SQL update capabilities are really impressing but there is one major performance issue with update of many features, exemplified by:
ogrinfo -dialect sqlite -sql "UPDATE <table> SET x = 1" PG:"<connection>"

This is painfully slow because ogr updates features one by one and furthermore updates all existing attributes incl. geometries.
Eg. updating 10000 features in pgAdmin/psql with UPDATE <table> SET x = 1 executes in milliseconds but takes several minutes with ogr.

The current ogr functionality is also not correct from a database transactional point of view.

I found an old RFC, https://gdal.org/development/rfc/rfc13_createfeatures.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdevelopment%2Frfc%2Frfc13_createfeatures.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C3b414fa9917044b75a1908da4a0796d5%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903693706302767%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=eljZ4rvGttntCTxuA17o4%2FLrk9TMGnuHQAbq7sme%2Bcg%3D&reserved=0>, requesting this but it was withdrawn for reasons not anymore digitally available.

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.t-kartor.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C3b414fa9917044b75a1908da4a0796d5%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903693706302767%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=VaFIiVeyaRcDyOZ41DlzMXTbI6hiPfMGIA1KVE7yTo0%3D&reserved=0>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C3b414fa9917044b75a1908da4a0796d5%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637903693706302767%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=BRLbGKSf3lrhbO01fV%2B6isaEvDijYQzwA9iuKYgSBZw%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220609/9cd0b045/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Jun 10 02:24:05 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 10 Jun 2022 11:24:05 +0200
Subject: [gdal-dev] Motion: adopt RFC 86 Column-oriented read API for vector
 layers
Message-ID: <ef3c19b6-dbe4-2085-1218-2ec729587e28@spatialys.com>

Hi,

As the discussion seems to have calmed down, I move to adopt RFC 86: 
Column-oriented read API for vector layers : 
https://github.com/OSGeo/gdal/pull/5830

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From mateusz at loskot.net  Fri Jun 10 03:23:50 2022
From: mateusz at loskot.net (Mateusz Loskot)
Date: Fri, 10 Jun 2022 12:23:50 +0200
Subject: [gdal-dev] Motion: adopt RFC 86 Column-oriented read API for
 vector layers
In-Reply-To: <ef3c19b6-dbe4-2085-1218-2ec729587e28@spatialys.com>
References: <ef3c19b6-dbe4-2085-1218-2ec729587e28@spatialys.com>
Message-ID: <CABUeae_N01nP8MUP2vU_gBVb7EY4qW1Sh-Si_qDgu=3m4ddwUQ@mail.gmail.com>

+1 Mateusz

On Fri, 10 Jun 2022 at 11:24, Even Rouault <even.rouault at spatialys.com> wrote:
>
> Hi,
>
> As the discussion seems to have calmed down, I move to adopt RFC 86:
> Column-oriented read API for vector layers :
> https://github.com/OSGeo/gdal/pull/5830
>
> Starting with my +1
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Mateusz Loskot, http://mateusz.loskot.net

From jukka.rahkonen at maanmittauslaitos.fi  Fri Jun 10 03:31:41 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 10 Jun 2022 10:31:41 +0000
Subject: [gdal-dev] Motion: adopt RFC 86 Column-oriented read API for
 vector layers
Message-ID: <AM0PR09MB32190F2BA065411C75158D6DFDA69@AM0PR09MB3219.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
L?hetetty: perjantai 10. kes?kuuta 2022 12.24
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: adopt RFC 86 Column-oriented read API for vector layers

Hi,

As the discussion seems to have calmed down, I move to adopt RFC 86: 
Column-oriented read API for vector layers : 
https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fpull%2F5830&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cc9207b26b31b446853bc08da4ac305a2%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637904499157874720%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=AOM7C9oJ9f1cATEl8PVOYHCgWAsnBNc6Z9ayeqWbLeU%3D&amp;reserved=0

Starting with my +1

Even

-- 
https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cc9207b26b31b446853bc08da4ac305a2%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637904499157874720%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=zwxm2ft67KLWpALnaRhOos56HYWEuBQD%2B7LBjh1nw%2BI%3D&amp;reserved=0
My software is free, but my time generally not.

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cc9207b26b31b446853bc08da4ac305a2%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637904499157874720%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=FkVuL6Bd%2BK%2BbcW0lRu4gfaaiXkbI7JTTe9%2FtOn4Vi44%3D&amp;reserved=0

From jesse.r.meyer at nasa.gov  Fri Jun 10 08:08:04 2022
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Fri, 10 Jun 2022 15:08:04 +0000
Subject: [gdal-dev] Iterating through an OGR polygon as a set of triangles
 via the C API
Message-ID: <DM6PR09MB592751DFDEDB386B44D4F9D8C9A69@DM6PR09MB5927.namprd09.prod.outlook.com>

Hi,

My goal is to build an indexed list of triangles from OGR polygons as inputs to a hardware rasterizer for efficient rendering.  I see RFC 64 was implemented a few years ago but the documentation warns "not yet implemented".  These is reinforced by my failed attempt to use OGR_G_ForceTo on a polygon geometry to the TIN type.  OGR's object hierarchy can be easy to misunderstand so maybe I'm just missing something here.

Is this functionality available? If not, are viewers like QGIS manually building an index list themselves (or perhaps they use old fixed function APIs)?

Thanks,
Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220610/411cb445/attachment.htm>

From even.rouault at spatialys.com  Fri Jun 10 08:29:27 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 10 Jun 2022 17:29:27 +0200
Subject: [gdal-dev] Iterating through an OGR polygon as a set of
 triangles via the C API
In-Reply-To: <DM6PR09MB592751DFDEDB386B44D4F9D8C9A69@DM6PR09MB5927.namprd09.prod.outlook.com>
References: <DM6PR09MB592751DFDEDB386B44D4F9D8C9A69@DM6PR09MB5927.namprd09.prod.outlook.com>
Message-ID: <2f86e79e-70b8-f51c-8caa-f2d0d372436e@spatialys.com>


Le 10/06/2022 ? 17:08, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND 
APPLICATIONS INC] via gdal-dev a ?crit?:
> Hi,
>
> My goal is to build an indexed list of triangles from OGR polygons as 
> inputs to a hardware rasterizer for efficient rendering.? I see RFC 64 
> was implemented a few years ago but the documentation warns "not yet 
> implemented".

-->where exactly do you see this mentioned?


Anyway, tesselation as triangles wasn't in the scope of the RFC


But you might want to use OGR_G_DelaunayTriangulation()


> These is reinforced by my failed attempt to use OGR_G_ForceTo on a 
> polygon geometry to the TIN type.? OGR's object hierarchy can be easy 
> to misunderstand so maybe I'm just missing something here.
>
> Is this functionality available? If not, are viewers like QGIS 
> manually building an index list themselves (or perhaps they use old 
> fixed function APIs)?
>
> Thanks,
> Jesse
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220610/58e55f82/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Jun 10 09:23:53 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 10 Jun 2022 18:23:53 +0200
Subject: [gdal-dev] Pull request adding creation/update capabilities to the
 OpenFileGDB driver
Message-ID: <617b3029-f2fe-ca26-5fa5-0606d6c8e9ab@spatialys.com>

Hi,

I just wanted to quickly mention https://github.com/OSGeo/gdal/pull/5910 
which adds creation/update capabilities for the FileGeodatabase format 
in the OpenFileGDB driver (that is the built-in driver, not needing a 
binary SDK)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From howard at hobu.co  Fri Jun 10 10:07:35 2022
From: howard at hobu.co (Howard Butler)
Date: Fri, 10 Jun 2022 12:07:35 -0500
Subject: [gdal-dev] Motion: adopt RFC 86 Column-oriented read API for
 vector layers
In-Reply-To: <AM0PR09MB32190F2BA065411C75158D6DFDA69@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB32190F2BA065411C75158D6DFDA69@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <8B99D00C-3F69-4130-968B-FADC3493396A@hobu.co>

+1

Howard

> On Jun 10, 2022, at 5:31 AM, Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> wrote:
> 
> +1
> 
> -Jukka Rahkonen-
> 
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault
> L?hetetty: perjantai 10. kes?kuuta 2022 12.24
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] Motion: adopt RFC 86 Column-oriented read API for vector layers
> 
> Hi,
> 
> As the discussion seems to have calmed down, I move to adopt RFC 86: 
> Column-oriented read API for vector layers : 
> https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FOSGeo%2Fgdal%2Fpull%2F5830&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cc9207b26b31b446853bc08da4ac305a2%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637904499157874720%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=AOM7C9oJ9f1cATEl8PVOYHCgWAsnBNc6Z9ayeqWbLeU%3D&amp;reserved=0
> 
> Starting with my +1
> 
> Even
> 
> -- 
> https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cc9207b26b31b446853bc08da4ac305a2%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637904499157874720%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=zwxm2ft67KLWpALnaRhOos56HYWEuBQD%2B7LBjh1nw%2BI%3D&amp;reserved=0
> My software is free, but my time generally not.
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&amp;data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cc9207b26b31b446853bc08da4ac305a2%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637904499157874720%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=FkVuL6Bd%2BK%2BbcW0lRu4gfaaiXkbI7JTTe9%2FtOn4Vi44%3D&amp;reserved=0
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From fagonzalezv at indracompany.com  Fri Jun 10 19:11:09 2022
From: fagonzalezv at indracompany.com (Gonzalez Velasquez, Frando Alexis)
Date: Sat, 11 Jun 2022 02:11:09 +0000
Subject: [gdal-dev] Ogr2ogr conversion to geojson problem..... any
 suggestion?
Message-ID: <GV1P193MB2071BDA7B9DCF0A74C39847ADDA99@GV1P193MB2071.EURP193.PROD.OUTLOOK.COM>

Hi dev team!

I am writing to inquire about conversion to geojson problem, I will show you in a little and simple example that shows my big problem:

We are using the ogr2ogr executables commands like this :

ogr2ogr -f GeoJSON C:\tmp\nombres.json C:\tmp\TUNJA1R_ejemplo.xtf testModel.table

As you can see, The input file is "TUNJA1R_ejemplo.xtf" a simple array of names in xml example, but with the same name of key :

"<?xml version="1.0" encoding="UTF-8"?><TRANSFER xmlns=http://www.interlis.ch/INTERLIS2.3>
<HEADERSECTION SENDER="ili2ora-4.4.3-658b7daf37ba45ed2330ca3e3a3c3d59c96e91fa" VERSION="2.3"><MODELS>
<MODEL NAME="testModel" VERSION="2022-06-10" URI=mailto:PC4 at localhost></MODEL></MODELS></HEADERSECTION>
<DATASECTION>
<testModel BID="testModel">
                <testModel.table TID="234921">
                                <name>pepe</name>
                                < name >maria</ name >
                                < name >juana</ name >
                                <nestedfield>
                                < name >julia</ name > //also try a nested field, wioth results....
                                </nestedfield>
                                < name >mario</ name >
                                < name >luz</ name >
                                < name >angela</ name >
                </testModel.table>
</Submodelo_Insumos_SNR_V1_0.Datos_SNR>
</DATASECTION>
</TRANSFER>"

After execution, the output file  " nombres.json "of conversion always leaves only the last key value :

{
"type": "FeatureCollection",
"name": "testModel.table",
"features": [
{ "type": "Feature", "properties": { "TID": "234921", " name ": "angela" }, "geometry": null }
]
}


Is there any strategy to handle this problem like an extra command or option (-option) on the command line to get in the output file with all the names even the input file has the same key name ? because, i saw that ogr2ogr always update the same key with the last value, and we need all the seven names array in the output json file on the same registry.

Finally, I have come to think that I should modify the ogr2ogr code to better handle this and not always leave the last value in the conversion, but I hope it is the last option that I should take.


Any advice would be really appreciated, thanks!!!


[minsait-indra]

FRANDO GONZ?LEZ
Senior Systems Engineer
fagonzalezv at indracompany.com<mailto:fagonzalezv at indracompany.com>

Calle 93 16 25
Bogot?, Colombia
T +57 1 646 36 00
M +57 3006604908

minsait.com<https://eur04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.minsait.com%2F&data=04%7C01%7Cfagonzalezv%40indracompany.com%7C6c419c97a7134841c0da08d9f7ce4282%7C7808e00514894374954bd3b08f193920%7C0%7C0%7C637813287514711623%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=0Jr%2BkI3f3Uh3g%2FG5C5yElQX9pHauhEi9ds6w%2FPOxLtM%3D&reserved=0>
indracompany.com<https://eur04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.indracompany.com%2F&data=04%7C01%7Cfagonzalezv%40indracompany.com%7C6c419c97a7134841c0da08d9f7ce4282%7C7808e00514894374954bd3b08f193920%7C0%7C0%7C637813287514711623%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=W2xsw4RMlZ8TUymKMTE5zqosvKN2LV5QhwvGmAxgZM0%3D&reserved=0>



________________________________

Este correo electr?nico y, en su caso, cualquier fichero anexo al mismo, contiene informaci?n de car?cter confidencial exclusivamente dirigida a su destinatario o destinatarios. Si no es vd. el destinatario indicado, queda notificado que la lectura, utilizaci?n, divulgaci?n y/o copia sin autorizaci?n est? prohibida en virtud de la legislaci?n vigente. En el caso de haber recibido este correo electr?nico por error, se ruega notificar inmediatamente esta circunstancia mediante reenv?o a la direcci?n electr?nica del remitente.
Evite imprimir este mensaje si no es estrictamente necesario.

This email and any file attached to it (when applicable) contain(s) confidential information that is exclusively addressed to its recipient(s). If you are not the indicated recipient, you are informed that reading, using, disseminating and/or copying it without authorisation is forbidden in accordance with the legislation in effect. If you have received this email by mistake, please immediately notify the sender of the situation by resending it to their email address.
Avoid printing this message if it is not absolutely necessary.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220611/6a53170a/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 1476 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220611/6a53170a/attachment-0001.png>

From even.rouault at spatialys.com  Sat Jun 11 03:20:39 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 11 Jun 2022 12:20:39 +0200
Subject: [gdal-dev] Ogr2ogr conversion to geojson problem..... any
 suggestion?
In-Reply-To: <GV1P193MB2071BDA7B9DCF0A74C39847ADDA99@GV1P193MB2071.EURP193.PROD.OUTLOOK.COM>
References: <GV1P193MB2071BDA7B9DCF0A74C39847ADDA99@GV1P193MB2071.EURP193.PROD.OUTLOOK.COM>
Message-ID: <abd990fb-6afd-4a41-fb8c-8c538016b7c2@spatialys.com>

Frando Alexis,

when using ogr2ogr, there are 3 components involved:

- the driver that reads the input file

- the driver that writes the output file

- the ogr2ogr specific logic

So when analyzing an issue, it is important to try to localize where it is.

Here the issue comes from the input driver, as you can easily see when 
running "ogrinfo your.xtf" (I had to slightly edit the one you pasted 
since it was invalid XML)

$ ogrinfo test.xtf -al
INFO: Open of `test.xtf'
 ????? using driver `Interlis 2' successful.

Layer name: testModel.table
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
(unknown)
TID: String (0.0)
name: String (0.0)
OGRFeature(testModel.table):1
 ? TID (String) = 234921
 ? name (String) = angela

So the issue lies in the Interlis 2 driver. I've not dug further to know 
if the Interlis 2 format is supposed to deal with repeated XML element 
names.

Even


Le 11/06/2022 ? 04:11, Gonzalez Velasquez, Frando Alexis a ?crit?:
>
> Hi dev team!
>
> I am writing to inquire about conversion to geojson problem, I will 
> show you in a little and simple example that shows my big problem:
>
> We are using the ogr2ogr executables commands like this :
>
> */ogr2ogr -f GeoJSON C:\tmp\nombres.json C:\tmp\TUNJA1R_ejemplo.xtf 
> testModel.table/*
>
> As you can see, The input file is ?TUNJA1R_ejemplo.xtf? a simple array 
> of names in xml example, but with the same name of key :
>
> ?<?xml version="1.0" encoding="UTF-8"?><TRANSFER 
> xmlns=http://www.interlis.ch/INTERLIS2.3>
>
> <HEADERSECTION 
> SENDER="ili2ora-4.4.3-658b7daf37ba45ed2330ca3e3a3c3d59c96e91fa" 
> VERSION="2.3"><MODELS>
>
> <MODEL NAME="testModel" VERSION="2022-06-10" URI=mailto:PC4 at localhost 
> <mailto:PC4 at localhost>></MODEL></MODELS></HEADERSECTION>
>
> <DATASECTION>
>
> <testModel BID="testModel">
>
> <testModel.table TID="234921">
>
> <name>pepe</name>
>
> < name >maria</ name >
>
> < name >juana</name >
>
> <nestedfield>
>
> < name >julia</ name > //also try a nested field, wioth results?.
>
> </nestedfield>
>
> < name >mario</ name >
>
> < name >luz</ name >
>
> < name >*angela*</ name >
>
> ??????????????? </testModel.table>
>
> </Submodelo_Insumos_SNR_V1_0.Datos_SNR>
>
> </DATASECTION>
>
> </TRANSFER>?
>
> After execution, the output file ?? nombres.json ?of conversion always 
> leaves only the last key value :
>
> {
>
> "type": "FeatureCollection",
>
> "name": "testModel.table",
>
> "features": [
>
> { "type": "Feature", "properties": { "TID": "234921", " name ": 
> "*angela*" }, "geometry": null }
>
> ]
>
> }
>
> *Is there any strategy to handle this problem like an extra command or 
> option (-option) on the command line to get in the output file with 
> all the names even the input file has the same key name ?*because, i 
> saw that ogr2ogr always update the same key with the last value, and 
> we need */all the seven names/* array in the output json file on the 
> same registry.
>
> Finally, I have come to think that I should modify the ogr2ogr code to 
> better handle this and not always leave the last value in the 
> conversion, but I hope it is the last option that I should take.
>
> Any advice would be really appreciated, thanks!!!
>
> minsait-indra
>
> FRANDO GONZ?LEZ
>
> Senior Systems Engineer
>
> fagonzalezv at indracompany.com <mailto:fagonzalezv at indracompany.com>
>
> Calle 93 16 25
>
> Bogot?, Colombia
>
> T +57 1 646 36 00
>
> M +57 3006604908
>
> minsait.com 
> <https://eur04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.minsait.com%2F&data=04%7C01%7Cfagonzalezv%40indracompany.com%7C6c419c97a7134841c0da08d9f7ce4282%7C7808e00514894374954bd3b08f193920%7C0%7C0%7C637813287514711623%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=0Jr%2BkI3f3Uh3g%2FG5C5yElQX9pHauhEi9ds6w%2FPOxLtM%3D&reserved=0>
>
> indracompany.com 
> <https://eur04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.indracompany.com%2F&data=04%7C01%7Cfagonzalezv%40indracompany.com%7C6c419c97a7134841c0da08d9f7ce4282%7C7808e00514894374954bd3b08f193920%7C0%7C0%7C637813287514711623%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=W2xsw4RMlZ8TUymKMTE5zqosvKN2LV5QhwvGmAxgZM0%3D&reserved=0>
>
>
> ------------------------------------------------------------------------
>
> Este correo electr?nico y, en su caso, cualquier fichero anexo al 
> mismo, contiene informaci?n de car?cter confidencial exclusivamente 
> dirigida a su destinatario o destinatarios. Si no es vd. el 
> destinatario indicado, queda notificado que la lectura, utilizaci?n, 
> divulgaci?n y/o copia sin autorizaci?n est? prohibida en virtud de la 
> legislaci?n vigente. En el caso de haber recibido este correo 
> electr?nico por error, se ruega notificar inmediatamente esta 
> circunstancia mediante reenv?o a la direcci?n electr?nica del remitente.
> Evite imprimir este mensaje si no es estrictamente necesario.
>
> This email and any file attached to it (when applicable) contain(s) 
> confidential information that is exclusively addressed to its 
> recipient(s). If you are not the indicated recipient, you are informed 
> that reading, using, disseminating and/or copying it without 
> authorisation is forbidden in accordance with the legislation in 
> effect. If you have received this email by mistake, please immediately 
> notify the sender of the situation by resending it to their email address.
> Avoid printing this message if it is not absolutely necessary.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220611/37daeeb0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 1476 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220611/37daeeb0/attachment.png>

From pekka at gispo.fi  Mon Jun 13 22:34:04 2022
From: pekka at gispo.fi (Pekka Sarkola)
Date: Tue, 14 Jun 2022 08:34:04 +0300
Subject: [gdal-dev] Possibility to use config options in VRT-files
Message-ID: <CANgLEnCvUiA0m8UCX7jNfw0-rrg_J-6NHGtdXHmwt+ag8zw2jw@mail.gmail.com>

Hi!

Could it be possible to add GDAL configuration options to VRT-files?

I have worked with several WFS-services, where I have to set
OGR_WFS_PAGING_ALLOWED=OFF -option to get data.It is not problem to add
system variable or --config when running ogrinfo/ogr2ogr from command line.
But I like to use the same .vrt-files also in QGIS and it will be more
convenient to add necessary config-options to vrt-files.

Rgs,

Pekka
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/4debd4a5/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 13 22:58:20 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 14 Jun 2022 05:58:20 +0000
Subject: [gdal-dev] Possibility to use config options in VRT-files
Message-ID: <AM0PR09MB3219398AB2CE622D9B2B0638FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Do you need to use just the OGR virtual format https://gdal.org/drivers/vector/vrt.html? The simple WFS service description file https://gdal.org/drivers/vector/wfs.html seems to support an additional PagingAllowed element as immediate children of the OGRWFSDataSource for that purpose.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Pekka Sarkola
L?hetetty: tiistai 14. kes?kuuta 2022 8.34
Vastaanottaja: 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Possibility to use config options in VRT-files

Hi!

Could it be possible to add GDAL configuration options to VRT-files?

I have worked with several WFS-services, where I have to set OGR_WFS_PAGING_ALLOWED=OFF -option to get data.It is not problem to add system variable or --config when running ogrinfo/ogr2ogr from command line. But I like to use the same .vrt-files also in QGIS and it will be more convenient to add necessary config-options to vrt-files.

Rgs,

Pekka



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/ba921eb9/attachment.htm>

From even.rouault at spatialys.com  Tue Jun 14 02:39:22 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Jun 2022 11:39:22 +0200
Subject: [gdal-dev] Motion: adopt RFC 86 Column-oriented read API for
 vector layers
In-Reply-To: <ef3c19b6-dbe4-2085-1218-2ec729587e28@spatialys.com>
References: <ef3c19b6-dbe4-2085-1218-2ec729587e28@spatialys.com>
Message-ID: <0b53e8c4-3187-6cad-bd65-a39ab797fc41@spatialys.com>

Hi,

I declare this motion passed with +1 from PSC members MateuszL, JukkaR, 
HowardB and me.

Even

Le 10/06/2022 ? 11:24, Even Rouault a ?crit?:
> Hi,
>
> As the discussion seems to have calmed down, I move to adopt RFC 86: 
> Column-oriented read API for vector layers : 
> https://github.com/OSGeo/gdal/pull/5830
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From pekka at gispo.fi  Tue Jun 14 05:49:15 2022
From: pekka at gispo.fi (Pekka Sarkola)
Date: Tue, 14 Jun 2022 15:49:15 +0300
Subject: [gdal-dev] Possibility to use config options in VRT-files
In-Reply-To: <AM0PR09MB3219398AB2CE622D9B2B0638FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB3219398AB2CE622D9B2B0638FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CANgLEnAQnE6KwHhKz3fDLc11PQeLiNSN3HeNW_D+EthqkcY3DQ@mail.gmail.com>

Hi!

I had some other problems with the WFS service description file, need to
check that.

However, in another case I'd like to use GML_ATTRIBUTES_TO_OGR_FIELDS
-config for WFS service.

Rgs,

Pekka

ti 14. kes?k. 2022 klo 8.58 Rahkonen Jukka (
jukka.rahkonen at maanmittauslaitos.fi) kirjoitti:

> Hi,
>
>
>
> Do you need to use just the OGR virtual format
> https://gdal.org/drivers/vector/vrt.html? The simple WFS service
> description file https://gdal.org/drivers/vector/wfs.html seems to
> support an additional PagingAllowed element as immediate children of the
> OGRWFSDataSource for that purpose.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Pekka
> Sarkola
> *L?hetetty:* tiistai 14. kes?kuuta 2022 8.34
> *Vastaanottaja:* 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <
> gdal-dev at lists.osgeo.org>
> *Aihe:* [gdal-dev] Possibility to use config options in VRT-files
>
>
>
> Hi!
>
>
>
> Could it be possible to add GDAL configuration options to VRT-files?
>
>
>
> I have worked with several WFS-services, where I have to set
> OGR_WFS_PAGING_ALLOWED=OFF -option to get data.It is not problem to add
> system variable or --config when running ogrinfo/ogr2ogr from command line.
> But I like to use the same .vrt-files also in QGIS and it will be more
> convenient to add necessary config-options to vrt-files.
>
>
>
> Rgs,
>
>
>
> Pekka
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/99e37fc5/attachment-0001.htm>

From even.rouault at spatialys.com  Tue Jun 14 05:52:22 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Jun 2022 14:52:22 +0200
Subject: [gdal-dev] Possibility to use config options in VRT-files
In-Reply-To: <CANgLEnAQnE6KwHhKz3fDLc11PQeLiNSN3HeNW_D+EthqkcY3DQ@mail.gmail.com>
References: <AM0PR09MB3219398AB2CE622D9B2B0638FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CANgLEnAQnE6KwHhKz3fDLc11PQeLiNSN3HeNW_D+EthqkcY3DQ@mail.gmail.com>
Message-ID: <7460c1d0-eb9c-23f8-b6e6-80c26e72e249@spatialys.com>

Hi,

It is not possible to set configuration options in VRT files. There 
could potentially be security issues in doing so and reading untrusted VRT.

Even

Le 14/06/2022 ? 14:49, Pekka Sarkola a ?crit?:
> Hi!
>
> I had some other problems with the WFS service description file, need 
> to check that.
>
> However, in another case I'd like to use?GML_ATTRIBUTES_TO_OGR_FIELDS 
> -config for WFS service.
>
> Rgs,
>
> Pekka
>
>
> ti 14. kes?k. 2022 klo 8.58 Rahkonen Jukka 
> (jukka.rahkonen at maanmittauslaitos.fi) kirjoitti:
>
>     Hi,
>
>     Do you need to use just the OGR virtual format
>     https://gdal.org/drivers/vector/vrt.html? The simple WFS service
>     description file https://gdal.org/drivers/vector/wfs.html seems to
>     support an additional PagingAllowed element as immediate children
>     of the OGRWFSDataSource for that purpose.
>
>     -Jukka Rahkonen-
>
>     *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta
>     *Pekka Sarkola
>     *L?hetetty:* tiistai 14. kes?kuuta 2022 8.34
>     *Vastaanottaja:* 'gdal-dev at lists.osgeo.org'
>     (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
>     *Aihe:* [gdal-dev] Possibility to use config options in VRT-files
>
>     Hi!
>
>     Could it be possible to add GDAL configuration options to VRT-files?
>
>     I have worked with several WFS-services, where I have to set
>     OGR_WFS_PAGING_ALLOWED=OFF -option to get data.It is not problem
>     to add system variable or --config when running ogrinfo/ogr2ogr
>     from command line. But I like to use the same .vrt-files also in
>     QGIS and it will be more convenient?to add necessary
>     config-options to vrt-files.
>
>     Rgs,
>
>     Pekka
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/d835b584/attachment.htm>

From pekka at gispo.fi  Tue Jun 14 06:19:34 2022
From: pekka at gispo.fi (Pekka Sarkola)
Date: Tue, 14 Jun 2022 16:19:34 +0300
Subject: [gdal-dev] Possibility to use config options in VRT-files
In-Reply-To: <7460c1d0-eb9c-23f8-b6e6-80c26e72e249@spatialys.com>
References: <AM0PR09MB3219398AB2CE622D9B2B0638FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CANgLEnAQnE6KwHhKz3fDLc11PQeLiNSN3HeNW_D+EthqkcY3DQ@mail.gmail.com>
 <7460c1d0-eb9c-23f8-b6e6-80c26e72e249@spatialys.com>
Message-ID: <CANgLEnCgqfWC6QpMDyxrRCujGG3Vgkz2x3qJCHOk2MVnk+Q-9A@mail.gmail.com>

Hi,

Ok, I understand and agree with this security issue.

However, I still have problems with the WFS service file.

This works perfectly:

    ogrinfo WFS:
https://geodata.tampere.fi/geoserver/wfs?typename=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW
-al -so --config OGR_WFS_PAGING_ALLOWED OFF

Without  OGR_WFS_PAGING_ALLOWED, I got some HTTP 400 errors.

I create WFS Service file (tre_wfs.xml):

<OGRWFSDataSource>
  <URL>
https://geodata.tampere.fi/geoserver/wfs?typename=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW
</URL>
  <PagingAllowed>OFF</PagingAllowed>
</OGRWFSDataSource>


When I run this service file with ogrinfo:

ogrinfo -ro tre_wfs.xml -al -so


I also got those HTTP 400 errors. However, if I add config parameter:

ogrinfo -ro tre_wfs.xml -al -so --config OGR_WFS_PAGING_ALLOWED OFF


It works, I'm confused.

Rgs,

Pekka




ti 14. kes?k. 2022 klo 15.52 Even Rouault (even.rouault at spatialys.com)
kirjoitti:

> Hi,
>
> It is not possible to set configuration options in VRT files. There could
> potentially be security issues in doing so and reading untrusted VRT.
>
> Even
> Le 14/06/2022 ? 14:49, Pekka Sarkola a ?crit :
>
> Hi!
>
> I had some other problems with the WFS service description file, need to
> check that.
>
> However, in another case I'd like to use GML_ATTRIBUTES_TO_OGR_FIELDS
> -config for WFS service.
>
> Rgs,
>
> Pekka
>
> ti 14. kes?k. 2022 klo 8.58 Rahkonen Jukka (
> jukka.rahkonen at maanmittauslaitos.fi) kirjoitti:
>
>> Hi,
>>
>>
>>
>> Do you need to use just the OGR virtual format
>> https://gdal.org/drivers/vector/vrt.html? The simple WFS service
>> description file https://gdal.org/drivers/vector/wfs.html seems to
>> support an additional PagingAllowed element as immediate children of the
>> OGRWFSDataSource for that purpose.
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Pekka
>> Sarkola
>> *L?hetetty:* tiistai 14. kes?kuuta 2022 8.34
>> *Vastaanottaja:* 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <
>> gdal-dev at lists.osgeo.org>
>> *Aihe:* [gdal-dev] Possibility to use config options in VRT-files
>>
>>
>>
>> Hi!
>>
>>
>>
>> Could it be possible to add GDAL configuration options to VRT-files?
>>
>>
>>
>> I have worked with several WFS-services, where I have to set
>> OGR_WFS_PAGING_ALLOWED=OFF -option to get data.It is not problem to add
>> system variable or --config when running ogrinfo/ogr2ogr from command line.
>> But I like to use the same .vrt-files also in QGIS and it will be more
>> convenient to add necessary config-options to vrt-files.
>>
>>
>>
>> Rgs,
>>
>>
>>
>> Pekka
>>
>>
>>
>>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/b966c393/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Jun 14 06:48:07 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 14 Jun 2022 13:48:07 +0000
Subject: [gdal-dev] Possibility to use config options in VRT-files
Message-ID: <AM0PR09MB32198AED727E09484B53A369FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

I can confirm that despite having <PagingAllowed>OFF</PagingAllowed> in the wfs.xml file ogrinfo generates GetFeatures with COUNT and STARTINDEX as in this sample from the debug log:

HTTP: Fetch(https://geodata.tampere.fi/geoserver/wfs?typename=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW&SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&TYPENAMES=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW&STARTINDEX=0&COUNT=1000000)
ERROR 1: HTTP error code : 400

When it comes to the QGIS case I wonder if it could be possible to use Python and pyqgis for setting temporary environmental variables and opening the wfs.xml file. If it works then it would be possible to set also GML_ATTRIBUTES_TO_OGR_FIELDS.

-Jukka Rahkonen-

L?hett?j?: Pekka Sarkola <pekka at gispo.fi>
L?hetetty: tiistai 14. kes?kuuta 2022 16.20
Vastaanottaja: Even Rouault <even.rouault at spatialys.com>
Kopio: Pekka Sarkola <pekka.sarkola at gispo.fi>; Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>; 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] Possibility to use config options in VRT-files

Hi,

Ok, I understand and agree with this security issue.

However, I still have problems with the WFS service file.

This works perfectly:

    ogrinfo WFS:https://geodata.tampere.fi/geoserver/wfs?typename=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgeodata.tampere.fi%2Fgeoserver%2Fwfs%3Ftypename%3Dmaankaytto%3AKAAVAYKSIKOT_ALUE_MVIEW&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2355d7c51b73426e7e4208da4e088e22%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637908095892972141%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=A6Kozvr5wkzMwd7yS6tWp7fT1LvnzWxP9tzMWTyEFQI%3D&reserved=0> -al -so --config OGR_WFS_PAGING_ALLOWED OFF

Without  OGR_WFS_PAGING_ALLOWED, I got some HTTP 400 errors.

I create WFS Service file (tre_wfs.xml):

<OGRWFSDataSource>
  <URL>https://geodata.tampere.fi/geoserver/wfs?typename=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgeodata.tampere.fi%2Fgeoserver%2Fwfs%3Ftypename%3Dmaankaytto%3AKAAVAYKSIKOT_ALUE_MVIEW&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2355d7c51b73426e7e4208da4e088e22%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637908095892972141%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=A6Kozvr5wkzMwd7yS6tWp7fT1LvnzWxP9tzMWTyEFQI%3D&reserved=0></URL>
  <PagingAllowed>OFF</PagingAllowed>
</OGRWFSDataSource>

When I run this service file with ogrinfo:

ogrinfo -ro tre_wfs.xml -al -so

I also got those HTTP 400 errors. However, if I add config parameter:

ogrinfo -ro tre_wfs.xml -al -so --config OGR_WFS_PAGING_ALLOWED OFF

It works, I'm confused.

Rgs,

Pekka




ti 14. kes?k. 2022 klo 15.52 Even Rouault (even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>) kirjoitti:

Hi,

It is not possible to set configuration options in VRT files. There could potentially be security issues in doing so and reading untrusted VRT.

Even
Le 14/06/2022 ? 14:49, Pekka Sarkola a ?crit :
Hi!

I had some other problems with the WFS service description file, need to check that.

However, in another case I'd like to use GML_ATTRIBUTES_TO_OGR_FIELDS -config for WFS service.

Rgs,

Pekka

ti 14. kes?k. 2022 klo 8.58 Rahkonen Jukka (jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>) kirjoitti:
Hi,

Do you need to use just the OGR virtual format https://gdal.org/drivers/vector/vrt.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdrivers%2Fvector%2Fvrt.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2355d7c51b73426e7e4208da4e088e22%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637908095892972141%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=9cqvOvjBsw59cWVS6Qa1grxGz5O1fzHQE6DjYA25Gd0%3D&reserved=0>? The simple WFS service description file https://gdal.org/drivers/vector/wfs.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fdrivers%2Fvector%2Fwfs.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2355d7c51b73426e7e4208da4e088e22%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637908095892972141%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=1dR9jTbtEho%2BG3tz8op8iACkOkgNhnfaQ2%2FTEWVlFcw%3D&reserved=0> seems to support an additional PagingAllowed element as immediate children of the OGRWFSDataSource for that purpose.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Pekka Sarkola
L?hetetty: tiistai 14. kes?kuuta 2022 8.34
Vastaanottaja: 'gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>' (gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>) <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Aihe: [gdal-dev] Possibility to use config options in VRT-files

Hi!

Could it be possible to add GDAL configuration options to VRT-files?

I have worked with several WFS-services, where I have to set OGR_WFS_PAGING_ALLOWED=OFF -option to get data.It is not problem to add system variable or --config when running ogrinfo/ogr2ogr from command line. But I like to use the same .vrt-files also in QGIS and it will be more convenient to add necessary config-options to vrt-files.

Rgs,

Pekka





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2355d7c51b73426e7e4208da4e088e22%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637908095892972141%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=SzJbJuBEctSTcoi%2BppR2UXh1666TLOTj2O%2FRa8IIOFM%3D&reserved=0>

--

http://www.spatialys.com<https://eur06.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com%2F&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C2355d7c51b73426e7e4208da4e088e22%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637908095892972141%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Z4ZSfVGuoY3561YnLe%2B53H7B8uQVLkiWcLwj3yJyu%2F8%3D&reserved=0>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/b8318b65/attachment-0001.htm>

From even.rouault at spatialys.com  Tue Jun 14 06:48:35 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 Jun 2022 15:48:35 +0200
Subject: [gdal-dev] Possibility to use config options in VRT-files
In-Reply-To: <CANgLEnCgqfWC6QpMDyxrRCujGG3Vgkz2x3qJCHOk2MVnk+Q-9A@mail.gmail.com>
References: <AM0PR09MB3219398AB2CE622D9B2B0638FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CANgLEnAQnE6KwHhKz3fDLc11PQeLiNSN3HeNW_D+EthqkcY3DQ@mail.gmail.com>
 <7460c1d0-eb9c-23f8-b6e6-80c26e72e249@spatialys.com>
 <CANgLEnCgqfWC6QpMDyxrRCujGG3Vgkz2x3qJCHOk2MVnk+Q-9A@mail.gmail.com>
Message-ID: <9ee77800-035c-ff92-7d35-c78f7c69e599@spatialys.com>

Pekka,

Support for <PagingAllowed> was indeed buggy. Fix queued in 
https://github.com/OSGeo/gdal/pull/5924

Even

Le 14/06/2022 ? 15:19, Pekka Sarkola a ?crit?:
>
>     <OGRWFSDataSource>
>     ?
>     <URL>https://geodata.tampere.fi/geoserver/wfs?typename=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW</URL>
>     ? <PagingAllowed>OFF</PagingAllowed>
>     </OGRWFSDataSource>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/7475a1bb/attachment.htm>

From pekka at gispo.fi  Tue Jun 14 07:22:38 2022
From: pekka at gispo.fi (Pekka Sarkola)
Date: Tue, 14 Jun 2022 17:22:38 +0300
Subject: [gdal-dev] Possibility to use config options in VRT-files
In-Reply-To: <9ee77800-035c-ff92-7d35-c78f7c69e599@spatialys.com>
References: <AM0PR09MB3219398AB2CE622D9B2B0638FDAA9@AM0PR09MB3219.eurprd09.prod.outlook.com>
 <CANgLEnAQnE6KwHhKz3fDLc11PQeLiNSN3HeNW_D+EthqkcY3DQ@mail.gmail.com>
 <7460c1d0-eb9c-23f8-b6e6-80c26e72e249@spatialys.com>
 <CANgLEnCgqfWC6QpMDyxrRCujGG3Vgkz2x3qJCHOk2MVnk+Q-9A@mail.gmail.com>
 <9ee77800-035c-ff92-7d35-c78f7c69e599@spatialys.com>
Message-ID: <CANgLEnDOp2jGOv714KT+e_VQ3w-Kp91g5RQMwcEYR7Shmgg8JQ@mail.gmail.com>

Hi Even,

Great, thank you!

Rgs,

Pekka


ti 14. kes?k. 2022 klo 16.48 Even Rouault (even.rouault at spatialys.com)
kirjoitti:

> Pekka,
>
> Support for <PagingAllowed> was indeed buggy. Fix queued in
> https://github.com/OSGeo/gdal/pull/5924
>
> Even
> Le 14/06/2022 ? 15:19, Pekka Sarkola a ?crit :
>
> <OGRWFSDataSource>
>   <URL>
> https://geodata.tampere.fi/geoserver/wfs?typename=maankaytto:KAAVAYKSIKOT_ALUE_MVIEW
> </URL>
>   <PagingAllowed>OFF</PagingAllowed>
> </OGRWFSDataSource>
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220614/c294bdcd/attachment.htm>

From even.rouault at spatialys.com  Wed Jun 15 07:51:28 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 15 Jun 2022 16:51:28 +0200
Subject: [gdal-dev] Proposed new driver to handle Basis Universal / KTX2
 textures
Message-ID: <cda34b18-989e-23d4-70b3-a7deb2a72dc3@spatialys.com>

Hi,

There's interest for adding a new read/write raster GDAL driver for the 
Basis Universal and KTX2 (https://github.khronos.org/KTX-Specification/) 
texture formats, used in 3D/BIM formats like I3S and glTF. That would 
use the https://github.com/BinomialLLC/basis_universal software (Apache 
2.0 licensed) to do the encoding/decoding.

I just wanted to know if people were comfortable to have this as a 
in-tree (optional) GDAL driver. Texture support is not necessarily where 
GDAL is most known but we do already have a few drivers specifically 
handling that like the DDS/crunch one 
(https://gdal.org/drivers/raster/dds.html) or the TARGA one 
(https://gdal.org/drivers/raster/tga.html), not mentioning more generic 
purposes formats like JPEG or PNG.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jluis at ualg.pt  Thu Jun 16 09:27:55 2022
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Thu, 16 Jun 2022 16:27:55 +0000
Subject: [gdal-dev] dfMaxAngleStepSizeDegrees  in ApproximateArcAngles
Message-ID: <AM6PR04MB395976932C7314C844D92463A6AC9@AM6PR04MB3959.eurprd04.prod.outlook.com>

Even, I wrapped OGR_G_ApproximateArcAngles() in Julia and I think there is something wrong with the  dfMaxAngleStepSizeDegrees argument
(here shortcut to ?inc?)

This is fine (just repeating the default 0.0 value). Note, I?m dropping the z (=0) argin but that?s only the julia wrapper interface.

D = GMT.Gdal.arcellipse(0, 0, 1., 1., 0., -90., inc=0.)
BoundingBox: [6.123233995736766e-17, 1.0, 0.0, 1.0]
24?2 GMTdataset{Float64, 2}
Row ? x            y
     ? Float64      Float64
??????????????????????????????
   1 ? 6.12323e-17  1.0
   2 ? 0.0682424    0.997669
   3 ? 0.136167     0.990686
   4 ? 0.203456     0.979084
   5 ? 0.269797     0.962917
  ?  ?      ?           ?
  20 ? 0.962917     0.269797
  21 ? 0.979084     0.203456
  22 ? 0.990686     0.136167
  23 ? 0.997669     0.0682424
  24 ? 1.0          0.0

But if I use for example 10 (or any other number) the dfEndAngle is no longer respected

D = GMT.Gdal.arcellipse(0, 0., 1., 1., 0., -90., inc=10.)
BoundingBox: [6.123233995736766e-17, 0.9993908270190958, -0.17364817766693033, 1.0]
26?2 GMTdataset{Float64, 2}
Row ? x            y
     ? Float64      Float64
???????????????????????????????
   1 ? 6.12323e-17   1.0
   2 ? 0.0697565     0.997564
   3 ? 0.139173      0.990268
   4 ? 0.207912      0.978148
   5 ? 0.275637      0.961262
   6 ? 0.34202       0.939693
   7 ? 0.406737      0.913545
   8 ? 0.469472      0.882948
  ?  ?      ?           ?
  19 ? 0.951057      0.309017
  20 ? 0.970296      0.241922
  21 ? 0.984808      0.173648
  22 ? 0.994522      0.104528
  23 ? 0.999391      0.0348995
  24 ? 0.999391     -0.0348995
  25 ? 0.994522     -0.104528
  26 ? 0.984808     -0.173648


Joaquim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220616/f43d111a/attachment.htm>

From even.rouault at spatialys.com  Thu Jun 16 09:48:42 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 16 Jun 2022 18:48:42 +0200
Subject: [gdal-dev] dfMaxAngleStepSizeDegrees in ApproximateArcAngles
In-Reply-To: <AM6PR04MB395976932C7314C844D92463A6AC9@AM6PR04MB3959.eurprd04.prod.outlook.com>
References: <AM6PR04MB395976932C7314C844D92463A6AC9@AM6PR04MB3959.eurprd04.prod.outlook.com>
Message-ID: <7deca06b-1357-875e-59a3-3992e6331168@spatialys.com>

I can't replicate that. Below the output with the Python bindings that 
directly map OGR_G_ApproximateArcAngles():

>>> from osgeo import ogr
 >>> g = ogr.ApproximateArcAngles(0, 0, 0, 1, 1, 0, 0, -90, 0)
 >>> g.FlattenTo2D()
 >>> g.ExportToWkt()
'LINESTRING (1 0,0.997668769190539 0.068242413364671,0.990685946036331 
0.136166649096247,0.979084087682323 0.203456013052634,0.962917287347799 
0.269796771157024,0.942260922118821 0.334879612170986,0.917211301505453 
0.398401089846241,0.887885218402375 0.460065037731152,0.854419404546489 
0.519583950035434,0.816969893010442 0.576680322114867,0.77571129070442 
0.631087944326053,0.730835964278124 0.682553143218654,0.682553143218654 
0.730835964278124,0.631087944326053 0.77571129070442,0.576680322114867 
0.816969893010442,0.519583950035434 0.854419404546489,0.460065037731152 
0.887885218402375,0.398401089846242 0.917211301505453,0.334879612170986 
0.942260922118821,0.269796771157024 0.962917287347799,0.203456013052634 
0.979084087682323,0.136166649096247 0.990685946036331,0.068242413364671 
0.997668769190539,0.0 1.0)'

>>> g = ogr.ApproximateArcAngles(0,  0, 0, 1, 1, 0, 0, -90, 10)
 >>> g.FlattenTo2D()
 >>> g.ExportToWkt()
'LINESTRING (1 0,0.984807753012208 0.17364817766693,0.939692620785908 
0.342020143325669,0.866025403784439 0.5,0.766044443118978 
0.642787609686539,0.642787609686539 0.766044443118978,0.5 
0.866025403784439,0.342020143325669 0.939692620785908,0.17364817766693 
0.984807753012208,0.0 1.0)'
 >>>

For the inc=0 case, note that there's a x/y inversion compared to your 
output.

The inc=10 case has 10 points in its output as expected

Even

Le 16/06/2022 ? 18:27, Joaquim Manuel Freire Lu?s a ?crit?:
>
> Even, I wrapped OGR_G_ApproximateArcAngles() in Julia and I think 
> there is something wrong with the ?dfMaxAngleStepSizeDegrees argument
>
> (here shortcut to ?inc?)
>
> This is fine (just repeating the default 0.0 value). Note, I?m 
> dropping the z (=0) argin but that?s only the julia wrapper interface.
>
> D = GMT.Gdal.arcellipse(0, 0, 1., 1., 0., -90., inc=0.)
>
> BoundingBox: [6.123233995736766e-17, 1.0, 0.0, 1.0]
>
> 24?2 GMTdataset{Float64, 2}
>
> Row ? x??????????? y
>
> ? Float64????? Float64
>
> ??????????????????????????????
>
> ?? 1 ? 6.12323e-17? 1.0
>
> ?? 2 ? 0.0682424 0.997669
>
> ?? 3 ? 0.136167 0.990686
>
> ?? 4 ? 0.203456 0.979084
>
> ?? 5 ? 0.269797 0.962917
>
> ????
>
> ? 20 ? 0.962917 0.269797
>
> ? 21 ? 0.979084 0.203456
>
> ? 22 ? 0.990686 0.136167
>
> ? 23 ? 0.997669 0.0682424
>
> ? 24 ? 1.0????????? 0.0
>
> But if I use for example 10 (or any other number) the dfEndAngle is no 
> longer respected
>
> D = GMT.Gdal.arcellipse(0, 0., 1., 1., 0., -90., inc=10.)
>
> BoundingBox: [6.123233995736766e-17, 0.9993908270190958, 
> -0.17364817766693033, 1.0]
>
> 26?2 GMTdataset{Float64, 2}
>
> Row ? x??????????? y
>
> ? Float64????? Float64
>
> ???????????????????????????????
>
> ?? 1 ? 6.12323e-17?? 1.0
>
> ?? 2 ? 0.0697565 0.997564
>
> ?? 3 ? 0.139173 0.990268
>
> ?? 4 ? 0.207912 0.978148
>
> ?? 5 ? 0.275637 0.961262
>
> ?? 6 ? 0.34202 0.939693
>
> ?? 7 ? 0.406737 0.913545
>
> ?? 8 ? 0.469472 0.882948
>
> ????
>
> ? 19 ? 0.951057 0.309017
>
> ? 20 ? 0.970296 0.241922
>
> ? 21 ? 0.984808 0.173648
>
> ? 22 ? 0.994522 0.104528
>
> ? 23 ? 0.999391 0.0348995
>
> ? 24 ? 0.999391 -0.0348995
>
> ? 25 ? 0.994522 -0.104528
>
> ? 26 ? 0.984808 -0.173648
>
> Joaquim
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220616/439ffef3/attachment-0001.htm>

From jluis at ualg.pt  Thu Jun 16 10:35:35 2022
From: jluis at ualg.pt (=?utf-8?B?Sm9hcXVpbSBNYW51ZWwgRnJlaXJlIEx1w61z?=)
Date: Thu, 16 Jun 2022 17:35:35 +0000
Subject: [gdal-dev] dfMaxAngleStepSizeDegrees in ApproximateArcAngles
In-Reply-To: <7deca06b-1357-875e-59a3-3992e6331168@spatialys.com>
References: <AM6PR04MB395976932C7314C844D92463A6AC9@AM6PR04MB3959.eurprd04.prod.outlook.com>
 <7deca06b-1357-875e-59a3-3992e6331168@spatialys.com>
Message-ID: <AM6PR04MB39590EC45F271D13B0A2DEE4A6AC9@AM6PR04MB3959.eurprd04.prod.outlook.com>

Ah ghrr, I missed one argin in my wrapping (the dfRotation) and probably because the dfMaxAngleStepSizeDegrees  has a default value, an error was not triggered.
Now it works. Sorry for the noise.

From: Even Rouault <even.rouault at spatialys.com>
Sent: Thursday, June 16, 2022 5:49 PM
To: Joaquim Manuel Freire Lu?s <jluis at ualg.pt>; gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] dfMaxAngleStepSizeDegrees in ApproximateArcAngles


I can't replicate that. Below the output with the Python bindings that directly map OGR_G_ApproximateArcAngles():

>>> from osgeo import ogr
>>> g = ogr.ApproximateArcAngles(0, 0, 0, 1, 1, 0, 0, -90, 0)
>>> g.FlattenTo2D()
>>> g.ExportToWkt()
'LINESTRING (1 0,0.997668769190539 0.068242413364671,0.990685946036331 0.136166649096247,0.979084087682323 0.203456013052634,0.962917287347799 0.269796771157024,0.942260922118821 0.334879612170986,0.917211301505453 0.398401089846241,0.887885218402375 0.460065037731152,0.854419404546489 0.519583950035434,0.816969893010442 0.576680322114867,0.77571129070442 0.631087944326053,0.730835964278124 0.682553143218654,0.682553143218654 0.730835964278124,0.631087944326053 0.77571129070442,0.576680322114867 0.816969893010442,0.519583950035434 0.854419404546489,0.460065037731152 0.887885218402375,0.398401089846242 0.917211301505453,0.334879612170986 0.942260922118821,0.269796771157024 0.962917287347799,0.203456013052634 0.979084087682323,0.136166649096247 0.990685946036331,0.068242413364671 0.997668769190539,0.0 1.0)'

>>> g = ogr.ApproximateArcAngles(0, 0, 0, 1, 1, 0, 0, -90, 10)
>>> g.FlattenTo2D()
>>> g.ExportToWkt()
'LINESTRING (1 0,0.984807753012208 0.17364817766693,0.939692620785908 0.342020143325669,0.866025403784439 0.5,0.766044443118978 0.642787609686539,0.642787609686539 0.766044443118978,0.5 0.866025403784439,0.342020143325669 0.939692620785908,0.17364817766693 0.984807753012208,0.0 1.0)'
>>>

For the inc=0 case, note that there's a x/y inversion compared to your output.

The inc=10 case has 10 points in its output as expected

Even
Le 16/06/2022 ? 18:27, Joaquim Manuel Freire Lu?s a ?crit :
Even, I wrapped OGR_G_ApproximateArcAngles() in Julia and I think there is something wrong with the  dfMaxAngleStepSizeDegrees argument
(here shortcut to ?inc?)

This is fine (just repeating the default 0.0 value). Note, I?m dropping the z (=0) argin but that?s only the julia wrapper interface.

D = GMT.Gdal.arcellipse(0, 0, 1., 1., 0., -90., inc=0.)
BoundingBox: [6.123233995736766e-17, 1.0, 0.0, 1.0]
24?2 GMTdataset{Float64, 2}
Row ? x            y
     ? Float64      Float64
??????????????????????????????
   1 ? 6.12323e-17  1.0
   2 ? 0.0682424    0.997669
   3 ? 0.136167     0.990686
   4 ? 0.203456     0.979084
   5 ? 0.269797     0.962917
  ?  ?      ?           ?
  20 ? 0.962917     0.269797
  21 ? 0.979084     0.203456
  22 ? 0.990686     0.136167
  23 ? 0.997669     0.0682424
  24 ? 1.0          0.0

But if I use for example 10 (or any other number) the dfEndAngle is no longer respected

D = GMT.Gdal.arcellipse(0, 0., 1., 1., 0., -90., inc=10.)
BoundingBox: [6.123233995736766e-17, 0.9993908270190958, -0.17364817766693033, 1.0]
26?2 GMTdataset{Float64, 2}
Row ? x            y
     ? Float64      Float64
???????????????????????????????
   1 ? 6.12323e-17   1.0
   2 ? 0.0697565     0.997564
   3 ? 0.139173      0.990268
   4 ? 0.207912      0.978148
   5 ? 0.275637      0.961262
   6 ? 0.34202       0.939693
   7 ? 0.406737      0.913545
   8 ? 0.469472      0.882948
  ?  ?      ?           ?
  19 ? 0.951057      0.309017
  20 ? 0.970296      0.241922
  21 ? 0.984808      0.173648
  22 ? 0.994522      0.104528
  23 ? 0.999391      0.0348995
  24 ? 0.999391     -0.0348995
  25 ? 0.994522     -0.104528
  26 ? 0.984808     -0.173648


Joaquim



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220616/32e2eeb0/attachment-0001.htm>

From jrmorreale_ml at enoreth.net  Thu Jun 16 11:46:29 2022
From: jrmorreale_ml at enoreth.net (Jean-Roc Morreale (ml))
Date: Thu, 16 Jun 2022 20:46:29 +0200
Subject: [gdal-dev] Proposed new driver to handle Basis Universal / KTX2
 textures
In-Reply-To: <cda34b18-989e-23d4-70b3-a7deb2a72dc3@spatialys.com>
References: <cda34b18-989e-23d4-70b3-a7deb2a72dc3@spatialys.com>
Message-ID: <b07af6f44ba7a9e6b3cb92c06c87b90bc6bdde22.camel@enoreth.net>

Hi Even,

Out of curiosity, what are the possible usecases for geospatial tasks,
georeferenced normal/displacement mapping straight to the gpu ?

regards,
JR

Le mercredi 15 juin 2022 ? 16:51 +0200, Even Rouault a ?crit?:
> Hi,
> 
> There's interest for adding a new read/write raster GDAL driver for
> the 
> Basis Universal and KTX2
> (https://github.khronos.org/KTX-Specification/) 
> texture formats, used in 3D/BIM formats like I3S and glTF. That would
> use the https://github.com/BinomialLLC/basis_universal?software
> (Apache 
> 2.0 licensed) to do the encoding/decoding.
> 
> I just wanted to know if people were comfortable to have this as a 
> in-tree (optional) GDAL driver. Texture support is not necessarily
> where 
> GDAL is most known but we do already have a few drivers specifically 
> handling that like the DDS/crunch one 
> (https://gdal.org/drivers/raster/dds.html) or the TARGA one 
> (https://gdal.org/drivers/raster/tga.html), not mentioning more
> generic 
> purposes formats like JPEG or PNG.
> 
> Even
> 


From even.rouault at spatialys.com  Thu Jun 16 12:15:38 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 16 Jun 2022 21:15:38 +0200
Subject: [gdal-dev] Proposed new driver to handle Basis Universal / KTX2
 textures
In-Reply-To: <b07af6f44ba7a9e6b3cb92c06c87b90bc6bdde22.camel@enoreth.net>
References: <cda34b18-989e-23d4-70b3-a7deb2a72dc3@spatialys.com>
 <b07af6f44ba7a9e6b3cb92c06c87b90bc6bdde22.camel@enoreth.net>
Message-ID: <0e291e83-b634-6231-85de-a9bad21bda4a@spatialys.com>

Jean-Roc,

those formats have potential to be loaded on the GPU with very few 
processing, as far as I understand their description. And the 
BinomialLLC/basis_universal code is able to do that typically.

That said in a GDAL context, full decompression/compression will be done 
as there's no direct interface between GDAL and the GPU. The use case 
here is more to use GDAL's convenient generic raster capabilities to 
read/write that format amongst other textures formats (which don't hold 
georefencing by themselves, but may be associated to georeferenced 
objects externally), regular non-georeferenced images ... and sometimes 
geospatial raster formats.

Even

Le 16/06/2022 ? 20:46, Jean-Roc Morreale (ml) a ?crit?:
> Hi Even,
>
> Out of curiosity, what are the possible usecases for geospatial tasks,
> georeferenced normal/displacement mapping straight to the gpu ?
>
> regards,
> JR
>
> Le mercredi 15 juin 2022 ? 16:51 +0200, Even Rouault a ?crit?:
>> Hi,
>>
>> There's interest for adding a new read/write raster GDAL driver for
>> the
>> Basis Universal and KTX2
>> (https://github.khronos.org/KTX-Specification/)
>> texture formats, used in 3D/BIM formats like I3S and glTF. That would
>> use the https://github.com/BinomialLLC/basis_universal?software
>> (Apache
>> 2.0 licensed) to do the encoding/decoding.
>>
>> I just wanted to know if people were comfortable to have this as a
>> in-tree (optional) GDAL driver. Texture support is not necessarily
>> where
>> GDAL is most known but we do already have a few drivers specifically
>> handling that like the DDS/crunch one
>> (https://gdal.org/drivers/raster/dds.html) or the TARGA one
>> (https://gdal.org/drivers/raster/tga.html), not mentioning more
>> generic
>> purposes formats like JPEG or PNG.
>>
>> Even
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From esoth at stanford.edu  Thu Jun 16 16:51:20 2022
From: esoth at stanford.edu (Emily Soth)
Date: Thu, 16 Jun 2022 16:51:20 -0700
Subject: [gdal-dev] python - convert CSV of point coordinates to geopackage
Message-ID: <CAMFVpTL8yQLyyBBpRC2gPzeypTnNwEDNDsw4HrR5wkmtW-t8oQ@mail.gmail.com>

Hi,

I am trying to create a geopackage from a CSV of point coordinates making
use of the X_POSSIBLE_NAMES and Y_POSSIBLE_NAMES open options on the CSV
driver.

I have tried a few things (details are in a gist
<https://gist.github.com/emlys/60db94cb4017a78219a1aa1dadc0914d>). To
summarize, I can only set the open options when opening as a gdal.Dataset,
but then I cannot copy that back into a vector format.

In the source code it looks like open options can be passed to the CSV
driver's Open function (source
<https://github.com/OSGeo/gdal/blob/35c07b18316b4b6d238f6d60b82c31e25662ad27/ogr/ogrsf_frmts/csv/ogrcsvdriver.cpp#L142-L167>)
but I don't know how to use this from the python API since the python
ogr.Driver.Open function doesn't accept open options unlike gdal.OpenEx.

Thank you!
- Emily
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220616/a4dac125/attachment.htm>

From alansnow21 at gmail.com  Thu Jun 16 17:48:07 2022
From: alansnow21 at gmail.com (Alan Snow)
Date: Thu, 16 Jun 2022 19:48:07 -0500
Subject: [gdal-dev] python - convert CSV of point coordinates to
 geopackage
In-Reply-To: <CAMFVpTL8yQLyyBBpRC2gPzeypTnNwEDNDsw4HrR5wkmtW-t8oQ@mail.gmail.com>
References: <CAMFVpTL8yQLyyBBpRC2gPzeypTnNwEDNDsw4HrR5wkmtW-t8oQ@mail.gmail.com>
Message-ID: <CAGybdFSn4hyM2MWrMx6ONvuKukuShuj2c9NqJeACZyKknR0SUw@mail.gmail.com>

These references may be helpful:

https://geopandas.org/en/stable/docs/user_guide/io.html

https://geopandas.org/en/stable/docs/reference/api/geopandas.points_from_xy.html


On Thu, Jun 16, 2022, 7:14 PM Emily Soth <esoth at stanford.edu> wrote:

> Hi,
>
> I am trying to create a geopackage from a CSV of point coordinates making
> use of the X_POSSIBLE_NAMES and Y_POSSIBLE_NAMES open options on the CSV
> driver.
>
> I have tried a few things (details are in a gist
> <https://gist.github.com/emlys/60db94cb4017a78219a1aa1dadc0914d>). To
> summarize, I can only set the open options when opening as a gdal.Dataset,
> but then I cannot copy that back into a vector format.
>
> In the source code it looks like open options can be passed to the CSV
> driver's Open function (source
> <https://github.com/OSGeo/gdal/blob/35c07b18316b4b6d238f6d60b82c31e25662ad27/ogr/ogrsf_frmts/csv/ogrcsvdriver.cpp#L142-L167>)
> but I don't know how to use this from the python API since the python
> ogr.Driver.Open function doesn't accept open options unlike gdal.OpenEx.
>
> Thank you!
> - Emily
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220616/e6d13953/attachment.htm>

From ashley_c_mort at raytheon.com  Fri Jun 17 07:51:51 2022
From: ashley_c_mort at raytheon.com (Ashley Mort)
Date: Fri, 17 Jun 2022 14:51:51 +0000
Subject: [gdal-dev] convert to ESRI Shapefile- datetime as a string?
Message-ID: <BN2P110MB1256DCBF3A7177147FBFC304CAAF9@BN2P110MB1256.NAMP110.PROD.OUTLOOK.COM>

We are using GDAL 3.4.1 to convert GeoJSON to ESRI Shapefile with ogr2ogr.  Our source data has a datetime field with content like "2022-07-09T23:59:59.000000Z" and in the resultant Shapefile it shows up as 7/9/2002.

Is there a way to get the ISO datetime into the Shapefile as a string instead of the truncated date?

Thanks!

Ashley Mort
Sr. Software Engineer
972-638-6317 office
814-571-3039 cell

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220617/0759dfb4/attachment.htm>

From even.rouault at spatialys.com  Fri Jun 17 08:29:07 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 17 Jun 2022 17:29:07 +0200
Subject: [gdal-dev] convert to ESRI Shapefile- datetime as a string?
In-Reply-To: <BN2P110MB1256DCBF3A7177147FBFC304CAAF9@BN2P110MB1256.NAMP110.PROD.OUTLOOK.COM>
References: <BN2P110MB1256DCBF3A7177147FBFC304CAAF9@BN2P110MB1256.NAMP110.PROD.OUTLOOK.COM>
Message-ID: <61d7a606-8d1d-0e02-39f8-6dcbbd105c64@spatialys.com>

Ashley,

try adding "-mapFieldType DateTime=String". See 
https://gdal.org/programs/ogr2ogr.html#cmdoption-ogr2ogr-mapFieldType

You won't get a ISO datetime but the historical format used by OGR: 
"YYYY/MM/DD HH:MM:SS"

Even

Le 17/06/2022 ? 16:51, Ashley Mort via gdal-dev a ?crit?:
>
> We are using GDAL 3.4.1 to convert GeoJSON to ESRI Shapefile with 
> ogr2ogr.? Our source data has a datetime field with content like 
> ?2022-07-09T23:59:59.000000Z? and in the resultant Shapefile it shows 
> up as 7/9/2002.
>
> Is there a way to get the ISO datetime into the Shapefile as a string 
> instead of the truncated date?
>
> Thanks!
>
> Ashley Mort
>
> Sr. Software Engineer
>
> 972-638-6317 office
>
> 814-571-3039 cell
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220617/9e650b5c/attachment-0001.htm>

From osgeo.mailinglist at gmail.com  Fri Jun 17 17:36:18 2022
From: osgeo.mailinglist at gmail.com (Thomas Gratier)
Date: Sat, 18 Jun 2022 02:36:18 +0200
Subject: [gdal-dev] python - convert CSV of point coordinates to
 geopackage
In-Reply-To: <CAGybdFSn4hyM2MWrMx6ONvuKukuShuj2c9NqJeACZyKknR0SUw@mail.gmail.com>
References: <CAMFVpTL8yQLyyBBpRC2gPzeypTnNwEDNDsw4HrR5wkmtW-t8oQ@mail.gmail.com>
 <CAGybdFSn4hyM2MWrMx6ONvuKukuShuj2c9NqJeACZyKknR0SUw@mail.gmail.com>
Message-ID: <CACPZzQ03yq2_ttOk0tp28pwpZnNunDT0p5tASKjDtSLKysxyAQ@mail.gmail.com>

Hi,

One possible approach using only GDAL
https://gist.github.com/ThomasG77/1c76c8fd4f6ee08d9da88dfdb911cfcb
It can be also made with higher level abstraction package like geopandas or
fiona like mentioned by Alan (also in the same link)


Regards

Thomas Gratier

PS: not sure I've code the fastest solution for 3 approaches


Le ven. 17 juin 2022 ? 02:48, Alan Snow <alansnow21 at gmail.com> a ?crit :

> These references may be helpful:
>
> https://geopandas.org/en/stable/docs/user_guide/io.html
>
>
> https://geopandas.org/en/stable/docs/reference/api/geopandas.points_from_xy.html
>
>
> On Thu, Jun 16, 2022, 7:14 PM Emily Soth <esoth at stanford.edu> wrote:
>
>> Hi,
>>
>> I am trying to create a geopackage from a CSV of point coordinates making
>> use of the X_POSSIBLE_NAMES and Y_POSSIBLE_NAMES open options on the CSV
>> driver.
>>
>> I have tried a few things (details are in a gist
>> <https://gist.github.com/emlys/60db94cb4017a78219a1aa1dadc0914d>). To
>> summarize, I can only set the open options when opening as a gdal.Dataset,
>> but then I cannot copy that back into a vector format.
>>
>> In the source code it looks like open options can be passed to the CSV
>> driver's Open function (source
>> <https://github.com/OSGeo/gdal/blob/35c07b18316b4b6d238f6d60b82c31e25662ad27/ogr/ogrsf_frmts/csv/ogrcsvdriver.cpp#L142-L167>)
>> but I don't know how to use this from the python API since the python
>> ogr.Driver.Open function doesn't accept open options unlike gdal.OpenEx.
>>
>> Thank you!
>> - Emily
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220618/dd287caa/attachment.htm>

From ashley_c_mort at raytheon.com  Fri Jun 17 20:32:04 2022
From: ashley_c_mort at raytheon.com (Ashley Mort)
Date: Sat, 18 Jun 2022 03:32:04 +0000
Subject: [gdal-dev] convert to ESRI Shapefile- datetime as a string?
In-Reply-To: <61d7a606-8d1d-0e02-39f8-6dcbbd105c64@spatialys.com>
References: <BN2P110MB1256DCBF3A7177147FBFC304CAAF9@BN2P110MB1256.NAMP110.PROD.OUTLOOK.COM>
 <61d7a606-8d1d-0e02-39f8-6dcbbd105c64@spatialys.com>
Message-ID: <BN2P110MB1256F8E068275C9560C24926CAAE9@BN2P110MB1256.NAMP110.PROD.OUTLOOK.COM>

That worked.  Thanks!

Ashley Mort
Sr. Software Engineer
972-638-6317 office
814-571-3039 cell

From: Even Rouault <even.rouault at spatialys.com>
Sent: Friday, June 17, 2022 10:29 AM
To: Ashley Mort <ashley_c_mort at raytheon.com>; gdal-dev at lists.osgeo.org
Subject: [External] Re: [gdal-dev] convert to ESRI Shapefile- datetime as a string?


Ashley,

try adding "-mapFieldType DateTime=String". See https://gdal.org/programs/ogr2ogr.html#cmdoption-ogr2ogr-mapFieldType

You won't get a ISO datetime but the historical format used by OGR: "YYYY/MM/DD HH:MM:SS"

Even
Le 17/06/2022 ? 16:51, Ashley Mort via gdal-dev a ?crit :
We are using GDAL 3.4.1 to convert GeoJSON to ESRI Shapefile with ogr2ogr.  Our source data has a datetime field with content like ?2022-07-09T23:59:59.000000Z? and in the resultant Shapefile it shows up as 7/9/2002.

Is there a way to get the ISO datetime into the Shapefile as a string instead of the truncated date?

Thanks!

Ashley Mort
Sr. Software Engineer
972-638-6317 office
814-571-3039 cell




_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220618/bffde10d/attachment.htm>

From jon.morris.dev at outlook.com  Wed Jun 22 06:37:04 2022
From: jon.morris.dev at outlook.com (Jon Morris)
Date: Wed, 22 Jun 2022 13:37:04 +0000
Subject: [gdal-dev] GetFID incorrect after sorting layer
Message-ID: <DB8PR10MB2844EC4F2DE8419AFC9CB186AFB29@DB8PR10MB2844.EURPRD10.PROD.OUTLOOK.COM>

Hello all,

I?m having trouble getting features in a layer after sorting with SQL query. It seems that the FIDs change when the layer is sorted. I?m ok with that, but if you take the id returned by GetFID and call GetFeature on the layer, you get a different feature. I would have thought GetFID/GetFeature should remain in sync even after sorting. The docs for GetFeature say ?If this method returns a non-NULL feature, it is guaranteed that its feature id (OGRFeature::GetFID()) will be the same as nFID.?
https://gdal.org/doxygen/classOGRLayer.html#ace902dfb44335fb1a877aa035ecff209

I?m aware I could just iterate through the layer, but I want to add/delete features so prefer to iterate through a list of ids instead. Should I just ignore the FIDs and iterate through range(layer.GetFeatureCount()) instead? Is that guaranteed to give me every feature in size order?

I?m using GDAL 3.4.1 on Python 3.8.12

Repro case:
https://gist.github.com/jontwo/01d8cbf1e047e36d2fb2f7786ad60e73
Creates a layer with 4 features, areas 1, 64, 4, 25
Then sorts them with ds.ExecuteSQL(f"SELECT * FROM lname ORDER BY OGR_GEOM_AREA ASC")
Gets a list of FIDs in the layer using GetFID
Calls GetFeature for each of these FIDs.

Output:
Areas before: [(0, 1.0), (1, 64.0), (2, 4.0), (3, 25.0)]
Areas after: [(0, 1.0), (2, 4.0), (3, 25.0), (1, 64.0)]
Requested FID 0 (area 1.0) got 0 (area 1.0)
Requested FID 2 (area 4.0) got 3 (area 25.0)
Requested FID 3 (area 25.0) got 1 (area 64.0)
Requested FID 1 (area 64.0) got 2 (area 4.0)

Thanks,

Jon

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220622/b86005b2/attachment.htm>

From even.rouault at spatialys.com  Wed Jun 22 08:09:33 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 Jun 2022 17:09:33 +0200
Subject: [gdal-dev] GetFID incorrect after sorting layer
In-Reply-To: <DB8PR10MB2844EC4F2DE8419AFC9CB186AFB29@DB8PR10MB2844.EURPRD10.PROD.OUTLOOK.COM>
References: <DB8PR10MB2844EC4F2DE8419AFC9CB186AFB29@DB8PR10MB2844.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <2af247c4-b2cb-3643-8f33-3627266f987a@spatialys.com>

Jon,

this is a bug on the result SQL layer implementation of GetFeature(). 
Can you file a ticket in https://github.com/OSGeo/gdal/issues/new with 
the below elements? Thanks

Even

Le 22/06/2022 ? 15:37, Jon Morris a ?crit?:
>
> Hello all,
>
> I?m having trouble getting features in a layer after sorting with SQL 
> query. It seems that the FIDs change when the layer is sorted. I?m ok 
> with that, but if you take the id returned by GetFID and call 
> GetFeature on the layer, you get a different feature. I would have 
> thought GetFID/GetFeature should remain in sync even after sorting. 
> The docs for GetFeature say ?If this method returns a non-NULL 
> feature, it is guaranteed that its feature id (OGRFeature::GetFID()) 
> will be the same as nFID.?
>
> https://gdal.org/doxygen/classOGRLayer.html#ace902dfb44335fb1a877aa035ecff209 
>
>
> I?m aware I could just iterate through the layer, but I want to 
> add/delete features so prefer to iterate through a list of ids 
> instead. Should I just ignore the FIDs and iterate through 
> range(layer.GetFeatureCount()) instead? Is that guaranteed to give me 
> every feature in size order?
>
> I?m using GDAL 3.4.1 on Python 3.8.12
>
> Repro case:
>
> https://gist.github.com/jontwo/01d8cbf1e047e36d2fb2f7786ad60e73
>
> Creates a layer with 4 features, areas 1, 64, 4, 25
>
> Then sorts them with ds.ExecuteSQL(f"SELECT * FROM lname ORDER BY 
> OGR_GEOM_AREA ASC")
>
> Gets a list of FIDs in the layer using GetFID
>
> Calls GetFeature for each of these FIDs.
>
> Output:
>
> Areas before: [(0, 1.0), (1, 64.0), (2, 4.0), (3, 25.0)]
>
> Areas after: [(0, 1.0), (2, 4.0), (3, 25.0), (1, 64.0)]
>
> Requested FID 0 (area 1.0) got 0 (area 1.0)
>
> Requested FID 2 (area 4.0) got 3 (area 25.0)
>
> Requested FID 3 (area 25.0) got 1 (area 64.0)
>
> Requested FID 1 (area 64.0) got 2 (area 4.0)
>
> Thanks,
>
> Jon
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220622/106841a6/attachment.htm>

From jon.morris.dev at outlook.com  Wed Jun 22 11:14:27 2022
From: jon.morris.dev at outlook.com (Jon Morris)
Date: Wed, 22 Jun 2022 18:14:27 +0000
Subject: [gdal-dev] GetFID incorrect after sorting layer
In-Reply-To: <2af247c4-b2cb-3643-8f33-3627266f987a@spatialys.com>
References: <DB8PR10MB2844EC4F2DE8419AFC9CB186AFB29@DB8PR10MB2844.EURPRD10.PROD.OUTLOOK.COM>
 <2af247c4-b2cb-3643-8f33-3627266f987a@spatialys.com>
Message-ID: <DB8PR10MB284433DF6B556FCF221EAA90AFB29@DB8PR10MB2844.EURPRD10.PROD.OUTLOOK.COM>

Done: https://github.com/OSGeo/gdal/issues/5967

Many thanks,

Jon
[https://opengraph.githubassets.com/594c877faa442856292a9b4df982ba26051c434a7b1e2c82ab21fe444a6f95dc/OSGeo/gdal/issues/5967]<https://github.com/OSGeo/gdal/issues/5967>
GetFID incorrect after sorting layer ? Issue #5967 ? OSGeo/gdal<https://github.com/OSGeo/gdal/issues/5967>
Expected behavior and actual behavior. When a layer is sorted using ExecuteSQL with ORDER BY, the FIDs in the layer are changed such GetFeature returns the wrong feature when using an fid obtained ...
github.com

________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: 22 June 2022 16:09
To: Jon Morris <jon.morris.dev at outlook.com>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] GetFID incorrect after sorting layer


Jon,

this is a bug on the result SQL layer implementation of GetFeature(). Can you file a ticket in https://github.com/OSGeo/gdal/issues/new with the below elements? Thanks

Even

Le 22/06/2022 ? 15:37, Jon Morris a ?crit :

Hello all,



I?m having trouble getting features in a layer after sorting with SQL query. It seems that the FIDs change when the layer is sorted. I?m ok with that, but if you take the id returned by GetFID and call GetFeature on the layer, you get a different feature. I would have thought GetFID/GetFeature should remain in sync even after sorting. The docs for GetFeature say ?If this method returns a non-NULL feature, it is guaranteed that its feature id (OGRFeature::GetFID()) will be the same as nFID.?

https://gdal.org/doxygen/classOGRLayer.html#ace902dfb44335fb1a877aa035ecff209



I?m aware I could just iterate through the layer, but I want to add/delete features so prefer to iterate through a list of ids instead. Should I just ignore the FIDs and iterate through range(layer.GetFeatureCount()) instead? Is that guaranteed to give me every feature in size order?



I?m using GDAL 3.4.1 on Python 3.8.12



Repro case:

https://gist.github.com/jontwo/01d8cbf1e047e36d2fb2f7786ad60e73

Creates a layer with 4 features, areas 1, 64, 4, 25

Then sorts them with ds.ExecuteSQL(f"SELECT * FROM lname ORDER BY OGR_GEOM_AREA ASC")

Gets a list of FIDs in the layer using GetFID

Calls GetFeature for each of these FIDs.



Output:

Areas before: [(0, 1.0), (1, 64.0), (2, 4.0), (3, 25.0)]

Areas after: [(0, 1.0), (2, 4.0), (3, 25.0), (1, 64.0)]

Requested FID 0 (area 1.0) got 0 (area 1.0)

Requested FID 2 (area 4.0) got 3 (area 25.0)

Requested FID 3 (area 25.0) got 1 (area 64.0)

Requested FID 1 (area 64.0) got 2 (area 4.0)



Thanks,



Jon




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220622/7a203c7d/attachment-0001.htm>

From chaoli0394 at gmail.com  Sun Jun 26 18:08:52 2022
From: chaoli0394 at gmail.com (Chao Li)
Date: Mon, 27 Jun 2022 10:08:52 +0900
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
Message-ID: <CADrR-ja4qAqNe+Jmj0TWHrxrn3KL+4kQe6ewkzhiJYA005Cmkg@mail.gmail.com>

Dear GDAL experts,

I have a problem using *gdalwarp*.

I want to reproject a raster and change its resolution by the average
method.

This is the *gdalinfo* of the raster

[q70176a at ito-2 ~]$ gdalinfo
 DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
                                                      Driver: GTiff/GeoTIFF
Files:
DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
Size is 86400, 31200
Coordinate System is:
PROJCRS["unknown",
    BASEGEOGCRS["unknown",
        DATUM["unknown",
            ELLIPSOID["unknown",6371007.181,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CONVERSION["Sinusoidal",
        METHOD["Sinusoidal"],
        PARAMETER["Longitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]
Data axis to CRS axis mapping: 1,2
Origin = (-20015109.353999998420477,7783653.637667000293732)
Pixel Size = (463.312716527771215,-463.312716527787586)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
  NoData Value=32767

This is the *gdalwarp* commend:

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite
DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

I also tried

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite
DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

However, the 32767 is not set to be nodata, and be averaged in the output
raster.

How can I set this?

Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288.
If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run
together?

Since there nothing returns, I really do not know.

Best regards.

-- 
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com
-------------------------------------------------------------------------------------
???? ????
???? ??? ??? ????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/562dcc37/attachment.htm>

From andrew at aitchison.me.uk  Sun Jun 26 20:44:10 2022
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 27 Jun 2022 04:44:10 +0100 (BST)
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
In-Reply-To: <CADrR-ja4qAqNe+Jmj0TWHrxrn3KL+4kQe6ewkzhiJYA005Cmkg@mail.gmail.com>
References: <CADrR-ja4qAqNe+Jmj0TWHrxrn3KL+4kQe6ewkzhiJYA005Cmkg@mail.gmail.com>
Message-ID: <f0519bdc-a134-e1a1-1f17-4d84c72fb6a6@aitchison.me.uk>

On Mon, 27 Jun 2022, Chao Li wrote:

> Dear GDAL experts,
>
> I have a problem using *gdalwarp*.
>
> I want to reproject a raster and change its resolution by the average
> method.
     ...       ...
> This is the *gdalinfo* of the raster
> Corner Coordinates:
> Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
> Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
> Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
> Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
> Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)

Is your input really a triangle ?

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From jukka.rahkonen at maanmittauslaitos.fi  Sun Jun 26 22:52:01 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 27 Jun 2022 05:52:01 +0000
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
Message-ID: <AM0PR09MB3219279BABD2FD0A4962270CFDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

The right syntax is average -srcnodata 32767 but you should not need to use it at all because GDAL recognizes nodata from your input automatically as you can see from the gdalinfo report. Could you clip and share a small sample from your source data so that some nodata is included? You can use gdal_translate with -srswin or -projwin for that.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Chao Li
L?hetetty: maanantai 27. kes?kuuta 2022 4.09
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear GDAL experts,

I have a problem using gdalwarp.

I want to reproject a raster and change its resolution by the average method.

This is the gdalinfo of the raster

[q70176a at ito-2 ~]$ gdalinfo  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif                                                       Driver: GTiff/GeoTIFF
Files: DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
Size is 86400, 31200
Coordinate System is:
PROJCRS["unknown",
    BASEGEOGCRS["unknown",
        DATUM["unknown",
            ELLIPSOID["unknown",6371007.181,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CONVERSION["Sinusoidal",
        METHOD["Sinusoidal"],
        PARAMETER["Longitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]
Data axis to CRS axis mapping: 1,2
Origin = (-20015109.353999998420477,7783653.637667000293732)
Pixel Size = (463.312716527771215,-463.312716527787586)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
  NoData Value=32767

This is the gdalwarp commend:

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

I also tried

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

However, the 32767 is not set to be nodata, and be averaged in the output raster.

How can I set this?

Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288. If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run together?

Since there nothing returns, I really do not know.

Best regards.

--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/b6d107f6/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 27 01:17:31 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 27 Jun 2022 08:17:31 +0000
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
Message-ID: <AM0PR09MB3219CFC9681D88D881D5DB80FDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

It seems to work for me with GDAL 3.6.0dev on Windows.

gdalwarp -t_srs EPSG:4326 -r average -ot float64 -multi MOD17A2H_GPP_2020_001.tif mod64m.tif
Creating output file that is 2969P x 2572L.
Processing MOD17A2H_GPP_2020_001.tif [1/1] : 0Using internal nodata values (e.g. 32767) for image MOD17A2H_GPP_2020_001.tif.
Copying nodata values from source MOD17A2H_GPP_2020_001.tif to destination mod64m.tif.
...10...20...30...40...50...60...70...80...90...100 - done.

gdalinfo mod64m.tif
Driver: GTiff/GeoTIFF
Files: mod64m.tif
Size is 2969, 2572
Coordinate System is:
GEOGCRS["WGS 84",
?
Band 1 Block=2969x1 Type=Float64, ColorInterp=Gray
  NoData Value=32767

I don?t know why nodata is lost for you. Have you already tried to set the output nodata explicitly with -dstnodata 32767 as a workaround?

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com>
L?hetetty: maanantai 27. kes?kuuta 2022 10.50
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear Ms./Mr. Jukka

Thank you for your reply. I try to delete the  -srcnodata 32767, but it still doesn't work.

I have attach a part of raster, in this email.

Thanks for your help

Best regards

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> ?2022?6?27??? 14:52???
Hi,

The right syntax is average -srcnodata 32767 but you should not need to use it at all because GDAL recognizes nodata from your input automatically as you can see from the gdalinfo report. Could you clip and share a small sample from your source data so that some nodata is included? You can use gdal_translate with -srswin or -projwin for that.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Chao Li
L?hetetty: maanantai 27. kes?kuuta 2022 4.09
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear GDAL experts,

I have a problem using gdalwarp.

I want to reproject a raster and change its resolution by the average method.

This is the gdalinfo of the raster

[q70176a at ito-2 ~]$ gdalinfo  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif                                                       Driver: GTiff/GeoTIFF
Files: DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
Size is 86400, 31200
Coordinate System is:
PROJCRS["unknown",
    BASEGEOGCRS["unknown",
        DATUM["unknown",
            ELLIPSOID["unknown",6371007.181,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CONVERSION["Sinusoidal",
        METHOD["Sinusoidal"],
        PARAMETER["Longitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]
Data axis to CRS axis mapping: 1,2
Origin = (-20015109.353999998420477,7783653.637667000293732)
Pixel Size = (463.312716527771215,-463.312716527787586)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
  NoData Value=32767

This is the gdalwarp commend:

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

I also tried

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

However, the 32767 is not set to be nodata, and be averaged in the output raster.

How can I set this?

Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288. If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run together?

Since there nothing returns, I really do not know.

Best regards.

--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------


--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/3e1b6e48/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 27 02:14:25 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 27 Jun 2022 09:14:25 +0000
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
Message-ID: <AM0PR09MB3219AAC05E23D9B5EC0F69DDFDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Please send answers as reply-to-all so they will go also to the gdal-dev mailing list.

There is something odd in the source data. As you can see from the attached image there are pixels which are close to the nodata 32767 but not exactly. Huge areas have value 32766 but here and there I can also see values 32765, 32762 etc.  The point in the image is at EPSG:4326 97.30902,5.18109.
I think that the source data that you clipped for the test is somehow corrupted. Could you check if you can find similar pixel values from the original image? The sample is LZW compressed but could it be that at some moment the image has been compressed with JPEG or some other lossy method?

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com>
L?hetetty: maanantai 27. kes?kuuta 2022 11.29
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Hi,

Now, seemingly, it works. I am also able to get output raster, but once you visualize this raster you will find that the boundaries between value and nodata zones are abnormal. There might be over 20,000.

However the valid values are no more than 1000. That?s my problem.

Could please check whether you have the same problem?

Thank you.

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>?2022?6?27? ??17:17???
Hi,

It seems to work for me with GDAL 3.6.0dev on Windows.

gdalwarp -t_srs EPSG:4326 -r average -ot float64 -multi MOD17A2H_GPP_2020_001.tif mod64m.tif
Creating output file that is 2969P x 2572L.
Processing MOD17A2H_GPP_2020_001.tif [1/1] : 0Using internal nodata values (e.g. 32767) for image MOD17A2H_GPP_2020_001.tif.
Copying nodata values from source MOD17A2H_GPP_2020_001.tif to destination mod64m.tif.
...10...20...30...40...50...60...70...80...90...100 - done.

gdalinfo mod64m.tif
Driver: GTiff/GeoTIFF
Files: mod64m.tif
Size is 2969, 2572
Coordinate System is:
GEOGCRS["WGS 84",
?
Band 1 Block=2969x1 Type=Float64, ColorInterp=Gray
  NoData Value=32767
I don?t know why nodata is lost for you. Have you already tried to set the output nodata explicitly with -dstnodata 32767 as a workaround?

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>>
L?hetetty: maanantai 27. kes?kuuta 2022 10.50
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear Ms./Mr. Jukka

Thank you for your reply. I try to delete the  -srcnodata 32767, but it still doesn't work.

I have attach a part of raster, in this email.

Thanks for your help

Best regards

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> ?2022?6?27??? 14:52???
Hi,

The right syntax is average -srcnodata 32767 but you should not need to use it at all because GDAL recognizes nodata from your input automatically as you can see from the gdalinfo report. Could you clip and share a small sample from your source data so that some nodata is included? You can use gdal_translate with -srswin or -projwin for that.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Chao Li
L?hetetty: maanantai 27. kes?kuuta 2022 4.09
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear GDAL experts,

I have a problem using gdalwarp.

I want to reproject a raster and change its resolution by the average method.

This is the gdalinfo of the raster

[q70176a at ito-2 ~]$ gdalinfo  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif                                                       Driver: GTiff/GeoTIFF
Files: DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
Size is 86400, 31200
Coordinate System is:
PROJCRS["unknown",
    BASEGEOGCRS["unknown",
        DATUM["unknown",
            ELLIPSOID["unknown",6371007.181,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CONVERSION["Sinusoidal",
        METHOD["Sinusoidal"],
        PARAMETER["Longitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]
Data axis to CRS axis mapping: 1,2
Origin = (-20015109.353999998420477,7783653.637667000293732)
Pixel Size = (463.312716527771215,-463.312716527787586)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
  NoData Value=32767

This is the gdalwarp commend:

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

I also tried

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

However, the 32767 is not set to be nodata, and be averaged in the output raster.

How can I set this?

Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288. If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run together?

Since there nothing returns, I really do not know.

Best regards.

--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------


--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/b39e1e80/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Almost_nodata.png
Type: image/png
Size: 18095 bytes
Desc: Almost_nodata.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/b39e1e80/attachment-0001.png>

From chaoli0394 at gmail.com  Mon Jun 27 03:55:20 2022
From: chaoli0394 at gmail.com (Chao Li)
Date: Mon, 27 Jun 2022 19:55:20 +0900
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
In-Reply-To: <AM0PR09MB3219AAC05E23D9B5EC0F69DDFDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB3219AAC05E23D9B5EC0F69DDFDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CADrR-jZVxGME6S_iyWZGM+4AYobevajaauL2at7z6jbDzanUyQ@mail.gmail.com>

Hi,

You are right but when I try to check the data processing, there is no any
compression. On my computer, it is similar to your situation. I guess most
nodata values are over 32760, so maybe I can list all of them.

-srcnodata <32760 32761 32762 32763 32764 32765 32766 32767>. Is this the
right way?

Thank you.

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 18:14???

> Hi,
>
>
>
> Please send answers as reply-to-all so they will go also to the gdal-dev
> mailing list.
>
>
>
> There is something odd in the source data. As you can see from the
> attached image there are pixels which are close to the nodata 32767 but
> not exactly. Huge areas have value 32766 but here and there I can also see
> values 32765, 32762 etc.  The point in the image is at EPSG:4326
> 97.30902,5.18109.
>
> I think that the source data that you clipped for the test is somehow
> corrupted. Could you check if you can find similar pixel values from the
> original image? The sample is LZW compressed but could it be that at some
> moment the image has been compressed with JPEG or some other lossy method?
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 11.29
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Hi,
>
>
>
> Now, seemingly, it works. I am also able to get output raster, but once
> you visualize this raster you will find that the boundaries between value
> and nodata zones are abnormal. There might be over 20,000.
>
>
>
> However the valid values are no more than 1000. That?s my problem.
>
>
>
> Could please check whether you have the same problem?
>
>
>
> Thank you.
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>?2022?6?27? ??17:17???
>
> Hi,
>
>
>
> It seems to work for me with GDAL 3.6.0dev on Windows.
>
>
>
> gdalwarp -t_srs EPSG:4326 -r average -ot float64 -multi
> MOD17A2H_GPP_2020_001.tif mod64m.tif
>
> Creating output file that is 2969P x 2572L.
>
> Processing MOD17A2H_GPP_2020_001.tif [1/1] : 0Using internal nodata values
> (e.g. 32767) for image MOD17A2H_GPP_2020_001.tif.
>
> Copying nodata values from source MOD17A2H_GPP_2020_001.tif to destination
> mod64m.tif.
>
> ...10...20...30...40...50...60...70...80...90...100 - done.
>
>
>
> gdalinfo mod64m.tif
>
> Driver: GTiff/GeoTIFF
>
> Files: mod64m.tif
>
> Size is 2969, 2572
>
> Coordinate System is:
>
> GEOGCRS["WGS 84",
>
> ?
> Band 1 Block=2969x1 Type=Float64, ColorInterp=Gray
>
>   NoData Value=32767
>
> I don?t know why nodata is lost for you. Have you already tried to set the
> output nodata explicitly with -dstnodata 32767 as a workaround?
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 10.50
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Dear Ms./Mr. Jukka
>
>
>
> Thank you for your reply. I try to delete the  -srcnodata 32767, but it
> still doesn't work.
>
>
>
> I have attach a part of raster, in this email.
>
>
>
> Thanks for your help
>
>
>
> Best regards
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 14:52
> ???
>
> Hi,
>
>
>
> The right syntax is average -srcnodata 32767 but you should not need to
> use it at all because GDAL recognizes nodata from your input automatically
> as you can see from the gdalinfo report. Could you clip and share a small
> sample from your source data so that some nodata is included? You can use
> gdal_translate with -srswin or -projwin for that.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Chao
> Li
> *L?hetetty:* maanantai 27. kes?kuuta 2022 4.09
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Dear GDAL experts,
>
>
>
> I have a problem using *gdalwarp*.
>
>
>
> I want to reproject a raster and change its resolution by the average
> method.
>
>
>
> This is the *gdalinfo* of the raster
>
>
>
> [q70176a at ito-2 ~]$ gdalinfo
>  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
>                                                       Driver: GTiff/GeoTIFF
> Files:
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> Size is 86400, 31200
> Coordinate System is:
> PROJCRS["unknown",
>     BASEGEOGCRS["unknown",
>         DATUM["unknown",
>             ELLIPSOID["unknown",6371007.181,0,
>                 LENGTHUNIT["metre",1,
>                     ID["EPSG",9001]]]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["degree",0.0174532925199433,
>                 ID["EPSG",9122]]]],
>     CONVERSION["Sinusoidal",
>         METHOD["Sinusoidal"],
>         PARAMETER["Longitude of natural origin",0,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8802]],
>         PARAMETER["False easting",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8806]],
>         PARAMETER["False northing",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8807]]],
>     CS[Cartesian,2],
>         AXIS["easting",east,
>             ORDER[1],
>             LENGTHUNIT["metre",1,
>                 ID["EPSG",9001]]],
>         AXIS["northing",north,
>             ORDER[2],
>             LENGTHUNIT["metre",1,
>                 ID["EPSG",9001]]]]
> Data axis to CRS axis mapping: 1,2
> Origin = (-20015109.353999998420477,7783653.637667000293732)
> Pixel Size = (463.312716527771215,-463.312716527787586)
> Metadata:
>   AREA_OR_POINT=Area
> Image Structure Metadata:
>   INTERLEAVE=BAND
> Corner Coordinates:
> Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
> Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
> Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
> Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
> Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
> Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
>   NoData Value=32767
>
>
>
> This is the *gdalwarp* commend:
>
>
>
> [q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
> 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif
>
>
>
> I also tried
>
>
>
> [q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
> 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif
>
>
>
> However, the 32767 is not set to be nodata, and be averaged in the output
> raster.
>
>
>
> How can I set this?
>
>
>
> Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288.
> If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run
> together?
>
>
>
> Since there nothing returns, I really do not know.
>
>
>
> Best regards.
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>


-- 
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com
-------------------------------------------------------------------------------------
???? ????
???? ??? ??? ????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/b12ba6c9/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 27 04:11:14 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 27 Jun 2022 11:11:14 +0000
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
Message-ID: <AM0PR09MB3219F3249CA98F60EF9D0CD3FDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Your idea is OK in theory but GeoTIFF supports only one nodata value. This is not relevant with your single band data, but it may be good to know that in GeoTIFF the nodata value is also the same for all bands. Therefore with GeoTIFF it is not possible to make for example blue 0 0 255 nodata in a RGB image even it could be handy because natural aerial and satellite images tend to have 0 0 0 and 255 255 255 also in the data pixels but not pure blue pixels.

A good solution would be to polygonise areas with pixel value >=32760 and create and add an alpha band or mask band into the image. An easier way is to update the raster with gdal_calc https://gdal.org/programs/gdal_calc.html and update all pixel values >=32760 into single value 32767.

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com>
L?hetetty: maanantai 27. kes?kuuta 2022 13.55
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Hi,

You are right but when I try to check the data processing, there is no any compression. On my computer, it is similar to your situation. I guess most nodata values are over 32760, so maybe I can list all of them.

-srcnodata <32760 32761 32762 32763 32764 32765 32766 32767>. Is this the right way?

Thank you.

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> ?2022?6?27??? 18:14???
Hi,

Please send answers as reply-to-all so they will go also to the gdal-dev mailing list.

There is something odd in the source data. As you can see from the attached image there are pixels which are close to the nodata 32767 but not exactly. Huge areas have value 32766 but here and there I can also see values 32765, 32762 etc.  The point in the image is at EPSG:4326 97.30902,5.18109.
I think that the source data that you clipped for the test is somehow corrupted. Could you check if you can find similar pixel values from the original image? The sample is LZW compressed but could it be that at some moment the image has been compressed with JPEG or some other lossy method?

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>>
L?hetetty: maanantai 27. kes?kuuta 2022 11.29
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Hi,

Now, seemingly, it works. I am also able to get output raster, but once you visualize this raster you will find that the boundaries between value and nodata zones are abnormal. There might be over 20,000.

However the valid values are no more than 1000. That?s my problem.

Could please check whether you have the same problem?

Thank you.

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>?2022?6?27? ??17:17???
Hi,

It seems to work for me with GDAL 3.6.0dev on Windows.

gdalwarp -t_srs EPSG:4326 -r average -ot float64 -multi MOD17A2H_GPP_2020_001.tif mod64m.tif
Creating output file that is 2969P x 2572L.
Processing MOD17A2H_GPP_2020_001.tif [1/1] : 0Using internal nodata values (e.g. 32767) for image MOD17A2H_GPP_2020_001.tif.
Copying nodata values from source MOD17A2H_GPP_2020_001.tif to destination mod64m.tif.
...10...20...30...40...50...60...70...80...90...100 - done.

gdalinfo mod64m.tif
Driver: GTiff/GeoTIFF
Files: mod64m.tif
Size is 2969, 2572
Coordinate System is:
GEOGCRS["WGS 84",
?
Band 1 Block=2969x1 Type=Float64, ColorInterp=Gray
  NoData Value=32767
I don?t know why nodata is lost for you. Have you already tried to set the output nodata explicitly with -dstnodata 32767 as a workaround?

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>>
L?hetetty: maanantai 27. kes?kuuta 2022 10.50
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear Ms./Mr. Jukka

Thank you for your reply. I try to delete the  -srcnodata 32767, but it still doesn't work.

I have attach a part of raster, in this email.

Thanks for your help

Best regards

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> ?2022?6?27??? 14:52???
Hi,

The right syntax is average -srcnodata 32767 but you should not need to use it at all because GDAL recognizes nodata from your input automatically as you can see from the gdalinfo report. Could you clip and share a small sample from your source data so that some nodata is included? You can use gdal_translate with -srswin or -projwin for that.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Chao Li
L?hetetty: maanantai 27. kes?kuuta 2022 4.09
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear GDAL experts,

I have a problem using gdalwarp.

I want to reproject a raster and change its resolution by the average method.

This is the gdalinfo of the raster

[q70176a at ito-2 ~]$ gdalinfo  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif                                                       Driver: GTiff/GeoTIFF
Files: DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
Size is 86400, 31200
Coordinate System is:
PROJCRS["unknown",
    BASEGEOGCRS["unknown",
        DATUM["unknown",
            ELLIPSOID["unknown",6371007.181,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CONVERSION["Sinusoidal",
        METHOD["Sinusoidal"],
        PARAMETER["Longitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]
Data axis to CRS axis mapping: 1,2
Origin = (-20015109.353999998420477,7783653.637667000293732)
Pixel Size = (463.312716527771215,-463.312716527787586)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
  NoData Value=32767

This is the gdalwarp commend:

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

I also tried

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

However, the 32767 is not set to be nodata, and be averaged in the output raster.

How can I set this?

Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288. If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run together?

Since there nothing returns, I really do not know.

Best regards.

--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------


--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------


--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/e672be1a/attachment-0001.htm>

From even.rouault at spatialys.com  Mon Jun 27 04:35:55 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 27 Jun 2022 13:35:55 +0200
Subject: [gdal-dev] GDAL 3.5.1 RC1 available
Message-ID: <5c5af6b8-6004-8c1d-7b55-ac0738da5c1e@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.5.1 release candidate.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.5.1/gdal-3.5.1rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.5.1/gdal-3.5.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.5.1/gdal351rc1.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.5.1/gdalautotest-3.5.1rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.5.1/gdalautotest-3.5.1rc1.zip

The NEWS file is here :

 ? https://github.com/OSGeo/gdal/blob/v3.5.1RC1/NEWS.md

I'll call for a vote promoting it to final later next week if no
serious problems are reported before.

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From varskann1993 at gmail.com  Mon Jun 27 05:21:43 2022
From: varskann1993 at gmail.com (Kanishk Varshney)
Date: Mon, 27 Jun 2022 17:51:43 +0530
Subject: [gdal-dev] Fwd: Creating MBTiles with transparent background from
 GeoTIFF
In-Reply-To: <CAM18NOGM4PTCgCkCs80YesRQc47Ed1Wogzu1GMLyw+EP19RENw@mail.gmail.com>
References: <CAM18NOGM4PTCgCkCs80YesRQc47Ed1Wogzu1GMLyw+EP19RENw@mail.gmail.com>
Message-ID: <CAM18NOFz78vkvEvc_UyyjgeYiWozRCVC3o7KCE1gewkvC8fsXw@mail.gmail.com>

Hey all,

I am stuck with MBTiles creation from GeoTIFF files that have a black
background (RGB: 0,0,0).

In QGIS, I am able to generate MBTiles via the following steps:

   - Set Transparency pixel (0 0 0) to get a geotiff with transparent
   background
   - Use Generate XYZ tiles (MBTiles) tool to generate the MBTiles for the
   above generated geotiff.

I want to automate the workflow using python, but not able to achieve great
success.

The following commands are used:

gdal_translate -tr 0.035 0.035 -a_nodata none -of MBTILES file1.tif
file1.mbtiles


gdaladdo -r nearest file1.mbtiles 2 4 8 16


This results in following issues:

1. The generated mbtiles don't have all the resolutions that manually
generated MBTiles have

2. Background is still black, which is a big concern for my usecase


Any help or alternative would be appreciated. Attaching a sample
Geotiff for reference


 sample_geotiff.tif
<https://drive.google.com/file/d/1HJaw59FVEwG_9sEN8bvfeRw1GrawGnUb/view?usp=drive_web>


Thanks,

Kanishk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/94dd2061/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 27 06:22:31 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Mon, 27 Jun 2022 13:22:31 +0000
Subject: [gdal-dev] Fwd: Creating MBTiles with transparent background
 from GeoTIFF
Message-ID: <AM0PR09MB3219C0A2DB42F4E6F6CF2495FDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

Your original image does not have nodata:
gdalinfo sample_geotiff.tif
...
Band 1 Block=8889x1 Type=Byte, ColorInterp=Red
Band 2 Block=8889x1 Type=Byte, ColorInterp=Green
Band 3 Block=8889x1 Type=Byte, ColorInterp=Blue

MBTiles driver does not support transparency with nodata but with alpha https://gdal.org/drivers/raster/mbtiles.html

One possible workflow:
Convert RGB 0 0 0 pixels into alpha with gdalwarp

gdalwarp -srcnodata 0 -dstalpha sample_geotiff.tif sample_with_alpha.tif

Convert this input with alpha into MBTiles

gdal_translate -tr 0.035 0.035 -of MBTILES sample_with_alpha.tif file1.mbtiles

I guess there are other ways to get a desired result, I stopped experimenting when this seemed to work.

-Jukka Rahkonen-



L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Kanishk Varshney
L?hetetty: maanantai 27. kes?kuuta 2022 15.22
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Fwd: Creating MBTiles with transparent background from GeoTIFF


Hey all,

I am stuck with MBTiles creation from GeoTIFF files that have a black background (RGB: 0,0,0).

In QGIS, I am able to generate MBTiles via the following steps:

  *   Set Transparency pixel (0 0 0) to get a geotiff with transparent background
  *   Use Generate XYZ tiles (MBTiles) tool to generate the MBTiles for the above generated geotiff.
I want to automate the workflow using python, but not able to achieve great success.

The following commands are used:

gdal_translate -tr 0.035 0.035 -a_nodata none -of MBTILES file1.tif file1.mbtiles



gdaladdo -r nearest file1.mbtiles 2 4 8 16



This results in following issues:

1. The generated mbtiles don't have all the resolutions that manually generated MBTiles have

2. Background is still black, which is a big concern for my usecase



Any help or alternative would be appreciated. Attaching a sample Geotiff for reference



[https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png] sample_geotiff.tif<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdrive.google.com%2Ffile%2Fd%2F1HJaw59FVEwG_9sEN8bvfeRw1GrawGnUb%2Fview%3Fusp%3Ddrive_web&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7Cf59902129f0d4022d41208da5837ad09%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C1%7C637919293399292802%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000%7C%7C%7C&sdata=hmfLGGUvB05Rl34jbgA%2F6SiI%2BTdImGhVUK%2FEHxGV8d0%3D&reserved=0>





Thanks,

Kanishk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220627/4363377f/attachment-0001.htm>

From chaoli0394 at gmail.com  Mon Jun 27 16:58:04 2022
From: chaoli0394 at gmail.com (Chao Li)
Date: Tue, 28 Jun 2022 08:58:04 +0900
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
In-Reply-To: <AM0PR09MB3219F3249CA98F60EF9D0CD3FDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB3219F3249CA98F60EF9D0CD3FDB99@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CADrR-jawNzO6iN9Hyx6QcgVfhy3GoZ7j8gaF1wB4JqxBreokkg@mail.gmail.com>

Hi,

I read the gdalwarp synopsis: https://gdal.org/programs/gdalwarp.html

I find the multi values can be used, but it has to write in -srcnodata
"32760 32761 32762 32763 32764 32765 32766 32767".

However, it does not work. Does anyone know how to figure it out?

 Thanks

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 20:11???

> Hi,
>
>
>
> Your idea is OK in theory but GeoTIFF supports only one nodata value. This
> is not relevant with your single band data, but it may be good to know that
> in GeoTIFF the nodata value is also the same for all bands. Therefore with
> GeoTIFF it is not possible to make for example blue 0 0 255 nodata in a RGB
> image even it could be handy because natural aerial and satellite images
> tend to have 0 0 0 and 255 255 255 also in the data pixels but not pure
> blue pixels.
>
>
>
> A good solution would be to polygonise areas with pixel value >=32760 and
> create and add an alpha band or mask band into the image. An easier way is
> to update the raster with gdal_calc
> https://gdal.org/programs/gdal_calc.html and update all pixel values
> >=32760 into single value 32767.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 13.55
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Hi,
>
>
>
> You are right but when I try to check the data processing, there is no any
> compression. On my computer, it is similar to your situation. I guess most
> nodata values are over 32760, so maybe I can list all of them.
>
>
>
> -srcnodata <32760 32761 32762 32763 32764 32765 32766 32767>. Is this the
> right way?
>
>
>
> Thank you.
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 18:14
> ???
>
> Hi,
>
>
>
> Please send answers as reply-to-all so they will go also to the gdal-dev
> mailing list.
>
>
>
> There is something odd in the source data. As you can see from the
> attached image there are pixels which are close to the nodata 32767 but not
> exactly. Huge areas have value 32766 but here and there I can also see
> values 32765, 32762 etc.  The point in the image is at EPSG:4326
> 97.30902,5.18109.
>
> I think that the source data that you clipped for the test is somehow
> corrupted. Could you check if you can find similar pixel values from the
> original image? The sample is LZW compressed but could it be that at some
> moment the image has been compressed with JPEG or some other lossy method?
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 11.29
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Hi,
>
>
>
> Now, seemingly, it works. I am also able to get output raster, but once
> you visualize this raster you will find that the boundaries between value
> and nodata zones are abnormal. There might be over 20,000.
>
>
>
> However the valid values are no more than 1000. That?s my problem.
>
>
>
> Could please check whether you have the same problem?
>
>
>
> Thank you.
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>?2022?6?27? ??17:17???
>
> Hi,
>
>
>
> It seems to work for me with GDAL 3.6.0dev on Windows.
>
>
>
> gdalwarp -t_srs EPSG:4326 -r average -ot float64 -multi
> MOD17A2H_GPP_2020_001.tif mod64m.tif
>
> Creating output file that is 2969P x 2572L.
>
> Processing MOD17A2H_GPP_2020_001.tif [1/1] : 0Using internal nodata values
> (e.g. 32767) for image MOD17A2H_GPP_2020_001.tif.
>
> Copying nodata values from source MOD17A2H_GPP_2020_001.tif to destination
> mod64m.tif.
>
> ...10...20...30...40...50...60...70...80...90...100 - done.
>
>
>
> gdalinfo mod64m.tif
>
> Driver: GTiff/GeoTIFF
>
> Files: mod64m.tif
>
> Size is 2969, 2572
>
> Coordinate System is:
>
> GEOGCRS["WGS 84",
>
> ?
> Band 1 Block=2969x1 Type=Float64, ColorInterp=Gray
>
>   NoData Value=32767
>
> I don?t know why nodata is lost for you. Have you already tried to set the
> output nodata explicitly with -dstnodata 32767 as a workaround?
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 10.50
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Dear Ms./Mr. Jukka
>
>
>
> Thank you for your reply. I try to delete the  -srcnodata 32767, but it
> still doesn't work.
>
>
>
> I have attach a part of raster, in this email.
>
>
>
> Thanks for your help
>
>
>
> Best regards
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 14:52
> ???
>
> Hi,
>
>
>
> The right syntax is average -srcnodata 32767 but you should not need to
> use it at all because GDAL recognizes nodata from your input automatically
> as you can see from the gdalinfo report. Could you clip and share a small
> sample from your source data so that some nodata is included? You can use
> gdal_translate with -srswin or -projwin for that.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Chao
> Li
> *L?hetetty:* maanantai 27. kes?kuuta 2022 4.09
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Dear GDAL experts,
>
>
>
> I have a problem using *gdalwarp*.
>
>
>
> I want to reproject a raster and change its resolution by the average
> method.
>
>
>
> This is the *gdalinfo* of the raster
>
>
>
> [q70176a at ito-2 ~]$ gdalinfo
>  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
>                                                       Driver: GTiff/GeoTIFF
> Files:
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> Size is 86400, 31200
> Coordinate System is:
> PROJCRS["unknown",
>     BASEGEOGCRS["unknown",
>         DATUM["unknown",
>             ELLIPSOID["unknown",6371007.181,0,
>                 LENGTHUNIT["metre",1,
>                     ID["EPSG",9001]]]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["degree",0.0174532925199433,
>                 ID["EPSG",9122]]]],
>     CONVERSION["Sinusoidal",
>         METHOD["Sinusoidal"],
>         PARAMETER["Longitude of natural origin",0,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8802]],
>         PARAMETER["False easting",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8806]],
>         PARAMETER["False northing",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8807]]],
>     CS[Cartesian,2],
>         AXIS["easting",east,
>             ORDER[1],
>             LENGTHUNIT["metre",1,
>                 ID["EPSG",9001]]],
>         AXIS["northing",north,
>             ORDER[2],
>             LENGTHUNIT["metre",1,
>                 ID["EPSG",9001]]]]
> Data axis to CRS axis mapping: 1,2
> Origin = (-20015109.353999998420477,7783653.637667000293732)
> Pixel Size = (463.312716527771215,-463.312716527787586)
> Metadata:
>   AREA_OR_POINT=Area
> Image Structure Metadata:
>   INTERLEAVE=BAND
> Corner Coordinates:
> Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
> Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
> Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
> Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
> Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
> Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
>   NoData Value=32767
>
>
>
> This is the *gdalwarp* commend:
>
>
>
> [q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
> 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif
>
>
>
> I also tried
>
>
>
> [q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
> 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif
>
>
>
> However, the 32767 is not set to be nodata, and be averaged in the output
> raster.
>
>
>
> How can I set this?
>
>
>
> Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288.
> If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run
> together?
>
>
>
> Since there nothing returns, I really do not know.
>
>
>
> Best regards.
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>


-- 
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com
-------------------------------------------------------------------------------------
???? ????
???? ??? ??? ????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/12857065/attachment-0001.htm>

From nik at nixanz.com  Mon Jun 27 18:19:48 2022
From: nik at nixanz.com (Nik Sands)
Date: Tue, 28 Jun 2022 11:19:48 +1000
Subject: [gdal-dev] building on macOS - fatal error: 'direct.h' file not
 found
Message-ID: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>

Hi GDAL devs,

Since I last built GDAL (2.2.2), cmake has been introduced and it appears as though it is going to be the only option going forward.  So I?m attempting to use cmake to build GDAL 3.5.0 on macOS 12.4 ('Monterey?).  I?ve installed cmake using the ?homebrew? macOS package manager.

However, I?m getting numerous build errors, starting with the following error when running cmake to build GDAL 3.5.0:

	fatal error: 'direct.h' file not found

(a little more context from the error log is included at the end, below)

I?m attempting to build GDAL as follows:

export LDFLAGS=-L/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib
export CFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
export CCFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
export CXXFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
export CPPFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
cd gdal-3.5.0
mkdir build
cd build
cmake -DPROJ_ROOT=~/build -DSQLITE3_INCLUDE_DIR=~/build/include -DSQLITE3_LIBRARY=~/build/lib/libsqlite3.a .. -DCMAKE_INSTALL_PREFIX=~/build -DCMAKE_BUILD_TYPE=Release ..

I?m a hobbyist and not a professional developer, so my understanding of these things is quite limited.  However, my research so far indicates that ?direct.h? is a Windows-specific header file and therefore perhaps cmake has not been configured correctly for macOS in this GDAL distribution?

Is it possible to build GDAL using cmake on macOS?  If so, how to I deal with this error?

I can supply the entire CMakeError.log file if that would help (as an attachement, or copy/pasted as text in an email).

Cheers,
Nik.

Snippet from CMakeError.log:
------------------------------

Source file was:
 int main() { return 0; }
Determining if the include file direct.h exists failed with the following output:
Change Dir: /Users/nsands/Documents/Development/3rdParty/GDAL3/gdal-3.5.0/build/CMakeFiles/CMakeTmp

Run Build Command(s):/usr/bin/make -f Makefile cmTC_190db/fast && /Applications/Xcode.app/Contents/Developer/usr/bin/make  -f CMakeFiles/cmTC_190db.dir/build.make CMakeFiles/cmTC_190db.dir/build
Building C object CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc   -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk    -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX12.3.sdk -std=gnu99 -MD -MT CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o -MF CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o.d -o CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o -c /Users/nsands/Documents/Development/3rdParty/GDAL3/gdal-3.5.0/build/CMakeFiles/CMakeTmp/CheckIncludeFile.c
/Users/nsands/Documents/Development/3rdParty/GDAL3/gdal-3.5.0/build/CMakeFiles/CMakeTmp/CheckIncludeFile.c:1:10: fatal error: 'direct.h' file not found
#include <direct.h>
         ^~~~~~~~~~
1 error generated.
make[1]: *** [CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o] Error 1
make: *** [cmTC_190db/fast] Error 2

------------------------------


========================================================
NIK SANDS
Line Tamer | Time Traveller | Space Cadet


From chaoli0394 at gmail.com  Mon Jun 27 20:18:47 2022
From: chaoli0394 at gmail.com (Chao Li)
Date: Tue, 28 Jun 2022 12:18:47 +0900
Subject: [gdal-dev] gdal_calc.py Does Not Work on Mac
Message-ID: <CADrR-jZj8-JAbmiDzYutwjm2ko8ieighDHnZrkFkMEcte2-ybg@mail.gmail.com>

Hi,

I meet a problem when I use gdal_calc.py on mac:

(base) lichao at riushios-MacBook-Pro ~ % gdal_calc.py

Traceback (most recent call last):

  File
"/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py",
line 29, in swig_import_helper

    return importlib.import_module(mname)

  File "/Users/lichao/opt/anaconda3/lib/python3.9/importlib/__init__.py",
line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

  File "<frozen importlib._bootstrap>", line 1030, in _gcd_import

  File "<frozen importlib._bootstrap>", line 1007, in _find_and_load

  File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked

  File "<frozen importlib._bootstrap>", line 666, in _load_unlocked

  File "<frozen importlib._bootstrap>", line 565, in module_from_spec

  File "<frozen importlib._bootstrap_external>", line 1173, in create_module

  File "<frozen importlib._bootstrap>", line 228, in
_call_with_frames_removed

ImportError:
dlopen(/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/_
gdal.cpython-39-darwin.so, 0x0002): Library not loaded:
@rpath/libpoppler.91.dylib

  Referenced from: /Users/lichao/opt/anaconda3/lib/libgdal.30.dylib

  Reason: tried: '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such
file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such
file),
'/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/../../../libpoppler.91.dylib'
(no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such
file),
'/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/../../../libpoppler.91.dylib'
(no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
such file), '/Users/lichao/opt/anaconda3/bin/../lib/libpoppler.91.dylib'
(no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
such file), '/Users/lichao/opt/anaconda3/bin/../lib/libpoppler.91.dylib'
(no such file), '/usr/local/lib/libpoppler.91.dylib' (no such file),
'/usr/lib/libpoppler.91.dylib' (no such file)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/lichao/opt/anaconda3/bin/gdal_calc.py", line 4, in <module>

    __import__('pkg_resources').run_script('GDAL==3.4.1', 'gdal_calc.py')

  File
"/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/pkg_resources/__init__.py",
line 662, in run_script

    self.require(requires)[0].run_script(script_name, ns)

  File
"/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/pkg_resources/__init__.py",
line 1459, in run_script

    exec(code, namespace, namespace)

  File
"/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/GDAL-3.4.1-py3.9-macosx-10.9-x86_64.egg-info/scripts/gdal_calc.py",
line 5, in <module>

    from osgeo_utils.gdal_calc import *  # noqa

  File
"/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo_utils/gdal_calc.py",
line 46, in <module>

    from osgeo import gdal

  File
"/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py",
line 45, in <module>

    _gdal = swig_import_helper()

  File
"/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py",
line 42, in swig_import_helper

    return importlib.import_module('_gdal')

  File "/Users/lichao/opt/anaconda3/lib/python3.9/importlib/__init__.py",
line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

ModuleNotFoundError: No module named '_gdal'


(base) lichao at riushios-MacBook-Pro ~ % which gdal_calc.py

/Users/lichao/opt/anaconda3/bin/gdal_calc.py


(base) lichao at riushios-MacBook-Pro ~ % gdal-config --version

3.4.1


Thanks for your help.


Best

-- 
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com
-------------------------------------------------------------------------------------
???? ????
???? ??? ??? ????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/28e54f14/attachment-0001.htm>

From andreas.oxenstierna at t-kartor.com  Mon Jun 27 23:28:01 2022
From: andreas.oxenstierna at t-kartor.com (Andreas Oxenstierna)
Date: Tue, 28 Jun 2022 06:28:01 +0000
Subject: [gdal-dev] gdal_calc.py Does Not Work on Mac
In-Reply-To: <CADrR-jZj8-JAbmiDzYutwjm2ko8ieighDHnZrkFkMEcte2-ybg@mail.gmail.com>
References: <CADrR-jZj8-JAbmiDzYutwjm2ko8ieighDHnZrkFkMEcte2-ybg@mail.gmail.com>
Message-ID: <4fb328fc-5baf-4828-84a0-31ed5590ff24@Spark>

Hi

My gdal installation with brew, https://formulae.brew.sh/formula/gdal,  do work on macOS:
which gdal_calc.py
/usr/local/bin/gdal_calc.py

ls -l /usr/local/bin/gdal_calc*
/usr/local/bin/gdal_calc.py -> ../Cellar/gdal/3.3.2_3/bin/gdal_calc.py

Do you have to use Anaconda?

Best Regards

Andreas Oxenstierna
T-Kartor Geospatial AB
Olof Mohlins v?g 12 Kristianstad
mobile: +46 733 206831
mailto: andreas.oxenstierna at t-kartor.com<mailto:andreas.oxenstierna at t-kartor.com>
www.t-kartor.com<http://www.t-kartor.com>
On 28 Jun 2022, 05:19 +0200, Chao Li <chaoli0394 at gmail.com>, wrote:
Hi,

I meet a problem when I use gdal_calc.py on mac:


(base) lichao at riushios-MacBook-Pro ~ % gdal_calc.py

Traceback (most recent call last):

  File "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py", line 29, in swig_import_helper

    return importlib.import_module(mname)

  File "/Users/lichao/opt/anaconda3/lib/python3.9/importlib/__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

  File "<frozen importlib._bootstrap>", line 1030, in _gcd_import

  File "<frozen importlib._bootstrap>", line 1007, in _find_and_load

  File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked

  File "<frozen importlib._bootstrap>", line 666, in _load_unlocked

  File "<frozen importlib._bootstrap>", line 565, in module_from_spec

  File "<frozen importlib._bootstrap_external>", line 1173, in create_module

  File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed

ImportError: dlopen(/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/_gdal.cpython-39-darwin.so<http://gdal.cpython-39-darwin.so>, 0x0002): Library not loaded: @rpath/libpoppler.91.dylib

  Referenced from: /Users/lichao/opt/anaconda3/lib/libgdal.30.dylib

  Reason: tried: '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/../../../libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/../../../libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/bin/../lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such file), '/Users/lichao/opt/anaconda3/bin/../lib/libpoppler.91.dylib' (no such file), '/usr/local/lib/libpoppler.91.dylib' (no such file), '/usr/lib/libpoppler.91.dylib' (no such file)


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/lichao/opt/anaconda3/bin/gdal_calc.py", line 4, in <module>

    __import__('pkg_resources').run_script('GDAL==3.4.1', 'gdal_calc.py')

  File "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/pkg_resources/__init__.py", line 662, in run_script

    self.require(requires)[0].run_script(script_name, ns)

  File "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/pkg_resources/__init__.py", line 1459, in run_script

    exec(code, namespace, namespace)

  File "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/GDAL-3.4.1-py3.9-macosx-10.9-x86_64.egg-info/scripts/gdal_calc.py", line 5, in <module>

    from osgeo_utils.gdal_calc import *  # noqa

  File "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo_utils/gdal_calc.py", line 46, in <module>

    from osgeo import gdal

  File "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py", line 45, in <module>

    _gdal = swig_import_helper()

  File "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py", line 42, in swig_import_helper

    return importlib.import_module('_gdal')

  File "/Users/lichao/opt/anaconda3/lib/python3.9/importlib/__init__.py", line 127, in import_module

    return _bootstrap._gcd_import(name[level:], package, level)

ModuleNotFoundError: No module named '_gdal'


(base) lichao at riushios-MacBook-Pro ~ % which gdal_calc.py

/Users/lichao/opt/anaconda3/bin/gdal_calc.py


(base) lichao at riushios-MacBook-Pro ~ % gdal-config --version

3.4.1


Thanks for your help.


Best

--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/1df82440/attachment-0001.htm>

From chaoli0394 at gmail.com  Mon Jun 27 23:31:22 2022
From: chaoli0394 at gmail.com (Chao Li)
Date: Tue, 28 Jun 2022 15:31:22 +0900
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
In-Reply-To: <AM0PR09MB3219E928BA70ED464B0C2DBBFDB89@AM0PR09MB3219.eurprd09.prod.outlook.com>
References: <AM0PR09MB3219E928BA70ED464B0C2DBBFDB89@AM0PR09MB3219.eurprd09.prod.outlook.com>
Message-ID: <CADrR-jYJp_YbKwFb-M9GmOX-0YGx4kkmZM=35SkbOEzJgdz=BQ@mail.gmail.com>

Hi,

Thank you for your reply. I realized the issues. Thank you.

Li

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?28??? 15:27???

> Hi,
>
>
>
> You are reading the documentation optimistically. The -srsnodata does
> accept a list but the list can only be a one nodata value per band.
>
> ?Set nodata masking values for input bands (different values can be
> supplied for each band).? In the GDAL datamodel the nodata in rasterband is
> a single value https://gdal.org/api/gdalrasterband_cpp.html. In addition,
> all image formats do not support having a separate nodata value for each
> band. GeoTIFF for example is using the same one nodata value for all bands
> https://gdal.org/drivers/raster/gtiff.html ?GDAL stores band nodata value
> in the non standard TIFFTAG_GDAL_NODATA ASCII tag (code 42113) for files
> created with the default profile GDALGeoTIFF. Note that all bands must use
> the same nodata value.?
>
>
>
> There is a similar question in gis.stackexchange from couple of years ago
> https://gis.stackexchange.com/questions/380092/gdalwarp-assigning-more-than-one-nodata-value
> with an advice about how to update the raster with Python to have a single
> value for nodata.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* tiistai 28. kes?kuuta 2022 2.58
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Hi,
>
>
>
> I read the gdalwarp synopsis: https://gdal.org/programs/gdalwarp.html
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fprograms%2Fgdalwarp.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C7fbed8ed633f467be75a08da5898e96a%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637919711038387709%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=olfoXnii%2FhSi6RHqcF6c%2BCfM78eFEAeRG1hJNK2VSMA%3D&reserved=0>
>
>
>
>
> I find the multi values can be used, but it has to write in -srcnodata
> "32760 32761 32762 32763 32764 32765 32766 32767".
>
>
>
> However, it does not work. Does anyone know how to figure it out?
>
>
>
>  Thanks
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 20:11
> ???
>
> Hi,
>
>
>
> Your idea is OK in theory but GeoTIFF supports only one nodata value. This
> is not relevant with your single band data, but it may be good to know that
> in GeoTIFF the nodata value is also the same for all bands. Therefore with
> GeoTIFF it is not possible to make for example blue 0 0 255 nodata in a RGB
> image even it could be handy because natural aerial and satellite images
> tend to have 0 0 0 and 255 255 255 also in the data pixels but not pure
> blue pixels.
>
>
>
> A good solution would be to polygonise areas with pixel value >=32760 and
> create and add an alpha band or mask band into the image. An easier way is
> to update the raster with gdal_calc
> https://gdal.org/programs/gdal_calc.html
> <https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fprograms%2Fgdal_calc.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C7fbed8ed633f467be75a08da5898e96a%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637919711038387709%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=YQ0nkJ%2BQbbXSzsdNj7z6Bj2FOoU7v7KOeQqkeCWKH8E%3D&reserved=0>
> and update all pixel values >=32760 into single value 32767.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 13.55
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Hi,
>
>
>
> You are right but when I try to check the data processing, there is no any
> compression. On my computer, it is similar to your situation. I guess most
> nodata values are over 32760, so maybe I can list all of them.
>
>
>
> -srcnodata <32760 32761 32762 32763 32764 32765 32766 32767>. Is this the
> right way?
>
>
>
> Thank you.
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 18:14
> ???
>
> Hi,
>
>
>
> Please send answers as reply-to-all so they will go also to the gdal-dev
> mailing list.
>
>
>
> There is something odd in the source data. As you can see from the
> attached image there are pixels which are close to the nodata 32767 but not
> exactly. Huge areas have value 32766 but here and there I can also see
> values 32765, 32762 etc.  The point in the image is at EPSG:4326
> 97.30902,5.18109.
>
> I think that the source data that you clipped for the test is somehow
> corrupted. Could you check if you can find similar pixel values from the
> original image? The sample is LZW compressed but could it be that at some
> moment the image has been compressed with JPEG or some other lossy method?
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 11.29
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Hi,
>
>
>
> Now, seemingly, it works. I am also able to get output raster, but once
> you visualize this raster you will find that the boundaries between value
> and nodata zones are abnormal. There might be over 20,000.
>
>
>
> However the valid values are no more than 1000. That?s my problem.
>
>
>
> Could please check whether you have the same problem?
>
>
>
> Thank you.
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>?2022?6?27? ??17:17???
>
> Hi,
>
>
>
> It seems to work for me with GDAL 3.6.0dev on Windows.
>
>
>
> gdalwarp -t_srs EPSG:4326 -r average -ot float64 -multi
> MOD17A2H_GPP_2020_001.tif mod64m.tif
>
> Creating output file that is 2969P x 2572L.
>
> Processing MOD17A2H_GPP_2020_001.tif [1/1] : 0Using internal nodata values
> (e.g. 32767) for image MOD17A2H_GPP_2020_001.tif.
>
> Copying nodata values from source MOD17A2H_GPP_2020_001.tif to destination
> mod64m.tif.
>
> ...10...20...30...40...50...60...70...80...90...100 - done.
>
>
>
> gdalinfo mod64m.tif
>
> Driver: GTiff/GeoTIFF
>
> Files: mod64m.tif
>
> Size is 2969, 2572
>
> Coordinate System is:
>
> GEOGCRS["WGS 84",
>
> ?
> Band 1 Block=2969x1 Type=Float64, ColorInterp=Gray
>
>   NoData Value=32767
>
> I don?t know why nodata is lost for you. Have you already tried to set the
> output nodata explicitly with -dstnodata 32767 as a workaround?
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Chao Li <chaoli0394 at gmail.com>
> *L?hetetty:* maanantai 27. kes?kuuta 2022 10.50
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Aihe:* Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Dear Ms./Mr. Jukka
>
>
>
> Thank you for your reply. I try to delete the  -srcnodata 32767, but it
> still doesn't work.
>
>
>
> I have attach a part of raster, in this email.
>
>
>
> Thanks for your help
>
>
>
> Best regards
>
>
>
> Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi> ?2022?6?27??? 14:52
> ???
>
> Hi,
>
>
>
> The right syntax is average -srcnodata 32767 but you should not need to
> use it at all because GDAL recognizes nodata from your input automatically
> as you can see from the gdalinfo report. Could you clip and share a small
> sample from your source data so that some nodata is included? You can use
> gdal_translate with -srswin or -projwin for that.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Chao
> Li
> *L?hetetty:* maanantai 27. kes?kuuta 2022 4.09
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
>
>
>
> Dear GDAL experts,
>
>
>
> I have a problem using *gdalwarp*.
>
>
>
> I want to reproject a raster and change its resolution by the average
> method.
>
>
>
> This is the *gdalinfo* of the raster
>
>
>
> [q70176a at ito-2 ~]$ gdalinfo
>  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
>                                                       Driver: GTiff/GeoTIFF
> Files:
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> Size is 86400, 31200
> Coordinate System is:
> PROJCRS["unknown",
>     BASEGEOGCRS["unknown",
>         DATUM["unknown",
>             ELLIPSOID["unknown",6371007.181,0,
>                 LENGTHUNIT["metre",1,
>                     ID["EPSG",9001]]]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["degree",0.0174532925199433,
>                 ID["EPSG",9122]]]],
>     CONVERSION["Sinusoidal",
>         METHOD["Sinusoidal"],
>         PARAMETER["Longitude of natural origin",0,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8802]],
>         PARAMETER["False easting",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8806]],
>         PARAMETER["False northing",0,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8807]]],
>     CS[Cartesian,2],
>         AXIS["easting",east,
>             ORDER[1],
>             LENGTHUNIT["metre",1,
>                 ID["EPSG",9001]]],
>         AXIS["northing",north,
>             ORDER[2],
>             LENGTHUNIT["metre",1,
>                 ID["EPSG",9001]]]]
> Data axis to CRS axis mapping: 1,2
> Origin = (-20015109.353999998420477,7783653.637667000293732)
> Pixel Size = (463.312716527771215,-463.312716527787586)
> Metadata:
>   AREA_OR_POINT=Area
> Image Structure Metadata:
>   INTERLEAVE=BAND
> Corner Coordinates:
> Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
> Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
> Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
> Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
> Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
> Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
>   NoData Value=32767
>
>
>
> This is the *gdalwarp* commend:
>
>
>
> [q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
> 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif
>
>
>
> I also tried
>
>
>
> [q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1
> 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
> DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif
>
>
>
> However, the 32767 is not set to be nodata, and be averaged in the output
> raster.
>
>
>
> How can I set this?
>
>
>
> Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288.
> If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run
> together?
>
>
>
> Since there nothing returns, I really do not know.
>
>
>
> Best regards.
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>
>
>
>
> --
>
>
> ------------------------------------------------------------------------------------
>
> Mike Li
>
> Department of Urban and Environmental Engineering
>
> Graduate School of Engineering
>
> Kyushu University
>
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
>
> Tel: 090-8304-8953
>
> E-mail: chaoli0394 at gmail.com
>
>
> -------------------------------------------------------------------------------------
>
> ???? ????
>
> ???? ??? ??? ????????????
>
> ???????
>
>
> -------------------------------------------------------------------------------------
>


-- 
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com
-------------------------------------------------------------------------------------
???? ????
???? ??? ??? ????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/1a859f0a/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Jun 27 23:26:59 2022
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 28 Jun 2022 06:26:59 +0000
Subject: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting
Message-ID: <AM0PR09MB3219E928BA70ED464B0C2DBBFDB89@AM0PR09MB3219.eurprd09.prod.outlook.com>

Hi,

You are reading the documentation optimistically. The -srsnodata does accept a list but the list can only be a one nodata value per band.
?Set nodata masking values for input bands (different values can be supplied for each band).? In the GDAL datamodel the nodata in rasterband is a single value https://gdal.org/api/gdalrasterband_cpp.html. In addition, all image formats do not support having a separate nodata value for each band. GeoTIFF for example is using the same one nodata value for all bands https://gdal.org/drivers/raster/gtiff.html ?GDAL stores band nodata value in the non standard TIFFTAG_GDAL_NODATA ASCII tag (code 42113) for files created with the default profile GDALGeoTIFF. Note that all bands must use the same nodata value.?

There is a similar question in gis.stackexchange from couple of years ago https://gis.stackexchange.com/questions/380092/gdalwarp-assigning-more-than-one-nodata-value with an advice about how to update the raster with Python to have a single value for nodata.

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com>
L?hetetty: tiistai 28. kes?kuuta 2022 2.58
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Hi,

I read the gdalwarp synopsis: https://gdal.org/programs/gdalwarp.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fprograms%2Fgdalwarp.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C7fbed8ed633f467be75a08da5898e96a%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637919711038387709%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=olfoXnii%2FhSi6RHqcF6c%2BCfM78eFEAeRG1hJNK2VSMA%3D&reserved=0>

I find the multi values can be used, but it has to write in -srcnodata "32760 32761 32762 32763 32764 32765 32766 32767".

However, it does not work. Does anyone know how to figure it out?

 Thanks

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> ?2022?6?27??? 20:11???
Hi,

Your idea is OK in theory but GeoTIFF supports only one nodata value. This is not relevant with your single band data, but it may be good to know that in GeoTIFF the nodata value is also the same for all bands. Therefore with GeoTIFF it is not possible to make for example blue 0 0 255 nodata in a RGB image even it could be handy because natural aerial and satellite images tend to have 0 0 0 and 255 255 255 also in the data pixels but not pure blue pixels.

A good solution would be to polygonise areas with pixel value >=32760 and create and add an alpha band or mask band into the image. An easier way is to update the raster with gdal_calc https://gdal.org/programs/gdal_calc.html<https://eur06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgdal.org%2Fprograms%2Fgdal_calc.html&data=05%7C01%7Cjukka.rahkonen%40maanmittauslaitos.fi%7C7fbed8ed633f467be75a08da5898e96a%7Cc4f8a63255804a1c92371d5a571b71fa%7C0%7C0%7C637919711038387709%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=YQ0nkJ%2BQbbXSzsdNj7z6Bj2FOoU7v7KOeQqkeCWKH8E%3D&reserved=0> and update all pixel values >=32760 into single value 32767.

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>>
L?hetetty: maanantai 27. kes?kuuta 2022 13.55
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Hi,

You are right but when I try to check the data processing, there is no any compression. On my computer, it is similar to your situation. I guess most nodata values are over 32760, so maybe I can list all of them.

-srcnodata <32760 32761 32762 32763 32764 32765 32766 32767>. Is this the right way?

Thank you.

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> ?2022?6?27??? 18:14???
Hi,

Please send answers as reply-to-all so they will go also to the gdal-dev mailing list.

There is something odd in the source data. As you can see from the attached image there are pixels which are close to the nodata 32767 but not exactly. Huge areas have value 32766 but here and there I can also see values 32765, 32762 etc.  The point in the image is at EPSG:4326 97.30902,5.18109.
I think that the source data that you clipped for the test is somehow corrupted. Could you check if you can find similar pixel values from the original image? The sample is LZW compressed but could it be that at some moment the image has been compressed with JPEG or some other lossy method?

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>>
L?hetetty: maanantai 27. kes?kuuta 2022 11.29
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Hi,

Now, seemingly, it works. I am also able to get output raster, but once you visualize this raster you will find that the boundaries between value and nodata zones are abnormal. There might be over 20,000.

However the valid values are no more than 1000. That?s my problem.

Could please check whether you have the same problem?

Thank you.

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>?2022?6?27? ??17:17???
Hi,

It seems to work for me with GDAL 3.6.0dev on Windows.

gdalwarp -t_srs EPSG:4326 -r average -ot float64 -multi MOD17A2H_GPP_2020_001.tif mod64m.tif
Creating output file that is 2969P x 2572L.
Processing MOD17A2H_GPP_2020_001.tif [1/1] : 0Using internal nodata values (e.g. 32767) for image MOD17A2H_GPP_2020_001.tif.
Copying nodata values from source MOD17A2H_GPP_2020_001.tif to destination mod64m.tif.
...10...20...30...40...50...60...70...80...90...100 - done.

gdalinfo mod64m.tif
Driver: GTiff/GeoTIFF
Files: mod64m.tif
Size is 2969, 2572
Coordinate System is:
GEOGCRS["WGS 84",
?
Band 1 Block=2969x1 Type=Float64, ColorInterp=Gray
  NoData Value=32767
I don?t know why nodata is lost for you. Have you already tried to set the output nodata explicitly with -dstnodata 32767 as a workaround?

-Jukka Rahkonen-

L?hett?j?: Chao Li <chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>>
L?hetetty: maanantai 27. kes?kuuta 2022 10.50
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Aihe: Re: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear Ms./Mr. Jukka

Thank you for your reply. I try to delete the  -srcnodata 32767, but it still doesn't work.

I have attach a part of raster, in this email.

Thanks for your help

Best regards

Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> ?2022?6?27??? 14:52???
Hi,

The right syntax is average -srcnodata 32767 but you should not need to use it at all because GDAL recognizes nodata from your input automatically as you can see from the gdalinfo report. Could you clip and share a small sample from your source data so that some nodata is included? You can use gdal_translate with -srswin or -projwin for that.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Chao Li
L?hetetty: maanantai 27. kes?kuuta 2022 4.09
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] gdalwarp Resampling Input Raster Nodata Setting

Dear GDAL experts,

I have a problem using gdalwarp.

I want to reproject a raster and change its resolution by the average method.

This is the gdalinfo of the raster

[q70176a at ito-2 ~]$ gdalinfo  DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif                                                       Driver: GTiff/GeoTIFF
Files: DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif
Size is 86400, 31200
Coordinate System is:
PROJCRS["unknown",
    BASEGEOGCRS["unknown",
        DATUM["unknown",
            ELLIPSOID["unknown",6371007.181,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CONVERSION["Sinusoidal",
        METHOD["Sinusoidal"],
        PARAMETER["Longitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]
Data axis to CRS axis mapping: 1,2
Origin = (-20015109.353999998420477,7783653.637667000293732)
Pixel Size = (463.312716527771215,-463.312716527787586)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-20015109.354, 7783653.638) (166d17' 5.25"W, 70d 0' 0.00"N)
Lower Left  (-20015109.354,-6671703.118) (  0d 0' 0.00"E, 60d 0' 0.00"S)
Upper Right (20015109.354, 7783653.638) (166d17' 5.25"E, 70d 0' 0.00"N)
Lower Right (20015109.354,-6671703.118) (  0d 0' 0.00"W, 60d 0' 0.00"S)
Center      (      -0.000,  555975.260) (  0d 0' 0.00"W,  5d 0' 0.00"N)
Band 1 Block=86400x1 Type=Int16, ColorInterp=Gray
  NoData Value=32767

This is the gdalwarp commend:

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata "32767" -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

I also tried

[q70176a at ito-2 ~]$ gdalwarp -t_srs EPSG:4326 -te -180 -90 180  90 -tr 0.1 0.1 -ot Float64 -r average -srcnodata 32767 -multi -overwrite DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP/MOD17A2H_GPP_2016_001.tif DP12/11_RawData/02_GGP/Gross_PP_8Days_500m_v6/GPP_01_test/test2.tif

However, the 32767 is not set to be nodata, and be averaged in the output raster.

How can I set this?

Additionally, I am using a HPC with multinodes. With 8 nodes, I have 288. If I set -multi and -wo NUM_THREADS=val/ALL_CPUS, will all that 288 run together?

Since there nothing returns, I really do not know.

Best regards.

--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------


--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------


--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------


--
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com<mailto:chaoli0394 at gmail.com>
-------------------------------------------------------------------------------------
?????????
?????????????????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/74b9ae70/attachment-0001.htm>

From chaoli0394 at gmail.com  Tue Jun 28 00:11:58 2022
From: chaoli0394 at gmail.com (Chao Li)
Date: Tue, 28 Jun 2022 16:11:58 +0900
Subject: [gdal-dev] gdal_calc.py Does Not Work on Mac
In-Reply-To: <4fb328fc-5baf-4828-84a0-31ed5590ff24@Spark>
References: <CADrR-jZj8-JAbmiDzYutwjm2ko8ieighDHnZrkFkMEcte2-ybg@mail.gmail.com>
 <4fb328fc-5baf-4828-84a0-31ed5590ff24@Spark>
Message-ID: <CADrR-jYUQQg+qv1Dk=8B6fGS3o9sqiGr0E=omT3DJ=7n78iBQA@mail.gmail.com>

Hi,

"brew install gdal" does work. I did it before, the problem is that I
forget to add the PATH of gdal and the default PATH is to Anaconda.

Now, it works :D

Thank you.

Andreas Oxenstierna <andreas.oxenstierna at t-kartor.com> ?2022?6?28???
15:28???

> Hi
>
> My gdal installation with brew, https://formulae.brew.sh/formula/gdal,  do
> work on macOS:
> which gdal_calc.py
> /usr/local/bin/gdal_calc.py
>
> ls -l /usr/local/bin/gdal_calc*
> /usr/local/bin/gdal_calc.py -> ../Cellar/gdal/3.3.2_3/bin/gdal_calc.py
>
> Do you have to use Anaconda?
>
> Best Regards
>
> Andreas Oxenstierna
> T-Kartor Geospatial AB
> Olof Mohlins v?g 12 Kristianstad
> mobile: +46 733 206831
> mailto: andreas.oxenstierna at t-kartor.com
> www.t-kartor.com
> On 28 Jun 2022, 05:19 +0200, Chao Li <chaoli0394 at gmail.com>, wrote:
>
> Hi,
>
> I meet a problem when I use gdal_calc.py on mac:
>
> (base) lichao at riushios-MacBook-Pro ~ % gdal_calc.py
>
> Traceback (most recent call last):
>
>   File
> "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py",
> line 29, in swig_import_helper
>
>     return importlib.import_module(mname)
>
>   File "/Users/lichao/opt/anaconda3/lib/python3.9/importlib/__init__.py",
> line 127, in import_module
>
>     return _bootstrap._gcd_import(name[level:], package, level)
>
>   File "<frozen importlib._bootstrap>", line 1030, in _gcd_import
>
>   File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
>
>   File "<frozen importlib._bootstrap>", line 986, in
> _find_and_load_unlocked
>
>   File "<frozen importlib._bootstrap>", line 666, in _load_unlocked
>
>   File "<frozen importlib._bootstrap>", line 565, in module_from_spec
>
>   File "<frozen importlib._bootstrap_external>", line 1173, in
> create_module
>
>   File "<frozen importlib._bootstrap>", line 228, in
> _call_with_frames_removed
>
> ImportError:
> dlopen(/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/_
> gdal.cpython-39-darwin.so, 0x0002): Library not loaded:
> @rpath/libpoppler.91.dylib
>
>   Referenced from: /Users/lichao/opt/anaconda3/lib/libgdal.30.dylib
>
>   Reason: tried: '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib'
> (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
> such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such
> file),
> '/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/../../../libpoppler.91.dylib'
> (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
> such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no such
> file),
> '/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/../../../libpoppler.91.dylib'
> (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
> such file), '/Users/lichao/opt/anaconda3/bin/../lib/libpoppler.91.dylib'
> (no such file), '/Users/lichao/opt/anaconda3/lib/libpoppler.91.dylib' (no
> such file), '/Users/lichao/opt/anaconda3/bin/../lib/libpoppler.91.dylib'
> (no such file), '/usr/local/lib/libpoppler.91.dylib' (no such file),
> '/usr/lib/libpoppler.91.dylib' (no such file)
>
>
> During handling of the above exception, another exception occurred:
>
>
> Traceback (most recent call last):
>
>   File "/Users/lichao/opt/anaconda3/bin/gdal_calc.py", line 4, in <module>
>
>     __import__('pkg_resources').run_script('GDAL==3.4.1', 'gdal_calc.py')
>
>   File
> "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/pkg_resources/__init__.py",
> line 662, in run_script
>
>     self.require(requires)[0].run_script(script_name, ns)
>
>   File
> "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/pkg_resources/__init__.py",
> line 1459, in run_script
>
>     exec(code, namespace, namespace)
>
>   File
> "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/GDAL-3.4.1-py3.9-macosx-10.9-x86_64.egg-info/scripts/gdal_calc.py",
> line 5, in <module>
>
>     from osgeo_utils.gdal_calc import *  # noqa
>
>   File
> "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo_utils/gdal_calc.py",
> line 46, in <module>
>
>     from osgeo import gdal
>
>   File
> "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py",
> line 45, in <module>
>
>     _gdal = swig_import_helper()
>
>   File
> "/Users/lichao/opt/anaconda3/lib/python3.9/site-packages/osgeo/__init__.py",
> line 42, in swig_import_helper
>
>     return importlib.import_module('_gdal')
>
>   File "/Users/lichao/opt/anaconda3/lib/python3.9/importlib/__init__.py",
> line 127, in import_module
>
>     return _bootstrap._gcd_import(name[level:], package, level)
>
> ModuleNotFoundError: No module named '_gdal'
>
>
> (base) lichao at riushios-MacBook-Pro ~ % which gdal_calc.py
>
> /Users/lichao/opt/anaconda3/bin/gdal_calc.py
>
>
> (base) lichao at riushios-MacBook-Pro ~ % gdal-config --version
>
> 3.4.1
>
>
> Thanks for your help.
>
>
> Best
>
> --
>
> ------------------------------------------------------------------------------------
> Mike Li
> Department of Urban and Environmental Engineering
> Graduate School of Engineering
> Kyushu University
> 744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
> Tel: 090-8304-8953
> E-mail: chaoli0394 at gmail.com
>
> -------------------------------------------------------------------------------------
> ???? ????
> ???? ??? ??? ????????????
> ???????
>
> -------------------------------------------------------------------------------------
>
>

-- 
------------------------------------------------------------------------------------
Mike Li
Department of Urban and Environmental Engineering
Graduate School of Engineering
Kyushu University
744 Motooka, Nishi-ku, Fukuoka 819-0395 Japan
Tel: 090-8304-8953
E-mail: chaoli0394 at gmail.com
-------------------------------------------------------------------------------------
???? ????
???? ??? ??? ????????????
???????
-------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/3bd361ca/attachment-0001.htm>

From gdt at lexort.com  Tue Jun 28 02:53:41 2022
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 28 Jun 2022 05:53:41 -0400
Subject: [gdal-dev] building on macOS - fatal error: 'direct.h' file not
 found
In-Reply-To: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com> (Nik Sands's
 message of "Tue, 28 Jun 2022 11:19:48 +1000")
References: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
Message-ID: <rmi8rph15cq.fsf@s1.lexort.com>


Nik Sands <nik at nixanz.com> writes:

> Since I last built GDAL (2.2.2), cmake has been introduced and it
> appears as though it is going to be the only option going forward.  So
> I?m attempting to use cmake to build GDAL 3.5.0 on macOS 12.4
> ('Monterey?).  I?ve installed cmake using the ?homebrew? macOS package
> manager.
>
> However, I?m getting numerous build errors, starting with the
> following error when running cmake to build GDAL 3.5.0:
>
> 	fatal error: 'direct.h' file not found

For what it's worth I have been building gdal with cmake on NetBSD,
directly from git sources.   I have not yet converted the pkgsc package.

> I?m attempting to build GDAL as follows:
>
> export LDFLAGS=-L/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib
> export CFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
> export CCFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
> export CXXFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
> export CPPFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"

First, I suggest reading the build instructions carefully and following
them.  Maybe you did, but the above flags are very surprising to me.  I
understand how macOS has an sdk-only approach, but cmake ought to
support that out of the box (or else take the position that macOS is
broken in which case pretty much every cmake-using program would need
such an accomodation).

See BUILDING.md on master.  Since you are using 3.5.0 and that file is
not present, the relevant bits are:

  # Building with cmake

  There is a [build hints](https://gdal.org/build_hints.html) page on the
  website.

  Beyond that page, note:
    - cmake builds in the source directory are not supported (expected to
    fail)

> cd gdal-3.5.0
> mkdir build
> cd build
> cmake -DPROJ_ROOT=~/build -DSQLITE3_INCLUDE_DIR=~/build/include -DSQLITE3_LIBRARY=~/build/lib/libsqlite3.a .. -DCMAKE_INSTALL_PREFIX=~/build -DCMAKE_BUILD_TYPE=Release ..

You probably should be calling cmake with

  -DCMAKE_PREFIX_PATH=$HOME/build -DCMAKE_INSTALL_PREFIX=$HOME/build

according to the hints page.   It is likely a bug if you need to
separately specify PROJ_ROOT.  Perhaps in the cmakefiles, perhaps in
build_hints.html :-)

> I?m a hobbyist and not a professional developer, so my understanding
> of these things is quite limited.  However, my research so far
> indicates that ?direct.h? is a Windows-specific header file and
> therefore perhaps cmake has not been configured correctly for macOS in
> this GDAL distribution?

Don't worry; almost nobody really understands cmake.

I suggest starting over following the instructions.  Make really sure
there is nothing left from before -- cmake tends to create caches that
it doesn't remove.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/4aa08ba8/attachment.sig>

From even.rouault at spatialys.com  Tue Jun 28 03:00:48 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 28 Jun 2022 12:00:48 +0200
Subject: [gdal-dev] building on macOS - fatal error: 'direct.h' file not
 found
In-Reply-To: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
References: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
Message-ID: <84d45893-1a1e-b838-4fe6-440e9f6e353b@spatialys.com>

"CheckIncludeFile.c:1:10: fatal error: 'direct.h' file not found" is not 
an issue when it happens during the CMake configuration phase, ie when 
you run "cmake" (it is not expected during the build phase of course). 
The GDAL CMake configuration tries to find which header files are there 
or not : 
https://github.com/OSGeo/gdal/blob/9aa17692a54a2c6afe2fa9a1cabc3443837f8fca/cmake/helpers/configure.cmake#L38

We do test CMake on MacOS in our continuous integration: 
https://github.com/OSGeo/gdal/blob/9aa17692a54a2c6afe2fa9a1cabc3443837f8fca/.github/workflows/cmake_builds.yml#L524

I'm not sure that setting of LDFLAGS, CFLAGS, etc. is necessary.

Even

Le 28/06/2022 ? 03:19, Nik Sands a ?crit?:
> Hi GDAL devs,
>
> Since I last built GDAL (2.2.2), cmake has been introduced and it appears as though it is going to be the only option going forward.  So I?m attempting to use cmake to build GDAL 3.5.0 on macOS 12.4 ('Monterey?).  I?ve installed cmake using the ?homebrew? macOS package manager.
>
> However, I?m getting numerous build errors, starting with the following error when running cmake to build GDAL 3.5.0:
>
> 	fatal error: 'direct.h' file not found
>
> (a little more context from the error log is included at the end, below)
>
> I?m attempting to build GDAL as follows:
>
> export LDFLAGS=-L/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib
> export CFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
> export CCFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
> export CXXFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
> export CPPFLAGS="-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk"
> cd gdal-3.5.0
> mkdir build
> cd build
> cmake -DPROJ_ROOT=~/build -DSQLITE3_INCLUDE_DIR=~/build/include -DSQLITE3_LIBRARY=~/build/lib/libsqlite3.a .. -DCMAKE_INSTALL_PREFIX=~/build -DCMAKE_BUILD_TYPE=Release ..
>
> I?m a hobbyist and not a professional developer, so my understanding of these things is quite limited.  However, my research so far indicates that ?direct.h? is a Windows-specific header file and therefore perhaps cmake has not been configured correctly for macOS in this GDAL distribution?
>
> Is it possible to build GDAL using cmake on macOS?  If so, how to I deal with this error?
>
> I can supply the entire CMakeError.log file if that would help (as an attachement, or copy/pasted as text in an email).
>
> Cheers,
> Nik.
>
> Snippet from CMakeError.log:
> ------------------------------
>
> Source file was:
>   int main() { return 0; }
> Determining if the include file direct.h exists failed with the following output:
> Change Dir: /Users/nsands/Documents/Development/3rdParty/GDAL3/gdal-3.5.0/build/CMakeFiles/CMakeTmp
>
> Run Build Command(s):/usr/bin/make -f Makefile cmTC_190db/fast && /Applications/Xcode.app/Contents/Developer/usr/bin/make  -f CMakeFiles/cmTC_190db.dir/build.make CMakeFiles/cmTC_190db.dir/build
> Building C object CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o
> /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc   -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk    -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX12.3.sdk -std=gnu99 -MD -MT CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o -MF CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o.d -o CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o -c /Users/nsands/Documents/Development/3rdParty/GDAL3/gdal-3.5.0/build/CMakeFiles/CMakeTmp/CheckIncludeFile.c
> /Users/nsands/Documents/Development/3rdParty/GDAL3/gdal-3.5.0/build/CMakeFiles/CMakeTmp/CheckIncludeFile.c:1:10: fatal error: 'direct.h' file not found
> #include <direct.h>
>           ^~~~~~~~~~
> 1 error generated.
> make[1]: *** [CMakeFiles/cmTC_190db.dir/CheckIncludeFile.c.o] Error 1
> make: *** [cmTC_190db/fast] Error 2
>
> ------------------------------
>
>
> ========================================================
> NIK SANDS
> Line Tamer | Time Traveller | Space Cadet
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From mateusz at loskot.net  Tue Jun 28 03:14:06 2022
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 28 Jun 2022 12:14:06 +0200
Subject: [gdal-dev] building on macOS - fatal error: 'direct.h' file not
 found
In-Reply-To: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
References: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
Message-ID: <CABUeae-txE=_YGLUjUb7oF2LeWg_c5NyfE6RshQGWhGPYtaN5A@mail.gmail.com>

On Tue, 28 Jun 2022 at 03:28, Nik Sands <nik at nixanz.com> wrote:
> However, I?m getting numerous build errors, starting with the following error when running cmake to build GDAL 3.5.0:
>
>         fatal error: 'direct.h' file not found

Check cmake command output for

-- Looking for direct.h

and what is the look-up result it reports.

GDAL's CMake configuration checks for direct.h
https://github.com/OSGeo/gdal/blob/14be6dea87fd44dc58c3e6a2befb5913147ddbc7/cmake/helpers/configure.cmake#L38

> I?m a hobbyist and not a professional developer, so my understanding of these things is quite limited.

You can still build with Autotools!

> However, my research so far indicates that ?direct.h? is a Windows-specific header file

Correct.

> and therefore perhaps cmake has not been configured correctly for macOS in this GDAL distribution?

As per the earlier link, it's simple, it runs
`check_include_file("direct.h" HAVE_DIRECT_H)`
and if the header is found, then HAVE_DIRECT_H is set.
The CMake configuration does almost the same as the Autotools does:
https://github.com/OSGeo/gdal/blob/14be6dea87fd44dc58c3e6a2befb5913147ddbc7/configure.ac#L295

Question is, is HAVE_DIRECT_H set on macOS or not.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From clemens at opengis.ch  Tue Jun 28 04:13:28 2022
From: clemens at opengis.ch (Clemens Rudert)
Date: Tue, 28 Jun 2022 13:13:28 +0200
Subject: [gdal-dev] Fwd: Raster Data with vsicurl from http source
In-Reply-To: <2292e8f8-6cfa-7c41-89e7-6cc6ab5e8992@opengis.ch>
References: <2292e8f8-6cfa-7c41-89e7-6cc6ab5e8992@opengis.ch>
Message-ID: <CAGXsddEw78U3KB6aTeyPF0QZ+krHGUfq07DTAz_RFwK0N88Hpg@mail.gmail.com>

Hi

I try to read raster data from an URL with QGIS. I see QGIS uses GDAL
vsicurl to connect to data. It works just fine. Only GDAL tries to fetch
a lot of meta files which can be disabled by setting the
GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR

Using this:

GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR gdalinfo /vsicurl/http://<url>/my.tif

It works as expected and does not query any additional files.

But starting QGIS with GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR does not
have the expected effect.

Now I wonder where this variable gets lost. It is available in the QGIS
settings dialog as ENV but seems not be reflected when GDAL is called.
I'm not that deep in the connections between GDAL and QGIS. I know this
is more an issue for QGIS then for GDAL  but I ask here anyway because
already talked to QGIS people who suggested to ask here :)


Thank you for your help.


Cheers Clemens

-- 
 <https://qfield.org/get/>

QFIELD 2.0 IS HERE! - Hold the power of QGIS in 
your hand - learn more 
<https://www.opengis.ch/2022/04/05/qfield-2-0-is-here/> - get it now 
<https://qfield.org/get>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/36a8eb35/attachment.htm>

From gdt at lexort.com  Tue Jun 28 04:56:26 2022
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 28 Jun 2022 07:56:26 -0400
Subject: [gdal-dev] GDAL 3.5.1 RC1 available
References: <5c5af6b8-6004-8c1d-7b55-ac0738da5c1e@spatialys.com>
Message-ID: <rmir139ypat.fsf@s1.lexort.com>


Even Rouault <even.rouault at spatialys.com> writes:

> https://download.osgeo.org/gdal/3.5.1/gdal-3.5.1rc1.tar.xz

This built within pkgsrc, with no changes to the set of installed files
(our PLIST file), and just a micro shlib bump.  Note that I am still
building pkgsrc with autoconf.

autotest seems as ok as it's been on my system, so not a concern about
this RC:
  = 3 failed, 8010 passed, 1750 skipped, 2 xfailed, 28 warnings in 676.58s (0:11:16) =

qgis (without being rebuilt, which should be ok because 3.5.1 is not an
ABI change from 3.5.0) started up and loaded a bunch of layers,
geopackage vector and raster (tiff) with no issues.

From my viewpoint, RC1 is ok to be promoted for release.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/189e0509/attachment.sig>

From adamgutonski at protonmail.com  Tue Jun 28 11:15:14 2022
From: adamgutonski at protonmail.com (adamgutonski)
Date: Tue, 28 Jun 2022 18:15:14 +0000
Subject: [gdal-dev] Anticipated GDAL 3.5.1 Release Date
Message-ID: <ro7NOB2nZqAB1ETeqoSVpkGL98ovd2dtMaboqhdDxYz4_ibBviS9YHMoXBDZqAKxHhEBTIOiDEDhPbMzAaVJjclIFBt77wLhF121L0Bi8iI=@protonmail.com>

Hello,

When is the anticipated release date for GDAL release 3.5.1?

Thank you,
Adam

Sent with [Proton Mail](https://proton.me/) secure email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220628/59ff5b5e/attachment.htm>

From nik at nixanz.com  Tue Jun 28 18:50:02 2022
From: nik at nixanz.com (nik at nixanz.com)
Date: Wed, 29 Jun 2022 11:50:02 +1000
Subject: [gdal-dev] building on macOS - fatal error: 'direct.h' file not
 found
In-Reply-To: <CABUeae-txE=_YGLUjUb7oF2LeWg_c5NyfE6RshQGWhGPYtaN5A@mail.gmail.com>
References: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
 <CABUeae-txE=_YGLUjUb7oF2LeWg_c5NyfE6RshQGWhGPYtaN5A@mail.gmail.com>
Message-ID: <862cc999163fcc805ae30b98fc392926@nixanz.com>

Thanks for all the replies so far.  I'm aim to work through them 
properly when I get time and expect to have some follow-up questions.

For now, I just wanted to briefly address this comment:

> 
> You can still build with Autotools!
> 

For GDAL 3.5.x, this is true.  However, it is GDAL 3.6 (not yet 
released) that has the new features that I really need.  And on GDAL 
GitHub, it states:

RFC 84:
Addition of a CMake build system, which deprecates the existing
autoconf/automake and nmake build systems, that will be removed
in GDAL 3.6.0. Users are encouraged to adopt the new CMake build system.
Documentation of the CMake build system is at
https://gdal.org/build_hints.html.

Therefore the purpose of this exercise is to get the CMake system 
working.  So if my understanding is correct, avoiding CMake is not an 
option for me if I want to use GDAL 3.6.

Cheers,
Nik.

-----------------------------------------

NIK SANDS
Line Tamer | Time Traveller | Space Cadet

On 2022-06-28 20:14, Mateusz Loskot wrote:
> On Tue, 28 Jun 2022 at 03:28, Nik Sands <nik at nixanz.com> wrote:
>> However, I?m getting numerous build errors, starting with the 
>> following error when running cmake to build GDAL 3.5.0:
>> 
>>         fatal error: 'direct.h' file not found
> 
> Check cmake command output for
> 
> -- Looking for direct.h
> 
> and what is the look-up result it reports.
> 
> GDAL's CMake configuration checks for direct.h
> https://github.com/OSGeo/gdal/blob/14be6dea87fd44dc58c3e6a2befb5913147ddbc7/cmake/helpers/configure.cmake#L38
> 
>> I?m a hobbyist and not a professional developer, so my understanding 
>> of these things is quite limited.
> 
> You can still build with Autotools!
> 
>> However, my research so far indicates that ?direct.h? is a 
>> Windows-specific header file
> 
> Correct.
> 
>> and therefore perhaps cmake has not been configured correctly for 
>> macOS in this GDAL distribution?
> 
> As per the earlier link, it's simple, it runs
> `check_include_file("direct.h" HAVE_DIRECT_H)`
> and if the header is found, then HAVE_DIRECT_H is set.
> The CMake configuration does almost the same as the Autotools does:
> https://github.com/OSGeo/gdal/blob/14be6dea87fd44dc58c3e6a2befb5913147ddbc7/configure.ac#L295
> 
> Question is, is HAVE_DIRECT_H set on macOS or not.
> 
> Best regards,

From mateusz at loskot.net  Wed Jun 29 01:36:41 2022
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed, 29 Jun 2022 10:36:41 +0200
Subject: [gdal-dev] building on macOS - fatal error: 'direct.h' file not
 found
In-Reply-To: <862cc999163fcc805ae30b98fc392926@nixanz.com>
References: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
 <CABUeae-txE=_YGLUjUb7oF2LeWg_c5NyfE6RshQGWhGPYtaN5A@mail.gmail.com>
 <862cc999163fcc805ae30b98fc392926@nixanz.com>
Message-ID: <CABUeae-R69tDWruKwUd4SKs2dUCYAW8hPi3EMfd5L0JtX0ygzQ@mail.gmail.com>

On Wed, 29 Jun 2022 at 03:50, <nik at nixanz.com> wrote:
> >
> > You can still build with Autotools!
> >
> [...]
> Therefore the purpose of this exercise is to get the CMake system
> working.  So if my understanding is correct, avoiding CMake is not an
> option for me if I want to use GDAL 3.6.

Correct.
CMake has been out there for a very ling time and
it is battle-tested on macOS, and other systems too,
even on some exotic ones.

CMake is like democracy, not ideal, but it's best
the humanity has worked out so far that works for
well all countries. I suggest to stop CMake rants.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From runette at gmail.com  Wed Jun 29 05:18:48 2022
From: runette at gmail.com (Paul Harwood)
Date: Wed, 29 Jun 2022 13:18:48 +0100
Subject: [gdal-dev] building on macOS - fatal error: 'direct.h' file not
 found
In-Reply-To: <862cc999163fcc805ae30b98fc392926@nixanz.com>
References: <4EF7B26B-C3F9-4709-87B6-D5895D90C6FD@nixanz.com>
 <CABUeae-txE=_YGLUjUb7oF2LeWg_c5NyfE6RshQGWhGPYtaN5A@mail.gmail.com>
 <862cc999163fcc805ae30b98fc392926@nixanz.com>
Message-ID: <CAE8nN5NtqQUB25m=dw_oOPH_BEnVr2xS-tsr0ogfNS+OLMi4Bg@mail.gmail.com>

When I did some work on the csharp build scripts - I ended up building on
mac about 100 times with different configurations so - to state the obvious
- it does work!

That said - for various reasons that are not relevant here - I don't use
Homebrew. But I would be surprised if that is the problem.

You should not need any of the configuration items you have! Have you tried
just the basic build ?

Start with a clean repo (as Greg says -- make is very good at caching)

mkdir build
cd build
cmake ..
cmake --build .
cmake --build . --target install

provided the dependencies are actually all loaded, then that should work.

On Wed, 29 Jun 2022 at 02:50, <nik at nixanz.com> wrote:

> Thanks for all the replies so far.  I'm aim to work through them
> properly when I get time and expect to have some follow-up questions.
>
> For now, I just wanted to briefly address this comment:
>
> >
> > You can still build with Autotools!
> >
>
> For GDAL 3.5.x, this is true.  However, it is GDAL 3.6 (not yet
> released) that has the new features that I really need.  And on GDAL
> GitHub, it states:
>
> RFC 84:
> Addition of a CMake build system, which deprecates the existing
> autoconf/automake and nmake build systems, that will be removed
> in GDAL 3.6.0. Users are encouraged to adopt the new CMake build system.
> Documentation of the CMake build system is at
> https://gdal.org/build_hints.html.
>
> Therefore the purpose of this exercise is to get the CMake system
> working.  So if my understanding is correct, avoiding CMake is not an
> option for me if I want to use GDAL 3.6.
>
> Cheers,
> Nik.
>
> -----------------------------------------
>
> NIK SANDS
> Line Tamer | Time Traveller | Space Cadet
>
> On 2022-06-28 20:14, Mateusz Loskot wrote:
> > On Tue, 28 Jun 2022 at 03:28, Nik Sands <nik at nixanz.com> wrote:
> >> However, I?m getting numerous build errors, starting with the
> >> following error when running cmake to build GDAL 3.5.0:
> >>
> >>         fatal error: 'direct.h' file not found
> >
> > Check cmake command output for
> >
> > -- Looking for direct.h
> >
> > and what is the look-up result it reports.
> >
> > GDAL's CMake configuration checks for direct.h
> >
> https://github.com/OSGeo/gdal/blob/14be6dea87fd44dc58c3e6a2befb5913147ddbc7/cmake/helpers/configure.cmake#L38
> >
> >> I?m a hobbyist and not a professional developer, so my understanding
> >> of these things is quite limited.
> >
> > You can still build with Autotools!
> >
> >> However, my research so far indicates that ?direct.h? is a
> >> Windows-specific header file
> >
> > Correct.
> >
> >> and therefore perhaps cmake has not been configured correctly for
> >> macOS in this GDAL distribution?
> >
> > As per the earlier link, it's simple, it runs
> > `check_include_file("direct.h" HAVE_DIRECT_H)`
> > and if the header is found, then HAVE_DIRECT_H is set.
> > The CMake configuration does almost the same as the Autotools does:
> >
> https://github.com/OSGeo/gdal/blob/14be6dea87fd44dc58c3e6a2befb5913147ddbc7/configure.ac#L295
> >
> > Question is, is HAVE_DIRECT_H set on macOS or not.
> >
> > Best regards,
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220629/135c830b/attachment.htm>

From adamgutonski at protonmail.com  Wed Jun 29 09:35:34 2022
From: adamgutonski at protonmail.com (adamgutonski)
Date: Wed, 29 Jun 2022 16:35:34 +0000
Subject: [gdal-dev] Add FileGDB Driver to GDAL Version 3.5.0
Message-ID: <u7hdKBbh59zxn-W8kOx2ytUfCNnRrtASPQr2cwmcXOQaJiQ322IBViyhdOR4Eiw8SjhuSUwJWUdWpsz8iGNq4xAsl4bDj3q6rsynkyo1wTs=@protonmail.com>

Hello,

I am wondering how to add the ESRI File GDB API .dll to an established conda environment with GDAL 3.5.0. Previous versions of GDAL allowed me to:

- place FileGDBAPI.dll in C:\Anaconda3\envs\<env_name>\Library\bin

- place gdalplugins folder containing ogr_FileGDB.dll here C:\Anaconda3\envs\<env_name>

After this simple set up, I am able to use the driver. However, this set up does not work for GDAL 3.5.0. It seems that the gdalplugins folder is already created here: C:\anaconda3\envs\<env_name>\Library\bin\gdalplugins. When I create a system environment variable GDAL_DRIVER_PATH and point it to this directory, the File GDB API still does not load.

How does one add the FileGDB API to an already installed version of GDAL 3.5.0?

Thank you,
Adam

Sent with [Proton Mail](https://proton.me/) secure email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220629/b00ddaeb/attachment.htm>

From jamesli200116 at gmail.com  Wed Jun 29 17:47:21 2022
From: jamesli200116 at gmail.com (James Li)
Date: Thu, 30 Jun 2022 09:47:21 +0900
Subject: [gdal-dev] Points Overlap in Gdal Rasterize
Message-ID: <CAA6xY=X4fp1MeyvL+K6uUcJdSB=nZ22170ZaDMzq0jNPSjM3og@mail.gmail.com>

Hi,

Thanks for reading my email.

When I use csv file including x, y, and z to generate GTiff, what is the
method to solve the overlapping issue? Averaging all the values in the cell
or just using the last value or another method.

I read the URL about *gdal_rasterize*:
https://gdal.org/programs/gdal_rasterize.html, but I hardly find that
information.

Thanks

-- 
---------------------------------------------------
James Li
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220630/79734353/attachment.htm>

From varskann1993 at gmail.com  Thu Jun 30 02:35:57 2022
From: varskann1993 at gmail.com (Kanishk Varshney)
Date: Thu, 30 Jun 2022 15:05:57 +0530
Subject: [gdal-dev] MBTiles blurry
Message-ID: <CAM18NOGva9tjireygOR1=NT6mjWtz6EGVu2O7AzSRRH=9UE10w@mail.gmail.com>

 topview_sample.tif
<https://drive.google.com/file/d/1tOpP3R8QphE0TE5n9LUMls6eY7ORqtG5/view?usp=drive_web>

Hey All,

I am trying to generate MBTiles, but I am noticing that the
quality/resolution I can achieve using the Gdal_translate command is
lagging behind I can achieve in the QGIS tool setting hyperparameters..

My QGIS parameters are:
*Minimum Zoom: 0*
*Maximum Zoom: 22*
*DPI: 600*
*Format: PNG*
*Background: Transparent*
*Quality: 100*
*Meta title size: 4*


And my GDAL commands are:

gdalwarp -srcnodata 0 -dstalpha infile.tif outfile.tif


gdal_translate -tr 0.035 0.035 -co 'QUALITY=100' -of MBTILES
outfile.tif outmbtile.mbtiles


gdaladdo -r nearest outmbtile.mbtiles 2 4 8 16


If I am trying to improve the target resolution even further(reducing
-tr value) , it corrupts the output mbtile and a blank or blurred tile
gets generated

Also, the opening option ZOOM_LEVEL seems to error out(Using with -oo
"ZOOM_LEVEL=9)

Any help is appreciated.


Thanks,

Kanishk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220630/4a8fe417/attachment.htm>

From even.rouault at spatialys.com  Thu Jun 30 02:54:41 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 30 Jun 2022 11:54:41 +0200
Subject: [gdal-dev] GDAL 3.5.1 RC2 available (Re: GDAL 3.5.1 RC1 available)
In-Reply-To: <5c5af6b8-6004-8c1d-7b55-ac0738da5c1e@spatialys.com>
References: <5c5af6b8-6004-8c1d-7b55-ac0738da5c1e@spatialys.com>
Message-ID: <7822bbc8-34df-542b-4318-f555f41a2811@spatialys.com>

Hi,

I've just uploaded a RC2 with 3 changes w.r.t RC1:

- netCDF:? fix reading geotransform of a CF file with long/lat grid 
mapping (3.5.0 regression)
- OSRGetProjTLSContext(): make it faster on Linux by saving getpid() 
system call
- S57: fix wrong punctuation in .csv resource files

Updated links:

 ? https://download.osgeo.org/gdal/3.5.1/gdal-3.5.1rc2.tar.xz
 ? https://download.osgeo.org/gdal/3.5.1/gdal-3.5.1rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.5.1/gdal351rc2.zip

https://download.osgeo.org/gdal/3.5.1/gdalautotest-3.5.1rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.5.1/gdalautotest-3.5.1rc2.zip

Even

Le 27/06/2022 ? 13:35, Even Rouault a ?crit?:
> Hi,
>
> I have prepared a GDAL/OGR 3.5.1 release candidate.
>
> Pick up an archive among the following ones (by ascending size):
>
> ? https://download.osgeo.org/gdal/3.5.1/gdal-3.5.1rc1.tar.xz
> ? https://download.osgeo.org/gdal/3.5.1/gdal-3.5.1rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.5.1/gdal351rc1.zip
>
> A snapshot of the gdalautotest suite is also available :
>
> https://download.osgeo.org/gdal/3.5.1/gdalautotest-3.5.1rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.5.1/gdalautotest-3.5.1rc1.zip
>
> The NEWS file is here :
>
> ? https://github.com/OSGeo/gdal/blob/v3.5.1RC1/NEWS.md
>
> I'll call for a vote promoting it to final later next week if no
> serious problems are reported before.
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Jun 30 03:07:55 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 30 Jun 2022 12:07:55 +0200
Subject: [gdal-dev] MBTiles blurry
In-Reply-To: <CAM18NOGva9tjireygOR1=NT6mjWtz6EGVu2O7AzSRRH=9UE10w@mail.gmail.com>
References: <CAM18NOGva9tjireygOR1=NT6mjWtz6EGVu2O7AzSRRH=9UE10w@mail.gmail.com>
Message-ID: <04c2ced8-6d35-c959-8761-e6c4d9c0ced0@spatialys.com>

Kanishk,


>
> And my GDAL commands are:
>
> gdalwarp -srcnodata 0 -dstalpha infile.tif outfile.tif
> gdal_translate -tr 0.035 0.035 -co 'QUALITY=100' -of MBTILES 
> outfile.tifoutmbtile.mbtiles
> gdaladdo -r nearest outmbtile.mbtiles2 4 8 16

The above gives a OK result for me with topveiw_sample.tif as input. 
Note that you don't need the first gdalwarp step as your file has 
already an alpha band.

To improve quality you should add for example -r average to 
gdal_translate otherwise nearest neighbour reampling will be used, which 
is generally a bad idea.

Same for gdaladdo: you should'nt use nearest neighbour reampling for 
good quality

> If I am trying to improve the target resolution even further(reducing -tr value) , it corrupts the output mbtile and a blank or blurred tile gets generated
> Also, the opening option ZOOM_LEVEL seems to error out(Using with -oo "ZOOM_LEVEL=9)

If you look at the output of gdalinfo on the generated mbtiles file, 
you'll see that the full resolution is at zoom level 22, and given the 
dimensions of the file only 2 overview levels were generated. So the 
minimum zoom level at which you can open that file is 20.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220630/7e01bb5d/attachment.htm>

From varskann1993 at gmail.com  Thu Jun 30 04:18:10 2022
From: varskann1993 at gmail.com (Kanishk Varshney)
Date: Thu, 30 Jun 2022 16:48:10 +0530
Subject: [gdal-dev] MBTiles blurry
In-Reply-To: <04c2ced8-6d35-c959-8761-e6c4d9c0ced0@spatialys.com>
References: <CAM18NOGva9tjireygOR1=NT6mjWtz6EGVu2O7AzSRRH=9UE10w@mail.gmail.com>
 <04c2ced8-6d35-c959-8761-e6c4d9c0ced0@spatialys.com>
Message-ID: <CAM18NOGYkMGG6wu2fZNXD85BsqOu1r6LwY89kuj98SGW09-tjw@mail.gmail.com>

Hey Even,
Thanks for the quick response.

If you notice the MBTiles, the finer details(cracks on Road, etc) and edges
are all blurred. I tried the -r average flag as well but the result was
almost similar

I am more interested in preserving those details while reducing the size of
the data. So any other approach or format that might suit my use case will
be appreciated as well!

Thanks,
Kanishk

On Thu, Jun 30, 2022 at 3:37 PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Kanishk,
>
>
> And my GDAL commands are:
>
> gdalwarp -srcnodata 0 -dstalpha infile.tif outfile.tif
>
>  gdal_translate -tr 0.035 0.035 -co 'QUALITY=100' -of MBTILES outfile.tif outmbtile.mbtiles
>
> gdaladdo -r nearest outmbtile.mbtiles 2 4 8 16
>
> The above gives a OK result for me with topveiw_sample.tif as input. Note
> that you don't need the first gdalwarp step as your file has already an
> alpha band.
>
> To improve quality you should add for example -r average to gdal_translate
> otherwise nearest neighbour reampling will be used, which is generally a
> bad idea.
>
> Same for gdaladdo: you should'nt use nearest neighbour reampling for good
> quality
>
> If I am trying to improve the target resolution even further(reducing -tr value) , it corrupts the output mbtile and a blank or blurred tile gets generated
>
> Also, the opening option ZOOM_LEVEL seems to error out(Using with -oo "ZOOM_LEVEL=9)
>
> If you look at the output of gdalinfo on the generated mbtiles file,
> you'll see that the full resolution is at zoom level 22, and given the
> dimensions of the file only 2 overview levels were generated. So the
> minimum zoom level at which you can open that file is 20.
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220630/b2f05916/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Jun 30 04:28:28 2022
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 30 Jun 2022 13:28:28 +0200
Subject: [gdal-dev] MBTiles blurry
In-Reply-To: <CAM18NOGYkMGG6wu2fZNXD85BsqOu1r6LwY89kuj98SGW09-tjw@mail.gmail.com>
References: <CAM18NOGva9tjireygOR1=NT6mjWtz6EGVu2O7AzSRRH=9UE10w@mail.gmail.com>
 <04c2ced8-6d35-c959-8761-e6c4d9c0ced0@spatialys.com>
 <CAM18NOGYkMGG6wu2fZNXD85BsqOu1r6LwY89kuj98SGW09-tjw@mail.gmail.com>
Message-ID: <79919f36-4754-9c09-47d5-c873f8fd0522@spatialys.com>

You can perhaps try -r lanczos . It is good at preserving sharp details 
(but can also create artifacts on other situations. there's nothing as a 
universally good resampling method)

Ah, and one point I forgot is that when going to MBTiles, an implicit 
reprojection to Web Mercator is also done by the MBTiles driver, which 
involves another resampling

Try also adding -co RESAMPLING=LANCZOS in the gdal_translate stage.

If you don't need MBTiles format and WebMercator projection, I'd say 
just stick with GeoTIFF, and possibly use the COG driver: 
https://gdal.org/drivers/raster/cog.html

Le 30/06/2022 ? 13:18, Kanishk Varshney a ?crit?:
> Hey Even,
> Thanks for the quick response.
>
> If you notice the MBTiles, the finer details(cracks on Road, etc)?and 
> edges are all blurred. I tried the -r average flag as well but the 
> result was almost similar
>
> I am more interested in preserving those?details while reducing the 
> size of the data. So any other approach or format that might suit my 
> use case?will be appreciated as well!
>
> Thanks,
> Kanishk
>
> On Thu, Jun 30, 2022 at 3:37 PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Kanishk,
>
>
>>
>>     And my GDAL commands are:
>>
>>     gdalwarp -srcnodata 0 -dstalpha infile.tif outfile.tif
>>     gdal_translate -tr 0.035 0.035 -co 'QUALITY=100' -of MBTILES
>>     outfile.tifoutmbtile.mbtiles
>>     gdaladdo -r nearest outmbtile.mbtiles2 4 8 16
>
>     The above gives a OK result for me with topveiw_sample.tif as
>     input. Note that you don't need the first gdalwarp step as your
>     file has already an alpha band.
>
>     To improve quality you should add for example -r average to
>     gdal_translate otherwise nearest neighbour reampling will be used,
>     which is generally a bad idea.
>
>     Same for gdaladdo: you should'nt use nearest neighbour reampling
>     for good quality
>
>>     If I am trying to improve the target resolution even further(reducing -tr value) , it corrupts the output mbtile and a blank or blurred tile gets generated
>>     Also, the opening option ZOOM_LEVEL seems to error out(Using with -oo "ZOOM_LEVEL=9)
>
>     If you look at the output of gdalinfo on the generated mbtiles
>     file, you'll see that the full resolution is at zoom level 22, and
>     given the dimensions of the file only 2 overview levels were
>     generated. So the minimum zoom level at which you can open that
>     file is 20.
>
>     Even
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220630/d14c3d79/attachment.htm>

From varskann1993 at gmail.com  Thu Jun 30 05:06:28 2022
From: varskann1993 at gmail.com (Kanishk Varshney)
Date: Thu, 30 Jun 2022 17:36:28 +0530
Subject: [gdal-dev] MBTiles blurry
In-Reply-To: <79919f36-4754-9c09-47d5-c873f8fd0522@spatialys.com>
References: <CAM18NOGva9tjireygOR1=NT6mjWtz6EGVu2O7AzSRRH=9UE10w@mail.gmail.com>
 <04c2ced8-6d35-c959-8761-e6c4d9c0ced0@spatialys.com>
 <CAM18NOGYkMGG6wu2fZNXD85BsqOu1r6LwY89kuj98SGW09-tjw@mail.gmail.com>
 <79919f36-4754-9c09-47d5-c873f8fd0522@spatialys.com>
Message-ID: <CAM18NOETBG-G0-TJN0=Dy_pG7PDj_OAYDufSOFhctU5n7wS4xg@mail.gmail.com>

So these flags I have tried .. nearest was the one giving best out of these
re sampling methods!


Lanczos and Average re sampling both smoother the edges etc and blur the
overall image even further!


On Thu, 30 Jun 2022 at 4:58 PM, Even Rouault <even.rouault at spatialys.com>
wrote:

> You can perhaps try -r lanczos . It is good at preserving sharp details
> (but can also create artifacts on other situations. there's nothing as a
> universally good resampling method)
>
> Ah, and one point I forgot is that when going to MBTiles, an implicit
> reprojection to Web Mercator is also done by the MBTiles driver, which
> involves another resampling
>
> Try also adding -co RESAMPLING=LANCZOS in the gdal_translate stage.
>
> If you don't need MBTiles format and WebMercator projection, I'd say just
> stick with GeoTIFF, and possibly use the COG driver:
> https://gdal.org/drivers/raster/cog.html
> Le 30/06/2022 ? 13:18, Kanishk Varshney a ?crit :
>
> Hey Even,
> Thanks for the quick response.
>
> If you notice the MBTiles, the finer details(cracks on Road, etc) and
> edges are all blurred. I tried the -r average flag as well but the result
> was almost similar
>
> I am more interested in preserving those details while reducing the size
> of the data. So any other approach or format that might suit my use
> case will be appreciated as well!
>
> Thanks,
> Kanishk
>
> On Thu, Jun 30, 2022 at 3:37 PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Kanishk,
>>
>>
>> And my GDAL commands are:
>>
>> gdalwarp -srcnodata 0 -dstalpha infile.tif outfile.tif
>>
>>  gdal_translate -tr 0.035 0.035 -co 'QUALITY=100' -of MBTILES outfile.tif outmbtile.mbtiles
>>
>> gdaladdo -r nearest outmbtile.mbtiles 2 4 8 16
>>
>> The above gives a OK result for me with topveiw_sample.tif as input. Note
>> that you don't need the first gdalwarp step as your file has already an
>> alpha band.
>>
>> To improve quality you should add for example -r average to
>> gdal_translate otherwise nearest neighbour reampling will be used, which is
>> generally a bad idea.
>>
>> Same for gdaladdo: you should'nt use nearest neighbour reampling for good
>> quality
>>
>> If I am trying to improve the target resolution even further(reducing -tr value) , it corrupts the output mbtile and a blank or blurred tile gets generated
>>
>> Also, the opening option ZOOM_LEVEL seems to error out(Using with -oo "ZOOM_LEVEL=9)
>>
>> If you look at the output of gdalinfo on the generated mbtiles file,
>> you'll see that the full resolution is at zoom level 22, and given the
>> dimensions of the file only 2 overview levels were generated. So the
>> minimum zoom level at which you can open that file is 20.
>>
>> Even
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220630/bbdd01ca/attachment.htm>

From christophe.delepine at thalesgroup.com  Thu Jun 30 08:17:18 2022
From: christophe.delepine at thalesgroup.com (DELEPINE Christophe)
Date: Thu, 30 Jun 2022 15:17:18 +0000
Subject: [gdal-dev] Creating a vector mbtile with several layers
Message-ID: <cfc1630be4a24254971facb8503de34f@thalesgroup.com>

Hello

I am trying to create a vector mbtile containing several layers (using C++ GDAL API) but it does not work. My output mbtile only contains one layer (ogrinfo only lists one layer)
What I do is the following :

GDALDriver* driver = (GDALDriver*)GDALGetDriverByName("MBTiles");
GDALDataset* poDS = driver->Create(mbtiles.c_str(), 0, 0, 0, GDT_Unknown, datasetCreationOptions);
for (auto& layer : layers)
{
       OGRLayer* oLayer = poDS->CreateLayer(layer.name_.c_str(), &srs3857_, wkbUnknown);
OGRFeature *oFeature = OGRFeature::CreateFeature(oLayer->GetLayerDefn());
oFeature->SetGeometryDirectly(geom);
oLayer->CreateFeature(oFeature);
}
GDALClose(poDS);


Any idea what is wrong ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20220630/368e5014/attachment-0001.htm>

