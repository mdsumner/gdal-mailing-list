From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec  1 05:23:58 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Tue, 1 Dec 2020 13:23:58 +0000
Subject: [gdal-dev] gdal_create: input file option
Message-ID: <3044ca7837634d7cb7f288e10150dbda@maanmittauslaitos.fi>

Hi,

Every now and then people would like to rasterize vectors into raster that matches exactly with some existing raster. There are a few possible ways for creating an empty copy from a raster with GDAL tools https://gis.stackexchange.com/questions/220753/how-do-i-create-blank-geotiff-with-same-spatial-properties-as-existing-geotiff . The gdal_merge way with -createonly does the job and is fast, but who remembers that gdal_merge exists and can be used for such purpose? How about to add an option like "-if" (input file) into gdal_create program, with the same effect? Options -outsize, -a_srs, -a_ullr would have no effect if used together with input template file. Options -of, -bands, -ot, -a_nodata, -co could override if given. Not sure about metadata, but probably it is never worth copying from the template file.

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201201/7d5d779e/attachment.html>

From juliermeopensourcedeveloper at gmail.com  Tue Dec  1 06:07:49 2020
From: juliermeopensourcedeveloper at gmail.com (1520 gis)
Date: Tue, 1 Dec 2020 11:07:49 -0300
Subject: [gdal-dev] Fwd: Grep gdalinfo subdataset
In-Reply-To: <CAKTKyJJBBFH+rrRZApN79NsKk1Na-ZFR=gZTLxZ1W4UB+V4Xqw@mail.gmail.com>
References: <CAKTKyJJBBFH+rrRZApN79NsKk1Na-ZFR=gZTLxZ1W4UB+V4Xqw@mail.gmail.com>
Message-ID: <CAKTKyJJj6SpNx1t66AiNMzFJG9UgKz_usLYf=OMrz6VonaPkFg@mail.gmail.com>

---------- Forwarded message ---------
From: 1520 gis <juliermeopensourcedeveloper at gmail.com>
Date: Fri, Nov 27, 2020 at 3:14 PM
Subject: Grep gdalinfo subdataset
To: <gdal-dev at lists.osgeo.org>


Hi all,

I am trying to grep the SUBDATASET_X_NAME in gdalinfo.
I only need the WCS:url

If I grep the subdataset [1], the string slice "SUBDATASET_5_NAME" comes
together. I would like to know if I can get only WCS:url by using any
gdalinfo options.

I tried running [2] , but no success. Is there any gdalinfo option which
response is the same as in [1]?

Thank you very much for your time in advance.

Kind regards
Julierme


[1]
gdalinfo "WCS:
http://demo.geo-solutions.it/geoserver/ows?service=WCS&version=2.0.1&request=GetCapabilities
" | grep 'nurc__Img_Sample'

[2]

gdalinfo -sd nurc__Img_Sample "WCS:
http://demo.geo-solutions.it/geoserver/ows?service=WCS&version=2.0.1&request=GetCapabilities
"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201201/b45c6c09/attachment.html>

From even.rouault at spatialys.com  Tue Dec  1 07:23:49 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 01 Dec 2020 16:23:49 +0100
Subject: [gdal-dev] New STACTA driver and gdal2tiles
In-Reply-To: <4a1e16d5aea74869a73912f1dfefbb6d@maanmittauslaitos.fi>
References: <4a1e16d5aea74869a73912f1dfefbb6d@maanmittauslaitos.fi>
Message-ID: <2004741.uNZ4PYgJl8@even-i700>

On mardi 1 d?cembre 2020 07:44:06 CET Rahkonen Jukka (MML) wrote:
> Hi,
> 
> I noticed that a new STACTA driver appeared with
> https://github.com/OSGeo/gdal/pull/3227. Probably gdal2tiles could be made
> to create a catalog json file like
> https://github.com/OSGeo/gdal/pull/3227/files#diff-f1b9f20b0e955285ddcebb01
> 53367a254d3d0126a784e52b9ae36dba0eab023c and then the directory of files
> that gdal2tiles creates could be opened simply with the STACTA driver in
> only the "href" in "asset_templetes" points to correct place.  Am I right?

In theory yes I think. The same could hold for a WMTS capabilities XML file.

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From neteler at osgeo.org  Tue Dec  1 08:46:13 2020
From: neteler at osgeo.org (Markus Neteler)
Date: Tue, 1 Dec 2020 17:46:13 +0100
Subject: [gdal-dev] Fwd: Grep gdalinfo subdataset
In-Reply-To: <CAKTKyJJj6SpNx1t66AiNMzFJG9UgKz_usLYf=OMrz6VonaPkFg@mail.gmail.com>
References: <CAKTKyJJBBFH+rrRZApN79NsKk1Na-ZFR=gZTLxZ1W4UB+V4Xqw@mail.gmail.com>
 <CAKTKyJJj6SpNx1t66AiNMzFJG9UgKz_usLYf=OMrz6VonaPkFg@mail.gmail.com>
Message-ID: <CALFmHhthJ8B6MR-t1FnvfdSDrzjeYHvLVsNPKaysq2HmjsW5NQ@mail.gmail.com>

On Tue, Dec 1, 2020 at 3:08 PM 1520 gis
<juliermeopensourcedeveloper at gmail.com> wrote:
> From: 1520 gis <juliermeopensourcedeveloper at gmail.com>
> Date: Fri, Nov 27, 2020 at 3:14 PM
> Subject: Grep gdalinfo subdataset
> To: <gdal-dev at lists.osgeo.org>
>
>
> Hi all,
>
> I am trying to grep the SUBDATASET_X_NAME in gdalinfo.
> I only need the WCS:url
>
> If I grep the subdataset [1], the string slice "SUBDATASET_5_NAME" comes together. I would like to know if I can get only WCS:url by using any gdalinfo options.
>
> I tried running [2] , but no success.

Just a wild guess:
maybe it is easier to use the `-json` output and parse it (here: quick
Sentinel-2 example, not very elegant):

gdalinfo S2A_MSIL2A_20190912T025541_N0213_R032_T48MYT_20190912T065935.zip
-json | jq ".metadata" | jq ".SUBDATASETS" | jq ".SUBDATASET_2_NAME"
"SENTINEL2_L2A:/vsizip/S2A_MSIL2A_20190912T025541_N0213_R032_T48MYT_20190912T065935.zip/S2A_MSIL2A_20190912T025541_N0213_R032_T48MYT_20190912T065935.SAFE/MTD_MSIL2A.xml:20m:EPSG_32748"

cheers,
Markus

From muro.hector at gmail.com  Tue Dec  1 09:15:32 2020
From: muro.hector at gmail.com (Hector muro)
Date: Tue, 1 Dec 2020 17:15:32 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database table
Message-ID: <CAKdB_X4xA5HJy19idqTkn_3YKvZFpj2Tf1_DKeRZ5zECSMs0tA@mail.gmail.com>

Hi all,

I was wondering if someone knew if it's possible to project or transform
within the same table in a database, using ogr2ogr.

What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and I
would like, using a single command to create an extra column
"geom_wkt_4326" for instance. It does not have to be of type geometry, but
could be text for instance.

I guess the other plausible solution would be to create a temporary table
with that transformation on it and reference it to the first one by id for
instance.

Any help is appreciated!

Thanks,
Hector
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201201/791c88c9/attachment.html>

From brandon.biggs at ski.org  Tue Dec  1 11:40:39 2020
From: brandon.biggs at ski.org (Brandon Biggs)
Date: Tue, 1 Dec 2020 19:40:39 +0000
Subject: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
Message-ID: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>

Hello,
I am wondering how to convert an obj file to a geojson file? I am using ogr2ogr with the command:
Ogr2ogr -f geojson output.geojson input.obj
But get the error that ogr2ogr does not have an OBJ driver. I looked on:
the vector drivers page<https://gdal.org/drivers/vector/index.html>
but am unable to find a simple obj converter. I am wondering if there is such a thing? I am probably going to write my own that does what I want, because OBJ is so simple, I was just wondering if GDAL could already do it.
Thanks,

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201201/2cc30294/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec  1 12:13:43 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 1 Dec 2020 13:13:43 -0700 (MST)
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <CAKdB_X4xA5HJy19idqTkn_3YKvZFpj2Tf1_DKeRZ5zECSMs0tA@mail.gmail.com>
References: <CAKdB_X4xA5HJy19idqTkn_3YKvZFpj2Tf1_DKeRZ5zECSMs0tA@mail.gmail.com>
Message-ID: <1606853623247-0.post@n6.nabble.com>

Hi,

No, unfortunately it is not possible with one ogr2ogr command.

You need two commands and you must use ogrinfo. Here an example about adding
another geometry column and populating it with EPSG:3857 version of original
EPSG:4326 geometries.

ogrinfo PG:"host=localhost port=5432 dbname=test user=user
password=password" -sql "alter table states add column geom2 geometry"

ogrinfo PG:"host=localhost port=5432 dbname=test user=user
password=password" -sql "update states set
geom2=ST_Transform(wkb_geometry,3857)"

You can do all that is possible with SQL also with ogrinfo.


-Jukka Rahkonen-



hectormauer wrote
> Hi all,
> 
> I was wondering if someone knew if it's possible to project or transform
> within the same table in a database, using ogr2ogr.
> 
> What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and I
> would like, using a single command to create an extra column
> "geom_wkt_4326" for instance. It does not have to be of type geometry, but
> could be text for instance.
> 
> I guess the other plausible solution would be to create a temporary table
> with that transformation on it and reference it to the first one by id for
> instance.
> 
> Any help is appreciated!
> 
> Thanks,
> Hector
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From andrew at aitchison.me.uk  Tue Dec  1 12:09:07 2020
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 1 Dec 2020 20:09:07 +0000 (GMT)
Subject: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
In-Reply-To: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
Message-ID: <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>

On Tue, 1 Dec 2020, Brandon Biggs wrote:

> Hello,
> I am wondering how to convert an obj file to a geojson file? I am using ogr2ogr with the command:
> Ogr2ogr -f geojson output.geojson input.obj
> But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> the vector drivers page<https://gdal.org/drivers/vector/index.html>
> but am unable to find a simple obj converter. I am wondering if there is such a thing? I am probably going to write my own that does what I want, because OBJ is so simple, I was just wondering if GDAL could already do it.

I've never heard of OBJ, but that doesn't mean much.

If you only want a read-only ogr driver you might want to look at
 	https://gdal.org/tutorials/vector_python_driver.html
if you would find a quick-n-dirty python quicker to write than C++.

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From muro.hector at gmail.com  Tue Dec  1 12:22:09 2020
From: muro.hector at gmail.com (Hector muro)
Date: Tue, 1 Dec 2020 20:22:09 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <1606853623247-0.post@n6.nabble.com>
References: <CAKdB_X4xA5HJy19idqTkn_3YKvZFpj2Tf1_DKeRZ5zECSMs0tA@mail.gmail.com>
 <1606853623247-0.post@n6.nabble.com>
Message-ID: <CAKdB_X5EeSsu-PsfFS-VoTa3gQkWduyaVF72S83jaA1aNVQj7Q@mail.gmail.com>

Oh, I see. That's great.

But what if the Database does not have ST_Transform support? Could we still
achieve a similar approach by means of ogr2ogr?

(I should have mentioned this in my first email).

Thanks again!
Hector

On Tue, 1 Dec 2020 at 20:14, jratike80 <jukka.rahkonen at maanmittauslaitos.fi>
wrote:

> Hi,
>
> No, unfortunately it is not possible with one ogr2ogr command.
>
> You need two commands and you must use ogrinfo. Here an example about
> adding
> another geometry column and populating it with EPSG:3857 version of
> original
> EPSG:4326 geometries.
>
> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> password=password" -sql "alter table states add column geom2 geometry"
>
> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> password=password" -sql "update states set
> geom2=ST_Transform(wkb_geometry,3857)"
>
> You can do all that is possible with SQL also with ogrinfo.
>
>
> -Jukka Rahkonen-
>
>
>
> hectormauer wrote
> > Hi all,
> >
> > I was wondering if someone knew if it's possible to project or transform
> > within the same table in a database, using ogr2ogr.
> >
> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and I
> > would like, using a single command to create an extra column
> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
> but
> > could be text for instance.
> >
> > I guess the other plausible solution would be to create a temporary table
> > with that transformation on it and reference it to the first one by id
> for
> > instance.
> >
> > Any help is appreciated!
> >
> > Thanks,
> > Hector
> >
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201201/1b299b33/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec  1 12:56:42 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 1 Dec 2020 13:56:42 -0700 (MST)
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <CAKdB_X5EeSsu-PsfFS-VoTa3gQkWduyaVF72S83jaA1aNVQj7Q@mail.gmail.com>
References: <CAKdB_X4xA5HJy19idqTkn_3YKvZFpj2Tf1_DKeRZ5zECSMs0tA@mail.gmail.com>
 <1606853623247-0.post@n6.nabble.com>
 <CAKdB_X5EeSsu-PsfFS-VoTa3gQkWduyaVF72S83jaA1aNVQj7Q@mail.gmail.com>
Message-ID: <1606856202839-0.post@n6.nabble.com>

I would say that it is best to still use ogrinfo. You did not tell what is
your database so I can't tell the exact recipe for you but you will learn
it. You need to know that there are different SQL dialects for GDAL: OGR
SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
are all documented.  If your database does not have native ST_Transform
support then you take it from SQLite/Spatialite. For overriding the native
SQL of your database you may need to use -dialect indirect_SQLite.

Here is another example with a shapefile. A combination of OGR SQL and
SQLite dialects is needed.

Add a new column
ogrinfo -sql "alter table states add wkt_geom text" states.shp

There is space for only 254 charactes in a shapefile and that is not enough
for big polygons but we can do at least something with a little trick. 

ogrinfo -dialect sqlite -sql "update states set
wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp

Check what we got
ogrinfo states.shp -al
...
SERVICE (Real) = 637487.000000000
  MANUAL (Real) = 302635.000000000
  P_MALE (Real) = 0.496000000
  P_FEMALE (Real) = 0.504000000
  SAMP_POP (Real) = 736744.000000000
  wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
  MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
48.21064,-122.507858 48.253971,-122.403137 48....


-Jukka Rahkonen- 




hectormauer wrote
> Oh, I see. That's great.
> 
> But what if the Database does not have ST_Transform support? Could we
> still
> achieve a similar approach by means of ogr2ogr?
> 
> (I should have mentioned this in my first email).
> 
> Thanks again!
> Hector
> 
> On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;

> jukka.rahkonen@

> &gt;
> wrote:
> 
>> Hi,
>>
>> No, unfortunately it is not possible with one ogr2ogr command.
>>
>> You need two commands and you must use ogrinfo. Here an example about
>> adding
>> another geometry column and populating it with EPSG:3857 version of
>> original
>> EPSG:4326 geometries.
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "alter table states add column geom2 geometry"
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "update states set
>> geom2=ST_Transform(wkb_geometry,3857)"
>>
>> You can do all that is possible with SQL also with ogrinfo.
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> hectormauer wrote
>> > Hi all,
>> >
>> > I was wondering if someone knew if it's possible to project or
>> transform
>> > within the same table in a database, using ogr2ogr.
>> >
>> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and
>> I
>> > would like, using a single command to create an extra column
>> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
>> but
>> > could be text for instance.
>> >
>> > I guess the other plausible solution would be to create a temporary
>> table
>> > with that transformation on it and reference it to the first one by id
>> for
>> > instance.
>> >
>> > Any help is appreciated!
>> >
>> > Thanks,
>> > Hector
>> >
>> > _______________________________________________
>> > gdal-dev mailing list
>>
>> > gdal-dev at .osgeo
>>
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>>
>> --
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>> 

> gdal-dev at .osgeo

>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From muro.hector at gmail.com  Tue Dec  1 14:13:51 2020
From: muro.hector at gmail.com (Hector muro)
Date: Tue, 1 Dec 2020 22:13:51 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <1606856202839-0.post@n6.nabble.com>
References: <CAKdB_X4xA5HJy19idqTkn_3YKvZFpj2Tf1_DKeRZ5zECSMs0tA@mail.gmail.com>
 <1606853623247-0.post@n6.nabble.com>
 <CAKdB_X5EeSsu-PsfFS-VoTa3gQkWduyaVF72S83jaA1aNVQj7Q@mail.gmail.com>
 <1606856202839-0.post@n6.nabble.com>
Message-ID: <CAKdB_X51ZRhVAxJUshnH+zkKdQ++Ukapt6F7PDtZjT6azixvkA@mail.gmail.com>

Oh that's a great idea.

I have to use SQL Server (not by personal choice) and had given it a go
with sqlite as dialect, bur was probably too focused on ogr2ogr. I also
didn't know about the "indirect_SQLite" dialect.

I will give a try at what you suggest.

Thanks for the help :)

Hector


On Tue, 1 Dec 2020, 20:56 jratike80, <jukka.rahkonen at maanmittauslaitos.fi>
wrote:

> I would say that it is best to still use ogrinfo. You did not tell what is
> your database so I can't tell the exact recipe for you but you will learn
> it. You need to know that there are different SQL dialects for GDAL: OGR
> SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
> are all documented.  If your database does not have native ST_Transform
> support then you take it from SQLite/Spatialite. For overriding the native
> SQL of your database you may need to use -dialect indirect_SQLite.
>
> Here is another example with a shapefile. A combination of OGR SQL and
> SQLite dialects is needed.
>
> Add a new column
> ogrinfo -sql "alter table states add wkt_geom text" states.shp
>
> There is space for only 254 charactes in a shapefile and that is not enough
> for big polygons but we can do at least something with a little trick.
>
> ogrinfo -dialect sqlite -sql "update states set
> wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp
>
> Check what we got
> ogrinfo states.shp -al
> ...
> SERVICE (Real) = 637487.000000000
>   MANUAL (Real) = 302635.000000000
>   P_MALE (Real) = 0.496000000
>   P_FEMALE (Real) = 0.504000000
>   SAMP_POP (Real) = 736744.000000000
>   wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
>   MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
> 48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
> 48.21064,-122.507858 48.253971,-122.403137 48....
>
>
> -Jukka Rahkonen-
>
>
>
>
> hectormauer wrote
> > Oh, I see. That's great.
> >
> > But what if the Database does not have ST_Transform support? Could we
> > still
> > achieve a similar approach by means of ogr2ogr?
> >
> > (I should have mentioned this in my first email).
> >
> > Thanks again!
> > Hector
> >
> > On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;
>
> > jukka.rahkonen@
>
> > &gt;
> > wrote:
> >
> >> Hi,
> >>
> >> No, unfortunately it is not possible with one ogr2ogr command.
> >>
> >> You need two commands and you must use ogrinfo. Here an example about
> >> adding
> >> another geometry column and populating it with EPSG:3857 version of
> >> original
> >> EPSG:4326 geometries.
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "alter table states add column geom2 geometry"
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "update states set
> >> geom2=ST_Transform(wkb_geometry,3857)"
> >>
> >> You can do all that is possible with SQL also with ogrinfo.
> >>
> >>
> >> -Jukka Rahkonen-
> >>
> >>
> >>
> >> hectormauer wrote
> >> > Hi all,
> >> >
> >> > I was wondering if someone knew if it's possible to project or
> >> transform
> >> > within the same table in a database, using ogr2ogr.
> >> >
> >> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700
> and
> >> I
> >> > would like, using a single command to create an extra column
> >> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
> >> but
> >> > could be text for instance.
> >> >
> >> > I guess the other plausible solution would be to create a temporary
> >> table
> >> > with that transformation on it and reference it to the first one by id
> >> for
> >> > instance.
> >> >
> >> > Any help is appreciated!
> >> >
> >> > Thanks,
> >> > Hector
> >> >
> >> > _______________________________________________
> >> > gdal-dev mailing list
> >>
> >> > gdal-dev at .osgeo
> >>
> >> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >>
> >>
> >>
> >>
> >> --
> >> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> >> _______________________________________________
> >> gdal-dev mailing list
> >>
>
> > gdal-dev at .osgeo
>
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201201/55c35b6a/attachment-0001.html>

From even.rouault at spatialys.com  Wed Dec  2 02:04:17 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 02 Dec 2020 11:04:17 +0100
Subject: [gdal-dev] gdal_create: input file option
In-Reply-To: <3044ca7837634d7cb7f288e10150dbda@maanmittauslaitos.fi>
References: <3044ca7837634d7cb7f288e10150dbda@maanmittauslaitos.fi>
Message-ID: <3491985.JaXWAuQ7dA@even-i700>

On mardi 1 d?cembre 2020 13:23:58 CET Rahkonen Jukka (MML) wrote:
> Hi,
> 
> Every now and then people would like to rasterize vectors into raster that
> matches exactly with some existing raster. There are a few possible ways
> for creating an empty copy from a raster with GDAL tools
> https://gis.stackexchange.com/questions/220753/how-do-i-create-blank-geotif
> f-with-same-spatial-properties-as-existing-geotiff . The gdal_merge way with
> -createonly does the job and is fast, but who remembers that gdal_merge
> exists and can be used for such purpose? How about to add an option like
> "-if" (input file) into gdal_create program, with the same effect? Options
> -outsize, -a_srs, -a_ullr would have no effect if used together with input
> template file. Options -of, -bands, -ot, -a_nodata, -co could override if
> given. Not sure about metadata, but probably it is never worth copying from
> the template file.

I've mostly followed your suggestion in
https://github.com/OSGeo/gdal/pull/3255

Not sure if it will be useful, but to avoid too many exceptions, -outsize, -a-
srs, -a_ullr can actually override the settings of the input file

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From muro.hector at gmail.com  Wed Dec  2 02:12:57 2020
From: muro.hector at gmail.com (Hector muro)
Date: Wed, 2 Dec 2020 10:12:57 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <1606856202839-0.post@n6.nabble.com>
References: <CAKdB_X4xA5HJy19idqTkn_3YKvZFpj2Tf1_DKeRZ5zECSMs0tA@mail.gmail.com>
 <1606853623247-0.post@n6.nabble.com>
 <CAKdB_X5EeSsu-PsfFS-VoTa3gQkWduyaVF72S83jaA1aNVQj7Q@mail.gmail.com>
 <1606856202839-0.post@n6.nabble.com>
Message-ID: <CAKdB_X4SwarMLSXH_49gUV7YxxJ-yiPD5X9-v2sg7QjrA9UHHA@mail.gmail.com>

Hi again,

I've given your idea a go:

ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> =
ST_AsText(ST_Transform(geometry),4326)" --config
MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"

This connects correctly, as I get this message:

INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC
Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

But it can't read/find the table in the update statement:

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set
<text_geom> = ST_AsText(ST_Transform(geometry),4326)):
  no such table: <table_name>

(I have tried different versions of the table name, quoting, unquoting,
adding the Schema name . table name, with the same results.) I now wonder
if the sqlite dialect can't really read what's inside my SQL Server
instance? Is it maybe too much what I am trying to do? (too much for SQL
Server's limitations).

Thanks again,
Hector

On Tue, 1 Dec 2020 at 20:56, jratike80 <jukka.rahkonen at maanmittauslaitos.fi>
wrote:

> I would say that it is best to still use ogrinfo. You did not tell what is
> your database so I can't tell the exact recipe for you but you will learn
> it. You need to know that there are different SQL dialects for GDAL: OGR
> SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
> are all documented.  If your database does not have native ST_Transform
> support then you take it from SQLite/Spatialite. For overriding the native
> SQL of your database you may need to use -dialect indirect_SQLite.
>
> Here is another example with a shapefile. A combination of OGR SQL and
> SQLite dialects is needed.
>
> Add a new column
> ogrinfo -sql "alter table states add wkt_geom text" states.shp
>
> There is space for only 254 charactes in a shapefile and that is not enough
> for big polygons but we can do at least something with a little trick.
>
> ogrinfo -dialect sqlite -sql "update states set
> wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp
>
> Check what we got
> ogrinfo states.shp -al
> ...
> SERVICE (Real) = 637487.000000000
>   MANUAL (Real) = 302635.000000000
>   P_MALE (Real) = 0.496000000
>   P_FEMALE (Real) = 0.504000000
>   SAMP_POP (Real) = 736744.000000000
>   wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
>   MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
> 48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
> 48.21064,-122.507858 48.253971,-122.403137 48....
>
>
> -Jukka Rahkonen-
>
>
>
>
> hectormauer wrote
> > Oh, I see. That's great.
> >
> > But what if the Database does not have ST_Transform support? Could we
> > still
> > achieve a similar approach by means of ogr2ogr?
> >
> > (I should have mentioned this in my first email).
> >
> > Thanks again!
> > Hector
> >
> > On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;
>
> > jukka.rahkonen@
>
> > &gt;
> > wrote:
> >
> >> Hi,
> >>
> >> No, unfortunately it is not possible with one ogr2ogr command.
> >>
> >> You need two commands and you must use ogrinfo. Here an example about
> >> adding
> >> another geometry column and populating it with EPSG:3857 version of
> >> original
> >> EPSG:4326 geometries.
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "alter table states add column geom2 geometry"
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "update states set
> >> geom2=ST_Transform(wkb_geometry,3857)"
> >>
> >> You can do all that is possible with SQL also with ogrinfo.
> >>
> >>
> >> -Jukka Rahkonen-
> >>
> >>
> >>
> >> hectormauer wrote
> >> > Hi all,
> >> >
> >> > I was wondering if someone knew if it's possible to project or
> >> transform
> >> > within the same table in a database, using ogr2ogr.
> >> >
> >> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700
> and
> >> I
> >> > would like, using a single command to create an extra column
> >> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
> >> but
> >> > could be text for instance.
> >> >
> >> > I guess the other plausible solution would be to create a temporary
> >> table
> >> > with that transformation on it and reference it to the first one by id
> >> for
> >> > instance.
> >> >
> >> > Any help is appreciated!
> >> >
> >> > Thanks,
> >> > Hector
> >> >
> >> > _______________________________________________
> >> > gdal-dev mailing list
> >>
> >> > gdal-dev at .osgeo
> >>
> >> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >>
> >>
> >>
> >>
> >> --
> >> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> >> _______________________________________________
> >> gdal-dev mailing list
> >>
>
> > gdal-dev at .osgeo
>
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/fedaa23c/attachment.html>

From ahuarte47 at yahoo.es  Wed Dec  2 02:22:18 2020
From: ahuarte47 at yahoo.es (A Huarte)
Date: Wed, 2 Dec 2020 10:22:18 +0000 (UTC)
Subject: [gdal-dev] Creating a MVT cache with ogr2ogr but using the
 EPSG:25830 CRS...
References: <1485978028.6952310.1606904538163.ref@mail.yahoo.com>
Message-ID: <1485978028.6952310.1606904538163@mail.yahoo.com>

Hi everyone,
I would create a Mapbox Vector Tile cache using ogr2ogr and?MVT: Mapbox Vector Tiles ? GDAL documentation?but writing the files in the EPSG:25830 projection. Later I want to show this layer in one OpenLayers map viewer with this CRS as map system reference.
I have read the driver provides the TILINGS_SCHEME parameter:

TILING_SCHEME=crs,tile_origin_upper_left_x,tile_origin_upper_left_y, tile_dimension_zoom_0: Define a custom tiling scheme with a CRS (typically given as EPSG:XXXX), the coordinates of the upper-left corner of the upper-left tile (0,0) in the CRS, and the dimension of the tile at zoom level 0. Only available for FORMAT=DIRECTORY. The standard WebMercator tiling scheme would be defined by ?EPSG:3857,-20037508.343,20037508.343,40075016.686?. A tiling scheme for WGS84 geodetic could be ?EPSG:4326,-180,180,360?. The tiling scheme for Finnish ETRS-TM35FIN (EPSG:3067) is ?EPSG:3067,-548576,8388608,2097152?. When using such as custom tiling scheme, the ?crs?, ?tile_origin_upper_left_x?, ?tile_origin_upper_left_y? and ?tile_dimension_zoom_0? entries are added to the metadata.json, and are honoured by the OGR MVT reader.
?How can I get these metadata values for my CRS? Any way, is it a good pratice using another CRS that EPSG:3857? Otherwise, what do you recommend me??
Thanks in advanceAlvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/6adb3f02/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec  2 02:29:01 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 2 Dec 2020 10:29:01 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
Message-ID: <bc59ae2ef8f343f7a72b67eea4943547@maanmittauslaitos.fi>

Hi,

I am not familiar with SQL server but your table name may require quotation marks " " and they require escaping with \ so that they do not close the SQL statement. Try
-sql "update \"table_name\" set ?. "

Simple test to verify if the problem is caused by the unquoted table name is to run ogrinfo with
-sql "select * from table_name limit 1".

-Jukka-





L?hett?j?: Hector muro <muro.hector at gmail.com>
L?hetetty: keskiviikko 2. joulukuuta 2020 12.13
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi again,

I've given your idea a go:

ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> = ST_AsText(ST_Transform(geometry),4326)" --config MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"

This connects correctly, as I get this message:

INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

But it can't read/find the table in the update statement:

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set  <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
  no such table: <table_name>

(I have tried different versions of the table name, quoting, unquoting, adding the Schema name . table name, with the same results.) I now wonder if the sqlite dialect can't really read what's inside my SQL Server instance? Is it maybe too much what I am trying to do? (too much for SQL Server's limitations).

Thanks again,
Hector

On Tue, 1 Dec 2020 at 20:56, jratike80 <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
I would say that it is best to still use ogrinfo. You did not tell what is
your database so I can't tell the exact recipe for you but you will learn
it. You need to know that there are different SQL dialects for GDAL: OGR
SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
are all documented.  If your database does not have native ST_Transform
support then you take it from SQLite/Spatialite. For overriding the native
SQL of your database you may need to use -dialect indirect_SQLite.

Here is another example with a shapefile. A combination of OGR SQL and
SQLite dialects is needed.

Add a new column
ogrinfo -sql "alter table states add wkt_geom text" states.shp

There is space for only 254 charactes in a shapefile and that is not enough
for big polygons but we can do at least something with a little trick.

ogrinfo -dialect sqlite -sql "update states set
wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp

Check what we got
ogrinfo states.shp -al
...
SERVICE (Real) = 637487.000000000
  MANUAL (Real) = 302635.000000000
  P_MALE (Real) = 0.496000000
  P_FEMALE (Real) = 0.504000000
  SAMP_POP (Real) = 736744.000000000
  wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
  MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
48.21064,-122.507858 48.253971,-122.403137 48....


-Jukka Rahkonen-




hectormauer wrote
> Oh, I see. That's great.
>
> But what if the Database does not have ST_Transform support? Could we
> still
> achieve a similar approach by means of ogr2ogr?
>
> (I should have mentioned this in my first email).
>
> Thanks again!
> Hector
>
> On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;

> jukka.rahkonen@<mailto:jukka.rahkonen@>

> &gt;
> wrote:
>
>> Hi,
>>
>> No, unfortunately it is not possible with one ogr2ogr command.
>>
>> You need two commands and you must use ogrinfo. Here an example about
>> adding
>> another geometry column and populating it with EPSG:3857 version of
>> original
>> EPSG:4326 geometries.
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "alter table states add column geom2 geometry"
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "update states set
>> geom2=ST_Transform(wkb_geometry,3857)"
>>
>> You can do all that is possible with SQL also with ogrinfo.
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> hectormauer wrote
>> > Hi all,
>> >
>> > I was wondering if someone knew if it's possible to project or
>> transform
>> > within the same table in a database, using ogr2ogr.
>> >
>> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and
>> I
>> > would like, using a single command to create an extra column
>> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
>> but
>> > could be text for instance.
>> >
>> > I guess the other plausible solution would be to create a temporary
>> table
>> > with that transformation on it and reference it to the first one by id
>> for
>> > instance.
>> >
>> > Any help is appreciated!
>> >
>> > Thanks,
>> > Hector
>> >
>> > _______________________________________________
>> > gdal-dev mailing list
>>
>> > gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>
>>
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>>
>> --
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>>

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/ab5ccbac/attachment-0001.html>

From runette at gmail.com  Wed Dec  2 02:31:34 2020
From: runette at gmail.com (Paul Harwood)
Date: Wed, 2 Dec 2020 10:31:34 +0000
Subject: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
In-Reply-To: <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
 <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>
Message-ID: <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>

.OBJ is a simple object mesh  (or to put it in more traditional terms: TIN)
- it has shape but no data values and is not geolocated.

I don't think there is any driver for OGR that will read .OBJ.

You are going to problems with geolocation if you write your own. Geojson
requires that the geometries are geolocated - and in the current version
that they are in epsg:4326. That is not totally impossible - people have
been using .dxf files for gis data for decades and that format is also not
in theory geolocated. It is not a trivial problem though.

I guess I would ask the usual question .. why?

- what are you actually trying to achieve and why a GIS format like GeoJSON?

- If you have to use GeoJSON - I am guessing you are transferring some data
to something that reads GeoJSON only? In that case - can your source
produce .dxf? OGR can read .dxf.

- If you only have the source in .OBJ - what other formats can the
destination read? Although, if you only have the source in .obj, I very
much doubt any of the GIS tools like GDAL are going to be able to help you.
It just is not a format used in GIS.

It is a problem we solved in the ViRGiS projec <http://www.virgis.org>t -
since .obj is used a lot in VR. There we used an existing library to read
the .obj files - but that is in C# and I doubt that would help you.

On Tue, 1 Dec 2020 at 20:15, Andrew C Aitchison <andrew at aitchison.me.uk>
wrote:

> On Tue, 1 Dec 2020, Brandon Biggs wrote:
>
> > Hello,
> > I am wondering how to convert an obj file to a geojson file? I am using
> ogr2ogr with the command:
> > Ogr2ogr -f geojson output.geojson input.obj
> > But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> > the vector drivers page<https://gdal.org/drivers/vector/index.html>
> > but am unable to find a simple obj converter. I am wondering if there is
> such a thing? I am probably going to write my own that does what I want,
> because OBJ is so simple, I was just wondering if GDAL could already do it.
>
> I've never heard of OBJ, but that doesn't mean much.
>
> If you only want a read-only ogr driver you might want to look at
>         https://gdal.org/tutorials/vector_python_driver.html
> if you would find a quick-n-dirty python quicker to write than C++.
>
> --
> Andrew C. Aitchison                                     Kendal, UK
>                         andrew at aitchison.me.uk
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/d2c60650/attachment.html>

From muro.hector at gmail.com  Wed Dec  2 02:36:39 2020
From: muro.hector at gmail.com (Hector muro)
Date: Wed, 2 Dec 2020 10:36:39 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <bc59ae2ef8f343f7a72b67eea4943547@maanmittauslaitos.fi>
References: <bc59ae2ef8f343f7a72b67eea4943547@maanmittauslaitos.fi>
Message-ID: <CAKdB_X7vHZvxEFhqMYs1YQ0ykUzwuZkHWgrVGhPdQbc1CyZ9LA@mail.gmail.com>

Hi,

Yeah, I did try that, with the same result. the test with "sql" (no
dialect) returns correct.

ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :

[dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data"
"$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
Driver 17 for SQL Server][SQL Server]There is already an object named
'geometry_columns' in the database.(2714)
INFO: Open of
`MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC
Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
PROJCRS["OSGB 1936 / British National Grid",
    BASEGEOGCRS["OSGB 1936",
        DATUM["OSGB 1936",
            ELLIPSOID["Airy 1830",6377563.396,299.3249646,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4277]],
    CONVERSION["British National Grid",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",49,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-2,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996012717,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",400000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",-100000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["unknown"],
        AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to 3?33'E"],
        BBOX[49.75,-9.2,61.14,2.88]],
    ID["EPSG",27700]]
Data axis to CRS axis mapping: 1,2
Geometry Column = geometry
[...]

So, it is not the formatting, but rather what I supposed that sqlite has no
visibility over the SQL Server schema, which surprises me a bit, since it
can actually connect using the MSSQLSpatial Driver and retrieve info
without it.

Thanks
Hector

On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> I am not familiar with SQL server but your table name may require
> quotation marks " " and they require escaping with \ so that they do not
> close the SQL statement. Try
>
> -sql "update \"table_name\" set ?. "
>
>
>
> Simple test to verify if the problem is caused by the unquoted table name
> is to run ogrinfo with
>
> -sql "select * from table_name limit 1".
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.13
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi again,
>
>
>
> I've given your idea a go:
>
>
>
> ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> =
> ST_AsText(ST_Transform(geometry),4326)" --config
> MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
>
>
>
> This connects correctly, as I get this message:
>
>
>
> INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
>
>
> But it can't read/find the table in the update statement:
>
>
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set
> <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
>   no such table: <table_name>
>
>
>
> (I have tried different versions of the table name, quoting, unquoting,
> adding the Schema name . table name, with the same results.) I now wonder
> if the sqlite dialect can't really read what's inside my SQL Server
> instance? Is it maybe too much what I am trying to do? (too much for SQL
> Server's limitations).
>
>
>
> Thanks again,
>
> Hector
>
>
>
> On Tue, 1 Dec 2020 at 20:56, jratike80 <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> I would say that it is best to still use ogrinfo. You did not tell what is
> your database so I can't tell the exact recipe for you but you will learn
> it. You need to know that there are different SQL dialects for GDAL: OGR
> SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
> are all documented.  If your database does not have native ST_Transform
> support then you take it from SQLite/Spatialite. For overriding the native
> SQL of your database you may need to use -dialect indirect_SQLite.
>
> Here is another example with a shapefile. A combination of OGR SQL and
> SQLite dialects is needed.
>
> Add a new column
> ogrinfo -sql "alter table states add wkt_geom text" states.shp
>
> There is space for only 254 charactes in a shapefile and that is not enough
> for big polygons but we can do at least something with a little trick.
>
> ogrinfo -dialect sqlite -sql "update states set
> wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp
>
> Check what we got
> ogrinfo states.shp -al
> ...
> SERVICE (Real) = 637487.000000000
>   MANUAL (Real) = 302635.000000000
>   P_MALE (Real) = 0.496000000
>   P_FEMALE (Real) = 0.504000000
>   SAMP_POP (Real) = 736744.000000000
>   wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
>   MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
> 48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
> 48.21064,-122.507858 48.253971,-122.403137 48....
>
>
> -Jukka Rahkonen-
>
>
>
>
> hectormauer wrote
> > Oh, I see. That's great.
> >
> > But what if the Database does not have ST_Transform support? Could we
> > still
> > achieve a similar approach by means of ogr2ogr?
> >
> > (I should have mentioned this in my first email).
> >
> > Thanks again!
> > Hector
> >
> > On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;
>
> > jukka.rahkonen@
>
> > &gt;
> > wrote:
> >
> >> Hi,
> >>
> >> No, unfortunately it is not possible with one ogr2ogr command.
> >>
> >> You need two commands and you must use ogrinfo. Here an example about
> >> adding
> >> another geometry column and populating it with EPSG:3857 version of
> >> original
> >> EPSG:4326 geometries.
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "alter table states add column geom2 geometry"
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "update states set
> >> geom2=ST_Transform(wkb_geometry,3857)"
> >>
> >> You can do all that is possible with SQL also with ogrinfo.
> >>
> >>
> >> -Jukka Rahkonen-
> >>
> >>
> >>
> >> hectormauer wrote
> >> > Hi all,
> >> >
> >> > I was wondering if someone knew if it's possible to project or
> >> transform
> >> > within the same table in a database, using ogr2ogr.
> >> >
> >> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700
> and
> >> I
> >> > would like, using a single command to create an extra column
> >> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
> >> but
> >> > could be text for instance.
> >> >
> >> > I guess the other plausible solution would be to create a temporary
> >> table
> >> > with that transformation on it and reference it to the first one by id
> >> for
> >> > instance.
> >> >
> >> > Any help is appreciated!
> >> >
> >> > Thanks,
> >> > Hector
> >> >
> >> > _______________________________________________
> >> > gdal-dev mailing list
> >>
> >> > gdal-dev at .osgeo
> >>
> >> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >>
> >>
> >>
> >>
> >> --
> >> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> >> _______________________________________________
> >> gdal-dev mailing list
> >>
>
> > gdal-dev at .osgeo
>
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/7d659f26/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec  2 02:55:03 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 2 Dec 2020 10:55:03 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
Message-ID: <19326fb3031e4210bbdf74288dac29a2@maanmittauslaitos.fi>

Hi,

Sorry, I can?t follow what did you test. Do you mean that
ogrinfo -dialect SQLite -sql "select * from crown_site_data limit 1" "$connect_string"

returns just an error? And the same with
ogrinfo -dialect SQLite -sql "select * from \"crown_site_data\" limit 1" "$connect_string"

Try also with ?-dialect ogrsql? even that dialect does  not have those ST_ functions that you need.

-Jukka-







L?hett?j?: Hector muro <muro.hector at gmail.com>
L?hetetty: keskiviikko 2. joulukuuta 2020 12.37
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi,

Yeah, I did try that, with the same result. the test with "sql" (no dialect) returns correct.

ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :

[dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
PROJCRS["OSGB 1936 / British National Grid",
    BASEGEOGCRS["OSGB 1936",
        DATUM["OSGB 1936",
            ELLIPSOID["Airy 1830",6377563.396,299.3249646,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4277]],
    CONVERSION["British National Grid",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",49,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-2,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996012717,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",400000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",-100000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["unknown"],
        AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to 3?33'E"],
        BBOX[49.75,-9.2,61.14,2.88]],
    ID["EPSG",27700]]
Data axis to CRS axis mapping: 1,2
Geometry Column = geometry
[...]

So, it is not the formatting, but rather what I supposed that sqlite has no visibility over the SQL Server schema, which surprises me a bit, since it can actually connect using the MSSQLSpatial Driver and retrieve info without it.

Thanks
Hector

On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

I am not familiar with SQL server but your table name may require quotation marks " " and they require escaping with \ so that they do not close the SQL statement. Try
-sql "update \"table_name\" set ?. "

Simple test to verify if the problem is caused by the unquoted table name is to run ogrinfo with
-sql "select * from table_name limit 1".

-Jukka-





L?hett?j?: Hector muro <muro.hector at gmail.com<mailto:muro.hector at gmail.com>>
L?hetetty: keskiviikko 2. joulukuuta 2020 12.13
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi again,

I've given your idea a go:

ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> = ST_AsText(ST_Transform(geometry),4326)" --config MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"

This connects correctly, as I get this message:

INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

But it can't read/find the table in the update statement:

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set  <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
  no such table: <table_name>

(I have tried different versions of the table name, quoting, unquoting, adding the Schema name . table name, with the same results.) I now wonder if the sqlite dialect can't really read what's inside my SQL Server instance? Is it maybe too much what I am trying to do? (too much for SQL Server's limitations).

Thanks again,
Hector

On Tue, 1 Dec 2020 at 20:56, jratike80 <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
I would say that it is best to still use ogrinfo. You did not tell what is
your database so I can't tell the exact recipe for you but you will learn
it. You need to know that there are different SQL dialects for GDAL: OGR
SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
are all documented.  If your database does not have native ST_Transform
support then you take it from SQLite/Spatialite. For overriding the native
SQL of your database you may need to use -dialect indirect_SQLite.

Here is another example with a shapefile. A combination of OGR SQL and
SQLite dialects is needed.

Add a new column
ogrinfo -sql "alter table states add wkt_geom text" states.shp

There is space for only 254 charactes in a shapefile and that is not enough
for big polygons but we can do at least something with a little trick.

ogrinfo -dialect sqlite -sql "update states set
wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp

Check what we got
ogrinfo states.shp -al
...
SERVICE (Real) = 637487.000000000
  MANUAL (Real) = 302635.000000000
  P_MALE (Real) = 0.496000000
  P_FEMALE (Real) = 0.504000000
  SAMP_POP (Real) = 736744.000000000
  wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
  MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
48.21064,-122.507858 48.253971,-122.403137 48....


-Jukka Rahkonen-




hectormauer wrote
> Oh, I see. That's great.
>
> But what if the Database does not have ST_Transform support? Could we
> still
> achieve a similar approach by means of ogr2ogr?
>
> (I should have mentioned this in my first email).
>
> Thanks again!
> Hector
>
> On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;

> jukka.rahkonen@<mailto:jukka.rahkonen@>

> &gt;
> wrote:
>
>> Hi,
>>
>> No, unfortunately it is not possible with one ogr2ogr command.
>>
>> You need two commands and you must use ogrinfo. Here an example about
>> adding
>> another geometry column and populating it with EPSG:3857 version of
>> original
>> EPSG:4326 geometries.
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "alter table states add column geom2 geometry"
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "update states set
>> geom2=ST_Transform(wkb_geometry,3857)"
>>
>> You can do all that is possible with SQL also with ogrinfo.
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> hectormauer wrote
>> > Hi all,
>> >
>> > I was wondering if someone knew if it's possible to project or
>> transform
>> > within the same table in a database, using ogr2ogr.
>> >
>> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and
>> I
>> > would like, using a single command to create an extra column
>> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
>> but
>> > could be text for instance.
>> >
>> > I guess the other plausible solution would be to create a temporary
>> table
>> > with that transformation on it and reference it to the first one by id
>> for
>> > instance.
>> >
>> > Any help is appreciated!
>> >
>> > Thanks,
>> > Hector
>> >
>> > _______________________________________________
>> > gdal-dev mailing list
>>
>> > gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>
>>
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>>
>> --
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>>

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/00291f7e/attachment-0001.html>

From muro.hector at gmail.com  Wed Dec  2 03:02:25 2020
From: muro.hector at gmail.com (Hector muro)
Date: Wed, 2 Dec 2020 11:02:25 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <19326fb3031e4210bbdf74288dac29a2@maanmittauslaitos.fi>
References: <19326fb3031e4210bbdf74288dac29a2@maanmittauslaitos.fi>
Message-ID: <CAKdB_X7OzkgXfw6DtTVKDOm4n6iFQkduR_Ds9Xchi2Xvc_bW_A@mail.gmail.com>

Hi,

Sorry, no, I meant that, using the flag dialect returns an error of "Table
not found", but using the -sql flag without dialect returns records for
that table.

Therefor I believe the "problem" is with the dialect, here:

[dev at localhost ~]$ ogrinfo -dialect ogrsql -sql "select top(1) * from xxx"
"$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
Driver 17 for SQL Server][SQL Server]There is already an object named
'geometry_columns' in the database.(2714)
INFO: Open of
`MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
for SQL Server'
      using driver `MSSQLSpatial' successful.
ERROR 1: SELECT from table xxxfailed, no such table/featureclass.

[dev at localhost ~]$ ogrinfo -dialect sqlite -sql "select top(1) * from xxx"
"$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
Driver 17 for SQL Server][SQL Server]There is already an object named
'geometry_columns' in the database.(2714)
INFO: Open of
`MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
for SQL Server'
      using driver `MSSQLSpatial' successful.
ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select * from crown_site_data
limit 1):
  no such table: xxx

But, if I do not set the dialect, i.e. direct sql:

[dev at localhost ~]$ ogrinfo -sql "select top(1) * from xxx" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
Driver 17 for SQL Server][SQL Server]There is already an object named
'geometry_columns' in the database.(2714)
INFO: Open of
`MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
for SQL Server'
      using driver `MSSQLSpatial' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
PROJCRS["OSGB 1936 / British National Grid",
    BASEGEOGCRS["OSGB 1936",

What do you think? I wouldn't be surprised if SQL Server was blocking this
somehow, or there was some implementation missing.

Thanks
Hector

On Wed, 2 Dec 2020 at 10:55, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Sorry, I can?t follow what did you test. Do you mean that
>
> ogrinfo -dialect SQLite -sql "select * from crown_site_data limit 1"
> "$connect_string"
>
>
>
> returns just an error? And the same with
>
> ogrinfo -dialect SQLite -sql "select * from \"crown_site_data\" limit 1"
> "$connect_string"
>
>
>
> Try also with ?-dialect ogrsql? even that dialect does  not have those ST_
> functions that you need.
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.37
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi,
>
>
>
> Yeah, I did try that, with the same result. the test with "sql" (no
> dialect) returns correct.
>
>
>
> ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :
>
>
>
> [dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data"
> "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
> Layer name: SELECT
> Geometry: Unknown (any)
> Feature Count: 1
> Layer SRS WKT:
> PROJCRS["OSGB 1936 / British National Grid",
>     BASEGEOGCRS["OSGB 1936",
>         DATUM["OSGB 1936",
>             ELLIPSOID["Airy 1830",6377563.396,299.3249646,
>                 LENGTHUNIT["metre",1]]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["degree",0.0174532925199433]],
>         ID["EPSG",4277]],
>     CONVERSION["British National Grid",
>         METHOD["Transverse Mercator",
>             ID["EPSG",9807]],
>         PARAMETER["Latitude of natural origin",49,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8801]],
>         PARAMETER["Longitude of natural origin",-2,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8802]],
>         PARAMETER["Scale factor at natural origin",0.9996012717,
>             SCALEUNIT["unity",1],
>             ID["EPSG",8805]],
>         PARAMETER["False easting",400000,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8806]],
>         PARAMETER["False northing",-100000,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8807]]],
>     CS[Cartesian,2],
>         AXIS["(E)",east,
>             ORDER[1],
>             LENGTHUNIT["metre",1]],
>         AXIS["(N)",north,
>             ORDER[2],
>             LENGTHUNIT["metre",1]],
>     USAGE[
>         SCOPE["unknown"],
>         AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to 3?33'E"],
>         BBOX[49.75,-9.2,61.14,2.88]],
>     ID["EPSG",27700]]
> Data axis to CRS axis mapping: 1,2
> Geometry Column = geometry
> [...]
>
>
>
> So, it is not the formatting, but rather what I supposed that sqlite has
> no visibility over the SQL Server schema, which surprises me a bit, since
> it can actually connect using the MSSQLSpatial Driver and retrieve info
> without it.
>
>
>
> Thanks
>
> Hector
>
>
>
> On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> I am not familiar with SQL server but your table name may require
> quotation marks " " and they require escaping with \ so that they do not
> close the SQL statement. Try
>
> -sql "update \"table_name\" set ?. "
>
>
>
> Simple test to verify if the problem is caused by the unquoted table name
> is to run ogrinfo with
>
> -sql "select * from table_name limit 1".
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.13
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi again,
>
>
>
> I've given your idea a go:
>
>
>
> ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> =
> ST_AsText(ST_Transform(geometry),4326)" --config
> MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
>
>
>
> This connects correctly, as I get this message:
>
>
>
> INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
>
>
> But it can't read/find the table in the update statement:
>
>
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set
> <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
>   no such table: <table_name>
>
>
>
> (I have tried different versions of the table name, quoting, unquoting,
> adding the Schema name . table name, with the same results.) I now wonder
> if the sqlite dialect can't really read what's inside my SQL Server
> instance? Is it maybe too much what I am trying to do? (too much for SQL
> Server's limitations).
>
>
>
> Thanks again,
>
> Hector
>
>
>
> On Tue, 1 Dec 2020 at 20:56, jratike80 <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> I would say that it is best to still use ogrinfo. You did not tell what is
> your database so I can't tell the exact recipe for you but you will learn
> it. You need to know that there are different SQL dialects for GDAL: OGR
> SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
> are all documented.  If your database does not have native ST_Transform
> support then you take it from SQLite/Spatialite. For overriding the native
> SQL of your database you may need to use -dialect indirect_SQLite.
>
> Here is another example with a shapefile. A combination of OGR SQL and
> SQLite dialects is needed.
>
> Add a new column
> ogrinfo -sql "alter table states add wkt_geom text" states.shp
>
> There is space for only 254 charactes in a shapefile and that is not enough
> for big polygons but we can do at least something with a little trick.
>
> ogrinfo -dialect sqlite -sql "update states set
> wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp
>
> Check what we got
> ogrinfo states.shp -al
> ...
> SERVICE (Real) = 637487.000000000
>   MANUAL (Real) = 302635.000000000
>   P_MALE (Real) = 0.496000000
>   P_FEMALE (Real) = 0.504000000
>   SAMP_POP (Real) = 736744.000000000
>   wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
>   MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
> 48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
> 48.21064,-122.507858 48.253971,-122.403137 48....
>
>
> -Jukka Rahkonen-
>
>
>
>
> hectormauer wrote
> > Oh, I see. That's great.
> >
> > But what if the Database does not have ST_Transform support? Could we
> > still
> > achieve a similar approach by means of ogr2ogr?
> >
> > (I should have mentioned this in my first email).
> >
> > Thanks again!
> > Hector
> >
> > On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;
>
> > jukka.rahkonen@
>
> > &gt;
> > wrote:
> >
> >> Hi,
> >>
> >> No, unfortunately it is not possible with one ogr2ogr command.
> >>
> >> You need two commands and you must use ogrinfo. Here an example about
> >> adding
> >> another geometry column and populating it with EPSG:3857 version of
> >> original
> >> EPSG:4326 geometries.
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "alter table states add column geom2 geometry"
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "update states set
> >> geom2=ST_Transform(wkb_geometry,3857)"
> >>
> >> You can do all that is possible with SQL also with ogrinfo.
> >>
> >>
> >> -Jukka Rahkonen-
> >>
> >>
> >>
> >> hectormauer wrote
> >> > Hi all,
> >> >
> >> > I was wondering if someone knew if it's possible to project or
> >> transform
> >> > within the same table in a database, using ogr2ogr.
> >> >
> >> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700
> and
> >> I
> >> > would like, using a single command to create an extra column
> >> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
> >> but
> >> > could be text for instance.
> >> >
> >> > I guess the other plausible solution would be to create a temporary
> >> table
> >> > with that transformation on it and reference it to the first one by id
> >> for
> >> > instance.
> >> >
> >> > Any help is appreciated!
> >> >
> >> > Thanks,
> >> > Hector
> >> >
> >> > _______________________________________________
> >> > gdal-dev mailing list
> >>
> >> > gdal-dev at .osgeo
> >>
> >> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >>
> >>
> >>
> >>
> >> --
> >> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> >> _______________________________________________
> >> gdal-dev mailing list
> >>
>
> > gdal-dev at .osgeo
>
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/0b52907c/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec  2 03:14:51 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 2 Dec 2020 11:14:51 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
Message-ID: <3b0ff817016b40a3b844cff628539c41@maanmittauslaitos.fi>

Hi,

Try also with ?-dialect indirect_sqlite? but it should not make difference in this case. Then
I must give up, hopefully somebody who has access to SQL server can continue. Before that one more hint: If you do not define a dialect the you are using the native SQL server SQL dialect. SQL server understands what top(1) means but SQLite and OGRSQL do not. If you manage to get so far you would see this error with SQLite dialect:

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) from underscore_test):
  no such function: top

-Jukka-



L?hett?j?: Hector muro <muro.hector at gmail.com>
L?hetetty: keskiviikko 2. joulukuuta 2020 13.02
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi,

Sorry, no, I meant that, using the flag dialect returns an error of "Table not found", but using the -sql flag without dialect returns records for that table.

Therefor I believe the "problem" is with the dialect, here:

[dev at localhost ~]$ ogrinfo -dialect ogrsql -sql "select top(1) * from xxx" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.
ERROR 1: SELECT from table xxxfailed, no such table/featureclass.
[dev at localhost ~]$ ogrinfo -dialect sqlite -sql "select top(1) * from xxx" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.
ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select * from crown_site_data limit 1):
  no such table: xxx

But, if I do not set the dialect, i.e. direct sql:

[dev at localhost ~]$ ogrinfo -sql "select top(1) * from xxx" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
PROJCRS["OSGB 1936 / British National Grid",
    BASEGEOGCRS["OSGB 1936",

What do you think? I wouldn't be surprised if SQL Server was blocking this somehow, or there was some implementation missing.

Thanks
Hector

On Wed, 2 Dec 2020 at 10:55, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Sorry, I can?t follow what did you test. Do you mean that
ogrinfo -dialect SQLite -sql "select * from crown_site_data limit 1" "$connect_string"

returns just an error? And the same with
ogrinfo -dialect SQLite -sql "select * from \"crown_site_data\" limit 1" "$connect_string"

Try also with ?-dialect ogrsql? even that dialect does  not have those ST_ functions that you need.

-Jukka-






L?hett?j?: Hector muro <muro.hector at gmail.com<mailto:muro.hector at gmail.com>>
L?hetetty: keskiviikko 2. joulukuuta 2020 12.37
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi,

Yeah, I did try that, with the same result. the test with "sql" (no dialect) returns correct.

ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :

[dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
PROJCRS["OSGB 1936 / British National Grid",
    BASEGEOGCRS["OSGB 1936",
        DATUM["OSGB 1936",
            ELLIPSOID["Airy 1830",6377563.396,299.3249646,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4277]],
    CONVERSION["British National Grid",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",49,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-2,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996012717,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",400000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",-100000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["unknown"],
        AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to 3?33'E"],
        BBOX[49.75,-9.2,61.14,2.88]],
    ID["EPSG",27700]]
Data axis to CRS axis mapping: 1,2
Geometry Column = geometry
[...]

So, it is not the formatting, but rather what I supposed that sqlite has no visibility over the SQL Server schema, which surprises me a bit, since it can actually connect using the MSSQLSpatial Driver and retrieve info without it.

Thanks
Hector

On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

I am not familiar with SQL server but your table name may require quotation marks " " and they require escaping with \ so that they do not close the SQL statement. Try
-sql "update \"table_name\" set ?. "

Simple test to verify if the problem is caused by the unquoted table name is to run ogrinfo with
-sql "select * from table_name limit 1".

-Jukka-





L?hett?j?: Hector muro <muro.hector at gmail.com<mailto:muro.hector at gmail.com>>
L?hetetty: keskiviikko 2. joulukuuta 2020 12.13
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi again,

I've given your idea a go:

ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> = ST_AsText(ST_Transform(geometry),4326)" --config MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"

This connects correctly, as I get this message:

INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

But it can't read/find the table in the update statement:

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set  <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
  no such table: <table_name>

(I have tried different versions of the table name, quoting, unquoting, adding the Schema name . table name, with the same results.) I now wonder if the sqlite dialect can't really read what's inside my SQL Server instance? Is it maybe too much what I am trying to do? (too much for SQL Server's limitations).

Thanks again,
Hector

On Tue, 1 Dec 2020 at 20:56, jratike80 <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
I would say that it is best to still use ogrinfo. You did not tell what is
your database so I can't tell the exact recipe for you but you will learn
it. You need to know that there are different SQL dialects for GDAL: OGR
SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
are all documented.  If your database does not have native ST_Transform
support then you take it from SQLite/Spatialite. For overriding the native
SQL of your database you may need to use -dialect indirect_SQLite.

Here is another example with a shapefile. A combination of OGR SQL and
SQLite dialects is needed.

Add a new column
ogrinfo -sql "alter table states add wkt_geom text" states.shp

There is space for only 254 charactes in a shapefile and that is not enough
for big polygons but we can do at least something with a little trick.

ogrinfo -dialect sqlite -sql "update states set
wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp

Check what we got
ogrinfo states.shp -al
...
SERVICE (Real) = 637487.000000000
  MANUAL (Real) = 302635.000000000
  P_MALE (Real) = 0.496000000
  P_FEMALE (Real) = 0.504000000
  SAMP_POP (Real) = 736744.000000000
  wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
  MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
48.21064,-122.507858 48.253971,-122.403137 48....


-Jukka Rahkonen-




hectormauer wrote
> Oh, I see. That's great.
>
> But what if the Database does not have ST_Transform support? Could we
> still
> achieve a similar approach by means of ogr2ogr?
>
> (I should have mentioned this in my first email).
>
> Thanks again!
> Hector
>
> On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;

> jukka.rahkonen@<mailto:jukka.rahkonen@>

> &gt;
> wrote:
>
>> Hi,
>>
>> No, unfortunately it is not possible with one ogr2ogr command.
>>
>> You need two commands and you must use ogrinfo. Here an example about
>> adding
>> another geometry column and populating it with EPSG:3857 version of
>> original
>> EPSG:4326 geometries.
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "alter table states add column geom2 geometry"
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "update states set
>> geom2=ST_Transform(wkb_geometry,3857)"
>>
>> You can do all that is possible with SQL also with ogrinfo.
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> hectormauer wrote
>> > Hi all,
>> >
>> > I was wondering if someone knew if it's possible to project or
>> transform
>> > within the same table in a database, using ogr2ogr.
>> >
>> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and
>> I
>> > would like, using a single command to create an extra column
>> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
>> but
>> > could be text for instance.
>> >
>> > I guess the other plausible solution would be to create a temporary
>> table
>> > with that transformation on it and reference it to the first one by id
>> for
>> > instance.
>> >
>> > Any help is appreciated!
>> >
>> > Thanks,
>> > Hector
>> >
>> > _______________________________________________
>> > gdal-dev mailing list
>>
>> > gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>
>>
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>>
>> --
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>>

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/24f05822/attachment-0001.html>

From muro.hector at gmail.com  Wed Dec  2 03:19:40 2020
From: muro.hector at gmail.com (Hector muro)
Date: Wed, 2 Dec 2020 11:19:40 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <3b0ff817016b40a3b844cff628539c41@maanmittauslaitos.fi>
References: <3b0ff817016b40a3b844cff628539c41@maanmittauslaitos.fi>
Message-ID: <CAKdB_X6VPwtbt-vOnpJ3GbRXgqUg7m2jyD3fX1ZoXgy30kFLMQ@mail.gmail.com>

Hi,

Yeah, indirect_sqlite returns the same as using no dialect.

And if I use the dialect sqlite with the top function I get a syntax error;

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) * from xxx):
  near "from": syntax error

Thanks for the effort, I appreciate it. I really did not know the ability
to edit data via -sql in the ogrinfo command, so asking here wasn't in vane
:)

Hector

On Wed, 2 Dec 2020 at 11:14, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
>
>
> Try also with ?-dialect indirect_sqlite? but it should not make difference
> in this case. Then
>
> I must give up, hopefully somebody who has access to SQL server can
> continue. Before that one more hint: If you do not define a dialect the you
> are using the native SQL server SQL dialect. SQL server understands what
> top(1) means but SQLite and OGRSQL do not. If you manage to get so far you
> would see this error with SQLite dialect:
>
>
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) from
> underscore_test):
>
>   no such function: top
>
>
>
> -Jukka-
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 13.02
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi,
>
>
>
> Sorry, no, I meant that, using the flag dialect returns an error of "Table
> not found", but using the -sql flag without dialect returns records for
> that table.
>
>
>
> Therefor I believe the "problem" is with the dialect, here:
>
>
>
> [dev at localhost ~]$ ogrinfo -dialect ogrsql -sql "select top(1) * from
> xxx" "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
> for SQL Server'
>       using driver `MSSQLSpatial' successful.
> ERROR 1: SELECT from table xxxfailed, no such table/featureclass.
>
> [dev at localhost ~]$ ogrinfo -dialect sqlite -sql "select top(1) * from
> xxx" "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
> for SQL Server'
>       using driver `MSSQLSpatial' successful.
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select * from crown_site_data
> limit 1):
>   no such table: xxx
>
>
>
> But, if I do not set the dialect, i.e. direct sql:
>
>
>
> [dev at localhost ~]$ ogrinfo -sql "select top(1) * from xxx"
> "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
> for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
> Layer name: SELECT
> Geometry: Unknown (any)
> Feature Count: 1
> Layer SRS WKT:
> PROJCRS["OSGB 1936 / British National Grid",
>     BASEGEOGCRS["OSGB 1936",
>
>
>
> What do you think? I wouldn't be surprised if SQL Server was blocking this
> somehow, or there was some implementation missing.
>
>
>
> Thanks
>
> Hector
>
>
>
> On Wed, 2 Dec 2020 at 10:55, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> Sorry, I can?t follow what did you test. Do you mean that
>
> ogrinfo -dialect SQLite -sql "select * from crown_site_data limit 1"
> "$connect_string"
>
>
>
> returns just an error? And the same with
>
> ogrinfo -dialect SQLite -sql "select * from \"crown_site_data\" limit 1"
> "$connect_string"
>
>
>
> Try also with ?-dialect ogrsql? even that dialect does  not have those ST_
> functions that you need.
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.37
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi,
>
>
>
> Yeah, I did try that, with the same result. the test with "sql" (no
> dialect) returns correct.
>
>
>
> ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :
>
>
>
> [dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data"
> "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
> Layer name: SELECT
> Geometry: Unknown (any)
> Feature Count: 1
> Layer SRS WKT:
> PROJCRS["OSGB 1936 / British National Grid",
>     BASEGEOGCRS["OSGB 1936",
>         DATUM["OSGB 1936",
>             ELLIPSOID["Airy 1830",6377563.396,299.3249646,
>                 LENGTHUNIT["metre",1]]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["degree",0.0174532925199433]],
>         ID["EPSG",4277]],
>     CONVERSION["British National Grid",
>         METHOD["Transverse Mercator",
>             ID["EPSG",9807]],
>         PARAMETER["Latitude of natural origin",49,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8801]],
>         PARAMETER["Longitude of natural origin",-2,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8802]],
>         PARAMETER["Scale factor at natural origin",0.9996012717,
>             SCALEUNIT["unity",1],
>             ID["EPSG",8805]],
>         PARAMETER["False easting",400000,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8806]],
>         PARAMETER["False northing",-100000,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8807]]],
>     CS[Cartesian,2],
>         AXIS["(E)",east,
>             ORDER[1],
>             LENGTHUNIT["metre",1]],
>         AXIS["(N)",north,
>             ORDER[2],
>             LENGTHUNIT["metre",1]],
>     USAGE[
>         SCOPE["unknown"],
>         AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to 3?33'E"],
>         BBOX[49.75,-9.2,61.14,2.88]],
>     ID["EPSG",27700]]
> Data axis to CRS axis mapping: 1,2
> Geometry Column = geometry
> [...]
>
>
>
> So, it is not the formatting, but rather what I supposed that sqlite has
> no visibility over the SQL Server schema, which surprises me a bit, since
> it can actually connect using the MSSQLSpatial Driver and retrieve info
> without it.
>
>
>
> Thanks
>
> Hector
>
>
>
> On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> I am not familiar with SQL server but your table name may require
> quotation marks " " and they require escaping with \ so that they do not
> close the SQL statement. Try
>
> -sql "update \"table_name\" set ?. "
>
>
>
> Simple test to verify if the problem is caused by the unquoted table name
> is to run ogrinfo with
>
> -sql "select * from table_name limit 1".
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.13
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi again,
>
>
>
> I've given your idea a go:
>
>
>
> ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> =
> ST_AsText(ST_Transform(geometry),4326)" --config
> MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
>
>
>
> This connects correctly, as I get this message:
>
>
>
> INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
>
>
> But it can't read/find the table in the update statement:
>
>
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set
> <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
>   no such table: <table_name>
>
>
>
> (I have tried different versions of the table name, quoting, unquoting,
> adding the Schema name . table name, with the same results.) I now wonder
> if the sqlite dialect can't really read what's inside my SQL Server
> instance? Is it maybe too much what I am trying to do? (too much for SQL
> Server's limitations).
>
>
>
> Thanks again,
>
> Hector
>
>
>
> On Tue, 1 Dec 2020 at 20:56, jratike80 <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> I would say that it is best to still use ogrinfo. You did not tell what is
> your database so I can't tell the exact recipe for you but you will learn
> it. You need to know that there are different SQL dialects for GDAL: OGR
> SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
> are all documented.  If your database does not have native ST_Transform
> support then you take it from SQLite/Spatialite. For overriding the native
> SQL of your database you may need to use -dialect indirect_SQLite.
>
> Here is another example with a shapefile. A combination of OGR SQL and
> SQLite dialects is needed.
>
> Add a new column
> ogrinfo -sql "alter table states add wkt_geom text" states.shp
>
> There is space for only 254 charactes in a shapefile and that is not enough
> for big polygons but we can do at least something with a little trick.
>
> ogrinfo -dialect sqlite -sql "update states set
> wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp
>
> Check what we got
> ogrinfo states.shp -al
> ...
> SERVICE (Real) = 637487.000000000
>   MANUAL (Real) = 302635.000000000
>   P_MALE (Real) = 0.496000000
>   P_FEMALE (Real) = 0.504000000
>   SAMP_POP (Real) = 736744.000000000
>   wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
>   MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
> 48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
> 48.21064,-122.507858 48.253971,-122.403137 48....
>
>
> -Jukka Rahkonen-
>
>
>
>
> hectormauer wrote
> > Oh, I see. That's great.
> >
> > But what if the Database does not have ST_Transform support? Could we
> > still
> > achieve a similar approach by means of ogr2ogr?
> >
> > (I should have mentioned this in my first email).
> >
> > Thanks again!
> > Hector
> >
> > On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;
>
> > jukka.rahkonen@
>
> > &gt;
> > wrote:
> >
> >> Hi,
> >>
> >> No, unfortunately it is not possible with one ogr2ogr command.
> >>
> >> You need two commands and you must use ogrinfo. Here an example about
> >> adding
> >> another geometry column and populating it with EPSG:3857 version of
> >> original
> >> EPSG:4326 geometries.
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "alter table states add column geom2 geometry"
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "update states set
> >> geom2=ST_Transform(wkb_geometry,3857)"
> >>
> >> You can do all that is possible with SQL also with ogrinfo.
> >>
> >>
> >> -Jukka Rahkonen-
> >>
> >>
> >>
> >> hectormauer wrote
> >> > Hi all,
> >> >
> >> > I was wondering if someone knew if it's possible to project or
> >> transform
> >> > within the same table in a database, using ogr2ogr.
> >> >
> >> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700
> and
> >> I
> >> > would like, using a single command to create an extra column
> >> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
> >> but
> >> > could be text for instance.
> >> >
> >> > I guess the other plausible solution would be to create a temporary
> >> table
> >> > with that transformation on it and reference it to the first one by id
> >> for
> >> > instance.
> >> >
> >> > Any help is appreciated!
> >> >
> >> > Thanks,
> >> > Hector
> >> >
> >> > _______________________________________________
> >> > gdal-dev mailing list
> >>
> >> > gdal-dev at .osgeo
> >>
> >> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >>
> >>
> >>
> >>
> >> --
> >> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> >> _______________________________________________
> >> gdal-dev mailing list
> >>
>
> > gdal-dev at .osgeo
>
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/46ba740b/attachment-0001.html>

From muro.hector at gmail.com  Wed Dec  2 03:46:14 2020
From: muro.hector at gmail.com (Hector muro)
Date: Wed, 2 Dec 2020 11:46:14 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <CAKdB_X6VPwtbt-vOnpJ3GbRXgqUg7m2jyD3fX1ZoXgy30kFLMQ@mail.gmail.com>
References: <3b0ff817016b40a3b844cff628539c41@maanmittauslaitos.fi>
 <CAKdB_X6VPwtbt-vOnpJ3GbRXgqUg7m2jyD3fX1ZoXgy30kFLMQ@mail.gmail.com>
Message-ID: <CAKdB_X5Y=8RbduM-Qd1qfj=sg4CEMwRqYOwKLoajGTjq0f2HQQ@mail.gmail.com>

Hi again,

Okey, I think I got it. And you were right, it was getting the  quotes
correctly. I needed to single quote the 'Schema.Table'. Now the error says
that there is no such function "ST_Transform" when using sqlite dialect!!

ogrinfo "$connect_string" -dialect sqlite -sql "update 'XXX.xxx' set xxx =
ST_AsText(ST_Transform(geometry,4326))" --config
MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
INFO: Open of
`MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC
Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.
layer names ignored in combination with -sql.
ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update 'XXX.xxx' set xxx =
ST_AsText(ST_Transform(geometry,4326))):
  no such function: ST_Transform

What am I missing?

On Wed, 2 Dec 2020 at 11:19, Hector muro <muro.hector at gmail.com> wrote:

> Hi,
>
> Yeah, indirect_sqlite returns the same as using no dialect.
>
> And if I use the dialect sqlite with the top function I get a syntax error;
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) * from xxx):
>   near "from": syntax error
>
> Thanks for the effort, I appreciate it. I really did not know the ability
> to edit data via -sql in the ogrinfo command, so asking here wasn't in vane
> :)
>
> Hector
>
> On Wed, 2 Dec 2020 at 11:14, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
>> Hi,
>>
>>
>>
>> Try also with ?-dialect indirect_sqlite? but it should not make
>> difference in this case. Then
>>
>> I must give up, hopefully somebody who has access to SQL server can
>> continue. Before that one more hint: If you do not define a dialect the you
>> are using the native SQL server SQL dialect. SQL server understands what
>> top(1) means but SQLite and OGRSQL do not. If you manage to get so far you
>> would see this error with SQLite dialect:
>>
>>
>>
>> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) from
>> underscore_test):
>>
>>   no such function: top
>>
>>
>>
>> -Jukka-
>>
>>
>>
>>
>>
>>
>>
>> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
>> *L?hetetty:* keskiviikko 2. joulukuuta 2020 13.02
>> *Vastaanottaja:* Rahkonen Jukka (MML) <
>> jukka.rahkonen at maanmittauslaitos.fi>
>> *Kopio:* gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same
>> database table
>>
>>
>>
>> Hi,
>>
>>
>>
>> Sorry, no, I meant that, using the flag dialect returns an error of
>> "Table not found", but using the -sql flag without dialect returns records
>> for that table.
>>
>>
>>
>> Therefor I believe the "problem" is with the dialect, here:
>>
>>
>>
>> [dev at localhost ~]$ ogrinfo -dialect ogrsql -sql "select top(1) * from
>> xxx" "$connect_string"
>> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
>> Driver 17 for SQL Server][SQL Server]There is already an object named
>> 'geometry_columns' in the database.(2714)
>> INFO: Open of
>> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
>> for SQL Server'
>>       using driver `MSSQLSpatial' successful.
>> ERROR 1: SELECT from table xxxfailed, no such table/featureclass.
>>
>> [dev at localhost ~]$ ogrinfo -dialect sqlite -sql "select top(1) * from
>> xxx" "$connect_string"
>> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
>> Driver 17 for SQL Server][SQL Server]There is already an object named
>> 'geometry_columns' in the database.(2714)
>> INFO: Open of
>> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
>> for SQL Server'
>>       using driver `MSSQLSpatial' successful.
>> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select * from
>> crown_site_data limit 1):
>>   no such table: xxx
>>
>>
>>
>> But, if I do not set the dialect, i.e. direct sql:
>>
>>
>>
>> [dev at localhost ~]$ ogrinfo -sql "select top(1) * from xxx"
>> "$connect_string"
>> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
>> Driver 17 for SQL Server][SQL Server]There is already an object named
>> 'geometry_columns' in the database.(2714)
>> INFO: Open of
>> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
>> for SQL Server'
>>       using driver `MSSQLSpatial' successful.
>>
>> Layer name: SELECT
>> Geometry: Unknown (any)
>> Feature Count: 1
>> Layer SRS WKT:
>> PROJCRS["OSGB 1936 / British National Grid",
>>     BASEGEOGCRS["OSGB 1936",
>>
>>
>>
>> What do you think? I wouldn't be surprised if SQL Server was blocking
>> this somehow, or there was some implementation missing.
>>
>>
>>
>> Thanks
>>
>> Hector
>>
>>
>>
>> On Wed, 2 Dec 2020 at 10:55, Rahkonen Jukka (MML) <
>> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>
>> Hi,
>>
>>
>>
>> Sorry, I can?t follow what did you test. Do you mean that
>>
>> ogrinfo -dialect SQLite -sql "select * from crown_site_data limit 1"
>> "$connect_string"
>>
>>
>>
>> returns just an error? And the same with
>>
>> ogrinfo -dialect SQLite -sql "select * from \"crown_site_data\" limit 1"
>> "$connect_string"
>>
>>
>>
>> Try also with ?-dialect ogrsql? even that dialect does  not have those
>> ST_ functions that you need.
>>
>>
>>
>> -Jukka-
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
>> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.37
>> *Vastaanottaja:* Rahkonen Jukka (MML) <
>> jukka.rahkonen at maanmittauslaitos.fi>
>> *Kopio:* gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same
>> database table
>>
>>
>>
>> Hi,
>>
>>
>>
>> Yeah, I did try that, with the same result. the test with "sql" (no
>> dialect) returns correct.
>>
>>
>>
>> ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :
>>
>>
>>
>> [dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data"
>> "$connect_string"
>> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
>> Driver 17 for SQL Server][SQL Server]There is already an object named
>> 'geometry_columns' in the database.(2714)
>> INFO: Open of
>> `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC
>> Driver 17 for SQL Server'
>>       using driver `MSSQLSpatial' successful.
>>
>> Layer name: SELECT
>> Geometry: Unknown (any)
>> Feature Count: 1
>> Layer SRS WKT:
>> PROJCRS["OSGB 1936 / British National Grid",
>>     BASEGEOGCRS["OSGB 1936",
>>         DATUM["OSGB 1936",
>>             ELLIPSOID["Airy 1830",6377563.396,299.3249646,
>>                 LENGTHUNIT["metre",1]]],
>>         PRIMEM["Greenwich",0,
>>             ANGLEUNIT["degree",0.0174532925199433]],
>>         ID["EPSG",4277]],
>>     CONVERSION["British National Grid",
>>         METHOD["Transverse Mercator",
>>             ID["EPSG",9807]],
>>         PARAMETER["Latitude of natural origin",49,
>>             ANGLEUNIT["degree",0.0174532925199433],
>>             ID["EPSG",8801]],
>>         PARAMETER["Longitude of natural origin",-2,
>>             ANGLEUNIT["degree",0.0174532925199433],
>>             ID["EPSG",8802]],
>>         PARAMETER["Scale factor at natural origin",0.9996012717,
>>             SCALEUNIT["unity",1],
>>             ID["EPSG",8805]],
>>         PARAMETER["False easting",400000,
>>             LENGTHUNIT["metre",1],
>>             ID["EPSG",8806]],
>>         PARAMETER["False northing",-100000,
>>             LENGTHUNIT["metre",1],
>>             ID["EPSG",8807]]],
>>     CS[Cartesian,2],
>>         AXIS["(E)",east,
>>             ORDER[1],
>>             LENGTHUNIT["metre",1]],
>>         AXIS["(N)",north,
>>             ORDER[2],
>>             LENGTHUNIT["metre",1]],
>>     USAGE[
>>         SCOPE["unknown"],
>>         AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to
>> 3?33'E"],
>>         BBOX[49.75,-9.2,61.14,2.88]],
>>     ID["EPSG",27700]]
>> Data axis to CRS axis mapping: 1,2
>> Geometry Column = geometry
>> [...]
>>
>>
>>
>> So, it is not the formatting, but rather what I supposed that sqlite has
>> no visibility over the SQL Server schema, which surprises me a bit, since
>> it can actually connect using the MSSQLSpatial Driver and retrieve info
>> without it.
>>
>>
>>
>> Thanks
>>
>> Hector
>>
>>
>>
>> On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <
>> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>
>> Hi,
>>
>>
>>
>> I am not familiar with SQL server but your table name may require
>> quotation marks " " and they require escaping with \ so that they do not
>> close the SQL statement. Try
>>
>> -sql "update \"table_name\" set ?. "
>>
>>
>>
>> Simple test to verify if the problem is caused by the unquoted table name
>> is to run ogrinfo with
>>
>> -sql "select * from table_name limit 1".
>>
>>
>>
>> -Jukka-
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
>> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.13
>> *Vastaanottaja:* Rahkonen Jukka (MML) <
>> jukka.rahkonen at maanmittauslaitos.fi>
>> *Kopio:* gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same
>> database table
>>
>>
>>
>> Hi again,
>>
>>
>>
>> I've given your idea a go:
>>
>>
>>
>> ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> =
>> ST_AsText(ST_Transform(geometry),4326)" --config
>> MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
>>
>>
>>
>> This connects correctly, as I get this message:
>>
>>
>>
>> INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC
>> Driver 17 for SQL Server'
>>       using driver `MSSQLSpatial' successful.
>>
>>
>>
>> But it can't read/find the table in the update statement:
>>
>>
>>
>> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set
>> <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
>>   no such table: <table_name>
>>
>>
>>
>> (I have tried different versions of the table name, quoting, unquoting,
>> adding the Schema name . table name, with the same results.) I now wonder
>> if the sqlite dialect can't really read what's inside my SQL Server
>> instance? Is it maybe too much what I am trying to do? (too much for SQL
>> Server's limitations).
>>
>>
>>
>> Thanks again,
>>
>> Hector
>>
>>
>>
>> On Tue, 1 Dec 2020 at 20:56, jratike80 <
>> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>>
>> I would say that it is best to still use ogrinfo. You did not tell what is
>> your database so I can't tell the exact recipe for you but you will learn
>> it. You need to know that there are different SQL dialects for GDAL: OGR
>> SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
>> are all documented.  If your database does not have native ST_Transform
>> support then you take it from SQLite/Spatialite. For overriding the native
>> SQL of your database you may need to use -dialect indirect_SQLite.
>>
>> Here is another example with a shapefile. A combination of OGR SQL and
>> SQLite dialects is needed.
>>
>> Add a new column
>> ogrinfo -sql "alter table states add wkt_geom text" states.shp
>>
>> There is space for only 254 charactes in a shapefile and that is not
>> enough
>> for big polygons but we can do at least something with a little trick.
>>
>> ogrinfo -dialect sqlite -sql "update states set
>> wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp
>>
>> Check what we got
>> ogrinfo states.shp -al
>> ...
>> SERVICE (Real) = 637487.000000000
>>   MANUAL (Real) = 302635.000000000
>>   P_MALE (Real) = 0.496000000
>>   P_FEMALE (Real) = 0.504000000
>>   SAMP_POP (Real) = 736744.000000000
>>   wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
>>   MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
>> 48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
>> 48.21064,-122.507858 48.253971,-122.403137 48....
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>>
>> hectormauer wrote
>> > Oh, I see. That's great.
>> >
>> > But what if the Database does not have ST_Transform support? Could we
>> > still
>> > achieve a similar approach by means of ogr2ogr?
>> >
>> > (I should have mentioned this in my first email).
>> >
>> > Thanks again!
>> > Hector
>> >
>> > On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;
>>
>> > jukka.rahkonen@
>>
>> > &gt;
>> > wrote:
>> >
>> >> Hi,
>> >>
>> >> No, unfortunately it is not possible with one ogr2ogr command.
>> >>
>> >> You need two commands and you must use ogrinfo. Here an example about
>> >> adding
>> >> another geometry column and populating it with EPSG:3857 version of
>> >> original
>> >> EPSG:4326 geometries.
>> >>
>> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> >> password=password" -sql "alter table states add column geom2 geometry"
>> >>
>> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> >> password=password" -sql "update states set
>> >> geom2=ST_Transform(wkb_geometry,3857)"
>> >>
>> >> You can do all that is possible with SQL also with ogrinfo.
>> >>
>> >>
>> >> -Jukka Rahkonen-
>> >>
>> >>
>> >>
>> >> hectormauer wrote
>> >> > Hi all,
>> >> >
>> >> > I was wondering if someone knew if it's possible to project or
>> >> transform
>> >> > within the same table in a database, using ogr2ogr.
>> >> >
>> >> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700
>> and
>> >> I
>> >> > would like, using a single command to create an extra column
>> >> > "geom_wkt_4326" for instance. It does not have to be of type
>> geometry,
>> >> but
>> >> > could be text for instance.
>> >> >
>> >> > I guess the other plausible solution would be to create a temporary
>> >> table
>> >> > with that transformation on it and reference it to the first one by
>> id
>> >> for
>> >> > instance.
>> >> >
>> >> > Any help is appreciated!
>> >> >
>> >> > Thanks,
>> >> > Hector
>> >> >
>> >> > _______________________________________________
>> >> > gdal-dev mailing list
>> >>
>> >> > gdal-dev at .osgeo
>> >>
>> >> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> >>
>> >>
>> >>
>> >>
>> >>
>> >> --
>> >> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> >> _______________________________________________
>> >> gdal-dev mailing list
>> >>
>>
>> > gdal-dev at .osgeo
>>
>> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> >>
>> >
>> > _______________________________________________
>> > gdal-dev mailing list
>>
>> > gdal-dev at .osgeo
>>
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>>
>> --
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/d6f87a73/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec  2 03:58:51 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Wed, 2 Dec 2020 11:58:51 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
Message-ID: <51a23a65c4d44c11b7873f8cec2f9889@maanmittauslaitos.fi>

Hi,
Hi,

What do you get from ogrinfo by having
-sql "select sqlite_version()"
and
-sql "select spatialite_version()"

If the first query returns something like sqlite_version() (String) = 3.24.0 it confirms that you are really running SQLite. It the latter command does not return anything it means that your GDAL is built without Spatialite or there is something wrong with loading the Spatialite extension. The good result would be something like spatialite_version() (String) = 4.3.0-RC1 or higher.

I suppose you are on Linux. What Linux? What is your GDAL version? How did you install it?

-Jukka

L?hett?j?: Hector muro <muro.hector at gmail.com>
L?hetetty: keskiviikko 2. joulukuuta 2020 13.46
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi again,

Okey, I think I got it. And you were right, it was getting the  quotes correctly. I needed to single quote the 'Schema.Table'. Now the error says that there is no such function "ST_Transform" when using sqlite dialect!!

ogrinfo "$connect_string" -dialect sqlite -sql "update 'XXX.xxx' set xxx = ST_AsText(ST_Transform(geometry,4326))" --config MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
INFO: Open of `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.
layer names ignored in combination with -sql.
ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update 'XXX.xxx' set xxx = ST_AsText(ST_Transform(geometry,4326))):
  no such function: ST_Transform

What am I missing?

On Wed, 2 Dec 2020 at 11:19, Hector muro <muro.hector at gmail.com<mailto:muro.hector at gmail.com>> wrote:
Hi,

Yeah, indirect_sqlite returns the same as using no dialect.

And if I use the dialect sqlite with the top function I get a syntax error;

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) * from xxx):
  near "from": syntax error

Thanks for the effort, I appreciate it. I really did not know the ability to edit data via -sql in the ogrinfo command, so asking here wasn't in vane :)

Hector

On Wed, 2 Dec 2020 at 11:14, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Try also with ?-dialect indirect_sqlite? but it should not make difference in this case. Then
I must give up, hopefully somebody who has access to SQL server can continue. Before that one more hint: If you do not define a dialect the you are using the native SQL server SQL dialect. SQL server understands what top(1) means but SQLite and OGRSQL do not. If you manage to get so far you would see this error with SQLite dialect:

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) from underscore_test):
  no such function: top

-Jukka-



L?hett?j?: Hector muro <muro.hector at gmail.com<mailto:muro.hector at gmail.com>>
L?hetetty: keskiviikko 2. joulukuuta 2020 13.02
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi,

Sorry, no, I meant that, using the flag dialect returns an error of "Table not found", but using the -sql flag without dialect returns records for that table.

Therefor I believe the "problem" is with the dialect, here:

[dev at localhost ~]$ ogrinfo -dialect ogrsql -sql "select top(1) * from xxx" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.
ERROR 1: SELECT from table xxxfailed, no such table/featureclass.
[dev at localhost ~]$ ogrinfo -dialect sqlite -sql "select top(1) * from xxx" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.
ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select * from crown_site_data limit 1):
  no such table: xxx

But, if I do not set the dialect, i.e. direct sql:

[dev at localhost ~]$ ogrinfo -sql "select top(1) * from xxx" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
PROJCRS["OSGB 1936 / British National Grid",
    BASEGEOGCRS["OSGB 1936",

What do you think? I wouldn't be surprised if SQL Server was blocking this somehow, or there was some implementation missing.

Thanks
Hector

On Wed, 2 Dec 2020 at 10:55, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Sorry, I can?t follow what did you test. Do you mean that
ogrinfo -dialect SQLite -sql "select * from crown_site_data limit 1" "$connect_string"

returns just an error? And the same with
ogrinfo -dialect SQLite -sql "select * from \"crown_site_data\" limit 1" "$connect_string"

Try also with ?-dialect ogrsql? even that dialect does  not have those ST_ functions that you need.

-Jukka-






L?hett?j?: Hector muro <muro.hector at gmail.com<mailto:muro.hector at gmail.com>>
L?hetetty: keskiviikko 2. joulukuuta 2020 12.37
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi,

Yeah, I did try that, with the same result. the test with "sql" (no dialect) returns correct.

ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :

[dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data" "$connect_string"
ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC Driver 17 for SQL Server][SQL Server]There is already an object named 'geometry_columns' in the database.(2714)
INFO: Open of `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

Layer name: SELECT
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
PROJCRS["OSGB 1936 / British National Grid",
    BASEGEOGCRS["OSGB 1936",
        DATUM["OSGB 1936",
            ELLIPSOID["Airy 1830",6377563.396,299.3249646,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4277]],
    CONVERSION["British National Grid",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",49,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-2,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996012717,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",400000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",-100000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["unknown"],
        AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to 3?33'E"],
        BBOX[49.75,-9.2,61.14,2.88]],
    ID["EPSG",27700]]
Data axis to CRS axis mapping: 1,2
Geometry Column = geometry
[...]

So, it is not the formatting, but rather what I supposed that sqlite has no visibility over the SQL Server schema, which surprises me a bit, since it can actually connect using the MSSQLSpatial Driver and retrieve info without it.

Thanks
Hector

On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

I am not familiar with SQL server but your table name may require quotation marks " " and they require escaping with \ so that they do not close the SQL statement. Try
-sql "update \"table_name\" set ?. "

Simple test to verify if the problem is caused by the unquoted table name is to run ogrinfo with
-sql "select * from table_name limit 1".

-Jukka-





L?hett?j?: Hector muro <muro.hector at gmail.com<mailto:muro.hector at gmail.com>>
L?hetetty: keskiviikko 2. joulukuuta 2020 12.13
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] ogr2ogr project/transform CRS in the same database table

Hi again,

I've given your idea a go:

ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> = ST_AsText(ST_Transform(geometry),4326)" --config MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"

This connects correctly, as I get this message:

INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC Driver 17 for SQL Server'
      using driver `MSSQLSpatial' successful.

But it can't read/find the table in the update statement:

ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set  <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
  no such table: <table_name>

(I have tried different versions of the table name, quoting, unquoting, adding the Schema name . table name, with the same results.) I now wonder if the sqlite dialect can't really read what's inside my SQL Server instance? Is it maybe too much what I am trying to do? (too much for SQL Server's limitations).

Thanks again,
Hector

On Tue, 1 Dec 2020 at 20:56, jratike80 <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
I would say that it is best to still use ogrinfo. You did not tell what is
your database so I can't tell the exact recipe for you but you will learn
it. You need to know that there are different SQL dialects for GDAL: OGR
SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
are all documented.  If your database does not have native ST_Transform
support then you take it from SQLite/Spatialite. For overriding the native
SQL of your database you may need to use -dialect indirect_SQLite.

Here is another example with a shapefile. A combination of OGR SQL and
SQLite dialects is needed.

Add a new column
ogrinfo -sql "alter table states add wkt_geom text" states.shp

There is space for only 254 charactes in a shapefile and that is not enough
for big polygons but we can do at least something with a little trick.

ogrinfo -dialect sqlite -sql "update states set
wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp

Check what we got
ogrinfo states.shp -al
...
SERVICE (Real) = 637487.000000000
  MANUAL (Real) = 302635.000000000
  P_MALE (Real) = 0.496000000
  P_FEMALE (Real) = 0.504000000
  SAMP_POP (Real) = 736744.000000000
  wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
  MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
48.21064,-122.507858 48.253971,-122.403137 48....


-Jukka Rahkonen-




hectormauer wrote
> Oh, I see. That's great.
>
> But what if the Database does not have ST_Transform support? Could we
> still
> achieve a similar approach by means of ogr2ogr?
>
> (I should have mentioned this in my first email).
>
> Thanks again!
> Hector
>
> On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;

> jukka.rahkonen@<mailto:jukka.rahkonen@>

> &gt;
> wrote:
>
>> Hi,
>>
>> No, unfortunately it is not possible with one ogr2ogr command.
>>
>> You need two commands and you must use ogrinfo. Here an example about
>> adding
>> another geometry column and populating it with EPSG:3857 version of
>> original
>> EPSG:4326 geometries.
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "alter table states add column geom2 geometry"
>>
>> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
>> password=password" -sql "update states set
>> geom2=ST_Transform(wkb_geometry,3857)"
>>
>> You can do all that is possible with SQL also with ogrinfo.
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> hectormauer wrote
>> > Hi all,
>> >
>> > I was wondering if someone knew if it's possible to project or
>> transform
>> > within the same table in a database, using ogr2ogr.
>> >
>> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700 and
>> I
>> > would like, using a single command to create an extra column
>> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
>> but
>> > could be text for instance.
>> >
>> > I guess the other plausible solution would be to create a temporary
>> table
>> > with that transformation on it and reference it to the first one by id
>> for
>> > instance.
>> >
>> > Any help is appreciated!
>> >
>> > Thanks,
>> > Hector
>> >
>> > _______________________________________________
>> > gdal-dev mailing list
>>
>> > gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>
>>
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>>
>>
>> --
>> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
>> _______________________________________________
>> gdal-dev mailing list
>>

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo<mailto:gdal-dev at .osgeo>

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/1dc54821/attachment-0001.html>

From muro.hector at gmail.com  Wed Dec  2 04:07:45 2020
From: muro.hector at gmail.com (Hector muro)
Date: Wed, 2 Dec 2020 12:07:45 +0000
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database
 table
In-Reply-To: <51a23a65c4d44c11b7873f8cec2f9889@maanmittauslaitos.fi>
References: <51a23a65c4d44c11b7873f8cec2f9889@maanmittauslaitos.fi>
Message-ID: <CAKdB_X4vEhz2aYq326fNRh2uhLCWG=UxdefQGrLHKH26mC=88w@mail.gmail.com>

Hi,

Thanks for that.

The first query returns:
  sqlite_version() (String) = 3.7.17

The latter returns an error (no such function: spatialite_version), so I
gess my gdal installation is not set with Spatialite, but if I do this:
 ogrinfo --formats | grep -i spatialite
  SQLite -vector- (rw+v): SQLite / Spatialite

Is there another separate driver for Spatialite only? I had assumed it came
with the SQLite itself. should I configure GDAL installation with:
"--with-spatialite=ARG" ?

I am running this on CentOS , GDAL 3.0.4 and I installed it from source.

Thanks and regards
Hector

On Wed, 2 Dec 2020 at 11:58, Rahkonen Jukka (MML) <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
> Hi,
>
>
>
> What do you get from ogrinfo by having
>
> -sql "select sqlite_version()"
>
> and
>
> -sql "select spatialite_version()"
>
>
>
> If the first query returns something like sqlite_version() (String) =
> 3.24.0 it confirms that you are really running SQLite. It the latter
> command does not return anything it means that your GDAL is built without
> Spatialite or there is something wrong with loading the Spatialite
> extension. The good result would be something like spatialite_version()
> (String) = 4.3.0-RC1 or higher.
>
>
>
> I suppose you are on Linux. What Linux? What is your GDAL version? How did
> you install it?
>
>
>
> -Jukka
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 13.46
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi again,
>
>
>
> Okey, I think I got it. And you were right, it was getting the  quotes
> correctly. I needed to single quote the 'Schema.Table'. Now the error says
> that there is no such function "ST_Transform" when using sqlite dialect!!
>
>
>
> ogrinfo "$connect_string" -dialect sqlite -sql "update 'XXX.xxx' set xxx =
> ST_AsText(ST_Transform(geometry,4326))" --config
> MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
> INFO: Open of
> `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
> layer names ignored in combination with -sql.
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update 'XXX.xxx' set xxx =
> ST_AsText(ST_Transform(geometry,4326))):
>   no such function: ST_Transform
>
>
>
> What am I missing?
>
>
>
> On Wed, 2 Dec 2020 at 11:19, Hector muro <muro.hector at gmail.com> wrote:
>
> Hi,
>
>
>
> Yeah, indirect_sqlite returns the same as using no dialect.
>
>
>
> And if I use the dialect sqlite with the top function I get a syntax error;
>
>
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) * from xxx):
>   near "from": syntax error
>
>
>
> Thanks for the effort, I appreciate it. I really did not know the ability
> to edit data via -sql in the ogrinfo command, so asking here wasn't in vane
> :)
>
>
>
> Hector
>
>
>
> On Wed, 2 Dec 2020 at 11:14, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> Try also with ?-dialect indirect_sqlite? but it should not make difference
> in this case. Then
>
> I must give up, hopefully somebody who has access to SQL server can
> continue. Before that one more hint: If you do not define a dialect the you
> are using the native SQL server SQL dialect. SQL server understands what
> top(1) means but SQLite and OGRSQL do not. If you manage to get so far you
> would see this error with SQLite dialect:
>
>
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select top(1) from
> underscore_test):
>
>   no such function: top
>
>
>
> -Jukka-
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 13.02
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi,
>
>
>
> Sorry, no, I meant that, using the flag dialect returns an error of "Table
> not found", but using the -sql flag without dialect returns records for
> that table.
>
>
>
> Therefor I believe the "problem" is with the dialect, here:
>
>
>
> [dev at localhost ~]$ ogrinfo -dialect ogrsql -sql "select top(1) * from
> xxx" "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
> for SQL Server'
>       using driver `MSSQLSpatial' successful.
> ERROR 1: SELECT from table xxxfailed, no such table/featureclass.
>
> [dev at localhost ~]$ ogrinfo -dialect sqlite -sql "select top(1) * from
> xxx" "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
> for SQL Server'
>       using driver `MSSQLSpatial' successful.
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(select * from crown_site_data
> limit 1):
>   no such table: xxx
>
>
>
> But, if I do not set the dialect, i.e. direct sql:
>
>
>
> [dev at localhost ~]$ ogrinfo -sql "select top(1) * from xxx"
> "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=xxx;UID=xxx;PWD=xxx;DRIVER=ODBC Driver 17
> for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
> Layer name: SELECT
> Geometry: Unknown (any)
> Feature Count: 1
> Layer SRS WKT:
> PROJCRS["OSGB 1936 / British National Grid",
>     BASEGEOGCRS["OSGB 1936",
>
>
>
> What do you think? I wouldn't be surprised if SQL Server was blocking this
> somehow, or there was some implementation missing.
>
>
>
> Thanks
>
> Hector
>
>
>
> On Wed, 2 Dec 2020 at 10:55, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> Sorry, I can?t follow what did you test. Do you mean that
>
> ogrinfo -dialect SQLite -sql "select * from crown_site_data limit 1"
> "$connect_string"
>
>
>
> returns just an error? And the same with
>
> ogrinfo -dialect SQLite -sql "select * from \"crown_site_data\" limit 1"
> "$connect_string"
>
>
>
> Try also with ?-dialect ogrsql? even that dialect does  not have those ST_
> functions that you need.
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.37
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi,
>
>
>
> Yeah, I did try that, with the same result. the test with "sql" (no
> dialect) returns correct.
>
>
>
> ogrinfo -sql "select top(1) * from <table_name>" "$connect_string" :
>
>
>
> [dev at localhost ~]$ ogrinfo -sql "select top(1) * from crown_site_data"
> "$connect_string"
> ERROR 1: Error initializing the metadata tables : [S0001][Microsoft][ODBC
> Driver 17 for SQL Server][SQL Server]There is already an object named
> 'geometry_columns' in the database.(2714)
> INFO: Open of
> `MSSQL:server=localhost;database=INMWS_GEOM_TESTS;UID=dev;PWD=DevDev1234;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
> Layer name: SELECT
> Geometry: Unknown (any)
> Feature Count: 1
> Layer SRS WKT:
> PROJCRS["OSGB 1936 / British National Grid",
>     BASEGEOGCRS["OSGB 1936",
>         DATUM["OSGB 1936",
>             ELLIPSOID["Airy 1830",6377563.396,299.3249646,
>                 LENGTHUNIT["metre",1]]],
>         PRIMEM["Greenwich",0,
>             ANGLEUNIT["degree",0.0174532925199433]],
>         ID["EPSG",4277]],
>     CONVERSION["British National Grid",
>         METHOD["Transverse Mercator",
>             ID["EPSG",9807]],
>         PARAMETER["Latitude of natural origin",49,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8801]],
>         PARAMETER["Longitude of natural origin",-2,
>             ANGLEUNIT["degree",0.0174532925199433],
>             ID["EPSG",8802]],
>         PARAMETER["Scale factor at natural origin",0.9996012717,
>             SCALEUNIT["unity",1],
>             ID["EPSG",8805]],
>         PARAMETER["False easting",400000,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8806]],
>         PARAMETER["False northing",-100000,
>             LENGTHUNIT["metre",1],
>             ID["EPSG",8807]]],
>     CS[Cartesian,2],
>         AXIS["(E)",east,
>             ORDER[1],
>             LENGTHUNIT["metre",1]],
>         AXIS["(N)",north,
>             ORDER[2],
>             LENGTHUNIT["metre",1]],
>     USAGE[
>         SCOPE["unknown"],
>         AREA["UK - Britain and UKCS 49?46'N to 61?01'N, 7?33'W to 3?33'E"],
>         BBOX[49.75,-9.2,61.14,2.88]],
>     ID["EPSG",27700]]
> Data axis to CRS axis mapping: 1,2
> Geometry Column = geometry
> [...]
>
>
>
> So, it is not the formatting, but rather what I supposed that sqlite has
> no visibility over the SQL Server schema, which surprises me a bit, since
> it can actually connect using the MSSQLSpatial Driver and retrieve info
> without it.
>
>
>
> Thanks
>
> Hector
>
>
>
> On Wed, 2 Dec 2020 at 10:29, Rahkonen Jukka (MML) <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> Hi,
>
>
>
> I am not familiar with SQL server but your table name may require
> quotation marks " " and they require escaping with \ so that they do not
> close the SQL statement. Try
>
> -sql "update \"table_name\" set ?. "
>
>
>
> Simple test to verify if the problem is caused by the unquoted table name
> is to run ogrinfo with
>
> -sql "select * from table_name limit 1".
>
>
>
> -Jukka-
>
>
>
>
>
>
>
>
>
>
>
> *L?hett?j?:* Hector muro <muro.hector at gmail.com>
> *L?hetetty:* keskiviikko 2. joulukuuta 2020 12.13
> *Vastaanottaja:* Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi
> >
> *Kopio:* gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] ogr2ogr project/transform CRS in the same database
> table
>
>
>
> Hi again,
>
>
>
> I've given your idea a go:
>
>
>
> ogrinfo -dialect sqlite -sql "update <table_name> set <text_geom> =
> ST_AsText(ST_Transform(geometry),4326)" --config
> MSSQLSPATIAL_USE_GEOMETRY_COLUMNS NO "$connect_string"
>
>
>
> This connects correctly, as I get this message:
>
>
>
> INFO: Open of `MSSQL:server=xxx;database=xxx;UID=xxx;PWD=xx;DRIVER=ODBC
> Driver 17 for SQL Server'
>       using driver `MSSQLSpatial' successful.
>
>
>
> But it can't read/find the table in the update statement:
>
>
>
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(update <table_name> set
> <text_geom> = ST_AsText(ST_Transform(geometry),4326)):
>   no such table: <table_name>
>
>
>
> (I have tried different versions of the table name, quoting, unquoting,
> adding the Schema name . table name, with the same results.) I now wonder
> if the sqlite dialect can't really read what's inside my SQL Server
> instance? Is it maybe too much what I am trying to do? (too much for SQL
> Server's limitations).
>
>
>
> Thanks again,
>
> Hector
>
>
>
> On Tue, 1 Dec 2020 at 20:56, jratike80 <
> jukka.rahkonen at maanmittauslaitos.fi> wrote:
>
> I would say that it is best to still use ogrinfo. You did not tell what is
> your database so I can't tell the exact recipe for you but you will learn
> it. You need to know that there are different SQL dialects for GDAL: OGR
> SQL, SQLite, indirect_SQLite, and the native SQL for your database.  They
> are all documented.  If your database does not have native ST_Transform
> support then you take it from SQLite/Spatialite. For overriding the native
> SQL of your database you may need to use -dialect indirect_SQLite.
>
> Here is another example with a shapefile. A combination of OGR SQL and
> SQLite dialects is needed.
>
> Add a new column
> ogrinfo -sql "alter table states add wkt_geom text" states.shp
>
> There is space for only 254 charactes in a shapefile and that is not enough
> for big polygons but we can do at least something with a little trick.
>
> ogrinfo -dialect sqlite -sql "update states set
> wkt_geom=ST_AsText(ST_Transform(ST_Centroid(geometry),3857))" states.shp
>
> Check what we got
> ogrinfo states.shp -al
> ...
> SERVICE (Real) = 637487.000000000
>   MANUAL (Real) = 302635.000000000
>   P_MALE (Real) = 0.496000000
>   P_FEMALE (Real) = 0.504000000
>   SAMP_POP (Real) = 736744.000000000
>   wkt_geom (String) = POINT(-13405860.170799 6003812.424048)
>   MULTIPOLYGON (((-122.400749 48.225395,-122.461586 48.228542,-122.453156
> 48.128674,-122.360077 48.06028,-122.513245 48.134155,-122.540802
> 48.21064,-122.507858 48.253971,-122.403137 48....
>
>
> -Jukka Rahkonen-
>
>
>
>
> hectormauer wrote
> > Oh, I see. That's great.
> >
> > But what if the Database does not have ST_Transform support? Could we
> > still
> > achieve a similar approach by means of ogr2ogr?
> >
> > (I should have mentioned this in my first email).
> >
> > Thanks again!
> > Hector
> >
> > On Tue, 1 Dec 2020 at 20:14, jratike80 &lt;
>
> > jukka.rahkonen@
>
> > &gt;
> > wrote:
> >
> >> Hi,
> >>
> >> No, unfortunately it is not possible with one ogr2ogr command.
> >>
> >> You need two commands and you must use ogrinfo. Here an example about
> >> adding
> >> another geometry column and populating it with EPSG:3857 version of
> >> original
> >> EPSG:4326 geometries.
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "alter table states add column geom2 geometry"
> >>
> >> ogrinfo PG:"host=localhost port=5432 dbname=test user=user
> >> password=password" -sql "update states set
> >> geom2=ST_Transform(wkb_geometry,3857)"
> >>
> >> You can do all that is possible with SQL also with ogrinfo.
> >>
> >>
> >> -Jukka Rahkonen-
> >>
> >>
> >>
> >> hectormauer wrote
> >> > Hi all,
> >> >
> >> > I was wondering if someone knew if it's possible to project or
> >> transform
> >> > within the same table in a database, using ogr2ogr.
> >> >
> >> > What I mean is, I have a table with fields: id, id2, geom_wkt_27700
> and
> >> I
> >> > would like, using a single command to create an extra column
> >> > "geom_wkt_4326" for instance. It does not have to be of type geometry,
> >> but
> >> > could be text for instance.
> >> >
> >> > I guess the other plausible solution would be to create a temporary
> >> table
> >> > with that transformation on it and reference it to the first one by id
> >> for
> >> > instance.
> >> >
> >> > Any help is appreciated!
> >> >
> >> > Thanks,
> >> > Hector
> >> >
> >> > _______________________________________________
> >> > gdal-dev mailing list
> >>
> >> > gdal-dev at .osgeo
> >>
> >> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >>
> >>
> >>
> >>
> >> --
> >> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> >> _______________________________________________
> >> gdal-dev mailing list
> >>
>
> > gdal-dev at .osgeo
>
> >> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >>
> >
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/37b8e2b1/attachment-0001.html>

From bclay at infoscitex.com  Wed Dec  2 04:49:56 2020
From: bclay at infoscitex.com (Clay, Bruce)
Date: Wed, 2 Dec 2020 12:49:56 +0000
Subject: [gdal-dev] [EXTERNAL] Re: Converting OBJ to Geojson files with
 ogr2ogr
In-Reply-To: <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
 <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>,
 <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
Message-ID: <a13457527f0e4347b181734edf9e942c@infoscitex.com>

Take a look at CityXml / CityGml and CityJson.  There is partial support at least in GDAL based on web searches.  Also some support for QGIS through a plugin


Bruce


________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Paul Harwood <runette at gmail.com>
Sent: Wednesday, December 2, 2020 5:31 AM
To: Andrew C Aitchison
Cc: gdal-dev at lists.osgeo.org
Subject: [EXTERNAL] Re: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr

.OBJ is a simple object mesh  (or to put it in more traditional terms: TIN) - it has shape but no data values and is not geolocated.

I don't think there is any driver for OGR that will read .OBJ.

You are going to problems with geolocation if you write your own. Geojson requires that the geometries are geolocated - and in the current version that they are in epsg:4326. That is not totally impossible - people have been using .dxf files for gis data for decades and that format is also not in theory geolocated. It is not a trivial problem though.

I guess I would ask the usual question .. why?

- what are you actually trying to achieve and why a GIS format like GeoJSON?

- If you have to use GeoJSON - I am guessing you are transferring some data to something that reads GeoJSON only? In that case - can your source produce .dxf? OGR can read .dxf.

- If you only have the source in .OBJ - what other formats can the destination read? Although, if you only have the source in .obj, I very much doubt any of the GIS tools like GDAL are going to be able to help you. It just is not a format used in GIS.

It is a problem we solved in the ViRGiS projec<https://usg02.safelinks.protection.office365.us/?url=http%3A%2F%2Fwww.virgis.org%2F&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296346911%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=P2rkx2BIsKJ0GPY3EdGesGO%2B9Az%2FTB5s0f9YMRkH%2FH0%3D&reserved=0>t - since .obj is used a lot in VR. There we used an existing library to read the .obj files - but that is in C# and I doubt that would help you.

On Tue, 1 Dec 2020 at 20:15, Andrew C Aitchison <andrew at aitchison.me.uk<mailto:andrew at aitchison.me.uk>> wrote:
On Tue, 1 Dec 2020, Brandon Biggs wrote:

> Hello,
> I am wondering how to convert an obj file to a geojson file? I am using ogr2ogr with the command:
> Ogr2ogr -f geojson output.geojson input.obj
> But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> the vector drivers page<https://gdal.org/drivers/vector/index.html<https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgdal.org%2Fdrivers%2Fvector%2Findex.html&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296346911%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=YlMoWYX%2FArELUfRlhGmaqSd8H%2BQeyhJKoWz2FZSQoNM%3D&reserved=0>>
> but am unable to find a simple obj converter. I am wondering if there is such a thing? I am probably going to write my own that does what I want, because OBJ is so simple, I was just wondering if GDAL could already do it.

I've never heard of OBJ, but that doesn't mean much.

If you only want a read-only ogr driver you might want to look at
        https://gdal.org/tutorials/vector_python_driver.html<https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgdal.org%2Ftutorials%2Fvector_python_driver.html&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296356903%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=ulnrpqd06IeuubvWwEkSSFhsPUWFw9rsfdYfGWf0zis%3D&reserved=0>
if you would find a quick-n-dirty python quicker to write than C++.

--
Andrew C. Aitchison                                     Kendal, UK
                        andrew at aitchison.me.uk<mailto:andrew at aitchison.me.uk>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev<https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296356903%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=teiA9QIidI%2F3%2FdzekPU0zwZ%2FySofRSBD1D5OMhPsndc%3D&reserved=0>

From mj10777 at googlemail.com  Wed Dec  2 05:30:34 2020
From: mj10777 at googlemail.com (Mark Johnson)
Date: Wed, 2 Dec 2020 14:30:34 +0100
Subject: [gdal-dev] ogr2ogr project/transform CRS in the same database table
Message-ID: <CAEEbjBirby3uy+yCjwbFoGGSxBJvVBQ5a3D3RG3-FBwiSn0oxA@mail.gmail.com>

See MSSQLSpatial - Microsoft SQL Server Spatial Database ? GDAL
documentation

https://gdal.org/drivers/vector/mssqlspatial.html

The MS SQL Spatial driver passes SQL statements directly to MS SQL by
default, rather than evaluating them internally when using the ExecuteSQL()
call on the OGRDataSource, or the -sql command option to ogr2ogr. Attribute
query expressions are also passed directly through to MSSQL. It?s also
possible to request the OGR MSSQL driver to handle SQL commands with the
OGR SQL engine, by passing ?OGRSQL? string to the ExecuteSQL() method, as
the name of the SQL dialect.

Since you are using -dialect sqlite, it is not clear (to me) who is
executing the spatial commands.

In MS SQL, the spatial command don't contain the '_' as elsewhere in
spatialite and postgis. I also don't see a ST_Transform command listed.

STAsText (geometry Data Type) - SQL Server | Microsoft Docs

https://docs.microsoft.com/en-us/sql/t-sql/spatial-geometry/stastext-geometry-data-type?view=sql-server-ver15
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/28b22d6c/attachment.html>

From runette at gmail.com  Wed Dec  2 05:51:46 2020
From: runette at gmail.com (Paul Harwood)
Date: Wed, 2 Dec 2020 13:51:46 +0000
Subject: [gdal-dev] [EXTERNAL] Re: Converting OBJ to Geojson files with
 ogr2ogr
In-Reply-To: <a13457527f0e4347b181734edf9e942c@infoscitex.com>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
 <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>
 <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
 <a13457527f0e4347b181734edf9e942c@infoscitex.com>
Message-ID: <CAE8nN5MCCSaN4Eta4GPXSfGKF6UDW+Pfy+RE3RA2TQdmoyk0CQ@mail.gmail.com>

I guess the OP can answer for themselves but I am curious since I cannot
see anyway that Cityxxx would facilitate the conversion of an .obj into
GeoJSON ?

On Wed, 2 Dec 2020 at 12:49, Clay, Bruce <bclay at infoscitex.com> wrote:

> Take a look at CityXml / CityGml and CityJson.  There is partial support
> at least in GDAL based on web searches.  Also some support for QGIS through
> a plugin
>
>
> Bruce
>
>
> ________________________________
> From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Paul
> Harwood <runette at gmail.com>
> Sent: Wednesday, December 2, 2020 5:31 AM
> To: Andrew C Aitchison
> Cc: gdal-dev at lists.osgeo.org
> Subject: [EXTERNAL] Re: [gdal-dev] Converting OBJ to Geojson files with
> ogr2ogr
>
> .OBJ is a simple object mesh  (or to put it in more traditional terms:
> TIN) - it has shape but no data values and is not geolocated.
>
> I don't think there is any driver for OGR that will read .OBJ.
>
> You are going to problems with geolocation if you write your own. Geojson
> requires that the geometries are geolocated - and in the current version
> that they are in epsg:4326. That is not totally impossible - people have
> been using .dxf files for gis data for decades and that format is also not
> in theory geolocated. It is not a trivial problem though.
>
> I guess I would ask the usual question .. why?
>
> - what are you actually trying to achieve and why a GIS format like
> GeoJSON?
>
> - If you have to use GeoJSON - I am guessing you are transferring some
> data to something that reads GeoJSON only? In that case - can your source
> produce .dxf? OGR can read .dxf.
>
> - If you only have the source in .OBJ - what other formats can the
> destination read? Although, if you only have the source in .obj, I very
> much doubt any of the GIS tools like GDAL are going to be able to help you.
> It just is not a format used in GIS.
>
> It is a problem we solved in the ViRGiS projec<
> https://usg02.safelinks.protection.office365.us/?url=http%3A%2F%2Fwww.virgis.org%2F&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296346911%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=P2rkx2BIsKJ0GPY3EdGesGO%2B9Az%2FTB5s0f9YMRkH%2FH0%3D&reserved=0>t
> - since .obj is used a lot in VR. There we used an existing library to read
> the .obj files - but that is in C# and I doubt that would help you.
>
> On Tue, 1 Dec 2020 at 20:15, Andrew C Aitchison <andrew at aitchison.me.uk
> <mailto:andrew at aitchison.me.uk>> wrote:
> On Tue, 1 Dec 2020, Brandon Biggs wrote:
>
> > Hello,
> > I am wondering how to convert an obj file to a geojson file? I am using
> ogr2ogr with the command:
> > Ogr2ogr -f geojson output.geojson input.obj
> > But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> > the vector drivers page<https://gdal.org/drivers/vector/index.html<
> https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgdal.org%2Fdrivers%2Fvector%2Findex.html&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296346911%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=YlMoWYX%2FArELUfRlhGmaqSd8H%2BQeyhJKoWz2FZSQoNM%3D&reserved=0
> >>
> > but am unable to find a simple obj converter. I am wondering if there is
> such a thing? I am probably going to write my own that does what I want,
> because OBJ is so simple, I was just wondering if GDAL could already do it.
>
> I've never heard of OBJ, but that doesn't mean much.
>
> If you only want a read-only ogr driver you might want to look at
>         https://gdal.org/tutorials/vector_python_driver.html<
> https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Fgdal.org%2Ftutorials%2Fvector_python_driver.html&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296356903%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=ulnrpqd06IeuubvWwEkSSFhsPUWFw9rsfdYfGWf0zis%3D&reserved=0
> >
> if you would find a quick-n-dirty python quicker to write than C++.
>
> --
> Andrew C. Aitchison                                     Kendal, UK
>                         andrew at aitchison.me.uk<mailto:
> andrew at aitchison.me.uk>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev<
> https://usg02.safelinks.protection.office365.us/?url=https%3A%2F%2Flists.osgeo.org%2Fmailman%2Flistinfo%2Fgdal-dev&data=04%7C01%7C%7C0da679eff03c4694022308d896ad7f40%7C3430c5de5e6f4f9d9d9690e985038b58%7C0%7C0%7C637425019296356903%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=teiA9QIidI%2F3%2FdzekPU0zwZ%2FySofRSBD1D5OMhPsndc%3D&reserved=0
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/a41e7165/attachment.html>

From mattijn at gmail.com  Wed Dec  2 07:18:37 2020
From: mattijn at gmail.com (mattijn)
Date: Wed, 2 Dec 2020 16:18:37 +0100
Subject: [gdal-dev] Transformation works in GDAL2 but cause problems in GDAL3
Message-ID: <CAL4Gwo5xoCw7d9kq2x1kJbk7fk4GkgFx6J+XHM13biVSVnVmfQ@mail.gmail.com>

Dear all,

Question: how do I define my source raster instance, to avoid using the
advance `-ct` operator in gdalwarp in GDAL3 during reprojection?

I've been reading
https://trac.osgeo.org/gdal/wiki/rfc73_proj6_wkt2_srsbarn#Axisorderissues
 and
https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
and I've tried numerous things and I really wished I could have found the
info by myself.
But I'm a bit lost.

I've a .h5 file with data originating from the Dutch weather radar.
I've an *old
fashion* PROJ.4 definition and an Affine instance. Based on this
information I was, using GDAL2, able to create a registered-raster instance
or geotiff. And then using gdalwarp I could reproject it to a more
common epsg:28992 or epsg:4326 projection.

But now, using GDAL3, I cannot get the gdalwarp reprojection to give me
anything that comes close to what was possible in GDAL2.

In GDAL2 the following works:

echo "0.000 -3650.000" | gdaltransform -s_srs '+proj=stere +x_0=0
+y_0=0 +lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752' -t_srs
EPSG:4326 --debug on


OGRCT: Source: +proj=stere +lat_0=90 +lat_ts=60 +lon_0=0 +k=1 +x_0=0
+y_0=0 +a=6378.137 +b=6356.752 +units=m +no_defs
OGRCT: Target: +proj=longlat +datum=WGS84 +no_defs
OGRCT: Source: +proj=longlat +datum=WGS84 +no_defs
OGRCT: Target: +proj=stere +lat_0=90 +lat_ts=60 +lon_0=0 +k=1 +x_0=0
+y_0=0 +a=6378.137 +b=6356.752 +units=m +no_defs
0 55.9735620711571 0


But now with GDAL3 using the same command I get:

ERROR 1: PROJ: proj_create_operations: Source and target ellipsoid do not
belong to the same celestial body

And using the `-ct` operator with GDAL3 I get this:

echo "0.000 -3650.000" | gdaltransform -s_srs '+proj=stere +x_0=0 +y_0=0
+lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752' -t_srs EPSG:4326 -ct
'+proj=axisswap +order=2,1 +step' --debug on

0 -3650 0

All in all, I like to know how I could create or define my source raster
instance operable for GDAL3 in such a way, it is able to reproject it
correctly without any advanced reprojection operators.

I've prepared all this as well in this GitHub Notebook
<https://github.com/mattijn/KNMI-radar-PyGMT/blob/main/reproject%20knmi%20radar%20using%20rasterio.ipynb>
in Python, that works with GDAL2 installed, but fails similar as above with
GDAL3. In this notebook is referred to a file that is included in the repo
of the notebook.

Any help or advice is much appreciated!

Kind regards,
Mattijn van Hoek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/9a2a0871/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec  2 07:42:31 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 2 Dec 2020 08:42:31 -0700 (MST)
Subject: [gdal-dev] gdal_create: input file option
In-Reply-To: <3491985.JaXWAuQ7dA@even-i700>
References: <3044ca7837634d7cb7f288e10150dbda@maanmittauslaitos.fi>
 <3491985.JaXWAuQ7dA@even-i700>
Message-ID: <1606923751872-0.post@n6.nabble.com>

Hi,

Great, allowing to override all automatically captured parameters is
probably a good feature. I believe that some users will find this new option
useful.

Next challenge could be to burn vertical and horizontal gridlines for
warping and resampling tests.

-Jukka-



Even Rouault-2 wrote
> On mardi 1 d?cembre 2020 13:23:58 CET Rahkonen Jukka (MML) wrote:
>> Hi,
>> 
>> Every now and then people would like to rasterize vectors into raster
>> that
>> matches exactly with some existing raster. There are a few possible ways
>> for creating an empty copy from a raster with GDAL tools
>> https://gis.stackexchange.com/questions/220753/how-do-i-create-blank-geotif
>> f-with-same-spatial-properties-as-existing-geotiff . The gdal_merge way
>> with
>> -createonly does the job and is fast, but who remembers that gdal_merge
>> exists and can be used for such purpose? How about to add an option like
>> "-if" (input file) into gdal_create program, with the same effect?
>> Options
>> -outsize, -a_srs, -a_ullr would have no effect if used together with
>> input
>> template file. Options -of, -bands, -ot, -a_nodata, -co could override if
>> given. Not sure about metadata, but probably it is never worth copying
>> from
>> the template file.
> 
> I've mostly followed your suggestion in
> https://github.com/OSGeo/gdal/pull/3255
> 
> Not sure if it will be useful, but to avoid too many exceptions, -outsize,
> -a-
> srs, -a_ullr can actually override the settings of the input file
> 
> Even
> 
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From brandon.biggs at ski.org  Wed Dec  2 08:02:31 2020
From: brandon.biggs at ski.org (Brandon Biggs)
Date: Wed, 2 Dec 2020 16:02:31 +0000
Subject: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
In-Reply-To: <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
 <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>,
 <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
Message-ID: <BY5PR16MB3239F0F600535F1E0335B094F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>

Hello,
It's for a custom coordinate system for VR. Geojson provides a very easy syntax for properties and geometries that I like to use with origin at 0,0 bottom left.
I'll probably write my own converter, as OBJ is kind of an important file type we need to support.
Thanks,


Brandon Biggs<https://www.ski.org/users/brandon-biggs>
Engineer

Smith-Kettlewell Eye Research Institute
Office: 415-345-2130
Cell: 650-833-9394

________________________________
From: Paul Harwood <runette at gmail.com>
Sent: Wednesday, December 2, 2020 2:31 AM
To: Andrew C Aitchison <andrew at aitchison.me.uk>
Cc: Brandon Biggs <brandon.biggs at ski.org>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr

.OBJ is a simple object mesh  (or to put it in more traditional terms: TIN) - it has shape but no data values and is not geolocated.

I don't think there is any driver for OGR that will read .OBJ.

You are going to problems with geolocation if you write your own. Geojson requires that the geometries are geolocated - and in the current version that they are in epsg:4326. That is not totally impossible - people have been using .dxf files for gis data for decades and that format is also not in theory geolocated. It is not a trivial problem though.

I guess I would ask the usual question .. why?

- what are you actually trying to achieve and why a GIS format like GeoJSON?

- If you have to use GeoJSON - I am guessing you are transferring some data to something that reads GeoJSON only? In that case - can your source produce .dxf? OGR can read .dxf.

- If you only have the source in .OBJ - what other formats can the destination read? Although, if you only have the source in .obj, I very much doubt any of the GIS tools like GDAL are going to be able to help you. It just is not a format used in GIS.

It is a problem we solved in the ViRGiS projec<http://www.virgis.org>t - since .obj is used a lot in VR. There we used an existing library to read the .obj files - but that is in C# and I doubt that would help you.

On Tue, 1 Dec 2020 at 20:15, Andrew C Aitchison <andrew at aitchison.me.uk<mailto:andrew at aitchison.me.uk>> wrote:
On Tue, 1 Dec 2020, Brandon Biggs wrote:

> Hello,
> I am wondering how to convert an obj file to a geojson file? I am using ogr2ogr with the command:
> Ogr2ogr -f geojson output.geojson input.obj
> But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> the vector drivers page<https://gdal.org/drivers/vector/index.html>
> but am unable to find a simple obj converter. I am wondering if there is such a thing? I am probably going to write my own that does what I want, because OBJ is so simple, I was just wondering if GDAL could already do it.

I've never heard of OBJ, but that doesn't mean much.

If you only want a read-only ogr driver you might want to look at
        https://gdal.org/tutorials/vector_python_driver.html
if you would find a quick-n-dirty python quicker to write than C++.

--
Andrew C. Aitchison                                     Kendal, UK
                        andrew at aitchison.me.uk<mailto:andrew at aitchison.me.uk>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/e4a85b30/attachment.html>

From njacadieux.gitlab at gmail.com  Wed Dec  2 12:16:44 2020
From: njacadieux.gitlab at gmail.com (Nicolas Cadieux)
Date: Wed, 2 Dec 2020 15:16:44 -0500
Subject: [gdal-dev] gdal_translate,
 exporting "Byte - Eight bit unsigned integer" single band tiff to
 gpkg using -ot Byte results in 4 bands raster with changed values
Message-ID: <3efe5401-8991-2b87-8e72-4c6ca8d00383@gmail.com>

Hi,

This follows a discussion in the qgis-user mailing list.? We are using 
gdal_translate (and QGIS "export as") on a 8bit unsigned single band 
tiff to a .gpkg.? When using no -ot switch or when using -ot Byte, this 
results in a 4 band .gpkg raster with the wrong values.? (Values in band 
1 to 3 are similar but off the mark). Band 4 is set at 255 as expected.? 
Looks like some type of compression is going on in the band 1 to 3).

When saving using the -ot Int16 or Float32 switch, all is well and the 
result has one band with the correct values.

ex: gdal_translate -ot Int16 -of GPKG "E:/Users/Nicolas/Google Drive 
Nicolas/Partage_temporaire/qgis/int16.gpkg" "E:/Users/Nicolas/Google 
Drive Nicolas/Partage_temporaire/qgis/int16.gpkg"

Is this a possible problem with the driver or is the problem sitting 18 
inches in front of the screen? Problem similar on a Mac running QGIS 
3.10.1-A with GDAL 3.0.2 and QGIS3.16 on Windows running GDAL 3.1.4.

Test files are found here: 
https://drive.google.com/drive/folders/1fMl9odowUFFRQFK61rTxgHeom_D8ymN6?usp=sharing

Thanks!

Nicolas

Nicolas Cadieux
https://gitlab.com/njacadieux


From runette at gmail.com  Wed Dec  2 12:20:38 2020
From: runette at gmail.com (Paul Harwood)
Date: Wed, 2 Dec 2020 20:20:38 +0000
Subject: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
In-Reply-To: <BY5PR16MB3239F0F600535F1E0335B094F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
 <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>
 <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
 <BY5PR16MB3239F0F600535F1E0335B094F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>
Message-ID: <CAE8nN5M23b7KvdPFQqjpnHTg+zre4pED_Ycb4ZTRdSRbwsRXTg@mail.gmail.com>

GeoJSON is very good for many things but I would not convert an .OBJ to
GeoJSON and then into the VR space local coordinate system. You are going
to have project the OBJ into 4326 and then project it again into the local
coordinate system - even if implicitly. Go directly from OBJ to an internal
mesh.

If you are building the VR in Unity - you can use this to do it :

https://openupm.com/packages/com.virgis.geometry3sharp/

You really should take a look at what we are doing at www.virgis.org - we
have worked a lot of this out. It is in Unity but even if you are not using
Unity there could be good learnings.





On Wed, 2 Dec 2020 at 16:02, Brandon Biggs <brandon.biggs at ski.org> wrote:

> Hello,
> It's for a custom coordinate system for VR. Geojson provides a very easy
> syntax for properties and geometries that I like to use with origin at 0,0
> bottom left.
> I'll probably write my own converter, as OBJ is kind of an important file
> type we need to support.
> Thanks,
>
>
> Brandon Biggs <https://www.ski.org/users/brandon-biggs>
> Engineer
>
> Smith-Kettlewell Eye Research Institute
> Office: 415-345-2130
> Cell: 650-833-9394
>
> ------------------------------
> *From:* Paul Harwood <runette at gmail.com>
> *Sent:* Wednesday, December 2, 2020 2:31 AM
> *To:* Andrew C Aitchison <andrew at aitchison.me.uk>
> *Cc:* Brandon Biggs <brandon.biggs at ski.org>; gdal-dev at lists.osgeo.org <
> gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
>
> .OBJ is a simple object mesh  (or to put it in more traditional terms:
> TIN) - it has shape but no data values and is not geolocated.
>
> I don't think there is any driver for OGR that will read .OBJ.
>
> You are going to problems with geolocation if you write your own. Geojson
> requires that the geometries are geolocated - and in the current version
> that they are in epsg:4326. That is not totally impossible - people have
> been using .dxf files for gis data for decades and that format is also not
> in theory geolocated. It is not a trivial problem though.
>
> I guess I would ask the usual question .. why?
>
> - what are you actually trying to achieve and why a GIS format like
> GeoJSON?
>
> - If you have to use GeoJSON - I am guessing you are transferring some
> data to something that reads GeoJSON only? In that case - can your source
> produce .dxf? OGR can read .dxf.
>
> - If you only have the source in .OBJ - what other formats can the
> destination read? Although, if you only have the source in .obj, I very
> much doubt any of the GIS tools like GDAL are going to be able to help you.
> It just is not a format used in GIS.
>
> It is a problem we solved in the ViRGiS projec <http://www.virgis.org>t -
> since .obj is used a lot in VR. There we used an existing library to read
> the .obj files - but that is in C# and I doubt that would help you.
>
> On Tue, 1 Dec 2020 at 20:15, Andrew C Aitchison <andrew at aitchison.me.uk>
> wrote:
>
> On Tue, 1 Dec 2020, Brandon Biggs wrote:
>
> > Hello,
> > I am wondering how to convert an obj file to a geojson file? I am using
> ogr2ogr with the command:
> > Ogr2ogr -f geojson output.geojson input.obj
> > But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> > the vector drivers page<https://gdal.org/drivers/vector/index.html>
> > but am unable to find a simple obj converter. I am wondering if there is
> such a thing? I am probably going to write my own that does what I want,
> because OBJ is so simple, I was just wondering if GDAL could already do it.
>
> I've never heard of OBJ, but that doesn't mean much.
>
> If you only want a read-only ogr driver you might want to look at
>         https://gdal.org/tutorials/vector_python_driver.html
> if you would find a quick-n-dirty python quicker to write than C++.
>
> --
> Andrew C. Aitchison                                     Kendal, UK
>                         andrew at aitchison.me.uk
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/da1b3afc/attachment.html>

From even.rouault at spatialys.com  Wed Dec  2 12:55:34 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 02 Dec 2020 21:55:34 +0100
Subject: [gdal-dev] gdal_translate,
 exporting "Byte - Eight bit unsigned integer" single band tiff to
 gpkg using -ot Byte results in 4 bands raster with changed values
In-Reply-To: <3efe5401-8991-2b87-8e72-4c6ca8d00383@gmail.com>
References: <3efe5401-8991-2b87-8e72-4c6ca8d00383@gmail.com>
Message-ID: <4839492.jGSs15A7Cb@even-i700>

On mercredi 2 d?cembre 2020 15:16:44 CET Nicolas Cadieux wrote:
> Hi,
> 
> This follows a discussion in the qgis-user mailing list.  We are using
> gdal_translate (and QGIS "export as") on a 8bit unsigned single band
> tiff to a .gpkg.  When using no -ot switch or when using -ot Byte, this
> results in a 4 band .gpkg raster with the wrong values.  (Values in band
> 1 to 3 are similar but off the mark). Band 4 is set at 255 as expected. 
> Looks like some type of compression is going on in the band 1 to 3).
> 
> When saving using the -ot Int16 or Float32 switch, all is well and the
> result has one band with the correct values.
> 
> ex: gdal_translate -ot Int16 -of GPKG "E:/Users/Nicolas/Google Drive
> Nicolas/Partage_temporaire/qgis/int16.gpkg" "E:/Users/Nicolas/Google
> Drive Nicolas/Partage_temporaire/qgis/int16.gpkg"
> 
> Is this a possible problem with the driver or is the problem sitting 18
> inches in front of the screen? Problem similar on a Mac running QGIS
> 3.10.1-A with GDAL 3.0.2 and QGIS3.16 on Windows running GDAL 3.1.4.
> 
> Test files are found here:
> https://drive.google.com/drive/folders/1fMl9odowUFFRQFK61rTxgHeom_D8ymN6?usp
> =sharing
> 

The answer is there:
https://gdal.org/drivers/raster/gpkg.html#tile-formats

For Byte input (that isn't recognized as to be used by the tiled gridded 
coverage data), the default tile format will use JPEG lossy compression for 
tiles with a fully opaque channel.

-co TILE_FORMAT=PNG will use lossless compression

GeoPackage raster aim was initially for visualisation purposes, hence this 
default. The more analytic side was a later addition to the format, and 
actually an extension

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From brandon.biggs at ski.org  Wed Dec  2 12:57:49 2020
From: brandon.biggs at ski.org (Brandon Biggs)
Date: Wed, 2 Dec 2020 20:57:49 +0000
Subject: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
In-Reply-To: <CAE8nN5M23b7KvdPFQqjpnHTg+zre4pED_Ycb4ZTRdSRbwsRXTg@mail.gmail.com>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
 <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>
 <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
 <BY5PR16MB3239F0F600535F1E0335B094F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>,
 <CAE8nN5M23b7KvdPFQqjpnHTg+zre4pED_Ycb4ZTRdSRbwsRXTg@mail.gmail.com>
Message-ID: <BY5PR16MB323978D96D71B999574348B9F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>

Hello,
We're using JavaScript, not Unity, but this is very interesting, I wish it was a JS package.
We're kind of using Geojson as our internal coordinate system at the moment, but with a few oddities, like allowing 0.0 as the origin, rather than using Long lat.
I just built a parser, so we're good.
Thanks,


Brandon Biggs<https://www.ski.org/users/brandon-biggs>
Engineer

Smith-Kettlewell Eye Research Institute
Office: 415-345-2130
Cell: 650-833-9394

________________________________
From: Paul Harwood <runette at gmail.com>
Sent: Wednesday, December 2, 2020 12:20 PM
To: Brandon Biggs <brandon.biggs at ski.org>
Cc: Andrew C Aitchison <andrew at aitchison.me.uk>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr

GeoJSON is very good for many things but I would not convert an .OBJ to GeoJSON and then into the VR space local coordinate system. You are going to have project the OBJ into 4326 and then project it again into the local coordinate system - even if implicitly. Go directly from OBJ to an internal mesh.

If you are building the VR in Unity - you can use this to do it :

https://openupm.com/packages/com.virgis.geometry3sharp/

You really should take a look at what we are doing at www.virgis.org<http://www.virgis.org> - we have worked a lot of this out. It is in Unity but even if you are not using Unity there could be good learnings.





On Wed, 2 Dec 2020 at 16:02, Brandon Biggs <brandon.biggs at ski.org<mailto:brandon.biggs at ski.org>> wrote:
Hello,
It's for a custom coordinate system for VR. Geojson provides a very easy syntax for properties and geometries that I like to use with origin at 0,0 bottom left.
I'll probably write my own converter, as OBJ is kind of an important file type we need to support.
Thanks,


Brandon Biggs<https://www.ski.org/users/brandon-biggs>
Engineer

Smith-Kettlewell Eye Research Institute
Office: 415-345-2130
Cell: 650-833-9394

________________________________
From: Paul Harwood <runette at gmail.com<mailto:runette at gmail.com>>
Sent: Wednesday, December 2, 2020 2:31 AM
To: Andrew C Aitchison <andrew at aitchison.me.uk<mailto:andrew at aitchison.me.uk>>
Cc: Brandon Biggs <brandon.biggs at ski.org<mailto:brandon.biggs at ski.org>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org> <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: Re: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr

.OBJ is a simple object mesh  (or to put it in more traditional terms: TIN) - it has shape but no data values and is not geolocated.

I don't think there is any driver for OGR that will read .OBJ.

You are going to problems with geolocation if you write your own. Geojson requires that the geometries are geolocated - and in the current version that they are in epsg:4326. That is not totally impossible - people have been using .dxf files for gis data for decades and that format is also not in theory geolocated. It is not a trivial problem though.

I guess I would ask the usual question .. why?

- what are you actually trying to achieve and why a GIS format like GeoJSON?

- If you have to use GeoJSON - I am guessing you are transferring some data to something that reads GeoJSON only? In that case - can your source produce .dxf? OGR can read .dxf.

- If you only have the source in .OBJ - what other formats can the destination read? Although, if you only have the source in .obj, I very much doubt any of the GIS tools like GDAL are going to be able to help you. It just is not a format used in GIS.

It is a problem we solved in the ViRGiS projec<http://www.virgis.org>t - since .obj is used a lot in VR. There we used an existing library to read the .obj files - but that is in C# and I doubt that would help you.

On Tue, 1 Dec 2020 at 20:15, Andrew C Aitchison <andrew at aitchison.me.uk<mailto:andrew at aitchison.me.uk>> wrote:
On Tue, 1 Dec 2020, Brandon Biggs wrote:

> Hello,
> I am wondering how to convert an obj file to a geojson file? I am using ogr2ogr with the command:
> Ogr2ogr -f geojson output.geojson input.obj
> But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> the vector drivers page<https://gdal.org/drivers/vector/index.html>
> but am unable to find a simple obj converter. I am wondering if there is such a thing? I am probably going to write my own that does what I want, because OBJ is so simple, I was just wondering if GDAL could already do it.

I've never heard of OBJ, but that doesn't mean much.

If you only want a read-only ogr driver you might want to look at
        https://gdal.org/tutorials/vector_python_driver.html
if you would find a quick-n-dirty python quicker to write than C++.

--
Andrew C. Aitchison                                     Kendal, UK
                        andrew at aitchison.me.uk<mailto:andrew at aitchison.me.uk>
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/3dfce94b/attachment-0001.html>

From runette at gmail.com  Wed Dec  2 13:08:14 2020
From: runette at gmail.com (Paul Harwood)
Date: Wed, 2 Dec 2020 21:08:14 +0000
Subject: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
In-Reply-To: <BY5PR16MB323978D96D71B999574348B9F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>
References: <BY5PR16MB323944E10DCB1462BB7F835DF3F40@BY5PR16MB3239.namprd16.prod.outlook.com>
 <e1d87d2e-9054-51fd-2294-302229b33f2f@aitchison.me.uk>
 <CAE8nN5M5TkyvoPO+1PnXReHoRdi7bMDx5-oWFKC8NVuCroBiQA@mail.gmail.com>
 <BY5PR16MB3239F0F600535F1E0335B094F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>
 <CAE8nN5M23b7KvdPFQqjpnHTg+zre4pED_Ycb4ZTRdSRbwsRXTg@mail.gmail.com>
 <BY5PR16MB323978D96D71B999574348B9F3F30@BY5PR16MB3239.namprd16.prod.outlook.com>
Message-ID: <CAE8nN5OMp=SuySpdRRsvGWOQt1A+bqYyy+jH-z==jU0k+o=nhw@mail.gmail.com>

Whatever works for you - although I can sense the purists going cross-eyed
at the phrase "using Geojson as our internal coordinate system " :) I think
you might be piling up problems for your self later - but then I don't know
your scope.

Good luck.

PS - just to be clear "purist" is not meant to be in any way pejorative.

On Wed, 2 Dec 2020 at 20:57, Brandon Biggs <brandon.biggs at ski.org> wrote:

> Hello,
> We're using JavaScript, not Unity, but this is very interesting, I wish it
> was a JS package.
> We're kind of using Geojson as our internal coordinate system at the
> moment, but with a few oddities, like allowing 0.0 as the origin, rather
> than using Long lat.
> I just built a parser, so we're good.
> Thanks,
>
>
> Brandon Biggs <https://www.ski.org/users/brandon-biggs>
> Engineer
>
> Smith-Kettlewell Eye Research Institute
> Office: 415-345-2130
> Cell: 650-833-9394
>
> ------------------------------
> *From:* Paul Harwood <runette at gmail.com>
> *Sent:* Wednesday, December 2, 2020 12:20 PM
> *To:* Brandon Biggs <brandon.biggs at ski.org>
> *Cc:* Andrew C Aitchison <andrew at aitchison.me.uk>;
> gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
>
> GeoJSON is very good for many things but I would not convert an .OBJ to
> GeoJSON and then into the VR space local coordinate system. You are going
> to have project the OBJ into 4326 and then project it again into the local
> coordinate system - even if implicitly. Go directly from OBJ to an internal
> mesh.
>
> If you are building the VR in Unity - you can use this to do it :
>
> https://openupm.com/packages/com.virgis.geometry3sharp/
>
> You really should take a look at what we are doing at www.virgis.org - we
> have worked a lot of this out. It is in Unity but even if you are not using
> Unity there could be good learnings.
>
>
>
>
>
> On Wed, 2 Dec 2020 at 16:02, Brandon Biggs <brandon.biggs at ski.org> wrote:
>
> Hello,
> It's for a custom coordinate system for VR. Geojson provides a very easy
> syntax for properties and geometries that I like to use with origin at 0,0
> bottom left.
> I'll probably write my own converter, as OBJ is kind of an important file
> type we need to support.
> Thanks,
>
>
> Brandon Biggs <https://www.ski.org/users/brandon-biggs>
> Engineer
>
> Smith-Kettlewell Eye Research Institute
> Office: 415-345-2130
> Cell: 650-833-9394
>
> ------------------------------
> *From:* Paul Harwood <runette at gmail.com>
> *Sent:* Wednesday, December 2, 2020 2:31 AM
> *To:* Andrew C Aitchison <andrew at aitchison.me.uk>
> *Cc:* Brandon Biggs <brandon.biggs at ski.org>; gdal-dev at lists.osgeo.org <
> gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] Converting OBJ to Geojson files with ogr2ogr
>
> .OBJ is a simple object mesh  (or to put it in more traditional terms:
> TIN) - it has shape but no data values and is not geolocated.
>
> I don't think there is any driver for OGR that will read .OBJ.
>
> You are going to problems with geolocation if you write your own. Geojson
> requires that the geometries are geolocated - and in the current version
> that they are in epsg:4326. That is not totally impossible - people have
> been using .dxf files for gis data for decades and that format is also not
> in theory geolocated. It is not a trivial problem though.
>
> I guess I would ask the usual question .. why?
>
> - what are you actually trying to achieve and why a GIS format like
> GeoJSON?
>
> - If you have to use GeoJSON - I am guessing you are transferring some
> data to something that reads GeoJSON only? In that case - can your source
> produce .dxf? OGR can read .dxf.
>
> - If you only have the source in .OBJ - what other formats can the
> destination read? Although, if you only have the source in .obj, I very
> much doubt any of the GIS tools like GDAL are going to be able to help you.
> It just is not a format used in GIS.
>
> It is a problem we solved in the ViRGiS projec <http://www.virgis.org>t -
> since .obj is used a lot in VR. There we used an existing library to read
> the .obj files - but that is in C# and I doubt that would help you.
>
> On Tue, 1 Dec 2020 at 20:15, Andrew C Aitchison <andrew at aitchison.me.uk>
> wrote:
>
> On Tue, 1 Dec 2020, Brandon Biggs wrote:
>
> > Hello,
> > I am wondering how to convert an obj file to a geojson file? I am using
> ogr2ogr with the command:
> > Ogr2ogr -f geojson output.geojson input.obj
> > But get the error that ogr2ogr does not have an OBJ driver. I looked on:
> > the vector drivers page<https://gdal.org/drivers/vector/index.html>
> > but am unable to find a simple obj converter. I am wondering if there is
> such a thing? I am probably going to write my own that does what I want,
> because OBJ is so simple, I was just wondering if GDAL could already do it.
>
> I've never heard of OBJ, but that doesn't mean much.
>
> If you only want a read-only ogr driver you might want to look at
>         https://gdal.org/tutorials/vector_python_driver.html
> if you would find a quick-n-dirty python quicker to write than C++.
>
> --
> Andrew C. Aitchison                                     Kendal, UK
>                         andrew at aitchison.me.uk
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201202/8126816d/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec  2 13:16:11 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 2 Dec 2020 14:16:11 -0700 (MST)
Subject: [gdal-dev] gdal_translate,
 exporting "Byte - Eight bit unsigned integer" single band tiff to
 gpkg using -ot Byte results in 4 bands raster with changed values
In-Reply-To: <4839492.jGSs15A7Cb@even-i700>
References: <3efe5401-8991-2b87-8e72-4c6ca8d00383@gmail.com>
 <4839492.jGSs15A7Cb@even-i700>
Message-ID: <1606943771345-0.post@n6.nabble.com>

It might be good to read also about the open options in
https://gdal.org/drivers/raster/gpkg.html

"BAND_COUNT=1/2/3/4: Number of bands of the dataset exposed after opening.
Some conversions will be done when possible and implemented, but this might
fail in some cases, depending on the BAND_COUNT value and the number of
bands of the tile. Defaults to 4 (which is the always safe value)."

-Jukka Rahkonen-


Even Rouault-2 wrote
> On mercredi 2 d?cembre 2020 15:16:44 CET Nicolas Cadieux wrote:
>> Hi,
>> 
>> This follows a discussion in the qgis-user mailing list.  We are using
>> gdal_translate (and QGIS "export as") on a 8bit unsigned single band
>> tiff to a .gpkg.  When using no -ot switch or when using -ot Byte, this
>> results in a 4 band .gpkg raster with the wrong values.  (Values in band
>> 1 to 3 are similar but off the mark). Band 4 is set at 255 as expected. 
>> Looks like some type of compression is going on in the band 1 to 3).
>> 
>> When saving using the -ot Int16 or Float32 switch, all is well and the
>> result has one band with the correct values.
>> 
>> ex: gdal_translate -ot Int16 -of GPKG "E:/Users/Nicolas/Google Drive
>> Nicolas/Partage_temporaire/qgis/int16.gpkg" "E:/Users/Nicolas/Google
>> Drive Nicolas/Partage_temporaire/qgis/int16.gpkg"
>> 
>> Is this a possible problem with the driver or is the problem sitting 18
>> inches in front of the screen? Problem similar on a Mac running QGIS
>> 3.10.1-A with GDAL 3.0.2 and QGIS3.16 on Windows running GDAL 3.1.4.
>> 
>> Test files are found here:
>> https://drive.google.com/drive/folders/1fMl9odowUFFRQFK61rTxgHeom_D8ymN6?usp
>> =sharing
>> 
> 
> The answer is there:
> https://gdal.org/drivers/raster/gpkg.html#tile-formats
> 
> For Byte input (that isn't recognized as to be used by the tiled gridded 
> coverage data), the default tile format will use JPEG lossy compression
> for 
> tiles with a fully opaque channel.
> 
> -co TILE_FORMAT=PNG will use lossless compression
> 
> GeoPackage raster aim was initially for visualisation purposes, hence this 
> default. The more analytic side was a later addition to the format, and 
> actually an extension
> 
> Even
> 
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Thu Dec  3 02:19:19 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 03 Dec 2020 11:19:19 +0100
Subject: [gdal-dev] Transformation works in GDAL2 but cause problems in
 GDAL3
In-Reply-To: <CAL4Gwo5xoCw7d9kq2x1kJbk7fk4GkgFx6J+XHM13biVSVnVmfQ@mail.gmail.com>
References: <CAL4Gwo5xoCw7d9kq2x1kJbk7fk4GkgFx6J+XHM13biVSVnVmfQ@mail.gmail.com>
Message-ID: <1646959.zJHlO4bZCe@even-i700>

Mattijn,

> Question: how do I define my source raster instance, to avoid using the
> advance `-ct` operator in gdalwarp in GDAL3 during reprojection?

I don't think you can avoid it here. There seems to be an issue in either your 
source file or in the HDF5 driver regarding the unit of the ellipsoid axis. 
Normally the a and b parameters should be in meters, not kilometers.

> But now with GDAL3 using the same command I get:
> 
> ERROR 1: PROJ: proj_create_operations: Source and target ellipsoid do not
> belong to the same celestial body

yes it detects that the source and target ellipsoids are completely different, 
which is in most cases involve a non sensical attempt.

> And using the `-ct` operator with GDAL3 I get this:
> 
> echo "0.000 -3650.000" | gdaltransform -s_srs '+proj=stere +x_0=0 +y_0=0
> +lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752' -t_srs EPSG:4326 -ct
> '+proj=axisswap +order=2,1 +step' --debug on

Your -ct pipeline should include the full pipeline, not just an axisswap 
operation. For gdaltransform, you can remove the -s_srs and -t_srs parameters 
when you specify -ct. For gdalwarp / ogr2ogr, you can keep the -t_srs so that 
the output dataset has correct CRS information.

Your pipeline should be something like

+proj=pipeline +step +inv +proj=stere +x_0=0 +y_0=0
+lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752 +step +proj=axisswap 
+order=2,1

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mattijn at gmail.com  Thu Dec  3 02:26:17 2020
From: mattijn at gmail.com (mattijn)
Date: Thu, 3 Dec 2020 11:26:17 +0100
Subject: [gdal-dev] Transformation works in GDAL2 but cause problems in
 GDAL3
In-Reply-To: <1646959.zJHlO4bZCe@even-i700>
References: <CAL4Gwo5xoCw7d9kq2x1kJbk7fk4GkgFx6J+XHM13biVSVnVmfQ@mail.gmail.com>
 <1646959.zJHlO4bZCe@even-i700>
Message-ID: <CAL4Gwo7GXj53crjwHdBPb=TFYbOt7FxxwQOWtK4qNZj-+JoHHg@mail.gmail.com>

Dear Even,

Thanks for your response! It's much appreciated. I control the creation of
the source file, so I can adjust the unit of the ellipsoid axis in the
source. Would that help with avoiding the need of a  -ct pipeline?

Regards,
Mattijn

(forgot the Replay All, to send to the full list, instead of replying to
Even only.)


On Thu, 3 Dec 2020 at 11:19, Even Rouault <even.rouault at spatialys.com>
wrote:

> Mattijn,
>
> > Question: how do I define my source raster instance, to avoid using the
> > advance `-ct` operator in gdalwarp in GDAL3 during reprojection?
>
> I don't think you can avoid it here. There seems to be an issue in either
> your
> source file or in the HDF5 driver regarding the unit of the ellipsoid
> axis.
> Normally the a and b parameters should be in meters, not kilometers.
>
> > But now with GDAL3 using the same command I get:
> >
> > ERROR 1: PROJ: proj_create_operations: Source and target ellipsoid do not
> > belong to the same celestial body
>
> yes it detects that the source and target ellipsoids are completely
> different,
> which is in most cases involve a non sensical attempt.
>
> > And using the `-ct` operator with GDAL3 I get this:
> >
> > echo "0.000 -3650.000" | gdaltransform -s_srs '+proj=stere +x_0=0 +y_0=0
> > +lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752' -t_srs EPSG:4326
> -ct
> > '+proj=axisswap +order=2,1 +step' --debug on
>
> Your -ct pipeline should include the full pipeline, not just an axisswap
> operation. For gdaltransform, you can remove the -s_srs and -t_srs
> parameters
> when you specify -ct. For gdalwarp / ogr2ogr, you can keep the -t_srs so
> that
> the output dataset has correct CRS information.
>
> Your pipeline should be something like
>
> +proj=pipeline +step +inv +proj=stere +x_0=0 +y_0=0
> +lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752 +step +proj=axisswap
> +order=2,1
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201203/d305e093/attachment-0001.html>

From mattijn at gmail.com  Thu Dec  3 03:11:13 2020
From: mattijn at gmail.com (mattijn)
Date: Thu, 3 Dec 2020 12:11:13 +0100
Subject: [gdal-dev] Transformation works in GDAL2 but cause problems in
 GDAL3
In-Reply-To: <CAL4Gwo7GXj53crjwHdBPb=TFYbOt7FxxwQOWtK4qNZj-+JoHHg@mail.gmail.com>
References: <CAL4Gwo5xoCw7d9kq2x1kJbk7fk4GkgFx6J+XHM13biVSVnVmfQ@mail.gmail.com>
 <1646959.zJHlO4bZCe@even-i700>
 <CAL4Gwo7GXj53crjwHdBPb=TFYbOt7FxxwQOWtK4qNZj-+JoHHg@mail.gmail.com>
Message-ID: <CAL4Gwo6qXX=fGweHH0hVNWP3vngKrsyCZ11G-yMgbwucP9X26g@mail.gmail.com>

Dear Even et al.,

To answer my own question. Based on your comment on the units, I was able
to make it. By changing the Affine transformation as well. So the
gdaltransform example command becomes like this:
echo "0 -3650000" | gdaltransform -s_srs "+proj=stere +x_0=0 +y_0=0
+lat_0=90 +lon_0=0 +lat_ts=60 +a=6378137 +b=6356752" -t_srs EPSG:4326
And gives as result
0 90 0
This is really great! Let me send a message as well to the meteorological
agency so they can update their projection information.
Thanks again!
Regards,
Mattijn

On Thu, 3 Dec 2020 at 11:26, mattijn <mattijn at gmail.com> wrote:

> Dear Even,
>
> Thanks for your response! It's much appreciated. I control the creation of
> the source file, so I can adjust the unit of the ellipsoid axis in the
> source. Would that help with avoiding the need of a  -ct pipeline?
>
> Regards,
> Mattijn
>
> (forgot the Replay All, to send to the full list, instead of replying to
> Even only.)
>
>
> On Thu, 3 Dec 2020 at 11:19, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Mattijn,
>>
>> > Question: how do I define my source raster instance, to avoid using the
>> > advance `-ct` operator in gdalwarp in GDAL3 during reprojection?
>>
>> I don't think you can avoid it here. There seems to be an issue in either
>> your
>> source file or in the HDF5 driver regarding the unit of the ellipsoid
>> axis.
>> Normally the a and b parameters should be in meters, not kilometers.
>>
>> > But now with GDAL3 using the same command I get:
>> >
>> > ERROR 1: PROJ: proj_create_operations: Source and target ellipsoid do
>> not
>> > belong to the same celestial body
>>
>> yes it detects that the source and target ellipsoids are completely
>> different,
>> which is in most cases involve a non sensical attempt.
>>
>> > And using the `-ct` operator with GDAL3 I get this:
>> >
>> > echo "0.000 -3650.000" | gdaltransform -s_srs '+proj=stere +x_0=0 +y_0=0
>> > +lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752' -t_srs EPSG:4326
>> -ct
>> > '+proj=axisswap +order=2,1 +step' --debug on
>>
>> Your -ct pipeline should include the full pipeline, not just an axisswap
>> operation. For gdaltransform, you can remove the -s_srs and -t_srs
>> parameters
>> when you specify -ct. For gdalwarp / ogr2ogr, you can keep the -t_srs so
>> that
>> the output dataset has correct CRS information.
>>
>> Your pipeline should be something like
>>
>> +proj=pipeline +step +inv +proj=stere +x_0=0 +y_0=0
>> +lat_0=90 +lon_0=0 +lat_ts=60 +a=6378.137 +b=6356.752 +step
>> +proj=axisswap
>> +order=2,1
>>
>> Even
>>
>> --
>> Spatialys - Geospatial professional services
>> http://www.spatialys.com
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201203/07d279fc/attachment.html>

From felix.divo at sailingteam.tu-darmstadt.de  Thu Dec  3 05:16:24 2020
From: felix.divo at sailingteam.tu-darmstadt.de (Felix)
Date: Thu, 3 Dec 2020 14:16:24 +0100
Subject: [gdal-dev] Sampling raster bands at irregular points
Message-ID: <e54a660b-1f82-82e2-a179-3aa31a4da909@sailingteam.tu-darmstadt.de>

Hello All,

I'm here for some suggestions on how to sample from a raster band at 
_non-regular_ points. Non-regular in this context means that the points 
have arbitrary coordinates and do not lie on a regular lattice/mesh like 
all pairs of integers would do.

In my application, there is an irregular set of points for which we 
require bathymetric data (i.e. topographical data/elevation). I started 
out by manually reading in the ETOPO1 dataset (for now, we might use 
Earth2014 later) and then interpolating around each point sequentially. 
As we have up to hundred-tousands of points and doing the computation 
sequentially in Python/numpy, this is currently running for days (well, 
we canceled it at that point).

Ideally, I'd like to use something like the "gdal_grid" tool, where the 
interpolation algorithm can be configured and the heavy-lifting is done 
in C rather than in Python. But it only supports creating a new 
_regular_ grid. The inverse distance interpolation with cutoff radii 
would be ideal.

Does such a tool/such functionality exist in in GDAL or was my search 
rightfully fruitless? I mainly searched in the raster programs, the 
(C++) API of GDALRasterBand and of course generally in the internet. 
Thank you for your suggestions, in advance!

Cheers and Stay Safe
Felix Divo


From cpaulik at vandersat.com  Thu Dec  3 05:28:01 2020
From: cpaulik at vandersat.com (Christoph Paulik)
Date: Thu, 3 Dec 2020 14:28:01 +0100
Subject: [gdal-dev] Sampling raster bands at irregular points
In-Reply-To: <e54a660b-1f82-82e2-a179-3aa31a4da909@sailingteam.tu-darmstadt.de>
References: <e54a660b-1f82-82e2-a179-3aa31a4da909@sailingteam.tu-darmstadt.de>
Message-ID: <CAHtCBnjMSWwOszf6EARQdY3-6XSN1dr4hFqMMikd4cDMzoBhsQ@mail.gmail.com>

Hi Felix,

I'm really not sure I understand what exactly you are trying to do.
But if you have not tried pyresample yet it might do what you want. See
https://pyresample.readthedocs.io/en/latest/

Christoph

On Thu, 3 Dec 2020 at 14:16, Felix <felix.divo at sailingteam.tu-darmstadt.de>
wrote:

> Hello All,
>
> I'm here for some suggestions on how to sample from a raster band at
> _non-regular_ points. Non-regular in this context means that the points
> have arbitrary coordinates and do not lie on a regular lattice/mesh like
> all pairs of integers would do.
>
> In my application, there is an irregular set of points for which we
> require bathymetric data (i.e. topographical data/elevation). I started
> out by manually reading in the ETOPO1 dataset (for now, we might use
> Earth2014 later) and then interpolating around each point sequentially.
> As we have up to hundred-tousands of points and doing the computation
> sequentially in Python/numpy, this is currently running for days (well,
> we canceled it at that point).
>
> Ideally, I'd like to use something like the "gdal_grid" tool, where the
> interpolation algorithm can be configured and the heavy-lifting is done
> in C rather than in Python. But it only supports creating a new
> _regular_ grid. The inverse distance interpolation with cutoff radii
> would be ideal.
>
> Does such a tool/such functionality exist in in GDAL or was my search
> rightfully fruitless? I mainly searched in the raster programs, the
> (C++) API of GDALRasterBand and of course generally in the internet.
> Thank you for your suggestions, in advance!
>
> Cheers and Stay Safe
> Felix Divo
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
*Christoph Paulik* | Head of Infrastructure

*VanderSat.** Unmatched water data. Satellite observed.*

Wilhelminastraat 43a, 2011 VK, Haarlem, The Netherlands

M: +31(0)618271928
vandersat.com <http://www.vandersat.com/> | Linkedin
<https://www.linkedin.com/company/vandersat> | Twitter
<https://twitter.com/VanderSatNL>

--------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201203/8337d4dd/attachment.html>

From evert.etienne at sitemark.com  Thu Dec  3 06:13:20 2020
From: evert.etienne at sitemark.com (Evert Etienne (SITEMARK))
Date: Thu, 3 Dec 2020 14:13:20 +0000
Subject: [gdal-dev] MBTiles generation docs question
Message-ID: <CC88448B-DC77-4197-8E0A-13FEC8E4C5EC@sitemark.com>

Dear,

I have a question about the following extract of the MBTiles driver docs (https://gdal.org/drivers/raster/mbtiles.html#raster-creation-issues)

> When using the CreateCopy() API (such as with gdal_translate), automatic reprojection of the input dataset to EPSG:3857 (WebMercator) will be done, with selection of the appropriate zoom level.

As far as I understand it, the input file (tif in my case) will be warped to 3857 before MBTiles generation. But I am unsure what the appropriate zoom level means in this case, could someone elaborate or point me in a next direction to investigate?

I was looking at these docs for the explanation of the following error I got, pointers much appreciated as well.

`gdal_translate output.tif output.mbtiles -of MBTILES
Input file size is 88543, 68686
ERROR 1: Could not find an approproate zoom level`

Many thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201203/09612a3b/attachment-0001.html>

From jluis at ualg.pt  Thu Dec  3 08:44:32 2020
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Thu, 3 Dec 2020 16:44:32 +0000
Subject: [gdal-dev] Sampling raster bands at irregular points
In-Reply-To: <e54a660b-1f82-82e2-a179-3aa31a4da909@sailingteam.tu-darmstadt.de>
References: <e54a660b-1f82-82e2-a179-3aa31a4da909@sailingteam.tu-darmstadt.de>
Message-ID: <VI1PR04MB396641094A8DC8390A0A5E64A6F20@VI1PR04MB3966.eurprd04.prod.outlook.com>

Another option is the GMT program grdtrack (https://docs.generic-mapping-tools.org/dev/grdtrack.html). It's pure C and extremely fast.

-----Original Message-----
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Felix
Sent: Thursday, December 3, 2020 1:16 PM
To: gdal-dev at lists.osgeo.org
Subject: [gdal-dev] Sampling raster bands at irregular points

Hello All,

I'm here for some suggestions on how to sample from a raster band at _non-regular_ points. Non-regular in this context means that the points have arbitrary coordinates and do not lie on a regular lattice/mesh like all pairs of integers would do.

In my application, there is an irregular set of points for which we require bathymetric data (i.e. topographical data/elevation). I started out by manually reading in the ETOPO1 dataset (for now, we might use
Earth2014 later) and then interpolating around each point sequentially. 
As we have up to hundred-tousands of points and doing the computation sequentially in Python/numpy, this is currently running for days (well, we canceled it at that point).

Ideally, I'd like to use something like the "gdal_grid" tool, where the interpolation algorithm can be configured and the heavy-lifting is done in C rather than in Python. But it only supports creating a new _regular_ grid. The inverse distance interpolation with cutoff radii would be ideal.

Does such a tool/such functionality exist in in GDAL or was my search rightfully fruitless? I mainly searched in the raster programs, the
(C++) API of GDALRasterBand and of course generally in the internet. 
Thank you for your suggestions, in advance!

Cheers and Stay Safe
Felix Divo

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From jukka.rahkonen at maanmittauslaitos.fi  Thu Dec  3 10:37:57 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 3 Dec 2020 11:37:57 -0700 (MST)
Subject: [gdal-dev] MBTiles generation docs question
In-Reply-To: <CC88448B-DC77-4197-8E0A-13FEC8E4C5EC@sitemark.com>
References: <CC88448B-DC77-4197-8E0A-13FEC8E4C5EC@sitemark.com>
Message-ID: <1607020677434-0.post@n6.nabble.com>

Hi,

I would guess that the appropriate zoom level is the one with pixel size
closest to the pixel size of the source file after it has been warped into
EPSG:3857.

Please add gdalinfo report about the source image. 

-Jukka Rahkonen-


Evert Etienne (SITEMARK) wrote
> Dear,
> 
> I have a question about the following extract of the MBTiles driver docs
> (https://gdal.org/drivers/raster/mbtiles.html#raster-creation-issues)
> 
>> When using the CreateCopy() API (such as with gdal_translate), automatic
>> reprojection of the input dataset to EPSG:3857 (WebMercator) will be
>> done, with selection of the appropriate zoom level.
> 
> As far as I understand it, the input file (tif in my case) will be warped
> to 3857 before MBTiles generation. But I am unsure what the appropriate
> zoom level means in this case, could someone elaborate or point me in a
> next direction to investigate?
> 
> I was looking at these docs for the explanation of the following error I
> got, pointers much appreciated as well.
> 
> `gdal_translate output.tif output.mbtiles -of MBTILES
> Input file size is 88543, 68686
> ERROR 1: Could not find an approproate zoom level`
> 
> Many thanks
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From evert.etienne at sitemark.com  Fri Dec  4 01:02:07 2020
From: evert.etienne at sitemark.com (Evert Etienne (SITEMARK))
Date: Fri, 4 Dec 2020 09:02:07 +0000
Subject: [gdal-dev] MBTiles generation docs question
Message-ID: <C960B998-130C-4A5C-AF1E-E295AA142C59@sitemark.com>

Hey,

Your zoom level explanation makes sense, thanks.

I should have included the gdalinfo in my previous mail, apologies.

```
Driver: GTiff/GeoTIFF
Files: output.tif
Size is 88543, 68686
Coordinate System is:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Origin = (130.457233786582947,33.011549334631184)
Pixel Size = (0.000000076347339,-0.000000076347339)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  ( 130.4572338,  33.0115493) (130d27'26.04"E, 33d 0'41.58"N)
Lower Left  ( 130.4572338,  33.0063053) (130d27'26.04"E, 33d 0'22.70"N)
Upper Right ( 130.4639938,  33.0115493) (130d27'50.38"E, 33d 0'41.58"N)
Lower Right ( 130.4639938,  33.0063053) (130d27'50.38"E, 33d 0'22.70"N)
Center      ( 130.4606138,  33.0089273) (130d27'38.21"E, 33d 0'32.14"N)
Band 1 Block=88543x1 Type=Byte, ColorInterp=Red
  Mask Flags: PER_DATASET ALPHA 
Band 2 Block=88543x1 Type=Byte, ColorInterp=Green
  Mask Flags: PER_DATASET ALPHA 
Band 3 Block=88543x1 Type=Byte, ColorInterp=Blue
  Mask Flags: PER_DATASET ALPHA 
Band 4 Block=88543x1 Type=Byte, ColorInterp=Alpha
```
causing the error mentioned previously
``gdal_translate output.tif output.mbtiles -of MBTILES
Input file size is 88543, 68686
ERROR 1: Could not find an approproate zoom level`



From jukka.rahkonen at maanmittauslaitos.fi  Fri Dec  4 03:46:16 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 4 Dec 2020 04:46:16 -0700 (MST)
Subject: [gdal-dev] MBTiles generation docs question
In-Reply-To: <C960B998-130C-4A5C-AF1E-E295AA142C59@sitemark.com>
References: <CC88448B-DC77-4197-8E0A-13FEC8E4C5EC@sitemark.com>
 <1607020677434-0.post@n6.nabble.com>
 <C960B998-130C-4A5C-AF1E-E295AA142C59@sitemark.com>
Message-ID: <1607082376399-0.post@n6.nabble.com>

Hi,

I am adding some related links:
- Open GDAL ticket (where you already added your comment)
https://github.com/OSGeo/gdal/issues/3126
- Question in gis.stackexchange
https://gis.stackexchange.com/questions/376827/gdaladdo-zoom-level-not-supported

The issue is that at the moment GDAL does not handle MBTiles with zoom
level>22. That corresponds roughly to pixel size of 11 millimeters. I
checked that your image is about 582 meters in height and with 68686 pixels
it makes a pixel size of  8-9 millimeters if I calculated it right.

BTW. I checked the distance in meters with ogrinfo trick
ogrinfo -dialect sqlite -sql "SELECT ST_Distance(ST_GeomFromText('POINT
(130.4572338 33.0115493)'),ST_GeomFromText('POINT (130.4572338
33.0063053)'),1)" foo.jml

where foo.jml can be any existing ogr source. 

-Jukka Rahkonen-



Evert Etienne (SITEMARK) wrote
> Hey,
> 
> Your zoom level explanation makes sense, thanks.
> 
> I should have included the gdalinfo in my previous mail, apologies.
> 
> ```
> Driver: GTiff/GeoTIFF
> Files: output.tif
> Size is 88543, 68686
> Coordinate System is:
> GEOGCRS["WGS 84",
>     DATUM["World Geodetic System 1984",
>         ELLIPSOID["WGS 84",6378137,298.257223563,
>             LENGTHUNIT["metre",1]]],
>     PRIMEM["Greenwich",0,
>         ANGLEUNIT["degree",0.0174532925199433]],
>     CS[ellipsoidal,2],
>         AXIS["geodetic latitude (Lat)",north,
>             ORDER[1],
>             ANGLEUNIT["degree",0.0174532925199433]],
>         AXIS["geodetic longitude (Lon)",east,
>             ORDER[2],
>             ANGLEUNIT["degree",0.0174532925199433]],
>     ID["EPSG",4326]]
> Data axis to CRS axis mapping: 2,1
> Origin = (130.457233786582947,33.011549334631184)
> Pixel Size = (0.000000076347339,-0.000000076347339)
> Metadata:
>   AREA_OR_POINT=Area
> Image Structure Metadata:
>   INTERLEAVE=PIXEL
> Corner Coordinates:
> Upper Left  ( 130.4572338,  33.0115493) (130d27'26.04"E, 33d 0'41.58"N)
> Lower Left  ( 130.4572338,  33.0063053) (130d27'26.04"E, 33d 0'22.70"N)
> Upper Right ( 130.4639938,  33.0115493) (130d27'50.38"E, 33d 0'41.58"N)
> Lower Right ( 130.4639938,  33.0063053) (130d27'50.38"E, 33d 0'22.70"N)
> Center      ( 130.4606138,  33.0089273) (130d27'38.21"E, 33d 0'32.14"N)
> Band 1 Block=88543x1 Type=Byte, ColorInterp=Red
>   Mask Flags: PER_DATASET ALPHA 
> Band 2 Block=88543x1 Type=Byte, ColorInterp=Green
>   Mask Flags: PER_DATASET ALPHA 
> Band 3 Block=88543x1 Type=Byte, ColorInterp=Blue
>   Mask Flags: PER_DATASET ALPHA 
> Band 4 Block=88543x1 Type=Byte, ColorInterp=Alpha
> ```
> causing the error mentioned previously
> ``gdal_translate output.tif output.mbtiles -of MBTILES
> Input file size is 88543, 68686
> ERROR 1: Could not find an approproate zoom level`
> 
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From felix.divo at sailingteam.tu-darmstadt.de  Mon Dec  7 12:59:51 2020
From: felix.divo at sailingteam.tu-darmstadt.de (Felix)
Date: Mon, 7 Dec 2020 21:59:51 +0100
Subject: [gdal-dev] Querying RasterBands near edges
Message-ID: <6b533446-179b-d28c-b223-e12513cc6453@sailingteam.tu-darmstadt.de>

Hey,

Our application requires us to fetch for many pairs of (latitude, 
longitude) all existing values within some radius from an existing 
raster dataset. Is it possible to read values from a GDALRasterBand 
given some general bounding box, even if it is at the edge of a dataset?

One can easily convert between bounding boxes in geographical 
coordinates and pixels using Dataset::GetGeoTransform() and 
InvGeoTransform(), but GDALRasterBand/GDALMDArray/the Python bindings 
seems to not have a method for being queried by it. Of course, simple 
boxes can be read e.g. using the Python methods 
Band::ReadAsArray/Band::ReadRaster. But this does not work once queries 
get to the boundaries, as all of these methods do not support "wrapping 
around" to the other side of the dataset. As an example:

    Dataset: 1000 x 1000 pixels
    Bounding box in pixels, given as two corner points in (x, y) pixels:
    (950, 950) and (50, 50)
    This should query all 50 by 50 pixel corners of the dataset and
    result in a 100 by 100 pixel result
    It arises when a point at the edge of a dataset is queried with a
    radius of 50 pixels
    However, numpy and the above methods do not allow to express such
    wrap-around indexing

Is there some method that I'm overlooking or is this intentionally 
something that users should implement for themselfs? It feels like such 
indexing would be required in a lot of other places too.

I've posted here last week about some suggestions on how to query raster 
bands at non-structured points. Thanks for the useful replies, Christoph 
& Joaquim! However, it seems like we have to code that ourselfs, thus 
the above digging.

Cheers
Felix D.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201207/3c98e13c/attachment.html>

From andrew at aitchison.me.uk  Mon Dec  7 13:45:44 2020
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Mon, 7 Dec 2020 21:45:44 +0000 (GMT)
Subject: [gdal-dev] Querying RasterBands near edges
In-Reply-To: <6b533446-179b-d28c-b223-e12513cc6453@sailingteam.tu-darmstadt.de>
References: <6b533446-179b-d28c-b223-e12513cc6453@sailingteam.tu-darmstadt.de>
Message-ID: <a01cc2cf-a11d-1966-c483-b44a20396667@aitchison.me.uk>

On Mon, 7 Dec 2020, Felix wrote:

> Our application requires us to fetch for many pairs of (latitude, longitude) 
> all existing values within some radius from an existing raster dataset. Is it 
> possible to read values from a GDALRasterBand given some general bounding 
> box, even if it is at the edge of a dataset?
>
> One can easily convert between bounding boxes in geographical coordinates and 
> pixels using Dataset::GetGeoTransform() and InvGeoTransform(), but 
> GDALRasterBand/GDALMDArray/the Python bindings seems to not have a method for 
> being queried by it. Of course, simple boxes can be read e.g. using the 
> Python methods Band::ReadAsArray/Band::ReadRaster. But this does not work 
> once queries get to the boundaries, as all of these methods do not support 
> "wrapping around" to the other side of the dataset. As an example:
>
>   Dataset: 1000 x 1000 pixels
>   Bounding box in pixels, given as two corner points in (x, y) pixels:
>   (950, 950) and (50, 50)
>   This should query all 50 by 50 pixel corners of the dataset and
>   result in a 100 by 100 pixel result
>   It arises when a point at the edge of a dataset is queried with a
>   radius of 50 pixels
>   However, numpy and the above methods do not allow to express such
>   wrap-around indexing
>
> Is there some method that I'm overlooking or is this intentionally something 
> that users should implement for themselfs? It feels like such indexing would 
> be required in a lot of other places too.

Unless your dataset covers the whole world, I don't understand why would 
wld want such a wrap-around for a geographical application.
Even then you would wrap at the left/right border but not the poles 
(top/bottom).

If you are processing whole world data, could you generate a second raster 
with the left and right halves swapped and split the points into two sets ?
Then provided you use the correct image for each set your radius wont 
cross the edge of the raster.

-- 
Andrew C. Aitchison					Kendal, UK
 			andrew at aitchison.me.uk

From sean at mapbox.com  Mon Dec  7 14:42:50 2020
From: sean at mapbox.com (Sean Gillies)
Date: Mon, 7 Dec 2020 15:42:50 -0700
Subject: [gdal-dev] Querying RasterBands near edges
In-Reply-To: <6b533446-179b-d28c-b223-e12513cc6453@sailingteam.tu-darmstadt.de>
References: <6b533446-179b-d28c-b223-e12513cc6453@sailingteam.tu-darmstadt.de>
Message-ID: <CADPhZXxqS+RiF1_1=cq=tKssetCtN0-eVD92X9AAw=JWuBnwUA@mail.gmail.com>

Hi Felix,

The rasterio Python API has a concept of a "boundless" read (see boundless
keyword under
https://rasterio.readthedocs.io/en/latest/api/rasterio._io.html#rasterio._io.DatasetReaderBase.read)
which sounds similar to what you're looking for. This is implemented using
a VRT and you might be able to do the same kind of thing with the GDAL
Python bindings.

1. Create a VRT with ample extra space around your raster and with a
suitable background value
2. Read from the VRT instead of the raster

You could even tile the VRT with multiple virtual copies of your raster if
you wanted a true wrap-around.

Hope this helps!

On Mon, Dec 7, 2020 at 1:59 PM Felix <felix.divo at sailingteam.tu-darmstadt.de>
wrote:

> Hey,
>
> Our application requires us to fetch for many pairs of (latitude,
> longitude) all existing values within some radius from an existing raster
> dataset. Is it possible to read values from a GDALRasterBand given some
> general bounding box, even if it is at the edge of a dataset?
>
> One can easily convert between bounding boxes in geographical coordinates
> and pixels using Dataset::GetGeoTransform() and InvGeoTransform(), but
> GDALRasterBand/GDALMDArray/the Python bindings seems to not have a method
> for being queried by it. Of course, simple boxes can be read e.g. using the
> Python methods Band::ReadAsArray/Band::ReadRaster. But this does not work
> once queries get to the boundaries, as all of these methods do not support
> "wrapping around" to the other side of the dataset. As an example:
>
> Dataset: 1000 x 1000 pixels
> Bounding box in pixels, given as two corner points in (x, y) pixels: (950,
> 950) and (50, 50)
> This should query all 50 by 50 pixel corners of the dataset and result in
> a 100 by 100 pixel result
> It arises when a point at the edge of a dataset is queried with a radius
> of 50 pixels
> However, numpy and the above methods do not allow to express such
> wrap-around indexing
>
> Is there some method that I'm overlooking or is this intentionally
> something that users should implement for themselfs? It feels like such
> indexing would be required in a lot of other places too.
>
> I've posted here last week about some suggestions on how to query raster
> bands at non-structured points. Thanks for the useful replies, Christoph &
> Joaquim! However, it seems like we have to code that ourselfs, thus the
> above digging.
>
> Cheers
> Felix D.
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201207/e6195f93/attachment.html>

From tglewis1993 at gmail.com  Tue Dec  8 02:56:49 2020
From: tglewis1993 at gmail.com (Tom Lewis)
Date: Tue, 8 Dec 2020 10:56:49 +0000
Subject: [gdal-dev] QUAPOS and other geometry fields (C#)
Message-ID: <CAAxK3svXJ50RuVrrp3Jyh758naxx2+2nOX6oAUaZB-9=uprSPg@mail.gmail.com>

 Hi,

I am trying to get the geometry fields through the GDAL.OGR c# wrapper.

I need to loop through and print every field (with name) on every geometry
in a feature. I am looking for the QUAPOS field in the geometry (if
applicable) but am unsure which combination of definitions and functions to
use, as GeomFieldDef names always seem to return blank.

What I tried was:

Use feature.GetGeomFieldCount to set up a loop between 0 -> fieldCount.
For each iteration, use the loop index with feature.GetGeomFieldRefnDef()
to get the GeomFieldDefn instance (which was not null).
With this GeomFieldDefn use the GetNameRef (also tried just GetName)
function to get the fields name. (Not sure how to get the value of the
field in this method, but the return was always blank so it wouldn't matter
I suspect. I tried with the fields SpatialRef, but that didn't work.)

Trying to write the conditional procedures outlined in the S52 Presentation
Library documentation (Ed 4.0) and am now hitting a roadblock here. I am
probably just woefully misunderstanding this document and apologies if this
is a simple question, but I have had no luck finding any answers through
GoogleFu.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/6a86db37/attachment.html>

From alexhighviz at hotmail.com  Tue Dec  8 04:37:08 2020
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Tue, 8 Dec 2020 12:37:08 +0000
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python library?
Message-ID: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>

Hello,

Could somebody please put me on the right track with the following problem?

I have a C++ library that makes use of GDAL for processing raster maps and I would like to wrap some of its features into a Python library to make it accessible to a wider community.

I would like my library to present functions that take rasters as input and produce rasters as outputs.  I can modify the C++ side to have the functions work on GDALRasterBands, GDALDatasets, or just on filenames. From my perspective I'd prefer to write any wrapping / boiler plate in C++ and have the Python parts as small as possible.

I know this question has been asked before here, but I don't recall the answer and could not find it again. A simple example of "best practice" would be ideal.


With many thanks, Alex


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/6abb13b8/attachment-0001.html>

From sean at mapbox.com  Tue Dec  8 06:28:00 2020
From: sean at mapbox.com (Sean Gillies)
Date: Tue, 8 Dec 2020 07:28:00 -0700
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
Message-ID: <CADPhZXxqhvmdF-bnyC=hL4Hbrxw1eQ+ZDo1hXhy0XUMA5hvqEA@mail.gmail.com>

Hi Alex,

I observe more people using pybind11 these days.
https://github.com/pybind/pybind11.

Yours,


On Tue, Dec 8, 2020 at 5:37 AM Alex HighViz <alexhighviz at hotmail.com> wrote:

> Hello,
>
> Could somebody please put me on the right track with the following
> problem?
>
> I have a C++ library that makes use of GDAL for processing raster maps and
> I would like to wrap some of its features into a Python library to make it
> accessible to a wider community.
>
> I would like my library to present functions that take rasters as input
> and produce rasters as outputs.  I can modify the C++ side to have the
> functions work on GDALRasterBands, GDALDatasets, or just on filenames. From
> my perspective I'd prefer to write any wrapping / boiler plate in C++ and
> have the Python parts as small as possible.
>
> I know this question has been asked before here, but I don't recall the
> answer and could not find it again. A simple example of "best practice"
> would be ideal.
>
>
> With many thanks, Alex
>


-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/b39022dd/attachment.html>

From runette at gmail.com  Tue Dec  8 08:46:07 2020
From: runette at gmail.com (Paul Harwood)
Date: Tue, 8 Dec 2020 16:46:07 +0000
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
Message-ID: <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>

I may have misunderstood but I think you are asking the wrong community.

You can take your own C++ library and make it available to a Python library
- see https://docs.python.org/3/extending/extending.html etc - but this is
not the community to ask for advice about that. You can, of course, access
GDAL in that c++ library using the c++ API but I don't think that doing so
would change how you expose the API from your library in Python ...

Perhaps you need to make your question more specific?

On Tue, 8 Dec 2020 at 12:37, Alex HighViz <alexhighviz at hotmail.com> wrote:

> Hello,
>
> Could somebody please put me on the right track with the following
> problem?
>
> I have a C++ library that makes use of GDAL for processing raster maps and
> I would like to wrap some of its features into a Python library to make it
> accessible to a wider community.
>
> I would like my library to present functions that take rasters as input
> and produce rasters as outputs.  I can modify the C++ side to have the
> functions work on GDALRasterBands, GDALDatasets, or just on filenames. From
> my perspective I'd prefer to write any wrapping / boiler plate in C++ and
> have the Python parts as small as possible.
>
> I know this question has been asked before here, but I don't recall the
> answer and could not find it again. A simple example of "best practice"
> would be ideal.
>
>
> With many thanks, Alex
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/e6e4259f/attachment.html>

From alexhighviz at hotmail.com  Tue Dec  8 10:17:43 2020
From: alexhighviz at hotmail.com (Alex HighViz)
Date: Tue, 8 Dec 2020 18:17:43 +0000
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>,
 <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
Message-ID: <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>

Hi Paul,

Yes there is a generic, "how do I expose a  C++ library to Python users" question. But there is a GDAL specific issue that the main inputs and outputs in my library are raster layers, and I am not sure how to pass those. Especially if my library is using GDAL and the user is using GDAL through Python. I can make my interface completely based on filenames, but that seems inefficient. Is this not a more commonly encountered problem?

Thanks, Alex

Get Outlook for Android<https://aka.ms/ghei36>

________________________________
From: Paul Harwood <runette at gmail.com>
Sent: Tuesday, December 8, 2020 4:46:07 PM
To: Alex HighViz <alexhighviz at hotmail.com>
Cc: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] How to wrap a C++ library using GDAL in a Python library?

I may have misunderstood but I think you are asking the wrong community.

You can take your own C++ library and make it available to a Python library - see https://docs.python.org/3/extending/extending.html etc - but this is not the community to ask for advice about that. You can, of course, access GDAL in that c++ library using the c++ API but I don't think that doing so would change how you expose the API from your library in Python ...

Perhaps you need to make your question more specific?

On Tue, 8 Dec 2020 at 12:37, Alex HighViz <alexhighviz at hotmail.com<mailto:alexhighviz at hotmail.com>> wrote:
Hello,

Could somebody please put me on the right track with the following problem?

I have a C++ library that makes use of GDAL for processing raster maps and I would like to wrap some of its features into a Python library to make it accessible to a wider community.

I would like my library to present functions that take rasters as input and produce rasters as outputs.  I can modify the C++ side to have the functions work on GDALRasterBands, GDALDatasets, or just on filenames. From my perspective I'd prefer to write any wrapping / boiler plate in C++ and have the Python parts as small as possible.

I know this question has been asked before here, but I don't recall the answer and could not find it again. A simple example of "best practice" would be ideal.


With many thanks, Alex


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/8172b630/attachment-0001.html>

From bcward at astutespruce.com  Tue Dec  8 10:25:00 2020
From: bcward at astutespruce.com (Brendan Ward)
Date: Tue, 8 Dec 2020 10:25:00 -0800
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
 <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
Message-ID: <CAENuiqRtRtnXnF3_G7TWzxpsAsAdTt_SxTrecJfiPyTYo3QvxQ@mail.gmail.com>

Alex,

see rasterio: https://github.com/mapbox/rasterio

It uses Cython (https://cython.readthedocs.io/en/latest/index.html) to wrap
GDAL rasters and related functions for use in Python.  You can use Cython
to wrap C / C++ libraries for use in Python; how much you wrap depends on
the interface you want between the two.

Hope that helps,

Brendan

On Tue, Dec 8, 2020 at 10:17 AM Alex HighViz <alexhighviz at hotmail.com>
wrote:

> Hi Paul,
>
> Yes there is a generic, "how do I expose a  C++ library to Python users"
> question. But there is a GDAL specific issue that the main inputs and
> outputs in my library are raster layers, and I am not sure how to pass
> those. Especially if my library is using GDAL and the user is using GDAL
> through Python. I can make my interface completely based on filenames, but
> that seems inefficient. Is this not a more commonly encountered problem?
>
> Thanks, Alex
>
> Get Outlook for Android <https://aka.ms/ghei36>
>
> ------------------------------
> *From:* Paul Harwood <runette at gmail.com>
> *Sent:* Tuesday, December 8, 2020 4:46:07 PM
> *To:* Alex HighViz <alexhighviz at hotmail.com>
> *Cc:* gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
> *Subject:* Re: [gdal-dev] How to wrap a C++ library using GDAL in a
> Python library?
>
> I may have misunderstood but I think you are asking the wrong community.
>
> You can take your own C++ library and make it available to a Python
> library - see https://docs.python.org/3/extending/extending.html etc -
> but this is not the community to ask for advice about that. You can, of
> course, access GDAL in that c++ library using the c++ API but I don't think
> that doing so would change how you expose the API from your library in
> Python ...
>
> Perhaps you need to make your question more specific?
>
> On Tue, 8 Dec 2020 at 12:37, Alex HighViz <alexhighviz at hotmail.com> wrote:
>
> Hello,
>
> Could somebody please put me on the right track with the following
> problem?
>
> I have a C++ library that makes use of GDAL for processing raster maps and
> I would like to wrap some of its features into a Python library to make it
> accessible to a wider community.
>
> I would like my library to present functions that take rasters as input
> and produce rasters as outputs.  I can modify the C++ side to have the
> functions work on GDALRasterBands, GDALDatasets, or just on filenames. From
> my perspective I'd prefer to write any wrapping / boiler plate in C++ and
> have the Python parts as small as possible.
>
> I know this question has been asked before here, but I don't recall the
> answer and could not find it again. A simple example of "best practice"
> would be ideal.
>
>
> With many thanks, Alex
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Brendan C. Ward
Owner | Lead Software Engineer
Astute Spruce, LLC
astutespruce.com
541-250-9544
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/7fd5e617/attachment.html>

From yrneh.ulloa at gmail.com  Tue Dec  8 14:03:54 2020
From: yrneh.ulloa at gmail.com (Yrneh Ulloa-Torrealba)
Date: Tue, 8 Dec 2020 23:03:54 +0100
Subject: [gdal-dev] Problem with gdal. Warp 6257
Message-ID: <CADQXUM3BKUoWTbFSsG5e0JnVOv6W4eSJWn1==aQKwJgzi4fOGA@mail.gmail.com>

Dear GDAL community,

I had a problem using gdal.Warp for a raster from EPSG 6257 to 6686. Does
someone know why this happened?

More information on:
https://gis.stackexchange.com/questions/380877/reprojection-with-gdal-warp-doesnt-work

Thank you very much for any advice!
Best,
Yrneh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/89bba783/attachment.html>

From even.rouault at spatialys.com  Tue Dec  8 14:14:47 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 08 Dec 2020 23:14:47 +0100
Subject: [gdal-dev] Problem with gdal. Warp 6257
In-Reply-To: <CADQXUM3BKUoWTbFSsG5e0JnVOv6W4eSJWn1==aQKwJgzi4fOGA@mail.gmail.com>
References: <CADQXUM3BKUoWTbFSsG5e0JnVOv6W4eSJWn1==aQKwJgzi4fOGA@mail.gmail.com>
Message-ID: <1947211.bb81VeFxaR@even-i700>

On mardi 8 d?cembre 2020 23:03:54 CET Yrneh Ulloa-Torrealba wrote:
> Dear GDAL community,
> 
> I had a problem using gdal.Warp for a raster from EPSG 6257 to 6686. Does
> someone know why this happened?
> 
> More information on:
> https://gis.stackexchange.com/questions/380877/reprojection-with-gdal-warp-d
> oesnt-work

EPSG:6257 uses the "Colombia Urban" projection method, whose support has been 
added only in PROJ 7.2 (
https://proj.org/operations/projections/col_urban.html )

And there must be an error in the target EPSG code in your post: EPSG:6686 is 
a Japanese CRS (well, you could technically try to do the reprojection, but it 
is unlikely this is what you want to do)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sean.gillies at gmail.com  Tue Dec  8 14:16:20 2020
From: sean.gillies at gmail.com (Sean Gillies)
Date: Tue, 8 Dec 2020 15:16:20 -0700
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <CADPhZXxx4dFMWNg3LSWE+Be58F-5eiBTtTgHMfZ2asij_T2-kw@mail.gmail.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
 <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAENuiqRtRtnXnF3_G7TWzxpsAsAdTt_SxTrecJfiPyTYo3QvxQ@mail.gmail.com>
 <CADPhZXxx4dFMWNg3LSWE+Be58F-5eiBTtTgHMfZ2asij_T2-kw@mail.gmail.com>
Message-ID: <CAOodmJqNCw7bXAjgyZfJZetF4-M8rr1ovS-Ht8W+ZnK1thXfVA@mail.gmail.com>

Hi,

Rasterio is different, though. It spreads Python very thickly on top of
GDAL. The state of the art for very thin Python bindings for a C++ project
seems to be pybind11. It's used for numpy's FFT module, based on pocketfft.

If some of you are surprised to see me post again on this thread, it's
because my sean at mapbox.com address is getting marked as spam. I've been
having a private conversation with Even on this list that no one else has
seen. And I thought it was because the clarity and insight of my answers
rendered everyone incapable of comment :)

On Tue, Dec 8, 2020 at 3:06 PM Sean Gillies <sean at mapbox.com> wrote:

>
>
> ---------- Forwarded message ---------
> From: Brendan Ward <bcward at astutespruce.com>
> Date: Tue, Dec 8, 2020 at 11:25 AM
> Subject: Re: [gdal-dev] How to wrap a C++ library using GDAL in a Python
> library?
> To: Alex HighViz <alexhighviz at hotmail.com>
> Cc: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
>
>
> Alex,
>
> see rasterio: https://github.com/mapbox/rasterio
>
> It uses Cython (https://cython.readthedocs.io/en/latest/index.html) to
> wrap GDAL rasters and related functions for use in Python.  You can use
> Cython to wrap C / C++ libraries for use in Python; how much you wrap
> depends on the interface you want between the two.
>
> Hope that helps,
>
> Brendan
>
> On Tue, Dec 8, 2020 at 10:17 AM Alex HighViz <alexhighviz at hotmail.com>
> wrote:
>
>> Hi Paul,
>>
>> Yes there is a generic, "how do I expose a  C++ library to Python users"
>> question. But there is a GDAL specific issue that the main inputs and
>> outputs in my library are raster layers, and I am not sure how to pass
>> those. Especially if my library is using GDAL and the user is using GDAL
>> through Python. I can make my interface completely based on filenames, but
>> that seems inefficient. Is this not a more commonly encountered problem?
>>
>> Thanks, Alex
>>
>> Get Outlook for Android <https://aka.ms/ghei36>
>>
>> ------------------------------
>> *From:* Paul Harwood <runette at gmail.com>
>> *Sent:* Tuesday, December 8, 2020 4:46:07 PM
>> *To:* Alex HighViz <alexhighviz at hotmail.com>
>> *Cc:* gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
>> *Subject:* Re: [gdal-dev] How to wrap a C++ library using GDAL in a
>> Python library?
>>
>> I may have misunderstood but I think you are asking the wrong community.
>>
>> You can take your own C++ library and make it available to a Python
>> library - see https://docs.python.org/3/extending/extending.html etc -
>> but this is not the community to ask for advice about that. You can, of
>> course, access GDAL in that c++ library using the c++ API but I don't think
>> that doing so would change how you expose the API from your library in
>> Python ...
>>
>> Perhaps you need to make your question more specific?
>>
>> On Tue, 8 Dec 2020 at 12:37, Alex HighViz <alexhighviz at hotmail.com>
>> wrote:
>>
>> Hello,
>>
>> Could somebody please put me on the right track with the following
>> problem?
>>
>> I have a C++ library that makes use of GDAL for processing raster maps
>> and I would like to wrap some of its features into a Python library to make
>> it accessible to a wider community.
>>
>> I would like my library to present functions that take rasters as input
>> and produce rasters as outputs.  I can modify the C++ side to have the
>> functions work on GDALRasterBands, GDALDatasets, or just on filenames. From
>> my perspective I'd prefer to write any wrapping / boiler plate in C++ and
>> have the Python parts as small as possible.
>>
>> I know this question has been asked before here, but I don't recall the
>> answer and could not find it again. A simple example of "best practice"
>> would be ideal.
>>
>>
>> With many thanks, Alex
>>
>>
-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201208/0204ad90/attachment.html>

From mateusz at loskot.net  Wed Dec  9 00:33:39 2020
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed, 9 Dec 2020 09:33:39 +0100
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <CAOodmJqNCw7bXAjgyZfJZetF4-M8rr1ovS-Ht8W+ZnK1thXfVA@mail.gmail.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
 <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAENuiqRtRtnXnF3_G7TWzxpsAsAdTt_SxTrecJfiPyTYo3QvxQ@mail.gmail.com>
 <CADPhZXxx4dFMWNg3LSWE+Be58F-5eiBTtTgHMfZ2asij_T2-kw@mail.gmail.com>
 <CAOodmJqNCw7bXAjgyZfJZetF4-M8rr1ovS-Ht8W+ZnK1thXfVA@mail.gmail.com>
Message-ID: <CABUeae_=wy5GefVRYYxDNTZ4tJgfZRUMtDxsTCCyqyAmmERP6Q@mail.gmail.com>

On Tue, 8 Dec 2020 at 23:16, Sean Gillies <sean.gillies at gmail.com> wrote:
>
> The state of the art for very thin Python bindings for a C++ project seems to be pybind11. It's used for numpy's FFT module, based on pocketfft.

My observations are similar to that and pybind11 is the currently
popular solution.

I personally like to stick to vanilla Python API though, not easy, but
not a terrible experience either.

> If some of you are surprised to see me post again on this thread, it's because my sean at mapbox.com address is getting marked as spam.

FYI, your messages from that address always landed in my GMaill inbox
marked as spam.
That actually is the case for every message from @mapbox.com (e.g.
from OSRM folks).

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From sean at mapbox.com  Wed Dec  9 08:18:26 2020
From: sean at mapbox.com (Sean Gillies)
Date: Wed, 9 Dec 2020 09:18:26 -0700
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <CABUeae_=wy5GefVRYYxDNTZ4tJgfZRUMtDxsTCCyqyAmmERP6Q@mail.gmail.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
 <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAENuiqRtRtnXnF3_G7TWzxpsAsAdTt_SxTrecJfiPyTYo3QvxQ@mail.gmail.com>
 <CADPhZXxx4dFMWNg3LSWE+Be58F-5eiBTtTgHMfZ2asij_T2-kw@mail.gmail.com>
 <CAOodmJqNCw7bXAjgyZfJZetF4-M8rr1ovS-Ht8W+ZnK1thXfVA@mail.gmail.com>
 <CABUeae_=wy5GefVRYYxDNTZ4tJgfZRUMtDxsTCCyqyAmmERP6Q@mail.gmail.com>
Message-ID: <CADPhZXxfZKE9nkgVLhgSTUSURKUc-OD5cqucVtDJexatt3A7rw@mail.gmail.com>

Hi Mateusz,

The OSGeo sysadmins found something to correct in mailman configuration,
I'm giving that a test here.

On Wed, Dec 9, 2020 at 1:32 AM Mateusz Loskot <mateusz at loskot.net> wrote:

> On Tue, 8 Dec 2020 at 23:16, Sean Gillies <sean.gillies at gmail.com> wrote:
> >
> > The state of the art for very thin Python bindings for a C++ project
> seems to be pybind11. It's used for numpy's FFT module, based on pocketfft.
>
> My observations are similar to that and pybind11 is the currently
> popular solution.
>
> I personally like to stick to vanilla Python API though, not easy, but
> not a terrible experience either.
>
> > If some of you are surprised to see me post again on this thread, it's
> because my sean at mapbox.com address is getting marked as spam.
>
> FYI, your messages from that address always landed in my GMaill inbox
> marked as spam.
> That actually is the case for every message from @mapbox.com (e.g.
> from OSRM folks).
>
> Best regards,


-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201209/28247aa1/attachment-0001.html>

From mateusz at loskot.net  Wed Dec  9 10:39:43 2020
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed, 9 Dec 2020 19:39:43 +0100
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <CADPhZXxfZKE9nkgVLhgSTUSURKUc-OD5cqucVtDJexatt3A7rw@mail.gmail.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
 <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAENuiqRtRtnXnF3_G7TWzxpsAsAdTt_SxTrecJfiPyTYo3QvxQ@mail.gmail.com>
 <CADPhZXxx4dFMWNg3LSWE+Be58F-5eiBTtTgHMfZ2asij_T2-kw@mail.gmail.com>
 <CAOodmJqNCw7bXAjgyZfJZetF4-M8rr1ovS-Ht8W+ZnK1thXfVA@mail.gmail.com>
 <CABUeae_=wy5GefVRYYxDNTZ4tJgfZRUMtDxsTCCyqyAmmERP6Q@mail.gmail.com>
 <CADPhZXxfZKE9nkgVLhgSTUSURKUc-OD5cqucVtDJexatt3A7rw@mail.gmail.com>
Message-ID: <CABUeae-0xACoE18k-0ODRFpKbc+uzDTOgh_O3gL0sDpRVNE_Gg@mail.gmail.com>

On Wed, 9 Dec 2020 at 17:19, Sean Gillies via gdal-dev
<gdal-dev at lists.osgeo.org> wrote:
>
> Hi Mateusz,
>
> The OSGeo sysadmins found something to correct in mailman configuration, I'm giving that a test here.

Sean,

>From my perspective, that 'something' does the job and despams your message.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From neteler at osgeo.org  Wed Dec  9 11:18:36 2020
From: neteler at osgeo.org (Markus Neteler)
Date: Wed, 9 Dec 2020 20:18:36 +0100
Subject: [gdal-dev] How to wrap a C++ library using GDAL in a Python
 library?
In-Reply-To: <CABUeae-0xACoE18k-0ODRFpKbc+uzDTOgh_O3gL0sDpRVNE_Gg@mail.gmail.com>
References: <AM6PR05MB4965624AB531379D2D7D8B92B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAE8nN5NNR55a+gnOr9yg5TyE4uHMEp_q9CRA971fazXUEvW1_A@mail.gmail.com>
 <AM6PR05MB4965F29DDBBEC75B03DA38A0B4CD0@AM6PR05MB4965.eurprd05.prod.outlook.com>
 <CAENuiqRtRtnXnF3_G7TWzxpsAsAdTt_SxTrecJfiPyTYo3QvxQ@mail.gmail.com>
 <CADPhZXxx4dFMWNg3LSWE+Be58F-5eiBTtTgHMfZ2asij_T2-kw@mail.gmail.com>
 <CAOodmJqNCw7bXAjgyZfJZetF4-M8rr1ovS-Ht8W+ZnK1thXfVA@mail.gmail.com>
 <CABUeae_=wy5GefVRYYxDNTZ4tJgfZRUMtDxsTCCyqyAmmERP6Q@mail.gmail.com>
 <CADPhZXxfZKE9nkgVLhgSTUSURKUc-OD5cqucVtDJexatt3A7rw@mail.gmail.com>
 <CABUeae-0xACoE18k-0ODRFpKbc+uzDTOgh_O3gL0sDpRVNE_Gg@mail.gmail.com>
Message-ID: <CALFmHhsKce24v0QiNJzVS=N65TBvg_g_Ufv94LDmaLW1z9i4WQ@mail.gmail.com>

Hi,

Mateusz Loskot <mateusz at loskot.net> schrieb am Mi., 9. Dez. 2020, 19:38:

> On Wed, 9 Dec 2020 at 17:19, Sean Gillies via gdal-dev
> <gdal-dev at lists.osgeo.org> wrote:
> >
> > Hi Mateusz,
> >
> > The OSGeo sysadmins found something to correct in mailman configuration,
> I'm giving that a test here.
>
> Sean,
>
> From my perspective, that 'something' does the job and despams your
> message.
>



Yes, it is a new DMARC related mailman setting.
For details, see

https://trac.osgeo.org/osgeo/ticket/2475

Best,
Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201209/7afd2064/attachment.html>

From laurynasgedminas at gmail.com  Wed Dec  9 16:11:18 2020
From: laurynasgedminas at gmail.com (Laurynas Gedminas)
Date: Wed, 9 Dec 2020 19:11:18 -0500
Subject: [gdal-dev] raster from kml/kmz file
Message-ID: <CAPJBxMHD2zkxBEzw1xuiRBuNhb2aRYVkJKg9nkc0pd81MueOnQ@mail.gmail.com>

Hey guys,
can GDAL translate this  file into raster?
https://ipad.fas.usda.gov/cropexplorer/imageview.aspx?regionid=europe&startdate=11%2f21%2f2020&imenddate=11%2f30%2f2020&ftypeid=45&fattributeid=32

QGIS was not able to covert it.

Thank you,
Laurynas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201209/14a93bc2/attachment.html>

From landa.martin at gmail.com  Thu Dec 10 00:39:30 2020
From: landa.martin at gmail.com (Martin Landa)
Date: Thu, 10 Dec 2020 09:39:30 +0100
Subject: [gdal-dev] promote_to_multi and python API
Message-ID: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>

Hi,

is there a way to apply PROMOTE_TO_MULTI in Python API? I am trying to
write a sample script for students in Python which converts SHP file
to PostGIS layers. I am dealing with a well known problem "Geometry
type (MultiXXX) does not match column type (XXX)".

How to solve it properly in order to avoid calling `ogr2ogr` from
Python code? :-)

Thanks, Martin

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From kai.muehlbauer at uni-bonn.de  Thu Dec 10 00:58:03 2020
From: kai.muehlbauer at uni-bonn.de (=?UTF-8?Q?Kai_M=c3=bchlbauer?=)
Date: Thu, 10 Dec 2020 09:58:03 +0100
Subject: [gdal-dev] promote_to_multi and python API
In-Reply-To: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
References: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
Message-ID: <03f96128-297b-6906-66a8-21bf2311a9de@uni-bonn.de>

Hi Martin,

not sure if this helps you, but "PROMOTE_TO_MULTI" can be added as 
option with several OGR functions with the Python API (eg. Intersection, 
Update, Identity etc.).

See https://gdal.org/python/osgeo.ogr.Layer-class.html

HTH,
Kai

Am 10.12.20 um 09:39 schrieb Martin Landa:
> Hi,
> 
> is there a way to apply PROMOTE_TO_MULTI in Python API? I am trying to
> write a sample script for students in Python which converts SHP file
> to PostGIS layers. I am dealing with a well known problem "Geometry
> type (MultiXXX) does not match column type (XXX)".
> 
> How to solve it properly in order to avoid calling `ogr2ogr` from
> Python code? :-)
> 
> Thanks, Martin
> 


From landa.martin at gmail.com  Thu Dec 10 00:59:43 2020
From: landa.martin at gmail.com (Martin Landa)
Date: Thu, 10 Dec 2020 09:59:43 +0100
Subject: [gdal-dev] promote_to_multi and python API
In-Reply-To: <03f96128-297b-6906-66a8-21bf2311a9de@uni-bonn.de>
References: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
 <03f96128-297b-6906-66a8-21bf2311a9de@uni-bonn.de>
Message-ID: <CA+Ei1OfyBTmyekZwsS74c4yoArGgRYJZUgDFbiq_5xhtjvhetQ@mail.gmail.com>

Hi,

?t 10. 12. 2020 v 9:58 odes?latel Kai M?hlbauer
<kai.muehlbauer at uni-bonn.de> napsal:
> not sure if this helps you, but "PROMOTE_TO_MULTI" can be added as
> option with several OGR functions with the Python API (eg. Intersection,
> Update, Identity etc.).

yes, thanks for pointing this out. But it seems to be not possible for
CopyLayer() which is the problem in my case.

Martin

-- 
Martin Landa
http://geo.fsv.cvut.cz/gwiki/Landa
http://gismentors.cz/mentors/landa

From jukka.rahkonen at maanmittauslaitos.fi  Thu Dec 10 04:27:38 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 10 Dec 2020 05:27:38 -0700 (MST)
Subject: [gdal-dev] promote_to_multi and python API
In-Reply-To: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
References: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
Message-ID: <1607603258729-0.post@n6.nabble.com>

Hi,

You do not need to call ogr2ogr because there is a python library equivalent
"gdal.VectorTranslate". You can find a PROMOTE_TO_MULTI example from the
autotests

https://github.com/OSGeo/gdal/blob/master/autotest/utilities/test_ogr2ogr_lib.py#L539

-Jukka Rahkonen-


Martin Landa wrote
> Hi,
> 
> is there a way to apply PROMOTE_TO_MULTI in Python API? I am trying to
> write a sample script for students in Python which converts SHP file
> to PostGIS layers. I am dealing with a well known problem "Geometry
> type (MultiXXX) does not match column type (XXX)".
> 
> How to solve it properly in order to avoid calling `ogr2ogr` from
> Python code? :-)
> 
> Thanks, Martin
> 
> -- 
> Martin Landa
> http://geo.fsv.cvut.cz/gwiki/Landa
> http://gismentors.cz/mentors/landa
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Thu Dec 10 05:11:09 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 10 Dec 2020 14:11:09 +0100
Subject: [gdal-dev] promote_to_multi and python API
In-Reply-To: <CA+Ei1OfyBTmyekZwsS74c4yoArGgRYJZUgDFbiq_5xhtjvhetQ@mail.gmail.com>
References: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
 <03f96128-297b-6906-66a8-21bf2311a9de@uni-bonn.de>
 <CA+Ei1OfyBTmyekZwsS74c4yoArGgRYJZUgDFbiq_5xhtjvhetQ@mail.gmail.com>
Message-ID: <3674359.9RS6RvUDoy@even-i700>

Martin,

> 
> <kai.muehlbauer at uni-bonn.de> napsal:
> > not sure if this helps you, but "PROMOTE_TO_MULTI" can be added as
> > option with several OGR functions with the Python API (eg. Intersection,
> > Update, Identity etc.).
> 
> yes, thanks for pointing this out. But it seems to be not possible for
> CopyLayer() which is the problem in my case.

CopyLayer() is for simple/straightforward conversions. For more advanced 
options, use gdal.VectorTranslate(), the API version of ogr2ogr

(Or you could do the hwole process at hand, and use the 
Geometry.ForceTo(geom_type) API, but you'll likey be much happier using 
gdal.VectorTranslate())

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From nhv at meganet.net  Thu Dec 10 03:54:50 2020
From: nhv at meganet.net (Norman Vine)
Date: Thu, 10 Dec 2020 06:54:50 -0500
Subject: [gdal-dev] promote_to_multi and python API
In-Reply-To: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
References: <CA+Ei1OdDriFH99zAkn_=+2+OsZ8q8FH2KhyxxfjP3QtiStTqCg@mail.gmail.com>
Message-ID: <DFA67C24-D809-4567-8A09-E4CD5A508549@meganet.net>

I usually peruse the ogr2ogr.py source for hints
maybe this helps
https://github.com/OSGeo/gdal/blob/master/gdal/swig/python/samples/ogr2ogr.py#L1512

> On Dec 10, 2020, at 3:39 AM, Martin Landa <landa.martin at gmail.com> wrote:
> 
> Hi,
> 
> is there a way to apply PROMOTE_TO_MULTI in Python API? I am trying to
> write a sample script for students in Python which converts SHP file
> to PostGIS layers. I am dealing with a well known problem "Geometry
> type (MultiXXX) does not match column type (XXX)".
> 
> How to solve it properly in order to avoid calling `ogr2ogr` from
> Python code? :-)
> 
> Thanks, Martin
> 
> -- 
> Martin Landa
> http://geo.fsv.cvut.cz/gwiki/Landa
> http://gismentors.cz/mentors/landa
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 



From korolevs at msn.com  Thu Dec 10 06:31:51 2020
From: korolevs at msn.com (korolevs at msn.com)
Date: Thu, 10 Dec 2020 09:31:51 -0500
Subject: [gdal-dev] GDALinfo 3.1.4 gives segmentation fault error
Message-ID: <SJ0PR19MB45101C97213319C58B5B14CDD0CB0@SJ0PR19MB4510.namprd19.prod.outlook.com>

What could be a reason why on MacOS Catalina 10.15.6(19G2021)
galindo http://download.osgeo.org/geotiff/samples/other/erdas_spnad83.tif <http://download.osgeo.org/geotiff/samples/other/erdas_spnad83.tif>
gives error segmentation fault but
galindo http://download.osgeo.org/geotiff/samples/usgs/o41078a2.tif <http://download.osgeo.org/geotiff/samples/usgs/o41078a2.tif>
does not?

Slav Korolev
korolevs at msn.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201210/24f6895e/attachment.html>

From jgr at osgeopt.pt  Thu Dec 10 07:00:50 2020
From: jgr at osgeopt.pt (Jorge Gustavo Rocha)
Date: Thu, 10 Dec 2020 15:00:50 +0000
Subject: [gdal-dev] GDALinfo 3.1.4 gives segmentation fault error
In-Reply-To: <SJ0PR19MB45101C97213319C58B5B14CDD0CB0@SJ0PR19MB4510.namprd19.prod.outlook.com>
References: <SJ0PR19MB45101C97213319C58B5B14CDD0CB0@SJ0PR19MB4510.namprd19.prod.outlook.com>
Message-ID: <9c68b949-b81a-1ef6-544b-513ec03352c8@osgeopt.pt>

Hi Slav,

Libraries might be the problem. Can you provide more info, please?

Tell us which libraries are being used by gdalinfo. Something like:

ldd `which gdalinfo`

Regards,

Jorge

?s 14:31 de 10/12/20, korolevs at msn.com escreveu:
> What could be a reason why on MacOS Catalina 10.15.6(19G2021)
> galindo?http://download.osgeo.org/geotiff/samples/other/erdas_spnad83.tif
> gives error /segmentation fault /but
> galindo?http://download.osgeo.org/geotiff/samples/usgs/o41078a2.tif
> does not?
> 
> Slav Korolev
> korolevs at msn.com <mailto:korolevs at msn.com>
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 

-- 
OSGeo Portugal
NIF: 509588190
email: geral at osgeopt.pt
https://www.osgeopt.pt/

Pr?ximo evento: SASIG 2017, 20 a 22 de novembro, Porto
Mais informa??es: http://osgeopt.pt/sasig2017/

From woklist at kyngchaos.com  Thu Dec 10 12:40:39 2020
From: woklist at kyngchaos.com (William Kyngesburye)
Date: Thu, 10 Dec 2020 14:40:39 -0600
Subject: [gdal-dev] GDALinfo 3.1.4 gives segmentation fault error
In-Reply-To: <9c68b949-b81a-1ef6-544b-513ec03352c8@osgeopt.pt>
References: <9c68b949-b81a-1ef6-544b-513ec03352c8@osgeopt.pt>
Message-ID: <16D6E0D1-C6C6-4A39-AE42-0AEEEA741160@kyngchaos.com>

On macOS that would be

otool -L /path/to/gdalinfo

-----
William Kyngesburye
<kyngchaos at kyngchaos.com>
<http://www.kyngchaos.com>

Don't Panic

> On Dec 10, 2020, at 9:01 AM, Jorge Gustavo Rocha <jgr at osgeopt.pt> wrote:
> 
> ?Hi Slav,
> 
> Libraries might be the problem. Can you provide more info, please?
> 
> Tell us which libraries are being used by gdalinfo. Something like:
> 
> ldd `which gdalinfo`
> 
> Regards,
> 
> Jorge
> 
> ?s 14:31 de 10/12/20, korolevs at msn.com escreveu:
>> What could be a reason why on MacOS Catalina 10.15.6(19G2021)
>> galindo http://download.osgeo.org/geotiff/samples/other/erdas_spnad83.tif
>> gives error /segmentation fault /but
>> galindo http://download.osgeo.org/geotiff/samples/usgs/o41078a2.tif
>> does not?
>> 
>> Slav Korolev
>> korolevs at msn.com <mailto:korolevs at msn.com>
>> 
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> 
> 
> -- 
> OSGeo Portugal
> NIF: 509588190
> email: geral at osgeopt.pt
> https://www.osgeopt.pt/
> 
> Pr?ximo evento: SASIG 2017, 20 a 22 de novembro, Porto
> Mais informa??es: http://osgeopt.pt/sasig2017/
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 


From alex at outsideanalytics.com  Thu Dec 10 18:06:35 2020
From: alex at outsideanalytics.com (Alex Riggs)
Date: Thu, 10 Dec 2020 19:06:35 -0700
Subject: [gdal-dev] Open Python3 bytes using gdal's Python bindings
Message-ID: <CAMDQBEULHDgHDQY-cojWZnNwnqg0nNZbNdKjoKXsGDgCiipLTA@mail.gmail.com>

Hello all,

First for some background. I have a service which receives protobuf
messages, each message contains a bytes-encoded netcdf file. Currently, I
write the netcdf to a temporary, on-disk file, which I then open with
gdal.Open() to do some stuff to. Based on what I could discern, both the
Open and OpenEx expect a string representing a file except in the case of
"exotic drivers".

My hope is to eliminate the need for that temporary file and instead read
the bytes string directly. Is this possible?

Thanks,

Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201210/7afb97fc/attachment.html>

From even.rouault at spatialys.com  Fri Dec 11 04:04:17 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 11 Dec 2020 13:04:17 +0100
Subject: [gdal-dev] Open Python3 bytes using gdal's Python bindings
In-Reply-To: <CAMDQBEULHDgHDQY-cojWZnNwnqg0nNZbNdKjoKXsGDgCiipLTA@mail.gmail.com>
References: <CAMDQBEULHDgHDQY-cojWZnNwnqg0nNZbNdKjoKXsGDgCiipLTA@mail.gmail.com>
Message-ID: <8629317.7R4xYscLCS@even-i700>

On jeudi 10 d?cembre 2020 19:06:35 CET Alex Riggs wrote:
> Hello all,
> 
> First for some background. I have a service which receives protobuf
> messages, each message contains a bytes-encoded netcdf file. Currently, I
> write the netcdf to a temporary, on-disk file, which I then open with
> gdal.Open() to do some stuff to. Based on what I could discern, both the
> Open and OpenEx expect a string representing a file except in the case of
> "exotic drivers".
> 
> My hope is to eliminate the need for that temporary file and instead read
> the bytes string directly. Is this possible?

If you're on Linux, then you could write the buffer in a /vsimem/ file 
(gdal.FileFromMemBuffer('/vsimem/foo.nc', blob) ), and use the netCDF driver 
on that file.

Actually we could likely remove the Linux-only restriction for the particular 
case of /vsimem/ files but this isn't implemented currently in the driver.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From paul.malm at lfv.se  Fri Dec 11 04:15:23 2020
From: paul.malm at lfv.se (paul.malm at lfv.se)
Date: Fri, 11 Dec 2020 12:15:23 +0000
Subject: [gdal-dev] gdaljni
Message-ID: <3dfbeaa02ba540cdb2cb1f6909047d29@lfv.se>

Hi,
This java command: Dataset ds = gdal.Open(txtInFilename.getText());
Generates:
Exception in thread "AWT-EventQueue-0" java.lang.UnsatisfiedLinkError: org.gdal.gdal.gdalJNI.Open__SWIG_1(Ljava/lang/String;)J
            at org.gdal.gdal.gdalJNI.Open__SWIG_1(Native Method)
            at org.gdal.gdal.gdal.Open(gdal.java:589)
            at raster.ImageTiler.info(ImageTiler.java:233)
            at raster.ImageTiler.access$2(ImageTiler.java:230)
            at raster.ImageTiler$2.mouseReleased(ImageTiler.java:211)
            at java.awt.AWTEventMulticaster.mouseReleased(AWTEventMulticaster.java:290)
            at java.awt.Component.processMouseEvent(Component.java:6539)
            at javax.swing.JComponent.processMouseEvent(JComponent.java:3324)
            at java.awt.Component.processEvent(Component.java:6304)
            at java.awt.Container.processEvent(Container.java:2239)
            at java.awt.Component.dispatchEventImpl(Component.java:4889)
            at java.awt.Container.dispatchEventImpl(Container.java:2297)
            at java.awt.Component.dispatchEvent(Component.java:4711)
            at java.awt.LightweightDispatcher.retargetMouseEvent(Container.java:4904)
            at java.awt.LightweightDispatcher.processMouseEvent(Container.java:4535)
            at java.awt.LightweightDispatcher.dispatchEvent(Container.java:4476)
            at java.awt.Container.dispatchEventImpl(Container.java:2283)
            at java.awt.Window.dispatchEventImpl(Window.java:2746)
            at java.awt.Component.dispatchEvent(Component.java:4711)
            at java.awt.EventQueue.dispatchEventImpl(EventQueue.java:760)
            at java.awt.EventQueue.access$500(EventQueue.java:97)
            at java.awt.EventQueue$3.run(EventQueue.java:709)
            at java.awt.EventQueue$3.run(EventQueue.java:703)
            at java.security.AccessController.doPrivileged(Native Method)
            at java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)
            at java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:84)
            at java.awt.EventQueue$4.run(EventQueue.java:733)
            at java.awt.EventQueue$4.run(EventQueue.java:731)
            at java.security.AccessController.doPrivileged(Native Method)
            at java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)
            at java.awt.EventQueue.dispatchEvent(EventQueue.java:730)
            at java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:205)
            at java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:116)
            at java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:105)
            at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:101)
            at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:93)
            at java.awt.EventDispatchThread.run(EventDispatchThread.java:82)
Anyone who knows what I have to do?
Kind regards,
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201211/575f4cc1/attachment-0001.html>

From jgr at osgeopt.pt  Fri Dec 11 08:28:45 2020
From: jgr at osgeopt.pt (Jorge Gustavo Rocha)
Date: Fri, 11 Dec 2020 16:28:45 +0000
Subject: [gdal-dev] GDALinfo 3.1.4 gives segmentation fault error
In-Reply-To: <SJ0PR19MB4510BA019725682D18B37A18D0CB0@SJ0PR19MB4510.namprd19.prod.outlook.com>
References: <SJ0PR19MB45101C97213319C58B5B14CDD0CB0@SJ0PR19MB4510.namprd19.prod.outlook.com>
 <9c68b949-b81a-1ef6-544b-513ec03352c8@osgeopt.pt>
 <SJ0PR19MB4510BA019725682D18B37A18D0CB0@SJ0PR19MB4510.namprd19.prod.outlook.com>
Message-ID: <1fa3ec02-1c1e-b96d-fae9-127d2950bd0e@osgeopt.pt>

Hi Slav,

You have a local build of gdal, right? Somewhere in
/Users/vskorole/opendap/hyrax/. gdal and proj libraries are picked from
/Users/vskorole/opendap/hyrax/build/deps/

Do have any other gdal installed from packages around?

If you have more than one gdal, seems like a library mismatch issue. If
you have just that gdal built by yourself, seems like a compilation and
deploy issue.

Sorry for not being so helpful, but I'm not a mac user.

Good luck,

Jorge


?s 16:37 de 10/12/20, korolevs at msn.com escreveu:
> Thank you for response.
> On macOS there is no ldd there is equivalent oTool.
> So:
> otool -L /Users/vskorole/opendap/hyrax/build/deps/bin/gdalinfo
> /Users/vskorole/opendap/hyrax/build/deps/bin/gdalinfo:
> 	/Users/vskorole/opendap/hyrax/build/deps/lib/libgdal.27.dylib (compatibility version 28.0.0, current version 28.4.0)
> 	/usr/local/opt/openexr/lib/libIlmImf-2_4.24.dylib (compatibility version 24.0.0, current version 24.0.0)
> 	/usr/local/opt/ilmbase/lib/libImath-2_4.24.dylib (compatibility version 24.0.0, current version 24.0.0)
> 	/usr/local/opt/ilmbase/lib/libHalf-2_4.24.dylib (compatibility version 24.0.0, current version 24.0.0)
> 	/usr/local/opt/ilmbase/lib/libIex-2_4.24.dylib (compatibility version 24.0.0, current version 24.0.0)
> 	/usr/local/opt/ilmbase/lib/libIexMath-2_4.24.dylib (compatibility version 24.0.0, current version 24.0.0)
> 	/usr/local/opt/ilmbase/lib/libIlmThread-2_4.24.dylib (compatibility version 24.0.0, current version 24.0.0)
> 	/usr/local/lib/libcrypto.1.1.dylib (compatibility version 1.1.0, current version 1.1.0)
> 	/usr/local/opt/json-c/lib/libjson-c.5.dylib (compatibility version 5.0.0, current version 5.1.0)
> 	/usr/local/opt/freexl/lib/libfreexl.1.dylib (compatibility version 3.0.0, current version 3.0.0)
> 	/usr/local/opt/geos/lib/libgeos_c.1.dylib (compatibility version 15.0.0, current version 15.3.0)
> 	/usr/local/opt/webp/lib/libwebp.7.dylib (compatibility version 9.0.0, current version 9.0.0)
> 	/usr/local/opt/openjpeg/lib/libopenjp2.7.dylib (compatibility version 7.0.0, current version 2.3.1)
> 	/usr/local/opt/jasper/lib/libjasper.4.dylib (compatibility version 4.0.0, current version 5.0.0)
> 	/usr/local/opt/hdf5/lib/libhdf5.200.dylib (compatibility version 201.0.0, current version 201.0.0)
> 	/usr/local/opt/giflib/lib/libgif.dylib (compatibility version 0.0.0, current version 7.2.0)
> 	/usr/local/opt/jpeg/lib/libjpeg.9.dylib (compatibility version 14.0.0, current version 14.0.0)
> 	/usr/local/opt/libgeotiff/lib/libgeotiff.5.dylib (compatibility version 7.0.0, current version 7.0.0)
> 	/usr/local/opt/libtiff/lib/libtiff.5.dylib (compatibility version 11.0.0, current version 11.0.0)
> 	/usr/local/opt/libpng/lib/libpng16.16.dylib (compatibility version 54.0.0, current version 54.0.0)
> 	/usr/local/opt/cfitsio/lib/libcfitsio.9.dylib (compatibility version 9.0.0, current version 9.3.49)
> 	/Users/vskorole/opendap/hyrax/build/deps/proj-6/lib/libproj.15.dylib (compatibility version 19.0.0, current version 19.2.0)
> 	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.100.1)
> 	/usr/lib/libsqlite3.dylib (compatibility version 9.0.0, current version 308.5.0)
> 	/usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.11)
> 	/usr/local/opt/pcre/lib/libpcre.1.dylib (compatibility version 4.0.0, current version 4.12.0)
> 	/usr/lib/libcurl.4.dylib (compatibility version 7.0.0, current version 9.0.0)
> 	/usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)
> 	/usr/lib/libxml2.2.dylib (compatibility version 10.0.0, current version 10.9.0)
> 	/usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 902.1.0)
> 
> Thank you.
> Slav Korolev.
> 
>> On Dec 10, 2020, at 10:00 AM, Jorge Gustavo Rocha <jgr at osgeopt.pt> wrote:
>>
>> Hi Slav,
>>
>> Libraries might be the problem. Can you provide more info, please?
>>
>> Tell us which libraries are being used by gdalinfo. Something like:
>>
>> ldd `which gdalinfo`
>>
>> Regards,
>>
>> Jorge
>>
>> ?s 14:31 de 10/12/20, korolevs at msn.com escreveu:
>>> What could be a reason why on MacOS Catalina 10.15.6(19G2021)
>>> galindo http://download.osgeo.org/geotiff/samples/other/erdas_spnad83.tif
>>> gives error /segmentation fault /but
>>> galindo http://download.osgeo.org/geotiff/samples/usgs/o41078a2.tif
>>> does not?
>>>
>>> Slav Korolev
>>> korolevs at msn.com <mailto:korolevs at msn.com>
>>>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
>> -- 
>> OSGeo Portugal
>> NIF: 509588190
>> email: geral at osgeopt.pt
>> https://www.osgeopt.pt/
>>
>> Pr?ximo evento: SASIG 2017, 20 a 22 de novembro, Porto
>> Mais informa??es: http://osgeopt.pt/sasig2017/
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 

-- 
OSGeo Portugal
NIF: 509588190
email: geral at osgeopt.pt
https://www.osgeopt.pt/

Pr?ximo evento: SASIG 2017, 20 a 22 de novembro, Porto
Mais informa??es: http://osgeopt.pt/sasig2017/

From jukka.rahkonen at maanmittauslaitos.fi  Sun Dec 13 15:08:23 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Sun, 13 Dec 2020 23:08:23 +0000
Subject: [gdal-dev] How to kill gdal2tiles?
Message-ID: <40395d7db08041a39c3cf348cd605e15@maanmittauslaitos.fi>

Hi,

Is there some clean way to kill gdal2tiles script? Ctrl-C at least does not work but leaves the script to some odd state.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201213/14784710/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 14 00:02:48 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 14 Dec 2020 08:02:48 +0000
Subject: [gdal-dev] How to kill gdal2tiles?
Message-ID: <48596430c1bf40c99da7e4439b30d61f@maanmittauslaitos.fi>

Hi Sean,

Thanks for the hint about multiprocessing. I was testing a command from gis.stackexchange with copy-pasting it and there is indeed a parameter ?--processes=6?.

It seems to me that there in no clean way to kill gdal2tiles on Windows when it is executing via multiprocess path. Ctrl-C kills a single process friendly.

-Jukka Rahkonen-

L?hett?j?: Sean Gillies <sean.gillies at gmail.com>
L?hetetty: maanantai 14. joulukuuta 2020 1.14
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [gdal-dev] How to kill gdal2tiles?

Hi Jukka,

Didn't gdal2tiles get a multiprocessing implementation recently? If that's the case, you must track down the child processes with ps (assuming POSIX) and kill them.

On Sun, Dec 13, 2020 at 4:08 PM Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> wrote:
Hi,

Is there some clean way to kill gdal2tiles script? Ctrl-C at least does not work but leaves the script to some odd state.

-Jukka Rahkonen-

--
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201214/aa46eaa3/attachment.html>

From jesus.moran at solute.es  Mon Dec 14 03:04:08 2020
From: jesus.moran at solute.es (jesus.moran at solute.es)
Date: Mon, 14 Dec 2020 12:04:08 +0100
Subject: [gdal-dev] gdal_translate  -scale
Message-ID: <000401d6d208$d8fb0870$8af11950$@solute.es>

Hello GDAL team and thank you for welcome me.

 

I have an issue with the gdal_translate command. I would like to use the
?STATISTICS_MIN? and ?STATISTICS_MAX? metadata key values in the -scale
parameter of the program, so I don?t need to specify it manually every time
I want to scale the output. Is there any way to do this?

 

Thanks a lot in advance!

 


 <http://www.solute.es/> 


Jes?s Maria Mor?n Rosado
Project Engineer

Av. Cerro del ?guila, 3, 28703 S.S. de los Reyes, Madrid

CONFIDENTIALITY: This e-mail and any attachments are confidential and may be
privileged. If you are not a named recipient, please notify the sender
immediately and do not disclose the contents to another person, use it for
any purpose or store or copy the information in any medium.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201214/6ff76be8/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1617 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201214/6ff76be8/attachment.gif>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 14 04:18:06 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 14 Dec 2020 05:18:06 -0700 (MST)
Subject: [gdal-dev] gdal_translate  -scale
In-Reply-To: <000401d6d208$d8fb0870$8af11950$@solute.es>
References: <000401d6d208$d8fb0870$8af11950$@solute.es>
Message-ID: <1607948286965-0.post@n6.nabble.com>

Hi,

If your output is 8 bit you can just use -scale without min/max values.
>From https://gdal.org/programs/gdal_translate.html:

"Rescale the input pixels values from the range src_min to src_max to the
range dst_min to dst_max. If omitted the output range is 0 to 255. If
omitted the input range is automatically computed from the source data."

If your data is higher than 8 bit and you want to keep it so you are out of
luck with gdal_translate because it first omits the output range and sets it
into 0-255 before it can omit the input range and compute the range
automatically.

The current behavior is not optimal for certain use cases
(https://gis.stackexchange.com/questions/294129/min-max-stretch-using-gdal-translate-in-a-batch).
Some programmer learning GDAL could take this as a challenge and formulate
how to improve the automatic scaling support so that it would not break too
much. As a first aid a Python script for automatic min/max scaling would be
nice, and why not with an option to utilize the histogram and use for
example +/- 98% of the histogram. Or mean +/- (2 x RMS).

-Jukka Rahkonen-



jesus.moran wrote
> Hello GDAL team and thank you for welcome me.
> 
>  
> 
> I have an issue with the gdal_translate command. I would like to use the
> ?STATISTICS_MIN? and ?STATISTICS_MAX? metadata key values in the -scale
> parameter of the program, so I don?t need to specify it manually every
> time
> I want to scale the output. Is there any way to do this?
> 
>  
> 
> Thanks a lot in advance!
> 
>  
> 
> 
>  &lt;http://www.solute.es/&gt; 
> 
> 
> Jes?s Maria Mor?n Rosado
> Project Engineer
> 
> Av. Cerro del ?guila, 3, 28703 S.S. de los Reyes, Madrid
> 
> CONFIDENTIALITY: This e-mail and any attachments are confidential and may
> be
> privileged. If you are not a named recipient, please notify the sender
> immediately and do not disclose the contents to another person, use it for
> any purpose or store or copy the information in any medium.
> 
>  
> 
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> image001.gif (2K)
> &lt;http://osgeo-org.1560.x6.nabble.com/attachment/5452429/0/image001.gif&gt;





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 14 04:38:07 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Mon, 14 Dec 2020 12:38:07 +0000
Subject: [gdal-dev] gdal_translate  -scale
Message-ID: <4079761f038e4653a57c32a62a489eea@maanmittauslaitos.fi>

Hi,

Please remember to use reply-to-all for sending a copy to the list as well.

-Jukka-

-----Alkuper?inen viesti-----
L?hett?j?: jesus.moran at solute.es <jesus.moran at solute.es> 
L?hetetty: maanantai 14. joulukuuta 2020 14.27
Vastaanottaja: Rahkonen Jukka (MML) <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: RE: [gdal-dev] gdal_translate -scale

Hi,

Thank you so much for your quick response. I can see the issue here. My data is 16 bits so it can be omitted in the -scale param. I will have to look for Python aid as you said, then.

Have a nice Monday! 




Jes?s Maria Mor?n Rosado
Project Engineer
 
Av. Cerro del ?guila, 3, 28703 S.S. de los Reyes, Madrid
CONFIDENTIALITY: This e-mail and any attachments are confidential and may be privileged. If you are not a named recipient, please notify the sender immediately and do not disclose the contents to another person, use it for any purpose or store or copy the information in any medium.

-----Original Message-----
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of jratike80
Sent: lunes, 14 de diciembre de 2020 13:18
To: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] gdal_translate -scale

Hi,

If your output is 8 bit you can just use -scale without min/max values.
From https://gdal.org/programs/gdal_translate.html:

"Rescale the input pixels values from the range src_min to src_max to the range dst_min to dst_max. If omitted the output range is 0 to 255. If omitted the input range is automatically computed from the source data."

If your data is higher than 8 bit and you want to keep it so you are out of luck with gdal_translate because it first omits the output range and sets it into 0-255 before it can omit the input range and compute the range automatically.

The current behavior is not optimal for certain use cases (https://gis.stackexchange.com/questions/294129/min-max-stretch-using-gdal-translate-in-a-batch).
Some programmer learning GDAL could take this as a challenge and formulate how to improve the automatic scaling support so that it would not break too much. As a first aid a Python script for automatic min/max scaling would be nice, and why not with an option to utilize the histogram and use for example +/- 98% of the histogram. Or mean +/- (2 x RMS).

-Jukka Rahkonen-



jesus.moran wrote
> Hello GDAL team and thank you for welcome me.
> 
>  
> 
> I have an issue with the gdal_translate command. I would like to use 
> the ?STATISTICS_MIN? and ?STATISTICS_MAX? metadata key values in the 
> -scale parameter of the program, so I don?t need to specify it 
> manually every time I want to scale the output. Is there any way to do 
> this?
> 
>  
> 
> Thanks a lot in advance!
> 
>  
> 
> 
>  &lt;http://www.solute.es/&gt;
> 
> 
> Jes?s Maria Mor?n Rosado
> Project Engineer
> 
> Av. Cerro del ?guila, 3, 28703 S.S. de los Reyes, Madrid
> 
> CONFIDENTIALITY: This e-mail and any attachments are confidential and 
> may be privileged. If you are not a named recipient, please notify the 
> sender immediately and do not disclose the contents to another person, 
> use it for any purpose or store or copy the information in any medium.
> 
>  
> 
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
> 
> image001.gif (2K)
> &lt;http://osgeo-org.1560.x6.nabble.com/attachment/5452429/0/image001.
> gif&gt;





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev


From symphoni.bush at noaa.gov  Tue Dec 15 11:33:54 2020
From: symphoni.bush at noaa.gov (Symphoni Bush - NOAA Affiliate)
Date: Tue, 15 Dec 2020 14:33:54 -0500
Subject: [gdal-dev] Gdal EOL?
Message-ID: <CAA5fwB63DFhazttGTQX_5w-cyr0EERAFZmz_p1Zy8M2dp_TN9Q@mail.gmail.com>

I am trying to figure out what versions of gdal are EOL, and if so, when
they become EOL? Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201215/a9faeee8/attachment.html>

From even.rouault at spatialys.com  Tue Dec 15 12:06:51 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 15 Dec 2020 21:06:51 +0100
Subject: [gdal-dev] Gdal EOL?
In-Reply-To: <CAA5fwB63DFhazttGTQX_5w-cyr0EERAFZmz_p1Zy8M2dp_TN9Q@mail.gmail.com>
References: <CAA5fwB63DFhazttGTQX_5w-cyr0EERAFZmz_p1Zy8M2dp_TN9Q@mail.gmail.com>
Message-ID: <6063171.afxfK0dASA@even-i700>

On mardi 15 d?cembre 2020 14:33:54 CET Symphoni Bush - NOAA Affiliate via 
gdal-dev wrote:
> I am trying to figure out what versions of gdal are EOL, and if so, when
> they become EOL? Thanks.

The current scheme is:
- feature releases occur every 6 months
- only the last feature release is supported for 6 months with bugfix releases 
every 2 months, until the next feature release is available.

So, concretely, only GDAL 3.2 is supported with bugfix versions every 2 months 
(3.2.1, etc) until GDAL 3.3.0 will be released in May 2021. At that point, 
GDAL 3.3 will become the new supported version.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From g.averlant at gmail.com  Wed Dec 16 12:52:41 2020
From: g.averlant at gmail.com (Guilhain Averlant)
Date: Wed, 16 Dec 2020 21:52:41 +0100
Subject: [gdal-dev] OGR python : write binary data in layer
Message-ID: <CAFYtvVxDj9De=fwDaXGJ2KDST_CM0tsM-UkQL+xeNC0KrGWPZQ@mail.gmail.com>

I wrote a ticket on gis.stackexchange.combut I didn't get a satisfactory
answer, so I ask my question here.

I'm trying to create a memory layer with gdal/ogr python that contains a
Binary Field.

But I didn't succeed, where am I wrong?

   from osgeo import ogr

   # create layer
   driver = ogr.GetDriverByName('Memory')
   data_source = driver.CreateDataSource('foo')
   layer = data_source.CreateLayer('bar')

   # create binary field
   field_name = 'bin_field'
   binary_field = ogr.FieldDefn(field_name, ogr.OFTBinary)
   layer.CreateField(binary_field)

   # add feature that contains binary value
   bytes_value = bytes(b'hello world')
   feature = ogr.Feature(layer.GetLayerDefn())
   feature.SetField(field_name, bytes_value)
   layer.CreateFeature(feature)

Error message :

       feature.SetField(field_name, bytes_value)
     File "/usr/lib/python3/dist-packages/osgeo/ogr.py", line 4321, in
SetField
       return _ogr.Feature_SetField(self, *args)
   TypeError: Wrong number or type of arguments for overloaded function
'Feature_SetField'.
     Possible C/C++ prototypes are:
       OGRFeatureShadow::SetField(int,char const *)
       OGRFeatureShadow::SetField(char const *,char const *)
       OGRFeatureShadow::SetField(int,double)
       OGRFeatureShadow::SetField(char const *,double)
       OGRFeatureShadow::SetField(int,int,int,int,int,int,float,int)
       OGRFeatureShadow::SetField(char const
*,int,int,int,int,int,float,int)

Link to question on Stack Exchange :
https://gis.stackexchange.com/questions/382119/ogr-python-write-binary-data-in-layer

-- 
Guilhain AVERLANT
119 rue Manin
75019 PARIS
06 28 22 83 05
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201216/ab8aed9f/attachment.html>

From even.rouault at spatialys.com  Wed Dec 16 13:28:21 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 16 Dec 2020 22:28:21 +0100
Subject: [gdal-dev] OGR python : write binary data in layer
In-Reply-To: <CAFYtvVxDj9De=fwDaXGJ2KDST_CM0tsM-UkQL+xeNC0KrGWPZQ@mail.gmail.com>
References: <CAFYtvVxDj9De=fwDaXGJ2KDST_CM0tsM-UkQL+xeNC0KrGWPZQ@mail.gmail.com>
Message-ID: <14516861.B9VtmHrslq@even-i700>

Guilhain,

On mercredi 16 d?cembre 2020 21:52:41 CET Guilhain Averlant wrote:
> I wrote a ticket on gis.stackexchange.combut I didn't get a satisfactory
> answer, so I ask my question here.
> 
> I'm trying to create a memory layer with gdal/ogr python that contains a
> Binary Field.
> 
> But I didn't succeed, where am I wrong?

Probably nothing. I'm not sure why we don't have an override for this. Perhaps 
because OFTBinary is rather exotic and nobody strongly needed it before. 
Perhaps some (past) Python2/3 dilemna too

You can use f.SetFieldBinaryFromHexString(field_name,
												  binary_as_hex_string)

where e.g. binary_as_hex_string = binascii.hexlify(b'hello world')

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From g.averlant at gmail.com  Thu Dec 17 06:21:55 2020
From: g.averlant at gmail.com (Guilhain Averlant)
Date: Thu, 17 Dec 2020 15:21:55 +0100
Subject: [gdal-dev] OGR python : write binary data in layer
In-Reply-To: <14516861.B9VtmHrslq@even-i700>
References: <CAFYtvVxDj9De=fwDaXGJ2KDST_CM0tsM-UkQL+xeNC0KrGWPZQ@mail.gmail.com>
 <14516861.B9VtmHrslq@even-i700>
Message-ID: <CAFYtvVxZw=7PtFp4FfHauSPwya9nUPe45+a_SrvwxQpzWQR_ag@mail.gmail.com>

Thanks a lot !

If you want to use only native python functions you can do like this.

binary_as_hex_string = bytes_value.hex()
feature.SetFieldBinaryFromHexString(field_name, binary_as_hex_string)

To restore bytes_value to bytes type :

bytes_value = bytes.fromhex(binary_as_hex_string)



Le mer. 16 d?c. 2020 ? 22:28, Even Rouault <even.rouault at spatialys.com> a
?crit :

> Guilhain,
>
> On mercredi 16 d?cembre 2020 21:52:41 CET Guilhain Averlant wrote:
> > I wrote a ticket on gis.stackexchange.combut I didn't get a satisfactory
> > answer, so I ask my question here.
> >
> > I'm trying to create a memory layer with gdal/ogr python that contains a
> > Binary Field.
> >
> > But I didn't succeed, where am I wrong?
>
> Probably nothing. I'm not sure why we don't have an override for this.
> Perhaps
> because OFTBinary is rather exotic and nobody strongly needed it before.
> Perhaps some (past) Python2/3 dilemna too
>
> You can use f.SetFieldBinaryFromHexString(field_name,
>
>                         binary_as_hex_string)
>
> where e.g. binary_as_hex_string = binascii.hexlify(b'hello world')
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>


-- 
Guilhain AVERLANT
119 rue Manin
75019 PARIS
06 28 22 83 05
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201217/6ed64167/attachment.html>

From j1 at jimenezshaw.com  Thu Dec 17 10:28:29 2020
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Thu, 17 Dec 2020 19:28:29 +0100
Subject: [gdal-dev] Best way to read jpeg interleaved
Message-ID: <CADRrdKvKX0oyr0PdBSMLvDz3-0+kfoZhEX7NBzLhPW37G4wYfw@mail.gmail.com>

Hi

I want to read quickly a jpeg file, and store it in memory interleaved
(RGBRGBRGB).
Is this the fastest way to read it?
(note: dest is already allocated to the proper size)

void loadImageRGBUint8(const std::string& path, void* dest) { auto dataSet
= static_cast<GDALDataset*>(GDALOpen(path.c_str(), GA_ReadOnly))); // check
dataSet ...
const auto width = dataSet->GetRasterXSize(); const auto height =
dataSet->GetRasterYSize(); const auto rasterReturn =
dataSet->RasterIO(GF_Read, 0, // top 0, // left width, height, dest, width,
height, GDT_Byte, 3, // bands nullptr, 3, // nPixelSpace 3 * width, //
nLineSpace 1, // nBandSpace nullptr); // ...check rasterReturn and destroy
dataSet ... }

Regarding the parameter "nLineSpace", documentation says
nLineSpace The byte offset from the start of one scanline in pData to the
start of the next. If defaulted (0) the size of the datatype eBufType *
nBufXSize is used.
In the code above, if I set nLineSpace to 0, it works fine. However, if I
write what documentation says ( 1 * width ), it does not work. Is this a
bug in the documentation, or am I understanding it wrongly?

Thanks
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201217/bfa7ccfd/attachment.html>

From even.rouault at spatialys.com  Thu Dec 17 10:47:24 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 17 Dec 2020 19:47:24 +0100
Subject: [gdal-dev] Best way to read jpeg interleaved
In-Reply-To: <CADRrdKvKX0oyr0PdBSMLvDz3-0+kfoZhEX7NBzLhPW37G4wYfw@mail.gmail.com>
References: <CADRrdKvKX0oyr0PdBSMLvDz3-0+kfoZhEX7NBzLhPW37G4wYfw@mail.gmail.com>
Message-ID: <5371946.MUndmuuMl3@even-i700>

Javier,

> I want to read quickly a jpeg file, and store it in memory interleaved
> (RGBRGBRGB).
> Is this the fastest way to read it?

Yes. There is even an optimized code path in the JPEG driver for that 
situation that short circuits completely the GDAL block cache.

> Regarding the parameter "nLineSpace", documentation says
> nLineSpace The byte offset from the start of one scanline in pData to the
> start of the next. If defaulted (0) the size of the datatype eBufType *
> nBufXSize is used.
> In the code above, if I set nLineSpace to 0, it works fine. However, if I
> write what documentation says ( 1 * width ), it does not work. Is this a
> bug in the documentation, or am I understanding it wrongly?

The relevant code is:

/* -------------------------------------------------------------------- */
/*      If pixel and line spacing are defaulted assign reasonable      */
/*      value assuming a packed buffer.                                 */
/* -------------------------------------------------------------------- */
    if( nPixelSpace == 0 )
        nPixelSpace = GDALGetDataTypeSizeBytes(eBufType);

    if( nLineSpace == 0 )
    {
        nLineSpace = nPixelSpace * nBufXSize;
    }

    if( nBandSpace == 0 && nBandCount > 1 )
    {
        nBandSpace = nLineSpace * nBufYSize;
    }

The doc is correct if all spacing parameters are set to 0, but indeed not if 
you put some to 0 and others not. PR to make it more accurate welcome.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From g.averlant at gmail.com  Fri Dec 18 01:12:05 2020
From: g.averlant at gmail.com (Guilhain Averlant)
Date: Fri, 18 Dec 2020 10:12:05 +0100
Subject: [gdal-dev] OGR python : read binary data in layer
Message-ID: <CAFYtvVwE+Z=dp1r5jbH8rivatAzYJXCxhVsh2AezXqA-pT9XQA@mail.gmail.com>

Hello everyone.

Same layer new problem when I try to get value stored in my feature my
binary value (transformed to hex value) is truncated to 75 char maximum.
I tried to add the 'SetWidth' variable when creating the field, but it
doesn't change anything.

from osgeo import ogr

# create layer
driver = ogr.GetDriverByName('Memory')
data_source = driver.CreateDataSource('foo')
layer = data_source.CreateLayer('bar')

# create binary field
field_name = 'bin_field'
binary_field = ogr.FieldDefn(field_name, ogr.OFTBinary)
layer.CreateField(binary_field)

# add feature that contains binary value
bytes_value = bytes(b'\x0e=p\xa3\xd7\n=@"\x8f\\(\xf5\xc2\x8f\xc0`]\x1e\xb8Q\xeb\x85?\xf8Q\xeb\x85\x1e\xb8R at A\x8f\\(\xf5\xc2\x8f at R\x0e\xf9\xdb"\xd0\xe5@\x0e=p\xa3\xd7\n=@"\x8f\\(\xf5\xc2\x8f\x00\x00\x00\x01\x00\x00\x00\x04 at 7.\x14z\xe1G\xae\xc0A%\x1e\xb8Q\xeb\x85\xbf\xf4\xf5\xc2\x8f\\(\xf6\xc0\x12p\xa3\xd7\n=q@\x0bG\xae\x14z\xe1H at Sz=p\xa3\xd7\n at 7.\x14z\xe1G\xae\xc0A%\x1e\xb8Q\xeb\x85')
binary_as_hex_string = bytes_value.hex()
feature = ogr.Feature(layer.GetLayerDefn())
feature.SetFieldBinaryFromHexString(field_name, binary_as_hex_string)
layer.CreateFeature(feature)

# get new feature in layer to read it
read_feature = layer.GetFeature(0)
# get 'bin_field' field value
print(read_feature.GetField(field_name))

>>> "0E3D70A3D70A3D40228F5C28F5C28FC0605D1EB851EB853FF851EB851EB85240418F5C28..."


Any idea to get the entire value ?

This should return this value normally :
0e3d70a3d70a3d40228f5c28f5c28fc0605d1eb851eb853ff851eb851eb85240418f5c28f5c28f40520ef9db22d0e5400e3d70a3d70a3d40228f5c28f5c28f000000010000000440372e147ae147aec041251eb851eb85bff4f5c28f5c28f6c01270a3d70a3d71400b47ae147ae14840537a3d70a3d70a40372e147ae147aec041251eb851eb85

-- 
Guilhain AVERLANT
119 rue Manin
75019 PARIS
06 28 22 83 05
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201218/3f3b9349/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Dec 18 03:57:47 2020
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka (MML))
Date: Fri, 18 Dec 2020 11:57:47 +0000
Subject: [gdal-dev] Issue with gdalcompare.py and Proj 8
Message-ID: <45349fb5d0e44557b4d4c5e7859355a4@maanmittauslaitos.fi>

Hi,

The proj.db in Proj version 8 (installed with OSGeo4W) is a bit different than it used to be and therefore gdalcompare.py fails with this error:

ERROR 1: PROJ: proj_create_from_database: SQLite error on SELECT name, coordinate_system_auth_name, coordinate_system_code, geodetic_crs_auth_name, geodetic_crs_code, conversion_auth_name, conversion_code, area_of_use_auth_name, area_of_use_code, text_definition, deprecated FROM projected_crs WHERE auth_name = ? AND code = ?: no such column: area_of_use_auth_name

There seems to be a few fields which are not present in the new version of the projected_crs table: scope, area_of_use_auth_name, area_of_use_code.

I believe that the proj.db is as it should for Proj 8 and gdalcompare needs a fix but I am not quite sure. The code that builds proj.db is in PROJ/build_db.py at master * OSGeo/PROJ (github.com)<https://github.com/OSGeo/PROJ/blob/master/scripts/build_db.py>.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201218/607e3ab0/attachment.html>

From even.rouault at spatialys.com  Fri Dec 18 04:33:29 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 18 Dec 2020 13:33:29 +0100
Subject: [gdal-dev] OGR python : read binary data in layer
In-Reply-To: <CAFYtvVwE+Z=dp1r5jbH8rivatAzYJXCxhVsh2AezXqA-pT9XQA@mail.gmail.com>
References: <CAFYtvVwE+Z=dp1r5jbH8rivatAzYJXCxhVsh2AezXqA-pT9XQA@mail.gmail.com>
Message-ID: <1886140.AVvaR3YaK6@even-i700>

> Any idea to get the entire value ?

read_feature.GetFieldAsBinary(field_name)

This will return a binary content, not an hex encoded string

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Dec 18 04:37:09 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 18 Dec 2020 13:37:09 +0100
Subject: [gdal-dev] Issue with gdalcompare.py and Proj 8
In-Reply-To: <45349fb5d0e44557b4d4c5e7859355a4@maanmittauslaitos.fi>
References: <45349fb5d0e44557b4d4c5e7859355a4@maanmittauslaitos.fi>
Message-ID: <2294191.a2zd1JY8h3@even-i700>

Jukka,

> The proj.db in Proj version 8 (installed with OSGeo4W) is a bit different
> than it used to be and therefore gdalcompare.py fails with this error:
> 
> ERROR 1: PROJ: proj_create_from_database: SQLite error on SELECT name,
> coordinate_system_auth_name, coordinate_system_code,
> geodetic_crs_auth_name, geodetic_crs_code, conversion_auth_name,
> conversion_code, area_of_use_auth_name, area_of_use_code, text_definition,
> deprecated FROM projected_crs WHERE auth_name = ? AND code = ?: no such
> column: area_of_use_auth_name
> 
> There seems to be a few fields which are not present in the new version of
> the projected_crs table: scope, area_of_use_auth_name, area_of_use_code.
> 
> I believe that the proj.db is as it should for Proj 8 and gdalcompare needs
> a fix but I am not quite sure. The code that builds proj.db is in
> PROJ/build_db.py at master * OSGeo/PROJ
> (github.com)<https://github.com/OSGeo/PROJ/blob/master/scripts/build_db.py>
> .

This smells like a misconfiguration of your OSGeo4W environment. You're likely 
using a PROJ < 8 library with a proj.db from PROJ 7.2 or 8. Check PROJ_LIB

https://github.com/OSGeo/PROJ/search?q=area_of_use_auth_name shows there's no 
longer any occurence of area_of_use_auth_name in PROJ master

GDAL does not directly issue SQL requests on proj.db. It hardly knows about 
its existence. This is done by the PROJ.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Dec 18 10:08:49 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 18 Dec 2020 19:08:49 +0100
Subject: [gdal-dev] Compositing of overlapping sources with mask/alpha band
 in VRT
Message-ID: <27757555.lger4l8dr0@even-i700>

Hi,

Just wanted to mention a new capability of the VRT driver
(https://github.com/OSGeo/gdal/pull/3303) to take into account the mask band 
of a source to determine which pixels must be taken into account. This is a 
generalization of the <NODATA> mechanism to the mask band concept. This can 
work with internal/external mask bands, and with alpha band too, with the 
limitation for the later that it will interpret any non-0 value as fully 
opaque (no alpha blending)

I was hesitating a bit if that new capability should be implicit or explicit. 
I decided for explicit, to be consistent with the existing NODATA mechanism. 
That said, if you create the VRT with gdalbuildvrt, it will default to using 
the new feature and adding the required <UseMaskBand>true</UseMaskBand> 
element.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From hh1 at posteo.de  Mon Dec 21 03:24:30 2020
From: hh1 at posteo.de (G Seiffert)
Date: Mon, 21 Dec 2020 10:24:30 -0100
Subject: [gdal-dev] Geotransform for non-North-up images?
Message-ID: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>

Hi all from GDLA.

Thanks for the opportunity to as a question. It's regarding the 
Geotransform 
Tutorial(https://gdal.org/tutorials/geotransforms_tut.html). Tried to 
get info in the web but since this seems a tricky one, my searches failed.

The tutorial only deals with the ideal case of 'North up' images, for 
which GT(2) and GT(4) are zero. However, my images are 'East up' and 
potentially 'any direction up' (underwater photomosaic surveys by ROV). 
The rotation works with '90' for GT(2, 4). But the scaling seems 
completely ignored. Any hint? If it would be easy, I assume your 
tutorial would give an example for how to deal with "non-N-up' images, 
but ...

My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm per 
pixel, we're flying just 3m above the bottom).

In case I rotate the images prior to geotransform (in Photoshop), 
geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can 
live with that for our last survey but I'm also looking for a solution 
in case our survey heading cannot be 0, 90, 180, or 270, but has to be 
something like 35? (due to bottom currents etc.).

Best regards, any hint qappreciated,
Gerhard


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201221/ac177e0d/attachment.html>

From knudsen.thomas at gmail.com  Mon Dec 21 04:03:02 2020
From: knudsen.thomas at gmail.com (Thomas Knudsen)
Date: Mon, 21 Dec 2020 13:03:02 +0100
Subject: [gdal-dev] Geotransform for non-North-up images?
In-Reply-To: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
References: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
Message-ID: <CAH0YoEPkAW2MMCGLA34C6S88Ny0Y8SJKLwz_npix5gFuUtYtag@mail.gmail.com>

Perhaps you can find some relevant information on the Wikpedia page
describing the ESRI world file format:
https://en.wikipedia.org/wiki/World_file - that usually where I go when I
need to re-learn the basics of affine transformations

/thomas

Den man. 21. dec. 2020 kl. 12.34 skrev G Seiffert <hh1 at posteo.de>:

> Hi all from GDLA.
>
> Thanks for the opportunity to as a question. It's regarding the Geotransform
> Tutorial (https://gdal.org/tutorials/geotransforms_tut.html). Tried to
> get info in the web but since this seems a tricky one, my searches failed.
>
> The tutorial only deals with the ideal case of 'North up' images, for
> which GT(2) and GT(4) are zero. However, my images are 'East up' and
> potentially 'any direction up' (underwater photomosaic surveys by ROV). The
> rotation works with '90' for GT(2, 4). But the scaling seems completely
> ignored. Any hint? If it would be easy, I assume your tutorial would give
> an example for how to deal with "non-N-up' images, but ...
>
> My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm per
> pixel, we're flying just 3m above the bottom).
>
> In case I rotate the images prior to geotransform (in Photoshop),
> geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can live
> with that for our last survey but I'm also looking for a solution in case
> our survey heading cannot be 0, 90, 180, or 270, but has to be something
> like 35? (due to bottom currents etc.).
>
> Best regards, any hint qappreciated,
> Gerhard
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201221/d92e978c/attachment.html>

From j1 at jimenezshaw.com  Mon Dec 21 04:03:29 2020
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 21 Dec 2020 13:03:29 +0100
Subject: [gdal-dev] Geotransform for non-North-up images?
In-Reply-To: <CADRrdKtOWe7VCtD9Dvai55EMy91FiPCHZh=EqJOW4EOJDLXCOg@mail.gmail.com>
References: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
 <CADRrdKtOWe7VCtD9Dvai55EMy91FiPCHZh=EqJOW4EOJDLXCOg@mail.gmail.com>
Message-ID: <CADRrdKtn-Gz4ENNBmxmPuW+jjW258PoBZmea51gosdi1SZtyPA@mail.gmail.com>

What I do to compute the (single) GSD (or pixel size) when there is a
rotation is this:

GSD = sqrt(abs(determinant([2x2 top left corner])))

see that pixel size can be different in X and Y directions. If you know
your raster has no such distortion, you can just take the sqrt.
abs is important. Usually Y goes from top to bottom in images files, while
the other way around in coordinate systems. That produces a negative
determinant.

Cheers
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Mon, 21 Dec 2020 at 12:55, Javier Jimenez Shaw <j1 at jimenezshaw.com>
wrote:

> Those transformation parameters can be seen as a 3x3 transformation matrix
> like this
>
> Xg     GT1 GT2 GT0     Xp
> Yg  =  GT4 GT5 GT3  *  Yp
>  1      0   0   1       1
>
> Where [Xp, Yp] is the coordinate in pixels, and [Xg, Yg] is the
> "geographic" coordinate (whatever it means ;)
>
> the 2x2 top left corner of the transformation matrix can be seen as a 2D
> rotation-scaling matrix:
> https://en.wikipedia.org/wiki/Transformation_matrix#Examples_in_2_dimensions
> [GT0, GT3] is the "geographic" coordinate of the pixel [0, 0] (regardless
> rotation or scaling)
>
> Cheers
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
> On Mon, 21 Dec 2020 at 12:34, G Seiffert <hh1 at posteo.de> wrote:
>
>> Hi all from GDLA.
>>
>> Thanks for the opportunity to as a question. It's regarding the Geotransform
>> Tutorial (https://gdal.org/tutorials/geotransforms_tut.html). Tried to
>> get info in the web but since this seems a tricky one, my searches failed.
>>
>> The tutorial only deals with the ideal case of 'North up' images, for
>> which GT(2) and GT(4) are zero. However, my images are 'East up' and
>> potentially 'any direction up' (underwater photomosaic surveys by ROV). The
>> rotation works with '90' for GT(2, 4). But the scaling seems completely
>> ignored. Any hint? If it would be easy, I assume your tutorial would give
>> an example for how to deal with "non-N-up' images, but ...
>>
>> My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm per
>> pixel, we're flying just 3m above the bottom).
>>
>> In case I rotate the images prior to geotransform (in Photoshop),
>> geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can live
>> with that for our last survey but I'm also looking for a solution in case
>> our survey heading cannot be 0, 90, 180, or 270, but has to be something
>> like 35? (due to bottom currents etc.).
>>
>> Best regards, any hint qappreciated,
>> Gerhard
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201221/7b03c536/attachment.html>

From j1 at jimenezshaw.com  Mon Dec 21 03:55:37 2020
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 21 Dec 2020 12:55:37 +0100
Subject: [gdal-dev] Geotransform for non-North-up images?
In-Reply-To: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
References: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
Message-ID: <CADRrdKtOWe7VCtD9Dvai55EMy91FiPCHZh=EqJOW4EOJDLXCOg@mail.gmail.com>

Those transformation parameters can be seen as a 3x3 transformation matrix
like this

Xg     GT1 GT2 GT0     Xp
Yg  =  GT4 GT5 GT3  *  Yp
 1      0   0   1       1

Where [Xp, Yp] is the coordinate in pixels, and [Xg, Yg] is the
"geographic" coordinate (whatever it means ;)

the 2x2 top left corner of the transformation matrix can be seen as a 2D
rotation-scaling matrix:
https://en.wikipedia.org/wiki/Transformation_matrix#Examples_in_2_dimensions
[GT0, GT3] is the "geographic" coordinate of the pixel [0, 0] (regardless
rotation or scaling)

Cheers
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Mon, 21 Dec 2020 at 12:34, G Seiffert <hh1 at posteo.de> wrote:

> Hi all from GDLA.
>
> Thanks for the opportunity to as a question. It's regarding the Geotransform
> Tutorial (https://gdal.org/tutorials/geotransforms_tut.html). Tried to
> get info in the web but since this seems a tricky one, my searches failed.
>
> The tutorial only deals with the ideal case of 'North up' images, for
> which GT(2) and GT(4) are zero. However, my images are 'East up' and
> potentially 'any direction up' (underwater photomosaic surveys by ROV). The
> rotation works with '90' for GT(2, 4). But the scaling seems completely
> ignored. Any hint? If it would be easy, I assume your tutorial would give
> an example for how to deal with "non-N-up' images, but ...
>
> My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm per
> pixel, we're flying just 3m above the bottom).
>
> In case I rotate the images prior to geotransform (in Photoshop),
> geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can live
> with that for our last survey but I'm also looking for a solution in case
> our survey heading cannot be 0, 90, 180, or 270, but has to be something
> like 35? (due to bottom currents etc.).
>
> Best regards, any hint qappreciated,
> Gerhard
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201221/f59f1028/attachment-0001.html>

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 21 04:35:33 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Mon, 21 Dec 2020 05:35:33 -0700 (MST)
Subject: [gdal-dev] Geotransform for non-North-up images?
In-Reply-To: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
References: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
Message-ID: <1608554133656-0.post@n6.nabble.com>

Hi,

The geotransform parameters are the same than in the ESRI wordfile. I tried
once to understand how the parameters behave when the image is rotated and
wrote an OpenOffice spreadsheet about that. You can have a try and play with
the parameters. I hope I have understood it right. I was not so sure myself
and therefore there are some unnecessary cells with forward and backward
formulas just to verify the results. 

http://latuviitta.org/documents/rotated_worldfile.ods

-Jukka Rahkonen-


G Seiffert wrote
> Hi all from GDLA.
> 
> Thanks for the opportunity to as a question. It's regarding the 
> Geotransform 
> Tutorial(https://gdal.org/tutorials/geotransforms_tut.html). Tried to 
> get info in the web but since this seems a tricky one, my searches failed.
> 
> The tutorial only deals with the ideal case of 'North up' images, for 
> which GT(2) and GT(4) are zero. However, my images are 'East up' and 
> potentially 'any direction up' (underwater photomosaic surveys by ROV). 
> The rotation works with '90' for GT(2, 4). But the scaling seems 
> completely ignored. Any hint? If it would be easy, I assume your 
> tutorial would give an example for how to deal with "non-N-up' images, 
> but ...
> 
> My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm per 
> pixel, we're flying just 3m above the bottom).
> 
> In case I rotate the images prior to geotransform (in Photoshop), 
> geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can 
> live with that for our last survey but I'm also looking for a solution 
> in case our survey heading cannot be 0, 90, 180, or 270, but has to be 
> something like 35? (due to bottom currents etc.).
> 
> Best regards, any hint qappreciated,
> Gerhard
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From hh1 at posteo.de  Mon Dec 21 05:57:18 2020
From: hh1 at posteo.de (G Seiffert)
Date: Mon, 21 Dec 2020 12:57:18 -0100
Subject: [gdal-dev] Geotransform for non-North-up images?
In-Reply-To: <CADRrdKtOWe7VCtD9Dvai55EMy91FiPCHZh=EqJOW4EOJDLXCOg@mail.gmail.com>
References: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
 <CADRrdKtOWe7VCtD9Dvai55EMy91FiPCHZh=EqJOW4EOJDLXCOg@mail.gmail.com>
Message-ID: <4078ce15-351f-2195-d0d3-e7fa502c8e05@posteo.de>

Thanks Javier. Need to confess: math is not my strong side. I'm more the 
"trial and error" guy. And - shame on me - Google.

Got the rotation AND the scaling correct meanwhile, calculating the 
params as described here: 
https://gis.stackexchange.com/questions/69715/rotating-rasters-using-gdal-geotransform-and-arcgis-desktop?noredirect=1&lq=1

Below a code snippet (I work in Python). However,? with the exact calcs 
from above website, my pics were rotated correctly but for some strange 
reason mirrored vertically! Try and error: Making GT(4) negative got rid 
of the mirroring. So almost happy now, just facing a weird shift of 2m 
to west and 0.7m to south, working on it.

# ROTATION PART Start ================================================
 ??? rot_deg = 90
 ??? rotation = np.deg2rad(rot_deg)

 ??? GT0 = orig_x
 ??? GT1 = math.cos(rotation) * image_resolution
 ??? GT2 = -math.sin(rotation) * image_resolution
 ??? GT3 = orig_y
 ??? GT4 = -math.sin(rotation) * image_resolution
 ??? GT5 = math.cos(rotation) * image_resolution

 ??? geotrans = (GT0, GT1, GT2, GT3, GT4, GT5)

# ROTATION PART End ================================================

Thanks so far! Also Thomas and Jukka!
Gerhard

> Javier Jimenez Shaw <mailto:j1 at jimenezshaw.com>
> 21 December 2020 10:55
> Those transformation parameters can be seen as a 3x3 transformation 
> matrix like this
>
> Xg ? ? GT1 GT2 GT0 ??? Xp
> Yg? =? GT4 GT5 GT3? *? Yp
> ?1 ? ?? 0?? 0?? 1? ? ?? 1
>
> Where [Xp, Yp] is the coordinate in pixels, and [Xg, Yg] is the 
> "geographic" coordinate (whatever it means ;)
>
> the 2x2 top left corner of the transformation matrix can be seen as a 
> 2D rotation-scaling matrix: 
> https://en.wikipedia.org/wiki/Transformation_matrix#Examples_in_2_dimensions
> [GT0, GT3]is the "geographic" coordinate of the pixel [0, 
> 0](regardless rotation or scaling)
>
> Cheers
> .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
> G Seiffert <mailto:hh1 at posteo.de>
> 21 December 2020 10:24
> Hi all from GDLA.
>
> Thanks for the opportunity to as a question. It's regarding the 
> Geotransform 
> Tutorial(https://gdal.org/tutorials/geotransforms_tut.html). Tried to 
> get info in the web but since this seems a tricky one, my searches failed.
>
> The tutorial only deals with the ideal case of 'North up' images, for 
> which GT(2) and GT(4) are zero. However, my images are 'East up' and 
> potentially 'any direction up' (underwater photomosaic surveys by 
> ROV). The rotation works with '90' for GT(2, 4). But the scaling seems 
> completely ignored. Any hint? If it would be easy, I assume your 
> tutorial would give an example for how to deal with "non-N-up' images, 
> but ...
>
> My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm 
> per pixel, we're flying just 3m above the bottom).
>
> In case I rotate the images prior to geotransform (in Photoshop), 
> geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can 
> live with that for our last survey but I'm also looking for a solution 
> in case our survey heading cannot be 0, 90, 180, or 270, but has to be 
> something like 35? (due to bottom currents etc.).
>
> Best regards, any hint qappreciated,
> Gerhard
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201221/3c145302/attachment.html>

From j1 at jimenezshaw.com  Mon Dec 21 07:02:48 2020
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 21 Dec 2020 16:02:48 +0100
Subject: [gdal-dev] Geotransform for non-North-up images?
In-Reply-To: <4078ce15-351f-2195-d0d3-e7fa502c8e05@posteo.de>
References: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
 <CADRrdKtOWe7VCtD9Dvai55EMy91FiPCHZh=EqJOW4EOJDLXCOg@mail.gmail.com>
 <4078ce15-351f-2195-d0d3-e7fa502c8e05@posteo.de>
Message-ID: <CADRrdKu=ufLTFX98H=Y3CZg073GR+o6c+f3x8s5NO_G1roLr4g@mail.gmail.com>

I am not sure, but I guess that you have to negate also GT5: y axis is
reversed between image coordinates and "geographic" coordinates.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
Entre dos pensamientos racionales
hay infinitos pensamientos irracionales.



On Mon, 21 Dec 2020 at 14:57, G Seiffert <hh1 at posteo.de> wrote:

> Thanks Javier. Need to confess: math is not my strong side. I'm more the
> "trial and error" guy. And - shame on me - Google.
>
> Got the rotation AND the scaling correct meanwhile, calculating the params
> as described here:
> https://gis.stackexchange.com/questions/69715/rotating-rasters-using-gdal-geotransform-and-arcgis-desktop?noredirect=1&lq=1
>
> Below a code snippet (I work in Python). However,  with the exact calcs
> from above website, my pics were rotated correctly but for some strange
> reason mirrored vertically! Try and error: Making GT(4) negative got rid of
> the mirroring. So almost happy now, just facing a weird shift of 2m to west
> and 0.7m to south, working on it.
>
> # ROTATION PART Start ================================================
>     rot_deg = 90
>     rotation = np.deg2rad(rot_deg)
>
>     GT0 = orig_x
>     GT1 = math.cos(rotation) * image_resolution
>     GT2 = -math.sin(rotation) * image_resolution
>     GT3 = orig_y
>     GT4 = -math.sin(rotation) * image_resolution
>     GT5 = math.cos(rotation) * image_resolution
>
>     geotrans = (GT0, GT1, GT2, GT3, GT4, GT5)
>
> # ROTATION PART End ================================================
>
> Thanks so far! Also Thomas and Jukka!
> Gerhard
>
> Javier Jimenez Shaw <j1 at jimenezshaw.com>
> 21 December 2020 10:55
> Those transformation parameters can be seen as a 3x3 transformation matrix
> like this
>
> Xg     GT1 GT2 GT0     Xp
> Yg  =  GT4 GT5 GT3  *  Yp
>  1      0   0   1       1
>
> Where [Xp, Yp] is the coordinate in pixels, and [Xg, Yg] is the
> "geographic" coordinate (whatever it means ;)
>
> the 2x2 top left corner of the transformation matrix can be seen as a 2D
> rotation-scaling matrix:
> https://en.wikipedia.org/wiki/Transformation_matrix#Examples_in_2_dimensions
> [GT0, GT3] is the "geographic" coordinate of the pixel [0, 0] (regardless
> rotation or scaling)
>
> Cheers
> .___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
> G Seiffert <hh1 at posteo.de>
> 21 December 2020 10:24
> Hi all from GDLA.
>
> Thanks for the opportunity to as a question. It's regarding the Geotransform
> Tutorial (https://gdal.org/tutorials/geotransforms_tut.html). Tried to
> get info in the web but since this seems a tricky one, my searches failed.
>
> The tutorial only deals with the ideal case of 'North up' images, for
> which GT(2) and GT(4) are zero. However, my images are 'East up' and
> potentially 'any direction up' (underwater photomosaic surveys by ROV). The
> rotation works with '90' for GT(2, 4). But the scaling seems completely
> ignored. Any hint? If it would be easy, I assume your tutorial would give
> an example for how to deal with "non-N-up' images, but ...
>
> My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm per
> pixel, we're flying just 3m above the bottom).
>
> In case I rotate the images prior to geotransform (in Photoshop),
> geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can live
> with that for our last survey but I'm also looking for a solution in case
> our survey heading cannot be 0, 90, 180, or 270, but has to be something
> like 35? (due to bottom currents etc.).
>
> Best regards, any hint qappreciated,
> Gerhard
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201221/fd1ee5c6/attachment-0001.html>

From matteo.ghetta at gmail.com  Mon Dec 21 07:29:51 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Mon, 21 Dec 2020 16:29:51 +0100
Subject: [gdal-dev] ogr2ogr question
Message-ID: <d1cb3436-4adb-f399-9d52-47488c7c5ebc@gmail.com>

Hi all,

I'm really stuck on a ogr2ogr command.

I've a template.gpkg file with some tables and what I'm trying to do is 
to overwrite some of these tables with some already existing views of a 
PG database.

The tables and views have the same structure and geometry, basically I'm 
trying to create a my_data.gpkg with the same tables of the 
template.gpkg file, but overwriting some of these tables with the PG 
view contents.

This is the ogr2ogr command I'm using, but nothing is happening (the 
data.gpkg remains the same of template.gpkg).

ogr2ogr -f GPKG /home/matteo/Desktop/data.gpkg "PG:dbname='mydb' 
host=myhost port=5432 user='myuser' password='xxxxx' sslmode=disable" 
--config PG_USE_COPY YES -sql "SELECT * FROM "_003"."intap" " -overwrite 
-progress

(the intap table should be overwritten with the content filtered by the 
-sql statement: "_003"."intap" is the view of PG).

I search everywhere for a parameter that could solve this problem but I 
didn't find any

Thanks for any help

Cheers

Matteo

From even.rouault at spatialys.com  Mon Dec 21 08:55:11 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 21 Dec 2020 17:55:11 +0100
Subject: [gdal-dev] ogr2ogr question
In-Reply-To: <d1cb3436-4adb-f399-9d52-47488c7c5ebc@gmail.com>
References: <d1cb3436-4adb-f399-9d52-47488c7c5ebc@gmail.com>
Message-ID: <804312843.diVFP4x8ZZ@even-i700>

Matteo,

> I'm really stuck on a ogr2ogr command.
> 
> I've a template.gpkg file with some tables and what I'm trying to do is
> to overwrite some of these tables with some already existing views of a
> PG database.
> 
> The tables and views have the same structure and geometry, basically I'm
> trying to create a my_data.gpkg with the same tables of the
> template.gpkg file, but overwriting some of these tables with the PG
> view contents.
> 
> This is the ogr2ogr command I'm using, but nothing is happening (the
> data.gpkg remains the same of template.gpkg).
> 
> ogr2ogr -f GPKG /home/matteo/Desktop/data.gpkg "PG:dbname='mydb'
> host=myhost port=5432 user='myuser' password='xxxxx' sslmode=disable"
> --config PG_USE_COPY YES -sql "SELECT * FROM "_003"."intap" " -overwrite
> -progress
> 
> (the intap table should be overwritten with the content filtered by the
> -sql statement: "_003"."intap" is the view of PG).
> 
> I search everywhere for a parameter that could solve this problem but I
> didn't find any

If you look at the output of
ogrinfo PG:..... -sql "select ...."
you'll see that the resulting layer is called "sql_statement", so your ogr2ogr 
invokation will overwrite/create a sql_statement table in your GPKG. You want 
to add -nln intap to rename this SQL result layer.
And -overwrite deletes and recreates the table from scratch, so if you've 
customized your template with CHECKs, FOREIGN KEYs etc, they will be lost. If 
the target table in the template is empty, you can just use -append instead of 
-overwrite.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From hh1 at posteo.de  Mon Dec 21 09:23:17 2020
From: hh1 at posteo.de (G Seiffert)
Date: Mon, 21 Dec 2020 16:23:17 -0100
Subject: [gdal-dev] Geotransform for non-North-up images?
In-Reply-To: <CADRrdKu=ufLTFX98H=Y3CZg073GR+o6c+f3x8s5NO_G1roLr4g@mail.gmail.com>
References: <1c998c51-1fa0-ed0d-009f-c3e428ca9892@posteo.de>
 <CADRrdKtOWe7VCtD9Dvai55EMy91FiPCHZh=EqJOW4EOJDLXCOg@mail.gmail.com>
 <4078ce15-351f-2195-d0d3-e7fa502c8e05@posteo.de>
 <CADRrdKu=ufLTFX98H=Y3CZg073GR+o6c+f3x8s5NO_G1roLr4g@mail.gmail.com>
Message-ID: <50dc86cd-214c-4661-7ba2-abfed79d2d1b@posteo.de>

Thanks Javier, but as it looks the way I did works great. Got rid of the 
XY shift as well. Rotation affects the calculations for the origin as 
well, of course, this is what I needed to correct. In case of 0 vs 90 
deg rotation the fix was simple. Will now work on trig formulas that 
work with any rotation angle.

G


> Javier Jimenez Shaw <mailto:j1 at jimenezshaw.com>
> 21 December 2020 14:02
> I am not sure, but I guess that you have to negate also GT5: y axis is 
> reversed between image coordinates and "geographic" coordinates.
> .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
> G Seiffert <mailto:hh1 at posteo.de>
> 21 December 2020 12:57
> Thanks Javier. Need to confess: math is not my strong side. I'm more 
> the "trial and error" guy. And - shame on me - Google.
>
> Got the rotation AND the scaling correct meanwhile, calculating the 
> params as described here: 
> https://gis.stackexchange.com/questions/69715/rotating-rasters-using-gdal-geotransform-and-arcgis-desktop?noredirect=1&lq=1
>
> Below a code snippet (I work in Python). However,? with the exact 
> calcs from above website, my pics were rotated correctly but for some 
> strange reason mirrored vertically! Try and error: Making GT(4) 
> negative got rid of the mirroring. So almost happy now, just facing a 
> weird shift of 2m to west and 0.7m to south, working on it.
>
> # ROTATION PART Start ================================================
> ??? rot_deg = 90
> ??? rotation = np.deg2rad(rot_deg)
>
> ??? GT0 = orig_x
> ??? GT1 = math.cos(rotation) * image_resolution
> ??? GT2 = -math.sin(rotation) * image_resolution
> ??? GT3 = orig_y
> ??? GT4 = -math.sin(rotation) * image_resolution
> ??? GT5 = math.cos(rotation) * image_resolution
>
> ??? geotrans = (GT0, GT1, GT2, GT3, GT4, GT5)
>
> # ROTATION PART End ================================================
>
> Thanks so far! Also Thomas and Jukka!
> Gerhard
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> Javier Jimenez Shaw <mailto:j1 at jimenezshaw.com>
> 21 December 2020 10:55
> Those transformation parameters can be seen as a 3x3 transformation 
> matrix like this
>
> Xg ? ? GT1 GT2 GT0 ??? Xp
> Yg? =? GT4 GT5 GT3? *? Yp
> ?1 ? ?? 0?? 0?? 1? ? ?? 1
>
> Where [Xp, Yp] is the coordinate in pixels, and [Xg, Yg] is the 
> "geographic" coordinate (whatever it means ;)
>
> the 2x2 top left corner of the transformation matrix can be seen as a 
> 2D rotation-scaling matrix: 
> https://en.wikipedia.org/wiki/Transformation_matrix#Examples_in_2_dimensions
> [GT0, GT3]is the "geographic" coordinate of the pixel [0, 
> 0](regardless rotation or scaling)
>
> Cheers
> .___ ._ ..._ .. . ._.? .___ .. __ . _. . __..? ... .... ._ .__
> Entre dos pensamientos racionales
> hay infinitos pensamientos irracionales.
>
>
>
> G Seiffert <mailto:hh1 at posteo.de>
> 21 December 2020 10:24
> Hi all from GDLA.
>
> Thanks for the opportunity to as a question. It's regarding the 
> Geotransform 
> Tutorial(https://gdal.org/tutorials/geotransforms_tut.html). Tried to 
> get info in the web but since this seems a tricky one, my searches failed.
>
> The tutorial only deals with the ideal case of 'North up' images, for 
> which GT(2) and GT(4) are zero. However, my images are 'East up' and 
> potentially 'any direction up' (underwater photomosaic surveys by 
> ROV). The rotation works with '90' for GT(2, 4). But the scaling seems 
> completely ignored. Any hint? If it would be easy, I assume your 
> tutorial would give an example for how to deal with "non-N-up' images, 
> but ...
>
> My pics are 1920x1080, with pixel resolution of 0.0015 (yes, 0.15cm 
> per pixel, we're flying just 3m above the bottom).
>
> In case I rotate the images prior to geotransform (in Photoshop), 
> geotransform works perfect, with GT(2, 4) = 0. Scaling spot on. I can 
> live with that for our last survey but I'm also looking for a solution 
> in case our survey heading cannot be 0, 90, 180, or 270, but has to be 
> something like 35? (due to bottom currents etc.).
>
> Best regards, any hint qappreciated,
> Gerhard
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201221/c1534e0e/attachment.html>

From matteo.ghetta at gmail.com  Mon Dec 21 22:55:38 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 22 Dec 2020 07:55:38 +0100
Subject: [gdal-dev] ogr2ogr question
In-Reply-To: <804312843.diVFP4x8ZZ@even-i700>
References: <d1cb3436-4adb-f399-9d52-47488c7c5ebc@gmail.com>
 <804312843.diVFP4x8ZZ@even-i700>
Message-ID: <3b417a3e-d814-3831-f9db-16f3a7464dd1@gmail.com>

Hi Even,

> If you look at the output of
> ogrinfo PG:..... -sql "select ...."
> you'll see that the resulting layer is called "sql_statement", so your ogr2ogr
> invokation will overwrite/create a sql_statement table in your GPKG. You want
> to add -nln intap to rename this SQL result layer.
> And -overwrite deletes and recreates the table from scratch, so if you've
> customized your template with CHECKs, FOREIGN KEYs etc, they will be lost. If
> the target table in the template is empty, you can just use -append instead of
> -overwrite.

go it, thanks! I was sure that if the table names are the same in both 
input and output, than ogr2ogr was overwriting the output automatically.

Just for information: -overwrite is doing a "truncate table" before 
adding the new features? Is this the reason that FK, CHECKS and other 
customization will be lost?

Cheers and thanks

Matteo

From jukka.rahkonen at maanmittauslaitos.fi  Mon Dec 21 23:36:25 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 22 Dec 2020 00:36:25 -0700 (MST)
Subject: [gdal-dev] ogr2ogr question
In-Reply-To: <3b417a3e-d814-3831-f9db-16f3a7464dd1@gmail.com>
References: <d1cb3436-4adb-f399-9d52-47488c7c5ebc@gmail.com>
 <804312843.diVFP4x8ZZ@even-i700>
 <3b417a3e-d814-3831-f9db-16f3a7464dd1@gmail.com>
Message-ID: <1608622585377-0.post@n6.nabble.com>

Hi,

No, -overwrite does not truncate but it drops the table. However, with the
PostgreSQL driver it is also possible to truncate the table by using this
documented method  https://gdal.org/drivers/vector/pg.html#vector-pg. Check
the configuration options

"OGR_TRUNCATE: If set to ?YES?, the content of the table will be first
erased with the SQL TRUNCATE command before inserting the first feature.
This is an alternative to using the -overwrite flag of ogr2ogr, that avoids
views based on the table to be destroyed. Typical use case: ?ogr2ogr -append
PG:dbname=foo abc.shp ?config OGR_TRUNCATE YES?."

-Jukka Rahkonen-


ghtmtt wrote
> 
> Just for information: -overwrite is doing a "truncate table" before 
> adding the new features? Is this the reason that FK, CHECKS and other 
> customization will be lost?
> 
> Cheers and thanks
> 
> Matteo





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From matteo.ghetta at gmail.com  Tue Dec 22 01:34:11 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 22 Dec 2020 10:34:11 +0100
Subject: [gdal-dev] ogr2ogr question
In-Reply-To: <1608622585377-0.post@n6.nabble.com>
References: <d1cb3436-4adb-f399-9d52-47488c7c5ebc@gmail.com>
 <804312843.diVFP4x8ZZ@even-i700>
 <3b417a3e-d814-3831-f9db-16f3a7464dd1@gmail.com>
 <1608622585377-0.post@n6.nabble.com>
Message-ID: <8279cc70-439d-484f-f175-ec30b971996e@gmail.com>

Hi Jukka,

thanks for the clarifications.

On 12/22/20 8:36 AM, jratike80 wrote:

> No, -overwrite does not truncate but it drops the table. However, with the
> PostgreSQL driver it is also possible to truncate the table by using this
> documented method  https://gdal.org/drivers/vector/pg.html#vector-pg. Check
> the configuration options
> 
> "OGR_TRUNCATE: If set to ?YES?, the content of the table will be first
> erased with the SQL TRUNCATE command before inserting the first feature.
> This is an alternative to using the -overwrite flag of ogr2ogr, that avoids
> views based on the table to be destroyed. Typical use case: ?ogr2ogr -append
> PG:dbname=foo abc.shp ?config OGR_TRUNCATE YES?."

from what I read, OGR_TRUNCATE YES is a driver option of PG and not of 
GPKG. Will it eventually work if the export (as it is in my case) is 
made from PG to GPKG? The tables in the GPGK will be truncated?

Cheers and thanks

Matteo

From philippe.ghesquiere at airbus.com  Tue Dec 22 02:11:23 2020
From: philippe.ghesquiere at airbus.com (Bugbuster)
Date: Tue, 22 Dec 2020 03:11:23 -0700 (MST)
Subject: [gdal-dev] Visual C++ 2015: compiling error with GDAL 3.2
Message-ID: <1608631883241-0.post@n6.nabble.com>

My environnement is :
* Windows 10
* Visual C++ 2015 64 bits

When compiling GDAL 3.2, I get an error in gcore/tilematrixset.hpp
tilematrixset.hpp(47): error C2131: expression did not evaluate to a
constant
failure was caused by non-constant arguments or reference to a non-constant
symbol
note: see usage of 'std::numeric_limits<double>::quiet_NaN()'

The code line which gives the error is :
static constexpr double NaN = std::numeric_limits<double>::quiet_NaN();

I tried to replace it with "static const", "const" and other variants : no
success.
I know it is not easy to initialize a static constant attribute in a header
file, but I do not remember all the subtilities :-(

All other uses of std::numeric_limits<double>::quiet_NaN() in the code are
OK.
Do you have any ideas?





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From mateusz at loskot.net  Tue Dec 22 02:33:30 2020
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 22 Dec 2020 11:33:30 +0100
Subject: [gdal-dev] Visual C++ 2015: compiling error with GDAL 3.2
In-Reply-To: <1608631883241-0.post@n6.nabble.com>
References: <1608631883241-0.post@n6.nabble.com>
Message-ID: <CABUeae8+k-qgwfMEfnJWYntTWa1OqiFNqm3c8VRcPf67h-rfLA@mail.gmail.com>

On Tue, 22 Dec 2020 at 11:11, Bugbuster <philippe.ghesquiere at airbus.com> wrote:
>
> When compiling GDAL 3.2, I get an error in gcore/tilematrixset.hpp
> tilematrixset.hpp(47): error C2131: expression did not evaluate to a
> constant
> failure was caused by non-constant arguments or reference to a non-constant
> symbol
> note: see usage of 'std::numeric_limits<double>::quiet_NaN()'

VS 2015 should swallow that fine
https://rextester.com/LQPF72765

but, AFAIR, you need the latest update of the VS 2015
in order to get more complete C++11 support.

Best regards.
-- 
Mateusz Loskot, http://mateusz.loskot.net

From matteo.ghetta at gmail.com  Tue Dec 22 03:22:00 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 22 Dec 2020 12:22:00 +0100
Subject: [gdal-dev] Exporting triggers/constraints from PG to GPKG
Message-ID: <22b98891-d372-1ea7-addc-29d2e5973625@gmail.com>

Hi all (and sorry for the flood of these days),

the question is very simple: if I have triggers and/or constraint in a 
PG database, is ogr2ogr exporting them to the GPKG?

At a first view it seems not (I looked in the exported GPKG and I cannot 
find the triggers and constraints). I also couldn't find any option in 
the documentation.

Cheers and thanks!

Matteo

From philippe.ghesquiere at airbus.com  Tue Dec 22 03:47:39 2020
From: philippe.ghesquiere at airbus.com (Bugbuster)
Date: Tue, 22 Dec 2020 04:47:39 -0700 (MST)
Subject: [gdal-dev] Visual C++ 2015: compiling error with GDAL 3.2
In-Reply-To: <CABUeae8+k-qgwfMEfnJWYntTWa1OqiFNqm3c8VRcPf67h-rfLA@mail.gmail.com>
References: <1608631883241-0.post@n6.nabble.com>
 <CABUeae8+k-qgwfMEfnJWYntTWa1OqiFNqm3c8VRcPf67h-rfLA@mail.gmail.com>
Message-ID: <1608637659275-0.post@n6.nabble.com>

You may be right about the update of VS2015.
My version is 19.00.23026 (to be compared to yours : 19.00.23506)

An I do have the error with the small test you sent.

Do you have any idea declare/initialize the NaN attribute in another way ?

I do not any easy way to update my compiler :-(





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec 22 03:54:50 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 22 Dec 2020 04:54:50 -0700 (MST)
Subject: [gdal-dev] Exporting triggers/constraints from PG to GPKG
In-Reply-To: <22b98891-d372-1ea7-addc-29d2e5973625@gmail.com>
References: <22b98891-d372-1ea7-addc-29d2e5973625@gmail.com>
Message-ID: <1608638090412-0.post@n6.nabble.com>

Hi,

You are right, ogr2ogr converts just the data from the table/view/query and
metadata that defines the coordinate system.  I believe it would be very
hard to handle the creation of triggers and constraints and insert data in
the right order into SQLite, Oracle, MSSQL etc.

-Jukka Rahkonen-


ghtmtt wrote
> Hi all (and sorry for the flood of these days),
> 
> the question is very simple: if I have triggers and/or constraint in a 
> PG database, is ogr2ogr exporting them to the GPKG?
> 
> At a first view it seems not (I looked in the exported GPKG and I cannot 
> find the triggers and constraints). I also couldn't find any option in 
> the documentation.
> 
> Cheers and thanks!
> 
> Matteo
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From matteo.ghetta at gmail.com  Tue Dec 22 05:40:50 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 22 Dec 2020 14:40:50 +0100
Subject: [gdal-dev] Exporting triggers/constraints from PG to GPKG
In-Reply-To: <1608638090412-0.post@n6.nabble.com>
References: <22b98891-d372-1ea7-addc-29d2e5973625@gmail.com>
 <1608638090412-0.post@n6.nabble.com>
Message-ID: <260c730f-fb37-865c-64e2-02d0beda9a62@gmail.com>

Hi,

> You are right, ogr2ogr converts just the data from the table/view/query and
> metadata that defines the coordinate system.  I believe it would be very
> hard to handle the creation of triggers and constraints and insert data in
> the right order into SQLite, Oracle, MSSQL etc.

it's perfectly understandable given the different dialects of each provider.

Thanks

Matteo

From Jon.Morris at jbarisk.com  Tue Dec 22 06:06:25 2020
From: Jon.Morris at jbarisk.com (Jon Morris)
Date: Tue, 22 Dec 2020 14:06:25 +0000
Subject: [gdal-dev] Duplicate pixels in VRT
Message-ID: <LO2P123MB4077EE826519864F2028D19A82DF0@LO2P123MB4077.GBRP123.PROD.OUTLOOK.COM>

Hello all,

I've come across a weird edge case and I'm wondering if anyone has seen something similar.

I'm updating our application from GDAL v2.2 to v3.2 and have a failing test where there is a 1 pixel shift in the output. We're building a VRT from a DTM and a flood depth raster and when you call ds.ReadAsArray() on the VRT there is a duplicated column of pixels at GDAL 2, which is causing the apparent shift. It's not worth raising a ticket, as the GDAL 3 output is correct, but I can't explain why this shift has happened and I'm wondering if this has happened anywhere else.

If I open the two VRTs in QGIS, they look the same, so maybe it's an issue with ReadAsArray. There is slight difference in SRS precision, which might be causing a rounding error, but otherwise I've no idea what might be causing it.

GDAL 2
<SRS>
PROJCS["North_America_Albers_Equal_Area_Conic",
GEOGCS["NAD83",DATUM["North_American_Datum_1983",
SPHEROID["GRS 1980",6378137,298.2572221010042,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],
PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433],AUTHORITY["EPSG","4269"]],
PROJECTION["Albers_Conic_Equal_Area"],
PARAMETER["standard_parallel_1",20],
PARAMETER["standard_parallel_2",60],
PARAMETER["latitude_of_center",40],
PARAMETER["longitude_of_center",-96],
PARAMETER["false_easting",0],
PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]]]
</SRS>

GDAL 3
<SRS dataAxisToSRSAxisMapping="1,2">
PROJCS["North_America_Albers_Equal_Area_Conic",
GEOGCS["NAD83",DATUM["North_American_Datum_1983",
SPHEROID["GRS 1980",6378137,298.257222101004,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],
PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],
PROJECTION["Albers_Conic_Equal_Area"],
PARAMETER["latitude_of_center",40],
PARAMETER["longitude_of_center",-96],
PARAMETER["standard_parallel_1",20],
PARAMETER["standard_parallel_2",60],
PARAMETER["false_easting",0],
PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]
</SRS>

Thanks,

Jon


Jon Morris
Software Developer

COVID-19. During the current outbreak JBA remains open for business and we continue to deliver our services. However, we have adopted flexible/remote working as required. I will be receiving and reading email as normal but I may not always be available on the office number.


[JBA COVID-19 statement]<https://www.jbagroup.co.uk/sites/www.jbagroup.co.uk/files/documents/15-030%20JBA%20Business%20Continuity%20Briefing%20-%20Latest.pdf>

T +44 (0) 1756 799919
www.jbarisk.com<http://www.jbarisk.com>

[Visit our website]<http://www.jbarisk.com> [http://www.jbagroup.co.uk/imgstore/JBA-Email-Sig-Icons-LINKEDIN.png] <https://www.linkedin.com/in/jon-morris-a2897b4/>  [Follow us on Twitter] <https://twitter.com/jbarisk>

Find out more about us here: www.jbarisk.com<http://www.jbarisk.com/> and follow us on Twitter @JBARisk<http://twitter.com/JBARisk> and LinkedIn<https://www.linkedin.com/company/2370847?trk=tyah&trkInfo=clickedVertical%3Acompany%2CclickedEntityId%3A2370847%2Cidx%3A2-1-2%2CtarId%3A1447414259786%2Ctas%3AJBA%20RISK%20MANAGEMENT>

The JBA Group supports the JBA Trust.

All JBA Risk Management's email messages contain confidential information and are intended only for the individual(s) named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail.
Please notify the sender immediately by email if you have received this email by mistake and delete this email from your system.


JBA Risk Management Limited is registered in England, company number 07732946, 1 Broughton Park, Old Lane North, Broughton, Skipton, North Yorkshire, BD23 3FD, Telephone: +441756799919


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201222/d3874537/attachment-0001.html>

From mateusz at loskot.net  Tue Dec 22 06:35:16 2020
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 22 Dec 2020 15:35:16 +0100
Subject: [gdal-dev] Visual C++ 2015: compiling error with GDAL 3.2
In-Reply-To: <1608637659275-0.post@n6.nabble.com>
References: <1608631883241-0.post@n6.nabble.com>
 <CABUeae8+k-qgwfMEfnJWYntTWa1OqiFNqm3c8VRcPf67h-rfLA@mail.gmail.com>
 <1608637659275-0.post@n6.nabble.com>
Message-ID: <CABUeae9PJ7Q_KPgv2yda-N8-SP9N7UdycdeBggSx7tZDv9vipQ@mail.gmail.com>

On Tue, 22 Dec 2020 at 12:47, Bugbuster <philippe.ghesquiere at airbus.com> wrote:
>
> You may be right about the update of VS2015.
> My version is 19.00.23026 (to be compared to yours : 19.00.23506)
>
> An I do have the error with the small test you sent.
>
> Do you have any idea declare/initialize the NaN attribute in another way ?

https://duckduckgo.com/?q=static+const+double+member+c%2B%2B03
e.g. https://stackoverflow.com/a/50764180/151641

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net

From philippe.ghesquiere at airbus.com  Tue Dec 22 09:26:45 2020
From: philippe.ghesquiere at airbus.com (Bugbuster)
Date: Tue, 22 Dec 2020 10:26:45 -0700 (MST)
Subject: [gdal-dev] Visual C++ 2015: compiling error with GDAL 3.2
In-Reply-To: <CABUeae9PJ7Q_KPgv2yda-N8-SP9N7UdycdeBggSx7tZDv9vipQ@mail.gmail.com>
References: <1608631883241-0.post@n6.nabble.com>
 <CABUeae8+k-qgwfMEfnJWYntTWa1OqiFNqm3c8VRcPf67h-rfLA@mail.gmail.com>
 <1608637659275-0.post@n6.nabble.com>
 <CABUeae9PJ7Q_KPgv2yda-N8-SP9N7UdycdeBggSx7tZDv9vipQ@mail.gmail.com>
Message-ID: <1608658005395-0.post@n6.nabble.com>

This works perfectly. Thanks
It is just an ugly patch before I can witch to a more modern compiler



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec 22 11:47:04 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 22 Dec 2020 12:47:04 -0700 (MST)
Subject: [gdal-dev] Duplicate pixels in VRT
In-Reply-To: <LO2P123MB4077EE826519864F2028D19A82DF0@LO2P123MB4077.GBRP123.PROD.OUTLOOK.COM>
References: <LO2P123MB4077EE826519864F2028D19A82DF0@LO2P123MB4077.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <1608666424915-0.post@n6.nabble.com>

Hi,

Check what are the extents of two adjacert images reported by GDAL 2 and 3,
as well as the sizes in pixels, and if images are of type "pixel is area" or
"pixel is point". DEM kind of images are sometimes intentionally produced to
have overlap.

-Jukka Rahkonen-



Jon Morris wrote
> Hello all,
> 
> I've come across a weird edge case and I'm wondering if anyone has seen
> something similar.
> 
> I'm updating our application from GDAL v2.2 to v3.2 and have a failing
> test where there is a 1 pixel shift in the output. We're building a VRT
> from a DTM and a flood depth raster and when you call ds.ReadAsArray() on
> the VRT there is a duplicated column of pixels at GDAL 2, which is causing
> the apparent shift. It's not worth raising a ticket, as the GDAL 3 output
> is correct, but I can't explain why this shift has happened and I'm
> wondering if this has happened anywhere else.
> 
> If I open the two VRTs in QGIS, they look the same, so maybe it's an issue
> with ReadAsArray. There is slight difference in SRS precision, which might
> be causing a rounding error, but otherwise I've no idea what might be
> causing it.
> 
> GDAL 2
> <SRS>
> PROJCS["North_America_Albers_Equal_Area_Conic",
> GEOGCS["NAD83",DATUM["North_American_Datum_1983",
> SPHEROID["GRS
> 1980",6378137,298.2572221010042,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],
> PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433],AUTHORITY["EPSG","4269"]],
> PROJECTION["Albers_Conic_Equal_Area"],
> PARAMETER["standard_parallel_1",20],
> PARAMETER["standard_parallel_2",60],
> PARAMETER["latitude_of_center",40],
> PARAMETER["longitude_of_center",-96],
> PARAMETER["false_easting",0],
> PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]]]
> </SRS>
> GDAL 3
> <SRS dataAxisToSRSAxisMapping="1,2">
> PROJCS["North_America_Albers_Equal_Area_Conic",
> GEOGCS["NAD83",DATUM["North_American_Datum_1983",
> SPHEROID["GRS
> 1980",6378137,298.257222101004,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],
> PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],
> PROJECTION["Albers_Conic_Equal_Area"],
> PARAMETER["latitude_of_center",40],
> PARAMETER["longitude_of_center",-96],
> PARAMETER["standard_parallel_1",20],
> PARAMETER["standard_parallel_2",60],
> PARAMETER["false_easting",0],
> PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]
> </SRS>
> Thanks,
> 
> Jon
> 
> 
> Jon Morris
> Software Developer
> 
> COVID-19. During the current outbreak JBA remains open for business and we
> continue to deliver our services. However, we have adopted flexible/remote
> working as required. I will be receiving and reading email as normal but I
> may not always be available on the office number.
> 
> 
> [JBA COVID-19
> statement]&lt;https://www.jbagroup.co.uk/sites/www.jbagroup.co.uk/files/documents/15-030%20JBA%20Business%20Continuity%20Briefing%20-%20Latest.pdf&gt;
> 
> T +44 (0) 1756 799919
> www.jbarisk.com&lt;http://www.jbarisk.com&gt;
> 
> [Visit our website]&lt;http://www.jbarisk.com&gt;
> [http://www.jbagroup.co.uk/imgstore/JBA-Email-Sig-Icons-LINKEDIN.png]
> &lt;https://www.linkedin.com/in/jon-morris-a2897b4/&gt;  [Follow us on
> Twitter] &lt;https://twitter.com/jbarisk&gt;
> 
> Find out more about us here:
> www.jbarisk.com&lt;http://www.jbarisk.com/&gt; and follow us on Twitter
> @JBARisk&lt;http://twitter.com/JBARisk&gt; and
> LinkedIn&lt;https://www.linkedin.com/company/2370847?trk=tyah&amp;trkInfo=clickedVertical%3Acompany%2CclickedEntityId%3A2370847%2Cidx%3A2-1-2%2CtarId%3A1447414259786%2Ctas%3AJBA%20RISK%20MANAGEMENT&gt;
> 
> The JBA Group supports the JBA Trust.
> 
> All JBA Risk Management's email messages contain confidential information
> and are intended only for the individual(s) named. If you are not the
> named addressee you should not disseminate, distribute or copy this
> e-mail.
> Please notify the sender immediately by email if you have received this
> email by mistake and delete this email from your system.
> 
> 
> JBA Risk Management Limited is registered in England, company number
> 07732946, 1 Broughton Park, Old Lane North, Broughton, Skipton, North
> Yorkshire, BD23 3FD, Telephone: +441756799919
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From idan at miara.com  Tue Dec 22 13:42:15 2020
From: idan at miara.com (Idan Miara)
Date: Tue, 22 Dec 2020 23:42:15 +0200
Subject: [gdal-dev] Call for discussion on RFC 78: gdal-utils package
Message-ID: <CAEDrt38wQFXC9p=Ttb4ATpmHrthX+vFga-GjpCUGZZJYV-Bhdg@mail.gmail.com>

Hi All,

I would like to call for discussion on RFC 78: gdal-utils package
<https://github.com/talos-gis/gdal/blob/Branch_rfc78_py_modules/gdal/doc/source/development/rfc/rfc78_gdal_utils_package.rst>
Please give your feedback on this PR.
<https://github.com/OSGeo/gdal/pull/3260>
Summary

This RFC suggests to export `osgeo.utils`, `osgeo.auxiliary` (which were
introduced in GDAL 3.2)
outside of the `osgeo` package (which includes the GDAL core bindings),
into a new pure-Python package `osgeo_utils`,
along with any other Python scripts/samples that can be reused.
It shall be distributed in a new `gdal-utils` wheel in `pypi` for smooth
upgrading via `pip install --upgrade gdal-utils`.

For maximum backwards compatibility, The `gdal` distribution wheel would
still include both packages: `osgeo` and `osgeo_utils`.

This RFC does NOT suggest exporting any code into a different repo or
impact any non-Python code.

Kind regards,
Idan Miara
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201222/75b27736/attachment.html>

From mochi.silva at gmail.com  Tue Dec 22 16:54:44 2020
From: mochi.silva at gmail.com (Moises Silva)
Date: Tue, 22 Dec 2020 21:54:44 -0300
Subject: [gdal-dev] Doubts to Convert TopoJson to SHP File
Message-ID: <CAETVUGhFOUy3AvdqP=2ar855k0E0ypV5juKSuEoYHXUMHd4F8g@mail.gmail.com>

Hi,

   I am newbie to use the GDAL and passing the problem in convert TopoJSON
to SHP FIle.
   I executed the command below and some files were created (.dbf, .shp,
.shx) but the file .prj is not created.
    Is there any parameters that I need to pass to create this .prj file?
          ogr2ogr -f "ESRI Shapefile"  countries110m  countries110m.json

Thanks,
Mochi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201222/e530ee5a/attachment.html>

From Jon.Morris at jbarisk.com  Wed Dec 23 00:52:25 2020
From: Jon.Morris at jbarisk.com (Jon Morris)
Date: Wed, 23 Dec 2020 08:52:25 +0000
Subject: [gdal-dev] Duplicate pixels in VRT
In-Reply-To: <1608666424915-0.post@n6.nabble.com>
References: <LO2P123MB4077EE826519864F2028D19A82DF0@LO2P123MB4077.GBRP123.PROD.OUTLOOK.COM>,
 <1608666424915-0.post@n6.nabble.com>
Message-ID: <LO2P123MB407775CBF49A039A8B30532782DE0@LO2P123MB4077.GBRP123.PROD.OUTLOOK.COM>

Hi Jukka,

I'm off work now so can't check the image type until next week, but the extents are the same at both GDAL 2 and GDAL 3. At v3, there is a repeated column of pixels at the right hand edge. I guess there is no more data, so it is padded to fill the required extent.

Jon

Get Outlook for Android<https://aka.ms/ghei36>

________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of jratike80 <jukka.rahkonen at maanmittauslaitos.fi>
Sent: Tuesday, December 22, 2020 7:47:04 PM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Duplicate pixels in VRT

Hi,

Check what are the extents of two adjacert images reported by GDAL 2 and 3,
as well as the sizes in pixels, and if images are of type "pixel is area" or
"pixel is point". DEM kind of images are sometimes intentionally produced to
have overlap.

-Jukka Rahkonen-



Jon Morris wrote
> Hello all,
>
> I've come across a weird edge case and I'm wondering if anyone has seen
> something similar.
>
> I'm updating our application from GDAL v2.2 to v3.2 and have a failing
> test where there is a 1 pixel shift in the output. We're building a VRT
> from a DTM and a flood depth raster and when you call ds.ReadAsArray() on
> the VRT there is a duplicated column of pixels at GDAL 2, which is causing
> the apparent shift. It's not worth raising a ticket, as the GDAL 3 output
> is correct, but I can't explain why this shift has happened and I'm
> wondering if this has happened anywhere else.
>
> If I open the two VRTs in QGIS, they look the same, so maybe it's an issue
> with ReadAsArray. There is slight difference in SRS precision, which might
> be causing a rounding error, but otherwise I've no idea what might be
> causing it.
>
> GDAL 2
> <SRS>
> PROJCS["North_America_Albers_Equal_Area_Conic",
> GEOGCS["NAD83",DATUM["North_American_Datum_1983",
> SPHEROID["GRS
> 1980",6378137,298.2572221010042,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],
> PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433],AUTHORITY["EPSG","4269"]],
> PROJECTION["Albers_Conic_Equal_Area"],
> PARAMETER["standard_parallel_1",20],
> PARAMETER["standard_parallel_2",60],
> PARAMETER["latitude_of_center",40],
> PARAMETER["longitude_of_center",-96],
> PARAMETER["false_easting",0],
> PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]]]
> </SRS>
> GDAL 3
> <SRS dataAxisToSRSAxisMapping="1,2">
> PROJCS["North_America_Albers_Equal_Area_Conic",
> GEOGCS["NAD83",DATUM["North_American_Datum_1983",
> SPHEROID["GRS
> 1980",6378137,298.257222101004,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],
> PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],
> PROJECTION["Albers_Conic_Equal_Area"],
> PARAMETER["latitude_of_center",40],
> PARAMETER["longitude_of_center",-96],
> PARAMETER["standard_parallel_1",20],
> PARAMETER["standard_parallel_2",60],
> PARAMETER["false_easting",0],
> PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]
> </SRS>
> Thanks,
>
> Jon
>
>
> Jon Morris
> Software Developer
>
> COVID-19. During the current outbreak JBA remains open for business and we
> continue to deliver our services. However, we have adopted flexible/remote
> working as required. I will be receiving and reading email as normal but I
> may not always be available on the office number.
>
>
> [JBA COVID-19
> statement]&lt;https://www.jbagroup.co.uk/sites/www.jbagroup.co.uk/files/documents/15-030%20JBA%20Business%20Continuity%20Briefing%20-%20Latest.pdf&gt;
>
> T +44 (0) 1756 799919
> www.jbarisk.com&lt;http://www.jbarisk.com&gt<http://www.jbarisk.com&lt;http://www.jbarisk.com&gt>;
>
> [Visit our website]&lt;http://www.jbarisk.com&gt;
> [http://www.jbagroup.co.uk/imgstore/JBA-Email-Sig-Icons-LINKEDIN.png]
> &lt;https://www.linkedin.com/in/jon-morris-a2897b4/&gt;  [Follow us on
> Twitter] &lt;https://twitter.com/jbarisk&gt;
>
> Find out more about us here:
> www.jbarisk.com&lt;http://www.jbarisk.com/&gt<http://www.jbarisk.com&lt;http://www.jbarisk.com/&gt>; and follow us on Twitter
> @JBARisk&lt;http://twitter.com/JBARisk&gt; and
> LinkedIn&lt;https://www.linkedin.com/company/2370847?trk=tyah&amp;trkInfo=clickedVertical%3Acompany%2CclickedEntityId%3A2370847%2Cidx%3A2-1-2%2CtarId%3A1447414259786%2Ctas%3AJBA%20RISK%20MANAGEMENT&gt;
>
> The JBA Group supports the JBA Trust.
>
> All JBA Risk Management's email messages contain confidential information
> and are intended only for the individual(s) named. If you are not the
> named addressee you should not disseminate, distribute or copy this
> e-mail.
> Please notify the sender immediately by email if you have received this
> email by mistake and delete this email from your system.
>
>
> JBA Risk Management Limited is registered in England, company number
> 07732946, 1 Broughton Park, Old Lane North, Broughton, Skipton, North
> Yorkshire, BD23 3FD, Telephone: +441756799919
>
>
>
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

[JBA COVID-19 statement]<https://www.jbagroup.co.uk/sites/www.jbagroup.co.uk/files/documents/15-030%20JBA%20Business%20Continuity%20Briefing%20-%20Latest.pdf>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201223/0d5df703/attachment-0001.html>

From matteo.ghetta at gmail.com  Wed Dec 23 07:00:28 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Wed, 23 Dec 2020 16:00:28 +0100
Subject: [gdal-dev] Export multiple tables from GPKG to PG
Message-ID: <c38c92ca-64c3-80e9-9907-a0e773732fc9@gmail.com>

Hi all (again, sorry for the flooding),

for some reasons I have to export many tables (not all) from a GPKG to a 
PG database.

I can do it easily with a loop, but I need ogr2ogr to do it in a single 
transaction. That's because even if the first N tables are correctly 
imported, at the first error I need a total rollback without importing 
anything in PG.

The "problem" is that I have to specify some parameter in ogr2ogr (e.g. 
-nln) for each table to import.

I hope I made myself clear

Cheers and thanks

Matteo

From jukka.rahkonen at maanmittauslaitos.fi  Wed Dec 23 07:31:51 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 23 Dec 2020 08:31:51 -0700 (MST)
Subject: [gdal-dev] Doubts to Convert TopoJson to SHP File
In-Reply-To: <CAETVUGhFOUy3AvdqP=2ar855k0E0ypV5juKSuEoYHXUMHd4F8g@mail.gmail.com>
References: <CAETVUGhFOUy3AvdqP=2ar855k0E0ypV5juKSuEoYHXUMHd4F8g@mail.gmail.com>
Message-ID: <1608737511586-0.post@n6.nabble.com>

Hi,

Do you know in which coordinate system the topojson data are? If GDAL can't
recognize it automatically (check with ogrinfo) you can give it manually,
for example " -a_srs EPSG:4326". That should trigger the creation of the
.prj file.

-Jukka Rahkonen-


Moises Silva wrote
> Hi,
> 
>    I am newbie to use the GDAL and passing the problem in convert TopoJSON
> to SHP FIle.
>    I executed the command below and some files were created (.dbf, .shp,
> .shx) but the file .prj is not created.
>     Is there any parameters that I need to pass to create this .prj file?
>           ogr2ogr -f "ESRI Shapefile"  countries110m  countries110m.json
> 
> Thanks,
> Mochi
> 
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Wed Dec 23 08:49:16 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 23 Dec 2020 17:49:16 +0100
Subject: [gdal-dev] Doubts to Convert TopoJson to SHP File
In-Reply-To: <CAETVUGhFOUy3AvdqP=2ar855k0E0ypV5juKSuEoYHXUMHd4F8g@mail.gmail.com>
References: <CAETVUGhFOUy3AvdqP=2ar855k0E0ypV5juKSuEoYHXUMHd4F8g@mail.gmail.com>
Message-ID: <3005148.iFqyKQQmu1@even-i700>

On mardi 22 d?cembre 2020 21:54:44 CET Moises Silva wrote:
> Hi,
> 
>    I am newbie to use the GDAL and passing the problem in convert TopoJSON
> to SHP FIle.
>    I executed the command below and some files were created (.dbf, .shp,
> .shx) but the file .prj is not created.
>     Is there any parameters that I need to pass to create this .prj file?
>           ogr2ogr -f "ESRI Shapefile"  countries110m  countries110m.json
> 

The TopoJSON specification (https://github.com/topojson/topojson-specification 
) makes no mention of coordinate reference system. In most cases it might be 
EPSG:4326 as suggested by Jukka, as it is the default CRS for GeoJSON from 
which TopoJSON "derives"

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From evert.etienne at sitemark.com  Wed Dec 23 08:53:55 2020
From: evert.etienne at sitemark.com (Evert Etienne (SITEMARK))
Date: Wed, 23 Dec 2020 16:53:55 +0000
Subject: [gdal-dev] MBTiles generation docs question
Message-ID: <854F9F30-E17D-41EE-B03A-5A4A3936BB3D@sitemark.com>

Thank you Jukka for the links.

As I?ve commented on the github ticket and stackoverflow post, you helped me to find a workaround. 
Is there any tool available that can change a 3857 geotiff to the resolution needed for a specific zoom level at the location of the geotiff (I am having a hard time figuring out how this would work exactly due to the 3857 projection changing sizes)

Many thanks



From even.rouault at spatialys.com  Wed Dec 23 08:51:53 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 23 Dec 2020 17:51:53 +0100
Subject: [gdal-dev] Export multiple tables from GPKG to PG
In-Reply-To: <c38c92ca-64c3-80e9-9907-a0e773732fc9@gmail.com>
References: <c38c92ca-64c3-80e9-9907-a0e773732fc9@gmail.com>
Message-ID: <12879291.MW17BPD5mW@even-i700>

On mercredi 23 d?cembre 2020 16:00:28 CET matteo wrote:
> Hi all (again, sorry for the flooding),
> 
> for some reasons I have to export many tables (not all) from a GPKG to a
> PG database.
> 
> I can do it easily with a loop, but I need ogr2ogr to do it in a single
> transaction. That's because even if the first N tables are correctly
> imported, at the first error I need a total rollback without importing
> anything in PG.
> 
> The "problem" is that I have to specify some parameter in ogr2ogr (e.g.
> -nln) for each table to import.

You could possibly do that in 2 steps:
- use ogr2vrt to create a VRT from your source GeoPackage and rename layers as 
you wish
https://github.com/OSGeo/gdal/blob/master/gdal/swig/python/samples/ogr2vrt.py

- and then use ogr2ogr to convert that VRT to PG, with -gt unlimited to do 
that in a single transaction

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From franco.amato at gmail.com  Wed Dec 23 09:09:04 2020
From: franco.amato at gmail.com (Franco Amato)
Date: Wed, 23 Dec 2020 12:09:04 -0500
Subject: [gdal-dev] sfcgal support
Message-ID: <CA+CRCaZZOTYsh+Ko1xGVFNSK7+zLRGBEScnKFEjLS2kw4UvzJg@mail.gmail.com>

Hi everyone,
I would know if is possible to build gdal (3.x) with sfcgal support
as indicated at this link
https://github.com/OSGeo/gdal/blob/master/gdal/m4/sfcgal.m4.

I took a look at the nmake.opt file in the source package and didn't find
the right option.

Thanx

-- 
*Franco Amato*
Il caff? ? un piacere, se non ? buono che piacere ?...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201223/cbeb0af9/attachment.html>

From even.rouault at spatialys.com  Wed Dec 23 10:09:56 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 23 Dec 2020 19:09:56 +0100
Subject: [gdal-dev] sfcgal support
In-Reply-To: <CA+CRCaZZOTYsh+Ko1xGVFNSK7+zLRGBEScnKFEjLS2kw4UvzJg@mail.gmail.com>
References: <CA+CRCaZZOTYsh+Ko1xGVFNSK7+zLRGBEScnKFEjLS2kw4UvzJg@mail.gmail.com>
Message-ID: <2032934.50nOm3vPqy@even-i700>

On mercredi 23 d?cembre 2020 12:09:04 CET Franco Amato wrote:
> Hi everyone,
> I would know if is possible to build gdal (3.x) with sfcgal support
> as indicated at this link
> https://github.com/OSGeo/gdal/blob/master/gdal/m4/sfcgal.m4.
> 
> I took a look at the nmake.opt file in the source package and didn't find
> the right option.

It looks like it was never added to the Windows makefiles. It shouldn't be 
hopefully too hard to add if you want to try:
- make sure that the SFCGAL .lib is added to EXTERNAL_LIBS in nmake.opt
- edit ogr/makefile.vc to pass -DHAVE_SFCGAL and -I to the header files of 
SFCGA in EXTRA_FLAGS

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From hoseinimani95 at gmail.com  Wed Dec 23 12:19:45 2020
From: hoseinimani95 at gmail.com (hosein imani)
Date: Wed, 23 Dec 2020 23:49:45 +0330
Subject: [gdal-dev] HDF5 output
Message-ID: <CAAFGfcG4=XCziPbFSb=XhYFvh5skxU4hwLpGrQjfTBhC_xOkkQ@mail.gmail.com>

Hello
Does gdal_translate have capability to convert a format to HDF5?
I tried to convert ?tiff?format to ?HDF5? bud I got an error message
ERROR 1: HDF5 driver has no creation capabilities
If gdal doesn?t convert to HDF5, how could i convert to HDF5
Please advise

Thanks
Sincerely
-- 
Hosein Imani
Environmental Engineering, M.Sc
School of Civil Engineering
Sharif University of Technology
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201223/17279617/attachment.html>

From matteo.ghetta at gmail.com  Wed Dec 23 23:54:47 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Thu, 24 Dec 2020 08:54:47 +0100
Subject: [gdal-dev] Export multiple tables from GPKG to PG
In-Reply-To: <12879291.MW17BPD5mW@even-i700>
References: <c38c92ca-64c3-80e9-9907-a0e773732fc9@gmail.com>
 <12879291.MW17BPD5mW@even-i700>
Message-ID: <8bb93370-a88a-69d3-480e-a16266053866@gmail.com>

Hi Even,

thanks for the reply.

> You could possibly do that in 2 steps:
> - use ogr2vrt to create a VRT from your source GeoPackage and rename layers as
> you wish
> https://github.com/OSGeo/gdal/blob/master/gdal/swig/python/samples/ogr2vrt.py


OK so I've to download this file and run it to build a vrt file (if I 
don't want to create it by myself).
> - and then use ogr2ogr to convert that VRT to PG, with -gt unlimited to do
> that in a single transaction

so the parameter is literally ?:

ogr2ogr ...... -gt unlimited

?

Thanks!

Matteo

From even.rouault at spatialys.com  Thu Dec 24 03:15:10 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 24 Dec 2020 12:15:10 +0100
Subject: [gdal-dev] HDF5 output
In-Reply-To: <CAAFGfcG4=XCziPbFSb=XhYFvh5skxU4hwLpGrQjfTBhC_xOkkQ@mail.gmail.com>
References: <CAAFGfcG4=XCziPbFSb=XhYFvh5skxU4hwLpGrQjfTBhC_xOkkQ@mail.gmail.com>
Message-ID: <2731533.KsLgfmpHY7@even-i700>

On mercredi 23 d?cembre 2020 23:49:45 CET hosein imani wrote:
> Hello
> Does gdal_translate have capability to convert a format to HDF5?
> I tried to convert ?tiff?format to ?HDF5? bud I got an error message
> ERROR 1: HDF5 driver has no creation capabilities
> If gdal doesn?t convert to HDF5, how could i convert to HDF5
> Please advise

If you use the netCDF driver with the FORMAT=NC4 creation option, this will 
generate a netCDF 4 file, which is technically a HDF5 file

gdal_translate your.tif dest.h5 -of netCDF -co FORMAT=NC4

See https://gdal.org/drivers/raster/netcdf.html

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From hoseinimani95 at gmail.com  Thu Dec 24 03:27:33 2020
From: hoseinimani95 at gmail.com (hosein imani)
Date: Thu, 24 Dec 2020 14:57:33 +0330
Subject: [gdal-dev] HDF5 output
In-Reply-To: <2731533.KsLgfmpHY7@even-i700>
References: <CAAFGfcG4=XCziPbFSb=XhYFvh5skxU4hwLpGrQjfTBhC_xOkkQ@mail.gmail.com>
 <2731533.KsLgfmpHY7@even-i700>
Message-ID: <CAAFGfcGPOGoO3ujwqopRU=FDVHeHZeQ2N7dpxkuaeQ4GspgBrg@mail.gmail.com>

Awesome, thanks!

On Thu, Dec 24, 2020 at 14:45 Even Rouault <even.rouault at spatialys.com>
wrote:

> On mercredi 23 d?cembre 2020 23:49:45 CET hosein imani wrote:
> > Hello
> > Does gdal_translate have capability to convert a format to HDF5?
> > I tried to convert ?tiff?format to ?HDF5? bud I got an error message
> > ERROR 1: HDF5 driver has no creation capabilities
> > If gdal doesn?t convert to HDF5, how could i convert to HDF5
> > Please advise
>
> If you use the netCDF driver with the FORMAT=NC4 creation option, this
> will
> generate a netCDF 4 file, which is technically a HDF5 file
>
> gdal_translate your.tif dest.h5 -of netCDF -co FORMAT=NC4
>
> See https://gdal.org/drivers/raster/netcdf.html
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-- 
Hosein Imani
Environmental Engineering, M.Sc
School of Civil Engineering
Sharif University of Technology
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201224/921ba5c6/attachment.html>

From even.rouault at spatialys.com  Tue Dec 29 04:52:17 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 29 Dec 2020 13:52:17 +0100
Subject: [gdal-dev] GDAL 3.2.1 RC1 available
Message-ID: <5320397.ASe69ofMJq@even-i700>

Hi,

I have prepared a GDAL/OGR 3.2.1 release candidate.

Pick up an archive among the following ones (by ascending size):

  https://download.osgeo.org/gdal/3.2.1/gdal-3.2.1rc1.tar.xz
  https://download.osgeo.org/gdal/3.2.1/gdal-3.2.1rc1.tar.gz
  https://download.osgeo.org/gdal/3.2.1/gdal321rc1.zip

A snapshot of the gdalautotest suite is also available :

  https://download.osgeo.org/gdal/3.2.1/gdalautotest-3.2.1rc1.tar.gz
  https://download.osgeo.org/gdal/3.2.1/gdalautotest-3.2.1rc1.zip

GDAL-GRASS plugin:

  https://download.osgeo.org/gdal/3.2.1/gdal-grass-3.2.1.tar.gz

The NEWS file is here :

  https://github.com/OSGeo/gdal/blob/v3.2.1RC1/gdal/NEWS

I'll call for a vote promoting it to final before end of the week if no
serious problems are reported before.

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From snori at geovista.in  Tue Dec 29 07:22:25 2020
From: snori at geovista.in (snorimaps)
Date: Tue, 29 Dec 2020 08:22:25 -0700 (MST)
Subject: [gdal-dev] ogr2ogr PDF
In-Reply-To: <785199B14156764C8EB14EF96CEDC44EE6ABF6@xw-exch03.lfv.se>
References: <785199B14156764C8EB14EF96CEDC44EE67BF1@xw-exch03.lfv.se>
 <4fd18be65df5fd125e2931980b6df398@carto.net>
 <785199B14156764C8EB14EF96CEDC44EE69842@xw-exch03.lfv.se>
 <1573659318482-0.post@n6.nabble.com>
 <785199B14156764C8EB14EF96CEDC44EE69F5D@xw-exch03.lfv.se>
 <ef29aaa5-4895-f83c-3bfc-9740a9e05f98@gmail.com>
 <785199B14156764C8EB14EF96CEDC44EE6ABF6@xw-exch03.lfv.se>
Message-ID: <1609255345428-0.post@n6.nabble.com>

Hi Paul

Did you manage to solve this issue, I'm also unable to output a dash pattern
to PDF, it's always a solid line no matter what pattern I choose.

I also found several other PDF styling options not working:

- dash patterns for Linestrings
- LABEL option for Linestrings
- angle (a:) option for Points, when {angle} needs to be read from feature
properties.

I would appreciate any help from anyone to make the above work, I have tried
everything. Gdal v3.1.4

Thanks



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From matteo.ghetta at gmail.com  Tue Dec 29 07:25:57 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 29 Dec 2020 16:25:57 +0100
Subject: [gdal-dev] exporting all tables from PG schema
Message-ID: <df348aa8-54fb-3446-2ddf-27071ab8340a@gmail.com>

Hi all,

I'd like to export all the table of a PG schema to either GPKG or a 
shapefiles.

In the schema I've a lot of non-spatial tables and with something like:

ogr2ogr -f GPKG output.gpkg "PG:dbname=mydb schemas=myschema user=myuser 
password=mypws host=myhost" -progress

the output is generated but it only contains geometric tables. I 
couldn't find a parameter to force the export of also non-spatial tables.

What I'd like to avoid is to loop on every single layer

Cheers and thanks

Matteo

From jukka.rahkonen at maanmittauslaitos.fi  Tue Dec 29 09:27:53 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Tue, 29 Dec 2020 10:27:53 -0700 (MST)
Subject: [gdal-dev] exporting all tables from PG schema
In-Reply-To: <df348aa8-54fb-3446-2ddf-27071ab8340a@gmail.com>
References: <df348aa8-54fb-3446-2ddf-27071ab8340a@gmail.com>
Message-ID: <1609262873929-0.post@n6.nabble.com>

Hi,

I would have a try with open option LIST_ALL_TABLES=YES
https://gdal.org/drivers/vector/pg.html.
"LIST_ALL_TABLES=YES/NO: This may be ?YES? to force all tables, including
non-spatial ones, to be listed." It is probably worth reading
https://gdal.org/drivers/vector/gpkg.html as well, about the layer creation
options and aspatial tables.


-Jukka Rahkonen-




ghtmtt wrote
> Hi all,
> 
> I'd like to export all the table of a PG schema to either GPKG or a 
> shapefiles.
> 
> In the schema I've a lot of non-spatial tables and with something like:
> 
> ogr2ogr -f GPKG output.gpkg "PG:dbname=mydb schemas=myschema user=myuser 
> password=mypws host=myhost" -progress
> 
> the output is generated but it only contains geometric tables. I 
> couldn't find a parameter to force the export of also non-spatial tables.
> 
> What I'd like to avoid is to loop on every single layer
> 
> Cheers and thanks
> 
> Matteo
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From jan.heckman at gmail.com  Tue Dec 29 09:41:55 2020
From: jan.heckman at gmail.com (Jan Heckman)
Date: Tue, 29 Dec 2020 18:41:55 +0100
Subject: [gdal-dev] exporting all tables from PG schema
In-Reply-To: <1609262873929-0.post@n6.nabble.com>
References: <df348aa8-54fb-3446-2ddf-27071ab8340a@gmail.com>
 <1609262873929-0.post@n6.nabble.com>
Message-ID: <CAKMUAtD7E0f1jY32ZvSqCGZbAx4F5f5XJAEiK_RNj0rGWVnxCg@mail.gmail.com>

That's cool.
Had not yet run into this, but was probably going to pretty soon.
Thanks!

On Tue, Dec 29, 2020 at 6:28 PM jratike80 <
jukka.rahkonen at maanmittauslaitos.fi> wrote:

> Hi,
>
> I would have a try with open option LIST_ALL_TABLES=YES
> https://gdal.org/drivers/vector/pg.html.
> "LIST_ALL_TABLES=YES/NO: This may be ?YES? to force all tables, including
> non-spatial ones, to be listed." It is probably worth reading
> https://gdal.org/drivers/vector/gpkg.html as well, about the layer
> creation
> options and aspatial tables.
>
>
> -Jukka Rahkonen-
>
>
>
>
> ghtmtt wrote
> > Hi all,
> >
> > I'd like to export all the table of a PG schema to either GPKG or a
> > shapefiles.
> >
> > In the schema I've a lot of non-spatial tables and with something like:
> >
> > ogr2ogr -f GPKG output.gpkg "PG:dbname=mydb schemas=myschema user=myuser
> > password=mypws host=myhost" -progress
> >
> > the output is generated but it only contains geometric tables. I
> > couldn't find a parameter to force the export of also non-spatial tables.
> >
> > What I'd like to avoid is to loop on every single layer
> >
> > Cheers and thanks
> >
> > Matteo
> > _______________________________________________
> > gdal-dev mailing list
>
> > gdal-dev at .osgeo
>
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
>
>
> --
> Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201229/f0d991e3/attachment.html>

From matteo.ghetta at gmail.com  Tue Dec 29 09:59:42 2020
From: matteo.ghetta at gmail.com (matteo)
Date: Tue, 29 Dec 2020 18:59:42 +0100
Subject: [gdal-dev] exporting all tables from PG schema
In-Reply-To: <1609262873929-0.post@n6.nabble.com>
References: <df348aa8-54fb-3446-2ddf-27071ab8340a@gmail.com>
 <1609262873929-0.post@n6.nabble.com>
Message-ID: <749798e0-b501-64c2-ce64-b9526f2d41af@gmail.com>

Got it!

--config PG_LIST_ALL_TABLES YES

:)

Thanks

Matteo

From jed.kaplan at arve-research.com  Wed Dec 30 03:03:24 2020
From: jed.kaplan at arve-research.com (Jed O. Kaplan)
Date: Wed, 30 Dec 2020 19:03:24 +0800
Subject: [gdal-dev] gdalwarp: behavior of "mode" resampling with NODATA
Message-ID: <6CB8E4FF-0C43-428C-9055-3FD6BC6DB989@arve-research.com>

Working with GDAL 3.0.4

The behavior of ?mode? resampling when NODATA pixels are present is not clear to me from reading the documentation. I guess there are two possibilities:

1) If NODATA is the modal value among the pixels under consideration, then the result is NODATA
or
2) The modal value among the pixels under consideration is taken in exclusion of NODATA, so that a NODATA will be returned only if ALL of the pixels in the resampling window are NODATA.

I would prefer if it was (2) above, but I would be grateful if anyone could confirm how the filter works.

Many thanks,

Jed





From j1 at jimenezshaw.com  Wed Dec 30 03:14:15 2020
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 30 Dec 2020 12:14:15 +0100
Subject: [gdal-dev] gdalwarp: behavior of "mode" resampling with NODATA
In-Reply-To: <6CB8E4FF-0C43-428C-9055-3FD6BC6DB989@arve-research.com>
References: <6CB8E4FF-0C43-428C-9055-3FD6BC6DB989@arve-research.com>
Message-ID: <CADRrdKvRqzfsek-5T+-NjS9QsEdPkiupSvvP0-DnWm7OPv1LgA@mail.gmail.com>

What I understand is (2), and also my experience.

Cheers

El mi?., 30 dic. 2020 12:11, Jed O. Kaplan <jed.kaplan at arve-research.com>
escribi?:

> Working with GDAL 3.0.4
>
> The behavior of ?mode? resampling when NODATA pixels are present is not
> clear to me from reading the documentation. I guess there are two
> possibilities:
>
> 1) If NODATA is the modal value among the pixels under consideration, then
> the result is NODATA
> or
> 2) The modal value among the pixels under consideration is taken in
> exclusion of NODATA, so that a NODATA will be returned only if ALL of the
> pixels in the resampling window are NODATA.
>
> I would prefer if it was (2) above, but I would be grateful if anyone
> could confirm how the filter works.
>
> Many thanks,
>
> Jed
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201230/d7c2f01d/attachment.html>

From even.rouault at spatialys.com  Thu Dec 31 00:58:04 2020
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 31 Dec 2020 09:58:04 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.2.1 RC1
Message-ID: <2500286.d7aLm5r6SR@even-i700>

Hi,

Having heard no issues being reported regarding RC1

Motion:

Adopt GDAL 3.2.1 RC1 as final 3.2.1 release

Starting with my +1

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From mateusz at loskot.net  Thu Dec 31 01:23:04 2020
From: mateusz at loskot.net (Mateusz Loskot)
Date: Thu, 31 Dec 2020 10:23:04 +0100
Subject: [gdal-dev] Motion: promote GDAL 3.2.1 RC1
In-Reply-To: <2500286.d7aLm5r6SR@even-i700>
References: <2500286.d7aLm5r6SR@even-i700>
Message-ID: <CABUeae-nPj=uMurn87zxKnrb15uCdO+s4hbFswJ+7EWaHC2BkA@mail.gmail.com>

+1


Mateusz Loskot, mateusz at loskot.net
(Sent from mobile, may suffer from top-posting)

On Thu, 31 Dec 2020, 09:58 Even Rouault, <even.rouault at spatialys.com> wrote:

> Hi,
>
> Having heard no issues being reported regarding RC1
>
> Motion:
>
> Adopt GDAL 3.2.1 RC1 as final 3.2.1 release
>
> Starting with my +1
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20201231/a878114d/attachment.html>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Dec 31 05:20:55 2020
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Thu, 31 Dec 2020 06:20:55 -0700 (MST)
Subject: [gdal-dev] Motion: promote GDAL 3.2.1 RC1
In-Reply-To: <2500286.d7aLm5r6SR@even-i700>
References: <2500286.d7aLm5r6SR@even-i700>
Message-ID: <1609420855297-0.post@n6.nabble.com>

+1

-Jukka Rahkonen-


Even Rouault-2 wrote
> Hi,
> 
> Having heard no issues being reported regarding RC1
> 
> Motion:
> 
> Adopt GDAL 3.2.1 RC1 as final 3.2.1 release
> 
> Starting with my +1
> 
> Even
> 
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From dmorissette at mapgears.com  Thu Dec 31 09:03:24 2020
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Thu, 31 Dec 2020 12:03:24 -0500
Subject: [gdal-dev] Motion: promote GDAL 3.2.1 RC1
In-Reply-To: <2500286.d7aLm5r6SR@even-i700>
References: <2500286.d7aLm5r6SR@even-i700>
Message-ID: <2a6064e3-50b3-8878-cb56-a5897f564bf2@mapgears.com>

+1

Daniel


On 2020-12-31 03:58, Even Rouault wrote:
> Hi,
> 
> Having heard no issues being reported regarding RC1
> 
> Motion:
> 
> Adopt GDAL 3.2.1 RC1 as final 3.2.1 release
> 
> Starting with my +1
> 
> Even
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

